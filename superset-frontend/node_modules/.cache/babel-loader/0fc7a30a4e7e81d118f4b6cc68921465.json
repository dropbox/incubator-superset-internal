{"ast":null,"code":"import _reject from \"lodash/reject\"; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useMemo, useState } from 'react';\nimport { isFeatureEnabled, FeatureFlag, getExtensionsRegistry, styled, t } from '@superset-ui/core';\nimport rison from 'rison';\nimport Collapse from 'src/components/Collapse';\n\nimport { dangerouslyGetItemDoNotUse, dangerouslySetItemDoNotUse, getItem, LocalStorageKeys, setItem } from 'src/utils/localStorageHelpers';\nimport ListViewCard from 'src/components/ListViewCard';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { CardContainer, createErrorHandler, getRecentActivityObjs, getUserOwnedObjects, loadingCardCount, mq } from 'src/views/CRUD/utils';\nimport { AntdSwitch } from 'src/components';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport { TableTab } from 'src/views/CRUD/types';\nimport SubMenu from 'src/features/home/SubMenu';\nimport { userHasPermission } from 'src/dashboard/util/permissionUtils';\nimport ActivityTable from 'src/features/home/ActivityTable';\nimport ChartTable from 'src/features/home/ChartTable';\nimport SavedQueries from 'src/features/home/SavedQueries';\nimport DashboardTable from 'src/features/home/DashboardTable';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst extensionsRegistry = getExtensionsRegistry();\nconst DEFAULT_TAB_ARR = ['2', '3'];\nconst WelcomeContainer = styled.div`\n  background-color: ${(_ref) => {let { theme } = _ref;return theme.colors.grayscale.light4;}};\n  .ant-row.menu {\n    margin-top: -15px;\n    background-color: ${(_ref2) => {let { theme } = _ref2;return theme.colors.grayscale.light4;}};\n    &:after {\n      content: '';\n      display: block;\n      border: 1px solid ${(_ref3) => {let { theme } = _ref3;return theme.colors.grayscale.light2;}};\n      margin: 0px ${(_ref4) => {let { theme } = _ref4;return theme.gridUnit * 6;}}px;\n      position: relative;\n      width: 100%;\n      ${mq[1]} {\n        margin-top: 5px;\n        margin: 0px 2px;\n      }\n    }\n    .ant-menu.ant-menu-light.ant-menu-root.ant-menu-horizontal {\n      padding-left: ${(_ref5) => {let { theme } = _ref5;return theme.gridUnit * 8;}}px;\n    }\n    button {\n      padding: 3px 21px;\n    }\n  }\n  .ant-card-meta-description {\n    margin-top: ${(_ref6) => {let { theme } = _ref6;return theme.gridUnit;}}px;\n  }\n  .ant-card.ant-card-bordered {\n    border: 1px solid ${(_ref7) => {let { theme } = _ref7;return theme.colors.grayscale.light2;}};\n  }\n  .ant-collapse-item .ant-collapse-content {\n    margin-bottom: ${(_ref8) => {let { theme } = _ref8;return theme.gridUnit * -6;}}px;\n  }\n  div.ant-collapse-item:last-child.ant-collapse-item-active\n    .ant-collapse-header {\n    padding-bottom: ${(_ref9) => {let { theme } = _ref9;return theme.gridUnit * 3;}}px;\n  }\n  div.ant-collapse-item:last-child .ant-collapse-header {\n    padding-bottom: ${(_ref10) => {let { theme } = _ref10;return theme.gridUnit * 9;}}px;\n  }\n  .loading-cards {\n    margin-top: ${(_ref11) => {let { theme } = _ref11;return theme.gridUnit * 8;}}px;\n    .ant-card-cover > div {\n      height: 168px;\n    }\n  }\n`;\nconst WelcomeNav = styled.div`\n  ${(_ref12) => {let { theme } = _ref12;return `\n    .switch {\n      display: flex;\n      flex-direction: row;\n      margin: ${theme.gridUnit * 4}px;\n      span {\n        display: block;\n        margin: ${theme.gridUnit}px;\n        line-height: ${theme.gridUnit * 3.5}px;\n      }\n    }\n  `;}}\n`;\nconst bootstrapData = getBootstrapData();\nexport const LoadingCards = (_ref13) => {let { cover } = _ref13;return ___EmotionJSX(CardContainer, { showThumbnails: cover, className: \"loading-cards\" },\n  [...new Array(loadingCardCount)].map((_, index) => ___EmotionJSX(ListViewCard, { key: index, cover: cover ? false : ___EmotionJSX(React.Fragment, null), description: \"\", loading: true })));};\n\nfunction Welcome(_ref14) {let { user, addDangerToast } = _ref14;\n  const canReadSavedQueries = userHasPermission(user, 'SavedQuery', 'can_read');\n  const userid = user.userId;\n  const id = userid.toString(); // confident that user is not a guest user\n  const params = rison.encode({ page_size: 6 });\n  const recent = `/api/v1/log/recent_activity/?q=${params}`;\n  const [activeChild, setActiveChild] = useState('Loading');\n  const userKey = dangerouslyGetItemDoNotUse(id, null);\n  let defaultChecked = false;\n  const isThumbnailsEnabled = isFeatureEnabled(FeatureFlag.THUMBNAILS);\n  if (isThumbnailsEnabled) {\n    defaultChecked =\n    (userKey == null ? void 0 : userKey.thumbnails) === undefined ? true : userKey == null ? void 0 : userKey.thumbnails;\n  }\n  const [checked, setChecked] = useState(defaultChecked);\n  const [activityData, setActivityData] = useState(null);\n  const [chartData, setChartData] = useState(null);\n  const [queryData, setQueryData] = useState(null);\n  const [dashboardData, setDashboardData] = useState(null);\n  const [isFetchingActivityData, setIsFetchingActivityData] = useState(true);\n  const collapseState = getItem(LocalStorageKeys.homepage_collapse_state, []);\n  const [activeState, setActiveState] = useState(collapseState);\n  const handleCollapse = (state) => {\n    setActiveState(state);\n    setItem(LocalStorageKeys.homepage_collapse_state, state);\n  };\n  const WelcomeMessageExtension = extensionsRegistry.get('welcome.message');\n  const WelcomeTopExtension = extensionsRegistry.get('welcome.banner');\n  const WelcomeMainExtension = extensionsRegistry.get('welcome.main.replacement');\n  const [otherTabTitle, otherTabFilters] = useMemo(() => {var _bootstrapData$common;\n    const lastTab = (_bootstrapData$common = bootstrapData.common) == null ? void 0 : _bootstrapData$common.conf.\n    WELCOME_PAGE_LAST_TAB;\n    const [customTitle, customFilter] = Array.isArray(lastTab) ?\n    lastTab :\n    [undefined, undefined];\n    if (customTitle && customFilter) {\n      return [t(customTitle), customFilter];\n    }\n    if (lastTab === 'all') {\n      return [t('All'), []];\n    }\n    return [\n    t('Examples'),\n    [\n    {\n      col: 'created_by',\n      opr: 'rel_o_m',\n      value: 0 }]];\n\n\n\n  }, []);\n  useEffect(() => {\n    if (!otherTabFilters) {\n      return;\n    }\n    const activeTab = getItem(LocalStorageKeys.homepage_activity_filter, null);\n    setActiveState(collapseState.length > 0 ? collapseState : DEFAULT_TAB_ARR);\n    getRecentActivityObjs(user.userId, recent, addDangerToast, otherTabFilters).\n    then((res) => {\n      const data = {};\n      data[TableTab.Other] = res.other;\n      if (res.viewed) {\n        const filtered = _reject(res.viewed, ['item_url', null]).map((r) => r);\n        data[TableTab.Viewed] = filtered;\n        if (!activeTab && data[TableTab.Viewed]) {\n          setActiveChild(TableTab.Viewed);\n        } else\n        if (!activeTab && !data[TableTab.Viewed]) {\n          setActiveChild(TableTab.Created);\n        } else\n\n        setActiveChild(activeTab || TableTab.Created);\n      } else\n      if (!activeTab)\n      setActiveChild(TableTab.Created);else\n\n      setActiveChild(activeTab);\n      setActivityData((activityData) => ({ ...activityData, ...data }));\n    }).\n    catch(createErrorHandler((errMsg) => {\n      setActivityData((activityData) => ({\n        ...activityData,\n        [TableTab.Viewed]: [] }));\n\n      addDangerToast(t('There was an issue fetching your recent activity: %s', errMsg));\n    }));\n    // Sets other activity data in parallel with recents api call\n    const ownSavedQueryFilters = [\n    {\n      col: 'created_by',\n      opr: 'rel_o_m',\n      value: `${id}` }];\n\n\n    Promise.all([\n    getUserOwnedObjects(id, 'dashboard').\n    then((r) => {\n      setDashboardData(r);\n      return Promise.resolve();\n    }).\n    catch((err) => {\n      setDashboardData([]);\n      addDangerToast(t('There was an issue fetching your dashboards: %s', err));\n      return Promise.resolve();\n    }),\n    getUserOwnedObjects(id, 'chart').\n    then((r) => {\n      setChartData(r);\n      return Promise.resolve();\n    }).\n    catch((err) => {\n      setChartData([]);\n      addDangerToast(t('There was an issue fetching your chart: %s', err));\n      return Promise.resolve();\n    }),\n    canReadSavedQueries ?\n    getUserOwnedObjects(id, 'saved_query', ownSavedQueryFilters).\n    then((r) => {\n      setQueryData(r);\n      return Promise.resolve();\n    }).\n    catch((err) => {\n      setQueryData([]);\n      addDangerToast(t('There was an issue fetching your saved queries: %s', err));\n      return Promise.resolve();\n    }) :\n    Promise.resolve()]).\n    then(() => {\n      setIsFetchingActivityData(false);\n    });\n  }, [otherTabFilters]);\n  const handleToggle = () => {\n    setChecked(!checked);\n    dangerouslySetItemDoNotUse(id, { thumbnails: !checked });\n  };\n  useEffect(() => {\n    if (!collapseState && queryData != null && queryData.length) {\n      setActiveState((activeState) => [...activeState, '4']);\n    }\n    setActivityData((activityData) => ({\n      ...activityData,\n      Created: [\n      ...((chartData == null ? void 0 : chartData.slice(0, 3)) || []),\n      ...((dashboardData == null ? void 0 : dashboardData.slice(0, 3)) || []),\n      ...((queryData == null ? void 0 : queryData.slice(0, 3)) || [])] }));\n\n\n  }, [chartData, queryData, dashboardData]);\n  useEffect(() => {var _activityData$TableTa;\n    if (!collapseState && activityData != null && (_activityData$TableTa = activityData[TableTab.Viewed]) != null && _activityData$TableTa.length) {\n      setActiveState((activeState) => ['1', ...activeState]);\n    }\n  }, [activityData]);\n  const isRecentActivityLoading = !(activityData != null && activityData[TableTab.Other]) && !(activityData != null && activityData[TableTab.Viewed]);\n  const menuData = {\n    activeChild: 'Home',\n    name: t('Home') };\n\n  if (isThumbnailsEnabled) {\n    menuData.buttons = [\n    {\n      name: ___EmotionJSX(WelcomeNav, null,\n      ___EmotionJSX(\"div\", { className: \"switch\" },\n      ___EmotionJSX(AntdSwitch, { checked: checked, onClick: handleToggle }),\n      ___EmotionJSX(\"span\", null, t('Thumbnails')))),\n\n\n      onClick: handleToggle,\n      buttonStyle: 'link' }];\n\n\n  }\n  return ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(SubMenu, menuData),\n  ___EmotionJSX(WelcomeContainer, null,\n  WelcomeMessageExtension && ___EmotionJSX(WelcomeMessageExtension, null),\n  WelcomeTopExtension && ___EmotionJSX(WelcomeTopExtension, null),\n  WelcomeMainExtension && ___EmotionJSX(WelcomeMainExtension, null),\n  (!WelcomeTopExtension || !WelcomeMainExtension) && ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(Collapse, { activeKey: activeState, onChange: handleCollapse, ghost: true, bigger: true },\n  ___EmotionJSX(Collapse.Panel, { header: t('Recents'), key: \"1\" },\n  activityData && (\n  activityData[TableTab.Viewed] ||\n  activityData[TableTab.Other] ||\n  activityData[TableTab.Created]) &&\n  activeChild !== 'Loading' ? ___EmotionJSX(ActivityTable, { user: { userId: user.userId } // user is definitely not a guest user on this page\n    , activeChild: activeChild, setActiveChild: setActiveChild, activityData: activityData, isFetchingActivityData: isFetchingActivityData }) : ___EmotionJSX(LoadingCards, null)),\n\n  ___EmotionJSX(Collapse.Panel, { header: t('Dashboards'), key: \"2\" },\n  !dashboardData || isRecentActivityLoading ? ___EmotionJSX(LoadingCards, { cover: checked }) : ___EmotionJSX(DashboardTable, { user: user, mine: dashboardData, showThumbnails: checked, otherTabData: activityData == null ? void 0 : activityData[TableTab.Other], otherTabFilters: otherTabFilters, otherTabTitle: otherTabTitle })),\n\n  ___EmotionJSX(Collapse.Panel, { header: t('Charts'), key: \"3\" },\n  !chartData || isRecentActivityLoading ? ___EmotionJSX(LoadingCards, { cover: checked }) : ___EmotionJSX(ChartTable, { showThumbnails: checked, user: user, mine: chartData, otherTabData: activityData == null ? void 0 : activityData[TableTab.Other], otherTabFilters: otherTabFilters, otherTabTitle: otherTabTitle })),\n\n  canReadSavedQueries && ___EmotionJSX(Collapse.Panel, { header: t('Saved queries'), key: \"4\" },\n  !queryData ? ___EmotionJSX(LoadingCards, { cover: checked }) : ___EmotionJSX(SavedQueries, { showThumbnails: checked, user: user, mine: queryData, featureFlag: isThumbnailsEnabled }))))));\n\n\n\n\n\n}\nexport default withToasts(Welcome);","map":{"version":3,"mappings":"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","names":["React","useEffect","useMemo","useState","isFeatureEnabled","FeatureFlag","getExtensionsRegistry","styled","t","rison","Collapse","dangerouslyGetItemDoNotUse","dangerouslySetItemDoNotUse","getItem","LocalStorageKeys","setItem","ListViewCard","withToasts","CardContainer","createErrorHandler","getRecentActivityObjs","getUserOwnedObjects","loadingCardCount","mq","AntdSwitch","getBootstrapData","TableTab","SubMenu","userHasPermission","ActivityTable","ChartTable","SavedQueries","DashboardTable","extensionsRegistry","DEFAULT_TAB_ARR","WelcomeContainer","div","theme","colors","grayscale","light4","light2","gridUnit","WelcomeNav","bootstrapData","LoadingCards","cover","Array","map","_","index","Welcome","user","addDangerToast","canReadSavedQueries","userid","userId","id","toString","params","encode","page_size","recent","activeChild","setActiveChild","userKey","defaultChecked","isThumbnailsEnabled","THUMBNAILS","thumbnails","undefined","checked","setChecked","activityData","setActivityData","chartData","setChartData","queryData","setQueryData","dashboardData","setDashboardData","isFetchingActivityData","setIsFetchingActivityData","collapseState","homepage_collapse_state","activeState","setActiveState","handleCollapse","state","WelcomeMessageExtension","get","WelcomeTopExtension","WelcomeMainExtension","otherTabTitle","otherTabFilters","lastTab","common","conf","WELCOME_PAGE_LAST_TAB","customTitle","customFilter","isArray","col","opr","value","activeTab","homepage_activity_filter","length","then","data","Other","res","other","viewed","filtered","r","Viewed","Created","catch","errMsg","ownSavedQueryFilters","Promise","all","resolve","err","handleToggle","slice","isRecentActivityLoading","menuData","name","buttons","onClick","buttonStyle"],"sourceRoot":"","sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/src/pages/Home/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useMemo, useState } from 'react';\nimport {\n  isFeatureEnabled,\n  FeatureFlag,\n  getExtensionsRegistry,\n  JsonObject,\n  styled,\n  t,\n} from '@superset-ui/core';\nimport rison from 'rison';\nimport Collapse from 'src/components/Collapse';\nimport { User } from 'src/types/bootstrapTypes';\nimport { reject } from 'lodash';\nimport {\n  dangerouslyGetItemDoNotUse,\n  dangerouslySetItemDoNotUse,\n  getItem,\n  LocalStorageKeys,\n  setItem,\n} from 'src/utils/localStorageHelpers';\nimport ListViewCard from 'src/components/ListViewCard';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport {\n  CardContainer,\n  createErrorHandler,\n  getRecentActivityObjs,\n  getUserOwnedObjects,\n  loadingCardCount,\n  mq,\n} from 'src/views/CRUD/utils';\nimport { AntdSwitch } from 'src/components';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport { TableTab } from 'src/views/CRUD/types';\nimport SubMenu, { SubMenuProps } from 'src/features/home/SubMenu';\nimport { userHasPermission } from 'src/dashboard/util/permissionUtils';\nimport { WelcomePageLastTab } from 'src/features/home/types';\nimport ActivityTable from 'src/features/home/ActivityTable';\nimport ChartTable from 'src/features/home/ChartTable';\nimport SavedQueries from 'src/features/home/SavedQueries';\nimport DashboardTable from 'src/features/home/DashboardTable';\n\nconst extensionsRegistry = getExtensionsRegistry();\n\ninterface WelcomeProps {\n  user: User;\n  addDangerToast: (arg0: string) => void;\n}\n\nexport interface ActivityData {\n  [TableTab.Created]?: JsonObject[];\n  [TableTab.Edited]?: JsonObject[];\n  [TableTab.Viewed]?: JsonObject[];\n  [TableTab.Other]?: JsonObject[];\n}\n\ninterface LoadingProps {\n  cover?: boolean;\n}\n\nconst DEFAULT_TAB_ARR = ['2', '3'];\n\nconst WelcomeContainer = styled.div`\n  background-color: ${({ theme }) => theme.colors.grayscale.light4};\n  .ant-row.menu {\n    margin-top: -15px;\n    background-color: ${({ theme }) => theme.colors.grayscale.light4};\n    &:after {\n      content: '';\n      display: block;\n      border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n      margin: 0px ${({ theme }) => theme.gridUnit * 6}px;\n      position: relative;\n      width: 100%;\n      ${mq[1]} {\n        margin-top: 5px;\n        margin: 0px 2px;\n      }\n    }\n    .ant-menu.ant-menu-light.ant-menu-root.ant-menu-horizontal {\n      padding-left: ${({ theme }) => theme.gridUnit * 8}px;\n    }\n    button {\n      padding: 3px 21px;\n    }\n  }\n  .ant-card-meta-description {\n    margin-top: ${({ theme }) => theme.gridUnit}px;\n  }\n  .ant-card.ant-card-bordered {\n    border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n  .ant-collapse-item .ant-collapse-content {\n    margin-bottom: ${({ theme }) => theme.gridUnit * -6}px;\n  }\n  div.ant-collapse-item:last-child.ant-collapse-item-active\n    .ant-collapse-header {\n    padding-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n  }\n  div.ant-collapse-item:last-child .ant-collapse-header {\n    padding-bottom: ${({ theme }) => theme.gridUnit * 9}px;\n  }\n  .loading-cards {\n    margin-top: ${({ theme }) => theme.gridUnit * 8}px;\n    .ant-card-cover > div {\n      height: 168px;\n    }\n  }\n`;\n\nconst WelcomeNav = styled.div`\n  ${({ theme }) => `\n    .switch {\n      display: flex;\n      flex-direction: row;\n      margin: ${theme.gridUnit * 4}px;\n      span {\n        display: block;\n        margin: ${theme.gridUnit}px;\n        line-height: ${theme.gridUnit * 3.5}px;\n      }\n    }\n  `}\n`;\n\nconst bootstrapData = getBootstrapData();\n\nexport const LoadingCards = ({ cover }: LoadingProps) => (\n  <CardContainer showThumbnails={cover} className=\"loading-cards\">\n    {[...new Array(loadingCardCount)].map((_, index) => (\n      <ListViewCard\n        key={index}\n        cover={cover ? false : <></>}\n        description=\"\"\n        loading\n      />\n    ))}\n  </CardContainer>\n);\n\nfunction Welcome({ user, addDangerToast }: WelcomeProps) {\n  const canReadSavedQueries = userHasPermission(user, 'SavedQuery', 'can_read');\n  const userid = user.userId;\n  const id = userid!.toString(); // confident that user is not a guest user\n  const params = rison.encode({ page_size: 6 });\n  const recent = `/api/v1/log/recent_activity/?q=${params}`;\n  const [activeChild, setActiveChild] = useState('Loading');\n  const userKey = dangerouslyGetItemDoNotUse(id, null);\n  let defaultChecked = false;\n  const isThumbnailsEnabled = isFeatureEnabled(FeatureFlag.THUMBNAILS);\n  if (isThumbnailsEnabled) {\n    defaultChecked =\n      userKey?.thumbnails === undefined ? true : userKey?.thumbnails;\n  }\n  const [checked, setChecked] = useState(defaultChecked);\n  const [activityData, setActivityData] = useState<ActivityData | null>(null);\n  const [chartData, setChartData] = useState<Array<object> | null>(null);\n  const [queryData, setQueryData] = useState<Array<object> | null>(null);\n  const [dashboardData, setDashboardData] = useState<Array<object> | null>(\n    null,\n  );\n  const [isFetchingActivityData, setIsFetchingActivityData] = useState(true);\n\n  const collapseState = getItem(LocalStorageKeys.homepage_collapse_state, []);\n  const [activeState, setActiveState] = useState<Array<string>>(collapseState);\n\n  const handleCollapse = (state: Array<string>) => {\n    setActiveState(state);\n    setItem(LocalStorageKeys.homepage_collapse_state, state);\n  };\n\n  const WelcomeMessageExtension = extensionsRegistry.get('welcome.message');\n  const WelcomeTopExtension = extensionsRegistry.get('welcome.banner');\n  const WelcomeMainExtension = extensionsRegistry.get(\n    'welcome.main.replacement',\n  );\n\n  const [otherTabTitle, otherTabFilters] = useMemo(() => {\n    const lastTab = bootstrapData.common?.conf\n      .WELCOME_PAGE_LAST_TAB as WelcomePageLastTab;\n    const [customTitle, customFilter] = Array.isArray(lastTab)\n      ? lastTab\n      : [undefined, undefined];\n    if (customTitle && customFilter) {\n      return [t(customTitle), customFilter];\n    }\n    if (lastTab === 'all') {\n      return [t('All'), []];\n    }\n    return [\n      t('Examples'),\n      [\n        {\n          col: 'created_by',\n          opr: 'rel_o_m',\n          value: 0,\n        },\n      ],\n    ];\n  }, []);\n\n  useEffect(() => {\n    if (!otherTabFilters) {\n      return;\n    }\n    const activeTab = getItem(LocalStorageKeys.homepage_activity_filter, null);\n    setActiveState(collapseState.length > 0 ? collapseState : DEFAULT_TAB_ARR);\n    getRecentActivityObjs(user.userId!, recent, addDangerToast, otherTabFilters)\n      .then(res => {\n        const data: ActivityData | null = {};\n        data[TableTab.Other] = res.other;\n        if (res.viewed) {\n          const filtered = reject(res.viewed, ['item_url', null]).map(r => r);\n          data[TableTab.Viewed] = filtered;\n          if (!activeTab && data[TableTab.Viewed]) {\n            setActiveChild(TableTab.Viewed);\n          } else if (!activeTab && !data[TableTab.Viewed]) {\n            setActiveChild(TableTab.Created);\n          } else setActiveChild(activeTab || TableTab.Created);\n        } else if (!activeTab) setActiveChild(TableTab.Created);\n        else setActiveChild(activeTab);\n        setActivityData(activityData => ({ ...activityData, ...data }));\n      })\n      .catch(\n        createErrorHandler((errMsg: unknown) => {\n          setActivityData(activityData => ({\n            ...activityData,\n            [TableTab.Viewed]: [],\n          }));\n          addDangerToast(\n            t('There was an issue fetching your recent activity: %s', errMsg),\n          );\n        }),\n      );\n\n    // Sets other activity data in parallel with recents api call\n    const ownSavedQueryFilters = [\n      {\n        col: 'created_by',\n        opr: 'rel_o_m',\n        value: `${id}`,\n      },\n    ];\n    Promise.all([\n      getUserOwnedObjects(id, 'dashboard')\n        .then(r => {\n          setDashboardData(r);\n          return Promise.resolve();\n        })\n        .catch((err: unknown) => {\n          setDashboardData([]);\n          addDangerToast(\n            t('There was an issue fetching your dashboards: %s', err),\n          );\n          return Promise.resolve();\n        }),\n      getUserOwnedObjects(id, 'chart')\n        .then(r => {\n          setChartData(r);\n          return Promise.resolve();\n        })\n        .catch((err: unknown) => {\n          setChartData([]);\n          addDangerToast(t('There was an issue fetching your chart: %s', err));\n          return Promise.resolve();\n        }),\n      canReadSavedQueries\n        ? getUserOwnedObjects(id, 'saved_query', ownSavedQueryFilters)\n            .then(r => {\n              setQueryData(r);\n              return Promise.resolve();\n            })\n            .catch((err: unknown) => {\n              setQueryData([]);\n              addDangerToast(\n                t('There was an issue fetching your saved queries: %s', err),\n              );\n              return Promise.resolve();\n            })\n        : Promise.resolve(),\n    ]).then(() => {\n      setIsFetchingActivityData(false);\n    });\n  }, [otherTabFilters]);\n\n  const handleToggle = () => {\n    setChecked(!checked);\n    dangerouslySetItemDoNotUse(id, { thumbnails: !checked });\n  };\n\n  useEffect(() => {\n    if (!collapseState && queryData?.length) {\n      setActiveState(activeState => [...activeState, '4']);\n    }\n    setActivityData(activityData => ({\n      ...activityData,\n      Created: [\n        ...(chartData?.slice(0, 3) || []),\n        ...(dashboardData?.slice(0, 3) || []),\n        ...(queryData?.slice(0, 3) || []),\n      ],\n    }));\n  }, [chartData, queryData, dashboardData]);\n\n  useEffect(() => {\n    if (!collapseState && activityData?.[TableTab.Viewed]?.length) {\n      setActiveState(activeState => ['1', ...activeState]);\n    }\n  }, [activityData]);\n\n  const isRecentActivityLoading =\n    !activityData?.[TableTab.Other] && !activityData?.[TableTab.Viewed];\n\n  const menuData: SubMenuProps = {\n    activeChild: 'Home',\n    name: t('Home'),\n  };\n\n  if (isThumbnailsEnabled) {\n    menuData.buttons = [\n      {\n        name: (\n          <WelcomeNav>\n            <div className=\"switch\">\n              <AntdSwitch checked={checked} onClick={handleToggle} />\n              <span>{t('Thumbnails')}</span>\n            </div>\n          </WelcomeNav>\n        ),\n        onClick: handleToggle,\n        buttonStyle: 'link',\n      },\n    ];\n  }\n\n  return (\n    <>\n      <SubMenu {...menuData} />\n      <WelcomeContainer>\n        {WelcomeMessageExtension && <WelcomeMessageExtension />}\n        {WelcomeTopExtension && <WelcomeTopExtension />}\n        {WelcomeMainExtension && <WelcomeMainExtension />}\n        {(!WelcomeTopExtension || !WelcomeMainExtension) && (\n          <>\n            <Collapse\n              activeKey={activeState}\n              onChange={handleCollapse}\n              ghost\n              bigger\n            >\n              <Collapse.Panel header={t('Recents')} key=\"1\">\n                {activityData &&\n                (activityData[TableTab.Viewed] ||\n                  activityData[TableTab.Other] ||\n                  activityData[TableTab.Created]) &&\n                activeChild !== 'Loading' ? (\n                  <ActivityTable\n                    user={{ userId: user.userId! }} // user is definitely not a guest user on this page\n                    activeChild={activeChild}\n                    setActiveChild={setActiveChild}\n                    activityData={activityData}\n                    isFetchingActivityData={isFetchingActivityData}\n                  />\n                ) : (\n                  <LoadingCards />\n                )}\n              </Collapse.Panel>\n              <Collapse.Panel header={t('Dashboards')} key=\"2\">\n                {!dashboardData || isRecentActivityLoading ? (\n                  <LoadingCards cover={checked} />\n                ) : (\n                  <DashboardTable\n                    user={user}\n                    mine={dashboardData}\n                    showThumbnails={checked}\n                    otherTabData={activityData?.[TableTab.Other]}\n                    otherTabFilters={otherTabFilters}\n                    otherTabTitle={otherTabTitle}\n                  />\n                )}\n              </Collapse.Panel>\n              <Collapse.Panel header={t('Charts')} key=\"3\">\n                {!chartData || isRecentActivityLoading ? (\n                  <LoadingCards cover={checked} />\n                ) : (\n                  <ChartTable\n                    showThumbnails={checked}\n                    user={user}\n                    mine={chartData}\n                    otherTabData={activityData?.[TableTab.Other]}\n                    otherTabFilters={otherTabFilters}\n                    otherTabTitle={otherTabTitle}\n                  />\n                )}\n              </Collapse.Panel>\n              {canReadSavedQueries && (\n                <Collapse.Panel header={t('Saved queries')} key=\"4\">\n                  {!queryData ? (\n                    <LoadingCards cover={checked} />\n                  ) : (\n                    <SavedQueries\n                      showThumbnails={checked}\n                      user={user}\n                      mine={queryData}\n                      featureFlag={isThumbnailsEnabled}\n                    />\n                  )}\n                </Collapse.Panel>\n              )}\n            </Collapse>\n          </>\n        )}\n      </WelcomeContainer>\n    </>\n  );\n}\n\nexport default withToasts(Welcome);\n"]},"metadata":{},"sourceType":"module"}