{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport * as d3array from 'd3-array';\nimport sandboxedEval from '../utils/sandbox';\n\nexport function commonLayerProps(\nformData,\nsetTooltip,\nsetTooltipContent,\nonSelect)\n{\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = (o) => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y });\n\n      } else {\n        setTooltip(null);\n      }\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = (o) => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n    };\n  } else if (fd.table_filter && onSelect !== undefined) {\n    onClick = (o) => onSelect(o.object[fd.line_column]);\n  }\n\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover) };\n\n}\n\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99 };\n\n\n/* Get an a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(type, accessor) {if (type === void 0) {type = 'sum';}if (accessor === void 0) {accessor = null;}\n  if (type === 'count') {\n    return (arr) => arr.length;\n  }\n  let d3func;\n  if (type in percentiles) {\n    d3func = (arr, acc) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1, o2) =>\n        d3array.ascending(accessor(o1), accessor(o2)));\n\n      } else {\n        sortedArr = arr.sort(d3array.ascending);\n      }\n\n      return d3array.quantile(sortedArr, percentiles[type], acc);\n    };\n  } else {\n    d3func = d3array[type];\n  }\n  if (!accessor) {\n    return (arr) => d3func(arr);\n  }\n\n  return (arr) => d3func(arr.map((x) => accessor(x)));\n}","map":{"version":3,"names":["d3array","sandboxedEval","commonLayerProps","formData","setTooltip","setTooltipContent","onSelect","fd","onHover","tooltipContentGenerator","js_tooltip","o","picked","content","x","y","onClick","js_onclick_href","href","window","open","table_filter","undefined","object","line_column","pickable","Boolean","percentiles","p1","p5","p95","p99","getAggFunc","type","accessor","arr","length","d3func","acc","sortedArr","sort","o1","o2","ascending","quantile","map"],"sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/layers/common.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport * as d3array from 'd3-array';\nimport sandboxedEval from '../utils/sandbox';\n\nexport function commonLayerProps(\n  formData,\n  setTooltip,\n  setTooltipContent,\n  onSelect,\n) {\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = o => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y,\n        });\n      } else {\n        setTooltip(null);\n      }\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = o => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n    };\n  } else if (fd.table_filter && onSelect !== undefined) {\n    onClick = o => onSelect(o.object[fd.line_column]);\n  }\n\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover),\n  };\n}\n\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99,\n};\n\n/* Get an a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(type = 'sum', accessor = null) {\n  if (type === 'count') {\n    return arr => arr.length;\n  }\n  let d3func;\n  if (type in percentiles) {\n    d3func = (arr, acc) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1, o2) =>\n          d3array.ascending(accessor(o1), accessor(o2)),\n        );\n      } else {\n        sortedArr = arr.sort(d3array.ascending);\n      }\n\n      return d3array.quantile(sortedArr, percentiles[type], acc);\n    };\n  } else {\n    d3func = d3array[type];\n  }\n  if (!accessor) {\n    return arr => d3func(arr);\n  }\n\n  return arr => d3func(arr.map(x => accessor(x)));\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}