{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint global-require: 0 */\nimport $ from 'jquery';\nimport { SupersetClient } from '@superset-ui/core';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport setupErrorMessages from 'src/setup/setupErrorMessages';\nfunction showApiMessage(resp) {\n  const template = '<div class=\"alert\"> ' +\n  '<button type=\"button\" class=\"close\" ' +\n  'data-dismiss=\"alert\">\\xD7</button> </div>';\n  const severity = resp.severity || 'info';\n  $(template).\n  addClass(`alert-${severity}`).\n  append(resp.message || '').\n  appendTo($('#alert-container'));\n}\nfunction toggleCheckbox(apiUrlPrefix, selector) {\n  SupersetClient.get({\n    endpoint: apiUrlPrefix + $(selector)[0].checked }).\n\n  then(() => undefined).\n  catch((response) => getClientErrorObject(response).then((parsedResp) => {\n    if (parsedResp != null && parsedResp.message) {\n      showApiMessage(parsedResp);\n    }\n  }));\n}\nexport default function setupApp() {\n  $(document).ready(function () {\n    $(':checkbox[data-checkbox-api-prefix]').change(function () {\n      const $this = $(this);\n      const prefix = $this.data('checkbox-api-prefix');\n      const id = $this.attr('id');\n      toggleCheckbox(prefix, `#${id}`);\n    });\n    // for language picker dropdown\n    $('#language-picker a').click(function (ev) {\n      ev.preventDefault();\n      SupersetClient.get({\n        url: ev.currentTarget.href,\n        parseMethod: null }).\n      then(() => {\n        window.location.reload();\n      });\n    });\n  });\n  // A set of hacks to allow apps to run within a FAB template\n  // this allows for the server side generated menus to function\n  window.$ = $;\n  window.jQuery = $;\n  require('bootstrap');\n  // setup appwide custom error messages\n  setupErrorMessages();\n}","map":{"version":3,"mappings":"AAAA;;;;;;;;;;;;;;;;;;AAkBA;AACA,OAAOA,CAAP,MAAc,QAAd;AACA,SAASC,cAAT,QAA+B,mBAA/B;AACA,SACEC,oBADF,QAGO,gCAHP;AAIA,OAAOC,kBAAP,MAA+B,8BAA/B;AAUA,SAASC,cAAT,CAAwBC,IAAxB,EAA+C;EAC7C,MAAMC,QAAQ,GACZ;EACA,sCADA;EAEA,2CAHF;EAIA,MAAMC,QAAQ,GAAGF,IAAI,CAACE,QAAL,IAAiB,MAAlC;EACAP,CAAC,CAACM,QAAD,CAAD;EACGE,QADH,CACY,SAASD,QAAQ,EAD7B;EAEGE,MAFH,CAEUJ,IAAI,CAACK,OAAL,IAAgB,EAF1B;EAGGC,QAHH,CAGYX,CAAC,CAAC,kBAAD,CAHb;AAID;AAED,SAASY,cAAT,CAAwBC,YAAxB,EAA8CC,QAA9C,EAA8D;EAC5Db,cAAc,CAACc,GAAf,CAAmB;IACjBC,QAAQ,EAAEH,YAAY,GAAIb,CAAC,CAACc,QAAD,CAAD,CAAY,CAAZ,EAAoCG,OAD7C,EAAnB;;EAGGC,IAHH,CAGQ,MAAMC,SAHd;EAIGC,KAJH,CAIS,SAAQ,KACblB,oBAAoB,CAACmB,QAAD,CAApB,CAA+BH,IAA/B,CAAoC,WAAU,KAAG;IAC/C,IAAII,UAAJ,YAAIA,UAAU,CAAEZ,OAAhB,EAAyB;MACvBN,cAAc,CAACkB,UAAD,CAAd;IACD;EACF,CAJD,CALJ;AAWD;AAED,eAAc,SAAUC,QAAV,GAAkB;EAC9BvB,CAAC,CAACwB,QAAD,CAAD,CAAYC,KAAZ,CAAkB;IAChBzB,CAAC,CAAC,qCAAD,CAAD,CAAyC0B,MAAzC,CAAgD;MAG9C,MAAMC,KAAK,GAAG3B,CAAC,CAAC,IAAD,CAAf;MACA,MAAM4B,MAAM,GAAGD,KAAK,CAACE,IAAN,CAAW,qBAAX,CAAf;MACA,MAAMC,EAAE,GAAGH,KAAK,CAACI,IAAN,CAAW,IAAX,CAAX;MACAnB,cAAc,CAACgB,MAAD,EAAS,IAAIE,EAAE,EAAf,CAAd;IACD,CAPD;IASA;IACA9B,CAAC,CAAC,oBAAD,CAAD,CAAwBgC,KAAxB,CAA8B,UAC5BC,EAD4B,EAM3B;MAEDA,EAAE,CAACC,cAAH;MACAjC,cAAc,CAACc,GAAf,CAAmB;QACjBoB,GAAG,EAAEF,EAAE,CAACG,aAAH,CAAiBC,IADL;QAEjBC,WAAW,EAAE,IAFI,EAAnB;MAGGpB,IAHH,CAGQ,MAAK;QACXqB,MAAM,CAACC,QAAP,CAAgBC,MAAhB;MACD,CALD;IAMD,CAfD;EAgBD,CA3BD;EA6BA;EACA;EACAF,MAAM,CAACvC,CAAP,GAAWA,CAAX;EACAuC,MAAM,CAACG,MAAP,GAAgB1C,CAAhB;EACA2C,OAAO,CAAC,WAAD,CAAP;EAEA;EACAxC,kBAAkB;AACnB","names":["$","SupersetClient","getClientErrorObject","setupErrorMessages","showApiMessage","resp","template","severity","addClass","append","message","appendTo","toggleCheckbox","apiUrlPrefix","selector","get","endpoint","checked","then","undefined","catch","response","parsedResp","setupApp","document","ready","change","$this","prefix","data","id","attr","click","ev","preventDefault","url","currentTarget","href","parseMethod","window","location","reload","jQuery","require"],"sourceRoot":"","sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/src/setup/setupApp.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint global-require: 0 */\nimport $ from 'jquery';\nimport { SupersetClient } from '@superset-ui/core';\nimport {\n  getClientErrorObject,\n  ClientErrorObject,\n} from 'src/utils/getClientErrorObject';\nimport setupErrorMessages from 'src/setup/setupErrorMessages';\n\n// eslint-disable-next-line @typescript-eslint/no-unused-vars\ndeclare global {\n  interface Window {\n    $: any;\n    jQuery: any;\n  }\n}\n\nfunction showApiMessage(resp: ClientErrorObject) {\n  const template =\n    '<div class=\"alert\"> ' +\n    '<button type=\"button\" class=\"close\" ' +\n    'data-dismiss=\"alert\">\\xD7</button> </div>';\n  const severity = resp.severity || 'info';\n  $(template)\n    .addClass(`alert-${severity}`)\n    .append(resp.message || '')\n    .appendTo($('#alert-container'));\n}\n\nfunction toggleCheckbox(apiUrlPrefix: string, selector: string) {\n  SupersetClient.get({\n    endpoint: apiUrlPrefix + ($(selector)[0] as HTMLInputElement).checked,\n  })\n    .then(() => undefined)\n    .catch(response =>\n      getClientErrorObject(response).then(parsedResp => {\n        if (parsedResp?.message) {\n          showApiMessage(parsedResp);\n        }\n      }),\n    );\n}\n\nexport default function setupApp() {\n  $(document).ready(function () {\n    $(':checkbox[data-checkbox-api-prefix]').change(function (\n      this: HTMLElement,\n    ) {\n      const $this = $(this);\n      const prefix = $this.data('checkbox-api-prefix');\n      const id = $this.attr('id');\n      toggleCheckbox(prefix, `#${id}`);\n    });\n\n    // for language picker dropdown\n    $('#language-picker a').click(function (\n      ev: JQuery.ClickEvent<\n        HTMLLinkElement,\n        null,\n        HTMLLinkElement,\n        HTMLLinkElement\n      >,\n    ) {\n      ev.preventDefault();\n      SupersetClient.get({\n        url: ev.currentTarget.href,\n        parseMethod: null,\n      }).then(() => {\n        window.location.reload();\n      });\n    });\n  });\n\n  // A set of hacks to allow apps to run within a FAB template\n  // this allows for the server side generated menus to function\n  window.$ = $;\n  window.jQuery = $;\n  require('bootstrap');\n\n  // setup appwide custom error messages\n  setupErrorMessages();\n}\n"]},"metadata":{},"sourceType":"module"}