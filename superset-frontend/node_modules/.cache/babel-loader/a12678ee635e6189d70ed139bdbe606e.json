{"ast":null,"code":"import _omit from \"lodash/omit\";function _EMOTION_STRINGIFIED_CSS_ERROR__() {return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";}import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\"; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\n\nimport { Input } from 'src/components/Input';\nimport { FormItem } from 'src/components/Form';\nimport jsonStringify from 'json-stringify-pretty-compact';\nimport Button from 'src/components/Button';\nimport { AntdForm, AsyncSelect, Col, Row } from 'src/components';\nimport rison from 'rison';\nimport { CategoricalColorNamespace, ensureIsArray, isFeatureEnabled, FeatureFlag, getCategoricalSchemeRegistry, getSharedLabelColor, styled, SupersetClient, t } from '@superset-ui/core';\nimport Modal from 'src/components/Modal';\nimport { JsonEditor } from 'src/components/AsyncAceEditor';\nimport ColorSchemeControlWrapper from 'src/dashboard/components/ColorSchemeControlWrapper';\nimport FilterScopeModal from 'src/dashboard/components/filterscope/FilterScopeModal';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { addTag, deleteTaggedObjects, fetchTags, OBJECT_TYPES } from 'src/features/tags/tags';\nimport { loadTags } from 'src/components/Tags/utils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst StyledFormItem = styled(FormItem)`\n  margin-bottom: 0;\n`;\nconst StyledJsonEditor = styled(JsonEditor)`\n  border-radius: ${(_ref) => {let { theme } = _ref;return theme.borderRadius;}}px;\n  border: 1px solid ${(_ref2) => {let { theme } = _ref2;return theme.colors.secondary.light2;}};\n`;var _ref4 = process.env.NODE_ENV === \"production\" ? { name: \"1blj7km\", styles: \"margin-top:1em\" } : { name: \"1gtq0eh-PropertiesModal\", styles: \"margin-top:1em;label:PropertiesModal;\", map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy96aGFvcnVpL3NyYy9pbmN1YmF0b3Itc3VwZXJzZXQtaW50ZXJuYWwvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL1Byb3BlcnRpZXNNb2RhbC9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBb2VrQiIsImZpbGUiOiIvVXNlcnMvemhhb3J1aS9zcmMvaW5jdWJhdG9yLXN1cGVyc2V0LWludGVybmFsL3N1cGVyc2V0LWZyb250ZW5kL3NyYy9kYXNoYm9hcmQvY29tcG9uZW50cy9Qcm9wZXJ0aWVzTW9kYWwvaW5kZXgudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgb21pdCB9IGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBJbnB1dCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0lucHV0JztcbmltcG9ydCB7IEZvcm1JdGVtIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvRm9ybSc7XG5pbXBvcnQganNvblN0cmluZ2lmeSBmcm9tICdqc29uLXN0cmluZ2lmeS1wcmV0dHktY29tcGFjdCc7XG5pbXBvcnQgQnV0dG9uIGZyb20gJ3NyYy9jb21wb25lbnRzL0J1dHRvbic7XG5pbXBvcnQgeyBBbnRkRm9ybSwgQXN5bmNTZWxlY3QsIENvbCwgUm93IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMnO1xuaW1wb3J0IHJpc29uIGZyb20gJ3Jpc29uJztcbmltcG9ydCB7IENhdGVnb3JpY2FsQ29sb3JOYW1lc3BhY2UsIGVuc3VyZUlzQXJyYXksIGlzRmVhdHVyZUVuYWJsZWQsIEZlYXR1cmVGbGFnLCBnZXRDYXRlZ29yaWNhbFNjaGVtZVJlZ2lzdHJ5LCBnZXRTaGFyZWRMYWJlbENvbG9yLCBzdHlsZWQsIFN1cGVyc2V0Q2xpZW50LCB0LCB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCBNb2RhbCBmcm9tICdzcmMvY29tcG9uZW50cy9Nb2RhbCc7XG5pbXBvcnQgeyBKc29uRWRpdG9yIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvQXN5bmNBY2VFZGl0b3InO1xuaW1wb3J0IENvbG9yU2NoZW1lQ29udHJvbFdyYXBwZXIgZnJvbSAnc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL0NvbG9yU2NoZW1lQ29udHJvbFdyYXBwZXInO1xuaW1wb3J0IEZpbHRlclNjb3BlTW9kYWwgZnJvbSAnc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL2ZpbHRlcnNjb3BlL0ZpbHRlclNjb3BlTW9kYWwnO1xuaW1wb3J0IHsgZ2V0Q2xpZW50RXJyb3JPYmplY3QgfSBmcm9tICdzcmMvdXRpbHMvZ2V0Q2xpZW50RXJyb3JPYmplY3QnO1xuaW1wb3J0IHdpdGhUb2FzdHMgZnJvbSAnc3JjL2NvbXBvbmVudHMvTWVzc2FnZVRvYXN0cy93aXRoVG9hc3RzJztcbmltcG9ydCB7IGFkZFRhZywgZGVsZXRlVGFnZ2VkT2JqZWN0cywgZmV0Y2hUYWdzLCBPQkpFQ1RfVFlQRVMsIH0gZnJvbSAnc3JjL2ZlYXR1cmVzL3RhZ3MvdGFncyc7XG5pbXBvcnQgeyBsb2FkVGFncyB9IGZyb20gJ3NyYy9jb21wb25lbnRzL1RhZ3MvdXRpbHMnO1xuY29uc3QgU3R5bGVkRm9ybUl0ZW0gPSBzdHlsZWQoRm9ybUl0ZW0pIGBcbiAgbWFyZ2luLWJvdHRvbTogMDtcbmA7XG5jb25zdCBTdHlsZWRKc29uRWRpdG9yID0gc3R5bGVkKEpzb25FZGl0b3IpIGBcbiAgYm9yZGVyLXJhZGl1czogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ib3JkZXJSYWRpdXN9cHg7XG4gIGJvcmRlcjogMXB4IHNvbGlkICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuY29sb3JzLnNlY29uZGFyeS5saWdodDJ9O1xuYDtcbmNvbnN0IFByb3BlcnRpZXNNb2RhbCA9ICh7IGFkZFN1Y2Nlc3NUb2FzdCwgYWRkRGFuZ2VyVG9hc3QsIGNvbG9yU2NoZW1lOiBjdXJyZW50Q29sb3JTY2hlbWUsIGRhc2hib2FyZElkLCBkYXNoYm9hcmRJbmZvOiBjdXJyZW50RGFzaGJvYXJkSW5mbywgZGFzaGJvYXJkVGl0bGUsIG9uSGlkZSA9ICgpID0+IHsgfSwgb25seUFwcGx5ID0gZmFsc2UsIG9uU3VibWl0ID0gKCkgPT4geyB9LCBzaG93ID0gZmFsc2UsIH0pID0+IHtcbiAgICBjb25zdCBbZm9ybV0gPSBBbnRkRm9ybS51c2VGb3JtKCk7XG4gICAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbaXNBZHZhbmNlZE9wZW4sIHNldElzQWR2YW5jZWRPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbY29sb3JTY2hlbWUsIHNldENvbG9yU2NoZW1lXSA9IHVzZVN0YXRlKGN1cnJlbnRDb2xvclNjaGVtZSk7XG4gICAgY29uc3QgW2pzb25NZXRhZGF0YSwgc2V0SnNvbk1ldGFkYXRhXSA9IHVzZVN0YXRlKCcnKTtcbiAgICBjb25zdCBbZGFzaGJvYXJkSW5mbywgc2V0RGFzaGJvYXJkSW5mb10gPSB1c2VTdGF0ZSgpO1xuICAgIGNvbnN0IFtvd25lcnMsIHNldE93bmVyc10gPSB1c2VTdGF0ZShbXSk7XG4gICAgY29uc3QgW3JvbGVzLCBzZXRSb2xlc10gPSB1c2VTdGF0ZShbXSk7XG4gICAgY29uc3Qgc2F2ZUxhYmVsID0gb25seUFwcGx5ID8gdCgnQXBwbHknKSA6IHQoJ1NhdmUnKTtcbiAgICBjb25zdCBbdGFncywgc2V0VGFnc10gPSB1c2VTdGF0ZShbXSk7XG4gICAgY29uc3QgY2F0ZWdvcmljYWxTY2hlbWVSZWdpc3RyeSA9IGdldENhdGVnb3JpY2FsU2NoZW1lUmVnaXN0cnkoKTtcbiAgICBjb25zdCB0YWdzQXNTZWxlY3RWYWx1ZXMgPSB1c2VNZW1vKCgpID0+IHtcbiAgICAgICAgY29uc3Qgc2VsZWN0VGFncyA9IHRhZ3MubWFwKHRhZyA9PiAoe1xuICAgICAgICAgICAgdmFsdWU6IHRhZy5uYW1lLFxuICAgICAgICAgICAgbGFiZWw6IHRhZy5uYW1lLFxuICAgICAgICAgICAga2V5OiB0YWcubmFtZSxcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gc2VsZWN0VGFncztcbiAgICB9LCBbdGFncy5sZW5ndGhdKTtcbiAgICBjb25zdCBoYW5kbGVFcnJvclJlc3BvbnNlID0gYXN5bmMgKHJlc3BvbnNlKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgZXJyb3IsIHN0YXR1c1RleHQsIG1lc3NhZ2UgfSA9IGF3YWl0IGdldENsaWVudEVycm9yT2JqZWN0KHJlc3BvbnNlKTtcbiAgICAgICAgbGV0IGVycm9yVGV4dCA9IGVycm9yIHx8IHN0YXR1c1RleHQgfHwgdCgnQW4gZXJyb3IgaGFzIG9jY3VycmVkJyk7XG4gICAgICAgIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ29iamVjdCcgJiYgJ2pzb25fbWV0YWRhdGEnIGluIG1lc3NhZ2UpIHtcbiAgICAgICAgICAgIGVycm9yVGV4dCA9IG1lc3NhZ2UuanNvbl9tZXRhZGF0YTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmICh0eXBlb2YgbWVzc2FnZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgICAgIGVycm9yVGV4dCA9IG1lc3NhZ2U7XG4gICAgICAgICAgICBpZiAobWVzc2FnZSA9PT0gJ0ZvcmJpZGRlbicpIHtcbiAgICAgICAgICAgICAgICBlcnJvclRleHQgPSB0KCdZb3UgZG8gbm90IGhhdmUgcGVybWlzc2lvbiB0byBlZGl0IHRoaXMgZGFzaGJvYXJkJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgTW9kYWwuZXJyb3Ioe1xuICAgICAgICAgICAgdGl0bGU6IHQoJ0Vycm9yJyksXG4gICAgICAgICAgICBjb250ZW50OiBlcnJvclRleHQsXG4gICAgICAgICAgICBva0J1dHRvblByb3BzOiB7IGRhbmdlcjogdHJ1ZSwgY2xhc3NOYW1lOiAnYnRuLWRhbmdlcicgfSxcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjb25zdCBsb2FkQWNjZXNzT3B0aW9ucyA9IHVzZUNhbGxiYWNrKChhY2Nlc3NUeXBlID0gJ293bmVycycsIGlucHV0ID0gJycsIHBhZ2UsIHBhZ2VTaXplKSA9PiB7XG4gICAgICAgIGNvbnN0IHF1ZXJ5ID0gcmlzb24uZW5jb2RlKHtcbiAgICAgICAgICAgIGZpbHRlcjogaW5wdXQsXG4gICAgICAgICAgICBwYWdlLFxuICAgICAgICAgICAgcGFnZV9zaXplOiBwYWdlU2l6ZSxcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBTdXBlcnNldENsaWVudC5nZXQoe1xuICAgICAgICAgICAgZW5kcG9pbnQ6IGAvYXBpL3YxL2Rhc2hib2FyZC9yZWxhdGVkLyR7YWNjZXNzVHlwZX0/cT0ke3F1ZXJ5fWAsXG4gICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4gKHtcbiAgICAgICAgICAgIGRhdGE6IHJlc3BvbnNlLmpzb24ucmVzdWx0XG4gICAgICAgICAgICAgICAgLmZpbHRlcigoaXRlbSkgPT4gaXRlbS5leHRyYS5hY3RpdmUgIT09IHVuZGVmaW5lZCA/IGl0ZW0uZXh0cmEuYWN0aXZlIDogdHJ1ZSlcbiAgICAgICAgICAgICAgICAubWFwKChpdGVtKSA9PiAoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiBpdGVtLnZhbHVlLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBpdGVtLnRleHQsXG4gICAgICAgICAgICB9KSksXG4gICAgICAgICAgICB0b3RhbENvdW50OiByZXNwb25zZS5qc29uLmNvdW50LFxuICAgICAgICB9KSk7XG4gICAgfSwgW10pO1xuICAgIGNvbnN0IGhhbmRsZURhc2hib2FyZERhdGEgPSB1c2VDYWxsYmFjayhkYXNoYm9hcmREYXRhID0+IHtcbiAgICAgICAgY29uc3QgeyBpZCwgZGFzaGJvYXJkX3RpdGxlLCBzbHVnLCBjZXJ0aWZpZWRfYnksIGNlcnRpZmljYXRpb25fZGV0YWlscywgb3duZXJzLCByb2xlcywgbWV0YWRhdGEsIGlzX21hbmFnZWRfZXh0ZXJuYWxseSwgfSA9IGRhc2hib2FyZERhdGE7XG4gICAgICAgIGNvbnN0IGRhc2hib2FyZEluZm8gPSB7XG4gICAgICAgICAgICBpZCxcbiAgICAgICAgICAgIHRpdGxlOiBkYXNoYm9hcmRfdGl0bGUsXG4gICAgICAgICAgICBzbHVnOiBzbHVnIHx8ICcnLFxuICAgICAgICAgICAgY2VydGlmaWVkQnk6IGNlcnRpZmllZF9ieSB8fCAnJyxcbiAgICAgICAgICAgIGNlcnRpZmljYXRpb25EZXRhaWxzOiBjZXJ0aWZpY2F0aW9uX2RldGFpbHMgfHwgJycsXG4gICAgICAgICAgICBpc01hbmFnZWRFeHRlcm5hbGx5OiBpc19tYW5hZ2VkX2V4dGVybmFsbHkgfHwgZmFsc2UsXG4gICAgICAgIH07XG4gICAgICAgIGZvcm0uc2V0RmllbGRzVmFsdWUoZGFzaGJvYXJkSW5mbyk7XG4gICAgICAgIHNldERhc2hib2FyZEluZm8oZGFzaGJvYXJkSW5mbyk7XG4gICAgICAgIHNldE93bmVycyhvd25lcnMpO1xuICAgICAgICBzZXRSb2xlcyhyb2xlcyk7XG4gICAgICAgIHNldENvbG9yU2NoZW1lKG1ldGFkYXRhLmNvbG9yX3NjaGVtZSk7XG4gICAgICAgIGNvbnN0IG1ldGFEYXRhQ29weSA9IG9taXQobWV0YWRhdGEsIFtcbiAgICAgICAgICAgICdwb3NpdGlvbnMnLFxuICAgICAgICAgICAgJ3NoYXJlZF9sYWJlbF9jb2xvcnMnLFxuICAgICAgICAgICAgJ2NvbG9yX3NjaGVtZV9kb21haW4nLFxuICAgICAgICBdKTtcbiAgICAgICAgc2V0SnNvbk1ldGFkYXRhKG1ldGFEYXRhQ29weSA/IGpzb25TdHJpbmdpZnkobWV0YURhdGFDb3B5KSA6ICcnKTtcbiAgICB9LCBbZm9ybV0pO1xuICAgIGNvbnN0IGZldGNoRGFzaGJvYXJkRGV0YWlscyA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgICAgc2V0SXNMb2FkaW5nKHRydWUpO1xuICAgICAgICAvLyBXZSBmZXRjaCB0aGUgZGFzaGJvYXJkIGRldGFpbHMgYmVjYXVzZSBub3QgYWxsIGNvZGVcbiAgICAgICAgLy8gdGhhdCByZW5kZXJzIHRoaXMgY29tcG9uZW50IGhhdmUgYWxsIHRoZSB2YWx1ZXMgd2UgbmVlZC5cbiAgICAgICAgLy8gQXQgc29tZSBwb2ludCB3aGVuIHdlIGhhdmUgYSBtb3JlIGNvbnNpc3RlbnQgZnJvbnRlbmRcbiAgICAgICAgLy8gZGF0YW1vZGVsLCB0aGUgZGFzaGJvYXJkIGNvdWxkIHByb2JhYmx5IGp1c3QgYmUgcGFzc2VkIGFzIGEgcHJvcC5cbiAgICAgICAgU3VwZXJzZXRDbGllbnQuZ2V0KHtcbiAgICAgICAgICAgIGVuZHBvaW50OiBgL2FwaS92MS9kYXNoYm9hcmQvJHtkYXNoYm9hcmRJZH1gLFxuICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRhc2hib2FyZCA9IHJlc3BvbnNlLmpzb24ucmVzdWx0O1xuICAgICAgICAgICAgY29uc3QganNvbk1ldGFkYXRhT2JqID0gZGFzaGJvYXJkLmpzb25fbWV0YWRhdGE/Lmxlbmd0aFxuICAgICAgICAgICAgICAgID8gSlNPTi5wYXJzZShkYXNoYm9hcmQuanNvbl9tZXRhZGF0YSlcbiAgICAgICAgICAgICAgICA6IHt9O1xuICAgICAgICAgICAgaGFuZGxlRGFzaGJvYXJkRGF0YSh7XG4gICAgICAgICAgICAgICAgLi4uZGFzaGJvYXJkLFxuICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBqc29uTWV0YWRhdGFPYmosXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgICAgIH0sIGhhbmRsZUVycm9yUmVzcG9uc2UpO1xuICAgIH0sIFtkYXNoYm9hcmRJZCwgaGFuZGxlRGFzaGJvYXJkRGF0YV0pO1xuICAgIGNvbnN0IGdldEpzb25NZXRhZGF0YSA9ICgpID0+IHtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvbnN0IGpzb25NZXRhZGF0YU9iaiA9IGpzb25NZXRhZGF0YT8ubGVuZ3RoXG4gICAgICAgICAgICAgICAgPyBKU09OLnBhcnNlKGpzb25NZXRhZGF0YSlcbiAgICAgICAgICAgICAgICA6IHt9O1xuICAgICAgICAgICAgcmV0dXJuIGpzb25NZXRhZGF0YU9iajtcbiAgICAgICAgfVxuICAgICAgICBjYXRjaCAoXykge1xuICAgICAgICAgICAgcmV0dXJuIHt9O1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBoYW5kbGVPbkNoYW5nZU93bmVycyA9IChvd25lcnMpID0+IHtcbiAgICAgICAgY29uc3QgcGFyc2VkT3duZXJzID0gZW5zdXJlSXNBcnJheShvd25lcnMpLm1hcChvID0+ICh7XG4gICAgICAgICAgICBpZDogby52YWx1ZSxcbiAgICAgICAgICAgIGZ1bGxfbmFtZTogby5sYWJlbCxcbiAgICAgICAgfSkpO1xuICAgICAgICBzZXRPd25lcnMocGFyc2VkT3duZXJzKTtcbiAgICB9O1xuICAgIGNvbnN0IGhhbmRsZU9uQ2hhbmdlUm9sZXMgPSAocm9sZXMpID0+IHtcbiAgICAgICAgY29uc3QgcGFyc2VkUm9sZXMgPSBlbnN1cmVJc0FycmF5KHJvbGVzKS5tYXAociA9PiAoe1xuICAgICAgICAgICAgaWQ6IHIudmFsdWUsXG4gICAgICAgICAgICBuYW1lOiByLmxhYmVsLFxuICAgICAgICB9KSk7XG4gICAgICAgIHNldFJvbGVzKHBhcnNlZFJvbGVzKTtcbiAgICB9O1xuICAgIGNvbnN0IGhhbmRsZU93bmVyc1NlbGVjdFZhbHVlID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBwYXJzZWRPd25lcnMgPSAob3duZXJzIHx8IFtdKS5tYXAoKG93bmVyKSA9PiAoe1xuICAgICAgICAgICAgdmFsdWU6IG93bmVyLmlkLFxuICAgICAgICAgICAgbGFiZWw6IG93bmVyLmZ1bGxfbmFtZSB8fCBgJHtvd25lci5maXJzdF9uYW1lfSAke293bmVyLmxhc3RfbmFtZX1gLFxuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiBwYXJzZWRPd25lcnM7XG4gICAgfTtcbiAgICBjb25zdCBoYW5kbGVSb2xlc1NlbGVjdFZhbHVlID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBwYXJzZWRSb2xlcyA9IChyb2xlcyB8fCBbXSkubWFwKChyb2xlKSA9PiAoe1xuICAgICAgICAgICAgdmFsdWU6IHJvbGUuaWQsXG4gICAgICAgICAgICBsYWJlbDogYCR7cm9sZS5uYW1lfWAsXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIHBhcnNlZFJvbGVzO1xuICAgIH07XG4gICAgY29uc3Qgb25Db2xvclNjaGVtZUNoYW5nZSA9IChjb2xvclNjaGVtZSA9ICcnLCB7IHVwZGF0ZU1ldGFkYXRhID0gdHJ1ZSB9ID0ge30pID0+IHtcbiAgICAgICAgLy8gY2hlY2sgdGhhdCBjb2xvcl9zY2hlbWUgaXMgdmFsaWRcbiAgICAgICAgY29uc3QgY29sb3JDaG9pY2VzID0gY2F0ZWdvcmljYWxTY2hlbWVSZWdpc3RyeS5rZXlzKCk7XG4gICAgICAgIGNvbnN0IGpzb25NZXRhZGF0YU9iaiA9IGdldEpzb25NZXRhZGF0YSgpO1xuICAgICAgICAvLyBvbmx5IGZpcmUgaWYgdGhlIGNvbG9yX3NjaGVtZSBpcyBwcmVzZW50IGFuZCBpbnZhbGlkXG4gICAgICAgIGlmIChjb2xvclNjaGVtZSAmJiAhY29sb3JDaG9pY2VzLmluY2x1ZGVzKGNvbG9yU2NoZW1lKSkge1xuICAgICAgICAgICAgTW9kYWwuZXJyb3Ioe1xuICAgICAgICAgICAgICAgIHRpdGxlOiB0KCdFcnJvcicpLFxuICAgICAgICAgICAgICAgIGNvbnRlbnQ6IHQoJ0EgdmFsaWQgY29sb3Igc2NoZW1lIGlzIHJlcXVpcmVkJyksXG4gICAgICAgICAgICAgICAgb2tCdXR0b25Qcm9wczogeyBkYW5nZXI6IHRydWUsIGNsYXNzTmFtZTogJ2J0bi1kYW5nZXInIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignQSB2YWxpZCBjb2xvciBzY2hlbWUgaXMgcmVxdWlyZWQnKTtcbiAgICAgICAgfVxuICAgICAgICAvLyB1cGRhdGUgbWV0YWRhdGEgdG8gbWF0Y2ggc2VsZWN0aW9uXG4gICAgICAgIGlmICh1cGRhdGVNZXRhZGF0YSkge1xuICAgICAgICAgICAganNvbk1ldGFkYXRhT2JqLmNvbG9yX3NjaGVtZSA9IGNvbG9yU2NoZW1lO1xuICAgICAgICAgICAganNvbk1ldGFkYXRhT2JqLmxhYmVsX2NvbG9ycyA9IGpzb25NZXRhZGF0YU9iai5sYWJlbF9jb2xvcnMgfHwge307XG4gICAgICAgICAgICBzZXRKc29uTWV0YWRhdGEoanNvblN0cmluZ2lmeShqc29uTWV0YWRhdGFPYmopKTtcbiAgICAgICAgfVxuICAgICAgICBzZXRDb2xvclNjaGVtZShjb2xvclNjaGVtZSk7XG4gICAgfTtcbiAgICBjb25zdCB1cGRhdGVUYWdzID0gKG9sZFRhZ3MsIG5ld1RhZ3MpID0+IHtcbiAgICAgICAgLy8gdXBkYXRlIHRoZSB0YWdzIGZvciB0aGlzIG9iamVjdFxuICAgICAgICAvLyBhZGQgdGFncyB0aGF0IGFyZSBpbiBuZXcgdGFncywgYnV0IG5vdCBpbiBvbGQgdGFnc1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgYXJyYXktY2FsbGJhY2stcmV0dXJuXG4gICAgICAgIG5ld1RhZ3MubWFwKCh0YWcpID0+IHtcbiAgICAgICAgICAgIGlmICghb2xkVGFncy5zb21lKHQgPT4gdC5uYW1lID09PSB0YWcubmFtZSkpIHtcbiAgICAgICAgICAgICAgICBhZGRUYWcoe1xuICAgICAgICAgICAgICAgICAgICBvYmplY3RUeXBlOiBPQkpFQ1RfVFlQRVMuREFTSEJPQVJELFxuICAgICAgICAgICAgICAgICAgICBvYmplY3RJZDogZGFzaGJvYXJkSWQsXG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVUeXBlczogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSwgdGFnLm5hbWUsICgpID0+IHsgfSwgKCkgPT4geyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIC8vIGRlbGV0ZSB0YWdzIHRoYXQgYXJlIGluIG9sZCB0YWdzLCBidXQgbm90IGluIG5ldyB0YWdzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBhcnJheS1jYWxsYmFjay1yZXR1cm5cbiAgICAgICAgb2xkVGFncy5tYXAoKHRhZykgPT4ge1xuICAgICAgICAgICAgaWYgKCFuZXdUYWdzLnNvbWUodCA9PiB0Lm5hbWUgPT09IHRhZy5uYW1lKSkge1xuICAgICAgICAgICAgICAgIGRlbGV0ZVRhZ2dlZE9iamVjdHMoe1xuICAgICAgICAgICAgICAgICAgICBvYmplY3RUeXBlOiBPQkpFQ1RfVFlQRVMuREFTSEJPQVJELFxuICAgICAgICAgICAgICAgICAgICBvYmplY3RJZDogZGFzaGJvYXJkSWQsXG4gICAgICAgICAgICAgICAgfSwgdGFnLCAoKSA9PiB7IH0sICgpID0+IHsgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgY29uc3Qgb25GaW5pc2ggPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgdGl0bGUsIHNsdWcsIGNlcnRpZmllZEJ5LCBjZXJ0aWZpY2F0aW9uRGV0YWlscyB9ID0gZm9ybS5nZXRGaWVsZHNWYWx1ZSgpO1xuICAgICAgICBsZXQgY3VycmVudENvbG9yU2NoZW1lID0gY29sb3JTY2hlbWU7XG4gICAgICAgIGxldCBjb2xvck5hbWVzcGFjZSA9ICcnO1xuICAgICAgICBsZXQgY3VycmVudEpzb25NZXRhZGF0YSA9IGpzb25NZXRhZGF0YTtcbiAgICAgICAgLy8gdmFsaWRhdGUgY3VycmVudEpzb25NZXRhZGF0YVxuICAgICAgICBsZXQgbWV0YWRhdGE7XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBpZiAoIWN1cnJlbnRKc29uTWV0YWRhdGEuc3RhcnRzV2l0aCgneycpIHx8XG4gICAgICAgICAgICAgICAgIWN1cnJlbnRKc29uTWV0YWRhdGEuZW5kc1dpdGgoJ30nKSkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgbWV0YWRhdGEgPSBKU09OLnBhcnNlKGN1cnJlbnRKc29uTWV0YWRhdGEpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgYWRkRGFuZ2VyVG9hc3QodCgnSlNPTiBtZXRhZGF0YSBpcyBpbnZhbGlkIScpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICAvLyBjb2xvciBzY2hlbWUgaW4ganNvbiBtZXRhZGF0YSBoYXMgcHJlY2VkZW5jZSBvdmVyIHNlbGVjdGlvblxuICAgICAgICBjdXJyZW50Q29sb3JTY2hlbWUgPSBtZXRhZGF0YT8uY29sb3Jfc2NoZW1lIHx8IGNvbG9yU2NoZW1lO1xuICAgICAgICBjb2xvck5hbWVzcGFjZSA9IG1ldGFkYXRhPy5jb2xvcl9uYW1lc3BhY2U7XG4gICAgICAgIC8vIGZpbHRlciBzaGFyZWRfbGFiZWxfY29sb3IgZnJvbSB1c2VyIGlucHV0XG4gICAgICAgIGlmIChtZXRhZGF0YT8uc2hhcmVkX2xhYmVsX2NvbG9ycykge1xuICAgICAgICAgICAgZGVsZXRlIG1ldGFkYXRhLnNoYXJlZF9sYWJlbF9jb2xvcnM7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG1ldGFkYXRhPy5jb2xvcl9zY2hlbWVfZG9tYWluKSB7XG4gICAgICAgICAgICBkZWxldGUgbWV0YWRhdGEuY29sb3Jfc2NoZW1lX2RvbWFpbjtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBzaGFyZWRMYWJlbENvbG9yID0gZ2V0U2hhcmVkTGFiZWxDb2xvcigpO1xuICAgICAgICBjb25zdCBjYXRlZ29yaWNhbE5hbWVzcGFjZSA9IENhdGVnb3JpY2FsQ29sb3JOYW1lc3BhY2UuZ2V0TmFtZXNwYWNlKGNvbG9yTmFtZXNwYWNlKTtcbiAgICAgICAgY2F0ZWdvcmljYWxOYW1lc3BhY2UucmVzZXRDb2xvcnMoKTtcbiAgICAgICAgaWYgKGN1cnJlbnRDb2xvclNjaGVtZSkge1xuICAgICAgICAgICAgc2hhcmVkTGFiZWxDb2xvci51cGRhdGVDb2xvck1hcChjb2xvck5hbWVzcGFjZSwgY3VycmVudENvbG9yU2NoZW1lKTtcbiAgICAgICAgICAgIG1ldGFkYXRhLnNoYXJlZF9sYWJlbF9jb2xvcnMgPSBPYmplY3QuZnJvbUVudHJpZXMoc2hhcmVkTGFiZWxDb2xvci5nZXRDb2xvck1hcCgpKTtcbiAgICAgICAgICAgIG1ldGFkYXRhLmNvbG9yX3NjaGVtZV9kb21haW4gPVxuICAgICAgICAgICAgICAgIGNhdGVnb3JpY2FsU2NoZW1lUmVnaXN0cnkuZ2V0KGNvbG9yU2NoZW1lKT8uY29sb3JzIHx8IFtdO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc2hhcmVkTGFiZWxDb2xvci5yZXNldCgpO1xuICAgICAgICAgICAgbWV0YWRhdGEuc2hhcmVkX2xhYmVsX2NvbG9ycyA9IHt9O1xuICAgICAgICAgICAgbWV0YWRhdGEuY29sb3Jfc2NoZW1lX2RvbWFpbiA9IFtdO1xuICAgICAgICB9XG4gICAgICAgIGN1cnJlbnRKc29uTWV0YWRhdGEgPSBqc29uU3RyaW5naWZ5KG1ldGFkYXRhKTtcbiAgICAgICAgb25Db2xvclNjaGVtZUNoYW5nZShjdXJyZW50Q29sb3JTY2hlbWUsIHtcbiAgICAgICAgICAgIHVwZGF0ZU1ldGFkYXRhOiBmYWxzZSxcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLlRBR0dJTkdfU1lTVEVNKSkge1xuICAgICAgICAgICAgLy8gdXBkYXRlIHRhZ3NcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZmV0Y2hUYWdzKHtcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0VHlwZTogT0JKRUNUX1RZUEVTLkRBU0hCT0FSRCxcbiAgICAgICAgICAgICAgICAgICAgb2JqZWN0SWQ6IGRhc2hib2FyZElkLFxuICAgICAgICAgICAgICAgICAgICBpbmNsdWRlVHlwZXM6IGZhbHNlLFxuICAgICAgICAgICAgICAgIH0sIChjdXJyZW50VGFncykgPT4gdXBkYXRlVGFncyhjdXJyZW50VGFncywgdGFncyksIGVycm9yID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlRXJyb3JSZXNwb25zZShlcnJvcik7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZXJyb3IpIHtcbiAgICAgICAgICAgICAgICBoYW5kbGVFcnJvclJlc3BvbnNlKGVycm9yKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtb3JlT25TdWJtaXRQcm9wcyA9IHt9O1xuICAgICAgICBjb25zdCBtb3JlUHV0UHJvcHMgPSB7fTtcbiAgICAgICAgaWYgKGlzRmVhdHVyZUVuYWJsZWQoRmVhdHVyZUZsYWcuREFTSEJPQVJEX1JCQUMpKSB7XG4gICAgICAgICAgICBtb3JlT25TdWJtaXRQcm9wcy5yb2xlcyA9IHJvbGVzO1xuICAgICAgICAgICAgbW9yZVB1dFByb3BzLnJvbGVzID0gKHJvbGVzIHx8IFtdKS5tYXAociA9PiByLmlkKTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBvblN1Ym1pdFByb3BzID0ge1xuICAgICAgICAgICAgaWQ6IGRhc2hib2FyZElkLFxuICAgICAgICAgICAgdGl0bGUsXG4gICAgICAgICAgICBzbHVnLFxuICAgICAgICAgICAganNvbk1ldGFkYXRhOiBjdXJyZW50SnNvbk1ldGFkYXRhLFxuICAgICAgICAgICAgb3duZXJzLFxuICAgICAgICAgICAgY29sb3JTY2hlbWU6IGN1cnJlbnRDb2xvclNjaGVtZSxcbiAgICAgICAgICAgIGNvbG9yTmFtZXNwYWNlLFxuICAgICAgICAgICAgY2VydGlmaWVkQnksXG4gICAgICAgICAgICBjZXJ0aWZpY2F0aW9uRGV0YWlscyxcbiAgICAgICAgICAgIC4uLm1vcmVPblN1Ym1pdFByb3BzLFxuICAgICAgICB9O1xuICAgICAgICBpZiAob25seUFwcGx5KSB7XG4gICAgICAgICAgICBvblN1Ym1pdChvblN1Ym1pdFByb3BzKTtcbiAgICAgICAgICAgIG9uSGlkZSgpO1xuICAgICAgICAgICAgYWRkU3VjY2Vzc1RvYXN0KHQoJ0Rhc2hib2FyZCBwcm9wZXJ0aWVzIHVwZGF0ZWQnKSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBTdXBlcnNldENsaWVudC5wdXQoe1xuICAgICAgICAgICAgICAgIGVuZHBvaW50OiBgL2FwaS92MS9kYXNoYm9hcmQvJHtkYXNoYm9hcmRJZH1gLFxuICAgICAgICAgICAgICAgIGhlYWRlcnM6IHsgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJyB9LFxuICAgICAgICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgICAgICAgICAgICAgZGFzaGJvYXJkX3RpdGxlOiB0aXRsZSxcbiAgICAgICAgICAgICAgICAgICAgc2x1Zzogc2x1ZyB8fCBudWxsLFxuICAgICAgICAgICAgICAgICAgICBqc29uX21ldGFkYXRhOiBjdXJyZW50SnNvbk1ldGFkYXRhIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIG93bmVyczogKG93bmVycyB8fCBbXSkubWFwKG8gPT4gby5pZCksXG4gICAgICAgICAgICAgICAgICAgIGNlcnRpZmllZF9ieTogY2VydGlmaWVkQnkgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgY2VydGlmaWNhdGlvbl9kZXRhaWxzOiBjZXJ0aWZpZWRCeSAmJiBjZXJ0aWZpY2F0aW9uRGV0YWlscyA/IGNlcnRpZmljYXRpb25EZXRhaWxzIDogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgLi4ubW9yZVB1dFByb3BzLFxuICAgICAgICAgICAgICAgIH0pLFxuICAgICAgICAgICAgfSkudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgb25TdWJtaXQob25TdWJtaXRQcm9wcyk7XG4gICAgICAgICAgICAgICAgb25IaWRlKCk7XG4gICAgICAgICAgICAgICAgYWRkU3VjY2Vzc1RvYXN0KHQoJ1RoZSBkYXNoYm9hcmQgaGFzIGJlZW4gc2F2ZWQnKSk7XG4gICAgICAgICAgICB9LCBoYW5kbGVFcnJvclJlc3BvbnNlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgZ2V0Um93c1dpdGhvdXRSb2xlcyA9ICgpID0+IHtcbiAgICAgICAgY29uc3QganNvbk1ldGFkYXRhT2JqID0gZ2V0SnNvbk1ldGFkYXRhKCk7XG4gICAgICAgIGNvbnN0IGhhc0N1c3RvbUxhYmVsQ29sb3JzID0gISFPYmplY3Qua2V5cyhqc29uTWV0YWRhdGFPYmo/LmxhYmVsX2NvbG9ycyB8fCB7fSkubGVuZ3RoO1xuICAgICAgICByZXR1cm4gKDxSb3cgZ3V0dGVyPXsxNn0+XG4gICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MTJ9PlxuICAgICAgICAgIDxoMyBzdHlsZT17eyBtYXJnaW5Ub3A6ICcxZW0nIH19Pnt0KCdBY2Nlc3MnKX08L2gzPlxuICAgICAgICAgIDxTdHlsZWRGb3JtSXRlbSBsYWJlbD17dCgnT3duZXJzJyl9PlxuICAgICAgICAgICAgPEFzeW5jU2VsZWN0IGFsbG93Q2xlYXIgYXJpYUxhYmVsPXt0KCdPd25lcnMnKX0gZGlzYWJsZWQ9e2lzTG9hZGluZ30gbW9kZT1cIm11bHRpcGxlXCIgb25DaGFuZ2U9e2hhbmRsZU9uQ2hhbmdlT3duZXJzfSBvcHRpb25zPXsoaW5wdXQsIHBhZ2UsIHBhZ2VTaXplKSA9PiBsb2FkQWNjZXNzT3B0aW9ucygnb3duZXJzJywgaW5wdXQsIHBhZ2UsIHBhZ2VTaXplKX0gdmFsdWU9e2hhbmRsZU93bmVyc1NlbGVjdFZhbHVlKCl9Lz5cbiAgICAgICAgICA8L1N0eWxlZEZvcm1JdGVtPlxuICAgICAgICAgIDxwIGNsYXNzTmFtZT1cImhlbHAtYmxvY2tcIj5cbiAgICAgICAgICAgIHt0KCdPd25lcnMgaXMgYSBsaXN0IG9mIHVzZXJzIHdobyBjYW4gYWx0ZXIgdGhlIGRhc2hib2FyZC4gU2VhcmNoYWJsZSBieSBuYW1lIG9yIHVzZXJuYW1lLicpfVxuICAgICAgICAgIDwvcD5cbiAgICAgICAgPC9Db2w+XG4gICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MTJ9PlxuICAgICAgICAgIDxoMyBzdHlsZT17eyBtYXJnaW5Ub3A6ICcxZW0nIH19Pnt0KCdDb2xvcnMnKX08L2gzPlxuICAgICAgICAgIDxDb2xvclNjaGVtZUNvbnRyb2xXcmFwcGVyIGhhc0N1c3RvbUxhYmVsQ29sb3JzPXtoYXNDdXN0b21MYWJlbENvbG9yc30gb25DaGFuZ2U9e29uQ29sb3JTY2hlbWVDaGFuZ2V9IGNvbG9yU2NoZW1lPXtjb2xvclNjaGVtZX0gbGFiZWxNYXJnaW49ezR9Lz5cbiAgICAgICAgPC9Db2w+XG4gICAgICA8L1Jvdz4pO1xuICAgIH07XG4gICAgY29uc3QgZ2V0Um93c1dpdGhSb2xlcyA9ICgpID0+IHtcbiAgICAgICAgY29uc3QganNvbk1ldGFkYXRhT2JqID0gZ2V0SnNvbk1ldGFkYXRhKCk7XG4gICAgICAgIGNvbnN0IGhhc0N1c3RvbUxhYmVsQ29sb3JzID0gISFPYmplY3Qua2V5cyhqc29uTWV0YWRhdGFPYmo/LmxhYmVsX2NvbG9ycyB8fCB7fSkubGVuZ3RoO1xuICAgICAgICByZXR1cm4gKDw+XG4gICAgICAgIDxSb3c+XG4gICAgICAgICAgPENvbCB4cz17MjR9IG1kPXsyNH0+XG4gICAgICAgICAgICA8aDMgc3R5bGU9e3sgbWFyZ2luVG9wOiAnMWVtJyB9fT57dCgnQWNjZXNzJyl9PC9oMz5cbiAgICAgICAgICA8L0NvbD5cbiAgICAgICAgPC9Sb3c+XG4gICAgICAgIDxSb3cgZ3V0dGVyPXsxNn0+XG4gICAgICAgICAgPENvbCB4cz17MjR9IG1kPXsxMn0+XG4gICAgICAgICAgICA8U3R5bGVkRm9ybUl0ZW0gbGFiZWw9e3QoJ093bmVycycpfT5cbiAgICAgICAgICAgICAgPEFzeW5jU2VsZWN0IGFsbG93Q2xlYXIgYWxsb3dOZXdPcHRpb25zIGFyaWFMYWJlbD17dCgnT3duZXJzJyl9IGRpc2FibGVkPXtpc0xvYWRpbmd9IG1vZGU9XCJtdWx0aXBsZVwiIG9uQ2hhbmdlPXtoYW5kbGVPbkNoYW5nZU93bmVyc30gb3B0aW9ucz17KGlucHV0LCBwYWdlLCBwYWdlU2l6ZSkgPT4gbG9hZEFjY2Vzc09wdGlvbnMoJ293bmVycycsIGlucHV0LCBwYWdlLCBwYWdlU2l6ZSl9IHZhbHVlPXtoYW5kbGVPd25lcnNTZWxlY3RWYWx1ZSgpfS8+XG4gICAgICAgICAgICA8L1N0eWxlZEZvcm1JdGVtPlxuICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwiaGVscC1ibG9ja1wiPlxuICAgICAgICAgICAgICB7dCgnT3duZXJzIGlzIGEgbGlzdCBvZiB1c2VycyB3aG8gY2FuIGFsdGVyIHRoZSBkYXNoYm9hcmQuIFNlYXJjaGFibGUgYnkgbmFtZSBvciB1c2VybmFtZS4nKX1cbiAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICA8L0NvbD5cbiAgICAgICAgICA8Q29sIHhzPXsyNH0gbWQ9ezEyfT5cbiAgICAgICAgICAgIDxTdHlsZWRGb3JtSXRlbSBsYWJlbD17dCgnUm9sZXMnKX0+XG4gICAgICAgICAgICAgIDxBc3luY1NlbGVjdCBhbGxvd0NsZWFyIGFyaWFMYWJlbD17dCgnUm9sZXMnKX0gZGlzYWJsZWQ9e2lzTG9hZGluZ30gbW9kZT1cIm11bHRpcGxlXCIgb25DaGFuZ2U9e2hhbmRsZU9uQ2hhbmdlUm9sZXN9IG9wdGlvbnM9eyhpbnB1dCwgcGFnZSwgcGFnZVNpemUpID0+IGxvYWRBY2Nlc3NPcHRpb25zKCdyb2xlcycsIGlucHV0LCBwYWdlLCBwYWdlU2l6ZSl9IHZhbHVlPXtoYW5kbGVSb2xlc1NlbGVjdFZhbHVlKCl9Lz5cbiAgICAgICAgICAgIDwvU3R5bGVkRm9ybUl0ZW0+XG4gICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJoZWxwLWJsb2NrXCI+XG4gICAgICAgICAgICAgIHt0KCdSb2xlcyBpcyBhIGxpc3Qgd2hpY2ggZGVmaW5lcyBhY2Nlc3MgdG8gdGhlIGRhc2hib2FyZC4gR3JhbnRpbmcgYSByb2xlIGFjY2VzcyB0byBhIGRhc2hib2FyZCB3aWxsIGJ5cGFzcyBkYXRhc2V0IGxldmVsIGNoZWNrcy4gSWYgbm8gcm9sZXMgYXJlIGRlZmluZWQsIHJlZ3VsYXIgYWNjZXNzIHBlcm1pc3Npb25zIGFwcGx5LicpfVxuICAgICAgICAgICAgPC9wPlxuICAgICAgICAgIDwvQ29sPlxuICAgICAgICA8L1Jvdz5cbiAgICAgICAgPFJvdz5cbiAgICAgICAgICA8Q29sIHhzPXsyNH0gbWQ9ezEyfT5cbiAgICAgICAgICAgIDxDb2xvclNjaGVtZUNvbnRyb2xXcmFwcGVyIGhhc0N1c3RvbUxhYmVsQ29sb3JzPXtoYXNDdXN0b21MYWJlbENvbG9yc30gb25DaGFuZ2U9e29uQ29sb3JTY2hlbWVDaGFuZ2V9IGNvbG9yU2NoZW1lPXtjb2xvclNjaGVtZX0gbGFiZWxNYXJnaW49ezR9Lz5cbiAgICAgICAgICA8L0NvbD5cbiAgICAgICAgPC9Sb3c+XG4gICAgICA8Lz4pO1xuICAgIH07XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKHNob3cpIHtcbiAgICAgICAgICAgIGlmICghY3VycmVudERhc2hib2FyZEluZm8pIHtcbiAgICAgICAgICAgICAgICBmZXRjaERhc2hib2FyZERldGFpbHMoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIGhhbmRsZURhc2hib2FyZERhdGEoY3VycmVudERhc2hib2FyZEluZm8pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIEpzb25FZGl0b3IucHJlbG9hZCgpO1xuICAgIH0sIFtjdXJyZW50RGFzaGJvYXJkSW5mbywgZmV0Y2hEYXNoYm9hcmREZXRhaWxzLCBoYW5kbGVEYXNoYm9hcmREYXRhLCBzaG93XSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8gdGhlIHRpdGxlIGNhbiBiZSBjaGFuZ2VkIGlubGluZSBpbiB0aGUgZGFzaGJvYXJkLCB0aGlzIGNhdGNoZXMgaXRcbiAgICAgICAgaWYgKGRhc2hib2FyZFRpdGxlICYmXG4gICAgICAgICAgICBkYXNoYm9hcmRJbmZvICYmXG4gICAgICAgICAgICBkYXNoYm9hcmRJbmZvLnRpdGxlICE9PSBkYXNoYm9hcmRUaXRsZSkge1xuICAgICAgICAgICAgZm9ybS5zZXRGaWVsZHNWYWx1ZSh7XG4gICAgICAgICAgICAgICAgLi4uZGFzaGJvYXJkSW5mbyxcbiAgICAgICAgICAgICAgICB0aXRsZTogZGFzaGJvYXJkVGl0bGUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sIFtkYXNoYm9hcmRJbmZvLCBkYXNoYm9hcmRUaXRsZSwgZm9ybV0pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICghaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5UQUdHSU5HX1NZU1RFTSkpXG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIHRyeSB7XG4gICAgICAgICAgICBmZXRjaFRhZ3Moe1xuICAgICAgICAgICAgICAgIG9iamVjdFR5cGU6IE9CSkVDVF9UWVBFUy5EQVNIQk9BUkQsXG4gICAgICAgICAgICAgICAgb2JqZWN0SWQ6IGRhc2hib2FyZElkLFxuICAgICAgICAgICAgICAgIGluY2x1ZGVUeXBlczogZmFsc2UsXG4gICAgICAgICAgICB9LCAodGFncykgPT4gc2V0VGFncyh0YWdzKSwgKGVycm9yKSA9PiB7XG4gICAgICAgICAgICAgICAgYWRkRGFuZ2VyVG9hc3QoYEVycm9yIGZldGNoaW5nIHRhZ3M6ICR7ZXJyb3IudGV4dH1gKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgaGFuZGxlRXJyb3JSZXNwb25zZShlcnJvcik7XG4gICAgICAgIH1cbiAgICB9LCBbZGFzaGJvYXJkSWRdKTtcbiAgICBjb25zdCBoYW5kbGVDaGFuZ2VUYWdzID0gKHZhbHVlcykgPT4ge1xuICAgICAgICAvLyB0cmlnZ2VyZWQgd2hlbmV2ZXIgYSBuZXcgdGFnIGlzIHNlbGVjdGVkIG9yIGEgdGFnIHdhcyBkZXNlbGVjdGVkXG4gICAgICAgIC8vIG9uIG5ldyB0YWcgc2VsZWN0ZWQsIGFkZCB0aGUgdGFnXG4gICAgICAgIGNvbnN0IHVuaXF1ZVRhZ3MgPSBbLi4ubmV3IFNldCh2YWx1ZXMubWFwKHYgPT4gdi5sYWJlbCkpXTtcbiAgICAgICAgc2V0VGFncyhbLi4udW5pcXVlVGFncy5tYXAodCA9PiAoeyBuYW1lOiB0IH0pKV0pO1xuICAgIH07XG4gICAgcmV0dXJuICg8TW9kYWwgc2hvdz17c2hvd30gb25IaWRlPXtvbkhpZGV9IHRpdGxlPXt0KCdEYXNoYm9hcmQgcHJvcGVydGllcycpfSBmb290ZXI9ezw+XG4gICAgICAgICAgPEJ1dHRvbiBodG1sVHlwZT1cImJ1dHRvblwiIGJ1dHRvblNpemU9XCJzbWFsbFwiIG9uQ2xpY2s9e29uSGlkZX0gZGF0YS10ZXN0PVwicHJvcGVydGllcy1tb2RhbC1jYW5jZWwtYnV0dG9uXCIgY3RhPlxuICAgICAgICAgICAge3QoJ0NhbmNlbCcpfVxuICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgIDxCdXR0b24gZGF0YS10ZXN0PVwicHJvcGVydGllcy1tb2RhbC1hcHBseS1idXR0b25cIiBvbkNsaWNrPXtmb3JtLnN1Ym1pdH0gYnV0dG9uU2l6ZT1cInNtYWxsXCIgYnV0dG9uU3R5bGU9XCJwcmltYXJ5XCIgY2xhc3NOYW1lPVwibS1yLTVcIiBjdGEgZGlzYWJsZWQ9e2Rhc2hib2FyZEluZm8/LmlzTWFuYWdlZEV4dGVybmFsbHl9IHRvb2x0aXA9e2Rhc2hib2FyZEluZm8/LmlzTWFuYWdlZEV4dGVybmFsbHlcbiAgICAgICAgICAgICAgICA/IHQoXCJUaGlzIGRhc2hib2FyZCBpcyBtYW5hZ2VkIGV4dGVybmFsbHksIGFuZCBjYW4ndCBiZSBlZGl0ZWQgaW4gU3VwZXJzZXRcIilcbiAgICAgICAgICAgICAgICA6ICcnfT5cbiAgICAgICAgICAgIHtzYXZlTGFiZWx9XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgIDwvPn0gcmVzcG9uc2l2ZT5cbiAgICAgIDxBbnRkRm9ybSBmb3JtPXtmb3JtfSBvbkZpbmlzaD17b25GaW5pc2h9IGRhdGEtdGVzdD1cImRhc2hib2FyZC1lZGl0LXByb3BlcnRpZXMtZm9ybVwiIGxheW91dD1cInZlcnRpY2FsXCIgaW5pdGlhbFZhbHVlcz17ZGFzaGJvYXJkSW5mb30+XG4gICAgICAgIDxSb3c+XG4gICAgICAgICAgPENvbCB4cz17MjR9IG1kPXsyNH0+XG4gICAgICAgICAgICA8aDM+e3QoJ0Jhc2ljIGluZm9ybWF0aW9uJyl9PC9oMz5cbiAgICAgICAgICA8L0NvbD5cbiAgICAgICAgPC9Sb3c+XG4gICAgICAgIDxSb3cgZ3V0dGVyPXsxNn0+XG4gICAgICAgICAgPENvbCB4cz17MjR9IG1kPXsxMn0+XG4gICAgICAgICAgICA8Rm9ybUl0ZW0gbGFiZWw9e3QoJ1RpdGxlJyl9IG5hbWU9XCJ0aXRsZVwiPlxuICAgICAgICAgICAgICA8SW5wdXQgZGF0YS10ZXN0PVwiZGFzaGJvYXJkLXRpdGxlLWlucHV0XCIgdHlwZT1cInRleHRcIiBkaXNhYmxlZD17aXNMb2FkaW5nfS8+XG4gICAgICAgICAgICA8L0Zvcm1JdGVtPlxuICAgICAgICAgIDwvQ29sPlxuICAgICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MTJ9PlxuICAgICAgICAgICAgPFN0eWxlZEZvcm1JdGVtIGxhYmVsPXt0KCdVUkwgc2x1ZycpfSBuYW1lPVwic2x1Z1wiPlxuICAgICAgICAgICAgICA8SW5wdXQgdHlwZT1cInRleHRcIiBkaXNhYmxlZD17aXNMb2FkaW5nfS8+XG4gICAgICAgICAgICA8L1N0eWxlZEZvcm1JdGVtPlxuICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwiaGVscC1ibG9ja1wiPlxuICAgICAgICAgICAgICB7dCgnQSByZWFkYWJsZSBVUkwgZm9yIHlvdXIgZGFzaGJvYXJkJyl9XG4gICAgICAgICAgICA8L3A+XG4gICAgICAgICAgPC9Db2w+XG4gICAgICAgIDwvUm93PlxuICAgICAgICB7aXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5EQVNIQk9BUkRfUkJBQylcbiAgICAgICAgICAgID8gZ2V0Um93c1dpdGhSb2xlcygpXG4gICAgICAgICAgICA6IGdldFJvd3NXaXRob3V0Um9sZXMoKX1cbiAgICAgICAgPFJvdz5cbiAgICAgICAgICA8Q29sIHhzPXsyNH0gbWQ9ezI0fT5cbiAgICAgICAgICAgIDxoMz57dCgnQ2VydGlmaWNhdGlvbicpfTwvaDM+XG4gICAgICAgICAgPC9Db2w+XG4gICAgICAgIDwvUm93PlxuICAgICAgICA8Um93IGd1dHRlcj17MTZ9PlxuICAgICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MTJ9PlxuICAgICAgICAgICAgPFN0eWxlZEZvcm1JdGVtIGxhYmVsPXt0KCdDZXJ0aWZpZWQgYnknKX0gbmFtZT1cImNlcnRpZmllZEJ5XCI+XG4gICAgICAgICAgICAgIDxJbnB1dCB0eXBlPVwidGV4dFwiIGRpc2FibGVkPXtpc0xvYWRpbmd9Lz5cbiAgICAgICAgICAgIDwvU3R5bGVkRm9ybUl0ZW0+XG4gICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJoZWxwLWJsb2NrXCI+XG4gICAgICAgICAgICAgIHt0KCdQZXJzb24gb3IgZ3JvdXAgdGhhdCBoYXMgY2VydGlmaWVkIHRoaXMgZGFzaGJvYXJkLicpfVxuICAgICAgICAgICAgPC9wPlxuICAgICAgICAgIDwvQ29sPlxuICAgICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MTJ9PlxuICAgICAgICAgICAgPFN0eWxlZEZvcm1JdGVtIGxhYmVsPXt0KCdDZXJ0aWZpY2F0aW9uIGRldGFpbHMnKX0gbmFtZT1cImNlcnRpZmljYXRpb25EZXRhaWxzXCI+XG4gICAgICAgICAgICAgIDxJbnB1dCB0eXBlPVwidGV4dFwiIGRpc2FibGVkPXtpc0xvYWRpbmd9Lz5cbiAgICAgICAgICAgIDwvU3R5bGVkRm9ybUl0ZW0+XG4gICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJoZWxwLWJsb2NrXCI+XG4gICAgICAgICAgICAgIHt0KCdBbnkgYWRkaXRpb25hbCBkZXRhaWwgdG8gc2hvdyBpbiB0aGUgY2VydGlmaWNhdGlvbiB0b29sdGlwLicpfVxuICAgICAgICAgICAgPC9wPlxuICAgICAgICAgIDwvQ29sPlxuICAgICAgICA8L1Jvdz5cbiAgICAgICAge2lzRmVhdHVyZUVuYWJsZWQoRmVhdHVyZUZsYWcuVEFHR0lOR19TWVNURU0pID8gKDxSb3cgZ3V0dGVyPXsxNn0+XG4gICAgICAgICAgICA8Q29sIHhzPXsyNH0gbWQ9ezEyfT5cbiAgICAgICAgICAgICAgPGgzIGNzcz17eyBtYXJnaW5Ub3A6ICcxZW0nIH19Pnt0KCdUYWdzJyl9PC9oMz5cbiAgICAgICAgICAgIDwvQ29sPlxuICAgICAgICAgIDwvUm93PikgOiBudWxsfVxuICAgICAgICB7aXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5UQUdHSU5HX1NZU1RFTSkgPyAoPFJvdyBndXR0ZXI9ezE2fT5cbiAgICAgICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MTJ9PlxuICAgICAgICAgICAgICA8U3R5bGVkRm9ybUl0ZW0+XG4gICAgICAgICAgICAgICAgPEFzeW5jU2VsZWN0IGFyaWFMYWJlbD1cIlRhZ3NcIiBtb2RlPVwibXVsdGlwbGVcIiBhbGxvd05ld09wdGlvbnMgdmFsdWU9e3RhZ3NBc1NlbGVjdFZhbHVlc30gb3B0aW9ucz17bG9hZFRhZ3N9IG9uQ2hhbmdlPXtoYW5kbGVDaGFuZ2VUYWdzfSBhbGxvd0NsZWFyLz5cbiAgICAgICAgICAgICAgPC9TdHlsZWRGb3JtSXRlbT5cbiAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPVwiaGVscC1ibG9ja1wiPlxuICAgICAgICAgICAgICAgIHt0KCdBIGxpc3Qgb2YgdGFncyB0aGF0IGhhdmUgYmVlbiBhcHBsaWVkIHRvIHRoaXMgY2hhcnQuJyl9XG4gICAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICAgIDwvQ29sPlxuICAgICAgICAgIDwvUm93PikgOiBudWxsfVxuICAgICAgICA8Um93PlxuICAgICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MjR9PlxuICAgICAgICAgICAgPGgzIHN0eWxlPXt7IG1hcmdpblRvcDogJzFlbScgfX0+XG4gICAgICAgICAgICAgIDxCdXR0b24gYnV0dG9uU3R5bGU9XCJsaW5rXCIgb25DbGljaz17KCkgPT4gc2V0SXNBZHZhbmNlZE9wZW4oIWlzQWR2YW5jZWRPcGVuKX0+XG4gICAgICAgICAgICAgICAgPGkgY2xhc3NOYW1lPXtgZmEgZmEtYW5nbGUtJHtpc0FkdmFuY2VkT3BlbiA/ICdkb3duJyA6ICdyaWdodCd9YH0gc3R5bGU9e3sgbWluV2lkdGg6ICcxZW0nIH19Lz5cbiAgICAgICAgICAgICAgICB7dCgnQWR2YW5jZWQnKX1cbiAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICA8L2gzPlxuICAgICAgICAgICAge2lzQWR2YW5jZWRPcGVuICYmICg8PlxuICAgICAgICAgICAgICAgIDxTdHlsZWRGb3JtSXRlbSBsYWJlbD17dCgnSlNPTiBtZXRhZGF0YScpfT5cbiAgICAgICAgICAgICAgICAgIDxTdHlsZWRKc29uRWRpdG9yIHNob3dMb2FkaW5nRm9ySW1wb3J0IG5hbWU9XCJqc29uX21ldGFkYXRhXCIgdmFsdWU9e2pzb25NZXRhZGF0YX0gb25DaGFuZ2U9e3NldEpzb25NZXRhZGF0YX0gdGFiU2l6ZT17Mn0gd2lkdGg9XCIxMDAlXCIgaGVpZ2h0PVwiMjAwcHhcIiB3cmFwRW5hYmxlZC8+XG4gICAgICAgICAgICAgICAgPC9TdHlsZWRGb3JtSXRlbT5cbiAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJoZWxwLWJsb2NrXCI+XG4gICAgICAgICAgICAgICAgICB7dCgnVGhpcyBKU09OIG9iamVjdCBpcyBnZW5lcmF0ZWQgZHluYW1pY2FsbHkgd2hlbiBjbGlja2luZyB0aGUgc2F2ZSBvciBvdmVyd3JpdGUgYnV0dG9uIGluIHRoZSBkYXNoYm9hcmQgdmlldy4gSXQgaXMgZXhwb3NlZCBoZXJlIGZvciByZWZlcmVuY2UgYW5kIGZvciBwb3dlciB1c2VycyB3aG8gbWF5IHdhbnQgdG8gYWx0ZXIgc3BlY2lmaWMgcGFyYW1ldGVycy4nKX1cbiAgICAgICAgICAgICAgICAgIHtvbmx5QXBwbHkgJiYgKDw+XG4gICAgICAgICAgICAgICAgICAgICAgeycgJ31cbiAgICAgICAgICAgICAgICAgICAgICB7dCgnUGxlYXNlIERPIE5PVCBvdmVyd3JpdGUgdGhlIFwiZmlsdGVyX3Njb3Blc1wiIGtleS4nKX17JyAnfVxuICAgICAgICAgICAgICAgICAgICAgIDxGaWx0ZXJTY29wZU1vZGFsIHRyaWdnZXJOb2RlPXs8c3BhbiBjbGFzc05hbWU9XCJhbGVydC1saW5rXCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAge3QoJ1VzZSBcIiUobWVudU5hbWUpc1wiIG1lbnUgaW5zdGVhZC4nLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICBtZW51TmFtZTogdCgnU2V0IGZpbHRlciBtYXBwaW5nJyksXG4gICAgICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICAgICAgICAgICAgICA8L3NwYW4+fS8+XG4gICAgICAgICAgICAgICAgICAgIDwvPil9XG4gICAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgICA8Lz4pfVxuICAgICAgICAgIDwvQ29sPlxuICAgICAgICA8L1Jvdz5cbiAgICAgIDwvQW50ZEZvcm0+XG4gICAgPC9Nb2RhbD4pO1xufTtcbmV4cG9ydCBkZWZhdWx0IHdpdGhUb2FzdHMoUHJvcGVydGllc01vZGFsKTtcbiJdfQ== */\", toString: _EMOTION_STRINGIFIED_CSS_ERROR__ };\nconst PropertiesModal = (_ref3) => {let { addSuccessToast, addDangerToast, colorScheme: currentColorScheme, dashboardId, dashboardInfo: currentDashboardInfo, dashboardTitle, onHide = () => {}, onlyApply = false, onSubmit = () => {}, show = false } = _ref3;\n  const [form] = AntdForm.useForm();\n  const [isLoading, setIsLoading] = useState(false);\n  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);\n  const [colorScheme, setColorScheme] = useState(currentColorScheme);\n  const [jsonMetadata, setJsonMetadata] = useState('');\n  const [dashboardInfo, setDashboardInfo] = useState();\n  const [owners, setOwners] = useState([]);\n  const [roles, setRoles] = useState([]);\n  const saveLabel = onlyApply ? t('Apply') : t('Save');\n  const [tags, setTags] = useState([]);\n  const categoricalSchemeRegistry = getCategoricalSchemeRegistry();\n  const tagsAsSelectValues = useMemo(() => {\n    const selectTags = tags.map((tag) => ({\n      value: tag.name,\n      label: tag.name,\n      key: tag.name }));\n\n    return selectTags;\n  }, [tags.length]);\n  const handleErrorResponse = async (response) => {\n    const { error, statusText, message } = await getClientErrorObject(response);\n    let errorText = error || statusText || t('An error has occurred');\n    if (typeof message === 'object' && 'json_metadata' in message) {\n      errorText = message.json_metadata;\n    } else\n    if (typeof message === 'string') {\n      errorText = message;\n      if (message === 'Forbidden') {\n        errorText = t('You do not have permission to edit this dashboard');\n      }\n    }\n    Modal.error({\n      title: t('Error'),\n      content: errorText,\n      okButtonProps: { danger: true, className: 'btn-danger' } });\n\n  };\n  const loadAccessOptions = useCallback(function (accessType, input, page, pageSize) {if (accessType === void 0) {accessType = 'owners';}if (input === void 0) {input = '';}\n    const query = rison.encode({\n      filter: input,\n      page,\n      page_size: pageSize });\n\n    return SupersetClient.get({\n      endpoint: `/api/v1/dashboard/related/${accessType}?q=${query}` }).\n    then((response) => ({\n      data: response.json.result.\n      filter((item) => item.extra.active !== undefined ? item.extra.active : true).\n      map((item) => ({\n        value: item.value,\n        label: item.text })),\n\n      totalCount: response.json.count }));\n\n  }, []);\n  const handleDashboardData = useCallback((dashboardData) => {\n    const { id, dashboard_title, slug, certified_by, certification_details, owners, roles, metadata, is_managed_externally } = dashboardData;\n    const dashboardInfo = {\n      id,\n      title: dashboard_title,\n      slug: slug || '',\n      certifiedBy: certified_by || '',\n      certificationDetails: certification_details || '',\n      isManagedExternally: is_managed_externally || false };\n\n    form.setFieldsValue(dashboardInfo);\n    setDashboardInfo(dashboardInfo);\n    setOwners(owners);\n    setRoles(roles);\n    setColorScheme(metadata.color_scheme);\n    const metaDataCopy = _omit(metadata, [\n    'positions',\n    'shared_label_colors',\n    'color_scheme_domain']);\n\n    setJsonMetadata(metaDataCopy ? jsonStringify(metaDataCopy) : '');\n  }, [form]);\n  const fetchDashboardDetails = useCallback(() => {\n    setIsLoading(true);\n    // We fetch the dashboard details because not all code\n    // that renders this component have all the values we need.\n    // At some point when we have a more consistent frontend\n    // datamodel, the dashboard could probably just be passed as a prop.\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/${dashboardId}` }).\n    then((response) => {var _dashboard$json_metad;\n      const dashboard = response.json.result;\n      const jsonMetadataObj = (_dashboard$json_metad = dashboard.json_metadata) != null && _dashboard$json_metad.length ?\n      JSON.parse(dashboard.json_metadata) :\n      {};\n      handleDashboardData({\n        ...dashboard,\n        metadata: jsonMetadataObj });\n\n      setIsLoading(false);\n    }, handleErrorResponse);\n  }, [dashboardId, handleDashboardData]);\n  const getJsonMetadata = () => {\n    try {\n      const jsonMetadataObj = jsonMetadata != null && jsonMetadata.length ?\n      JSON.parse(jsonMetadata) :\n      {};\n      return jsonMetadataObj;\n    }\n    catch (_) {\n      return {};\n    }\n  };\n  const handleOnChangeOwners = (owners) => {\n    const parsedOwners = ensureIsArray(owners).map((o) => ({\n      id: o.value,\n      full_name: o.label }));\n\n    setOwners(parsedOwners);\n  };\n  const handleOnChangeRoles = (roles) => {\n    const parsedRoles = ensureIsArray(roles).map((r) => ({\n      id: r.value,\n      name: r.label }));\n\n    setRoles(parsedRoles);\n  };\n  const handleOwnersSelectValue = () => {\n    const parsedOwners = (owners || []).map((owner) => ({\n      value: owner.id,\n      label: owner.full_name || `${owner.first_name} ${owner.last_name}` }));\n\n    return parsedOwners;\n  };\n  const handleRolesSelectValue = () => {\n    const parsedRoles = (roles || []).map((role) => ({\n      value: role.id,\n      label: `${role.name}` }));\n\n    return parsedRoles;\n  };\n  const onColorSchemeChange = function (colorScheme, _temp) {if (colorScheme === void 0) {colorScheme = '';}let { updateMetadata = true } = _temp === void 0 ? {} : _temp;\n    // check that color_scheme is valid\n    const colorChoices = categoricalSchemeRegistry.keys();\n    const jsonMetadataObj = getJsonMetadata();\n    // only fire if the color_scheme is present and invalid\n    if (colorScheme && !_includesInstanceProperty(colorChoices).call(colorChoices, colorScheme)) {\n      Modal.error({\n        title: t('Error'),\n        content: t('A valid color scheme is required'),\n        okButtonProps: { danger: true, className: 'btn-danger' } });\n\n      throw new Error('A valid color scheme is required');\n    }\n    // update metadata to match selection\n    if (updateMetadata) {\n      jsonMetadataObj.color_scheme = colorScheme;\n      jsonMetadataObj.label_colors = jsonMetadataObj.label_colors || {};\n      setJsonMetadata(jsonStringify(jsonMetadataObj));\n    }\n    setColorScheme(colorScheme);\n  };\n  const updateTags = (oldTags, newTags) => {\n    // update the tags for this object\n    // add tags that are in new tags, but not in old tags\n    // eslint-disable-next-line array-callback-return\n    newTags.map((tag) => {\n      if (!oldTags.some((t) => t.name === tag.name)) {\n        addTag({\n          objectType: OBJECT_TYPES.DASHBOARD,\n          objectId: dashboardId,\n          includeTypes: false },\n        tag.name, () => {}, () => {});\n      }\n    });\n    // delete tags that are in old tags, but not in new tags\n    // eslint-disable-next-line array-callback-return\n    oldTags.map((tag) => {\n      if (!newTags.some((t) => t.name === tag.name)) {\n        deleteTaggedObjects({\n          objectType: OBJECT_TYPES.DASHBOARD,\n          objectId: dashboardId },\n        tag, () => {}, () => {});\n      }\n    });\n  };\n  const onFinish = () => {var _metadata, _metadata2, _metadata3, _metadata4;\n    const { title, slug, certifiedBy, certificationDetails } = form.getFieldsValue();\n    let currentColorScheme = colorScheme;\n    let colorNamespace = '';\n    let currentJsonMetadata = jsonMetadata;\n    // validate currentJsonMetadata\n    let metadata;\n    try {\n      if (!currentJsonMetadata.startsWith('{') ||\n      !currentJsonMetadata.endsWith('}')) {\n        throw new Error();\n      }\n      metadata = JSON.parse(currentJsonMetadata);\n    }\n    catch (error) {\n      addDangerToast(t('JSON metadata is invalid!'));\n      return;\n    }\n    // color scheme in json metadata has precedence over selection\n    currentColorScheme = ((_metadata = metadata) == null ? void 0 : _metadata.color_scheme) || colorScheme;\n    colorNamespace = (_metadata2 = metadata) == null ? void 0 : _metadata2.color_namespace;\n    // filter shared_label_color from user input\n    if ((_metadata3 = metadata) != null && _metadata3.shared_label_colors) {\n      delete metadata.shared_label_colors;\n    }\n    if ((_metadata4 = metadata) != null && _metadata4.color_scheme_domain) {\n      delete metadata.color_scheme_domain;\n    }\n    const sharedLabelColor = getSharedLabelColor();\n    const categoricalNamespace = CategoricalColorNamespace.getNamespace(colorNamespace);\n    categoricalNamespace.resetColors();\n    if (currentColorScheme) {var _categoricalSchemeReg;\n      sharedLabelColor.updateColorMap(colorNamespace, currentColorScheme);\n      metadata.shared_label_colors = Object.fromEntries(sharedLabelColor.getColorMap());\n      metadata.color_scheme_domain =\n      ((_categoricalSchemeReg = categoricalSchemeRegistry.get(colorScheme)) == null ? void 0 : _categoricalSchemeReg.colors) || [];\n    } else\n    {\n      sharedLabelColor.reset();\n      metadata.shared_label_colors = {};\n      metadata.color_scheme_domain = [];\n    }\n    currentJsonMetadata = jsonStringify(metadata);\n    onColorSchemeChange(currentColorScheme, {\n      updateMetadata: false });\n\n    if (isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM)) {\n      // update tags\n      try {\n        fetchTags({\n          objectType: OBJECT_TYPES.DASHBOARD,\n          objectId: dashboardId,\n          includeTypes: false },\n        (currentTags) => updateTags(currentTags, tags), (error) => {\n          handleErrorResponse(error);\n        });\n      }\n      catch (error) {\n        handleErrorResponse(error);\n      }\n    }\n    const moreOnSubmitProps = {};\n    const morePutProps = {};\n    if (isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC)) {\n      moreOnSubmitProps.roles = roles;\n      morePutProps.roles = (roles || []).map((r) => r.id);\n    }\n    const onSubmitProps = {\n      id: dashboardId,\n      title,\n      slug,\n      jsonMetadata: currentJsonMetadata,\n      owners,\n      colorScheme: currentColorScheme,\n      colorNamespace,\n      certifiedBy,\n      certificationDetails,\n      ...moreOnSubmitProps };\n\n    if (onlyApply) {\n      onSubmit(onSubmitProps);\n      onHide();\n      addSuccessToast(t('Dashboard properties updated'));\n    } else\n    {\n      SupersetClient.put({\n        endpoint: `/api/v1/dashboard/${dashboardId}`,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          dashboard_title: title,\n          slug: slug || null,\n          json_metadata: currentJsonMetadata || null,\n          owners: (owners || []).map((o) => o.id),\n          certified_by: certifiedBy || null,\n          certification_details: certifiedBy && certificationDetails ? certificationDetails : null,\n          ...morePutProps }) }).\n\n      then(() => {\n        onSubmit(onSubmitProps);\n        onHide();\n        addSuccessToast(t('The dashboard has been saved'));\n      }, handleErrorResponse);\n    }\n  };\n  const getRowsWithoutRoles = () => {\n    const jsonMetadataObj = getJsonMetadata();\n    const hasCustomLabelColors = !!Object.keys((jsonMetadataObj == null ? void 0 : jsonMetadataObj.label_colors) || {}).length;\n    return ___EmotionJSX(Row, { gutter: 16 },\n    ___EmotionJSX(Col, { xs: 24, md: 12 },\n    ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } }, t('Access')),\n    ___EmotionJSX(StyledFormItem, { label: t('Owners') },\n    ___EmotionJSX(AsyncSelect, { allowClear: true, ariaLabel: t('Owners'), disabled: isLoading, mode: \"multiple\", onChange: handleOnChangeOwners, options: (input, page, pageSize) => loadAccessOptions('owners', input, page, pageSize), value: handleOwnersSelectValue() })),\n\n    ___EmotionJSX(\"p\", { className: \"help-block\" },\n    t('Owners is a list of users who can alter the dashboard. Searchable by name or username.'))),\n\n\n    ___EmotionJSX(Col, { xs: 24, md: 12 },\n    ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } }, t('Colors')),\n    ___EmotionJSX(ColorSchemeControlWrapper, { hasCustomLabelColors: hasCustomLabelColors, onChange: onColorSchemeChange, colorScheme: colorScheme, labelMargin: 4 })));\n\n\n  };\n  const getRowsWithRoles = () => {\n    const jsonMetadataObj = getJsonMetadata();\n    const hasCustomLabelColors = !!Object.keys((jsonMetadataObj == null ? void 0 : jsonMetadataObj.label_colors) || {}).length;\n    return ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(Row, null,\n    ___EmotionJSX(Col, { xs: 24, md: 24 },\n    ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } }, t('Access')))),\n\n\n    ___EmotionJSX(Row, { gutter: 16 },\n    ___EmotionJSX(Col, { xs: 24, md: 12 },\n    ___EmotionJSX(StyledFormItem, { label: t('Owners') },\n    ___EmotionJSX(AsyncSelect, { allowClear: true, allowNewOptions: true, ariaLabel: t('Owners'), disabled: isLoading, mode: \"multiple\", onChange: handleOnChangeOwners, options: (input, page, pageSize) => loadAccessOptions('owners', input, page, pageSize), value: handleOwnersSelectValue() })),\n\n    ___EmotionJSX(\"p\", { className: \"help-block\" },\n    t('Owners is a list of users who can alter the dashboard. Searchable by name or username.'))),\n\n\n    ___EmotionJSX(Col, { xs: 24, md: 12 },\n    ___EmotionJSX(StyledFormItem, { label: t('Roles') },\n    ___EmotionJSX(AsyncSelect, { allowClear: true, ariaLabel: t('Roles'), disabled: isLoading, mode: \"multiple\", onChange: handleOnChangeRoles, options: (input, page, pageSize) => loadAccessOptions('roles', input, page, pageSize), value: handleRolesSelectValue() })),\n\n    ___EmotionJSX(\"p\", { className: \"help-block\" },\n    t('Roles is a list which defines access to the dashboard. Granting a role access to a dashboard will bypass dataset level checks. If no roles are defined, regular access permissions apply.')))),\n\n\n\n    ___EmotionJSX(Row, null,\n    ___EmotionJSX(Col, { xs: 24, md: 12 },\n    ___EmotionJSX(ColorSchemeControlWrapper, { hasCustomLabelColors: hasCustomLabelColors, onChange: onColorSchemeChange, colorScheme: colorScheme, labelMargin: 4 }))));\n\n\n\n  };\n  useEffect(() => {\n    if (show) {\n      if (!currentDashboardInfo) {\n        fetchDashboardDetails();\n      } else\n      {\n        handleDashboardData(currentDashboardInfo);\n      }\n    }\n    JsonEditor.preload();\n  }, [currentDashboardInfo, fetchDashboardDetails, handleDashboardData, show]);\n  useEffect(() => {\n    // the title can be changed inline in the dashboard, this catches it\n    if (dashboardTitle &&\n    dashboardInfo &&\n    dashboardInfo.title !== dashboardTitle) {\n      form.setFieldsValue({\n        ...dashboardInfo,\n        title: dashboardTitle });\n\n    }\n  }, [dashboardInfo, dashboardTitle, form]);\n  useEffect(() => {\n    if (!isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM))\n    return;\n    try {\n      fetchTags({\n        objectType: OBJECT_TYPES.DASHBOARD,\n        objectId: dashboardId,\n        includeTypes: false },\n      (tags) => setTags(tags), (error) => {\n        addDangerToast(`Error fetching tags: ${error.text}`);\n      });\n    }\n    catch (error) {\n      handleErrorResponse(error);\n    }\n  }, [dashboardId]);\n  const handleChangeTags = (values) => {\n    // triggered whenever a new tag is selected or a tag was deselected\n    // on new tag selected, add the tag\n    const uniqueTags = [...new Set(values.map((v) => v.label))];\n    setTags([...uniqueTags.map((t) => ({ name: t }))]);\n  };\n  return ___EmotionJSX(Modal, { show: show, onHide: onHide, title: t('Dashboard properties'), footer: ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(Button, { htmlType: \"button\", buttonSize: \"small\", onClick: onHide, cta: true },\n    t('Cancel')),\n\n    ___EmotionJSX(Button, { onClick: form.submit, buttonSize: \"small\", buttonStyle: \"primary\", className: \"m-r-5\", cta: true, disabled: dashboardInfo == null ? void 0 : dashboardInfo.isManagedExternally, tooltip: dashboardInfo != null && dashboardInfo.isManagedExternally ?\n      t(\"This dashboard is managed externally, and can't be edited in Superset\") :\n      '' },\n    saveLabel)),\n\n    responsive: true },\n  ___EmotionJSX(AntdForm, { form: form, onFinish: onFinish, layout: \"vertical\", initialValues: dashboardInfo },\n  ___EmotionJSX(Row, null,\n  ___EmotionJSX(Col, { xs: 24, md: 24 },\n  ___EmotionJSX(\"h3\", null, t('Basic information')))),\n\n\n  ___EmotionJSX(Row, { gutter: 16 },\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(FormItem, { label: t('Title'), name: \"title\" },\n  ___EmotionJSX(Input, { type: \"text\", disabled: isLoading }))),\n\n\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(StyledFormItem, { label: t('URL slug'), name: \"slug\" },\n  ___EmotionJSX(Input, { type: \"text\", disabled: isLoading })),\n\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('A readable URL for your dashboard')))),\n\n\n\n  isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC) ?\n  getRowsWithRoles() :\n  getRowsWithoutRoles(),\n  ___EmotionJSX(Row, null,\n  ___EmotionJSX(Col, { xs: 24, md: 24 },\n  ___EmotionJSX(\"h3\", null, t('Certification')))),\n\n\n  ___EmotionJSX(Row, { gutter: 16 },\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(StyledFormItem, { label: t('Certified by'), name: \"certifiedBy\" },\n  ___EmotionJSX(Input, { type: \"text\", disabled: isLoading })),\n\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('Person or group that has certified this dashboard.'))),\n\n\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(StyledFormItem, { label: t('Certification details'), name: \"certificationDetails\" },\n  ___EmotionJSX(Input, { type: \"text\", disabled: isLoading })),\n\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('Any additional detail to show in the certification tooltip.')))),\n\n\n\n  isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM) ? ___EmotionJSX(Row, { gutter: 16 },\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(\"h3\", { css: _ref4 }, t('Tags')))) :\n\n  null,\n  isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM) ? ___EmotionJSX(Row, { gutter: 16 },\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(StyledFormItem, null,\n  ___EmotionJSX(AsyncSelect, { ariaLabel: \"Tags\", mode: \"multiple\", allowNewOptions: true, value: tagsAsSelectValues, options: loadTags, onChange: handleChangeTags, allowClear: true })),\n\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('A list of tags that have been applied to this chart.')))) :\n\n\n  null,\n  ___EmotionJSX(Row, null,\n  ___EmotionJSX(Col, { xs: 24, md: 24 },\n  ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } },\n  ___EmotionJSX(Button, { buttonStyle: \"link\", onClick: () => setIsAdvancedOpen(!isAdvancedOpen) },\n  ___EmotionJSX(\"i\", { className: `fa fa-angle-${isAdvancedOpen ? 'down' : 'right'}`, style: { minWidth: '1em' } }),\n  t('Advanced'))),\n\n\n  isAdvancedOpen && ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(StyledFormItem, { label: t('JSON metadata') },\n  ___EmotionJSX(StyledJsonEditor, { showLoadingForImport: true, name: \"json_metadata\", value: jsonMetadata, onChange: setJsonMetadata, tabSize: 2, width: \"100%\", height: \"200px\", wrapEnabled: true })),\n\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('This JSON object is generated dynamically when clicking the save or overwrite button in the dashboard view. It is exposed here for reference and for power users who may want to alter specific parameters.'),\n  onlyApply && ___EmotionJSX(React.Fragment, null,\n  ' ',\n  t('Please DO NOT overwrite the \"filter_scopes\" key.'), ' ',\n  ___EmotionJSX(FilterScopeModal, { triggerNode: ___EmotionJSX(\"span\", { className: \"alert-link\" },\n    t('Use \"%(menuName)s\" menu instead.', {\n      menuName: t('Set filter mapping') })) }))))))));\n\n\n\n\n\n\n\n\n\n};\nexport default withToasts(PropertiesModal);","map":{"version":3,"mappings":"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","names":["React","useCallback","useEffect","useMemo","useState","Input","FormItem","jsonStringify","Button","AntdForm","AsyncSelect","Col","Row","rison","CategoricalColorNamespace","ensureIsArray","isFeatureEnabled","FeatureFlag","getCategoricalSchemeRegistry","getSharedLabelColor","styled","SupersetClient","t","Modal","JsonEditor","ColorSchemeControlWrapper","FilterScopeModal","getClientErrorObject","withToasts","addTag","deleteTaggedObjects","fetchTags","OBJECT_TYPES","loadTags","StyledFormItem","StyledJsonEditor","theme","borderRadius","colors","secondary","light2","PropertiesModal","addSuccessToast","addDangerToast","colorScheme","currentColorScheme","dashboardId","dashboardInfo","currentDashboardInfo","dashboardTitle","onHide","onlyApply","onSubmit","show","form","useForm","isLoading","setIsLoading","isAdvancedOpen","setIsAdvancedOpen","setColorScheme","jsonMetadata","setJsonMetadata","setDashboardInfo","owners","setOwners","roles","setRoles","saveLabel","tags","setTags","categoricalSchemeRegistry","tagsAsSelectValues","selectTags","map","value","tag","name","label","key","length","handleErrorResponse","response","error","statusText","message","errorText","json_metadata","title","content","okButtonProps","danger","className","loadAccessOptions","accessType","input","page","pageSize","query","encode","filter","page_size","get","endpoint","then","data","json","result","item","extra","active","undefined","text","totalCount","count","handleDashboardData","id","dashboard_title","slug","certified_by","certification_details","metadata","is_managed_externally","dashboardData","certifiedBy","certificationDetails","isManagedExternally","setFieldsValue","color_scheme","metaDataCopy","fetchDashboardDetails","dashboard","jsonMetadataObj","JSON","parse","getJsonMetadata","_","handleOnChangeOwners","parsedOwners","o","full_name","handleOnChangeRoles","parsedRoles","r","handleOwnersSelectValue","owner","first_name","last_name","handleRolesSelectValue","role","onColorSchemeChange","updateMetadata","colorChoices","keys","Error","label_colors","updateTags","oldTags","newTags","some","objectType","DASHBOARD","objectId","includeTypes","onFinish","getFieldsValue","colorNamespace","currentJsonMetadata","startsWith","endsWith","color_namespace","shared_label_colors","color_scheme_domain","sharedLabelColor","categoricalNamespace","getNamespace","resetColors","updateColorMap","Object","fromEntries","getColorMap","reset","TAGGING_SYSTEM","currentTags","moreOnSubmitProps","morePutProps","DASHBOARD_RBAC","onSubmitProps","put","headers","body","stringify","getRowsWithoutRoles","hasCustomLabelColors","marginTop","getRowsWithRoles","preload","handleChangeTags","values","uniqueTags","Set","v","submit","minWidth","menuName"],"sourceRoot":"","sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/src/dashboard/components/PropertiesModal/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { omit } from 'lodash';\nimport { Input } from 'src/components/Input';\nimport { FormItem } from 'src/components/Form';\nimport jsonStringify from 'json-stringify-pretty-compact';\nimport Button from 'src/components/Button';\nimport { AntdForm, AsyncSelect, Col, Row } from 'src/components';\nimport rison from 'rison';\nimport {\n  CategoricalColorNamespace,\n  ensureIsArray,\n  isFeatureEnabled,\n  FeatureFlag,\n  getCategoricalSchemeRegistry,\n  getSharedLabelColor,\n  styled,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\n\nimport Modal from 'src/components/Modal';\nimport { JsonEditor } from 'src/components/AsyncAceEditor';\n\nimport ColorSchemeControlWrapper from 'src/dashboard/components/ColorSchemeControlWrapper';\nimport FilterScopeModal from 'src/dashboard/components/filterscope/FilterScopeModal';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport TagType from 'src/types/TagType';\nimport {\n  addTag,\n  deleteTaggedObjects,\n  fetchTags,\n  OBJECT_TYPES,\n} from 'src/features/tags/tags';\nimport { loadTags } from 'src/components/Tags/utils';\n\nconst StyledFormItem = styled(FormItem)`\n  margin-bottom: 0;\n`;\n\nconst StyledJsonEditor = styled(JsonEditor)`\n  border-radius: ${({ theme }) => theme.borderRadius}px;\n  border: 1px solid ${({ theme }) => theme.colors.secondary.light2};\n`;\n\ntype PropertiesModalProps = {\n  dashboardId: number;\n  dashboardTitle?: string;\n  dashboardInfo?: Record<string, any>;\n  show?: boolean;\n  onHide?: () => void;\n  colorScheme?: string;\n  onSubmit?: (params: Record<string, any>) => void;\n  addSuccessToast: (message: string) => void;\n  addDangerToast: (message: string) => void;\n  onlyApply?: boolean;\n};\n\ntype Roles = { id: number; name: string }[];\ntype Owners = {\n  id: number;\n  full_name?: string;\n  first_name?: string;\n  last_name?: string;\n}[];\ntype DashboardInfo = {\n  id: number;\n  title: string;\n  slug: string;\n  certifiedBy: string;\n  certificationDetails: string;\n  isManagedExternally: boolean;\n};\n\nconst PropertiesModal = ({\n  addSuccessToast,\n  addDangerToast,\n  colorScheme: currentColorScheme,\n  dashboardId,\n  dashboardInfo: currentDashboardInfo,\n  dashboardTitle,\n  onHide = () => {},\n  onlyApply = false,\n  onSubmit = () => {},\n  show = false,\n}: PropertiesModalProps) => {\n  const [form] = AntdForm.useForm();\n  const [isLoading, setIsLoading] = useState(false);\n  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);\n  const [colorScheme, setColorScheme] = useState(currentColorScheme);\n  const [jsonMetadata, setJsonMetadata] = useState('');\n  const [dashboardInfo, setDashboardInfo] = useState<DashboardInfo>();\n  const [owners, setOwners] = useState<Owners>([]);\n  const [roles, setRoles] = useState<Roles>([]);\n  const saveLabel = onlyApply ? t('Apply') : t('Save');\n  const [tags, setTags] = useState<TagType[]>([]);\n  const categoricalSchemeRegistry = getCategoricalSchemeRegistry();\n\n  const tagsAsSelectValues = useMemo(() => {\n    const selectTags = tags.map(tag => ({\n      value: tag.name,\n      label: tag.name,\n      key: tag.name,\n    }));\n    return selectTags;\n  }, [tags.length]);\n\n  const handleErrorResponse = async (response: Response) => {\n    const { error, statusText, message } = await getClientErrorObject(response);\n    let errorText = error || statusText || t('An error has occurred');\n    if (typeof message === 'object' && 'json_metadata' in message) {\n      errorText = (message as { json_metadata: string }).json_metadata;\n    } else if (typeof message === 'string') {\n      errorText = message;\n\n      if (message === 'Forbidden') {\n        errorText = t('You do not have permission to edit this dashboard');\n      }\n    }\n\n    Modal.error({\n      title: t('Error'),\n      content: errorText,\n      okButtonProps: { danger: true, className: 'btn-danger' },\n    });\n  };\n\n  const loadAccessOptions = useCallback(\n    (accessType = 'owners', input = '', page: number, pageSize: number) => {\n      const query = rison.encode({\n        filter: input,\n        page,\n        page_size: pageSize,\n      });\n      return SupersetClient.get({\n        endpoint: `/api/v1/dashboard/related/${accessType}?q=${query}`,\n      }).then(response => ({\n        data: response.json.result\n          .filter((item: { extra: { active: boolean } }) =>\n            item.extra.active !== undefined ? item.extra.active : true,\n          )\n          .map((item: { value: number; text: string }) => ({\n            value: item.value,\n            label: item.text,\n          })),\n        totalCount: response.json.count,\n      }));\n    },\n    [],\n  );\n\n  const handleDashboardData = useCallback(\n    dashboardData => {\n      const {\n        id,\n        dashboard_title,\n        slug,\n        certified_by,\n        certification_details,\n        owners,\n        roles,\n        metadata,\n        is_managed_externally,\n      } = dashboardData;\n      const dashboardInfo = {\n        id,\n        title: dashboard_title,\n        slug: slug || '',\n        certifiedBy: certified_by || '',\n        certificationDetails: certification_details || '',\n        isManagedExternally: is_managed_externally || false,\n      };\n\n      form.setFieldsValue(dashboardInfo);\n      setDashboardInfo(dashboardInfo);\n      setOwners(owners);\n      setRoles(roles);\n      setColorScheme(metadata.color_scheme);\n\n      const metaDataCopy = omit(metadata, [\n        'positions',\n        'shared_label_colors',\n        'color_scheme_domain',\n      ]);\n\n      setJsonMetadata(metaDataCopy ? jsonStringify(metaDataCopy) : '');\n    },\n    [form],\n  );\n\n  const fetchDashboardDetails = useCallback(() => {\n    setIsLoading(true);\n    // We fetch the dashboard details because not all code\n    // that renders this component have all the values we need.\n    // At some point when we have a more consistent frontend\n    // datamodel, the dashboard could probably just be passed as a prop.\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/${dashboardId}`,\n    }).then(response => {\n      const dashboard = response.json.result;\n      const jsonMetadataObj = dashboard.json_metadata?.length\n        ? JSON.parse(dashboard.json_metadata)\n        : {};\n\n      handleDashboardData({\n        ...dashboard,\n        metadata: jsonMetadataObj,\n      });\n\n      setIsLoading(false);\n    }, handleErrorResponse);\n  }, [dashboardId, handleDashboardData]);\n\n  const getJsonMetadata = () => {\n    try {\n      const jsonMetadataObj = jsonMetadata?.length\n        ? JSON.parse(jsonMetadata)\n        : {};\n      return jsonMetadataObj;\n    } catch (_) {\n      return {};\n    }\n  };\n\n  const handleOnChangeOwners = (owners: { value: number; label: string }[]) => {\n    const parsedOwners: Owners = ensureIsArray(owners).map(o => ({\n      id: o.value,\n      full_name: o.label,\n    }));\n    setOwners(parsedOwners);\n  };\n\n  const handleOnChangeRoles = (roles: { value: number; label: string }[]) => {\n    const parsedRoles: Roles = ensureIsArray(roles).map(r => ({\n      id: r.value,\n      name: r.label,\n    }));\n    setRoles(parsedRoles);\n  };\n\n  const handleOwnersSelectValue = () => {\n    const parsedOwners = (owners || []).map(\n      (owner: {\n        id: number;\n        first_name?: string;\n        last_name?: string;\n        full_name?: string;\n      }) => ({\n        value: owner.id,\n        label: owner.full_name || `${owner.first_name} ${owner.last_name}`,\n      }),\n    );\n    return parsedOwners;\n  };\n\n  const handleRolesSelectValue = () => {\n    const parsedRoles = (roles || []).map(\n      (role: { id: number; name: string }) => ({\n        value: role.id,\n        label: `${role.name}`,\n      }),\n    );\n    return parsedRoles;\n  };\n\n  const onColorSchemeChange = (\n    colorScheme = '',\n    { updateMetadata = true } = {},\n  ) => {\n    // check that color_scheme is valid\n    const colorChoices = categoricalSchemeRegistry.keys();\n    const jsonMetadataObj = getJsonMetadata();\n\n    // only fire if the color_scheme is present and invalid\n    if (colorScheme && !colorChoices.includes(colorScheme)) {\n      Modal.error({\n        title: t('Error'),\n        content: t('A valid color scheme is required'),\n        okButtonProps: { danger: true, className: 'btn-danger' },\n      });\n      throw new Error('A valid color scheme is required');\n    }\n\n    // update metadata to match selection\n    if (updateMetadata) {\n      jsonMetadataObj.color_scheme = colorScheme;\n      jsonMetadataObj.label_colors = jsonMetadataObj.label_colors || {};\n\n      setJsonMetadata(jsonStringify(jsonMetadataObj));\n    }\n    setColorScheme(colorScheme);\n  };\n\n  const updateTags = (oldTags: TagType[], newTags: TagType[]) => {\n    // update the tags for this object\n    // add tags that are in new tags, but not in old tags\n    // eslint-disable-next-line array-callback-return\n    newTags.map((tag: TagType) => {\n      if (!oldTags.some(t => t.name === tag.name)) {\n        addTag(\n          {\n            objectType: OBJECT_TYPES.DASHBOARD,\n            objectId: dashboardId,\n            includeTypes: false,\n          },\n          tag.name,\n          () => {},\n          () => {},\n        );\n      }\n    });\n    // delete tags that are in old tags, but not in new tags\n    // eslint-disable-next-line array-callback-return\n    oldTags.map((tag: TagType) => {\n      if (!newTags.some(t => t.name === tag.name)) {\n        deleteTaggedObjects(\n          {\n            objectType: OBJECT_TYPES.DASHBOARD,\n            objectId: dashboardId,\n          },\n          tag,\n          () => {},\n          () => {},\n        );\n      }\n    });\n  };\n\n  const onFinish = () => {\n    const { title, slug, certifiedBy, certificationDetails } =\n      form.getFieldsValue();\n    let currentColorScheme = colorScheme;\n    let colorNamespace = '';\n    let currentJsonMetadata = jsonMetadata;\n\n    // validate currentJsonMetadata\n    let metadata;\n    try {\n      if (\n        !currentJsonMetadata.startsWith('{') ||\n        !currentJsonMetadata.endsWith('}')\n      ) {\n        throw new Error();\n      }\n      metadata = JSON.parse(currentJsonMetadata);\n    } catch (error) {\n      addDangerToast(t('JSON metadata is invalid!'));\n      return;\n    }\n\n    // color scheme in json metadata has precedence over selection\n    currentColorScheme = metadata?.color_scheme || colorScheme;\n    colorNamespace = metadata?.color_namespace;\n\n    // filter shared_label_color from user input\n    if (metadata?.shared_label_colors) {\n      delete metadata.shared_label_colors;\n    }\n    if (metadata?.color_scheme_domain) {\n      delete metadata.color_scheme_domain;\n    }\n\n    const sharedLabelColor = getSharedLabelColor();\n    const categoricalNamespace =\n      CategoricalColorNamespace.getNamespace(colorNamespace);\n    categoricalNamespace.resetColors();\n    if (currentColorScheme) {\n      sharedLabelColor.updateColorMap(colorNamespace, currentColorScheme);\n      metadata.shared_label_colors = Object.fromEntries(\n        sharedLabelColor.getColorMap(),\n      );\n      metadata.color_scheme_domain =\n        categoricalSchemeRegistry.get(colorScheme)?.colors || [];\n    } else {\n      sharedLabelColor.reset();\n      metadata.shared_label_colors = {};\n      metadata.color_scheme_domain = [];\n    }\n\n    currentJsonMetadata = jsonStringify(metadata);\n\n    onColorSchemeChange(currentColorScheme, {\n      updateMetadata: false,\n    });\n\n    if (isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM)) {\n      // update tags\n      try {\n        fetchTags(\n          {\n            objectType: OBJECT_TYPES.DASHBOARD,\n            objectId: dashboardId,\n            includeTypes: false,\n          },\n          (currentTags: TagType[]) => updateTags(currentTags, tags),\n          error => {\n            handleErrorResponse(error);\n          },\n        );\n      } catch (error) {\n        handleErrorResponse(error);\n      }\n    }\n\n    const moreOnSubmitProps: { roles?: Roles } = {};\n    const morePutProps: { roles?: number[] } = {};\n    if (isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC)) {\n      moreOnSubmitProps.roles = roles;\n      morePutProps.roles = (roles || []).map(r => r.id);\n    }\n    const onSubmitProps = {\n      id: dashboardId,\n      title,\n      slug,\n      jsonMetadata: currentJsonMetadata,\n      owners,\n      colorScheme: currentColorScheme,\n      colorNamespace,\n      certifiedBy,\n      certificationDetails,\n      ...moreOnSubmitProps,\n    };\n    if (onlyApply) {\n      onSubmit(onSubmitProps);\n      onHide();\n      addSuccessToast(t('Dashboard properties updated'));\n    } else {\n      SupersetClient.put({\n        endpoint: `/api/v1/dashboard/${dashboardId}`,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          dashboard_title: title,\n          slug: slug || null,\n          json_metadata: currentJsonMetadata || null,\n          owners: (owners || []).map(o => o.id),\n          certified_by: certifiedBy || null,\n          certification_details:\n            certifiedBy && certificationDetails ? certificationDetails : null,\n          ...morePutProps,\n        }),\n      }).then(() => {\n        onSubmit(onSubmitProps);\n        onHide();\n        addSuccessToast(t('The dashboard has been saved'));\n      }, handleErrorResponse);\n    }\n  };\n\n  const getRowsWithoutRoles = () => {\n    const jsonMetadataObj = getJsonMetadata();\n    const hasCustomLabelColors = !!Object.keys(\n      jsonMetadataObj?.label_colors || {},\n    ).length;\n\n    return (\n      <Row gutter={16}>\n        <Col xs={24} md={12}>\n          <h3 style={{ marginTop: '1em' }}>{t('Access')}</h3>\n          <StyledFormItem label={t('Owners')}>\n            <AsyncSelect\n              allowClear\n              ariaLabel={t('Owners')}\n              disabled={isLoading}\n              mode=\"multiple\"\n              onChange={handleOnChangeOwners}\n              options={(input, page, pageSize) =>\n                loadAccessOptions('owners', input, page, pageSize)\n              }\n              value={handleOwnersSelectValue()}\n            />\n          </StyledFormItem>\n          <p className=\"help-block\">\n            {t(\n              'Owners is a list of users who can alter the dashboard. Searchable by name or username.',\n            )}\n          </p>\n        </Col>\n        <Col xs={24} md={12}>\n          <h3 style={{ marginTop: '1em' }}>{t('Colors')}</h3>\n          <ColorSchemeControlWrapper\n            hasCustomLabelColors={hasCustomLabelColors}\n            onChange={onColorSchemeChange}\n            colorScheme={colorScheme}\n            labelMargin={4}\n          />\n        </Col>\n      </Row>\n    );\n  };\n\n  const getRowsWithRoles = () => {\n    const jsonMetadataObj = getJsonMetadata();\n    const hasCustomLabelColors = !!Object.keys(\n      jsonMetadataObj?.label_colors || {},\n    ).length;\n\n    return (\n      <>\n        <Row>\n          <Col xs={24} md={24}>\n            <h3 style={{ marginTop: '1em' }}>{t('Access')}</h3>\n          </Col>\n        </Row>\n        <Row gutter={16}>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('Owners')}>\n              <AsyncSelect\n                allowClear\n                allowNewOptions\n                ariaLabel={t('Owners')}\n                disabled={isLoading}\n                mode=\"multiple\"\n                onChange={handleOnChangeOwners}\n                options={(input, page, pageSize) =>\n                  loadAccessOptions('owners', input, page, pageSize)\n                }\n                value={handleOwnersSelectValue()}\n              />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t(\n                'Owners is a list of users who can alter the dashboard. Searchable by name or username.',\n              )}\n            </p>\n          </Col>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('Roles')}>\n              <AsyncSelect\n                allowClear\n                ariaLabel={t('Roles')}\n                disabled={isLoading}\n                mode=\"multiple\"\n                onChange={handleOnChangeRoles}\n                options={(input, page, pageSize) =>\n                  loadAccessOptions('roles', input, page, pageSize)\n                }\n                value={handleRolesSelectValue()}\n              />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t(\n                'Roles is a list which defines access to the dashboard. Granting a role access to a dashboard will bypass dataset level checks. If no roles are defined, regular access permissions apply.',\n              )}\n            </p>\n          </Col>\n        </Row>\n        <Row>\n          <Col xs={24} md={12}>\n            <ColorSchemeControlWrapper\n              hasCustomLabelColors={hasCustomLabelColors}\n              onChange={onColorSchemeChange}\n              colorScheme={colorScheme}\n              labelMargin={4}\n            />\n          </Col>\n        </Row>\n      </>\n    );\n  };\n\n  useEffect(() => {\n    if (show) {\n      if (!currentDashboardInfo) {\n        fetchDashboardDetails();\n      } else {\n        handleDashboardData(currentDashboardInfo);\n      }\n    }\n\n    JsonEditor.preload();\n  }, [currentDashboardInfo, fetchDashboardDetails, handleDashboardData, show]);\n\n  useEffect(() => {\n    // the title can be changed inline in the dashboard, this catches it\n    if (\n      dashboardTitle &&\n      dashboardInfo &&\n      dashboardInfo.title !== dashboardTitle\n    ) {\n      form.setFieldsValue({\n        ...dashboardInfo,\n        title: dashboardTitle,\n      });\n    }\n  }, [dashboardInfo, dashboardTitle, form]);\n\n  useEffect(() => {\n    if (!isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM)) return;\n    try {\n      fetchTags(\n        {\n          objectType: OBJECT_TYPES.DASHBOARD,\n          objectId: dashboardId,\n          includeTypes: false,\n        },\n        (tags: TagType[]) => setTags(tags),\n        (error: Response) => {\n          addDangerToast(`Error fetching tags: ${error.text}`);\n        },\n      );\n    } catch (error) {\n      handleErrorResponse(error);\n    }\n  }, [dashboardId]);\n\n  const handleChangeTags = (values: { label: string; value: number }[]) => {\n    // triggered whenever a new tag is selected or a tag was deselected\n    // on new tag selected, add the tag\n\n    const uniqueTags = [...new Set(values.map(v => v.label))];\n    setTags([...uniqueTags.map(t => ({ name: t }))]);\n  };\n\n  return (\n    <Modal\n      show={show}\n      onHide={onHide}\n      title={t('Dashboard properties')}\n      footer={\n        <>\n          <Button\n            htmlType=\"button\"\n            buttonSize=\"small\"\n            onClick={onHide}\n            data-test=\"properties-modal-cancel-button\"\n            cta\n          >\n            {t('Cancel')}\n          </Button>\n          <Button\n            data-test=\"properties-modal-apply-button\"\n            onClick={form.submit}\n            buttonSize=\"small\"\n            buttonStyle=\"primary\"\n            className=\"m-r-5\"\n            cta\n            disabled={dashboardInfo?.isManagedExternally}\n            tooltip={\n              dashboardInfo?.isManagedExternally\n                ? t(\n                    \"This dashboard is managed externally, and can't be edited in Superset\",\n                  )\n                : ''\n            }\n          >\n            {saveLabel}\n          </Button>\n        </>\n      }\n      responsive\n    >\n      <AntdForm\n        form={form}\n        onFinish={onFinish}\n        data-test=\"dashboard-edit-properties-form\"\n        layout=\"vertical\"\n        initialValues={dashboardInfo}\n      >\n        <Row>\n          <Col xs={24} md={24}>\n            <h3>{t('Basic information')}</h3>\n          </Col>\n        </Row>\n        <Row gutter={16}>\n          <Col xs={24} md={12}>\n            <FormItem label={t('Title')} name=\"title\">\n              <Input\n                data-test=\"dashboard-title-input\"\n                type=\"text\"\n                disabled={isLoading}\n              />\n            </FormItem>\n          </Col>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('URL slug')} name=\"slug\">\n              <Input type=\"text\" disabled={isLoading} />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t('A readable URL for your dashboard')}\n            </p>\n          </Col>\n        </Row>\n        {isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC)\n          ? getRowsWithRoles()\n          : getRowsWithoutRoles()}\n        <Row>\n          <Col xs={24} md={24}>\n            <h3>{t('Certification')}</h3>\n          </Col>\n        </Row>\n        <Row gutter={16}>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('Certified by')} name=\"certifiedBy\">\n              <Input type=\"text\" disabled={isLoading} />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t('Person or group that has certified this dashboard.')}\n            </p>\n          </Col>\n          <Col xs={24} md={12}>\n            <StyledFormItem\n              label={t('Certification details')}\n              name=\"certificationDetails\"\n            >\n              <Input type=\"text\" disabled={isLoading} />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t('Any additional detail to show in the certification tooltip.')}\n            </p>\n          </Col>\n        </Row>\n        {isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM) ? (\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              <h3 css={{ marginTop: '1em' }}>{t('Tags')}</h3>\n            </Col>\n          </Row>\n        ) : null}\n        {isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM) ? (\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              <StyledFormItem>\n                <AsyncSelect\n                  ariaLabel=\"Tags\"\n                  mode=\"multiple\"\n                  allowNewOptions\n                  value={tagsAsSelectValues}\n                  options={loadTags}\n                  onChange={handleChangeTags}\n                  allowClear\n                />\n              </StyledFormItem>\n              <p className=\"help-block\">\n                {t('A list of tags that have been applied to this chart.')}\n              </p>\n            </Col>\n          </Row>\n        ) : null}\n        <Row>\n          <Col xs={24} md={24}>\n            <h3 style={{ marginTop: '1em' }}>\n              <Button\n                buttonStyle=\"link\"\n                onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}\n              >\n                <i\n                  className={`fa fa-angle-${isAdvancedOpen ? 'down' : 'right'}`}\n                  style={{ minWidth: '1em' }}\n                />\n                {t('Advanced')}\n              </Button>\n            </h3>\n            {isAdvancedOpen && (\n              <>\n                <StyledFormItem label={t('JSON metadata')}>\n                  <StyledJsonEditor\n                    showLoadingForImport\n                    name=\"json_metadata\"\n                    value={jsonMetadata}\n                    onChange={setJsonMetadata}\n                    tabSize={2}\n                    width=\"100%\"\n                    height=\"200px\"\n                    wrapEnabled\n                  />\n                </StyledFormItem>\n                <p className=\"help-block\">\n                  {t(\n                    'This JSON object is generated dynamically when clicking the save or overwrite button in the dashboard view. It is exposed here for reference and for power users who may want to alter specific parameters.',\n                  )}\n                  {onlyApply && (\n                    <>\n                      {' '}\n                      {t(\n                        'Please DO NOT overwrite the \"filter_scopes\" key.',\n                      )}{' '}\n                      <FilterScopeModal\n                        triggerNode={\n                          <span className=\"alert-link\">\n                            {t('Use \"%(menuName)s\" menu instead.', {\n                              menuName: t('Set filter mapping'),\n                            })}\n                          </span>\n                        }\n                      />\n                    </>\n                  )}\n                </p>\n              </>\n            )}\n          </Col>\n        </Row>\n      </AntdForm>\n    </Modal>\n  );\n};\n\nexport default withToasts(PropertiesModal);\n"]},"metadata":{},"sourceType":"module"}