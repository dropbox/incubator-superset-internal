{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-env browser */\nimport cx from 'classnames';\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { addAlpha, css, FeatureFlag, styled, t, useTheme, useElementOnScreen } from '@superset-ui/core';\nimport { Global } from '@emotion/react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport BuilderComponentPane from 'src/dashboard/components/BuilderComponentPane';\nimport DashboardHeader from 'src/dashboard/containers/DashboardHeader';\nimport Icons from 'src/components/Icons';\nimport IconButton from 'src/dashboard/components/IconButton';\nimport DragDroppable from 'src/dashboard/components/dnd/DragDroppable';\nimport DashboardComponent from 'src/dashboard/containers/DashboardComponent';\nimport WithPopoverMenu from 'src/dashboard/components/menu/WithPopoverMenu';\nimport getDirectPathToTabIndex from 'src/dashboard/util/getDirectPathToTabIndex';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { FilterBarOrientation } from 'src/dashboard/types';\nimport { setDirectPathToChild, setEditMode } from 'src/dashboard/actions/dashboardState';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport { deleteTopLevelTabs, handleComponentDrop } from 'src/dashboard/actions/dashboardLayout';\nimport { DASHBOARD_GRID_ID, DASHBOARD_ROOT_DEPTH, DASHBOARD_ROOT_ID, DashboardStandaloneMode } from 'src/dashboard/util/constants';\nimport FilterBar from 'src/dashboard/components/nativeFilters/FilterBar';\nimport Loading from 'src/components/Loading';\nimport { EmptyStateBig } from 'src/components/EmptyState';\nimport { useUiConfig } from 'src/components/UiConfigContext';\nimport ResizableSidebar from 'src/components/ResizableSidebar';\nimport { BUILDER_SIDEPANEL_WIDTH, CLOSED_FILTER_BAR_WIDTH, FILTER_BAR_HEADER_HEIGHT, FILTER_BAR_TABS_HEIGHT, MAIN_HEADER_HEIGHT, OPEN_FILTER_BAR_MAX_WIDTH, OPEN_FILTER_BAR_WIDTH } from 'src/dashboard/constants';\nimport { getRootLevelTabsComponent, shouldFocusTabs } from './utils';\nimport DashboardContainer from './DashboardContainer';\nimport { useNativeFilters } from './state';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst StyledDiv = styled.div`\n  ${(_ref) => {let { theme } = _ref;return css`\n    display: grid;\n    grid-template-columns: auto 1fr;\n    grid-template-rows: auto 1fr;\n    flex: 1;\n    /* Special cases */\n\n    /* A row within a column has inset hover menu */\n    .dragdroppable-column .dragdroppable-row .hover-menu--left {\n      left: ${theme.gridUnit * -3}px;\n      background: ${theme.colors.grayscale.light5};\n      border: 1px solid ${theme.colors.grayscale.light2};\n    }\n\n    .dashboard-component-tabs {\n      position: relative;\n    }\n\n    /* A column within a column or tabs has inset hover menu */\n    .dragdroppable-column .dragdroppable-column .hover-menu--top,\n    .dashboard-component-tabs .dragdroppable-column .hover-menu--top {\n      top: ${theme.gridUnit * -3}px;\n      background: ${theme.colors.grayscale.light5};\n      border: 1px solid ${theme.colors.grayscale.light2};\n    }\n\n    /* move Tabs hover menu to top near actual Tabs */\n    .dashboard-component-tabs > .hover-menu-container > .hover-menu--left {\n      top: 0;\n      transform: unset;\n      background: transparent;\n    }\n\n    /* push Chart actions to upper right */\n    .dragdroppable-column .dashboard-component-chart-holder .hover-menu--top,\n    .dragdroppable .dashboard-component-header .hover-menu--top {\n      right: ${theme.gridUnit * 2}px;\n      top: ${theme.gridUnit * 2}px;\n      background: transparent;\n      border: none;\n      transform: unset;\n      left: unset;\n    }\n    div:hover > .hover-menu-container .hover-menu,\n    .hover-menu-container .hover-menu:hover {\n      opacity: 1;\n    }\n\n    p {\n      margin: 0 0 ${theme.gridUnit * 2}px 0;\n    }\n\n    i.danger {\n      color: ${theme.colors.error.base};\n    }\n\n    i.warning {\n      color: ${theme.colors.alert.base};\n    }\n  `;}}\n`;\n// @z-index-above-dashboard-charts + 1 = 11\nconst FiltersPanel = styled.div`\n  grid-column: 1;\n  grid-row: 1 / span 2;\n  z-index: 11;\n  width: ${(_ref2) => {let { width } = _ref2;return width;}}px;\n  ${(_ref3) => {let { hidden } = _ref3;return hidden && `display: none;`;}}\n`;\nconst StickyPanel = styled.div`\n  position: sticky;\n  top: -1px;\n  width: ${(_ref4) => {let { width } = _ref4;return width;}}px;\n  flex: 0 0 ${(_ref5) => {let { width } = _ref5;return width;}}px;\n`;\n// @z-index-above-dashboard-popovers (99) + 1 = 100\nconst StyledHeader = styled.div`\n  grid-column: 2;\n  grid-row: 1;\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  max-width: 100vw;\n`;\nconst StyledContent = styled.div`\n  grid-column: 2;\n  grid-row: 2;\n  // @z-index-above-dashboard-header (100) + 1 = 101\n  ${(_ref6) => {let { fullSizeChartId } = _ref6;return fullSizeChartId && `z-index: 101;`;}}\n`;\nconst DashboardContentWrapper = styled.div`\n  ${(_ref7) => {let { theme } = _ref7;return css`\n    &.dashboard {\n      position: relative;\n      flex-grow: 1;\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n\n      /* drop shadow for top-level tabs only */\n      & .dashboard-component-tabs {\n        box-shadow: 0 ${theme.gridUnit}px ${theme.gridUnit}px 0\n          ${addAlpha(theme.colors.grayscale.dark2, parseFloat(theme.opacity.light) / 100)};\n        padding-left: ${theme.gridUnit *\n  2}px; /* note this is added to tab-level padding, to match header */\n      }\n\n      .dropdown-toggle.btn.btn-primary .caret {\n        color: ${theme.colors.grayscale.light5};\n      }\n\n      .background--transparent {\n        background-color: transparent;\n      }\n\n      .background--white {\n        background-color: ${theme.colors.grayscale.light5};\n      }\n    }\n    &.dashboard--editing {\n      .grid-row:after,\n      .dashboard-component-tabs > .hover-menu:hover + div:after {\n        border: 1px dashed transparent;\n        content: '';\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        top: 0;\n        left: 0;\n        z-index: 1;\n        pointer-events: none;\n      }\n\n      .resizable-container {\n        & .dashboard-component-chart-holder {\n          .dashboard-chart {\n            .chart-container {\n              cursor: move;\n              opacity: 0.2;\n            }\n\n            .slice_container {\n              /* disable chart interactions in edit mode */\n              pointer-events: none;\n            }\n          }\n\n          &:hover .dashboard-chart .chart-container {\n            opacity: 0.7;\n          }\n        }\n\n        &:hover,\n        &.resizable-container--resizing:hover {\n          & > .dashboard-component-chart-holder:after {\n            border: 1px dashed ${theme.colors.primary.base};\n          }\n        }\n      }\n\n      .resizable-container--resizing:hover > .grid-row:after,\n      .hover-menu:hover + .grid-row:after,\n      .dashboard-component-tabs > .hover-menu:hover + div:after {\n        border: 1px dashed ${theme.colors.primary.base};\n        z-index: 2;\n      }\n\n      .grid-row:after,\n      .dashboard-component-tabs > .hover-menu + div:after {\n        border: 1px dashed ${theme.colors.grayscale.light2};\n      }\n\n      /* provide hit area in case row contents is edge to edge */\n      .dashboard-component-tabs-content {\n        .dragdroppable-row {\n          padding-top: ${theme.gridUnit * 4}px;\n        }\n\n        & > div:not(:last-child):not(.empty-droptarget) {\n          margin-bottom: ${theme.gridUnit * 4}px;\n        }\n      }\n\n      .dashboard-component-chart-holder {\n        &:after {\n          content: '';\n          position: absolute;\n          width: 100%;\n          height: 100%;\n          top: 0;\n          left: 0;\n          z-index: 1;\n          pointer-events: none;\n          border: 1px solid transparent;\n        }\n\n        &:hover:after {\n          border: 1px dashed ${theme.colors.primary.base};\n          z-index: 2;\n        }\n      }\n\n      .contract-trigger:before {\n        display: none;\n      }\n    }\n\n    & .dashboard-component-tabs-content {\n      & > div:not(:last-child):not(.empty-droptarget) {\n        margin-bottom: ${theme.gridUnit * 4}px;\n      }\n\n      & > .empty-droptarget {\n        position: absolute;\n        width: 100%;\n      }\n\n      & > .empty-droptarget:first-child {\n        height: ${theme.gridUnit * 4}px;\n        top: -2px;\n        z-index: 10;\n      }\n\n      & > .empty-droptarget:last-child {\n        height: ${theme.gridUnit * 3}px;\n        bottom: 0;\n      }\n    }\n\n    .empty-droptarget:first-child .drop-indicator--bottom {\n      top: ${theme.gridUnit * 6}px;\n    }\n  `;}}\n`;\nconst StyledDashboardContent = styled.div`\n  ${(_ref8) => {let { theme, editMode, marginLeft } = _ref8;return css`\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    height: auto;\n    flex: 1;\n\n    .grid-container .dashboard-component-tabs {\n      box-shadow: none;\n      padding-left: 0;\n    }\n\n    .grid-container {\n      /* without this, the grid will not get smaller upon toggling the builder panel on */\n      width: 0;\n      flex: 1;\n      position: relative;\n      margin-top: ${theme.gridUnit * 6}px;\n      margin-right: ${theme.gridUnit * 8}px;\n      margin-bottom: ${theme.gridUnit * 6}px;\n      margin-left: ${marginLeft}px;\n\n      ${editMode &&\n  `\n      max-width: calc(100% - ${BUILDER_SIDEPANEL_WIDTH + theme.gridUnit * 16}px);\n    `}\n\n      /* this is the ParentSize wrapper */\n    & > div:first-child {\n        height: inherit !important;\n      }\n    }\n\n    .dashboard-builder-sidepane {\n      width: ${BUILDER_SIDEPANEL_WIDTH}px;\n      z-index: 1;\n    }\n\n    .dashboard-component-chart-holder {\n      width: 100%;\n      height: 100%;\n      background-color: ${theme.colors.grayscale.light5};\n      position: relative;\n      padding: ${theme.gridUnit * 4}px;\n      overflow-y: visible;\n\n      // transitionable traits to show filter relevance\n      transition: opacity ${theme.transitionTiming}s ease-in-out,\n        border-color ${theme.transitionTiming}s ease-in-out,\n        box-shadow ${theme.transitionTiming}s ease-in-out;\n\n      &.fade-in {\n        border-radius: ${theme.borderRadius}px;\n        box-shadow: inset 0 0 0 2px ${theme.colors.primary.base},\n          0 0 0 3px\n            ${addAlpha(theme.colors.primary.base, parseFloat(theme.opacity.light) / 100)};\n      }\n\n      &.fade-out {\n        border-radius: ${theme.borderRadius}px;\n        box-shadow: none;\n      }\n\n      & .missing-chart-container {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        overflow-y: auto;\n        justify-content: center;\n\n        .missing-chart-body {\n          font-size: ${theme.typography.sizes.s}px;\n          position: relative;\n          display: flex;\n        }\n      }\n    }\n  `;}}\n`;\nconst DashboardBuilder = () => {var _dashboardLayout$DASH, _dashboardLayout$DASH2;\n  const dispatch = useDispatch();\n  const uiConfig = useUiConfig();\n  const theme = useTheme();\n  const dashboardId = useSelector((_ref9) => {let { dashboardInfo } = _ref9;return `${dashboardInfo.id}`;});\n  const dashboardLayout = useSelector((state) => state.dashboardLayout.present);\n  const editMode = useSelector((state) => state.dashboardState.editMode);\n  const canEdit = useSelector((_ref10) => {let { dashboardInfo } = _ref10;return dashboardInfo.dash_edit_perm;});\n  const dashboardIsSaving = useSelector((_ref11) => {let { dashboardState } = _ref11;return dashboardState.dashboardIsSaving;});\n  const fullSizeChartId = useSelector((state) => state.dashboardState.fullSizeChartId);\n  const crossFiltersEnabled = isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS);\n  const filterBarOrientation = useSelector((_ref12) => {let { dashboardInfo } = _ref12;return isFeatureEnabled(FeatureFlag.HORIZONTAL_FILTER_BAR) ?\n    dashboardInfo.filterBarOrientation :\n    FilterBarOrientation.VERTICAL;});\n  const handleChangeTab = useCallback((_ref13) => {let { pathToTabIndex } = _ref13;\n    dispatch(setDirectPathToChild(pathToTabIndex));\n  }, [dispatch]);\n  const handleDeleteTopLevelTabs = useCallback(() => {\n    dispatch(deleteTopLevelTabs());\n    const firstTab = getDirectPathToTabIndex(getRootLevelTabsComponent(dashboardLayout), 0);\n    dispatch(setDirectPathToChild(firstTab));\n  }, [dashboardLayout, dispatch]);\n  const handleDrop = useCallback((dropResult) => dispatch(handleComponentDrop(dropResult)), [dispatch]);\n  const headerRef = React.useRef(null);\n  const dashboardRoot = dashboardLayout[DASHBOARD_ROOT_ID];\n  const rootChildId = dashboardRoot == null ? void 0 : dashboardRoot.children[0];\n  const topLevelTabs = rootChildId !== DASHBOARD_GRID_ID ?\n  dashboardLayout[rootChildId] :\n  undefined;\n  const standaloneMode = getUrlParam(URL_PARAMS.standalone);\n  const isReport = standaloneMode === DashboardStandaloneMode.REPORT;\n  const hideDashboardHeader = uiConfig.hideTitle ||\n  standaloneMode === DashboardStandaloneMode.HIDE_NAV_AND_TITLE ||\n  isReport;\n  const [barTopOffset, setBarTopOffset] = useState(0);\n  useEffect(() => {var _headerRef$current, _headerRef$current$ge;\n    setBarTopOffset(((_headerRef$current = headerRef.current) == null ? void 0 : (_headerRef$current$ge = _headerRef$current.getBoundingClientRect()) == null ? void 0 : _headerRef$current$ge.height) || 0);\n    let observer;\n    if (global.hasOwnProperty('ResizeObserver') && headerRef.current) {\n      observer = new ResizeObserver((entries) => {\n        setBarTopOffset((current) => {var _entries$, _entries$$contentRect;return (entries == null ? void 0 : (_entries$ = entries[0]) == null ? void 0 : (_entries$$contentRect = _entries$.contentRect) == null ? void 0 : _entries$$contentRect.height) || current;});\n      });\n      observer.observe(headerRef.current);\n    }\n    return () => {var _observer;\n      (_observer = observer) == null ? void 0 : _observer.disconnect();\n    };\n  }, []);\n  const { showDashboard, dashboardFiltersOpen, toggleDashboardFiltersOpen, nativeFiltersEnabled } = useNativeFilters();\n  const [containerRef, isSticky] = useElementOnScreen({\n    threshold: [1] });\n\n  const filterSetEnabled = isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS_SET);\n  const showFilterBar = (crossFiltersEnabled || nativeFiltersEnabled) && !editMode;\n  const offset = FILTER_BAR_HEADER_HEIGHT + (\n  isSticky || standaloneMode ? 0 : MAIN_HEADER_HEIGHT) + (\n  filterSetEnabled ? FILTER_BAR_TABS_HEIGHT : 0);\n  const filterBarHeight = `calc(100vh - ${offset}px)`;\n  const filterBarOffset = dashboardFiltersOpen ? 0 : barTopOffset + 20;\n  const draggableStyle = useMemo(() => ({\n    marginLeft: dashboardFiltersOpen ||\n    editMode ||\n    !nativeFiltersEnabled ||\n    filterBarOrientation === FilterBarOrientation.HORIZONTAL ?\n    0 :\n    -32 }),\n  [\n  dashboardFiltersOpen,\n  editMode,\n  filterBarOrientation,\n  nativeFiltersEnabled]);\n\n  // If a new tab was added, update the directPathToChild to reflect it\n  const currentTopLevelTabs = useRef(topLevelTabs);\n  useEffect(() => {var _currentTopLevelTabs$, _currentTopLevelTabs$2, _topLevelTabs$childre;\n    const currentTabsLength = (_currentTopLevelTabs$ = currentTopLevelTabs.current) == null ? void 0 : (_currentTopLevelTabs$2 = _currentTopLevelTabs$.children) == null ? void 0 : _currentTopLevelTabs$2.length;\n    const newTabsLength = topLevelTabs == null ? void 0 : (_topLevelTabs$childre = topLevelTabs.children) == null ? void 0 : _topLevelTabs$childre.length;\n    if (currentTabsLength !== undefined &&\n    newTabsLength !== undefined &&\n    newTabsLength > currentTabsLength) {\n      const lastTab = getDirectPathToTabIndex(getRootLevelTabsComponent(dashboardLayout), newTabsLength - 1);\n      dispatch(setDirectPathToChild(lastTab));\n    }\n    currentTopLevelTabs.current = topLevelTabs;\n  }, [topLevelTabs]);\n  const renderDraggableContent = useCallback((_ref14) => {let { dropIndicatorProps } = _ref14;return ___EmotionJSX(\"div\", null,\n    !hideDashboardHeader && ___EmotionJSX(DashboardHeader, null),\n    showFilterBar &&\n    filterBarOrientation === FilterBarOrientation.HORIZONTAL && ___EmotionJSX(FilterBar, { orientation: FilterBarOrientation.HORIZONTAL, hidden: isReport }),\n    dropIndicatorProps && ___EmotionJSX(\"div\", dropIndicatorProps),\n    !isReport && topLevelTabs && !uiConfig.hideNav && ___EmotionJSX(WithPopoverMenu, { shouldFocus: shouldFocusTabs, menuItems: [\n      ___EmotionJSX(IconButton, { icon: ___EmotionJSX(Icons.FallOutlined, { iconSize: \"xl\" }), label: t('Collapse tab content'), onClick: handleDeleteTopLevelTabs })],\n      editMode: editMode },\n\n    ___EmotionJSX(DashboardComponent, { id: topLevelTabs == null ? void 0 : topLevelTabs.id, parentId: DASHBOARD_ROOT_ID, depth: DASHBOARD_ROOT_DEPTH + 1, index: 0, renderTabContent: false, renderHoverMenu: false, onChangeTab: handleChangeTab })));},\n\n  [\n  nativeFiltersEnabled,\n  filterBarOrientation,\n  editMode,\n  handleChangeTab,\n  handleDeleteTopLevelTabs,\n  hideDashboardHeader,\n  isReport,\n  topLevelTabs,\n  uiConfig.hideNav]);\n\n  const dashboardContentMarginLeft = !dashboardFiltersOpen &&\n  !editMode &&\n  nativeFiltersEnabled &&\n  filterBarOrientation !== FilterBarOrientation.HORIZONTAL ?\n  0 :\n  theme.gridUnit * 8;\n  return ___EmotionJSX(StyledDiv, null,\n  showFilterBar && filterBarOrientation === FilterBarOrientation.VERTICAL && ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(ResizableSidebar, { id: `dashboard:${dashboardId}`, enable: dashboardFiltersOpen, minWidth: OPEN_FILTER_BAR_WIDTH, maxWidth: OPEN_FILTER_BAR_MAX_WIDTH, initialWidth: OPEN_FILTER_BAR_WIDTH },\n  (adjustedWidth) => {\n    const filterBarWidth = dashboardFiltersOpen ?\n    adjustedWidth :\n    CLOSED_FILTER_BAR_WIDTH;\n    return ___EmotionJSX(FiltersPanel, { width: filterBarWidth, hidden: isReport, \"data-test\": \"dashboard-filters-panel\" },\n    ___EmotionJSX(StickyPanel, { ref: containerRef, width: filterBarWidth },\n    ___EmotionJSX(ErrorBoundary, null,\n    ___EmotionJSX(FilterBar, { orientation: FilterBarOrientation.VERTICAL, verticalConfig: {\n        filtersOpen: dashboardFiltersOpen,\n        toggleFiltersBar: toggleDashboardFiltersOpen,\n        width: filterBarWidth,\n        height: filterBarHeight,\n        offset: filterBarOffset } }))));\n\n\n\n\n  })),\n\n\n  ___EmotionJSX(StyledHeader, { ref: headerRef },\n\n  ___EmotionJSX(DragDroppable, { \"data-test\": \"top-level-tabs\", component: dashboardRoot, parentComponent: null, depth: DASHBOARD_ROOT_DEPTH, index: 0, orientation: \"column\", onDrop: handleDrop, editMode: editMode\n    // you cannot drop on/displace tabs if they already exist\n    , disableDragDrop: !!topLevelTabs, style: draggableStyle },\n  renderDraggableContent)),\n\n\n  ___EmotionJSX(StyledContent, { fullSizeChartId: fullSizeChartId },\n  ___EmotionJSX(Global, { styles: css`\n            // @z-index-above-dashboard-header (100) + 1 = 101\n            ${fullSizeChartId &&\n    `div > .filterStatusPopover.ant-popover{z-index: 101}`}\n          ` }),\n  !editMode &&\n  !topLevelTabs &&\n  ((_dashboardLayout$DASH = dashboardLayout[DASHBOARD_GRID_ID]) == null ? void 0 : (_dashboardLayout$DASH2 = _dashboardLayout$DASH.children) == null ? void 0 : _dashboardLayout$DASH2.length) === 0 && ___EmotionJSX(EmptyStateBig, { title: t('There are no charts added to this dashboard'), description: canEdit &&\n    t('Go to the edit mode to configure the dashboard and add charts'), buttonText: canEdit && t('Edit the dashboard'), buttonAction: () => dispatch(setEditMode(true)), image: \"dashboard.svg\" }),\n  ___EmotionJSX(DashboardContentWrapper, { \"data-test\": \"dashboard-content-wrapper\", className: cx('dashboard', editMode && 'dashboard--editing') },\n  ___EmotionJSX(StyledDashboardContent, { className: \"dashboard-content\", editMode: editMode, marginLeft: dashboardContentMarginLeft },\n  showDashboard ? ___EmotionJSX(DashboardContainer, { topLevelTabs: topLevelTabs }) : ___EmotionJSX(Loading, null),\n  editMode && ___EmotionJSX(BuilderComponentPane, { topOffset: barTopOffset })))),\n\n\n\n  dashboardIsSaving && ___EmotionJSX(Loading, { css: css`\n            && {\n              position: fixed;\n            }\n          ` }));\n\n};__signature__(DashboardBuilder, \"useDispatch{dispatch}\\nuseUiConfig{uiConfig}\\nuseTheme{theme}\\nuseSelector{dashboardId}\\nuseSelector{dashboardLayout}\\nuseSelector{editMode}\\nuseSelector{canEdit}\\nuseSelector{dashboardIsSaving}\\nuseSelector{fullSizeChartId}\\nuseSelector{filterBarOrientation}\\nuseCallback{handleChangeTab}\\nuseCallback{handleDeleteTopLevelTabs}\\nuseCallback{handleDrop}\\nuseRef{headerRef}\\nuseState{[barTopOffset, setBarTopOffset](0)}\\nuseEffect{}\\nuseNativeFilters{{ showDashboard, dashboardFiltersOpen, toggleDashboardFiltersOpen, nativeFiltersEnabled, }}\\nuseElementOnScreen{[containerRef, isSticky]}\\nuseMemo{draggableStyle}\\nuseRef{currentTopLevelTabs}\\nuseEffect{}\\nuseCallback{renderDraggableContent}\", () => [useDispatch, useUiConfig, useTheme, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useSelector, useNativeFilters, useElementOnScreen]);const _default =\nDashboardBuilder;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(StyledDiv, \"StyledDiv\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(FiltersPanel, \"FiltersPanel\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(StickyPanel, \"StickyPanel\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(StyledHeader, \"StyledHeader\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(StyledContent, \"StyledContent\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(DashboardContentWrapper, \"DashboardContentWrapper\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(StyledDashboardContent, \"StyledDashboardContent\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(DashboardBuilder, \"DashboardBuilder\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"mappings":"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","names":["cx","React","useCallback","useEffect","useMemo","useRef","useState","addAlpha","css","FeatureFlag","styled","t","useTheme","useElementOnScreen","Global","useDispatch","useSelector","ErrorBoundary","BuilderComponentPane","DashboardHeader","Icons","IconButton","DragDroppable","DashboardComponent","WithPopoverMenu","getDirectPathToTabIndex","URL_PARAMS","getUrlParam","FilterBarOrientation","setDirectPathToChild","setEditMode","isFeatureEnabled","deleteTopLevelTabs","handleComponentDrop","DASHBOARD_GRID_ID","DASHBOARD_ROOT_DEPTH","DASHBOARD_ROOT_ID","DashboardStandaloneMode","FilterBar","Loading","EmptyStateBig","useUiConfig","ResizableSidebar","BUILDER_SIDEPANEL_WIDTH","CLOSED_FILTER_BAR_WIDTH","FILTER_BAR_HEADER_HEIGHT","FILTER_BAR_TABS_HEIGHT","MAIN_HEADER_HEIGHT","OPEN_FILTER_BAR_MAX_WIDTH","OPEN_FILTER_BAR_WIDTH","getRootLevelTabsComponent","shouldFocusTabs","DashboardContainer","useNativeFilters","StyledDiv","div","theme","gridUnit","colors","grayscale","light5","light2","error","base","alert","FiltersPanel","width","hidden","StickyPanel","StyledHeader","StyledContent","fullSizeChartId","DashboardContentWrapper","dark2","parseFloat","opacity","light","primary","StyledDashboardContent","editMode","marginLeft","transitionTiming","borderRadius","typography","sizes","s","DashboardBuilder","dispatch","uiConfig","dashboardId","dashboardInfo","id","dashboardLayout","state","present","dashboardState","canEdit","dash_edit_perm","dashboardIsSaving","crossFiltersEnabled","DASHBOARD_CROSS_FILTERS","filterBarOrientation","HORIZONTAL_FILTER_BAR","VERTICAL","handleChangeTab","pathToTabIndex","handleDeleteTopLevelTabs","firstTab","handleDrop","dropResult","headerRef","dashboardRoot","rootChildId","children","topLevelTabs","undefined","standaloneMode","standalone","isReport","REPORT","hideDashboardHeader","hideTitle","HIDE_NAV_AND_TITLE","barTopOffset","setBarTopOffset","current","getBoundingClientRect","height","observer","global","hasOwnProperty","ResizeObserver","contentRect","observe","disconnect","showDashboard","dashboardFiltersOpen","toggleDashboardFiltersOpen","nativeFiltersEnabled","containerRef","isSticky","threshold","filterSetEnabled","DASHBOARD_NATIVE_FILTERS_SET","showFilterBar","offset","filterBarHeight","filterBarOffset","draggableStyle","HORIZONTAL","currentTopLevelTabs","currentTabsLength","length","newTabsLength","lastTab","renderDraggableContent","dropIndicatorProps","hideNav","dashboardContentMarginLeft","filterBarWidth","adjustedWidth","filtersOpen","toggleFiltersBar"],"sourceRoot":"","sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/DashboardBuilder.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-env browser */\nimport cx from 'classnames';\nimport React, {\n  FC,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport {\n  addAlpha,\n  css,\n  FeatureFlag,\n  JsonObject,\n  styled,\n  t,\n  useTheme,\n  useElementOnScreen,\n} from '@superset-ui/core';\nimport { Global } from '@emotion/react';\nimport { useDispatch, useSelector } from 'react-redux';\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport BuilderComponentPane from 'src/dashboard/components/BuilderComponentPane';\nimport DashboardHeader from 'src/dashboard/containers/DashboardHeader';\nimport Icons from 'src/components/Icons';\nimport IconButton from 'src/dashboard/components/IconButton';\nimport DragDroppable from 'src/dashboard/components/dnd/DragDroppable';\nimport DashboardComponent from 'src/dashboard/containers/DashboardComponent';\nimport WithPopoverMenu from 'src/dashboard/components/menu/WithPopoverMenu';\nimport getDirectPathToTabIndex from 'src/dashboard/util/getDirectPathToTabIndex';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport {\n  DashboardLayout,\n  FilterBarOrientation,\n  RootState,\n} from 'src/dashboard/types';\nimport {\n  setDirectPathToChild,\n  setEditMode,\n} from 'src/dashboard/actions/dashboardState';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport {\n  deleteTopLevelTabs,\n  handleComponentDrop,\n} from 'src/dashboard/actions/dashboardLayout';\nimport {\n  DASHBOARD_GRID_ID,\n  DASHBOARD_ROOT_DEPTH,\n  DASHBOARD_ROOT_ID,\n  DashboardStandaloneMode,\n} from 'src/dashboard/util/constants';\nimport FilterBar from 'src/dashboard/components/nativeFilters/FilterBar';\nimport Loading from 'src/components/Loading';\nimport { EmptyStateBig } from 'src/components/EmptyState';\nimport { useUiConfig } from 'src/components/UiConfigContext';\nimport ResizableSidebar from 'src/components/ResizableSidebar';\nimport {\n  BUILDER_SIDEPANEL_WIDTH,\n  CLOSED_FILTER_BAR_WIDTH,\n  FILTER_BAR_HEADER_HEIGHT,\n  FILTER_BAR_TABS_HEIGHT,\n  MAIN_HEADER_HEIGHT,\n  OPEN_FILTER_BAR_MAX_WIDTH,\n  OPEN_FILTER_BAR_WIDTH,\n} from 'src/dashboard/constants';\nimport { getRootLevelTabsComponent, shouldFocusTabs } from './utils';\nimport DashboardContainer from './DashboardContainer';\nimport { useNativeFilters } from './state';\n\ntype DashboardBuilderProps = {};\n\nconst StyledDiv = styled.div`\n  ${({ theme }) => css`\n    display: grid;\n    grid-template-columns: auto 1fr;\n    grid-template-rows: auto 1fr;\n    flex: 1;\n    /* Special cases */\n\n    /* A row within a column has inset hover menu */\n    .dragdroppable-column .dragdroppable-row .hover-menu--left {\n      left: ${theme.gridUnit * -3}px;\n      background: ${theme.colors.grayscale.light5};\n      border: 1px solid ${theme.colors.grayscale.light2};\n    }\n\n    .dashboard-component-tabs {\n      position: relative;\n    }\n\n    /* A column within a column or tabs has inset hover menu */\n    .dragdroppable-column .dragdroppable-column .hover-menu--top,\n    .dashboard-component-tabs .dragdroppable-column .hover-menu--top {\n      top: ${theme.gridUnit * -3}px;\n      background: ${theme.colors.grayscale.light5};\n      border: 1px solid ${theme.colors.grayscale.light2};\n    }\n\n    /* move Tabs hover menu to top near actual Tabs */\n    .dashboard-component-tabs > .hover-menu-container > .hover-menu--left {\n      top: 0;\n      transform: unset;\n      background: transparent;\n    }\n\n    /* push Chart actions to upper right */\n    .dragdroppable-column .dashboard-component-chart-holder .hover-menu--top,\n    .dragdroppable .dashboard-component-header .hover-menu--top {\n      right: ${theme.gridUnit * 2}px;\n      top: ${theme.gridUnit * 2}px;\n      background: transparent;\n      border: none;\n      transform: unset;\n      left: unset;\n    }\n    div:hover > .hover-menu-container .hover-menu,\n    .hover-menu-container .hover-menu:hover {\n      opacity: 1;\n    }\n\n    p {\n      margin: 0 0 ${theme.gridUnit * 2}px 0;\n    }\n\n    i.danger {\n      color: ${theme.colors.error.base};\n    }\n\n    i.warning {\n      color: ${theme.colors.alert.base};\n    }\n  `}\n`;\n\n// @z-index-above-dashboard-charts + 1 = 11\nconst FiltersPanel = styled.div<{ width: number; hidden: boolean }>`\n  grid-column: 1;\n  grid-row: 1 / span 2;\n  z-index: 11;\n  width: ${({ width }) => width}px;\n  ${({ hidden }) => hidden && `display: none;`}\n`;\n\nconst StickyPanel = styled.div<{ width: number }>`\n  position: sticky;\n  top: -1px;\n  width: ${({ width }) => width}px;\n  flex: 0 0 ${({ width }) => width}px;\n`;\n\n// @z-index-above-dashboard-popovers (99) + 1 = 100\nconst StyledHeader = styled.div`\n  grid-column: 2;\n  grid-row: 1;\n  position: sticky;\n  top: 0;\n  z-index: 100;\n  max-width: 100vw;\n`;\n\nconst StyledContent = styled.div<{\n  fullSizeChartId: number | null;\n}>`\n  grid-column: 2;\n  grid-row: 2;\n  // @z-index-above-dashboard-header (100) + 1 = 101\n  ${({ fullSizeChartId }) => fullSizeChartId && `z-index: 101;`}\n`;\n\nconst DashboardContentWrapper = styled.div`\n  ${({ theme }) => css`\n    &.dashboard {\n      position: relative;\n      flex-grow: 1;\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n\n      /* drop shadow for top-level tabs only */\n      & .dashboard-component-tabs {\n        box-shadow: 0 ${theme.gridUnit}px ${theme.gridUnit}px 0\n          ${addAlpha(\n            theme.colors.grayscale.dark2,\n            parseFloat(theme.opacity.light) / 100,\n          )};\n        padding-left: ${theme.gridUnit *\n        2}px; /* note this is added to tab-level padding, to match header */\n      }\n\n      .dropdown-toggle.btn.btn-primary .caret {\n        color: ${theme.colors.grayscale.light5};\n      }\n\n      .background--transparent {\n        background-color: transparent;\n      }\n\n      .background--white {\n        background-color: ${theme.colors.grayscale.light5};\n      }\n    }\n    &.dashboard--editing {\n      .grid-row:after,\n      .dashboard-component-tabs > .hover-menu:hover + div:after {\n        border: 1px dashed transparent;\n        content: '';\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        top: 0;\n        left: 0;\n        z-index: 1;\n        pointer-events: none;\n      }\n\n      .resizable-container {\n        & .dashboard-component-chart-holder {\n          .dashboard-chart {\n            .chart-container {\n              cursor: move;\n              opacity: 0.2;\n            }\n\n            .slice_container {\n              /* disable chart interactions in edit mode */\n              pointer-events: none;\n            }\n          }\n\n          &:hover .dashboard-chart .chart-container {\n            opacity: 0.7;\n          }\n        }\n\n        &:hover,\n        &.resizable-container--resizing:hover {\n          & > .dashboard-component-chart-holder:after {\n            border: 1px dashed ${theme.colors.primary.base};\n          }\n        }\n      }\n\n      .resizable-container--resizing:hover > .grid-row:after,\n      .hover-menu:hover + .grid-row:after,\n      .dashboard-component-tabs > .hover-menu:hover + div:after {\n        border: 1px dashed ${theme.colors.primary.base};\n        z-index: 2;\n      }\n\n      .grid-row:after,\n      .dashboard-component-tabs > .hover-menu + div:after {\n        border: 1px dashed ${theme.colors.grayscale.light2};\n      }\n\n      /* provide hit area in case row contents is edge to edge */\n      .dashboard-component-tabs-content {\n        .dragdroppable-row {\n          padding-top: ${theme.gridUnit * 4}px;\n        }\n\n        & > div:not(:last-child):not(.empty-droptarget) {\n          margin-bottom: ${theme.gridUnit * 4}px;\n        }\n      }\n\n      .dashboard-component-chart-holder {\n        &:after {\n          content: '';\n          position: absolute;\n          width: 100%;\n          height: 100%;\n          top: 0;\n          left: 0;\n          z-index: 1;\n          pointer-events: none;\n          border: 1px solid transparent;\n        }\n\n        &:hover:after {\n          border: 1px dashed ${theme.colors.primary.base};\n          z-index: 2;\n        }\n      }\n\n      .contract-trigger:before {\n        display: none;\n      }\n    }\n\n    & .dashboard-component-tabs-content {\n      & > div:not(:last-child):not(.empty-droptarget) {\n        margin-bottom: ${theme.gridUnit * 4}px;\n      }\n\n      & > .empty-droptarget {\n        position: absolute;\n        width: 100%;\n      }\n\n      & > .empty-droptarget:first-child {\n        height: ${theme.gridUnit * 4}px;\n        top: -2px;\n        z-index: 10;\n      }\n\n      & > .empty-droptarget:last-child {\n        height: ${theme.gridUnit * 3}px;\n        bottom: 0;\n      }\n    }\n\n    .empty-droptarget:first-child .drop-indicator--bottom {\n      top: ${theme.gridUnit * 6}px;\n    }\n  `}\n`;\n\nconst StyledDashboardContent = styled.div<{\n  editMode: boolean;\n  marginLeft: number;\n}>`\n  ${({ theme, editMode, marginLeft }) => css`\n    display: flex;\n    flex-direction: row;\n    flex-wrap: nowrap;\n    height: auto;\n    flex: 1;\n\n    .grid-container .dashboard-component-tabs {\n      box-shadow: none;\n      padding-left: 0;\n    }\n\n    .grid-container {\n      /* without this, the grid will not get smaller upon toggling the builder panel on */\n      width: 0;\n      flex: 1;\n      position: relative;\n      margin-top: ${theme.gridUnit * 6}px;\n      margin-right: ${theme.gridUnit * 8}px;\n      margin-bottom: ${theme.gridUnit * 6}px;\n      margin-left: ${marginLeft}px;\n\n      ${editMode &&\n      `\n      max-width: calc(100% - ${\n        BUILDER_SIDEPANEL_WIDTH + theme.gridUnit * 16\n      }px);\n    `}\n\n      /* this is the ParentSize wrapper */\n    & > div:first-child {\n        height: inherit !important;\n      }\n    }\n\n    .dashboard-builder-sidepane {\n      width: ${BUILDER_SIDEPANEL_WIDTH}px;\n      z-index: 1;\n    }\n\n    .dashboard-component-chart-holder {\n      width: 100%;\n      height: 100%;\n      background-color: ${theme.colors.grayscale.light5};\n      position: relative;\n      padding: ${theme.gridUnit * 4}px;\n      overflow-y: visible;\n\n      // transitionable traits to show filter relevance\n      transition: opacity ${theme.transitionTiming}s ease-in-out,\n        border-color ${theme.transitionTiming}s ease-in-out,\n        box-shadow ${theme.transitionTiming}s ease-in-out;\n\n      &.fade-in {\n        border-radius: ${theme.borderRadius}px;\n        box-shadow: inset 0 0 0 2px ${theme.colors.primary.base},\n          0 0 0 3px\n            ${addAlpha(\n              theme.colors.primary.base,\n              parseFloat(theme.opacity.light) / 100,\n            )};\n      }\n\n      &.fade-out {\n        border-radius: ${theme.borderRadius}px;\n        box-shadow: none;\n      }\n\n      & .missing-chart-container {\n        display: flex;\n        flex-direction: column;\n        align-items: center;\n        overflow-y: auto;\n        justify-content: center;\n\n        .missing-chart-body {\n          font-size: ${theme.typography.sizes.s}px;\n          position: relative;\n          display: flex;\n        }\n      }\n    }\n  `}\n`;\n\nconst DashboardBuilder: FC<DashboardBuilderProps> = () => {\n  const dispatch = useDispatch();\n  const uiConfig = useUiConfig();\n  const theme = useTheme();\n\n  const dashboardId = useSelector<RootState, string>(\n    ({ dashboardInfo }) => `${dashboardInfo.id}`,\n  );\n  const dashboardLayout = useSelector<RootState, DashboardLayout>(\n    state => state.dashboardLayout.present,\n  );\n  const editMode = useSelector<RootState, boolean>(\n    state => state.dashboardState.editMode,\n  );\n  const canEdit = useSelector<RootState, boolean>(\n    ({ dashboardInfo }) => dashboardInfo.dash_edit_perm,\n  );\n  const dashboardIsSaving = useSelector<RootState, boolean>(\n    ({ dashboardState }) => dashboardState.dashboardIsSaving,\n  );\n  const fullSizeChartId = useSelector<RootState, number | null>(\n    state => state.dashboardState.fullSizeChartId,\n  );\n  const crossFiltersEnabled = isFeatureEnabled(\n    FeatureFlag.DASHBOARD_CROSS_FILTERS,\n  );\n  const filterBarOrientation = useSelector<RootState, FilterBarOrientation>(\n    ({ dashboardInfo }) =>\n      isFeatureEnabled(FeatureFlag.HORIZONTAL_FILTER_BAR)\n        ? dashboardInfo.filterBarOrientation\n        : FilterBarOrientation.VERTICAL,\n  );\n\n  const handleChangeTab = useCallback(\n    ({ pathToTabIndex }: { pathToTabIndex: string[] }) => {\n      dispatch(setDirectPathToChild(pathToTabIndex));\n    },\n    [dispatch],\n  );\n\n  const handleDeleteTopLevelTabs = useCallback(() => {\n    dispatch(deleteTopLevelTabs());\n\n    const firstTab = getDirectPathToTabIndex(\n      getRootLevelTabsComponent(dashboardLayout),\n      0,\n    );\n    dispatch(setDirectPathToChild(firstTab));\n  }, [dashboardLayout, dispatch]);\n\n  const handleDrop = useCallback(\n    dropResult => dispatch(handleComponentDrop(dropResult)),\n    [dispatch],\n  );\n\n  const headerRef = React.useRef<HTMLDivElement>(null);\n  const dashboardRoot = dashboardLayout[DASHBOARD_ROOT_ID];\n  const rootChildId = dashboardRoot?.children[0];\n  const topLevelTabs =\n    rootChildId !== DASHBOARD_GRID_ID\n      ? dashboardLayout[rootChildId]\n      : undefined;\n  const standaloneMode = getUrlParam(URL_PARAMS.standalone);\n  const isReport = standaloneMode === DashboardStandaloneMode.REPORT;\n  const hideDashboardHeader =\n    uiConfig.hideTitle ||\n    standaloneMode === DashboardStandaloneMode.HIDE_NAV_AND_TITLE ||\n    isReport;\n\n  const [barTopOffset, setBarTopOffset] = useState(0);\n\n  useEffect(() => {\n    setBarTopOffset(headerRef.current?.getBoundingClientRect()?.height || 0);\n\n    let observer: ResizeObserver;\n    if (global.hasOwnProperty('ResizeObserver') && headerRef.current) {\n      observer = new ResizeObserver(entries => {\n        setBarTopOffset(\n          current => entries?.[0]?.contentRect?.height || current,\n        );\n      });\n\n      observer.observe(headerRef.current);\n    }\n\n    return () => {\n      observer?.disconnect();\n    };\n  }, []);\n\n  const {\n    showDashboard,\n    dashboardFiltersOpen,\n    toggleDashboardFiltersOpen,\n    nativeFiltersEnabled,\n  } = useNativeFilters();\n\n  const [containerRef, isSticky] = useElementOnScreen<HTMLDivElement>({\n    threshold: [1],\n  });\n\n  const filterSetEnabled = isFeatureEnabled(\n    FeatureFlag.DASHBOARD_NATIVE_FILTERS_SET,\n  );\n  const showFilterBar =\n    (crossFiltersEnabled || nativeFiltersEnabled) && !editMode;\n\n  const offset =\n    FILTER_BAR_HEADER_HEIGHT +\n    (isSticky || standaloneMode ? 0 : MAIN_HEADER_HEIGHT) +\n    (filterSetEnabled ? FILTER_BAR_TABS_HEIGHT : 0);\n\n  const filterBarHeight = `calc(100vh - ${offset}px)`;\n  const filterBarOffset = dashboardFiltersOpen ? 0 : barTopOffset + 20;\n\n  const draggableStyle = useMemo(\n    () => ({\n      marginLeft:\n        dashboardFiltersOpen ||\n        editMode ||\n        !nativeFiltersEnabled ||\n        filterBarOrientation === FilterBarOrientation.HORIZONTAL\n          ? 0\n          : -32,\n    }),\n    [\n      dashboardFiltersOpen,\n      editMode,\n      filterBarOrientation,\n      nativeFiltersEnabled,\n    ],\n  );\n\n  // If a new tab was added, update the directPathToChild to reflect it\n  const currentTopLevelTabs = useRef(topLevelTabs);\n  useEffect(() => {\n    const currentTabsLength = currentTopLevelTabs.current?.children?.length;\n    const newTabsLength = topLevelTabs?.children?.length;\n\n    if (\n      currentTabsLength !== undefined &&\n      newTabsLength !== undefined &&\n      newTabsLength > currentTabsLength\n    ) {\n      const lastTab = getDirectPathToTabIndex(\n        getRootLevelTabsComponent(dashboardLayout),\n        newTabsLength - 1,\n      );\n      dispatch(setDirectPathToChild(lastTab));\n    }\n\n    currentTopLevelTabs.current = topLevelTabs;\n  }, [topLevelTabs]);\n\n  const renderDraggableContent = useCallback(\n    ({ dropIndicatorProps }: { dropIndicatorProps: JsonObject }) => (\n      <div>\n        {!hideDashboardHeader && <DashboardHeader />}\n        {showFilterBar &&\n          filterBarOrientation === FilterBarOrientation.HORIZONTAL && (\n            <FilterBar\n              orientation={FilterBarOrientation.HORIZONTAL}\n              hidden={isReport}\n            />\n          )}\n        {dropIndicatorProps && <div {...dropIndicatorProps} />}\n        {!isReport && topLevelTabs && !uiConfig.hideNav && (\n          <WithPopoverMenu\n            shouldFocus={shouldFocusTabs}\n            menuItems={[\n              <IconButton\n                icon={<Icons.FallOutlined iconSize=\"xl\" />}\n                label={t('Collapse tab content')}\n                onClick={handleDeleteTopLevelTabs}\n              />,\n            ]}\n            editMode={editMode}\n          >\n            {/* @ts-ignore */}\n            <DashboardComponent\n              id={topLevelTabs?.id}\n              parentId={DASHBOARD_ROOT_ID}\n              depth={DASHBOARD_ROOT_DEPTH + 1}\n              index={0}\n              renderTabContent={false}\n              renderHoverMenu={false}\n              onChangeTab={handleChangeTab}\n            />\n          </WithPopoverMenu>\n        )}\n      </div>\n    ),\n    [\n      nativeFiltersEnabled,\n      filterBarOrientation,\n      editMode,\n      handleChangeTab,\n      handleDeleteTopLevelTabs,\n      hideDashboardHeader,\n      isReport,\n      topLevelTabs,\n      uiConfig.hideNav,\n    ],\n  );\n\n  const dashboardContentMarginLeft =\n    !dashboardFiltersOpen &&\n    !editMode &&\n    nativeFiltersEnabled &&\n    filterBarOrientation !== FilterBarOrientation.HORIZONTAL\n      ? 0\n      : theme.gridUnit * 8;\n\n  return (\n    <StyledDiv>\n      {showFilterBar && filterBarOrientation === FilterBarOrientation.VERTICAL && (\n        <>\n          <ResizableSidebar\n            id={`dashboard:${dashboardId}`}\n            enable={dashboardFiltersOpen}\n            minWidth={OPEN_FILTER_BAR_WIDTH}\n            maxWidth={OPEN_FILTER_BAR_MAX_WIDTH}\n            initialWidth={OPEN_FILTER_BAR_WIDTH}\n          >\n            {adjustedWidth => {\n              const filterBarWidth = dashboardFiltersOpen\n                ? adjustedWidth\n                : CLOSED_FILTER_BAR_WIDTH;\n              return (\n                <FiltersPanel\n                  width={filterBarWidth}\n                  hidden={isReport}\n                  data-test=\"dashboard-filters-panel\"\n                >\n                  <StickyPanel ref={containerRef} width={filterBarWidth}>\n                    <ErrorBoundary>\n                      <FilterBar\n                        orientation={FilterBarOrientation.VERTICAL}\n                        verticalConfig={{\n                          filtersOpen: dashboardFiltersOpen,\n                          toggleFiltersBar: toggleDashboardFiltersOpen,\n                          width: filterBarWidth,\n                          height: filterBarHeight,\n                          offset: filterBarOffset,\n                        }}\n                      />\n                    </ErrorBoundary>\n                  </StickyPanel>\n                </FiltersPanel>\n              );\n            }}\n          </ResizableSidebar>\n        </>\n      )}\n      <StyledHeader ref={headerRef}>\n        {/* @ts-ignore */}\n        <DragDroppable\n          data-test=\"top-level-tabs\"\n          component={dashboardRoot}\n          parentComponent={null}\n          depth={DASHBOARD_ROOT_DEPTH}\n          index={0}\n          orientation=\"column\"\n          onDrop={handleDrop}\n          editMode={editMode}\n          // you cannot drop on/displace tabs if they already exist\n          disableDragDrop={!!topLevelTabs}\n          style={draggableStyle}\n        >\n          {renderDraggableContent}\n        </DragDroppable>\n      </StyledHeader>\n      <StyledContent fullSizeChartId={fullSizeChartId}>\n        <Global\n          styles={css`\n            // @z-index-above-dashboard-header (100) + 1 = 101\n            ${fullSizeChartId &&\n            `div > .filterStatusPopover.ant-popover{z-index: 101}`}\n          `}\n        />\n        {!editMode &&\n          !topLevelTabs &&\n          dashboardLayout[DASHBOARD_GRID_ID]?.children?.length === 0 && (\n            <EmptyStateBig\n              title={t('There are no charts added to this dashboard')}\n              description={\n                canEdit &&\n                t(\n                  'Go to the edit mode to configure the dashboard and add charts',\n                )\n              }\n              buttonText={canEdit && t('Edit the dashboard')}\n              buttonAction={() => dispatch(setEditMode(true))}\n              image=\"dashboard.svg\"\n            />\n          )}\n        <DashboardContentWrapper\n          data-test=\"dashboard-content-wrapper\"\n          className={cx('dashboard', editMode && 'dashboard--editing')}\n        >\n          <StyledDashboardContent\n            className=\"dashboard-content\"\n            editMode={editMode}\n            marginLeft={dashboardContentMarginLeft}\n          >\n            {showDashboard ? (\n              <DashboardContainer topLevelTabs={topLevelTabs} />\n            ) : (\n              <Loading />\n            )}\n            {editMode && <BuilderComponentPane topOffset={barTopOffset} />}\n          </StyledDashboardContent>\n        </DashboardContentWrapper>\n      </StyledContent>\n      {dashboardIsSaving && (\n        <Loading\n          css={css`\n            && {\n              position: fixed;\n            }\n          `}\n        />\n      )}\n    </StyledDiv>\n  );\n};\n\nexport default DashboardBuilder;\n"]},"metadata":{},"sourceType":"module"}