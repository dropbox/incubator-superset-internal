{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable react/sort-prop-types */\nimport dt from 'datatables.net-bs';\nimport PropTypes from 'prop-types';\nimport {\ngetTimeFormatter,\ngetTimeFormatterForGranularity,\nsmartDateFormatter } from\n'@superset-ui/core';\nimport { formatCellValue, formatDateCellValue } from './utils/formatCells';\nimport fixTableHeight from './utils/fixTableHeight';\nimport 'datatables.net-bs/css/dataTables.bootstrap.css';\n\nif (window.$) {\n  dt(window, window.$);\n}\nconst $ = window.$ || dt.$;\n\nconst propTypes = {\n  data: PropTypes.shape({\n    // TODO: replace this with raw data in SIP-6\n    html: PropTypes.string,\n    columns: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.arrayOf(PropTypes.string)])) }),\n\n\n\n  height: PropTypes.number,\n  columnFormats: PropTypes.objectOf(PropTypes.string),\n  numberFormat: PropTypes.string,\n  numGroups: PropTypes.number,\n  verboseMap: PropTypes.objectOf(PropTypes.string) };\n\n\nconst hasOnlyTextChild = (node) =>\nnode.childNodes.length === 1 &&\nnode.childNodes[0].nodeType === Node.TEXT_NODE;\n\nfunction PivotTable(element, props) {\n  const {\n    columnFormats,\n    data,\n    dateFormat,\n    granularity,\n    height,\n    numberFormat,\n    numGroups,\n    verboseMap } =\n  props;\n\n  const { html, columns } = data;\n  const container = element;\n  const $container = $(element);\n  let dateFormatter;\n\n  if (dateFormat === smartDateFormatter.id && granularity) {\n    dateFormatter = getTimeFormatterForGranularity(granularity);\n  } else if (dateFormat) {\n    dateFormatter = getTimeFormatter(dateFormat);\n  } else {\n    dateFormatter = String;\n  }\n\n  // queryData data is a string of html with a single table element\n  container.innerHTML = html;\n\n  const cols = Array.isArray(columns[0]) ? columns.map((col) => col[0]) : columns;\n  const dateRegex = /^__timestamp:(-?\\d*\\.?\\d*)$/;\n\n  $container.find('th').each(function formatTh() {\n    if (hasOnlyTextChild(this)) {\n      const cellValue = formatDateCellValue(\n      $(this).text(),\n      verboseMap,\n      dateRegex,\n      dateFormatter);\n\n      $(this).text(cellValue);\n    }\n  });\n\n  $container.find('tbody tr').each(function eachRow() {\n    $(this).\n    find('td').\n    each(function eachTd(index) {\n      if (hasOnlyTextChild(this)) {\n        const tdText = $(this).text();\n        const { textContent, sortAttributeValue } = formatCellValue(\n        index,\n        cols,\n        tdText,\n        columnFormats,\n        numberFormat,\n        dateRegex,\n        dateFormatter);\n\n        $(this).text(textContent);\n        $(this).attr('data-sort', sortAttributeValue);\n      }\n    });\n  });\n\n  $container.find('table').each(function fullWidth() {\n    this.style = 'width: 100%';\n  });\n\n  if (numGroups === 1) {\n    // When there is only 1 group by column,\n    // we use the DataTable plugin to make the header fixed.\n    // The plugin takes care of the scrolling so we don't need\n    // overflow: 'auto' on the table.\n    container.style.overflow = 'hidden';\n    const table = $container.find('table').DataTable({\n      paging: false,\n      searching: false,\n      bInfo: false,\n      scrollY: `${height}px`,\n      scrollCollapse: true,\n      scrollX: true });\n\n    table.column('-1').order('desc').draw();\n    fixTableHeight($container.find('.dataTables_wrapper'), height);\n  } else {\n    // When there is more than 1 group by column we just render the table, without using\n    // the DataTable plugin, so we need to handle the scrolling ourselves.\n    // In this case the header is not fixed.\n    container.style.overflow = 'auto';\n    container.style.height = `${height + 10}px`;\n  }\n}\n\nPivotTable.displayName = 'PivotTable';\nPivotTable.propTypes = propTypes;const _default =\n\nPivotTable;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register($, \"$\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-pivot-table/src/PivotTable.js\");reactHotLoader.register(propTypes, \"propTypes\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-pivot-table/src/PivotTable.js\");reactHotLoader.register(hasOnlyTextChild, \"hasOnlyTextChild\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-pivot-table/src/PivotTable.js\");reactHotLoader.register(PivotTable, \"PivotTable\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-pivot-table/src/PivotTable.js\");reactHotLoader.register(_default, \"default\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-pivot-table/src/PivotTable.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["dt","PropTypes","getTimeFormatter","getTimeFormatterForGranularity","smartDateFormatter","formatCellValue","formatDateCellValue","fixTableHeight","window","$","propTypes","data","shape","html","string","columns","arrayOf","oneOfType","height","number","columnFormats","objectOf","numberFormat","numGroups","verboseMap","hasOnlyTextChild","node","childNodes","length","nodeType","Node","TEXT_NODE","PivotTable","element","props","dateFormat","granularity","container","$container","dateFormatter","id","String","innerHTML","cols","Array","isArray","map","col","dateRegex","find","each","formatTh","cellValue","text","eachRow","eachTd","index","tdText","textContent","sortAttributeValue","attr","fullWidth","style","overflow","table","DataTable","paging","searching","bInfo","scrollY","scrollCollapse","scrollX","column","order","draw","displayName"],"sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-pivot-table/src/PivotTable.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable react/sort-prop-types */\nimport dt from 'datatables.net-bs';\nimport PropTypes from 'prop-types';\nimport {\n  getTimeFormatter,\n  getTimeFormatterForGranularity,\n  smartDateFormatter,\n} from '@superset-ui/core';\nimport { formatCellValue, formatDateCellValue } from './utils/formatCells';\nimport fixTableHeight from './utils/fixTableHeight';\nimport 'datatables.net-bs/css/dataTables.bootstrap.css';\n\nif (window.$) {\n  dt(window, window.$);\n}\nconst $ = window.$ || dt.$;\n\nconst propTypes = {\n  data: PropTypes.shape({\n    // TODO: replace this with raw data in SIP-6\n    html: PropTypes.string,\n    columns: PropTypes.arrayOf(\n      PropTypes.oneOfType([\n        PropTypes.string,\n        PropTypes.arrayOf(PropTypes.string),\n      ]),\n    ),\n  }),\n  height: PropTypes.number,\n  columnFormats: PropTypes.objectOf(PropTypes.string),\n  numberFormat: PropTypes.string,\n  numGroups: PropTypes.number,\n  verboseMap: PropTypes.objectOf(PropTypes.string),\n};\n\nconst hasOnlyTextChild = node =>\n  node.childNodes.length === 1 &&\n  node.childNodes[0].nodeType === Node.TEXT_NODE;\n\nfunction PivotTable(element, props) {\n  const {\n    columnFormats,\n    data,\n    dateFormat,\n    granularity,\n    height,\n    numberFormat,\n    numGroups,\n    verboseMap,\n  } = props;\n\n  const { html, columns } = data;\n  const container = element;\n  const $container = $(element);\n  let dateFormatter;\n\n  if (dateFormat === smartDateFormatter.id && granularity) {\n    dateFormatter = getTimeFormatterForGranularity(granularity);\n  } else if (dateFormat) {\n    dateFormatter = getTimeFormatter(dateFormat);\n  } else {\n    dateFormatter = String;\n  }\n\n  // queryData data is a string of html with a single table element\n  container.innerHTML = html;\n\n  const cols = Array.isArray(columns[0]) ? columns.map(col => col[0]) : columns;\n  const dateRegex = /^__timestamp:(-?\\d*\\.?\\d*)$/;\n\n  $container.find('th').each(function formatTh() {\n    if (hasOnlyTextChild(this)) {\n      const cellValue = formatDateCellValue(\n        $(this).text(),\n        verboseMap,\n        dateRegex,\n        dateFormatter,\n      );\n      $(this).text(cellValue);\n    }\n  });\n\n  $container.find('tbody tr').each(function eachRow() {\n    $(this)\n      .find('td')\n      .each(function eachTd(index) {\n        if (hasOnlyTextChild(this)) {\n          const tdText = $(this).text();\n          const { textContent, sortAttributeValue } = formatCellValue(\n            index,\n            cols,\n            tdText,\n            columnFormats,\n            numberFormat,\n            dateRegex,\n            dateFormatter,\n          );\n          $(this).text(textContent);\n          $(this).attr('data-sort', sortAttributeValue);\n        }\n      });\n  });\n\n  $container.find('table').each(function fullWidth() {\n    this.style = 'width: 100%';\n  });\n\n  if (numGroups === 1) {\n    // When there is only 1 group by column,\n    // we use the DataTable plugin to make the header fixed.\n    // The plugin takes care of the scrolling so we don't need\n    // overflow: 'auto' on the table.\n    container.style.overflow = 'hidden';\n    const table = $container.find('table').DataTable({\n      paging: false,\n      searching: false,\n      bInfo: false,\n      scrollY: `${height}px`,\n      scrollCollapse: true,\n      scrollX: true,\n    });\n    table.column('-1').order('desc').draw();\n    fixTableHeight($container.find('.dataTables_wrapper'), height);\n  } else {\n    // When there is more than 1 group by column we just render the table, without using\n    // the DataTable plugin, so we need to handle the scrolling ourselves.\n    // In this case the header is not fixed.\n    container.style.overflow = 'auto';\n    container.style.height = `${height + 10}px`;\n  }\n}\n\nPivotTable.displayName = 'PivotTable';\nPivotTable.propTypes = propTypes;\n\nexport default PivotTable;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}