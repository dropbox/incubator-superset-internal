{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useMemo, useRef } from 'react';\nimport { Global } from '@emotion/react';\nimport { useHistory } from 'react-router-dom';\nimport { CategoricalColorNamespace, FeatureFlag, getSharedLabelColor, isFeatureEnabled, SharedLabelColorSource, t, useTheme } from '@superset-ui/core';\nimport pick from 'lodash/pick';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useToasts } from 'src/components/MessageToasts/withToasts';\nimport Loading from 'src/components/Loading';\nimport { useDashboard, useDashboardCharts, useDashboardDatasets } from 'src/hooks/apiResources';\nimport { hydrateDashboard } from 'src/dashboard/actions/hydrate';\nimport { setDatasources } from 'src/dashboard/actions/datasources';\nimport injectCustomCss from 'src/dashboard/util/injectCustomCss';\nimport setupPlugins from 'src/setup/setupPlugins';\nimport { getItem, LocalStorageKeys, setItem } from 'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { getFilterSets } from 'src/dashboard/actions/nativeFilters';\nimport { setDatasetsStatus } from 'src/dashboard/actions/dashboardState';\nimport { getFilterValue, getPermalinkValue } from 'src/dashboard/components/nativeFilters/FilterBar/keyValue';\nimport shortid from 'shortid';\nimport { getActiveFilters } from '../util/activeDashboardFilters';\nimport { chartContextMenuStyles, filterCardPopoverStyle, headerStyles } from '../styles';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nexport const DashboardPageIdContext = /*#__PURE__*/React.createContext('');\nsetupPlugins();\nconst DashboardContainer = /*#__PURE__*/React.lazy(() => import(\n/* webpackChunkName: \"DashboardContainer\" */\n/* webpackPreload: true */\n'src/dashboard/containers/Dashboard'));\nconst originalDocumentTitle = document.title;\nconst getDashboardContextLocalStorage = () => {\n  const dashboardsContexts = getItem(LocalStorageKeys.dashboard__explore_context, {});\n  // A new dashboard tab id is generated on each dashboard page opening.\n  // We mark ids as redundant when user leaves the dashboard, because they won't be reused.\n  // Then we remove redundant dashboard contexts from local storage in order not to clutter it\n  return Object.fromEntries(Object.entries(dashboardsContexts).filter((_ref) => {let [, value] = _ref;return !value.isRedundant;}));\n};\nconst updateDashboardTabLocalStorage = (dashboardPageId, dashboardContext) => {\n  const dashboardsContexts = getDashboardContextLocalStorage();\n  setItem(LocalStorageKeys.dashboard__explore_context, {\n    ...dashboardsContexts,\n    [dashboardPageId]: dashboardContext });\n\n};\nconst useSyncDashboardStateWithLocalStorage = () => {\n  const dashboardPageId = useMemo(() => shortid.generate(), []);\n  const dashboardContextForExplore = useSelector((_ref2) => {var _dashboardInfo$metada, _dashboardInfo$metada2, _dashboardInfo$metada3;let { dashboardInfo, dashboardState, nativeFilters, dataMask } = _ref2;return {\n      labelColors: ((_dashboardInfo$metada = dashboardInfo.metadata) == null ? void 0 : _dashboardInfo$metada.label_colors) || {},\n      sharedLabelColors: ((_dashboardInfo$metada2 = dashboardInfo.metadata) == null ? void 0 : _dashboardInfo$metada2.shared_label_colors) || {},\n      colorScheme: dashboardState == null ? void 0 : dashboardState.colorScheme,\n      chartConfiguration: ((_dashboardInfo$metada3 = dashboardInfo.metadata) == null ? void 0 : _dashboardInfo$metada3.chart_configuration) || {},\n      nativeFilters: Object.entries(nativeFilters.filters).reduce((acc, _ref3) => {let [key, filterValue] = _ref3;return {\n          ...acc,\n          [key]: pick(filterValue, ['chartsInScope']) };},\n      {}),\n      dataMask,\n      dashboardId: dashboardInfo.id,\n      filterBoxFilters: getActiveFilters(),\n      dashboardPageId };});\n\n  useEffect(() => {\n    updateDashboardTabLocalStorage(dashboardPageId, dashboardContextForExplore);\n    return () => {\n      // mark tab id as redundant when dashboard unmounts - case when user opens\n      // Explore in the same tab\n      updateDashboardTabLocalStorage(dashboardPageId, {\n        ...dashboardContextForExplore,\n        isRedundant: true });\n\n    };\n  }, [dashboardContextForExplore, dashboardPageId]);\n  return dashboardPageId;\n};__signature__(useSyncDashboardStateWithLocalStorage, \"useMemo{dashboardPageId}\\nuseSelector{dashboardContextForExplore}\\nuseEffect{}\", () => [useSelector]);\nexport const DashboardPage = (_ref4) => {let { idOrSlug } = _ref4;\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const history = useHistory();\n  const dashboardPageId = useSyncDashboardStateWithLocalStorage();\n  const { addDangerToast } = useToasts();\n  const { result: dashboard, error: dashboardApiError } = useDashboard(idOrSlug);\n  const { result: charts, error: chartsApiError } = useDashboardCharts(idOrSlug);\n  const { result: datasets, error: datasetsApiError, status } = useDashboardDatasets(idOrSlug);\n  const isDashboardHydrated = useRef(false);\n  const error = dashboardApiError || chartsApiError;\n  const readyToRender = Boolean(dashboard && charts);\n  const { dashboard_title, css, metadata, id = 0 } = dashboard || {};\n  useEffect(() => {\n    // mark tab id as redundant when user closes browser tab - a new id will be\n    // generated next time user opens a dashboard and the old one won't be reused\n    const handleTabClose = () => {\n      const dashboardsContexts = getDashboardContextLocalStorage();\n      setItem(LocalStorageKeys.dashboard__explore_context, {\n        ...dashboardsContexts,\n        [dashboardPageId]: {\n          ...dashboardsContexts[dashboardPageId],\n          isRedundant: true } });\n\n\n    };\n    window.addEventListener('beforeunload', handleTabClose);\n    return () => {\n      window.removeEventListener('beforeunload', handleTabClose);\n    };\n  }, [dashboardPageId]);\n  useEffect(() => {\n    dispatch(setDatasetsStatus(status));\n  }, [dispatch, status]);\n  useEffect(() => {\n    // eslint-disable-next-line consistent-return\n    async function getDataMaskApplied() {\n      const permalinkKey = getUrlParam(URL_PARAMS.permalinkKey);\n      const nativeFilterKeyValue = getUrlParam(URL_PARAMS.nativeFiltersKey);\n      const isOldRison = getUrlParam(URL_PARAMS.nativeFilters);\n      let dataMask = nativeFilterKeyValue || {};\n      // activeTabs is initialized with undefined so that it doesn't override\n      // the currently stored value when hydrating\n      let activeTabs;\n      if (permalinkKey) {\n        const permalinkValue = await getPermalinkValue(permalinkKey);\n        if (permalinkValue) {\n          ({ dataMask, activeTabs } = permalinkValue.state);\n        }\n      } else\n      if (nativeFilterKeyValue) {\n        dataMask = await getFilterValue(id, nativeFilterKeyValue);\n      }\n      if (isOldRison) {\n        dataMask = isOldRison;\n      }\n      if (readyToRender) {\n        if (!isDashboardHydrated.current) {\n          isDashboardHydrated.current = true;\n          if (isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS_SET)) {\n            // only initialize filterset once\n            dispatch(getFilterSets(id));\n          }\n        }\n        dispatch(hydrateDashboard({\n          history,\n          dashboard,\n          charts,\n          activeTabs,\n          dataMask }));\n\n      }\n      return null;\n    }\n    if (id)\n    getDataMaskApplied();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [readyToRender]);\n  useEffect(() => {\n    if (dashboard_title) {\n      document.title = dashboard_title;\n    }\n    return () => {\n      document.title = originalDocumentTitle;\n    };\n  }, [dashboard_title]);\n  useEffect(() => {\n    if (typeof css === 'string') {\n      // returning will clean up custom css\n      // when dashboard unmounts or changes\n      return injectCustomCss(css);\n    }\n    return () => {};\n  }, [css]);\n  useEffect(() => {\n    const sharedLabelColor = getSharedLabelColor();\n    sharedLabelColor.source = SharedLabelColorSource.dashboard;\n    return () => {\n      // clean up label color\n      const categoricalNamespace = CategoricalColorNamespace.getNamespace(metadata == null ? void 0 : metadata.color_namespace);\n      categoricalNamespace.resetColors();\n      sharedLabelColor.clear();\n    };\n  }, [metadata == null ? void 0 : metadata.color_namespace]);\n  useEffect(() => {\n    if (datasetsApiError) {\n      addDangerToast(t('Error loading chart datasources. Filters may not work correctly.'));\n    } else\n    {\n      dispatch(setDatasources(datasets));\n    }\n  }, [addDangerToast, datasets, datasetsApiError, dispatch]);\n  if (error)\n  throw error; // caught in error boundary\n  if (!readyToRender || !isDashboardHydrated.current)\n  return ___EmotionJSX(Loading, null);\n  return ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(Global, { styles: [\n    filterCardPopoverStyle(theme),\n    headerStyles(theme),\n    chartContextMenuStyles(theme), process.env.NODE_ENV === \"production\" ? \"\" : \";label:DashboardPage;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9ib2dkYW5reXJ5bGl1ay9jb2RlL29wZW5zb3VyY2Uvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2Rhc2hib2FyZC9jb250YWluZXJzL0Rhc2hib2FyZFBhZ2UudHN4Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQStNYyIsImZpbGUiOiIvVXNlcnMvYm9nZGFua3lyeWxpdWsvY29kZS9vcGVuc291cmNlL3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3NyYy9kYXNoYm9hcmQvY29udGFpbmVycy9EYXNoYm9hcmRQYWdlLnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCBSZWFjdCwgeyB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVJlZiB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IEdsb2JhbCB9IGZyb20gJ0BlbW90aW9uL3JlYWN0JztcbmltcG9ydCB7IHVzZUhpc3RvcnkgfSBmcm9tICdyZWFjdC1yb3V0ZXItZG9tJztcbmltcG9ydCB7IENhdGVnb3JpY2FsQ29sb3JOYW1lc3BhY2UsIEZlYXR1cmVGbGFnLCBnZXRTaGFyZWRMYWJlbENvbG9yLCBpc0ZlYXR1cmVFbmFibGVkLCBTaGFyZWRMYWJlbENvbG9yU291cmNlLCB0LCB1c2VUaGVtZSwgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgcGljayBmcm9tICdsb2Rhc2gvcGljayc7XG5pbXBvcnQgeyB1c2VEaXNwYXRjaCwgdXNlU2VsZWN0b3IgfSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQgeyB1c2VUb2FzdHMgfSBmcm9tICdzcmMvY29tcG9uZW50cy9NZXNzYWdlVG9hc3RzL3dpdGhUb2FzdHMnO1xuaW1wb3J0IExvYWRpbmcgZnJvbSAnc3JjL2NvbXBvbmVudHMvTG9hZGluZyc7XG5pbXBvcnQgeyB1c2VEYXNoYm9hcmQsIHVzZURhc2hib2FyZENoYXJ0cywgdXNlRGFzaGJvYXJkRGF0YXNldHMsIH0gZnJvbSAnc3JjL2hvb2tzL2FwaVJlc291cmNlcyc7XG5pbXBvcnQgeyBoeWRyYXRlRGFzaGJvYXJkIH0gZnJvbSAnc3JjL2Rhc2hib2FyZC9hY3Rpb25zL2h5ZHJhdGUnO1xuaW1wb3J0IHsgc2V0RGF0YXNvdXJjZXMgfSBmcm9tICdzcmMvZGFzaGJvYXJkL2FjdGlvbnMvZGF0YXNvdXJjZXMnO1xuaW1wb3J0IGluamVjdEN1c3RvbUNzcyBmcm9tICdzcmMvZGFzaGJvYXJkL3V0aWwvaW5qZWN0Q3VzdG9tQ3NzJztcbmltcG9ydCBzZXR1cFBsdWdpbnMgZnJvbSAnc3JjL3NldHVwL3NldHVwUGx1Z2lucyc7XG5pbXBvcnQgeyBnZXRJdGVtLCBMb2NhbFN0b3JhZ2VLZXlzLCBzZXRJdGVtLCB9IGZyb20gJ3NyYy91dGlscy9sb2NhbFN0b3JhZ2VIZWxwZXJzJztcbmltcG9ydCB7IFVSTF9QQVJBTVMgfSBmcm9tICdzcmMvY29uc3RhbnRzJztcbmltcG9ydCB7IGdldFVybFBhcmFtIH0gZnJvbSAnc3JjL3V0aWxzL3VybFV0aWxzJztcbmltcG9ydCB7IGdldEZpbHRlclNldHMgfSBmcm9tICdzcmMvZGFzaGJvYXJkL2FjdGlvbnMvbmF0aXZlRmlsdGVycyc7XG5pbXBvcnQgeyBzZXREYXRhc2V0c1N0YXR1cyB9IGZyb20gJ3NyYy9kYXNoYm9hcmQvYWN0aW9ucy9kYXNoYm9hcmRTdGF0ZSc7XG5pbXBvcnQgeyBnZXRGaWx0ZXJWYWx1ZSwgZ2V0UGVybWFsaW5rVmFsdWUsIH0gZnJvbSAnc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL25hdGl2ZUZpbHRlcnMvRmlsdGVyQmFyL2tleVZhbHVlJztcbmltcG9ydCBzaG9ydGlkIGZyb20gJ3Nob3J0aWQnO1xuaW1wb3J0IHsgZ2V0QWN0aXZlRmlsdGVycyB9IGZyb20gJy4uL3V0aWwvYWN0aXZlRGFzaGJvYXJkRmlsdGVycyc7XG5pbXBvcnQgeyBjaGFydENvbnRleHRNZW51U3R5bGVzLCBmaWx0ZXJDYXJkUG9wb3ZlclN0eWxlLCBoZWFkZXJTdHlsZXMsIH0gZnJvbSAnLi4vc3R5bGVzJztcbmV4cG9ydCBjb25zdCBEYXNoYm9hcmRQYWdlSWRDb250ZXh0ID0gUmVhY3QuY3JlYXRlQ29udGV4dCgnJyk7XG5zZXR1cFBsdWdpbnMoKTtcbmNvbnN0IERhc2hib2FyZENvbnRhaW5lciA9IFJlYWN0LmxhenkoKCkgPT4gaW1wb3J0KFxuLyogd2VicGFja0NodW5rTmFtZTogXCJEYXNoYm9hcmRDb250YWluZXJcIiAqL1xuLyogd2VicGFja1ByZWxvYWQ6IHRydWUgKi9cbidzcmMvZGFzaGJvYXJkL2NvbnRhaW5lcnMvRGFzaGJvYXJkJykpO1xuY29uc3Qgb3JpZ2luYWxEb2N1bWVudFRpdGxlID0gZG9jdW1lbnQudGl0bGU7XG5jb25zdCBnZXREYXNoYm9hcmRDb250ZXh0TG9jYWxTdG9yYWdlID0gKCkgPT4ge1xuICAgIGNvbnN0IGRhc2hib2FyZHNDb250ZXh0cyA9IGdldEl0ZW0oTG9jYWxTdG9yYWdlS2V5cy5kYXNoYm9hcmRfX2V4cGxvcmVfY29udGV4dCwge30pO1xuICAgIC8vIEEgbmV3IGRhc2hib2FyZCB0YWIgaWQgaXMgZ2VuZXJhdGVkIG9uIGVhY2ggZGFzaGJvYXJkIHBhZ2Ugb3BlbmluZy5cbiAgICAvLyBXZSBtYXJrIGlkcyBhcyByZWR1bmRhbnQgd2hlbiB1c2VyIGxlYXZlcyB0aGUgZGFzaGJvYXJkLCBiZWNhdXNlIHRoZXkgd29uJ3QgYmUgcmV1c2VkLlxuICAgIC8vIFRoZW4gd2UgcmVtb3ZlIHJlZHVuZGFudCBkYXNoYm9hcmQgY29udGV4dHMgZnJvbSBsb2NhbCBzdG9yYWdlIGluIG9yZGVyIG5vdCB0byBjbHV0dGVyIGl0XG4gICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhPYmplY3QuZW50cmllcyhkYXNoYm9hcmRzQ29udGV4dHMpLmZpbHRlcigoWywgdmFsdWVdKSA9PiAhdmFsdWUuaXNSZWR1bmRhbnQpKTtcbn07XG5jb25zdCB1cGRhdGVEYXNoYm9hcmRUYWJMb2NhbFN0b3JhZ2UgPSAoZGFzaGJvYXJkUGFnZUlkLCBkYXNoYm9hcmRDb250ZXh0KSA9PiB7XG4gICAgY29uc3QgZGFzaGJvYXJkc0NvbnRleHRzID0gZ2V0RGFzaGJvYXJkQ29udGV4dExvY2FsU3RvcmFnZSgpO1xuICAgIHNldEl0ZW0oTG9jYWxTdG9yYWdlS2V5cy5kYXNoYm9hcmRfX2V4cGxvcmVfY29udGV4dCwge1xuICAgICAgICAuLi5kYXNoYm9hcmRzQ29udGV4dHMsXG4gICAgICAgIFtkYXNoYm9hcmRQYWdlSWRdOiBkYXNoYm9hcmRDb250ZXh0LFxuICAgIH0pO1xufTtcbmNvbnN0IHVzZVN5bmNEYXNoYm9hcmRTdGF0ZVdpdGhMb2NhbFN0b3JhZ2UgPSAoKSA9PiB7XG4gICAgY29uc3QgZGFzaGJvYXJkUGFnZUlkID0gdXNlTWVtbygoKSA9PiBzaG9ydGlkLmdlbmVyYXRlKCksIFtdKTtcbiAgICBjb25zdCBkYXNoYm9hcmRDb250ZXh0Rm9yRXhwbG9yZSA9IHVzZVNlbGVjdG9yKCh7IGRhc2hib2FyZEluZm8sIGRhc2hib2FyZFN0YXRlLCBuYXRpdmVGaWx0ZXJzLCBkYXRhTWFzayB9KSA9PiAoe1xuICAgICAgICBsYWJlbENvbG9yczogZGFzaGJvYXJkSW5mby5tZXRhZGF0YT8ubGFiZWxfY29sb3JzIHx8IHt9LFxuICAgICAgICBzaGFyZWRMYWJlbENvbG9yczogZGFzaGJvYXJkSW5mby5tZXRhZGF0YT8uc2hhcmVkX2xhYmVsX2NvbG9ycyB8fCB7fSxcbiAgICAgICAgY29sb3JTY2hlbWU6IGRhc2hib2FyZFN0YXRlPy5jb2xvclNjaGVtZSxcbiAgICAgICAgY2hhcnRDb25maWd1cmF0aW9uOiBkYXNoYm9hcmRJbmZvLm1ldGFkYXRhPy5jaGFydF9jb25maWd1cmF0aW9uIHx8IHt9LFxuICAgICAgICBuYXRpdmVGaWx0ZXJzOiBPYmplY3QuZW50cmllcyhuYXRpdmVGaWx0ZXJzLmZpbHRlcnMpLnJlZHVjZSgoYWNjLCBba2V5LCBmaWx0ZXJWYWx1ZV0pID0+ICh7XG4gICAgICAgICAgICAuLi5hY2MsXG4gICAgICAgICAgICBba2V5XTogcGljayhmaWx0ZXJWYWx1ZSwgWydjaGFydHNJblNjb3BlJ10pLFxuICAgICAgICB9KSwge30pLFxuICAgICAgICBkYXRhTWFzayxcbiAgICAgICAgZGFzaGJvYXJkSWQ6IGRhc2hib2FyZEluZm8uaWQsXG4gICAgICAgIGZpbHRlckJveEZpbHRlcnM6IGdldEFjdGl2ZUZpbHRlcnMoKSxcbiAgICAgICAgZGFzaGJvYXJkUGFnZUlkLFxuICAgIH0pKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICB1cGRhdGVEYXNoYm9hcmRUYWJMb2NhbFN0b3JhZ2UoZGFzaGJvYXJkUGFnZUlkLCBkYXNoYm9hcmRDb250ZXh0Rm9yRXhwbG9yZSk7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICAvLyBtYXJrIHRhYiBpZCBhcyByZWR1bmRhbnQgd2hlbiBkYXNoYm9hcmQgdW5tb3VudHMgLSBjYXNlIHdoZW4gdXNlciBvcGVuc1xuICAgICAgICAgICAgLy8gRXhwbG9yZSBpbiB0aGUgc2FtZSB0YWJcbiAgICAgICAgICAgIHVwZGF0ZURhc2hib2FyZFRhYkxvY2FsU3RvcmFnZShkYXNoYm9hcmRQYWdlSWQsIHtcbiAgICAgICAgICAgICAgICAuLi5kYXNoYm9hcmRDb250ZXh0Rm9yRXhwbG9yZSxcbiAgICAgICAgICAgICAgICBpc1JlZHVuZGFudDogdHJ1ZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgIH0sIFtkYXNoYm9hcmRDb250ZXh0Rm9yRXhwbG9yZSwgZGFzaGJvYXJkUGFnZUlkXSk7XG4gICAgcmV0dXJuIGRhc2hib2FyZFBhZ2VJZDtcbn07XG5leHBvcnQgY29uc3QgRGFzaGJvYXJkUGFnZSA9ICh7IGlkT3JTbHVnIH0pID0+IHtcbiAgICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKCk7XG4gICAgY29uc3QgZGlzcGF0Y2ggPSB1c2VEaXNwYXRjaCgpO1xuICAgIGNvbnN0IGhpc3RvcnkgPSB1c2VIaXN0b3J5KCk7XG4gICAgY29uc3QgZGFzaGJvYXJkUGFnZUlkID0gdXNlU3luY0Rhc2hib2FyZFN0YXRlV2l0aExvY2FsU3RvcmFnZSgpO1xuICAgIGNvbnN0IHsgYWRkRGFuZ2VyVG9hc3QgfSA9IHVzZVRvYXN0cygpO1xuICAgIGNvbnN0IHsgcmVzdWx0OiBkYXNoYm9hcmQsIGVycm9yOiBkYXNoYm9hcmRBcGlFcnJvciB9ID0gdXNlRGFzaGJvYXJkKGlkT3JTbHVnKTtcbiAgICBjb25zdCB7IHJlc3VsdDogY2hhcnRzLCBlcnJvcjogY2hhcnRzQXBpRXJyb3IgfSA9IHVzZURhc2hib2FyZENoYXJ0cyhpZE9yU2x1Zyk7XG4gICAgY29uc3QgeyByZXN1bHQ6IGRhdGFzZXRzLCBlcnJvcjogZGF0YXNldHNBcGlFcnJvciwgc3RhdHVzLCB9ID0gdXNlRGFzaGJvYXJkRGF0YXNldHMoaWRPclNsdWcpO1xuICAgIGNvbnN0IGlzRGFzaGJvYXJkSHlkcmF0ZWQgPSB1c2VSZWYoZmFsc2UpO1xuICAgIGNvbnN0IGVycm9yID0gZGFzaGJvYXJkQXBpRXJyb3IgfHwgY2hhcnRzQXBpRXJyb3I7XG4gICAgY29uc3QgcmVhZHlUb1JlbmRlciA9IEJvb2xlYW4oZGFzaGJvYXJkICYmIGNoYXJ0cyk7XG4gICAgY29uc3QgeyBkYXNoYm9hcmRfdGl0bGUsIGNzcywgbWV0YWRhdGEsIGlkID0gMCB9ID0gZGFzaGJvYXJkIHx8IHt9O1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIG1hcmsgdGFiIGlkIGFzIHJlZHVuZGFudCB3aGVuIHVzZXIgY2xvc2VzIGJyb3dzZXIgdGFiIC0gYSBuZXcgaWQgd2lsbCBiZVxuICAgICAgICAvLyBnZW5lcmF0ZWQgbmV4dCB0aW1lIHVzZXIgb3BlbnMgYSBkYXNoYm9hcmQgYW5kIHRoZSBvbGQgb25lIHdvbid0IGJlIHJldXNlZFxuICAgICAgICBjb25zdCBoYW5kbGVUYWJDbG9zZSA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGRhc2hib2FyZHNDb250ZXh0cyA9IGdldERhc2hib2FyZENvbnRleHRMb2NhbFN0b3JhZ2UoKTtcbiAgICAgICAgICAgIHNldEl0ZW0oTG9jYWxTdG9yYWdlS2V5cy5kYXNoYm9hcmRfX2V4cGxvcmVfY29udGV4dCwge1xuICAgICAgICAgICAgICAgIC4uLmRhc2hib2FyZHNDb250ZXh0cyxcbiAgICAgICAgICAgICAgICBbZGFzaGJvYXJkUGFnZUlkXToge1xuICAgICAgICAgICAgICAgICAgICAuLi5kYXNoYm9hcmRzQ29udGV4dHNbZGFzaGJvYXJkUGFnZUlkXSxcbiAgICAgICAgICAgICAgICAgICAgaXNSZWR1bmRhbnQ6IHRydWUsXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9O1xuICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgaGFuZGxlVGFiQ2xvc2UpO1xuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIGhhbmRsZVRhYkNsb3NlKTtcbiAgICAgICAgfTtcbiAgICB9LCBbZGFzaGJvYXJkUGFnZUlkXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgZGlzcGF0Y2goc2V0RGF0YXNldHNTdGF0dXMoc3RhdHVzKSk7XG4gICAgfSwgW2Rpc3BhdGNoLCBzdGF0dXNdKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgY29uc2lzdGVudC1yZXR1cm5cbiAgICAgICAgYXN5bmMgZnVuY3Rpb24gZ2V0RGF0YU1hc2tBcHBsaWVkKCkge1xuICAgICAgICAgICAgY29uc3QgcGVybWFsaW5rS2V5ID0gZ2V0VXJsUGFyYW0oVVJMX1BBUkFNUy5wZXJtYWxpbmtLZXkpO1xuICAgICAgICAgICAgY29uc3QgbmF0aXZlRmlsdGVyS2V5VmFsdWUgPSBnZXRVcmxQYXJhbShVUkxfUEFSQU1TLm5hdGl2ZUZpbHRlcnNLZXkpO1xuICAgICAgICAgICAgY29uc3QgaXNPbGRSaXNvbiA9IGdldFVybFBhcmFtKFVSTF9QQVJBTVMubmF0aXZlRmlsdGVycyk7XG4gICAgICAgICAgICBsZXQgZGF0YU1hc2sgPSBuYXRpdmVGaWx0ZXJLZXlWYWx1ZSB8fCB7fTtcbiAgICAgICAgICAgIC8vIGFjdGl2ZVRhYnMgaXMgaW5pdGlhbGl6ZWQgd2l0aCB1bmRlZmluZWQgc28gdGhhdCBpdCBkb2Vzbid0IG92ZXJyaWRlXG4gICAgICAgICAgICAvLyB0aGUgY3VycmVudGx5IHN0b3JlZCB2YWx1ZSB3aGVuIGh5ZHJhdGluZ1xuICAgICAgICAgICAgbGV0IGFjdGl2ZVRhYnM7XG4gICAgICAgICAgICBpZiAocGVybWFsaW5rS2V5KSB7XG4gICAgICAgICAgICAgICAgY29uc3QgcGVybWFsaW5rVmFsdWUgPSBhd2FpdCBnZXRQZXJtYWxpbmtWYWx1ZShwZXJtYWxpbmtLZXkpO1xuICAgICAgICAgICAgICAgIGlmIChwZXJtYWxpbmtWYWx1ZSkge1xuICAgICAgICAgICAgICAgICAgICAoeyBkYXRhTWFzaywgYWN0aXZlVGFicyB9ID0gcGVybWFsaW5rVmFsdWUuc3RhdGUpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKG5hdGl2ZUZpbHRlcktleVZhbHVlKSB7XG4gICAgICAgICAgICAgICAgZGF0YU1hc2sgPSBhd2FpdCBnZXRGaWx0ZXJWYWx1ZShpZCwgbmF0aXZlRmlsdGVyS2V5VmFsdWUpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGlzT2xkUmlzb24pIHtcbiAgICAgICAgICAgICAgICBkYXRhTWFzayA9IGlzT2xkUmlzb247XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAocmVhZHlUb1JlbmRlcikge1xuICAgICAgICAgICAgICAgIGlmICghaXNEYXNoYm9hcmRIeWRyYXRlZC5jdXJyZW50KSB7XG4gICAgICAgICAgICAgICAgICAgIGlzRGFzaGJvYXJkSHlkcmF0ZWQuY3VycmVudCA9IHRydWU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkRBU0hCT0FSRF9OQVRJVkVfRklMVEVSU19TRVQpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBvbmx5IGluaXRpYWxpemUgZmlsdGVyc2V0IG9uY2VcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpc3BhdGNoKGdldEZpbHRlclNldHMoaWQpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkaXNwYXRjaChoeWRyYXRlRGFzaGJvYXJkKHtcbiAgICAgICAgICAgICAgICAgICAgaGlzdG9yeSxcbiAgICAgICAgICAgICAgICAgICAgZGFzaGJvYXJkLFxuICAgICAgICAgICAgICAgICAgICBjaGFydHMsXG4gICAgICAgICAgICAgICAgICAgIGFjdGl2ZVRhYnMsXG4gICAgICAgICAgICAgICAgICAgIGRhdGFNYXNrLFxuICAgICAgICAgICAgICAgIH0pKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBudWxsO1xuICAgICAgICB9XG4gICAgICAgIGlmIChpZClcbiAgICAgICAgICAgIGdldERhdGFNYXNrQXBwbGllZCgpO1xuICAgICAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgcmVhY3QtaG9va3MvZXhoYXVzdGl2ZS1kZXBzXG4gICAgfSwgW3JlYWR5VG9SZW5kZXJdKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoZGFzaGJvYXJkX3RpdGxlKSB7XG4gICAgICAgICAgICBkb2N1bWVudC50aXRsZSA9IGRhc2hib2FyZF90aXRsZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgICAgICAgZG9jdW1lbnQudGl0bGUgPSBvcmlnaW5hbERvY3VtZW50VGl0bGU7XG4gICAgICAgIH07XG4gICAgfSwgW2Rhc2hib2FyZF90aXRsZV0pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmICh0eXBlb2YgY3NzID09PSAnc3RyaW5nJykge1xuICAgICAgICAgICAgLy8gcmV0dXJuaW5nIHdpbGwgY2xlYW4gdXAgY3VzdG9tIGNzc1xuICAgICAgICAgICAgLy8gd2hlbiBkYXNoYm9hcmQgdW5tb3VudHMgb3IgY2hhbmdlc1xuICAgICAgICAgICAgcmV0dXJuIGluamVjdEN1c3RvbUNzcyhjc3MpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoKSA9PiB7IH07XG4gICAgfSwgW2Nzc10pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNoYXJlZExhYmVsQ29sb3IgPSBnZXRTaGFyZWRMYWJlbENvbG9yKCk7XG4gICAgICAgIHNoYXJlZExhYmVsQ29sb3Iuc291cmNlID0gU2hhcmVkTGFiZWxDb2xvclNvdXJjZS5kYXNoYm9hcmQ7XG4gICAgICAgIHJldHVybiAoKSA9PiB7XG4gICAgICAgICAgICAvLyBjbGVhbiB1cCBsYWJlbCBjb2xvclxuICAgICAgICAgICAgY29uc3QgY2F0ZWdvcmljYWxOYW1lc3BhY2UgPSBDYXRlZ29yaWNhbENvbG9yTmFtZXNwYWNlLmdldE5hbWVzcGFjZShtZXRhZGF0YT8uY29sb3JfbmFtZXNwYWNlKTtcbiAgICAgICAgICAgIGNhdGVnb3JpY2FsTmFtZXNwYWNlLnJlc2V0Q29sb3JzKCk7XG4gICAgICAgICAgICBzaGFyZWRMYWJlbENvbG9yLmNsZWFyKCk7XG4gICAgICAgIH07XG4gICAgfSwgW21ldGFkYXRhPy5jb2xvcl9uYW1lc3BhY2VdKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoZGF0YXNldHNBcGlFcnJvcikge1xuICAgICAgICAgICAgYWRkRGFuZ2VyVG9hc3QodCgnRXJyb3IgbG9hZGluZyBjaGFydCBkYXRhc291cmNlcy4gRmlsdGVycyBtYXkgbm90IHdvcmsgY29ycmVjdGx5LicpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRpc3BhdGNoKHNldERhdGFzb3VyY2VzKGRhdGFzZXRzKSk7XG4gICAgICAgIH1cbiAgICB9LCBbYWRkRGFuZ2VyVG9hc3QsIGRhdGFzZXRzLCBkYXRhc2V0c0FwaUVycm9yLCBkaXNwYXRjaF0pO1xuICAgIGlmIChlcnJvcilcbiAgICAgICAgdGhyb3cgZXJyb3I7IC8vIGNhdWdodCBpbiBlcnJvciBib3VuZGFyeVxuICAgIGlmICghcmVhZHlUb1JlbmRlciB8fCAhaXNEYXNoYm9hcmRIeWRyYXRlZC5jdXJyZW50KVxuICAgICAgICByZXR1cm4gPExvYWRpbmcgLz47XG4gICAgcmV0dXJuICg8PlxuICAgICAgPEdsb2JhbCBzdHlsZXM9e1tcbiAgICAgICAgICAgIGZpbHRlckNhcmRQb3BvdmVyU3R5bGUodGhlbWUpLFxuICAgICAgICAgICAgaGVhZGVyU3R5bGVzKHRoZW1lKSxcbiAgICAgICAgICAgIGNoYXJ0Q29udGV4dE1lbnVTdHlsZXModGhlbWUpLFxuICAgICAgICBdfS8+XG4gICAgICA8RGFzaGJvYXJkUGFnZUlkQ29udGV4dC5Qcm92aWRlciB2YWx1ZT17ZGFzaGJvYXJkUGFnZUlkfT5cbiAgICAgICAgPERhc2hib2FyZENvbnRhaW5lciAvPlxuICAgICAgPC9EYXNoYm9hcmRQYWdlSWRDb250ZXh0LlByb3ZpZGVyPlxuICAgIDwvPik7XG59O1xuZXhwb3J0IGRlZmF1bHQgRGFzaGJvYXJkUGFnZTtcbiJdfQ== */\"] }),\n\n  ___EmotionJSX(DashboardPageIdContext.Provider, { value: dashboardPageId },\n  ___EmotionJSX(DashboardContainer, null)));\n\n\n};__signature__(DashboardPage, \"useTheme{theme}\\nuseDispatch{dispatch}\\nuseHistory{history}\\nuseSyncDashboardStateWithLocalStorage{dashboardPageId}\\nuseToasts{{ addDangerToast }}\\nuseDashboard{{ result: dashboard, error: dashboardApiError }}\\nuseDashboardCharts{{ result: charts, error: chartsApiError }}\\nuseDashboardDatasets{{ result: datasets, error: datasetsApiError, status, }}\\nuseRef{isDashboardHydrated}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\\nuseEffect{}\", () => [useTheme, useDispatch, useHistory, useSyncDashboardStateWithLocalStorage, useToasts, useDashboard, useDashboardCharts, useDashboardDatasets]);const _default =\nDashboardPage;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(DashboardPageIdContext, \"DashboardPageIdContext\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/containers/DashboardPage.tsx\");reactHotLoader.register(DashboardContainer, \"DashboardContainer\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/containers/DashboardPage.tsx\");reactHotLoader.register(originalDocumentTitle, \"originalDocumentTitle\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/containers/DashboardPage.tsx\");reactHotLoader.register(getDashboardContextLocalStorage, \"getDashboardContextLocalStorage\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/containers/DashboardPage.tsx\");reactHotLoader.register(updateDashboardTabLocalStorage, \"updateDashboardTabLocalStorage\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/containers/DashboardPage.tsx\");reactHotLoader.register(useSyncDashboardStateWithLocalStorage, \"useSyncDashboardStateWithLocalStorage\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/containers/DashboardPage.tsx\");reactHotLoader.register(DashboardPage, \"DashboardPage\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/containers/DashboardPage.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/containers/DashboardPage.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"mappings":"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","names":["React","useEffect","useMemo","useRef","Global","useHistory","CategoricalColorNamespace","FeatureFlag","getSharedLabelColor","isFeatureEnabled","SharedLabelColorSource","t","useTheme","pick","useDispatch","useSelector","useToasts","Loading","useDashboard","useDashboardCharts","useDashboardDatasets","hydrateDashboard","setDatasources","injectCustomCss","setupPlugins","getItem","LocalStorageKeys","setItem","URL_PARAMS","getUrlParam","getFilterSets","setDatasetsStatus","getFilterValue","getPermalinkValue","shortid","getActiveFilters","chartContextMenuStyles","filterCardPopoverStyle","headerStyles","DashboardPageIdContext","createContext","DashboardContainer","lazy","originalDocumentTitle","document","title","getDashboardContextLocalStorage","dashboardsContexts","dashboard__explore_context","Object","fromEntries","entries","filter","value","isRedundant","updateDashboardTabLocalStorage","dashboardPageId","dashboardContext","useSyncDashboardStateWithLocalStorage","generate","dashboardContextForExplore","dashboardInfo","dashboardState","nativeFilters","dataMask","labelColors","metadata","label_colors","sharedLabelColors","shared_label_colors","colorScheme","chartConfiguration","chart_configuration","filters","reduce","acc","key","filterValue","dashboardId","id","filterBoxFilters","DashboardPage","idOrSlug","theme","dispatch","history","addDangerToast","result","dashboard","error","dashboardApiError","charts","chartsApiError","datasets","datasetsApiError","status","isDashboardHydrated","readyToRender","Boolean","dashboard_title","css","handleTabClose","window","addEventListener","removeEventListener","getDataMaskApplied","permalinkKey","nativeFilterKeyValue","nativeFiltersKey","isOldRison","activeTabs","permalinkValue","state","current","DASHBOARD_NATIVE_FILTERS_SET","sharedLabelColor","source","categoricalNamespace","getNamespace","color_namespace","resetColors","clear"],"sourceRoot":"","sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/containers/DashboardPage.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FC, useEffect, useMemo, useRef } from 'react';\nimport { Global } from '@emotion/react';\nimport { useHistory } from 'react-router-dom';\nimport {\n  CategoricalColorNamespace,\n  FeatureFlag,\n  getSharedLabelColor,\n  isFeatureEnabled,\n  SharedLabelColorSource,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport pick from 'lodash/pick';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { useToasts } from 'src/components/MessageToasts/withToasts';\nimport Loading from 'src/components/Loading';\nimport {\n  useDashboard,\n  useDashboardCharts,\n  useDashboardDatasets,\n} from 'src/hooks/apiResources';\nimport { hydrateDashboard } from 'src/dashboard/actions/hydrate';\nimport { setDatasources } from 'src/dashboard/actions/datasources';\nimport injectCustomCss from 'src/dashboard/util/injectCustomCss';\nimport setupPlugins from 'src/setup/setupPlugins';\n\nimport {\n  getItem,\n  LocalStorageKeys,\n  setItem,\n} from 'src/utils/localStorageHelpers';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { getFilterSets } from 'src/dashboard/actions/nativeFilters';\nimport { setDatasetsStatus } from 'src/dashboard/actions/dashboardState';\nimport {\n  getFilterValue,\n  getPermalinkValue,\n} from 'src/dashboard/components/nativeFilters/FilterBar/keyValue';\nimport { DashboardContextForExplore } from 'src/types/DashboardContextForExplore';\nimport shortid from 'shortid';\nimport { RootState } from '../types';\nimport { getActiveFilters } from '../util/activeDashboardFilters';\nimport {\n  chartContextMenuStyles,\n  filterCardPopoverStyle,\n  headerStyles,\n} from '../styles';\n\nexport const DashboardPageIdContext = React.createContext('');\n\nsetupPlugins();\nconst DashboardContainer = React.lazy(\n  () =>\n    import(\n      /* webpackChunkName: \"DashboardContainer\" */\n      /* webpackPreload: true */\n      'src/dashboard/containers/Dashboard'\n    ),\n);\n\nconst originalDocumentTitle = document.title;\n\ntype PageProps = {\n  idOrSlug: string;\n};\n\nconst getDashboardContextLocalStorage = () => {\n  const dashboardsContexts = getItem(\n    LocalStorageKeys.dashboard__explore_context,\n    {},\n  );\n  // A new dashboard tab id is generated on each dashboard page opening.\n  // We mark ids as redundant when user leaves the dashboard, because they won't be reused.\n  // Then we remove redundant dashboard contexts from local storage in order not to clutter it\n  return Object.fromEntries(\n    Object.entries(dashboardsContexts).filter(\n      ([, value]) => !value.isRedundant,\n    ),\n  );\n};\n\nconst updateDashboardTabLocalStorage = (\n  dashboardPageId: string,\n  dashboardContext: DashboardContextForExplore,\n) => {\n  const dashboardsContexts = getDashboardContextLocalStorage();\n  setItem(LocalStorageKeys.dashboard__explore_context, {\n    ...dashboardsContexts,\n    [dashboardPageId]: dashboardContext,\n  });\n};\n\nconst useSyncDashboardStateWithLocalStorage = () => {\n  const dashboardPageId = useMemo(() => shortid.generate(), []);\n  const dashboardContextForExplore = useSelector<\n    RootState,\n    DashboardContextForExplore\n  >(({ dashboardInfo, dashboardState, nativeFilters, dataMask }) => ({\n    labelColors: dashboardInfo.metadata?.label_colors || {},\n    sharedLabelColors: dashboardInfo.metadata?.shared_label_colors || {},\n    colorScheme: dashboardState?.colorScheme,\n    chartConfiguration: dashboardInfo.metadata?.chart_configuration || {},\n    nativeFilters: Object.entries(nativeFilters.filters).reduce(\n      (acc, [key, filterValue]) => ({\n        ...acc,\n        [key]: pick(filterValue, ['chartsInScope']),\n      }),\n      {},\n    ),\n    dataMask,\n    dashboardId: dashboardInfo.id,\n    filterBoxFilters: getActiveFilters(),\n    dashboardPageId,\n  }));\n\n  useEffect(() => {\n    updateDashboardTabLocalStorage(dashboardPageId, dashboardContextForExplore);\n    return () => {\n      // mark tab id as redundant when dashboard unmounts - case when user opens\n      // Explore in the same tab\n      updateDashboardTabLocalStorage(dashboardPageId, {\n        ...dashboardContextForExplore,\n        isRedundant: true,\n      });\n    };\n  }, [dashboardContextForExplore, dashboardPageId]);\n  return dashboardPageId;\n};\n\nexport const DashboardPage: FC<PageProps> = ({ idOrSlug }: PageProps) => {\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const history = useHistory();\n  const dashboardPageId = useSyncDashboardStateWithLocalStorage();\n  const { addDangerToast } = useToasts();\n  const { result: dashboard, error: dashboardApiError } =\n    useDashboard(idOrSlug);\n  const { result: charts, error: chartsApiError } =\n    useDashboardCharts(idOrSlug);\n  const {\n    result: datasets,\n    error: datasetsApiError,\n    status,\n  } = useDashboardDatasets(idOrSlug);\n  const isDashboardHydrated = useRef(false);\n\n  const error = dashboardApiError || chartsApiError;\n  const readyToRender = Boolean(dashboard && charts);\n  const { dashboard_title, css, metadata, id = 0 } = dashboard || {};\n\n  useEffect(() => {\n    // mark tab id as redundant when user closes browser tab - a new id will be\n    // generated next time user opens a dashboard and the old one won't be reused\n    const handleTabClose = () => {\n      const dashboardsContexts = getDashboardContextLocalStorage();\n      setItem(LocalStorageKeys.dashboard__explore_context, {\n        ...dashboardsContexts,\n        [dashboardPageId]: {\n          ...dashboardsContexts[dashboardPageId],\n          isRedundant: true,\n        },\n      });\n    };\n    window.addEventListener('beforeunload', handleTabClose);\n    return () => {\n      window.removeEventListener('beforeunload', handleTabClose);\n    };\n  }, [dashboardPageId]);\n\n  useEffect(() => {\n    dispatch(setDatasetsStatus(status));\n  }, [dispatch, status]);\n\n  useEffect(() => {\n    // eslint-disable-next-line consistent-return\n    async function getDataMaskApplied() {\n      const permalinkKey = getUrlParam(URL_PARAMS.permalinkKey);\n      const nativeFilterKeyValue = getUrlParam(URL_PARAMS.nativeFiltersKey);\n      const isOldRison = getUrlParam(URL_PARAMS.nativeFilters);\n\n      let dataMask = nativeFilterKeyValue || {};\n      // activeTabs is initialized with undefined so that it doesn't override\n      // the currently stored value when hydrating\n      let activeTabs: string[] | undefined;\n      if (permalinkKey) {\n        const permalinkValue = await getPermalinkValue(permalinkKey);\n        if (permalinkValue) {\n          ({ dataMask, activeTabs } = permalinkValue.state);\n        }\n      } else if (nativeFilterKeyValue) {\n        dataMask = await getFilterValue(id, nativeFilterKeyValue);\n      }\n      if (isOldRison) {\n        dataMask = isOldRison;\n      }\n\n      if (readyToRender) {\n        if (!isDashboardHydrated.current) {\n          isDashboardHydrated.current = true;\n          if (isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS_SET)) {\n            // only initialize filterset once\n            dispatch(getFilterSets(id));\n          }\n        }\n        dispatch(\n          hydrateDashboard({\n            history,\n            dashboard,\n            charts,\n            activeTabs,\n            dataMask,\n          }),\n        );\n      }\n      return null;\n    }\n    if (id) getDataMaskApplied();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [readyToRender]);\n\n  useEffect(() => {\n    if (dashboard_title) {\n      document.title = dashboard_title;\n    }\n    return () => {\n      document.title = originalDocumentTitle;\n    };\n  }, [dashboard_title]);\n\n  useEffect(() => {\n    if (typeof css === 'string') {\n      // returning will clean up custom css\n      // when dashboard unmounts or changes\n      return injectCustomCss(css);\n    }\n    return () => {};\n  }, [css]);\n\n  useEffect(() => {\n    const sharedLabelColor = getSharedLabelColor();\n    sharedLabelColor.source = SharedLabelColorSource.dashboard;\n    return () => {\n      // clean up label color\n      const categoricalNamespace = CategoricalColorNamespace.getNamespace(\n        metadata?.color_namespace,\n      );\n      categoricalNamespace.resetColors();\n      sharedLabelColor.clear();\n    };\n  }, [metadata?.color_namespace]);\n\n  useEffect(() => {\n    if (datasetsApiError) {\n      addDangerToast(\n        t('Error loading chart datasources. Filters may not work correctly.'),\n      );\n    } else {\n      dispatch(setDatasources(datasets));\n    }\n  }, [addDangerToast, datasets, datasetsApiError, dispatch]);\n\n  if (error) throw error; // caught in error boundary\n  if (!readyToRender || !isDashboardHydrated.current) return <Loading />;\n\n  return (\n    <>\n      <Global\n        styles={[\n          filterCardPopoverStyle(theme),\n          headerStyles(theme),\n          chartContextMenuStyles(theme),\n        ]}\n      />\n      <DashboardPageIdContext.Provider value={dashboardPageId}>\n        <DashboardContainer />\n      </DashboardPageIdContext.Provider>\n    </>\n  );\n};\n\nexport default DashboardPage;\n"]},"metadata":{},"sourceType":"module"}