{"ast":null,"code":"import { css as _css } from \"@emotion/react\";import _isEmpty from \"lodash/isEmpty\";var _bootstrapData$common, _bootstrapData$common2;function _EMOTION_STRINGIFIED_CSS_ERROR__() {return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";} /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable jsx-a11y/anchor-is-valid */\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport React, {\nuseState,\nuseEffect,\nuseMemo,\nuseRef,\nuseCallback } from\n'react';\nimport useEffectEvent from 'src/hooks/useEffectEvent';\nimport { CSSTransition } from 'react-transition-group';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport Split from 'react-split';\nimport {\ncss,\nFeatureFlag,\nisFeatureEnabled,\nstyled,\nt,\nuseTheme,\ngetExtensionsRegistry } from\n'@superset-ui/core';\nimport debounce from 'lodash/debounce';\nimport throttle from 'lodash/throttle';\nimport Modal from 'src/components/Modal';\nimport Mousetrap from 'mousetrap';\nimport Button from 'src/components/Button';\nimport Timer from 'src/components/Timer';\nimport ResizableSidebar from 'src/components/ResizableSidebar';\nimport { AntdDropdown, AntdSwitch } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport { Menu } from 'src/components/Menu';\nimport Icons from 'src/components/Icons';\nimport { detectOS } from 'src/utils/common';\nimport {\naddNewQueryEditor,\nCtasEnum,\nestimateQueryCost,\npersistEditorHeight,\npostStopQuery,\nqueryEditorSetAutorun,\nqueryEditorSetSql,\nqueryEditorSetAndSaveSql,\nqueryEditorSetTemplateParams,\nrunQueryFromSqlEditor,\nsaveQuery,\naddSavedQueryToTabState,\nscheduleQuery,\nsetActiveSouthPaneTab,\nupdateSavedQuery } from\n'src/SqlLab/actions/sqlLab';\nimport {\nSTATE_TYPE_MAP,\nSQL_EDITOR_GUTTER_HEIGHT,\nSQL_EDITOR_GUTTER_MARGIN,\nSQL_TOOLBAR_HEIGHT,\nSQL_EDITOR_LEFTBAR_WIDTH,\nSQL_EDITOR_PADDING,\nINITIAL_NORTH_PERCENT,\nINITIAL_SOUTH_PERCENT,\nSET_QUERY_EDITOR_SQL_DEBOUNCE_MS,\nWINDOW_RESIZE_THROTTLE_MS } from\n'src/SqlLab/constants';\nimport {\ngetItem,\nLocalStorageKeys,\nsetItem } from\n'src/utils/localStorageHelpers';\nimport { EmptyStateBig } from 'src/components/EmptyState';\nimport getBootstrapData from 'src/utils/getBootstrapData';\n\nimport TemplateParamsEditor from '../TemplateParamsEditor';\nimport SouthPane from '../SouthPane';\nimport SaveQuery from '../SaveQuery';\nimport ScheduleQueryButton from '../ScheduleQueryButton';\nimport EstimateQueryCostButton from '../EstimateQueryCostButton';\nimport ShareSqlLabQuery from '../ShareSqlLabQuery';\nimport SqlEditorLeftBar from '../SqlEditorLeftBar';\nimport AceEditorWrapper from '../AceEditorWrapper';\nimport RunQueryActionButton from '../RunQueryActionButton';\nimport QueryLimitSelect from '../QueryLimitSelect';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst bootstrapData = getBootstrapData();\nconst scheduledQueriesConf = bootstrapData == null ? void 0 : (_bootstrapData$common = bootstrapData.common) == null ? void 0 : (_bootstrapData$common2 = _bootstrapData$common.conf) == null ? void 0 : _bootstrapData$common2.SCHEDULED_QUERIES;\n\nconst StyledToolbar = styled.div`\n  padding: ${(_ref) => {let { theme } = _ref;return theme.gridUnit * 2;}}px;\n  background: ${(_ref2) => {let { theme } = _ref2;return theme.colors.grayscale.light5;}};\n  display: flex;\n  justify-content: space-between;\n  border: 1px solid ${(_ref3) => {let { theme } = _ref3;return theme.colors.grayscale.light2;}};\n  border-top: 0;\n\n  form {\n    margin-block-end: 0;\n  }\n\n  .leftItems,\n  .rightItems {\n    display: flex;\n    align-items: center;\n    & > span {\n      margin-right: ${(_ref4) => {let { theme } = _ref4;return theme.gridUnit * 2;}}px;\n      display: inline-block;\n\n      &:last-child {\n        margin-right: 0;\n      }\n    }\n  }\n\n  .limitDropdown {\n    white-space: nowrap;\n  }\n`;\n\nconst StyledSidebar = styled.div`\n  flex: 0 0 ${(_ref5) => {let { width } = _ref5;return width;}}px;\n  width: ${(_ref6) => {let { width } = _ref6;return width;}}px;\n  padding: ${(_ref7) => {let { theme, hide } = _ref7;return hide ? 0 : theme.gridUnit * 2.5;}}px;\n  border-right: 1px solid\n    ${(_ref8) => {let { theme, hide } = _ref8;return (\n    hide ? 'transparent' : theme.colors.grayscale.light2);}};\n`;\n\nconst StyledSqlEditor = styled.div`\n  ${(_ref9) => {let { theme } = _ref9;return css`\n    display: flex;\n    flex-direction: row;\n    height: 100%;\n\n    .schemaPane {\n      transition: transform ${theme.transitionTiming}s ease-in-out;\n    }\n\n    .queryPane {\n      flex: 1 1 auto;\n      padding: ${theme.gridUnit * 2}px;\n      overflow-y: auto;\n      overflow-x: scroll;\n    }\n\n    .schemaPane-enter-done,\n    .schemaPane-exit {\n      transform: translateX(0);\n      z-index: 7;\n    }\n\n    .schemaPane-exit-active {\n      transform: translateX(-120%);\n    }\n\n    .schemaPane-enter-active {\n      transform: translateX(0);\n      max-width: ${theme.gridUnit * 75}px;\n    }\n\n    .schemaPane-enter,\n    .schemaPane-exit-done {\n      max-width: 0;\n      transform: translateX(-120%);\n      overflow: hidden;\n    }\n\n    .schemaPane-exit-done + .queryPane {\n      margin-left: 0;\n    }\n\n    .gutter {\n      border-top: 1px solid ${theme.colors.grayscale.light2};\n      border-bottom: 1px solid ${theme.colors.grayscale.light2};\n      width: 3%;\n      margin: ${SQL_EDITOR_GUTTER_MARGIN}px 47%;\n    }\n\n    .gutter.gutter-vertical {\n      cursor: row-resize;\n    }\n  `;}}\n`;\n\nconst propTypes = {\n  tables: PropTypes.array.isRequired,\n  queryEditor: PropTypes.object.isRequired,\n  defaultQueryLimit: PropTypes.number.isRequired,\n  maxRow: PropTypes.number.isRequired,\n  displayLimit: PropTypes.number.isRequired,\n  saveQueryWarning: PropTypes.string,\n  scheduleQueryWarning: PropTypes.string };\n\n\nconst extensionsRegistry = getExtensionsRegistry();var _ref13 = process.env.NODE_ENV === \"production\" ? { name: \"1eoy87d\", styles: \"display:flex;justify-content:space-between\" } : { name: \"1egglng-renderDropdown\", styles: \"display:flex;justify-content:space-between;label:renderDropdown;\", map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy96aGFvcnVpL3NyYy9pbmN1YmF0b3Itc3VwZXJzZXQtaW50ZXJuYWwvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL1NxbExhYi9jb21wb25lbnRzL1NxbEVkaXRvci9pbmRleC5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBa2pCbUIiLCJmaWxlIjoiL1VzZXJzL3poYW9ydWkvc3JjL2luY3ViYXRvci1zdXBlcnNldC1pbnRlcm5hbC9zdXBlcnNldC1mcm9udGVuZC9zcmMvU3FsTGFiL2NvbXBvbmVudHMvU3FsRWRpdG9yL2luZGV4LmpzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbi8qIGVzbGludC1kaXNhYmxlIGpzeC1hMTF5L2FuY2hvci1pcy12YWxpZCAqL1xuLyogZXNsaW50LWRpc2FibGUganN4LWExMXkvbm8tc3RhdGljLWVsZW1lbnQtaW50ZXJhY3Rpb25zICovXG5pbXBvcnQgUmVhY3QsIHtcbiAgdXNlU3RhdGUsXG4gIHVzZUVmZmVjdCxcbiAgdXNlTWVtbyxcbiAgdXNlUmVmLFxuICB1c2VDYWxsYmFjayxcbn0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHVzZUVmZmVjdEV2ZW50IGZyb20gJ3NyYy9ob29rcy91c2VFZmZlY3RFdmVudCc7XG5pbXBvcnQgeyBDU1NUcmFuc2l0aW9uIH0gZnJvbSAncmVhY3QtdHJhbnNpdGlvbi1ncm91cCc7XG5pbXBvcnQgeyBzaGFsbG93RXF1YWwsIHVzZURpc3BhdGNoLCB1c2VTZWxlY3RvciB9IGZyb20gJ3JlYWN0LXJlZHV4JztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgU3BsaXQgZnJvbSAncmVhY3Qtc3BsaXQnO1xuaW1wb3J0IHtcbiAgY3NzLFxuICBGZWF0dXJlRmxhZyxcbiAgaXNGZWF0dXJlRW5hYmxlZCxcbiAgc3R5bGVkLFxuICB0LFxuICB1c2VUaGVtZSxcbiAgZ2V0RXh0ZW5zaW9uc1JlZ2lzdHJ5LFxufSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgZGVib3VuY2UgZnJvbSAnbG9kYXNoL2RlYm91bmNlJztcbmltcG9ydCB0aHJvdHRsZSBmcm9tICdsb2Rhc2gvdGhyb3R0bGUnO1xuaW1wb3J0IE1vZGFsIGZyb20gJ3NyYy9jb21wb25lbnRzL01vZGFsJztcbmltcG9ydCBNb3VzZXRyYXAgZnJvbSAnbW91c2V0cmFwJztcbmltcG9ydCBCdXR0b24gZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uJztcbmltcG9ydCBUaW1lciBmcm9tICdzcmMvY29tcG9uZW50cy9UaW1lcic7XG5pbXBvcnQgUmVzaXphYmxlU2lkZWJhciBmcm9tICdzcmMvY29tcG9uZW50cy9SZXNpemFibGVTaWRlYmFyJztcbmltcG9ydCB7IEFudGREcm9wZG93biwgQW50ZFN3aXRjaCB9IGZyb20gJ3NyYy9jb21wb25lbnRzJztcbmltcG9ydCB7IElucHV0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvSW5wdXQnO1xuaW1wb3J0IHsgTWVudSB9IGZyb20gJ3NyYy9jb21wb25lbnRzL01lbnUnO1xuaW1wb3J0IEljb25zIGZyb20gJ3NyYy9jb21wb25lbnRzL0ljb25zJztcbmltcG9ydCB7IGRldGVjdE9TIH0gZnJvbSAnc3JjL3V0aWxzL2NvbW1vbic7XG5pbXBvcnQge1xuICBhZGROZXdRdWVyeUVkaXRvcixcbiAgQ3Rhc0VudW0sXG4gIGVzdGltYXRlUXVlcnlDb3N0LFxuICBwZXJzaXN0RWRpdG9ySGVpZ2h0LFxuICBwb3N0U3RvcFF1ZXJ5LFxuICBxdWVyeUVkaXRvclNldEF1dG9ydW4sXG4gIHF1ZXJ5RWRpdG9yU2V0U3FsLFxuICBxdWVyeUVkaXRvclNldEFuZFNhdmVTcWwsXG4gIHF1ZXJ5RWRpdG9yU2V0VGVtcGxhdGVQYXJhbXMsXG4gIHJ1blF1ZXJ5RnJvbVNxbEVkaXRvcixcbiAgc2F2ZVF1ZXJ5LFxuICBhZGRTYXZlZFF1ZXJ5VG9UYWJTdGF0ZSxcbiAgc2NoZWR1bGVRdWVyeSxcbiAgc2V0QWN0aXZlU291dGhQYW5lVGFiLFxuICB1cGRhdGVTYXZlZFF1ZXJ5LFxufSBmcm9tICdzcmMvU3FsTGFiL2FjdGlvbnMvc3FsTGFiJztcbmltcG9ydCB7XG4gIFNUQVRFX1RZUEVfTUFQLFxuICBTUUxfRURJVE9SX0dVVFRFUl9IRUlHSFQsXG4gIFNRTF9FRElUT1JfR1VUVEVSX01BUkdJTixcbiAgU1FMX1RPT0xCQVJfSEVJR0hULFxuICBTUUxfRURJVE9SX0xFRlRCQVJfV0lEVEgsXG4gIFNRTF9FRElUT1JfUEFERElORyxcbiAgSU5JVElBTF9OT1JUSF9QRVJDRU5ULFxuICBJTklUSUFMX1NPVVRIX1BFUkNFTlQsXG4gIFNFVF9RVUVSWV9FRElUT1JfU1FMX0RFQk9VTkNFX01TLFxuICBXSU5ET1dfUkVTSVpFX1RIUk9UVExFX01TLFxufSBmcm9tICdzcmMvU3FsTGFiL2NvbnN0YW50cyc7XG5pbXBvcnQge1xuICBnZXRJdGVtLFxuICBMb2NhbFN0b3JhZ2VLZXlzLFxuICBzZXRJdGVtLFxufSBmcm9tICdzcmMvdXRpbHMvbG9jYWxTdG9yYWdlSGVscGVycyc7XG5pbXBvcnQgeyBFbXB0eVN0YXRlQmlnIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvRW1wdHlTdGF0ZSc7XG5pbXBvcnQgZ2V0Qm9vdHN0cmFwRGF0YSBmcm9tICdzcmMvdXRpbHMvZ2V0Qm9vdHN0cmFwRGF0YSc7XG5pbXBvcnQgeyBpc0VtcHR5IH0gZnJvbSAnbG9kYXNoJztcbmltcG9ydCBUZW1wbGF0ZVBhcmFtc0VkaXRvciBmcm9tICcuLi9UZW1wbGF0ZVBhcmFtc0VkaXRvcic7XG5pbXBvcnQgU291dGhQYW5lIGZyb20gJy4uL1NvdXRoUGFuZSc7XG5pbXBvcnQgU2F2ZVF1ZXJ5IGZyb20gJy4uL1NhdmVRdWVyeSc7XG5pbXBvcnQgU2NoZWR1bGVRdWVyeUJ1dHRvbiBmcm9tICcuLi9TY2hlZHVsZVF1ZXJ5QnV0dG9uJztcbmltcG9ydCBFc3RpbWF0ZVF1ZXJ5Q29zdEJ1dHRvbiBmcm9tICcuLi9Fc3RpbWF0ZVF1ZXJ5Q29zdEJ1dHRvbic7XG5pbXBvcnQgU2hhcmVTcWxMYWJRdWVyeSBmcm9tICcuLi9TaGFyZVNxbExhYlF1ZXJ5JztcbmltcG9ydCBTcWxFZGl0b3JMZWZ0QmFyIGZyb20gJy4uL1NxbEVkaXRvckxlZnRCYXInO1xuaW1wb3J0IEFjZUVkaXRvcldyYXBwZXIgZnJvbSAnLi4vQWNlRWRpdG9yV3JhcHBlcic7XG5pbXBvcnQgUnVuUXVlcnlBY3Rpb25CdXR0b24gZnJvbSAnLi4vUnVuUXVlcnlBY3Rpb25CdXR0b24nO1xuaW1wb3J0IFF1ZXJ5TGltaXRTZWxlY3QgZnJvbSAnLi4vUXVlcnlMaW1pdFNlbGVjdCc7XG5cbmNvbnN0IGJvb3RzdHJhcERhdGEgPSBnZXRCb290c3RyYXBEYXRhKCk7XG5jb25zdCBzY2hlZHVsZWRRdWVyaWVzQ29uZiA9IGJvb3RzdHJhcERhdGE/LmNvbW1vbj8uY29uZj8uU0NIRURVTEVEX1FVRVJJRVM7XG5cbmNvbnN0IFN0eWxlZFRvb2xiYXIgPSBzdHlsZWQuZGl2YFxuICBwYWRkaW5nOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMn1weDtcbiAgYmFja2dyb3VuZDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0NX07XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgYm9yZGVyOiAxcHggc29saWQgJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0Mn07XG4gIGJvcmRlci10b3A6IDA7XG5cbiAgZm9ybSB7XG4gICAgbWFyZ2luLWJsb2NrLWVuZDogMDtcbiAgfVxuXG4gIC5sZWZ0SXRlbXMsXG4gIC5yaWdodEl0ZW1zIHtcbiAgICBkaXNwbGF5OiBmbGV4O1xuICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gICAgJiA+IHNwYW4ge1xuICAgICAgbWFyZ2luLXJpZ2h0OiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMn1weDtcbiAgICAgIGRpc3BsYXk6IGlubGluZS1ibG9jaztcblxuICAgICAgJjpsYXN0LWNoaWxkIHtcbiAgICAgICAgbWFyZ2luLXJpZ2h0OiAwO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIC5saW1pdERyb3Bkb3duIHtcbiAgICB3aGl0ZS1zcGFjZTogbm93cmFwO1xuICB9XG5gO1xuXG5jb25zdCBTdHlsZWRTaWRlYmFyID0gc3R5bGVkLmRpdmBcbiAgZmxleDogMCAwICR7KHsgd2lkdGggfSkgPT4gd2lkdGh9cHg7XG4gIHdpZHRoOiAkeyh7IHdpZHRoIH0pID0+IHdpZHRofXB4O1xuICBwYWRkaW5nOiAkeyh7IHRoZW1lLCBoaWRlIH0pID0+IChoaWRlID8gMCA6IHRoZW1lLmdyaWRVbml0ICogMi41KX1weDtcbiAgYm9yZGVyLXJpZ2h0OiAxcHggc29saWRcbiAgICAkeyh7IHRoZW1lLCBoaWRlIH0pID0+XG4gICAgICBoaWRlID8gJ3RyYW5zcGFyZW50JyA6IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbmA7XG5cbmNvbnN0IFN0eWxlZFNxbEVkaXRvciA9IHN0eWxlZC5kaXZgXG4gICR7KHsgdGhlbWUgfSkgPT4gY3NzYFxuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgZmxleC1kaXJlY3Rpb246IHJvdztcbiAgICBoZWlnaHQ6IDEwMCU7XG5cbiAgICAuc2NoZW1hUGFuZSB7XG4gICAgICB0cmFuc2l0aW9uOiB0cmFuc2Zvcm0gJHt0aGVtZS50cmFuc2l0aW9uVGltaW5nfXMgZWFzZS1pbi1vdXQ7XG4gICAgfVxuXG4gICAgLnF1ZXJ5UGFuZSB7XG4gICAgICBmbGV4OiAxIDEgYXV0bztcbiAgICAgIHBhZGRpbmc6ICR7dGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICAgICAgb3ZlcmZsb3cteTogYXV0bztcbiAgICAgIG92ZXJmbG93LXg6IHNjcm9sbDtcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1lbnRlci1kb25lLFxuICAgIC5zY2hlbWFQYW5lLWV4aXQge1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKDApO1xuICAgICAgei1pbmRleDogNztcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1leGl0LWFjdGl2ZSB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTEyMCUpO1xuICAgIH1cblxuICAgIC5zY2hlbWFQYW5lLWVudGVyLWFjdGl2ZSB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7XG4gICAgICBtYXgtd2lkdGg6ICR7dGhlbWUuZ3JpZFVuaXQgKiA3NX1weDtcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1lbnRlcixcbiAgICAuc2NoZW1hUGFuZS1leGl0LWRvbmUge1xuICAgICAgbWF4LXdpZHRoOiAwO1xuICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGVYKC0xMjAlKTtcbiAgICAgIG92ZXJmbG93OiBoaWRkZW47XG4gICAgfVxuXG4gICAgLnNjaGVtYVBhbmUtZXhpdC1kb25lICsgLnF1ZXJ5UGFuZSB7XG4gICAgICBtYXJnaW4tbGVmdDogMDtcbiAgICB9XG5cbiAgICAuZ3V0dGVyIHtcbiAgICAgIGJvcmRlci10b3A6IDFweCBzb2xpZCAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgICAgIGJvcmRlci1ib3R0b206IDFweCBzb2xpZCAke3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgICAgIHdpZHRoOiAzJTtcbiAgICAgIG1hcmdpbjogJHtTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU59cHggNDclO1xuICAgIH1cblxuICAgIC5ndXR0ZXIuZ3V0dGVyLXZlcnRpY2FsIHtcbiAgICAgIGN1cnNvcjogcm93LXJlc2l6ZTtcbiAgICB9XG4gIGB9XG5gO1xuXG5jb25zdCBwcm9wVHlwZXMgPSB7XG4gIHRhYmxlczogUHJvcFR5cGVzLmFycmF5LmlzUmVxdWlyZWQsXG4gIHF1ZXJ5RWRpdG9yOiBQcm9wVHlwZXMub2JqZWN0LmlzUmVxdWlyZWQsXG4gIGRlZmF1bHRRdWVyeUxpbWl0OiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gIG1heFJvdzogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICBkaXNwbGF5TGltaXQ6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgc2F2ZVF1ZXJ5V2FybmluZzogUHJvcFR5cGVzLnN0cmluZyxcbiAgc2NoZWR1bGVRdWVyeVdhcm5pbmc6IFByb3BUeXBlcy5zdHJpbmcsXG59O1xuXG5jb25zdCBleHRlbnNpb25zUmVnaXN0cnkgPSBnZXRFeHRlbnNpb25zUmVnaXN0cnkoKTtcblxuY29uc3QgU3FsRWRpdG9yID0gKHtcbiAgdGFibGVzLFxuICBxdWVyeUVkaXRvcixcbiAgZGVmYXVsdFF1ZXJ5TGltaXQsXG4gIG1heFJvdyxcbiAgZGlzcGxheUxpbWl0LFxuICBzYXZlUXVlcnlXYXJuaW5nLFxuICBzY2hlZHVsZVF1ZXJ5V2FybmluZyA9IG51bGwsXG59KSA9PiB7XG4gIGNvbnN0IHRoZW1lID0gdXNlVGhlbWUoKTtcbiAgY29uc3QgZGlzcGF0Y2ggPSB1c2VEaXNwYXRjaCgpO1xuXG4gIGNvbnN0IHsgZGF0YWJhc2UsIGxhdGVzdFF1ZXJ5LCBoaWRlTGVmdEJhciB9ID0gdXNlU2VsZWN0b3IoXG4gICAgKHsgc3FsTGFiOiB7IHVuc2F2ZWRRdWVyeUVkaXRvciwgZGF0YWJhc2VzLCBxdWVyaWVzIH0gfSkgPT4ge1xuICAgICAgbGV0IHsgZGJJZCwgbGF0ZXN0UXVlcnlJZCwgaGlkZUxlZnRCYXIgfSA9IHF1ZXJ5RWRpdG9yO1xuICAgICAgaWYgKHVuc2F2ZWRRdWVyeUVkaXRvci5pZCA9PT0gcXVlcnlFZGl0b3IuaWQpIHtcbiAgICAgICAgZGJJZCA9IHVuc2F2ZWRRdWVyeUVkaXRvci5kYklkIHx8IGRiSWQ7XG4gICAgICAgIGxhdGVzdFF1ZXJ5SWQgPSB1bnNhdmVkUXVlcnlFZGl0b3IubGF0ZXN0UXVlcnlJZCB8fCBsYXRlc3RRdWVyeUlkO1xuICAgICAgICBoaWRlTGVmdEJhciA9IHVuc2F2ZWRRdWVyeUVkaXRvci5oaWRlTGVmdEJhciB8fCBoaWRlTGVmdEJhcjtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgIGRhdGFiYXNlOiBkYXRhYmFzZXNbZGJJZF0sXG4gICAgICAgIGxhdGVzdFF1ZXJ5OiBxdWVyaWVzW2xhdGVzdFF1ZXJ5SWRdLFxuICAgICAgICBoaWRlTGVmdEJhcixcbiAgICAgIH07XG4gICAgfSxcbiAgICBzaGFsbG93RXF1YWwsXG4gICk7XG5cbiAgY29uc3QgW2hlaWdodCwgc2V0SGVpZ2h0XSA9IHVzZVN0YXRlKDApO1xuICBjb25zdCBbYXV0b3J1biwgc2V0QXV0b3J1bl0gPSB1c2VTdGF0ZShxdWVyeUVkaXRvci5hdXRvcnVuKTtcbiAgY29uc3QgW2N0YXMsIHNldEN0YXNdID0gdXNlU3RhdGUoJycpO1xuICBjb25zdCBbbm9ydGhQZXJjZW50LCBzZXROb3J0aFBlcmNlbnRdID0gdXNlU3RhdGUoXG4gICAgcXVlcnlFZGl0b3Iubm9ydGhQZXJjZW50IHx8IElOSVRJQUxfTk9SVEhfUEVSQ0VOVCxcbiAgKTtcbiAgY29uc3QgW3NvdXRoUGVyY2VudCwgc2V0U291dGhQZXJjZW50XSA9IHVzZVN0YXRlKFxuICAgIHF1ZXJ5RWRpdG9yLnNvdXRoUGVyY2VudCB8fCBJTklUSUFMX1NPVVRIX1BFUkNFTlQsXG4gICk7XG4gIGNvbnN0IFthdXRvY29tcGxldGVFbmFibGVkLCBzZXRBdXRvY29tcGxldGVFbmFibGVkXSA9IHVzZVN0YXRlKFxuICAgIGdldEl0ZW0oTG9jYWxTdG9yYWdlS2V5cy5zcWxsYWJfX2lzX2F1dG9jb21wbGV0ZV9lbmFibGVkLCB0cnVlKSxcbiAgKTtcbiAgY29uc3QgW3Nob3dDcmVhdGVBc01vZGFsLCBzZXRTaG93Q3JlYXRlQXNNb2RhbF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IFtjcmVhdGVBcywgc2V0Q3JlYXRlQXNdID0gdXNlU3RhdGUoJycpO1xuICBjb25zdCBbc2hvd0VtcHR5U3RhdGUsIHNldFNob3dFbXB0eVN0YXRlXSA9IHVzZVN0YXRlKGZhbHNlKTtcblxuICBjb25zdCBzcWxFZGl0b3JSZWYgPSB1c2VSZWYobnVsbCk7XG4gIGNvbnN0IG5vcnRoUGFuZVJlZiA9IHVzZVJlZihudWxsKTtcblxuICBjb25zdCBTcWxGb3JtRXh0ZW5zaW9uID0gZXh0ZW5zaW9uc1JlZ2lzdHJ5LmdldCgnc3FsZWRpdG9yLmV4dGVuc2lvbi5mb3JtJyk7XG5cbiAgY29uc3Qgc3RhcnRRdWVyeSA9IHVzZUNhbGxiYWNrKFxuICAgIChjdGFzQXJnID0gZmFsc2UsIGN0YXNfbWV0aG9kID0gQ3Rhc0VudW0uVEFCTEUpID0+IHtcbiAgICAgIGlmICghZGF0YWJhc2UpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuXG4gICAgICBkaXNwYXRjaChcbiAgICAgICAgcnVuUXVlcnlGcm9tU3FsRWRpdG9yKFxuICAgICAgICAgIGRhdGFiYXNlLFxuICAgICAgICAgIHF1ZXJ5RWRpdG9yLFxuICAgICAgICAgIGRlZmF1bHRRdWVyeUxpbWl0LFxuICAgICAgICAgIGN0YXNBcmcgPyBjdGFzIDogJycsXG4gICAgICAgICAgY3Rhc0FyZyxcbiAgICAgICAgICBjdGFzX21ldGhvZCxcbiAgICAgICAgKSxcbiAgICAgICk7XG4gICAgICBkaXNwYXRjaChzZXRBY3RpdmVTb3V0aFBhbmVUYWIoJ1Jlc3VsdHMnKSk7XG4gICAgfSxcbiAgICBbY3RhcywgZGF0YWJhc2UsIGRlZmF1bHRRdWVyeUxpbWl0LCBkaXNwYXRjaCwgcXVlcnlFZGl0b3JdLFxuICApO1xuXG4gIGNvbnN0IHN0b3BRdWVyeSA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICBpZiAobGF0ZXN0UXVlcnkgJiYgWydydW5uaW5nJywgJ3BlbmRpbmcnXS5pbmRleE9mKGxhdGVzdFF1ZXJ5LnN0YXRlKSA+PSAwKSB7XG4gICAgICBkaXNwYXRjaChwb3N0U3RvcFF1ZXJ5KGxhdGVzdFF1ZXJ5KSk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfSwgW2Rpc3BhdGNoLCBsYXRlc3RRdWVyeV0pO1xuXG4gIGNvbnN0IHJ1blF1ZXJ5ID0gKCkgPT4ge1xuICAgIGlmIChkYXRhYmFzZSkge1xuICAgICAgc3RhcnRRdWVyeSgpO1xuICAgIH1cbiAgfTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmIChhdXRvcnVuKSB7XG4gICAgICBzZXRBdXRvcnVuKGZhbHNlKTtcbiAgICAgIGRpc3BhdGNoKHF1ZXJ5RWRpdG9yU2V0QXV0b3J1bihxdWVyeUVkaXRvciwgZmFsc2UpKTtcbiAgICAgIHN0YXJ0UXVlcnkoKTtcbiAgICB9XG4gIH0sIFthdXRvcnVuLCBkaXNwYXRjaCwgcXVlcnlFZGl0b3IsIHN0YXJ0UXVlcnldKTtcblxuICAvLyBPbmUgbGF5ZXIgb2YgYWJzdHJhY3Rpb24gZm9yIGVhc3kgc3B5aW5nIGluIHVuaXQgdGVzdHNcbiAgY29uc3QgZ2V0U3FsRWRpdG9ySGVpZ2h0ID0gKCkgPT5cbiAgICBzcWxFZGl0b3JSZWYuY3VycmVudFxuICAgICAgPyBzcWxFZGl0b3JSZWYuY3VycmVudC5jbGllbnRIZWlnaHQgLSBTUUxfRURJVE9SX1BBRERJTkcgKiAyXG4gICAgICA6IDA7XG5cbiAgY29uc3QgZ2V0SG90a2V5Q29uZmlnID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIC8vIEdldCB0aGUgdXNlcidzIE9TXG4gICAgY29uc3QgdXNlck9TID0gZGV0ZWN0T1MoKTtcbiAgICBjb25zdCBiYXNlID0gW1xuICAgICAge1xuICAgICAgICBuYW1lOiAncnVuUXVlcnkxJyxcbiAgICAgICAga2V5OiAnY3RybCtyJyxcbiAgICAgICAgZGVzY3I6IHQoJ1J1biBxdWVyeScpLFxuICAgICAgICBmdW5jOiAoKSA9PiB7XG4gICAgICAgICAgaWYgKHF1ZXJ5RWRpdG9yLnNxbC50cmltKCkgIT09ICcnKSB7XG4gICAgICAgICAgICBzdGFydFF1ZXJ5KCk7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ3J1blF1ZXJ5MicsXG4gICAgICAgIGtleTogJ2N0cmwrZW50ZXInLFxuICAgICAgICBkZXNjcjogdCgnUnVuIHF1ZXJ5JyksXG4gICAgICAgIGZ1bmM6ICgpID0+IHtcbiAgICAgICAgICBpZiAocXVlcnlFZGl0b3Iuc3FsLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgICAgICAgIHN0YXJ0UXVlcnkoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAncnVuUXVlcnkzJyxcbiAgICAgICAga2V5OiAnY3RybCtzaGlmdCtlbnRlcicsXG4gICAgICAgIGRlc2NyOiB0KCdSdW4gY3VycmVudCBxdWVyeScpLFxuICAgICAgICBmdW5jOiBlZGl0b3IgPT4ge1xuICAgICAgICAgIGlmICghZWRpdG9yLmdldFZhbHVlKCkudHJpbSgpKSB7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIGNvbnN0IHNlc3Npb24gPSBlZGl0b3IuZ2V0U2Vzc2lvbigpO1xuICAgICAgICAgIGNvbnN0IGN1cnNvclBvc2l0aW9uID0gZWRpdG9yLmdldEN1cnNvclBvc2l0aW9uKCk7XG4gICAgICAgICAgY29uc3QgdG90YWxMaW5lID0gc2Vzc2lvbi5nZXRMZW5ndGgoKTtcbiAgICAgICAgICBjb25zdCBjdXJyZW50Um93ID0gZWRpdG9yLmdldEZpcnN0VmlzaWJsZVJvdygpO1xuICAgICAgICAgIGxldCBlbmQgPSBlZGl0b3IuZmluZCgnOycsIHtcbiAgICAgICAgICAgIGJhY2t3YXJkczogZmFsc2UsXG4gICAgICAgICAgICBza2lwQ3VycmVudDogdHJ1ZSxcbiAgICAgICAgICAgIHN0YXJ0OiBjdXJzb3JQb3NpdGlvbixcbiAgICAgICAgICB9KT8uZW5kO1xuICAgICAgICAgIGlmICghZW5kIHx8IGVuZC5yb3cgPCBjdXJzb3JQb3NpdGlvbi5yb3cpIHtcbiAgICAgICAgICAgIGVuZCA9IHtcbiAgICAgICAgICAgICAgcm93OiB0b3RhbExpbmUgKyAxLFxuICAgICAgICAgICAgICBjb2x1bW46IDAsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBsZXQgc3RhcnQgPSBlZGl0b3IuZmluZCgnOycsIHtcbiAgICAgICAgICAgIGJhY2t3YXJkczogdHJ1ZSxcbiAgICAgICAgICAgIHNraXBDdXJyZW50OiB0cnVlLFxuICAgICAgICAgICAgc3RhcnQ6IGN1cnNvclBvc2l0aW9uLFxuICAgICAgICAgIH0pPy5lbmQ7XG4gICAgICAgICAgbGV0IGN1cnJlbnRMaW5lID0gZWRpdG9yLmZpbmQoJzsnLCB7XG4gICAgICAgICAgICBiYWNrd2FyZHM6IHRydWUsXG4gICAgICAgICAgICBza2lwQ3VycmVudDogdHJ1ZSxcbiAgICAgICAgICAgIHN0YXJ0OiBjdXJzb3JQb3NpdGlvbixcbiAgICAgICAgICB9KT8uZW5kPy5yb3c7XG4gICAgICAgICAgaWYgKFxuICAgICAgICAgICAgIWN1cnJlbnRMaW5lIHx8XG4gICAgICAgICAgICBjdXJyZW50TGluZSA+IGN1cnNvclBvc2l0aW9uLnJvdyB8fFxuICAgICAgICAgICAgKGN1cnJlbnRMaW5lID09PSBjdXJzb3JQb3NpdGlvbi5yb3cgJiZcbiAgICAgICAgICAgICAgc3RhcnQ/LmNvbHVtbiA+IGN1cnNvclBvc2l0aW9uLmNvbHVtbilcbiAgICAgICAgICApIHtcbiAgICAgICAgICAgIGN1cnJlbnRMaW5lID0gMDtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IGNvbnRlbnQgPVxuICAgICAgICAgICAgY3VycmVudExpbmUgPT09IHN0YXJ0Py5yb3dcbiAgICAgICAgICAgICAgPyBzZXNzaW9uLmdldExpbmUoY3VycmVudExpbmUpLnNsaWNlKHN0YXJ0LmNvbHVtbikudHJpbSgpXG4gICAgICAgICAgICAgIDogc2Vzc2lvbi5nZXRMaW5lKGN1cnJlbnRMaW5lKS50cmltKCk7XG4gICAgICAgICAgd2hpbGUgKCFjb250ZW50ICYmIGN1cnJlbnRMaW5lIDwgdG90YWxMaW5lKSB7XG4gICAgICAgICAgICBjdXJyZW50TGluZSArPSAxO1xuICAgICAgICAgICAgY29udGVudCA9IHNlc3Npb24uZ2V0TGluZShjdXJyZW50TGluZSkudHJpbSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBpZiAoY3VycmVudExpbmUgIT09IHN0YXJ0Py5yb3cpIHtcbiAgICAgICAgICAgIHN0YXJ0ID0geyByb3c6IGN1cnJlbnRMaW5lLCBjb2x1bW46IDAgfTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZWRpdG9yLnNlbGVjdGlvbi5zZXRSYW5nZSh7XG4gICAgICAgICAgICBzdGFydDogc3RhcnQgPz8geyByb3c6IDAsIGNvbHVtbjogMCB9LFxuICAgICAgICAgICAgZW5kLFxuICAgICAgICAgIH0pO1xuICAgICAgICAgIHN0YXJ0UXVlcnkoKTtcbiAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLmNsZWFyU2VsZWN0aW9uKCk7XG4gICAgICAgICAgZWRpdG9yLm1vdmVDdXJzb3JUb1Bvc2l0aW9uKGN1cnNvclBvc2l0aW9uKTtcbiAgICAgICAgICBlZGl0b3Iuc2Nyb2xsVG9Sb3coY3VycmVudFJvdyk7XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAnbmV3VGFiJyxcbiAgICAgICAga2V5OiB1c2VyT1MgPT09ICdXaW5kb3dzJyA/ICdjdHJsK3EnIDogJ2N0cmwrdCcsXG4gICAgICAgIGRlc2NyOiB0KCdOZXcgdGFiJyksXG4gICAgICAgIGZ1bmM6ICgpID0+IHtcbiAgICAgICAgICBkaXNwYXRjaChhZGROZXdRdWVyeUVkaXRvcigpKTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdzdG9wUXVlcnknLFxuICAgICAgICBrZXk6IHVzZXJPUyA9PT0gJ01hY09TJyA/ICdjdHJsK3gnIDogJ2N0cmwrZScsXG4gICAgICAgIGRlc2NyOiB0KCdTdG9wIHF1ZXJ5JyksXG4gICAgICAgIGZ1bmM6IHN0b3BRdWVyeSxcbiAgICAgIH0sXG4gICAgXTtcblxuICAgIGlmICh1c2VyT1MgPT09ICdNYWNPUycpIHtcbiAgICAgIGJhc2UucHVzaCh7XG4gICAgICAgIG5hbWU6ICdwcmV2aW91c0xpbmUnLFxuICAgICAgICBrZXk6ICdjdHJsK3AnLFxuICAgICAgICBkZXNjcjogdCgnUHJldmlvdXMgTGluZScpLFxuICAgICAgICBmdW5jOiBlZGl0b3IgPT4ge1xuICAgICAgICAgIGVkaXRvci5uYXZpZ2F0ZVVwKDEpO1xuICAgICAgICB9LFxuICAgICAgfSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGJhc2U7XG4gIH0sIFtkaXNwYXRjaCwgcXVlcnlFZGl0b3Iuc3FsLCBzdGFydFF1ZXJ5LCBzdG9wUXVlcnldKTtcblxuICBjb25zdCBvbkJlZm9yZVVubG9hZCA9IHVzZUVmZmVjdEV2ZW50KGV2ZW50ID0+IHtcbiAgICBpZiAoXG4gICAgICBkYXRhYmFzZT8uZXh0cmFfanNvbj8uY2FuY2VsX3F1ZXJ5X29uX3dpbmRvd3NfdW5sb2FkICYmXG4gICAgICBsYXRlc3RRdWVyeT8uc3RhdGUgPT09ICdydW5uaW5nJ1xuICAgICkge1xuICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgIHN0b3BRdWVyeSgpO1xuICAgIH1cbiAgfSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBXZSBuZWVkIHRvIG1lYXN1cmUgdGhlIGhlaWdodCBvZiB0aGUgc3FsIGVkaXRvciBwb3N0IHJlbmRlciB0byBmaWd1cmUgdGhlIGhlaWdodCBvZlxuICAgIC8vIHRoZSBzb3V0aCBwYW5lIHNvIGl0IGdldHMgcmVuZGVyZWQgcHJvcGVybHlcbiAgICBzZXRIZWlnaHQoZ2V0U3FsRWRpdG9ySGVpZ2h0KCkpO1xuICAgIGNvbnN0IGhhbmRsZVdpbmRvd1Jlc2l6ZVdpdGhUaHJvdHRsZSA9IHRocm90dGxlKFxuICAgICAgKCkgPT4gc2V0SGVpZ2h0KGdldFNxbEVkaXRvckhlaWdodCgpKSxcbiAgICAgIFdJTkRPV19SRVNJWkVfVEhST1RUTEVfTVMsXG4gICAgKTtcblxuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdyZXNpemUnLCBoYW5kbGVXaW5kb3dSZXNpemVXaXRoVGhyb3R0bGUpO1xuICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCBvbkJlZm9yZVVubG9hZCk7XG5cbiAgICByZXR1cm4gKCkgPT4ge1xuICAgICAgd2luZG93LnJlbW92ZUV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGhhbmRsZVdpbmRvd1Jlc2l6ZVdpdGhUaHJvdHRsZSk7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcignYmVmb3JldW5sb2FkJywgb25CZWZvcmVVbmxvYWQpO1xuICAgIH07XG4gICAgLy8gVE9ETzogUmVtb3ZlIHVzZUVmZmVjdEV2ZW50IGRlcHMgb25jZSBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QvcHVsbC8yNTg4MSBpcyByZWxlYXNlZFxuICB9LCBbb25CZWZvcmVVbmxvYWRdKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIGlmICghZGF0YWJhc2UgfHwgaXNFbXB0eShkYXRhYmFzZSkpIHtcbiAgICAgIHNldFNob3dFbXB0eVN0YXRlKHRydWUpO1xuICAgIH1cbiAgfSwgW2RhdGFiYXNlXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBzZXR1cCBob3RrZXlzXG4gICAgTW91c2V0cmFwLnJlc2V0KCk7XG4gICAgY29uc3QgaG90a2V5cyA9IGdldEhvdGtleUNvbmZpZygpO1xuICAgIGhvdGtleXMuZm9yRWFjaChrZXlDb25maWcgPT4ge1xuICAgICAgTW91c2V0cmFwLmJpbmQoW2tleUNvbmZpZy5rZXldLCBrZXlDb25maWcuZnVuYyk7XG4gICAgfSk7XG4gIH0sIFtnZXRIb3RrZXlDb25maWcsIGxhdGVzdFF1ZXJ5XSk7XG5cbiAgY29uc3Qgb25SZXNpemVTdGFydCA9ICgpID0+IHtcbiAgICAvLyBTZXQgdGhlIGhlaWdodHMgb24gdGhlIGFjZSBlZGl0b3IgYW5kIHRoZSBhY2UgY29udGVudCBhcmVhIGFmdGVyIGRyYWcgc3RhcnRzXG4gICAgLy8gdG8gc21vb3RoIG91dCB0aGUgdmlzdWFsIHRyYW5zaXRpb24gdG8gdGhlIG5ldyBoZWlnaHRzIHdoZW4gZHJhZyBlbmRzXG4gICAgZG9jdW1lbnQuZ2V0RWxlbWVudHNCeUNsYXNzTmFtZSgnYWNlX2NvbnRlbnQnKVswXS5zdHlsZS5oZWlnaHQgPSAnMTAwJSc7XG4gIH07XG5cbiAgY29uc3Qgb25SZXNpemVFbmQgPSAoW25vcnRoUGVyY2VudCwgc291dGhQZXJjZW50XSkgPT4ge1xuICAgIHNldE5vcnRoUGVyY2VudChub3J0aFBlcmNlbnQpO1xuICAgIHNldFNvdXRoUGVyY2VudChzb3V0aFBlcmNlbnQpO1xuXG4gICAgaWYgKG5vcnRoUGFuZVJlZi5jdXJyZW50Py5jbGllbnRIZWlnaHQpIHtcbiAgICAgIGRpc3BhdGNoKHBlcnNpc3RFZGl0b3JIZWlnaHQocXVlcnlFZGl0b3IsIG5vcnRoUGVyY2VudCwgc291dGhQZXJjZW50KSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbCA9IHVzZUNhbGxiYWNrKFxuICAgIHNxbCA9PiB7XG4gICAgICBkaXNwYXRjaChxdWVyeUVkaXRvclNldEFuZFNhdmVTcWwocXVlcnlFZGl0b3IsIHNxbCkpO1xuICAgIH0sXG4gICAgW2Rpc3BhdGNoLCBxdWVyeUVkaXRvcl0sXG4gICk7XG5cbiAgY29uc3Qgc2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsV2l0aERlYm91bmNlID0gdXNlTWVtbyhcbiAgICAoKSA9PiBkZWJvdW5jZShzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWwsIFNFVF9RVUVSWV9FRElUT1JfU1FMX0RFQk9VTkNFX01TKSxcbiAgICBbc2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsXSxcbiAgKTtcblxuICBjb25zdCBvblNxbENoYW5nZWQgPSBzcWwgPT4ge1xuICAgIGRpc3BhdGNoKHF1ZXJ5RWRpdG9yU2V0U3FsKHF1ZXJ5RWRpdG9yLCBzcWwpKTtcbiAgICBzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWxXaXRoRGVib3VuY2Uoc3FsKTtcbiAgfTtcblxuICAvLyBSZXR1cm4gdGhlIGhlaWdodHMgZm9yIHRoZSBhY2UgZWRpdG9yIGFuZCB0aGUgc291dGggcGFuZSBhcyBhbiBvYmplY3RcbiAgLy8gZ2l2ZW4gdGhlIGhlaWdodCBvZiB0aGUgc3FsIGVkaXRvciwgbm9ydGggcGFuZSBwZXJjZW50IGFuZCBzb3V0aCBwYW5lIHBlcmNlbnQuXG4gIGNvbnN0IGdldEFjZUVkaXRvckFuZFNvdXRoUGFuZUhlaWdodHMgPSAoXG4gICAgaGVpZ2h0LFxuICAgIG5vcnRoUGVyY2VudCxcbiAgICBzb3V0aFBlcmNlbnQsXG4gICkgPT4gKHtcbiAgICBhY2VFZGl0b3JIZWlnaHQ6XG4gICAgICAoaGVpZ2h0ICogbm9ydGhQZXJjZW50KSAvICh0aGVtZS5ncmlkVW5pdCAqIDI1KSAtXG4gICAgICAoU1FMX0VESVRPUl9HVVRURVJfSEVJR0hUIC8gMiArIFNRTF9FRElUT1JfR1VUVEVSX01BUkdJTikgLVxuICAgICAgU1FMX1RPT0xCQVJfSEVJR0hULFxuICAgIHNvdXRoUGFuZUhlaWdodDpcbiAgICAgIChoZWlnaHQgKiBzb3V0aFBlcmNlbnQpIC8gKHRoZW1lLmdyaWRVbml0ICogMjUpIC1cbiAgICAgIChTUUxfRURJVE9SX0dVVFRFUl9IRUlHSFQgLyAyICsgU1FMX0VESVRPUl9HVVRURVJfTUFSR0lOKSxcbiAgfSk7XG5cbiAgY29uc3QgZ2V0UXVlcnlDb3N0RXN0aW1hdGUgPSAoKSA9PiB7XG4gICAgaWYgKGRhdGFiYXNlKSB7XG4gICAgICBkaXNwYXRjaChlc3RpbWF0ZVF1ZXJ5Q29zdChxdWVyeUVkaXRvcikpO1xuICAgIH1cbiAgfTtcblxuICBjb25zdCBoYW5kbGVUb2dnbGVBdXRvY29tcGxldGVFbmFibGVkID0gKCkgPT4ge1xuICAgIHNldEl0ZW0oXG4gICAgICBMb2NhbFN0b3JhZ2VLZXlzLnNxbGxhYl9faXNfYXV0b2NvbXBsZXRlX2VuYWJsZWQsXG4gICAgICAhYXV0b2NvbXBsZXRlRW5hYmxlZCxcbiAgICApO1xuICAgIHNldEF1dG9jb21wbGV0ZUVuYWJsZWQoIWF1dG9jb21wbGV0ZUVuYWJsZWQpO1xuICB9O1xuXG4gIGNvbnN0IGVsZW1lbnRTdHlsZSA9IChkaW1lbnNpb24sIGVsZW1lbnRTaXplLCBndXR0ZXJTaXplKSA9PiAoe1xuICAgIFtkaW1lbnNpb25dOiBgY2FsYygke2VsZW1lbnRTaXplfSUgLSAke1xuICAgICAgZ3V0dGVyU2l6ZSArIFNRTF9FRElUT1JfR1VUVEVSX01BUkdJTlxuICAgIH1weClgLFxuICB9KTtcblxuICBjb25zdCBjcmVhdGVUYWJsZUFzID0gKCkgPT4ge1xuICAgIHN0YXJ0UXVlcnkodHJ1ZSwgQ3Rhc0VudW0uVEFCTEUpO1xuICAgIHNldFNob3dDcmVhdGVBc01vZGFsKGZhbHNlKTtcbiAgICBzZXRDdGFzKCcnKTtcbiAgfTtcblxuICBjb25zdCBjcmVhdGVWaWV3QXMgPSAoKSA9PiB7XG4gICAgc3RhcnRRdWVyeSh0cnVlLCBDdGFzRW51bS5WSUVXKTtcbiAgICBzZXRTaG93Q3JlYXRlQXNNb2RhbChmYWxzZSk7XG4gICAgc2V0Q3RhcygnJyk7XG4gIH07XG5cbiAgY29uc3QgY3Rhc0NoYW5nZWQgPSBldmVudCA9PiB7XG4gICAgc2V0Q3RhcyhldmVudC50YXJnZXQudmFsdWUpO1xuICB9O1xuXG4gIGNvbnN0IHJlbmRlckRyb3Bkb3duID0gKCkgPT4ge1xuICAgIGNvbnN0IHFlID0gcXVlcnlFZGl0b3I7XG4gICAgY29uc3Qgc3VjY2Vzc2Z1bCA9IGxhdGVzdFF1ZXJ5Py5zdGF0ZSA9PT0gJ3N1Y2Nlc3MnO1xuICAgIGNvbnN0IHNjaGVkdWxlVG9vbFRpcCA9IHN1Y2Nlc3NmdWxcbiAgICAgID8gdCgnU2NoZWR1bGUgdGhlIHF1ZXJ5IHBlcmlvZGljYWxseScpXG4gICAgICA6IHQoJ1lvdSBtdXN0IHJ1biB0aGUgcXVlcnkgc3VjY2Vzc2Z1bGx5IGZpcnN0Jyk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxNZW51IGNzcz17eyB3aWR0aDogdGhlbWUuZ3JpZFVuaXQgKiA0NCB9fT5cbiAgICAgICAgPE1lbnUuSXRlbSBjc3M9e3sgZGlzcGxheTogJ2ZsZXgnLCBqdXN0aWZ5Q29udGVudDogJ3NwYWNlLWJldHdlZW4nIH19PlxuICAgICAgICAgIHsnICd9XG4gICAgICAgICAgPHNwYW4+e3QoJ0F1dG9jb21wbGV0ZScpfTwvc3Bhbj57JyAnfVxuICAgICAgICAgIDxBbnRkU3dpdGNoXG4gICAgICAgICAgICBjaGVja2VkPXthdXRvY29tcGxldGVFbmFibGVkfVxuICAgICAgICAgICAgb25DaGFuZ2U9e2hhbmRsZVRvZ2dsZUF1dG9jb21wbGV0ZUVuYWJsZWR9XG4gICAgICAgICAgICBuYW1lPVwiYXV0b2NvbXBsZXRlLXN3aXRjaFwiXG4gICAgICAgICAgLz57JyAnfVxuICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAge2lzRmVhdHVyZUVuYWJsZWQoRmVhdHVyZUZsYWcuRU5BQkxFX1RFTVBMQVRFX1BST0NFU1NJTkcpICYmIChcbiAgICAgICAgICA8TWVudS5JdGVtPlxuICAgICAgICAgICAgPFRlbXBsYXRlUGFyYW1zRWRpdG9yXG4gICAgICAgICAgICAgIGxhbmd1YWdlPVwianNvblwiXG4gICAgICAgICAgICAgIG9uQ2hhbmdlPXtwYXJhbXMgPT4ge1xuICAgICAgICAgICAgICAgIGRpc3BhdGNoKHF1ZXJ5RWRpdG9yU2V0VGVtcGxhdGVQYXJhbXMocWUsIHBhcmFtcykpO1xuICAgICAgICAgICAgICB9fVxuICAgICAgICAgICAgICBxdWVyeUVkaXRvcklkPXtxZS5pZH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9NZW51Lkl0ZW0+XG4gICAgICAgICl9XG4gICAgICAgIHshaXNFbXB0eShzY2hlZHVsZWRRdWVyaWVzQ29uZikgJiYgKFxuICAgICAgICAgIDxNZW51Lkl0ZW0+XG4gICAgICAgICAgICA8U2NoZWR1bGVRdWVyeUJ1dHRvblxuICAgICAgICAgICAgICBkZWZhdWx0TGFiZWw9e3FlLm5hbWV9XG4gICAgICAgICAgICAgIHNxbD17cWUuc3FsfVxuICAgICAgICAgICAgICBvblNjaGVkdWxlPXtxdWVyeSA9PiBkaXNwYXRjaChzY2hlZHVsZVF1ZXJ5KHF1ZXJ5KSl9XG4gICAgICAgICAgICAgIHNjaGVtYT17cWUuc2NoZW1hfVxuICAgICAgICAgICAgICBkYklkPXtxZS5kYklkfVxuICAgICAgICAgICAgICBzY2hlZHVsZVF1ZXJ5V2FybmluZz17c2NoZWR1bGVRdWVyeVdhcm5pbmd9XG4gICAgICAgICAgICAgIHRvb2x0aXA9e3NjaGVkdWxlVG9vbFRpcH1cbiAgICAgICAgICAgICAgZGlzYWJsZWQ9eyFzdWNjZXNzZnVsfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAgKX1cbiAgICAgIDwvTWVudT5cbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IG9uU2F2ZVF1ZXJ5ID0gYXN5bmMgKHF1ZXJ5LCBjbGllbnRJZCkgPT4ge1xuICAgIGNvbnN0IHNhdmVkUXVlcnkgPSBhd2FpdCBkaXNwYXRjaChzYXZlUXVlcnkocXVlcnksIGNsaWVudElkKSk7XG4gICAgZGlzcGF0Y2goYWRkU2F2ZWRRdWVyeVRvVGFiU3RhdGUocXVlcnlFZGl0b3IsIHNhdmVkUXVlcnkpKTtcbiAgfTtcblxuICBjb25zdCByZW5kZXJFZGl0b3JCb3R0b21CYXIgPSAoKSA9PiB7XG4gICAgY29uc3QgeyBhbGxvd19jdGFzOiBhbGxvd0NUQVMsIGFsbG93X2N2YXM6IGFsbG93Q1ZBUyB9ID0gZGF0YWJhc2UgfHwge307XG5cbiAgICBjb25zdCBzaG93TWVudSA9IGFsbG93Q1RBUyB8fCBhbGxvd0NWQVM7XG4gICAgY29uc3QgcnVuTWVudUJ0biA9IChcbiAgICAgIDxNZW51PlxuICAgICAgICB7YWxsb3dDVEFTICYmIChcbiAgICAgICAgICA8TWVudS5JdGVtXG4gICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgIHNldFNob3dDcmVhdGVBc01vZGFsKHRydWUpO1xuICAgICAgICAgICAgICBzZXRDcmVhdGVBcyhDdGFzRW51bS5UQUJMRSk7XG4gICAgICAgICAgICB9fVxuICAgICAgICAgICAga2V5PVwiMVwiXG4gICAgICAgICAgPlxuICAgICAgICAgICAge3QoJ0NSRUFURSBUQUJMRSBBUycpfVxuICAgICAgICAgIDwvTWVudS5JdGVtPlxuICAgICAgICApfVxuICAgICAgICB7YWxsb3dDVkFTICYmIChcbiAgICAgICAgICA8TWVudS5JdGVtXG4gICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB7XG4gICAgICAgICAgICAgIHNldFNob3dDcmVhdGVBc01vZGFsKHRydWUpO1xuICAgICAgICAgICAgICBzZXRDcmVhdGVBcyhDdGFzRW51bS5WSUVXKTtcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICBrZXk9XCIyXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICB7dCgnQ1JFQVRFIFZJRVcgQVMnKX1cbiAgICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAgKX1cbiAgICAgIDwvTWVudT5cbiAgICApO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxTdHlsZWRUb29sYmFyIGNsYXNzTmFtZT1cInNxbC10b29sYmFyXCIgaWQ9XCJqcy1zcWwtdG9vbGJhclwiPlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cImxlZnRJdGVtc1wiPlxuICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgPFJ1blF1ZXJ5QWN0aW9uQnV0dG9uXG4gICAgICAgICAgICAgIGFsbG93QXN5bmM9e2RhdGFiYXNlID8gZGF0YWJhc2UuYWxsb3dfcnVuX2FzeW5jIDogZmFsc2V9XG4gICAgICAgICAgICAgIHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfVxuICAgICAgICAgICAgICBxdWVyeVN0YXRlPXtsYXRlc3RRdWVyeT8uc3RhdGV9XG4gICAgICAgICAgICAgIHJ1blF1ZXJ5PXtydW5RdWVyeX1cbiAgICAgICAgICAgICAgc3RvcFF1ZXJ5PXtzdG9wUXVlcnl9XG4gICAgICAgICAgICAgIG92ZXJsYXlDcmVhdGVBc01lbnU9e3Nob3dNZW51ID8gcnVuTWVudUJ0biA6IG51bGx9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICB7aXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5FU1RJTUFURV9RVUVSWV9DT1NUKSAmJlxuICAgICAgICAgICAgZGF0YWJhc2U/LmFsbG93c19jb3N0X2VzdGltYXRlICYmIChcbiAgICAgICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICAgICAgPEVzdGltYXRlUXVlcnlDb3N0QnV0dG9uXG4gICAgICAgICAgICAgICAgICBnZXRFc3RpbWF0ZT17Z2V0UXVlcnlDb3N0RXN0aW1hdGV9XG4gICAgICAgICAgICAgICAgICBxdWVyeUVkaXRvcklkPXtxdWVyeUVkaXRvci5pZH1cbiAgICAgICAgICAgICAgICAgIHRvb2x0aXA9e3QoJ0VzdGltYXRlIHRoZSBjb3N0IGJlZm9yZSBydW5uaW5nIGEgcXVlcnknKX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgPFF1ZXJ5TGltaXRTZWxlY3RcbiAgICAgICAgICAgICAgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9XG4gICAgICAgICAgICAgIG1heFJvdz17bWF4Um93fVxuICAgICAgICAgICAgICBkZWZhdWx0UXVlcnlMaW1pdD17ZGVmYXVsdFF1ZXJ5TGltaXR9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICB7bGF0ZXN0UXVlcnkgJiYgKFxuICAgICAgICAgICAgPFRpbWVyXG4gICAgICAgICAgICAgIHN0YXJ0VGltZT17bGF0ZXN0UXVlcnkuc3RhcnREdHRtfVxuICAgICAgICAgICAgICBlbmRUaW1lPXtsYXRlc3RRdWVyeS5lbmREdHRtfVxuICAgICAgICAgICAgICBzdGF0ZT17U1RBVEVfVFlQRV9NQVBbbGF0ZXN0UXVlcnkuc3RhdGVdfVxuICAgICAgICAgICAgICBpc1J1bm5pbmc9e2xhdGVzdFF1ZXJ5LnN0YXRlID09PSAncnVubmluZyd9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8ZGl2IGNsYXNzTmFtZT1cInJpZ2h0SXRlbXNcIj5cbiAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgIDxTYXZlUXVlcnlcbiAgICAgICAgICAgICAgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9XG4gICAgICAgICAgICAgIGNvbHVtbnM9e2xhdGVzdFF1ZXJ5Py5yZXN1bHRzPy5jb2x1bW5zIHx8IFtdfVxuICAgICAgICAgICAgICBvblNhdmU9e29uU2F2ZVF1ZXJ5fVxuICAgICAgICAgICAgICBvblVwZGF0ZT17KHF1ZXJ5LCByZW1vdGVJZCwgaWQpID0+XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2godXBkYXRlU2F2ZWRRdWVyeShxdWVyeSwgcmVtb3RlSWQsIGlkKSlcbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICBzYXZlUXVlcnlXYXJuaW5nPXtzYXZlUXVlcnlXYXJuaW5nfVxuICAgICAgICAgICAgICBkYXRhYmFzZT17ZGF0YWJhc2V9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgIDxTaGFyZVNxbExhYlF1ZXJ5IHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfSAvPlxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8QW50ZERyb3Bkb3duIG92ZXJsYXk9e3JlbmRlckRyb3Bkb3duKCl9IHRyaWdnZXI9XCJjbGlja1wiPlxuICAgICAgICAgICAgPEljb25zLk1vcmVIb3JpeiBpY29uQ29sb3I9e3RoZW1lLmNvbG9ycy5ncmF5c2NhbGUuYmFzZX0gLz5cbiAgICAgICAgICA8L0FudGREcm9wZG93bj5cbiAgICAgICAgPC9kaXY+XG4gICAgICA8L1N0eWxlZFRvb2xiYXI+XG4gICAgKTtcbiAgfTtcblxuICBjb25zdCBxdWVyeVBhbmUgPSAoKSA9PiB7XG4gICAgY29uc3QgaG90a2V5cyA9IGdldEhvdGtleUNvbmZpZygpO1xuICAgIGNvbnN0IHsgYWNlRWRpdG9ySGVpZ2h0LCBzb3V0aFBhbmVIZWlnaHQgfSA9XG4gICAgICBnZXRBY2VFZGl0b3JBbmRTb3V0aFBhbmVIZWlnaHRzKGhlaWdodCwgbm9ydGhQZXJjZW50LCBzb3V0aFBlcmNlbnQpO1xuICAgIHJldHVybiAoXG4gICAgICA8U3BsaXRcbiAgICAgICAgZXhwYW5kVG9NaW5cbiAgICAgICAgY2xhc3NOYW1lPVwicXVlcnlQYW5lXCJcbiAgICAgICAgc2l6ZXM9e1tub3J0aFBlcmNlbnQsIHNvdXRoUGVyY2VudF19XG4gICAgICAgIGVsZW1lbnRTdHlsZT17ZWxlbWVudFN0eWxlfVxuICAgICAgICBtaW5TaXplPXsyMDB9XG4gICAgICAgIGRpcmVjdGlvbj1cInZlcnRpY2FsXCJcbiAgICAgICAgZ3V0dGVyU2l6ZT17U1FMX0VESVRPUl9HVVRURVJfSEVJR0hUfVxuICAgICAgICBvbkRyYWdTdGFydD17b25SZXNpemVTdGFydH1cbiAgICAgICAgb25EcmFnRW5kPXtvblJlc2l6ZUVuZH1cbiAgICAgID5cbiAgICAgICAgPGRpdiByZWY9e25vcnRoUGFuZVJlZn0gY2xhc3NOYW1lPVwibm9ydGgtcGFuZVwiPlxuICAgICAgICAgIHtTcWxGb3JtRXh0ZW5zaW9uICYmIChcbiAgICAgICAgICAgIDxTcWxGb3JtRXh0ZW5zaW9uXG4gICAgICAgICAgICAgIHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfVxuICAgICAgICAgICAgICBzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWxXaXRoRGVib3VuY2U9e1xuICAgICAgICAgICAgICAgIHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbFdpdGhEZWJvdW5jZVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHN0YXJ0UXVlcnk9e3N0YXJ0UXVlcnl9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICl9XG4gICAgICAgICAgPEFjZUVkaXRvcldyYXBwZXJcbiAgICAgICAgICAgIGF1dG9jb21wbGV0ZT17YXV0b2NvbXBsZXRlRW5hYmxlZH1cbiAgICAgICAgICAgIG9uQmx1cj17c2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsfVxuICAgICAgICAgICAgb25DaGFuZ2U9e29uU3FsQ2hhbmdlZH1cbiAgICAgICAgICAgIHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfVxuICAgICAgICAgICAgaGVpZ2h0PXtgJHthY2VFZGl0b3JIZWlnaHR9cHhgfVxuICAgICAgICAgICAgaG90a2V5cz17aG90a2V5c31cbiAgICAgICAgICAvPlxuICAgICAgICAgIHtyZW5kZXJFZGl0b3JCb3R0b21CYXIoaG90a2V5cyl9XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8U291dGhQYW5lXG4gICAgICAgICAgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9XG4gICAgICAgICAgbGF0ZXN0UXVlcnlJZD17bGF0ZXN0UXVlcnk/LmlkfVxuICAgICAgICAgIGhlaWdodD17c291dGhQYW5lSGVpZ2h0fVxuICAgICAgICAgIGRpc3BsYXlMaW1pdD17ZGlzcGxheUxpbWl0fVxuICAgICAgICAgIGRlZmF1bHRRdWVyeUxpbWl0PXtkZWZhdWx0UXVlcnlMaW1pdH1cbiAgICAgICAgLz5cbiAgICAgIDwvU3BsaXQ+XG4gICAgKTtcbiAgfTtcblxuICBjb25zdCBjcmVhdGVWaWV3TW9kYWxUaXRsZSA9XG4gICAgY3JlYXRlQXMgPT09IEN0YXNFbnVtLlZJRVcgPyAnQ1JFQVRFIFZJRVcgQVMnIDogJ0NSRUFURSBUQUJMRSBBUyc7XG5cbiAgY29uc3QgY3JlYXRlTW9kYWxQbGFjZUhvbGRlciA9XG4gICAgY3JlYXRlQXMgPT09IEN0YXNFbnVtLlZJRVdcbiAgICAgID8gdCgnU3BlY2lmeSBuYW1lIHRvIENSRUFURSBWSUVXIEFTIHNjaGVtYSBpbjogcHVibGljJylcbiAgICAgIDogdCgnU3BlY2lmeSBuYW1lIHRvIENSRUFURSBUQUJMRSBBUyBzY2hlbWEgaW46IHB1YmxpYycpO1xuXG4gIGNvbnN0IGxlZnRCYXJTdGF0ZUNsYXNzID0gaGlkZUxlZnRCYXJcbiAgICA/ICdzY2hlbWFQYW5lLWV4aXQtZG9uZSdcbiAgICA6ICdzY2hlbWFQYW5lLWVudGVyLWRvbmUnO1xuICByZXR1cm4gKFxuICAgIDxTdHlsZWRTcWxFZGl0b3IgcmVmPXtzcWxFZGl0b3JSZWZ9IGNsYXNzTmFtZT1cIlNxbEVkaXRvclwiPlxuICAgICAgPENTU1RyYW5zaXRpb24gY2xhc3NOYW1lcz1cInNjaGVtYVBhbmVcIiBpbj17IWhpZGVMZWZ0QmFyfSB0aW1lb3V0PXszMDB9PlxuICAgICAgICA8UmVzaXphYmxlU2lkZWJhclxuICAgICAgICAgIGlkPXtgc3FsbGFiOiR7cXVlcnlFZGl0b3IuaWR9YH1cbiAgICAgICAgICBtaW5XaWR0aD17U1FMX0VESVRPUl9MRUZUQkFSX1dJRFRIfVxuICAgICAgICAgIGluaXRpYWxXaWR0aD17U1FMX0VESVRPUl9MRUZUQkFSX1dJRFRIfVxuICAgICAgICAgIGVuYWJsZT17IWhpZGVMZWZ0QmFyfVxuICAgICAgICA+XG4gICAgICAgICAge2FkanVzdGVkV2lkdGggPT4gKFxuICAgICAgICAgICAgPFN0eWxlZFNpZGViYXJcbiAgICAgICAgICAgICAgY2xhc3NOYW1lPXtgc2NoZW1hUGFuZSAke2xlZnRCYXJTdGF0ZUNsYXNzfWB9XG4gICAgICAgICAgICAgIHdpZHRoPXthZGp1c3RlZFdpZHRofVxuICAgICAgICAgICAgICBoaWRlPXtoaWRlTGVmdEJhcn1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgPFNxbEVkaXRvckxlZnRCYXJcbiAgICAgICAgICAgICAgICBkYXRhYmFzZT17ZGF0YWJhc2V9XG4gICAgICAgICAgICAgICAgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9XG4gICAgICAgICAgICAgICAgdGFibGVzPXt0YWJsZXN9XG4gICAgICAgICAgICAgICAgc2V0RW1wdHlTdGF0ZT17Ym9vbCA9PiBzZXRTaG93RW1wdHlTdGF0ZShib29sKX1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgIDwvU3R5bGVkU2lkZWJhcj5cbiAgICAgICAgICApfVxuICAgICAgICA8L1Jlc2l6YWJsZVNpZGViYXI+XG4gICAgICA8L0NTU1RyYW5zaXRpb24+XG4gICAgICB7c2hvd0VtcHR5U3RhdGUgPyAoXG4gICAgICAgIDxFbXB0eVN0YXRlQmlnXG4gICAgICAgICAgaW1hZ2U9XCJ2ZWN0b3Iuc3ZnXCJcbiAgICAgICAgICB0aXRsZT17dCgnU2VsZWN0IGEgZGF0YWJhc2UgdG8gd3JpdGUgYSBxdWVyeScpfVxuICAgICAgICAgIGRlc2NyaXB0aW9uPXt0KFxuICAgICAgICAgICAgJ0Nob29zZSBvbmUgb2YgdGhlIGF2YWlsYWJsZSBkYXRhYmFzZXMgZnJvbSB0aGUgcGFuZWwgb24gdGhlIGxlZnQuJyxcbiAgICAgICAgICApfVxuICAgICAgICAvPlxuICAgICAgKSA6IChcbiAgICAgICAgcXVlcnlQYW5lKClcbiAgICAgICl9XG4gICAgICA8TW9kYWxcbiAgICAgICAgdmlzaWJsZT17c2hvd0NyZWF0ZUFzTW9kYWx9XG4gICAgICAgIHRpdGxlPXt0KGNyZWF0ZVZpZXdNb2RhbFRpdGxlKX1cbiAgICAgICAgb25IaWRlPXsoKSA9PiBzZXRTaG93Q3JlYXRlQXNNb2RhbChmYWxzZSl9XG4gICAgICAgIGZvb3Rlcj17XG4gICAgICAgICAgPD5cbiAgICAgICAgICAgIDxCdXR0b24gb25DbGljaz17KCkgPT4gc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpfT5cbiAgICAgICAgICAgICAge3QoJ0NhbmNlbCcpfVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICB7Y3JlYXRlQXMgPT09IEN0YXNFbnVtLlRBQkxFICYmIChcbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2N0YXMubGVuZ3RoID09PSAwfVxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2NyZWF0ZVRhYmxlQXN9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7dCgnQ3JlYXRlJyl9XG4gICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIHtjcmVhdGVBcyA9PT0gQ3Rhc0VudW0uVklFVyAmJiAoXG4gICAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgICBidXR0b25TdHlsZT1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgIGRpc2FibGVkPXtjdGFzLmxlbmd0aCA9PT0gMH1cbiAgICAgICAgICAgICAgICBvbkNsaWNrPXtjcmVhdGVWaWV3QXN9XG4gICAgICAgICAgICAgID5cbiAgICAgICAgICAgICAgICB7dCgnQ3JlYXRlJyl9XG4gICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8Lz5cbiAgICAgICAgfVxuICAgICAgPlxuICAgICAgICA8c3Bhbj57dCgnTmFtZScpfTwvc3Bhbj5cbiAgICAgICAgPElucHV0IHBsYWNlaG9sZGVyPXtjcmVhdGVNb2RhbFBsYWNlSG9sZGVyfSBvbkNoYW5nZT17Y3Rhc0NoYW5nZWR9IC8+XG4gICAgICA8L01vZGFsPlxuICAgIDwvU3R5bGVkU3FsRWRpdG9yPlxuICApO1xufTtcblxuU3FsRWRpdG9yLnByb3BUeXBlcyA9IHByb3BUeXBlcztcblxuZXhwb3J0IGRlZmF1bHQgU3FsRWRpdG9yO1xuIl19 */\", toString: _EMOTION_STRINGIFIED_CSS_ERROR__ };\n\nconst SqlEditor = (_ref10) =>\n\n\n\n\n\n\n\n{let { tables, queryEditor, defaultQueryLimit, maxRow, displayLimit, saveQueryWarning, scheduleQueryWarning = null } = _ref10;\n  const theme = useTheme();\n  const dispatch = useDispatch();\n\n  const { database, latestQuery, hideLeftBar } = useSelector(\n  (_ref11) => {let { sqlLab: { unsavedQueryEditor, databases, queries } } = _ref11;\n    let { dbId, latestQueryId, hideLeftBar } = queryEditor;\n    if (unsavedQueryEditor.id === queryEditor.id) {\n      dbId = unsavedQueryEditor.dbId || dbId;\n      latestQueryId = unsavedQueryEditor.latestQueryId || latestQueryId;\n      hideLeftBar = unsavedQueryEditor.hideLeftBar || hideLeftBar;\n    }\n    return {\n      database: databases[dbId],\n      latestQuery: queries[latestQueryId],\n      hideLeftBar };\n\n  },\n  shallowEqual);\n\n\n  const [height, setHeight] = useState(0);\n  const [autorun, setAutorun] = useState(queryEditor.autorun);\n  const [ctas, setCtas] = useState('');\n  const [northPercent, setNorthPercent] = useState(\n  queryEditor.northPercent || INITIAL_NORTH_PERCENT);\n\n  const [southPercent, setSouthPercent] = useState(\n  queryEditor.southPercent || INITIAL_SOUTH_PERCENT);\n\n  const [autocompleteEnabled, setAutocompleteEnabled] = useState(\n  getItem(LocalStorageKeys.sqllab__is_autocomplete_enabled, true));\n\n  const [showCreateAsModal, setShowCreateAsModal] = useState(false);\n  const [createAs, setCreateAs] = useState('');\n  const [showEmptyState, setShowEmptyState] = useState(false);\n\n  const sqlEditorRef = useRef(null);\n  const northPaneRef = useRef(null);\n\n  const SqlFormExtension = extensionsRegistry.get('sqleditor.extension.form');\n\n  const startQuery = useCallback(\n  function (ctasArg, ctas_method) {if (ctasArg === void 0) {ctasArg = false;}if (ctas_method === void 0) {ctas_method = CtasEnum.TABLE;}\n    if (!database) {\n      return;\n    }\n\n    dispatch(\n    runQueryFromSqlEditor(\n    database,\n    queryEditor,\n    defaultQueryLimit,\n    ctasArg ? ctas : '',\n    ctasArg,\n    ctas_method));\n\n\n    dispatch(setActiveSouthPaneTab('Results'));\n  },\n  [ctas, database, defaultQueryLimit, dispatch, queryEditor]);\n\n\n  const stopQuery = useCallback(() => {\n    if (latestQuery && ['running', 'pending'].indexOf(latestQuery.state) >= 0) {\n      dispatch(postStopQuery(latestQuery));\n    }\n    return false;\n  }, [dispatch, latestQuery]);\n\n  const runQuery = () => {\n    if (database) {\n      startQuery();\n    }\n  };\n\n  useEffect(() => {\n    if (autorun) {\n      setAutorun(false);\n      dispatch(queryEditorSetAutorun(queryEditor, false));\n      startQuery();\n    }\n  }, [autorun, dispatch, queryEditor, startQuery]);\n\n  // One layer of abstraction for easy spying in unit tests\n  const getSqlEditorHeight = () =>\n  sqlEditorRef.current ?\n  sqlEditorRef.current.clientHeight - SQL_EDITOR_PADDING * 2 :\n  0;\n\n  const getHotkeyConfig = useCallback(() => {\n    // Get the user's OS\n    const userOS = detectOS();\n    const base = [\n    {\n      name: 'runQuery1',\n      key: 'ctrl+r',\n      descr: t('Run query'),\n      func: () => {\n        if (queryEditor.sql.trim() !== '') {\n          startQuery();\n        }\n      } },\n\n    {\n      name: 'runQuery2',\n      key: 'ctrl+enter',\n      descr: t('Run query'),\n      func: () => {\n        if (queryEditor.sql.trim() !== '') {\n          startQuery();\n        }\n      } },\n\n    {\n      name: 'runQuery3',\n      key: 'ctrl+shift+enter',\n      descr: t('Run current query'),\n      func: (editor) => {var _editor$find, _editor$find2, _editor$find3, _editor$find3$end, _start, _start2, _start3, _start4;\n        if (!editor.getValue().trim()) {\n          return;\n        }\n        const session = editor.getSession();\n        const cursorPosition = editor.getCursorPosition();\n        const totalLine = session.getLength();\n        const currentRow = editor.getFirstVisibleRow();\n        let end = (_editor$find = editor.find(';', {\n          backwards: false,\n          skipCurrent: true,\n          start: cursorPosition })) == null ? void 0 : _editor$find.\n        end;\n        if (!end || end.row < cursorPosition.row) {\n          end = {\n            row: totalLine + 1,\n            column: 0 };\n\n        }\n        let start = (_editor$find2 = editor.find(';', {\n          backwards: true,\n          skipCurrent: true,\n          start: cursorPosition })) == null ? void 0 : _editor$find2.\n        end;\n        let currentLine = (_editor$find3 = editor.find(';', {\n          backwards: true,\n          skipCurrent: true,\n          start: cursorPosition })) == null ? void 0 : (_editor$find3$end = _editor$find3.\n        end) == null ? void 0 : _editor$find3$end.row;\n        if (\n        !currentLine ||\n        currentLine > cursorPosition.row ||\n        currentLine === cursorPosition.row &&\n        ((_start = start) == null ? void 0 : _start.column) > cursorPosition.column)\n        {\n          currentLine = 0;\n        }\n        let content =\n        currentLine === ((_start2 = start) == null ? void 0 : _start2.row) ?\n        session.getLine(currentLine).slice(start.column).trim() :\n        session.getLine(currentLine).trim();\n        while (!content && currentLine < totalLine) {\n          currentLine += 1;\n          content = session.getLine(currentLine).trim();\n        }\n        if (currentLine !== ((_start3 = start) == null ? void 0 : _start3.row)) {\n          start = { row: currentLine, column: 0 };\n        }\n        editor.selection.setRange({\n          start: (_start4 = start) != null ? _start4 : { row: 0, column: 0 },\n          end });\n\n        startQuery();\n        editor.selection.clearSelection();\n        editor.moveCursorToPosition(cursorPosition);\n        editor.scrollToRow(currentRow);\n      } },\n\n    {\n      name: 'newTab',\n      key: userOS === 'Windows' ? 'ctrl+q' : 'ctrl+t',\n      descr: t('New tab'),\n      func: () => {\n        dispatch(addNewQueryEditor());\n      } },\n\n    {\n      name: 'stopQuery',\n      key: userOS === 'MacOS' ? 'ctrl+x' : 'ctrl+e',\n      descr: t('Stop query'),\n      func: stopQuery }];\n\n\n\n    if (userOS === 'MacOS') {\n      base.push({\n        name: 'previousLine',\n        key: 'ctrl+p',\n        descr: t('Previous Line'),\n        func: (editor) => {\n          editor.navigateUp(1);\n        } });\n\n    }\n\n    return base;\n  }, [dispatch, queryEditor.sql, startQuery, stopQuery]);\n\n  const onBeforeUnload = useEffectEvent((event) => {var _database$extra_json;\n    if (\n    database != null && (_database$extra_json = database.extra_json) != null && _database$extra_json.cancel_query_on_windows_unload &&\n    (latestQuery == null ? void 0 : latestQuery.state) === 'running')\n    {\n      event.preventDefault();\n      stopQuery();\n    }\n  });\n\n  useEffect(() => {\n    // We need to measure the height of the sql editor post render to figure the height of\n    // the south pane so it gets rendered properly\n    setHeight(getSqlEditorHeight());\n    const handleWindowResizeWithThrottle = throttle(\n    () => setHeight(getSqlEditorHeight()),\n    WINDOW_RESIZE_THROTTLE_MS);\n\n\n    window.addEventListener('resize', handleWindowResizeWithThrottle);\n    window.addEventListener('beforeunload', onBeforeUnload);\n\n    return () => {\n      window.removeEventListener('resize', handleWindowResizeWithThrottle);\n      window.removeEventListener('beforeunload', onBeforeUnload);\n    };\n    // TODO: Remove useEffectEvent deps once https://github.com/facebook/react/pull/25881 is released\n  }, [onBeforeUnload]);\n\n  useEffect(() => {\n    if (!database || _isEmpty(database)) {\n      setShowEmptyState(true);\n    }\n  }, [database]);\n\n  useEffect(() => {\n    // setup hotkeys\n    Mousetrap.reset();\n    const hotkeys = getHotkeyConfig();\n    hotkeys.forEach((keyConfig) => {\n      Mousetrap.bind([keyConfig.key], keyConfig.func);\n    });\n  }, [getHotkeyConfig, latestQuery]);\n\n  const onResizeStart = () => {\n    // Set the heights on the ace editor and the ace content area after drag starts\n    // to smooth out the visual transition to the new heights when drag ends\n    document.getElementsByClassName('ace_content')[0].style.height = '100%';\n  };\n\n  const onResizeEnd = (_ref12) => {var _northPaneRef$current;let [northPercent, southPercent] = _ref12;\n    setNorthPercent(northPercent);\n    setSouthPercent(southPercent);\n\n    if ((_northPaneRef$current = northPaneRef.current) != null && _northPaneRef$current.clientHeight) {\n      dispatch(persistEditorHeight(queryEditor, northPercent, southPercent));\n    }\n  };\n\n  const setQueryEditorAndSaveSql = useCallback(\n  (sql) => {\n    dispatch(queryEditorSetAndSaveSql(queryEditor, sql));\n  },\n  [dispatch, queryEditor]);\n\n\n  const setQueryEditorAndSaveSqlWithDebounce = useMemo(\n  () => debounce(setQueryEditorAndSaveSql, SET_QUERY_EDITOR_SQL_DEBOUNCE_MS),\n  [setQueryEditorAndSaveSql]);\n\n\n  const onSqlChanged = (sql) => {\n    dispatch(queryEditorSetSql(queryEditor, sql));\n    setQueryEditorAndSaveSqlWithDebounce(sql);\n  };\n\n  // Return the heights for the ace editor and the south pane as an object\n  // given the height of the sql editor, north pane percent and south pane percent.\n  const getAceEditorAndSouthPaneHeights = (\n  height,\n  northPercent,\n  southPercent) => (\n  {\n    aceEditorHeight:\n    height * northPercent / (theme.gridUnit * 25) - (\n    SQL_EDITOR_GUTTER_HEIGHT / 2 + SQL_EDITOR_GUTTER_MARGIN) -\n    SQL_TOOLBAR_HEIGHT,\n    southPaneHeight:\n    height * southPercent / (theme.gridUnit * 25) - (\n    SQL_EDITOR_GUTTER_HEIGHT / 2 + SQL_EDITOR_GUTTER_MARGIN) });\n\n\n  const getQueryCostEstimate = () => {\n    if (database) {\n      dispatch(estimateQueryCost(queryEditor));\n    }\n  };\n\n  const handleToggleAutocompleteEnabled = () => {\n    setItem(\n    LocalStorageKeys.sqllab__is_autocomplete_enabled,\n    !autocompleteEnabled);\n\n    setAutocompleteEnabled(!autocompleteEnabled);\n  };\n\n  const elementStyle = (dimension, elementSize, gutterSize) => ({\n    [dimension]: `calc(${elementSize}% - ${\n    gutterSize + SQL_EDITOR_GUTTER_MARGIN\n    }px)` });\n\n\n  const createTableAs = () => {\n    startQuery(true, CtasEnum.TABLE);\n    setShowCreateAsModal(false);\n    setCtas('');\n  };\n\n  const createViewAs = () => {\n    startQuery(true, CtasEnum.VIEW);\n    setShowCreateAsModal(false);\n    setCtas('');\n  };\n\n  const ctasChanged = (event) => {\n    setCtas(event.target.value);\n  };\n\n  const renderDropdown = () => {\n    const qe = queryEditor;\n    const successful = (latestQuery == null ? void 0 : latestQuery.state) === 'success';\n    const scheduleToolTip = successful ?\n    t('Schedule the query periodically') :\n    t('You must run the query successfully first');\n    return (\n      ___EmotionJSX(Menu, { css: /*#__PURE__*/_css({ width: theme.gridUnit * 44 }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:renderDropdown;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy96aGFvcnVpL3NyYy9pbmN1YmF0b3Itc3VwZXJzZXQtaW50ZXJuYWwvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL1NxbExhYi9jb21wb25lbnRzL1NxbEVkaXRvci9pbmRleC5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBaWpCWSIsImZpbGUiOiIvVXNlcnMvemhhb3J1aS9zcmMvaW5jdWJhdG9yLXN1cGVyc2V0LWludGVybmFsL3N1cGVyc2V0LWZyb250ZW5kL3NyYy9TcWxMYWIvY29tcG9uZW50cy9TcWxFZGl0b3IvaW5kZXguanN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuLyogZXNsaW50LWRpc2FibGUganN4LWExMXkvYW5jaG9yLWlzLXZhbGlkICovXG4vKiBlc2xpbnQtZGlzYWJsZSBqc3gtYTExeS9uby1zdGF0aWMtZWxlbWVudC1pbnRlcmFjdGlvbnMgKi9cbmltcG9ydCBSZWFjdCwge1xuICB1c2VTdGF0ZSxcbiAgdXNlRWZmZWN0LFxuICB1c2VNZW1vLFxuICB1c2VSZWYsXG4gIHVzZUNhbGxiYWNrLFxufSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgdXNlRWZmZWN0RXZlbnQgZnJvbSAnc3JjL2hvb2tzL3VzZUVmZmVjdEV2ZW50JztcbmltcG9ydCB7IENTU1RyYW5zaXRpb24gfSBmcm9tICdyZWFjdC10cmFuc2l0aW9uLWdyb3VwJztcbmltcG9ydCB7IHNoYWxsb3dFcXVhbCwgdXNlRGlzcGF0Y2gsIHVzZVNlbGVjdG9yIH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCBTcGxpdCBmcm9tICdyZWFjdC1zcGxpdCc7XG5pbXBvcnQge1xuICBjc3MsXG4gIEZlYXR1cmVGbGFnLFxuICBpc0ZlYXR1cmVFbmFibGVkLFxuICBzdHlsZWQsXG4gIHQsXG4gIHVzZVRoZW1lLFxuICBnZXRFeHRlbnNpb25zUmVnaXN0cnksXG59IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCBkZWJvdW5jZSBmcm9tICdsb2Rhc2gvZGVib3VuY2UnO1xuaW1wb3J0IHRocm90dGxlIGZyb20gJ2xvZGFzaC90aHJvdHRsZSc7XG5pbXBvcnQgTW9kYWwgZnJvbSAnc3JjL2NvbXBvbmVudHMvTW9kYWwnO1xuaW1wb3J0IE1vdXNldHJhcCBmcm9tICdtb3VzZXRyYXAnO1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdzcmMvY29tcG9uZW50cy9CdXR0b24nO1xuaW1wb3J0IFRpbWVyIGZyb20gJ3NyYy9jb21wb25lbnRzL1RpbWVyJztcbmltcG9ydCBSZXNpemFibGVTaWRlYmFyIGZyb20gJ3NyYy9jb21wb25lbnRzL1Jlc2l6YWJsZVNpZGViYXInO1xuaW1wb3J0IHsgQW50ZERyb3Bkb3duLCBBbnRkU3dpdGNoIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMnO1xuaW1wb3J0IHsgSW5wdXQgfSBmcm9tICdzcmMvY29tcG9uZW50cy9JbnB1dCc7XG5pbXBvcnQgeyBNZW51IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvTWVudSc7XG5pbXBvcnQgSWNvbnMgZnJvbSAnc3JjL2NvbXBvbmVudHMvSWNvbnMnO1xuaW1wb3J0IHsgZGV0ZWN0T1MgfSBmcm9tICdzcmMvdXRpbHMvY29tbW9uJztcbmltcG9ydCB7XG4gIGFkZE5ld1F1ZXJ5RWRpdG9yLFxuICBDdGFzRW51bSxcbiAgZXN0aW1hdGVRdWVyeUNvc3QsXG4gIHBlcnNpc3RFZGl0b3JIZWlnaHQsXG4gIHBvc3RTdG9wUXVlcnksXG4gIHF1ZXJ5RWRpdG9yU2V0QXV0b3J1bixcbiAgcXVlcnlFZGl0b3JTZXRTcWwsXG4gIHF1ZXJ5RWRpdG9yU2V0QW5kU2F2ZVNxbCxcbiAgcXVlcnlFZGl0b3JTZXRUZW1wbGF0ZVBhcmFtcyxcbiAgcnVuUXVlcnlGcm9tU3FsRWRpdG9yLFxuICBzYXZlUXVlcnksXG4gIGFkZFNhdmVkUXVlcnlUb1RhYlN0YXRlLFxuICBzY2hlZHVsZVF1ZXJ5LFxuICBzZXRBY3RpdmVTb3V0aFBhbmVUYWIsXG4gIHVwZGF0ZVNhdmVkUXVlcnksXG59IGZyb20gJ3NyYy9TcWxMYWIvYWN0aW9ucy9zcWxMYWInO1xuaW1wb3J0IHtcbiAgU1RBVEVfVFlQRV9NQVAsXG4gIFNRTF9FRElUT1JfR1VUVEVSX0hFSUdIVCxcbiAgU1FMX0VESVRPUl9HVVRURVJfTUFSR0lOLFxuICBTUUxfVE9PTEJBUl9IRUlHSFQsXG4gIFNRTF9FRElUT1JfTEVGVEJBUl9XSURUSCxcbiAgU1FMX0VESVRPUl9QQURESU5HLFxuICBJTklUSUFMX05PUlRIX1BFUkNFTlQsXG4gIElOSVRJQUxfU09VVEhfUEVSQ0VOVCxcbiAgU0VUX1FVRVJZX0VESVRPUl9TUUxfREVCT1VOQ0VfTVMsXG4gIFdJTkRPV19SRVNJWkVfVEhST1RUTEVfTVMsXG59IGZyb20gJ3NyYy9TcWxMYWIvY29uc3RhbnRzJztcbmltcG9ydCB7XG4gIGdldEl0ZW0sXG4gIExvY2FsU3RvcmFnZUtleXMsXG4gIHNldEl0ZW0sXG59IGZyb20gJ3NyYy91dGlscy9sb2NhbFN0b3JhZ2VIZWxwZXJzJztcbmltcG9ydCB7IEVtcHR5U3RhdGVCaWcgfSBmcm9tICdzcmMvY29tcG9uZW50cy9FbXB0eVN0YXRlJztcbmltcG9ydCBnZXRCb290c3RyYXBEYXRhIGZyb20gJ3NyYy91dGlscy9nZXRCb290c3RyYXBEYXRhJztcbmltcG9ydCB7IGlzRW1wdHkgfSBmcm9tICdsb2Rhc2gnO1xuaW1wb3J0IFRlbXBsYXRlUGFyYW1zRWRpdG9yIGZyb20gJy4uL1RlbXBsYXRlUGFyYW1zRWRpdG9yJztcbmltcG9ydCBTb3V0aFBhbmUgZnJvbSAnLi4vU291dGhQYW5lJztcbmltcG9ydCBTYXZlUXVlcnkgZnJvbSAnLi4vU2F2ZVF1ZXJ5JztcbmltcG9ydCBTY2hlZHVsZVF1ZXJ5QnV0dG9uIGZyb20gJy4uL1NjaGVkdWxlUXVlcnlCdXR0b24nO1xuaW1wb3J0IEVzdGltYXRlUXVlcnlDb3N0QnV0dG9uIGZyb20gJy4uL0VzdGltYXRlUXVlcnlDb3N0QnV0dG9uJztcbmltcG9ydCBTaGFyZVNxbExhYlF1ZXJ5IGZyb20gJy4uL1NoYXJlU3FsTGFiUXVlcnknO1xuaW1wb3J0IFNxbEVkaXRvckxlZnRCYXIgZnJvbSAnLi4vU3FsRWRpdG9yTGVmdEJhcic7XG5pbXBvcnQgQWNlRWRpdG9yV3JhcHBlciBmcm9tICcuLi9BY2VFZGl0b3JXcmFwcGVyJztcbmltcG9ydCBSdW5RdWVyeUFjdGlvbkJ1dHRvbiBmcm9tICcuLi9SdW5RdWVyeUFjdGlvbkJ1dHRvbic7XG5pbXBvcnQgUXVlcnlMaW1pdFNlbGVjdCBmcm9tICcuLi9RdWVyeUxpbWl0U2VsZWN0JztcblxuY29uc3QgYm9vdHN0cmFwRGF0YSA9IGdldEJvb3RzdHJhcERhdGEoKTtcbmNvbnN0IHNjaGVkdWxlZFF1ZXJpZXNDb25mID0gYm9vdHN0cmFwRGF0YT8uY29tbW9uPy5jb25mPy5TQ0hFRFVMRURfUVVFUklFUztcblxuY29uc3QgU3R5bGVkVG9vbGJhciA9IHN0eWxlZC5kaXZgXG4gIHBhZGRpbmc6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICBiYWNrZ3JvdW5kOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQ1fTtcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuICBib3JkZXI6IDFweCBzb2xpZCAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5ncmF5c2NhbGUubGlnaHQyfTtcbiAgYm9yZGVyLXRvcDogMDtcblxuICBmb3JtIHtcbiAgICBtYXJnaW4tYmxvY2stZW5kOiAwO1xuICB9XG5cbiAgLmxlZnRJdGVtcyxcbiAgLnJpZ2h0SXRlbXMge1xuICAgIGRpc3BsYXk6IGZsZXg7XG4gICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAgICAmID4gc3BhbiB7XG4gICAgICBtYXJnaW4tcmlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICAgICAgZGlzcGxheTogaW5saW5lLWJsb2NrO1xuXG4gICAgICAmOmxhc3QtY2hpbGQge1xuICAgICAgICBtYXJnaW4tcmlnaHQ6IDA7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgLmxpbWl0RHJvcGRvd24ge1xuICAgIHdoaXRlLXNwYWNlOiBub3dyYXA7XG4gIH1cbmA7XG5cbmNvbnN0IFN0eWxlZFNpZGViYXIgPSBzdHlsZWQuZGl2YFxuICBmbGV4OiAwIDAgJHsoeyB3aWR0aCB9KSA9PiB3aWR0aH1weDtcbiAgd2lkdGg6ICR7KHsgd2lkdGggfSkgPT4gd2lkdGh9cHg7XG4gIHBhZGRpbmc6ICR7KHsgdGhlbWUsIGhpZGUgfSkgPT4gKGhpZGUgPyAwIDogdGhlbWUuZ3JpZFVuaXQgKiAyLjUpfXB4O1xuICBib3JkZXItcmlnaHQ6IDFweCBzb2xpZFxuICAgICR7KHsgdGhlbWUsIGhpZGUgfSkgPT5cbiAgICAgIGhpZGUgPyAndHJhbnNwYXJlbnQnIDogdGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuYDtcblxuY29uc3QgU3R5bGVkU3FsRWRpdG9yID0gc3R5bGVkLmRpdmBcbiAgJHsoeyB0aGVtZSB9KSA9PiBjc3NgXG4gICAgZGlzcGxheTogZmxleDtcbiAgICBmbGV4LWRpcmVjdGlvbjogcm93O1xuICAgIGhlaWdodDogMTAwJTtcblxuICAgIC5zY2hlbWFQYW5lIHtcbiAgICAgIHRyYW5zaXRpb246IHRyYW5zZm9ybSAke3RoZW1lLnRyYW5zaXRpb25UaW1pbmd9cyBlYXNlLWluLW91dDtcbiAgICB9XG5cbiAgICAucXVlcnlQYW5lIHtcbiAgICAgIGZsZXg6IDEgMSBhdXRvO1xuICAgICAgcGFkZGluZzogJHt0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gICAgICBvdmVyZmxvdy15OiBhdXRvO1xuICAgICAgb3ZlcmZsb3cteDogc2Nyb2xsO1xuICAgIH1cblxuICAgIC5zY2hlbWFQYW5lLWVudGVyLWRvbmUsXG4gICAgLnNjaGVtYVBhbmUtZXhpdCB7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoMCk7XG4gICAgICB6LWluZGV4OiA3O1xuICAgIH1cblxuICAgIC5zY2hlbWFQYW5lLWV4aXQtYWN0aXZlIHtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgtMTIwJSk7XG4gICAgfVxuXG4gICAgLnNjaGVtYVBhbmUtZW50ZXItYWN0aXZlIHtcbiAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlWCgwKTtcbiAgICAgIG1heC13aWR0aDogJHt0aGVtZS5ncmlkVW5pdCAqIDc1fXB4O1xuICAgIH1cblxuICAgIC5zY2hlbWFQYW5lLWVudGVyLFxuICAgIC5zY2hlbWFQYW5lLWV4aXQtZG9uZSB7XG4gICAgICBtYXgtd2lkdGg6IDA7XG4gICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZVgoLTEyMCUpO1xuICAgICAgb3ZlcmZsb3c6IGhpZGRlbjtcbiAgICB9XG5cbiAgICAuc2NoZW1hUGFuZS1leGl0LWRvbmUgKyAucXVlcnlQYW5lIHtcbiAgICAgIG1hcmdpbi1sZWZ0OiAwO1xuICAgIH1cblxuICAgIC5ndXR0ZXIge1xuICAgICAgYm9yZGVyLXRvcDogMXB4IHNvbGlkICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuICAgICAgYm9yZGVyLWJvdHRvbTogMXB4IHNvbGlkICR7dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5saWdodDJ9O1xuICAgICAgd2lkdGg6IDMlO1xuICAgICAgbWFyZ2luOiAke1NRTF9FRElUT1JfR1VUVEVSX01BUkdJTn1weCA0NyU7XG4gICAgfVxuXG4gICAgLmd1dHRlci5ndXR0ZXItdmVydGljYWwge1xuICAgICAgY3Vyc29yOiByb3ctcmVzaXplO1xuICAgIH1cbiAgYH1cbmA7XG5cbmNvbnN0IHByb3BUeXBlcyA9IHtcbiAgdGFibGVzOiBQcm9wVHlwZXMuYXJyYXkuaXNSZXF1aXJlZCxcbiAgcXVlcnlFZGl0b3I6IFByb3BUeXBlcy5vYmplY3QuaXNSZXF1aXJlZCxcbiAgZGVmYXVsdFF1ZXJ5TGltaXQ6IFByb3BUeXBlcy5udW1iZXIuaXNSZXF1aXJlZCxcbiAgbWF4Um93OiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gIGRpc3BsYXlMaW1pdDogUHJvcFR5cGVzLm51bWJlci5pc1JlcXVpcmVkLFxuICBzYXZlUXVlcnlXYXJuaW5nOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBzY2hlZHVsZVF1ZXJ5V2FybmluZzogUHJvcFR5cGVzLnN0cmluZyxcbn07XG5cbmNvbnN0IGV4dGVuc2lvbnNSZWdpc3RyeSA9IGdldEV4dGVuc2lvbnNSZWdpc3RyeSgpO1xuXG5jb25zdCBTcWxFZGl0b3IgPSAoe1xuICB0YWJsZXMsXG4gIHF1ZXJ5RWRpdG9yLFxuICBkZWZhdWx0UXVlcnlMaW1pdCxcbiAgbWF4Um93LFxuICBkaXNwbGF5TGltaXQsXG4gIHNhdmVRdWVyeVdhcm5pbmcsXG4gIHNjaGVkdWxlUXVlcnlXYXJuaW5nID0gbnVsbCxcbn0pID0+IHtcbiAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICBjb25zdCBkaXNwYXRjaCA9IHVzZURpc3BhdGNoKCk7XG5cbiAgY29uc3QgeyBkYXRhYmFzZSwgbGF0ZXN0UXVlcnksIGhpZGVMZWZ0QmFyIH0gPSB1c2VTZWxlY3RvcihcbiAgICAoeyBzcWxMYWI6IHsgdW5zYXZlZFF1ZXJ5RWRpdG9yLCBkYXRhYmFzZXMsIHF1ZXJpZXMgfSB9KSA9PiB7XG4gICAgICBsZXQgeyBkYklkLCBsYXRlc3RRdWVyeUlkLCBoaWRlTGVmdEJhciB9ID0gcXVlcnlFZGl0b3I7XG4gICAgICBpZiAodW5zYXZlZFF1ZXJ5RWRpdG9yLmlkID09PSBxdWVyeUVkaXRvci5pZCkge1xuICAgICAgICBkYklkID0gdW5zYXZlZFF1ZXJ5RWRpdG9yLmRiSWQgfHwgZGJJZDtcbiAgICAgICAgbGF0ZXN0UXVlcnlJZCA9IHVuc2F2ZWRRdWVyeUVkaXRvci5sYXRlc3RRdWVyeUlkIHx8IGxhdGVzdFF1ZXJ5SWQ7XG4gICAgICAgIGhpZGVMZWZ0QmFyID0gdW5zYXZlZFF1ZXJ5RWRpdG9yLmhpZGVMZWZ0QmFyIHx8IGhpZGVMZWZ0QmFyO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgZGF0YWJhc2U6IGRhdGFiYXNlc1tkYklkXSxcbiAgICAgICAgbGF0ZXN0UXVlcnk6IHF1ZXJpZXNbbGF0ZXN0UXVlcnlJZF0sXG4gICAgICAgIGhpZGVMZWZ0QmFyLFxuICAgICAgfTtcbiAgICB9LFxuICAgIHNoYWxsb3dFcXVhbCxcbiAgKTtcblxuICBjb25zdCBbaGVpZ2h0LCBzZXRIZWlnaHRdID0gdXNlU3RhdGUoMCk7XG4gIGNvbnN0IFthdXRvcnVuLCBzZXRBdXRvcnVuXSA9IHVzZVN0YXRlKHF1ZXJ5RWRpdG9yLmF1dG9ydW4pO1xuICBjb25zdCBbY3Rhcywgc2V0Q3Rhc10gPSB1c2VTdGF0ZSgnJyk7XG4gIGNvbnN0IFtub3J0aFBlcmNlbnQsIHNldE5vcnRoUGVyY2VudF0gPSB1c2VTdGF0ZShcbiAgICBxdWVyeUVkaXRvci5ub3J0aFBlcmNlbnQgfHwgSU5JVElBTF9OT1JUSF9QRVJDRU5ULFxuICApO1xuICBjb25zdCBbc291dGhQZXJjZW50LCBzZXRTb3V0aFBlcmNlbnRdID0gdXNlU3RhdGUoXG4gICAgcXVlcnlFZGl0b3Iuc291dGhQZXJjZW50IHx8IElOSVRJQUxfU09VVEhfUEVSQ0VOVCxcbiAgKTtcbiAgY29uc3QgW2F1dG9jb21wbGV0ZUVuYWJsZWQsIHNldEF1dG9jb21wbGV0ZUVuYWJsZWRdID0gdXNlU3RhdGUoXG4gICAgZ2V0SXRlbShMb2NhbFN0b3JhZ2VLZXlzLnNxbGxhYl9faXNfYXV0b2NvbXBsZXRlX2VuYWJsZWQsIHRydWUpLFxuICApO1xuICBjb25zdCBbc2hvd0NyZWF0ZUFzTW9kYWwsIHNldFNob3dDcmVhdGVBc01vZGFsXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2NyZWF0ZUFzLCBzZXRDcmVhdGVBc10gPSB1c2VTdGF0ZSgnJyk7XG4gIGNvbnN0IFtzaG93RW1wdHlTdGF0ZSwgc2V0U2hvd0VtcHR5U3RhdGVdID0gdXNlU3RhdGUoZmFsc2UpO1xuXG4gIGNvbnN0IHNxbEVkaXRvclJlZiA9IHVzZVJlZihudWxsKTtcbiAgY29uc3Qgbm9ydGhQYW5lUmVmID0gdXNlUmVmKG51bGwpO1xuXG4gIGNvbnN0IFNxbEZvcm1FeHRlbnNpb24gPSBleHRlbnNpb25zUmVnaXN0cnkuZ2V0KCdzcWxlZGl0b3IuZXh0ZW5zaW9uLmZvcm0nKTtcblxuICBjb25zdCBzdGFydFF1ZXJ5ID0gdXNlQ2FsbGJhY2soXG4gICAgKGN0YXNBcmcgPSBmYWxzZSwgY3Rhc19tZXRob2QgPSBDdGFzRW51bS5UQUJMRSkgPT4ge1xuICAgICAgaWYgKCFkYXRhYmFzZSkge1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGRpc3BhdGNoKFxuICAgICAgICBydW5RdWVyeUZyb21TcWxFZGl0b3IoXG4gICAgICAgICAgZGF0YWJhc2UsXG4gICAgICAgICAgcXVlcnlFZGl0b3IsXG4gICAgICAgICAgZGVmYXVsdFF1ZXJ5TGltaXQsXG4gICAgICAgICAgY3Rhc0FyZyA/IGN0YXMgOiAnJyxcbiAgICAgICAgICBjdGFzQXJnLFxuICAgICAgICAgIGN0YXNfbWV0aG9kLFxuICAgICAgICApLFxuICAgICAgKTtcbiAgICAgIGRpc3BhdGNoKHNldEFjdGl2ZVNvdXRoUGFuZVRhYignUmVzdWx0cycpKTtcbiAgICB9LFxuICAgIFtjdGFzLCBkYXRhYmFzZSwgZGVmYXVsdFF1ZXJ5TGltaXQsIGRpc3BhdGNoLCBxdWVyeUVkaXRvcl0sXG4gICk7XG5cbiAgY29uc3Qgc3RvcFF1ZXJ5ID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgIGlmIChsYXRlc3RRdWVyeSAmJiBbJ3J1bm5pbmcnLCAncGVuZGluZyddLmluZGV4T2YobGF0ZXN0UXVlcnkuc3RhdGUpID49IDApIHtcbiAgICAgIGRpc3BhdGNoKHBvc3RTdG9wUXVlcnkobGF0ZXN0UXVlcnkpKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9LCBbZGlzcGF0Y2gsIGxhdGVzdFF1ZXJ5XSk7XG5cbiAgY29uc3QgcnVuUXVlcnkgPSAoKSA9PiB7XG4gICAgaWYgKGRhdGFiYXNlKSB7XG4gICAgICBzdGFydFF1ZXJ5KCk7XG4gICAgfVxuICB9O1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKGF1dG9ydW4pIHtcbiAgICAgIHNldEF1dG9ydW4oZmFsc2UpO1xuICAgICAgZGlzcGF0Y2gocXVlcnlFZGl0b3JTZXRBdXRvcnVuKHF1ZXJ5RWRpdG9yLCBmYWxzZSkpO1xuICAgICAgc3RhcnRRdWVyeSgpO1xuICAgIH1cbiAgfSwgW2F1dG9ydW4sIGRpc3BhdGNoLCBxdWVyeUVkaXRvciwgc3RhcnRRdWVyeV0pO1xuXG4gIC8vIE9uZSBsYXllciBvZiBhYnN0cmFjdGlvbiBmb3IgZWFzeSBzcHlpbmcgaW4gdW5pdCB0ZXN0c1xuICBjb25zdCBnZXRTcWxFZGl0b3JIZWlnaHQgPSAoKSA9PlxuICAgIHNxbEVkaXRvclJlZi5jdXJyZW50XG4gICAgICA/IHNxbEVkaXRvclJlZi5jdXJyZW50LmNsaWVudEhlaWdodCAtIFNRTF9FRElUT1JfUEFERElORyAqIDJcbiAgICAgIDogMDtcblxuICBjb25zdCBnZXRIb3RrZXlDb25maWcgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgLy8gR2V0IHRoZSB1c2VyJ3MgT1NcbiAgICBjb25zdCB1c2VyT1MgPSBkZXRlY3RPUygpO1xuICAgIGNvbnN0IGJhc2UgPSBbXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdydW5RdWVyeTEnLFxuICAgICAgICBrZXk6ICdjdHJsK3InLFxuICAgICAgICBkZXNjcjogdCgnUnVuIHF1ZXJ5JyksXG4gICAgICAgIGZ1bmM6ICgpID0+IHtcbiAgICAgICAgICBpZiAocXVlcnlFZGl0b3Iuc3FsLnRyaW0oKSAhPT0gJycpIHtcbiAgICAgICAgICAgIHN0YXJ0UXVlcnkoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgICAge1xuICAgICAgICBuYW1lOiAncnVuUXVlcnkyJyxcbiAgICAgICAga2V5OiAnY3RybCtlbnRlcicsXG4gICAgICAgIGRlc2NyOiB0KCdSdW4gcXVlcnknKSxcbiAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgIGlmIChxdWVyeUVkaXRvci5zcWwudHJpbSgpICE9PSAnJykge1xuICAgICAgICAgICAgc3RhcnRRdWVyeSgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICdydW5RdWVyeTMnLFxuICAgICAgICBrZXk6ICdjdHJsK3NoaWZ0K2VudGVyJyxcbiAgICAgICAgZGVzY3I6IHQoJ1J1biBjdXJyZW50IHF1ZXJ5JyksXG4gICAgICAgIGZ1bmM6IGVkaXRvciA9PiB7XG4gICAgICAgICAgaWYgKCFlZGl0b3IuZ2V0VmFsdWUoKS50cmltKCkpIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgY29uc3Qgc2Vzc2lvbiA9IGVkaXRvci5nZXRTZXNzaW9uKCk7XG4gICAgICAgICAgY29uc3QgY3Vyc29yUG9zaXRpb24gPSBlZGl0b3IuZ2V0Q3Vyc29yUG9zaXRpb24oKTtcbiAgICAgICAgICBjb25zdCB0b3RhbExpbmUgPSBzZXNzaW9uLmdldExlbmd0aCgpO1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3cgPSBlZGl0b3IuZ2V0Rmlyc3RWaXNpYmxlUm93KCk7XG4gICAgICAgICAgbGV0IGVuZCA9IGVkaXRvci5maW5kKCc7Jywge1xuICAgICAgICAgICAgYmFja3dhcmRzOiBmYWxzZSxcbiAgICAgICAgICAgIHNraXBDdXJyZW50OiB0cnVlLFxuICAgICAgICAgICAgc3RhcnQ6IGN1cnNvclBvc2l0aW9uLFxuICAgICAgICAgIH0pPy5lbmQ7XG4gICAgICAgICAgaWYgKCFlbmQgfHwgZW5kLnJvdyA8IGN1cnNvclBvc2l0aW9uLnJvdykge1xuICAgICAgICAgICAgZW5kID0ge1xuICAgICAgICAgICAgICByb3c6IHRvdGFsTGluZSArIDEsXG4gICAgICAgICAgICAgIGNvbHVtbjogMCxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGxldCBzdGFydCA9IGVkaXRvci5maW5kKCc7Jywge1xuICAgICAgICAgICAgYmFja3dhcmRzOiB0cnVlLFxuICAgICAgICAgICAgc2tpcEN1cnJlbnQ6IHRydWUsXG4gICAgICAgICAgICBzdGFydDogY3Vyc29yUG9zaXRpb24sXG4gICAgICAgICAgfSk/LmVuZDtcbiAgICAgICAgICBsZXQgY3VycmVudExpbmUgPSBlZGl0b3IuZmluZCgnOycsIHtcbiAgICAgICAgICAgIGJhY2t3YXJkczogdHJ1ZSxcbiAgICAgICAgICAgIHNraXBDdXJyZW50OiB0cnVlLFxuICAgICAgICAgICAgc3RhcnQ6IGN1cnNvclBvc2l0aW9uLFxuICAgICAgICAgIH0pPy5lbmQ/LnJvdztcbiAgICAgICAgICBpZiAoXG4gICAgICAgICAgICAhY3VycmVudExpbmUgfHxcbiAgICAgICAgICAgIGN1cnJlbnRMaW5lID4gY3Vyc29yUG9zaXRpb24ucm93IHx8XG4gICAgICAgICAgICAoY3VycmVudExpbmUgPT09IGN1cnNvclBvc2l0aW9uLnJvdyAmJlxuICAgICAgICAgICAgICBzdGFydD8uY29sdW1uID4gY3Vyc29yUG9zaXRpb24uY29sdW1uKVxuICAgICAgICAgICkge1xuICAgICAgICAgICAgY3VycmVudExpbmUgPSAwO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsZXQgY29udGVudCA9XG4gICAgICAgICAgICBjdXJyZW50TGluZSA9PT0gc3RhcnQ/LnJvd1xuICAgICAgICAgICAgICA/IHNlc3Npb24uZ2V0TGluZShjdXJyZW50TGluZSkuc2xpY2Uoc3RhcnQuY29sdW1uKS50cmltKClcbiAgICAgICAgICAgICAgOiBzZXNzaW9uLmdldExpbmUoY3VycmVudExpbmUpLnRyaW0oKTtcbiAgICAgICAgICB3aGlsZSAoIWNvbnRlbnQgJiYgY3VycmVudExpbmUgPCB0b3RhbExpbmUpIHtcbiAgICAgICAgICAgIGN1cnJlbnRMaW5lICs9IDE7XG4gICAgICAgICAgICBjb250ZW50ID0gc2Vzc2lvbi5nZXRMaW5lKGN1cnJlbnRMaW5lKS50cmltKCk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGlmIChjdXJyZW50TGluZSAhPT0gc3RhcnQ/LnJvdykge1xuICAgICAgICAgICAgc3RhcnQgPSB7IHJvdzogY3VycmVudExpbmUsIGNvbHVtbjogMCB9O1xuICAgICAgICAgIH1cbiAgICAgICAgICBlZGl0b3Iuc2VsZWN0aW9uLnNldFJhbmdlKHtcbiAgICAgICAgICAgIHN0YXJ0OiBzdGFydCA/PyB7IHJvdzogMCwgY29sdW1uOiAwIH0sXG4gICAgICAgICAgICBlbmQsXG4gICAgICAgICAgfSk7XG4gICAgICAgICAgc3RhcnRRdWVyeSgpO1xuICAgICAgICAgIGVkaXRvci5zZWxlY3Rpb24uY2xlYXJTZWxlY3Rpb24oKTtcbiAgICAgICAgICBlZGl0b3IubW92ZUN1cnNvclRvUG9zaXRpb24oY3Vyc29yUG9zaXRpb24pO1xuICAgICAgICAgIGVkaXRvci5zY3JvbGxUb1JvdyhjdXJyZW50Um93KTtcbiAgICAgICAgfSxcbiAgICAgIH0sXG4gICAgICB7XG4gICAgICAgIG5hbWU6ICduZXdUYWInLFxuICAgICAgICBrZXk6IHVzZXJPUyA9PT0gJ1dpbmRvd3MnID8gJ2N0cmwrcScgOiAnY3RybCt0JyxcbiAgICAgICAgZGVzY3I6IHQoJ05ldyB0YWInKSxcbiAgICAgICAgZnVuYzogKCkgPT4ge1xuICAgICAgICAgIGRpc3BhdGNoKGFkZE5ld1F1ZXJ5RWRpdG9yKCkpO1xuICAgICAgICB9LFxuICAgICAgfSxcbiAgICAgIHtcbiAgICAgICAgbmFtZTogJ3N0b3BRdWVyeScsXG4gICAgICAgIGtleTogdXNlck9TID09PSAnTWFjT1MnID8gJ2N0cmwreCcgOiAnY3RybCtlJyxcbiAgICAgICAgZGVzY3I6IHQoJ1N0b3AgcXVlcnknKSxcbiAgICAgICAgZnVuYzogc3RvcFF1ZXJ5LFxuICAgICAgfSxcbiAgICBdO1xuXG4gICAgaWYgKHVzZXJPUyA9PT0gJ01hY09TJykge1xuICAgICAgYmFzZS5wdXNoKHtcbiAgICAgICAgbmFtZTogJ3ByZXZpb3VzTGluZScsXG4gICAgICAgIGtleTogJ2N0cmwrcCcsXG4gICAgICAgIGRlc2NyOiB0KCdQcmV2aW91cyBMaW5lJyksXG4gICAgICAgIGZ1bmM6IGVkaXRvciA9PiB7XG4gICAgICAgICAgZWRpdG9yLm5hdmlnYXRlVXAoMSk7XG4gICAgICAgIH0sXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICByZXR1cm4gYmFzZTtcbiAgfSwgW2Rpc3BhdGNoLCBxdWVyeUVkaXRvci5zcWwsIHN0YXJ0UXVlcnksIHN0b3BRdWVyeV0pO1xuXG4gIGNvbnN0IG9uQmVmb3JlVW5sb2FkID0gdXNlRWZmZWN0RXZlbnQoZXZlbnQgPT4ge1xuICAgIGlmIChcbiAgICAgIGRhdGFiYXNlPy5leHRyYV9qc29uPy5jYW5jZWxfcXVlcnlfb25fd2luZG93c191bmxvYWQgJiZcbiAgICAgIGxhdGVzdFF1ZXJ5Py5zdGF0ZSA9PT0gJ3J1bm5pbmcnXG4gICAgKSB7XG4gICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgc3RvcFF1ZXJ5KCk7XG4gICAgfVxuICB9KTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIC8vIFdlIG5lZWQgdG8gbWVhc3VyZSB0aGUgaGVpZ2h0IG9mIHRoZSBzcWwgZWRpdG9yIHBvc3QgcmVuZGVyIHRvIGZpZ3VyZSB0aGUgaGVpZ2h0IG9mXG4gICAgLy8gdGhlIHNvdXRoIHBhbmUgc28gaXQgZ2V0cyByZW5kZXJlZCBwcm9wZXJseVxuICAgIHNldEhlaWdodChnZXRTcWxFZGl0b3JIZWlnaHQoKSk7XG4gICAgY29uc3QgaGFuZGxlV2luZG93UmVzaXplV2l0aFRocm90dGxlID0gdGhyb3R0bGUoXG4gICAgICAoKSA9PiBzZXRIZWlnaHQoZ2V0U3FsRWRpdG9ySGVpZ2h0KCkpLFxuICAgICAgV0lORE9XX1JFU0laRV9USFJPVFRMRV9NUyxcbiAgICApO1xuXG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIGhhbmRsZVdpbmRvd1Jlc2l6ZVdpdGhUaHJvdHRsZSk7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ2JlZm9yZXVubG9hZCcsIG9uQmVmb3JlVW5sb2FkKTtcblxuICAgIHJldHVybiAoKSA9PiB7XG4gICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigncmVzaXplJywgaGFuZGxlV2luZG93UmVzaXplV2l0aFRocm90dGxlKTtcbiAgICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdiZWZvcmV1bmxvYWQnLCBvbkJlZm9yZVVubG9hZCk7XG4gICAgfTtcbiAgICAvLyBUT0RPOiBSZW1vdmUgdXNlRWZmZWN0RXZlbnQgZGVwcyBvbmNlIGh0dHBzOi8vZ2l0aHViLmNvbS9mYWNlYm9vay9yZWFjdC9wdWxsLzI1ODgxIGlzIHJlbGVhc2VkXG4gIH0sIFtvbkJlZm9yZVVubG9hZF0pO1xuXG4gIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgaWYgKCFkYXRhYmFzZSB8fCBpc0VtcHR5KGRhdGFiYXNlKSkge1xuICAgICAgc2V0U2hvd0VtcHR5U3RhdGUodHJ1ZSk7XG4gICAgfVxuICB9LCBbZGF0YWJhc2VdKTtcblxuICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgIC8vIHNldHVwIGhvdGtleXNcbiAgICBNb3VzZXRyYXAucmVzZXQoKTtcbiAgICBjb25zdCBob3RrZXlzID0gZ2V0SG90a2V5Q29uZmlnKCk7XG4gICAgaG90a2V5cy5mb3JFYWNoKGtleUNvbmZpZyA9PiB7XG4gICAgICBNb3VzZXRyYXAuYmluZChba2V5Q29uZmlnLmtleV0sIGtleUNvbmZpZy5mdW5jKTtcbiAgICB9KTtcbiAgfSwgW2dldEhvdGtleUNvbmZpZywgbGF0ZXN0UXVlcnldKTtcblxuICBjb25zdCBvblJlc2l6ZVN0YXJ0ID0gKCkgPT4ge1xuICAgIC8vIFNldCB0aGUgaGVpZ2h0cyBvbiB0aGUgYWNlIGVkaXRvciBhbmQgdGhlIGFjZSBjb250ZW50IGFyZWEgYWZ0ZXIgZHJhZyBzdGFydHNcbiAgICAvLyB0byBzbW9vdGggb3V0IHRoZSB2aXN1YWwgdHJhbnNpdGlvbiB0byB0aGUgbmV3IGhlaWdodHMgd2hlbiBkcmFnIGVuZHNcbiAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKCdhY2VfY29udGVudCcpWzBdLnN0eWxlLmhlaWdodCA9ICcxMDAlJztcbiAgfTtcblxuICBjb25zdCBvblJlc2l6ZUVuZCA9IChbbm9ydGhQZXJjZW50LCBzb3V0aFBlcmNlbnRdKSA9PiB7XG4gICAgc2V0Tm9ydGhQZXJjZW50KG5vcnRoUGVyY2VudCk7XG4gICAgc2V0U291dGhQZXJjZW50KHNvdXRoUGVyY2VudCk7XG5cbiAgICBpZiAobm9ydGhQYW5lUmVmLmN1cnJlbnQ/LmNsaWVudEhlaWdodCkge1xuICAgICAgZGlzcGF0Y2gocGVyc2lzdEVkaXRvckhlaWdodChxdWVyeUVkaXRvciwgbm9ydGhQZXJjZW50LCBzb3V0aFBlcmNlbnQpKTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3Qgc2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsID0gdXNlQ2FsbGJhY2soXG4gICAgc3FsID0+IHtcbiAgICAgIGRpc3BhdGNoKHF1ZXJ5RWRpdG9yU2V0QW5kU2F2ZVNxbChxdWVyeUVkaXRvciwgc3FsKSk7XG4gICAgfSxcbiAgICBbZGlzcGF0Y2gsIHF1ZXJ5RWRpdG9yXSxcbiAgKTtcblxuICBjb25zdCBzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWxXaXRoRGVib3VuY2UgPSB1c2VNZW1vKFxuICAgICgpID0+IGRlYm91bmNlKHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbCwgU0VUX1FVRVJZX0VESVRPUl9TUUxfREVCT1VOQ0VfTVMpLFxuICAgIFtzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWxdLFxuICApO1xuXG4gIGNvbnN0IG9uU3FsQ2hhbmdlZCA9IHNxbCA9PiB7XG4gICAgZGlzcGF0Y2gocXVlcnlFZGl0b3JTZXRTcWwocXVlcnlFZGl0b3IsIHNxbCkpO1xuICAgIHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbFdpdGhEZWJvdW5jZShzcWwpO1xuICB9O1xuXG4gIC8vIFJldHVybiB0aGUgaGVpZ2h0cyBmb3IgdGhlIGFjZSBlZGl0b3IgYW5kIHRoZSBzb3V0aCBwYW5lIGFzIGFuIG9iamVjdFxuICAvLyBnaXZlbiB0aGUgaGVpZ2h0IG9mIHRoZSBzcWwgZWRpdG9yLCBub3J0aCBwYW5lIHBlcmNlbnQgYW5kIHNvdXRoIHBhbmUgcGVyY2VudC5cbiAgY29uc3QgZ2V0QWNlRWRpdG9yQW5kU291dGhQYW5lSGVpZ2h0cyA9IChcbiAgICBoZWlnaHQsXG4gICAgbm9ydGhQZXJjZW50LFxuICAgIHNvdXRoUGVyY2VudCxcbiAgKSA9PiAoe1xuICAgIGFjZUVkaXRvckhlaWdodDpcbiAgICAgIChoZWlnaHQgKiBub3J0aFBlcmNlbnQpIC8gKHRoZW1lLmdyaWRVbml0ICogMjUpIC1cbiAgICAgIChTUUxfRURJVE9SX0dVVFRFUl9IRUlHSFQgLyAyICsgU1FMX0VESVRPUl9HVVRURVJfTUFSR0lOKSAtXG4gICAgICBTUUxfVE9PTEJBUl9IRUlHSFQsXG4gICAgc291dGhQYW5lSGVpZ2h0OlxuICAgICAgKGhlaWdodCAqIHNvdXRoUGVyY2VudCkgLyAodGhlbWUuZ3JpZFVuaXQgKiAyNSkgLVxuICAgICAgKFNRTF9FRElUT1JfR1VUVEVSX0hFSUdIVCAvIDIgKyBTUUxfRURJVE9SX0dVVFRFUl9NQVJHSU4pLFxuICB9KTtcblxuICBjb25zdCBnZXRRdWVyeUNvc3RFc3RpbWF0ZSA9ICgpID0+IHtcbiAgICBpZiAoZGF0YWJhc2UpIHtcbiAgICAgIGRpc3BhdGNoKGVzdGltYXRlUXVlcnlDb3N0KHF1ZXJ5RWRpdG9yKSk7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IGhhbmRsZVRvZ2dsZUF1dG9jb21wbGV0ZUVuYWJsZWQgPSAoKSA9PiB7XG4gICAgc2V0SXRlbShcbiAgICAgIExvY2FsU3RvcmFnZUtleXMuc3FsbGFiX19pc19hdXRvY29tcGxldGVfZW5hYmxlZCxcbiAgICAgICFhdXRvY29tcGxldGVFbmFibGVkLFxuICAgICk7XG4gICAgc2V0QXV0b2NvbXBsZXRlRW5hYmxlZCghYXV0b2NvbXBsZXRlRW5hYmxlZCk7XG4gIH07XG5cbiAgY29uc3QgZWxlbWVudFN0eWxlID0gKGRpbWVuc2lvbiwgZWxlbWVudFNpemUsIGd1dHRlclNpemUpID0+ICh7XG4gICAgW2RpbWVuc2lvbl06IGBjYWxjKCR7ZWxlbWVudFNpemV9JSAtICR7XG4gICAgICBndXR0ZXJTaXplICsgU1FMX0VESVRPUl9HVVRURVJfTUFSR0lOXG4gICAgfXB4KWAsXG4gIH0pO1xuXG4gIGNvbnN0IGNyZWF0ZVRhYmxlQXMgPSAoKSA9PiB7XG4gICAgc3RhcnRRdWVyeSh0cnVlLCBDdGFzRW51bS5UQUJMRSk7XG4gICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwoZmFsc2UpO1xuICAgIHNldEN0YXMoJycpO1xuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZVZpZXdBcyA9ICgpID0+IHtcbiAgICBzdGFydFF1ZXJ5KHRydWUsIEN0YXNFbnVtLlZJRVcpO1xuICAgIHNldFNob3dDcmVhdGVBc01vZGFsKGZhbHNlKTtcbiAgICBzZXRDdGFzKCcnKTtcbiAgfTtcblxuICBjb25zdCBjdGFzQ2hhbmdlZCA9IGV2ZW50ID0+IHtcbiAgICBzZXRDdGFzKGV2ZW50LnRhcmdldC52YWx1ZSk7XG4gIH07XG5cbiAgY29uc3QgcmVuZGVyRHJvcGRvd24gPSAoKSA9PiB7XG4gICAgY29uc3QgcWUgPSBxdWVyeUVkaXRvcjtcbiAgICBjb25zdCBzdWNjZXNzZnVsID0gbGF0ZXN0UXVlcnk/LnN0YXRlID09PSAnc3VjY2Vzcyc7XG4gICAgY29uc3Qgc2NoZWR1bGVUb29sVGlwID0gc3VjY2Vzc2Z1bFxuICAgICAgPyB0KCdTY2hlZHVsZSB0aGUgcXVlcnkgcGVyaW9kaWNhbGx5JylcbiAgICAgIDogdCgnWW91IG11c3QgcnVuIHRoZSBxdWVyeSBzdWNjZXNzZnVsbHkgZmlyc3QnKTtcbiAgICByZXR1cm4gKFxuICAgICAgPE1lbnUgY3NzPXt7IHdpZHRoOiB0aGVtZS5ncmlkVW5pdCAqIDQ0IH19PlxuICAgICAgICA8TWVudS5JdGVtIGNzcz17eyBkaXNwbGF5OiAnZmxleCcsIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicgfX0+XG4gICAgICAgICAgeycgJ31cbiAgICAgICAgICA8c3Bhbj57dCgnQXV0b2NvbXBsZXRlJyl9PC9zcGFuPnsnICd9XG4gICAgICAgICAgPEFudGRTd2l0Y2hcbiAgICAgICAgICAgIGNoZWNrZWQ9e2F1dG9jb21wbGV0ZUVuYWJsZWR9XG4gICAgICAgICAgICBvbkNoYW5nZT17aGFuZGxlVG9nZ2xlQXV0b2NvbXBsZXRlRW5hYmxlZH1cbiAgICAgICAgICAgIG5hbWU9XCJhdXRvY29tcGxldGUtc3dpdGNoXCJcbiAgICAgICAgICAvPnsnICd9XG4gICAgICAgIDwvTWVudS5JdGVtPlxuICAgICAgICB7aXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5FTkFCTEVfVEVNUExBVEVfUFJPQ0VTU0lORykgJiYgKFxuICAgICAgICAgIDxNZW51Lkl0ZW0+XG4gICAgICAgICAgICA8VGVtcGxhdGVQYXJhbXNFZGl0b3JcbiAgICAgICAgICAgICAgbGFuZ3VhZ2U9XCJqc29uXCJcbiAgICAgICAgICAgICAgb25DaGFuZ2U9e3BhcmFtcyA9PiB7XG4gICAgICAgICAgICAgICAgZGlzcGF0Y2gocXVlcnlFZGl0b3JTZXRUZW1wbGF0ZVBhcmFtcyhxZSwgcGFyYW1zKSk7XG4gICAgICAgICAgICAgIH19XG4gICAgICAgICAgICAgIHF1ZXJ5RWRpdG9ySWQ9e3FlLmlkfVxuICAgICAgICAgICAgLz5cbiAgICAgICAgICA8L01lbnUuSXRlbT5cbiAgICAgICAgKX1cbiAgICAgICAgeyFpc0VtcHR5KHNjaGVkdWxlZFF1ZXJpZXNDb25mKSAmJiAoXG4gICAgICAgICAgPE1lbnUuSXRlbT5cbiAgICAgICAgICAgIDxTY2hlZHVsZVF1ZXJ5QnV0dG9uXG4gICAgICAgICAgICAgIGRlZmF1bHRMYWJlbD17cWUubmFtZX1cbiAgICAgICAgICAgICAgc3FsPXtxZS5zcWx9XG4gICAgICAgICAgICAgIG9uU2NoZWR1bGU9e3F1ZXJ5ID0+IGRpc3BhdGNoKHNjaGVkdWxlUXVlcnkocXVlcnkpKX1cbiAgICAgICAgICAgICAgc2NoZW1hPXtxZS5zY2hlbWF9XG4gICAgICAgICAgICAgIGRiSWQ9e3FlLmRiSWR9XG4gICAgICAgICAgICAgIHNjaGVkdWxlUXVlcnlXYXJuaW5nPXtzY2hlZHVsZVF1ZXJ5V2FybmluZ31cbiAgICAgICAgICAgICAgdG9vbHRpcD17c2NoZWR1bGVUb29sVGlwfVxuICAgICAgICAgICAgICBkaXNhYmxlZD17IXN1Y2Nlc3NmdWx9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvTWVudS5JdGVtPlxuICAgICAgICApfVxuICAgICAgPC9NZW51PlxuICAgICk7XG4gIH07XG5cbiAgY29uc3Qgb25TYXZlUXVlcnkgPSBhc3luYyAocXVlcnksIGNsaWVudElkKSA9PiB7XG4gICAgY29uc3Qgc2F2ZWRRdWVyeSA9IGF3YWl0IGRpc3BhdGNoKHNhdmVRdWVyeShxdWVyeSwgY2xpZW50SWQpKTtcbiAgICBkaXNwYXRjaChhZGRTYXZlZFF1ZXJ5VG9UYWJTdGF0ZShxdWVyeUVkaXRvciwgc2F2ZWRRdWVyeSkpO1xuICB9O1xuXG4gIGNvbnN0IHJlbmRlckVkaXRvckJvdHRvbUJhciA9ICgpID0+IHtcbiAgICBjb25zdCB7IGFsbG93X2N0YXM6IGFsbG93Q1RBUywgYWxsb3dfY3ZhczogYWxsb3dDVkFTIH0gPSBkYXRhYmFzZSB8fCB7fTtcblxuICAgIGNvbnN0IHNob3dNZW51ID0gYWxsb3dDVEFTIHx8IGFsbG93Q1ZBUztcbiAgICBjb25zdCBydW5NZW51QnRuID0gKFxuICAgICAgPE1lbnU+XG4gICAgICAgIHthbGxvd0NUQVMgJiYgKFxuICAgICAgICAgIDxNZW51Lkl0ZW1cbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwodHJ1ZSk7XG4gICAgICAgICAgICAgIHNldENyZWF0ZUFzKEN0YXNFbnVtLlRBQkxFKTtcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgICBrZXk9XCIxXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICB7dCgnQ1JFQVRFIFRBQkxFIEFTJyl9XG4gICAgICAgICAgPC9NZW51Lkl0ZW0+XG4gICAgICAgICl9XG4gICAgICAgIHthbGxvd0NWQVMgJiYgKFxuICAgICAgICAgIDxNZW51Lkl0ZW1cbiAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgc2V0U2hvd0NyZWF0ZUFzTW9kYWwodHJ1ZSk7XG4gICAgICAgICAgICAgIHNldENyZWF0ZUFzKEN0YXNFbnVtLlZJRVcpO1xuICAgICAgICAgICAgfX1cbiAgICAgICAgICAgIGtleT1cIjJcIlxuICAgICAgICAgID5cbiAgICAgICAgICAgIHt0KCdDUkVBVEUgVklFVyBBUycpfVxuICAgICAgICAgIDwvTWVudS5JdGVtPlxuICAgICAgICApfVxuICAgICAgPC9NZW51PlxuICAgICk7XG5cbiAgICByZXR1cm4gKFxuICAgICAgPFN0eWxlZFRvb2xiYXIgY2xhc3NOYW1lPVwic3FsLXRvb2xiYXJcIiBpZD1cImpzLXNxbC10b29sYmFyXCI+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwibGVmdEl0ZW1zXCI+XG4gICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICA8UnVuUXVlcnlBY3Rpb25CdXR0b25cbiAgICAgICAgICAgICAgYWxsb3dBc3luYz17ZGF0YWJhc2UgPyBkYXRhYmFzZS5hbGxvd19ydW5fYXN5bmMgOiBmYWxzZX1cbiAgICAgICAgICAgICAgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9XG4gICAgICAgICAgICAgIHF1ZXJ5U3RhdGU9e2xhdGVzdFF1ZXJ5Py5zdGF0ZX1cbiAgICAgICAgICAgICAgcnVuUXVlcnk9e3J1blF1ZXJ5fVxuICAgICAgICAgICAgICBzdG9wUXVlcnk9e3N0b3BRdWVyeX1cbiAgICAgICAgICAgICAgb3ZlcmxheUNyZWF0ZUFzTWVudT17c2hvd01lbnUgPyBydW5NZW51QnRuIDogbnVsbH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIHtpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkVTVElNQVRFX1FVRVJZX0NPU1QpICYmXG4gICAgICAgICAgICBkYXRhYmFzZT8uYWxsb3dzX2Nvc3RfZXN0aW1hdGUgJiYgKFxuICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICA8RXN0aW1hdGVRdWVyeUNvc3RCdXR0b25cbiAgICAgICAgICAgICAgICAgIGdldEVzdGltYXRlPXtnZXRRdWVyeUNvc3RFc3RpbWF0ZX1cbiAgICAgICAgICAgICAgICAgIHF1ZXJ5RWRpdG9ySWQ9e3F1ZXJ5RWRpdG9yLmlkfVxuICAgICAgICAgICAgICAgICAgdG9vbHRpcD17dCgnRXN0aW1hdGUgdGhlIGNvc3QgYmVmb3JlIHJ1bm5pbmcgYSBxdWVyeScpfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICA8UXVlcnlMaW1pdFNlbGVjdFxuICAgICAgICAgICAgICBxdWVyeUVkaXRvcklkPXtxdWVyeUVkaXRvci5pZH1cbiAgICAgICAgICAgICAgbWF4Um93PXttYXhSb3d9XG4gICAgICAgICAgICAgIGRlZmF1bHRRdWVyeUxpbWl0PXtkZWZhdWx0UXVlcnlMaW1pdH1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIHtsYXRlc3RRdWVyeSAmJiAoXG4gICAgICAgICAgICA8VGltZXJcbiAgICAgICAgICAgICAgc3RhcnRUaW1lPXtsYXRlc3RRdWVyeS5zdGFydER0dG19XG4gICAgICAgICAgICAgIGVuZFRpbWU9e2xhdGVzdFF1ZXJ5LmVuZER0dG19XG4gICAgICAgICAgICAgIHN0YXRlPXtTVEFURV9UWVBFX01BUFtsYXRlc3RRdWVyeS5zdGF0ZV19XG4gICAgICAgICAgICAgIGlzUnVubmluZz17bGF0ZXN0UXVlcnkuc3RhdGUgPT09ICdydW5uaW5nJ31cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxkaXYgY2xhc3NOYW1lPVwicmlnaHRJdGVtc1wiPlxuICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgPFNhdmVRdWVyeVxuICAgICAgICAgICAgICBxdWVyeUVkaXRvcklkPXtxdWVyeUVkaXRvci5pZH1cbiAgICAgICAgICAgICAgY29sdW1ucz17bGF0ZXN0UXVlcnk/LnJlc3VsdHM/LmNvbHVtbnMgfHwgW119XG4gICAgICAgICAgICAgIG9uU2F2ZT17b25TYXZlUXVlcnl9XG4gICAgICAgICAgICAgIG9uVXBkYXRlPXsocXVlcnksIHJlbW90ZUlkLCBpZCkgPT5cbiAgICAgICAgICAgICAgICBkaXNwYXRjaCh1cGRhdGVTYXZlZFF1ZXJ5KHF1ZXJ5LCByZW1vdGVJZCwgaWQpKVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIHNhdmVRdWVyeVdhcm5pbmc9e3NhdmVRdWVyeVdhcm5pbmd9XG4gICAgICAgICAgICAgIGRhdGFiYXNlPXtkYXRhYmFzZX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgPFNoYXJlU3FsTGFiUXVlcnkgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9IC8+XG4gICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgIDxBbnRkRHJvcGRvd24gb3ZlcmxheT17cmVuZGVyRHJvcGRvd24oKX0gdHJpZ2dlcj1cImNsaWNrXCI+XG4gICAgICAgICAgICA8SWNvbnMuTW9yZUhvcml6IGljb25Db2xvcj17dGhlbWUuY29sb3JzLmdyYXlzY2FsZS5iYXNlfSAvPlxuICAgICAgICAgIDwvQW50ZERyb3Bkb3duPlxuICAgICAgICA8L2Rpdj5cbiAgICAgIDwvU3R5bGVkVG9vbGJhcj5cbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IHF1ZXJ5UGFuZSA9ICgpID0+IHtcbiAgICBjb25zdCBob3RrZXlzID0gZ2V0SG90a2V5Q29uZmlnKCk7XG4gICAgY29uc3QgeyBhY2VFZGl0b3JIZWlnaHQsIHNvdXRoUGFuZUhlaWdodCB9ID1cbiAgICAgIGdldEFjZUVkaXRvckFuZFNvdXRoUGFuZUhlaWdodHMoaGVpZ2h0LCBub3J0aFBlcmNlbnQsIHNvdXRoUGVyY2VudCk7XG4gICAgcmV0dXJuIChcbiAgICAgIDxTcGxpdFxuICAgICAgICBleHBhbmRUb01pblxuICAgICAgICBjbGFzc05hbWU9XCJxdWVyeVBhbmVcIlxuICAgICAgICBzaXplcz17W25vcnRoUGVyY2VudCwgc291dGhQZXJjZW50XX1cbiAgICAgICAgZWxlbWVudFN0eWxlPXtlbGVtZW50U3R5bGV9XG4gICAgICAgIG1pblNpemU9ezIwMH1cbiAgICAgICAgZGlyZWN0aW9uPVwidmVydGljYWxcIlxuICAgICAgICBndXR0ZXJTaXplPXtTUUxfRURJVE9SX0dVVFRFUl9IRUlHSFR9XG4gICAgICAgIG9uRHJhZ1N0YXJ0PXtvblJlc2l6ZVN0YXJ0fVxuICAgICAgICBvbkRyYWdFbmQ9e29uUmVzaXplRW5kfVxuICAgICAgPlxuICAgICAgICA8ZGl2IHJlZj17bm9ydGhQYW5lUmVmfSBjbGFzc05hbWU9XCJub3J0aC1wYW5lXCI+XG4gICAgICAgICAge1NxbEZvcm1FeHRlbnNpb24gJiYgKFxuICAgICAgICAgICAgPFNxbEZvcm1FeHRlbnNpb25cbiAgICAgICAgICAgICAgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9XG4gICAgICAgICAgICAgIHNldFF1ZXJ5RWRpdG9yQW5kU2F2ZVNxbFdpdGhEZWJvdW5jZT17XG4gICAgICAgICAgICAgICAgc2V0UXVlcnlFZGl0b3JBbmRTYXZlU3FsV2l0aERlYm91bmNlXG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgc3RhcnRRdWVyeT17c3RhcnRRdWVyeX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgICA8QWNlRWRpdG9yV3JhcHBlclxuICAgICAgICAgICAgYXV0b2NvbXBsZXRlPXthdXRvY29tcGxldGVFbmFibGVkfVxuICAgICAgICAgICAgb25CbHVyPXtzZXRRdWVyeUVkaXRvckFuZFNhdmVTcWx9XG4gICAgICAgICAgICBvbkNoYW5nZT17b25TcWxDaGFuZ2VkfVxuICAgICAgICAgICAgcXVlcnlFZGl0b3JJZD17cXVlcnlFZGl0b3IuaWR9XG4gICAgICAgICAgICBoZWlnaHQ9e2Ake2FjZUVkaXRvckhlaWdodH1weGB9XG4gICAgICAgICAgICBob3RrZXlzPXtob3RrZXlzfVxuICAgICAgICAgIC8+XG4gICAgICAgICAge3JlbmRlckVkaXRvckJvdHRvbUJhcihob3RrZXlzKX1cbiAgICAgICAgPC9kaXY+XG4gICAgICAgIDxTb3V0aFBhbmVcbiAgICAgICAgICBxdWVyeUVkaXRvcklkPXtxdWVyeUVkaXRvci5pZH1cbiAgICAgICAgICBsYXRlc3RRdWVyeUlkPXtsYXRlc3RRdWVyeT8uaWR9XG4gICAgICAgICAgaGVpZ2h0PXtzb3V0aFBhbmVIZWlnaHR9XG4gICAgICAgICAgZGlzcGxheUxpbWl0PXtkaXNwbGF5TGltaXR9XG4gICAgICAgICAgZGVmYXVsdFF1ZXJ5TGltaXQ9e2RlZmF1bHRRdWVyeUxpbWl0fVxuICAgICAgICAvPlxuICAgICAgPC9TcGxpdD5cbiAgICApO1xuICB9O1xuXG4gIGNvbnN0IGNyZWF0ZVZpZXdNb2RhbFRpdGxlID1cbiAgICBjcmVhdGVBcyA9PT0gQ3Rhc0VudW0uVklFVyA/ICdDUkVBVEUgVklFVyBBUycgOiAnQ1JFQVRFIFRBQkxFIEFTJztcblxuICBjb25zdCBjcmVhdGVNb2RhbFBsYWNlSG9sZGVyID1cbiAgICBjcmVhdGVBcyA9PT0gQ3Rhc0VudW0uVklFV1xuICAgICAgPyB0KCdTcGVjaWZ5IG5hbWUgdG8gQ1JFQVRFIFZJRVcgQVMgc2NoZW1hIGluOiBwdWJsaWMnKVxuICAgICAgOiB0KCdTcGVjaWZ5IG5hbWUgdG8gQ1JFQVRFIFRBQkxFIEFTIHNjaGVtYSBpbjogcHVibGljJyk7XG5cbiAgY29uc3QgbGVmdEJhclN0YXRlQ2xhc3MgPSBoaWRlTGVmdEJhclxuICAgID8gJ3NjaGVtYVBhbmUtZXhpdC1kb25lJ1xuICAgIDogJ3NjaGVtYVBhbmUtZW50ZXItZG9uZSc7XG4gIHJldHVybiAoXG4gICAgPFN0eWxlZFNxbEVkaXRvciByZWY9e3NxbEVkaXRvclJlZn0gY2xhc3NOYW1lPVwiU3FsRWRpdG9yXCI+XG4gICAgICA8Q1NTVHJhbnNpdGlvbiBjbGFzc05hbWVzPVwic2NoZW1hUGFuZVwiIGluPXshaGlkZUxlZnRCYXJ9IHRpbWVvdXQ9ezMwMH0+XG4gICAgICAgIDxSZXNpemFibGVTaWRlYmFyXG4gICAgICAgICAgaWQ9e2BzcWxsYWI6JHtxdWVyeUVkaXRvci5pZH1gfVxuICAgICAgICAgIG1pbldpZHRoPXtTUUxfRURJVE9SX0xFRlRCQVJfV0lEVEh9XG4gICAgICAgICAgaW5pdGlhbFdpZHRoPXtTUUxfRURJVE9SX0xFRlRCQVJfV0lEVEh9XG4gICAgICAgICAgZW5hYmxlPXshaGlkZUxlZnRCYXJ9XG4gICAgICAgID5cbiAgICAgICAgICB7YWRqdXN0ZWRXaWR0aCA9PiAoXG4gICAgICAgICAgICA8U3R5bGVkU2lkZWJhclxuICAgICAgICAgICAgICBjbGFzc05hbWU9e2BzY2hlbWFQYW5lICR7bGVmdEJhclN0YXRlQ2xhc3N9YH1cbiAgICAgICAgICAgICAgd2lkdGg9e2FkanVzdGVkV2lkdGh9XG4gICAgICAgICAgICAgIGhpZGU9e2hpZGVMZWZ0QmFyfVxuICAgICAgICAgICAgPlxuICAgICAgICAgICAgICA8U3FsRWRpdG9yTGVmdEJhclxuICAgICAgICAgICAgICAgIGRhdGFiYXNlPXtkYXRhYmFzZX1cbiAgICAgICAgICAgICAgICBxdWVyeUVkaXRvcklkPXtxdWVyeUVkaXRvci5pZH1cbiAgICAgICAgICAgICAgICB0YWJsZXM9e3RhYmxlc31cbiAgICAgICAgICAgICAgICBzZXRFbXB0eVN0YXRlPXtib29sID0+IHNldFNob3dFbXB0eVN0YXRlKGJvb2wpfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9TdHlsZWRTaWRlYmFyPlxuICAgICAgICAgICl9XG4gICAgICAgIDwvUmVzaXphYmxlU2lkZWJhcj5cbiAgICAgIDwvQ1NTVHJhbnNpdGlvbj5cbiAgICAgIHtzaG93RW1wdHlTdGF0ZSA/IChcbiAgICAgICAgPEVtcHR5U3RhdGVCaWdcbiAgICAgICAgICBpbWFnZT1cInZlY3Rvci5zdmdcIlxuICAgICAgICAgIHRpdGxlPXt0KCdTZWxlY3QgYSBkYXRhYmFzZSB0byB3cml0ZSBhIHF1ZXJ5Jyl9XG4gICAgICAgICAgZGVzY3JpcHRpb249e3QoXG4gICAgICAgICAgICAnQ2hvb3NlIG9uZSBvZiB0aGUgYXZhaWxhYmxlIGRhdGFiYXNlcyBmcm9tIHRoZSBwYW5lbCBvbiB0aGUgbGVmdC4nLFxuICAgICAgICAgICl9XG4gICAgICAgIC8+XG4gICAgICApIDogKFxuICAgICAgICBxdWVyeVBhbmUoKVxuICAgICAgKX1cbiAgICAgIDxNb2RhbFxuICAgICAgICB2aXNpYmxlPXtzaG93Q3JlYXRlQXNNb2RhbH1cbiAgICAgICAgdGl0bGU9e3QoY3JlYXRlVmlld01vZGFsVGl0bGUpfVxuICAgICAgICBvbkhpZGU9eygpID0+IHNldFNob3dDcmVhdGVBc01vZGFsKGZhbHNlKX1cbiAgICAgICAgZm9vdGVyPXtcbiAgICAgICAgICA8PlxuICAgICAgICAgICAgPEJ1dHRvbiBvbkNsaWNrPXsoKSA9PiBzZXRTaG93Q3JlYXRlQXNNb2RhbChmYWxzZSl9PlxuICAgICAgICAgICAgICB7dCgnQ2FuY2VsJyl9XG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgIHtjcmVhdGVBcyA9PT0gQ3Rhc0VudW0uVEFCTEUgJiYgKFxuICAgICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgICBkaXNhYmxlZD17Y3Rhcy5sZW5ndGggPT09IDB9XG4gICAgICAgICAgICAgICAgb25DbGljaz17Y3JlYXRlVGFibGVBc31cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHt0KCdDcmVhdGUnKX1cbiAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICApfVxuICAgICAgICAgICAge2NyZWF0ZUFzID09PSBDdGFzRW51bS5WSUVXICYmIChcbiAgICAgICAgICAgICAgPEJ1dHRvblxuICAgICAgICAgICAgICAgIGJ1dHRvblN0eWxlPVwicHJpbWFyeVwiXG4gICAgICAgICAgICAgICAgZGlzYWJsZWQ9e2N0YXMubGVuZ3RoID09PSAwfVxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e2NyZWF0ZVZpZXdBc31cbiAgICAgICAgICAgICAgPlxuICAgICAgICAgICAgICAgIHt0KCdDcmVhdGUnKX1cbiAgICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgICApfVxuICAgICAgICAgIDwvPlxuICAgICAgICB9XG4gICAgICA+XG4gICAgICAgIDxzcGFuPnt0KCdOYW1lJyl9PC9zcGFuPlxuICAgICAgICA8SW5wdXQgcGxhY2Vob2xkZXI9e2NyZWF0ZU1vZGFsUGxhY2VIb2xkZXJ9IG9uQ2hhbmdlPXtjdGFzQ2hhbmdlZH0gLz5cbiAgICAgIDwvTW9kYWw+XG4gICAgPC9TdHlsZWRTcWxFZGl0b3I+XG4gICk7XG59O1xuXG5TcWxFZGl0b3IucHJvcFR5cGVzID0gcHJvcFR5cGVzO1xuXG5leHBvcnQgZGVmYXVsdCBTcWxFZGl0b3I7XG4iXX0= */\") },\n      ___EmotionJSX(Menu.Item, { css: _ref13 },\n      ' ',\n      ___EmotionJSX(\"span\", null, t('Autocomplete')), ' ',\n      ___EmotionJSX(AntdSwitch, {\n        checked: autocompleteEnabled,\n        onChange: handleToggleAutocompleteEnabled,\n        name: \"autocomplete-switch\" }),\n      ' '),\n\n      isFeatureEnabled(FeatureFlag.ENABLE_TEMPLATE_PROCESSING) &&\n      ___EmotionJSX(Menu.Item, null,\n      ___EmotionJSX(TemplateParamsEditor, {\n        language: \"json\",\n        onChange: (params) => {\n          dispatch(queryEditorSetTemplateParams(qe, params));\n        },\n        queryEditorId: qe.id })),\n\n\n\n      !_isEmpty(scheduledQueriesConf) &&\n      ___EmotionJSX(Menu.Item, null,\n      ___EmotionJSX(ScheduleQueryButton, {\n        defaultLabel: qe.name,\n        sql: qe.sql,\n        onSchedule: (query) => dispatch(scheduleQuery(query)),\n        schema: qe.schema,\n        dbId: qe.dbId,\n        scheduleQueryWarning: scheduleQueryWarning,\n        tooltip: scheduleToolTip,\n        disabled: !successful }))));\n\n\n\n\n\n  };\n\n  const onSaveQuery = async (query, clientId) => {\n    const savedQuery = await dispatch(saveQuery(query, clientId));\n    dispatch(addSavedQueryToTabState(queryEditor, savedQuery));\n  };\n\n  const renderEditorBottomBar = () => {var _latestQuery$results;\n    const { allow_ctas: allowCTAS, allow_cvas: allowCVAS } = database || {};\n\n    const showMenu = allowCTAS || allowCVAS;\n    const runMenuBtn =\n    ___EmotionJSX(Menu, null,\n    allowCTAS &&\n    ___EmotionJSX(Menu.Item, {\n      onClick: () => {\n        setShowCreateAsModal(true);\n        setCreateAs(CtasEnum.TABLE);\n      },\n      key: \"1\" },\n\n    t('CREATE TABLE AS')),\n\n\n    allowCVAS &&\n    ___EmotionJSX(Menu.Item, {\n      onClick: () => {\n        setShowCreateAsModal(true);\n        setCreateAs(CtasEnum.VIEW);\n      },\n      key: \"2\" },\n\n    t('CREATE VIEW AS')));\n\n\n\n\n\n    return (\n      ___EmotionJSX(StyledToolbar, { className: \"sql-toolbar\", id: \"js-sql-toolbar\" },\n      ___EmotionJSX(\"div\", { className: \"leftItems\" },\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(RunQueryActionButton, {\n        allowAsync: database ? database.allow_run_async : false,\n        queryEditorId: queryEditor.id,\n        queryState: latestQuery == null ? void 0 : latestQuery.state,\n        runQuery: runQuery,\n        stopQuery: stopQuery,\n        overlayCreateAsMenu: showMenu ? runMenuBtn : null })),\n\n\n      isFeatureEnabled(FeatureFlag.ESTIMATE_QUERY_COST) && (\n      database == null ? void 0 : database.allows_cost_estimate) &&\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(EstimateQueryCostButton, {\n        getEstimate: getQueryCostEstimate,\n        queryEditorId: queryEditor.id,\n        tooltip: t('Estimate the cost before running a query') })),\n\n\n\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(QueryLimitSelect, {\n        queryEditorId: queryEditor.id,\n        maxRow: maxRow,\n        defaultQueryLimit: defaultQueryLimit })),\n\n\n      latestQuery &&\n      ___EmotionJSX(Timer, {\n        startTime: latestQuery.startDttm,\n        endTime: latestQuery.endDttm,\n        state: STATE_TYPE_MAP[latestQuery.state],\n        isRunning: latestQuery.state === 'running' })),\n\n\n\n      ___EmotionJSX(\"div\", { className: \"rightItems\" },\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(SaveQuery, {\n        queryEditorId: queryEditor.id,\n        columns: (latestQuery == null ? void 0 : (_latestQuery$results = latestQuery.results) == null ? void 0 : _latestQuery$results.columns) || [],\n        onSave: onSaveQuery,\n        onUpdate: (query, remoteId, id) =>\n        dispatch(updateSavedQuery(query, remoteId, id)),\n\n        saveQueryWarning: saveQueryWarning,\n        database: database })),\n\n\n      ___EmotionJSX(\"span\", null,\n      ___EmotionJSX(ShareSqlLabQuery, { queryEditorId: queryEditor.id })),\n\n      ___EmotionJSX(AntdDropdown, { overlay: renderDropdown(), trigger: \"click\" },\n      ___EmotionJSX(Icons.MoreHoriz, { iconColor: theme.colors.grayscale.base })))));\n\n\n\n\n  };\n\n  const queryPane = () => {\n    const hotkeys = getHotkeyConfig();\n    const { aceEditorHeight, southPaneHeight } =\n    getAceEditorAndSouthPaneHeights(height, northPercent, southPercent);\n    return (\n      ___EmotionJSX(Split, {\n        expandToMin: true,\n        className: \"queryPane\",\n        sizes: [northPercent, southPercent],\n        elementStyle: elementStyle,\n        minSize: 200,\n        direction: \"vertical\",\n        gutterSize: SQL_EDITOR_GUTTER_HEIGHT,\n        onDragStart: onResizeStart,\n        onDragEnd: onResizeEnd },\n\n      ___EmotionJSX(\"div\", { ref: northPaneRef, className: \"north-pane\" },\n      SqlFormExtension &&\n      ___EmotionJSX(SqlFormExtension, {\n        queryEditorId: queryEditor.id,\n        setQueryEditorAndSaveSqlWithDebounce:\n        setQueryEditorAndSaveSqlWithDebounce,\n\n        startQuery: startQuery }),\n\n\n      ___EmotionJSX(AceEditorWrapper, {\n        autocomplete: autocompleteEnabled,\n        onBlur: setQueryEditorAndSaveSql,\n        onChange: onSqlChanged,\n        queryEditorId: queryEditor.id,\n        height: `${aceEditorHeight}px`,\n        hotkeys: hotkeys }),\n\n      renderEditorBottomBar(hotkeys)),\n\n      ___EmotionJSX(SouthPane, {\n        queryEditorId: queryEditor.id,\n        latestQueryId: latestQuery == null ? void 0 : latestQuery.id,\n        height: southPaneHeight,\n        displayLimit: displayLimit,\n        defaultQueryLimit: defaultQueryLimit })));\n\n\n\n  };\n\n  const createViewModalTitle =\n  createAs === CtasEnum.VIEW ? 'CREATE VIEW AS' : 'CREATE TABLE AS';\n\n  const createModalPlaceHolder =\n  createAs === CtasEnum.VIEW ?\n  t('Specify name to CREATE VIEW AS schema in: public') :\n  t('Specify name to CREATE TABLE AS schema in: public');\n\n  const leftBarStateClass = hideLeftBar ?\n  'schemaPane-exit-done' :\n  'schemaPane-enter-done';\n  return (\n    ___EmotionJSX(StyledSqlEditor, { ref: sqlEditorRef, className: \"SqlEditor\" },\n    ___EmotionJSX(CSSTransition, { classNames: \"schemaPane\", in: !hideLeftBar, timeout: 300 },\n    ___EmotionJSX(ResizableSidebar, {\n      id: `sqllab:${queryEditor.id}`,\n      minWidth: SQL_EDITOR_LEFTBAR_WIDTH,\n      initialWidth: SQL_EDITOR_LEFTBAR_WIDTH,\n      enable: !hideLeftBar },\n\n    (adjustedWidth) =>\n    ___EmotionJSX(StyledSidebar, {\n      className: `schemaPane ${leftBarStateClass}`,\n      width: adjustedWidth,\n      hide: hideLeftBar },\n\n    ___EmotionJSX(SqlEditorLeftBar, {\n      database: database,\n      queryEditorId: queryEditor.id,\n      tables: tables,\n      setEmptyState: (bool) => setShowEmptyState(bool) })))),\n\n\n\n\n\n    showEmptyState ?\n    ___EmotionJSX(EmptyStateBig, {\n      image: \"vector.svg\",\n      title: t('Select a database to write a query'),\n      description: t(\n      'Choose one of the available databases from the panel on the left.') }) :\n\n\n\n    queryPane(),\n\n    ___EmotionJSX(Modal, {\n      visible: showCreateAsModal,\n      title: t(createViewModalTitle),\n      onHide: () => setShowCreateAsModal(false),\n      footer:\n      ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(Button, { onClick: () => setShowCreateAsModal(false) },\n      t('Cancel')),\n\n      createAs === CtasEnum.TABLE &&\n      ___EmotionJSX(Button, {\n        buttonStyle: \"primary\",\n        disabled: ctas.length === 0,\n        onClick: createTableAs },\n\n      t('Create')),\n\n\n      createAs === CtasEnum.VIEW &&\n      ___EmotionJSX(Button, {\n        buttonStyle: \"primary\",\n        disabled: ctas.length === 0,\n        onClick: createViewAs },\n\n      t('Create'))) },\n\n\n\n\n\n    ___EmotionJSX(\"span\", null, t('Name')),\n    ___EmotionJSX(Input, { placeholder: createModalPlaceHolder, onChange: ctasChanged }))));\n\n\n\n};\n\nSqlEditor.propTypes = propTypes;\n\nexport default SqlEditor;","map":{"version":3,"names":["React","useState","useEffect","useMemo","useRef","useCallback","useEffectEvent","CSSTransition","shallowEqual","useDispatch","useSelector","PropTypes","Split","css","FeatureFlag","isFeatureEnabled","styled","t","useTheme","getExtensionsRegistry","debounce","throttle","Modal","Mousetrap","Button","Timer","ResizableSidebar","AntdDropdown","AntdSwitch","Input","Menu","Icons","detectOS","addNewQueryEditor","CtasEnum","estimateQueryCost","persistEditorHeight","postStopQuery","queryEditorSetAutorun","queryEditorSetSql","queryEditorSetAndSaveSql","queryEditorSetTemplateParams","runQueryFromSqlEditor","saveQuery","addSavedQueryToTabState","scheduleQuery","setActiveSouthPaneTab","updateSavedQuery","STATE_TYPE_MAP","SQL_EDITOR_GUTTER_HEIGHT","SQL_EDITOR_GUTTER_MARGIN","SQL_TOOLBAR_HEIGHT","SQL_EDITOR_LEFTBAR_WIDTH","SQL_EDITOR_PADDING","INITIAL_NORTH_PERCENT","INITIAL_SOUTH_PERCENT","SET_QUERY_EDITOR_SQL_DEBOUNCE_MS","WINDOW_RESIZE_THROTTLE_MS","getItem","LocalStorageKeys","setItem","EmptyStateBig","getBootstrapData","TemplateParamsEditor","SouthPane","SaveQuery","ScheduleQueryButton","EstimateQueryCostButton","ShareSqlLabQuery","SqlEditorLeftBar","AceEditorWrapper","RunQueryActionButton","QueryLimitSelect","bootstrapData","scheduledQueriesConf","common","conf","SCHEDULED_QUERIES","StyledToolbar","div","theme","gridUnit","colors","grayscale","light5","light2","StyledSidebar","width","hide","StyledSqlEditor","transitionTiming","propTypes","tables","array","isRequired","queryEditor","object","defaultQueryLimit","number","maxRow","displayLimit","saveQueryWarning","string","scheduleQueryWarning","extensionsRegistry","SqlEditor","dispatch","database","latestQuery","hideLeftBar","sqlLab","unsavedQueryEditor","databases","queries","dbId","latestQueryId","id","height","setHeight","autorun","setAutorun","ctas","setCtas","northPercent","setNorthPercent","southPercent","setSouthPercent","autocompleteEnabled","setAutocompleteEnabled","sqllab__is_autocomplete_enabled","showCreateAsModal","setShowCreateAsModal","createAs","setCreateAs","showEmptyState","setShowEmptyState","sqlEditorRef","northPaneRef","SqlFormExtension","get","startQuery","ctasArg","ctas_method","TABLE","stopQuery","indexOf","state","runQuery","getSqlEditorHeight","current","clientHeight","getHotkeyConfig","userOS","base","name","key","descr","func","sql","trim","editor","getValue","session","getSession","cursorPosition","getCursorPosition","totalLine","getLength","currentRow","getFirstVisibleRow","end","find","backwards","skipCurrent","start","row","column","currentLine","content","getLine","slice","selection","setRange","clearSelection","moveCursorToPosition","scrollToRow","push","navigateUp","onBeforeUnload","event","extra_json","cancel_query_on_windows_unload","preventDefault","handleWindowResizeWithThrottle","window","addEventListener","removeEventListener","reset","hotkeys","forEach","keyConfig","bind","onResizeStart","document","getElementsByClassName","style","onResizeEnd","setQueryEditorAndSaveSql","setQueryEditorAndSaveSqlWithDebounce","onSqlChanged","getAceEditorAndSouthPaneHeights","aceEditorHeight","southPaneHeight","getQueryCostEstimate","handleToggleAutocompleteEnabled","elementStyle","dimension","elementSize","gutterSize","createTableAs","createViewAs","VIEW","ctasChanged","target","value","renderDropdown","qe","successful","scheduleToolTip","ENABLE_TEMPLATE_PROCESSING","params","query","schema","onSaveQuery","clientId","savedQuery","renderEditorBottomBar","allow_ctas","allowCTAS","allow_cvas","allowCVAS","showMenu","runMenuBtn","allow_run_async","ESTIMATE_QUERY_COST","allows_cost_estimate","startDttm","endDttm","results","columns","remoteId","queryPane","createViewModalTitle","createModalPlaceHolder","leftBarStateClass","adjustedWidth","bool","length"],"sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/src/SqlLab/components/SqlEditor/index.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable jsx-a11y/anchor-is-valid */\n/* eslint-disable jsx-a11y/no-static-element-interactions */\nimport React, {\n  useState,\n  useEffect,\n  useMemo,\n  useRef,\n  useCallback,\n} from 'react';\nimport useEffectEvent from 'src/hooks/useEffectEvent';\nimport { CSSTransition } from 'react-transition-group';\nimport { shallowEqual, useDispatch, useSelector } from 'react-redux';\nimport PropTypes from 'prop-types';\nimport Split from 'react-split';\nimport {\n  css,\n  FeatureFlag,\n  isFeatureEnabled,\n  styled,\n  t,\n  useTheme,\n  getExtensionsRegistry,\n} from '@superset-ui/core';\nimport debounce from 'lodash/debounce';\nimport throttle from 'lodash/throttle';\nimport Modal from 'src/components/Modal';\nimport Mousetrap from 'mousetrap';\nimport Button from 'src/components/Button';\nimport Timer from 'src/components/Timer';\nimport ResizableSidebar from 'src/components/ResizableSidebar';\nimport { AntdDropdown, AntdSwitch } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport { Menu } from 'src/components/Menu';\nimport Icons from 'src/components/Icons';\nimport { detectOS } from 'src/utils/common';\nimport {\n  addNewQueryEditor,\n  CtasEnum,\n  estimateQueryCost,\n  persistEditorHeight,\n  postStopQuery,\n  queryEditorSetAutorun,\n  queryEditorSetSql,\n  queryEditorSetAndSaveSql,\n  queryEditorSetTemplateParams,\n  runQueryFromSqlEditor,\n  saveQuery,\n  addSavedQueryToTabState,\n  scheduleQuery,\n  setActiveSouthPaneTab,\n  updateSavedQuery,\n} from 'src/SqlLab/actions/sqlLab';\nimport {\n  STATE_TYPE_MAP,\n  SQL_EDITOR_GUTTER_HEIGHT,\n  SQL_EDITOR_GUTTER_MARGIN,\n  SQL_TOOLBAR_HEIGHT,\n  SQL_EDITOR_LEFTBAR_WIDTH,\n  SQL_EDITOR_PADDING,\n  INITIAL_NORTH_PERCENT,\n  INITIAL_SOUTH_PERCENT,\n  SET_QUERY_EDITOR_SQL_DEBOUNCE_MS,\n  WINDOW_RESIZE_THROTTLE_MS,\n} from 'src/SqlLab/constants';\nimport {\n  getItem,\n  LocalStorageKeys,\n  setItem,\n} from 'src/utils/localStorageHelpers';\nimport { EmptyStateBig } from 'src/components/EmptyState';\nimport getBootstrapData from 'src/utils/getBootstrapData';\nimport { isEmpty } from 'lodash';\nimport TemplateParamsEditor from '../TemplateParamsEditor';\nimport SouthPane from '../SouthPane';\nimport SaveQuery from '../SaveQuery';\nimport ScheduleQueryButton from '../ScheduleQueryButton';\nimport EstimateQueryCostButton from '../EstimateQueryCostButton';\nimport ShareSqlLabQuery from '../ShareSqlLabQuery';\nimport SqlEditorLeftBar from '../SqlEditorLeftBar';\nimport AceEditorWrapper from '../AceEditorWrapper';\nimport RunQueryActionButton from '../RunQueryActionButton';\nimport QueryLimitSelect from '../QueryLimitSelect';\n\nconst bootstrapData = getBootstrapData();\nconst scheduledQueriesConf = bootstrapData?.common?.conf?.SCHEDULED_QUERIES;\n\nconst StyledToolbar = styled.div`\n  padding: ${({ theme }) => theme.gridUnit * 2}px;\n  background: ${({ theme }) => theme.colors.grayscale.light5};\n  display: flex;\n  justify-content: space-between;\n  border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  border-top: 0;\n\n  form {\n    margin-block-end: 0;\n  }\n\n  .leftItems,\n  .rightItems {\n    display: flex;\n    align-items: center;\n    & > span {\n      margin-right: ${({ theme }) => theme.gridUnit * 2}px;\n      display: inline-block;\n\n      &:last-child {\n        margin-right: 0;\n      }\n    }\n  }\n\n  .limitDropdown {\n    white-space: nowrap;\n  }\n`;\n\nconst StyledSidebar = styled.div`\n  flex: 0 0 ${({ width }) => width}px;\n  width: ${({ width }) => width}px;\n  padding: ${({ theme, hide }) => (hide ? 0 : theme.gridUnit * 2.5)}px;\n  border-right: 1px solid\n    ${({ theme, hide }) =>\n      hide ? 'transparent' : theme.colors.grayscale.light2};\n`;\n\nconst StyledSqlEditor = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    flex-direction: row;\n    height: 100%;\n\n    .schemaPane {\n      transition: transform ${theme.transitionTiming}s ease-in-out;\n    }\n\n    .queryPane {\n      flex: 1 1 auto;\n      padding: ${theme.gridUnit * 2}px;\n      overflow-y: auto;\n      overflow-x: scroll;\n    }\n\n    .schemaPane-enter-done,\n    .schemaPane-exit {\n      transform: translateX(0);\n      z-index: 7;\n    }\n\n    .schemaPane-exit-active {\n      transform: translateX(-120%);\n    }\n\n    .schemaPane-enter-active {\n      transform: translateX(0);\n      max-width: ${theme.gridUnit * 75}px;\n    }\n\n    .schemaPane-enter,\n    .schemaPane-exit-done {\n      max-width: 0;\n      transform: translateX(-120%);\n      overflow: hidden;\n    }\n\n    .schemaPane-exit-done + .queryPane {\n      margin-left: 0;\n    }\n\n    .gutter {\n      border-top: 1px solid ${theme.colors.grayscale.light2};\n      border-bottom: 1px solid ${theme.colors.grayscale.light2};\n      width: 3%;\n      margin: ${SQL_EDITOR_GUTTER_MARGIN}px 47%;\n    }\n\n    .gutter.gutter-vertical {\n      cursor: row-resize;\n    }\n  `}\n`;\n\nconst propTypes = {\n  tables: PropTypes.array.isRequired,\n  queryEditor: PropTypes.object.isRequired,\n  defaultQueryLimit: PropTypes.number.isRequired,\n  maxRow: PropTypes.number.isRequired,\n  displayLimit: PropTypes.number.isRequired,\n  saveQueryWarning: PropTypes.string,\n  scheduleQueryWarning: PropTypes.string,\n};\n\nconst extensionsRegistry = getExtensionsRegistry();\n\nconst SqlEditor = ({\n  tables,\n  queryEditor,\n  defaultQueryLimit,\n  maxRow,\n  displayLimit,\n  saveQueryWarning,\n  scheduleQueryWarning = null,\n}) => {\n  const theme = useTheme();\n  const dispatch = useDispatch();\n\n  const { database, latestQuery, hideLeftBar } = useSelector(\n    ({ sqlLab: { unsavedQueryEditor, databases, queries } }) => {\n      let { dbId, latestQueryId, hideLeftBar } = queryEditor;\n      if (unsavedQueryEditor.id === queryEditor.id) {\n        dbId = unsavedQueryEditor.dbId || dbId;\n        latestQueryId = unsavedQueryEditor.latestQueryId || latestQueryId;\n        hideLeftBar = unsavedQueryEditor.hideLeftBar || hideLeftBar;\n      }\n      return {\n        database: databases[dbId],\n        latestQuery: queries[latestQueryId],\n        hideLeftBar,\n      };\n    },\n    shallowEqual,\n  );\n\n  const [height, setHeight] = useState(0);\n  const [autorun, setAutorun] = useState(queryEditor.autorun);\n  const [ctas, setCtas] = useState('');\n  const [northPercent, setNorthPercent] = useState(\n    queryEditor.northPercent || INITIAL_NORTH_PERCENT,\n  );\n  const [southPercent, setSouthPercent] = useState(\n    queryEditor.southPercent || INITIAL_SOUTH_PERCENT,\n  );\n  const [autocompleteEnabled, setAutocompleteEnabled] = useState(\n    getItem(LocalStorageKeys.sqllab__is_autocomplete_enabled, true),\n  );\n  const [showCreateAsModal, setShowCreateAsModal] = useState(false);\n  const [createAs, setCreateAs] = useState('');\n  const [showEmptyState, setShowEmptyState] = useState(false);\n\n  const sqlEditorRef = useRef(null);\n  const northPaneRef = useRef(null);\n\n  const SqlFormExtension = extensionsRegistry.get('sqleditor.extension.form');\n\n  const startQuery = useCallback(\n    (ctasArg = false, ctas_method = CtasEnum.TABLE) => {\n      if (!database) {\n        return;\n      }\n\n      dispatch(\n        runQueryFromSqlEditor(\n          database,\n          queryEditor,\n          defaultQueryLimit,\n          ctasArg ? ctas : '',\n          ctasArg,\n          ctas_method,\n        ),\n      );\n      dispatch(setActiveSouthPaneTab('Results'));\n    },\n    [ctas, database, defaultQueryLimit, dispatch, queryEditor],\n  );\n\n  const stopQuery = useCallback(() => {\n    if (latestQuery && ['running', 'pending'].indexOf(latestQuery.state) >= 0) {\n      dispatch(postStopQuery(latestQuery));\n    }\n    return false;\n  }, [dispatch, latestQuery]);\n\n  const runQuery = () => {\n    if (database) {\n      startQuery();\n    }\n  };\n\n  useEffect(() => {\n    if (autorun) {\n      setAutorun(false);\n      dispatch(queryEditorSetAutorun(queryEditor, false));\n      startQuery();\n    }\n  }, [autorun, dispatch, queryEditor, startQuery]);\n\n  // One layer of abstraction for easy spying in unit tests\n  const getSqlEditorHeight = () =>\n    sqlEditorRef.current\n      ? sqlEditorRef.current.clientHeight - SQL_EDITOR_PADDING * 2\n      : 0;\n\n  const getHotkeyConfig = useCallback(() => {\n    // Get the user's OS\n    const userOS = detectOS();\n    const base = [\n      {\n        name: 'runQuery1',\n        key: 'ctrl+r',\n        descr: t('Run query'),\n        func: () => {\n          if (queryEditor.sql.trim() !== '') {\n            startQuery();\n          }\n        },\n      },\n      {\n        name: 'runQuery2',\n        key: 'ctrl+enter',\n        descr: t('Run query'),\n        func: () => {\n          if (queryEditor.sql.trim() !== '') {\n            startQuery();\n          }\n        },\n      },\n      {\n        name: 'runQuery3',\n        key: 'ctrl+shift+enter',\n        descr: t('Run current query'),\n        func: editor => {\n          if (!editor.getValue().trim()) {\n            return;\n          }\n          const session = editor.getSession();\n          const cursorPosition = editor.getCursorPosition();\n          const totalLine = session.getLength();\n          const currentRow = editor.getFirstVisibleRow();\n          let end = editor.find(';', {\n            backwards: false,\n            skipCurrent: true,\n            start: cursorPosition,\n          })?.end;\n          if (!end || end.row < cursorPosition.row) {\n            end = {\n              row: totalLine + 1,\n              column: 0,\n            };\n          }\n          let start = editor.find(';', {\n            backwards: true,\n            skipCurrent: true,\n            start: cursorPosition,\n          })?.end;\n          let currentLine = editor.find(';', {\n            backwards: true,\n            skipCurrent: true,\n            start: cursorPosition,\n          })?.end?.row;\n          if (\n            !currentLine ||\n            currentLine > cursorPosition.row ||\n            (currentLine === cursorPosition.row &&\n              start?.column > cursorPosition.column)\n          ) {\n            currentLine = 0;\n          }\n          let content =\n            currentLine === start?.row\n              ? session.getLine(currentLine).slice(start.column).trim()\n              : session.getLine(currentLine).trim();\n          while (!content && currentLine < totalLine) {\n            currentLine += 1;\n            content = session.getLine(currentLine).trim();\n          }\n          if (currentLine !== start?.row) {\n            start = { row: currentLine, column: 0 };\n          }\n          editor.selection.setRange({\n            start: start ?? { row: 0, column: 0 },\n            end,\n          });\n          startQuery();\n          editor.selection.clearSelection();\n          editor.moveCursorToPosition(cursorPosition);\n          editor.scrollToRow(currentRow);\n        },\n      },\n      {\n        name: 'newTab',\n        key: userOS === 'Windows' ? 'ctrl+q' : 'ctrl+t',\n        descr: t('New tab'),\n        func: () => {\n          dispatch(addNewQueryEditor());\n        },\n      },\n      {\n        name: 'stopQuery',\n        key: userOS === 'MacOS' ? 'ctrl+x' : 'ctrl+e',\n        descr: t('Stop query'),\n        func: stopQuery,\n      },\n    ];\n\n    if (userOS === 'MacOS') {\n      base.push({\n        name: 'previousLine',\n        key: 'ctrl+p',\n        descr: t('Previous Line'),\n        func: editor => {\n          editor.navigateUp(1);\n        },\n      });\n    }\n\n    return base;\n  }, [dispatch, queryEditor.sql, startQuery, stopQuery]);\n\n  const onBeforeUnload = useEffectEvent(event => {\n    if (\n      database?.extra_json?.cancel_query_on_windows_unload &&\n      latestQuery?.state === 'running'\n    ) {\n      event.preventDefault();\n      stopQuery();\n    }\n  });\n\n  useEffect(() => {\n    // We need to measure the height of the sql editor post render to figure the height of\n    // the south pane so it gets rendered properly\n    setHeight(getSqlEditorHeight());\n    const handleWindowResizeWithThrottle = throttle(\n      () => setHeight(getSqlEditorHeight()),\n      WINDOW_RESIZE_THROTTLE_MS,\n    );\n\n    window.addEventListener('resize', handleWindowResizeWithThrottle);\n    window.addEventListener('beforeunload', onBeforeUnload);\n\n    return () => {\n      window.removeEventListener('resize', handleWindowResizeWithThrottle);\n      window.removeEventListener('beforeunload', onBeforeUnload);\n    };\n    // TODO: Remove useEffectEvent deps once https://github.com/facebook/react/pull/25881 is released\n  }, [onBeforeUnload]);\n\n  useEffect(() => {\n    if (!database || isEmpty(database)) {\n      setShowEmptyState(true);\n    }\n  }, [database]);\n\n  useEffect(() => {\n    // setup hotkeys\n    Mousetrap.reset();\n    const hotkeys = getHotkeyConfig();\n    hotkeys.forEach(keyConfig => {\n      Mousetrap.bind([keyConfig.key], keyConfig.func);\n    });\n  }, [getHotkeyConfig, latestQuery]);\n\n  const onResizeStart = () => {\n    // Set the heights on the ace editor and the ace content area after drag starts\n    // to smooth out the visual transition to the new heights when drag ends\n    document.getElementsByClassName('ace_content')[0].style.height = '100%';\n  };\n\n  const onResizeEnd = ([northPercent, southPercent]) => {\n    setNorthPercent(northPercent);\n    setSouthPercent(southPercent);\n\n    if (northPaneRef.current?.clientHeight) {\n      dispatch(persistEditorHeight(queryEditor, northPercent, southPercent));\n    }\n  };\n\n  const setQueryEditorAndSaveSql = useCallback(\n    sql => {\n      dispatch(queryEditorSetAndSaveSql(queryEditor, sql));\n    },\n    [dispatch, queryEditor],\n  );\n\n  const setQueryEditorAndSaveSqlWithDebounce = useMemo(\n    () => debounce(setQueryEditorAndSaveSql, SET_QUERY_EDITOR_SQL_DEBOUNCE_MS),\n    [setQueryEditorAndSaveSql],\n  );\n\n  const onSqlChanged = sql => {\n    dispatch(queryEditorSetSql(queryEditor, sql));\n    setQueryEditorAndSaveSqlWithDebounce(sql);\n  };\n\n  // Return the heights for the ace editor and the south pane as an object\n  // given the height of the sql editor, north pane percent and south pane percent.\n  const getAceEditorAndSouthPaneHeights = (\n    height,\n    northPercent,\n    southPercent,\n  ) => ({\n    aceEditorHeight:\n      (height * northPercent) / (theme.gridUnit * 25) -\n      (SQL_EDITOR_GUTTER_HEIGHT / 2 + SQL_EDITOR_GUTTER_MARGIN) -\n      SQL_TOOLBAR_HEIGHT,\n    southPaneHeight:\n      (height * southPercent) / (theme.gridUnit * 25) -\n      (SQL_EDITOR_GUTTER_HEIGHT / 2 + SQL_EDITOR_GUTTER_MARGIN),\n  });\n\n  const getQueryCostEstimate = () => {\n    if (database) {\n      dispatch(estimateQueryCost(queryEditor));\n    }\n  };\n\n  const handleToggleAutocompleteEnabled = () => {\n    setItem(\n      LocalStorageKeys.sqllab__is_autocomplete_enabled,\n      !autocompleteEnabled,\n    );\n    setAutocompleteEnabled(!autocompleteEnabled);\n  };\n\n  const elementStyle = (dimension, elementSize, gutterSize) => ({\n    [dimension]: `calc(${elementSize}% - ${\n      gutterSize + SQL_EDITOR_GUTTER_MARGIN\n    }px)`,\n  });\n\n  const createTableAs = () => {\n    startQuery(true, CtasEnum.TABLE);\n    setShowCreateAsModal(false);\n    setCtas('');\n  };\n\n  const createViewAs = () => {\n    startQuery(true, CtasEnum.VIEW);\n    setShowCreateAsModal(false);\n    setCtas('');\n  };\n\n  const ctasChanged = event => {\n    setCtas(event.target.value);\n  };\n\n  const renderDropdown = () => {\n    const qe = queryEditor;\n    const successful = latestQuery?.state === 'success';\n    const scheduleToolTip = successful\n      ? t('Schedule the query periodically')\n      : t('You must run the query successfully first');\n    return (\n      <Menu css={{ width: theme.gridUnit * 44 }}>\n        <Menu.Item css={{ display: 'flex', justifyContent: 'space-between' }}>\n          {' '}\n          <span>{t('Autocomplete')}</span>{' '}\n          <AntdSwitch\n            checked={autocompleteEnabled}\n            onChange={handleToggleAutocompleteEnabled}\n            name=\"autocomplete-switch\"\n          />{' '}\n        </Menu.Item>\n        {isFeatureEnabled(FeatureFlag.ENABLE_TEMPLATE_PROCESSING) && (\n          <Menu.Item>\n            <TemplateParamsEditor\n              language=\"json\"\n              onChange={params => {\n                dispatch(queryEditorSetTemplateParams(qe, params));\n              }}\n              queryEditorId={qe.id}\n            />\n          </Menu.Item>\n        )}\n        {!isEmpty(scheduledQueriesConf) && (\n          <Menu.Item>\n            <ScheduleQueryButton\n              defaultLabel={qe.name}\n              sql={qe.sql}\n              onSchedule={query => dispatch(scheduleQuery(query))}\n              schema={qe.schema}\n              dbId={qe.dbId}\n              scheduleQueryWarning={scheduleQueryWarning}\n              tooltip={scheduleToolTip}\n              disabled={!successful}\n            />\n          </Menu.Item>\n        )}\n      </Menu>\n    );\n  };\n\n  const onSaveQuery = async (query, clientId) => {\n    const savedQuery = await dispatch(saveQuery(query, clientId));\n    dispatch(addSavedQueryToTabState(queryEditor, savedQuery));\n  };\n\n  const renderEditorBottomBar = () => {\n    const { allow_ctas: allowCTAS, allow_cvas: allowCVAS } = database || {};\n\n    const showMenu = allowCTAS || allowCVAS;\n    const runMenuBtn = (\n      <Menu>\n        {allowCTAS && (\n          <Menu.Item\n            onClick={() => {\n              setShowCreateAsModal(true);\n              setCreateAs(CtasEnum.TABLE);\n            }}\n            key=\"1\"\n          >\n            {t('CREATE TABLE AS')}\n          </Menu.Item>\n        )}\n        {allowCVAS && (\n          <Menu.Item\n            onClick={() => {\n              setShowCreateAsModal(true);\n              setCreateAs(CtasEnum.VIEW);\n            }}\n            key=\"2\"\n          >\n            {t('CREATE VIEW AS')}\n          </Menu.Item>\n        )}\n      </Menu>\n    );\n\n    return (\n      <StyledToolbar className=\"sql-toolbar\" id=\"js-sql-toolbar\">\n        <div className=\"leftItems\">\n          <span>\n            <RunQueryActionButton\n              allowAsync={database ? database.allow_run_async : false}\n              queryEditorId={queryEditor.id}\n              queryState={latestQuery?.state}\n              runQuery={runQuery}\n              stopQuery={stopQuery}\n              overlayCreateAsMenu={showMenu ? runMenuBtn : null}\n            />\n          </span>\n          {isFeatureEnabled(FeatureFlag.ESTIMATE_QUERY_COST) &&\n            database?.allows_cost_estimate && (\n              <span>\n                <EstimateQueryCostButton\n                  getEstimate={getQueryCostEstimate}\n                  queryEditorId={queryEditor.id}\n                  tooltip={t('Estimate the cost before running a query')}\n                />\n              </span>\n            )}\n          <span>\n            <QueryLimitSelect\n              queryEditorId={queryEditor.id}\n              maxRow={maxRow}\n              defaultQueryLimit={defaultQueryLimit}\n            />\n          </span>\n          {latestQuery && (\n            <Timer\n              startTime={latestQuery.startDttm}\n              endTime={latestQuery.endDttm}\n              state={STATE_TYPE_MAP[latestQuery.state]}\n              isRunning={latestQuery.state === 'running'}\n            />\n          )}\n        </div>\n        <div className=\"rightItems\">\n          <span>\n            <SaveQuery\n              queryEditorId={queryEditor.id}\n              columns={latestQuery?.results?.columns || []}\n              onSave={onSaveQuery}\n              onUpdate={(query, remoteId, id) =>\n                dispatch(updateSavedQuery(query, remoteId, id))\n              }\n              saveQueryWarning={saveQueryWarning}\n              database={database}\n            />\n          </span>\n          <span>\n            <ShareSqlLabQuery queryEditorId={queryEditor.id} />\n          </span>\n          <AntdDropdown overlay={renderDropdown()} trigger=\"click\">\n            <Icons.MoreHoriz iconColor={theme.colors.grayscale.base} />\n          </AntdDropdown>\n        </div>\n      </StyledToolbar>\n    );\n  };\n\n  const queryPane = () => {\n    const hotkeys = getHotkeyConfig();\n    const { aceEditorHeight, southPaneHeight } =\n      getAceEditorAndSouthPaneHeights(height, northPercent, southPercent);\n    return (\n      <Split\n        expandToMin\n        className=\"queryPane\"\n        sizes={[northPercent, southPercent]}\n        elementStyle={elementStyle}\n        minSize={200}\n        direction=\"vertical\"\n        gutterSize={SQL_EDITOR_GUTTER_HEIGHT}\n        onDragStart={onResizeStart}\n        onDragEnd={onResizeEnd}\n      >\n        <div ref={northPaneRef} className=\"north-pane\">\n          {SqlFormExtension && (\n            <SqlFormExtension\n              queryEditorId={queryEditor.id}\n              setQueryEditorAndSaveSqlWithDebounce={\n                setQueryEditorAndSaveSqlWithDebounce\n              }\n              startQuery={startQuery}\n            />\n          )}\n          <AceEditorWrapper\n            autocomplete={autocompleteEnabled}\n            onBlur={setQueryEditorAndSaveSql}\n            onChange={onSqlChanged}\n            queryEditorId={queryEditor.id}\n            height={`${aceEditorHeight}px`}\n            hotkeys={hotkeys}\n          />\n          {renderEditorBottomBar(hotkeys)}\n        </div>\n        <SouthPane\n          queryEditorId={queryEditor.id}\n          latestQueryId={latestQuery?.id}\n          height={southPaneHeight}\n          displayLimit={displayLimit}\n          defaultQueryLimit={defaultQueryLimit}\n        />\n      </Split>\n    );\n  };\n\n  const createViewModalTitle =\n    createAs === CtasEnum.VIEW ? 'CREATE VIEW AS' : 'CREATE TABLE AS';\n\n  const createModalPlaceHolder =\n    createAs === CtasEnum.VIEW\n      ? t('Specify name to CREATE VIEW AS schema in: public')\n      : t('Specify name to CREATE TABLE AS schema in: public');\n\n  const leftBarStateClass = hideLeftBar\n    ? 'schemaPane-exit-done'\n    : 'schemaPane-enter-done';\n  return (\n    <StyledSqlEditor ref={sqlEditorRef} className=\"SqlEditor\">\n      <CSSTransition classNames=\"schemaPane\" in={!hideLeftBar} timeout={300}>\n        <ResizableSidebar\n          id={`sqllab:${queryEditor.id}`}\n          minWidth={SQL_EDITOR_LEFTBAR_WIDTH}\n          initialWidth={SQL_EDITOR_LEFTBAR_WIDTH}\n          enable={!hideLeftBar}\n        >\n          {adjustedWidth => (\n            <StyledSidebar\n              className={`schemaPane ${leftBarStateClass}`}\n              width={adjustedWidth}\n              hide={hideLeftBar}\n            >\n              <SqlEditorLeftBar\n                database={database}\n                queryEditorId={queryEditor.id}\n                tables={tables}\n                setEmptyState={bool => setShowEmptyState(bool)}\n              />\n            </StyledSidebar>\n          )}\n        </ResizableSidebar>\n      </CSSTransition>\n      {showEmptyState ? (\n        <EmptyStateBig\n          image=\"vector.svg\"\n          title={t('Select a database to write a query')}\n          description={t(\n            'Choose one of the available databases from the panel on the left.',\n          )}\n        />\n      ) : (\n        queryPane()\n      )}\n      <Modal\n        visible={showCreateAsModal}\n        title={t(createViewModalTitle)}\n        onHide={() => setShowCreateAsModal(false)}\n        footer={\n          <>\n            <Button onClick={() => setShowCreateAsModal(false)}>\n              {t('Cancel')}\n            </Button>\n            {createAs === CtasEnum.TABLE && (\n              <Button\n                buttonStyle=\"primary\"\n                disabled={ctas.length === 0}\n                onClick={createTableAs}\n              >\n                {t('Create')}\n              </Button>\n            )}\n            {createAs === CtasEnum.VIEW && (\n              <Button\n                buttonStyle=\"primary\"\n                disabled={ctas.length === 0}\n                onClick={createViewAs}\n              >\n                {t('Create')}\n              </Button>\n            )}\n          </>\n        }\n      >\n        <span>{t('Name')}</span>\n        <Input placeholder={createModalPlaceHolder} onChange={ctasChanged} />\n      </Modal>\n    </StyledSqlEditor>\n  );\n};\n\nSqlEditor.propTypes = propTypes;\n\nexport default SqlEditor;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}