{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { GenericDataType, getNumberFormatter, isProbablyHTML, sanitizeHtml } from '@superset-ui/core';\nimport DateWithFormatter from './DateWithFormatter';\n/**\n * Format text for cell value.\n */\nfunction formatValue(formatter, value) {\n  // render undefined as empty string\n  if (value === undefined) {\n    return [false, ''];\n  }\n  // render null as `N/A`\n  if (value === null ||\n  // null values in temporal columns are wrapped in a Date object, so make sure we\n  // handle them here too\n  value instanceof DateWithFormatter && value.input === null) {\n    return [false, 'N/A'];\n  }\n  if (formatter) {\n    return [false, formatter(value)];\n  }\n  if (typeof value === 'string') {\n    return isProbablyHTML(value) ? [true, sanitizeHtml(value)] : [false, value];\n  }\n  return [false, value.toString()];\n}\nexport function formatColumnValue(column, value) {\n  const { dataType, formatter, config = {} } = column;\n  const isNumber = dataType === GenericDataType.NUMERIC;\n  const smallNumberFormatter = config.d3SmallNumberFormat === undefined ?\n  formatter :\n  getNumberFormatter(config.d3SmallNumberFormat);\n  return formatValue(isNumber && typeof value === 'number' && Math.abs(value) < 1 ?\n  smallNumberFormatter :\n  formatter, value);\n}","map":{"version":3,"mappings":"AAAA;;;;;;;;;;;;;;;;;;AAkBA,SAEEA,eAFF,EAGEC,kBAHF,EAIEC,cAJF,EAKEC,YALF,QAMO,mBANP;AAQA,OAAOC,iBAAP,MAA8B,qBAA9B;AAEA;;;AAGA,SAASC,WAAT,CACEC,SADF,EAEEC,KAFF,EAEwB;EAEtB;EACA,IAAIA,KAAK,KAAKC,SAAd,EAAyB;IACvB,OAAO,CAAC,KAAD,EAAQ,EAAR,CAAP;EACD;EACD;EACA,IACED,KAAK,KAAK,IAAV;EACA;EACA;EACCA,KAAK,YAAYH,iBAAjB,IAAsCG,KAAK,CAACE,KAAN,KAAgB,IAJzD,EAKE;IACA,OAAO,CAAC,KAAD,EAAQ,KAAR,CAAP;EACD;EACD,IAAIH,SAAJ,EAAe;IACb,OAAO,CAAC,KAAD,EAAQA,SAAS,CAACC,KAAD,CAAjB,CAAP;EACD;EACD,IAAI,OAAOA,KAAP,KAAiB,QAArB,EAA+B;IAC7B,OAAOL,cAAc,CAACK,KAAD,CAAd,GAAwB,CAAC,IAAD,EAAOJ,YAAY,CAACI,KAAD,CAAnB,CAAxB,GAAsD,CAAC,KAAD,EAAQA,KAAR,CAA7D;EACD;EACD,OAAO,CAAC,KAAD,EAAQA,KAAK,CAACG,QAAN,EAAR,CAAP;AACD;AAED,OAAM,SAAUC,iBAAV,CACJC,MADI,EAEJL,KAFI,EAEkB;EAEtB,MAAM,EAAEM,QAAF,EAAYP,SAAZ,EAAuBQ,MAAM,GAAG,EAAhC,KAAuCF,MAA7C;EACA,MAAMG,QAAQ,GAAGF,QAAQ,KAAKb,eAAe,CAACgB,OAA9C;EACA,MAAMC,oBAAoB,GACxBH,MAAM,CAACI,mBAAP,KAA+BV,SAA/B;EACIF,SADJ;EAEIL,kBAAkB,CAACa,MAAM,CAACI,mBAAR,CAHxB;EAIA,OAAOb,WAAW,CAChBU,QAAQ,IAAI,OAAOR,KAAP,KAAiB,QAA7B,IAAyCY,IAAI,CAACC,GAAL,CAASb,KAAT,IAAkB,CAA3D;EACIU,oBADJ;EAEIX,SAHY,EAIhBC,KAJgB,CAAlB;AAMD","names":["GenericDataType","getNumberFormatter","isProbablyHTML","sanitizeHtml","DateWithFormatter","formatValue","formatter","value","undefined","input","toString","formatColumnValue","column","dataType","config","isNumber","NUMERIC","smallNumberFormatter","d3SmallNumberFormat","Math","abs"],"sourceRoot":"","sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/plugins/plugin-chart-table/src/utils/formatValue.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  DataRecordValue,\n  GenericDataType,\n  getNumberFormatter,\n  isProbablyHTML,\n  sanitizeHtml,\n} from '@superset-ui/core';\nimport { DataColumnMeta } from '../types';\nimport DateWithFormatter from './DateWithFormatter';\n\n/**\n * Format text for cell value.\n */\nfunction formatValue(\n  formatter: DataColumnMeta['formatter'],\n  value: DataRecordValue,\n): [boolean, string] {\n  // render undefined as empty string\n  if (value === undefined) {\n    return [false, ''];\n  }\n  // render null as `N/A`\n  if (\n    value === null ||\n    // null values in temporal columns are wrapped in a Date object, so make sure we\n    // handle them here too\n    (value instanceof DateWithFormatter && value.input === null)\n  ) {\n    return [false, 'N/A'];\n  }\n  if (formatter) {\n    return [false, formatter(value as number)];\n  }\n  if (typeof value === 'string') {\n    return isProbablyHTML(value) ? [true, sanitizeHtml(value)] : [false, value];\n  }\n  return [false, value.toString()];\n}\n\nexport function formatColumnValue(\n  column: DataColumnMeta,\n  value: DataRecordValue,\n) {\n  const { dataType, formatter, config = {} } = column;\n  const isNumber = dataType === GenericDataType.NUMERIC;\n  const smallNumberFormatter =\n    config.d3SmallNumberFormat === undefined\n      ? formatter\n      : getNumberFormatter(config.d3SmallNumberFormat);\n  return formatValue(\n    isNumber && typeof value === 'number' && Math.abs(value) < 1\n      ? smallNumberFormatter\n      : formatter,\n    value,\n  );\n}\n"]},"metadata":{},"sourceType":"module"}