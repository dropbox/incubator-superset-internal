{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ensureIsArray, getMetricLabel } from '@superset-ui/core';\nexport function extractExtraMetrics(formData) {\n  const { groupby, timeseries_limit_metric, x_axis_sort, metrics } = formData;\n  const extra_metrics = [];\n  const limitMetric = ensureIsArray(timeseries_limit_metric)[0];\n  if (!(groupby || []).length &&\n  limitMetric &&\n  getMetricLabel(limitMetric) === x_axis_sort &&\n  !(metrics != null && metrics.some((metric) => getMetricLabel(metric) === x_axis_sort))) {\n    extra_metrics.push(limitMetric);\n  }\n  return extra_metrics;\n}","map":{"version":3,"mappings":"AAAA;;;;;;;;;;;;;;;;;;AAkBA,SACEA,aADF,EAEEC,cAFF,QAKO,mBALP;AAOA,OAAM,SAAUC,mBAAV,CACJC,QADI,EACmB;EAEvB,MAAM,EAAEC,OAAF,EAAWC,uBAAX,EAAoCC,WAApC,EAAiDC,OAAjD,KAA6DJ,QAAnE;EACA,MAAMK,aAAa,GAAsB,EAAzC;EACA,MAAMC,WAAW,GAAGT,aAAa,CAACK,uBAAD,CAAb,CAAuC,CAAvC,CAApB;EACA,IACE,CAAC,CAACD,OAAO,IAAI,EAAZ,EAAgBM,MAAjB;EACAD,WADA;EAEAR,cAAc,CAACQ,WAAD,CAAd,KAAgCH,WAFhC;EAGA,EAACC,OAAD,YAACA,OAAO,CAAEI,IAAT,CAAc,OAAM,KAAIV,cAAc,CAACW,MAAD,CAAd,KAA2BN,WAAnD,CAAD,CAJF,EAKE;IACAE,aAAa,CAACK,IAAd,CAAmBJ,WAAnB;EACD;EACD,OAAOD,aAAP;AACD","names":["ensureIsArray","getMetricLabel","extractExtraMetrics","formData","groupby","timeseries_limit_metric","x_axis_sort","metrics","extra_metrics","limitMetric","length","some","metric","push"],"sourceRoot":"","sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/packages/superset-ui-chart-controls/src/operators/utils/extractExtraMetrics.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ensureIsArray,\n  getMetricLabel,\n  QueryFormData,\n  QueryFormMetric,\n} from '@superset-ui/core';\n\nexport function extractExtraMetrics(\n  formData: QueryFormData,\n): QueryFormMetric[] {\n  const { groupby, timeseries_limit_metric, x_axis_sort, metrics } = formData;\n  const extra_metrics: QueryFormMetric[] = [];\n  const limitMetric = ensureIsArray(timeseries_limit_metric)[0];\n  if (\n    !(groupby || []).length &&\n    limitMetric &&\n    getMetricLabel(limitMetric) === x_axis_sort &&\n    !metrics?.some(metric => getMetricLabel(metric) === x_axis_sort)\n  ) {\n    extra_metrics.push(limitMetric);\n  }\n  return extra_metrics;\n}\n"]},"metadata":{},"sourceType":"module"}