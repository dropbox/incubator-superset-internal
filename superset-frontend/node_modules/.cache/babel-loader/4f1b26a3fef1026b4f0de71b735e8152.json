{"ast":null,"code":"import { css as _css } from \"@emotion/react\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport ButtonGroup from 'src/components/ButtonGroup';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport shortid from 'shortid';\nimport { QueryState, styled, t, useTheme, usePrevious } from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport { SaveDatasetModal } from 'src/SqlLab/components/SaveDatasetModal';\nimport { EXPLORE_CHART_DEFAULT } from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport ProgressBar from 'src/components/ProgressBar';\nimport Loading from 'src/components/Loading';\nimport FilterableTable from 'src/components/FilterableTable';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport { addQueryEditor, clearQueryResults, CtasEnum, fetchQueryResults, reFetchQueryResults, reRunQuery } from 'src/SqlLab/actions/sqlLab';\nimport { URL_PARAMS } from 'src/constants';\nimport ExploreCtasResultsButton from '../ExploreCtasResultsButton';\nimport ExploreResultsButton from '../ExploreResultsButton';\nimport HighlightedSql from '../HighlightedSql';\nimport QueryStateLabel from '../QueryStateLabel';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nvar LIMITING_FACTOR;\n(function (LIMITING_FACTOR) {\n  LIMITING_FACTOR[\"QUERY\"] = \"QUERY\";\n  LIMITING_FACTOR[\"QUERY_AND_DROPDOWN\"] = \"QUERY_AND_DROPDOWN\";\n  LIMITING_FACTOR[\"DROPDOWN\"] = \"DROPDOWN\";\n  LIMITING_FACTOR[\"NOT_LIMITED\"] = \"NOT_LIMITED\";\n})(LIMITING_FACTOR || (LIMITING_FACTOR = {}));\nconst ResultlessStyles = styled.div`\n  position: relative;\n  min-height: ${(_ref) => {let { theme } = _ref;return theme.gridUnit * 25;}}px;\n  [role='alert'] {\n    margin-top: ${(_ref2) => {let { theme } = _ref2;return theme.gridUnit * 2;}}px;\n  }\n  .sql-result-track-job {\n    margin-top: ${(_ref3) => {let { theme } = _ref3;return theme.gridUnit * 2;}}px;\n  }\n`;\n// Making text render line breaks/tabs as is as monospace,\n// but wrapping text too so text doesn't overflow\nconst MonospaceDiv = styled.div`\n  font-family: ${(_ref4) => {let { theme } = _ref4;return theme.typography.families.monospace;}};\n  white-space: pre;\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\nconst ReturnedRows = styled.div`\n  font-size: ${(_ref5) => {let { theme } = _ref5;return theme.typography.sizes.s;}}px;\n  line-height: ${(_ref6) => {let { theme } = _ref6;return theme.gridUnit * 6;}}px;\n`;\nconst ResultSetControls = styled.div`\n  display: flex;\n  justify-content: space-between;\n  padding: ${(_ref7) => {let { theme } = _ref7;return 2 * theme.gridUnit;}}px 0;\n`;\nconst ResultSetButtons = styled.div`\n  display: grid;\n  grid-auto-flow: column;\n  padding-right: ${(_ref8) => {let { theme } = _ref8;return 2 * theme.gridUnit;}}px;\n`;\nconst LimitMessage = styled.span`\n  color: ${(_ref9) => {let { theme } = _ref9;return theme.colors.secondary.light1;}};\n  margin-left: ${(_ref10) => {let { theme } = _ref10;return theme.gridUnit * 2;}}px;\n`;\nconst ResultSet = (_ref11) => {var _query$results2, _query$extra$progress, _query$extra;let { cache = false, csv = true, database = {}, displayLimit, height, query, search = true, showSql = false, visualize = true, user, defaultQueryLimit } = _ref11;\n  const theme = useTheme();\n  const [searchText, setSearchText] = useState('');\n  const [cachedData, setCachedData] = useState([]);\n  const [showSaveDatasetModal, setShowSaveDatasetModal] = useState(false);\n  const [alertIsOpen, setAlertIsOpen] = useState(false);\n  const dispatch = useDispatch();\n  const reRunQueryIfSessionTimeoutErrorOnMount = useCallback(() => {\n    if (query.errorMessage &&\n    query.errorMessage.indexOf('session timed out') > 0) {\n      dispatch(reRunQuery(query));\n    }\n  }, []);\n  useEffect(() => {\n    // only do this the first time the component is rendered/mounted\n    reRunQueryIfSessionTimeoutErrorOnMount();\n  }, [reRunQueryIfSessionTimeoutErrorOnMount]);\n  const fetchResults = (query) => {\n    dispatch(fetchQueryResults(query, displayLimit));\n  };\n  const prevQuery = usePrevious(query);\n  useEffect(() => {var _query$results, _query$results$data;\n    if (cache && query.cached && (query == null ? void 0 : (_query$results = query.results) == null ? void 0 : (_query$results$data = _query$results.data) == null ? void 0 : _query$results$data.length) > 0) {\n      setCachedData(query.results.data);\n      dispatch(clearQueryResults(query));\n    }\n    if (query.resultsKey && query.resultsKey !== (prevQuery == null ? void 0 : prevQuery.resultsKey)) {\n      fetchResults(query);\n    }\n  }, [query, cache]);\n  const calculateAlertRefHeight = (alertElement) => {\n    if (alertElement) {\n      setAlertIsOpen(true);\n    } else\n    {\n      setAlertIsOpen(false);\n    }\n  };\n  const popSelectStar = (tempSchema, tempTable) => {\n    const qe = {\n      id: shortid.generate(),\n      name: tempTable,\n      autorun: false,\n      dbId: query.dbId,\n      sql: `SELECT * FROM ${tempSchema ? `${tempSchema}.` : ''}${tempTable}` };\n\n    dispatch(addQueryEditor(qe));\n  };\n  const changeSearch = (event) => {\n    setSearchText(event.target.value);\n  };\n  const createExploreResultsOnClick = async () => {\n    const { results } = query;\n    if (results != null && results.query_id) {\n      const key = await postFormData(results.query_id, 'query', {\n        ...EXPLORE_CHART_DEFAULT,\n        datasource: `${results.query_id}__query`,\n        ...{\n          all_columns: results.columns.map((column) => column.name) } });\n\n\n      const url = mountExploreUrl(null, {\n        [URL_PARAMS.formDataKey.name]: key });\n\n      window.open(url, '_blank', 'noreferrer');\n    } else\n    {\n      addDangerToast(t('Unable to create chart without a query id.'));\n    }\n  };\n  const getExportCsvUrl = (clientId) => `/api/v1/sqllab/export/${clientId}/`;\n  const renderControls = () => {\n    if (search || visualize || csv) {\n      let { data } = query.results;\n      if (cache && query.cached) {\n        data = cachedData;\n      }\n      const { columns } = query.results;\n      // Added compute logic to stop user from being able to Save & Explore\n      const datasource = {\n        columns: query.results.columns,\n        name: (query == null ? void 0 : query.tab) || 'Untitled',\n        dbId: query == null ? void 0 : query.dbId,\n        sql: query == null ? void 0 : query.sql,\n        templateParams: query == null ? void 0 : query.templateParams,\n        schema: query == null ? void 0 : query.schema };\n\n      return ___EmotionJSX(ResultSetControls, null,\n      ___EmotionJSX(SaveDatasetModal, { visible: showSaveDatasetModal, onHide: () => setShowSaveDatasetModal(false), buttonTextOnSave: t('Save & Explore'), buttonTextOnOverwrite: t('Overwrite & Explore'), modalDescription: t('Save this query as a virtual dataset to continue exploring'), datasource: datasource }),\n      ___EmotionJSX(ResultSetButtons, null,\n      visualize && (database == null ? void 0 : database.allows_virtual_table_explore) && ___EmotionJSX(ExploreResultsButton, { database: database, onClick: createExploreResultsOnClick }),\n      csv && ___EmotionJSX(Button, { buttonSize: \"small\", href: getExportCsvUrl(query.id) },\n      ___EmotionJSX(\"i\", { className: \"fa fa-file-text-o\" }), \" \", t('Download to CSV')),\n\n\n      ___EmotionJSX(CopyToClipboard, { text: prepareCopyToClipboardTabularData(data, columns), wrapped: false, copyNode: ___EmotionJSX(Button, { buttonSize: \"small\" },\n        ___EmotionJSX(\"i\", { className: \"fa fa-clipboard\" }), \" \", t('Copy to Clipboard')),\n        hideTooltip: true })),\n\n      search && ___EmotionJSX(\"input\", { type: \"text\", onChange: changeSearch, value: searchText, className: \"form-control input-sm\", placeholder: t('Filter results') }));\n\n    }\n    return ___EmotionJSX(\"div\", null);\n  };\n  const renderRowsReturned = () => {var _user$roles, _results$data;\n    const { results, rows, queryLimit, limitingFactor } = query;\n    let limitMessage;\n    const limitReached = results == null ? void 0 : results.displayLimitReached;\n    const limit = queryLimit || results.query.limit;\n    const isAdmin = !!(user != null && (_user$roles = user.roles) != null && _user$roles.Admin);\n    const rowsCount = Math.min(rows || 0, (results == null ? void 0 : (_results$data = results.data) == null ? void 0 : _results$data.length) || 0);\n    const displayMaxRowsReachedMessage = {\n      withAdmin: t('The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROWS. ' +\n      'Please add additional limits/filters or download to csv to see more rows up to ' +\n      'the %(limit)d limit.', { rows: rowsCount, limit }),\n      withoutAdmin: t('The number of results displayed is limited to %(rows)d. ' +\n      'Please add additional limits/filters, download to csv, or contact an admin ' +\n      'to see more rows up to the %(limit)d limit.', { rows: rowsCount, limit }) };\n\n    const shouldUseDefaultDropdownAlert = limit === defaultQueryLimit &&\n    limitingFactor === LIMITING_FACTOR.DROPDOWN;\n    if (limitingFactor === LIMITING_FACTOR.QUERY && csv) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the query', { rows });\n    } else\n    if (limitingFactor === LIMITING_FACTOR.DROPDOWN &&\n    !shouldUseDefaultDropdownAlert) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the limit dropdown.', { rows });\n    } else\n    if (limitingFactor === LIMITING_FACTOR.QUERY_AND_DROPDOWN) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the query and limit dropdown.', { rows });\n    }\n    const rowsReturnedMessage = t('%(rows)d rows returned', {\n      rows });\n\n    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n    return ___EmotionJSX(ReturnedRows, null,\n    !limitReached && !shouldUseDefaultDropdownAlert && ___EmotionJSX(\"span\", { title: tooltipText },\n    rowsReturnedMessage,\n    ___EmotionJSX(LimitMessage, null, limitMessage)),\n\n    !limitReached && shouldUseDefaultDropdownAlert && ___EmotionJSX(\"div\", { ref: calculateAlertRefHeight },\n    ___EmotionJSX(Alert, { type: \"warning\", message: t('%(rows)d rows returned', { rows }), onClose: () => setAlertIsOpen(false), description: t('The number of rows displayed is limited to %(rows)d by the dropdown.', { rows }) })),\n\n    limitReached && ___EmotionJSX(\"div\", { ref: calculateAlertRefHeight },\n    ___EmotionJSX(Alert, { type: \"warning\", onClose: () => setAlertIsOpen(false), message: t('%(rows)d rows returned', { rows: rowsCount }), description: isAdmin ?\n      displayMaxRowsReachedMessage.withAdmin :\n      displayMaxRowsReachedMessage.withoutAdmin })));\n\n\n  };\n  const limitReached = query == null ? void 0 : (_query$results2 = query.results) == null ? void 0 : _query$results2.displayLimitReached;\n  let sql;\n  let exploreDBId = query.dbId;\n  if (database != null && database.explore_database_id) {\n    exploreDBId = database.explore_database_id;\n  }\n  let trackingUrl;\n  if (query.trackingUrl &&\n  query.state !== QueryState.SUCCESS &&\n  query.state !== QueryState.FETCHING) {\n    trackingUrl = ___EmotionJSX(Button, { className: \"sql-result-track-job\", buttonSize: \"small\", href: query.trackingUrl, target: \"_blank\" },\n    query.state === QueryState.RUNNING ?\n    t('Track job') :\n    t('See query details'));\n\n  }\n  if (showSql) {\n    sql = ___EmotionJSX(HighlightedSql, { sql: query.sql });\n  }\n  if (query.state === QueryState.STOPPED) {\n    return ___EmotionJSX(Alert, { type: \"warning\", message: t('Query was stopped') });\n  }\n  if (query.state === QueryState.FAILED) {var _query$errors;\n    return ___EmotionJSX(ResultlessStyles, null,\n    ___EmotionJSX(ErrorMessageWithStackTrace, { title: t('Database error'), error: query == null ? void 0 : (_query$errors = query.errors) == null ? void 0 : _query$errors[0], subtitle: ___EmotionJSX(MonospaceDiv, null, query.errorMessage), copyText: query.errorMessage || undefined, link: query.link, source: \"sqllab\" }),\n    trackingUrl);\n\n  }\n  if (query.state === QueryState.SUCCESS && query.ctas) {\n    const { tempSchema, tempTable } = query;\n    let object = 'Table';\n    if (query.ctas_method === CtasEnum.VIEW) {\n      object = 'View';\n    }\n    return ___EmotionJSX(\"div\", null,\n    ___EmotionJSX(Alert, { type: \"info\", message: ___EmotionJSX(React.Fragment, null,\n      t(object), \" [\",\n      ___EmotionJSX(\"strong\", null,\n      tempSchema ? `${tempSchema}.` : '',\n      tempTable), \"] \",\n\n      t('was created'), \" \\xA0\",\n      ___EmotionJSX(ButtonGroup, null,\n      ___EmotionJSX(Button, { buttonSize: \"small\", css: /*#__PURE__*/_css({ marginRight: theme.gridUnit }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ResultSet;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9ib2dkYW5reXJ5bGl1ay9jb2RlL29wZW5zb3VyY2Uvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL1NxbExhYi9jb21wb25lbnRzL1Jlc3VsdFNldC9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBdVIyQyIsImZpbGUiOiIvVXNlcnMvYm9nZGFua3lyeWxpdWsvY29kZS9vcGVuc291cmNlL3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3NyYy9TcWxMYWIvY29tcG9uZW50cy9SZXN1bHRTZXQvaW5kZXgudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlRGlzcGF0Y2ggfSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQgQnV0dG9uR3JvdXAgZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uR3JvdXAnO1xuaW1wb3J0IEFsZXJ0IGZyb20gJ3NyYy9jb21wb25lbnRzL0FsZXJ0JztcbmltcG9ydCBCdXR0b24gZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uJztcbmltcG9ydCBzaG9ydGlkIGZyb20gJ3Nob3J0aWQnO1xuaW1wb3J0IHsgUXVlcnlTdGF0ZSwgc3R5bGVkLCB0LCB1c2VUaGVtZSwgdXNlUHJldmlvdXMsIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IEVycm9yTWVzc2FnZVdpdGhTdGFja1RyYWNlIGZyb20gJ3NyYy9jb21wb25lbnRzL0Vycm9yTWVzc2FnZS9FcnJvck1lc3NhZ2VXaXRoU3RhY2tUcmFjZSc7XG5pbXBvcnQgeyBTYXZlRGF0YXNldE1vZGFsLCB9IGZyb20gJ3NyYy9TcWxMYWIvY29tcG9uZW50cy9TYXZlRGF0YXNldE1vZGFsJztcbmltcG9ydCB7IEVYUExPUkVfQ0hBUlRfREVGQVVMVCB9IGZyb20gJ3NyYy9TcWxMYWIvdHlwZXMnO1xuaW1wb3J0IHsgbW91bnRFeHBsb3JlVXJsIH0gZnJvbSAnc3JjL2V4cGxvcmUvZXhwbG9yZVV0aWxzJztcbmltcG9ydCB7IHBvc3RGb3JtRGF0YSB9IGZyb20gJ3NyYy9leHBsb3JlL2V4cGxvcmVVdGlscy9mb3JtRGF0YSc7XG5pbXBvcnQgUHJvZ3Jlc3NCYXIgZnJvbSAnc3JjL2NvbXBvbmVudHMvUHJvZ3Jlc3NCYXInO1xuaW1wb3J0IExvYWRpbmcgZnJvbSAnc3JjL2NvbXBvbmVudHMvTG9hZGluZyc7XG5pbXBvcnQgRmlsdGVyYWJsZVRhYmxlIGZyb20gJ3NyYy9jb21wb25lbnRzL0ZpbHRlcmFibGVUYWJsZSc7XG5pbXBvcnQgQ29weVRvQ2xpcGJvYXJkIGZyb20gJ3NyYy9jb21wb25lbnRzL0NvcHlUb0NsaXBib2FyZCc7XG5pbXBvcnQgeyBhZGREYW5nZXJUb2FzdCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL01lc3NhZ2VUb2FzdHMvYWN0aW9ucyc7XG5pbXBvcnQgeyBwcmVwYXJlQ29weVRvQ2xpcGJvYXJkVGFidWxhckRhdGEgfSBmcm9tICdzcmMvdXRpbHMvY29tbW9uJztcbmltcG9ydCB7IGFkZFF1ZXJ5RWRpdG9yLCBjbGVhclF1ZXJ5UmVzdWx0cywgQ3Rhc0VudW0sIGZldGNoUXVlcnlSZXN1bHRzLCByZUZldGNoUXVlcnlSZXN1bHRzLCByZVJ1blF1ZXJ5LCB9IGZyb20gJ3NyYy9TcWxMYWIvYWN0aW9ucy9zcWxMYWInO1xuaW1wb3J0IHsgVVJMX1BBUkFNUyB9IGZyb20gJ3NyYy9jb25zdGFudHMnO1xuaW1wb3J0IEV4cGxvcmVDdGFzUmVzdWx0c0J1dHRvbiBmcm9tICcuLi9FeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24nO1xuaW1wb3J0IEV4cGxvcmVSZXN1bHRzQnV0dG9uIGZyb20gJy4uL0V4cGxvcmVSZXN1bHRzQnV0dG9uJztcbmltcG9ydCBIaWdobGlnaHRlZFNxbCBmcm9tICcuLi9IaWdobGlnaHRlZFNxbCc7XG5pbXBvcnQgUXVlcnlTdGF0ZUxhYmVsIGZyb20gJy4uL1F1ZXJ5U3RhdGVMYWJlbCc7XG52YXIgTElNSVRJTkdfRkFDVE9SO1xuKGZ1bmN0aW9uIChMSU1JVElOR19GQUNUT1IpIHtcbiAgICBMSU1JVElOR19GQUNUT1JbXCJRVUVSWVwiXSA9IFwiUVVFUllcIjtcbiAgICBMSU1JVElOR19GQUNUT1JbXCJRVUVSWV9BTkRfRFJPUERPV05cIl0gPSBcIlFVRVJZX0FORF9EUk9QRE9XTlwiO1xuICAgIExJTUlUSU5HX0ZBQ1RPUltcIkRST1BET1dOXCJdID0gXCJEUk9QRE9XTlwiO1xuICAgIExJTUlUSU5HX0ZBQ1RPUltcIk5PVF9MSU1JVEVEXCJdID0gXCJOT1RfTElNSVRFRFwiO1xufSkoTElNSVRJTkdfRkFDVE9SIHx8IChMSU1JVElOR19GQUNUT1IgPSB7fSkpO1xuY29uc3QgUmVzdWx0bGVzc1N0eWxlcyA9IHN0eWxlZC5kaXYgYFxuICBwb3NpdGlvbjogcmVsYXRpdmU7XG4gIG1pbi1oZWlnaHQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyNX1weDtcbiAgW3JvbGU9J2FsZXJ0J10ge1xuICAgIG1hcmdpbi10b3A6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICB9XG4gIC5zcWwtcmVzdWx0LXRyYWNrLWpvYiB7XG4gICAgbWFyZ2luLXRvcDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDJ9cHg7XG4gIH1cbmA7XG4vLyBNYWtpbmcgdGV4dCByZW5kZXIgbGluZSBicmVha3MvdGFicyBhcyBpcyBhcyBtb25vc3BhY2UsXG4vLyBidXQgd3JhcHBpbmcgdGV4dCB0b28gc28gdGV4dCBkb2Vzbid0IG92ZXJmbG93XG5jb25zdCBNb25vc3BhY2VEaXYgPSBzdHlsZWQuZGl2IGBcbiAgZm9udC1mYW1pbHk6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUudHlwb2dyYXBoeS5mYW1pbGllcy5tb25vc3BhY2V9O1xuICB3aGl0ZS1zcGFjZTogcHJlO1xuICB3b3JkLWJyZWFrOiBicmVhay13b3JkO1xuICBvdmVyZmxvdy14OiBhdXRvO1xuICB3aGl0ZS1zcGFjZTogcHJlLXdyYXA7XG5gO1xuY29uc3QgUmV0dXJuZWRSb3dzID0gc3R5bGVkLmRpdiBgXG4gIGZvbnQtc2l6ZTogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS50eXBvZ3JhcGh5LnNpemVzLnN9cHg7XG4gIGxpbmUtaGVpZ2h0OiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogNn1weDtcbmA7XG5jb25zdCBSZXN1bHRTZXRDb250cm9scyA9IHN0eWxlZC5kaXYgYFxuICBkaXNwbGF5OiBmbGV4O1xuICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47XG4gIHBhZGRpbmc6ICR7KHsgdGhlbWUgfSkgPT4gMiAqIHRoZW1lLmdyaWRVbml0fXB4IDA7XG5gO1xuY29uc3QgUmVzdWx0U2V0QnV0dG9ucyA9IHN0eWxlZC5kaXYgYFxuICBkaXNwbGF5OiBncmlkO1xuICBncmlkLWF1dG8tZmxvdzogY29sdW1uO1xuICBwYWRkaW5nLXJpZ2h0OiAkeyh7IHRoZW1lIH0pID0+IDIgKiB0aGVtZS5ncmlkVW5pdH1weDtcbmA7XG5jb25zdCBMaW1pdE1lc3NhZ2UgPSBzdHlsZWQuc3BhbiBgXG4gIGNvbG9yOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5zZWNvbmRhcnkubGlnaHQxfTtcbiAgbWFyZ2luLWxlZnQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuYDtcbmNvbnN0IFJlc3VsdFNldCA9ICh7IGNhY2hlID0gZmFsc2UsIGNzdiA9IHRydWUsIGRhdGFiYXNlID0ge30sIGRpc3BsYXlMaW1pdCwgaGVpZ2h0LCBxdWVyeSwgc2VhcmNoID0gdHJ1ZSwgc2hvd1NxbCA9IGZhbHNlLCB2aXN1YWxpemUgPSB0cnVlLCB1c2VyLCBkZWZhdWx0UXVlcnlMaW1pdCwgfSkgPT4ge1xuICAgIGNvbnN0IHRoZW1lID0gdXNlVGhlbWUoKTtcbiAgICBjb25zdCBbc2VhcmNoVGV4dCwgc2V0U2VhcmNoVGV4dF0gPSB1c2VTdGF0ZSgnJyk7XG4gICAgY29uc3QgW2NhY2hlZERhdGEsIHNldENhY2hlZERhdGFdID0gdXNlU3RhdGUoW10pO1xuICAgIGNvbnN0IFtzaG93U2F2ZURhdGFzZXRNb2RhbCwgc2V0U2hvd1NhdmVEYXRhc2V0TW9kYWxdID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IFthbGVydElzT3Blbiwgc2V0QWxlcnRJc09wZW5dID0gdXNlU3RhdGUoZmFsc2UpO1xuICAgIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKTtcbiAgICBjb25zdCByZVJ1blF1ZXJ5SWZTZXNzaW9uVGltZW91dEVycm9yT25Nb3VudCA9IHVzZUNhbGxiYWNrKCgpID0+IHtcbiAgICAgICAgaWYgKHF1ZXJ5LmVycm9yTWVzc2FnZSAmJlxuICAgICAgICAgICAgcXVlcnkuZXJyb3JNZXNzYWdlLmluZGV4T2YoJ3Nlc3Npb24gdGltZWQgb3V0JykgPiAwKSB7XG4gICAgICAgICAgICBkaXNwYXRjaChyZVJ1blF1ZXJ5KHF1ZXJ5KSk7XG4gICAgICAgIH1cbiAgICB9LCBbXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgLy8gb25seSBkbyB0aGlzIHRoZSBmaXJzdCB0aW1lIHRoZSBjb21wb25lbnQgaXMgcmVuZGVyZWQvbW91bnRlZFxuICAgICAgICByZVJ1blF1ZXJ5SWZTZXNzaW9uVGltZW91dEVycm9yT25Nb3VudCgpO1xuICAgIH0sIFtyZVJ1blF1ZXJ5SWZTZXNzaW9uVGltZW91dEVycm9yT25Nb3VudF0pO1xuICAgIGNvbnN0IGZldGNoUmVzdWx0cyA9IChxdWVyeSkgPT4ge1xuICAgICAgICBkaXNwYXRjaChmZXRjaFF1ZXJ5UmVzdWx0cyhxdWVyeSwgZGlzcGxheUxpbWl0KSk7XG4gICAgfTtcbiAgICBjb25zdCBwcmV2UXVlcnkgPSB1c2VQcmV2aW91cyhxdWVyeSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKGNhY2hlICYmIHF1ZXJ5LmNhY2hlZCAmJiBxdWVyeT8ucmVzdWx0cz8uZGF0YT8ubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgc2V0Q2FjaGVkRGF0YShxdWVyeS5yZXN1bHRzLmRhdGEpO1xuICAgICAgICAgICAgZGlzcGF0Y2goY2xlYXJRdWVyeVJlc3VsdHMocXVlcnkpKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAocXVlcnkucmVzdWx0c0tleSAmJiBxdWVyeS5yZXN1bHRzS2V5ICE9PSBwcmV2UXVlcnk/LnJlc3VsdHNLZXkpIHtcbiAgICAgICAgICAgIGZldGNoUmVzdWx0cyhxdWVyeSk7XG4gICAgICAgIH1cbiAgICB9LCBbcXVlcnksIGNhY2hlXSk7XG4gICAgY29uc3QgY2FsY3VsYXRlQWxlcnRSZWZIZWlnaHQgPSAoYWxlcnRFbGVtZW50KSA9PiB7XG4gICAgICAgIGlmIChhbGVydEVsZW1lbnQpIHtcbiAgICAgICAgICAgIHNldEFsZXJ0SXNPcGVuKHRydWUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgc2V0QWxlcnRJc09wZW4oZmFsc2UpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBwb3BTZWxlY3RTdGFyID0gKHRlbXBTY2hlbWEsIHRlbXBUYWJsZSkgPT4ge1xuICAgICAgICBjb25zdCBxZSA9IHtcbiAgICAgICAgICAgIGlkOiBzaG9ydGlkLmdlbmVyYXRlKCksXG4gICAgICAgICAgICBuYW1lOiB0ZW1wVGFibGUsXG4gICAgICAgICAgICBhdXRvcnVuOiBmYWxzZSxcbiAgICAgICAgICAgIGRiSWQ6IHF1ZXJ5LmRiSWQsXG4gICAgICAgICAgICBzcWw6IGBTRUxFQ1QgKiBGUk9NICR7dGVtcFNjaGVtYSA/IGAke3RlbXBTY2hlbWF9LmAgOiAnJ30ke3RlbXBUYWJsZX1gLFxuICAgICAgICB9O1xuICAgICAgICBkaXNwYXRjaChhZGRRdWVyeUVkaXRvcihxZSkpO1xuICAgIH07XG4gICAgY29uc3QgY2hhbmdlU2VhcmNoID0gKGV2ZW50KSA9PiB7XG4gICAgICAgIHNldFNlYXJjaFRleHQoZXZlbnQudGFyZ2V0LnZhbHVlKTtcbiAgICB9O1xuICAgIGNvbnN0IGNyZWF0ZUV4cGxvcmVSZXN1bHRzT25DbGljayA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgY29uc3QgeyByZXN1bHRzIH0gPSBxdWVyeTtcbiAgICAgICAgaWYgKHJlc3VsdHM/LnF1ZXJ5X2lkKSB7XG4gICAgICAgICAgICBjb25zdCBrZXkgPSBhd2FpdCBwb3N0Rm9ybURhdGEocmVzdWx0cy5xdWVyeV9pZCwgJ3F1ZXJ5Jywge1xuICAgICAgICAgICAgICAgIC4uLkVYUExPUkVfQ0hBUlRfREVGQVVMVCxcbiAgICAgICAgICAgICAgICBkYXRhc291cmNlOiBgJHtyZXN1bHRzLnF1ZXJ5X2lkfV9fcXVlcnlgLFxuICAgICAgICAgICAgICAgIC4uLntcbiAgICAgICAgICAgICAgICAgICAgYWxsX2NvbHVtbnM6IHJlc3VsdHMuY29sdW1ucy5tYXAoY29sdW1uID0+IGNvbHVtbi5uYW1lKSxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBjb25zdCB1cmwgPSBtb3VudEV4cGxvcmVVcmwobnVsbCwge1xuICAgICAgICAgICAgICAgIFtVUkxfUEFSQU1TLmZvcm1EYXRhS2V5Lm5hbWVdOiBrZXksXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHdpbmRvdy5vcGVuKHVybCwgJ19ibGFuaycsICdub3JlZmVycmVyJyk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBhZGREYW5nZXJUb2FzdCh0KCdVbmFibGUgdG8gY3JlYXRlIGNoYXJ0IHdpdGhvdXQgYSBxdWVyeSBpZC4nKSk7XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGdldEV4cG9ydENzdlVybCA9IChjbGllbnRJZCkgPT4gYC9hcGkvdjEvc3FsbGFiL2V4cG9ydC8ke2NsaWVudElkfS9gO1xuICAgIGNvbnN0IHJlbmRlckNvbnRyb2xzID0gKCkgPT4ge1xuICAgICAgICBpZiAoc2VhcmNoIHx8IHZpc3VhbGl6ZSB8fCBjc3YpIHtcbiAgICAgICAgICAgIGxldCB7IGRhdGEgfSA9IHF1ZXJ5LnJlc3VsdHM7XG4gICAgICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkKSB7XG4gICAgICAgICAgICAgICAgZGF0YSA9IGNhY2hlZERhdGE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjb25zdCB7IGNvbHVtbnMgfSA9IHF1ZXJ5LnJlc3VsdHM7XG4gICAgICAgICAgICAvLyBBZGRlZCBjb21wdXRlIGxvZ2ljIHRvIHN0b3AgdXNlciBmcm9tIGJlaW5nIGFibGUgdG8gU2F2ZSAmIEV4cGxvcmVcbiAgICAgICAgICAgIGNvbnN0IGRhdGFzb3VyY2UgPSB7XG4gICAgICAgICAgICAgICAgY29sdW1uczogcXVlcnkucmVzdWx0cy5jb2x1bW5zLFxuICAgICAgICAgICAgICAgIG5hbWU6IHF1ZXJ5Py50YWIgfHwgJ1VudGl0bGVkJyxcbiAgICAgICAgICAgICAgICBkYklkOiBxdWVyeT8uZGJJZCxcbiAgICAgICAgICAgICAgICBzcWw6IHF1ZXJ5Py5zcWwsXG4gICAgICAgICAgICAgICAgdGVtcGxhdGVQYXJhbXM6IHF1ZXJ5Py50ZW1wbGF0ZVBhcmFtcyxcbiAgICAgICAgICAgICAgICBzY2hlbWE6IHF1ZXJ5Py5zY2hlbWEsXG4gICAgICAgICAgICB9O1xuICAgICAgICAgICAgcmV0dXJuICg8UmVzdWx0U2V0Q29udHJvbHM+XG4gICAgICAgICAgPFNhdmVEYXRhc2V0TW9kYWwgdmlzaWJsZT17c2hvd1NhdmVEYXRhc2V0TW9kYWx9IG9uSGlkZT17KCkgPT4gc2V0U2hvd1NhdmVEYXRhc2V0TW9kYWwoZmFsc2UpfSBidXR0b25UZXh0T25TYXZlPXt0KCdTYXZlICYgRXhwbG9yZScpfSBidXR0b25UZXh0T25PdmVyd3JpdGU9e3QoJ092ZXJ3cml0ZSAmIEV4cGxvcmUnKX0gbW9kYWxEZXNjcmlwdGlvbj17dCgnU2F2ZSB0aGlzIHF1ZXJ5IGFzIGEgdmlydHVhbCBkYXRhc2V0IHRvIGNvbnRpbnVlIGV4cGxvcmluZycpfSBkYXRhc291cmNlPXtkYXRhc291cmNlfS8+XG4gICAgICAgICAgPFJlc3VsdFNldEJ1dHRvbnM+XG4gICAgICAgICAgICB7dmlzdWFsaXplICYmIGRhdGFiYXNlPy5hbGxvd3NfdmlydHVhbF90YWJsZV9leHBsb3JlICYmICg8RXhwbG9yZVJlc3VsdHNCdXR0b24gZGF0YWJhc2U9e2RhdGFiYXNlfSBvbkNsaWNrPXtjcmVhdGVFeHBsb3JlUmVzdWx0c09uQ2xpY2t9Lz4pfVxuICAgICAgICAgICAge2NzdiAmJiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBocmVmPXtnZXRFeHBvcnRDc3ZVcmwocXVlcnkuaWQpfT5cbiAgICAgICAgICAgICAgICA8aSBjbGFzc05hbWU9XCJmYSBmYS1maWxlLXRleHQtb1wiLz4ge3QoJ0Rvd25sb2FkIHRvIENTVicpfVxuICAgICAgICAgICAgICA8L0J1dHRvbj4pfVxuXG4gICAgICAgICAgICA8Q29weVRvQ2xpcGJvYXJkIHRleHQ9e3ByZXBhcmVDb3B5VG9DbGlwYm9hcmRUYWJ1bGFyRGF0YShkYXRhLCBjb2x1bW5zKX0gd3JhcHBlZD17ZmFsc2V9IGNvcHlOb2RlPXs8QnV0dG9uIGJ1dHRvblNpemU9XCJzbWFsbFwiPlxuICAgICAgICAgICAgICAgICAgPGkgY2xhc3NOYW1lPVwiZmEgZmEtY2xpcGJvYXJkXCIvPiB7dCgnQ29weSB0byBDbGlwYm9hcmQnKX1cbiAgICAgICAgICAgICAgICA8L0J1dHRvbj59IGhpZGVUb29sdGlwLz5cbiAgICAgICAgICA8L1Jlc3VsdFNldEJ1dHRvbnM+XG4gICAgICAgICAge3NlYXJjaCAmJiAoPGlucHV0IHR5cGU9XCJ0ZXh0XCIgb25DaGFuZ2U9e2NoYW5nZVNlYXJjaH0gdmFsdWU9e3NlYXJjaFRleHR9IGNsYXNzTmFtZT1cImZvcm0tY29udHJvbCBpbnB1dC1zbVwiIHBsYWNlaG9sZGVyPXt0KCdGaWx0ZXIgcmVzdWx0cycpfS8+KX1cbiAgICAgICAgPC9SZXN1bHRTZXRDb250cm9scz4pO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiA8ZGl2IC8+O1xuICAgIH07XG4gICAgY29uc3QgcmVuZGVyUm93c1JldHVybmVkID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB7IHJlc3VsdHMsIHJvd3MsIHF1ZXJ5TGltaXQsIGxpbWl0aW5nRmFjdG9yIH0gPSBxdWVyeTtcbiAgICAgICAgbGV0IGxpbWl0TWVzc2FnZTtcbiAgICAgICAgY29uc3QgbGltaXRSZWFjaGVkID0gcmVzdWx0cz8uZGlzcGxheUxpbWl0UmVhY2hlZDtcbiAgICAgICAgY29uc3QgbGltaXQgPSBxdWVyeUxpbWl0IHx8IHJlc3VsdHMucXVlcnkubGltaXQ7XG4gICAgICAgIGNvbnN0IGlzQWRtaW4gPSAhIXVzZXI/LnJvbGVzPy5BZG1pbjtcbiAgICAgICAgY29uc3Qgcm93c0NvdW50ID0gTWF0aC5taW4ocm93cyB8fCAwLCByZXN1bHRzPy5kYXRhPy5sZW5ndGggfHwgMCk7XG4gICAgICAgIGNvbnN0IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2UgPSB7XG4gICAgICAgICAgICB3aXRoQWRtaW46IHQoJ1RoZSBudW1iZXIgb2YgcmVzdWx0cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZCBieSB0aGUgY29uZmlndXJhdGlvbiBESVNQTEFZX01BWF9ST1dTLiAnICtcbiAgICAgICAgICAgICAgICAnUGxlYXNlIGFkZCBhZGRpdGlvbmFsIGxpbWl0cy9maWx0ZXJzIG9yIGRvd25sb2FkIHRvIGNzdiB0byBzZWUgbW9yZSByb3dzIHVwIHRvICcgK1xuICAgICAgICAgICAgICAgICd0aGUgJShsaW1pdClkIGxpbWl0LicsIHsgcm93czogcm93c0NvdW50LCBsaW1pdCB9KSxcbiAgICAgICAgICAgIHdpdGhvdXRBZG1pbjogdCgnVGhlIG51bWJlciBvZiByZXN1bHRzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkLiAnICtcbiAgICAgICAgICAgICAgICAnUGxlYXNlIGFkZCBhZGRpdGlvbmFsIGxpbWl0cy9maWx0ZXJzLCBkb3dubG9hZCB0byBjc3YsIG9yIGNvbnRhY3QgYW4gYWRtaW4gJyArXG4gICAgICAgICAgICAgICAgJ3RvIHNlZSBtb3JlIHJvd3MgdXAgdG8gdGhlICUobGltaXQpZCBsaW1pdC4nLCB7IHJvd3M6IHJvd3NDb3VudCwgbGltaXQgfSksXG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IHNob3VsZFVzZURlZmF1bHREcm9wZG93bkFsZXJ0ID0gbGltaXQgPT09IGRlZmF1bHRRdWVyeUxpbWl0ICYmXG4gICAgICAgICAgICBsaW1pdGluZ0ZhY3RvciA9PT0gTElNSVRJTkdfRkFDVE9SLkRST1BET1dOO1xuICAgICAgICBpZiAobGltaXRpbmdGYWN0b3IgPT09IExJTUlUSU5HX0ZBQ1RPUi5RVUVSWSAmJiBjc3YpIHtcbiAgICAgICAgICAgIGxpbWl0TWVzc2FnZSA9IHQoJ1RoZSBudW1iZXIgb2Ygcm93cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZCBieSB0aGUgcXVlcnknLCB7IHJvd3MgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobGltaXRpbmdGYWN0b3IgPT09IExJTUlUSU5HX0ZBQ1RPUi5EUk9QRE9XTiAmJlxuICAgICAgICAgICAgIXNob3VsZFVzZURlZmF1bHREcm9wZG93bkFsZXJ0KSB7XG4gICAgICAgICAgICBsaW1pdE1lc3NhZ2UgPSB0KCdUaGUgbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQgYnkgdGhlIGxpbWl0IGRyb3Bkb3duLicsIHsgcm93cyB9KTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChsaW1pdGluZ0ZhY3RvciA9PT0gTElNSVRJTkdfRkFDVE9SLlFVRVJZX0FORF9EUk9QRE9XTikge1xuICAgICAgICAgICAgbGltaXRNZXNzYWdlID0gdCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBxdWVyeSBhbmQgbGltaXQgZHJvcGRvd24uJywgeyByb3dzIH0pO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHJvd3NSZXR1cm5lZE1lc3NhZ2UgPSB0KCclKHJvd3MpZCByb3dzIHJldHVybmVkJywge1xuICAgICAgICAgICAgcm93cyxcbiAgICAgICAgfSk7XG4gICAgICAgIGNvbnN0IHRvb2x0aXBUZXh0ID0gYCR7cm93c1JldHVybmVkTWVzc2FnZX0uICR7bGltaXRNZXNzYWdlfWA7XG4gICAgICAgIHJldHVybiAoPFJldHVybmVkUm93cz5cbiAgICAgICAgeyFsaW1pdFJlYWNoZWQgJiYgIXNob3VsZFVzZURlZmF1bHREcm9wZG93bkFsZXJ0ICYmICg8c3BhbiB0aXRsZT17dG9vbHRpcFRleHR9PlxuICAgICAgICAgICAge3Jvd3NSZXR1cm5lZE1lc3NhZ2V9XG4gICAgICAgICAgICA8TGltaXRNZXNzYWdlPntsaW1pdE1lc3NhZ2V9PC9MaW1pdE1lc3NhZ2U+XG4gICAgICAgICAgPC9zcGFuPil9XG4gICAgICAgIHshbGltaXRSZWFjaGVkICYmIHNob3VsZFVzZURlZmF1bHREcm9wZG93bkFsZXJ0ICYmICg8ZGl2IHJlZj17Y2FsY3VsYXRlQWxlcnRSZWZIZWlnaHR9PlxuICAgICAgICAgICAgPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgbWVzc2FnZT17dCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHsgcm93cyB9KX0gb25DbG9zZT17KCkgPT4gc2V0QWxlcnRJc09wZW4oZmFsc2UpfSBkZXNjcmlwdGlvbj17dCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBkcm9wZG93bi4nLCB7IHJvd3MgfSl9Lz5cbiAgICAgICAgICA8L2Rpdj4pfVxuICAgICAgICB7bGltaXRSZWFjaGVkICYmICg8ZGl2IHJlZj17Y2FsY3VsYXRlQWxlcnRSZWZIZWlnaHR9PlxuICAgICAgICAgICAgPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgb25DbG9zZT17KCkgPT4gc2V0QWxlcnRJc09wZW4oZmFsc2UpfSBtZXNzYWdlPXt0KCclKHJvd3MpZCByb3dzIHJldHVybmVkJywgeyByb3dzOiByb3dzQ291bnQgfSl9IGRlc2NyaXB0aW9uPXtpc0FkbWluXG4gICAgICAgICAgICAgICAgICAgID8gZGlzcGxheU1heFJvd3NSZWFjaGVkTWVzc2FnZS53aXRoQWRtaW5cbiAgICAgICAgICAgICAgICAgICAgOiBkaXNwbGF5TWF4Um93c1JlYWNoZWRNZXNzYWdlLndpdGhvdXRBZG1pbn0vPlxuICAgICAgICAgIDwvZGl2Pil9XG4gICAgICA8L1JldHVybmVkUm93cz4pO1xuICAgIH07XG4gICAgY29uc3QgbGltaXRSZWFjaGVkID0gcXVlcnk/LnJlc3VsdHM/LmRpc3BsYXlMaW1pdFJlYWNoZWQ7XG4gICAgbGV0IHNxbDtcbiAgICBsZXQgZXhwbG9yZURCSWQgPSBxdWVyeS5kYklkO1xuICAgIGlmIChkYXRhYmFzZT8uZXhwbG9yZV9kYXRhYmFzZV9pZCkge1xuICAgICAgICBleHBsb3JlREJJZCA9IGRhdGFiYXNlLmV4cGxvcmVfZGF0YWJhc2VfaWQ7XG4gICAgfVxuICAgIGxldCB0cmFja2luZ1VybDtcbiAgICBpZiAocXVlcnkudHJhY2tpbmdVcmwgJiZcbiAgICAgICAgcXVlcnkuc3RhdGUgIT09IFF1ZXJ5U3RhdGUuU1VDQ0VTUyAmJlxuICAgICAgICBxdWVyeS5zdGF0ZSAhPT0gUXVlcnlTdGF0ZS5GRVRDSElORykge1xuICAgICAgICB0cmFja2luZ1VybCA9ICg8QnV0dG9uIGNsYXNzTmFtZT1cInNxbC1yZXN1bHQtdHJhY2stam9iXCIgYnV0dG9uU2l6ZT1cInNtYWxsXCIgaHJlZj17cXVlcnkudHJhY2tpbmdVcmx9IHRhcmdldD1cIl9ibGFua1wiPlxuICAgICAgICB7cXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuUlVOTklOR1xuICAgICAgICAgICAgICAgID8gdCgnVHJhY2sgam9iJylcbiAgICAgICAgICAgICAgICA6IHQoJ1NlZSBxdWVyeSBkZXRhaWxzJyl9XG4gICAgICA8L0J1dHRvbj4pO1xuICAgIH1cbiAgICBpZiAoc2hvd1NxbCkge1xuICAgICAgICBzcWwgPSA8SGlnaGxpZ2h0ZWRTcWwgc3FsPXtxdWVyeS5zcWx9Lz47XG4gICAgfVxuICAgIGlmIChxdWVyeS5zdGF0ZSA9PT0gUXVlcnlTdGF0ZS5TVE9QUEVEKSB7XG4gICAgICAgIHJldHVybiA8QWxlcnQgdHlwZT1cIndhcm5pbmdcIiBtZXNzYWdlPXt0KCdRdWVyeSB3YXMgc3RvcHBlZCcpfS8+O1xuICAgIH1cbiAgICBpZiAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuRkFJTEVEKSB7XG4gICAgICAgIHJldHVybiAoPFJlc3VsdGxlc3NTdHlsZXM+XG4gICAgICAgIDxFcnJvck1lc3NhZ2VXaXRoU3RhY2tUcmFjZSB0aXRsZT17dCgnRGF0YWJhc2UgZXJyb3InKX0gZXJyb3I9e3F1ZXJ5Py5lcnJvcnM/LlswXX0gc3VidGl0bGU9ezxNb25vc3BhY2VEaXY+e3F1ZXJ5LmVycm9yTWVzc2FnZX08L01vbm9zcGFjZURpdj59IGNvcHlUZXh0PXtxdWVyeS5lcnJvck1lc3NhZ2UgfHwgdW5kZWZpbmVkfSBsaW5rPXtxdWVyeS5saW5rfSBzb3VyY2U9XCJzcWxsYWJcIi8+XG4gICAgICAgIHt0cmFja2luZ1VybH1cbiAgICAgIDwvUmVzdWx0bGVzc1N0eWxlcz4pO1xuICAgIH1cbiAgICBpZiAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU1VDQ0VTUyAmJiBxdWVyeS5jdGFzKSB7XG4gICAgICAgIGNvbnN0IHsgdGVtcFNjaGVtYSwgdGVtcFRhYmxlIH0gPSBxdWVyeTtcbiAgICAgICAgbGV0IG9iamVjdCA9ICdUYWJsZSc7XG4gICAgICAgIGlmIChxdWVyeS5jdGFzX21ldGhvZCA9PT0gQ3Rhc0VudW0uVklFVykge1xuICAgICAgICAgICAgb2JqZWN0ID0gJ1ZpZXcnO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiAoPGRpdj5cbiAgICAgICAgPEFsZXJ0IHR5cGU9XCJpbmZvXCIgbWVzc2FnZT17PD5cbiAgICAgICAgICAgICAge3Qob2JqZWN0KX0gW1xuICAgICAgICAgICAgICA8c3Ryb25nPlxuICAgICAgICAgICAgICAgIHt0ZW1wU2NoZW1hID8gYCR7dGVtcFNjaGVtYX0uYCA6ICcnfVxuICAgICAgICAgICAgICAgIHt0ZW1wVGFibGV9XG4gICAgICAgICAgICAgIDwvc3Ryb25nPlxuICAgICAgICAgICAgICBdIHt0KCd3YXMgY3JlYXRlZCcpfSAmbmJzcDtcbiAgICAgICAgICAgICAgPEJ1dHRvbkdyb3VwPlxuICAgICAgICAgICAgICAgIDxCdXR0b24gYnV0dG9uU2l6ZT1cInNtYWxsXCIgY3NzPXt7IG1hcmdpblJpZ2h0OiB0aGVtZS5ncmlkVW5pdCB9fSBvbkNsaWNrPXsoKSA9PiBwb3BTZWxlY3RTdGFyKHRlbXBTY2hlbWEsIHRlbXBUYWJsZSl9PlxuICAgICAgICAgICAgICAgICAge3QoJ1F1ZXJ5IGluIGEgbmV3IHRhYicpfVxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPlxuICAgICAgICAgICAgICAgIDxFeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24gdGFibGU9e3RlbXBUYWJsZX0gc2NoZW1hPXt0ZW1wU2NoZW1hfSBkYklkPXtleHBsb3JlREJJZH0vPlxuICAgICAgICAgICAgICA8L0J1dHRvbkdyb3VwPlxuICAgICAgICAgICAgPC8+fS8+XG4gICAgICA8L2Rpdj4pO1xuICAgIH1cbiAgICBpZiAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU1VDQ0VTUyAmJiBxdWVyeS5yZXN1bHRzKSB7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0cyB9ID0gcXVlcnk7XG4gICAgICAgIC8vIEFjY291bnRzIGZvciBvZmZzZXQgbmVlZGVkIGZvciBoZWlnaHQgb2YgUmVzdWx0U2V0Um93c1JldHVybmVkIGNvbXBvbmVudCBpZiAhbGltaXRSZWFjaGVkXG4gICAgICAgIGNvbnN0IHJvd01lc3NhZ2VIZWlnaHQgPSAhbGltaXRSZWFjaGVkID8gMzIgOiAwO1xuICAgICAgICAvLyBBY2NvdW50cyBmb3Igb2Zmc2V0IG5lZWRlZCBmb3IgaGVpZ2h0IG9mIEFsZXJ0IGlmIHRoaXMuc3RhdGUuYWxlcnRJc09wZW5cbiAgICAgICAgY29uc3QgYWxlcnRDb250YWluZXJIZWlnaHQgPSA3MDtcbiAgICAgICAgLy8gV2UgbmVlZCB0byBjYWxjdWxhdGUgdGhlIGhlaWdodCBvZiB0aGlzLnJlbmRlclJvd3NSZXR1cm5lZCgpXG4gICAgICAgIC8vIGlmIHdlIHdhbnQgcmVzdWx0cyBwYW5lbCB0byBiZSBwcm9wZXIgaGVpZ2h0IGJlY2F1c2UgdGhlXG4gICAgICAgIC8vIEZpbHRlclRhYmxlIGNvbXBvbmVudCBuZWVkcyBhbiBleHBsaWNpdCBoZWlnaHQgdG8gcmVuZGVyXG4gICAgICAgIC8vIHRoZSBUYWJsZSBjb21wb25lbnRcbiAgICAgICAgY29uc3Qgcm93c0hlaWdodCA9IGFsZXJ0SXNPcGVuXG4gICAgICAgICAgICA/IGhlaWdodCAtIGFsZXJ0Q29udGFpbmVySGVpZ2h0XG4gICAgICAgICAgICA6IGhlaWdodCAtIHJvd01lc3NhZ2VIZWlnaHQ7XG4gICAgICAgIGxldCBkYXRhO1xuICAgICAgICBpZiAoY2FjaGUgJiYgcXVlcnkuY2FjaGVkKSB7XG4gICAgICAgICAgICBkYXRhID0gY2FjaGVkRGF0YTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChyZXN1bHRzPy5kYXRhKSB7XG4gICAgICAgICAgICAoeyBkYXRhIH0gPSByZXN1bHRzKTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnN0IGV4cGFuZGVkQ29sdW1ucyA9IHJlc3VsdHMuZXhwYW5kZWRfY29sdW1uc1xuICAgICAgICAgICAgICAgID8gcmVzdWx0cy5leHBhbmRlZF9jb2x1bW5zLm1hcChjb2wgPT4gY29sLm5hbWUpXG4gICAgICAgICAgICAgICAgOiBbXTtcbiAgICAgICAgICAgIHJldHVybiAoPD5cbiAgICAgICAgICB7cmVuZGVyQ29udHJvbHMoKX1cbiAgICAgICAgICB7cmVuZGVyUm93c1JldHVybmVkKCl9XG4gICAgICAgICAge3NxbH1cbiAgICAgICAgICA8RmlsdGVyYWJsZVRhYmxlIGRhdGE9e2RhdGF9IG9yZGVyZWRDb2x1bW5LZXlzPXtyZXN1bHRzLmNvbHVtbnMubWFwKGNvbCA9PiBjb2wubmFtZSl9IGhlaWdodD17cm93c0hlaWdodH0gZmlsdGVyVGV4dD17c2VhcmNoVGV4dH0gZXhwYW5kZWRDb2x1bW5zPXtleHBhbmRlZENvbHVtbnN9Lz5cbiAgICAgICAgPC8+KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1RoZSBxdWVyeSByZXR1cm5lZCBubyBkYXRhJyl9Lz47XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHF1ZXJ5LmNhY2hlZCB8fCAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU1VDQ0VTUyAmJiAhcXVlcnkucmVzdWx0cykpIHtcbiAgICAgICAgaWYgKHF1ZXJ5LmlzRGF0YVByZXZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBkaXNwYXRjaChyZUZldGNoUXVlcnlSZXN1bHRzKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucXVlcnksXG4gICAgICAgICAgICAgICAgICAgIGlzRGF0YVByZXZpZXc6IHRydWUsXG4gICAgICAgICAgICAgICAgfSkpfT5cbiAgICAgICAgICB7dCgnRmV0Y2ggZGF0YSBwcmV2aWV3Jyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5LnJlc3VsdHNLZXkpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBmZXRjaFJlc3VsdHMocXVlcnkpfT5cbiAgICAgICAgICB7dCgnUmVmZXRjaCByZXN1bHRzJyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IHByb2dyZXNzQmFyO1xuICAgIGlmIChxdWVyeS5wcm9ncmVzcyA+IDApIHtcbiAgICAgICAgcHJvZ3Jlc3NCYXIgPSAoPFByb2dyZXNzQmFyIHBlcmNlbnQ9e3BhcnNlSW50KHF1ZXJ5LnByb2dyZXNzLnRvRml4ZWQoMCksIDEwKX0gc3RyaXBlZC8+KTtcbiAgICB9XG4gICAgY29uc3QgcHJvZ3Jlc3NNc2cgPSBxdWVyeT8uZXh0cmE/LnByb2dyZXNzID8/IG51bGw7XG4gICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgIDxkaXY+eyFwcm9ncmVzc0JhciAmJiA8TG9hZGluZyBwb3NpdGlvbj1cIm5vcm1hbFwiLz59PC9kaXY+XG4gICAgICB7Lyogc2hvdyBsb2FkaW5nIGJhciB3aGVuZXZlciBwcm9ncmVzcyBiYXIgaXMgY29tcGxldGVkIGJ1dCBuZWVkcyB0aW1lIHRvIHJlbmRlciAqL31cbiAgICAgIDxkaXY+e3F1ZXJ5LnByb2dyZXNzID09PSAxMDAgJiYgPExvYWRpbmcgcG9zaXRpb249XCJub3JtYWxcIi8+fTwvZGl2PlxuICAgICAgPFF1ZXJ5U3RhdGVMYWJlbCBxdWVyeT17cXVlcnl9Lz5cbiAgICAgIDxkaXY+e3Byb2dyZXNzTXNnICYmIDxBbGVydCB0eXBlPVwic3VjY2Vzc1wiIG1lc3NhZ2U9e3Byb2dyZXNzTXNnfS8+fTwvZGl2PlxuICAgICAgPGRpdj57cXVlcnkucHJvZ3Jlc3MgIT09IDEwMCAmJiBwcm9ncmVzc0Jhcn08L2Rpdj5cbiAgICAgIHt0cmFja2luZ1VybCAmJiA8ZGl2Pnt0cmFja2luZ1VybH08L2Rpdj59XG4gICAgPC9SZXN1bHRsZXNzU3R5bGVzPik7XG59O1xuZXhwb3J0IGRlZmF1bHQgUmVzdWx0U2V0O1xuIl19 */\"), onClick: () => popSelectStar(tempSchema, tempTable) },\n      t('Query in a new tab')),\n\n      ___EmotionJSX(ExploreCtasResultsButton, { table: tempTable, schema: tempSchema, dbId: exploreDBId }))) }));\n\n\n\n  }\n  if (query.state === QueryState.SUCCESS && query.results) {\n    const { results } = query;\n    // Accounts for offset needed for height of ResultSetRowsReturned component if !limitReached\n    const rowMessageHeight = !limitReached ? 32 : 0;\n    // Accounts for offset needed for height of Alert if this.state.alertIsOpen\n    const alertContainerHeight = 70;\n    // We need to calculate the height of this.renderRowsReturned()\n    // if we want results panel to be proper height because the\n    // FilterTable component needs an explicit height to render\n    // the Table component\n    const rowsHeight = alertIsOpen ?\n    height - alertContainerHeight :\n    height - rowMessageHeight;\n    let data;\n    if (cache && query.cached) {\n      data = cachedData;\n    } else\n    if (results != null && results.data) {\n      ({ data } = results);\n    }\n    if (data && data.length > 0) {\n      const expandedColumns = results.expanded_columns ?\n      results.expanded_columns.map((col) => col.name) :\n      [];\n      return ___EmotionJSX(React.Fragment, null,\n      renderControls(),\n      renderRowsReturned(),\n      sql,\n      ___EmotionJSX(FilterableTable, { data: data, orderedColumnKeys: results.columns.map((col) => col.name), height: rowsHeight, filterText: searchText, expandedColumns: expandedColumns }));\n\n    }\n    if (data && data.length === 0) {\n      return ___EmotionJSX(Alert, { type: \"warning\", message: t('The query returned no data') });\n    }\n  }\n  if (query.cached || query.state === QueryState.SUCCESS && !query.results) {\n    if (query.isDataPreview) {\n      return ___EmotionJSX(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => dispatch(reFetchQueryResults({\n          ...query,\n          isDataPreview: true })) },\n\n      t('Fetch data preview'));\n\n    }\n    if (query.resultsKey) {\n      return ___EmotionJSX(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => fetchResults(query) },\n      t('Refetch results'));\n\n    }\n  }\n  let progressBar;\n  if (query.progress > 0) {\n    progressBar = ___EmotionJSX(ProgressBar, { percent: parseInt(query.progress.toFixed(0), 10), striped: true });\n  }\n  const progressMsg = (_query$extra$progress = query == null ? void 0 : (_query$extra = query.extra) == null ? void 0 : _query$extra.progress) != null ? _query$extra$progress : null;\n  return ___EmotionJSX(ResultlessStyles, null,\n  ___EmotionJSX(\"div\", null, !progressBar && ___EmotionJSX(Loading, { position: \"normal\" })),\n\n  ___EmotionJSX(\"div\", null, query.progress === 100 && ___EmotionJSX(Loading, { position: \"normal\" })),\n  ___EmotionJSX(QueryStateLabel, { query: query }),\n  ___EmotionJSX(\"div\", null, progressMsg && ___EmotionJSX(Alert, { type: \"success\", message: progressMsg })),\n  ___EmotionJSX(\"div\", null, query.progress !== 100 && progressBar),\n  trackingUrl && ___EmotionJSX(\"div\", null, trackingUrl));\n\n};__signature__(ResultSet, \"useTheme{theme}\\nuseState{[searchText, setSearchText]('')}\\nuseState{[cachedData, setCachedData]([])}\\nuseState{[showSaveDatasetModal, setShowSaveDatasetModal](false)}\\nuseState{[alertIsOpen, setAlertIsOpen](false)}\\nuseDispatch{dispatch}\\nuseCallback{reRunQueryIfSessionTimeoutErrorOnMount}\\nuseEffect{}\\nusePrevious{prevQuery}\\nuseEffect{}\", () => [useTheme, useDispatch, usePrevious]);const _default =\nResultSet;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(LIMITING_FACTOR, \"LIMITING_FACTOR\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultlessStyles, \"ResultlessStyles\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(MonospaceDiv, \"MonospaceDiv\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ReturnedRows, \"ReturnedRows\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSetControls, \"ResultSetControls\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSetButtons, \"ResultSetButtons\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(LimitMessage, \"LimitMessage\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(ResultSet, \"ResultSet\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"mappings":"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","names":["React","useCallback","useEffect","useState","useDispatch","ButtonGroup","Alert","Button","shortid","QueryState","styled","t","useTheme","usePrevious","ErrorMessageWithStackTrace","SaveDatasetModal","EXPLORE_CHART_DEFAULT","mountExploreUrl","postFormData","ProgressBar","Loading","FilterableTable","CopyToClipboard","addDangerToast","prepareCopyToClipboardTabularData","addQueryEditor","clearQueryResults","CtasEnum","fetchQueryResults","reFetchQueryResults","reRunQuery","URL_PARAMS","ExploreCtasResultsButton","ExploreResultsButton","HighlightedSql","QueryStateLabel","LIMITING_FACTOR","ResultlessStyles","div","theme","gridUnit","MonospaceDiv","typography","families","monospace","ReturnedRows","sizes","s","ResultSetControls","ResultSetButtons","LimitMessage","span","colors","secondary","light1","ResultSet","cache","csv","database","displayLimit","height","query","search","showSql","visualize","user","defaultQueryLimit","searchText","setSearchText","cachedData","setCachedData","showSaveDatasetModal","setShowSaveDatasetModal","alertIsOpen","setAlertIsOpen","dispatch","reRunQueryIfSessionTimeoutErrorOnMount","errorMessage","indexOf","fetchResults","prevQuery","cached","results","data","length","resultsKey","calculateAlertRefHeight","alertElement","popSelectStar","tempSchema","tempTable","qe","id","generate","name","autorun","dbId","sql","changeSearch","event","target","value","createExploreResultsOnClick","query_id","key","datasource","all_columns","columns","map","column","url","formDataKey","window","open","getExportCsvUrl","clientId","renderControls","tab","templateParams","schema","allows_virtual_table_explore","renderRowsReturned","rows","queryLimit","limitingFactor","limitMessage","limitReached","displayLimitReached","limit","isAdmin","roles","Admin","rowsCount","Math","min","displayMaxRowsReachedMessage","withAdmin","withoutAdmin","shouldUseDefaultDropdownAlert","DROPDOWN","QUERY","QUERY_AND_DROPDOWN","rowsReturnedMessage","tooltipText","exploreDBId","explore_database_id","trackingUrl","state","SUCCESS","FETCHING","RUNNING","STOPPED","FAILED","errors","undefined","link","ctas","object","ctas_method","VIEW","marginRight","rowMessageHeight","alertContainerHeight","rowsHeight","expandedColumns","expanded_columns","col","isDataPreview","progressBar","progress","parseInt","toFixed","progressMsg","extra"],"sourceRoot":"","sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/SqlLab/components/ResultSet/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport ButtonGroup from 'src/components/ButtonGroup';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport shortid from 'shortid';\nimport {\n  QueryResponse,\n  QueryState,\n  styled,\n  t,\n  useTheme,\n  usePrevious,\n} from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport {\n  ISaveableDatasource,\n  ISimpleColumn,\n  SaveDatasetModal,\n} from 'src/SqlLab/components/SaveDatasetModal';\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport { EXPLORE_CHART_DEFAULT } from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport ProgressBar from 'src/components/ProgressBar';\nimport Loading from 'src/components/Loading';\nimport FilterableTable from 'src/components/FilterableTable';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport {\n  addQueryEditor,\n  clearQueryResults,\n  CtasEnum,\n  fetchQueryResults,\n  reFetchQueryResults,\n  reRunQuery,\n} from 'src/SqlLab/actions/sqlLab';\nimport { URL_PARAMS } from 'src/constants';\nimport ExploreCtasResultsButton from '../ExploreCtasResultsButton';\nimport ExploreResultsButton from '../ExploreResultsButton';\nimport HighlightedSql from '../HighlightedSql';\nimport QueryStateLabel from '../QueryStateLabel';\n\nenum LIMITING_FACTOR {\n  QUERY = 'QUERY',\n  QUERY_AND_DROPDOWN = 'QUERY_AND_DROPDOWN',\n  DROPDOWN = 'DROPDOWN',\n  NOT_LIMITED = 'NOT_LIMITED',\n}\n\nexport interface ResultSetProps {\n  cache?: boolean;\n  csv?: boolean;\n  database?: Record<string, any>;\n  displayLimit: number;\n  height: number;\n  query: QueryResponse;\n  search?: boolean;\n  showSql?: boolean;\n  visualize?: boolean;\n  user: UserWithPermissionsAndRoles;\n  defaultQueryLimit: number;\n}\n\nconst ResultlessStyles = styled.div`\n  position: relative;\n  min-height: ${({ theme }) => theme.gridUnit * 25}px;\n  [role='alert'] {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n  .sql-result-track-job {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n`;\n\n// Making text render line breaks/tabs as is as monospace,\n// but wrapping text too so text doesn't overflow\nconst MonospaceDiv = styled.div`\n  font-family: ${({ theme }) => theme.typography.families.monospace};\n  white-space: pre;\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\n\nconst ReturnedRows = styled.div`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  line-height: ${({ theme }) => theme.gridUnit * 6}px;\n`;\n\nconst ResultSetControls = styled.div`\n  display: flex;\n  justify-content: space-between;\n  padding: ${({ theme }) => 2 * theme.gridUnit}px 0;\n`;\n\nconst ResultSetButtons = styled.div`\n  display: grid;\n  grid-auto-flow: column;\n  padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n`;\n\nconst LimitMessage = styled.span`\n  color: ${({ theme }) => theme.colors.secondary.light1};\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst ResultSet = ({\n  cache = false,\n  csv = true,\n  database = {},\n  displayLimit,\n  height,\n  query,\n  search = true,\n  showSql = false,\n  visualize = true,\n  user,\n  defaultQueryLimit,\n}: ResultSetProps) => {\n  const theme = useTheme();\n  const [searchText, setSearchText] = useState('');\n  const [cachedData, setCachedData] = useState<Record<string, unknown>[]>([]);\n  const [showSaveDatasetModal, setShowSaveDatasetModal] = useState(false);\n  const [alertIsOpen, setAlertIsOpen] = useState(false);\n\n  const dispatch = useDispatch();\n\n  const reRunQueryIfSessionTimeoutErrorOnMount = useCallback(() => {\n    if (\n      query.errorMessage &&\n      query.errorMessage.indexOf('session timed out') > 0\n    ) {\n      dispatch(reRunQuery(query));\n    }\n  }, []);\n\n  useEffect(() => {\n    // only do this the first time the component is rendered/mounted\n    reRunQueryIfSessionTimeoutErrorOnMount();\n  }, [reRunQueryIfSessionTimeoutErrorOnMount]);\n\n  const fetchResults = (query: QueryResponse) => {\n    dispatch(fetchQueryResults(query, displayLimit));\n  };\n\n  const prevQuery = usePrevious(query);\n  useEffect(() => {\n    if (cache && query.cached && query?.results?.data?.length > 0) {\n      setCachedData(query.results.data);\n      dispatch(clearQueryResults(query));\n    }\n    if (query.resultsKey && query.resultsKey !== prevQuery?.resultsKey) {\n      fetchResults(query);\n    }\n  }, [query, cache]);\n\n  const calculateAlertRefHeight = (alertElement: HTMLElement | null) => {\n    if (alertElement) {\n      setAlertIsOpen(true);\n    } else {\n      setAlertIsOpen(false);\n    }\n  };\n\n  const popSelectStar = (tempSchema: string | null, tempTable: string) => {\n    const qe = {\n      id: shortid.generate(),\n      name: tempTable,\n      autorun: false,\n      dbId: query.dbId,\n      sql: `SELECT * FROM ${tempSchema ? `${tempSchema}.` : ''}${tempTable}`,\n    };\n    dispatch(addQueryEditor(qe));\n  };\n\n  const changeSearch = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchText(event.target.value);\n  };\n\n  const createExploreResultsOnClick = async () => {\n    const { results } = query;\n\n    if (results?.query_id) {\n      const key = await postFormData(results.query_id, 'query', {\n        ...EXPLORE_CHART_DEFAULT,\n        datasource: `${results.query_id}__query`,\n        ...{\n          all_columns: results.columns.map(column => column.name),\n        },\n      });\n      const url = mountExploreUrl(null, {\n        [URL_PARAMS.formDataKey.name]: key,\n      });\n      window.open(url, '_blank', 'noreferrer');\n    } else {\n      addDangerToast(t('Unable to create chart without a query id.'));\n    }\n  };\n\n  const getExportCsvUrl = (clientId: string) =>\n    `/api/v1/sqllab/export/${clientId}/`;\n\n  const renderControls = () => {\n    if (search || visualize || csv) {\n      let { data } = query.results;\n      if (cache && query.cached) {\n        data = cachedData;\n      }\n      const { columns } = query.results;\n      // Added compute logic to stop user from being able to Save & Explore\n\n      const datasource: ISaveableDatasource = {\n        columns: query.results.columns as ISimpleColumn[],\n        name: query?.tab || 'Untitled',\n        dbId: query?.dbId,\n        sql: query?.sql,\n        templateParams: query?.templateParams,\n        schema: query?.schema,\n      };\n\n      return (\n        <ResultSetControls>\n          <SaveDatasetModal\n            visible={showSaveDatasetModal}\n            onHide={() => setShowSaveDatasetModal(false)}\n            buttonTextOnSave={t('Save & Explore')}\n            buttonTextOnOverwrite={t('Overwrite & Explore')}\n            modalDescription={t(\n              'Save this query as a virtual dataset to continue exploring',\n            )}\n            datasource={datasource}\n          />\n          <ResultSetButtons>\n            {visualize && database?.allows_virtual_table_explore && (\n              <ExploreResultsButton\n                database={database}\n                onClick={createExploreResultsOnClick}\n              />\n            )}\n            {csv && (\n              <Button buttonSize=\"small\" href={getExportCsvUrl(query.id)}>\n                <i className=\"fa fa-file-text-o\" /> {t('Download to CSV')}\n              </Button>\n            )}\n\n            <CopyToClipboard\n              text={prepareCopyToClipboardTabularData(data, columns)}\n              wrapped={false}\n              copyNode={\n                <Button buttonSize=\"small\">\n                  <i className=\"fa fa-clipboard\" /> {t('Copy to Clipboard')}\n                </Button>\n              }\n              hideTooltip\n            />\n          </ResultSetButtons>\n          {search && (\n            <input\n              type=\"text\"\n              onChange={changeSearch}\n              value={searchText}\n              className=\"form-control input-sm\"\n              placeholder={t('Filter results')}\n            />\n          )}\n        </ResultSetControls>\n      );\n    }\n    return <div />;\n  };\n\n  const renderRowsReturned = () => {\n    const { results, rows, queryLimit, limitingFactor } = query;\n    let limitMessage;\n    const limitReached = results?.displayLimitReached;\n    const limit = queryLimit || results.query.limit;\n    const isAdmin = !!user?.roles?.Admin;\n    const rowsCount = Math.min(rows || 0, results?.data?.length || 0);\n\n    const displayMaxRowsReachedMessage = {\n      withAdmin: t(\n        'The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROWS. ' +\n          'Please add additional limits/filters or download to csv to see more rows up to ' +\n          'the %(limit)d limit.',\n        { rows: rowsCount, limit },\n      ),\n      withoutAdmin: t(\n        'The number of results displayed is limited to %(rows)d. ' +\n          'Please add additional limits/filters, download to csv, or contact an admin ' +\n          'to see more rows up to the %(limit)d limit.',\n        { rows: rowsCount, limit },\n      ),\n    };\n    const shouldUseDefaultDropdownAlert =\n      limit === defaultQueryLimit &&\n      limitingFactor === LIMITING_FACTOR.DROPDOWN;\n\n    if (limitingFactor === LIMITING_FACTOR.QUERY && csv) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the query',\n        { rows },\n      );\n    } else if (\n      limitingFactor === LIMITING_FACTOR.DROPDOWN &&\n      !shouldUseDefaultDropdownAlert\n    ) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the limit dropdown.',\n        { rows },\n      );\n    } else if (limitingFactor === LIMITING_FACTOR.QUERY_AND_DROPDOWN) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the query and limit dropdown.',\n        { rows },\n      );\n    }\n\n    const rowsReturnedMessage = t('%(rows)d rows returned', {\n      rows,\n    });\n\n    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n\n    return (\n      <ReturnedRows>\n        {!limitReached && !shouldUseDefaultDropdownAlert && (\n          <span title={tooltipText}>\n            {rowsReturnedMessage}\n            <LimitMessage>{limitMessage}</LimitMessage>\n          </span>\n        )}\n        {!limitReached && shouldUseDefaultDropdownAlert && (\n          <div ref={calculateAlertRefHeight}>\n            <Alert\n              type=\"warning\"\n              message={t('%(rows)d rows returned', { rows })}\n              onClose={() => setAlertIsOpen(false)}\n              description={t(\n                'The number of rows displayed is limited to %(rows)d by the dropdown.',\n                { rows },\n              )}\n            />\n          </div>\n        )}\n        {limitReached && (\n          <div ref={calculateAlertRefHeight}>\n            <Alert\n              type=\"warning\"\n              onClose={() => setAlertIsOpen(false)}\n              message={t('%(rows)d rows returned', { rows: rowsCount })}\n              description={\n                isAdmin\n                  ? displayMaxRowsReachedMessage.withAdmin\n                  : displayMaxRowsReachedMessage.withoutAdmin\n              }\n            />\n          </div>\n        )}\n      </ReturnedRows>\n    );\n  };\n\n  const limitReached = query?.results?.displayLimitReached;\n  let sql;\n  let exploreDBId = query.dbId;\n  if (database?.explore_database_id) {\n    exploreDBId = database.explore_database_id;\n  }\n\n  let trackingUrl;\n  if (\n    query.trackingUrl &&\n    query.state !== QueryState.SUCCESS &&\n    query.state !== QueryState.FETCHING\n  ) {\n    trackingUrl = (\n      <Button\n        className=\"sql-result-track-job\"\n        buttonSize=\"small\"\n        href={query.trackingUrl}\n        target=\"_blank\"\n      >\n        {query.state === QueryState.RUNNING\n          ? t('Track job')\n          : t('See query details')}\n      </Button>\n    );\n  }\n\n  if (showSql) {\n    sql = <HighlightedSql sql={query.sql} />;\n  }\n\n  if (query.state === QueryState.STOPPED) {\n    return <Alert type=\"warning\" message={t('Query was stopped')} />;\n  }\n\n  if (query.state === QueryState.FAILED) {\n    return (\n      <ResultlessStyles>\n        <ErrorMessageWithStackTrace\n          title={t('Database error')}\n          error={query?.errors?.[0]}\n          subtitle={<MonospaceDiv>{query.errorMessage}</MonospaceDiv>}\n          copyText={query.errorMessage || undefined}\n          link={query.link}\n          source=\"sqllab\"\n        />\n        {trackingUrl}\n      </ResultlessStyles>\n    );\n  }\n\n  if (query.state === QueryState.SUCCESS && query.ctas) {\n    const { tempSchema, tempTable } = query;\n    let object = 'Table';\n    if (query.ctas_method === CtasEnum.VIEW) {\n      object = 'View';\n    }\n    return (\n      <div>\n        <Alert\n          type=\"info\"\n          message={\n            <>\n              {t(object)} [\n              <strong>\n                {tempSchema ? `${tempSchema}.` : ''}\n                {tempTable}\n              </strong>\n              ] {t('was created')} &nbsp;\n              <ButtonGroup>\n                <Button\n                  buttonSize=\"small\"\n                  css={{ marginRight: theme.gridUnit }}\n                  onClick={() => popSelectStar(tempSchema, tempTable)}\n                >\n                  {t('Query in a new tab')}\n                </Button>\n                <ExploreCtasResultsButton\n                  table={tempTable}\n                  schema={tempSchema}\n                  dbId={exploreDBId}\n                />\n              </ButtonGroup>\n            </>\n          }\n        />\n      </div>\n    );\n  }\n\n  if (query.state === QueryState.SUCCESS && query.results) {\n    const { results } = query;\n    // Accounts for offset needed for height of ResultSetRowsReturned component if !limitReached\n    const rowMessageHeight = !limitReached ? 32 : 0;\n    // Accounts for offset needed for height of Alert if this.state.alertIsOpen\n    const alertContainerHeight = 70;\n    // We need to calculate the height of this.renderRowsReturned()\n    // if we want results panel to be proper height because the\n    // FilterTable component needs an explicit height to render\n    // the Table component\n    const rowsHeight = alertIsOpen\n      ? height - alertContainerHeight\n      : height - rowMessageHeight;\n    let data;\n    if (cache && query.cached) {\n      data = cachedData;\n    } else if (results?.data) {\n      ({ data } = results);\n    }\n    if (data && data.length > 0) {\n      const expandedColumns = results.expanded_columns\n        ? results.expanded_columns.map(col => col.name)\n        : [];\n      return (\n        <>\n          {renderControls()}\n          {renderRowsReturned()}\n          {sql}\n          <FilterableTable\n            data={data}\n            orderedColumnKeys={results.columns.map(col => col.name)}\n            height={rowsHeight}\n            filterText={searchText}\n            expandedColumns={expandedColumns}\n          />\n        </>\n      );\n    }\n    if (data && data.length === 0) {\n      return <Alert type=\"warning\" message={t('The query returned no data')} />;\n    }\n  }\n\n  if (query.cached || (query.state === QueryState.SUCCESS && !query.results)) {\n    if (query.isDataPreview) {\n      return (\n        <Button\n          buttonSize=\"small\"\n          buttonStyle=\"primary\"\n          onClick={() =>\n            dispatch(\n              reFetchQueryResults({\n                ...query,\n                isDataPreview: true,\n              }),\n            )\n          }\n        >\n          {t('Fetch data preview')}\n        </Button>\n      );\n    }\n    if (query.resultsKey) {\n      return (\n        <Button\n          buttonSize=\"small\"\n          buttonStyle=\"primary\"\n          onClick={() => fetchResults(query)}\n        >\n          {t('Refetch results')}\n        </Button>\n      );\n    }\n  }\n\n  let progressBar;\n  if (query.progress > 0) {\n    progressBar = (\n      <ProgressBar percent={parseInt(query.progress.toFixed(0), 10)} striped />\n    );\n  }\n\n  const progressMsg = query?.extra?.progress ?? null;\n\n  return (\n    <ResultlessStyles>\n      <div>{!progressBar && <Loading position=\"normal\" />}</div>\n      {/* show loading bar whenever progress bar is completed but needs time to render */}\n      <div>{query.progress === 100 && <Loading position=\"normal\" />}</div>\n      <QueryStateLabel query={query} />\n      <div>{progressMsg && <Alert type=\"success\" message={progressMsg} />}</div>\n      <div>{query.progress !== 100 && progressBar}</div>\n      {trackingUrl && <div>{trackingUrl}</div>}\n    </ResultlessStyles>\n  );\n};\n\nexport default ResultSet;\n"]},"metadata":{},"sourceType":"module"}