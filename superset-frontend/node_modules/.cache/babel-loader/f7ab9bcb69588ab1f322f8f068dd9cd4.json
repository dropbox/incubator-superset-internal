{"ast":null,"code":"import { css as _css } from \"@emotion/react\"; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport ButtonGroup from 'src/components/ButtonGroup';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport shortid from 'shortid';\nimport { QueryState, styled, t, useTheme, usePrevious } from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport { SaveDatasetModal } from 'src/SqlLab/components/SaveDatasetModal';\nimport { EXPLORE_CHART_DEFAULT } from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport ProgressBar from 'src/components/ProgressBar';\nimport Loading from 'src/components/Loading';\nimport FilterableTable from 'src/components/FilterableTable';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport { addQueryEditor, clearQueryResults, CtasEnum, fetchQueryResults, reFetchQueryResults, reRunQuery } from 'src/SqlLab/actions/sqlLab';\nimport { URL_PARAMS } from 'src/constants';\nimport ExploreCtasResultsButton from '../ExploreCtasResultsButton';\nimport ExploreResultsButton from '../ExploreResultsButton';\nimport HighlightedSql from '../HighlightedSql';\nimport QueryStateLabel from '../QueryStateLabel';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nvar LIMITING_FACTOR;\n(function (LIMITING_FACTOR) {\n  LIMITING_FACTOR[\"QUERY\"] = \"QUERY\";\n  LIMITING_FACTOR[\"QUERY_AND_DROPDOWN\"] = \"QUERY_AND_DROPDOWN\";\n  LIMITING_FACTOR[\"DROPDOWN\"] = \"DROPDOWN\";\n  LIMITING_FACTOR[\"NOT_LIMITED\"] = \"NOT_LIMITED\";\n})(LIMITING_FACTOR || (LIMITING_FACTOR = {}));\nconst ResultContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  row-gap: ${(_ref) => {let { theme } = _ref;return theme.gridUnit * 2;}}px;\n`;\nconst ResultlessStyles = styled.div`\n  position: relative;\n  min-height: ${(_ref2) => {let { theme } = _ref2;return theme.gridUnit * 25;}}px;\n  [role='alert'] {\n    margin-top: ${(_ref3) => {let { theme } = _ref3;return theme.gridUnit * 2;}}px;\n  }\n  .sql-result-track-job {\n    margin-top: ${(_ref4) => {let { theme } = _ref4;return theme.gridUnit * 2;}}px;\n  }\n`;\n// Making text render line breaks/tabs as is as monospace,\n// but wrapping text too so text doesn't overflow\nconst MonospaceDiv = styled.div`\n  font-family: ${(_ref5) => {let { theme } = _ref5;return theme.typography.families.monospace;}};\n  white-space: pre;\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\nconst ReturnedRows = styled.div`\n  font-size: ${(_ref6) => {let { theme } = _ref6;return theme.typography.sizes.s;}}px;\n  line-height: ${(_ref7) => {let { theme } = _ref7;return theme.gridUnit * 6;}}px;\n`;\nconst ResultSetControls = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\nconst ResultSetButtons = styled.div`\n  display: grid;\n  grid-auto-flow: column;\n  padding-right: ${(_ref8) => {let { theme } = _ref8;return 2 * theme.gridUnit;}}px;\n`;\nconst LimitMessage = styled.span`\n  color: ${(_ref9) => {let { theme } = _ref9;return theme.colors.secondary.light1;}};\n  margin-left: ${(_ref10) => {let { theme } = _ref10;return theme.gridUnit * 2;}}px;\n`;\nconst ResultSet = (_ref11) => {var _query$results2, _query$extra$progress, _query$extra;let { cache = false, csv = true, database = {}, displayLimit, height, query, search = true, showSql = false, visualize = true, user, defaultQueryLimit } = _ref11;\n  const theme = useTheme();\n  const [searchText, setSearchText] = useState('');\n  const [cachedData, setCachedData] = useState([]);\n  const [showSaveDatasetModal, setShowSaveDatasetModal] = useState(false);\n  const [alertIsOpen, setAlertIsOpen] = useState(false);\n  const dispatch = useDispatch();\n  const reRunQueryIfSessionTimeoutErrorOnMount = useCallback(() => {\n    if (query.errorMessage &&\n    query.errorMessage.indexOf('session timed out') > 0) {\n      dispatch(reRunQuery(query));\n    }\n  }, []);\n  useEffect(() => {\n    // only do this the first time the component is rendered/mounted\n    reRunQueryIfSessionTimeoutErrorOnMount();\n  }, [reRunQueryIfSessionTimeoutErrorOnMount]);\n  const fetchResults = (query) => {\n    dispatch(fetchQueryResults(query, displayLimit));\n  };\n  const prevQuery = usePrevious(query);\n  useEffect(() => {var _query$results, _query$results$data;\n    if (cache && query.cached && (query == null ? void 0 : (_query$results = query.results) == null ? void 0 : (_query$results$data = _query$results.data) == null ? void 0 : _query$results$data.length) > 0) {\n      setCachedData(query.results.data);\n      dispatch(clearQueryResults(query));\n    }\n    if (query.resultsKey && query.resultsKey !== (prevQuery == null ? void 0 : prevQuery.resultsKey)) {\n      fetchResults(query);\n    }\n  }, [query, cache]);\n  const calculateAlertRefHeight = (alertElement) => {\n    if (alertElement) {\n      setAlertIsOpen(true);\n    } else\n    {\n      setAlertIsOpen(false);\n    }\n  };\n  const popSelectStar = (tempSchema, tempTable) => {\n    const qe = {\n      id: shortid.generate(),\n      name: tempTable,\n      autorun: false,\n      dbId: query.dbId,\n      sql: `SELECT * FROM ${tempSchema ? `${tempSchema}.` : ''}${tempTable}` };\n\n    dispatch(addQueryEditor(qe));\n  };\n  const changeSearch = (event) => {\n    setSearchText(event.target.value);\n  };\n  const createExploreResultsOnClick = async () => {\n    const { results } = query;\n    if (results != null && results.query_id) {\n      const key = await postFormData(results.query_id, 'query', {\n        ...EXPLORE_CHART_DEFAULT,\n        datasource: `${results.query_id}__query`,\n        ...{\n          all_columns: results.columns.map((column) => column.column_name) } });\n\n\n      const url = mountExploreUrl(null, {\n        [URL_PARAMS.formDataKey.name]: key });\n\n      window.open(url, '_blank', 'noreferrer');\n    } else\n    {\n      addDangerToast(t('Unable to create chart without a query id.'));\n    }\n  };\n  const getExportCsvUrl = (clientId) => `/api/v1/sqllab/export/${clientId}/`;\n  const renderControls = () => {\n    if (search || visualize || csv) {\n      let { data } = query.results;\n      if (cache && query.cached) {\n        data = cachedData;\n      }\n      const { columns } = query.results;\n      // Added compute logic to stop user from being able to Save & Explore\n      const datasource = {\n        columns: query.results.columns,\n        name: (query == null ? void 0 : query.tab) || 'Untitled',\n        dbId: query == null ? void 0 : query.dbId,\n        sql: query == null ? void 0 : query.sql,\n        templateParams: query == null ? void 0 : query.templateParams,\n        schema: query == null ? void 0 : query.schema };\n\n      return ___EmotionJSX(ResultSetControls, null,\n      ___EmotionJSX(SaveDatasetModal, { visible: showSaveDatasetModal, onHide: () => setShowSaveDatasetModal(false), buttonTextOnSave: t('Save & Explore'), buttonTextOnOverwrite: t('Overwrite & Explore'), modalDescription: t('Save this query as a virtual dataset to continue exploring'), datasource: datasource }),\n      ___EmotionJSX(ResultSetButtons, null,\n      visualize && (database == null ? void 0 : database.allows_virtual_table_explore) && ___EmotionJSX(ExploreResultsButton, { database: database, onClick: createExploreResultsOnClick }),\n      csv && ___EmotionJSX(Button, { buttonSize: \"small\", href: getExportCsvUrl(query.id) },\n      ___EmotionJSX(\"i\", { className: \"fa fa-file-text-o\" }), \" \", t('Download to CSV')),\n\n\n      ___EmotionJSX(CopyToClipboard, { text: prepareCopyToClipboardTabularData(data, columns), wrapped: false, copyNode: ___EmotionJSX(Button, { buttonSize: \"small\" },\n        ___EmotionJSX(\"i\", { className: \"fa fa-clipboard\" }), \" \", t('Copy to Clipboard')),\n        hideTooltip: true })),\n\n      search && ___EmotionJSX(\"input\", { type: \"text\", onChange: changeSearch, value: searchText, className: \"form-control input-sm\", placeholder: t('Filter results') }));\n\n    }\n    return ___EmotionJSX(\"div\", null);\n  };\n  const renderRowsReturned = () => {var _user$roles, _results$data;\n    const { results, rows, queryLimit, limitingFactor } = query;\n    let limitMessage;\n    const limitReached = results == null ? void 0 : results.displayLimitReached;\n    const limit = queryLimit || results.query.limit;\n    const isAdmin = !!(user != null && (_user$roles = user.roles) != null && _user$roles.Admin);\n    const rowsCount = Math.min(rows || 0, (results == null ? void 0 : (_results$data = results.data) == null ? void 0 : _results$data.length) || 0);\n    const displayMaxRowsReachedMessage = {\n      withAdmin: t('The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROW. ' +\n      'Please add additional limits/filters or download to csv to see more rows up to ' +\n      'the %(limit)d limit.', { rows: rowsCount, limit }),\n      withoutAdmin: t('The number of results displayed is limited to %(rows)d. ' +\n      'Please add additional limits/filters, download to csv, or contact an admin ' +\n      'to see more rows up to the %(limit)d limit.', { rows: rowsCount, limit }) };\n\n    const shouldUseDefaultDropdownAlert = limit === defaultQueryLimit &&\n    limitingFactor === LIMITING_FACTOR.DROPDOWN;\n    if (limitingFactor === LIMITING_FACTOR.QUERY && csv) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the query', { rows });\n    } else\n    if (limitingFactor === LIMITING_FACTOR.DROPDOWN &&\n    !shouldUseDefaultDropdownAlert) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the limit dropdown.', { rows });\n    } else\n    if (limitingFactor === LIMITING_FACTOR.QUERY_AND_DROPDOWN) {\n      limitMessage = t('The number of rows displayed is limited to %(rows)d by the query and limit dropdown.', { rows });\n    }\n    const rowsReturnedMessage = t('%(rows)d rows returned', {\n      rows });\n\n    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n    return ___EmotionJSX(ReturnedRows, null,\n    !limitReached && !shouldUseDefaultDropdownAlert && ___EmotionJSX(\"span\", { title: tooltipText },\n    rowsReturnedMessage,\n    ___EmotionJSX(LimitMessage, null, limitMessage)),\n\n    !limitReached && shouldUseDefaultDropdownAlert && ___EmotionJSX(\"div\", { ref: calculateAlertRefHeight },\n    ___EmotionJSX(Alert, { type: \"warning\", message: t('%(rows)d rows returned', { rows }), onClose: () => setAlertIsOpen(false), description: t('The number of rows displayed is limited to %(rows)d by the dropdown.', { rows }) })),\n\n    limitReached && ___EmotionJSX(\"div\", { ref: calculateAlertRefHeight },\n    ___EmotionJSX(Alert, { type: \"warning\", onClose: () => setAlertIsOpen(false), message: t('%(rows)d rows returned', { rows: rowsCount }), description: isAdmin ?\n      displayMaxRowsReachedMessage.withAdmin :\n      displayMaxRowsReachedMessage.withoutAdmin })));\n\n\n  };\n  const limitReached = query == null ? void 0 : (_query$results2 = query.results) == null ? void 0 : _query$results2.displayLimitReached;\n  let sql;\n  let exploreDBId = query.dbId;\n  if (database != null && database.explore_database_id) {\n    exploreDBId = database.explore_database_id;\n  }\n  let trackingUrl;\n  if (query.trackingUrl &&\n  query.state !== QueryState.SUCCESS &&\n  query.state !== QueryState.FETCHING) {\n    trackingUrl = ___EmotionJSX(Button, { className: \"sql-result-track-job\", buttonSize: \"small\", href: query.trackingUrl, target: \"_blank\" },\n    query.state === QueryState.RUNNING ?\n    t('Track job') :\n    t('See query details'));\n\n  }\n  if (showSql) {\n    sql = ___EmotionJSX(HighlightedSql, { sql: query.sql });\n  }\n  if (query.state === QueryState.STOPPED) {\n    return ___EmotionJSX(Alert, { type: \"warning\", message: t('Query was stopped') });\n  }\n  if (query.state === QueryState.FAILED) {var _query$errors;\n    return ___EmotionJSX(ResultlessStyles, null,\n    ___EmotionJSX(ErrorMessageWithStackTrace, { title: t('Database error'), error: query == null ? void 0 : (_query$errors = query.errors) == null ? void 0 : _query$errors[0], subtitle: ___EmotionJSX(MonospaceDiv, null, query.errorMessage), copyText: query.errorMessage || undefined, link: query.link, source: \"sqllab\" }),\n    trackingUrl);\n\n  }\n  if (query.state === QueryState.SUCCESS && query.ctas) {\n    const { tempSchema, tempTable } = query;\n    let object = 'Table';\n    if (query.ctas_method === CtasEnum.VIEW) {\n      object = 'View';\n    }\n    return ___EmotionJSX(\"div\", null,\n    ___EmotionJSX(Alert, { type: \"info\", message: ___EmotionJSX(React.Fragment, null,\n      t(object), \" [\",\n      ___EmotionJSX(\"strong\", null,\n      tempSchema ? `${tempSchema}.` : '',\n      tempTable), \"] \",\n\n      t('was created'), \" \\xA0\",\n      ___EmotionJSX(ButtonGroup, null,\n      ___EmotionJSX(Button, { buttonSize: \"small\", css: /*#__PURE__*/_css({ marginRight: theme.gridUnit }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ResultSet;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy96aGFvcnVpL3NyYy9pbmN1YmF0b3Itc3VwZXJzZXQtaW50ZXJuYWwvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL1NxbExhYi9jb21wb25lbnRzL1Jlc3VsdFNldC9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBMlIyQyIsImZpbGUiOiIvVXNlcnMvemhhb3J1aS9zcmMvaW5jdWJhdG9yLXN1cGVyc2V0LWludGVybmFsL3N1cGVyc2V0LWZyb250ZW5kL3NyYy9TcWxMYWIvY29tcG9uZW50cy9SZXN1bHRTZXQvaW5kZXgudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgdXNlRGlzcGF0Y2ggfSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQgQnV0dG9uR3JvdXAgZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uR3JvdXAnO1xuaW1wb3J0IEFsZXJ0IGZyb20gJ3NyYy9jb21wb25lbnRzL0FsZXJ0JztcbmltcG9ydCBCdXR0b24gZnJvbSAnc3JjL2NvbXBvbmVudHMvQnV0dG9uJztcbmltcG9ydCBzaG9ydGlkIGZyb20gJ3Nob3J0aWQnO1xuaW1wb3J0IHsgUXVlcnlTdGF0ZSwgc3R5bGVkLCB0LCB1c2VUaGVtZSwgdXNlUHJldmlvdXMsIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IEVycm9yTWVzc2FnZVdpdGhTdGFja1RyYWNlIGZyb20gJ3NyYy9jb21wb25lbnRzL0Vycm9yTWVzc2FnZS9FcnJvck1lc3NhZ2VXaXRoU3RhY2tUcmFjZSc7XG5pbXBvcnQgeyBTYXZlRGF0YXNldE1vZGFsLCB9IGZyb20gJ3NyYy9TcWxMYWIvY29tcG9uZW50cy9TYXZlRGF0YXNldE1vZGFsJztcbmltcG9ydCB7IEVYUExPUkVfQ0hBUlRfREVGQVVMVCB9IGZyb20gJ3NyYy9TcWxMYWIvdHlwZXMnO1xuaW1wb3J0IHsgbW91bnRFeHBsb3JlVXJsIH0gZnJvbSAnc3JjL2V4cGxvcmUvZXhwbG9yZVV0aWxzJztcbmltcG9ydCB7IHBvc3RGb3JtRGF0YSB9IGZyb20gJ3NyYy9leHBsb3JlL2V4cGxvcmVVdGlscy9mb3JtRGF0YSc7XG5pbXBvcnQgUHJvZ3Jlc3NCYXIgZnJvbSAnc3JjL2NvbXBvbmVudHMvUHJvZ3Jlc3NCYXInO1xuaW1wb3J0IExvYWRpbmcgZnJvbSAnc3JjL2NvbXBvbmVudHMvTG9hZGluZyc7XG5pbXBvcnQgRmlsdGVyYWJsZVRhYmxlIGZyb20gJ3NyYy9jb21wb25lbnRzL0ZpbHRlcmFibGVUYWJsZSc7XG5pbXBvcnQgQ29weVRvQ2xpcGJvYXJkIGZyb20gJ3NyYy9jb21wb25lbnRzL0NvcHlUb0NsaXBib2FyZCc7XG5pbXBvcnQgeyBhZGREYW5nZXJUb2FzdCB9IGZyb20gJ3NyYy9jb21wb25lbnRzL01lc3NhZ2VUb2FzdHMvYWN0aW9ucyc7XG5pbXBvcnQgeyBwcmVwYXJlQ29weVRvQ2xpcGJvYXJkVGFidWxhckRhdGEgfSBmcm9tICdzcmMvdXRpbHMvY29tbW9uJztcbmltcG9ydCB7IGFkZFF1ZXJ5RWRpdG9yLCBjbGVhclF1ZXJ5UmVzdWx0cywgQ3Rhc0VudW0sIGZldGNoUXVlcnlSZXN1bHRzLCByZUZldGNoUXVlcnlSZXN1bHRzLCByZVJ1blF1ZXJ5LCB9IGZyb20gJ3NyYy9TcWxMYWIvYWN0aW9ucy9zcWxMYWInO1xuaW1wb3J0IHsgVVJMX1BBUkFNUyB9IGZyb20gJ3NyYy9jb25zdGFudHMnO1xuaW1wb3J0IEV4cGxvcmVDdGFzUmVzdWx0c0J1dHRvbiBmcm9tICcuLi9FeHBsb3JlQ3Rhc1Jlc3VsdHNCdXR0b24nO1xuaW1wb3J0IEV4cGxvcmVSZXN1bHRzQnV0dG9uIGZyb20gJy4uL0V4cGxvcmVSZXN1bHRzQnV0dG9uJztcbmltcG9ydCBIaWdobGlnaHRlZFNxbCBmcm9tICcuLi9IaWdobGlnaHRlZFNxbCc7XG5pbXBvcnQgUXVlcnlTdGF0ZUxhYmVsIGZyb20gJy4uL1F1ZXJ5U3RhdGVMYWJlbCc7XG52YXIgTElNSVRJTkdfRkFDVE9SO1xuKGZ1bmN0aW9uIChMSU1JVElOR19GQUNUT1IpIHtcbiAgICBMSU1JVElOR19GQUNUT1JbXCJRVUVSWVwiXSA9IFwiUVVFUllcIjtcbiAgICBMSU1JVElOR19GQUNUT1JbXCJRVUVSWV9BTkRfRFJPUERPV05cIl0gPSBcIlFVRVJZX0FORF9EUk9QRE9XTlwiO1xuICAgIExJTUlUSU5HX0ZBQ1RPUltcIkRST1BET1dOXCJdID0gXCJEUk9QRE9XTlwiO1xuICAgIExJTUlUSU5HX0ZBQ1RPUltcIk5PVF9MSU1JVEVEXCJdID0gXCJOT1RfTElNSVRFRFwiO1xufSkoTElNSVRJTkdfRkFDVE9SIHx8IChMSU1JVElOR19GQUNUT1IgPSB7fSkpO1xuY29uc3QgUmVzdWx0Q29udGFpbmVyID0gc3R5bGVkLmRpdiBgXG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gIHJvdy1nYXA6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuYDtcbmNvbnN0IFJlc3VsdGxlc3NTdHlsZXMgPSBzdHlsZWQuZGl2IGBcbiAgcG9zaXRpb246IHJlbGF0aXZlO1xuICBtaW4taGVpZ2h0OiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMjV9cHg7XG4gIFtyb2xlPSdhbGVydCddIHtcbiAgICBtYXJnaW4tdG9wOiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMn1weDtcbiAgfVxuICAuc3FsLXJlc3VsdC10cmFjay1qb2Ige1xuICAgIG1hcmdpbi10b3A6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuZ3JpZFVuaXQgKiAyfXB4O1xuICB9XG5gO1xuLy8gTWFraW5nIHRleHQgcmVuZGVyIGxpbmUgYnJlYWtzL3RhYnMgYXMgaXMgYXMgbW9ub3NwYWNlLFxuLy8gYnV0IHdyYXBwaW5nIHRleHQgdG9vIHNvIHRleHQgZG9lc24ndCBvdmVyZmxvd1xuY29uc3QgTW9ub3NwYWNlRGl2ID0gc3R5bGVkLmRpdiBgXG4gIGZvbnQtZmFtaWx5OiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLnR5cG9ncmFwaHkuZmFtaWxpZXMubW9ub3NwYWNlfTtcbiAgd2hpdGUtc3BhY2U6IHByZTtcbiAgd29yZC1icmVhazogYnJlYWstd29yZDtcbiAgb3ZlcmZsb3cteDogYXV0bztcbiAgd2hpdGUtc3BhY2U6IHByZS13cmFwO1xuYDtcbmNvbnN0IFJldHVybmVkUm93cyA9IHN0eWxlZC5kaXYgYFxuICBmb250LXNpemU6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUudHlwb2dyYXBoeS5zaXplcy5zfXB4O1xuICBsaW5lLWhlaWdodDogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5ncmlkVW5pdCAqIDZ9cHg7XG5gO1xuY29uc3QgUmVzdWx0U2V0Q29udHJvbHMgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZmxleDtcbiAganVzdGlmeS1jb250ZW50OiBzcGFjZS1iZXR3ZWVuO1xuYDtcbmNvbnN0IFJlc3VsdFNldEJ1dHRvbnMgPSBzdHlsZWQuZGl2IGBcbiAgZGlzcGxheTogZ3JpZDtcbiAgZ3JpZC1hdXRvLWZsb3c6IGNvbHVtbjtcbiAgcGFkZGluZy1yaWdodDogJHsoeyB0aGVtZSB9KSA9PiAyICogdGhlbWUuZ3JpZFVuaXR9cHg7XG5gO1xuY29uc3QgTGltaXRNZXNzYWdlID0gc3R5bGVkLnNwYW4gYFxuICBjb2xvcjogJHsoeyB0aGVtZSB9KSA9PiB0aGVtZS5jb2xvcnMuc2Vjb25kYXJ5LmxpZ2h0MX07XG4gIG1hcmdpbi1sZWZ0OiAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmdyaWRVbml0ICogMn1weDtcbmA7XG5jb25zdCBSZXN1bHRTZXQgPSAoeyBjYWNoZSA9IGZhbHNlLCBjc3YgPSB0cnVlLCBkYXRhYmFzZSA9IHt9LCBkaXNwbGF5TGltaXQsIGhlaWdodCwgcXVlcnksIHNlYXJjaCA9IHRydWUsIHNob3dTcWwgPSBmYWxzZSwgdmlzdWFsaXplID0gdHJ1ZSwgdXNlciwgZGVmYXVsdFF1ZXJ5TGltaXQsIH0pID0+IHtcbiAgICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKCk7XG4gICAgY29uc3QgW3NlYXJjaFRleHQsIHNldFNlYXJjaFRleHRdID0gdXNlU3RhdGUoJycpO1xuICAgIGNvbnN0IFtjYWNoZWREYXRhLCBzZXRDYWNoZWREYXRhXSA9IHVzZVN0YXRlKFtdKTtcbiAgICBjb25zdCBbc2hvd1NhdmVEYXRhc2V0TW9kYWwsIHNldFNob3dTYXZlRGF0YXNldE1vZGFsXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBbYWxlcnRJc09wZW4sIHNldEFsZXJ0SXNPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgICBjb25zdCBkaXNwYXRjaCA9IHVzZURpc3BhdGNoKCk7XG4gICAgY29uc3QgcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICAgIGlmIChxdWVyeS5lcnJvck1lc3NhZ2UgJiZcbiAgICAgICAgICAgIHF1ZXJ5LmVycm9yTWVzc2FnZS5pbmRleE9mKCdzZXNzaW9uIHRpbWVkIG91dCcpID4gMCkge1xuICAgICAgICAgICAgZGlzcGF0Y2gocmVSdW5RdWVyeShxdWVyeSkpO1xuICAgICAgICB9XG4gICAgfSwgW10pO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIC8vIG9ubHkgZG8gdGhpcyB0aGUgZmlyc3QgdGltZSB0aGUgY29tcG9uZW50IGlzIHJlbmRlcmVkL21vdW50ZWRcbiAgICAgICAgcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnQoKTtcbiAgICB9LCBbcmVSdW5RdWVyeUlmU2Vzc2lvblRpbWVvdXRFcnJvck9uTW91bnRdKTtcbiAgICBjb25zdCBmZXRjaFJlc3VsdHMgPSAocXVlcnkpID0+IHtcbiAgICAgICAgZGlzcGF0Y2goZmV0Y2hRdWVyeVJlc3VsdHMocXVlcnksIGRpc3BsYXlMaW1pdCkpO1xuICAgIH07XG4gICAgY29uc3QgcHJldlF1ZXJ5ID0gdXNlUHJldmlvdXMocXVlcnkpO1xuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIGlmIChjYWNoZSAmJiBxdWVyeS5jYWNoZWQgJiYgcXVlcnk/LnJlc3VsdHM/LmRhdGE/Lmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHNldENhY2hlZERhdGEocXVlcnkucmVzdWx0cy5kYXRhKTtcbiAgICAgICAgICAgIGRpc3BhdGNoKGNsZWFyUXVlcnlSZXN1bHRzKHF1ZXJ5KSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5LnJlc3VsdHNLZXkgJiYgcXVlcnkucmVzdWx0c0tleSAhPT0gcHJldlF1ZXJ5Py5yZXN1bHRzS2V5KSB7XG4gICAgICAgICAgICBmZXRjaFJlc3VsdHMocXVlcnkpO1xuICAgICAgICB9XG4gICAgfSwgW3F1ZXJ5LCBjYWNoZV0pO1xuICAgIGNvbnN0IGNhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0ID0gKGFsZXJ0RWxlbWVudCkgPT4ge1xuICAgICAgICBpZiAoYWxlcnRFbGVtZW50KSB7XG4gICAgICAgICAgICBzZXRBbGVydElzT3Blbih0cnVlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIHNldEFsZXJ0SXNPcGVuKGZhbHNlKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgcG9wU2VsZWN0U3RhciA9ICh0ZW1wU2NoZW1hLCB0ZW1wVGFibGUpID0+IHtcbiAgICAgICAgY29uc3QgcWUgPSB7XG4gICAgICAgICAgICBpZDogc2hvcnRpZC5nZW5lcmF0ZSgpLFxuICAgICAgICAgICAgbmFtZTogdGVtcFRhYmxlLFxuICAgICAgICAgICAgYXV0b3J1bjogZmFsc2UsXG4gICAgICAgICAgICBkYklkOiBxdWVyeS5kYklkLFxuICAgICAgICAgICAgc3FsOiBgU0VMRUNUICogRlJPTSAke3RlbXBTY2hlbWEgPyBgJHt0ZW1wU2NoZW1hfS5gIDogJyd9JHt0ZW1wVGFibGV9YCxcbiAgICAgICAgfTtcbiAgICAgICAgZGlzcGF0Y2goYWRkUXVlcnlFZGl0b3IocWUpKTtcbiAgICB9O1xuICAgIGNvbnN0IGNoYW5nZVNlYXJjaCA9IChldmVudCkgPT4ge1xuICAgICAgICBzZXRTZWFyY2hUZXh0KGV2ZW50LnRhcmdldC52YWx1ZSk7XG4gICAgfTtcbiAgICBjb25zdCBjcmVhdGVFeHBsb3JlUmVzdWx0c09uQ2xpY2sgPSBhc3luYyAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0cyB9ID0gcXVlcnk7XG4gICAgICAgIGlmIChyZXN1bHRzPy5xdWVyeV9pZCkge1xuICAgICAgICAgICAgY29uc3Qga2V5ID0gYXdhaXQgcG9zdEZvcm1EYXRhKHJlc3VsdHMucXVlcnlfaWQsICdxdWVyeScsIHtcbiAgICAgICAgICAgICAgICAuLi5FWFBMT1JFX0NIQVJUX0RFRkFVTFQsXG4gICAgICAgICAgICAgICAgZGF0YXNvdXJjZTogYCR7cmVzdWx0cy5xdWVyeV9pZH1fX3F1ZXJ5YCxcbiAgICAgICAgICAgICAgICAuLi57XG4gICAgICAgICAgICAgICAgICAgIGFsbF9jb2x1bW5zOiByZXN1bHRzLmNvbHVtbnMubWFwKGNvbHVtbiA9PiBjb2x1bW4uY29sdW1uX25hbWUpLFxuICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGNvbnN0IHVybCA9IG1vdW50RXhwbG9yZVVybChudWxsLCB7XG4gICAgICAgICAgICAgICAgW1VSTF9QQVJBTVMuZm9ybURhdGFLZXkubmFtZV06IGtleSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgd2luZG93Lm9wZW4odXJsLCAnX2JsYW5rJywgJ25vcmVmZXJyZXInKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGFkZERhbmdlclRvYXN0KHQoJ1VuYWJsZSB0byBjcmVhdGUgY2hhcnQgd2l0aG91dCBhIHF1ZXJ5IGlkLicpKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgY29uc3QgZ2V0RXhwb3J0Q3N2VXJsID0gKGNsaWVudElkKSA9PiBgL2FwaS92MS9zcWxsYWIvZXhwb3J0LyR7Y2xpZW50SWR9L2A7XG4gICAgY29uc3QgcmVuZGVyQ29udHJvbHMgPSAoKSA9PiB7XG4gICAgICAgIGlmIChzZWFyY2ggfHwgdmlzdWFsaXplIHx8IGNzdikge1xuICAgICAgICAgICAgbGV0IHsgZGF0YSB9ID0gcXVlcnkucmVzdWx0cztcbiAgICAgICAgICAgIGlmIChjYWNoZSAmJiBxdWVyeS5jYWNoZWQpIHtcbiAgICAgICAgICAgICAgICBkYXRhID0gY2FjaGVkRGF0YTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNvbnN0IHsgY29sdW1ucyB9ID0gcXVlcnkucmVzdWx0cztcbiAgICAgICAgICAgIC8vIEFkZGVkIGNvbXB1dGUgbG9naWMgdG8gc3RvcCB1c2VyIGZyb20gYmVpbmcgYWJsZSB0byBTYXZlICYgRXhwbG9yZVxuICAgICAgICAgICAgY29uc3QgZGF0YXNvdXJjZSA9IHtcbiAgICAgICAgICAgICAgICBjb2x1bW5zOiBxdWVyeS5yZXN1bHRzLmNvbHVtbnMsXG4gICAgICAgICAgICAgICAgbmFtZTogcXVlcnk/LnRhYiB8fCAnVW50aXRsZWQnLFxuICAgICAgICAgICAgICAgIGRiSWQ6IHF1ZXJ5Py5kYklkLFxuICAgICAgICAgICAgICAgIHNxbDogcXVlcnk/LnNxbCxcbiAgICAgICAgICAgICAgICB0ZW1wbGF0ZVBhcmFtczogcXVlcnk/LnRlbXBsYXRlUGFyYW1zLFxuICAgICAgICAgICAgICAgIHNjaGVtYTogcXVlcnk/LnNjaGVtYSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICByZXR1cm4gKDxSZXN1bHRTZXRDb250cm9scz5cbiAgICAgICAgICA8U2F2ZURhdGFzZXRNb2RhbCB2aXNpYmxlPXtzaG93U2F2ZURhdGFzZXRNb2RhbH0gb25IaWRlPXsoKSA9PiBzZXRTaG93U2F2ZURhdGFzZXRNb2RhbChmYWxzZSl9IGJ1dHRvblRleHRPblNhdmU9e3QoJ1NhdmUgJiBFeHBsb3JlJyl9IGJ1dHRvblRleHRPbk92ZXJ3cml0ZT17dCgnT3ZlcndyaXRlICYgRXhwbG9yZScpfSBtb2RhbERlc2NyaXB0aW9uPXt0KCdTYXZlIHRoaXMgcXVlcnkgYXMgYSB2aXJ0dWFsIGRhdGFzZXQgdG8gY29udGludWUgZXhwbG9yaW5nJyl9IGRhdGFzb3VyY2U9e2RhdGFzb3VyY2V9Lz5cbiAgICAgICAgICA8UmVzdWx0U2V0QnV0dG9ucz5cbiAgICAgICAgICAgIHt2aXN1YWxpemUgJiYgZGF0YWJhc2U/LmFsbG93c192aXJ0dWFsX3RhYmxlX2V4cGxvcmUgJiYgKDxFeHBsb3JlUmVzdWx0c0J1dHRvbiBkYXRhYmFzZT17ZGF0YWJhc2V9IG9uQ2xpY2s9e2NyZWF0ZUV4cGxvcmVSZXN1bHRzT25DbGlja30vPil9XG4gICAgICAgICAgICB7Y3N2ICYmICg8QnV0dG9uIGJ1dHRvblNpemU9XCJzbWFsbFwiIGhyZWY9e2dldEV4cG9ydENzdlVybChxdWVyeS5pZCl9PlxuICAgICAgICAgICAgICAgIDxpIGNsYXNzTmFtZT1cImZhIGZhLWZpbGUtdGV4dC1vXCIvPiB7dCgnRG93bmxvYWQgdG8gQ1NWJyl9XG4gICAgICAgICAgICAgIDwvQnV0dG9uPil9XG5cbiAgICAgICAgICAgIDxDb3B5VG9DbGlwYm9hcmQgdGV4dD17cHJlcGFyZUNvcHlUb0NsaXBib2FyZFRhYnVsYXJEYXRhKGRhdGEsIGNvbHVtbnMpfSB3cmFwcGVkPXtmYWxzZX0gY29weU5vZGU9ezxCdXR0b24gYnV0dG9uU2l6ZT1cInNtYWxsXCI+XG4gICAgICAgICAgICAgICAgICA8aSBjbGFzc05hbWU9XCJmYSBmYS1jbGlwYm9hcmRcIi8+IHt0KCdDb3B5IHRvIENsaXBib2FyZCcpfVxuICAgICAgICAgICAgICAgIDwvQnV0dG9uPn0gaGlkZVRvb2x0aXAvPlxuICAgICAgICAgIDwvUmVzdWx0U2V0QnV0dG9ucz5cbiAgICAgICAgICB7c2VhcmNoICYmICg8aW5wdXQgdHlwZT1cInRleHRcIiBvbkNoYW5nZT17Y2hhbmdlU2VhcmNofSB2YWx1ZT17c2VhcmNoVGV4dH0gY2xhc3NOYW1lPVwiZm9ybS1jb250cm9sIGlucHV0LXNtXCIgcGxhY2Vob2xkZXI9e3QoJ0ZpbHRlciByZXN1bHRzJyl9Lz4pfVxuICAgICAgICA8L1Jlc3VsdFNldENvbnRyb2xzPik7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIDxkaXYgLz47XG4gICAgfTtcbiAgICBjb25zdCByZW5kZXJSb3dzUmV0dXJuZWQgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgcmVzdWx0cywgcm93cywgcXVlcnlMaW1pdCwgbGltaXRpbmdGYWN0b3IgfSA9IHF1ZXJ5O1xuICAgICAgICBsZXQgbGltaXRNZXNzYWdlO1xuICAgICAgICBjb25zdCBsaW1pdFJlYWNoZWQgPSByZXN1bHRzPy5kaXNwbGF5TGltaXRSZWFjaGVkO1xuICAgICAgICBjb25zdCBsaW1pdCA9IHF1ZXJ5TGltaXQgfHwgcmVzdWx0cy5xdWVyeS5saW1pdDtcbiAgICAgICAgY29uc3QgaXNBZG1pbiA9ICEhdXNlcj8ucm9sZXM/LkFkbWluO1xuICAgICAgICBjb25zdCByb3dzQ291bnQgPSBNYXRoLm1pbihyb3dzIHx8IDAsIHJlc3VsdHM/LmRhdGE/Lmxlbmd0aCB8fCAwKTtcbiAgICAgICAgY29uc3QgZGlzcGxheU1heFJvd3NSZWFjaGVkTWVzc2FnZSA9IHtcbiAgICAgICAgICAgIHdpdGhBZG1pbjogdCgnVGhlIG51bWJlciBvZiByZXN1bHRzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBjb25maWd1cmF0aW9uIERJU1BMQVlfTUFYX1JPVy4gJyArXG4gICAgICAgICAgICAgICAgJ1BsZWFzZSBhZGQgYWRkaXRpb25hbCBsaW1pdHMvZmlsdGVycyBvciBkb3dubG9hZCB0byBjc3YgdG8gc2VlIG1vcmUgcm93cyB1cCB0byAnICtcbiAgICAgICAgICAgICAgICAndGhlICUobGltaXQpZCBsaW1pdC4nLCB7IHJvd3M6IHJvd3NDb3VudCwgbGltaXQgfSksXG4gICAgICAgICAgICB3aXRob3V0QWRtaW46IHQoJ1RoZSBudW1iZXIgb2YgcmVzdWx0cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZC4gJyArXG4gICAgICAgICAgICAgICAgJ1BsZWFzZSBhZGQgYWRkaXRpb25hbCBsaW1pdHMvZmlsdGVycywgZG93bmxvYWQgdG8gY3N2LCBvciBjb250YWN0IGFuIGFkbWluICcgK1xuICAgICAgICAgICAgICAgICd0byBzZWUgbW9yZSByb3dzIHVwIHRvIHRoZSAlKGxpbWl0KWQgbGltaXQuJywgeyByb3dzOiByb3dzQ291bnQsIGxpbWl0IH0pLFxuICAgICAgICB9O1xuICAgICAgICBjb25zdCBzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCA9IGxpbWl0ID09PSBkZWZhdWx0UXVlcnlMaW1pdCAmJlxuICAgICAgICAgICAgbGltaXRpbmdGYWN0b3IgPT09IExJTUlUSU5HX0ZBQ1RPUi5EUk9QRE9XTjtcbiAgICAgICAgaWYgKGxpbWl0aW5nRmFjdG9yID09PSBMSU1JVElOR19GQUNUT1IuUVVFUlkgJiYgY3N2KSB7XG4gICAgICAgICAgICBsaW1pdE1lc3NhZ2UgPSB0KCdUaGUgbnVtYmVyIG9mIHJvd3MgZGlzcGxheWVkIGlzIGxpbWl0ZWQgdG8gJShyb3dzKWQgYnkgdGhlIHF1ZXJ5JywgeyByb3dzIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKGxpbWl0aW5nRmFjdG9yID09PSBMSU1JVElOR19GQUNUT1IuRFJPUERPV04gJiZcbiAgICAgICAgICAgICFzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCkge1xuICAgICAgICAgICAgbGltaXRNZXNzYWdlID0gdCgnVGhlIG51bWJlciBvZiByb3dzIGRpc3BsYXllZCBpcyBsaW1pdGVkIHRvICUocm93cylkIGJ5IHRoZSBsaW1pdCBkcm9wZG93bi4nLCB7IHJvd3MgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAobGltaXRpbmdGYWN0b3IgPT09IExJTUlUSU5HX0ZBQ1RPUi5RVUVSWV9BTkRfRFJPUERPV04pIHtcbiAgICAgICAgICAgIGxpbWl0TWVzc2FnZSA9IHQoJ1RoZSBudW1iZXIgb2Ygcm93cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZCBieSB0aGUgcXVlcnkgYW5kIGxpbWl0IGRyb3Bkb3duLicsIHsgcm93cyB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCByb3dzUmV0dXJuZWRNZXNzYWdlID0gdCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHtcbiAgICAgICAgICAgIHJvd3MsXG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB0b29sdGlwVGV4dCA9IGAke3Jvd3NSZXR1cm5lZE1lc3NhZ2V9LiAke2xpbWl0TWVzc2FnZX1gO1xuICAgICAgICByZXR1cm4gKDxSZXR1cm5lZFJvd3M+XG4gICAgICAgIHshbGltaXRSZWFjaGVkICYmICFzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCAmJiAoPHNwYW4gdGl0bGU9e3Rvb2x0aXBUZXh0fT5cbiAgICAgICAgICAgIHtyb3dzUmV0dXJuZWRNZXNzYWdlfVxuICAgICAgICAgICAgPExpbWl0TWVzc2FnZT57bGltaXRNZXNzYWdlfTwvTGltaXRNZXNzYWdlPlxuICAgICAgICAgIDwvc3Bhbj4pfVxuICAgICAgICB7IWxpbWl0UmVhY2hlZCAmJiBzaG91bGRVc2VEZWZhdWx0RHJvcGRvd25BbGVydCAmJiAoPGRpdiByZWY9e2NhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0fT5cbiAgICAgICAgICAgIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJyUocm93cylkIHJvd3MgcmV0dXJuZWQnLCB7IHJvd3MgfSl9IG9uQ2xvc2U9eygpID0+IHNldEFsZXJ0SXNPcGVuKGZhbHNlKX0gZGVzY3JpcHRpb249e3QoJ1RoZSBudW1iZXIgb2Ygcm93cyBkaXNwbGF5ZWQgaXMgbGltaXRlZCB0byAlKHJvd3MpZCBieSB0aGUgZHJvcGRvd24uJywgeyByb3dzIH0pfS8+XG4gICAgICAgICAgPC9kaXY+KX1cbiAgICAgICAge2xpbWl0UmVhY2hlZCAmJiAoPGRpdiByZWY9e2NhbGN1bGF0ZUFsZXJ0UmVmSGVpZ2h0fT5cbiAgICAgICAgICAgIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG9uQ2xvc2U9eygpID0+IHNldEFsZXJ0SXNPcGVuKGZhbHNlKX0gbWVzc2FnZT17dCgnJShyb3dzKWQgcm93cyByZXR1cm5lZCcsIHsgcm93czogcm93c0NvdW50IH0pfSBkZXNjcmlwdGlvbj17aXNBZG1pblxuICAgICAgICAgICAgICAgICAgICA/IGRpc3BsYXlNYXhSb3dzUmVhY2hlZE1lc3NhZ2Uud2l0aEFkbWluXG4gICAgICAgICAgICAgICAgICAgIDogZGlzcGxheU1heFJvd3NSZWFjaGVkTWVzc2FnZS53aXRob3V0QWRtaW59Lz5cbiAgICAgICAgICA8L2Rpdj4pfVxuICAgICAgPC9SZXR1cm5lZFJvd3M+KTtcbiAgICB9O1xuICAgIGNvbnN0IGxpbWl0UmVhY2hlZCA9IHF1ZXJ5Py5yZXN1bHRzPy5kaXNwbGF5TGltaXRSZWFjaGVkO1xuICAgIGxldCBzcWw7XG4gICAgbGV0IGV4cGxvcmVEQklkID0gcXVlcnkuZGJJZDtcbiAgICBpZiAoZGF0YWJhc2U/LmV4cGxvcmVfZGF0YWJhc2VfaWQpIHtcbiAgICAgICAgZXhwbG9yZURCSWQgPSBkYXRhYmFzZS5leHBsb3JlX2RhdGFiYXNlX2lkO1xuICAgIH1cbiAgICBsZXQgdHJhY2tpbmdVcmw7XG4gICAgaWYgKHF1ZXJ5LnRyYWNraW5nVXJsICYmXG4gICAgICAgIHF1ZXJ5LnN0YXRlICE9PSBRdWVyeVN0YXRlLlNVQ0NFU1MgJiZcbiAgICAgICAgcXVlcnkuc3RhdGUgIT09IFF1ZXJ5U3RhdGUuRkVUQ0hJTkcpIHtcbiAgICAgICAgdHJhY2tpbmdVcmwgPSAoPEJ1dHRvbiBjbGFzc05hbWU9XCJzcWwtcmVzdWx0LXRyYWNrLWpvYlwiIGJ1dHRvblNpemU9XCJzbWFsbFwiIGhyZWY9e3F1ZXJ5LnRyYWNraW5nVXJsfSB0YXJnZXQ9XCJfYmxhbmtcIj5cbiAgICAgICAge3F1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlJVTk5JTkdcbiAgICAgICAgICAgICAgICA/IHQoJ1RyYWNrIGpvYicpXG4gICAgICAgICAgICAgICAgOiB0KCdTZWUgcXVlcnkgZGV0YWlscycpfVxuICAgICAgPC9CdXR0b24+KTtcbiAgICB9XG4gICAgaWYgKHNob3dTcWwpIHtcbiAgICAgICAgc3FsID0gPEhpZ2hsaWdodGVkU3FsIHNxbD17cXVlcnkuc3FsfS8+O1xuICAgIH1cbiAgICBpZiAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU1RPUFBFRCkge1xuICAgICAgICByZXR1cm4gPEFsZXJ0IHR5cGU9XCJ3YXJuaW5nXCIgbWVzc2FnZT17dCgnUXVlcnkgd2FzIHN0b3BwZWQnKX0vPjtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLkZBSUxFRCkge1xuICAgICAgICByZXR1cm4gKDxSZXN1bHRsZXNzU3R5bGVzPlxuICAgICAgICA8RXJyb3JNZXNzYWdlV2l0aFN0YWNrVHJhY2UgdGl0bGU9e3QoJ0RhdGFiYXNlIGVycm9yJyl9IGVycm9yPXtxdWVyeT8uZXJyb3JzPy5bMF19IHN1YnRpdGxlPXs8TW9ub3NwYWNlRGl2PntxdWVyeS5lcnJvck1lc3NhZ2V9PC9Nb25vc3BhY2VEaXY+fSBjb3B5VGV4dD17cXVlcnkuZXJyb3JNZXNzYWdlIHx8IHVuZGVmaW5lZH0gbGluaz17cXVlcnkubGlua30gc291cmNlPVwic3FsbGFiXCIvPlxuICAgICAgICB7dHJhY2tpbmdVcmx9XG4gICAgICA8L1Jlc3VsdGxlc3NTdHlsZXM+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlNVQ0NFU1MgJiYgcXVlcnkuY3Rhcykge1xuICAgICAgICBjb25zdCB7IHRlbXBTY2hlbWEsIHRlbXBUYWJsZSB9ID0gcXVlcnk7XG4gICAgICAgIGxldCBvYmplY3QgPSAnVGFibGUnO1xuICAgICAgICBpZiAocXVlcnkuY3Rhc19tZXRob2QgPT09IEN0YXNFbnVtLlZJRVcpIHtcbiAgICAgICAgICAgIG9iamVjdCA9ICdWaWV3JztcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gKDxkaXY+XG4gICAgICAgIDxBbGVydCB0eXBlPVwiaW5mb1wiIG1lc3NhZ2U9ezw+XG4gICAgICAgICAgICAgIHt0KG9iamVjdCl9IFtcbiAgICAgICAgICAgICAgPHN0cm9uZz5cbiAgICAgICAgICAgICAgICB7dGVtcFNjaGVtYSA/IGAke3RlbXBTY2hlbWF9LmAgOiAnJ31cbiAgICAgICAgICAgICAgICB7dGVtcFRhYmxlfVxuICAgICAgICAgICAgICA8L3N0cm9uZz5cbiAgICAgICAgICAgICAgXSB7dCgnd2FzIGNyZWF0ZWQnKX0gJm5ic3A7XG4gICAgICAgICAgICAgIDxCdXR0b25Hcm91cD5cbiAgICAgICAgICAgICAgICA8QnV0dG9uIGJ1dHRvblNpemU9XCJzbWFsbFwiIGNzcz17eyBtYXJnaW5SaWdodDogdGhlbWUuZ3JpZFVuaXQgfX0gb25DbGljaz17KCkgPT4gcG9wU2VsZWN0U3Rhcih0ZW1wU2NoZW1hLCB0ZW1wVGFibGUpfT5cbiAgICAgICAgICAgICAgICAgIHt0KCdRdWVyeSBpbiBhIG5ldyB0YWInKX1cbiAgICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgICAgICA8RXhwbG9yZUN0YXNSZXN1bHRzQnV0dG9uIHRhYmxlPXt0ZW1wVGFibGV9IHNjaGVtYT17dGVtcFNjaGVtYX0gZGJJZD17ZXhwbG9yZURCSWR9Lz5cbiAgICAgICAgICAgICAgPC9CdXR0b25Hcm91cD5cbiAgICAgICAgICAgIDwvPn0vPlxuICAgICAgPC9kaXY+KTtcbiAgICB9XG4gICAgaWYgKHF1ZXJ5LnN0YXRlID09PSBRdWVyeVN0YXRlLlNVQ0NFU1MgJiYgcXVlcnkucmVzdWx0cykge1xuICAgICAgICBjb25zdCB7IHJlc3VsdHMgfSA9IHF1ZXJ5O1xuICAgICAgICAvLyBBY2NvdW50cyBmb3Igb2Zmc2V0IG5lZWRlZCBmb3IgaGVpZ2h0IG9mIFJlc3VsdFNldFJvd3NSZXR1cm5lZCBjb21wb25lbnQgaWYgIWxpbWl0UmVhY2hlZFxuICAgICAgICBjb25zdCByb3dNZXNzYWdlSGVpZ2h0ID0gIWxpbWl0UmVhY2hlZCA/IDMyIDogMDtcbiAgICAgICAgLy8gQWNjb3VudHMgZm9yIG9mZnNldCBuZWVkZWQgZm9yIGhlaWdodCBvZiBBbGVydCBpZiB0aGlzLnN0YXRlLmFsZXJ0SXNPcGVuXG4gICAgICAgIGNvbnN0IGFsZXJ0Q29udGFpbmVySGVpZ2h0ID0gNzA7XG4gICAgICAgIC8vIFdlIG5lZWQgdG8gY2FsY3VsYXRlIHRoZSBoZWlnaHQgb2YgdGhpcy5yZW5kZXJSb3dzUmV0dXJuZWQoKVxuICAgICAgICAvLyBpZiB3ZSB3YW50IHJlc3VsdHMgcGFuZWwgdG8gYmUgcHJvcGVyIGhlaWdodCBiZWNhdXNlIHRoZVxuICAgICAgICAvLyBGaWx0ZXJUYWJsZSBjb21wb25lbnQgbmVlZHMgYW4gZXhwbGljaXQgaGVpZ2h0IHRvIHJlbmRlclxuICAgICAgICAvLyB0aGUgVGFibGUgY29tcG9uZW50XG4gICAgICAgIGNvbnN0IHJvd3NIZWlnaHQgPSBhbGVydElzT3BlblxuICAgICAgICAgICAgPyBoZWlnaHQgLSBhbGVydENvbnRhaW5lckhlaWdodFxuICAgICAgICAgICAgOiBoZWlnaHQgLSByb3dNZXNzYWdlSGVpZ2h0O1xuICAgICAgICBsZXQgZGF0YTtcbiAgICAgICAgaWYgKGNhY2hlICYmIHF1ZXJ5LmNhY2hlZCkge1xuICAgICAgICAgICAgZGF0YSA9IGNhY2hlZERhdGE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAocmVzdWx0cz8uZGF0YSkge1xuICAgICAgICAgICAgKHsgZGF0YSB9ID0gcmVzdWx0cyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGRhdGEgJiYgZGF0YS5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zdCBleHBhbmRlZENvbHVtbnMgPSByZXN1bHRzLmV4cGFuZGVkX2NvbHVtbnNcbiAgICAgICAgICAgICAgICA/IHJlc3VsdHMuZXhwYW5kZWRfY29sdW1ucy5tYXAoY29sID0+IGNvbC5jb2x1bW5fbmFtZSlcbiAgICAgICAgICAgICAgICA6IFtdO1xuICAgICAgICAgICAgcmV0dXJuICg8UmVzdWx0Q29udGFpbmVyPlxuICAgICAgICAgIHtyZW5kZXJDb250cm9scygpfVxuICAgICAgICAgIHtyZW5kZXJSb3dzUmV0dXJuZWQoKX1cbiAgICAgICAgICB7c3FsfVxuICAgICAgICAgIDxGaWx0ZXJhYmxlVGFibGUgZGF0YT17ZGF0YX0gb3JkZXJlZENvbHVtbktleXM9e3Jlc3VsdHMuY29sdW1ucy5tYXAoY29sID0+IGNvbC5jb2x1bW5fbmFtZSl9IGhlaWdodD17cm93c0hlaWdodH0gZmlsdGVyVGV4dD17c2VhcmNoVGV4dH0gZXhwYW5kZWRDb2x1bW5zPXtleHBhbmRlZENvbHVtbnN9Lz5cbiAgICAgICAgPC9SZXN1bHRDb250YWluZXI+KTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoZGF0YSAmJiBkYXRhLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgcmV0dXJuIDxBbGVydCB0eXBlPVwid2FybmluZ1wiIG1lc3NhZ2U9e3QoJ1RoZSBxdWVyeSByZXR1cm5lZCBubyBkYXRhJyl9Lz47XG4gICAgICAgIH1cbiAgICB9XG4gICAgaWYgKHF1ZXJ5LmNhY2hlZCB8fCAocXVlcnkuc3RhdGUgPT09IFF1ZXJ5U3RhdGUuU1VDQ0VTUyAmJiAhcXVlcnkucmVzdWx0cykpIHtcbiAgICAgICAgaWYgKHF1ZXJ5LmlzRGF0YVByZXZpZXcpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBkaXNwYXRjaChyZUZldGNoUXVlcnlSZXN1bHRzKHtcbiAgICAgICAgICAgICAgICAgICAgLi4ucXVlcnksXG4gICAgICAgICAgICAgICAgICAgIGlzRGF0YVByZXZpZXc6IHRydWUsXG4gICAgICAgICAgICAgICAgfSkpfT5cbiAgICAgICAgICB7dCgnRmV0Y2ggZGF0YSBwcmV2aWV3Jyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHF1ZXJ5LnJlc3VsdHNLZXkpIHtcbiAgICAgICAgICAgIHJldHVybiAoPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBvbkNsaWNrPXsoKSA9PiBmZXRjaFJlc3VsdHMocXVlcnkpfT5cbiAgICAgICAgICB7dCgnUmVmZXRjaCByZXN1bHRzJyl9XG4gICAgICAgIDwvQnV0dG9uPik7XG4gICAgICAgIH1cbiAgICB9XG4gICAgbGV0IHByb2dyZXNzQmFyO1xuICAgIGlmIChxdWVyeS5wcm9ncmVzcyA+IDApIHtcbiAgICAgICAgcHJvZ3Jlc3NCYXIgPSAoPFByb2dyZXNzQmFyIHBlcmNlbnQ9e3BhcnNlSW50KHF1ZXJ5LnByb2dyZXNzLnRvRml4ZWQoMCksIDEwKX0gc3RyaXBlZC8+KTtcbiAgICB9XG4gICAgY29uc3QgcHJvZ3Jlc3NNc2cgPSBxdWVyeT8uZXh0cmE/LnByb2dyZXNzID8/IG51bGw7XG4gICAgcmV0dXJuICg8UmVzdWx0bGVzc1N0eWxlcz5cbiAgICAgIDxkaXY+eyFwcm9ncmVzc0JhciAmJiA8TG9hZGluZyBwb3NpdGlvbj1cIm5vcm1hbFwiLz59PC9kaXY+XG4gICAgICB7Lyogc2hvdyBsb2FkaW5nIGJhciB3aGVuZXZlciBwcm9ncmVzcyBiYXIgaXMgY29tcGxldGVkIGJ1dCBuZWVkcyB0aW1lIHRvIHJlbmRlciAqL31cbiAgICAgIDxkaXY+e3F1ZXJ5LnByb2dyZXNzID09PSAxMDAgJiYgPExvYWRpbmcgcG9zaXRpb249XCJub3JtYWxcIi8+fTwvZGl2PlxuICAgICAgPFF1ZXJ5U3RhdGVMYWJlbCBxdWVyeT17cXVlcnl9Lz5cbiAgICAgIDxkaXY+e3Byb2dyZXNzTXNnICYmIDxBbGVydCB0eXBlPVwic3VjY2Vzc1wiIG1lc3NhZ2U9e3Byb2dyZXNzTXNnfS8+fTwvZGl2PlxuICAgICAgPGRpdj57cXVlcnkucHJvZ3Jlc3MgIT09IDEwMCAmJiBwcm9ncmVzc0Jhcn08L2Rpdj5cbiAgICAgIHt0cmFja2luZ1VybCAmJiA8ZGl2Pnt0cmFja2luZ1VybH08L2Rpdj59XG4gICAgPC9SZXN1bHRsZXNzU3R5bGVzPik7XG59O1xuZXhwb3J0IGRlZmF1bHQgUmVzdWx0U2V0O1xuIl19 */\"), onClick: () => popSelectStar(tempSchema, tempTable) },\n      t('Query in a new tab')),\n\n      ___EmotionJSX(ExploreCtasResultsButton, { table: tempTable, schema: tempSchema, dbId: exploreDBId }))) }));\n\n\n\n  }\n  if (query.state === QueryState.SUCCESS && query.results) {\n    const { results } = query;\n    // Accounts for offset needed for height of ResultSetRowsReturned component if !limitReached\n    const rowMessageHeight = !limitReached ? 32 : 0;\n    // Accounts for offset needed for height of Alert if this.state.alertIsOpen\n    const alertContainerHeight = 70;\n    // We need to calculate the height of this.renderRowsReturned()\n    // if we want results panel to be proper height because the\n    // FilterTable component needs an explicit height to render\n    // the Table component\n    const rowsHeight = alertIsOpen ?\n    height - alertContainerHeight :\n    height - rowMessageHeight;\n    let data;\n    if (cache && query.cached) {\n      data = cachedData;\n    } else\n    if (results != null && results.data) {\n      ({ data } = results);\n    }\n    if (data && data.length > 0) {\n      const expandedColumns = results.expanded_columns ?\n      results.expanded_columns.map((col) => col.column_name) :\n      [];\n      return ___EmotionJSX(ResultContainer, null,\n      renderControls(),\n      renderRowsReturned(),\n      sql,\n      ___EmotionJSX(FilterableTable, { data: data, orderedColumnKeys: results.columns.map((col) => col.column_name), height: rowsHeight, filterText: searchText, expandedColumns: expandedColumns }));\n\n    }\n    if (data && data.length === 0) {\n      return ___EmotionJSX(Alert, { type: \"warning\", message: t('The query returned no data') });\n    }\n  }\n  if (query.cached || query.state === QueryState.SUCCESS && !query.results) {\n    if (query.isDataPreview) {\n      return ___EmotionJSX(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => dispatch(reFetchQueryResults({\n          ...query,\n          isDataPreview: true })) },\n\n      t('Fetch data preview'));\n\n    }\n    if (query.resultsKey) {\n      return ___EmotionJSX(Button, { buttonSize: \"small\", buttonStyle: \"primary\", onClick: () => fetchResults(query) },\n      t('Refetch results'));\n\n    }\n  }\n  let progressBar;\n  if (query.progress > 0) {\n    progressBar = ___EmotionJSX(ProgressBar, { percent: parseInt(query.progress.toFixed(0), 10), striped: true });\n  }\n  const progressMsg = (_query$extra$progress = query == null ? void 0 : (_query$extra = query.extra) == null ? void 0 : _query$extra.progress) != null ? _query$extra$progress : null;\n  return ___EmotionJSX(ResultlessStyles, null,\n  ___EmotionJSX(\"div\", null, !progressBar && ___EmotionJSX(Loading, { position: \"normal\" })),\n\n  ___EmotionJSX(\"div\", null, query.progress === 100 && ___EmotionJSX(Loading, { position: \"normal\" })),\n  ___EmotionJSX(QueryStateLabel, { query: query }),\n  ___EmotionJSX(\"div\", null, progressMsg && ___EmotionJSX(Alert, { type: \"success\", message: progressMsg })),\n  ___EmotionJSX(\"div\", null, query.progress !== 100 && progressBar),\n  trackingUrl && ___EmotionJSX(\"div\", null, trackingUrl));\n\n};\nexport default ResultSet;","map":{"version":3,"mappings":"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","names":["React","useCallback","useEffect","useState","useDispatch","ButtonGroup","Alert","Button","shortid","QueryState","styled","t","useTheme","usePrevious","ErrorMessageWithStackTrace","SaveDatasetModal","EXPLORE_CHART_DEFAULT","mountExploreUrl","postFormData","ProgressBar","Loading","FilterableTable","CopyToClipboard","addDangerToast","prepareCopyToClipboardTabularData","addQueryEditor","clearQueryResults","CtasEnum","fetchQueryResults","reFetchQueryResults","reRunQuery","URL_PARAMS","ExploreCtasResultsButton","ExploreResultsButton","HighlightedSql","QueryStateLabel","LIMITING_FACTOR","ResultContainer","div","theme","gridUnit","ResultlessStyles","MonospaceDiv","typography","families","monospace","ReturnedRows","sizes","s","ResultSetControls","ResultSetButtons","LimitMessage","span","colors","secondary","light1","ResultSet","cache","csv","database","displayLimit","height","query","search","showSql","visualize","user","defaultQueryLimit","searchText","setSearchText","cachedData","setCachedData","showSaveDatasetModal","setShowSaveDatasetModal","alertIsOpen","setAlertIsOpen","dispatch","reRunQueryIfSessionTimeoutErrorOnMount","errorMessage","indexOf","fetchResults","prevQuery","cached","results","data","length","resultsKey","calculateAlertRefHeight","alertElement","popSelectStar","tempSchema","tempTable","qe","id","generate","name","autorun","dbId","sql","changeSearch","event","target","value","createExploreResultsOnClick","query_id","key","datasource","all_columns","columns","map","column","column_name","url","formDataKey","window","open","getExportCsvUrl","clientId","renderControls","tab","templateParams","schema","allows_virtual_table_explore","renderRowsReturned","rows","queryLimit","limitingFactor","limitMessage","limitReached","displayLimitReached","limit","isAdmin","roles","Admin","rowsCount","Math","min","displayMaxRowsReachedMessage","withAdmin","withoutAdmin","shouldUseDefaultDropdownAlert","DROPDOWN","QUERY","QUERY_AND_DROPDOWN","rowsReturnedMessage","tooltipText","exploreDBId","explore_database_id","trackingUrl","state","SUCCESS","FETCHING","RUNNING","STOPPED","FAILED","errors","undefined","link","ctas","object","ctas_method","VIEW","marginRight","rowMessageHeight","alertContainerHeight","rowsHeight","expandedColumns","expanded_columns","col","isDataPreview","progressBar","progress","parseInt","toFixed","progressMsg","extra"],"sourceRoot":"","sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/src/SqlLab/components/ResultSet/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { useDispatch } from 'react-redux';\nimport ButtonGroup from 'src/components/ButtonGroup';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport shortid from 'shortid';\nimport {\n  QueryResponse,\n  QueryState,\n  styled,\n  t,\n  useTheme,\n  usePrevious,\n} from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport {\n  ISaveableDatasource,\n  ISimpleColumn,\n  SaveDatasetModal,\n} from 'src/SqlLab/components/SaveDatasetModal';\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport { EXPLORE_CHART_DEFAULT } from 'src/SqlLab/types';\nimport { mountExploreUrl } from 'src/explore/exploreUtils';\nimport { postFormData } from 'src/explore/exploreUtils/formData';\nimport ProgressBar from 'src/components/ProgressBar';\nimport Loading from 'src/components/Loading';\nimport FilterableTable from 'src/components/FilterableTable';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport {\n  addQueryEditor,\n  clearQueryResults,\n  CtasEnum,\n  fetchQueryResults,\n  reFetchQueryResults,\n  reRunQuery,\n} from 'src/SqlLab/actions/sqlLab';\nimport { URL_PARAMS } from 'src/constants';\nimport ExploreCtasResultsButton from '../ExploreCtasResultsButton';\nimport ExploreResultsButton from '../ExploreResultsButton';\nimport HighlightedSql from '../HighlightedSql';\nimport QueryStateLabel from '../QueryStateLabel';\n\nenum LIMITING_FACTOR {\n  QUERY = 'QUERY',\n  QUERY_AND_DROPDOWN = 'QUERY_AND_DROPDOWN',\n  DROPDOWN = 'DROPDOWN',\n  NOT_LIMITED = 'NOT_LIMITED',\n}\n\nexport interface ResultSetProps {\n  cache?: boolean;\n  csv?: boolean;\n  database?: Record<string, any>;\n  displayLimit: number;\n  height: number;\n  query: QueryResponse;\n  search?: boolean;\n  showSql?: boolean;\n  visualize?: boolean;\n  user: UserWithPermissionsAndRoles;\n  defaultQueryLimit: number;\n}\n\nconst ResultContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  row-gap: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst ResultlessStyles = styled.div`\n  position: relative;\n  min-height: ${({ theme }) => theme.gridUnit * 25}px;\n  [role='alert'] {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n  .sql-result-track-job {\n    margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  }\n`;\n\n// Making text render line breaks/tabs as is as monospace,\n// but wrapping text too so text doesn't overflow\nconst MonospaceDiv = styled.div`\n  font-family: ${({ theme }) => theme.typography.families.monospace};\n  white-space: pre;\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\n\nconst ReturnedRows = styled.div`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  line-height: ${({ theme }) => theme.gridUnit * 6}px;\n`;\n\nconst ResultSetControls = styled.div`\n  display: flex;\n  justify-content: space-between;\n`;\n\nconst ResultSetButtons = styled.div`\n  display: grid;\n  grid-auto-flow: column;\n  padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n`;\n\nconst LimitMessage = styled.span`\n  color: ${({ theme }) => theme.colors.secondary.light1};\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst ResultSet = ({\n  cache = false,\n  csv = true,\n  database = {},\n  displayLimit,\n  height,\n  query,\n  search = true,\n  showSql = false,\n  visualize = true,\n  user,\n  defaultQueryLimit,\n}: ResultSetProps) => {\n  const theme = useTheme();\n  const [searchText, setSearchText] = useState('');\n  const [cachedData, setCachedData] = useState<Record<string, unknown>[]>([]);\n  const [showSaveDatasetModal, setShowSaveDatasetModal] = useState(false);\n  const [alertIsOpen, setAlertIsOpen] = useState(false);\n\n  const dispatch = useDispatch();\n\n  const reRunQueryIfSessionTimeoutErrorOnMount = useCallback(() => {\n    if (\n      query.errorMessage &&\n      query.errorMessage.indexOf('session timed out') > 0\n    ) {\n      dispatch(reRunQuery(query));\n    }\n  }, []);\n\n  useEffect(() => {\n    // only do this the first time the component is rendered/mounted\n    reRunQueryIfSessionTimeoutErrorOnMount();\n  }, [reRunQueryIfSessionTimeoutErrorOnMount]);\n\n  const fetchResults = (query: QueryResponse) => {\n    dispatch(fetchQueryResults(query, displayLimit));\n  };\n\n  const prevQuery = usePrevious(query);\n  useEffect(() => {\n    if (cache && query.cached && query?.results?.data?.length > 0) {\n      setCachedData(query.results.data);\n      dispatch(clearQueryResults(query));\n    }\n    if (query.resultsKey && query.resultsKey !== prevQuery?.resultsKey) {\n      fetchResults(query);\n    }\n  }, [query, cache]);\n\n  const calculateAlertRefHeight = (alertElement: HTMLElement | null) => {\n    if (alertElement) {\n      setAlertIsOpen(true);\n    } else {\n      setAlertIsOpen(false);\n    }\n  };\n\n  const popSelectStar = (tempSchema: string | null, tempTable: string) => {\n    const qe = {\n      id: shortid.generate(),\n      name: tempTable,\n      autorun: false,\n      dbId: query.dbId,\n      sql: `SELECT * FROM ${tempSchema ? `${tempSchema}.` : ''}${tempTable}`,\n    };\n    dispatch(addQueryEditor(qe));\n  };\n\n  const changeSearch = (event: React.ChangeEvent<HTMLInputElement>) => {\n    setSearchText(event.target.value);\n  };\n\n  const createExploreResultsOnClick = async () => {\n    const { results } = query;\n\n    if (results?.query_id) {\n      const key = await postFormData(results.query_id, 'query', {\n        ...EXPLORE_CHART_DEFAULT,\n        datasource: `${results.query_id}__query`,\n        ...{\n          all_columns: results.columns.map(column => column.column_name),\n        },\n      });\n      const url = mountExploreUrl(null, {\n        [URL_PARAMS.formDataKey.name]: key,\n      });\n      window.open(url, '_blank', 'noreferrer');\n    } else {\n      addDangerToast(t('Unable to create chart without a query id.'));\n    }\n  };\n\n  const getExportCsvUrl = (clientId: string) =>\n    `/api/v1/sqllab/export/${clientId}/`;\n\n  const renderControls = () => {\n    if (search || visualize || csv) {\n      let { data } = query.results;\n      if (cache && query.cached) {\n        data = cachedData;\n      }\n      const { columns } = query.results;\n      // Added compute logic to stop user from being able to Save & Explore\n\n      const datasource: ISaveableDatasource = {\n        columns: query.results.columns as ISimpleColumn[],\n        name: query?.tab || 'Untitled',\n        dbId: query?.dbId,\n        sql: query?.sql,\n        templateParams: query?.templateParams,\n        schema: query?.schema,\n      };\n\n      return (\n        <ResultSetControls>\n          <SaveDatasetModal\n            visible={showSaveDatasetModal}\n            onHide={() => setShowSaveDatasetModal(false)}\n            buttonTextOnSave={t('Save & Explore')}\n            buttonTextOnOverwrite={t('Overwrite & Explore')}\n            modalDescription={t(\n              'Save this query as a virtual dataset to continue exploring',\n            )}\n            datasource={datasource}\n          />\n          <ResultSetButtons>\n            {visualize && database?.allows_virtual_table_explore && (\n              <ExploreResultsButton\n                database={database}\n                onClick={createExploreResultsOnClick}\n              />\n            )}\n            {csv && (\n              <Button buttonSize=\"small\" href={getExportCsvUrl(query.id)}>\n                <i className=\"fa fa-file-text-o\" /> {t('Download to CSV')}\n              </Button>\n            )}\n\n            <CopyToClipboard\n              text={prepareCopyToClipboardTabularData(data, columns)}\n              wrapped={false}\n              copyNode={\n                <Button buttonSize=\"small\">\n                  <i className=\"fa fa-clipboard\" /> {t('Copy to Clipboard')}\n                </Button>\n              }\n              hideTooltip\n            />\n          </ResultSetButtons>\n          {search && (\n            <input\n              type=\"text\"\n              onChange={changeSearch}\n              value={searchText}\n              className=\"form-control input-sm\"\n              placeholder={t('Filter results')}\n            />\n          )}\n        </ResultSetControls>\n      );\n    }\n    return <div />;\n  };\n\n  const renderRowsReturned = () => {\n    const { results, rows, queryLimit, limitingFactor } = query;\n    let limitMessage;\n    const limitReached = results?.displayLimitReached;\n    const limit = queryLimit || results.query.limit;\n    const isAdmin = !!user?.roles?.Admin;\n    const rowsCount = Math.min(rows || 0, results?.data?.length || 0);\n\n    const displayMaxRowsReachedMessage = {\n      withAdmin: t(\n        'The number of results displayed is limited to %(rows)d by the configuration DISPLAY_MAX_ROW. ' +\n          'Please add additional limits/filters or download to csv to see more rows up to ' +\n          'the %(limit)d limit.',\n        { rows: rowsCount, limit },\n      ),\n      withoutAdmin: t(\n        'The number of results displayed is limited to %(rows)d. ' +\n          'Please add additional limits/filters, download to csv, or contact an admin ' +\n          'to see more rows up to the %(limit)d limit.',\n        { rows: rowsCount, limit },\n      ),\n    };\n    const shouldUseDefaultDropdownAlert =\n      limit === defaultQueryLimit &&\n      limitingFactor === LIMITING_FACTOR.DROPDOWN;\n\n    if (limitingFactor === LIMITING_FACTOR.QUERY && csv) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the query',\n        { rows },\n      );\n    } else if (\n      limitingFactor === LIMITING_FACTOR.DROPDOWN &&\n      !shouldUseDefaultDropdownAlert\n    ) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the limit dropdown.',\n        { rows },\n      );\n    } else if (limitingFactor === LIMITING_FACTOR.QUERY_AND_DROPDOWN) {\n      limitMessage = t(\n        'The number of rows displayed is limited to %(rows)d by the query and limit dropdown.',\n        { rows },\n      );\n    }\n\n    const rowsReturnedMessage = t('%(rows)d rows returned', {\n      rows,\n    });\n\n    const tooltipText = `${rowsReturnedMessage}. ${limitMessage}`;\n\n    return (\n      <ReturnedRows>\n        {!limitReached && !shouldUseDefaultDropdownAlert && (\n          <span title={tooltipText}>\n            {rowsReturnedMessage}\n            <LimitMessage>{limitMessage}</LimitMessage>\n          </span>\n        )}\n        {!limitReached && shouldUseDefaultDropdownAlert && (\n          <div ref={calculateAlertRefHeight}>\n            <Alert\n              type=\"warning\"\n              message={t('%(rows)d rows returned', { rows })}\n              onClose={() => setAlertIsOpen(false)}\n              description={t(\n                'The number of rows displayed is limited to %(rows)d by the dropdown.',\n                { rows },\n              )}\n            />\n          </div>\n        )}\n        {limitReached && (\n          <div ref={calculateAlertRefHeight}>\n            <Alert\n              type=\"warning\"\n              onClose={() => setAlertIsOpen(false)}\n              message={t('%(rows)d rows returned', { rows: rowsCount })}\n              description={\n                isAdmin\n                  ? displayMaxRowsReachedMessage.withAdmin\n                  : displayMaxRowsReachedMessage.withoutAdmin\n              }\n            />\n          </div>\n        )}\n      </ReturnedRows>\n    );\n  };\n\n  const limitReached = query?.results?.displayLimitReached;\n  let sql;\n  let exploreDBId = query.dbId;\n  if (database?.explore_database_id) {\n    exploreDBId = database.explore_database_id;\n  }\n\n  let trackingUrl;\n  if (\n    query.trackingUrl &&\n    query.state !== QueryState.SUCCESS &&\n    query.state !== QueryState.FETCHING\n  ) {\n    trackingUrl = (\n      <Button\n        className=\"sql-result-track-job\"\n        buttonSize=\"small\"\n        href={query.trackingUrl}\n        target=\"_blank\"\n      >\n        {query.state === QueryState.RUNNING\n          ? t('Track job')\n          : t('See query details')}\n      </Button>\n    );\n  }\n\n  if (showSql) {\n    sql = <HighlightedSql sql={query.sql} />;\n  }\n\n  if (query.state === QueryState.STOPPED) {\n    return <Alert type=\"warning\" message={t('Query was stopped')} />;\n  }\n\n  if (query.state === QueryState.FAILED) {\n    return (\n      <ResultlessStyles>\n        <ErrorMessageWithStackTrace\n          title={t('Database error')}\n          error={query?.errors?.[0]}\n          subtitle={<MonospaceDiv>{query.errorMessage}</MonospaceDiv>}\n          copyText={query.errorMessage || undefined}\n          link={query.link}\n          source=\"sqllab\"\n        />\n        {trackingUrl}\n      </ResultlessStyles>\n    );\n  }\n\n  if (query.state === QueryState.SUCCESS && query.ctas) {\n    const { tempSchema, tempTable } = query;\n    let object = 'Table';\n    if (query.ctas_method === CtasEnum.VIEW) {\n      object = 'View';\n    }\n    return (\n      <div>\n        <Alert\n          type=\"info\"\n          message={\n            <>\n              {t(object)} [\n              <strong>\n                {tempSchema ? `${tempSchema}.` : ''}\n                {tempTable}\n              </strong>\n              ] {t('was created')} &nbsp;\n              <ButtonGroup>\n                <Button\n                  buttonSize=\"small\"\n                  css={{ marginRight: theme.gridUnit }}\n                  onClick={() => popSelectStar(tempSchema, tempTable)}\n                >\n                  {t('Query in a new tab')}\n                </Button>\n                <ExploreCtasResultsButton\n                  table={tempTable}\n                  schema={tempSchema}\n                  dbId={exploreDBId}\n                />\n              </ButtonGroup>\n            </>\n          }\n        />\n      </div>\n    );\n  }\n\n  if (query.state === QueryState.SUCCESS && query.results) {\n    const { results } = query;\n    // Accounts for offset needed for height of ResultSetRowsReturned component if !limitReached\n    const rowMessageHeight = !limitReached ? 32 : 0;\n    // Accounts for offset needed for height of Alert if this.state.alertIsOpen\n    const alertContainerHeight = 70;\n    // We need to calculate the height of this.renderRowsReturned()\n    // if we want results panel to be proper height because the\n    // FilterTable component needs an explicit height to render\n    // the Table component\n    const rowsHeight = alertIsOpen\n      ? height - alertContainerHeight\n      : height - rowMessageHeight;\n    let data;\n    if (cache && query.cached) {\n      data = cachedData;\n    } else if (results?.data) {\n      ({ data } = results);\n    }\n    if (data && data.length > 0) {\n      const expandedColumns = results.expanded_columns\n        ? results.expanded_columns.map(col => col.column_name)\n        : [];\n      return (\n        <ResultContainer>\n          {renderControls()}\n          {renderRowsReturned()}\n          {sql}\n          <FilterableTable\n            data={data}\n            orderedColumnKeys={results.columns.map(col => col.column_name)}\n            height={rowsHeight}\n            filterText={searchText}\n            expandedColumns={expandedColumns}\n          />\n        </ResultContainer>\n      );\n    }\n    if (data && data.length === 0) {\n      return <Alert type=\"warning\" message={t('The query returned no data')} />;\n    }\n  }\n\n  if (query.cached || (query.state === QueryState.SUCCESS && !query.results)) {\n    if (query.isDataPreview) {\n      return (\n        <Button\n          buttonSize=\"small\"\n          buttonStyle=\"primary\"\n          onClick={() =>\n            dispatch(\n              reFetchQueryResults({\n                ...query,\n                isDataPreview: true,\n              }),\n            )\n          }\n        >\n          {t('Fetch data preview')}\n        </Button>\n      );\n    }\n    if (query.resultsKey) {\n      return (\n        <Button\n          buttonSize=\"small\"\n          buttonStyle=\"primary\"\n          onClick={() => fetchResults(query)}\n        >\n          {t('Refetch results')}\n        </Button>\n      );\n    }\n  }\n\n  let progressBar;\n  if (query.progress > 0) {\n    progressBar = (\n      <ProgressBar percent={parseInt(query.progress.toFixed(0), 10)} striped />\n    );\n  }\n\n  const progressMsg = query?.extra?.progress ?? null;\n\n  return (\n    <ResultlessStyles>\n      <div>{!progressBar && <Loading position=\"normal\" />}</div>\n      {/* show loading bar whenever progress bar is completed but needs time to render */}\n      <div>{query.progress === 100 && <Loading position=\"normal\" />}</div>\n      <QueryStateLabel query={query} />\n      <div>{progressMsg && <Alert type=\"success\" message={progressMsg} />}</div>\n      <div>{query.progress !== 100 && progressBar}</div>\n      {trackingUrl && <div>{trackingUrl}</div>}\n    </ResultlessStyles>\n  );\n};\n\nexport default ResultSet;\n"]},"metadata":{},"sourceType":"module"}