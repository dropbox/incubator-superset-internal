{"ast":null,"code":"import _isEqual from \"lodash/isEqual\"; /* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/no-access-state-in-setstate */\n/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\n\nimport PropTypes from 'prop-types';\nimport { SupersetClient } from '@superset-ui/core';\n\nimport { DeckGLContainerStyledWrapper } from '../DeckGLContainer';\nimport { getExploreLongUrl } from '../utils/explore';\nimport layerGenerators from '../layers';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  formData: PropTypes.object.isRequired,\n  payload: PropTypes.object.isRequired,\n  setControlValue: PropTypes.func.isRequired,\n  viewport: PropTypes.object.isRequired,\n  onAddFilter: PropTypes.func,\n  onSelect: PropTypes.func };\n\nconst defaultProps = {\n  onAddFilter() {},\n  onSelect() {} };\n\n\nclass DeckMulti extends React.PureComponent {\n\n\n  constructor(props) {\n    super(props);this.containerRef = /*#__PURE__*/React.createRef();this.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    setTooltip = (tooltip) => {\n      const { current } = this.containerRef;\n      if (current) {\n        current.setTooltip(tooltip);\n      }\n    };this.state = { subSlicesLayers: {} };this.onViewportChange = this.onViewportChange.bind(this);}componentDidMount() {const { formData, payload } = this.props;this.loadLayers(formData, payload);}UNSAFE_componentWillReceiveProps(nextProps) {const { formData, payload } = nextProps;const hasChanges = !_isEqual(this.props.formData.deck_slices, nextProps.formData.deck_slices);if (hasChanges) {this.loadLayers(formData, payload);}}onViewportChange(viewport) {this.setState({ viewport });}loadLayers(formData, payload, viewport) {this.setState({ subSlicesLayers: {}, viewport });payload.data.slices.forEach((subslice) => {// Filters applied to multi_deck are passed down to underlying charts\n      // note that dashboard contextual information (filter_immune_slices and such) aren't\n      // taken into consideration here\n      const filters = [...(subslice.form_data.filters || []), ...(formData.filters || []), ...(formData.extra_filters || [])];const subsliceCopy = { ...subslice, form_data: { ...subslice.form_data, filters } };SupersetClient.get({ endpoint: getExploreLongUrl(subsliceCopy.form_data, 'json') }).then((_ref) => {let { json } = _ref;const layer = layerGenerators[subsliceCopy.form_data.viz_type](subsliceCopy.form_data, json, this.props.onAddFilter, this.setTooltip, [], this.props.onSelect);this.setState({ subSlicesLayers: { ...this.state.subSlicesLayers, [subsliceCopy.slice_id]: layer } });}).catch(() => {});});}render() {const { payload, formData, setControlValue, height, width } = this.props;\n    const { subSlicesLayers } = this.state;\n\n    const layers = Object.values(subSlicesLayers);\n\n    return (\n      ___EmotionJSX(DeckGLContainerStyledWrapper, {\n        ref: this.containerRef,\n        mapboxApiAccessToken: payload.data.mapboxApiKey,\n        viewport: this.state.viewport || this.props.viewport,\n        layers: layers,\n        mapStyle: formData.mapbox_style,\n        setControlValue: setControlValue,\n        onViewportChange: this.onViewportChange,\n        height: height,\n        width: width }));\n\n\n  }}\n\n\nDeckMulti.propTypes = propTypes;\nDeckMulti.defaultProps = defaultProps;\n\nexport default DeckMulti;","map":{"version":3,"names":["React","PropTypes","SupersetClient","DeckGLContainerStyledWrapper","getExploreLongUrl","layerGenerators","propTypes","formData","object","isRequired","payload","setControlValue","func","viewport","onAddFilter","onSelect","defaultProps","DeckMulti","PureComponent","constructor","props","containerRef","createRef","setTooltip","tooltip","current","state","subSlicesLayers","onViewportChange","bind","componentDidMount","loadLayers","UNSAFE_componentWillReceiveProps","nextProps","hasChanges","deck_slices","setState","data","slices","forEach","subslice","filters","form_data","extra_filters","subsliceCopy","get","endpoint","then","json","layer","viz_type","slice_id","catch","render","height","width","layers","Object","values","mapboxApiKey","mapbox_style"],"sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/Multi/Multi.jsx"],"sourcesContent":["/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/no-access-state-in-setstate */\n/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport _ from 'lodash';\nimport PropTypes from 'prop-types';\nimport { SupersetClient } from '@superset-ui/core';\n\nimport { DeckGLContainerStyledWrapper } from '../DeckGLContainer';\nimport { getExploreLongUrl } from '../utils/explore';\nimport layerGenerators from '../layers';\n\nconst propTypes = {\n  formData: PropTypes.object.isRequired,\n  payload: PropTypes.object.isRequired,\n  setControlValue: PropTypes.func.isRequired,\n  viewport: PropTypes.object.isRequired,\n  onAddFilter: PropTypes.func,\n  onSelect: PropTypes.func,\n};\nconst defaultProps = {\n  onAddFilter() {},\n  onSelect() {},\n};\n\nclass DeckMulti extends React.PureComponent {\n  containerRef = React.createRef();\n\n  constructor(props) {\n    super(props);\n    this.state = { subSlicesLayers: {} };\n    this.onViewportChange = this.onViewportChange.bind(this);\n  }\n\n  componentDidMount() {\n    const { formData, payload } = this.props;\n    this.loadLayers(formData, payload);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const { formData, payload } = nextProps;\n    const hasChanges = !_.isEqual(\n      this.props.formData.deck_slices,\n      nextProps.formData.deck_slices,\n    );\n    if (hasChanges) {\n      this.loadLayers(formData, payload);\n    }\n  }\n\n  onViewportChange(viewport) {\n    this.setState({ viewport });\n  }\n\n  loadLayers(formData, payload, viewport) {\n    this.setState({ subSlicesLayers: {}, viewport });\n    payload.data.slices.forEach(subslice => {\n      // Filters applied to multi_deck are passed down to underlying charts\n      // note that dashboard contextual information (filter_immune_slices and such) aren't\n      // taken into consideration here\n      const filters = [\n        ...(subslice.form_data.filters || []),\n        ...(formData.filters || []),\n        ...(formData.extra_filters || []),\n      ];\n      const subsliceCopy = {\n        ...subslice,\n        form_data: {\n          ...subslice.form_data,\n          filters,\n        },\n      };\n\n      SupersetClient.get({\n        endpoint: getExploreLongUrl(subsliceCopy.form_data, 'json'),\n      })\n        .then(({ json }) => {\n          const layer = layerGenerators[subsliceCopy.form_data.viz_type](\n            subsliceCopy.form_data,\n            json,\n            this.props.onAddFilter,\n            this.setTooltip,\n            [],\n            this.props.onSelect,\n          );\n          this.setState({\n            subSlicesLayers: {\n              ...this.state.subSlicesLayers,\n              [subsliceCopy.slice_id]: layer,\n            },\n          });\n        })\n        .catch(() => {});\n    });\n  }\n\n  setTooltip = tooltip => {\n    const { current } = this.containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  };\n\n  render() {\n    const { payload, formData, setControlValue, height, width } = this.props;\n    const { subSlicesLayers } = this.state;\n\n    const layers = Object.values(subSlicesLayers);\n\n    return (\n      <DeckGLContainerStyledWrapper\n        ref={this.containerRef}\n        mapboxApiAccessToken={payload.data.mapboxApiKey}\n        viewport={this.state.viewport || this.props.viewport}\n        layers={layers}\n        mapStyle={formData.mapbox_style}\n        setControlValue={setControlValue}\n        onViewportChange={this.onViewportChange}\n        height={height}\n        width={width}\n      />\n    );\n  }\n}\n\nDeckMulti.propTypes = propTypes;\nDeckMulti.defaultProps = defaultProps;\n\nexport default DeckMulti;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}