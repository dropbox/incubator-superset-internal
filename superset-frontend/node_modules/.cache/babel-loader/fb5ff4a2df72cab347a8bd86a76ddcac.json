{"ast":null,"code":"import { css as _css } from \"@emotion/react\";import _extends from \"@babel/runtime-corejs3/helpers/extends\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { forwardRef, useCallback, useImperativeHandle, useState } from 'react';\nimport ReactDOM from 'react-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Behavior, ensureIsArray, FeatureFlag, getChartMetadataRegistry, isFeatureEnabled, t, useTheme } from '@superset-ui/core';\nimport { findPermission } from 'src/utils/findPermission';\nimport { Menu } from 'src/components/Menu';\nimport { AntdDropdown as Dropdown } from 'src/components/index';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { DrillDetailMenuItems } from '../DrillDetail';\nimport { getMenuAdjustedY } from '../utils';\nimport { MenuItemTooltip } from '../DisabledMenuItemTooltip';\nimport { DrillByMenuItems } from '../DrillBy/DrillByMenuItems';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nexport var ContextMenuItem;\n(function (ContextMenuItem) {\n  ContextMenuItem[ContextMenuItem[\"CrossFilter\"] = 0] = \"CrossFilter\";\n  ContextMenuItem[ContextMenuItem[\"DrillToDetail\"] = 1] = \"DrillToDetail\";\n  ContextMenuItem[ContextMenuItem[\"DrillBy\"] = 2] = \"DrillBy\";\n  ContextMenuItem[ContextMenuItem[\"All\"] = 3] = \"All\";\n})(ContextMenuItem || (ContextMenuItem = {}));\nconst ChartContextMenu = (_ref, ref) => {var _getChartMetadataRegi, _getChartMetadataRegi2;let { id, formData, onSelection, onClose, displayedItems = ContextMenuItem.All, additionalConfig } = _ref;\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const canExplore = useSelector((state) => {var _state$user;return findPermission('can_explore', 'Superset', (_state$user = state.user) == null ? void 0 : _state$user.roles);});\n  const crossFiltersEnabled = useSelector((_ref2) => {let { dashboardInfo } = _ref2;return dashboardInfo.crossFiltersEnabled;});\n  const isDisplayed = (item) => {var _context;return displayedItems === ContextMenuItem.All ||\n    _includesInstanceProperty(_context = ensureIsArray(displayedItems)).call(_context, item);};\n  const [{ filters, clientX, clientY }, setState] = useState({ clientX: 0, clientY: 0 });\n  const menuItems = [];\n  const showDrillToDetail = isFeatureEnabled(FeatureFlag.DRILL_TO_DETAIL) &&\n  canExplore &&\n  isDisplayed(ContextMenuItem.DrillToDetail);\n  const showDrillBy = isFeatureEnabled(FeatureFlag.DRILL_BY) &&\n  canExplore &&\n  isDisplayed(ContextMenuItem.DrillBy);\n  const showCrossFilters = isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n  isDisplayed(ContextMenuItem.CrossFilter);\n  const isCrossFilteringSupportedByChart = (_getChartMetadataRegi = getChartMetadataRegistry().\n  get(formData.viz_type)) == null ? void 0 : (_getChartMetadataRegi2 = _getChartMetadataRegi.\n  behaviors) == null ? void 0 : _includesInstanceProperty(_getChartMetadataRegi2).call(_getChartMetadataRegi2, Behavior.INTERACTIVE_CHART);\n  let itemsCount = 0;\n  if (showCrossFilters) {\n    itemsCount += 1;\n  }\n  if (showDrillToDetail) {\n    itemsCount += 2; // Drill to detail always has 2 top-level menu items\n  }\n  if (showDrillBy) {\n    itemsCount += 1;\n  }\n  if (itemsCount === 0) {\n    itemsCount = 1; // \"No actions\" appears if no actions in menu\n  }\n  if (showCrossFilters) {var _filters$crossFilter;\n    const isCrossFilterDisabled = !isCrossFilteringSupportedByChart ||\n    !crossFiltersEnabled ||\n    !(filters != null && filters.crossFilter);\n    let crossFilteringTooltipTitle = null;\n    if (!isCrossFilterDisabled) {\n      crossFilteringTooltipTitle = ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"div\", null,\n      t('Cross-filter will be applied to all of the charts that use this dataset.')),\n\n      ___EmotionJSX(\"div\", null,\n      t('You can also just click on the chart to apply cross-filter.')));\n\n\n    } else\n    if (!crossFiltersEnabled) {\n      crossFilteringTooltipTitle = ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"div\", null, t('Cross-filtering is not enabled for this dashboard.')));\n\n    } else\n    if (!isCrossFilteringSupportedByChart) {\n      crossFilteringTooltipTitle = ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"div\", null,\n      t('This visualization type does not support cross-filtering.')));\n\n\n    } else\n    if (!(filters != null && filters.crossFilter)) {\n      crossFilteringTooltipTitle = ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"div\", null, t(`You can't apply cross-filter on this data point.`)));\n\n    }\n    menuItems.push(___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(Menu.Item, { key: \"cross-filtering-menu-item\", disabled: isCrossFilterDisabled, onClick: () => {\n        if (filters != null && filters.crossFilter) {\n          dispatch(updateDataMask(id, filters.crossFilter.dataMask));\n        }\n      } },\n    filters != null && (_filters$crossFilter = filters.crossFilter) != null && _filters$crossFilter.isCurrentValueSelected ? t('Remove cross-filter') : ___EmotionJSX(\"div\", null,\n    t('Add cross-filter'),\n    ___EmotionJSX(MenuItemTooltip, { title: crossFilteringTooltipTitle, color: !isCrossFilterDisabled ?\n      theme.colors.grayscale.base :\n      undefined }))),\n\n\n    itemsCount > 1 && ___EmotionJSX(Menu.Divider, null)));\n\n  }\n  if (showDrillToDetail) {\n    menuItems.push(___EmotionJSX(DrillDetailMenuItems, _extends({ chartId: id, formData: formData, filters: filters == null ? void 0 : filters.drillToDetail, isContextMenu: true, contextMenuY: clientY, onSelection: onSelection, submenuIndex: showCrossFilters ? 2 : 1 }, (additionalConfig == null ? void 0 : additionalConfig.drillToDetail) || {})));\n  }\n  if (showDrillBy) {\n    let submenuIndex = 0;\n    if (showCrossFilters) {\n      submenuIndex += 1;\n    }\n    if (showDrillToDetail) {\n      submenuIndex += 2;\n    }\n    menuItems.push(___EmotionJSX(DrillByMenuItems, _extends({ drillByConfig: filters == null ? void 0 : filters.drillBy, onSelection: onSelection, formData: formData, contextMenuY: clientY, submenuIndex: submenuIndex }, (additionalConfig == null ? void 0 : additionalConfig.drillBy) || {})));\n  }\n  const open = useCallback((clientX, clientY, filters) => {var _document$getElementB;\n    const adjustedY = getMenuAdjustedY(clientY, itemsCount);\n    setState({\n      clientX,\n      clientY: adjustedY,\n      filters });\n\n    // Since Ant Design's Dropdown does not offer an imperative API\n    // and we can't attach event triggers to charts SVG elements, we\n    // use a hidden span that gets clicked on when receiving click events\n    // from the charts.\n    (_document$getElementB = document.getElementById(`hidden-span-${id}`)) == null ? void 0 : _document$getElementB.click();\n  }, [id, itemsCount]);\n  useImperativeHandle(ref, () => ({\n    open }),\n  [open]);\n  return /*#__PURE__*/ReactDOM.createPortal(___EmotionJSX(Dropdown, { overlay: ___EmotionJSX(Menu, { className: \"chart-context-menu\", \"data-test\": \"chart-context-menu\" },\n    menuItems.length ? menuItems : ___EmotionJSX(Menu.Item, { disabled: true }, \"No actions\")),\n    trigger: ['click'], onVisibleChange: (value) => !value && onClose() },\n  ___EmotionJSX(\"span\", { id: `hidden-span-${id}`, css: /*#__PURE__*/_css({\n      visibility: 'hidden',\n      position: 'fixed',\n      top: clientY,\n      left: clientX,\n      width: 1,\n      height: 1 }, process.env.NODE_ENV === \"production\" ? \"\" : \";label:ChartContextMenu;\", process.env.NODE_ENV === \"production\" ? \"\" : \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9ib2dkYW5reXJ5bGl1ay9jb2RlL29wZW5zb3VyY2Uvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2NvbXBvbmVudHMvQ2hhcnQvQ2hhcnRDb250ZXh0TWVudS9DaGFydENvbnRleHRNZW51LnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFzSnFDIiwiZmlsZSI6Ii9Vc2Vycy9ib2dkYW5reXJ5bGl1ay9jb2RlL29wZW5zb3VyY2Uvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2NvbXBvbmVudHMvQ2hhcnQvQ2hhcnRDb250ZXh0TWVudS9DaGFydENvbnRleHRNZW51LnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCBSZWFjdCwgeyBmb3J3YXJkUmVmLCB1c2VDYWxsYmFjaywgdXNlSW1wZXJhdGl2ZUhhbmRsZSwgdXNlU3RhdGUsIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFJlYWN0RE9NIGZyb20gJ3JlYWN0LWRvbSc7XG5pbXBvcnQgeyB1c2VEaXNwYXRjaCwgdXNlU2VsZWN0b3IgfSBmcm9tICdyZWFjdC1yZWR1eCc7XG5pbXBvcnQgeyBCZWhhdmlvciwgZW5zdXJlSXNBcnJheSwgRmVhdHVyZUZsYWcsIGdldENoYXJ0TWV0YWRhdGFSZWdpc3RyeSwgaXNGZWF0dXJlRW5hYmxlZCwgdCwgdXNlVGhlbWUsIH0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuaW1wb3J0IHsgZmluZFBlcm1pc3Npb24gfSBmcm9tICdzcmMvdXRpbHMvZmluZFBlcm1pc3Npb24nO1xuaW1wb3J0IHsgTWVudSB9IGZyb20gJ3NyYy9jb21wb25lbnRzL01lbnUnO1xuaW1wb3J0IHsgQW50ZERyb3Bkb3duIGFzIERyb3Bkb3duIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvaW5kZXgnO1xuaW1wb3J0IHsgdXBkYXRlRGF0YU1hc2sgfSBmcm9tICdzcmMvZGF0YU1hc2svYWN0aW9ucyc7XG5pbXBvcnQgeyBEcmlsbERldGFpbE1lbnVJdGVtcyB9IGZyb20gJy4uL0RyaWxsRGV0YWlsJztcbmltcG9ydCB7IGdldE1lbnVBZGp1c3RlZFkgfSBmcm9tICcuLi91dGlscyc7XG5pbXBvcnQgeyBNZW51SXRlbVRvb2x0aXAgfSBmcm9tICcuLi9EaXNhYmxlZE1lbnVJdGVtVG9vbHRpcCc7XG5pbXBvcnQgeyBEcmlsbEJ5TWVudUl0ZW1zIH0gZnJvbSAnLi4vRHJpbGxCeS9EcmlsbEJ5TWVudUl0ZW1zJztcbmV4cG9ydCB2YXIgQ29udGV4dE1lbnVJdGVtO1xuKGZ1bmN0aW9uIChDb250ZXh0TWVudUl0ZW0pIHtcbiAgICBDb250ZXh0TWVudUl0ZW1bQ29udGV4dE1lbnVJdGVtW1wiQ3Jvc3NGaWx0ZXJcIl0gPSAwXSA9IFwiQ3Jvc3NGaWx0ZXJcIjtcbiAgICBDb250ZXh0TWVudUl0ZW1bQ29udGV4dE1lbnVJdGVtW1wiRHJpbGxUb0RldGFpbFwiXSA9IDFdID0gXCJEcmlsbFRvRGV0YWlsXCI7XG4gICAgQ29udGV4dE1lbnVJdGVtW0NvbnRleHRNZW51SXRlbVtcIkRyaWxsQnlcIl0gPSAyXSA9IFwiRHJpbGxCeVwiO1xuICAgIENvbnRleHRNZW51SXRlbVtDb250ZXh0TWVudUl0ZW1bXCJBbGxcIl0gPSAzXSA9IFwiQWxsXCI7XG59KShDb250ZXh0TWVudUl0ZW0gfHwgKENvbnRleHRNZW51SXRlbSA9IHt9KSk7XG5jb25zdCBDaGFydENvbnRleHRNZW51ID0gKHsgaWQsIGZvcm1EYXRhLCBvblNlbGVjdGlvbiwgb25DbG9zZSwgZGlzcGxheWVkSXRlbXMgPSBDb250ZXh0TWVudUl0ZW0uQWxsLCBhZGRpdGlvbmFsQ29uZmlnLCB9LCByZWYpID0+IHtcbiAgICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKCk7XG4gICAgY29uc3QgZGlzcGF0Y2ggPSB1c2VEaXNwYXRjaCgpO1xuICAgIGNvbnN0IGNhbkV4cGxvcmUgPSB1c2VTZWxlY3Rvcigoc3RhdGUpID0+IGZpbmRQZXJtaXNzaW9uKCdjYW5fZXhwbG9yZScsICdTdXBlcnNldCcsIHN0YXRlLnVzZXI/LnJvbGVzKSk7XG4gICAgY29uc3QgY3Jvc3NGaWx0ZXJzRW5hYmxlZCA9IHVzZVNlbGVjdG9yKCh7IGRhc2hib2FyZEluZm8gfSkgPT4gZGFzaGJvYXJkSW5mby5jcm9zc0ZpbHRlcnNFbmFibGVkKTtcbiAgICBjb25zdCBpc0Rpc3BsYXllZCA9IChpdGVtKSA9PiBkaXNwbGF5ZWRJdGVtcyA9PT0gQ29udGV4dE1lbnVJdGVtLkFsbCB8fFxuICAgICAgICBlbnN1cmVJc0FycmF5KGRpc3BsYXllZEl0ZW1zKS5pbmNsdWRlcyhpdGVtKTtcbiAgICBjb25zdCBbeyBmaWx0ZXJzLCBjbGllbnRYLCBjbGllbnRZIH0sIHNldFN0YXRlXSA9IHVzZVN0YXRlKHsgY2xpZW50WDogMCwgY2xpZW50WTogMCB9KTtcbiAgICBjb25zdCBtZW51SXRlbXMgPSBbXTtcbiAgICBjb25zdCBzaG93RHJpbGxUb0RldGFpbCA9IGlzRmVhdHVyZUVuYWJsZWQoRmVhdHVyZUZsYWcuRFJJTExfVE9fREVUQUlMKSAmJlxuICAgICAgICBjYW5FeHBsb3JlICYmXG4gICAgICAgIGlzRGlzcGxheWVkKENvbnRleHRNZW51SXRlbS5EcmlsbFRvRGV0YWlsKTtcbiAgICBjb25zdCBzaG93RHJpbGxCeSA9IGlzRmVhdHVyZUVuYWJsZWQoRmVhdHVyZUZsYWcuRFJJTExfQlkpICYmXG4gICAgICAgIGNhbkV4cGxvcmUgJiZcbiAgICAgICAgaXNEaXNwbGF5ZWQoQ29udGV4dE1lbnVJdGVtLkRyaWxsQnkpO1xuICAgIGNvbnN0IHNob3dDcm9zc0ZpbHRlcnMgPSBpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkRBU0hCT0FSRF9DUk9TU19GSUxURVJTKSAmJlxuICAgICAgICBpc0Rpc3BsYXllZChDb250ZXh0TWVudUl0ZW0uQ3Jvc3NGaWx0ZXIpO1xuICAgIGNvbnN0IGlzQ3Jvc3NGaWx0ZXJpbmdTdXBwb3J0ZWRCeUNoYXJ0ID0gZ2V0Q2hhcnRNZXRhZGF0YVJlZ2lzdHJ5KClcbiAgICAgICAgLmdldChmb3JtRGF0YS52aXpfdHlwZSlcbiAgICAgICAgPy5iZWhhdmlvcnM/LmluY2x1ZGVzKEJlaGF2aW9yLklOVEVSQUNUSVZFX0NIQVJUKTtcbiAgICBsZXQgaXRlbXNDb3VudCA9IDA7XG4gICAgaWYgKHNob3dDcm9zc0ZpbHRlcnMpIHtcbiAgICAgICAgaXRlbXNDb3VudCArPSAxO1xuICAgIH1cbiAgICBpZiAoc2hvd0RyaWxsVG9EZXRhaWwpIHtcbiAgICAgICAgaXRlbXNDb3VudCArPSAyOyAvLyBEcmlsbCB0byBkZXRhaWwgYWx3YXlzIGhhcyAyIHRvcC1sZXZlbCBtZW51IGl0ZW1zXG4gICAgfVxuICAgIGlmIChzaG93RHJpbGxCeSkge1xuICAgICAgICBpdGVtc0NvdW50ICs9IDE7XG4gICAgfVxuICAgIGlmIChpdGVtc0NvdW50ID09PSAwKSB7XG4gICAgICAgIGl0ZW1zQ291bnQgPSAxOyAvLyBcIk5vIGFjdGlvbnNcIiBhcHBlYXJzIGlmIG5vIGFjdGlvbnMgaW4gbWVudVxuICAgIH1cbiAgICBpZiAoc2hvd0Nyb3NzRmlsdGVycykge1xuICAgICAgICBjb25zdCBpc0Nyb3NzRmlsdGVyRGlzYWJsZWQgPSAhaXNDcm9zc0ZpbHRlcmluZ1N1cHBvcnRlZEJ5Q2hhcnQgfHxcbiAgICAgICAgICAgICFjcm9zc0ZpbHRlcnNFbmFibGVkIHx8XG4gICAgICAgICAgICAhZmlsdGVycz8uY3Jvc3NGaWx0ZXI7XG4gICAgICAgIGxldCBjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZSA9IG51bGw7XG4gICAgICAgIGlmICghaXNDcm9zc0ZpbHRlckRpc2FibGVkKSB7XG4gICAgICAgICAgICBjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZSA9ICg8PlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICB7dCgnQ3Jvc3MtZmlsdGVyIHdpbGwgYmUgYXBwbGllZCB0byBhbGwgb2YgdGhlIGNoYXJ0cyB0aGF0IHVzZSB0aGlzIGRhdGFzZXQuJyl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPGRpdj5cbiAgICAgICAgICAgIHt0KCdZb3UgY2FuIGFsc28ganVzdCBjbGljayBvbiB0aGUgY2hhcnQgdG8gYXBwbHkgY3Jvc3MtZmlsdGVyLicpfVxuICAgICAgICAgIDwvZGl2PlxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2UgaWYgKCFjcm9zc0ZpbHRlcnNFbmFibGVkKSB7XG4gICAgICAgICAgICBjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZSA9ICg8PlxuICAgICAgICAgIDxkaXY+e3QoJ0Nyb3NzLWZpbHRlcmluZyBpcyBub3QgZW5hYmxlZCBmb3IgdGhpcyBkYXNoYm9hcmQuJyl9PC9kaXY+XG4gICAgICAgIDwvPik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWlzQ3Jvc3NGaWx0ZXJpbmdTdXBwb3J0ZWRCeUNoYXJ0KSB7XG4gICAgICAgICAgICBjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZSA9ICg8PlxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICB7dCgnVGhpcyB2aXN1YWxpemF0aW9uIHR5cGUgZG9lcyBub3Qgc3VwcG9ydCBjcm9zcy1maWx0ZXJpbmcuJyl9XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvPik7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIWZpbHRlcnM/LmNyb3NzRmlsdGVyKSB7XG4gICAgICAgICAgICBjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZSA9ICg8PlxuICAgICAgICAgIDxkaXY+e3QoYFlvdSBjYW4ndCBhcHBseSBjcm9zcy1maWx0ZXIgb24gdGhpcyBkYXRhIHBvaW50LmApfTwvZGl2PlxuICAgICAgICA8Lz4pO1xuICAgICAgICB9XG4gICAgICAgIG1lbnVJdGVtcy5wdXNoKDw+XG4gICAgICAgIDxNZW51Lkl0ZW0ga2V5PVwiY3Jvc3MtZmlsdGVyaW5nLW1lbnUtaXRlbVwiIGRpc2FibGVkPXtpc0Nyb3NzRmlsdGVyRGlzYWJsZWR9IG9uQ2xpY2s9eygpID0+IHtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVycz8uY3Jvc3NGaWx0ZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlzcGF0Y2godXBkYXRlRGF0YU1hc2soaWQsIGZpbHRlcnMuY3Jvc3NGaWx0ZXIuZGF0YU1hc2spKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9fT5cbiAgICAgICAgICB7ZmlsdGVycz8uY3Jvc3NGaWx0ZXI/LmlzQ3VycmVudFZhbHVlU2VsZWN0ZWQgPyAodCgnUmVtb3ZlIGNyb3NzLWZpbHRlcicpKSA6ICg8ZGl2PlxuICAgICAgICAgICAgICB7dCgnQWRkIGNyb3NzLWZpbHRlcicpfVxuICAgICAgICAgICAgICA8TWVudUl0ZW1Ub29sdGlwIHRpdGxlPXtjcm9zc0ZpbHRlcmluZ1Rvb2x0aXBUaXRsZX0gY29sb3I9eyFpc0Nyb3NzRmlsdGVyRGlzYWJsZWRcbiAgICAgICAgICAgICAgICAgICAgPyB0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmJhc2VcbiAgICAgICAgICAgICAgICAgICAgOiB1bmRlZmluZWR9Lz5cbiAgICAgICAgICAgIDwvZGl2Pil9XG4gICAgICAgIDwvTWVudS5JdGVtPlxuICAgICAgICB7aXRlbXNDb3VudCA+IDEgJiYgPE1lbnUuRGl2aWRlciAvPn1cbiAgICAgIDwvPik7XG4gICAgfVxuICAgIGlmIChzaG93RHJpbGxUb0RldGFpbCkge1xuICAgICAgICBtZW51SXRlbXMucHVzaCg8RHJpbGxEZXRhaWxNZW51SXRlbXMgY2hhcnRJZD17aWR9IGZvcm1EYXRhPXtmb3JtRGF0YX0gZmlsdGVycz17ZmlsdGVycz8uZHJpbGxUb0RldGFpbH0gaXNDb250ZXh0TWVudSBjb250ZXh0TWVudVk9e2NsaWVudFl9IG9uU2VsZWN0aW9uPXtvblNlbGVjdGlvbn0gc3VibWVudUluZGV4PXtzaG93Q3Jvc3NGaWx0ZXJzID8gMiA6IDF9IHsuLi4oYWRkaXRpb25hbENvbmZpZz8uZHJpbGxUb0RldGFpbCB8fCB7fSl9Lz4pO1xuICAgIH1cbiAgICBpZiAoc2hvd0RyaWxsQnkpIHtcbiAgICAgICAgbGV0IHN1Ym1lbnVJbmRleCA9IDA7XG4gICAgICAgIGlmIChzaG93Q3Jvc3NGaWx0ZXJzKSB7XG4gICAgICAgICAgICBzdWJtZW51SW5kZXggKz0gMTtcbiAgICAgICAgfVxuICAgICAgICBpZiAoc2hvd0RyaWxsVG9EZXRhaWwpIHtcbiAgICAgICAgICAgIHN1Ym1lbnVJbmRleCArPSAyO1xuICAgICAgICB9XG4gICAgICAgIG1lbnVJdGVtcy5wdXNoKDxEcmlsbEJ5TWVudUl0ZW1zIGRyaWxsQnlDb25maWc9e2ZpbHRlcnM/LmRyaWxsQnl9IG9uU2VsZWN0aW9uPXtvblNlbGVjdGlvbn0gZm9ybURhdGE9e2Zvcm1EYXRhfSBjb250ZXh0TWVudVk9e2NsaWVudFl9IHN1Ym1lbnVJbmRleD17c3VibWVudUluZGV4fSB7Li4uKGFkZGl0aW9uYWxDb25maWc/LmRyaWxsQnkgfHwge30pfS8+KTtcbiAgICB9XG4gICAgY29uc3Qgb3BlbiA9IHVzZUNhbGxiYWNrKChjbGllbnRYLCBjbGllbnRZLCBmaWx0ZXJzKSA9PiB7XG4gICAgICAgIGNvbnN0IGFkanVzdGVkWSA9IGdldE1lbnVBZGp1c3RlZFkoY2xpZW50WSwgaXRlbXNDb3VudCk7XG4gICAgICAgIHNldFN0YXRlKHtcbiAgICAgICAgICAgIGNsaWVudFgsXG4gICAgICAgICAgICBjbGllbnRZOiBhZGp1c3RlZFksXG4gICAgICAgICAgICBmaWx0ZXJzLFxuICAgICAgICB9KTtcbiAgICAgICAgLy8gU2luY2UgQW50IERlc2lnbidzIERyb3Bkb3duIGRvZXMgbm90IG9mZmVyIGFuIGltcGVyYXRpdmUgQVBJXG4gICAgICAgIC8vIGFuZCB3ZSBjYW4ndCBhdHRhY2ggZXZlbnQgdHJpZ2dlcnMgdG8gY2hhcnRzIFNWRyBlbGVtZW50cywgd2VcbiAgICAgICAgLy8gdXNlIGEgaGlkZGVuIHNwYW4gdGhhdCBnZXRzIGNsaWNrZWQgb24gd2hlbiByZWNlaXZpbmcgY2xpY2sgZXZlbnRzXG4gICAgICAgIC8vIGZyb20gdGhlIGNoYXJ0cy5cbiAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYGhpZGRlbi1zcGFuLSR7aWR9YCk/LmNsaWNrKCk7XG4gICAgfSwgW2lkLCBpdGVtc0NvdW50XSk7XG4gICAgdXNlSW1wZXJhdGl2ZUhhbmRsZShyZWYsICgpID0+ICh7XG4gICAgICAgIG9wZW4sXG4gICAgfSksIFtvcGVuXSk7XG4gICAgcmV0dXJuIFJlYWN0RE9NLmNyZWF0ZVBvcnRhbCg8RHJvcGRvd24gb3ZlcmxheT17PE1lbnUgY2xhc3NOYW1lPVwiY2hhcnQtY29udGV4dC1tZW51XCIgZGF0YS10ZXN0PVwiY2hhcnQtY29udGV4dC1tZW51XCI+XG4gICAgICAgICAge21lbnVJdGVtcy5sZW5ndGggPyAobWVudUl0ZW1zKSA6ICg8TWVudS5JdGVtIGRpc2FibGVkPk5vIGFjdGlvbnM8L01lbnUuSXRlbT4pfVxuICAgICAgICA8L01lbnU+fSB0cmlnZ2VyPXtbJ2NsaWNrJ119IG9uVmlzaWJsZUNoYW5nZT17dmFsdWUgPT4gIXZhbHVlICYmIG9uQ2xvc2UoKX0+XG4gICAgICA8c3BhbiBpZD17YGhpZGRlbi1zcGFuLSR7aWR9YH0gY3NzPXt7XG4gICAgICAgICAgICB2aXNpYmlsaXR5OiAnaGlkZGVuJyxcbiAgICAgICAgICAgIHBvc2l0aW9uOiAnZml4ZWQnLFxuICAgICAgICAgICAgdG9wOiBjbGllbnRZLFxuICAgICAgICAgICAgbGVmdDogY2xpZW50WCxcbiAgICAgICAgICAgIHdpZHRoOiAxLFxuICAgICAgICAgICAgaGVpZ2h0OiAxLFxuICAgICAgICB9fS8+XG4gICAgPC9Ecm9wZG93bj4sIGRvY3VtZW50LmJvZHkpO1xufTtcbmV4cG9ydCBkZWZhdWx0IGZvcndhcmRSZWYoQ2hhcnRDb250ZXh0TWVudSk7XG4iXX0= */\") })),\n\n  document.body);\n};__signature__(ChartContextMenu, \"useTheme{theme}\\nuseDispatch{dispatch}\\nuseSelector{canExplore}\\nuseSelector{crossFiltersEnabled}\\nuseState{[{ filters, clientX, clientY }, setState]({ clientX: 0, clientY: 0 })}\\nuseCallback{open}\\nuseImperativeHandle{}\", () => [useTheme, useDispatch, useSelector, useSelector, useImperativeHandle]);const _default = /*#__PURE__*/\nforwardRef(ChartContextMenu);export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(ContextMenuItem, \"ContextMenuItem\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx\");reactHotLoader.register(ChartContextMenu, \"ChartContextMenu\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx\");reactHotLoader.register(_default, \"default\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"mappings":"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","names":["React","forwardRef","useCallback","useImperativeHandle","useState","ReactDOM","useDispatch","useSelector","Behavior","ensureIsArray","FeatureFlag","getChartMetadataRegistry","isFeatureEnabled","t","useTheme","findPermission","Menu","AntdDropdown","Dropdown","updateDataMask","DrillDetailMenuItems","getMenuAdjustedY","MenuItemTooltip","DrillByMenuItems","ContextMenuItem","ChartContextMenu","ref","id","formData","onSelection","onClose","displayedItems","All","additionalConfig","theme","dispatch","canExplore","state","user","roles","crossFiltersEnabled","dashboardInfo","isDisplayed","item","filters","clientX","clientY","setState","menuItems","showDrillToDetail","DRILL_TO_DETAIL","DrillToDetail","showDrillBy","DRILL_BY","DrillBy","showCrossFilters","DASHBOARD_CROSS_FILTERS","CrossFilter","isCrossFilteringSupportedByChart","get","viz_type","behaviors","INTERACTIVE_CHART","itemsCount","isCrossFilterDisabled","crossFilter","crossFilteringTooltipTitle","push","dataMask","isCurrentValueSelected","colors","grayscale","base","undefined","drillToDetail","submenuIndex","drillBy","open","adjustedY","getElementById","click","createPortal","length","value","visibility","position","top","left","width","height","document","body"],"sourceRoot":"","sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/components/Chart/ChartContextMenu/ChartContextMenu.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  forwardRef,\n  ReactNode,\n  RefObject,\n  useCallback,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport ReactDOM from 'react-dom';\nimport { useDispatch, useSelector } from 'react-redux';\nimport {\n  Behavior,\n  ContextMenuFilters,\n  ensureIsArray,\n  FeatureFlag,\n  getChartMetadataRegistry,\n  isFeatureEnabled,\n  QueryFormData,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport { RootState } from 'src/dashboard/types';\nimport { findPermission } from 'src/utils/findPermission';\nimport { Menu } from 'src/components/Menu';\nimport { AntdDropdown as Dropdown } from 'src/components/index';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { DrillDetailMenuItems } from '../DrillDetail';\nimport { getMenuAdjustedY } from '../utils';\nimport { MenuItemTooltip } from '../DisabledMenuItemTooltip';\nimport { DrillByMenuItems } from '../DrillBy/DrillByMenuItems';\n\nexport enum ContextMenuItem {\n  CrossFilter,\n  DrillToDetail,\n  DrillBy,\n  All,\n}\nexport interface ChartContextMenuProps {\n  id: number;\n  formData: QueryFormData;\n  onSelection: () => void;\n  onClose: () => void;\n  additionalConfig?: {\n    crossFilter?: Record<string, any>;\n    drillToDetail?: Record<string, any>;\n    drillBy?: Record<string, any>;\n  };\n  displayedItems?: ContextMenuItem[] | ContextMenuItem;\n}\n\nexport interface ChartContextMenuRef {\n  open: (\n    clientX: number,\n    clientY: number,\n    filters?: ContextMenuFilters,\n  ) => void;\n}\n\nconst ChartContextMenu = (\n  {\n    id,\n    formData,\n    onSelection,\n    onClose,\n    displayedItems = ContextMenuItem.All,\n    additionalConfig,\n  }: ChartContextMenuProps,\n  ref: RefObject<ChartContextMenuRef>,\n) => {\n  const theme = useTheme();\n  const dispatch = useDispatch();\n  const canExplore = useSelector((state: RootState) =>\n    findPermission('can_explore', 'Superset', state.user?.roles),\n  );\n  const crossFiltersEnabled = useSelector<RootState, boolean>(\n    ({ dashboardInfo }) => dashboardInfo.crossFiltersEnabled,\n  );\n\n  const isDisplayed = (item: ContextMenuItem) =>\n    displayedItems === ContextMenuItem.All ||\n    ensureIsArray(displayedItems).includes(item);\n\n  const [{ filters, clientX, clientY }, setState] = useState<{\n    clientX: number;\n    clientY: number;\n    filters?: ContextMenuFilters;\n  }>({ clientX: 0, clientY: 0 });\n\n  const menuItems = [];\n\n  const showDrillToDetail =\n    isFeatureEnabled(FeatureFlag.DRILL_TO_DETAIL) &&\n    canExplore &&\n    isDisplayed(ContextMenuItem.DrillToDetail);\n\n  const showDrillBy =\n    isFeatureEnabled(FeatureFlag.DRILL_BY) &&\n    canExplore &&\n    isDisplayed(ContextMenuItem.DrillBy);\n\n  const showCrossFilters =\n    isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n    isDisplayed(ContextMenuItem.CrossFilter);\n\n  const isCrossFilteringSupportedByChart = getChartMetadataRegistry()\n    .get(formData.viz_type)\n    ?.behaviors?.includes(Behavior.INTERACTIVE_CHART);\n\n  let itemsCount = 0;\n  if (showCrossFilters) {\n    itemsCount += 1;\n  }\n  if (showDrillToDetail) {\n    itemsCount += 2; // Drill to detail always has 2 top-level menu items\n  }\n  if (showDrillBy) {\n    itemsCount += 1;\n  }\n  if (itemsCount === 0) {\n    itemsCount = 1; // \"No actions\" appears if no actions in menu\n  }\n\n  if (showCrossFilters) {\n    const isCrossFilterDisabled =\n      !isCrossFilteringSupportedByChart ||\n      !crossFiltersEnabled ||\n      !filters?.crossFilter;\n\n    let crossFilteringTooltipTitle: ReactNode = null;\n    if (!isCrossFilterDisabled) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>\n            {t(\n              'Cross-filter will be applied to all of the charts that use this dataset.',\n            )}\n          </div>\n          <div>\n            {t('You can also just click on the chart to apply cross-filter.')}\n          </div>\n        </>\n      );\n    } else if (!crossFiltersEnabled) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>{t('Cross-filtering is not enabled for this dashboard.')}</div>\n        </>\n      );\n    } else if (!isCrossFilteringSupportedByChart) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>\n            {t('This visualization type does not support cross-filtering.')}\n          </div>\n        </>\n      );\n    } else if (!filters?.crossFilter) {\n      crossFilteringTooltipTitle = (\n        <>\n          <div>{t(`You can't apply cross-filter on this data point.`)}</div>\n        </>\n      );\n    }\n    menuItems.push(\n      <>\n        <Menu.Item\n          key=\"cross-filtering-menu-item\"\n          disabled={isCrossFilterDisabled}\n          onClick={() => {\n            if (filters?.crossFilter) {\n              dispatch(updateDataMask(id, filters.crossFilter.dataMask));\n            }\n          }}\n        >\n          {filters?.crossFilter?.isCurrentValueSelected ? (\n            t('Remove cross-filter')\n          ) : (\n            <div>\n              {t('Add cross-filter')}\n              <MenuItemTooltip\n                title={crossFilteringTooltipTitle}\n                color={\n                  !isCrossFilterDisabled\n                    ? theme.colors.grayscale.base\n                    : undefined\n                }\n              />\n            </div>\n          )}\n        </Menu.Item>\n        {itemsCount > 1 && <Menu.Divider />}\n      </>,\n    );\n  }\n  if (showDrillToDetail) {\n    menuItems.push(\n      <DrillDetailMenuItems\n        chartId={id}\n        formData={formData}\n        filters={filters?.drillToDetail}\n        isContextMenu\n        contextMenuY={clientY}\n        onSelection={onSelection}\n        submenuIndex={showCrossFilters ? 2 : 1}\n        {...(additionalConfig?.drillToDetail || {})}\n      />,\n    );\n  }\n  if (showDrillBy) {\n    let submenuIndex = 0;\n    if (showCrossFilters) {\n      submenuIndex += 1;\n    }\n    if (showDrillToDetail) {\n      submenuIndex += 2;\n    }\n    menuItems.push(\n      <DrillByMenuItems\n        drillByConfig={filters?.drillBy}\n        onSelection={onSelection}\n        formData={formData}\n        contextMenuY={clientY}\n        submenuIndex={submenuIndex}\n        {...(additionalConfig?.drillBy || {})}\n      />,\n    );\n  }\n\n  const open = useCallback(\n    (clientX: number, clientY: number, filters?: ContextMenuFilters) => {\n      const adjustedY = getMenuAdjustedY(clientY, itemsCount);\n      setState({\n        clientX,\n        clientY: adjustedY,\n        filters,\n      });\n\n      // Since Ant Design's Dropdown does not offer an imperative API\n      // and we can't attach event triggers to charts SVG elements, we\n      // use a hidden span that gets clicked on when receiving click events\n      // from the charts.\n      document.getElementById(`hidden-span-${id}`)?.click();\n    },\n    [id, itemsCount],\n  );\n\n  useImperativeHandle(\n    ref,\n    () => ({\n      open,\n    }),\n    [open],\n  );\n\n  return ReactDOM.createPortal(\n    <Dropdown\n      overlay={\n        <Menu className=\"chart-context-menu\" data-test=\"chart-context-menu\">\n          {menuItems.length ? (\n            menuItems\n          ) : (\n            <Menu.Item disabled>No actions</Menu.Item>\n          )}\n        </Menu>\n      }\n      trigger={['click']}\n      onVisibleChange={value => !value && onClose()}\n    >\n      <span\n        id={`hidden-span-${id}`}\n        css={{\n          visibility: 'hidden',\n          position: 'fixed',\n          top: clientY,\n          left: clientX,\n          width: 1,\n          height: 1,\n        }}\n      />\n    </Dropdown>,\n    document.body,\n  );\n};\n\nexport default forwardRef(ChartContextMenu);\n"]},"metadata":{},"sourceType":"module"}