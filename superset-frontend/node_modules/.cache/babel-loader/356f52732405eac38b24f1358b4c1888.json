{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable no-param-reassign, react/sort-prop-types */\nimport d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport {\ngetNumberFormatter,\nCategoricalColorNamespace } from\n'@superset-ui/core';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    matrix: PropTypes.arrayOf(PropTypes.arrayOf(PropTypes.number)),\n    nodes: PropTypes.arrayOf(PropTypes.string) }),\n\n  width: PropTypes.number,\n  height: PropTypes.number,\n  colorScheme: PropTypes.string,\n  numberFormat: PropTypes.string };\n\n\nfunction Chord(element, props) {\n  const { data, width, height, numberFormat, colorScheme, sliceId } = props;\n\n  element.innerHTML = '';\n\n  const div = d3.select(element);\n  div.classed('superset-legacy-chart-chord', true);\n  const { nodes, matrix } = data;\n  const f = getNumberFormatter(numberFormat);\n  const colorFn = CategoricalColorNamespace.getScale(colorScheme);\n\n  const outerRadius = Math.min(width, height) / 2 - 10;\n  const innerRadius = outerRadius - 24;\n\n  let chord;\n\n  const arc = d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius);\n\n  const layout = d3.layout.\n  chord().\n  padding(0.04).\n  sortSubgroups(d3.descending).\n  sortChords(d3.descending);\n\n  const path = d3.svg.chord().radius(innerRadius);\n\n  const svg = div.\n  append('svg').\n  attr('width', width).\n  attr('height', height).\n  on('mouseout', () => chord.classed('fade', false)).\n  append('g').\n  attr('id', 'circle').\n  attr('transform', `translate(${width / 2}, ${height / 2})`);\n\n  svg.append('circle').attr('r', outerRadius);\n\n  // Compute the chord layout.\n  layout.matrix(matrix);\n\n  const group = svg.\n  selectAll('.group').\n  data(layout.groups).\n  enter().\n  append('g').\n  attr('class', 'group').\n  on('mouseover', (d, i) => {\n    chord.classed('fade', (p) => p.source.index !== i && p.target.index !== i);\n  });\n\n  // Add a mouseover title.\n  group.append('title').text((d, i) => `${nodes[i]}: ${f(d.value)}`);\n\n  // Add the group arc.\n  const groupPath = group.\n  append('path').\n  attr('id', (d, i) => `group${i}`).\n  attr('d', arc).\n  style('fill', (d, i) => colorFn(nodes[i], sliceId));\n\n  // Add a text label.\n  const groupText = group.append('text').attr('x', 6).attr('dy', 15);\n\n  groupText.\n  append('textPath').\n  attr('xlink:href', (d, i) => `#group${i}`).\n  text((d, i) => nodes[i]);\n  // Remove the labels that don't fit. :(\n  groupText.\n  filter(function filter(d, i) {\n    return (\n      groupPath[0][i].getTotalLength() / 2 - 16 < this.getComputedTextLength());\n\n  }).\n  remove();\n\n  // Add the chords.\n  chord = svg.\n  selectAll('.chord').\n  data(layout.chords).\n  enter().\n  append('path').\n  attr('class', 'chord').\n  on('mouseover', (d) => {\n    chord.classed('fade', (p) => p !== d);\n  }).\n  style('fill', (d) => colorFn(nodes[d.source.index], sliceId)).\n  attr('d', path);\n\n  // Add an elaborate mouseover title for each chord.\n  chord.\n  append('title').\n  text(\n  (d) =>\n  `${nodes[d.source.index]} → ${nodes[d.target.index]}: ${f(\n  d.source.value)\n  }\\n${nodes[d.target.index]} → ${nodes[d.source.index]}: ${f(\n  d.target.value)\n  }`);\n\n}\n\nChord.displayName = 'Chord';\nChord.propTypes = propTypes;\n\nexport default Chord;","map":{"version":3,"names":["d3","PropTypes","getNumberFormatter","CategoricalColorNamespace","propTypes","data","shape","matrix","arrayOf","number","nodes","string","width","height","colorScheme","numberFormat","Chord","element","props","sliceId","innerHTML","div","select","classed","f","colorFn","getScale","outerRadius","Math","min","innerRadius","chord","arc","svg","layout","padding","sortSubgroups","descending","sortChords","path","radius","append","attr","on","group","selectAll","groups","enter","d","i","p","source","index","target","text","value","groupPath","style","groupText","filter","getTotalLength","getComputedTextLength","remove","chords","displayName"],"sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/plugins/legacy-plugin-chart-chord/src/Chord.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable no-param-reassign, react/sort-prop-types */\nimport d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport {\n  getNumberFormatter,\n  CategoricalColorNamespace,\n} from '@superset-ui/core';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    matrix: PropTypes.arrayOf(PropTypes.arrayOf(PropTypes.number)),\n    nodes: PropTypes.arrayOf(PropTypes.string),\n  }),\n  width: PropTypes.number,\n  height: PropTypes.number,\n  colorScheme: PropTypes.string,\n  numberFormat: PropTypes.string,\n};\n\nfunction Chord(element, props) {\n  const { data, width, height, numberFormat, colorScheme, sliceId } = props;\n\n  element.innerHTML = '';\n\n  const div = d3.select(element);\n  div.classed('superset-legacy-chart-chord', true);\n  const { nodes, matrix } = data;\n  const f = getNumberFormatter(numberFormat);\n  const colorFn = CategoricalColorNamespace.getScale(colorScheme);\n\n  const outerRadius = Math.min(width, height) / 2 - 10;\n  const innerRadius = outerRadius - 24;\n\n  let chord;\n\n  const arc = d3.svg.arc().innerRadius(innerRadius).outerRadius(outerRadius);\n\n  const layout = d3.layout\n    .chord()\n    .padding(0.04)\n    .sortSubgroups(d3.descending)\n    .sortChords(d3.descending);\n\n  const path = d3.svg.chord().radius(innerRadius);\n\n  const svg = div\n    .append('svg')\n    .attr('width', width)\n    .attr('height', height)\n    .on('mouseout', () => chord.classed('fade', false))\n    .append('g')\n    .attr('id', 'circle')\n    .attr('transform', `translate(${width / 2}, ${height / 2})`);\n\n  svg.append('circle').attr('r', outerRadius);\n\n  // Compute the chord layout.\n  layout.matrix(matrix);\n\n  const group = svg\n    .selectAll('.group')\n    .data(layout.groups)\n    .enter()\n    .append('g')\n    .attr('class', 'group')\n    .on('mouseover', (d, i) => {\n      chord.classed('fade', p => p.source.index !== i && p.target.index !== i);\n    });\n\n  // Add a mouseover title.\n  group.append('title').text((d, i) => `${nodes[i]}: ${f(d.value)}`);\n\n  // Add the group arc.\n  const groupPath = group\n    .append('path')\n    .attr('id', (d, i) => `group${i}`)\n    .attr('d', arc)\n    .style('fill', (d, i) => colorFn(nodes[i], sliceId));\n\n  // Add a text label.\n  const groupText = group.append('text').attr('x', 6).attr('dy', 15);\n\n  groupText\n    .append('textPath')\n    .attr('xlink:href', (d, i) => `#group${i}`)\n    .text((d, i) => nodes[i]);\n  // Remove the labels that don't fit. :(\n  groupText\n    .filter(function filter(d, i) {\n      return (\n        groupPath[0][i].getTotalLength() / 2 - 16 < this.getComputedTextLength()\n      );\n    })\n    .remove();\n\n  // Add the chords.\n  chord = svg\n    .selectAll('.chord')\n    .data(layout.chords)\n    .enter()\n    .append('path')\n    .attr('class', 'chord')\n    .on('mouseover', d => {\n      chord.classed('fade', p => p !== d);\n    })\n    .style('fill', d => colorFn(nodes[d.source.index], sliceId))\n    .attr('d', path);\n\n  // Add an elaborate mouseover title for each chord.\n  chord\n    .append('title')\n    .text(\n      d =>\n        `${nodes[d.source.index]} → ${nodes[d.target.index]}: ${f(\n          d.source.value,\n        )}\\n${nodes[d.target.index]} → ${nodes[d.source.index]}: ${f(\n          d.target.value,\n        )}`,\n    );\n}\n\nChord.displayName = 'Chord';\nChord.propTypes = propTypes;\n\nexport default Chord;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}