{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable func-names, react/sort-prop-types */\nimport d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport 'd3-svg-legend';\nimport d3tip from 'd3-tip';\nimport {\ngetColumnLabel,\ngetMetricLabel,\ngetNumberFormatter,\nNumberFormats,\ngetSequentialSchemeRegistry } from\n'@superset-ui/core';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    records: PropTypes.arrayOf(\n    PropTypes.shape({\n      x: PropTypes.string,\n      y: PropTypes.string,\n      v: PropTypes.number,\n      perc: PropTypes.number,\n      rank: PropTypes.number })),\n\n\n    extents: PropTypes.arrayOf(PropTypes.number) }),\n\n  width: PropTypes.number,\n  height: PropTypes.number,\n  bottomMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  colorScheme: PropTypes.string,\n  columnX: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  columnY: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  leftMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  metric: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  normalized: PropTypes.bool,\n  valueFormatter: PropTypes.object,\n  showLegend: PropTypes.bool,\n  showPercentage: PropTypes.bool,\n  showValues: PropTypes.bool,\n  sortXAxis: PropTypes.string,\n  sortYAxis: PropTypes.string,\n  xScaleInterval: PropTypes.number,\n  yScaleInterval: PropTypes.number,\n  yAxisBounds: PropTypes.arrayOf(PropTypes.number) };\n\n\nfunction cmp(a, b) {\n  return a > b ? 1 : -1;\n}\n\nconst DEFAULT_PROPERTIES = {\n  minChartWidth: 150,\n  minChartHeight: 150,\n  marginLeft: 35,\n  marginBottom: 35,\n  marginTop: 10,\n  marginRight: 10 };\n\n\n// Inspired from http://bl.ocks.org/mbostock/3074470\n// https://jsfiddle.net/cyril123/h0reyumq/\nfunction Heatmap(element, props) {\n  const {\n    data,\n    width,\n    height,\n    bottomMargin,\n    canvasImageRendering,\n    colorScheme,\n    columnX,\n    columnY,\n    leftMargin,\n    metric,\n    normalized,\n    valueFormatter,\n    showLegend,\n    showPercentage,\n    showValues,\n    sortXAxis,\n    sortYAxis,\n    xScaleInterval,\n    yScaleInterval,\n    yAxisBounds,\n    xAxisFormatter,\n    yAxisFormatter } =\n  props;\n\n  const { extents } = data;\n  const records = data.records.map((record) => ({\n    ...record,\n    x: xAxisFormatter(record.x),\n    y: yAxisFormatter(record.y) }));\n\n\n  const margin = {\n    top: 10,\n    right: 10,\n    bottom: 35,\n    left: 35 };\n\n\n  let showY = true;\n  let showX = true;\n  const pixelsPerCharX = 4.5; // approx, depends on font size\n  let pixelsPerCharY = 6; // approx, depends on font size\n\n  // Dynamically adjusts  based on max x / y category lengths\n  function adjustMargins() {\n    let longestX = 1;\n    let longestY = 1;\n\n    records.forEach((datum) => {\n      if (typeof datum.y === 'number') pixelsPerCharY = 7;\n      longestX = Math.max(\n      longestX,\n      datum.x && datum.x.toString().length || 1);\n\n      longestY = Math.max(\n      longestY,\n      datum.y && datum.y.toString().length || 1);\n\n    });\n\n    if (leftMargin === 'auto') {\n      margin.left = Math.ceil(Math.max(margin.left, pixelsPerCharY * longestY));\n    } else {\n      margin.left = leftMargin;\n    }\n\n    if (showLegend) {\n      margin.right += 40;\n    }\n\n    margin.bottom =\n    bottomMargin === 'auto' ?\n    Math.ceil(Math.max(margin.bottom, pixelsPerCharX * longestX)) :\n    bottomMargin;\n  }\n\n  // Check if x axis \"x\" position is outside of the container and rotate labels 90deg\n  function checkLabelPosition(container) {\n    const xAxisNode = container.select('.x.axis').node();\n\n    if (!xAxisNode) {\n      return;\n    }\n\n    if (\n    xAxisNode.getBoundingClientRect().x + 4 <\n    container.node().getBoundingClientRect().x)\n    {\n      container.\n      selectAll('.x.axis').\n      selectAll('text').\n      attr('transform', 'rotate(-90)').\n      attr('x', -6).\n      attr('y', 0).\n      attr('dy', '0.3em');\n    }\n  }\n\n  function ordScale(k, rangeBands, sortMethod) {\n    let domain = {};\n    const actualKeys = {}; // hack to preserve type of keys when number\n    records.forEach((d) => {\n      domain[d[k]] = (domain[d[k]] || 0) + d.v;\n      actualKeys[d[k]] = d[k];\n    });\n    // Not using object.keys() as it converts to strings\n    const keys = Object.keys(actualKeys).map((s) => actualKeys[s]);\n    if (sortMethod === 'alpha_asc') {\n      domain = keys.sort(cmp);\n    } else if (sortMethod === 'alpha_desc') {\n      domain = keys.sort(cmp).reverse();\n    } else if (sortMethod === 'value_desc') {\n      domain = Object.keys(domain).sort((a, b) =>\n      domain[a] > domain[b] ? -1 : 1);\n\n    } else if (sortMethod === 'value_asc') {\n      domain = Object.keys(domain).sort((a, b) =>\n      domain[b] > domain[a] ? -1 : 1);\n\n    }\n\n    if (k === 'y' && rangeBands) {\n      domain.reverse();\n    }\n\n    if (rangeBands) {\n      return d3.scale.ordinal().domain(domain).rangeBands(rangeBands);\n    }\n\n    return d3.scale.ordinal().domain(domain).range(d3.range(domain.length));\n  }\n\n  // eslint-disable-next-line no-param-reassign\n  element.innerHTML = '';\n  const matrix = {};\n\n  adjustMargins();\n\n  let hmWidth = width - (margin.left + margin.right);\n  let hmHeight = height - (margin.bottom + margin.top);\n  const hideYLabel = () => {\n    margin.left =\n    leftMargin === 'auto' ? DEFAULT_PROPERTIES.marginLeft : leftMargin;\n    hmWidth = width - (margin.left + margin.right);\n    showY = false;\n  };\n\n  const hideXLabel = () => {\n    margin.bottom =\n    bottomMargin === 'auto' ? DEFAULT_PROPERTIES.marginBottom : bottomMargin;\n    hmHeight = height - (margin.bottom + margin.top);\n    showX = false;\n  };\n\n  // Hide Y Labels\n  if (hmWidth < DEFAULT_PROPERTIES.minChartWidth) {\n    hideYLabel();\n  }\n\n  // Hide X Labels\n  if (\n  hmHeight < DEFAULT_PROPERTIES.minChartHeight ||\n  hmWidth < DEFAULT_PROPERTIES.minChartWidth)\n  {\n    hideXLabel();\n  }\n\n  if (showY && hmHeight < DEFAULT_PROPERTIES.minChartHeight) {\n    hideYLabel();\n  }\n\n  const fp = getNumberFormatter(NumberFormats.PERCENT);\n\n  const xScale = ordScale('x', null, sortXAxis);\n  const yScale = ordScale('y', null, sortYAxis);\n  const xRbScale = ordScale('x', [0, hmWidth], sortXAxis);\n  const yRbScale = ordScale('y', [hmHeight, 0], sortYAxis);\n  const X = 0;\n  const Y = 1;\n  const heatmapDim = [xRbScale.domain().length, yRbScale.domain().length];\n\n  const minBound = yAxisBounds[0] || 0;\n  const maxBound = yAxisBounds[1] || 1;\n  const colorScale = getSequentialSchemeRegistry().\n  get(colorScheme).\n  createLinearScale([minBound, maxBound]);\n\n  const scale = [\n  d3.scale.linear().domain([0, heatmapDim[X]]).range([0, hmWidth]),\n  d3.scale.linear().domain([0, heatmapDim[Y]]).range([0, hmHeight])];\n\n\n  const container = d3.select(element);\n  container.classed('superset-legacy-chart-heatmap', true);\n\n  const canvas = container.\n  append('canvas').\n  attr('width', heatmapDim[X]).\n  attr('height', heatmapDim[Y]).\n  style('width', `${hmWidth}px`).\n  style('height', `${hmHeight}px`).\n  style('image-rendering', canvasImageRendering).\n  style('left', `${margin.left}px`).\n  style('top', `${margin.top}px`).\n  style('position', 'absolute');\n\n  const svg = container.\n  append('svg').\n  attr('width', width).\n  attr('height', height).\n  attr('class', 'heatmap-container').\n  style('position', 'relative');\n\n  if (showValues) {\n    const cells = svg.\n    selectAll('rect').\n    data(records).\n    enter().\n    append('g').\n    attr('transform', `translate(${margin.left}, ${margin.top})`);\n\n    cells.\n    append('text').\n    attr('transform', (d) => `translate(${xRbScale(d.x)}, ${yRbScale(d.y)})`).\n    attr('y', yRbScale.rangeBand() / 2).\n    attr('x', xRbScale.rangeBand() / 2).\n    attr('text-anchor', 'middle').\n    attr('dy', '.35em').\n    text((d) => valueFormatter(d.v)).\n    attr(\n    'font-size',\n    `${Math.min(yRbScale.rangeBand(), xRbScale.rangeBand()) / 3}px`).\n\n    attr('fill', (d) => d.v >= extents[1] / 2 ? 'white' : 'black');\n  }\n\n  if (showLegend) {\n    const colorLegend = d3.legend.\n    color().\n    labelFormat(valueFormatter).\n    scale(colorScale).\n    shapePadding(0).\n    cells(10).\n    shapeWidth(10).\n    shapeHeight(10).\n    labelOffset(3);\n\n    svg.\n    append('g').\n    attr('transform', `translate(${width - 40}, ${margin.top})`).\n    call(colorLegend);\n  }\n\n  const tip = d3tip().\n  attr('class', 'd3-tip').\n  offset(function () {\n    const k = d3.mouse(this);\n    const x = k[0] - hmWidth / 2;\n\n    return [k[1] - 20, x];\n  }).\n  html(function () {\n    let s = '';\n    const k = d3.mouse(this);\n    const m = Math.floor(scale[0].invert(k[0]));\n    const n = Math.floor(scale[1].invert(k[1]));\n    if (m in matrix && n in matrix[m]) {\n      const obj = matrix[m][n];\n      s += `<div><b>${getColumnLabel(columnX)}: </b>${obj.x}<div>`;\n      s += `<div><b>${getColumnLabel(columnY)}: </b>${obj.y}<div>`;\n      s += `<div><b>${getMetricLabel(metric)}: </b>${valueFormatter(\n      obj.v)\n      }<div>`;\n      if (showPercentage) {\n        s += `<div><b>%: </b>${fp(normalized ? obj.rank : obj.perc)}<div>`;\n      }\n      tip.style('display', null);\n    } else {\n      // this is a hack to hide the tooltip because we have map it to a single <rect>\n      // d3-tip toggles opacity and calling hide here is undone by the lib after this call\n      tip.style('display', 'none');\n    }\n\n    return s;\n  });\n\n  const rect = svg.\n  append('g').\n  attr('transform', `translate(${margin.left}, ${margin.top})`).\n  append('rect').\n  classed('background-rect', true).\n  on('mousemove', tip.show).\n  on('mouseout', tip.hide).\n  attr('width', hmWidth).\n  attr('height', hmHeight);\n\n  rect.call(tip);\n\n  if (showX) {\n    const xAxis = d3.svg.\n    axis().\n    scale(xRbScale).\n    outerTickSize(0).\n    tickValues(xRbScale.domain().filter((d, i) => !(i % xScaleInterval))).\n    orient('bottom');\n\n    svg.\n    append('g').\n    attr('class', 'x axis').\n    attr('transform', `translate(${margin.left},${margin.top + hmHeight})`).\n    call(xAxis).\n    selectAll('text').\n    attr('x', -4).\n    attr('y', 10).\n    attr('dy', '0.3em').\n    style('text-anchor', 'end').\n    attr('transform', 'rotate(-45)');\n  }\n\n  if (showY) {\n    const yAxis = d3.svg.\n    axis().\n    scale(yRbScale).\n    outerTickSize(0).\n    tickValues(yRbScale.domain().filter((d, i) => !(i % yScaleInterval))).\n    orient('left');\n\n    svg.\n    append('g').\n    attr('class', 'y axis').\n    attr('transform', `translate(${margin.left},${margin.top})`).\n    call(yAxis);\n  }\n\n  checkLabelPosition(container);\n  const context = canvas.node().getContext('2d');\n  context.imageSmoothingEnabled = false;\n\n  // Compute the pixel colors; scaled by CSS.\n  function createImageObj() {\n    const imageObj = new Image();\n    const image = context.createImageData(heatmapDim[0], heatmapDim[1]);\n    const pixs = {};\n    records.forEach((d) => {\n      const c = d3.rgb(colorScale(normalized ? d.rank : d.perc));\n      const x = xScale(d.x);\n      const y = yScale(d.y);\n      pixs[x + y * xScale.domain().length] = c;\n      if (matrix[x] === undefined) {\n        matrix[x] = {};\n      }\n      if (matrix[x][y] === undefined) {\n        matrix[x][y] = d;\n      }\n    });\n\n    let p = 0;\n    for (let i = 0; i < heatmapDim[0] * heatmapDim[1]; i += 1) {\n      let c = pixs[i];\n      let alpha = 255;\n      if (c === undefined) {\n        c = d3.rgb('#F00');\n        alpha = 0;\n      }\n      image.data[p + 0] = c.r;\n      image.data[p + 1] = c.g;\n      image.data[p + 2] = c.b;\n      image.data[p + 3] = alpha;\n      p += 4;\n    }\n    context.putImageData(image, 0, 0);\n    imageObj.src = canvas.node().toDataURL();\n  }\n  createImageObj();\n}\n\nHeatmap.displayName = 'Heatmap';\nHeatmap.propTypes = propTypes;\n\nexport default Heatmap;","map":{"version":3,"names":["d3","PropTypes","d3tip","getColumnLabel","getMetricLabel","getNumberFormatter","NumberFormats","getSequentialSchemeRegistry","propTypes","data","shape","records","arrayOf","x","string","y","v","number","perc","rank","extents","width","height","bottomMargin","oneOfType","colorScheme","columnX","object","columnY","leftMargin","metric","normalized","bool","valueFormatter","showLegend","showPercentage","showValues","sortXAxis","sortYAxis","xScaleInterval","yScaleInterval","yAxisBounds","cmp","a","b","DEFAULT_PROPERTIES","minChartWidth","minChartHeight","marginLeft","marginBottom","marginTop","marginRight","Heatmap","element","props","canvasImageRendering","xAxisFormatter","yAxisFormatter","map","record","margin","top","right","bottom","left","showY","showX","pixelsPerCharX","pixelsPerCharY","adjustMargins","longestX","longestY","forEach","datum","Math","max","toString","length","ceil","checkLabelPosition","container","xAxisNode","select","node","getBoundingClientRect","selectAll","attr","ordScale","k","rangeBands","sortMethod","domain","actualKeys","d","keys","Object","s","sort","reverse","scale","ordinal","range","innerHTML","matrix","hmWidth","hmHeight","hideYLabel","hideXLabel","fp","PERCENT","xScale","yScale","xRbScale","yRbScale","X","Y","heatmapDim","minBound","maxBound","colorScale","get","createLinearScale","linear","classed","canvas","append","style","svg","cells","enter","rangeBand","text","min","colorLegend","legend","color","labelFormat","shapePadding","shapeWidth","shapeHeight","labelOffset","call","tip","offset","mouse","html","m","floor","invert","n","obj","rect","on","show","hide","xAxis","axis","outerTickSize","tickValues","filter","i","orient","yAxis","context","getContext","imageSmoothingEnabled","createImageObj","imageObj","Image","image","createImageData","pixs","c","rgb","undefined","p","alpha","r","g","putImageData","src","toDataURL","displayName"],"sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable func-names, react/sort-prop-types */\nimport d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport 'd3-svg-legend';\nimport d3tip from 'd3-tip';\nimport {\n  getColumnLabel,\n  getMetricLabel,\n  getNumberFormatter,\n  NumberFormats,\n  getSequentialSchemeRegistry,\n} from '@superset-ui/core';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    records: PropTypes.arrayOf(\n      PropTypes.shape({\n        x: PropTypes.string,\n        y: PropTypes.string,\n        v: PropTypes.number,\n        perc: PropTypes.number,\n        rank: PropTypes.number,\n      }),\n    ),\n    extents: PropTypes.arrayOf(PropTypes.number),\n  }),\n  width: PropTypes.number,\n  height: PropTypes.number,\n  bottomMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  colorScheme: PropTypes.string,\n  columnX: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  columnY: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  leftMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  metric: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  normalized: PropTypes.bool,\n  valueFormatter: PropTypes.object,\n  showLegend: PropTypes.bool,\n  showPercentage: PropTypes.bool,\n  showValues: PropTypes.bool,\n  sortXAxis: PropTypes.string,\n  sortYAxis: PropTypes.string,\n  xScaleInterval: PropTypes.number,\n  yScaleInterval: PropTypes.number,\n  yAxisBounds: PropTypes.arrayOf(PropTypes.number),\n};\n\nfunction cmp(a, b) {\n  return a > b ? 1 : -1;\n}\n\nconst DEFAULT_PROPERTIES = {\n  minChartWidth: 150,\n  minChartHeight: 150,\n  marginLeft: 35,\n  marginBottom: 35,\n  marginTop: 10,\n  marginRight: 10,\n};\n\n// Inspired from http://bl.ocks.org/mbostock/3074470\n// https://jsfiddle.net/cyril123/h0reyumq/\nfunction Heatmap(element, props) {\n  const {\n    data,\n    width,\n    height,\n    bottomMargin,\n    canvasImageRendering,\n    colorScheme,\n    columnX,\n    columnY,\n    leftMargin,\n    metric,\n    normalized,\n    valueFormatter,\n    showLegend,\n    showPercentage,\n    showValues,\n    sortXAxis,\n    sortYAxis,\n    xScaleInterval,\n    yScaleInterval,\n    yAxisBounds,\n    xAxisFormatter,\n    yAxisFormatter,\n  } = props;\n\n  const { extents } = data;\n  const records = data.records.map(record => ({\n    ...record,\n    x: xAxisFormatter(record.x),\n    y: yAxisFormatter(record.y),\n  }));\n\n  const margin = {\n    top: 10,\n    right: 10,\n    bottom: 35,\n    left: 35,\n  };\n\n  let showY = true;\n  let showX = true;\n  const pixelsPerCharX = 4.5; // approx, depends on font size\n  let pixelsPerCharY = 6; // approx, depends on font size\n\n  // Dynamically adjusts  based on max x / y category lengths\n  function adjustMargins() {\n    let longestX = 1;\n    let longestY = 1;\n\n    records.forEach(datum => {\n      if (typeof datum.y === 'number') pixelsPerCharY = 7;\n      longestX = Math.max(\n        longestX,\n        (datum.x && datum.x.toString().length) || 1,\n      );\n      longestY = Math.max(\n        longestY,\n        (datum.y && datum.y.toString().length) || 1,\n      );\n    });\n\n    if (leftMargin === 'auto') {\n      margin.left = Math.ceil(Math.max(margin.left, pixelsPerCharY * longestY));\n    } else {\n      margin.left = leftMargin;\n    }\n\n    if (showLegend) {\n      margin.right += 40;\n    }\n\n    margin.bottom =\n      bottomMargin === 'auto'\n        ? Math.ceil(Math.max(margin.bottom, pixelsPerCharX * longestX))\n        : bottomMargin;\n  }\n\n  // Check if x axis \"x\" position is outside of the container and rotate labels 90deg\n  function checkLabelPosition(container) {\n    const xAxisNode = container.select('.x.axis').node();\n\n    if (!xAxisNode) {\n      return;\n    }\n\n    if (\n      xAxisNode.getBoundingClientRect().x + 4 <\n      container.node().getBoundingClientRect().x\n    ) {\n      container\n        .selectAll('.x.axis')\n        .selectAll('text')\n        .attr('transform', 'rotate(-90)')\n        .attr('x', -6)\n        .attr('y', 0)\n        .attr('dy', '0.3em');\n    }\n  }\n\n  function ordScale(k, rangeBands, sortMethod) {\n    let domain = {};\n    const actualKeys = {}; // hack to preserve type of keys when number\n    records.forEach(d => {\n      domain[d[k]] = (domain[d[k]] || 0) + d.v;\n      actualKeys[d[k]] = d[k];\n    });\n    // Not using object.keys() as it converts to strings\n    const keys = Object.keys(actualKeys).map(s => actualKeys[s]);\n    if (sortMethod === 'alpha_asc') {\n      domain = keys.sort(cmp);\n    } else if (sortMethod === 'alpha_desc') {\n      domain = keys.sort(cmp).reverse();\n    } else if (sortMethod === 'value_desc') {\n      domain = Object.keys(domain).sort((a, b) =>\n        domain[a] > domain[b] ? -1 : 1,\n      );\n    } else if (sortMethod === 'value_asc') {\n      domain = Object.keys(domain).sort((a, b) =>\n        domain[b] > domain[a] ? -1 : 1,\n      );\n    }\n\n    if (k === 'y' && rangeBands) {\n      domain.reverse();\n    }\n\n    if (rangeBands) {\n      return d3.scale.ordinal().domain(domain).rangeBands(rangeBands);\n    }\n\n    return d3.scale.ordinal().domain(domain).range(d3.range(domain.length));\n  }\n\n  // eslint-disable-next-line no-param-reassign\n  element.innerHTML = '';\n  const matrix = {};\n\n  adjustMargins();\n\n  let hmWidth = width - (margin.left + margin.right);\n  let hmHeight = height - (margin.bottom + margin.top);\n  const hideYLabel = () => {\n    margin.left =\n      leftMargin === 'auto' ? DEFAULT_PROPERTIES.marginLeft : leftMargin;\n    hmWidth = width - (margin.left + margin.right);\n    showY = false;\n  };\n\n  const hideXLabel = () => {\n    margin.bottom =\n      bottomMargin === 'auto' ? DEFAULT_PROPERTIES.marginBottom : bottomMargin;\n    hmHeight = height - (margin.bottom + margin.top);\n    showX = false;\n  };\n\n  // Hide Y Labels\n  if (hmWidth < DEFAULT_PROPERTIES.minChartWidth) {\n    hideYLabel();\n  }\n\n  // Hide X Labels\n  if (\n    hmHeight < DEFAULT_PROPERTIES.minChartHeight ||\n    hmWidth < DEFAULT_PROPERTIES.minChartWidth\n  ) {\n    hideXLabel();\n  }\n\n  if (showY && hmHeight < DEFAULT_PROPERTIES.minChartHeight) {\n    hideYLabel();\n  }\n\n  const fp = getNumberFormatter(NumberFormats.PERCENT);\n\n  const xScale = ordScale('x', null, sortXAxis);\n  const yScale = ordScale('y', null, sortYAxis);\n  const xRbScale = ordScale('x', [0, hmWidth], sortXAxis);\n  const yRbScale = ordScale('y', [hmHeight, 0], sortYAxis);\n  const X = 0;\n  const Y = 1;\n  const heatmapDim = [xRbScale.domain().length, yRbScale.domain().length];\n\n  const minBound = yAxisBounds[0] || 0;\n  const maxBound = yAxisBounds[1] || 1;\n  const colorScale = getSequentialSchemeRegistry()\n    .get(colorScheme)\n    .createLinearScale([minBound, maxBound]);\n\n  const scale = [\n    d3.scale.linear().domain([0, heatmapDim[X]]).range([0, hmWidth]),\n    d3.scale.linear().domain([0, heatmapDim[Y]]).range([0, hmHeight]),\n  ];\n\n  const container = d3.select(element);\n  container.classed('superset-legacy-chart-heatmap', true);\n\n  const canvas = container\n    .append('canvas')\n    .attr('width', heatmapDim[X])\n    .attr('height', heatmapDim[Y])\n    .style('width', `${hmWidth}px`)\n    .style('height', `${hmHeight}px`)\n    .style('image-rendering', canvasImageRendering)\n    .style('left', `${margin.left}px`)\n    .style('top', `${margin.top}px`)\n    .style('position', 'absolute');\n\n  const svg = container\n    .append('svg')\n    .attr('width', width)\n    .attr('height', height)\n    .attr('class', 'heatmap-container')\n    .style('position', 'relative');\n\n  if (showValues) {\n    const cells = svg\n      .selectAll('rect')\n      .data(records)\n      .enter()\n      .append('g')\n      .attr('transform', `translate(${margin.left}, ${margin.top})`);\n\n    cells\n      .append('text')\n      .attr('transform', d => `translate(${xRbScale(d.x)}, ${yRbScale(d.y)})`)\n      .attr('y', yRbScale.rangeBand() / 2)\n      .attr('x', xRbScale.rangeBand() / 2)\n      .attr('text-anchor', 'middle')\n      .attr('dy', '.35em')\n      .text(d => valueFormatter(d.v))\n      .attr(\n        'font-size',\n        `${Math.min(yRbScale.rangeBand(), xRbScale.rangeBand()) / 3}px`,\n      )\n      .attr('fill', d => (d.v >= extents[1] / 2 ? 'white' : 'black'));\n  }\n\n  if (showLegend) {\n    const colorLegend = d3.legend\n      .color()\n      .labelFormat(valueFormatter)\n      .scale(colorScale)\n      .shapePadding(0)\n      .cells(10)\n      .shapeWidth(10)\n      .shapeHeight(10)\n      .labelOffset(3);\n\n    svg\n      .append('g')\n      .attr('transform', `translate(${width - 40}, ${margin.top})`)\n      .call(colorLegend);\n  }\n\n  const tip = d3tip()\n    .attr('class', 'd3-tip')\n    .offset(function () {\n      const k = d3.mouse(this);\n      const x = k[0] - hmWidth / 2;\n\n      return [k[1] - 20, x];\n    })\n    .html(function () {\n      let s = '';\n      const k = d3.mouse(this);\n      const m = Math.floor(scale[0].invert(k[0]));\n      const n = Math.floor(scale[1].invert(k[1]));\n      if (m in matrix && n in matrix[m]) {\n        const obj = matrix[m][n];\n        s += `<div><b>${getColumnLabel(columnX)}: </b>${obj.x}<div>`;\n        s += `<div><b>${getColumnLabel(columnY)}: </b>${obj.y}<div>`;\n        s += `<div><b>${getMetricLabel(metric)}: </b>${valueFormatter(\n          obj.v,\n        )}<div>`;\n        if (showPercentage) {\n          s += `<div><b>%: </b>${fp(normalized ? obj.rank : obj.perc)}<div>`;\n        }\n        tip.style('display', null);\n      } else {\n        // this is a hack to hide the tooltip because we have map it to a single <rect>\n        // d3-tip toggles opacity and calling hide here is undone by the lib after this call\n        tip.style('display', 'none');\n      }\n\n      return s;\n    });\n\n  const rect = svg\n    .append('g')\n    .attr('transform', `translate(${margin.left}, ${margin.top})`)\n    .append('rect')\n    .classed('background-rect', true)\n    .on('mousemove', tip.show)\n    .on('mouseout', tip.hide)\n    .attr('width', hmWidth)\n    .attr('height', hmHeight);\n\n  rect.call(tip);\n\n  if (showX) {\n    const xAxis = d3.svg\n      .axis()\n      .scale(xRbScale)\n      .outerTickSize(0)\n      .tickValues(xRbScale.domain().filter((d, i) => !(i % xScaleInterval)))\n      .orient('bottom');\n\n    svg\n      .append('g')\n      .attr('class', 'x axis')\n      .attr('transform', `translate(${margin.left},${margin.top + hmHeight})`)\n      .call(xAxis)\n      .selectAll('text')\n      .attr('x', -4)\n      .attr('y', 10)\n      .attr('dy', '0.3em')\n      .style('text-anchor', 'end')\n      .attr('transform', 'rotate(-45)');\n  }\n\n  if (showY) {\n    const yAxis = d3.svg\n      .axis()\n      .scale(yRbScale)\n      .outerTickSize(0)\n      .tickValues(yRbScale.domain().filter((d, i) => !(i % yScaleInterval)))\n      .orient('left');\n\n    svg\n      .append('g')\n      .attr('class', 'y axis')\n      .attr('transform', `translate(${margin.left},${margin.top})`)\n      .call(yAxis);\n  }\n\n  checkLabelPosition(container);\n  const context = canvas.node().getContext('2d');\n  context.imageSmoothingEnabled = false;\n\n  // Compute the pixel colors; scaled by CSS.\n  function createImageObj() {\n    const imageObj = new Image();\n    const image = context.createImageData(heatmapDim[0], heatmapDim[1]);\n    const pixs = {};\n    records.forEach(d => {\n      const c = d3.rgb(colorScale(normalized ? d.rank : d.perc));\n      const x = xScale(d.x);\n      const y = yScale(d.y);\n      pixs[x + y * xScale.domain().length] = c;\n      if (matrix[x] === undefined) {\n        matrix[x] = {};\n      }\n      if (matrix[x][y] === undefined) {\n        matrix[x][y] = d;\n      }\n    });\n\n    let p = 0;\n    for (let i = 0; i < heatmapDim[0] * heatmapDim[1]; i += 1) {\n      let c = pixs[i];\n      let alpha = 255;\n      if (c === undefined) {\n        c = d3.rgb('#F00');\n        alpha = 0;\n      }\n      image.data[p + 0] = c.r;\n      image.data[p + 1] = c.g;\n      image.data[p + 2] = c.b;\n      image.data[p + 3] = alpha;\n      p += 4;\n    }\n    context.putImageData(image, 0, 0);\n    imageObj.src = canvas.node().toDataURL();\n  }\n  createImageObj();\n}\n\nHeatmap.displayName = 'Heatmap';\nHeatmap.propTypes = propTypes;\n\nexport default Heatmap;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}