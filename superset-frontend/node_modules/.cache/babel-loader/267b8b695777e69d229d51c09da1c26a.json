{"ast":null,"code":"import _extends from \"@babel/runtime-corejs3/helpers/extends\";function _EMOTION_STRINGIFIED_CSS_ERROR__() {return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";} /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { List } from 'src/components';\nimport shortid from 'shortid';\nimport { t, withTheme } from '@superset-ui/core';\nimport {\nSortableContainer,\nSortableHandle,\nSortableElement,\narrayMove } from\n'react-sortable-hoc';\nimport Icons from 'src/components/Icons';\nimport {\nHeaderContainer,\nAddIconButton } from\n'src/explore/components/controls/OptionControls';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport CustomListItem from 'src/explore/components/controls/CustomListItem';\nimport controlMap from '..';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst propTypes = {\n  name: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  placeholder: PropTypes.string,\n  addTooltip: PropTypes.string,\n  itemGenerator: PropTypes.func,\n  keyAccessor: PropTypes.func,\n  onChange: PropTypes.func,\n  value: PropTypes.oneOfType([PropTypes.array]),\n  isFloat: PropTypes.bool,\n  isInt: PropTypes.bool,\n  controlName: PropTypes.string.isRequired };\n\n\nconst defaultProps = {\n  label: null,\n  description: null,\n  onChange: () => {},\n  placeholder: t('Empty collection'),\n  itemGenerator: () => ({ key: shortid.generate() }),\n  keyAccessor: (o) => o.key,\n  value: [],\n  addTooltip: t('Add an item') };\n\nconst SortableListItem = SortableElement(CustomListItem);\nconst SortableList = SortableContainer(List);\nconst SortableDragger = SortableHandle(() =>\n___EmotionJSX(\"i\", {\n  role: \"img\",\n  \"aria-label\": \"drag\",\n  className: \"fa fa-bars text-primary\",\n  style: { cursor: 'ns-resize' } }));var _ref2 = process.env.NODE_ENV === \"production\" ? { name: \"11g6mpt\", styles: \"justify-content:flex-start\" } : { name: \"13cksz1-CollectionControl\", styles: \"justify-content:flex-start;label:CollectionControl;\", map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy96aGFvcnVpL3NyYy9pbmN1YmF0b3Itc3VwZXJzZXQtaW50ZXJuYWwvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2V4cGxvcmUvY29tcG9uZW50cy9jb250cm9scy9Db2xsZWN0aW9uQ29udHJvbC9pbmRleC5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBd0hjIiwiZmlsZSI6Ii9Vc2Vycy96aGFvcnVpL3NyYy9pbmN1YmF0b3Itc3VwZXJzZXQtaW50ZXJuYWwvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2V4cGxvcmUvY29tcG9uZW50cy9jb250cm9scy9Db2xsZWN0aW9uQ29udHJvbC9pbmRleC5qc3giLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJztcbmltcG9ydCB7IExpc3QgfSBmcm9tICdzcmMvY29tcG9uZW50cyc7XG5pbXBvcnQgc2hvcnRpZCBmcm9tICdzaG9ydGlkJztcbmltcG9ydCB7IHQsIHdpdGhUaGVtZSB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCB7XG4gIFNvcnRhYmxlQ29udGFpbmVyLFxuICBTb3J0YWJsZUhhbmRsZSxcbiAgU29ydGFibGVFbGVtZW50LFxuICBhcnJheU1vdmUsXG59IGZyb20gJ3JlYWN0LXNvcnRhYmxlLWhvYyc7XG5pbXBvcnQgSWNvbnMgZnJvbSAnc3JjL2NvbXBvbmVudHMvSWNvbnMnO1xuaW1wb3J0IHtcbiAgSGVhZGVyQ29udGFpbmVyLFxuICBBZGRJY29uQnV0dG9uLFxufSBmcm9tICdzcmMvZXhwbG9yZS9jb21wb25lbnRzL2NvbnRyb2xzL09wdGlvbkNvbnRyb2xzJztcbmltcG9ydCB7IEluZm9Ub29sdGlwV2l0aFRyaWdnZXIgfSBmcm9tICdAc3VwZXJzZXQtdWkvY2hhcnQtY29udHJvbHMnO1xuaW1wb3J0IENvbnRyb2xIZWFkZXIgZnJvbSAnc3JjL2V4cGxvcmUvY29tcG9uZW50cy9Db250cm9sSGVhZGVyJztcbmltcG9ydCBDdXN0b21MaXN0SXRlbSBmcm9tICdzcmMvZXhwbG9yZS9jb21wb25lbnRzL2NvbnRyb2xzL0N1c3RvbUxpc3RJdGVtJztcbmltcG9ydCBjb250cm9sTWFwIGZyb20gJy4uJztcblxuY29uc3QgcHJvcFR5cGVzID0ge1xuICBuYW1lOiBQcm9wVHlwZXMuc3RyaW5nLmlzUmVxdWlyZWQsXG4gIGxhYmVsOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBkZXNjcmlwdGlvbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgcGxhY2Vob2xkZXI6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGFkZFRvb2x0aXA6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGl0ZW1HZW5lcmF0b3I6IFByb3BUeXBlcy5mdW5jLFxuICBrZXlBY2Nlc3NvcjogUHJvcFR5cGVzLmZ1bmMsXG4gIG9uQ2hhbmdlOiBQcm9wVHlwZXMuZnVuYyxcbiAgdmFsdWU6IFByb3BUeXBlcy5vbmVPZlR5cGUoW1Byb3BUeXBlcy5hcnJheV0pLFxuICBpc0Zsb2F0OiBQcm9wVHlwZXMuYm9vbCxcbiAgaXNJbnQ6IFByb3BUeXBlcy5ib29sLFxuICBjb250cm9sTmFtZTogUHJvcFR5cGVzLnN0cmluZy5pc1JlcXVpcmVkLFxufTtcblxuY29uc3QgZGVmYXVsdFByb3BzID0ge1xuICBsYWJlbDogbnVsbCxcbiAgZGVzY3JpcHRpb246IG51bGwsXG4gIG9uQ2hhbmdlOiAoKSA9PiB7fSxcbiAgcGxhY2Vob2xkZXI6IHQoJ0VtcHR5IGNvbGxlY3Rpb24nKSxcbiAgaXRlbUdlbmVyYXRvcjogKCkgPT4gKHsga2V5OiBzaG9ydGlkLmdlbmVyYXRlKCkgfSksXG4gIGtleUFjY2Vzc29yOiBvID0+IG8ua2V5LFxuICB2YWx1ZTogW10sXG4gIGFkZFRvb2x0aXA6IHQoJ0FkZCBhbiBpdGVtJyksXG59O1xuY29uc3QgU29ydGFibGVMaXN0SXRlbSA9IFNvcnRhYmxlRWxlbWVudChDdXN0b21MaXN0SXRlbSk7XG5jb25zdCBTb3J0YWJsZUxpc3QgPSBTb3J0YWJsZUNvbnRhaW5lcihMaXN0KTtcbmNvbnN0IFNvcnRhYmxlRHJhZ2dlciA9IFNvcnRhYmxlSGFuZGxlKCgpID0+IChcbiAgPGlcbiAgICByb2xlPVwiaW1nXCJcbiAgICBhcmlhLWxhYmVsPVwiZHJhZ1wiXG4gICAgY2xhc3NOYW1lPVwiZmEgZmEtYmFycyB0ZXh0LXByaW1hcnlcIlxuICAgIHN0eWxlPXt7IGN1cnNvcjogJ25zLXJlc2l6ZScgfX1cbiAgLz5cbikpO1xuXG5jbGFzcyBDb2xsZWN0aW9uQ29udHJvbCBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMub25BZGQgPSB0aGlzLm9uQWRkLmJpbmQodGhpcyk7XG4gIH1cblxuICBvbkNoYW5nZShpLCB2YWx1ZSkge1xuICAgIGNvbnN0IG5ld1ZhbHVlID0gWy4uLnRoaXMucHJvcHMudmFsdWVdO1xuICAgIG5ld1ZhbHVlW2ldID0geyAuLi50aGlzLnByb3BzLnZhbHVlW2ldLCAuLi52YWx1ZSB9O1xuICAgIHRoaXMucHJvcHMub25DaGFuZ2UobmV3VmFsdWUpO1xuICB9XG5cbiAgb25BZGQoKSB7XG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh0aGlzLnByb3BzLnZhbHVlLmNvbmNhdChbdGhpcy5wcm9wcy5pdGVtR2VuZXJhdG9yKCldKSk7XG4gIH1cblxuICBvblNvcnRFbmQoeyBvbGRJbmRleCwgbmV3SW5kZXggfSkge1xuICAgIHRoaXMucHJvcHMub25DaGFuZ2UoYXJyYXlNb3ZlKHRoaXMucHJvcHMudmFsdWUsIG9sZEluZGV4LCBuZXdJbmRleCkpO1xuICB9XG5cbiAgcmVtb3ZlSXRlbShpKSB7XG4gICAgdGhpcy5wcm9wcy5vbkNoYW5nZSh0aGlzLnByb3BzLnZhbHVlLmZpbHRlcigobywgaXgpID0+IGkgIT09IGl4KSk7XG4gIH1cblxuICByZW5kZXJMaXN0KCkge1xuICAgIGlmICh0aGlzLnByb3BzLnZhbHVlLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIDxkaXYgY2xhc3NOYW1lPVwidGV4dC1tdXRlZFwiPnt0aGlzLnByb3BzLnBsYWNlaG9sZGVyfTwvZGl2PjtcbiAgICB9XG4gICAgY29uc3QgQ29udHJvbCA9IGNvbnRyb2xNYXBbdGhpcy5wcm9wcy5jb250cm9sTmFtZV07XG4gICAgcmV0dXJuIChcbiAgICAgIDxTb3J0YWJsZUxpc3RcbiAgICAgICAgdXNlRHJhZ0hhbmRsZVxuICAgICAgICBsb2NrQXhpcz1cInlcIlxuICAgICAgICBvblNvcnRFbmQ9e3RoaXMub25Tb3J0RW5kLmJpbmQodGhpcyl9XG4gICAgICAgIGJvcmRlcmVkXG4gICAgICAgIGNzcz17dGhlbWUgPT4gKHtcbiAgICAgICAgICBib3JkZXJSYWRpdXM6IHRoZW1lLmdyaWRVbml0LFxuICAgICAgICB9KX1cbiAgICAgID5cbiAgICAgICAge3RoaXMucHJvcHMudmFsdWUubWFwKChvLCBpKSA9PiB7XG4gICAgICAgICAgLy8gbGFiZWwgcmVsZXZhbnQgb25seSBmb3IgaGVhZGVyLCBub3QgaGVyZVxuICAgICAgICAgIGNvbnN0IHsgbGFiZWwsIC4uLmNvbW1vblByb3BzIH0gPSB0aGlzLnByb3BzO1xuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8U29ydGFibGVMaXN0SXRlbVxuICAgICAgICAgICAgICBjbGFzc05hbWU9XCJjbGVhcmZpeFwiXG4gICAgICAgICAgICAgIGNzcz17eyBqdXN0aWZ5Q29udGVudDogJ2ZsZXgtc3RhcnQnIH19XG4gICAgICAgICAgICAgIGtleT17dGhpcy5wcm9wcy5rZXlBY2Nlc3NvcihvKX1cbiAgICAgICAgICAgICAgaW5kZXg9e2l9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxTb3J0YWJsZURyYWdnZXIgLz5cbiAgICAgICAgICAgICAgPGRpdlxuICAgICAgICAgICAgICAgIGNzcz17dGhlbWUgPT4gKHtcbiAgICAgICAgICAgICAgICAgIGZsZXg6IDEsXG4gICAgICAgICAgICAgICAgICBtYXJnaW5MZWZ0OiB0aGVtZS5ncmlkVW5pdCAqIDIsXG4gICAgICAgICAgICAgICAgICBtYXJnaW5SaWdodDogdGhlbWUuZ3JpZFVuaXQgKiAyLFxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAgPENvbnRyb2xcbiAgICAgICAgICAgICAgICAgIHsuLi5jb21tb25Qcm9wc31cbiAgICAgICAgICAgICAgICAgIHsuLi5vfVxuICAgICAgICAgICAgICAgICAgb25DaGFuZ2U9e3RoaXMub25DaGFuZ2UuYmluZCh0aGlzLCBpKX1cbiAgICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICAgICAgPEluZm9Ub29sdGlwV2l0aFRyaWdnZXJcbiAgICAgICAgICAgICAgICBpY29uPVwidGltZXNcIlxuICAgICAgICAgICAgICAgIGxhYmVsPVwicmVtb3ZlLWl0ZW1cIlxuICAgICAgICAgICAgICAgIHRvb2x0aXA9e3QoJ1JlbW92ZSBpdGVtJyl9XG4gICAgICAgICAgICAgICAgYnNTdHlsZT1cInByaW1hcnlcIlxuICAgICAgICAgICAgICAgIG9uQ2xpY2s9e3RoaXMucmVtb3ZlSXRlbS5iaW5kKHRoaXMsIGkpfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9Tb3J0YWJsZUxpc3RJdGVtPlxuICAgICAgICAgICk7XG4gICAgICAgIH0pfVxuICAgICAgPC9Tb3J0YWJsZUxpc3Q+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IHRoZW1lIH0gPSB0aGlzLnByb3BzO1xuICAgIHJldHVybiAoXG4gICAgICA8ZGl2IGRhdGEtdGVzdD1cIkNvbGxlY3Rpb25Db250cm9sXCIgY2xhc3NOYW1lPVwiQ29sbGVjdGlvbkNvbnRyb2xcIj5cbiAgICAgICAgPEhlYWRlckNvbnRhaW5lcj5cbiAgICAgICAgICA8Q29udHJvbEhlYWRlciB7Li4udGhpcy5wcm9wc30gLz5cbiAgICAgICAgICA8QWRkSWNvbkJ1dHRvbiBvbkNsaWNrPXt0aGlzLm9uQWRkfT5cbiAgICAgICAgICAgIDxJY29ucy5QbHVzTGFyZ2VcbiAgICAgICAgICAgICAgaWNvblNpemU9XCJzXCJcbiAgICAgICAgICAgICAgaWNvbkNvbG9yPXt0aGVtZS5jb2xvcnMuZ3JheXNjYWxlLmxpZ2h0NX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgPC9BZGRJY29uQnV0dG9uPlxuICAgICAgICA8L0hlYWRlckNvbnRhaW5lcj5cbiAgICAgICAge3RoaXMucmVuZGVyTGlzdCgpfVxuICAgICAgPC9kaXY+XG4gICAgKTtcbiAgfVxufVxuXG5Db2xsZWN0aW9uQ29udHJvbC5wcm9wVHlwZXMgPSBwcm9wVHlwZXM7XG5Db2xsZWN0aW9uQ29udHJvbC5kZWZhdWx0UHJvcHMgPSBkZWZhdWx0UHJvcHM7XG5cbmV4cG9ydCBkZWZhdWx0IHdpdGhUaGVtZShDb2xsZWN0aW9uQ29udHJvbCk7XG4iXX0= */\", toString: _EMOTION_STRINGIFIED_CSS_ERROR__ };\n\n\n\nclass CollectionControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onAdd = this.onAdd.bind(this);\n  }\n\n  onChange(i, value) {\n    const newValue = [...this.props.value];\n    newValue[i] = { ...this.props.value[i], ...value };\n    this.props.onChange(newValue);\n  }\n\n  onAdd() {\n    this.props.onChange(this.props.value.concat([this.props.itemGenerator()]));\n  }\n\n  onSortEnd(_ref) {let { oldIndex, newIndex } = _ref;\n    this.props.onChange(arrayMove(this.props.value, oldIndex, newIndex));\n  }\n\n  removeItem(i) {\n    this.props.onChange(this.props.value.filter((o, ix) => i !== ix));\n  }\n\n  renderList() {\n    if (this.props.value.length === 0) {\n      return ___EmotionJSX(\"div\", { className: \"text-muted\" }, this.props.placeholder);\n    }\n    const Control = controlMap[this.props.controlName];\n    return (\n      ___EmotionJSX(SortableList, {\n        useDragHandle: true,\n        lockAxis: \"y\",\n        onSortEnd: this.onSortEnd.bind(this),\n        bordered: true,\n        css: (theme) => ({\n          borderRadius: theme.gridUnit }) },\n\n\n      this.props.value.map((o, i) => {\n        // label relevant only for header, not here\n        const { label, ...commonProps } = this.props;\n        return (\n          ___EmotionJSX(SortableListItem, {\n            className: \"clearfix\",\n            css: _ref2,\n            key: this.props.keyAccessor(o),\n            index: i },\n\n          ___EmotionJSX(SortableDragger, null),\n          ___EmotionJSX(\"div\", {\n            css: (theme) => ({\n              flex: 1,\n              marginLeft: theme.gridUnit * 2,\n              marginRight: theme.gridUnit * 2 }) },\n\n\n          ___EmotionJSX(Control, _extends({},\n          commonProps,\n          o, {\n            onChange: this.onChange.bind(this, i) }))),\n\n\n          ___EmotionJSX(InfoTooltipWithTrigger, {\n            icon: \"times\",\n            label: \"remove-item\",\n            tooltip: t('Remove item'),\n            bsStyle: \"primary\",\n            onClick: this.removeItem.bind(this, i) })));\n\n\n\n      })));\n\n\n  }\n\n  render() {\n    const { theme } = this.props;\n    return (\n      ___EmotionJSX(\"div\", { className: \"CollectionControl\" },\n      ___EmotionJSX(HeaderContainer, null,\n      ___EmotionJSX(ControlHeader, this.props),\n      ___EmotionJSX(AddIconButton, { onClick: this.onAdd },\n      ___EmotionJSX(Icons.PlusLarge, {\n        iconSize: \"s\",\n        iconColor: theme.colors.grayscale.light5 }))),\n\n\n\n      this.renderList()));\n\n\n  }}\n\n\nCollectionControl.propTypes = propTypes;\nCollectionControl.defaultProps = defaultProps;\n\nexport default withTheme(CollectionControl);","map":{"version":3,"names":["React","PropTypes","List","shortid","t","withTheme","SortableContainer","SortableHandle","SortableElement","arrayMove","Icons","HeaderContainer","AddIconButton","InfoTooltipWithTrigger","ControlHeader","CustomListItem","controlMap","propTypes","name","string","isRequired","label","description","placeholder","addTooltip","itemGenerator","func","keyAccessor","onChange","value","oneOfType","array","isFloat","bool","isInt","controlName","defaultProps","key","generate","o","SortableListItem","SortableList","SortableDragger","cursor","CollectionControl","Component","constructor","props","onAdd","bind","i","newValue","concat","onSortEnd","oldIndex","newIndex","removeItem","filter","ix","renderList","length","Control","theme","borderRadius","gridUnit","map","commonProps","flex","marginLeft","marginRight","render","colors","grayscale","light5"],"sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/src/explore/components/controls/CollectionControl/index.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { List } from 'src/components';\nimport shortid from 'shortid';\nimport { t, withTheme } from '@superset-ui/core';\nimport {\n  SortableContainer,\n  SortableHandle,\n  SortableElement,\n  arrayMove,\n} from 'react-sortable-hoc';\nimport Icons from 'src/components/Icons';\nimport {\n  HeaderContainer,\n  AddIconButton,\n} from 'src/explore/components/controls/OptionControls';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport CustomListItem from 'src/explore/components/controls/CustomListItem';\nimport controlMap from '..';\n\nconst propTypes = {\n  name: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  placeholder: PropTypes.string,\n  addTooltip: PropTypes.string,\n  itemGenerator: PropTypes.func,\n  keyAccessor: PropTypes.func,\n  onChange: PropTypes.func,\n  value: PropTypes.oneOfType([PropTypes.array]),\n  isFloat: PropTypes.bool,\n  isInt: PropTypes.bool,\n  controlName: PropTypes.string.isRequired,\n};\n\nconst defaultProps = {\n  label: null,\n  description: null,\n  onChange: () => {},\n  placeholder: t('Empty collection'),\n  itemGenerator: () => ({ key: shortid.generate() }),\n  keyAccessor: o => o.key,\n  value: [],\n  addTooltip: t('Add an item'),\n};\nconst SortableListItem = SortableElement(CustomListItem);\nconst SortableList = SortableContainer(List);\nconst SortableDragger = SortableHandle(() => (\n  <i\n    role=\"img\"\n    aria-label=\"drag\"\n    className=\"fa fa-bars text-primary\"\n    style={{ cursor: 'ns-resize' }}\n  />\n));\n\nclass CollectionControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onAdd = this.onAdd.bind(this);\n  }\n\n  onChange(i, value) {\n    const newValue = [...this.props.value];\n    newValue[i] = { ...this.props.value[i], ...value };\n    this.props.onChange(newValue);\n  }\n\n  onAdd() {\n    this.props.onChange(this.props.value.concat([this.props.itemGenerator()]));\n  }\n\n  onSortEnd({ oldIndex, newIndex }) {\n    this.props.onChange(arrayMove(this.props.value, oldIndex, newIndex));\n  }\n\n  removeItem(i) {\n    this.props.onChange(this.props.value.filter((o, ix) => i !== ix));\n  }\n\n  renderList() {\n    if (this.props.value.length === 0) {\n      return <div className=\"text-muted\">{this.props.placeholder}</div>;\n    }\n    const Control = controlMap[this.props.controlName];\n    return (\n      <SortableList\n        useDragHandle\n        lockAxis=\"y\"\n        onSortEnd={this.onSortEnd.bind(this)}\n        bordered\n        css={theme => ({\n          borderRadius: theme.gridUnit,\n        })}\n      >\n        {this.props.value.map((o, i) => {\n          // label relevant only for header, not here\n          const { label, ...commonProps } = this.props;\n          return (\n            <SortableListItem\n              className=\"clearfix\"\n              css={{ justifyContent: 'flex-start' }}\n              key={this.props.keyAccessor(o)}\n              index={i}\n            >\n              <SortableDragger />\n              <div\n                css={theme => ({\n                  flex: 1,\n                  marginLeft: theme.gridUnit * 2,\n                  marginRight: theme.gridUnit * 2,\n                })}\n              >\n                <Control\n                  {...commonProps}\n                  {...o}\n                  onChange={this.onChange.bind(this, i)}\n                />\n              </div>\n              <InfoTooltipWithTrigger\n                icon=\"times\"\n                label=\"remove-item\"\n                tooltip={t('Remove item')}\n                bsStyle=\"primary\"\n                onClick={this.removeItem.bind(this, i)}\n              />\n            </SortableListItem>\n          );\n        })}\n      </SortableList>\n    );\n  }\n\n  render() {\n    const { theme } = this.props;\n    return (\n      <div data-test=\"CollectionControl\" className=\"CollectionControl\">\n        <HeaderContainer>\n          <ControlHeader {...this.props} />\n          <AddIconButton onClick={this.onAdd}>\n            <Icons.PlusLarge\n              iconSize=\"s\"\n              iconColor={theme.colors.grayscale.light5}\n            />\n          </AddIconButton>\n        </HeaderContainer>\n        {this.renderList()}\n      </div>\n    );\n  }\n}\n\nCollectionControl.propTypes = propTypes;\nCollectionControl.defaultProps = defaultProps;\n\nexport default withTheme(CollectionControl);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}