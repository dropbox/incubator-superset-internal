{"ast":null,"code":"function _EMOTION_STRINGIFIED_CSS_ERROR__() {return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";}import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\"; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Input } from 'src/components/Input';\nimport { FormItem } from 'src/components/Form';\nimport jsonStringify from 'json-stringify-pretty-compact';\nimport Button from 'src/components/Button';\nimport { AntdForm, AsyncSelect, Col, Row } from 'src/components';\nimport rison from 'rison';\nimport { CategoricalColorNamespace, ensureIsArray, FeatureFlag, getCategoricalSchemeRegistry, getSharedLabelColor, styled, SupersetClient, t } from '@superset-ui/core';\nimport Modal from 'src/components/Modal';\nimport { JsonEditor } from 'src/components/AsyncAceEditor';\nimport ColorSchemeControlWrapper from 'src/dashboard/components/ColorSchemeControlWrapper';\nimport FilterScopeModal from 'src/dashboard/components/filterscope/FilterScopeModal';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport { addTag, deleteTaggedObjects, fetchTags, OBJECT_TYPES } from 'src/features/tags/tags';\nimport { loadTags } from 'src/components/Tags/utils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst StyledFormItem = styled(FormItem)`\n  margin-bottom: 0;\n`;\nconst StyledJsonEditor = styled(JsonEditor)`\n  border-radius: ${(_ref) => {let { theme } = _ref;return theme.borderRadius;}}px;\n  border: 1px solid ${(_ref2) => {let { theme } = _ref2;return theme.colors.secondary.light2;}};\n`;var _ref4 = process.env.NODE_ENV === \"production\" ? { name: \"1blj7km\", styles: \"margin-top:1em\" } : { name: \"1gtq0eh-PropertiesModal\", styles: \"margin-top:1em;label:PropertiesModal;\", map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9ib2dkYW5reXJ5bGl1ay9jb2RlL29wZW5zb3VyY2Uvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2Rhc2hib2FyZC9jb21wb25lbnRzL1Byb3BlcnRpZXNNb2RhbC9pbmRleC50c3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBc2VrQiIsImZpbGUiOiIvVXNlcnMvYm9nZGFua3lyeWxpdWsvY29kZS9vcGVuc291cmNlL3N1cGVyc2V0L3N1cGVyc2V0LWZyb250ZW5kL3NyYy9kYXNoYm9hcmQvY29tcG9uZW50cy9Qcm9wZXJ0aWVzTW9kYWwvaW5kZXgudHN4Iiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBMaWNlbnNlZCB0byB0aGUgQXBhY2hlIFNvZnR3YXJlIEZvdW5kYXRpb24gKEFTRikgdW5kZXIgb25lXG4gKiBvciBtb3JlIGNvbnRyaWJ1dG9yIGxpY2Vuc2UgYWdyZWVtZW50cy4gIFNlZSB0aGUgTk9USUNFIGZpbGVcbiAqIGRpc3RyaWJ1dGVkIHdpdGggdGhpcyB3b3JrIGZvciBhZGRpdGlvbmFsIGluZm9ybWF0aW9uXG4gKiByZWdhcmRpbmcgY29weXJpZ2h0IG93bmVyc2hpcC4gIFRoZSBBU0YgbGljZW5zZXMgdGhpcyBmaWxlXG4gKiB0byB5b3UgdW5kZXIgdGhlIEFwYWNoZSBMaWNlbnNlLCBWZXJzaW9uIDIuMCAodGhlXG4gKiBcIkxpY2Vuc2VcIik7IHlvdSBtYXkgbm90IHVzZSB0aGlzIGZpbGUgZXhjZXB0IGluIGNvbXBsaWFuY2VcbiAqIHdpdGggdGhlIExpY2Vuc2UuICBZb3UgbWF5IG9idGFpbiBhIGNvcHkgb2YgdGhlIExpY2Vuc2UgYXRcbiAqXG4gKiAgIGh0dHA6Ly93d3cuYXBhY2hlLm9yZy9saWNlbnNlcy9MSUNFTlNFLTIuMFxuICpcbiAqIFVubGVzcyByZXF1aXJlZCBieSBhcHBsaWNhYmxlIGxhdyBvciBhZ3JlZWQgdG8gaW4gd3JpdGluZyxcbiAqIHNvZnR3YXJlIGRpc3RyaWJ1dGVkIHVuZGVyIHRoZSBMaWNlbnNlIGlzIGRpc3RyaWJ1dGVkIG9uIGFuXG4gKiBcIkFTIElTXCIgQkFTSVMsIFdJVEhPVVQgV0FSUkFOVElFUyBPUiBDT05ESVRJT05TIE9GIEFOWVxuICogS0lORCwgZWl0aGVyIGV4cHJlc3Mgb3IgaW1wbGllZC4gIFNlZSB0aGUgTGljZW5zZSBmb3IgdGhlXG4gKiBzcGVjaWZpYyBsYW5ndWFnZSBnb3Zlcm5pbmcgcGVybWlzc2lvbnMgYW5kIGxpbWl0YXRpb25zXG4gKiB1bmRlciB0aGUgTGljZW5zZS5cbiAqL1xuaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VFZmZlY3QsIHVzZU1lbW8sIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHsgSW5wdXQgfSBmcm9tICdzcmMvY29tcG9uZW50cy9JbnB1dCc7XG5pbXBvcnQgeyBGb3JtSXRlbSB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0Zvcm0nO1xuaW1wb3J0IGpzb25TdHJpbmdpZnkgZnJvbSAnanNvbi1zdHJpbmdpZnktcHJldHR5LWNvbXBhY3QnO1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdzcmMvY29tcG9uZW50cy9CdXR0b24nO1xuaW1wb3J0IHsgQW50ZEZvcm0sIEFzeW5jU2VsZWN0LCBDb2wsIFJvdyB9IGZyb20gJ3NyYy9jb21wb25lbnRzJztcbmltcG9ydCByaXNvbiBmcm9tICdyaXNvbic7XG5pbXBvcnQgeyBDYXRlZ29yaWNhbENvbG9yTmFtZXNwYWNlLCBlbnN1cmVJc0FycmF5LCBGZWF0dXJlRmxhZywgZ2V0Q2F0ZWdvcmljYWxTY2hlbWVSZWdpc3RyeSwgZ2V0U2hhcmVkTGFiZWxDb2xvciwgc3R5bGVkLCBTdXBlcnNldENsaWVudCwgdCwgfSBmcm9tICdAc3VwZXJzZXQtdWkvY29yZSc7XG5pbXBvcnQgTW9kYWwgZnJvbSAnc3JjL2NvbXBvbmVudHMvTW9kYWwnO1xuaW1wb3J0IHsgSnNvbkVkaXRvciB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0FzeW5jQWNlRWRpdG9yJztcbmltcG9ydCBDb2xvclNjaGVtZUNvbnRyb2xXcmFwcGVyIGZyb20gJ3NyYy9kYXNoYm9hcmQvY29tcG9uZW50cy9Db2xvclNjaGVtZUNvbnRyb2xXcmFwcGVyJztcbmltcG9ydCBGaWx0ZXJTY29wZU1vZGFsIGZyb20gJ3NyYy9kYXNoYm9hcmQvY29tcG9uZW50cy9maWx0ZXJzY29wZS9GaWx0ZXJTY29wZU1vZGFsJztcbmltcG9ydCB7IGdldENsaWVudEVycm9yT2JqZWN0IH0gZnJvbSAnc3JjL3V0aWxzL2dldENsaWVudEVycm9yT2JqZWN0JztcbmltcG9ydCB3aXRoVG9hc3RzIGZyb20gJ3NyYy9jb21wb25lbnRzL01lc3NhZ2VUb2FzdHMvd2l0aFRvYXN0cyc7XG5pbXBvcnQgeyBpc0ZlYXR1cmVFbmFibGVkIH0gZnJvbSAnc3JjL2ZlYXR1cmVGbGFncyc7XG5pbXBvcnQgeyBhZGRUYWcsIGRlbGV0ZVRhZ2dlZE9iamVjdHMsIGZldGNoVGFncywgT0JKRUNUX1RZUEVTLCB9IGZyb20gJ3NyYy9mZWF0dXJlcy90YWdzL3RhZ3MnO1xuaW1wb3J0IHsgbG9hZFRhZ3MgfSBmcm9tICdzcmMvY29tcG9uZW50cy9UYWdzL3V0aWxzJztcbmNvbnN0IFN0eWxlZEZvcm1JdGVtID0gc3R5bGVkKEZvcm1JdGVtKSBgXG4gIG1hcmdpbi1ib3R0b206IDA7XG5gO1xuY29uc3QgU3R5bGVkSnNvbkVkaXRvciA9IHN0eWxlZChKc29uRWRpdG9yKSBgXG4gIGJvcmRlci1yYWRpdXM6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuYm9yZGVyUmFkaXVzfXB4O1xuICBib3JkZXI6IDFweCBzb2xpZCAkeyh7IHRoZW1lIH0pID0+IHRoZW1lLmNvbG9ycy5zZWNvbmRhcnkubGlnaHQyfTtcbmA7XG5jb25zdCBQcm9wZXJ0aWVzTW9kYWwgPSAoeyBhZGRTdWNjZXNzVG9hc3QsIGFkZERhbmdlclRvYXN0LCBjb2xvclNjaGVtZTogY3VycmVudENvbG9yU2NoZW1lLCBkYXNoYm9hcmRJZCwgZGFzaGJvYXJkSW5mbzogY3VycmVudERhc2hib2FyZEluZm8sIGRhc2hib2FyZFRpdGxlLCBvbkhpZGUgPSAoKSA9PiB7IH0sIG9ubHlBcHBseSA9IGZhbHNlLCBvblN1Ym1pdCA9ICgpID0+IHsgfSwgc2hvdyA9IGZhbHNlLCB9KSA9PiB7XG4gICAgY29uc3QgW2Zvcm1dID0gQW50ZEZvcm0udXNlRm9ybSgpO1xuICAgIGNvbnN0IFtpc0xvYWRpbmcsIHNldElzTG9hZGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2lzQWR2YW5jZWRPcGVuLCBzZXRJc0FkdmFuY2VkT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW2NvbG9yU2NoZW1lLCBzZXRDb2xvclNjaGVtZV0gPSB1c2VTdGF0ZShjdXJyZW50Q29sb3JTY2hlbWUpO1xuICAgIGNvbnN0IFtqc29uTWV0YWRhdGEsIHNldEpzb25NZXRhZGF0YV0gPSB1c2VTdGF0ZSgnJyk7XG4gICAgY29uc3QgW2Rhc2hib2FyZEluZm8sIHNldERhc2hib2FyZEluZm9dID0gdXNlU3RhdGUoKTtcbiAgICBjb25zdCBbb3duZXJzLCBzZXRPd25lcnNdID0gdXNlU3RhdGUoW10pO1xuICAgIGNvbnN0IFtyb2xlcywgc2V0Um9sZXNdID0gdXNlU3RhdGUoW10pO1xuICAgIGNvbnN0IHNhdmVMYWJlbCA9IG9ubHlBcHBseSA/IHQoJ0FwcGx5JykgOiB0KCdTYXZlJyk7XG4gICAgY29uc3QgW3RhZ3MsIHNldFRhZ3NdID0gdXNlU3RhdGUoW10pO1xuICAgIGNvbnN0IGNhdGVnb3JpY2FsU2NoZW1lUmVnaXN0cnkgPSBnZXRDYXRlZ29yaWNhbFNjaGVtZVJlZ2lzdHJ5KCk7XG4gICAgY29uc3QgdGFnc0FzU2VsZWN0VmFsdWVzID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICAgIGNvbnN0IHNlbGVjdFRhZ3MgPSB0YWdzLm1hcCh0YWcgPT4gKHtcbiAgICAgICAgICAgIHZhbHVlOiB0YWcubmFtZSxcbiAgICAgICAgICAgIGxhYmVsOiB0YWcubmFtZSxcbiAgICAgICAgICAgIGtleTogdGFnLm5hbWUsXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIHNlbGVjdFRhZ3M7XG4gICAgfSwgW3RhZ3MubGVuZ3RoXSk7XG4gICAgY29uc3QgaGFuZGxlRXJyb3JSZXNwb25zZSA9IGFzeW5jIChyZXNwb25zZSkgPT4ge1xuICAgICAgICBjb25zdCB7IGVycm9yLCBzdGF0dXNUZXh0LCBtZXNzYWdlIH0gPSBhd2FpdCBnZXRDbGllbnRFcnJvck9iamVjdChyZXNwb25zZSk7XG4gICAgICAgIGxldCBlcnJvclRleHQgPSBlcnJvciB8fCBzdGF0dXNUZXh0IHx8IHQoJ0FuIGVycm9yIGhhcyBvY2N1cnJlZCcpO1xuICAgICAgICBpZiAodHlwZW9mIG1lc3NhZ2UgPT09ICdvYmplY3QnICYmICdqc29uX21ldGFkYXRhJyBpbiBtZXNzYWdlKSB7XG4gICAgICAgICAgICBlcnJvclRleHQgPSBtZXNzYWdlLmpzb25fbWV0YWRhdGE7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAodHlwZW9mIG1lc3NhZ2UgPT09ICdzdHJpbmcnKSB7XG4gICAgICAgICAgICBlcnJvclRleHQgPSBtZXNzYWdlO1xuICAgICAgICAgICAgaWYgKG1lc3NhZ2UgPT09ICdGb3JiaWRkZW4nKSB7XG4gICAgICAgICAgICAgICAgZXJyb3JUZXh0ID0gdCgnWW91IGRvIG5vdCBoYXZlIHBlcm1pc3Npb24gdG8gZWRpdCB0aGlzIGRhc2hib2FyZCcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIE1vZGFsLmVycm9yKHtcbiAgICAgICAgICAgIHRpdGxlOiB0KCdFcnJvcicpLFxuICAgICAgICAgICAgY29udGVudDogZXJyb3JUZXh0LFxuICAgICAgICAgICAgb2tCdXR0b25Qcm9wczogeyBkYW5nZXI6IHRydWUsIGNsYXNzTmFtZTogJ2J0bi1kYW5nZXInIH0sXG4gICAgICAgIH0pO1xuICAgIH07XG4gICAgY29uc3QgbG9hZEFjY2Vzc09wdGlvbnMgPSB1c2VDYWxsYmFjaygoYWNjZXNzVHlwZSA9ICdvd25lcnMnLCBpbnB1dCA9ICcnLCBwYWdlLCBwYWdlU2l6ZSkgPT4ge1xuICAgICAgICBjb25zdCBxdWVyeSA9IHJpc29uLmVuY29kZSh7XG4gICAgICAgICAgICBmaWx0ZXI6IGlucHV0LFxuICAgICAgICAgICAgcGFnZSxcbiAgICAgICAgICAgIHBhZ2Vfc2l6ZTogcGFnZVNpemUsXG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gU3VwZXJzZXRDbGllbnQuZ2V0KHtcbiAgICAgICAgICAgIGVuZHBvaW50OiBgL2FwaS92MS9kYXNoYm9hcmQvcmVsYXRlZC8ke2FjY2Vzc1R5cGV9P3E9JHtxdWVyeX1gLFxuICAgICAgICB9KS50aGVuKHJlc3BvbnNlID0+ICh7XG4gICAgICAgICAgICBkYXRhOiByZXNwb25zZS5qc29uLnJlc3VsdFxuICAgICAgICAgICAgICAgIC5maWx0ZXIoKGl0ZW0pID0+IGl0ZW0uZXh0cmEuYWN0aXZlICE9PSB1bmRlZmluZWQgPyBpdGVtLmV4dHJhLmFjdGl2ZSA6IHRydWUpXG4gICAgICAgICAgICAgICAgLm1hcCgoaXRlbSkgPT4gKHtcbiAgICAgICAgICAgICAgICB2YWx1ZTogaXRlbS52YWx1ZSxcbiAgICAgICAgICAgICAgICBsYWJlbDogaXRlbS50ZXh0LFxuICAgICAgICAgICAgfSkpLFxuICAgICAgICAgICAgdG90YWxDb3VudDogcmVzcG9uc2UuanNvbi5jb3VudCxcbiAgICAgICAgfSkpO1xuICAgIH0sIFtdKTtcbiAgICBjb25zdCBoYW5kbGVEYXNoYm9hcmREYXRhID0gdXNlQ2FsbGJhY2soZGFzaGJvYXJkRGF0YSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaWQsIGRhc2hib2FyZF90aXRsZSwgc2x1ZywgY2VydGlmaWVkX2J5LCBjZXJ0aWZpY2F0aW9uX2RldGFpbHMsIG93bmVycywgcm9sZXMsIG1ldGFkYXRhLCBpc19tYW5hZ2VkX2V4dGVybmFsbHksIH0gPSBkYXNoYm9hcmREYXRhO1xuICAgICAgICBjb25zdCBkYXNoYm9hcmRJbmZvID0ge1xuICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICB0aXRsZTogZGFzaGJvYXJkX3RpdGxlLFxuICAgICAgICAgICAgc2x1Zzogc2x1ZyB8fCAnJyxcbiAgICAgICAgICAgIGNlcnRpZmllZEJ5OiBjZXJ0aWZpZWRfYnkgfHwgJycsXG4gICAgICAgICAgICBjZXJ0aWZpY2F0aW9uRGV0YWlsczogY2VydGlmaWNhdGlvbl9kZXRhaWxzIHx8ICcnLFxuICAgICAgICAgICAgaXNNYW5hZ2VkRXh0ZXJuYWxseTogaXNfbWFuYWdlZF9leHRlcm5hbGx5IHx8IGZhbHNlLFxuICAgICAgICB9O1xuICAgICAgICBmb3JtLnNldEZpZWxkc1ZhbHVlKGRhc2hib2FyZEluZm8pO1xuICAgICAgICBzZXREYXNoYm9hcmRJbmZvKGRhc2hib2FyZEluZm8pO1xuICAgICAgICBzZXRPd25lcnMob3duZXJzKTtcbiAgICAgICAgc2V0Um9sZXMocm9sZXMpO1xuICAgICAgICBzZXRDb2xvclNjaGVtZShtZXRhZGF0YS5jb2xvcl9zY2hlbWUpO1xuICAgICAgICAvLyB0ZW1wb3JhcnkgZml4IHRvIHJlbW92ZSBwb3NpdGlvbnMgZnJvbSBkYXNoYm9hcmRzJyBtZXRhZGF0YVxuICAgICAgICBpZiAobWV0YWRhdGE/LnBvc2l0aW9ucykge1xuICAgICAgICAgICAgZGVsZXRlIG1ldGFkYXRhLnBvc2l0aW9ucztcbiAgICAgICAgfVxuICAgICAgICBjb25zdCBtZXRhRGF0YUNvcHkgPSB7IC4uLm1ldGFkYXRhIH07XG4gICAgICAgIGRlbGV0ZSBtZXRhRGF0YUNvcHkuc2hhcmVkX2xhYmVsX2NvbG9ycztcbiAgICAgICAgZGVsZXRlIG1ldGFEYXRhQ29weS5jb2xvcl9zY2hlbWVfZG9tYWluO1xuICAgICAgICBzZXRKc29uTWV0YWRhdGEobWV0YURhdGFDb3B5ID8ganNvblN0cmluZ2lmeShtZXRhRGF0YUNvcHkpIDogJycpO1xuICAgIH0sIFtmb3JtXSk7XG4gICAgY29uc3QgZmV0Y2hEYXNoYm9hcmREZXRhaWxzID0gdXNlQ2FsbGJhY2soKCkgPT4ge1xuICAgICAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7XG4gICAgICAgIC8vIFdlIGZldGNoIHRoZSBkYXNoYm9hcmQgZGV0YWlscyBiZWNhdXNlIG5vdCBhbGwgY29kZVxuICAgICAgICAvLyB0aGF0IHJlbmRlcnMgdGhpcyBjb21wb25lbnQgaGF2ZSBhbGwgdGhlIHZhbHVlcyB3ZSBuZWVkLlxuICAgICAgICAvLyBBdCBzb21lIHBvaW50IHdoZW4gd2UgaGF2ZSBhIG1vcmUgY29uc2lzdGVudCBmcm9udGVuZFxuICAgICAgICAvLyBkYXRhbW9kZWwsIHRoZSBkYXNoYm9hcmQgY291bGQgcHJvYmFibHkganVzdCBiZSBwYXNzZWQgYXMgYSBwcm9wLlxuICAgICAgICBTdXBlcnNldENsaWVudC5nZXQoe1xuICAgICAgICAgICAgZW5kcG9pbnQ6IGAvYXBpL3YxL2Rhc2hib2FyZC8ke2Rhc2hib2FyZElkfWAsXG4gICAgICAgIH0pLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgY29uc3QgZGFzaGJvYXJkID0gcmVzcG9uc2UuanNvbi5yZXN1bHQ7XG4gICAgICAgICAgICBjb25zdCBqc29uTWV0YWRhdGFPYmogPSBkYXNoYm9hcmQuanNvbl9tZXRhZGF0YT8ubGVuZ3RoXG4gICAgICAgICAgICAgICAgPyBKU09OLnBhcnNlKGRhc2hib2FyZC5qc29uX21ldGFkYXRhKVxuICAgICAgICAgICAgICAgIDoge307XG4gICAgICAgICAgICBoYW5kbGVEYXNoYm9hcmREYXRhKHtcbiAgICAgICAgICAgICAgICAuLi5kYXNoYm9hcmQsXG4gICAgICAgICAgICAgICAgbWV0YWRhdGE6IGpzb25NZXRhZGF0YU9iaixcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2V0SXNMb2FkaW5nKGZhbHNlKTtcbiAgICAgICAgfSwgaGFuZGxlRXJyb3JSZXNwb25zZSk7XG4gICAgfSwgW2Rhc2hib2FyZElkLCBoYW5kbGVEYXNoYm9hcmREYXRhXSk7XG4gICAgY29uc3QgZ2V0SnNvbk1ldGFkYXRhID0gKCkgPT4ge1xuICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29uc3QganNvbk1ldGFkYXRhT2JqID0ganNvbk1ldGFkYXRhPy5sZW5ndGhcbiAgICAgICAgICAgICAgICA/IEpTT04ucGFyc2UoanNvbk1ldGFkYXRhKVxuICAgICAgICAgICAgICAgIDoge307XG4gICAgICAgICAgICByZXR1cm4ganNvbk1ldGFkYXRhT2JqO1xuICAgICAgICB9XG4gICAgICAgIGNhdGNoIChfKSB7XG4gICAgICAgICAgICByZXR1cm4ge307XG4gICAgICAgIH1cbiAgICB9O1xuICAgIGNvbnN0IGhhbmRsZU9uQ2hhbmdlT3duZXJzID0gKG93bmVycykgPT4ge1xuICAgICAgICBjb25zdCBwYXJzZWRPd25lcnMgPSBlbnN1cmVJc0FycmF5KG93bmVycykubWFwKG8gPT4gKHtcbiAgICAgICAgICAgIGlkOiBvLnZhbHVlLFxuICAgICAgICAgICAgZnVsbF9uYW1lOiBvLmxhYmVsLFxuICAgICAgICB9KSk7XG4gICAgICAgIHNldE93bmVycyhwYXJzZWRPd25lcnMpO1xuICAgIH07XG4gICAgY29uc3QgaGFuZGxlT25DaGFuZ2VSb2xlcyA9IChyb2xlcykgPT4ge1xuICAgICAgICBjb25zdCBwYXJzZWRSb2xlcyA9IGVuc3VyZUlzQXJyYXkocm9sZXMpLm1hcChyID0+ICh7XG4gICAgICAgICAgICBpZDogci52YWx1ZSxcbiAgICAgICAgICAgIG5hbWU6IHIubGFiZWwsXG4gICAgICAgIH0pKTtcbiAgICAgICAgc2V0Um9sZXMocGFyc2VkUm9sZXMpO1xuICAgIH07XG4gICAgY29uc3QgaGFuZGxlT3duZXJzU2VsZWN0VmFsdWUgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhcnNlZE93bmVycyA9IChvd25lcnMgfHwgW10pLm1hcCgob3duZXIpID0+ICh7XG4gICAgICAgICAgICB2YWx1ZTogb3duZXIuaWQsXG4gICAgICAgICAgICBsYWJlbDogb3duZXIuZnVsbF9uYW1lIHx8IGAke293bmVyLmZpcnN0X25hbWV9ICR7b3duZXIubGFzdF9uYW1lfWAsXG4gICAgICAgIH0pKTtcbiAgICAgICAgcmV0dXJuIHBhcnNlZE93bmVycztcbiAgICB9O1xuICAgIGNvbnN0IGhhbmRsZVJvbGVzU2VsZWN0VmFsdWUgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHBhcnNlZFJvbGVzID0gKHJvbGVzIHx8IFtdKS5tYXAoKHJvbGUpID0+ICh7XG4gICAgICAgICAgICB2YWx1ZTogcm9sZS5pZCxcbiAgICAgICAgICAgIGxhYmVsOiBgJHtyb2xlLm5hbWV9YCxcbiAgICAgICAgfSkpO1xuICAgICAgICByZXR1cm4gcGFyc2VkUm9sZXM7XG4gICAgfTtcbiAgICBjb25zdCBvbkNvbG9yU2NoZW1lQ2hhbmdlID0gKGNvbG9yU2NoZW1lID0gJycsIHsgdXBkYXRlTWV0YWRhdGEgPSB0cnVlIH0gPSB7fSkgPT4ge1xuICAgICAgICAvLyBjaGVjayB0aGF0IGNvbG9yX3NjaGVtZSBpcyB2YWxpZFxuICAgICAgICBjb25zdCBjb2xvckNob2ljZXMgPSBjYXRlZ29yaWNhbFNjaGVtZVJlZ2lzdHJ5LmtleXMoKTtcbiAgICAgICAgY29uc3QganNvbk1ldGFkYXRhT2JqID0gZ2V0SnNvbk1ldGFkYXRhKCk7XG4gICAgICAgIC8vIG9ubHkgZmlyZSBpZiB0aGUgY29sb3Jfc2NoZW1lIGlzIHByZXNlbnQgYW5kIGludmFsaWRcbiAgICAgICAgaWYgKGNvbG9yU2NoZW1lICYmICFjb2xvckNob2ljZXMuaW5jbHVkZXMoY29sb3JTY2hlbWUpKSB7XG4gICAgICAgICAgICBNb2RhbC5lcnJvcih7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHQoJ0Vycm9yJyksXG4gICAgICAgICAgICAgICAgY29udGVudDogdCgnQSB2YWxpZCBjb2xvciBzY2hlbWUgaXMgcmVxdWlyZWQnKSxcbiAgICAgICAgICAgICAgICBva0J1dHRvblByb3BzOiB7IGRhbmdlcjogdHJ1ZSwgY2xhc3NOYW1lOiAnYnRuLWRhbmdlcicgfSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdBIHZhbGlkIGNvbG9yIHNjaGVtZSBpcyByZXF1aXJlZCcpO1xuICAgICAgICB9XG4gICAgICAgIC8vIHVwZGF0ZSBtZXRhZGF0YSB0byBtYXRjaCBzZWxlY3Rpb25cbiAgICAgICAgaWYgKHVwZGF0ZU1ldGFkYXRhKSB7XG4gICAgICAgICAgICBqc29uTWV0YWRhdGFPYmouY29sb3Jfc2NoZW1lID0gY29sb3JTY2hlbWU7XG4gICAgICAgICAgICBqc29uTWV0YWRhdGFPYmoubGFiZWxfY29sb3JzID0ganNvbk1ldGFkYXRhT2JqLmxhYmVsX2NvbG9ycyB8fCB7fTtcbiAgICAgICAgICAgIHNldEpzb25NZXRhZGF0YShqc29uU3RyaW5naWZ5KGpzb25NZXRhZGF0YU9iaikpO1xuICAgICAgICB9XG4gICAgICAgIHNldENvbG9yU2NoZW1lKGNvbG9yU2NoZW1lKTtcbiAgICB9O1xuICAgIGNvbnN0IHVwZGF0ZVRhZ3MgPSAob2xkVGFncywgbmV3VGFncykgPT4ge1xuICAgICAgICAvLyB1cGRhdGUgdGhlIHRhZ3MgZm9yIHRoaXMgb2JqZWN0XG4gICAgICAgIC8vIGFkZCB0YWdzIHRoYXQgYXJlIGluIG5ldyB0YWdzLCBidXQgbm90IGluIG9sZCB0YWdzXG4gICAgICAgIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBhcnJheS1jYWxsYmFjay1yZXR1cm5cbiAgICAgICAgbmV3VGFncy5tYXAoKHRhZykgPT4ge1xuICAgICAgICAgICAgaWYgKCFvbGRUYWdzLnNvbWUodCA9PiB0Lm5hbWUgPT09IHRhZy5uYW1lKSkge1xuICAgICAgICAgICAgICAgIGFkZFRhZyh7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdFR5cGU6IE9CSkVDVF9UWVBFUy5EQVNIQk9BUkQsXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdElkOiBkYXNoYm9hcmRJZCxcbiAgICAgICAgICAgICAgICAgICAgaW5jbHVkZVR5cGVzOiBmYWxzZSxcbiAgICAgICAgICAgICAgICB9LCB0YWcubmFtZSwgKCkgPT4geyB9LCAoKSA9PiB7IH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gZGVsZXRlIHRhZ3MgdGhhdCBhcmUgaW4gb2xkIHRhZ3MsIGJ1dCBub3QgaW4gbmV3IHRhZ3NcbiAgICAgICAgLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIGFycmF5LWNhbGxiYWNrLXJldHVyblxuICAgICAgICBvbGRUYWdzLm1hcCgodGFnKSA9PiB7XG4gICAgICAgICAgICBpZiAoIW5ld1RhZ3Muc29tZSh0ID0+IHQubmFtZSA9PT0gdGFnLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgZGVsZXRlVGFnZ2VkT2JqZWN0cyh7XG4gICAgICAgICAgICAgICAgICAgIG9iamVjdFR5cGU6IE9CSkVDVF9UWVBFUy5EQVNIQk9BUkQsXG4gICAgICAgICAgICAgICAgICAgIG9iamVjdElkOiBkYXNoYm9hcmRJZCxcbiAgICAgICAgICAgICAgICB9LCB0YWcsICgpID0+IHsgfSwgKCkgPT4geyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBjb25zdCBvbkZpbmlzaCA9ICgpID0+IHtcbiAgICAgICAgY29uc3QgeyB0aXRsZSwgc2x1ZywgY2VydGlmaWVkQnksIGNlcnRpZmljYXRpb25EZXRhaWxzIH0gPSBmb3JtLmdldEZpZWxkc1ZhbHVlKCk7XG4gICAgICAgIGxldCBjdXJyZW50Q29sb3JTY2hlbWUgPSBjb2xvclNjaGVtZTtcbiAgICAgICAgbGV0IGNvbG9yTmFtZXNwYWNlID0gJyc7XG4gICAgICAgIGxldCBjdXJyZW50SnNvbk1ldGFkYXRhID0ganNvbk1ldGFkYXRhO1xuICAgICAgICAvLyB2YWxpZGF0ZSBjdXJyZW50SnNvbk1ldGFkYXRhXG4gICAgICAgIGxldCBtZXRhZGF0YTtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGlmICghY3VycmVudEpzb25NZXRhZGF0YS5zdGFydHNXaXRoKCd7JykgfHxcbiAgICAgICAgICAgICAgICAhY3VycmVudEpzb25NZXRhZGF0YS5lbmRzV2l0aCgnfScpKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBtZXRhZGF0YSA9IEpTT04ucGFyc2UoY3VycmVudEpzb25NZXRhZGF0YSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBhZGREYW5nZXJUb2FzdCh0KCdKU09OIG1ldGFkYXRhIGlzIGludmFsaWQhJykpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIGNvbG9yIHNjaGVtZSBpbiBqc29uIG1ldGFkYXRhIGhhcyBwcmVjZWRlbmNlIG92ZXIgc2VsZWN0aW9uXG4gICAgICAgIGN1cnJlbnRDb2xvclNjaGVtZSA9IG1ldGFkYXRhPy5jb2xvcl9zY2hlbWUgfHwgY29sb3JTY2hlbWU7XG4gICAgICAgIGNvbG9yTmFtZXNwYWNlID0gbWV0YWRhdGE/LmNvbG9yX25hbWVzcGFjZTtcbiAgICAgICAgLy8gZmlsdGVyIHNoYXJlZF9sYWJlbF9jb2xvciBmcm9tIHVzZXIgaW5wdXRcbiAgICAgICAgaWYgKG1ldGFkYXRhPy5zaGFyZWRfbGFiZWxfY29sb3JzKSB7XG4gICAgICAgICAgICBkZWxldGUgbWV0YWRhdGEuc2hhcmVkX2xhYmVsX2NvbG9ycztcbiAgICAgICAgfVxuICAgICAgICBpZiAobWV0YWRhdGE/LmNvbG9yX3NjaGVtZV9kb21haW4pIHtcbiAgICAgICAgICAgIGRlbGV0ZSBtZXRhZGF0YS5jb2xvcl9zY2hlbWVfZG9tYWluO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IHNoYXJlZExhYmVsQ29sb3IgPSBnZXRTaGFyZWRMYWJlbENvbG9yKCk7XG4gICAgICAgIGNvbnN0IGNhdGVnb3JpY2FsTmFtZXNwYWNlID0gQ2F0ZWdvcmljYWxDb2xvck5hbWVzcGFjZS5nZXROYW1lc3BhY2UoY29sb3JOYW1lc3BhY2UpO1xuICAgICAgICBjYXRlZ29yaWNhbE5hbWVzcGFjZS5yZXNldENvbG9ycygpO1xuICAgICAgICBpZiAoY3VycmVudENvbG9yU2NoZW1lKSB7XG4gICAgICAgICAgICBzaGFyZWRMYWJlbENvbG9yLnVwZGF0ZUNvbG9yTWFwKGNvbG9yTmFtZXNwYWNlLCBjdXJyZW50Q29sb3JTY2hlbWUpO1xuICAgICAgICAgICAgbWV0YWRhdGEuc2hhcmVkX2xhYmVsX2NvbG9ycyA9IE9iamVjdC5mcm9tRW50cmllcyhzaGFyZWRMYWJlbENvbG9yLmdldENvbG9yTWFwKCkpO1xuICAgICAgICAgICAgbWV0YWRhdGEuY29sb3Jfc2NoZW1lX2RvbWFpbiA9XG4gICAgICAgICAgICAgICAgY2F0ZWdvcmljYWxTY2hlbWVSZWdpc3RyeS5nZXQoY29sb3JTY2hlbWUpPy5jb2xvcnMgfHwgW107XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBzaGFyZWRMYWJlbENvbG9yLnJlc2V0KCk7XG4gICAgICAgICAgICBtZXRhZGF0YS5zaGFyZWRfbGFiZWxfY29sb3JzID0ge307XG4gICAgICAgICAgICBtZXRhZGF0YS5jb2xvcl9zY2hlbWVfZG9tYWluID0gW107XG4gICAgICAgIH1cbiAgICAgICAgY3VycmVudEpzb25NZXRhZGF0YSA9IGpzb25TdHJpbmdpZnkobWV0YWRhdGEpO1xuICAgICAgICBvbkNvbG9yU2NoZW1lQ2hhbmdlKGN1cnJlbnRDb2xvclNjaGVtZSwge1xuICAgICAgICAgICAgdXBkYXRlTWV0YWRhdGE6IGZhbHNlLFxuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGlzRmVhdHVyZUVuYWJsZWQoRmVhdHVyZUZsYWcuVEFHR0lOR19TWVNURU0pKSB7XG4gICAgICAgICAgICAvLyB1cGRhdGUgdGFnc1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBmZXRjaFRhZ3Moe1xuICAgICAgICAgICAgICAgICAgICBvYmplY3RUeXBlOiBPQkpFQ1RfVFlQRVMuREFTSEJPQVJELFxuICAgICAgICAgICAgICAgICAgICBvYmplY3RJZDogZGFzaGJvYXJkSWQsXG4gICAgICAgICAgICAgICAgICAgIGluY2x1ZGVUeXBlczogZmFsc2UsXG4gICAgICAgICAgICAgICAgfSwgKGN1cnJlbnRUYWdzKSA9PiB1cGRhdGVUYWdzKGN1cnJlbnRUYWdzLCB0YWdzKSwgZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgICAgICBoYW5kbGVFcnJvclJlc3BvbnNlKGVycm9yKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlcnJvcikge1xuICAgICAgICAgICAgICAgIGhhbmRsZUVycm9yUmVzcG9uc2UoZXJyb3IpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG1vcmVPblN1Ym1pdFByb3BzID0ge307XG4gICAgICAgIGNvbnN0IG1vcmVQdXRQcm9wcyA9IHt9O1xuICAgICAgICBpZiAoaXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5EQVNIQk9BUkRfUkJBQykpIHtcbiAgICAgICAgICAgIG1vcmVPblN1Ym1pdFByb3BzLnJvbGVzID0gcm9sZXM7XG4gICAgICAgICAgICBtb3JlUHV0UHJvcHMucm9sZXMgPSAocm9sZXMgfHwgW10pLm1hcChyID0+IHIuaWQpO1xuICAgICAgICB9XG4gICAgICAgIGNvbnN0IG9uU3VibWl0UHJvcHMgPSB7XG4gICAgICAgICAgICBpZDogZGFzaGJvYXJkSWQsXG4gICAgICAgICAgICB0aXRsZSxcbiAgICAgICAgICAgIHNsdWcsXG4gICAgICAgICAgICBqc29uTWV0YWRhdGE6IGN1cnJlbnRKc29uTWV0YWRhdGEsXG4gICAgICAgICAgICBvd25lcnMsXG4gICAgICAgICAgICBjb2xvclNjaGVtZTogY3VycmVudENvbG9yU2NoZW1lLFxuICAgICAgICAgICAgY29sb3JOYW1lc3BhY2UsXG4gICAgICAgICAgICBjZXJ0aWZpZWRCeSxcbiAgICAgICAgICAgIGNlcnRpZmljYXRpb25EZXRhaWxzLFxuICAgICAgICAgICAgLi4ubW9yZU9uU3VibWl0UHJvcHMsXG4gICAgICAgIH07XG4gICAgICAgIGlmIChvbmx5QXBwbHkpIHtcbiAgICAgICAgICAgIG9uU3VibWl0KG9uU3VibWl0UHJvcHMpO1xuICAgICAgICAgICAgb25IaWRlKCk7XG4gICAgICAgICAgICBhZGRTdWNjZXNzVG9hc3QodCgnRGFzaGJvYXJkIHByb3BlcnRpZXMgdXBkYXRlZCcpKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIFN1cGVyc2V0Q2xpZW50LnB1dCh7XG4gICAgICAgICAgICAgICAgZW5kcG9pbnQ6IGAvYXBpL3YxL2Rhc2hib2FyZC8ke2Rhc2hib2FyZElkfWAsXG4gICAgICAgICAgICAgICAgaGVhZGVyczogeyAnQ29udGVudC1UeXBlJzogJ2FwcGxpY2F0aW9uL2pzb24nIH0sXG4gICAgICAgICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICAgICAgICAgICAgICBkYXNoYm9hcmRfdGl0bGU6IHRpdGxlLFxuICAgICAgICAgICAgICAgICAgICBzbHVnOiBzbHVnIHx8IG51bGwsXG4gICAgICAgICAgICAgICAgICAgIGpzb25fbWV0YWRhdGE6IGN1cnJlbnRKc29uTWV0YWRhdGEgfHwgbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgb3duZXJzOiAob3duZXJzIHx8IFtdKS5tYXAobyA9PiBvLmlkKSxcbiAgICAgICAgICAgICAgICAgICAgY2VydGlmaWVkX2J5OiBjZXJ0aWZpZWRCeSB8fCBudWxsLFxuICAgICAgICAgICAgICAgICAgICBjZXJ0aWZpY2F0aW9uX2RldGFpbHM6IGNlcnRpZmllZEJ5ICYmIGNlcnRpZmljYXRpb25EZXRhaWxzID8gY2VydGlmaWNhdGlvbkRldGFpbHMgOiBudWxsLFxuICAgICAgICAgICAgICAgICAgICAuLi5tb3JlUHV0UHJvcHMsXG4gICAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICB9KS50aGVuKCgpID0+IHtcbiAgICAgICAgICAgICAgICBvblN1Ym1pdChvblN1Ym1pdFByb3BzKTtcbiAgICAgICAgICAgICAgICBvbkhpZGUoKTtcbiAgICAgICAgICAgICAgICBhZGRTdWNjZXNzVG9hc3QodCgnVGhlIGRhc2hib2FyZCBoYXMgYmVlbiBzYXZlZCcpKTtcbiAgICAgICAgICAgIH0sIGhhbmRsZUVycm9yUmVzcG9uc2UpO1xuICAgICAgICB9XG4gICAgfTtcbiAgICBjb25zdCBnZXRSb3dzV2l0aG91dFJvbGVzID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBqc29uTWV0YWRhdGFPYmogPSBnZXRKc29uTWV0YWRhdGEoKTtcbiAgICAgICAgY29uc3QgaGFzQ3VzdG9tTGFiZWxDb2xvcnMgPSAhIU9iamVjdC5rZXlzKGpzb25NZXRhZGF0YU9iaj8ubGFiZWxfY29sb3JzIHx8IHt9KS5sZW5ndGg7XG4gICAgICAgIHJldHVybiAoPFJvdyBndXR0ZXI9ezE2fT5cbiAgICAgICAgPENvbCB4cz17MjR9IG1kPXsxMn0+XG4gICAgICAgICAgPGgzIHN0eWxlPXt7IG1hcmdpblRvcDogJzFlbScgfX0+e3QoJ0FjY2VzcycpfTwvaDM+XG4gICAgICAgICAgPFN0eWxlZEZvcm1JdGVtIGxhYmVsPXt0KCdPd25lcnMnKX0+XG4gICAgICAgICAgICA8QXN5bmNTZWxlY3QgYWxsb3dDbGVhciBhcmlhTGFiZWw9e3QoJ093bmVycycpfSBkaXNhYmxlZD17aXNMb2FkaW5nfSBtb2RlPVwibXVsdGlwbGVcIiBvbkNoYW5nZT17aGFuZGxlT25DaGFuZ2VPd25lcnN9IG9wdGlvbnM9eyhpbnB1dCwgcGFnZSwgcGFnZVNpemUpID0+IGxvYWRBY2Nlc3NPcHRpb25zKCdvd25lcnMnLCBpbnB1dCwgcGFnZSwgcGFnZVNpemUpfSB2YWx1ZT17aGFuZGxlT3duZXJzU2VsZWN0VmFsdWUoKX0vPlxuICAgICAgICAgIDwvU3R5bGVkRm9ybUl0ZW0+XG4gICAgICAgICAgPHAgY2xhc3NOYW1lPVwiaGVscC1ibG9ja1wiPlxuICAgICAgICAgICAge3QoJ093bmVycyBpcyBhIGxpc3Qgb2YgdXNlcnMgd2hvIGNhbiBhbHRlciB0aGUgZGFzaGJvYXJkLiBTZWFyY2hhYmxlIGJ5IG5hbWUgb3IgdXNlcm5hbWUuJyl9XG4gICAgICAgICAgPC9wPlxuICAgICAgICA8L0NvbD5cbiAgICAgICAgPENvbCB4cz17MjR9IG1kPXsxMn0+XG4gICAgICAgICAgPGgzIHN0eWxlPXt7IG1hcmdpblRvcDogJzFlbScgfX0+e3QoJ0NvbG9ycycpfTwvaDM+XG4gICAgICAgICAgPENvbG9yU2NoZW1lQ29udHJvbFdyYXBwZXIgaGFzQ3VzdG9tTGFiZWxDb2xvcnM9e2hhc0N1c3RvbUxhYmVsQ29sb3JzfSBvbkNoYW5nZT17b25Db2xvclNjaGVtZUNoYW5nZX0gY29sb3JTY2hlbWU9e2NvbG9yU2NoZW1lfSBsYWJlbE1hcmdpbj17NH0vPlxuICAgICAgICA8L0NvbD5cbiAgICAgIDwvUm93Pik7XG4gICAgfTtcbiAgICBjb25zdCBnZXRSb3dzV2l0aFJvbGVzID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBqc29uTWV0YWRhdGFPYmogPSBnZXRKc29uTWV0YWRhdGEoKTtcbiAgICAgICAgY29uc3QgaGFzQ3VzdG9tTGFiZWxDb2xvcnMgPSAhIU9iamVjdC5rZXlzKGpzb25NZXRhZGF0YU9iaj8ubGFiZWxfY29sb3JzIHx8IHt9KS5sZW5ndGg7XG4gICAgICAgIHJldHVybiAoPD5cbiAgICAgICAgPFJvdz5cbiAgICAgICAgICA8Q29sIHhzPXsyNH0gbWQ9ezI0fT5cbiAgICAgICAgICAgIDxoMyBzdHlsZT17eyBtYXJnaW5Ub3A6ICcxZW0nIH19Pnt0KCdBY2Nlc3MnKX08L2gzPlxuICAgICAgICAgIDwvQ29sPlxuICAgICAgICA8L1Jvdz5cbiAgICAgICAgPFJvdyBndXR0ZXI9ezE2fT5cbiAgICAgICAgICA8Q29sIHhzPXsyNH0gbWQ9ezEyfT5cbiAgICAgICAgICAgIDxTdHlsZWRGb3JtSXRlbSBsYWJlbD17dCgnT3duZXJzJyl9PlxuICAgICAgICAgICAgICA8QXN5bmNTZWxlY3QgYWxsb3dDbGVhciBhbGxvd05ld09wdGlvbnMgYXJpYUxhYmVsPXt0KCdPd25lcnMnKX0gZGlzYWJsZWQ9e2lzTG9hZGluZ30gbW9kZT1cIm11bHRpcGxlXCIgb25DaGFuZ2U9e2hhbmRsZU9uQ2hhbmdlT3duZXJzfSBvcHRpb25zPXsoaW5wdXQsIHBhZ2UsIHBhZ2VTaXplKSA9PiBsb2FkQWNjZXNzT3B0aW9ucygnb3duZXJzJywgaW5wdXQsIHBhZ2UsIHBhZ2VTaXplKX0gdmFsdWU9e2hhbmRsZU93bmVyc1NlbGVjdFZhbHVlKCl9Lz5cbiAgICAgICAgICAgIDwvU3R5bGVkRm9ybUl0ZW0+XG4gICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJoZWxwLWJsb2NrXCI+XG4gICAgICAgICAgICAgIHt0KCdPd25lcnMgaXMgYSBsaXN0IG9mIHVzZXJzIHdobyBjYW4gYWx0ZXIgdGhlIGRhc2hib2FyZC4gU2VhcmNoYWJsZSBieSBuYW1lIG9yIHVzZXJuYW1lLicpfVxuICAgICAgICAgICAgPC9wPlxuICAgICAgICAgIDwvQ29sPlxuICAgICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MTJ9PlxuICAgICAgICAgICAgPFN0eWxlZEZvcm1JdGVtIGxhYmVsPXt0KCdSb2xlcycpfT5cbiAgICAgICAgICAgICAgPEFzeW5jU2VsZWN0IGFsbG93Q2xlYXIgYXJpYUxhYmVsPXt0KCdSb2xlcycpfSBkaXNhYmxlZD17aXNMb2FkaW5nfSBtb2RlPVwibXVsdGlwbGVcIiBvbkNoYW5nZT17aGFuZGxlT25DaGFuZ2VSb2xlc30gb3B0aW9ucz17KGlucHV0LCBwYWdlLCBwYWdlU2l6ZSkgPT4gbG9hZEFjY2Vzc09wdGlvbnMoJ3JvbGVzJywgaW5wdXQsIHBhZ2UsIHBhZ2VTaXplKX0gdmFsdWU9e2hhbmRsZVJvbGVzU2VsZWN0VmFsdWUoKX0vPlxuICAgICAgICAgICAgPC9TdHlsZWRGb3JtSXRlbT5cbiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cImhlbHAtYmxvY2tcIj5cbiAgICAgICAgICAgICAge3QoJ1JvbGVzIGlzIGEgbGlzdCB3aGljaCBkZWZpbmVzIGFjY2VzcyB0byB0aGUgZGFzaGJvYXJkLiBHcmFudGluZyBhIHJvbGUgYWNjZXNzIHRvIGEgZGFzaGJvYXJkIHdpbGwgYnlwYXNzIGRhdGFzZXQgbGV2ZWwgY2hlY2tzLiBJZiBubyByb2xlcyBhcmUgZGVmaW5lZCwgcmVndWxhciBhY2Nlc3MgcGVybWlzc2lvbnMgYXBwbHkuJyl9XG4gICAgICAgICAgICA8L3A+XG4gICAgICAgICAgPC9Db2w+XG4gICAgICAgIDwvUm93PlxuICAgICAgICA8Um93PlxuICAgICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MTJ9PlxuICAgICAgICAgICAgPENvbG9yU2NoZW1lQ29udHJvbFdyYXBwZXIgaGFzQ3VzdG9tTGFiZWxDb2xvcnM9e2hhc0N1c3RvbUxhYmVsQ29sb3JzfSBvbkNoYW5nZT17b25Db2xvclNjaGVtZUNoYW5nZX0gY29sb3JTY2hlbWU9e2NvbG9yU2NoZW1lfSBsYWJlbE1hcmdpbj17NH0vPlxuICAgICAgICAgIDwvQ29sPlxuICAgICAgICA8L1Jvdz5cbiAgICAgIDwvPik7XG4gICAgfTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAoc2hvdykge1xuICAgICAgICAgICAgaWYgKCFjdXJyZW50RGFzaGJvYXJkSW5mbykge1xuICAgICAgICAgICAgICAgIGZldGNoRGFzaGJvYXJkRGV0YWlscygpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaGFuZGxlRGFzaGJvYXJkRGF0YShjdXJyZW50RGFzaGJvYXJkSW5mbyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgSnNvbkVkaXRvci5wcmVsb2FkKCk7XG4gICAgfSwgW2N1cnJlbnREYXNoYm9hcmRJbmZvLCBmZXRjaERhc2hib2FyZERldGFpbHMsIGhhbmRsZURhc2hib2FyZERhdGEsIHNob3ddKTtcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICAvLyB0aGUgdGl0bGUgY2FuIGJlIGNoYW5nZWQgaW5saW5lIGluIHRoZSBkYXNoYm9hcmQsIHRoaXMgY2F0Y2hlcyBpdFxuICAgICAgICBpZiAoZGFzaGJvYXJkVGl0bGUgJiZcbiAgICAgICAgICAgIGRhc2hib2FyZEluZm8gJiZcbiAgICAgICAgICAgIGRhc2hib2FyZEluZm8udGl0bGUgIT09IGRhc2hib2FyZFRpdGxlKSB7XG4gICAgICAgICAgICBmb3JtLnNldEZpZWxkc1ZhbHVlKHtcbiAgICAgICAgICAgICAgICAuLi5kYXNoYm9hcmRJbmZvLFxuICAgICAgICAgICAgICAgIHRpdGxlOiBkYXNoYm9hcmRUaXRsZSxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSwgW2Rhc2hib2FyZEluZm8sIGRhc2hib2FyZFRpdGxlLCBmb3JtXSk7XG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCFpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLlRBR0dJTkdfU1lTVEVNKSlcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGZldGNoVGFncyh7XG4gICAgICAgICAgICAgICAgb2JqZWN0VHlwZTogT0JKRUNUX1RZUEVTLkRBU0hCT0FSRCxcbiAgICAgICAgICAgICAgICBvYmplY3RJZDogZGFzaGJvYXJkSWQsXG4gICAgICAgICAgICAgICAgaW5jbHVkZVR5cGVzOiBmYWxzZSxcbiAgICAgICAgICAgIH0sICh0YWdzKSA9PiBzZXRUYWdzKHRhZ3MpLCAoZXJyb3IpID0+IHtcbiAgICAgICAgICAgICAgICBhZGREYW5nZXJUb2FzdChgRXJyb3IgZmV0Y2hpbmcgdGFnczogJHtlcnJvci50ZXh0fWApO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICBoYW5kbGVFcnJvclJlc3BvbnNlKGVycm9yKTtcbiAgICAgICAgfVxuICAgIH0sIFtkYXNoYm9hcmRJZF0pO1xuICAgIGNvbnN0IGhhbmRsZUNoYW5nZVRhZ3MgPSAodmFsdWVzKSA9PiB7XG4gICAgICAgIC8vIHRyaWdnZXJlZCB3aGVuZXZlciBhIG5ldyB0YWcgaXMgc2VsZWN0ZWQgb3IgYSB0YWcgd2FzIGRlc2VsZWN0ZWRcbiAgICAgICAgLy8gb24gbmV3IHRhZyBzZWxlY3RlZCwgYWRkIHRoZSB0YWdcbiAgICAgICAgY29uc3QgdW5pcXVlVGFncyA9IFsuLi5uZXcgU2V0KHZhbHVlcy5tYXAodiA9PiB2LmxhYmVsKSldO1xuICAgICAgICBzZXRUYWdzKFsuLi51bmlxdWVUYWdzLm1hcCh0ID0+ICh7IG5hbWU6IHQgfSkpXSk7XG4gICAgfTtcbiAgICByZXR1cm4gKDxNb2RhbCBzaG93PXtzaG93fSBvbkhpZGU9e29uSGlkZX0gdGl0bGU9e3QoJ0Rhc2hib2FyZCBwcm9wZXJ0aWVzJyl9IGZvb3Rlcj17PD5cbiAgICAgICAgICA8QnV0dG9uIGh0bWxUeXBlPVwiYnV0dG9uXCIgYnV0dG9uU2l6ZT1cInNtYWxsXCIgb25DbGljaz17b25IaWRlfSBkYXRhLXRlc3Q9XCJwcm9wZXJ0aWVzLW1vZGFsLWNhbmNlbC1idXR0b25cIiBjdGE+XG4gICAgICAgICAgICB7dCgnQ2FuY2VsJyl9XG4gICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgPEJ1dHRvbiBkYXRhLXRlc3Q9XCJwcm9wZXJ0aWVzLW1vZGFsLWFwcGx5LWJ1dHRvblwiIG9uQ2xpY2s9e2Zvcm0uc3VibWl0fSBidXR0b25TaXplPVwic21hbGxcIiBidXR0b25TdHlsZT1cInByaW1hcnlcIiBjbGFzc05hbWU9XCJtLXItNVwiIGN0YSBkaXNhYmxlZD17ZGFzaGJvYXJkSW5mbz8uaXNNYW5hZ2VkRXh0ZXJuYWxseX0gdG9vbHRpcD17ZGFzaGJvYXJkSW5mbz8uaXNNYW5hZ2VkRXh0ZXJuYWxseVxuICAgICAgICAgICAgICAgID8gdChcIlRoaXMgZGFzaGJvYXJkIGlzIG1hbmFnZWQgZXh0ZXJuYWxseSwgYW5kIGNhbid0IGJlIGVkaXRlZCBpbiBTdXBlcnNldFwiKVxuICAgICAgICAgICAgICAgIDogJyd9PlxuICAgICAgICAgICAge3NhdmVMYWJlbH1cbiAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgPC8+fSByZXNwb25zaXZlPlxuICAgICAgPEFudGRGb3JtIGZvcm09e2Zvcm19IG9uRmluaXNoPXtvbkZpbmlzaH0gZGF0YS10ZXN0PVwiZGFzaGJvYXJkLWVkaXQtcHJvcGVydGllcy1mb3JtXCIgbGF5b3V0PVwidmVydGljYWxcIiBpbml0aWFsVmFsdWVzPXtkYXNoYm9hcmRJbmZvfT5cbiAgICAgICAgPFJvdz5cbiAgICAgICAgICA8Q29sIHhzPXsyNH0gbWQ9ezI0fT5cbiAgICAgICAgICAgIDxoMz57dCgnQmFzaWMgaW5mb3JtYXRpb24nKX08L2gzPlxuICAgICAgICAgIDwvQ29sPlxuICAgICAgICA8L1Jvdz5cbiAgICAgICAgPFJvdyBndXR0ZXI9ezE2fT5cbiAgICAgICAgICA8Q29sIHhzPXsyNH0gbWQ9ezEyfT5cbiAgICAgICAgICAgIDxGb3JtSXRlbSBsYWJlbD17dCgnVGl0bGUnKX0gbmFtZT1cInRpdGxlXCI+XG4gICAgICAgICAgICAgIDxJbnB1dCBkYXRhLXRlc3Q9XCJkYXNoYm9hcmQtdGl0bGUtaW5wdXRcIiB0eXBlPVwidGV4dFwiIGRpc2FibGVkPXtpc0xvYWRpbmd9Lz5cbiAgICAgICAgICAgIDwvRm9ybUl0ZW0+XG4gICAgICAgICAgPC9Db2w+XG4gICAgICAgICAgPENvbCB4cz17MjR9IG1kPXsxMn0+XG4gICAgICAgICAgICA8U3R5bGVkRm9ybUl0ZW0gbGFiZWw9e3QoJ1VSTCBzbHVnJyl9IG5hbWU9XCJzbHVnXCI+XG4gICAgICAgICAgICAgIDxJbnB1dCB0eXBlPVwidGV4dFwiIGRpc2FibGVkPXtpc0xvYWRpbmd9Lz5cbiAgICAgICAgICAgIDwvU3R5bGVkRm9ybUl0ZW0+XG4gICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJoZWxwLWJsb2NrXCI+XG4gICAgICAgICAgICAgIHt0KCdBIHJlYWRhYmxlIFVSTCBmb3IgeW91ciBkYXNoYm9hcmQnKX1cbiAgICAgICAgICAgIDwvcD5cbiAgICAgICAgICA8L0NvbD5cbiAgICAgICAgPC9Sb3c+XG4gICAgICAgIHtpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLkRBU0hCT0FSRF9SQkFDKVxuICAgICAgICAgICAgPyBnZXRSb3dzV2l0aFJvbGVzKClcbiAgICAgICAgICAgIDogZ2V0Um93c1dpdGhvdXRSb2xlcygpfVxuICAgICAgICA8Um93PlxuICAgICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MjR9PlxuICAgICAgICAgICAgPGgzPnt0KCdDZXJ0aWZpY2F0aW9uJyl9PC9oMz5cbiAgICAgICAgICA8L0NvbD5cbiAgICAgICAgPC9Sb3c+XG4gICAgICAgIDxSb3cgZ3V0dGVyPXsxNn0+XG4gICAgICAgICAgPENvbCB4cz17MjR9IG1kPXsxMn0+XG4gICAgICAgICAgICA8U3R5bGVkRm9ybUl0ZW0gbGFiZWw9e3QoJ0NlcnRpZmllZCBieScpfSBuYW1lPVwiY2VydGlmaWVkQnlcIj5cbiAgICAgICAgICAgICAgPElucHV0IHR5cGU9XCJ0ZXh0XCIgZGlzYWJsZWQ9e2lzTG9hZGluZ30vPlxuICAgICAgICAgICAgPC9TdHlsZWRGb3JtSXRlbT5cbiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cImhlbHAtYmxvY2tcIj5cbiAgICAgICAgICAgICAge3QoJ1BlcnNvbiBvciBncm91cCB0aGF0IGhhcyBjZXJ0aWZpZWQgdGhpcyBkYXNoYm9hcmQuJyl9XG4gICAgICAgICAgICA8L3A+XG4gICAgICAgICAgPC9Db2w+XG4gICAgICAgICAgPENvbCB4cz17MjR9IG1kPXsxMn0+XG4gICAgICAgICAgICA8U3R5bGVkRm9ybUl0ZW0gbGFiZWw9e3QoJ0NlcnRpZmljYXRpb24gZGV0YWlscycpfSBuYW1lPVwiY2VydGlmaWNhdGlvbkRldGFpbHNcIj5cbiAgICAgICAgICAgICAgPElucHV0IHR5cGU9XCJ0ZXh0XCIgZGlzYWJsZWQ9e2lzTG9hZGluZ30vPlxuICAgICAgICAgICAgPC9TdHlsZWRGb3JtSXRlbT5cbiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cImhlbHAtYmxvY2tcIj5cbiAgICAgICAgICAgICAge3QoJ0FueSBhZGRpdGlvbmFsIGRldGFpbCB0byBzaG93IGluIHRoZSBjZXJ0aWZpY2F0aW9uIHRvb2x0aXAuJyl9XG4gICAgICAgICAgICA8L3A+XG4gICAgICAgICAgPC9Db2w+XG4gICAgICAgIDwvUm93PlxuICAgICAgICB7aXNGZWF0dXJlRW5hYmxlZChGZWF0dXJlRmxhZy5UQUdHSU5HX1NZU1RFTSkgPyAoPFJvdyBndXR0ZXI9ezE2fT5cbiAgICAgICAgICAgIDxDb2wgeHM9ezI0fSBtZD17MTJ9PlxuICAgICAgICAgICAgICA8aDMgY3NzPXt7IG1hcmdpblRvcDogJzFlbScgfX0+e3QoJ1RhZ3MnKX08L2gzPlxuICAgICAgICAgICAgPC9Db2w+XG4gICAgICAgICAgPC9Sb3c+KSA6IG51bGx9XG4gICAgICAgIHtpc0ZlYXR1cmVFbmFibGVkKEZlYXR1cmVGbGFnLlRBR0dJTkdfU1lTVEVNKSA/ICg8Um93IGd1dHRlcj17MTZ9PlxuICAgICAgICAgICAgPENvbCB4cz17MjR9IG1kPXsxMn0+XG4gICAgICAgICAgICAgIDxTdHlsZWRGb3JtSXRlbT5cbiAgICAgICAgICAgICAgICA8QXN5bmNTZWxlY3QgYXJpYUxhYmVsPVwiVGFnc1wiIG1vZGU9XCJtdWx0aXBsZVwiIGFsbG93TmV3T3B0aW9ucyB2YWx1ZT17dGFnc0FzU2VsZWN0VmFsdWVzfSBvcHRpb25zPXtsb2FkVGFnc30gb25DaGFuZ2U9e2hhbmRsZUNoYW5nZVRhZ3N9IGFsbG93Q2xlYXIvPlxuICAgICAgICAgICAgICA8L1N0eWxlZEZvcm1JdGVtPlxuICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9XCJoZWxwLWJsb2NrXCI+XG4gICAgICAgICAgICAgICAge3QoJ0EgbGlzdCBvZiB0YWdzIHRoYXQgaGF2ZSBiZWVuIGFwcGxpZWQgdG8gdGhpcyBjaGFydC4nKX1cbiAgICAgICAgICAgICAgPC9wPlxuICAgICAgICAgICAgPC9Db2w+XG4gICAgICAgICAgPC9Sb3c+KSA6IG51bGx9XG4gICAgICAgIDxSb3c+XG4gICAgICAgICAgPENvbCB4cz17MjR9IG1kPXsyNH0+XG4gICAgICAgICAgICA8aDMgc3R5bGU9e3sgbWFyZ2luVG9wOiAnMWVtJyB9fT5cbiAgICAgICAgICAgICAgPEJ1dHRvbiBidXR0b25TdHlsZT1cImxpbmtcIiBvbkNsaWNrPXsoKSA9PiBzZXRJc0FkdmFuY2VkT3BlbighaXNBZHZhbmNlZE9wZW4pfT5cbiAgICAgICAgICAgICAgICA8aSBjbGFzc05hbWU9e2BmYSBmYS1hbmdsZS0ke2lzQWR2YW5jZWRPcGVuID8gJ2Rvd24nIDogJ3JpZ2h0J31gfSBzdHlsZT17eyBtaW5XaWR0aDogJzFlbScgfX0vPlxuICAgICAgICAgICAgICAgIHt0KCdBZHZhbmNlZCcpfVxuICAgICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICAgIDwvaDM+XG4gICAgICAgICAgICB7aXNBZHZhbmNlZE9wZW4gJiYgKDw+XG4gICAgICAgICAgICAgICAgPFN0eWxlZEZvcm1JdGVtIGxhYmVsPXt0KCdKU09OIG1ldGFkYXRhJyl9PlxuICAgICAgICAgICAgICAgICAgPFN0eWxlZEpzb25FZGl0b3Igc2hvd0xvYWRpbmdGb3JJbXBvcnQgbmFtZT1cImpzb25fbWV0YWRhdGFcIiB2YWx1ZT17anNvbk1ldGFkYXRhfSBvbkNoYW5nZT17c2V0SnNvbk1ldGFkYXRhfSB0YWJTaXplPXsyfSB3aWR0aD1cIjEwMCVcIiBoZWlnaHQ9XCIyMDBweFwiIHdyYXBFbmFibGVkLz5cbiAgICAgICAgICAgICAgICA8L1N0eWxlZEZvcm1JdGVtPlxuICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT1cImhlbHAtYmxvY2tcIj5cbiAgICAgICAgICAgICAgICAgIHt0KCdUaGlzIEpTT04gb2JqZWN0IGlzIGdlbmVyYXRlZCBkeW5hbWljYWxseSB3aGVuIGNsaWNraW5nIHRoZSBzYXZlIG9yIG92ZXJ3cml0ZSBidXR0b24gaW4gdGhlIGRhc2hib2FyZCB2aWV3LiBJdCBpcyBleHBvc2VkIGhlcmUgZm9yIHJlZmVyZW5jZSBhbmQgZm9yIHBvd2VyIHVzZXJzIHdobyBtYXkgd2FudCB0byBhbHRlciBzcGVjaWZpYyBwYXJhbWV0ZXJzLicpfVxuICAgICAgICAgICAgICAgICAge29ubHlBcHBseSAmJiAoPD5cbiAgICAgICAgICAgICAgICAgICAgICB7JyAnfVxuICAgICAgICAgICAgICAgICAgICAgIHt0KCdQbGVhc2UgRE8gTk9UIG92ZXJ3cml0ZSB0aGUgXCJmaWx0ZXJfc2NvcGVzXCIga2V5LicpfXsnICd9XG4gICAgICAgICAgICAgICAgICAgICAgPEZpbHRlclNjb3BlTW9kYWwgdHJpZ2dlck5vZGU9ezxzcGFuIGNsYXNzTmFtZT1cImFsZXJ0LWxpbmtcIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7dCgnVXNlIFwiJShtZW51TmFtZSlzXCIgbWVudSBpbnN0ZWFkLicsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lbnVOYW1lOiB0KCdTZXQgZmlsdGVyIG1hcHBpbmcnKSxcbiAgICAgICAgICAgICAgICAgICAgfSl9XG4gICAgICAgICAgICAgICAgICAgICAgICAgIDwvc3Bhbj59Lz5cbiAgICAgICAgICAgICAgICAgICAgPC8+KX1cbiAgICAgICAgICAgICAgICA8L3A+XG4gICAgICAgICAgICAgIDwvPil9XG4gICAgICAgICAgPC9Db2w+XG4gICAgICAgIDwvUm93PlxuICAgICAgPC9BbnRkRm9ybT5cbiAgICA8L01vZGFsPik7XG59O1xuZXhwb3J0IGRlZmF1bHQgd2l0aFRvYXN0cyhQcm9wZXJ0aWVzTW9kYWwpO1xuIl19 */\", toString: _EMOTION_STRINGIFIED_CSS_ERROR__ };\nconst PropertiesModal = (_ref3) => {let { addSuccessToast, addDangerToast, colorScheme: currentColorScheme, dashboardId, dashboardInfo: currentDashboardInfo, dashboardTitle, onHide = () => {}, onlyApply = false, onSubmit = () => {}, show = false } = _ref3;\n  const [form] = AntdForm.useForm();\n  const [isLoading, setIsLoading] = useState(false);\n  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);\n  const [colorScheme, setColorScheme] = useState(currentColorScheme);\n  const [jsonMetadata, setJsonMetadata] = useState('');\n  const [dashboardInfo, setDashboardInfo] = useState();\n  const [owners, setOwners] = useState([]);\n  const [roles, setRoles] = useState([]);\n  const saveLabel = onlyApply ? t('Apply') : t('Save');\n  const [tags, setTags] = useState([]);\n  const categoricalSchemeRegistry = getCategoricalSchemeRegistry();\n  const tagsAsSelectValues = useMemo(() => {\n    const selectTags = tags.map((tag) => ({\n      value: tag.name,\n      label: tag.name,\n      key: tag.name }));\n\n    return selectTags;\n  }, [tags.length]);\n  const handleErrorResponse = async (response) => {\n    const { error, statusText, message } = await getClientErrorObject(response);\n    let errorText = error || statusText || t('An error has occurred');\n    if (typeof message === 'object' && 'json_metadata' in message) {\n      errorText = message.json_metadata;\n    } else\n    if (typeof message === 'string') {\n      errorText = message;\n      if (message === 'Forbidden') {\n        errorText = t('You do not have permission to edit this dashboard');\n      }\n    }\n    Modal.error({\n      title: t('Error'),\n      content: errorText,\n      okButtonProps: { danger: true, className: 'btn-danger' } });\n\n  };\n  const loadAccessOptions = useCallback(function (accessType, input, page, pageSize) {if (accessType === void 0) {accessType = 'owners';}if (input === void 0) {input = '';}\n    const query = rison.encode({\n      filter: input,\n      page,\n      page_size: pageSize });\n\n    return SupersetClient.get({\n      endpoint: `/api/v1/dashboard/related/${accessType}?q=${query}` }).\n    then((response) => ({\n      data: response.json.result.\n      filter((item) => item.extra.active !== undefined ? item.extra.active : true).\n      map((item) => ({\n        value: item.value,\n        label: item.text })),\n\n      totalCount: response.json.count }));\n\n  }, []);\n  const handleDashboardData = useCallback((dashboardData) => {\n    const { id, dashboard_title, slug, certified_by, certification_details, owners, roles, metadata, is_managed_externally } = dashboardData;\n    const dashboardInfo = {\n      id,\n      title: dashboard_title,\n      slug: slug || '',\n      certifiedBy: certified_by || '',\n      certificationDetails: certification_details || '',\n      isManagedExternally: is_managed_externally || false };\n\n    form.setFieldsValue(dashboardInfo);\n    setDashboardInfo(dashboardInfo);\n    setOwners(owners);\n    setRoles(roles);\n    setColorScheme(metadata.color_scheme);\n    // temporary fix to remove positions from dashboards' metadata\n    if (metadata != null && metadata.positions) {\n      delete metadata.positions;\n    }\n    const metaDataCopy = { ...metadata };\n    delete metaDataCopy.shared_label_colors;\n    delete metaDataCopy.color_scheme_domain;\n    setJsonMetadata(metaDataCopy ? jsonStringify(metaDataCopy) : '');\n  }, [form]);\n  const fetchDashboardDetails = useCallback(() => {\n    setIsLoading(true);\n    // We fetch the dashboard details because not all code\n    // that renders this component have all the values we need.\n    // At some point when we have a more consistent frontend\n    // datamodel, the dashboard could probably just be passed as a prop.\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/${dashboardId}` }).\n    then((response) => {var _dashboard$json_metad;\n      const dashboard = response.json.result;\n      const jsonMetadataObj = (_dashboard$json_metad = dashboard.json_metadata) != null && _dashboard$json_metad.length ?\n      JSON.parse(dashboard.json_metadata) :\n      {};\n      handleDashboardData({\n        ...dashboard,\n        metadata: jsonMetadataObj });\n\n      setIsLoading(false);\n    }, handleErrorResponse);\n  }, [dashboardId, handleDashboardData]);\n  const getJsonMetadata = () => {\n    try {\n      const jsonMetadataObj = jsonMetadata != null && jsonMetadata.length ?\n      JSON.parse(jsonMetadata) :\n      {};\n      return jsonMetadataObj;\n    }\n    catch (_) {\n      return {};\n    }\n  };\n  const handleOnChangeOwners = (owners) => {\n    const parsedOwners = ensureIsArray(owners).map((o) => ({\n      id: o.value,\n      full_name: o.label }));\n\n    setOwners(parsedOwners);\n  };\n  const handleOnChangeRoles = (roles) => {\n    const parsedRoles = ensureIsArray(roles).map((r) => ({\n      id: r.value,\n      name: r.label }));\n\n    setRoles(parsedRoles);\n  };\n  const handleOwnersSelectValue = () => {\n    const parsedOwners = (owners || []).map((owner) => ({\n      value: owner.id,\n      label: owner.full_name || `${owner.first_name} ${owner.last_name}` }));\n\n    return parsedOwners;\n  };\n  const handleRolesSelectValue = () => {\n    const parsedRoles = (roles || []).map((role) => ({\n      value: role.id,\n      label: `${role.name}` }));\n\n    return parsedRoles;\n  };\n  const onColorSchemeChange = function (colorScheme, _temp) {if (colorScheme === void 0) {colorScheme = '';}let { updateMetadata = true } = _temp === void 0 ? {} : _temp;\n    // check that color_scheme is valid\n    const colorChoices = categoricalSchemeRegistry.keys();\n    const jsonMetadataObj = getJsonMetadata();\n    // only fire if the color_scheme is present and invalid\n    if (colorScheme && !_includesInstanceProperty(colorChoices).call(colorChoices, colorScheme)) {\n      Modal.error({\n        title: t('Error'),\n        content: t('A valid color scheme is required'),\n        okButtonProps: { danger: true, className: 'btn-danger' } });\n\n      throw new Error('A valid color scheme is required');\n    }\n    // update metadata to match selection\n    if (updateMetadata) {\n      jsonMetadataObj.color_scheme = colorScheme;\n      jsonMetadataObj.label_colors = jsonMetadataObj.label_colors || {};\n      setJsonMetadata(jsonStringify(jsonMetadataObj));\n    }\n    setColorScheme(colorScheme);\n  };\n  const updateTags = (oldTags, newTags) => {\n    // update the tags for this object\n    // add tags that are in new tags, but not in old tags\n    // eslint-disable-next-line array-callback-return\n    newTags.map((tag) => {\n      if (!oldTags.some((t) => t.name === tag.name)) {\n        addTag({\n          objectType: OBJECT_TYPES.DASHBOARD,\n          objectId: dashboardId,\n          includeTypes: false },\n        tag.name, () => {}, () => {});\n      }\n    });\n    // delete tags that are in old tags, but not in new tags\n    // eslint-disable-next-line array-callback-return\n    oldTags.map((tag) => {\n      if (!newTags.some((t) => t.name === tag.name)) {\n        deleteTaggedObjects({\n          objectType: OBJECT_TYPES.DASHBOARD,\n          objectId: dashboardId },\n        tag, () => {}, () => {});\n      }\n    });\n  };\n  const onFinish = () => {var _metadata, _metadata2, _metadata3, _metadata4;\n    const { title, slug, certifiedBy, certificationDetails } = form.getFieldsValue();\n    let currentColorScheme = colorScheme;\n    let colorNamespace = '';\n    let currentJsonMetadata = jsonMetadata;\n    // validate currentJsonMetadata\n    let metadata;\n    try {\n      if (!currentJsonMetadata.startsWith('{') ||\n      !currentJsonMetadata.endsWith('}')) {\n        throw new Error();\n      }\n      metadata = JSON.parse(currentJsonMetadata);\n    }\n    catch (error) {\n      addDangerToast(t('JSON metadata is invalid!'));\n      return;\n    }\n    // color scheme in json metadata has precedence over selection\n    currentColorScheme = ((_metadata = metadata) == null ? void 0 : _metadata.color_scheme) || colorScheme;\n    colorNamespace = (_metadata2 = metadata) == null ? void 0 : _metadata2.color_namespace;\n    // filter shared_label_color from user input\n    if ((_metadata3 = metadata) != null && _metadata3.shared_label_colors) {\n      delete metadata.shared_label_colors;\n    }\n    if ((_metadata4 = metadata) != null && _metadata4.color_scheme_domain) {\n      delete metadata.color_scheme_domain;\n    }\n    const sharedLabelColor = getSharedLabelColor();\n    const categoricalNamespace = CategoricalColorNamespace.getNamespace(colorNamespace);\n    categoricalNamespace.resetColors();\n    if (currentColorScheme) {var _categoricalSchemeReg;\n      sharedLabelColor.updateColorMap(colorNamespace, currentColorScheme);\n      metadata.shared_label_colors = Object.fromEntries(sharedLabelColor.getColorMap());\n      metadata.color_scheme_domain =\n      ((_categoricalSchemeReg = categoricalSchemeRegistry.get(colorScheme)) == null ? void 0 : _categoricalSchemeReg.colors) || [];\n    } else\n    {\n      sharedLabelColor.reset();\n      metadata.shared_label_colors = {};\n      metadata.color_scheme_domain = [];\n    }\n    currentJsonMetadata = jsonStringify(metadata);\n    onColorSchemeChange(currentColorScheme, {\n      updateMetadata: false });\n\n    if (isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM)) {\n      // update tags\n      try {\n        fetchTags({\n          objectType: OBJECT_TYPES.DASHBOARD,\n          objectId: dashboardId,\n          includeTypes: false },\n        (currentTags) => updateTags(currentTags, tags), (error) => {\n          handleErrorResponse(error);\n        });\n      }\n      catch (error) {\n        handleErrorResponse(error);\n      }\n    }\n    const moreOnSubmitProps = {};\n    const morePutProps = {};\n    if (isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC)) {\n      moreOnSubmitProps.roles = roles;\n      morePutProps.roles = (roles || []).map((r) => r.id);\n    }\n    const onSubmitProps = {\n      id: dashboardId,\n      title,\n      slug,\n      jsonMetadata: currentJsonMetadata,\n      owners,\n      colorScheme: currentColorScheme,\n      colorNamespace,\n      certifiedBy,\n      certificationDetails,\n      ...moreOnSubmitProps };\n\n    if (onlyApply) {\n      onSubmit(onSubmitProps);\n      onHide();\n      addSuccessToast(t('Dashboard properties updated'));\n    } else\n    {\n      SupersetClient.put({\n        endpoint: `/api/v1/dashboard/${dashboardId}`,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          dashboard_title: title,\n          slug: slug || null,\n          json_metadata: currentJsonMetadata || null,\n          owners: (owners || []).map((o) => o.id),\n          certified_by: certifiedBy || null,\n          certification_details: certifiedBy && certificationDetails ? certificationDetails : null,\n          ...morePutProps }) }).\n\n      then(() => {\n        onSubmit(onSubmitProps);\n        onHide();\n        addSuccessToast(t('The dashboard has been saved'));\n      }, handleErrorResponse);\n    }\n  };\n  const getRowsWithoutRoles = () => {\n    const jsonMetadataObj = getJsonMetadata();\n    const hasCustomLabelColors = !!Object.keys((jsonMetadataObj == null ? void 0 : jsonMetadataObj.label_colors) || {}).length;\n    return ___EmotionJSX(Row, { gutter: 16 },\n    ___EmotionJSX(Col, { xs: 24, md: 12 },\n    ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } }, t('Access')),\n    ___EmotionJSX(StyledFormItem, { label: t('Owners') },\n    ___EmotionJSX(AsyncSelect, { allowClear: true, ariaLabel: t('Owners'), disabled: isLoading, mode: \"multiple\", onChange: handleOnChangeOwners, options: (input, page, pageSize) => loadAccessOptions('owners', input, page, pageSize), value: handleOwnersSelectValue() })),\n\n    ___EmotionJSX(\"p\", { className: \"help-block\" },\n    t('Owners is a list of users who can alter the dashboard. Searchable by name or username.'))),\n\n\n    ___EmotionJSX(Col, { xs: 24, md: 12 },\n    ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } }, t('Colors')),\n    ___EmotionJSX(ColorSchemeControlWrapper, { hasCustomLabelColors: hasCustomLabelColors, onChange: onColorSchemeChange, colorScheme: colorScheme, labelMargin: 4 })));\n\n\n  };\n  const getRowsWithRoles = () => {\n    const jsonMetadataObj = getJsonMetadata();\n    const hasCustomLabelColors = !!Object.keys((jsonMetadataObj == null ? void 0 : jsonMetadataObj.label_colors) || {}).length;\n    return ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(Row, null,\n    ___EmotionJSX(Col, { xs: 24, md: 24 },\n    ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } }, t('Access')))),\n\n\n    ___EmotionJSX(Row, { gutter: 16 },\n    ___EmotionJSX(Col, { xs: 24, md: 12 },\n    ___EmotionJSX(StyledFormItem, { label: t('Owners') },\n    ___EmotionJSX(AsyncSelect, { allowClear: true, allowNewOptions: true, ariaLabel: t('Owners'), disabled: isLoading, mode: \"multiple\", onChange: handleOnChangeOwners, options: (input, page, pageSize) => loadAccessOptions('owners', input, page, pageSize), value: handleOwnersSelectValue() })),\n\n    ___EmotionJSX(\"p\", { className: \"help-block\" },\n    t('Owners is a list of users who can alter the dashboard. Searchable by name or username.'))),\n\n\n    ___EmotionJSX(Col, { xs: 24, md: 12 },\n    ___EmotionJSX(StyledFormItem, { label: t('Roles') },\n    ___EmotionJSX(AsyncSelect, { allowClear: true, ariaLabel: t('Roles'), disabled: isLoading, mode: \"multiple\", onChange: handleOnChangeRoles, options: (input, page, pageSize) => loadAccessOptions('roles', input, page, pageSize), value: handleRolesSelectValue() })),\n\n    ___EmotionJSX(\"p\", { className: \"help-block\" },\n    t('Roles is a list which defines access to the dashboard. Granting a role access to a dashboard will bypass dataset level checks. If no roles are defined, regular access permissions apply.')))),\n\n\n\n    ___EmotionJSX(Row, null,\n    ___EmotionJSX(Col, { xs: 24, md: 12 },\n    ___EmotionJSX(ColorSchemeControlWrapper, { hasCustomLabelColors: hasCustomLabelColors, onChange: onColorSchemeChange, colorScheme: colorScheme, labelMargin: 4 }))));\n\n\n\n  };\n  useEffect(() => {\n    if (show) {\n      if (!currentDashboardInfo) {\n        fetchDashboardDetails();\n      } else\n      {\n        handleDashboardData(currentDashboardInfo);\n      }\n    }\n    JsonEditor.preload();\n  }, [currentDashboardInfo, fetchDashboardDetails, handleDashboardData, show]);\n  useEffect(() => {\n    // the title can be changed inline in the dashboard, this catches it\n    if (dashboardTitle &&\n    dashboardInfo &&\n    dashboardInfo.title !== dashboardTitle) {\n      form.setFieldsValue({\n        ...dashboardInfo,\n        title: dashboardTitle });\n\n    }\n  }, [dashboardInfo, dashboardTitle, form]);\n  useEffect(() => {\n    if (!isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM))\n    return;\n    try {\n      fetchTags({\n        objectType: OBJECT_TYPES.DASHBOARD,\n        objectId: dashboardId,\n        includeTypes: false },\n      (tags) => setTags(tags), (error) => {\n        addDangerToast(`Error fetching tags: ${error.text}`);\n      });\n    }\n    catch (error) {\n      handleErrorResponse(error);\n    }\n  }, [dashboardId]);\n  const handleChangeTags = (values) => {\n    // triggered whenever a new tag is selected or a tag was deselected\n    // on new tag selected, add the tag\n    const uniqueTags = [...new Set(values.map((v) => v.label))];\n    setTags([...uniqueTags.map((t) => ({ name: t }))]);\n  };\n  return ___EmotionJSX(Modal, { show: show, onHide: onHide, title: t('Dashboard properties'), footer: ___EmotionJSX(React.Fragment, null,\n    ___EmotionJSX(Button, { htmlType: \"button\", buttonSize: \"small\", onClick: onHide, cta: true },\n    t('Cancel')),\n\n    ___EmotionJSX(Button, { onClick: form.submit, buttonSize: \"small\", buttonStyle: \"primary\", className: \"m-r-5\", cta: true, disabled: dashboardInfo == null ? void 0 : dashboardInfo.isManagedExternally, tooltip: dashboardInfo != null && dashboardInfo.isManagedExternally ?\n      t(\"This dashboard is managed externally, and can't be edited in Superset\") :\n      '' },\n    saveLabel)),\n\n    responsive: true },\n  ___EmotionJSX(AntdForm, { form: form, onFinish: onFinish, layout: \"vertical\", initialValues: dashboardInfo },\n  ___EmotionJSX(Row, null,\n  ___EmotionJSX(Col, { xs: 24, md: 24 },\n  ___EmotionJSX(\"h3\", null, t('Basic information')))),\n\n\n  ___EmotionJSX(Row, { gutter: 16 },\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(FormItem, { label: t('Title'), name: \"title\" },\n  ___EmotionJSX(Input, { type: \"text\", disabled: isLoading }))),\n\n\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(StyledFormItem, { label: t('URL slug'), name: \"slug\" },\n  ___EmotionJSX(Input, { type: \"text\", disabled: isLoading })),\n\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('A readable URL for your dashboard')))),\n\n\n\n  isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC) ?\n  getRowsWithRoles() :\n  getRowsWithoutRoles(),\n  ___EmotionJSX(Row, null,\n  ___EmotionJSX(Col, { xs: 24, md: 24 },\n  ___EmotionJSX(\"h3\", null, t('Certification')))),\n\n\n  ___EmotionJSX(Row, { gutter: 16 },\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(StyledFormItem, { label: t('Certified by'), name: \"certifiedBy\" },\n  ___EmotionJSX(Input, { type: \"text\", disabled: isLoading })),\n\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('Person or group that has certified this dashboard.'))),\n\n\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(StyledFormItem, { label: t('Certification details'), name: \"certificationDetails\" },\n  ___EmotionJSX(Input, { type: \"text\", disabled: isLoading })),\n\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('Any additional detail to show in the certification tooltip.')))),\n\n\n\n  isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM) ? ___EmotionJSX(Row, { gutter: 16 },\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(\"h3\", { css: _ref4 }, t('Tags')))) :\n\n  null,\n  isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM) ? ___EmotionJSX(Row, { gutter: 16 },\n  ___EmotionJSX(Col, { xs: 24, md: 12 },\n  ___EmotionJSX(StyledFormItem, null,\n  ___EmotionJSX(AsyncSelect, { ariaLabel: \"Tags\", mode: \"multiple\", allowNewOptions: true, value: tagsAsSelectValues, options: loadTags, onChange: handleChangeTags, allowClear: true })),\n\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('A list of tags that have been applied to this chart.')))) :\n\n\n  null,\n  ___EmotionJSX(Row, null,\n  ___EmotionJSX(Col, { xs: 24, md: 24 },\n  ___EmotionJSX(\"h3\", { style: { marginTop: '1em' } },\n  ___EmotionJSX(Button, { buttonStyle: \"link\", onClick: () => setIsAdvancedOpen(!isAdvancedOpen) },\n  ___EmotionJSX(\"i\", { className: `fa fa-angle-${isAdvancedOpen ? 'down' : 'right'}`, style: { minWidth: '1em' } }),\n  t('Advanced'))),\n\n\n  isAdvancedOpen && ___EmotionJSX(React.Fragment, null,\n  ___EmotionJSX(StyledFormItem, { label: t('JSON metadata') },\n  ___EmotionJSX(StyledJsonEditor, { showLoadingForImport: true, name: \"json_metadata\", value: jsonMetadata, onChange: setJsonMetadata, tabSize: 2, width: \"100%\", height: \"200px\", wrapEnabled: true })),\n\n  ___EmotionJSX(\"p\", { className: \"help-block\" },\n  t('This JSON object is generated dynamically when clicking the save or overwrite button in the dashboard view. It is exposed here for reference and for power users who may want to alter specific parameters.'),\n  onlyApply && ___EmotionJSX(React.Fragment, null,\n  ' ',\n  t('Please DO NOT overwrite the \"filter_scopes\" key.'), ' ',\n  ___EmotionJSX(FilterScopeModal, { triggerNode: ___EmotionJSX(\"span\", { className: \"alert-link\" },\n    t('Use \"%(menuName)s\" menu instead.', {\n      menuName: t('Set filter mapping') })) }))))))));\n\n\n\n\n\n\n\n\n\n};\nexport default withToasts(PropertiesModal);","map":{"version":3,"mappings":"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","names":["React","useCallback","useEffect","useMemo","useState","Input","FormItem","jsonStringify","Button","AntdForm","AsyncSelect","Col","Row","rison","CategoricalColorNamespace","ensureIsArray","FeatureFlag","getCategoricalSchemeRegistry","getSharedLabelColor","styled","SupersetClient","t","Modal","JsonEditor","ColorSchemeControlWrapper","FilterScopeModal","getClientErrorObject","withToasts","isFeatureEnabled","addTag","deleteTaggedObjects","fetchTags","OBJECT_TYPES","loadTags","StyledFormItem","StyledJsonEditor","theme","borderRadius","colors","secondary","light2","PropertiesModal","addSuccessToast","addDangerToast","colorScheme","currentColorScheme","dashboardId","dashboardInfo","currentDashboardInfo","dashboardTitle","onHide","onlyApply","onSubmit","show","form","useForm","isLoading","setIsLoading","isAdvancedOpen","setIsAdvancedOpen","setColorScheme","jsonMetadata","setJsonMetadata","setDashboardInfo","owners","setOwners","roles","setRoles","saveLabel","tags","setTags","categoricalSchemeRegistry","tagsAsSelectValues","selectTags","map","value","tag","name","label","key","length","handleErrorResponse","response","error","statusText","message","errorText","json_metadata","title","content","okButtonProps","danger","className","loadAccessOptions","accessType","input","page","pageSize","query","encode","filter","page_size","get","endpoint","then","data","json","result","item","extra","active","undefined","text","totalCount","count","handleDashboardData","id","dashboard_title","slug","certified_by","certification_details","metadata","is_managed_externally","dashboardData","certifiedBy","certificationDetails","isManagedExternally","setFieldsValue","color_scheme","positions","metaDataCopy","shared_label_colors","color_scheme_domain","fetchDashboardDetails","dashboard","jsonMetadataObj","JSON","parse","getJsonMetadata","_","handleOnChangeOwners","parsedOwners","o","full_name","handleOnChangeRoles","parsedRoles","r","handleOwnersSelectValue","owner","first_name","last_name","handleRolesSelectValue","role","onColorSchemeChange","updateMetadata","colorChoices","keys","Error","label_colors","updateTags","oldTags","newTags","some","objectType","DASHBOARD","objectId","includeTypes","onFinish","getFieldsValue","colorNamespace","currentJsonMetadata","startsWith","endsWith","color_namespace","sharedLabelColor","categoricalNamespace","getNamespace","resetColors","updateColorMap","Object","fromEntries","getColorMap","reset","TAGGING_SYSTEM","currentTags","moreOnSubmitProps","morePutProps","DASHBOARD_RBAC","onSubmitProps","put","headers","body","stringify","getRowsWithoutRoles","hasCustomLabelColors","marginTop","getRowsWithRoles","preload","handleChangeTags","values","uniqueTags","Set","v","submit","minWidth","menuName"],"sourceRoot":"","sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/PropertiesModal/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { Input } from 'src/components/Input';\nimport { FormItem } from 'src/components/Form';\nimport jsonStringify from 'json-stringify-pretty-compact';\nimport Button from 'src/components/Button';\nimport { AntdForm, AsyncSelect, Col, Row } from 'src/components';\nimport rison from 'rison';\nimport {\n  CategoricalColorNamespace,\n  ensureIsArray,\n  FeatureFlag,\n  getCategoricalSchemeRegistry,\n  getSharedLabelColor,\n  styled,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\n\nimport Modal from 'src/components/Modal';\nimport { JsonEditor } from 'src/components/AsyncAceEditor';\n\nimport ColorSchemeControlWrapper from 'src/dashboard/components/ColorSchemeControlWrapper';\nimport FilterScopeModal from 'src/dashboard/components/filterscope/FilterScopeModal';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport TagType from 'src/types/TagType';\nimport {\n  addTag,\n  deleteTaggedObjects,\n  fetchTags,\n  OBJECT_TYPES,\n} from 'src/features/tags/tags';\nimport { loadTags } from 'src/components/Tags/utils';\n\nconst StyledFormItem = styled(FormItem)`\n  margin-bottom: 0;\n`;\n\nconst StyledJsonEditor = styled(JsonEditor)`\n  border-radius: ${({ theme }) => theme.borderRadius}px;\n  border: 1px solid ${({ theme }) => theme.colors.secondary.light2};\n`;\n\ntype PropertiesModalProps = {\n  dashboardId: number;\n  dashboardTitle?: string;\n  dashboardInfo?: Record<string, any>;\n  show?: boolean;\n  onHide?: () => void;\n  colorScheme?: string;\n  onSubmit?: (params: Record<string, any>) => void;\n  addSuccessToast: (message: string) => void;\n  addDangerToast: (message: string) => void;\n  onlyApply?: boolean;\n};\n\ntype Roles = { id: number; name: string }[];\ntype Owners = {\n  id: number;\n  full_name?: string;\n  first_name?: string;\n  last_name?: string;\n}[];\ntype DashboardInfo = {\n  id: number;\n  title: string;\n  slug: string;\n  certifiedBy: string;\n  certificationDetails: string;\n  isManagedExternally: boolean;\n};\n\nconst PropertiesModal = ({\n  addSuccessToast,\n  addDangerToast,\n  colorScheme: currentColorScheme,\n  dashboardId,\n  dashboardInfo: currentDashboardInfo,\n  dashboardTitle,\n  onHide = () => {},\n  onlyApply = false,\n  onSubmit = () => {},\n  show = false,\n}: PropertiesModalProps) => {\n  const [form] = AntdForm.useForm();\n  const [isLoading, setIsLoading] = useState(false);\n  const [isAdvancedOpen, setIsAdvancedOpen] = useState(false);\n  const [colorScheme, setColorScheme] = useState(currentColorScheme);\n  const [jsonMetadata, setJsonMetadata] = useState('');\n  const [dashboardInfo, setDashboardInfo] = useState<DashboardInfo>();\n  const [owners, setOwners] = useState<Owners>([]);\n  const [roles, setRoles] = useState<Roles>([]);\n  const saveLabel = onlyApply ? t('Apply') : t('Save');\n  const [tags, setTags] = useState<TagType[]>([]);\n  const categoricalSchemeRegistry = getCategoricalSchemeRegistry();\n\n  const tagsAsSelectValues = useMemo(() => {\n    const selectTags = tags.map(tag => ({\n      value: tag.name,\n      label: tag.name,\n      key: tag.name,\n    }));\n    return selectTags;\n  }, [tags.length]);\n\n  const handleErrorResponse = async (response: Response) => {\n    const { error, statusText, message } = await getClientErrorObject(response);\n    let errorText = error || statusText || t('An error has occurred');\n    if (typeof message === 'object' && 'json_metadata' in message) {\n      errorText = (message as { json_metadata: string }).json_metadata;\n    } else if (typeof message === 'string') {\n      errorText = message;\n\n      if (message === 'Forbidden') {\n        errorText = t('You do not have permission to edit this dashboard');\n      }\n    }\n\n    Modal.error({\n      title: t('Error'),\n      content: errorText,\n      okButtonProps: { danger: true, className: 'btn-danger' },\n    });\n  };\n\n  const loadAccessOptions = useCallback(\n    (accessType = 'owners', input = '', page: number, pageSize: number) => {\n      const query = rison.encode({\n        filter: input,\n        page,\n        page_size: pageSize,\n      });\n      return SupersetClient.get({\n        endpoint: `/api/v1/dashboard/related/${accessType}?q=${query}`,\n      }).then(response => ({\n        data: response.json.result\n          .filter((item: { extra: { active: boolean } }) =>\n            item.extra.active !== undefined ? item.extra.active : true,\n          )\n          .map((item: { value: number; text: string }) => ({\n            value: item.value,\n            label: item.text,\n          })),\n        totalCount: response.json.count,\n      }));\n    },\n    [],\n  );\n\n  const handleDashboardData = useCallback(\n    dashboardData => {\n      const {\n        id,\n        dashboard_title,\n        slug,\n        certified_by,\n        certification_details,\n        owners,\n        roles,\n        metadata,\n        is_managed_externally,\n      } = dashboardData;\n      const dashboardInfo = {\n        id,\n        title: dashboard_title,\n        slug: slug || '',\n        certifiedBy: certified_by || '',\n        certificationDetails: certification_details || '',\n        isManagedExternally: is_managed_externally || false,\n      };\n\n      form.setFieldsValue(dashboardInfo);\n      setDashboardInfo(dashboardInfo);\n      setOwners(owners);\n      setRoles(roles);\n      setColorScheme(metadata.color_scheme);\n\n      // temporary fix to remove positions from dashboards' metadata\n      if (metadata?.positions) {\n        delete metadata.positions;\n      }\n      const metaDataCopy = { ...metadata };\n\n      delete metaDataCopy.shared_label_colors;\n\n      delete metaDataCopy.color_scheme_domain;\n\n      setJsonMetadata(metaDataCopy ? jsonStringify(metaDataCopy) : '');\n    },\n    [form],\n  );\n\n  const fetchDashboardDetails = useCallback(() => {\n    setIsLoading(true);\n    // We fetch the dashboard details because not all code\n    // that renders this component have all the values we need.\n    // At some point when we have a more consistent frontend\n    // datamodel, the dashboard could probably just be passed as a prop.\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/${dashboardId}`,\n    }).then(response => {\n      const dashboard = response.json.result;\n      const jsonMetadataObj = dashboard.json_metadata?.length\n        ? JSON.parse(dashboard.json_metadata)\n        : {};\n\n      handleDashboardData({\n        ...dashboard,\n        metadata: jsonMetadataObj,\n      });\n\n      setIsLoading(false);\n    }, handleErrorResponse);\n  }, [dashboardId, handleDashboardData]);\n\n  const getJsonMetadata = () => {\n    try {\n      const jsonMetadataObj = jsonMetadata?.length\n        ? JSON.parse(jsonMetadata)\n        : {};\n      return jsonMetadataObj;\n    } catch (_) {\n      return {};\n    }\n  };\n\n  const handleOnChangeOwners = (owners: { value: number; label: string }[]) => {\n    const parsedOwners: Owners = ensureIsArray(owners).map(o => ({\n      id: o.value,\n      full_name: o.label,\n    }));\n    setOwners(parsedOwners);\n  };\n\n  const handleOnChangeRoles = (roles: { value: number; label: string }[]) => {\n    const parsedRoles: Roles = ensureIsArray(roles).map(r => ({\n      id: r.value,\n      name: r.label,\n    }));\n    setRoles(parsedRoles);\n  };\n\n  const handleOwnersSelectValue = () => {\n    const parsedOwners = (owners || []).map(\n      (owner: {\n        id: number;\n        first_name?: string;\n        last_name?: string;\n        full_name?: string;\n      }) => ({\n        value: owner.id,\n        label: owner.full_name || `${owner.first_name} ${owner.last_name}`,\n      }),\n    );\n    return parsedOwners;\n  };\n\n  const handleRolesSelectValue = () => {\n    const parsedRoles = (roles || []).map(\n      (role: { id: number; name: string }) => ({\n        value: role.id,\n        label: `${role.name}`,\n      }),\n    );\n    return parsedRoles;\n  };\n\n  const onColorSchemeChange = (\n    colorScheme = '',\n    { updateMetadata = true } = {},\n  ) => {\n    // check that color_scheme is valid\n    const colorChoices = categoricalSchemeRegistry.keys();\n    const jsonMetadataObj = getJsonMetadata();\n\n    // only fire if the color_scheme is present and invalid\n    if (colorScheme && !colorChoices.includes(colorScheme)) {\n      Modal.error({\n        title: t('Error'),\n        content: t('A valid color scheme is required'),\n        okButtonProps: { danger: true, className: 'btn-danger' },\n      });\n      throw new Error('A valid color scheme is required');\n    }\n\n    // update metadata to match selection\n    if (updateMetadata) {\n      jsonMetadataObj.color_scheme = colorScheme;\n      jsonMetadataObj.label_colors = jsonMetadataObj.label_colors || {};\n\n      setJsonMetadata(jsonStringify(jsonMetadataObj));\n    }\n    setColorScheme(colorScheme);\n  };\n\n  const updateTags = (oldTags: TagType[], newTags: TagType[]) => {\n    // update the tags for this object\n    // add tags that are in new tags, but not in old tags\n    // eslint-disable-next-line array-callback-return\n    newTags.map((tag: TagType) => {\n      if (!oldTags.some(t => t.name === tag.name)) {\n        addTag(\n          {\n            objectType: OBJECT_TYPES.DASHBOARD,\n            objectId: dashboardId,\n            includeTypes: false,\n          },\n          tag.name,\n          () => {},\n          () => {},\n        );\n      }\n    });\n    // delete tags that are in old tags, but not in new tags\n    // eslint-disable-next-line array-callback-return\n    oldTags.map((tag: TagType) => {\n      if (!newTags.some(t => t.name === tag.name)) {\n        deleteTaggedObjects(\n          {\n            objectType: OBJECT_TYPES.DASHBOARD,\n            objectId: dashboardId,\n          },\n          tag,\n          () => {},\n          () => {},\n        );\n      }\n    });\n  };\n\n  const onFinish = () => {\n    const { title, slug, certifiedBy, certificationDetails } =\n      form.getFieldsValue();\n    let currentColorScheme = colorScheme;\n    let colorNamespace = '';\n    let currentJsonMetadata = jsonMetadata;\n\n    // validate currentJsonMetadata\n    let metadata;\n    try {\n      if (\n        !currentJsonMetadata.startsWith('{') ||\n        !currentJsonMetadata.endsWith('}')\n      ) {\n        throw new Error();\n      }\n      metadata = JSON.parse(currentJsonMetadata);\n    } catch (error) {\n      addDangerToast(t('JSON metadata is invalid!'));\n      return;\n    }\n\n    // color scheme in json metadata has precedence over selection\n    currentColorScheme = metadata?.color_scheme || colorScheme;\n    colorNamespace = metadata?.color_namespace;\n\n    // filter shared_label_color from user input\n    if (metadata?.shared_label_colors) {\n      delete metadata.shared_label_colors;\n    }\n    if (metadata?.color_scheme_domain) {\n      delete metadata.color_scheme_domain;\n    }\n\n    const sharedLabelColor = getSharedLabelColor();\n    const categoricalNamespace =\n      CategoricalColorNamespace.getNamespace(colorNamespace);\n    categoricalNamespace.resetColors();\n    if (currentColorScheme) {\n      sharedLabelColor.updateColorMap(colorNamespace, currentColorScheme);\n      metadata.shared_label_colors = Object.fromEntries(\n        sharedLabelColor.getColorMap(),\n      );\n      metadata.color_scheme_domain =\n        categoricalSchemeRegistry.get(colorScheme)?.colors || [];\n    } else {\n      sharedLabelColor.reset();\n      metadata.shared_label_colors = {};\n      metadata.color_scheme_domain = [];\n    }\n\n    currentJsonMetadata = jsonStringify(metadata);\n\n    onColorSchemeChange(currentColorScheme, {\n      updateMetadata: false,\n    });\n\n    if (isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM)) {\n      // update tags\n      try {\n        fetchTags(\n          {\n            objectType: OBJECT_TYPES.DASHBOARD,\n            objectId: dashboardId,\n            includeTypes: false,\n          },\n          (currentTags: TagType[]) => updateTags(currentTags, tags),\n          error => {\n            handleErrorResponse(error);\n          },\n        );\n      } catch (error) {\n        handleErrorResponse(error);\n      }\n    }\n\n    const moreOnSubmitProps: { roles?: Roles } = {};\n    const morePutProps: { roles?: number[] } = {};\n    if (isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC)) {\n      moreOnSubmitProps.roles = roles;\n      morePutProps.roles = (roles || []).map(r => r.id);\n    }\n    const onSubmitProps = {\n      id: dashboardId,\n      title,\n      slug,\n      jsonMetadata: currentJsonMetadata,\n      owners,\n      colorScheme: currentColorScheme,\n      colorNamespace,\n      certifiedBy,\n      certificationDetails,\n      ...moreOnSubmitProps,\n    };\n    if (onlyApply) {\n      onSubmit(onSubmitProps);\n      onHide();\n      addSuccessToast(t('Dashboard properties updated'));\n    } else {\n      SupersetClient.put({\n        endpoint: `/api/v1/dashboard/${dashboardId}`,\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          dashboard_title: title,\n          slug: slug || null,\n          json_metadata: currentJsonMetadata || null,\n          owners: (owners || []).map(o => o.id),\n          certified_by: certifiedBy || null,\n          certification_details:\n            certifiedBy && certificationDetails ? certificationDetails : null,\n          ...morePutProps,\n        }),\n      }).then(() => {\n        onSubmit(onSubmitProps);\n        onHide();\n        addSuccessToast(t('The dashboard has been saved'));\n      }, handleErrorResponse);\n    }\n  };\n\n  const getRowsWithoutRoles = () => {\n    const jsonMetadataObj = getJsonMetadata();\n    const hasCustomLabelColors = !!Object.keys(\n      jsonMetadataObj?.label_colors || {},\n    ).length;\n\n    return (\n      <Row gutter={16}>\n        <Col xs={24} md={12}>\n          <h3 style={{ marginTop: '1em' }}>{t('Access')}</h3>\n          <StyledFormItem label={t('Owners')}>\n            <AsyncSelect\n              allowClear\n              ariaLabel={t('Owners')}\n              disabled={isLoading}\n              mode=\"multiple\"\n              onChange={handleOnChangeOwners}\n              options={(input, page, pageSize) =>\n                loadAccessOptions('owners', input, page, pageSize)\n              }\n              value={handleOwnersSelectValue()}\n            />\n          </StyledFormItem>\n          <p className=\"help-block\">\n            {t(\n              'Owners is a list of users who can alter the dashboard. Searchable by name or username.',\n            )}\n          </p>\n        </Col>\n        <Col xs={24} md={12}>\n          <h3 style={{ marginTop: '1em' }}>{t('Colors')}</h3>\n          <ColorSchemeControlWrapper\n            hasCustomLabelColors={hasCustomLabelColors}\n            onChange={onColorSchemeChange}\n            colorScheme={colorScheme}\n            labelMargin={4}\n          />\n        </Col>\n      </Row>\n    );\n  };\n\n  const getRowsWithRoles = () => {\n    const jsonMetadataObj = getJsonMetadata();\n    const hasCustomLabelColors = !!Object.keys(\n      jsonMetadataObj?.label_colors || {},\n    ).length;\n\n    return (\n      <>\n        <Row>\n          <Col xs={24} md={24}>\n            <h3 style={{ marginTop: '1em' }}>{t('Access')}</h3>\n          </Col>\n        </Row>\n        <Row gutter={16}>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('Owners')}>\n              <AsyncSelect\n                allowClear\n                allowNewOptions\n                ariaLabel={t('Owners')}\n                disabled={isLoading}\n                mode=\"multiple\"\n                onChange={handleOnChangeOwners}\n                options={(input, page, pageSize) =>\n                  loadAccessOptions('owners', input, page, pageSize)\n                }\n                value={handleOwnersSelectValue()}\n              />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t(\n                'Owners is a list of users who can alter the dashboard. Searchable by name or username.',\n              )}\n            </p>\n          </Col>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('Roles')}>\n              <AsyncSelect\n                allowClear\n                ariaLabel={t('Roles')}\n                disabled={isLoading}\n                mode=\"multiple\"\n                onChange={handleOnChangeRoles}\n                options={(input, page, pageSize) =>\n                  loadAccessOptions('roles', input, page, pageSize)\n                }\n                value={handleRolesSelectValue()}\n              />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t(\n                'Roles is a list which defines access to the dashboard. Granting a role access to a dashboard will bypass dataset level checks. If no roles are defined, regular access permissions apply.',\n              )}\n            </p>\n          </Col>\n        </Row>\n        <Row>\n          <Col xs={24} md={12}>\n            <ColorSchemeControlWrapper\n              hasCustomLabelColors={hasCustomLabelColors}\n              onChange={onColorSchemeChange}\n              colorScheme={colorScheme}\n              labelMargin={4}\n            />\n          </Col>\n        </Row>\n      </>\n    );\n  };\n\n  useEffect(() => {\n    if (show) {\n      if (!currentDashboardInfo) {\n        fetchDashboardDetails();\n      } else {\n        handleDashboardData(currentDashboardInfo);\n      }\n    }\n\n    JsonEditor.preload();\n  }, [currentDashboardInfo, fetchDashboardDetails, handleDashboardData, show]);\n\n  useEffect(() => {\n    // the title can be changed inline in the dashboard, this catches it\n    if (\n      dashboardTitle &&\n      dashboardInfo &&\n      dashboardInfo.title !== dashboardTitle\n    ) {\n      form.setFieldsValue({\n        ...dashboardInfo,\n        title: dashboardTitle,\n      });\n    }\n  }, [dashboardInfo, dashboardTitle, form]);\n\n  useEffect(() => {\n    if (!isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM)) return;\n    try {\n      fetchTags(\n        {\n          objectType: OBJECT_TYPES.DASHBOARD,\n          objectId: dashboardId,\n          includeTypes: false,\n        },\n        (tags: TagType[]) => setTags(tags),\n        (error: Response) => {\n          addDangerToast(`Error fetching tags: ${error.text}`);\n        },\n      );\n    } catch (error) {\n      handleErrorResponse(error);\n    }\n  }, [dashboardId]);\n\n  const handleChangeTags = (values: { label: string; value: number }[]) => {\n    // triggered whenever a new tag is selected or a tag was deselected\n    // on new tag selected, add the tag\n\n    const uniqueTags = [...new Set(values.map(v => v.label))];\n    setTags([...uniqueTags.map(t => ({ name: t }))]);\n  };\n\n  return (\n    <Modal\n      show={show}\n      onHide={onHide}\n      title={t('Dashboard properties')}\n      footer={\n        <>\n          <Button\n            htmlType=\"button\"\n            buttonSize=\"small\"\n            onClick={onHide}\n            data-test=\"properties-modal-cancel-button\"\n            cta\n          >\n            {t('Cancel')}\n          </Button>\n          <Button\n            data-test=\"properties-modal-apply-button\"\n            onClick={form.submit}\n            buttonSize=\"small\"\n            buttonStyle=\"primary\"\n            className=\"m-r-5\"\n            cta\n            disabled={dashboardInfo?.isManagedExternally}\n            tooltip={\n              dashboardInfo?.isManagedExternally\n                ? t(\n                    \"This dashboard is managed externally, and can't be edited in Superset\",\n                  )\n                : ''\n            }\n          >\n            {saveLabel}\n          </Button>\n        </>\n      }\n      responsive\n    >\n      <AntdForm\n        form={form}\n        onFinish={onFinish}\n        data-test=\"dashboard-edit-properties-form\"\n        layout=\"vertical\"\n        initialValues={dashboardInfo}\n      >\n        <Row>\n          <Col xs={24} md={24}>\n            <h3>{t('Basic information')}</h3>\n          </Col>\n        </Row>\n        <Row gutter={16}>\n          <Col xs={24} md={12}>\n            <FormItem label={t('Title')} name=\"title\">\n              <Input\n                data-test=\"dashboard-title-input\"\n                type=\"text\"\n                disabled={isLoading}\n              />\n            </FormItem>\n          </Col>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('URL slug')} name=\"slug\">\n              <Input type=\"text\" disabled={isLoading} />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t('A readable URL for your dashboard')}\n            </p>\n          </Col>\n        </Row>\n        {isFeatureEnabled(FeatureFlag.DASHBOARD_RBAC)\n          ? getRowsWithRoles()\n          : getRowsWithoutRoles()}\n        <Row>\n          <Col xs={24} md={24}>\n            <h3>{t('Certification')}</h3>\n          </Col>\n        </Row>\n        <Row gutter={16}>\n          <Col xs={24} md={12}>\n            <StyledFormItem label={t('Certified by')} name=\"certifiedBy\">\n              <Input type=\"text\" disabled={isLoading} />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t('Person or group that has certified this dashboard.')}\n            </p>\n          </Col>\n          <Col xs={24} md={12}>\n            <StyledFormItem\n              label={t('Certification details')}\n              name=\"certificationDetails\"\n            >\n              <Input type=\"text\" disabled={isLoading} />\n            </StyledFormItem>\n            <p className=\"help-block\">\n              {t('Any additional detail to show in the certification tooltip.')}\n            </p>\n          </Col>\n        </Row>\n        {isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM) ? (\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              <h3 css={{ marginTop: '1em' }}>{t('Tags')}</h3>\n            </Col>\n          </Row>\n        ) : null}\n        {isFeatureEnabled(FeatureFlag.TAGGING_SYSTEM) ? (\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              <StyledFormItem>\n                <AsyncSelect\n                  ariaLabel=\"Tags\"\n                  mode=\"multiple\"\n                  allowNewOptions\n                  value={tagsAsSelectValues}\n                  options={loadTags}\n                  onChange={handleChangeTags}\n                  allowClear\n                />\n              </StyledFormItem>\n              <p className=\"help-block\">\n                {t('A list of tags that have been applied to this chart.')}\n              </p>\n            </Col>\n          </Row>\n        ) : null}\n        <Row>\n          <Col xs={24} md={24}>\n            <h3 style={{ marginTop: '1em' }}>\n              <Button\n                buttonStyle=\"link\"\n                onClick={() => setIsAdvancedOpen(!isAdvancedOpen)}\n              >\n                <i\n                  className={`fa fa-angle-${isAdvancedOpen ? 'down' : 'right'}`}\n                  style={{ minWidth: '1em' }}\n                />\n                {t('Advanced')}\n              </Button>\n            </h3>\n            {isAdvancedOpen && (\n              <>\n                <StyledFormItem label={t('JSON metadata')}>\n                  <StyledJsonEditor\n                    showLoadingForImport\n                    name=\"json_metadata\"\n                    value={jsonMetadata}\n                    onChange={setJsonMetadata}\n                    tabSize={2}\n                    width=\"100%\"\n                    height=\"200px\"\n                    wrapEnabled\n                  />\n                </StyledFormItem>\n                <p className=\"help-block\">\n                  {t(\n                    'This JSON object is generated dynamically when clicking the save or overwrite button in the dashboard view. It is exposed here for reference and for power users who may want to alter specific parameters.',\n                  )}\n                  {onlyApply && (\n                    <>\n                      {' '}\n                      {t(\n                        'Please DO NOT overwrite the \"filter_scopes\" key.',\n                      )}{' '}\n                      <FilterScopeModal\n                        triggerNode={\n                          <span className=\"alert-link\">\n                            {t('Use \"%(menuName)s\" menu instead.', {\n                              menuName: t('Set filter mapping'),\n                            })}\n                          </span>\n                        }\n                      />\n                    </>\n                  )}\n                </p>\n              </>\n            )}\n          </Col>\n        </Row>\n      </AntdForm>\n    </Modal>\n  );\n};\n\nexport default withToasts(PropertiesModal);\n"]},"metadata":{},"sourceType":"module"}