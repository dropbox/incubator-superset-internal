{"ast":null,"code":"import _isEqual from \"lodash/isEqual\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /* eslint-disable react/jsx-sort-default-props */\n/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/forbid-prop-types */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport { StaticMap } from 'react-map-gl';\nimport DeckGL from 'deck.gl';\nimport { styled } from '@superset-ui/core';\nimport Tooltip from './components/Tooltip';\nimport 'mapbox-gl/dist/mapbox-gl.css';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst TICK = 250; // milliseconds\n\nconst propTypes = {\n  viewport: PropTypes.object.isRequired,\n  layers: PropTypes.array.isRequired,\n  setControlValue: PropTypes.func,\n  mapStyle: PropTypes.string,\n  mapboxApiAccessToken: PropTypes.string.isRequired,\n  children: PropTypes.node,\n  bottomMargin: PropTypes.number,\n  width: PropTypes.number.isRequired,\n  height: PropTypes.number.isRequired,\n  onViewportChange: PropTypes.func };\n\nconst defaultProps = {\n  mapStyle: 'light',\n  setControlValue: () => {},\n  children: null,\n  bottomMargin: 0 };\n\n\nexport class DeckGLContainer extends React.Component {\n  constructor(props) {\n    super(props);this.\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n    setTooltip = (tooltip) => {\n      this.setState({ tooltip });\n    };this.tick = this.tick.bind(this);this.onViewStateChange = this.onViewStateChange.bind(this); // This has to be placed after this.tick is bound to this\n    this.state = { timer: setInterval(this.tick, TICK), tooltip: null, viewState: props.viewport };}UNSAFE_componentWillReceiveProps(nextProps) {if (!_isEqual(nextProps.viewport, this.props.viewport)) {this.setState({ viewState: nextProps.viewport });}}componentWillUnmount() {clearInterval(this.state.timer);}onViewStateChange(_ref) {let { viewState } = _ref;this.setState({ viewState, lastUpdate: Date.now() });}tick() {// Rate limiting updating viewport controls as it triggers lotsa renders\n    const { lastUpdate } = this.state;if (lastUpdate && Date.now() - lastUpdate > TICK) {const setCV = this.props.setControlValue;if (setCV) {setCV('viewport', this.state.viewState);}this.setState({ lastUpdate: null });}}layers() {// Support for layer factory\n    if (this.props.layers.some((l) => typeof l === 'function')) {return this.props.layers.map((l) => typeof l === 'function' ? l() : l);}return this.props.layers;}render() {const { children, bottomMargin, height, width } = this.props;\n    const { viewState, tooltip } = this.state;\n    const adjustedHeight = height - bottomMargin;\n\n    const layers = this.layers();\n\n    return (\n      ___EmotionJSX(React.Fragment, null,\n      ___EmotionJSX(\"div\", { style: { position: 'relative', width, height: adjustedHeight } },\n      ___EmotionJSX(DeckGL, {\n        initWebGLParameters: true,\n        controller: true,\n        width: width,\n        height: adjustedHeight,\n        layers: layers,\n        viewState: viewState,\n        glOptions: { preserveDrawingBuffer: true },\n        onViewStateChange: this.onViewStateChange },\n\n      ___EmotionJSX(StaticMap, {\n        preserveDrawingBuffer: true,\n        mapStyle: this.props.mapStyle,\n        mapboxApiAccessToken: this.props.mapboxApiAccessToken })),\n\n\n      children),\n\n      ___EmotionJSX(Tooltip, { tooltip: tooltip })));\n\n\n  } // @ts-ignore\n  __reactstandin__regenerateByEval(key, code) {// @ts-ignore\n    this[key] = eval(code);}}\nDeckGLContainer.propTypes = propTypes;\nDeckGLContainer.defaultProps = defaultProps;\n\nexport const DeckGLContainerStyledWrapper = styled(DeckGLContainer)`\n  .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n`;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(TICK, \"TICK\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.jsx\");reactHotLoader.register(propTypes, \"propTypes\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.jsx\");reactHotLoader.register(defaultProps, \"defaultProps\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.jsx\");reactHotLoader.register(DeckGLContainer, \"DeckGLContainer\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.jsx\");reactHotLoader.register(DeckGLContainerStyledWrapper, \"DeckGLContainerStyledWrapper\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.jsx\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["React","PropTypes","StaticMap","DeckGL","styled","Tooltip","TICK","propTypes","viewport","object","isRequired","layers","array","setControlValue","func","mapStyle","string","mapboxApiAccessToken","children","node","bottomMargin","number","width","height","onViewportChange","defaultProps","DeckGLContainer","Component","constructor","props","setTooltip","tooltip","setState","tick","bind","onViewStateChange","state","timer","setInterval","viewState","UNSAFE_componentWillReceiveProps","nextProps","componentWillUnmount","clearInterval","lastUpdate","Date","now","setCV","some","l","map","render","adjustedHeight","position","preserveDrawingBuffer","DeckGLContainerStyledWrapper"],"sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.jsx"],"sourcesContent":["/* eslint-disable react/jsx-sort-default-props */\n/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/forbid-prop-types */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { isEqual } from 'lodash';\nimport { StaticMap } from 'react-map-gl';\nimport DeckGL from 'deck.gl';\nimport { styled } from '@superset-ui/core';\nimport Tooltip from './components/Tooltip';\nimport 'mapbox-gl/dist/mapbox-gl.css';\n\nconst TICK = 250; // milliseconds\n\nconst propTypes = {\n  viewport: PropTypes.object.isRequired,\n  layers: PropTypes.array.isRequired,\n  setControlValue: PropTypes.func,\n  mapStyle: PropTypes.string,\n  mapboxApiAccessToken: PropTypes.string.isRequired,\n  children: PropTypes.node,\n  bottomMargin: PropTypes.number,\n  width: PropTypes.number.isRequired,\n  height: PropTypes.number.isRequired,\n  onViewportChange: PropTypes.func,\n};\nconst defaultProps = {\n  mapStyle: 'light',\n  setControlValue: () => {},\n  children: null,\n  bottomMargin: 0,\n};\n\nexport class DeckGLContainer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.tick = this.tick.bind(this);\n    this.onViewStateChange = this.onViewStateChange.bind(this);\n    // This has to be placed after this.tick is bound to this\n    this.state = {\n      timer: setInterval(this.tick, TICK),\n      tooltip: null,\n      viewState: props.viewport,\n    };\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (!isEqual(nextProps.viewport, this.props.viewport)) {\n      this.setState({ viewState: nextProps.viewport });\n    }\n  }\n\n  componentWillUnmount() {\n    clearInterval(this.state.timer);\n  }\n\n  onViewStateChange({ viewState }) {\n    this.setState({ viewState, lastUpdate: Date.now() });\n  }\n\n  tick() {\n    // Rate limiting updating viewport controls as it triggers lotsa renders\n    const { lastUpdate } = this.state;\n    if (lastUpdate && Date.now() - lastUpdate > TICK) {\n      const setCV = this.props.setControlValue;\n      if (setCV) {\n        setCV('viewport', this.state.viewState);\n      }\n      this.setState({ lastUpdate: null });\n    }\n  }\n\n  layers() {\n    // Support for layer factory\n    if (this.props.layers.some(l => typeof l === 'function')) {\n      return this.props.layers.map(l => (typeof l === 'function' ? l() : l));\n    }\n\n    return this.props.layers;\n  }\n\n  setTooltip = tooltip => {\n    this.setState({ tooltip });\n  };\n\n  render() {\n    const { children, bottomMargin, height, width } = this.props;\n    const { viewState, tooltip } = this.state;\n    const adjustedHeight = height - bottomMargin;\n\n    const layers = this.layers();\n\n    return (\n      <>\n        <div style={{ position: 'relative', width, height: adjustedHeight }}>\n          <DeckGL\n            initWebGLParameters\n            controller\n            width={width}\n            height={adjustedHeight}\n            layers={layers}\n            viewState={viewState}\n            glOptions={{ preserveDrawingBuffer: true }}\n            onViewStateChange={this.onViewStateChange}\n          >\n            <StaticMap\n              preserveDrawingBuffer\n              mapStyle={this.props.mapStyle}\n              mapboxApiAccessToken={this.props.mapboxApiAccessToken}\n            />\n          </DeckGL>\n          {children}\n        </div>\n        <Tooltip tooltip={tooltip} />\n      </>\n    );\n  }\n}\n\nDeckGLContainer.propTypes = propTypes;\nDeckGLContainer.defaultProps = defaultProps;\n\nexport const DeckGLContainerStyledWrapper = styled(DeckGLContainer)`\n  .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n`;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}