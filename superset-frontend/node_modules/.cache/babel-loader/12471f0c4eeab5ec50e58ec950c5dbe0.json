{"ast":null,"code":"import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\"; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport shortid from 'shortid';\nimport rison from 'rison';\nimport {\nFeatureFlag,\nSupersetClient,\nt,\nisFeatureEnabled } from\n'@superset-ui/core';\nimport invert from 'lodash/invert';\nimport mapKeys from 'lodash/mapKeys';\n\nimport { now } from 'src/utils/dates';\nimport {\naddDangerToast as addDangerToastAction,\naddInfoToast as addInfoToastAction,\naddSuccessToast as addSuccessToastAction,\naddWarningToast as addWarningToastAction } from\n'src/components/MessageToasts/actions';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport COMMON_ERR_MESSAGES from 'src/utils/errorMessages';\nimport { LOG_ACTIONS_SQLLAB_FETCH_FAILED_QUERY } from 'src/logger/LogUtils';\nimport { logEvent } from 'src/logger/actions';\nimport { newQueryTabName } from '../utils/newQueryTabName';\n\nexport const RESET_STATE = 'RESET_STATE';\nexport const ADD_QUERY_EDITOR = 'ADD_QUERY_EDITOR';\nexport const UPDATE_QUERY_EDITOR = 'UPDATE_QUERY_EDITOR';\nexport const QUERY_EDITOR_SAVED = 'QUERY_EDITOR_SAVED';\nexport const CLONE_QUERY_TO_NEW_TAB = 'CLONE_QUERY_TO_NEW_TAB';\nexport const REMOVE_QUERY_EDITOR = 'REMOVE_QUERY_EDITOR';\nexport const MERGE_TABLE = 'MERGE_TABLE';\nexport const REMOVE_TABLES = 'REMOVE_TABLES';\nexport const END_QUERY = 'END_QUERY';\nexport const REMOVE_QUERY = 'REMOVE_QUERY';\nexport const EXPAND_TABLE = 'EXPAND_TABLE';\nexport const COLLAPSE_TABLE = 'COLLAPSE_TABLE';\nexport const QUERY_EDITOR_SETDB = 'QUERY_EDITOR_SETDB';\nexport const QUERY_EDITOR_SET_SCHEMA = 'QUERY_EDITOR_SET_SCHEMA';\nexport const QUERY_EDITOR_SET_TITLE = 'QUERY_EDITOR_SET_TITLE';\nexport const QUERY_EDITOR_SET_AUTORUN = 'QUERY_EDITOR_SET_AUTORUN';\nexport const QUERY_EDITOR_SET_SQL = 'QUERY_EDITOR_SET_SQL';\nexport const QUERY_EDITOR_SET_QUERY_LIMIT = 'QUERY_EDITOR_SET_QUERY_LIMIT';\nexport const QUERY_EDITOR_SET_TEMPLATE_PARAMS =\n'QUERY_EDITOR_SET_TEMPLATE_PARAMS';\nexport const QUERY_EDITOR_SET_SELECTED_TEXT = 'QUERY_EDITOR_SET_SELECTED_TEXT';\nexport const QUERY_EDITOR_SET_FUNCTION_NAMES =\n'QUERY_EDITOR_SET_FUNCTION_NAMES';\nexport const QUERY_EDITOR_PERSIST_HEIGHT = 'QUERY_EDITOR_PERSIST_HEIGHT';\nexport const QUERY_EDITOR_TOGGLE_LEFT_BAR = 'QUERY_EDITOR_TOGGLE_LEFT_BAR';\nexport const MIGRATE_QUERY_EDITOR = 'MIGRATE_QUERY_EDITOR';\nexport const MIGRATE_TAB_HISTORY = 'MIGRATE_TAB_HISTORY';\nexport const MIGRATE_TABLE = 'MIGRATE_TABLE';\nexport const MIGRATE_QUERY = 'MIGRATE_QUERY';\n\nexport const SET_DATABASES = 'SET_DATABASES';\nexport const SET_ACTIVE_QUERY_EDITOR = 'SET_ACTIVE_QUERY_EDITOR';\nexport const LOAD_QUERY_EDITOR = 'LOAD_QUERY_EDITOR';\nexport const SET_TABLES = 'SET_TABLES';\nexport const SET_ACTIVE_SOUTHPANE_TAB = 'SET_ACTIVE_SOUTHPANE_TAB';\nexport const REFRESH_QUERIES = 'REFRESH_QUERIES';\nexport const SET_USER_OFFLINE = 'SET_USER_OFFLINE';\nexport const RUN_QUERY = 'RUN_QUERY';\nexport const START_QUERY = 'START_QUERY';\nexport const STOP_QUERY = 'STOP_QUERY';\nexport const REQUEST_QUERY_RESULTS = 'REQUEST_QUERY_RESULTS';\nexport const QUERY_SUCCESS = 'QUERY_SUCCESS';\nexport const QUERY_FAILED = 'QUERY_FAILED';\nexport const CLEAR_INACTIVE_QUERIES = 'CLEAR_INACTIVE_QUERIES';\nexport const CLEAR_QUERY_RESULTS = 'CLEAR_QUERY_RESULTS';\nexport const REMOVE_DATA_PREVIEW = 'REMOVE_DATA_PREVIEW';\nexport const CHANGE_DATA_PREVIEW_ID = 'CHANGE_DATA_PREVIEW_ID';\n\nexport const COST_ESTIMATE_STARTED = 'COST_ESTIMATE_STARTED';\nexport const COST_ESTIMATE_RETURNED = 'COST_ESTIMATE_RETURNED';\nexport const COST_ESTIMATE_FAILED = 'COST_ESTIMATE_FAILED';\n\nexport const CREATE_DATASOURCE_STARTED = 'CREATE_DATASOURCE_STARTED';\nexport const CREATE_DATASOURCE_SUCCESS = 'CREATE_DATASOURCE_SUCCESS';\nexport const CREATE_DATASOURCE_FAILED = 'CREATE_DATASOURCE_FAILED';\n\nexport const addInfoToast = addInfoToastAction;\nexport const addSuccessToast = addSuccessToastAction;\nexport const addDangerToast = addDangerToastAction;\nexport const addWarningToast = addWarningToastAction;\n\nexport const CtasEnum = {\n  TABLE: 'TABLE',\n  VIEW: 'VIEW' };\n\nconst ERR_MSG_CANT_LOAD_QUERY = t(\"The query couldn't be loaded\");\n\n// a map of SavedQuery field names to the different names used client-side,\n// because for now making the names consistent is too complicated\n// so it might as well only happen in one place\nconst queryClientMapping = {\n  id: 'remoteId',\n  db_id: 'dbId',\n  label: 'name',\n  template_parameters: 'templateParams' };\n\nconst queryServerMapping = invert(queryClientMapping);\n\n// uses a mapping like those above to convert object key names to another style\nconst fieldConverter = (mapping) => (obj) =>\nmapKeys(obj, (value, key) => key in mapping ? mapping[key] : key);\n\nexport const convertQueryToServer = fieldConverter(queryServerMapping);\nexport const convertQueryToClient = fieldConverter(queryClientMapping);\n\nexport function getUpToDateQuery(rootState, queryEditor, key) {\n  const {\n    sqlLab: { unsavedQueryEditor } } =\n  rootState;\n  const id = key != null ? key : queryEditor.id;\n  return {\n    ...queryEditor,\n    ...(id === unsavedQueryEditor.id && unsavedQueryEditor) };\n\n}\n\nexport function resetState() {\n  return { type: RESET_STATE };\n}\n\nexport function updateQueryEditor(alterations) {\n  return { type: UPDATE_QUERY_EDITOR, alterations };\n}\n\nexport function scheduleQuery(query) {\n  return (dispatch) =>\n  SupersetClient.post({\n    endpoint: '/savedqueryviewapi/api/create',\n    postPayload: query,\n    stringify: false }).\n\n  then(() =>\n  dispatch(\n  addSuccessToast(\n  t(\n  'Your query has been scheduled. To see details of your query, navigate to Saved queries')))).\n\n\n\n\n  catch(() =>\n  dispatch(addDangerToast(t('Your query could not be scheduled'))));\n\n}\n\nexport function estimateQueryCost(queryEditor) {\n  return (dispatch, getState) => {\n    const { dbId, schema, sql, selectedText, templateParams } =\n    getUpToDateQuery(getState(), queryEditor);\n    const requestSql = selectedText || sql;\n\n    const postPayload = {\n      database_id: dbId,\n      schema,\n      sql: requestSql,\n      template_params: JSON.parse(templateParams || '{}') };\n\n\n    return Promise.all([\n    dispatch({ type: COST_ESTIMATE_STARTED, query: queryEditor }),\n    SupersetClient.post({\n      endpoint: '/api/v1/sqllab/estimate/',\n      body: JSON.stringify(postPayload),\n      headers: { 'Content-Type': 'application/json' } }).\n\n    then((_ref) => {let { json } = _ref;return (\n        dispatch({ type: COST_ESTIMATE_RETURNED, query: queryEditor, json }));}).\n\n    catch((response) =>\n    getClientErrorObject(response).then((error) => {\n      const message =\n      error.error ||\n      error.statusText ||\n      t('Failed at retrieving results');\n      return dispatch({\n        type: COST_ESTIMATE_FAILED,\n        query: queryEditor,\n        error: message });\n\n    }))]);\n\n\n  };\n}\n\nexport function clearInactiveQueries(interval) {\n  return { type: CLEAR_INACTIVE_QUERIES, interval };\n}\n\nexport function startQuery(query) {\n  Object.assign(query, {\n    id: query.id ? query.id : shortid.generate(),\n    progress: 0,\n    startDttm: now(),\n    state: query.runAsync ? 'pending' : 'running',\n    cached: false });\n\n  return { type: START_QUERY, query };\n}\n\nexport function querySuccess(query, results) {\n  return function (dispatch) {var _results$query;\n    const sqlEditorId = results == null ? void 0 : (_results$query = results.query) == null ? void 0 : _results$query.sqlEditorId;\n    const sync =\n    sqlEditorId &&\n    !query.isDataPreview &&\n    isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${sqlEditorId}`),\n      postPayload: { latest_query_id: query.id } }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: QUERY_SUCCESS, query, results })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while storing the latest query id in the backend. ' +\n    'Please contact your administrator if this problem persists.'))));\n\n\n\n\n  };\n}\n\nexport function queryFailed(query, msg, link, errors) {\n  return function (dispatch) {\n    const sync =\n    !query.isDataPreview &&\n    isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${query.sqlEditorId}`),\n      postPayload: { latest_query_id: query.id } }) :\n\n    Promise.resolve();\n\n    const eventData = {\n      has_err: true,\n      start_offset: query.startDttm,\n      ts: new Date().getTime() };\n\n    errors == null ? void 0 : errors.forEach((_ref2) => {var _extra$issue_codes;let { error_type: errorType, extra } = _ref2;\n      const messages = (extra == null ? void 0 : (_extra$issue_codes = extra.issue_codes) == null ? void 0 : _extra$issue_codes.map((_ref3) => {let { message } = _ref3;return message;})) || [\n      errorType];\n\n      messages.forEach((message) => {\n        dispatch(\n        logEvent(LOG_ACTIONS_SQLLAB_FETCH_FAILED_QUERY, {\n          ...eventData,\n          error_type: errorType,\n          error_details: message }));\n\n\n      });\n    });\n\n    return (\n      sync.\n      catch(() =>\n      dispatch(\n      addDangerToast(\n      t(\n      'An error occurred while storing the latest query id in the backend. ' +\n      'Please contact your administrator if this problem persists.'))))\n\n\n\n\n      // We should always show the error message, even if we couldn't sync the\n      // state to the backend\n      .then(() => dispatch({ type: QUERY_FAILED, query, msg, link, errors })));\n\n  };\n}\n\nexport function stopQuery(query) {\n  return { type: STOP_QUERY, query };\n}\n\nexport function clearQueryResults(query) {\n  return { type: CLEAR_QUERY_RESULTS, query };\n}\n\nexport function removeDataPreview(table) {\n  return { type: REMOVE_DATA_PREVIEW, table };\n}\n\nexport function requestQueryResults(query) {\n  return { type: REQUEST_QUERY_RESULTS, query };\n}\n\nexport function fetchQueryResults(query, displayLimit) {\n  return function (dispatch) {\n    dispatch(requestQueryResults(query));\n\n    const queryParams = rison.encode({\n      key: query.resultsKey,\n      rows: displayLimit || null });\n\n\n    return SupersetClient.get({\n      endpoint: `/api/v1/sqllab/results/?q=${queryParams}`,\n      parseMethod: 'json-bigint' }).\n\n    then((_ref4) => {let { json } = _ref4;return dispatch(querySuccess(query, json));}).\n    catch((response) =>\n    getClientErrorObject(response).then((error) => {\n      const message =\n      error.error ||\n      error.statusText ||\n      t('Failed at retrieving results');\n\n      return dispatch(\n      queryFailed(query, message, error.link, error.errors));\n\n    }));\n\n  };\n}\n\nexport function runQuery(query) {\n  return function (dispatch) {\n    dispatch(startQuery(query));\n    const postPayload = {\n      client_id: query.id,\n      database_id: query.dbId,\n      json: true,\n      runAsync: query.runAsync,\n      schema: query.schema,\n      sql: query.sql,\n      sql_editor_id: query.sqlEditorId,\n      tab: query.tab,\n      tmp_table_name: query.tempTable,\n      select_as_cta: query.ctas,\n      ctas_method: query.ctas_method,\n      templateParams: query.templateParams,\n      queryLimit: query.queryLimit,\n      expand_data: true };\n\n\n    const search = window.location.search || '';\n    return SupersetClient.post({\n      endpoint: `/api/v1/sqllab/execute/${search}`,\n      body: JSON.stringify(postPayload),\n      headers: { 'Content-Type': 'application/json' },\n      parseMethod: 'json-bigint' }).\n\n    then((_ref5) => {let { json } = _ref5;\n      if (!query.runAsync) {\n        dispatch(querySuccess(query, json));\n      }\n    }).\n    catch((response) =>\n    getClientErrorObject(response).then((error) => {\n      let message =\n      error.error ||\n      error.message ||\n      error.statusText ||\n      t('Unknown error');\n      if (_includesInstanceProperty(message).call(message, 'CSRF token')) {\n        message = t(COMMON_ERR_MESSAGES.SESSION_TIMED_OUT);\n      }\n      dispatch(queryFailed(query, message, error.link, error.errors));\n    }));\n\n  };\n}\n\nexport function runQueryFromSqlEditor(\ndatabase,\nqueryEditor,\ndefaultQueryLimit,\ntempTable,\nctas,\nctasMethod)\n{\n  return function (dispatch, getState) {\n    const qe = getUpToDateQuery(getState(), queryEditor, queryEditor.id);\n    const query = {\n      dbId: qe.dbId,\n      sql: qe.selectedText || qe.sql,\n      sqlEditorId: qe.id,\n      tab: qe.name,\n      schema: qe.schema,\n      tempTable,\n      templateParams: qe.templateParams,\n      queryLimit: qe.queryLimit || defaultQueryLimit,\n      runAsync: database ? database.allow_run_async : false,\n      ctas,\n      ctas_method: ctasMethod,\n      updateTabState: !qe.selectedText };\n\n    dispatch(runQuery(query));\n  };\n}\n\nexport function reRunQuery(query) {\n  // run Query with a new id\n  return function (dispatch) {\n    dispatch(runQuery({ ...query, id: shortid.generate() }));\n  };\n}\n\nexport function postStopQuery(query) {\n  return function (dispatch) {\n    return SupersetClient.post({\n      endpoint: '/api/v1/query/stop',\n      body: JSON.stringify({ client_id: query.id }),\n      headers: { 'Content-Type': 'application/json' } }).\n\n    then(() => dispatch(stopQuery(query))).\n    then(() => dispatch(addSuccessToast(t('Query was stopped.')))).\n    catch(() =>\n    dispatch(addDangerToast(t('Failed at stopping query. %s', query.id))));\n\n  };\n}\n\nexport function setDatabases(databases) {\n  return { type: SET_DATABASES, databases };\n}\n\nfunction migrateTable(table, queryEditorId, dispatch) {\n  return SupersetClient.post({\n    endpoint: encodeURI('/tableschemaview/'),\n    postPayload: { table: { ...table, queryEditorId } } }).\n\n  then((_ref6) => {let { json } = _ref6;\n    const newTable = {\n      ...table,\n      id: json.id,\n      queryEditorId };\n\n    return dispatch({ type: MIGRATE_TABLE, oldTable: table, newTable });\n  }).\n  catch(() =>\n  dispatch(\n  addWarningToast(\n  t(\n  'Unable to migrate table schema state to backend. Superset will retry ' +\n  'later. Please contact your administrator if this problem persists.'))));\n\n\n\n\n}\n\nfunction migrateQuery(queryId, queryEditorId, dispatch) {\n  return SupersetClient.post({\n    endpoint: encodeURI(`/tabstateview/${queryEditorId}/migrate_query`),\n    postPayload: { queryId } }).\n\n  then(() => dispatch({ type: MIGRATE_QUERY, queryId, queryEditorId })).\n  catch(() =>\n  dispatch(\n  addWarningToast(\n  t(\n  'Unable to migrate query state to backend. Superset will retry later. ' +\n  'Please contact your administrator if this problem persists.'))));\n\n\n\n\n}\n\nexport function migrateQueryEditorFromLocalStorage(\nqueryEditor,\ntables,\nqueries)\n{\n  return function (dispatch) {\n    return SupersetClient.post({\n      endpoint: '/tabstateview/',\n      postPayload: { queryEditor } }).\n\n    then((_ref7) => {let { json } = _ref7;\n      const newQueryEditor = {\n        ...queryEditor,\n        id: json.id.toString() };\n\n      dispatch({\n        type: MIGRATE_QUERY_EDITOR,\n        oldQueryEditor: queryEditor,\n        newQueryEditor });\n\n      dispatch({\n        type: MIGRATE_TAB_HISTORY,\n        oldId: queryEditor.id,\n        newId: newQueryEditor.id });\n\n      return Promise.all([\n      ...tables.map((table) =>\n      migrateTable(table, newQueryEditor.id, dispatch)),\n\n      ...queries.map((query) =>\n      migrateQuery(query.id, newQueryEditor.id, dispatch))]);\n\n\n    }).\n    catch(() =>\n    dispatch(\n    addWarningToast(\n    t(\n    'Unable to migrate query editor state to backend. Superset will retry ' +\n    'later. Please contact your administrator if this problem persists.'))));\n\n\n\n\n  };\n}\n\nexport function addQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.post({\n      endpoint: '/tabstateview/',\n      postPayload: { queryEditor } }) :\n\n    Promise.resolve({ json: { id: shortid.generate() } });\n\n    return sync.\n    then((_ref8) => {let { json } = _ref8;\n      const newQueryEditor = {\n        ...queryEditor,\n        id: json.id.toString() };\n\n      return dispatch({\n        type: ADD_QUERY_EDITOR,\n        queryEditor: newQueryEditor });\n\n    }).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'Unable to add a new tab to the backend. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function addNewQueryEditor() {\n  return function (dispatch, getState) {\n    const {\n      sqlLab: {\n        queryEditors,\n        tabHistory,\n        unsavedQueryEditor,\n        defaultDbId,\n        databases },\n\n      common } =\n    getState();\n    const activeQueryEditor = queryEditors.find(\n    (qe) => qe.id === tabHistory[tabHistory.length - 1]);\n\n    const dbIds = Object.values(databases).map((database) => database.id);\n    const firstDbId = dbIds.length > 0 ? Math.min(...dbIds) : undefined;\n    const { dbId, schema, queryLimit, autorun } = {\n      ...queryEditors[0],\n      ...activeQueryEditor,\n      ...(unsavedQueryEditor.id === (activeQueryEditor == null ? void 0 : activeQueryEditor.id) &&\n      unsavedQueryEditor) };\n\n    const warning = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    '' :\n    t(\n    '-- Note: Unless you save your query, these tabs will NOT persist if you clear your cookies or change browsers.\\n\\n');\n\n\n    const name = newQueryTabName(queryEditors || []);\n\n    return dispatch(\n    addQueryEditor({\n      dbId: dbId || defaultDbId || firstDbId,\n      schema: schema != null ? schema : null,\n      autorun: autorun != null ? autorun : false,\n      sql: `${warning}SELECT ...`,\n      queryLimit: queryLimit || common.conf.DEFAULT_SQLLAB_LIMIT,\n      name }));\n\n\n  };\n}\n\nexport function cloneQueryToNewTab(query, autorun) {\n  return function (dispatch, getState) {\n    const state = getState();\n    const { queryEditors, tabHistory } = state.sqlLab;\n    const sourceQueryEditor = queryEditors.find(\n    (qe) => qe.id === tabHistory[tabHistory.length - 1]);\n\n    const queryEditor = {\n      name: t('Copy of %s', sourceQueryEditor.name),\n      dbId: query.dbId ? query.dbId : null,\n      schema: query.schema ? query.schema : null,\n      autorun,\n      sql: query.sql,\n      queryLimit: sourceQueryEditor.queryLimit,\n      maxRow: sourceQueryEditor.maxRow,\n      templateParams: sourceQueryEditor.templateParams };\n\n    return dispatch(addQueryEditor(queryEditor));\n  };\n}\n\nexport function setActiveQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.post({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}/activate`) }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: SET_ACTIVE_QUERY_EDITOR, queryEditor })).\n    catch((response) => {\n      if (response.status !== 404) {\n        return dispatch(\n        addDangerToast(\n        t(\n        'An error occurred while setting the active tab. Please contact ' +\n        'your administrator.')));\n\n\n\n      }\n      return dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor });\n    });\n  };\n}\n\nexport function loadQueryEditor(queryEditor) {\n  return { type: LOAD_QUERY_EDITOR, queryEditor };\n}\n\nexport function setTables(tableSchemas) {\n  const tables = tableSchemas.\n  filter((tableSchema) => tableSchema.description !== null).\n  map((tableSchema) => {\n    const {\n      columns,\n      selectStar,\n      primaryKey,\n      foreignKeys,\n      indexes,\n      dataPreviewQueryId } =\n    tableSchema.description;\n    return {\n      dbId: tableSchema.database_id,\n      queryEditorId: tableSchema.tab_state_id.toString(),\n      schema: tableSchema.schema,\n      name: tableSchema.table,\n      expanded: tableSchema.expanded,\n      id: tableSchema.id,\n      dataPreviewQueryId,\n      columns,\n      selectStar,\n      primaryKey,\n      foreignKeys,\n      indexes,\n      isMetadataLoading: false,\n      isExtraMetadataLoading: false };\n\n  });\n  return { type: SET_TABLES, tables };\n}\n\nexport function switchQueryEditor(queryEditor, displayLimit) {\n  return function (dispatch) {\n    if (\n    isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) &&\n    queryEditor &&\n    !queryEditor.loaded)\n    {\n      SupersetClient.get({\n        endpoint: encodeURI(`/tabstateview/${queryEditor.id}`) }).\n\n      then((_ref9) => {var _json$latest_query, _json$saved_query;let { json } = _ref9;\n        const loadedQueryEditor = {\n          id: json.id.toString(),\n          loaded: true,\n          name: json.label,\n          sql: json.sql,\n          selectedText: null,\n          latestQueryId: (_json$latest_query = json.latest_query) == null ? void 0 : _json$latest_query.id,\n          autorun: json.autorun,\n          dbId: json.database_id,\n          templateParams: json.template_params,\n          schema: json.schema,\n          queryLimit: json.query_limit,\n          remoteId: (_json$saved_query = json.saved_query) == null ? void 0 : _json$saved_query.id,\n          validationResult: {\n            id: null,\n            errors: [],\n            completed: false },\n\n          hideLeftBar: json.hide_left_bar };\n\n        dispatch(loadQueryEditor(loadedQueryEditor));\n        dispatch(setTables(json.table_schemas || []));\n        dispatch(setActiveQueryEditor(loadedQueryEditor));\n        if (json.latest_query && json.latest_query.resultsKey) {\n          dispatch(fetchQueryResults(json.latest_query, displayLimit));\n        }\n      }).\n      catch((response) => {\n        if (response.status !== 404) {\n          return dispatch(\n          addDangerToast(t('An error occurred while fetching tab state')));\n\n        }\n        return dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor });\n      });\n    } else {\n      dispatch(setActiveQueryEditor(queryEditor));\n    }\n  };\n}\n\nexport function setActiveSouthPaneTab(tabId) {\n  return { type: SET_ACTIVE_SOUTHPANE_TAB, tabId };\n}\n\nexport function toggleLeftBar(queryEditor) {\n  const hideLeftBar = !queryEditor.hideLeftBar;\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { hide_left_bar: hideLeftBar } }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({\n      type: QUERY_EDITOR_TOGGLE_LEFT_BAR,\n      queryEditor,\n      hideLeftBar })).\n\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while hiding the left bar. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function removeQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.delete({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`) }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while removing tab. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function removeAllOtherQueryEditors(queryEditor) {\n  return function (dispatch, getState) {var _sqlLab$queryEditors;\n    const { sqlLab } = getState();\n    (_sqlLab$queryEditors = sqlLab.queryEditors) == null ? void 0 : _sqlLab$queryEditors.forEach((otherQueryEditor) => {\n      if (otherQueryEditor.id !== queryEditor.id) {\n        dispatch(removeQueryEditor(otherQueryEditor));\n      }\n    });\n  };\n}\n\nexport function removeQuery(query) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.delete({\n      endpoint: encodeURI(\n      `/tabstateview/${query.sqlEditorId}/query/${query.id}`) }) :\n\n\n    Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: REMOVE_QUERY, query })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while removing query. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetDb(queryEditor, dbId) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { database_id: dbId } }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: QUERY_EDITOR_SETDB, queryEditor, dbId })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab database ID. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetSchema(queryEditor, schema) {\n  return function (dispatch) {\n    const sync =\n    isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) &&\n    typeof queryEditor === 'object' ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { schema } }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({\n      type: QUERY_EDITOR_SET_SCHEMA,\n      queryEditor: queryEditor || {},\n      schema })).\n\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab schema. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetAutorun(queryEditor, autorun) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { autorun } }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({ type: QUERY_EDITOR_SET_AUTORUN, queryEditor, autorun })).\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab autorun. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetTitle(queryEditor, name, id) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${id}`),\n      postPayload: { label: name } }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({\n      type: QUERY_EDITOR_SET_TITLE,\n      queryEditor: { ...queryEditor, id },\n      name })).\n\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab name. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function saveQuery(query, clientId) {\n  const { id, ...payload } = convertQueryToServer(query);\n\n  return (dispatch) =>\n  SupersetClient.post({\n    endpoint: '/api/v1/saved_query/',\n    jsonPayload: convertQueryToServer(payload) }).\n\n  then((result) => {\n    const savedQuery = convertQueryToClient({\n      id: result.json.id,\n      ...result.json.result });\n\n    dispatch({\n      type: QUERY_EDITOR_SAVED,\n      query,\n      clientId,\n      result: savedQuery });\n\n    dispatch(queryEditorSetTitle(query, query.name, clientId));\n    return savedQuery;\n  }).\n  catch(() =>\n  dispatch(addDangerToast(t('Your query could not be saved'))));\n\n}\n\nexport const addSavedQueryToTabState =\n(queryEditor, savedQuery) => (dispatch) => {\n  const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n  SupersetClient.put({\n    endpoint: `/tabstateview/${queryEditor.id}`,\n    postPayload: { saved_query_id: savedQuery.remoteId } }) :\n\n  Promise.resolve();\n\n  return sync.\n  catch(() => {\n    dispatch(addDangerToast(t('Your query was not properly saved')));\n  }).\n  then(() => {\n    dispatch(addSuccessToast(t('Your query was saved')));\n  });\n};\n\nexport function updateSavedQuery(query, clientId) {\n  const { id, ...payload } = convertQueryToServer(query);\n\n  return (dispatch) =>\n  SupersetClient.put({\n    endpoint: `/api/v1/saved_query/${query.remoteId}`,\n    jsonPayload: convertQueryToServer(payload) }).\n\n  then(() => {\n    dispatch(addSuccessToast(t('Your query was updated')));\n    dispatch(queryEditorSetTitle(query, query.name, clientId));\n  }).\n  catch((e) => {\n    const message = t('Your query could not be updated');\n    // eslint-disable-next-line no-console\n    console.error(message, e);\n    dispatch(addDangerToast(message));\n  }).\n  then(() => dispatch(updateQueryEditor(query)));\n}\n\nexport function queryEditorSetSql(queryEditor, sql) {\n  return { type: QUERY_EDITOR_SET_SQL, queryEditor, sql };\n}\n\nexport function queryEditorSetAndSaveSql(targetQueryEditor, sql) {\n  return function (dispatch, getState) {\n    const queryEditor = getUpToDateQuery(getState(), targetQueryEditor);\n    // saved query and set tab state use this action\n    dispatch(queryEditorSetSql(queryEditor, sql));\n    if (isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)) {\n      return SupersetClient.put({\n        endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n        postPayload: { sql, latest_query_id: queryEditor.latestQueryId } }).\n      catch(() =>\n      dispatch(\n      addDangerToast(\n      t(\n      'An error occurred while storing your query in the backend. To ' +\n      'avoid losing your changes, please save your query using the ' +\n      '\"Save Query\" button.'))));\n\n\n\n\n    }\n    return Promise.resolve();\n  };\n}\n\nexport function queryEditorSetQueryLimit(queryEditor, queryLimit) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { query_limit: queryLimit } }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() =>\n    dispatch({\n      type: QUERY_EDITOR_SET_QUERY_LIMIT,\n      queryEditor,\n      queryLimit })).\n\n\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab name. Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetTemplateParams(queryEditor, templateParams) {\n  return function (dispatch) {\n    dispatch({\n      type: QUERY_EDITOR_SET_TEMPLATE_PARAMS,\n      queryEditor,\n      templateParams });\n\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.put({\n      endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      postPayload: { template_params: templateParams } }) :\n\n    Promise.resolve();\n\n    return sync.catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while setting the tab template parameters. ' +\n    'Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function queryEditorSetSelectedText(queryEditor, sql) {\n  return { type: QUERY_EDITOR_SET_SELECTED_TEXT, queryEditor, sql };\n}\n\nexport function mergeTable(table, query, prepend) {\n  return { type: MERGE_TABLE, table, query, prepend };\n}\n\nexport function addTable(queryEditor, tableName, schemaName) {\n  return function (dispatch, getState) {\n    const query = getUpToDateQuery(getState(), queryEditor, queryEditor.id);\n    const table = {\n      dbId: query.dbId,\n      queryEditorId: query.id,\n      schema: schemaName,\n      name: tableName };\n\n    dispatch(\n    mergeTable(\n    {\n      ...table,\n      id: shortid.generate(),\n      expanded: true },\n\n    null,\n    true));\n\n\n  };\n}\n\nexport function runTablePreviewQuery(newTable) {\n  return function (dispatch, getState) {\n    const {\n      sqlLab: { databases } } =\n    getState();\n    const database = databases[newTable.dbId];\n    const { dbId } = newTable;\n\n    if (database && !database.disable_data_preview) {\n      const dataPreviewQuery = {\n        id: shortid.generate(),\n        dbId,\n        sql: newTable.selectStar,\n        tableName: newTable.name,\n        sqlEditorId: null,\n        tab: '',\n        runAsync: database.allow_run_async,\n        ctas: false,\n        isDataPreview: true };\n\n      return Promise.all([\n      dispatch(\n      mergeTable(\n      {\n        id: newTable.id,\n        dbId: newTable.dbId,\n        schema: newTable.schema,\n        name: newTable.name,\n        queryEditorId: newTable.queryEditorId,\n        dataPreviewQueryId: dataPreviewQuery.id },\n\n      dataPreviewQuery)),\n\n\n      dispatch(runQuery(dataPreviewQuery))]);\n\n    }\n    return Promise.resolve();\n  };\n}\n\nexport function syncTable(table, tableMetadata) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.post({\n      endpoint: encodeURI('/tableschemaview/'),\n      postPayload: { table: { ...tableMetadata, ...table } } }) :\n\n    Promise.resolve({ json: { id: table.id } });\n\n    return sync.\n    then((_ref10) => {let { json: resultJson } = _ref10;\n      const newTable = { ...table, id: resultJson.id };\n      dispatch(\n      mergeTable({\n        ...newTable,\n        expanded: true,\n        initialized: true }));\n\n\n      if (!table.dataPreviewQueryId) {\n        dispatch(runTablePreviewQuery({ ...tableMetadata, ...newTable }));\n      }\n    }).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while fetching table metadata. ' +\n    'Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function changeDataPreviewId(oldQueryId, newQuery) {\n  return { type: CHANGE_DATA_PREVIEW_ID, oldQueryId, newQuery };\n}\n\nexport function reFetchQueryResults(query) {\n  return function (dispatch) {\n    const newQuery = {\n      id: shortid.generate(),\n      dbId: query.dbId,\n      sql: query.sql,\n      tableName: query.tableName,\n      sqlEditorId: null,\n      tab: '',\n      runAsync: false,\n      ctas: false,\n      queryLimit: query.queryLimit,\n      isDataPreview: query.isDataPreview };\n\n    dispatch(runQuery(newQuery));\n    dispatch(changeDataPreviewId(query.id, newQuery));\n  };\n}\n\nexport function expandTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.post({\n      endpoint: encodeURI(`/tableschemaview/${table.id}/expanded`),\n      postPayload: { expanded: true } }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: EXPAND_TABLE, table })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while expanding the table schema. ' +\n    'Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function collapseTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    SupersetClient.post({\n      endpoint: encodeURI(`/tableschemaview/${table.id}/expanded`),\n      postPayload: { expanded: false } }) :\n\n    Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: COLLAPSE_TABLE, table })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while collapsing the table schema. ' +\n    'Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function removeTables(tables) {\n  return function (dispatch) {var _tables$filter;\n    const tablesToRemove = (_tables$filter = tables == null ? void 0 : tables.filter(Boolean)) != null ? _tables$filter : [];\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) ?\n    Promise.all(\n    tablesToRemove.map((table) =>\n    SupersetClient.delete({\n      endpoint: encodeURI(`/tableschemaview/${table.id}`) }))) :\n\n\n\n    Promise.resolve();\n\n    return sync.\n    then(() => dispatch({ type: REMOVE_TABLES, tables: tablesToRemove })).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'An error occurred while removing the table schema. ' +\n    'Please contact your administrator.'))));\n\n\n\n\n  };\n}\n\nexport function refreshQueries(alteredQueries) {\n  return { type: REFRESH_QUERIES, alteredQueries };\n}\n\nexport function setUserOffline(offline) {\n  return { type: SET_USER_OFFLINE, offline };\n}\n\nexport function persistEditorHeight(queryEditor, northPercent, southPercent) {\n  return {\n    type: QUERY_EDITOR_PERSIST_HEIGHT,\n    queryEditor,\n    northPercent,\n    southPercent };\n\n}\n\nexport function popStoredQuery(urlId) {\n  return function (dispatch) {\n    return SupersetClient.get({ endpoint: `/kv/${urlId}` }).\n    then((_ref11) => {let { json } = _ref11;return (\n        dispatch(\n        addQueryEditor({\n          name: json.name ? json.name : t('Shared query'),\n          dbId: json.dbId ? parseInt(json.dbId, 10) : null,\n          schema: json.schema ? json.schema : null,\n          autorun: json.autorun ? json.autorun : false,\n          sql: json.sql ? json.sql : 'SELECT ...',\n          templateParams: json.templateParams })));}).\n\n\n\n    catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popSavedQuery(saveQueryId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/savedqueryviewapi/api/get/${saveQueryId}` }).\n\n    then((_ref12) => {let { json } = _ref12;\n      const queryEditorProps = {\n        ...convertQueryToClient(json.result),\n        loaded: true,\n        autorun: false };\n\n      return dispatch(addQueryEditor(queryEditorProps));\n    }).\n    catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popQuery(queryId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/query/${queryId}` }).\n\n    then((_ref13) => {let { json } = _ref13;\n      const queryData = json.result;\n      const queryEditorProps = {\n        dbId: queryData.database.id,\n        schema: queryData.schema,\n        sql: queryData.sql,\n        name: t('Copy of %s', queryData.tab_name),\n        autorun: false };\n\n      return dispatch(addQueryEditor(queryEditorProps));\n    }).\n    catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popDatasourceQuery(datasourceKey, sql) {\n  return function (dispatch) {\n    const QUERY_TEXT = t('Query');\n    const datasetId = datasourceKey.split('__')[0];\n    return SupersetClient.get({\n      endpoint: `/api/v1/dataset/${datasetId}?q=(keys:!(none))` }).\n\n    then((_ref14) => {let { json } = _ref14;return (\n        dispatch(\n        addQueryEditor({\n          name: `${QUERY_TEXT} ${json.result.name}`,\n          dbId: json.result.database.id,\n          schema: json.result.schema,\n          autorun: sql !== undefined,\n          sql: sql || json.result.select_star })));}).\n\n\n\n    catch(() =>\n    dispatch(addDangerToast(t(\"The datasource couldn't be loaded\"))));\n\n  };\n}\nexport function createDatasourceStarted() {\n  return { type: CREATE_DATASOURCE_STARTED };\n}\nexport function createDatasourceSuccess(data) {\n  const datasource = `${data.id}__table`;\n  return { type: CREATE_DATASOURCE_SUCCESS, datasource };\n}\nexport function createDatasourceFailed(err) {\n  return { type: CREATE_DATASOURCE_FAILED, err };\n}\n\nexport function createDatasource(vizOptions) {\n  return (dispatch) => {\n    dispatch(createDatasourceStarted());\n    const { dbId, schema, datasourceName, sql } = vizOptions;\n    return SupersetClient.post({\n      endpoint: '/api/v1/dataset/',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        database: dbId,\n        schema,\n        sql,\n        table_name: datasourceName,\n        is_managed_externally: false,\n        external_url: null }) }).\n\n\n    then((_ref15) => {let { json } = _ref15;\n      dispatch(createDatasourceSuccess(json));\n\n      return Promise.resolve(json);\n    }).\n    catch((error) => {\n      getClientErrorObject(error).then((e) => {\n        dispatch(addDangerToast(e.error));\n      });\n      dispatch(\n      createDatasourceFailed(\n      t('An error occurred while creating the data source')));\n\n\n\n      return Promise.reject();\n    });\n  };\n}\n\nexport function createCtasDatasource(vizOptions) {\n  return (dispatch) => {\n    dispatch(createDatasourceStarted());\n    return SupersetClient.post({\n      endpoint: '/api/v1/dataset/get_or_create/',\n      jsonPayload: vizOptions }).\n\n    then((_ref16) => {let { json } = _ref16;\n      dispatch(createDatasourceSuccess(json.result));\n\n      return json.result;\n    }).\n    catch(() => {\n      const errorMsg = t('An error occurred while creating the data source');\n      dispatch(createDatasourceFailed(errorMsg));\n      return Promise.reject(new Error(errorMsg));\n    });\n  };\n}","map":{"version":3,"names":["shortid","rison","FeatureFlag","SupersetClient","t","isFeatureEnabled","invert","mapKeys","now","addDangerToast","addDangerToastAction","addInfoToast","addInfoToastAction","addSuccessToast","addSuccessToastAction","addWarningToast","addWarningToastAction","getClientErrorObject","COMMON_ERR_MESSAGES","LOG_ACTIONS_SQLLAB_FETCH_FAILED_QUERY","logEvent","newQueryTabName","RESET_STATE","ADD_QUERY_EDITOR","UPDATE_QUERY_EDITOR","QUERY_EDITOR_SAVED","CLONE_QUERY_TO_NEW_TAB","REMOVE_QUERY_EDITOR","MERGE_TABLE","REMOVE_TABLES","END_QUERY","REMOVE_QUERY","EXPAND_TABLE","COLLAPSE_TABLE","QUERY_EDITOR_SETDB","QUERY_EDITOR_SET_SCHEMA","QUERY_EDITOR_SET_TITLE","QUERY_EDITOR_SET_AUTORUN","QUERY_EDITOR_SET_SQL","QUERY_EDITOR_SET_QUERY_LIMIT","QUERY_EDITOR_SET_TEMPLATE_PARAMS","QUERY_EDITOR_SET_SELECTED_TEXT","QUERY_EDITOR_SET_FUNCTION_NAMES","QUERY_EDITOR_PERSIST_HEIGHT","QUERY_EDITOR_TOGGLE_LEFT_BAR","MIGRATE_QUERY_EDITOR","MIGRATE_TAB_HISTORY","MIGRATE_TABLE","MIGRATE_QUERY","SET_DATABASES","SET_ACTIVE_QUERY_EDITOR","LOAD_QUERY_EDITOR","SET_TABLES","SET_ACTIVE_SOUTHPANE_TAB","REFRESH_QUERIES","SET_USER_OFFLINE","RUN_QUERY","START_QUERY","STOP_QUERY","REQUEST_QUERY_RESULTS","QUERY_SUCCESS","QUERY_FAILED","CLEAR_INACTIVE_QUERIES","CLEAR_QUERY_RESULTS","REMOVE_DATA_PREVIEW","CHANGE_DATA_PREVIEW_ID","COST_ESTIMATE_STARTED","COST_ESTIMATE_RETURNED","COST_ESTIMATE_FAILED","CREATE_DATASOURCE_STARTED","CREATE_DATASOURCE_SUCCESS","CREATE_DATASOURCE_FAILED","CtasEnum","TABLE","VIEW","ERR_MSG_CANT_LOAD_QUERY","queryClientMapping","id","db_id","label","template_parameters","queryServerMapping","fieldConverter","mapping","obj","value","key","convertQueryToServer","convertQueryToClient","getUpToDateQuery","rootState","queryEditor","sqlLab","unsavedQueryEditor","resetState","type","updateQueryEditor","alterations","scheduleQuery","query","dispatch","post","endpoint","postPayload","stringify","then","catch","estimateQueryCost","getState","dbId","schema","sql","selectedText","templateParams","requestSql","database_id","template_params","JSON","parse","Promise","all","body","headers","json","response","error","message","statusText","clearInactiveQueries","interval","startQuery","Object","assign","generate","progress","startDttm","state","runAsync","cached","querySuccess","results","sqlEditorId","sync","isDataPreview","SQLLAB_BACKEND_PERSISTENCE","put","encodeURI","latest_query_id","resolve","queryFailed","msg","link","errors","eventData","has_err","start_offset","ts","Date","getTime","forEach","error_type","errorType","extra","messages","issue_codes","map","error_details","stopQuery","clearQueryResults","removeDataPreview","table","requestQueryResults","fetchQueryResults","displayLimit","queryParams","encode","resultsKey","rows","get","parseMethod","runQuery","client_id","sql_editor_id","tab","tmp_table_name","tempTable","select_as_cta","ctas","ctas_method","queryLimit","expand_data","search","window","location","SESSION_TIMED_OUT","runQueryFromSqlEditor","database","defaultQueryLimit","ctasMethod","qe","name","allow_run_async","updateTabState","reRunQuery","postStopQuery","setDatabases","databases","migrateTable","queryEditorId","newTable","oldTable","migrateQuery","queryId","migrateQueryEditorFromLocalStorage","tables","queries","newQueryEditor","toString","oldQueryEditor","oldId","newId","addQueryEditor","addNewQueryEditor","queryEditors","tabHistory","defaultDbId","common","activeQueryEditor","find","length","dbIds","values","firstDbId","Math","min","undefined","autorun","warning","conf","DEFAULT_SQLLAB_LIMIT","cloneQueryToNewTab","sourceQueryEditor","maxRow","setActiveQueryEditor","status","loadQueryEditor","setTables","tableSchemas","filter","tableSchema","description","columns","selectStar","primaryKey","foreignKeys","indexes","dataPreviewQueryId","tab_state_id","expanded","isMetadataLoading","isExtraMetadataLoading","switchQueryEditor","loaded","loadedQueryEditor","latestQueryId","latest_query","query_limit","remoteId","saved_query","validationResult","completed","hideLeftBar","hide_left_bar","table_schemas","setActiveSouthPaneTab","tabId","toggleLeftBar","removeQueryEditor","delete","removeAllOtherQueryEditors","otherQueryEditor","removeQuery","queryEditorSetDb","queryEditorSetSchema","queryEditorSetAutorun","queryEditorSetTitle","saveQuery","clientId","payload","jsonPayload","result","savedQuery","addSavedQueryToTabState","saved_query_id","updateSavedQuery","e","console","queryEditorSetSql","queryEditorSetAndSaveSql","targetQueryEditor","queryEditorSetQueryLimit","queryEditorSetTemplateParams","queryEditorSetSelectedText","mergeTable","prepend","addTable","tableName","schemaName","runTablePreviewQuery","disable_data_preview","dataPreviewQuery","syncTable","tableMetadata","resultJson","initialized","changeDataPreviewId","oldQueryId","newQuery","reFetchQueryResults","expandTable","collapseTable","removeTables","tablesToRemove","Boolean","refreshQueries","alteredQueries","setUserOffline","offline","persistEditorHeight","northPercent","southPercent","popStoredQuery","urlId","parseInt","popSavedQuery","saveQueryId","queryEditorProps","popQuery","queryData","tab_name","popDatasourceQuery","datasourceKey","QUERY_TEXT","datasetId","split","select_star","createDatasourceStarted","createDatasourceSuccess","data","datasource","createDatasourceFailed","err","createDatasource","vizOptions","datasourceName","table_name","is_managed_externally","external_url","reject","createCtasDatasource","errorMsg","Error"],"sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/src/SqlLab/actions/sqlLab.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport shortid from 'shortid';\nimport rison from 'rison';\nimport {\n  FeatureFlag,\n  SupersetClient,\n  t,\n  isFeatureEnabled,\n} from '@superset-ui/core';\nimport invert from 'lodash/invert';\nimport mapKeys from 'lodash/mapKeys';\n\nimport { now } from 'src/utils/dates';\nimport {\n  addDangerToast as addDangerToastAction,\n  addInfoToast as addInfoToastAction,\n  addSuccessToast as addSuccessToastAction,\n  addWarningToast as addWarningToastAction,\n} from 'src/components/MessageToasts/actions';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport COMMON_ERR_MESSAGES from 'src/utils/errorMessages';\nimport { LOG_ACTIONS_SQLLAB_FETCH_FAILED_QUERY } from 'src/logger/LogUtils';\nimport { logEvent } from 'src/logger/actions';\nimport { newQueryTabName } from '../utils/newQueryTabName';\n\nexport const RESET_STATE = 'RESET_STATE';\nexport const ADD_QUERY_EDITOR = 'ADD_QUERY_EDITOR';\nexport const UPDATE_QUERY_EDITOR = 'UPDATE_QUERY_EDITOR';\nexport const QUERY_EDITOR_SAVED = 'QUERY_EDITOR_SAVED';\nexport const CLONE_QUERY_TO_NEW_TAB = 'CLONE_QUERY_TO_NEW_TAB';\nexport const REMOVE_QUERY_EDITOR = 'REMOVE_QUERY_EDITOR';\nexport const MERGE_TABLE = 'MERGE_TABLE';\nexport const REMOVE_TABLES = 'REMOVE_TABLES';\nexport const END_QUERY = 'END_QUERY';\nexport const REMOVE_QUERY = 'REMOVE_QUERY';\nexport const EXPAND_TABLE = 'EXPAND_TABLE';\nexport const COLLAPSE_TABLE = 'COLLAPSE_TABLE';\nexport const QUERY_EDITOR_SETDB = 'QUERY_EDITOR_SETDB';\nexport const QUERY_EDITOR_SET_SCHEMA = 'QUERY_EDITOR_SET_SCHEMA';\nexport const QUERY_EDITOR_SET_TITLE = 'QUERY_EDITOR_SET_TITLE';\nexport const QUERY_EDITOR_SET_AUTORUN = 'QUERY_EDITOR_SET_AUTORUN';\nexport const QUERY_EDITOR_SET_SQL = 'QUERY_EDITOR_SET_SQL';\nexport const QUERY_EDITOR_SET_QUERY_LIMIT = 'QUERY_EDITOR_SET_QUERY_LIMIT';\nexport const QUERY_EDITOR_SET_TEMPLATE_PARAMS =\n  'QUERY_EDITOR_SET_TEMPLATE_PARAMS';\nexport const QUERY_EDITOR_SET_SELECTED_TEXT = 'QUERY_EDITOR_SET_SELECTED_TEXT';\nexport const QUERY_EDITOR_SET_FUNCTION_NAMES =\n  'QUERY_EDITOR_SET_FUNCTION_NAMES';\nexport const QUERY_EDITOR_PERSIST_HEIGHT = 'QUERY_EDITOR_PERSIST_HEIGHT';\nexport const QUERY_EDITOR_TOGGLE_LEFT_BAR = 'QUERY_EDITOR_TOGGLE_LEFT_BAR';\nexport const MIGRATE_QUERY_EDITOR = 'MIGRATE_QUERY_EDITOR';\nexport const MIGRATE_TAB_HISTORY = 'MIGRATE_TAB_HISTORY';\nexport const MIGRATE_TABLE = 'MIGRATE_TABLE';\nexport const MIGRATE_QUERY = 'MIGRATE_QUERY';\n\nexport const SET_DATABASES = 'SET_DATABASES';\nexport const SET_ACTIVE_QUERY_EDITOR = 'SET_ACTIVE_QUERY_EDITOR';\nexport const LOAD_QUERY_EDITOR = 'LOAD_QUERY_EDITOR';\nexport const SET_TABLES = 'SET_TABLES';\nexport const SET_ACTIVE_SOUTHPANE_TAB = 'SET_ACTIVE_SOUTHPANE_TAB';\nexport const REFRESH_QUERIES = 'REFRESH_QUERIES';\nexport const SET_USER_OFFLINE = 'SET_USER_OFFLINE';\nexport const RUN_QUERY = 'RUN_QUERY';\nexport const START_QUERY = 'START_QUERY';\nexport const STOP_QUERY = 'STOP_QUERY';\nexport const REQUEST_QUERY_RESULTS = 'REQUEST_QUERY_RESULTS';\nexport const QUERY_SUCCESS = 'QUERY_SUCCESS';\nexport const QUERY_FAILED = 'QUERY_FAILED';\nexport const CLEAR_INACTIVE_QUERIES = 'CLEAR_INACTIVE_QUERIES';\nexport const CLEAR_QUERY_RESULTS = 'CLEAR_QUERY_RESULTS';\nexport const REMOVE_DATA_PREVIEW = 'REMOVE_DATA_PREVIEW';\nexport const CHANGE_DATA_PREVIEW_ID = 'CHANGE_DATA_PREVIEW_ID';\n\nexport const COST_ESTIMATE_STARTED = 'COST_ESTIMATE_STARTED';\nexport const COST_ESTIMATE_RETURNED = 'COST_ESTIMATE_RETURNED';\nexport const COST_ESTIMATE_FAILED = 'COST_ESTIMATE_FAILED';\n\nexport const CREATE_DATASOURCE_STARTED = 'CREATE_DATASOURCE_STARTED';\nexport const CREATE_DATASOURCE_SUCCESS = 'CREATE_DATASOURCE_SUCCESS';\nexport const CREATE_DATASOURCE_FAILED = 'CREATE_DATASOURCE_FAILED';\n\nexport const addInfoToast = addInfoToastAction;\nexport const addSuccessToast = addSuccessToastAction;\nexport const addDangerToast = addDangerToastAction;\nexport const addWarningToast = addWarningToastAction;\n\nexport const CtasEnum = {\n  TABLE: 'TABLE',\n  VIEW: 'VIEW',\n};\nconst ERR_MSG_CANT_LOAD_QUERY = t(\"The query couldn't be loaded\");\n\n// a map of SavedQuery field names to the different names used client-side,\n// because for now making the names consistent is too complicated\n// so it might as well only happen in one place\nconst queryClientMapping = {\n  id: 'remoteId',\n  db_id: 'dbId',\n  label: 'name',\n  template_parameters: 'templateParams',\n};\nconst queryServerMapping = invert(queryClientMapping);\n\n// uses a mapping like those above to convert object key names to another style\nconst fieldConverter = mapping => obj =>\n  mapKeys(obj, (value, key) => (key in mapping ? mapping[key] : key));\n\nexport const convertQueryToServer = fieldConverter(queryServerMapping);\nexport const convertQueryToClient = fieldConverter(queryClientMapping);\n\nexport function getUpToDateQuery(rootState, queryEditor, key) {\n  const {\n    sqlLab: { unsavedQueryEditor },\n  } = rootState;\n  const id = key ?? queryEditor.id;\n  return {\n    ...queryEditor,\n    ...(id === unsavedQueryEditor.id && unsavedQueryEditor),\n  };\n}\n\nexport function resetState() {\n  return { type: RESET_STATE };\n}\n\nexport function updateQueryEditor(alterations) {\n  return { type: UPDATE_QUERY_EDITOR, alterations };\n}\n\nexport function scheduleQuery(query) {\n  return dispatch =>\n    SupersetClient.post({\n      endpoint: '/savedqueryviewapi/api/create',\n      postPayload: query,\n      stringify: false,\n    })\n      .then(() =>\n        dispatch(\n          addSuccessToast(\n            t(\n              'Your query has been scheduled. To see details of your query, navigate to Saved queries',\n            ),\n          ),\n        ),\n      )\n      .catch(() =>\n        dispatch(addDangerToast(t('Your query could not be scheduled'))),\n      );\n}\n\nexport function estimateQueryCost(queryEditor) {\n  return (dispatch, getState) => {\n    const { dbId, schema, sql, selectedText, templateParams } =\n      getUpToDateQuery(getState(), queryEditor);\n    const requestSql = selectedText || sql;\n\n    const postPayload = {\n      database_id: dbId,\n      schema,\n      sql: requestSql,\n      template_params: JSON.parse(templateParams || '{}'),\n    };\n\n    return Promise.all([\n      dispatch({ type: COST_ESTIMATE_STARTED, query: queryEditor }),\n      SupersetClient.post({\n        endpoint: '/api/v1/sqllab/estimate/',\n        body: JSON.stringify(postPayload),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(({ json }) =>\n          dispatch({ type: COST_ESTIMATE_RETURNED, query: queryEditor, json }),\n        )\n        .catch(response =>\n          getClientErrorObject(response).then(error => {\n            const message =\n              error.error ||\n              error.statusText ||\n              t('Failed at retrieving results');\n            return dispatch({\n              type: COST_ESTIMATE_FAILED,\n              query: queryEditor,\n              error: message,\n            });\n          }),\n        ),\n    ]);\n  };\n}\n\nexport function clearInactiveQueries(interval) {\n  return { type: CLEAR_INACTIVE_QUERIES, interval };\n}\n\nexport function startQuery(query) {\n  Object.assign(query, {\n    id: query.id ? query.id : shortid.generate(),\n    progress: 0,\n    startDttm: now(),\n    state: query.runAsync ? 'pending' : 'running',\n    cached: false,\n  });\n  return { type: START_QUERY, query };\n}\n\nexport function querySuccess(query, results) {\n  return function (dispatch) {\n    const sqlEditorId = results?.query?.sqlEditorId;\n    const sync =\n      sqlEditorId &&\n      !query.isDataPreview &&\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n        ? SupersetClient.put({\n            endpoint: encodeURI(`/tabstateview/${sqlEditorId}`),\n            postPayload: { latest_query_id: query.id },\n          })\n        : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: QUERY_SUCCESS, query, results }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while storing the latest query id in the backend. ' +\n                'Please contact your administrator if this problem persists.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryFailed(query, msg, link, errors) {\n  return function (dispatch) {\n    const sync =\n      !query.isDataPreview &&\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n        ? SupersetClient.put({\n            endpoint: encodeURI(`/tabstateview/${query.sqlEditorId}`),\n            postPayload: { latest_query_id: query.id },\n          })\n        : Promise.resolve();\n\n    const eventData = {\n      has_err: true,\n      start_offset: query.startDttm,\n      ts: new Date().getTime(),\n    };\n    errors?.forEach(({ error_type: errorType, extra }) => {\n      const messages = extra?.issue_codes?.map(({ message }) => message) || [\n        errorType,\n      ];\n      messages.forEach(message => {\n        dispatch(\n          logEvent(LOG_ACTIONS_SQLLAB_FETCH_FAILED_QUERY, {\n            ...eventData,\n            error_type: errorType,\n            error_details: message,\n          }),\n        );\n      });\n    });\n\n    return (\n      sync\n        .catch(() =>\n          dispatch(\n            addDangerToast(\n              t(\n                'An error occurred while storing the latest query id in the backend. ' +\n                  'Please contact your administrator if this problem persists.',\n              ),\n            ),\n          ),\n        )\n        // We should always show the error message, even if we couldn't sync the\n        // state to the backend\n        .then(() => dispatch({ type: QUERY_FAILED, query, msg, link, errors }))\n    );\n  };\n}\n\nexport function stopQuery(query) {\n  return { type: STOP_QUERY, query };\n}\n\nexport function clearQueryResults(query) {\n  return { type: CLEAR_QUERY_RESULTS, query };\n}\n\nexport function removeDataPreview(table) {\n  return { type: REMOVE_DATA_PREVIEW, table };\n}\n\nexport function requestQueryResults(query) {\n  return { type: REQUEST_QUERY_RESULTS, query };\n}\n\nexport function fetchQueryResults(query, displayLimit) {\n  return function (dispatch) {\n    dispatch(requestQueryResults(query));\n\n    const queryParams = rison.encode({\n      key: query.resultsKey,\n      rows: displayLimit || null,\n    });\n\n    return SupersetClient.get({\n      endpoint: `/api/v1/sqllab/results/?q=${queryParams}`,\n      parseMethod: 'json-bigint',\n    })\n      .then(({ json }) => dispatch(querySuccess(query, json)))\n      .catch(response =>\n        getClientErrorObject(response).then(error => {\n          const message =\n            error.error ||\n            error.statusText ||\n            t('Failed at retrieving results');\n\n          return dispatch(\n            queryFailed(query, message, error.link, error.errors),\n          );\n        }),\n      );\n  };\n}\n\nexport function runQuery(query) {\n  return function (dispatch) {\n    dispatch(startQuery(query));\n    const postPayload = {\n      client_id: query.id,\n      database_id: query.dbId,\n      json: true,\n      runAsync: query.runAsync,\n      schema: query.schema,\n      sql: query.sql,\n      sql_editor_id: query.sqlEditorId,\n      tab: query.tab,\n      tmp_table_name: query.tempTable,\n      select_as_cta: query.ctas,\n      ctas_method: query.ctas_method,\n      templateParams: query.templateParams,\n      queryLimit: query.queryLimit,\n      expand_data: true,\n    };\n\n    const search = window.location.search || '';\n    return SupersetClient.post({\n      endpoint: `/api/v1/sqllab/execute/${search}`,\n      body: JSON.stringify(postPayload),\n      headers: { 'Content-Type': 'application/json' },\n      parseMethod: 'json-bigint',\n    })\n      .then(({ json }) => {\n        if (!query.runAsync) {\n          dispatch(querySuccess(query, json));\n        }\n      })\n      .catch(response =>\n        getClientErrorObject(response).then(error => {\n          let message =\n            error.error ||\n            error.message ||\n            error.statusText ||\n            t('Unknown error');\n          if (message.includes('CSRF token')) {\n            message = t(COMMON_ERR_MESSAGES.SESSION_TIMED_OUT);\n          }\n          dispatch(queryFailed(query, message, error.link, error.errors));\n        }),\n      );\n  };\n}\n\nexport function runQueryFromSqlEditor(\n  database,\n  queryEditor,\n  defaultQueryLimit,\n  tempTable,\n  ctas,\n  ctasMethod,\n) {\n  return function (dispatch, getState) {\n    const qe = getUpToDateQuery(getState(), queryEditor, queryEditor.id);\n    const query = {\n      dbId: qe.dbId,\n      sql: qe.selectedText || qe.sql,\n      sqlEditorId: qe.id,\n      tab: qe.name,\n      schema: qe.schema,\n      tempTable,\n      templateParams: qe.templateParams,\n      queryLimit: qe.queryLimit || defaultQueryLimit,\n      runAsync: database ? database.allow_run_async : false,\n      ctas,\n      ctas_method: ctasMethod,\n      updateTabState: !qe.selectedText,\n    };\n    dispatch(runQuery(query));\n  };\n}\n\nexport function reRunQuery(query) {\n  // run Query with a new id\n  return function (dispatch) {\n    dispatch(runQuery({ ...query, id: shortid.generate() }));\n  };\n}\n\nexport function postStopQuery(query) {\n  return function (dispatch) {\n    return SupersetClient.post({\n      endpoint: '/api/v1/query/stop',\n      body: JSON.stringify({ client_id: query.id }),\n      headers: { 'Content-Type': 'application/json' },\n    })\n      .then(() => dispatch(stopQuery(query)))\n      .then(() => dispatch(addSuccessToast(t('Query was stopped.'))))\n      .catch(() =>\n        dispatch(addDangerToast(t('Failed at stopping query. %s', query.id))),\n      );\n  };\n}\n\nexport function setDatabases(databases) {\n  return { type: SET_DATABASES, databases };\n}\n\nfunction migrateTable(table, queryEditorId, dispatch) {\n  return SupersetClient.post({\n    endpoint: encodeURI('/tableschemaview/'),\n    postPayload: { table: { ...table, queryEditorId } },\n  })\n    .then(({ json }) => {\n      const newTable = {\n        ...table,\n        id: json.id,\n        queryEditorId,\n      };\n      return dispatch({ type: MIGRATE_TABLE, oldTable: table, newTable });\n    })\n    .catch(() =>\n      dispatch(\n        addWarningToast(\n          t(\n            'Unable to migrate table schema state to backend. Superset will retry ' +\n              'later. Please contact your administrator if this problem persists.',\n          ),\n        ),\n      ),\n    );\n}\n\nfunction migrateQuery(queryId, queryEditorId, dispatch) {\n  return SupersetClient.post({\n    endpoint: encodeURI(`/tabstateview/${queryEditorId}/migrate_query`),\n    postPayload: { queryId },\n  })\n    .then(() => dispatch({ type: MIGRATE_QUERY, queryId, queryEditorId }))\n    .catch(() =>\n      dispatch(\n        addWarningToast(\n          t(\n            'Unable to migrate query state to backend. Superset will retry later. ' +\n              'Please contact your administrator if this problem persists.',\n          ),\n        ),\n      ),\n    );\n}\n\nexport function migrateQueryEditorFromLocalStorage(\n  queryEditor,\n  tables,\n  queries,\n) {\n  return function (dispatch) {\n    return SupersetClient.post({\n      endpoint: '/tabstateview/',\n      postPayload: { queryEditor },\n    })\n      .then(({ json }) => {\n        const newQueryEditor = {\n          ...queryEditor,\n          id: json.id.toString(),\n        };\n        dispatch({\n          type: MIGRATE_QUERY_EDITOR,\n          oldQueryEditor: queryEditor,\n          newQueryEditor,\n        });\n        dispatch({\n          type: MIGRATE_TAB_HISTORY,\n          oldId: queryEditor.id,\n          newId: newQueryEditor.id,\n        });\n        return Promise.all([\n          ...tables.map(table =>\n            migrateTable(table, newQueryEditor.id, dispatch),\n          ),\n          ...queries.map(query =>\n            migrateQuery(query.id, newQueryEditor.id, dispatch),\n          ),\n        ]);\n      })\n      .catch(() =>\n        dispatch(\n          addWarningToast(\n            t(\n              'Unable to migrate query editor state to backend. Superset will retry ' +\n                'later. Please contact your administrator if this problem persists.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function addQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: '/tabstateview/',\n          postPayload: { queryEditor },\n        })\n      : Promise.resolve({ json: { id: shortid.generate() } });\n\n    return sync\n      .then(({ json }) => {\n        const newQueryEditor = {\n          ...queryEditor,\n          id: json.id.toString(),\n        };\n        return dispatch({\n          type: ADD_QUERY_EDITOR,\n          queryEditor: newQueryEditor,\n        });\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'Unable to add a new tab to the backend. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function addNewQueryEditor() {\n  return function (dispatch, getState) {\n    const {\n      sqlLab: {\n        queryEditors,\n        tabHistory,\n        unsavedQueryEditor,\n        defaultDbId,\n        databases,\n      },\n      common,\n    } = getState();\n    const activeQueryEditor = queryEditors.find(\n      qe => qe.id === tabHistory[tabHistory.length - 1],\n    );\n    const dbIds = Object.values(databases).map(database => database.id);\n    const firstDbId = dbIds.length > 0 ? Math.min(...dbIds) : undefined;\n    const { dbId, schema, queryLimit, autorun } = {\n      ...queryEditors[0],\n      ...activeQueryEditor,\n      ...(unsavedQueryEditor.id === activeQueryEditor?.id &&\n        unsavedQueryEditor),\n    };\n    const warning = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? ''\n      : t(\n          '-- Note: Unless you save your query, these tabs will NOT persist if you clear your cookies or change browsers.\\n\\n',\n        );\n\n    const name = newQueryTabName(queryEditors || []);\n\n    return dispatch(\n      addQueryEditor({\n        dbId: dbId || defaultDbId || firstDbId,\n        schema: schema ?? null,\n        autorun: autorun ?? false,\n        sql: `${warning}SELECT ...`,\n        queryLimit: queryLimit || common.conf.DEFAULT_SQLLAB_LIMIT,\n        name,\n      }),\n    );\n  };\n}\n\nexport function cloneQueryToNewTab(query, autorun) {\n  return function (dispatch, getState) {\n    const state = getState();\n    const { queryEditors, tabHistory } = state.sqlLab;\n    const sourceQueryEditor = queryEditors.find(\n      qe => qe.id === tabHistory[tabHistory.length - 1],\n    );\n    const queryEditor = {\n      name: t('Copy of %s', sourceQueryEditor.name),\n      dbId: query.dbId ? query.dbId : null,\n      schema: query.schema ? query.schema : null,\n      autorun,\n      sql: query.sql,\n      queryLimit: sourceQueryEditor.queryLimit,\n      maxRow: sourceQueryEditor.maxRow,\n      templateParams: sourceQueryEditor.templateParams,\n    };\n    return dispatch(addQueryEditor(queryEditor));\n  };\n}\n\nexport function setActiveQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}/activate`),\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: SET_ACTIVE_QUERY_EDITOR, queryEditor }))\n      .catch(response => {\n        if (response.status !== 404) {\n          return dispatch(\n            addDangerToast(\n              t(\n                'An error occurred while setting the active tab. Please contact ' +\n                  'your administrator.',\n              ),\n            ),\n          );\n        }\n        return dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor });\n      });\n  };\n}\n\nexport function loadQueryEditor(queryEditor) {\n  return { type: LOAD_QUERY_EDITOR, queryEditor };\n}\n\nexport function setTables(tableSchemas) {\n  const tables = tableSchemas\n    .filter(tableSchema => tableSchema.description !== null)\n    .map(tableSchema => {\n      const {\n        columns,\n        selectStar,\n        primaryKey,\n        foreignKeys,\n        indexes,\n        dataPreviewQueryId,\n      } = tableSchema.description;\n      return {\n        dbId: tableSchema.database_id,\n        queryEditorId: tableSchema.tab_state_id.toString(),\n        schema: tableSchema.schema,\n        name: tableSchema.table,\n        expanded: tableSchema.expanded,\n        id: tableSchema.id,\n        dataPreviewQueryId,\n        columns,\n        selectStar,\n        primaryKey,\n        foreignKeys,\n        indexes,\n        isMetadataLoading: false,\n        isExtraMetadataLoading: false,\n      };\n    });\n  return { type: SET_TABLES, tables };\n}\n\nexport function switchQueryEditor(queryEditor, displayLimit) {\n  return function (dispatch) {\n    if (\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) &&\n      queryEditor &&\n      !queryEditor.loaded\n    ) {\n      SupersetClient.get({\n        endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n      })\n        .then(({ json }) => {\n          const loadedQueryEditor = {\n            id: json.id.toString(),\n            loaded: true,\n            name: json.label,\n            sql: json.sql,\n            selectedText: null,\n            latestQueryId: json.latest_query?.id,\n            autorun: json.autorun,\n            dbId: json.database_id,\n            templateParams: json.template_params,\n            schema: json.schema,\n            queryLimit: json.query_limit,\n            remoteId: json.saved_query?.id,\n            validationResult: {\n              id: null,\n              errors: [],\n              completed: false,\n            },\n            hideLeftBar: json.hide_left_bar,\n          };\n          dispatch(loadQueryEditor(loadedQueryEditor));\n          dispatch(setTables(json.table_schemas || []));\n          dispatch(setActiveQueryEditor(loadedQueryEditor));\n          if (json.latest_query && json.latest_query.resultsKey) {\n            dispatch(fetchQueryResults(json.latest_query, displayLimit));\n          }\n        })\n        .catch(response => {\n          if (response.status !== 404) {\n            return dispatch(\n              addDangerToast(t('An error occurred while fetching tab state')),\n            );\n          }\n          return dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor });\n        });\n    } else {\n      dispatch(setActiveQueryEditor(queryEditor));\n    }\n  };\n}\n\nexport function setActiveSouthPaneTab(tabId) {\n  return { type: SET_ACTIVE_SOUTHPANE_TAB, tabId };\n}\n\nexport function toggleLeftBar(queryEditor) {\n  const hideLeftBar = !queryEditor.hideLeftBar;\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { hide_left_bar: hideLeftBar },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_TOGGLE_LEFT_BAR,\n          queryEditor,\n          hideLeftBar,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while hiding the left bar. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function removeQueryEditor(queryEditor) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.delete({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: REMOVE_QUERY_EDITOR, queryEditor }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while removing tab. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function removeAllOtherQueryEditors(queryEditor) {\n  return function (dispatch, getState) {\n    const { sqlLab } = getState();\n    sqlLab.queryEditors?.forEach(otherQueryEditor => {\n      if (otherQueryEditor.id !== queryEditor.id) {\n        dispatch(removeQueryEditor(otherQueryEditor));\n      }\n    });\n  };\n}\n\nexport function removeQuery(query) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.delete({\n          endpoint: encodeURI(\n            `/tabstateview/${query.sqlEditorId}/query/${query.id}`,\n          ),\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: REMOVE_QUERY, query }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while removing query. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetDb(queryEditor, dbId) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { database_id: dbId },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: QUERY_EDITOR_SETDB, queryEditor, dbId }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab database ID. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetSchema(queryEditor, schema) {\n  return function (dispatch) {\n    const sync =\n      isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE) &&\n      typeof queryEditor === 'object'\n        ? SupersetClient.put({\n            endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n            postPayload: { schema },\n          })\n        : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_SET_SCHEMA,\n          queryEditor: queryEditor || {},\n          schema,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab schema. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetAutorun(queryEditor, autorun) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { autorun },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({ type: QUERY_EDITOR_SET_AUTORUN, queryEditor, autorun }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab autorun. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetTitle(queryEditor, name, id) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${id}`),\n          postPayload: { label: name },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_SET_TITLE,\n          queryEditor: { ...queryEditor, id },\n          name,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab name. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function saveQuery(query, clientId) {\n  const { id, ...payload } = convertQueryToServer(query);\n\n  return dispatch =>\n    SupersetClient.post({\n      endpoint: '/api/v1/saved_query/',\n      jsonPayload: convertQueryToServer(payload),\n    })\n      .then(result => {\n        const savedQuery = convertQueryToClient({\n          id: result.json.id,\n          ...result.json.result,\n        });\n        dispatch({\n          type: QUERY_EDITOR_SAVED,\n          query,\n          clientId,\n          result: savedQuery,\n        });\n        dispatch(queryEditorSetTitle(query, query.name, clientId));\n        return savedQuery;\n      })\n      .catch(() =>\n        dispatch(addDangerToast(t('Your query could not be saved'))),\n      );\n}\n\nexport const addSavedQueryToTabState =\n  (queryEditor, savedQuery) => dispatch => {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: `/tabstateview/${queryEditor.id}`,\n          postPayload: { saved_query_id: savedQuery.remoteId },\n        })\n      : Promise.resolve();\n\n    return sync\n      .catch(() => {\n        dispatch(addDangerToast(t('Your query was not properly saved')));\n      })\n      .then(() => {\n        dispatch(addSuccessToast(t('Your query was saved')));\n      });\n  };\n\nexport function updateSavedQuery(query, clientId) {\n  const { id, ...payload } = convertQueryToServer(query);\n\n  return dispatch =>\n    SupersetClient.put({\n      endpoint: `/api/v1/saved_query/${query.remoteId}`,\n      jsonPayload: convertQueryToServer(payload),\n    })\n      .then(() => {\n        dispatch(addSuccessToast(t('Your query was updated')));\n        dispatch(queryEditorSetTitle(query, query.name, clientId));\n      })\n      .catch(e => {\n        const message = t('Your query could not be updated');\n        // eslint-disable-next-line no-console\n        console.error(message, e);\n        dispatch(addDangerToast(message));\n      })\n      .then(() => dispatch(updateQueryEditor(query)));\n}\n\nexport function queryEditorSetSql(queryEditor, sql) {\n  return { type: QUERY_EDITOR_SET_SQL, queryEditor, sql };\n}\n\nexport function queryEditorSetAndSaveSql(targetQueryEditor, sql) {\n  return function (dispatch, getState) {\n    const queryEditor = getUpToDateQuery(getState(), targetQueryEditor);\n    // saved query and set tab state use this action\n    dispatch(queryEditorSetSql(queryEditor, sql));\n    if (isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)) {\n      return SupersetClient.put({\n        endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n        postPayload: { sql, latest_query_id: queryEditor.latestQueryId },\n      }).catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while storing your query in the backend. To ' +\n                'avoid losing your changes, please save your query using the ' +\n                '\"Save Query\" button.',\n            ),\n          ),\n        ),\n      );\n    }\n    return Promise.resolve();\n  };\n}\n\nexport function queryEditorSetQueryLimit(queryEditor, queryLimit) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { query_limit: queryLimit },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() =>\n        dispatch({\n          type: QUERY_EDITOR_SET_QUERY_LIMIT,\n          queryEditor,\n          queryLimit,\n        }),\n      )\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while setting the tab name. Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function queryEditorSetTemplateParams(queryEditor, templateParams) {\n  return function (dispatch) {\n    dispatch({\n      type: QUERY_EDITOR_SET_TEMPLATE_PARAMS,\n      queryEditor,\n      templateParams,\n    });\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.put({\n          endpoint: encodeURI(`/tabstateview/${queryEditor.id}`),\n          postPayload: { template_params: templateParams },\n        })\n      : Promise.resolve();\n\n    return sync.catch(() =>\n      dispatch(\n        addDangerToast(\n          t(\n            'An error occurred while setting the tab template parameters. ' +\n              'Please contact your administrator.',\n          ),\n        ),\n      ),\n    );\n  };\n}\n\nexport function queryEditorSetSelectedText(queryEditor, sql) {\n  return { type: QUERY_EDITOR_SET_SELECTED_TEXT, queryEditor, sql };\n}\n\nexport function mergeTable(table, query, prepend) {\n  return { type: MERGE_TABLE, table, query, prepend };\n}\n\nexport function addTable(queryEditor, tableName, schemaName) {\n  return function (dispatch, getState) {\n    const query = getUpToDateQuery(getState(), queryEditor, queryEditor.id);\n    const table = {\n      dbId: query.dbId,\n      queryEditorId: query.id,\n      schema: schemaName,\n      name: tableName,\n    };\n    dispatch(\n      mergeTable(\n        {\n          ...table,\n          id: shortid.generate(),\n          expanded: true,\n        },\n        null,\n        true,\n      ),\n    );\n  };\n}\n\nexport function runTablePreviewQuery(newTable) {\n  return function (dispatch, getState) {\n    const {\n      sqlLab: { databases },\n    } = getState();\n    const database = databases[newTable.dbId];\n    const { dbId } = newTable;\n\n    if (database && !database.disable_data_preview) {\n      const dataPreviewQuery = {\n        id: shortid.generate(),\n        dbId,\n        sql: newTable.selectStar,\n        tableName: newTable.name,\n        sqlEditorId: null,\n        tab: '',\n        runAsync: database.allow_run_async,\n        ctas: false,\n        isDataPreview: true,\n      };\n      return Promise.all([\n        dispatch(\n          mergeTable(\n            {\n              id: newTable.id,\n              dbId: newTable.dbId,\n              schema: newTable.schema,\n              name: newTable.name,\n              queryEditorId: newTable.queryEditorId,\n              dataPreviewQueryId: dataPreviewQuery.id,\n            },\n            dataPreviewQuery,\n          ),\n        ),\n        dispatch(runQuery(dataPreviewQuery)),\n      ]);\n    }\n    return Promise.resolve();\n  };\n}\n\nexport function syncTable(table, tableMetadata) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI('/tableschemaview/'),\n          postPayload: { table: { ...tableMetadata, ...table } },\n        })\n      : Promise.resolve({ json: { id: table.id } });\n\n    return sync\n      .then(({ json: resultJson }) => {\n        const newTable = { ...table, id: resultJson.id };\n        dispatch(\n          mergeTable({\n            ...newTable,\n            expanded: true,\n            initialized: true,\n          }),\n        );\n        if (!table.dataPreviewQueryId) {\n          dispatch(runTablePreviewQuery({ ...tableMetadata, ...newTable }));\n        }\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while fetching table metadata. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function changeDataPreviewId(oldQueryId, newQuery) {\n  return { type: CHANGE_DATA_PREVIEW_ID, oldQueryId, newQuery };\n}\n\nexport function reFetchQueryResults(query) {\n  return function (dispatch) {\n    const newQuery = {\n      id: shortid.generate(),\n      dbId: query.dbId,\n      sql: query.sql,\n      tableName: query.tableName,\n      sqlEditorId: null,\n      tab: '',\n      runAsync: false,\n      ctas: false,\n      queryLimit: query.queryLimit,\n      isDataPreview: query.isDataPreview,\n    };\n    dispatch(runQuery(newQuery));\n    dispatch(changeDataPreviewId(query.id, newQuery));\n  };\n}\n\nexport function expandTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI(`/tableschemaview/${table.id}/expanded`),\n          postPayload: { expanded: true },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: EXPAND_TABLE, table }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while expanding the table schema. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function collapseTable(table) {\n  return function (dispatch) {\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? SupersetClient.post({\n          endpoint: encodeURI(`/tableschemaview/${table.id}/expanded`),\n          postPayload: { expanded: false },\n        })\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: COLLAPSE_TABLE, table }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while collapsing the table schema. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function removeTables(tables) {\n  return function (dispatch) {\n    const tablesToRemove = tables?.filter(Boolean) ?? [];\n    const sync = isFeatureEnabled(FeatureFlag.SQLLAB_BACKEND_PERSISTENCE)\n      ? Promise.all(\n          tablesToRemove.map(table =>\n            SupersetClient.delete({\n              endpoint: encodeURI(`/tableschemaview/${table.id}`),\n            }),\n          ),\n        )\n      : Promise.resolve();\n\n    return sync\n      .then(() => dispatch({ type: REMOVE_TABLES, tables: tablesToRemove }))\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'An error occurred while removing the table schema. ' +\n                'Please contact your administrator.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nexport function refreshQueries(alteredQueries) {\n  return { type: REFRESH_QUERIES, alteredQueries };\n}\n\nexport function setUserOffline(offline) {\n  return { type: SET_USER_OFFLINE, offline };\n}\n\nexport function persistEditorHeight(queryEditor, northPercent, southPercent) {\n  return {\n    type: QUERY_EDITOR_PERSIST_HEIGHT,\n    queryEditor,\n    northPercent,\n    southPercent,\n  };\n}\n\nexport function popStoredQuery(urlId) {\n  return function (dispatch) {\n    return SupersetClient.get({ endpoint: `/kv/${urlId}` })\n      .then(({ json }) =>\n        dispatch(\n          addQueryEditor({\n            name: json.name ? json.name : t('Shared query'),\n            dbId: json.dbId ? parseInt(json.dbId, 10) : null,\n            schema: json.schema ? json.schema : null,\n            autorun: json.autorun ? json.autorun : false,\n            sql: json.sql ? json.sql : 'SELECT ...',\n            templateParams: json.templateParams,\n          }),\n        ),\n      )\n      .catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popSavedQuery(saveQueryId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/savedqueryviewapi/api/get/${saveQueryId}`,\n    })\n      .then(({ json }) => {\n        const queryEditorProps = {\n          ...convertQueryToClient(json.result),\n          loaded: true,\n          autorun: false,\n        };\n        return dispatch(addQueryEditor(queryEditorProps));\n      })\n      .catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popQuery(queryId) {\n  return function (dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/query/${queryId}`,\n    })\n      .then(({ json }) => {\n        const queryData = json.result;\n        const queryEditorProps = {\n          dbId: queryData.database.id,\n          schema: queryData.schema,\n          sql: queryData.sql,\n          name: t('Copy of %s', queryData.tab_name),\n          autorun: false,\n        };\n        return dispatch(addQueryEditor(queryEditorProps));\n      })\n      .catch(() => dispatch(addDangerToast(ERR_MSG_CANT_LOAD_QUERY)));\n  };\n}\nexport function popDatasourceQuery(datasourceKey, sql) {\n  return function (dispatch) {\n    const QUERY_TEXT = t('Query');\n    const datasetId = datasourceKey.split('__')[0];\n    return SupersetClient.get({\n      endpoint: `/api/v1/dataset/${datasetId}?q=(keys:!(none))`,\n    })\n      .then(({ json }) =>\n        dispatch(\n          addQueryEditor({\n            name: `${QUERY_TEXT} ${json.result.name}`,\n            dbId: json.result.database.id,\n            schema: json.result.schema,\n            autorun: sql !== undefined,\n            sql: sql || json.result.select_star,\n          }),\n        ),\n      )\n      .catch(() =>\n        dispatch(addDangerToast(t(\"The datasource couldn't be loaded\"))),\n      );\n  };\n}\nexport function createDatasourceStarted() {\n  return { type: CREATE_DATASOURCE_STARTED };\n}\nexport function createDatasourceSuccess(data) {\n  const datasource = `${data.id}__table`;\n  return { type: CREATE_DATASOURCE_SUCCESS, datasource };\n}\nexport function createDatasourceFailed(err) {\n  return { type: CREATE_DATASOURCE_FAILED, err };\n}\n\nexport function createDatasource(vizOptions) {\n  return dispatch => {\n    dispatch(createDatasourceStarted());\n    const { dbId, schema, datasourceName, sql } = vizOptions;\n    return SupersetClient.post({\n      endpoint: '/api/v1/dataset/',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        database: dbId,\n        schema,\n        sql,\n        table_name: datasourceName,\n        is_managed_externally: false,\n        external_url: null,\n      }),\n    })\n      .then(({ json }) => {\n        dispatch(createDatasourceSuccess(json));\n\n        return Promise.resolve(json);\n      })\n      .catch(error => {\n        getClientErrorObject(error).then(e => {\n          dispatch(addDangerToast(e.error));\n        });\n        dispatch(\n          createDatasourceFailed(\n            t('An error occurred while creating the data source'),\n          ),\n        );\n\n        return Promise.reject();\n      });\n  };\n}\n\nexport function createCtasDatasource(vizOptions) {\n  return dispatch => {\n    dispatch(createDatasourceStarted());\n    return SupersetClient.post({\n      endpoint: '/api/v1/dataset/get_or_create/',\n      jsonPayload: vizOptions,\n    })\n      .then(({ json }) => {\n        dispatch(createDatasourceSuccess(json.result));\n\n        return json.result;\n      })\n      .catch(() => {\n        const errorMsg = t('An error occurred while creating the data source');\n        dispatch(createDatasourceFailed(errorMsg));\n        return Promise.reject(new Error(errorMsg));\n      });\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}