{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { CategoricalColorNamespace, getMetricLabel, getNumberFormatter, NumberFormats, getColumnLabel } from '@superset-ui/core';\nimport { DEFAULT_FORM_DATA as DEFAULT_FUNNEL_FORM_DATA, EchartsFunnelLabelTypeType } from './types';\nimport { extractGroupbyLabel, getChartPadding, getColtypesMapping, getLegendProps, sanitizeHtml } from '../utils/series';\nimport { defaultGrid } from '../defaults';\nimport { OpacityEnum, DEFAULT_LEGEND_FORM_DATA } from '../constants';\nimport { getDefaultTooltip } from '../utils/tooltip';\nconst percentFormatter = getNumberFormatter(NumberFormats.PERCENT_2_POINT);\nexport function formatFunnelLabel(_ref) {let { params, labelType, numberFormatter, sanitizeName = false } = _ref;\n  const { name: rawName = '', value, percent } = params;\n  const name = sanitizeName ? sanitizeHtml(rawName) : rawName;\n  const formattedValue = numberFormatter(value);\n  const formattedPercent = percentFormatter(percent / 100);\n  switch (labelType) {\n    case EchartsFunnelLabelTypeType.Key:\n      return name;\n    case EchartsFunnelLabelTypeType.Value:\n      return formattedValue;\n    case EchartsFunnelLabelTypeType.Percent:\n      return formattedPercent;\n    case EchartsFunnelLabelTypeType.KeyValue:\n      return `${name}: ${formattedValue}`;\n    case EchartsFunnelLabelTypeType.KeyValuePercent:\n      return `${name}: ${formattedValue} (${formattedPercent})`;\n    case EchartsFunnelLabelTypeType.KeyPercent:\n      return `${name}: ${formattedPercent}`;\n    default:\n      return name;}\n\n}\nexport default function transformProps(chartProps) {\n  const { formData, height, hooks, filterState, queriesData, width, theme, inContextMenu, emitCrossFilters } = chartProps;\n  const data = queriesData[0].data || [];\n  const coltypeMapping = getColtypesMapping(queriesData[0]);\n  const { colorScheme, groupby, orient, sort, gap, labelLine, labelType, legendMargin, legendOrientation, legendType, metric = '', numberFormat, showLabels, showLegend, sliceId } = {\n    ...DEFAULT_LEGEND_FORM_DATA,\n    ...DEFAULT_FUNNEL_FORM_DATA,\n    ...formData };\n\n  const refs = {};\n  const metricLabel = getMetricLabel(metric);\n  const groupbyLabels = groupby.map(getColumnLabel);\n  const keys = data.map((datum) => extractGroupbyLabel({ datum, groupby: groupbyLabels, coltypeMapping: {} }));\n  const labelMap = data.reduce((acc, datum) => {\n    const label = extractGroupbyLabel({\n      datum,\n      groupby: groupbyLabels,\n      coltypeMapping: {} });\n\n    return {\n      ...acc,\n      [label]: groupbyLabels.map((col) => datum[col]) };\n\n  }, {});\n  const { setDataMask = () => {}, onContextMenu } = hooks;\n  const colorFn = CategoricalColorNamespace.getScale(colorScheme);\n  const numberFormatter = getNumberFormatter(numberFormat);\n  const transformedData = data.map((datum) => {var _context;\n    const name = extractGroupbyLabel({\n      datum,\n      groupby: groupbyLabels,\n      coltypeMapping: {} });\n\n    const isFiltered = filterState.selectedValues && !_includesInstanceProperty(_context = filterState.selectedValues).call(_context, name);\n    return {\n      value: datum[metricLabel],\n      name,\n      itemStyle: {\n        color: colorFn(name, sliceId),\n        opacity: isFiltered ?\n        OpacityEnum.SemiTransparent :\n        OpacityEnum.NonTransparent } };\n\n\n  });\n  const selectedValues = (filterState.selectedValues || []).reduce((acc, selectedValue) => {\n    const index = transformedData.findIndex((_ref2) => {let { name } = _ref2;return name === selectedValue;});\n    return {\n      ...acc,\n      [index]: selectedValue };\n\n  }, {});\n  const formatter = (params) => formatFunnelLabel({ params, numberFormatter, labelType });\n  const defaultLabel = {\n    formatter,\n    show: showLabels,\n    color: theme.colors.grayscale.dark2 };\n\n  const series = [\n  {\n    type: 'funnel',\n    ...getChartPadding(showLegend, legendOrientation, legendMargin),\n    animation: true,\n    minSize: '0%',\n    maxSize: '100%',\n    sort,\n    orient,\n    gap,\n    funnelAlign: 'center',\n    labelLine: { show: !!labelLine },\n    label: {\n      ...defaultLabel,\n      position: labelLine ? 'outer' : 'inner',\n      textBorderColor: 'transparent' },\n\n    emphasis: {\n      label: {\n        show: true,\n        fontWeight: 'bold' } },\n\n\n    // @ts-ignore\n    data: transformedData }];\n\n\n  const echartOptions = {\n    grid: {\n      ...defaultGrid },\n\n    tooltip: {\n      ...getDefaultTooltip(refs),\n      show: !inContextMenu,\n      trigger: 'item',\n      formatter: (params) => formatFunnelLabel({\n        params,\n        numberFormatter,\n        labelType: EchartsFunnelLabelTypeType.KeyValuePercent }) },\n\n\n    legend: {\n      ...getLegendProps(legendType, legendOrientation, showLegend, theme),\n      data: keys },\n\n    series };\n\n  return {\n    formData,\n    width,\n    height,\n    echartOptions,\n    setDataMask,\n    emitCrossFilters,\n    labelMap,\n    groupby,\n    selectedValues,\n    onContextMenu,\n    refs,\n    coltypeMapping };\n\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(percentFormatter, \"percentFormatter\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/plugin-chart-echarts/src/Funnel/transformProps.ts\");reactHotLoader.register(formatFunnelLabel, \"formatFunnelLabel\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/plugin-chart-echarts/src/Funnel/transformProps.ts\");reactHotLoader.register(transformProps, \"transformProps\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/plugin-chart-echarts/src/Funnel/transformProps.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"mappings":"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","names":["CategoricalColorNamespace","getMetricLabel","getNumberFormatter","NumberFormats","getColumnLabel","DEFAULT_FORM_DATA","DEFAULT_FUNNEL_FORM_DATA","EchartsFunnelLabelTypeType","extractGroupbyLabel","getChartPadding","getColtypesMapping","getLegendProps","sanitizeHtml","defaultGrid","OpacityEnum","DEFAULT_LEGEND_FORM_DATA","getDefaultTooltip","percentFormatter","PERCENT_2_POINT","formatFunnelLabel","params","labelType","numberFormatter","sanitizeName","name","rawName","value","percent","formattedValue","formattedPercent","Key","Value","Percent","KeyValue","KeyValuePercent","KeyPercent","transformProps","chartProps","formData","height","hooks","filterState","queriesData","width","theme","inContextMenu","emitCrossFilters","data","coltypeMapping","colorScheme","groupby","orient","sort","gap","labelLine","legendMargin","legendOrientation","legendType","metric","numberFormat","showLabels","showLegend","sliceId","refs","metricLabel","groupbyLabels","map","keys","datum","labelMap","reduce","acc","label","col","setDataMask","onContextMenu","colorFn","getScale","transformedData","isFiltered","selectedValues","itemStyle","color","opacity","SemiTransparent","NonTransparent","selectedValue","index","findIndex","formatter","defaultLabel","show","colors","grayscale","dark2","series","type","animation","minSize","maxSize","funnelAlign","position","textBorderColor","emphasis","fontWeight","echartOptions","grid","tooltip","trigger","legend"],"sourceRoot":"","sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/plugin-chart-echarts/src/Funnel/transformProps.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  CategoricalColorNamespace,\n  DataRecord,\n  getMetricLabel,\n  getNumberFormatter,\n  NumberFormats,\n  NumberFormatter,\n  getColumnLabel,\n} from '@superset-ui/core';\nimport { CallbackDataParams } from 'echarts/types/src/util/types';\nimport { EChartsCoreOption, FunnelSeriesOption } from 'echarts';\nimport {\n  DEFAULT_FORM_DATA as DEFAULT_FUNNEL_FORM_DATA,\n  EchartsFunnelChartProps,\n  EchartsFunnelFormData,\n  EchartsFunnelLabelTypeType,\n  FunnelChartTransformedProps,\n} from './types';\nimport {\n  extractGroupbyLabel,\n  getChartPadding,\n  getColtypesMapping,\n  getLegendProps,\n  sanitizeHtml,\n} from '../utils/series';\nimport { defaultGrid } from '../defaults';\nimport { OpacityEnum, DEFAULT_LEGEND_FORM_DATA } from '../constants';\nimport { getDefaultTooltip } from '../utils/tooltip';\nimport { Refs } from '../types';\n\nconst percentFormatter = getNumberFormatter(NumberFormats.PERCENT_2_POINT);\n\nexport function formatFunnelLabel({\n  params,\n  labelType,\n  numberFormatter,\n  sanitizeName = false,\n}: {\n  params: Pick<CallbackDataParams, 'name' | 'value' | 'percent'>;\n  labelType: EchartsFunnelLabelTypeType;\n  numberFormatter: NumberFormatter;\n  sanitizeName?: boolean;\n}): string {\n  const { name: rawName = '', value, percent } = params;\n  const name = sanitizeName ? sanitizeHtml(rawName) : rawName;\n  const formattedValue = numberFormatter(value as number);\n  const formattedPercent = percentFormatter((percent as number) / 100);\n  switch (labelType) {\n    case EchartsFunnelLabelTypeType.Key:\n      return name;\n    case EchartsFunnelLabelTypeType.Value:\n      return formattedValue;\n    case EchartsFunnelLabelTypeType.Percent:\n      return formattedPercent;\n    case EchartsFunnelLabelTypeType.KeyValue:\n      return `${name}: ${formattedValue}`;\n    case EchartsFunnelLabelTypeType.KeyValuePercent:\n      return `${name}: ${formattedValue} (${formattedPercent})`;\n    case EchartsFunnelLabelTypeType.KeyPercent:\n      return `${name}: ${formattedPercent}`;\n    default:\n      return name;\n  }\n}\n\nexport default function transformProps(\n  chartProps: EchartsFunnelChartProps,\n): FunnelChartTransformedProps {\n  const {\n    formData,\n    height,\n    hooks,\n    filterState,\n    queriesData,\n    width,\n    theme,\n    inContextMenu,\n    emitCrossFilters,\n  } = chartProps;\n  const data: DataRecord[] = queriesData[0].data || [];\n  const coltypeMapping = getColtypesMapping(queriesData[0]);\n  const {\n    colorScheme,\n    groupby,\n    orient,\n    sort,\n    gap,\n    labelLine,\n    labelType,\n    legendMargin,\n    legendOrientation,\n    legendType,\n    metric = '',\n    numberFormat,\n    showLabels,\n    showLegend,\n    sliceId,\n  }: EchartsFunnelFormData = {\n    ...DEFAULT_LEGEND_FORM_DATA,\n    ...DEFAULT_FUNNEL_FORM_DATA,\n    ...formData,\n  };\n  const refs: Refs = {};\n  const metricLabel = getMetricLabel(metric);\n  const groupbyLabels = groupby.map(getColumnLabel);\n  const keys = data.map(datum =>\n    extractGroupbyLabel({ datum, groupby: groupbyLabels, coltypeMapping: {} }),\n  );\n  const labelMap = data.reduce((acc: Record<string, string[]>, datum) => {\n    const label = extractGroupbyLabel({\n      datum,\n      groupby: groupbyLabels,\n      coltypeMapping: {},\n    });\n    return {\n      ...acc,\n      [label]: groupbyLabels.map(col => datum[col] as string),\n    };\n  }, {});\n\n  const { setDataMask = () => {}, onContextMenu } = hooks;\n\n  const colorFn = CategoricalColorNamespace.getScale(colorScheme as string);\n  const numberFormatter = getNumberFormatter(numberFormat);\n\n  const transformedData: FunnelSeriesOption[] = data.map(datum => {\n    const name = extractGroupbyLabel({\n      datum,\n      groupby: groupbyLabels,\n      coltypeMapping: {},\n    });\n    const isFiltered =\n      filterState.selectedValues && !filterState.selectedValues.includes(name);\n    return {\n      value: datum[metricLabel],\n      name,\n      itemStyle: {\n        color: colorFn(name, sliceId),\n        opacity: isFiltered\n          ? OpacityEnum.SemiTransparent\n          : OpacityEnum.NonTransparent,\n      },\n    };\n  });\n\n  const selectedValues = (filterState.selectedValues || []).reduce(\n    (acc: Record<string, number>, selectedValue: string) => {\n      const index = transformedData.findIndex(\n        ({ name }) => name === selectedValue,\n      );\n      return {\n        ...acc,\n        [index]: selectedValue,\n      };\n    },\n    {},\n  );\n\n  const formatter = (params: CallbackDataParams) =>\n    formatFunnelLabel({ params, numberFormatter, labelType });\n\n  const defaultLabel = {\n    formatter,\n    show: showLabels,\n    color: theme.colors.grayscale.dark2,\n  };\n\n  const series: FunnelSeriesOption[] = [\n    {\n      type: 'funnel',\n      ...getChartPadding(showLegend, legendOrientation, legendMargin),\n      animation: true,\n      minSize: '0%',\n      maxSize: '100%',\n      sort,\n      orient,\n      gap,\n      funnelAlign: 'center',\n      labelLine: { show: !!labelLine },\n      label: {\n        ...defaultLabel,\n        position: labelLine ? 'outer' : 'inner',\n        textBorderColor: 'transparent',\n      },\n      emphasis: {\n        label: {\n          show: true,\n          fontWeight: 'bold',\n        },\n      },\n      // @ts-ignore\n      data: transformedData,\n    },\n  ];\n\n  const echartOptions: EChartsCoreOption = {\n    grid: {\n      ...defaultGrid,\n    },\n    tooltip: {\n      ...getDefaultTooltip(refs),\n      show: !inContextMenu,\n      trigger: 'item',\n      formatter: (params: any) =>\n        formatFunnelLabel({\n          params,\n          numberFormatter,\n          labelType: EchartsFunnelLabelTypeType.KeyValuePercent,\n        }),\n    },\n    legend: {\n      ...getLegendProps(legendType, legendOrientation, showLegend, theme),\n      data: keys,\n    },\n    series,\n  };\n\n  return {\n    formData,\n    width,\n    height,\n    echartOptions,\n    setDataMask,\n    emitCrossFilters,\n    labelMap,\n    groupby,\n    selectedValues,\n    onContextMenu,\n    refs,\n    coltypeMapping,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}