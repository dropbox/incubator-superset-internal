{"ast":null,"code":"function _EMOTION_STRINGIFIED_CSS_ERROR__() {return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";} /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useRef, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { css, ensureIsArray, GenericDataType, t, useTheme } from '@superset-ui/core';\nimport { useResizeDetector } from 'react-resize-detector';\nimport Loading from 'src/components/Loading';\nimport BooleanCell from 'src/components/Table/cell-renderers/BooleanCell';\nimport NullCell from 'src/components/Table/cell-renderers/NullCell';\nimport TimeCell from 'src/components/Table/cell-renderers/TimeCell';\nimport { EmptyStateMedium } from 'src/components/EmptyState';\nimport { getDatasourceSamples } from 'src/components/Chart/chartAction';\nimport Table, { TableSize } from 'src/components/Table';\nimport HeaderWithRadioGroup from 'src/components/Table/header-renderers/HeaderWithRadioGroup';\nimport { ResourceStatus } from 'src/hooks/apiResources/apiResources';\nimport { useDatasetMetadataBar } from 'src/features/datasets/metadataBar/useDatasetMetadataBar';\nimport TableControls from './DrillDetailTableControls';\nimport { getDrillPayload } from './utils';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst PAGE_SIZE = 50;\n// Must be outside of the main component due to problems in\n// react-resize-detector with conditional rendering\n// https://github.com/maslianok/react-resize-detector/issues/178\nvar _ref2 = process.env.NODE_ENV === \"production\" ? { name: \"82a6rk\", styles: \"flex:1\" } : { name: \"1715jyj-Resizable\", styles: \"flex:1;label:Resizable;\", map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9ib2dkYW5reXJ5bGl1ay9jb2RlL29wZW5zb3VyY2Uvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2NvbXBvbmVudHMvQ2hhcnQvRHJpbGxEZXRhaWwvRHJpbGxEZXRhaWxQYW5lLnRzeCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUF3QzJCIiwiZmlsZSI6Ii9Vc2Vycy9ib2dkYW5reXJ5bGl1ay9jb2RlL29wZW5zb3VyY2Uvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2NvbXBvbmVudHMvQ2hhcnQvRHJpbGxEZXRhaWwvRHJpbGxEZXRhaWxQYW5lLnRzeCIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogTGljZW5zZWQgdG8gdGhlIEFwYWNoZSBTb2Z0d2FyZSBGb3VuZGF0aW9uIChBU0YpIHVuZGVyIG9uZVxuICogb3IgbW9yZSBjb250cmlidXRvciBsaWNlbnNlIGFncmVlbWVudHMuICBTZWUgdGhlIE5PVElDRSBmaWxlXG4gKiBkaXN0cmlidXRlZCB3aXRoIHRoaXMgd29yayBmb3IgYWRkaXRpb25hbCBpbmZvcm1hdGlvblxuICogcmVnYXJkaW5nIGNvcHlyaWdodCBvd25lcnNoaXAuICBUaGUgQVNGIGxpY2Vuc2VzIHRoaXMgZmlsZVxuICogdG8geW91IHVuZGVyIHRoZSBBcGFjaGUgTGljZW5zZSwgVmVyc2lvbiAyLjAgKHRoZVxuICogXCJMaWNlbnNlXCIpOyB5b3UgbWF5IG5vdCB1c2UgdGhpcyBmaWxlIGV4Y2VwdCBpbiBjb21wbGlhbmNlXG4gKiB3aXRoIHRoZSBMaWNlbnNlLiAgWW91IG1heSBvYnRhaW4gYSBjb3B5IG9mIHRoZSBMaWNlbnNlIGF0XG4gKlxuICogICBodHRwOi8vd3d3LmFwYWNoZS5vcmcvbGljZW5zZXMvTElDRU5TRS0yLjBcbiAqXG4gKiBVbmxlc3MgcmVxdWlyZWQgYnkgYXBwbGljYWJsZSBsYXcgb3IgYWdyZWVkIHRvIGluIHdyaXRpbmcsXG4gKiBzb2Z0d2FyZSBkaXN0cmlidXRlZCB1bmRlciB0aGUgTGljZW5zZSBpcyBkaXN0cmlidXRlZCBvbiBhblxuICogXCJBUyBJU1wiIEJBU0lTLCBXSVRIT1VUIFdBUlJBTlRJRVMgT1IgQ09ORElUSU9OUyBPRiBBTllcbiAqIEtJTkQsIGVpdGhlciBleHByZXNzIG9yIGltcGxpZWQuICBTZWUgdGhlIExpY2Vuc2UgZm9yIHRoZVxuICogc3BlY2lmaWMgbGFuZ3VhZ2UgZ292ZXJuaW5nIHBlcm1pc3Npb25zIGFuZCBsaW1pdGF0aW9uc1xuICogdW5kZXIgdGhlIExpY2Vuc2UuXG4gKi9cbmltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VSZWYsIHVzZVN0YXRlLCB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7IHVzZVNlbGVjdG9yIH0gZnJvbSAncmVhY3QtcmVkdXgnO1xuaW1wb3J0IHsgY3NzLCBlbnN1cmVJc0FycmF5LCBHZW5lcmljRGF0YVR5cGUsIHQsIHVzZVRoZW1lLCB9IGZyb20gJ0BzdXBlcnNldC11aS9jb3JlJztcbmltcG9ydCB7IHVzZVJlc2l6ZURldGVjdG9yIH0gZnJvbSAncmVhY3QtcmVzaXplLWRldGVjdG9yJztcbmltcG9ydCBMb2FkaW5nIGZyb20gJ3NyYy9jb21wb25lbnRzL0xvYWRpbmcnO1xuaW1wb3J0IEJvb2xlYW5DZWxsIGZyb20gJ3NyYy9jb21wb25lbnRzL1RhYmxlL2NlbGwtcmVuZGVyZXJzL0Jvb2xlYW5DZWxsJztcbmltcG9ydCBOdWxsQ2VsbCBmcm9tICdzcmMvY29tcG9uZW50cy9UYWJsZS9jZWxsLXJlbmRlcmVycy9OdWxsQ2VsbCc7XG5pbXBvcnQgVGltZUNlbGwgZnJvbSAnc3JjL2NvbXBvbmVudHMvVGFibGUvY2VsbC1yZW5kZXJlcnMvVGltZUNlbGwnO1xuaW1wb3J0IHsgRW1wdHlTdGF0ZU1lZGl1bSB9IGZyb20gJ3NyYy9jb21wb25lbnRzL0VtcHR5U3RhdGUnO1xuaW1wb3J0IHsgZ2V0RGF0YXNvdXJjZVNhbXBsZXMgfSBmcm9tICdzcmMvY29tcG9uZW50cy9DaGFydC9jaGFydEFjdGlvbic7XG5pbXBvcnQgVGFibGUsIHsgVGFibGVTaXplIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvVGFibGUnO1xuaW1wb3J0IEhlYWRlcldpdGhSYWRpb0dyb3VwIGZyb20gJ3NyYy9jb21wb25lbnRzL1RhYmxlL2hlYWRlci1yZW5kZXJlcnMvSGVhZGVyV2l0aFJhZGlvR3JvdXAnO1xuaW1wb3J0IHsgUmVzb3VyY2VTdGF0dXMgfSBmcm9tICdzcmMvaG9va3MvYXBpUmVzb3VyY2VzL2FwaVJlc291cmNlcyc7XG5pbXBvcnQgeyB1c2VEYXRhc2V0TWV0YWRhdGFCYXIgfSBmcm9tICdzcmMvZmVhdHVyZXMvZGF0YXNldHMvbWV0YWRhdGFCYXIvdXNlRGF0YXNldE1ldGFkYXRhQmFyJztcbmltcG9ydCBUYWJsZUNvbnRyb2xzIGZyb20gJy4vRHJpbGxEZXRhaWxUYWJsZUNvbnRyb2xzJztcbmltcG9ydCB7IGdldERyaWxsUGF5bG9hZCB9IGZyb20gJy4vdXRpbHMnO1xuY29uc3QgUEFHRV9TSVpFID0gNTA7XG4vLyBNdXN0IGJlIG91dHNpZGUgb2YgdGhlIG1haW4gY29tcG9uZW50IGR1ZSB0byBwcm9ibGVtcyBpblxuLy8gcmVhY3QtcmVzaXplLWRldGVjdG9yIHdpdGggY29uZGl0aW9uYWwgcmVuZGVyaW5nXG4vLyBodHRwczovL2dpdGh1Yi5jb20vbWFzbGlhbm9rL3JlYWN0LXJlc2l6ZS1kZXRlY3Rvci9pc3N1ZXMvMTc4XG5mdW5jdGlvbiBSZXNpemFibGUoeyBjaGlsZHJlbiB9KSB7XG4gICAgY29uc3QgeyByZWYsIGhlaWdodCB9ID0gdXNlUmVzaXplRGV0ZWN0b3IoKTtcbiAgICByZXR1cm4gKDxkaXYgcmVmPXtyZWZ9IGNzcz17eyBmbGV4OiAxIH19PlxuICAgICAge1JlYWN0LmNsb25lRWxlbWVudChjaGlsZHJlbiwgeyBoZWlnaHQgfSl9XG4gICAgPC9kaXY+KTtcbn1cbnZhciBUaW1lRm9ybWF0dGluZztcbihmdW5jdGlvbiAoVGltZUZvcm1hdHRpbmcpIHtcbiAgICBUaW1lRm9ybWF0dGluZ1tUaW1lRm9ybWF0dGluZ1tcIk9yaWdpbmFsXCJdID0gMF0gPSBcIk9yaWdpbmFsXCI7XG4gICAgVGltZUZvcm1hdHRpbmdbVGltZUZvcm1hdHRpbmdbXCJGb3JtYXR0ZWRcIl0gPSAxXSA9IFwiRm9ybWF0dGVkXCI7XG59KShUaW1lRm9ybWF0dGluZyB8fCAoVGltZUZvcm1hdHRpbmcgPSB7fSkpO1xuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gRHJpbGxEZXRhaWxQYW5lKHsgZm9ybURhdGEsIGluaXRpYWxGaWx0ZXJzLCB9KSB7XG4gICAgY29uc3QgdGhlbWUgPSB1c2VUaGVtZSgpO1xuICAgIGNvbnN0IFtwYWdlSW5kZXgsIHNldFBhZ2VJbmRleF0gPSB1c2VTdGF0ZSgwKTtcbiAgICBjb25zdCBsYXN0UGFnZUluZGV4ID0gdXNlUmVmKHBhZ2VJbmRleCk7XG4gICAgY29uc3QgW2ZpbHRlcnMsIHNldEZpbHRlcnNdID0gdXNlU3RhdGUoaW5pdGlhbEZpbHRlcnMpO1xuICAgIGNvbnN0IFtpc0xvYWRpbmcsIHNldElzTG9hZGluZ10gPSB1c2VTdGF0ZShmYWxzZSk7XG4gICAgY29uc3QgW3Jlc3BvbnNlRXJyb3IsIHNldFJlc3BvbnNlRXJyb3JdID0gdXNlU3RhdGUoJycpO1xuICAgIGNvbnN0IFtyZXN1bHRzUGFnZXMsIHNldFJlc3VsdHNQYWdlc10gPSB1c2VTdGF0ZShuZXcgTWFwKCkpO1xuICAgIGNvbnN0IFt0aW1lRm9ybWF0dGluZywgc2V0VGltZUZvcm1hdHRpbmddID0gdXNlU3RhdGUoe30pO1xuICAgIGNvbnN0IFNBTVBMRVNfUk9XX0xJTUlUID0gdXNlU2VsZWN0b3IoKHN0YXRlKSA9PiBzdGF0ZS5jb21tb24uY29uZi5TQU1QTEVTX1JPV19MSU1JVCk7XG4gICAgLy8gRXh0cmFjdCBkYXRhc291cmNlIElEL3R5cGUgZnJvbSBzdHJpbmcgSURcbiAgICBjb25zdCBbZGF0YXNvdXJjZUlkLCBkYXRhc291cmNlVHlwZV0gPSB1c2VNZW1vKCgpID0+IGZvcm1EYXRhLmRhdGFzb3VyY2Uuc3BsaXQoJ19fJyksIFtmb3JtRGF0YS5kYXRhc291cmNlXSk7XG4gICAgY29uc3QgeyBtZXRhZGF0YUJhciwgc3RhdHVzOiBtZXRhZGF0YUJhclN0YXR1cyB9ID0gdXNlRGF0YXNldE1ldGFkYXRhQmFyKHtcbiAgICAgICAgZGF0YXNldElkOiBkYXRhc291cmNlSWQsXG4gICAgfSk7XG4gICAgLy8gR2V0IHBhZ2Ugb2YgcmVzdWx0c1xuICAgIGNvbnN0IHJlc3VsdHNQYWdlID0gdXNlTWVtbygoKSA9PiB7XG4gICAgICAgIGNvbnN0IG5leHRSZXN1bHRzUGFnZSA9IHJlc3VsdHNQYWdlcy5nZXQocGFnZUluZGV4KTtcbiAgICAgICAgaWYgKG5leHRSZXN1bHRzUGFnZSkge1xuICAgICAgICAgICAgbGFzdFBhZ2VJbmRleC5jdXJyZW50ID0gcGFnZUluZGV4O1xuICAgICAgICAgICAgcmV0dXJuIG5leHRSZXN1bHRzUGFnZTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzdWx0c1BhZ2VzLmdldChsYXN0UGFnZUluZGV4LmN1cnJlbnQpO1xuICAgIH0sIFtwYWdlSW5kZXgsIHJlc3VsdHNQYWdlc10pO1xuICAgIGNvbnN0IG1hcHBlZENvbHVtbnMgPSB1c2VNZW1vKCgpID0+IHJlc3VsdHNQYWdlPy5jb2xOYW1lcy5tYXAoKGNvbHVtbiwgaW5kZXgpID0+ICh7XG4gICAgICAgIGtleTogY29sdW1uLFxuICAgICAgICBkYXRhSW5kZXg6IGNvbHVtbixcbiAgICAgICAgdGl0bGU6IHJlc3VsdHNQYWdlPy5jb2xUeXBlc1tpbmRleF0gPT09IEdlbmVyaWNEYXRhVHlwZS5URU1QT1JBTCA/ICg8SGVhZGVyV2l0aFJhZGlvR3JvdXAgaGVhZGVyVGl0bGU9e2NvbHVtbn0gZ3JvdXBUaXRsZT17dCgnRm9ybWF0dGluZycpfSBncm91cE9wdGlvbnM9e1tcbiAgICAgICAgICAgICAgICB7IGxhYmVsOiB0KCdPcmlnaW5hbCB2YWx1ZScpLCB2YWx1ZTogVGltZUZvcm1hdHRpbmcuT3JpZ2luYWwgfSxcbiAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgIGxhYmVsOiB0KCdGb3JtYXR0ZWQgdmFsdWUnKSxcbiAgICAgICAgICAgICAgICAgICAgdmFsdWU6IFRpbWVGb3JtYXR0aW5nLkZvcm1hdHRlZCxcbiAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgXX0gdmFsdWU9e3RpbWVGb3JtYXR0aW5nW2NvbHVtbl0gPT09IFRpbWVGb3JtYXR0aW5nLk9yaWdpbmFsXG4gICAgICAgICAgICAgICAgPyBUaW1lRm9ybWF0dGluZy5PcmlnaW5hbFxuICAgICAgICAgICAgICAgIDogVGltZUZvcm1hdHRpbmcuRm9ybWF0dGVkfSBvbkNoYW5nZT17dmFsdWUgPT4gc2V0VGltZUZvcm1hdHRpbmcoc3RhdGUgPT4gKHsgLi4uc3RhdGUsIFtjb2x1bW5dOiB2YWx1ZSB9KSl9Lz4pIDogKGNvbHVtbiksXG4gICAgICAgIHJlbmRlcjogdmFsdWUgPT4ge1xuICAgICAgICAgICAgaWYgKHZhbHVlID09PSB0cnVlIHx8IHZhbHVlID09PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgIHJldHVybiA8Qm9vbGVhbkNlbGwgdmFsdWU9e3ZhbHVlfS8+O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHZhbHVlID09PSBudWxsKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIDxOdWxsQ2VsbCAvPjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHRzUGFnZT8uY29sVHlwZXNbaW5kZXhdID09PSBHZW5lcmljRGF0YVR5cGUuVEVNUE9SQUwgJiZcbiAgICAgICAgICAgICAgICB0aW1lRm9ybWF0dGluZ1tjb2x1bW5dICE9PSBUaW1lRm9ybWF0dGluZy5PcmlnaW5hbCAmJlxuICAgICAgICAgICAgICAgICh0eXBlb2YgdmFsdWUgPT09ICdudW1iZXInIHx8IHZhbHVlIGluc3RhbmNlb2YgRGF0ZSkpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gPFRpbWVDZWxsIHZhbHVlPXt2YWx1ZX0vPjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBTdHJpbmcodmFsdWUpO1xuICAgICAgICB9LFxuICAgICAgICB3aWR0aDogMTUwLFxuICAgIH0pKSB8fCBbXSwgW3Jlc3VsdHNQYWdlPy5jb2xOYW1lcywgcmVzdWx0c1BhZ2U/LmNvbFR5cGVzLCB0aW1lRm9ybWF0dGluZ10pO1xuICAgIGNvbnN0IGRhdGEgPSB1c2VNZW1vKCgpID0+IHJlc3VsdHNQYWdlPy5kYXRhLm1hcCgocm93LCBpbmRleCkgPT4gcmVzdWx0c1BhZ2U/LmNvbE5hbWVzLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiAoeyAuLi5hY2MsIFtjdXJyXTogcm93W2N1cnJdIH0pLCB7XG4gICAgICAgIGtleTogaW5kZXgsXG4gICAgfSkpIHx8IFtdLCBbcmVzdWx0c1BhZ2U/LmNvbE5hbWVzLCByZXN1bHRzUGFnZT8uZGF0YV0pO1xuICAgIC8vIENsZWFyIGNhY2hlIG9uIHJlbG9hZCBidXR0b24gY2xpY2tcbiAgICBjb25zdCBoYW5kbGVSZWxvYWQgPSB1c2VDYWxsYmFjaygoKSA9PiB7XG4gICAgICAgIHNldFJlc3BvbnNlRXJyb3IoJycpO1xuICAgICAgICBzZXRSZXN1bHRzUGFnZXMobmV3IE1hcCgpKTtcbiAgICAgICAgc2V0UGFnZUluZGV4KDApO1xuICAgIH0sIFtdKTtcbiAgICAvLyBDbGVhciBjYWNoZSBhbmQgcmVzZXQgcGFnZSBpbmRleCBpZiBmaWx0ZXJzIGNoYW5nZVxuICAgIHVzZUVmZmVjdCgoKSA9PiB7XG4gICAgICAgIHNldFJlc3BvbnNlRXJyb3IoJycpO1xuICAgICAgICBzZXRSZXN1bHRzUGFnZXMobmV3IE1hcCgpKTtcbiAgICAgICAgc2V0UGFnZUluZGV4KDApO1xuICAgIH0sIFtmaWx0ZXJzXSk7XG4gICAgLy8gVXBkYXRlIGNhY2hlIG9yZGVyIGlmIHBhZ2UgaW4gY2FjaGVcbiAgICB1c2VFZmZlY3QoKCkgPT4ge1xuICAgICAgICBpZiAocmVzdWx0c1BhZ2VzLmhhcyhwYWdlSW5kZXgpICYmXG4gICAgICAgICAgICBbLi4ucmVzdWx0c1BhZ2VzLmtleXMoKV0uYXQoLTEpICE9PSBwYWdlSW5kZXgpIHtcbiAgICAgICAgICAgIGNvbnN0IG5leHRSZXN1bHRzUGFnZXMgPSBuZXcgTWFwKHJlc3VsdHNQYWdlcyk7XG4gICAgICAgICAgICBuZXh0UmVzdWx0c1BhZ2VzLmRlbGV0ZShwYWdlSW5kZXgpO1xuICAgICAgICAgICAgc2V0UmVzdWx0c1BhZ2VzKG5leHRSZXN1bHRzUGFnZXMuc2V0KHBhZ2VJbmRleCwgcmVzdWx0c1BhZ2VzLmdldChwYWdlSW5kZXgpKSk7XG4gICAgICAgIH1cbiAgICB9LCBbcGFnZUluZGV4LCByZXN1bHRzUGFnZXNdKTtcbiAgICAvLyBEb3dubG9hZCBwYWdlIG9mIHJlc3VsdHMgJiB0cmltIGNhY2hlIGlmIHBhZ2Ugbm90IGluIGNhY2hlXG4gICAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAgICAgaWYgKCFyZXNwb25zZUVycm9yICYmICFpc0xvYWRpbmcgJiYgIXJlc3VsdHNQYWdlcy5oYXMocGFnZUluZGV4KSkge1xuICAgICAgICAgICAgc2V0SXNMb2FkaW5nKHRydWUpO1xuICAgICAgICAgICAgY29uc3QganNvblBheWxvYWQgPSBnZXREcmlsbFBheWxvYWQoZm9ybURhdGEsIGZpbHRlcnMpID8/IHt9O1xuICAgICAgICAgICAgY29uc3QgY2FjaGVQYWdlTGltaXQgPSBNYXRoLmNlaWwoU0FNUExFU19ST1dfTElNSVQgLyBQQUdFX1NJWkUpO1xuICAgICAgICAgICAgZ2V0RGF0YXNvdXJjZVNhbXBsZXMoZGF0YXNvdXJjZVR5cGUsIGRhdGFzb3VyY2VJZCwgZmFsc2UsIGpzb25QYXlsb2FkLCBQQUdFX1NJWkUsIHBhZ2VJbmRleCArIDEpXG4gICAgICAgICAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4ge1xuICAgICAgICAgICAgICAgIHNldFJlc3VsdHNQYWdlcyhuZXcgTWFwKFtcbiAgICAgICAgICAgICAgICAgICAgLi4uWy4uLnJlc3VsdHNQYWdlcy5lbnRyaWVzKCldLnNsaWNlKC1jYWNoZVBhZ2VMaW1pdCArIDEpLFxuICAgICAgICAgICAgICAgICAgICBbXG4gICAgICAgICAgICAgICAgICAgICAgICBwYWdlSW5kZXgsXG4gICAgICAgICAgICAgICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdG90YWw6IHJlc3BvbnNlLnRvdGFsX2NvdW50LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE6IHJlc3BvbnNlLmRhdGEsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29sTmFtZXM6IGVuc3VyZUlzQXJyYXkocmVzcG9uc2UuY29sbmFtZXMpLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbFR5cGVzOiBlbnN1cmVJc0FycmF5KHJlc3BvbnNlLmNvbHR5cGVzKSxcbiAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIF0sXG4gICAgICAgICAgICAgICAgXSkpO1xuICAgICAgICAgICAgICAgIHNldFJlc3BvbnNlRXJyb3IoJycpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4ge1xuICAgICAgICAgICAgICAgIHNldFJlc3BvbnNlRXJyb3IoYCR7ZXJyb3IubmFtZX06ICR7ZXJyb3IubWVzc2FnZX1gKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgICAgLmZpbmFsbHkoKCkgPT4ge1xuICAgICAgICAgICAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgIH0sIFtcbiAgICAgICAgU0FNUExFU19ST1dfTElNSVQsXG4gICAgICAgIGRhdGFzb3VyY2VJZCxcbiAgICAgICAgZGF0YXNvdXJjZVR5cGUsXG4gICAgICAgIGZpbHRlcnMsXG4gICAgICAgIGZvcm1EYXRhLFxuICAgICAgICBpc0xvYWRpbmcsXG4gICAgICAgIHBhZ2VJbmRleCxcbiAgICAgICAgcmVzcG9uc2VFcnJvcixcbiAgICAgICAgcmVzdWx0c1BhZ2VzLFxuICAgIF0pO1xuICAgIGNvbnN0IGJvb3RzdHJhcHBpbmcgPSAoIXJlc3BvbnNlRXJyb3IgJiYgIXJlc3VsdHNQYWdlcy5zaXplKSB8fFxuICAgICAgICBtZXRhZGF0YUJhclN0YXR1cyA9PT0gUmVzb3VyY2VTdGF0dXMuTE9BRElORztcbiAgICBsZXQgdGFibGVDb250ZW50ID0gbnVsbDtcbiAgICBpZiAocmVzcG9uc2VFcnJvcikge1xuICAgICAgICAvLyBSZW5kZXIgZXJyb3IgaWYgcGFnZSBkb3dubG9hZCBmYWlsZWRcbiAgICAgICAgdGFibGVDb250ZW50ID0gKDxwcmUgY3NzPXtjc3MgYFxuICAgICAgICAgIG1hcmdpbi10b3A6ICR7dGhlbWUuZ3JpZFVuaXQgKiA0fXB4O1xuICAgICAgICBgfT5cbiAgICAgICAge3Jlc3BvbnNlRXJyb3J9XG4gICAgICA8L3ByZT4pO1xuICAgIH1cbiAgICBlbHNlIGlmIChib290c3RyYXBwaW5nKSB7XG4gICAgICAgIC8vIFJlbmRlciBsb2FkaW5nIGlmIGZpcnN0IHBhZ2UgaGFzbid0IGxvYWRlZFxuICAgICAgICB0YWJsZUNvbnRlbnQgPSA8TG9hZGluZyAvPjtcbiAgICB9XG4gICAgZWxzZSBpZiAocmVzdWx0c1BhZ2U/LnRvdGFsID09PSAwKSB7XG4gICAgICAgIC8vIFJlbmRlciBlbXB0eSBzdGF0ZSBpZiBubyByZXN1bHRzIGFyZSByZXR1cm5lZCBmb3IgcGFnZVxuICAgICAgICBjb25zdCB0aXRsZSA9IHQoJ05vIHJvd3Mgd2VyZSByZXR1cm5lZCBmb3IgdGhpcyBkYXRhc2V0Jyk7XG4gICAgICAgIHRhYmxlQ29udGVudCA9IDxFbXB0eVN0YXRlTWVkaXVtIGltYWdlPVwiZG9jdW1lbnQuc3ZnXCIgdGl0bGU9e3RpdGxlfS8+O1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgLy8gUmVuZGVyIHRhYmxlIGlmIGF0IGxlYXN0IG9uZSBwYWdlIGhhcyBzdWNjZXNzZnVsbHkgbG9hZGVkXG4gICAgICAgIHRhYmxlQ29udGVudCA9ICg8UmVzaXphYmxlPlxuICAgICAgICA8VGFibGUgZGF0YT17ZGF0YX0gY29sdW1ucz17bWFwcGVkQ29sdW1uc30gc2l6ZT17VGFibGVTaXplLlNNQUxMfSBkZWZhdWx0UGFnZVNpemU9e1BBR0VfU0laRX0gcmVjb3JkQ291bnQ9e3Jlc3VsdHNQYWdlPy50b3RhbH0gdXNlUGFnaW5hdGlvbiBsb2FkaW5nPXtpc0xvYWRpbmd9IG9uQ2hhbmdlPXtwYWdpbmF0aW9uID0+IHNldFBhZ2VJbmRleChwYWdpbmF0aW9uLmN1cnJlbnQgPyBwYWdpbmF0aW9uLmN1cnJlbnQgLSAxIDogMCl9IHJlc2l6YWJsZSB2aXJ0dWFsaXplLz5cbiAgICAgIDwvUmVzaXphYmxlPik7XG4gICAgfVxuICAgIHJldHVybiAoPD5cbiAgICAgIHshYm9vdHN0cmFwcGluZyAmJiBtZXRhZGF0YUJhcn1cbiAgICAgIHshYm9vdHN0cmFwcGluZyAmJiAoPFRhYmxlQ29udHJvbHMgZmlsdGVycz17ZmlsdGVyc30gc2V0RmlsdGVycz17c2V0RmlsdGVyc30gdG90YWxDb3VudD17cmVzdWx0c1BhZ2U/LnRvdGFsfSBsb2FkaW5nPXtpc0xvYWRpbmd9IG9uUmVsb2FkPXtoYW5kbGVSZWxvYWR9Lz4pfVxuICAgICAge3RhYmxlQ29udGVudH1cbiAgICA8Lz4pO1xufVxuIl19 */\", toString: _EMOTION_STRINGIFIED_CSS_ERROR__ };function Resizable(_ref) {let { children } = _ref;\n  const { ref, height } = useResizeDetector();\n  return ___EmotionJSX(\"div\", { ref: ref, css: _ref2 }, /*#__PURE__*/\n  React.cloneElement(children, { height }));\n\n}\nvar TimeFormatting;\n(function (TimeFormatting) {\n  TimeFormatting[TimeFormatting[\"Original\"] = 0] = \"Original\";\n  TimeFormatting[TimeFormatting[\"Formatted\"] = 1] = \"Formatted\";\n})(TimeFormatting || (TimeFormatting = {}));\nexport default function DrillDetailPane(_ref3) {let { formData, initialFilters } = _ref3;\n  const theme = useTheme();\n  const [pageIndex, setPageIndex] = useState(0);\n  const lastPageIndex = useRef(pageIndex);\n  const [filters, setFilters] = useState(initialFilters);\n  const [isLoading, setIsLoading] = useState(false);\n  const [responseError, setResponseError] = useState('');\n  const [resultsPages, setResultsPages] = useState(new Map());\n  const [timeFormatting, setTimeFormatting] = useState({});\n  const SAMPLES_ROW_LIMIT = useSelector((state) => state.common.conf.SAMPLES_ROW_LIMIT);\n  // Extract datasource ID/type from string ID\n  const [datasourceId, datasourceType] = useMemo(() => formData.datasource.split('__'), [formData.datasource]);\n  const { metadataBar, status: metadataBarStatus } = useDatasetMetadataBar({\n    datasetId: datasourceId });\n\n  // Get page of results\n  const resultsPage = useMemo(() => {\n    const nextResultsPage = resultsPages.get(pageIndex);\n    if (nextResultsPage) {\n      lastPageIndex.current = pageIndex;\n      return nextResultsPage;\n    }\n    return resultsPages.get(lastPageIndex.current);\n  }, [pageIndex, resultsPages]);\n  const mappedColumns = useMemo(() => (resultsPage == null ? void 0 : resultsPage.colNames.map((column, index) => ({\n    key: column,\n    dataIndex: column,\n    title: (resultsPage == null ? void 0 : resultsPage.colTypes[index]) === GenericDataType.TEMPORAL ? ___EmotionJSX(HeaderWithRadioGroup, { headerTitle: column, groupTitle: t('Formatting'), groupOptions: [\n      { label: t('Original value'), value: TimeFormatting.Original },\n      {\n        label: t('Formatted value'),\n        value: TimeFormatting.Formatted }],\n\n      value: timeFormatting[column] === TimeFormatting.Original ?\n      TimeFormatting.Original :\n      TimeFormatting.Formatted, onChange: (value) => setTimeFormatting((state) => ({ ...state, [column]: value })) }) : column,\n    render: (value) => {\n      if (value === true || value === false) {\n        return ___EmotionJSX(BooleanCell, { value: value });\n      }\n      if (value === null) {\n        return ___EmotionJSX(NullCell, null);\n      }\n      if ((resultsPage == null ? void 0 : resultsPage.colTypes[index]) === GenericDataType.TEMPORAL &&\n      timeFormatting[column] !== TimeFormatting.Original && (\n      typeof value === 'number' || value instanceof Date)) {\n        return ___EmotionJSX(TimeCell, { value: value });\n      }\n      return String(value);\n    },\n    width: 150 }))) ||\n  [], [resultsPage == null ? void 0 : resultsPage.colNames, resultsPage == null ? void 0 : resultsPage.colTypes, timeFormatting]);\n  const data = useMemo(() => (resultsPage == null ? void 0 : resultsPage.data.map((row, index) => resultsPage == null ? void 0 : resultsPage.colNames.reduce((acc, curr) => ({ ...acc, [curr]: row[curr] }), {\n    key: index }))) ||\n  [], [resultsPage == null ? void 0 : resultsPage.colNames, resultsPage == null ? void 0 : resultsPage.data]);\n  // Clear cache on reload button click\n  const handleReload = useCallback(() => {\n    setResponseError('');\n    setResultsPages(new Map());\n    setPageIndex(0);\n  }, []);\n  // Clear cache and reset page index if filters change\n  useEffect(() => {\n    setResponseError('');\n    setResultsPages(new Map());\n    setPageIndex(0);\n  }, [filters]);\n  // Update cache order if page in cache\n  useEffect(() => {\n    if (resultsPages.has(pageIndex) &&\n    [...resultsPages.keys()].at(-1) !== pageIndex) {\n      const nextResultsPages = new Map(resultsPages);\n      nextResultsPages.delete(pageIndex);\n      setResultsPages(nextResultsPages.set(pageIndex, resultsPages.get(pageIndex)));\n    }\n  }, [pageIndex, resultsPages]);\n  // Download page of results & trim cache if page not in cache\n  useEffect(() => {\n    if (!responseError && !isLoading && !resultsPages.has(pageIndex)) {var _getDrillPayload;\n      setIsLoading(true);\n      const jsonPayload = (_getDrillPayload = getDrillPayload(formData, filters)) != null ? _getDrillPayload : {};\n      const cachePageLimit = Math.ceil(SAMPLES_ROW_LIMIT / PAGE_SIZE);\n      getDatasourceSamples(datasourceType, datasourceId, false, jsonPayload, PAGE_SIZE, pageIndex + 1).\n      then((response) => {\n        setResultsPages(new Map([\n        ...[...resultsPages.entries()].slice(-cachePageLimit + 1),\n        [\n        pageIndex,\n        {\n          total: response.total_count,\n          data: response.data,\n          colNames: ensureIsArray(response.colnames),\n          colTypes: ensureIsArray(response.coltypes) }]]));\n\n\n\n        setResponseError('');\n      }).\n      catch((error) => {\n        setResponseError(`${error.name}: ${error.message}`);\n      }).\n      finally(() => {\n        setIsLoading(false);\n      });\n    }\n  }, [\n  SAMPLES_ROW_LIMIT,\n  datasourceId,\n  datasourceType,\n  filters,\n  formData,\n  isLoading,\n  pageIndex,\n  responseError,\n  resultsPages]);\n\n  const bootstrapping = !responseError && !resultsPages.size ||\n  metadataBarStatus === ResourceStatus.LOADING;\n  let tableContent = null;\n  if (responseError) {\n    // Render error if page download failed\n    tableContent = ___EmotionJSX(\"pre\", { css: css`\n          margin-top: ${theme.gridUnit * 4}px;\n        ` },\n    responseError);\n\n  } else\n  if (bootstrapping) {\n    // Render loading if first page hasn't loaded\n    tableContent = ___EmotionJSX(Loading, null);\n  } else\n  if ((resultsPage == null ? void 0 : resultsPage.total) === 0) {\n    // Render empty state if no results are returned for page\n    const title = t('No rows were returned for this dataset');\n    tableContent = ___EmotionJSX(EmptyStateMedium, { image: \"document.svg\", title: title });\n  } else\n  {\n    // Render table if at least one page has successfully loaded\n    tableContent = ___EmotionJSX(Resizable, null,\n    ___EmotionJSX(Table, { data: data, columns: mappedColumns, size: TableSize.SMALL, defaultPageSize: PAGE_SIZE, recordCount: resultsPage == null ? void 0 : resultsPage.total, usePagination: true, loading: isLoading, onChange: (pagination) => setPageIndex(pagination.current ? pagination.current - 1 : 0), resizable: true, virtualize: true }));\n\n  }\n  return ___EmotionJSX(React.Fragment, null,\n  !bootstrapping && metadataBar,\n  !bootstrapping && ___EmotionJSX(TableControls, { filters: filters, setFilters: setFilters, totalCount: resultsPage == null ? void 0 : resultsPage.total, loading: isLoading, onReload: handleReload }),\n  tableContent);\n\n}","map":{"version":3,"mappings":"wRAAA;;;;;;;;;;;;;;;;;;AAkBA,OAAOA,KAAP,IAEEC,WAFF,EAGEC,SAHF,EAIEC,OAJF,EAKEC,MALF,EAMEC,QANF,QAOO,OAPP;AAQA,SAASC,WAAT,QAA4B,aAA5B;AACA,SAEEC,GAFF,EAGEC,aAHF,EAIEC,eAJF,EAOEC,CAPF,EAQEC,QARF,QASO,mBATP;AAUA,SAASC,iBAAT,QAAkC,uBAAlC;AACA,OAAOC,OAAP,MAAoB,wBAApB;AACA,OAAOC,WAAP,MAAwB,iDAAxB;AACA,OAAOC,QAAP,MAAqB,8CAArB;AACA,OAAOC,QAAP,MAAqB,8CAArB;AACA,SAASC,gBAAT,QAAiC,2BAAjC;AACA,SAASC,oBAAT,QAAqC,kCAArC;AACA,OAAOC,KAAP,IAA6BC,SAA7B,QAA8C,sBAA9C;AACA,OAAOC,oBAAP,MAAiC,4DAAjC;AACA,SAASC,cAAT,QAA+B,qCAA/B;AACA,SAASC,qBAAT,QAAsC,yDAAtC;AACA,OAAOC,aAAP,MAA0B,4BAA1B;AACA,SAASC,eAAT,QAAgC,SAAhC,C;AAGA,MAAMC,SAAS,GAAG,EAAlB;AAMA;AACA;AACA;o0ZACA,SAASC,SAAT,OAA2D,KAAxC,EAAEC,QAAF,EAAwC;EACzD,MAAM,EAAEC,GAAF,EAAOC,MAAP,KAAkBlB,iBAAiB,EAAzC;EACA,OACE,uBAAK,GAAG,EAAEiB,GAAV,EAAe,GAAG,OAAlB;EACG7B,KAAK,CAAC+B,YAAN,CAAmBH,QAAnB,EAA6B,EAAEE,MAAF,EAA7B,CADH,CADF;;AAKD;AAED,IAAKE,cAAL;AAAA,WAAKA,cAAL,EAAmB;EACjBA;EACAA;AACD,CAHD,EAAKA,cAAc,KAAdA,cAAc,MAAnB;AAKA,eAAc,SAAUC,eAAV,QAMb,KANuC,EACtCC,QADsC,EAEtCC,cAFsC,EAMvC;EACC,MAAMC,KAAK,GAAGzB,QAAQ,EAAtB;EACA,MAAM,CAAC0B,SAAD,EAAYC,YAAZ,IAA4BjC,QAAQ,CAAC,CAAD,CAA1C;EACA,MAAMkC,aAAa,GAAGnC,MAAM,CAACiC,SAAD,CAA5B;EACA,MAAM,CAACG,OAAD,EAAUC,UAAV,IAAwBpC,QAAQ,CAAC8B,cAAD,CAAtC;EACA,MAAM,CAACO,SAAD,EAAYC,YAAZ,IAA4BtC,QAAQ,CAAC,KAAD,CAA1C;EACA,MAAM,CAACuC,aAAD,EAAgBC,gBAAhB,IAAoCxC,QAAQ,CAAC,EAAD,CAAlD;EACA,MAAM,CAACyC,YAAD,EAAeC,eAAf,IAAkC1C,QAAQ,CAC9C,IAAI2C,GAAJ,EAD8C,CAAhD;EAGA,MAAM,CAACC,cAAD,EAAiBC,iBAAjB,IAAsC7C,QAAQ,CAAC,EAAD,CAApD;EAEA,MAAM8C,iBAAiB,GAAG7C,WAAW,CACnC,CAAC8C,KAAD,KACEA,KAAK,CAACC,MAAN,CAAaC,IAAb,CAAkBH,iBAFe,CAArC;EAKA;EACA,MAAM,CAACI,YAAD,EAAeC,cAAf,IAAiCrD,OAAO,CAC5C,MAAM+B,QAAQ,CAACuB,UAAT,CAAoBC,KAApB,CAA0B,IAA1B,CADsC,EAE5C,CAACxB,QAAQ,CAACuB,UAAV,CAF4C,CAA9C;EAKA,MAAM,EAAEE,WAAF,EAAeC,MAAM,EAAEC,iBAAvB,KAA6CtC,qBAAqB,CAAC;IACvEuC,SAAS,EAAEP,YAD4D,EAAD,CAAxE;;EAGA;EACA,MAAMQ,WAAW,GAAG5D,OAAO,CAAC,MAAK;IAC/B,MAAM6D,eAAe,GAAGlB,YAAY,CAACmB,GAAb,CAAiB5B,SAAjB,CAAxB;IACA,IAAI2B,eAAJ,EAAqB;MACnBzB,aAAa,CAAC2B,OAAd,GAAwB7B,SAAxB;MACA,OAAO2B,eAAP;IACD;IAED,OAAOlB,YAAY,CAACmB,GAAb,CAAiB1B,aAAa,CAAC2B,OAA/B,CAAP;EACD,CAR0B,EAQxB,CAAC7B,SAAD,EAAYS,YAAZ,CARwB,CAA3B;EAUA,MAAMqB,aAAa,GAA0BhE,OAAO,CAClD,MACE,YAAW,QAAX,uBAAW,CAAEiE,QAAb,CAAsBC,GAAtB,CAA0B,CAACC,MAAD,EAASC,KAAT,MAAoB;IAC5CC,GAAG,EAAEF,MADuC;IAE5CG,SAAS,EAAEH,MAFiC;IAG5CI,KAAK,EACH,YAAW,QAAX,uBAAW,CAAEC,QAAb,CAAsBJ,KAAtB,OAAiC9D,eAAe,CAACmE,QAAjD,GACE,cAAC,oBAAD,IACE,WAAW,EAAEN,MADf,EAEE,UAAU,EAAE5D,CAAC,CAAC,YAAD,CAFf,EAGE,YAAY,EAAE;MACZ,EAAEmE,KAAK,EAAEnE,CAAC,CAAC,gBAAD,CAAV,EAA8BoE,KAAK,EAAE9C,cAAc,CAAC+C,QAApD,EADY;MAEZ;QACEF,KAAK,EAAEnE,CAAC,CAAC,iBAAD,CADV;QAEEoE,KAAK,EAAE9C,cAAc,CAACgD,SAFxB,EAFY,CAHhB;;MAUE,KAAK,EACH/B,cAAc,CAACqB,MAAD,CAAd,KAA2BtC,cAAc,CAAC+C,QAA1C;MACI/C,cAAc,CAAC+C,QADnB;MAEI/C,cAAc,CAACgD,SAbvB,EAeE,QAAQ,EAAE,MAAK,KACb9B,iBAAiB,CAAC,MAAK,MAAK,EAAE,GAAGE,KAAL,EAAY,CAACkB,MAAD,GAAUQ,KAAtB,EAAL,CAAN,CAhBrB,GADF,GAqBER,MAzBwC;IA2B5CW,MAAM,EAAE,MAAK,KAAG;MACd,IAAIH,KAAK,KAAK,IAAV,IAAkBA,KAAK,KAAK,KAAhC,EAAuC;QACrC,OAAO,cAAC,WAAD,IAAa,KAAK,EAAEA,KAApB,GAAP;MACD;MACD,IAAIA,KAAK,KAAK,IAAd,EAAoB;QAClB,OAAO,cAAC,QAAD,OAAP;MACD;MACD,IACE,YAAW,QAAX,uBAAW,CAAEH,QAAb,CAAsBJ,KAAtB,OAAiC9D,eAAe,CAACmE,QAAjD;MACA3B,cAAc,CAACqB,MAAD,CAAd,KAA2BtC,cAAc,CAAC+C,QAD1C;MAEC,OAAOD,KAAP,KAAiB,QAAjB,IAA6BA,KAAK,YAAYI,IAF/C,CADF,EAIE;QACA,OAAO,cAAC,QAAD,IAAU,KAAK,EAAEJ,KAAjB,GAAP;MACD;MACD,OAAOK,MAAM,CAACL,KAAD,CAAb;IACD,CA1C2C;IA2C5CM,KAAK,EAAE,GA3CqC,EAApB,CAA1B;EA4CO,EA9CyC,EA+ClD,CAACrB,WAAD,oBAACA,WAAW,CAAEK,QAAd,EAAwBL,WAAxB,oBAAwBA,WAAW,CAAEY,QAArC,EAA+C1B,cAA/C,CA/CkD,CAApD;EAkDA,MAAMoC,IAAI,GAAelF,OAAO,CAC9B,MACE,YAAW,QAAX,uBAAW,CAAEkF,IAAb,CAAkBhB,GAAlB,CAAsB,CAACiB,GAAD,EAAMf,KAAN,KACpBR,WADoB,oBACpBA,WAAW,CAAEK,QAAb,CAAsBmB,MAAtB,CACE,CAACC,GAAD,EAAMC,IAAN,MAAgB,EAAE,GAAGD,GAAL,EAAU,CAACC,IAAD,GAAQH,GAAG,CAACG,IAAD,CAArB,EAAhB,CADF,EAEE;IACEjB,GAAG,EAAED,KADP,EAFF,CADF;EAOK,EATuB,EAU9B,CAACR,WAAD,oBAACA,WAAW,CAAEK,QAAd,EAAwBL,WAAxB,oBAAwBA,WAAW,CAAEsB,IAArC,CAV8B,CAAhC;EAaA;EACA,MAAMK,YAAY,GAAGzF,WAAW,CAAC,MAAK;IACpC4C,gBAAgB,CAAC,EAAD,CAAhB;IACAE,eAAe,CAAC,IAAIC,GAAJ,EAAD,CAAf;IACAV,YAAY,CAAC,CAAD,CAAZ;EACD,CAJ+B,EAI7B,EAJ6B,CAAhC;EAMA;EACApC,SAAS,CAAC,MAAK;IACb2C,gBAAgB,CAAC,EAAD,CAAhB;IACAE,eAAe,CAAC,IAAIC,GAAJ,EAAD,CAAf;IACAV,YAAY,CAAC,CAAD,CAAZ;EACD,CAJQ,EAIN,CAACE,OAAD,CAJM,CAAT;EAMA;EACAtC,SAAS,CAAC,MAAK;IACb,IACE4C,YAAY,CAAC6C,GAAb,CAAiBtD,SAAjB;IACA,CAAC,GAAGS,YAAY,CAAC8C,IAAb,EAAJ,EAAyBC,EAAzB,CAA4B,CAAC,CAA7B,MAAoCxD,SAFtC,EAGE;MACA,MAAMyD,gBAAgB,GAAG,IAAI9C,GAAJ,CAAQF,YAAR,CAAzB;MACAgD,gBAAgB,CAACC,MAAjB,CAAwB1D,SAAxB;MACAU,eAAe,CACb+C,gBAAgB,CAACE,GAAjB,CACE3D,SADF,EAEES,YAAY,CAACmB,GAAb,CAAiB5B,SAAjB,CAFF,CADa,CAAf;IAMD;EACF,CAdQ,EAcN,CAACA,SAAD,EAAYS,YAAZ,CAdM,CAAT;EAgBA;EACA5C,SAAS,CAAC,MAAK;IACb,IAAI,CAAC0C,aAAD,IAAkB,CAACF,SAAnB,IAAgC,CAACI,YAAY,CAAC6C,GAAb,CAAiBtD,SAAjB,CAArC,EAAkE;MAChEM,YAAY,CAAC,IAAD,CAAZ;MACA,MAAMsD,WAAW,uBAAGxE,eAAe,CAACS,QAAD,EAAWM,OAAX,CAAlB,+BAAyC,EAA1D;MACA,MAAM0D,cAAc,GAAGC,IAAI,CAACC,IAAL,CAAUjD,iBAAiB,GAAGzB,SAA9B,CAAvB;MACAR,oBAAoB,CAClBsC,cADkB,EAElBD,YAFkB,EAGlB,KAHkB,EAIlB0C,WAJkB,EAKlBvE,SALkB,EAMlBW,SAAS,GAAG,CANM,CAApB;MAQGgE,IARH,CAQQ,SAAQ,KAAG;QACftD,eAAe,CACb,IAAIC,GAAJ,CAAQ;QACN,GAAG,CAAC,GAAGF,YAAY,CAACwD,OAAb,EAAJ,EAA4BC,KAA5B,CAAkC,CAACL,cAAD,GAAkB,CAApD,CADG;QAEN;QACE7D,SADF;QAEE;UACEmE,KAAK,EAAEC,QAAQ,CAACC,WADlB;UAEErB,IAAI,EAAEoB,QAAQ,CAACpB,IAFjB;UAGEjB,QAAQ,EAAE5D,aAAa,CAACiG,QAAQ,CAACE,QAAV,CAHzB;UAIEhC,QAAQ,EAAEnE,aAAa,CAACiG,QAAQ,CAACG,QAAV,CAJzB,EAFF,CAFM,CAAR,CADa,CAAf;;;;QAcA/D,gBAAgB,CAAC,EAAD,CAAhB;MACD,CAxBH;MAyBGgE,KAzBH,CAyBS,MAAK,KAAG;QACbhE,gBAAgB,CAAC,GAAGiE,KAAK,CAACC,IAAI,KAAKD,KAAK,CAACE,OAAO,EAAhC,CAAhB;MACD,CA3BH;MA4BGC,OA5BH,CA4BW,MAAK;QACZtE,YAAY,CAAC,KAAD,CAAZ;MACD,CA9BH;IA+BD;EACF,CArCQ,EAqCN;EACDQ,iBADC;EAEDI,YAFC;EAGDC,cAHC;EAIDhB,OAJC;EAKDN,QALC;EAMDQ,SANC;EAODL,SAPC;EAQDO,aARC;EASDE,YATC,CArCM,CAAT;;EAiDA,MAAMoE,aAAa,GAChB,CAACtE,aAAD,IAAkB,CAACE,YAAY,CAACqE,IAAjC;EACAtD,iBAAiB,KAAKvC,cAAc,CAAC8F,OAFvC;EAIA,IAAIC,YAAY,GAAG,IAAnB;EACA,IAAIzE,aAAJ,EAAmB;IACjB;IACAyE,YAAY,GACV,uBACE,GAAG,EAAE9G,GAAG;wBACQ6B,KAAK,CAACkF,QAAN,GAAiB,CAAC;SAFpC;IAKG1E,aALH,CADF;;EASD,CAXD;EAWO,IAAIsE,aAAJ,EAAmB;IACxB;IACAG,YAAY,GAAG,cAAC,OAAD,OAAf;EACD,CAHM;EAGA,IAAI,YAAW,QAAX,uBAAW,CAAEb,KAAb,MAAuB,CAA3B,EAA8B;IACnC;IACA,MAAM9B,KAAK,GAAGhE,CAAC,CAAC,wCAAD,CAAf;IACA2G,YAAY,GAAG,cAAC,gBAAD,IAAkB,KAAK,EAAC,cAAxB,EAAuC,KAAK,EAAE3C,KAA9C,GAAf;EACD,CAJM;EAIA;IACL;IACA2C,YAAY,GACV,cAAC,SAAD;IACE,cAAC,KAAD,IACE,IAAI,EAAEhC,IADR,EAEE,OAAO,EAAElB,aAFX,EAGE,IAAI,EAAE/C,SAAS,CAACmG,KAHlB,EAIE,eAAe,EAAE7F,SAJnB,EAKE,WAAW,EAAEqC,WAAF,oBAAEA,WAAW,CAAEyC,KAL5B,EAME,aAAa,MANf,EAOE,OAAO,EAAE9D,SAPX,EAQE,QAAQ,EAAE,WAAU,KAClBJ,YAAY,CAACkF,UAAU,CAACtD,OAAX,GAAqBsD,UAAU,CAACtD,OAAX,GAAqB,CAA1C,GAA8C,CAA/C,CAThB,EAWE,SAAS,MAXX,EAYE,UAAU,MAZZ,GADF,CADF;;EAkBD;EAED,OACE;EACG,CAACgD,aAAD,IAAkBvD,WADrB;EAEG,CAACuD,aAAD,IACC,cAAC,aAAD,IACE,OAAO,EAAE1E,OADX,EAEE,UAAU,EAAEC,UAFd,EAGE,UAAU,EAAEsB,WAAF,oBAAEA,WAAW,CAAEyC,KAH3B,EAIE,OAAO,EAAE9D,SAJX,EAKE,QAAQ,EAAEgD,YALZ,GAHJ;EAWG2B,YAXH,CADF;;AAeD","names":["React","useCallback","useEffect","useMemo","useRef","useState","useSelector","css","ensureIsArray","GenericDataType","t","useTheme","useResizeDetector","Loading","BooleanCell","NullCell","TimeCell","EmptyStateMedium","getDatasourceSamples","Table","TableSize","HeaderWithRadioGroup","ResourceStatus","useDatasetMetadataBar","TableControls","getDrillPayload","PAGE_SIZE","Resizable","children","ref","height","cloneElement","TimeFormatting","DrillDetailPane","formData","initialFilters","theme","pageIndex","setPageIndex","lastPageIndex","filters","setFilters","isLoading","setIsLoading","responseError","setResponseError","resultsPages","setResultsPages","Map","timeFormatting","setTimeFormatting","SAMPLES_ROW_LIMIT","state","common","conf","datasourceId","datasourceType","datasource","split","metadataBar","status","metadataBarStatus","datasetId","resultsPage","nextResultsPage","get","current","mappedColumns","colNames","map","column","index","key","dataIndex","title","colTypes","TEMPORAL","label","value","Original","Formatted","render","Date","String","width","data","row","reduce","acc","curr","handleReload","has","keys","at","nextResultsPages","delete","set","jsonPayload","cachePageLimit","Math","ceil","then","entries","slice","total","response","total_count","colnames","coltypes","catch","error","name","message","finally","bootstrapping","size","LOADING","tableContent","gridUnit","SMALL","pagination"],"sourceRoot":"","sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/components/Chart/DrillDetail/DrillDetailPane.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { useSelector } from 'react-redux';\nimport {\n  BinaryQueryObjectFilterClause,\n  css,\n  ensureIsArray,\n  GenericDataType,\n  JsonObject,\n  QueryFormData,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport { useResizeDetector } from 'react-resize-detector';\nimport Loading from 'src/components/Loading';\nimport BooleanCell from 'src/components/Table/cell-renderers/BooleanCell';\nimport NullCell from 'src/components/Table/cell-renderers/NullCell';\nimport TimeCell from 'src/components/Table/cell-renderers/TimeCell';\nimport { EmptyStateMedium } from 'src/components/EmptyState';\nimport { getDatasourceSamples } from 'src/components/Chart/chartAction';\nimport Table, { ColumnsType, TableSize } from 'src/components/Table';\nimport HeaderWithRadioGroup from 'src/components/Table/header-renderers/HeaderWithRadioGroup';\nimport { ResourceStatus } from 'src/hooks/apiResources/apiResources';\nimport { useDatasetMetadataBar } from 'src/features/datasets/metadataBar/useDatasetMetadataBar';\nimport TableControls from './DrillDetailTableControls';\nimport { getDrillPayload } from './utils';\nimport { ResultsPage } from './types';\n\nconst PAGE_SIZE = 50;\n\ninterface DataType {\n  [key: string]: any;\n}\n\n// Must be outside of the main component due to problems in\n// react-resize-detector with conditional rendering\n// https://github.com/maslianok/react-resize-detector/issues/178\nfunction Resizable({ children }: { children: ReactElement }) {\n  const { ref, height } = useResizeDetector();\n  return (\n    <div ref={ref} css={{ flex: 1 }}>\n      {React.cloneElement(children, { height })}\n    </div>\n  );\n}\n\nenum TimeFormatting {\n  Original,\n  Formatted,\n}\n\nexport default function DrillDetailPane({\n  formData,\n  initialFilters,\n}: {\n  formData: QueryFormData;\n  initialFilters: BinaryQueryObjectFilterClause[];\n}) {\n  const theme = useTheme();\n  const [pageIndex, setPageIndex] = useState(0);\n  const lastPageIndex = useRef(pageIndex);\n  const [filters, setFilters] = useState(initialFilters);\n  const [isLoading, setIsLoading] = useState(false);\n  const [responseError, setResponseError] = useState('');\n  const [resultsPages, setResultsPages] = useState<Map<number, ResultsPage>>(\n    new Map(),\n  );\n  const [timeFormatting, setTimeFormatting] = useState({});\n\n  const SAMPLES_ROW_LIMIT = useSelector(\n    (state: { common: { conf: JsonObject } }) =>\n      state.common.conf.SAMPLES_ROW_LIMIT,\n  );\n\n  // Extract datasource ID/type from string ID\n  const [datasourceId, datasourceType] = useMemo(\n    () => formData.datasource.split('__'),\n    [formData.datasource],\n  );\n\n  const { metadataBar, status: metadataBarStatus } = useDatasetMetadataBar({\n    datasetId: datasourceId,\n  });\n  // Get page of results\n  const resultsPage = useMemo(() => {\n    const nextResultsPage = resultsPages.get(pageIndex);\n    if (nextResultsPage) {\n      lastPageIndex.current = pageIndex;\n      return nextResultsPage;\n    }\n\n    return resultsPages.get(lastPageIndex.current);\n  }, [pageIndex, resultsPages]);\n\n  const mappedColumns: ColumnsType<DataType> = useMemo(\n    () =>\n      resultsPage?.colNames.map((column, index) => ({\n        key: column,\n        dataIndex: column,\n        title:\n          resultsPage?.colTypes[index] === GenericDataType.TEMPORAL ? (\n            <HeaderWithRadioGroup\n              headerTitle={column}\n              groupTitle={t('Formatting')}\n              groupOptions={[\n                { label: t('Original value'), value: TimeFormatting.Original },\n                {\n                  label: t('Formatted value'),\n                  value: TimeFormatting.Formatted,\n                },\n              ]}\n              value={\n                timeFormatting[column] === TimeFormatting.Original\n                  ? TimeFormatting.Original\n                  : TimeFormatting.Formatted\n              }\n              onChange={value =>\n                setTimeFormatting(state => ({ ...state, [column]: value }))\n              }\n            />\n          ) : (\n            column\n          ),\n        render: value => {\n          if (value === true || value === false) {\n            return <BooleanCell value={value} />;\n          }\n          if (value === null) {\n            return <NullCell />;\n          }\n          if (\n            resultsPage?.colTypes[index] === GenericDataType.TEMPORAL &&\n            timeFormatting[column] !== TimeFormatting.Original &&\n            (typeof value === 'number' || value instanceof Date)\n          ) {\n            return <TimeCell value={value} />;\n          }\n          return String(value);\n        },\n        width: 150,\n      })) || [],\n    [resultsPage?.colNames, resultsPage?.colTypes, timeFormatting],\n  );\n\n  const data: DataType[] = useMemo(\n    () =>\n      resultsPage?.data.map((row, index) =>\n        resultsPage?.colNames.reduce(\n          (acc, curr) => ({ ...acc, [curr]: row[curr] }),\n          {\n            key: index,\n          },\n        ),\n      ) || [],\n    [resultsPage?.colNames, resultsPage?.data],\n  );\n\n  // Clear cache on reload button click\n  const handleReload = useCallback(() => {\n    setResponseError('');\n    setResultsPages(new Map());\n    setPageIndex(0);\n  }, []);\n\n  // Clear cache and reset page index if filters change\n  useEffect(() => {\n    setResponseError('');\n    setResultsPages(new Map());\n    setPageIndex(0);\n  }, [filters]);\n\n  // Update cache order if page in cache\n  useEffect(() => {\n    if (\n      resultsPages.has(pageIndex) &&\n      [...resultsPages.keys()].at(-1) !== pageIndex\n    ) {\n      const nextResultsPages = new Map(resultsPages);\n      nextResultsPages.delete(pageIndex);\n      setResultsPages(\n        nextResultsPages.set(\n          pageIndex,\n          resultsPages.get(pageIndex) as ResultsPage,\n        ),\n      );\n    }\n  }, [pageIndex, resultsPages]);\n\n  // Download page of results & trim cache if page not in cache\n  useEffect(() => {\n    if (!responseError && !isLoading && !resultsPages.has(pageIndex)) {\n      setIsLoading(true);\n      const jsonPayload = getDrillPayload(formData, filters) ?? {};\n      const cachePageLimit = Math.ceil(SAMPLES_ROW_LIMIT / PAGE_SIZE);\n      getDatasourceSamples(\n        datasourceType,\n        datasourceId,\n        false,\n        jsonPayload,\n        PAGE_SIZE,\n        pageIndex + 1,\n      )\n        .then(response => {\n          setResultsPages(\n            new Map([\n              ...[...resultsPages.entries()].slice(-cachePageLimit + 1),\n              [\n                pageIndex,\n                {\n                  total: response.total_count,\n                  data: response.data,\n                  colNames: ensureIsArray(response.colnames),\n                  colTypes: ensureIsArray(response.coltypes),\n                },\n              ],\n            ]),\n          );\n          setResponseError('');\n        })\n        .catch(error => {\n          setResponseError(`${error.name}: ${error.message}`);\n        })\n        .finally(() => {\n          setIsLoading(false);\n        });\n    }\n  }, [\n    SAMPLES_ROW_LIMIT,\n    datasourceId,\n    datasourceType,\n    filters,\n    formData,\n    isLoading,\n    pageIndex,\n    responseError,\n    resultsPages,\n  ]);\n\n  const bootstrapping =\n    (!responseError && !resultsPages.size) ||\n    metadataBarStatus === ResourceStatus.LOADING;\n\n  let tableContent = null;\n  if (responseError) {\n    // Render error if page download failed\n    tableContent = (\n      <pre\n        css={css`\n          margin-top: ${theme.gridUnit * 4}px;\n        `}\n      >\n        {responseError}\n      </pre>\n    );\n  } else if (bootstrapping) {\n    // Render loading if first page hasn't loaded\n    tableContent = <Loading />;\n  } else if (resultsPage?.total === 0) {\n    // Render empty state if no results are returned for page\n    const title = t('No rows were returned for this dataset');\n    tableContent = <EmptyStateMedium image=\"document.svg\" title={title} />;\n  } else {\n    // Render table if at least one page has successfully loaded\n    tableContent = (\n      <Resizable>\n        <Table\n          data={data}\n          columns={mappedColumns}\n          size={TableSize.SMALL}\n          defaultPageSize={PAGE_SIZE}\n          recordCount={resultsPage?.total}\n          usePagination\n          loading={isLoading}\n          onChange={pagination =>\n            setPageIndex(pagination.current ? pagination.current - 1 : 0)\n          }\n          resizable\n          virtualize\n        />\n      </Resizable>\n    );\n  }\n\n  return (\n    <>\n      {!bootstrapping && metadataBar}\n      {!bootstrapping && (\n        <TableControls\n          filters={filters}\n          setFilters={setFilters}\n          totalCount={resultsPage?.total}\n          loading={isLoading}\n          onReload={handleReload}\n        />\n      )}\n      {tableContent}\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}