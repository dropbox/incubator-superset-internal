{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getColorFormatters } from '@superset-ui/chart-controls';\nimport { GenericDataType, getMetricLabel, extractTimegrain, getValueFormatter } from '@superset-ui/core';\nimport { getDateFormatter, parseMetricValue } from '../utils';\nexport default function transformProps(chartProps) {var _chartProps$datasourc, _metricEntry, _getColorFormatters;\n  const { width, height, queriesData, formData, rawFormData, hooks, datasource: { currencyFormats = {}, columnFormats = {} } } = chartProps;\n  const { headerFontSize, metric = 'value', subheader = '', subheaderFontSize, forceTimestampFormatting, timeFormat, yAxisFormat, conditionalFormatting } = formData;\n  const refs = {};\n  const { data = [], coltypes = [] } = queriesData[0];\n  const granularity = extractTimegrain(rawFormData);\n  const metricName = getMetricLabel(metric);\n  const formattedSubheader = subheader;\n  const bigNumber = data.length === 0 ? null : parseMetricValue(data[0][metricName]);\n  let metricEntry;\n  if ((_chartProps$datasourc = chartProps.datasource) != null && _chartProps$datasourc.metrics) {\n    metricEntry = chartProps.datasource.metrics.find((metricItem) => metricItem.metric_name === metric);\n  }\n  const formatTime = getDateFormatter(timeFormat, granularity, (_metricEntry = metricEntry) == null ? void 0 : _metricEntry.d3format);\n  const numberFormatter = getValueFormatter(metric, currencyFormats, columnFormats, yAxisFormat);\n  const headerFormatter = coltypes[0] === GenericDataType.TEMPORAL ||\n  coltypes[0] === GenericDataType.STRING ||\n  forceTimestampFormatting ?\n  formatTime :\n  numberFormatter;\n  const { onContextMenu } = hooks;\n  const defaultColorFormatters = [];\n  const colorThresholdFormatters = (_getColorFormatters = getColorFormatters(conditionalFormatting, data, false)) != null ? _getColorFormatters :\n  defaultColorFormatters;\n  return {\n    width,\n    height,\n    bigNumber,\n    headerFormatter,\n    headerFontSize,\n    subheaderFontSize,\n    subheader: formattedSubheader,\n    onContextMenu,\n    refs,\n    colorThresholdFormatters };\n\n}","map":{"version":3,"mappings":"AAAA;;;;;;;;;;;;;;;;;;AAkBA,SAEEA,kBAFF,QAIO,6BAJP;AAKA,SACEC,eADF,EAEEC,cAFF,EAGEC,gBAHF,EAKEC,iBALF,QAMO,mBANP;AAQA,SAASC,gBAAT,EAA2BC,gBAA3B,QAAmD,UAAnD;AAGA,eAAc,SAAUC,cAAV,CACZC,UADY,EACwB;EAEpC,MAAM,EACJC,KADI,EAEJC,MAFI,EAGJC,WAHI,EAIJC,QAJI,EAKJC,WALI,EAMJC,KANI,EAOJC,UAAU,EAAE,EAAEC,eAAe,GAAG,EAApB,EAAwBC,aAAa,GAAG,EAAxC,EAPR,KAQFT,UARJ;EASA,MAAM,EACJU,cADI,EAEJC,MAAM,GAAG,OAFL,EAGJC,SAAS,GAAG,EAHR,EAIJC,iBAJI,EAKJC,wBALI,EAMJC,UANI,EAOJC,WAPI,EAQJC,qBARI,KASFb,QATJ;EAUA,MAAMc,IAAI,GAAS,EAAnB;EACA,MAAM,EAAEC,IAAI,GAAG,EAAT,EAAaC,QAAQ,GAAG,EAAxB,KAA+BjB,WAAW,CAAC,CAAD,CAAhD;EACA,MAAMkB,WAAW,GAAG1B,gBAAgB,CAACU,WAAD,CAApC;EACA,MAAMiB,UAAU,GAAG5B,cAAc,CAACiB,MAAD,CAAjC;EACA,MAAMY,kBAAkB,GAAGX,SAA3B;EACA,MAAMY,SAAS,GACbL,IAAI,CAACM,MAAL,KAAgB,CAAhB,GAAoB,IAApB,GAA2B3B,gBAAgB,CAACqB,IAAI,CAAC,CAAD,CAAJ,CAAQG,UAAR,CAAD,CAD7C;EAGA,IAAII,WAAJ;EACA,6BAAI1B,UAAU,CAACO,UAAf,aAAI,sBAAuBoB,OAA3B,EAAoC;IAClCD,WAAW,GAAG1B,UAAU,CAACO,UAAX,CAAsBoB,OAAtB,CAA8BC,IAA9B,CACZ,WAAU,KAAIC,UAAU,CAACC,WAAX,KAA2BnB,MAD7B,CAAd;EAGD;EAED,MAAMoB,UAAU,GAAGlC,gBAAgB,CACjCkB,UADiC,EAEjCM,WAFiC,kBAGjCK,WAHiC,qBAGjC,aAAaM,QAHoB,CAAnC;EAMA,MAAMC,eAAe,GAAGrC,iBAAiB,CACvCe,MADuC,EAEvCH,eAFuC,EAGvCC,aAHuC,EAIvCO,WAJuC,CAAzC;EAOA,MAAMkB,eAAe,GACnBd,QAAQ,CAAC,CAAD,CAAR,KAAgB3B,eAAe,CAAC0C,QAAhC;EACAf,QAAQ,CAAC,CAAD,CAAR,KAAgB3B,eAAe,CAAC2C,MADhC;EAEAtB,wBAFA;EAGIiB,UAHJ;EAIIE,eALN;EAOA,MAAM,EAAEI,aAAF,KAAoB/B,KAA1B;EAEA,MAAMgC,sBAAsB,GAAG,EAA/B;EAEA,MAAMC,wBAAwB,0BAC5B/C,kBAAkB,CAACyB,qBAAD,EAAwBE,IAAxB,EAA8B,KAA9B,CADU;EAE5BmB,sBAFF;EAIA,OAAO;IACLrC,KADK;IAELC,MAFK;IAGLsB,SAHK;IAILU,eAJK;IAKLxB,cALK;IAMLG,iBANK;IAOLD,SAAS,EAAEW,kBAPN;IAQLc,aARK;IASLnB,IATK;IAULqB,wBAVK,EAAP;;AAYD","names":["getColorFormatters","GenericDataType","getMetricLabel","extractTimegrain","getValueFormatter","getDateFormatter","parseMetricValue","transformProps","chartProps","width","height","queriesData","formData","rawFormData","hooks","datasource","currencyFormats","columnFormats","headerFontSize","metric","subheader","subheaderFontSize","forceTimestampFormatting","timeFormat","yAxisFormat","conditionalFormatting","refs","data","coltypes","granularity","metricName","formattedSubheader","bigNumber","length","metricEntry","metrics","find","metricItem","metric_name","formatTime","d3format","numberFormatter","headerFormatter","TEMPORAL","STRING","onContextMenu","defaultColorFormatters","colorThresholdFormatters"],"sourceRoot":"","sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/plugins/plugin-chart-echarts/src/BigNumber/BigNumberTotal/transformProps.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ColorFormatters,\n  getColorFormatters,\n  Metric,\n} from '@superset-ui/chart-controls';\nimport {\n  GenericDataType,\n  getMetricLabel,\n  extractTimegrain,\n  QueryFormData,\n  getValueFormatter,\n} from '@superset-ui/core';\nimport { BigNumberTotalChartProps, BigNumberVizProps } from '../types';\nimport { getDateFormatter, parseMetricValue } from '../utils';\nimport { Refs } from '../../types';\n\nexport default function transformProps(\n  chartProps: BigNumberTotalChartProps,\n): BigNumberVizProps {\n  const {\n    width,\n    height,\n    queriesData,\n    formData,\n    rawFormData,\n    hooks,\n    datasource: { currencyFormats = {}, columnFormats = {} },\n  } = chartProps;\n  const {\n    headerFontSize,\n    metric = 'value',\n    subheader = '',\n    subheaderFontSize,\n    forceTimestampFormatting,\n    timeFormat,\n    yAxisFormat,\n    conditionalFormatting,\n  } = formData;\n  const refs: Refs = {};\n  const { data = [], coltypes = [] } = queriesData[0];\n  const granularity = extractTimegrain(rawFormData as QueryFormData);\n  const metricName = getMetricLabel(metric);\n  const formattedSubheader = subheader;\n  const bigNumber =\n    data.length === 0 ? null : parseMetricValue(data[0][metricName]);\n\n  let metricEntry: Metric | undefined;\n  if (chartProps.datasource?.metrics) {\n    metricEntry = chartProps.datasource.metrics.find(\n      metricItem => metricItem.metric_name === metric,\n    );\n  }\n\n  const formatTime = getDateFormatter(\n    timeFormat,\n    granularity,\n    metricEntry?.d3format,\n  );\n\n  const numberFormatter = getValueFormatter(\n    metric,\n    currencyFormats,\n    columnFormats,\n    yAxisFormat,\n  );\n\n  const headerFormatter =\n    coltypes[0] === GenericDataType.TEMPORAL ||\n    coltypes[0] === GenericDataType.STRING ||\n    forceTimestampFormatting\n      ? formatTime\n      : numberFormatter;\n\n  const { onContextMenu } = hooks;\n\n  const defaultColorFormatters = [] as ColorFormatters;\n\n  const colorThresholdFormatters =\n    getColorFormatters(conditionalFormatting, data, false) ??\n    defaultColorFormatters;\n\n  return {\n    width,\n    height,\n    bigNumber,\n    headerFormatter,\n    headerFontSize,\n    subheaderFontSize,\n    subheader: formattedSubheader,\n    onContextMenu,\n    refs,\n    colorThresholdFormatters,\n  };\n}\n"]},"metadata":{},"sourceType":"module"}