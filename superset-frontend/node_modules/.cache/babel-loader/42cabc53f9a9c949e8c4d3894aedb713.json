{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport { extent as d3Extent, range as d3Range } from 'd3-array';\nimport { select as d3Select } from 'd3-selection';\nimport { getSequentialSchemeRegistry, t } from '@superset-ui/core';\nimport CalHeatMap from './vendor/cal-heatmap';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    // Object hashed by metric name,\n    // then hashed by timestamp (in seconds, not milliseconds) as float\n    // the innermost value is count\n    // e.g. { count_distinct_something: { 1535034236.0: 3 } }\n    data: PropTypes.object,\n    domain: PropTypes.string,\n    range: PropTypes.number,\n    // timestamp in milliseconds\n    start: PropTypes.number,\n    subdomain: PropTypes.string }),\n\n  height: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellPadding: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellRadius: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellSize: PropTypes.number,\n  linearColorScheme: PropTypes.string,\n  showLegend: PropTypes.bool,\n  showMetricName: PropTypes.bool,\n  showValues: PropTypes.bool,\n  steps: PropTypes.number,\n  timeFormatter: PropTypes.func,\n  valueFormatter: PropTypes.func,\n  verboseMap: PropTypes.object,\n  theme: PropTypes.object };\n\n\nfunction Calendar(element, props) {\n  const {\n    data,\n    height,\n    cellPadding = 3,\n    cellRadius = 0,\n    cellSize = 10,\n    domainGranularity,\n    linearColorScheme,\n    showLegend,\n    showMetricName,\n    showValues,\n    steps,\n    subdomainGranularity,\n    timeFormatter,\n    valueFormatter,\n    verboseMap,\n    theme } =\n  props;\n\n  const container = d3Select(element).\n  classed('superset-legacy-chart-calendar', true).\n  style('height', height);\n  container.selectAll('*').remove();\n  const div = container.append('div');\n\n  const subDomainTextFormat = showValues ?\n  (date, value) => valueFormatter(value) :\n  null;\n\n  const metricsData = data.data;\n\n  const METRIC_TEXT = t('Metric');\n\n  Object.keys(metricsData).forEach((metric) => {\n    const calContainer = div.append('div');\n    if (showMetricName) {\n      calContainer.text(`${METRIC_TEXT}: ${verboseMap[metric] || metric}`);\n    }\n    const timestamps = metricsData[metric];\n    const extents = d3Extent(Object.keys(timestamps), (key) => timestamps[key]);\n    const step = (extents[1] - extents[0]) / (steps - 1);\n    const colorScale = getSequentialSchemeRegistry().\n    get(linearColorScheme).\n    createLinearScale(extents);\n\n    const legend = d3Range(steps).map((i) => extents[0] + step * i);\n    const legendColors = legend.map((x) => colorScale(x));\n\n    const cal = new CalHeatMap();\n    cal.init({\n      start: data.start,\n      data: timestamps,\n      itemSelector: calContainer.node(),\n      legendVerticalPosition: 'top',\n      cellSize,\n      cellPadding,\n      cellRadius,\n      legendCellSize: cellSize,\n      legendCellPadding: 2,\n      legendCellRadius: cellRadius,\n      tooltip: true,\n      domain: domainGranularity,\n      subDomain: subdomainGranularity,\n      range: data.range,\n      browsing: true,\n      legend,\n      legendColors: {\n        colorScale,\n        min: legendColors[0],\n        max: legendColors[legendColors.length - 1],\n        empty: theme.colors.grayscale.light5 },\n\n      displayLegend: showLegend,\n      itemName: '',\n      valueFormatter,\n      timeFormatter,\n      subDomainTextFormat });\n\n  });\n}\n\nCalendar.displayName = 'Calendar';\nCalendar.propTypes = propTypes;const _default =\n\nCalendar;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/Calendar.js\");reactHotLoader.register(Calendar, \"Calendar\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/Calendar.js\");reactHotLoader.register(_default, \"default\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/Calendar.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["PropTypes","extent","d3Extent","range","d3Range","select","d3Select","getSequentialSchemeRegistry","t","CalHeatMap","propTypes","data","shape","object","domain","string","number","start","subdomain","height","cellPadding","cellRadius","cellSize","linearColorScheme","showLegend","bool","showMetricName","showValues","steps","timeFormatter","func","valueFormatter","verboseMap","theme","Calendar","element","props","domainGranularity","subdomainGranularity","container","classed","style","selectAll","remove","div","append","subDomainTextFormat","date","value","metricsData","METRIC_TEXT","Object","keys","forEach","metric","calContainer","text","timestamps","extents","key","step","colorScale","get","createLinearScale","legend","map","i","legendColors","x","cal","init","itemSelector","node","legendVerticalPosition","legendCellSize","legendCellPadding","legendCellRadius","tooltip","subDomain","browsing","min","max","length","empty","colors","grayscale","light5","displayLegend","itemName","displayName"],"sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-calendar/src/Calendar.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport { extent as d3Extent, range as d3Range } from 'd3-array';\nimport { select as d3Select } from 'd3-selection';\nimport { getSequentialSchemeRegistry, t } from '@superset-ui/core';\nimport CalHeatMap from './vendor/cal-heatmap';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    // Object hashed by metric name,\n    // then hashed by timestamp (in seconds, not milliseconds) as float\n    // the innermost value is count\n    // e.g. { count_distinct_something: { 1535034236.0: 3 } }\n    data: PropTypes.object,\n    domain: PropTypes.string,\n    range: PropTypes.number,\n    // timestamp in milliseconds\n    start: PropTypes.number,\n    subdomain: PropTypes.string,\n  }),\n  height: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellPadding: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellRadius: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellSize: PropTypes.number,\n  linearColorScheme: PropTypes.string,\n  showLegend: PropTypes.bool,\n  showMetricName: PropTypes.bool,\n  showValues: PropTypes.bool,\n  steps: PropTypes.number,\n  timeFormatter: PropTypes.func,\n  valueFormatter: PropTypes.func,\n  verboseMap: PropTypes.object,\n  theme: PropTypes.object,\n};\n\nfunction Calendar(element, props) {\n  const {\n    data,\n    height,\n    cellPadding = 3,\n    cellRadius = 0,\n    cellSize = 10,\n    domainGranularity,\n    linearColorScheme,\n    showLegend,\n    showMetricName,\n    showValues,\n    steps,\n    subdomainGranularity,\n    timeFormatter,\n    valueFormatter,\n    verboseMap,\n    theme,\n  } = props;\n\n  const container = d3Select(element)\n    .classed('superset-legacy-chart-calendar', true)\n    .style('height', height);\n  container.selectAll('*').remove();\n  const div = container.append('div');\n\n  const subDomainTextFormat = showValues\n    ? (date, value) => valueFormatter(value)\n    : null;\n\n  const metricsData = data.data;\n\n  const METRIC_TEXT = t('Metric');\n\n  Object.keys(metricsData).forEach(metric => {\n    const calContainer = div.append('div');\n    if (showMetricName) {\n      calContainer.text(`${METRIC_TEXT}: ${verboseMap[metric] || metric}`);\n    }\n    const timestamps = metricsData[metric];\n    const extents = d3Extent(Object.keys(timestamps), key => timestamps[key]);\n    const step = (extents[1] - extents[0]) / (steps - 1);\n    const colorScale = getSequentialSchemeRegistry()\n      .get(linearColorScheme)\n      .createLinearScale(extents);\n\n    const legend = d3Range(steps).map(i => extents[0] + step * i);\n    const legendColors = legend.map(x => colorScale(x));\n\n    const cal = new CalHeatMap();\n    cal.init({\n      start: data.start,\n      data: timestamps,\n      itemSelector: calContainer.node(),\n      legendVerticalPosition: 'top',\n      cellSize,\n      cellPadding,\n      cellRadius,\n      legendCellSize: cellSize,\n      legendCellPadding: 2,\n      legendCellRadius: cellRadius,\n      tooltip: true,\n      domain: domainGranularity,\n      subDomain: subdomainGranularity,\n      range: data.range,\n      browsing: true,\n      legend,\n      legendColors: {\n        colorScale,\n        min: legendColors[0],\n        max: legendColors[legendColors.length - 1],\n        empty: theme.colors.grayscale.light5,\n      },\n      displayLegend: showLegend,\n      itemName: '',\n      valueFormatter,\n      timeFormatter,\n      subDomainTextFormat,\n    });\n  });\n}\n\nCalendar.displayName = 'Calendar';\nCalendar.propTypes = propTypes;\n\nexport default Calendar;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}