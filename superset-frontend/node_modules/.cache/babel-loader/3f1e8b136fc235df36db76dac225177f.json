{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\";var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport d3 from 'd3';\nimport d3tip from 'd3-tip';\nimport dompurify from 'dompurify';\nimport { smartDateFormatter, getNumberFormatter } from '@superset-ui/core';\n// Regexp for the label added to time shifted series\n// (1 hour offset, 2 days offset, etc.)\nconst TIME_SHIFT_PATTERN = /\\d+ \\w+ offset/;\n\nconst ANIMATION_TIME = 1000;\n\nexport function cleanColorInput(value) {\n  // for superset series that should have the same color\n  return String(value).\n  trim().\n  replace(' (right axis)', '').\n  split(', ').\n  filter((k) => !TIME_SHIFT_PATTERN.test(k)).\n  join(', ');\n}\n\n/**\n * If format is smart_date, format date\n * Otherwise, format number with the given format name\n * @param {*} format\n */\nexport function getTimeOrNumberFormatter(format) {\n  return format === 'smart_date' ?\n  smartDateFormatter :\n  getNumberFormatter(format);\n}\n\nexport function drawBarValues(svg, data, stacked, axisFormat) {\n  const format = getNumberFormatter(axisFormat);\n  const countSeriesDisplayed = data.filter((d) => !d.disabled).length;\n  const totalStackedValues =\n  stacked && data.length !== 0 ?\n  data[0].values.map((bar, iBar) => {\n    const bars = data.\n    filter((series) => !series.disabled).\n    map((series) => series.values[iBar]);\n\n    return d3.sum(bars, (d) => d.y);\n  }) :\n  [];\n  svg.selectAll('.bar-chart-label-group').remove();\n  setTimeout(() => {\n    svg.selectAll('.bar-chart-label-group').remove();\n    const groupLabels = svg.\n    select('g.nv-barsWrap').\n    append('g').\n    attr('class', 'bar-chart-label-group');\n    svg.\n    selectAll('g.nv-group').\n    filter((d, i) => !stacked || i === countSeriesDisplayed - 1).\n    selectAll('rect').\n    each(function each(d, index) {var _context;\n      const rectObj = d3.select(this);\n      const transformAttr = rectObj.attr('transform');\n      const xPos = parseFloat(rectObj.attr('x'));\n      const yPos = parseFloat(rectObj.attr('y'));\n      const rectWidth = parseFloat(rectObj.attr('width'));\n      const rectHeight = parseFloat(rectObj.attr('height'));\n      const textEls = groupLabels.\n      append('text').\n      text(format(stacked ? totalStackedValues[index] : d.y)).\n      attr('transform', transformAttr).\n      attr('class', 'bar-chart-label');\n\n      // fine tune text position\n      const bbox = textEls.node().getBBox();\n      const labelWidth = bbox.width;\n      const labelHeight = bbox.height;\n      textEls.attr('x', xPos + rectWidth / 2 - labelWidth / 2);\n      if (_includesInstanceProperty(_context = rectObj.attr('class')).call(_context, 'positive')) {\n        textEls.attr('y', yPos - 5);\n      } else {\n        textEls.attr('y', yPos + rectHeight + labelHeight);\n      }\n    });\n  }, ANIMATION_TIME);\n}\n\n// Formats the series key to account for a possible NULL value\nfunction getFormattedKey(seriesKey, shouldDompurify) {\n  if (seriesKey === '<NULL>') {\n    return `&lt;${seriesKey.slice(1, -1)}&gt;`;\n  }\n\n  return shouldDompurify ? dompurify.sanitize(seriesKey) : seriesKey;\n}\n\n// Custom sorted tooltip\n// use a verbose formatter for times\nexport function generateRichLineTooltipContent(\nd,\ntimeFormatter,\nvalueFormatter)\n{\n  let tooltip = '';\n  tooltip +=\n  \"<table><thead><tr><td colspan='3'>\" +\n  `<strong class='x-value'>${timeFormatter(d.value)}</strong>` +\n  '</td></tr></thead><tbody>';\n  d.series.sort((a, b) => a.value >= b.value ? -1 : 1);\n  d.series.forEach((series) => {\n    const key = getFormattedKey(series.key, true);\n    tooltip +=\n    `<tr class=\"${series.highlight ? 'emph' : ''}\">` +\n    `<td class='legend-color-guide' style=\"opacity: ${\n    series.highlight ? '1' : '0.75'\n    };\"\">` +\n    '<div ' +\n    `style=\"border: 2px solid ${\n    series.highlight ? 'black' : 'transparent'\n    }; background-color: ${series.color};\"` +\n    '></div>' +\n    '</td>' +\n    `<td>${key}</td>` +\n    `<td>${valueFormatter(series.value)}</td>` +\n    '</tr>';\n  });\n  tooltip += '</tbody></table>';\n\n  return dompurify.sanitize(tooltip);\n}\n\nexport function generateCompareTooltipContent(d, valueFormatter) {\n  let tooltip = '';\n  tooltip +=\n  \"<table><thead><tr><td colspan='3'>\" +\n  `<strong class='x-value'>${d.value}</strong>` +\n  '</td></tr></thead><tbody>';\n  d.series.sort((a, b) => a.value >= b.value ? -1 : 1);\n  d.series.forEach((series) => {\n    const key = getFormattedKey(series.key, true);\n    tooltip +=\n    `<tr class=\"${series.highlight ? 'emph' : ''}\">` +\n    `<td class='legend-color-guide' style=\"opacity: ${\n    series.highlight ? '1' : '0.75'\n    };\"\">` +\n    '<div ' +\n    `style=\"border: 2px solid ${\n    series.highlight ? 'black' : 'transparent'\n    }; background-color: ${series.color};\"` +\n    '></div>' +\n    '</td>' +\n    `<td>${key}</td>` +\n    `<td>${valueFormatter(series.value)}</td>` +\n    '</tr>';\n  });\n  tooltip += '</tbody></table>';\n\n  return dompurify.sanitize(tooltip);\n}\n\nexport function generateAreaChartTooltipContent(\nd,\ntimeFormatter,\nvalueFormatter,\nchart)\n{\n  const total =\n  chart.style() === 'expand' ?\n  // expand mode does not include total row\n  d3.sum(d.series, (s) => s.value) :\n  // other modes include total row at the end\n  d.series[d.series.length - 1].value;\n  let tooltip = '';\n  tooltip +=\n  \"<table><thead><tr><td colspan='4'>\" +\n  `<strong class='x-value'>${timeFormatter(d.value)}</strong>` +\n  '</td></tr></thead><tbody>' +\n  '<tr class=\"tooltip-header\"><td></td><td>Category</td><td>Value</td><td>% to total</td></tr>';\n  d.series.forEach((series) => {var _series$point;\n    const key = getFormattedKey(series.key, true);\n    let trClass = '';\n    if (series.highlight) {\n      trClass = 'superset-legacy-chart-nvd3-tr-highlight';\n    } else if (series.key === 'TOTAL') {\n      trClass = 'superset-legacy-chart-nvd3-tr-total';\n    }\n    tooltip +=\n    `<tr class=\"${trClass}\" style=\"border-color: ${series.color}\">` +\n    `<td style=\"color: ${series.color}\">${\n    series.key === 'TOTAL' ? '' : '&#9724;'\n    }</td>` +\n    `<td>${key}</td>` +\n    `<td>${valueFormatter(series == null ? void 0 : (_series$point = series.point) == null ? void 0 : _series$point.y)}</td>` +\n    `<td>${(100 * series.value / total).toFixed(2)}%</td>` +\n    '</tr>';\n  });\n  tooltip += '</tbody></table>';\n\n  return dompurify.sanitize(tooltip);\n}\n\nexport function generateMultiLineTooltipContent(d, xFormatter, yFormatters) {\n  const tooltipTitle = xFormatter(d.value);\n  let tooltip = '';\n\n  tooltip +=\n  \"<table><thead><tr><td colspan='3'>\" +\n  `<strong class='x-value'>${tooltipTitle}</strong>` +\n  '</td></tr></thead><tbody>';\n\n  d.series.forEach((series, i) => {\n    const yFormatter = yFormatters[i];\n    const key = getFormattedKey(series.key, false);\n    tooltip +=\n    \"<tr><td class='legend-color-guide'>\" +\n    `<div style=\"background-color: ${series.color};\"></div></td>` +\n    `<td class='key'>${key}</td>` +\n    `<td class='value'>${yFormatter(series.value)}</td></tr>`;\n  });\n\n  tooltip += '</tbody></table>';\n\n  return tooltip;\n}\n\nexport function generateTimePivotTooltip(d, xFormatter, yFormatter) {\n  const tooltipTitle = xFormatter(d.value);\n  let tooltip = '';\n\n  tooltip +=\n  \"<table><thead><tr><td colspan='3'>\" +\n  `<strong class='x-value'>${tooltipTitle}</strong>` +\n  '</td></tr></thead><tbody>';\n\n  d.series.forEach((series) => {\n    if (series.highlight) {\n      let label = '';\n      if (series.key === 'current') {\n        label = series.key;\n      } else {\n        label = `${series.key} of the selected frequency:`;\n      }\n      tooltip +=\n      \"<tr><td class='legend-color-guide'>\" +\n      `<div style=\"background-color: ${series.color};\"></div></td>` +\n      `<td class='key'>${label}</td>` +\n      `<td class='value'>${yFormatter(series.value)}</td></tr>`;\n    }\n  });\n\n  tooltip += '</tbody></table>';\n\n  return dompurify.sanitize(tooltip);\n}\n\nfunction getLabel(stringOrObjectWithLabel) {\n  return stringOrObjectWithLabel.label || stringOrObjectWithLabel;\n}\n\nfunction createHTMLRow(col1, col2) {\n  return `<tr><td>${col1}</td><td>${col2}</td></tr>`;\n}\n\nexport function generateBubbleTooltipContent(_ref)\n\n\n\n\n\n\n\n\n{let { point, entity, xField, yField, sizeField, xFormatter, yFormatter, sizeFormatter } = _ref;\n  let s = '<table>';\n  s +=\n  `<tr><td style=\"color: ${point.color};\">` +\n  `<strong>${point[entity]}</strong> (${point.group})` +\n  '</td></tr>';\n  s += createHTMLRow(getLabel(xField), xFormatter(point.x));\n  s += createHTMLRow(getLabel(yField), yFormatter(point.y));\n  s += createHTMLRow(getLabel(sizeField), sizeFormatter(point.size));\n  s += '</table>';\n\n  return s;\n}\n\n// shouldRemove indicates whether the nvtooltips should be removed from the DOM\nexport function hideTooltips(shouldRemove) {\n  const targets = document.querySelectorAll('.nvtooltip');\n  if (targets.length > 0) {\n    // Only set opacity to 0 when hiding tooltips so they would reappear\n    // on hover, which sets the opacity to 1\n    targets.forEach((t) => {\n      if (shouldRemove) {\n        t.remove();\n      } else {\n        // eslint-disable-next-line no-param-reassign\n        t.style.opacity = 0;\n      }\n    });\n  }\n}\n\nexport function generateTooltipClassName(uuid) {\n  return `tooltip-${uuid}`;\n}\n\nexport function removeTooltip(uuid) {\n  const classSelector = `.${generateTooltipClassName(uuid)}`;\n  const target = document.querySelector(classSelector);\n  if (target) {\n    target.remove();\n  }\n}\n\nexport function wrapTooltip(chart) {\n  const tooltipLayer =\n  chart.useInteractiveGuideline && chart.useInteractiveGuideline() ?\n  chart.interactiveLayer :\n  chart;\n  const tooltipGeneratorFunc = tooltipLayer.tooltip.contentGenerator();\n  tooltipLayer.tooltip.contentGenerator((d) => {\n    let tooltip = `<div>`;\n    tooltip += tooltipGeneratorFunc(d);\n    tooltip += '</div>';\n\n    return tooltip;\n  });\n}__signature__(wrapTooltip, \"useInteractiveGuideline{}\");\n\nexport function tipFactory(layer) {\n  return d3tip().\n  attr('class', `d3-tip ${layer.annotationTipClass || ''}`).\n  direction('n').\n  offset([-5, 0]).\n  html((d) => {\n    if (!d) {\n      return '';\n    }\n    const title =\n    d[layer.titleColumn] && d[layer.titleColumn].length > 0 ?\n    `${d[layer.titleColumn]} - ${layer.name}` :\n    layer.name;\n    const body = Array.isArray(layer.descriptionColumns) ?\n    layer.descriptionColumns.map((c) => d[c]) :\n    Object.values(d);\n\n    return `<div><strong>${title}</strong></div><br/><div>${body.join(\n    ', ')\n    }</div>`;\n  });\n}\n\nexport function getMaxLabelSize(svg, axisClass) {\n  // axis class = .nv-y2  // second y axis on dual line chart\n  // axis class = .nv-x  // x axis on time series line chart\n  const tickTexts = svg.selectAll(`.${axisClass} g.tick text`);\n  if (tickTexts.length > 0) {\n    const lengths = tickTexts[0].map((text) => text.getComputedTextLength());\n\n    return Math.ceil(Math.max(0, ...lengths));\n  }\n\n  return 0;\n}\n\nexport function formatLabel(input, verboseMap) {if (verboseMap === void 0) {verboseMap = {};}\n  // The input for label may be a string or an array of string\n  // When using the time shift feature, the label contains a '---' in the array\n  const verboseLookup = (s) => verboseMap[s] || s;\n\n  return Array.isArray(input) && input.length > 0 ?\n  input.\n  map((l) => TIME_SHIFT_PATTERN.test(l) ? l : verboseLookup(l)).\n  join(', ') :\n  verboseLookup(input);\n}\n\nconst MIN_BAR_WIDTH = 18;\n\nexport function computeBarChartWidth(data, stacked, maxWidth) {\n  const barCount = stacked ?\n  d3.max(data, (d) => d.values.length) :\n  d3.sum(data, (d) => d.values.length);\n\n  const barWidth = barCount * MIN_BAR_WIDTH;\n\n  return Math.max(barWidth, maxWidth);\n}\n\nexport function tryNumify(s) {\n  // Attempts casting to Number, returns string when failing\n  const n = Number(s);\n\n  return Number.isNaN(n) ? s : n;\n}\n\nexport function stringifyTimeRange(extent) {\n  if (extent.some((d) => d.toISOString === undefined)) {\n    return null;\n  }\n\n  return extent.map((d) => d.toISOString().slice(0, -1)).join(' : ');\n}\n\nexport function setAxisShowMaxMin(axis, showminmax) {\n  if (axis && axis.showMaxMin && showminmax !== undefined) {\n    axis.showMaxMin(showminmax);\n  }\n}\n\nexport function computeYDomain(data) {\n  if (Array.isArray(data) && data.length > 0 && Array.isArray(data[0].values)) {\n    const extents = data.\n    filter((d) => !d.disabled).\n    map((row) => d3.extent(row.values, (v) => v.y));\n    const minOfMin = d3.min(extents, (_ref2) => {let [min] = _ref2;return min;});\n    const maxOfMax = d3.max(extents, (_ref3) => {let [, max] = _ref3;return max;});\n\n    return [minOfMin, maxOfMax];\n  }\n\n  return [0, 1];\n}\n\nexport function computeStackedYDomain(data) {\n  if (Array.isArray(data) && data.length > 0 && Array.isArray(data[0].values)) {\n    const series = data.\n    filter((d) => !d.disabled).\n    map((d) => d.values.map((v) => v.y));\n    const stackedValues = series[0].map((_, i) =>\n    series.reduce((acc, cur) => acc + cur[i], 0));\n\n\n    return [Math.min(0, ...stackedValues), Math.max(0, ...stackedValues)];\n  }\n\n  return [0, 1];\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(TIME_SHIFT_PATTERN, \"TIME_SHIFT_PATTERN\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(ANIMATION_TIME, \"ANIMATION_TIME\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(cleanColorInput, \"cleanColorInput\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(getTimeOrNumberFormatter, \"getTimeOrNumberFormatter\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(drawBarValues, \"drawBarValues\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(getFormattedKey, \"getFormattedKey\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(generateRichLineTooltipContent, \"generateRichLineTooltipContent\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(generateCompareTooltipContent, \"generateCompareTooltipContent\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(generateAreaChartTooltipContent, \"generateAreaChartTooltipContent\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(generateMultiLineTooltipContent, \"generateMultiLineTooltipContent\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(generateTimePivotTooltip, \"generateTimePivotTooltip\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(getLabel, \"getLabel\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(createHTMLRow, \"createHTMLRow\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(generateBubbleTooltipContent, \"generateBubbleTooltipContent\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(hideTooltips, \"hideTooltips\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(generateTooltipClassName, \"generateTooltipClassName\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(removeTooltip, \"removeTooltip\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(wrapTooltip, \"wrapTooltip\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(tipFactory, \"tipFactory\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(getMaxLabelSize, \"getMaxLabelSize\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(formatLabel, \"formatLabel\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(MIN_BAR_WIDTH, \"MIN_BAR_WIDTH\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(computeBarChartWidth, \"computeBarChartWidth\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(tryNumify, \"tryNumify\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(stringifyTimeRange, \"stringifyTimeRange\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(setAxisShowMaxMin, \"setAxisShowMaxMin\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(computeYDomain, \"computeYDomain\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");reactHotLoader.register(computeStackedYDomain, \"computeStackedYDomain\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["d3","d3tip","dompurify","smartDateFormatter","getNumberFormatter","TIME_SHIFT_PATTERN","ANIMATION_TIME","cleanColorInput","value","String","trim","replace","split","filter","k","test","join","getTimeOrNumberFormatter","format","drawBarValues","svg","data","stacked","axisFormat","countSeriesDisplayed","d","disabled","length","totalStackedValues","values","map","bar","iBar","bars","series","sum","y","selectAll","remove","setTimeout","groupLabels","select","append","attr","i","each","index","rectObj","transformAttr","xPos","parseFloat","yPos","rectWidth","rectHeight","textEls","text","bbox","node","getBBox","labelWidth","width","labelHeight","height","getFormattedKey","seriesKey","shouldDompurify","slice","sanitize","generateRichLineTooltipContent","timeFormatter","valueFormatter","tooltip","sort","a","b","forEach","key","highlight","color","generateCompareTooltipContent","generateAreaChartTooltipContent","chart","total","style","s","trClass","point","toFixed","generateMultiLineTooltipContent","xFormatter","yFormatters","tooltipTitle","yFormatter","generateTimePivotTooltip","label","getLabel","stringOrObjectWithLabel","createHTMLRow","col1","col2","generateBubbleTooltipContent","entity","xField","yField","sizeField","sizeFormatter","group","x","size","hideTooltips","shouldRemove","targets","document","querySelectorAll","t","opacity","generateTooltipClassName","uuid","removeTooltip","classSelector","target","querySelector","wrapTooltip","tooltipLayer","useInteractiveGuideline","interactiveLayer","tooltipGeneratorFunc","contentGenerator","tipFactory","layer","annotationTipClass","direction","offset","html","title","titleColumn","name","body","Array","isArray","descriptionColumns","c","Object","getMaxLabelSize","axisClass","tickTexts","lengths","getComputedTextLength","Math","ceil","max","formatLabel","input","verboseMap","verboseLookup","l","MIN_BAR_WIDTH","computeBarChartWidth","maxWidth","barCount","barWidth","tryNumify","n","Number","isNaN","stringifyTimeRange","extent","some","toISOString","undefined","setAxisShowMaxMin","axis","showminmax","showMaxMin","computeYDomain","extents","row","v","minOfMin","min","maxOfMax","computeStackedYDomain","stackedValues","_","reduce","acc","cur"],"sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-preset-chart-nvd3/src/utils.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport d3 from 'd3';\nimport d3tip from 'd3-tip';\nimport dompurify from 'dompurify';\nimport { smartDateFormatter, getNumberFormatter } from '@superset-ui/core';\n// Regexp for the label added to time shifted series\n// (1 hour offset, 2 days offset, etc.)\nconst TIME_SHIFT_PATTERN = /\\d+ \\w+ offset/;\n\nconst ANIMATION_TIME = 1000;\n\nexport function cleanColorInput(value) {\n  // for superset series that should have the same color\n  return String(value)\n    .trim()\n    .replace(' (right axis)', '')\n    .split(', ')\n    .filter(k => !TIME_SHIFT_PATTERN.test(k))\n    .join(', ');\n}\n\n/**\n * If format is smart_date, format date\n * Otherwise, format number with the given format name\n * @param {*} format\n */\nexport function getTimeOrNumberFormatter(format) {\n  return format === 'smart_date'\n    ? smartDateFormatter\n    : getNumberFormatter(format);\n}\n\nexport function drawBarValues(svg, data, stacked, axisFormat) {\n  const format = getNumberFormatter(axisFormat);\n  const countSeriesDisplayed = data.filter(d => !d.disabled).length;\n  const totalStackedValues =\n    stacked && data.length !== 0\n      ? data[0].values.map((bar, iBar) => {\n          const bars = data\n            .filter(series => !series.disabled)\n            .map(series => series.values[iBar]);\n\n          return d3.sum(bars, d => d.y);\n        })\n      : [];\n  svg.selectAll('.bar-chart-label-group').remove();\n  setTimeout(() => {\n    svg.selectAll('.bar-chart-label-group').remove();\n    const groupLabels = svg\n      .select('g.nv-barsWrap')\n      .append('g')\n      .attr('class', 'bar-chart-label-group');\n    svg\n      .selectAll('g.nv-group')\n      .filter((d, i) => !stacked || i === countSeriesDisplayed - 1)\n      .selectAll('rect')\n      .each(function each(d, index) {\n        const rectObj = d3.select(this);\n        const transformAttr = rectObj.attr('transform');\n        const xPos = parseFloat(rectObj.attr('x'));\n        const yPos = parseFloat(rectObj.attr('y'));\n        const rectWidth = parseFloat(rectObj.attr('width'));\n        const rectHeight = parseFloat(rectObj.attr('height'));\n        const textEls = groupLabels\n          .append('text')\n          .text(format(stacked ? totalStackedValues[index] : d.y))\n          .attr('transform', transformAttr)\n          .attr('class', 'bar-chart-label');\n\n        // fine tune text position\n        const bbox = textEls.node().getBBox();\n        const labelWidth = bbox.width;\n        const labelHeight = bbox.height;\n        textEls.attr('x', xPos + rectWidth / 2 - labelWidth / 2);\n        if (rectObj.attr('class').includes('positive')) {\n          textEls.attr('y', yPos - 5);\n        } else {\n          textEls.attr('y', yPos + rectHeight + labelHeight);\n        }\n      });\n  }, ANIMATION_TIME);\n}\n\n// Formats the series key to account for a possible NULL value\nfunction getFormattedKey(seriesKey, shouldDompurify) {\n  if (seriesKey === '<NULL>') {\n    return `&lt;${seriesKey.slice(1, -1)}&gt;`;\n  }\n\n  return shouldDompurify ? dompurify.sanitize(seriesKey) : seriesKey;\n}\n\n// Custom sorted tooltip\n// use a verbose formatter for times\nexport function generateRichLineTooltipContent(\n  d,\n  timeFormatter,\n  valueFormatter,\n) {\n  let tooltip = '';\n  tooltip +=\n    \"<table><thead><tr><td colspan='3'>\" +\n    `<strong class='x-value'>${timeFormatter(d.value)}</strong>` +\n    '</td></tr></thead><tbody>';\n  d.series.sort((a, b) => (a.value >= b.value ? -1 : 1));\n  d.series.forEach(series => {\n    const key = getFormattedKey(series.key, true);\n    tooltip +=\n      `<tr class=\"${series.highlight ? 'emph' : ''}\">` +\n      `<td class='legend-color-guide' style=\"opacity: ${\n        series.highlight ? '1' : '0.75'\n      };\"\">` +\n      '<div ' +\n      `style=\"border: 2px solid ${\n        series.highlight ? 'black' : 'transparent'\n      }; background-color: ${series.color};\"` +\n      '></div>' +\n      '</td>' +\n      `<td>${key}</td>` +\n      `<td>${valueFormatter(series.value)}</td>` +\n      '</tr>';\n  });\n  tooltip += '</tbody></table>';\n\n  return dompurify.sanitize(tooltip);\n}\n\nexport function generateCompareTooltipContent(d, valueFormatter) {\n  let tooltip = '';\n  tooltip +=\n    \"<table><thead><tr><td colspan='3'>\" +\n    `<strong class='x-value'>${d.value}</strong>` +\n    '</td></tr></thead><tbody>';\n  d.series.sort((a, b) => (a.value >= b.value ? -1 : 1));\n  d.series.forEach(series => {\n    const key = getFormattedKey(series.key, true);\n    tooltip +=\n      `<tr class=\"${series.highlight ? 'emph' : ''}\">` +\n      `<td class='legend-color-guide' style=\"opacity: ${\n        series.highlight ? '1' : '0.75'\n      };\"\">` +\n      '<div ' +\n      `style=\"border: 2px solid ${\n        series.highlight ? 'black' : 'transparent'\n      }; background-color: ${series.color};\"` +\n      '></div>' +\n      '</td>' +\n      `<td>${key}</td>` +\n      `<td>${valueFormatter(series.value)}</td>` +\n      '</tr>';\n  });\n  tooltip += '</tbody></table>';\n\n  return dompurify.sanitize(tooltip);\n}\n\nexport function generateAreaChartTooltipContent(\n  d,\n  timeFormatter,\n  valueFormatter,\n  chart,\n) {\n  const total =\n    chart.style() === 'expand'\n      ? // expand mode does not include total row\n        d3.sum(d.series, s => s.value)\n      : // other modes include total row at the end\n        d.series[d.series.length - 1].value;\n  let tooltip = '';\n  tooltip +=\n    \"<table><thead><tr><td colspan='4'>\" +\n    `<strong class='x-value'>${timeFormatter(d.value)}</strong>` +\n    '</td></tr></thead><tbody>' +\n    '<tr class=\"tooltip-header\"><td></td><td>Category</td><td>Value</td><td>% to total</td></tr>';\n  d.series.forEach(series => {\n    const key = getFormattedKey(series.key, true);\n    let trClass = '';\n    if (series.highlight) {\n      trClass = 'superset-legacy-chart-nvd3-tr-highlight';\n    } else if (series.key === 'TOTAL') {\n      trClass = 'superset-legacy-chart-nvd3-tr-total';\n    }\n    tooltip +=\n      `<tr class=\"${trClass}\" style=\"border-color: ${series.color}\">` +\n      `<td style=\"color: ${series.color}\">${\n        series.key === 'TOTAL' ? '' : '&#9724;'\n      }</td>` +\n      `<td>${key}</td>` +\n      `<td>${valueFormatter(series?.point?.y)}</td>` +\n      `<td>${((100 * series.value) / total).toFixed(2)}%</td>` +\n      '</tr>';\n  });\n  tooltip += '</tbody></table>';\n\n  return dompurify.sanitize(tooltip);\n}\n\nexport function generateMultiLineTooltipContent(d, xFormatter, yFormatters) {\n  const tooltipTitle = xFormatter(d.value);\n  let tooltip = '';\n\n  tooltip +=\n    \"<table><thead><tr><td colspan='3'>\" +\n    `<strong class='x-value'>${tooltipTitle}</strong>` +\n    '</td></tr></thead><tbody>';\n\n  d.series.forEach((series, i) => {\n    const yFormatter = yFormatters[i];\n    const key = getFormattedKey(series.key, false);\n    tooltip +=\n      \"<tr><td class='legend-color-guide'>\" +\n      `<div style=\"background-color: ${series.color};\"></div></td>` +\n      `<td class='key'>${key}</td>` +\n      `<td class='value'>${yFormatter(series.value)}</td></tr>`;\n  });\n\n  tooltip += '</tbody></table>';\n\n  return tooltip;\n}\n\nexport function generateTimePivotTooltip(d, xFormatter, yFormatter) {\n  const tooltipTitle = xFormatter(d.value);\n  let tooltip = '';\n\n  tooltip +=\n    \"<table><thead><tr><td colspan='3'>\" +\n    `<strong class='x-value'>${tooltipTitle}</strong>` +\n    '</td></tr></thead><tbody>';\n\n  d.series.forEach(series => {\n    if (series.highlight) {\n      let label = '';\n      if (series.key === 'current') {\n        label = series.key;\n      } else {\n        label = `${series.key} of the selected frequency:`;\n      }\n      tooltip +=\n        \"<tr><td class='legend-color-guide'>\" +\n        `<div style=\"background-color: ${series.color};\"></div></td>` +\n        `<td class='key'>${label}</td>` +\n        `<td class='value'>${yFormatter(series.value)}</td></tr>`;\n    }\n  });\n\n  tooltip += '</tbody></table>';\n\n  return dompurify.sanitize(tooltip);\n}\n\nfunction getLabel(stringOrObjectWithLabel) {\n  return stringOrObjectWithLabel.label || stringOrObjectWithLabel;\n}\n\nfunction createHTMLRow(col1, col2) {\n  return `<tr><td>${col1}</td><td>${col2}</td></tr>`;\n}\n\nexport function generateBubbleTooltipContent({\n  point,\n  entity,\n  xField,\n  yField,\n  sizeField,\n  xFormatter,\n  yFormatter,\n  sizeFormatter,\n}) {\n  let s = '<table>';\n  s +=\n    `<tr><td style=\"color: ${point.color};\">` +\n    `<strong>${point[entity]}</strong> (${point.group})` +\n    '</td></tr>';\n  s += createHTMLRow(getLabel(xField), xFormatter(point.x));\n  s += createHTMLRow(getLabel(yField), yFormatter(point.y));\n  s += createHTMLRow(getLabel(sizeField), sizeFormatter(point.size));\n  s += '</table>';\n\n  return s;\n}\n\n// shouldRemove indicates whether the nvtooltips should be removed from the DOM\nexport function hideTooltips(shouldRemove) {\n  const targets = document.querySelectorAll('.nvtooltip');\n  if (targets.length > 0) {\n    // Only set opacity to 0 when hiding tooltips so they would reappear\n    // on hover, which sets the opacity to 1\n    targets.forEach(t => {\n      if (shouldRemove) {\n        t.remove();\n      } else {\n        // eslint-disable-next-line no-param-reassign\n        t.style.opacity = 0;\n      }\n    });\n  }\n}\n\nexport function generateTooltipClassName(uuid) {\n  return `tooltip-${uuid}`;\n}\n\nexport function removeTooltip(uuid) {\n  const classSelector = `.${generateTooltipClassName(uuid)}`;\n  const target = document.querySelector(classSelector);\n  if (target) {\n    target.remove();\n  }\n}\n\nexport function wrapTooltip(chart) {\n  const tooltipLayer =\n    chart.useInteractiveGuideline && chart.useInteractiveGuideline()\n      ? chart.interactiveLayer\n      : chart;\n  const tooltipGeneratorFunc = tooltipLayer.tooltip.contentGenerator();\n  tooltipLayer.tooltip.contentGenerator(d => {\n    let tooltip = `<div>`;\n    tooltip += tooltipGeneratorFunc(d);\n    tooltip += '</div>';\n\n    return tooltip;\n  });\n}\n\nexport function tipFactory(layer) {\n  return d3tip()\n    .attr('class', `d3-tip ${layer.annotationTipClass || ''}`)\n    .direction('n')\n    .offset([-5, 0])\n    .html(d => {\n      if (!d) {\n        return '';\n      }\n      const title =\n        d[layer.titleColumn] && d[layer.titleColumn].length > 0\n          ? `${d[layer.titleColumn]} - ${layer.name}`\n          : layer.name;\n      const body = Array.isArray(layer.descriptionColumns)\n        ? layer.descriptionColumns.map(c => d[c])\n        : Object.values(d);\n\n      return `<div><strong>${title}</strong></div><br/><div>${body.join(\n        ', ',\n      )}</div>`;\n    });\n}\n\nexport function getMaxLabelSize(svg, axisClass) {\n  // axis class = .nv-y2  // second y axis on dual line chart\n  // axis class = .nv-x  // x axis on time series line chart\n  const tickTexts = svg.selectAll(`.${axisClass} g.tick text`);\n  if (tickTexts.length > 0) {\n    const lengths = tickTexts[0].map(text => text.getComputedTextLength());\n\n    return Math.ceil(Math.max(0, ...lengths));\n  }\n\n  return 0;\n}\n\nexport function formatLabel(input, verboseMap = {}) {\n  // The input for label may be a string or an array of string\n  // When using the time shift feature, the label contains a '---' in the array\n  const verboseLookup = s => verboseMap[s] || s;\n\n  return Array.isArray(input) && input.length > 0\n    ? input\n        .map(l => (TIME_SHIFT_PATTERN.test(l) ? l : verboseLookup(l)))\n        .join(', ')\n    : verboseLookup(input);\n}\n\nconst MIN_BAR_WIDTH = 18;\n\nexport function computeBarChartWidth(data, stacked, maxWidth) {\n  const barCount = stacked\n    ? d3.max(data, d => d.values.length)\n    : d3.sum(data, d => d.values.length);\n\n  const barWidth = barCount * MIN_BAR_WIDTH;\n\n  return Math.max(barWidth, maxWidth);\n}\n\nexport function tryNumify(s) {\n  // Attempts casting to Number, returns string when failing\n  const n = Number(s);\n\n  return Number.isNaN(n) ? s : n;\n}\n\nexport function stringifyTimeRange(extent) {\n  if (extent.some(d => d.toISOString === undefined)) {\n    return null;\n  }\n\n  return extent.map(d => d.toISOString().slice(0, -1)).join(' : ');\n}\n\nexport function setAxisShowMaxMin(axis, showminmax) {\n  if (axis && axis.showMaxMin && showminmax !== undefined) {\n    axis.showMaxMin(showminmax);\n  }\n}\n\nexport function computeYDomain(data) {\n  if (Array.isArray(data) && data.length > 0 && Array.isArray(data[0].values)) {\n    const extents = data\n      .filter(d => !d.disabled)\n      .map(row => d3.extent(row.values, v => v.y));\n    const minOfMin = d3.min(extents, ([min]) => min);\n    const maxOfMax = d3.max(extents, ([, max]) => max);\n\n    return [minOfMin, maxOfMax];\n  }\n\n  return [0, 1];\n}\n\nexport function computeStackedYDomain(data) {\n  if (Array.isArray(data) && data.length > 0 && Array.isArray(data[0].values)) {\n    const series = data\n      .filter(d => !d.disabled)\n      .map(d => d.values.map(v => v.y));\n    const stackedValues = series[0].map((_, i) =>\n      series.reduce((acc, cur) => acc + cur[i], 0),\n    );\n\n    return [Math.min(0, ...stackedValues), Math.max(0, ...stackedValues)];\n  }\n\n  return [0, 1];\n}\n"],"mappings":"wYAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAAOA,EAAP,MAAe,IAAf;AACA,OAAOC,KAAP,MAAkB,QAAlB;AACA,OAAOC,SAAP,MAAsB,WAAtB;AACA,SAASC,kBAAT,EAA6BC,kBAA7B,QAAuD,mBAAvD;AACA;AACA;AACA,MAAMC,kBAAkB,GAAG,gBAA3B;;AAEA,MAAMC,cAAc,GAAG,IAAvB;;AAEA,OAAO,SAASC,eAAT,CAAyBC,KAAzB,EAAgC;EACrC;EACA,OAAOC,MAAM,CAACD,KAAD,CAAN;EACJE,IADI;EAEJC,OAFI,CAEI,eAFJ,EAEqB,EAFrB;EAGJC,KAHI,CAGE,IAHF;EAIJC,MAJI,CAIG,CAAAC,CAAC,KAAI,CAACT,kBAAkB,CAACU,IAAnB,CAAwBD,CAAxB,CAJT;EAKJE,IALI,CAKC,IALD,CAAP;AAMD;;AAED;AACA;AACA;AACA;AACA;AACA,OAAO,SAASC,wBAAT,CAAkCC,MAAlC,EAA0C;EAC/C,OAAOA,MAAM,KAAK,YAAX;EACHf,kBADG;EAEHC,kBAAkB,CAACc,MAAD,CAFtB;AAGD;;AAED,OAAO,SAASC,aAAT,CAAuBC,GAAvB,EAA4BC,IAA5B,EAAkCC,OAAlC,EAA2CC,UAA3C,EAAuD;EAC5D,MAAML,MAAM,GAAGd,kBAAkB,CAACmB,UAAD,CAAjC;EACA,MAAMC,oBAAoB,GAAGH,IAAI,CAACR,MAAL,CAAY,CAAAY,CAAC,KAAI,CAACA,CAAC,CAACC,QAApB,EAA8BC,MAA3D;EACA,MAAMC,kBAAkB;EACtBN,OAAO,IAAID,IAAI,CAACM,MAAL,KAAgB,CAA3B;EACIN,IAAI,CAAC,CAAD,CAAJ,CAAQQ,MAAR,CAAeC,GAAf,CAAmB,CAACC,GAAD,EAAMC,IAAN,KAAe;IAChC,MAAMC,IAAI,GAAGZ,IAAI;IACdR,MADU,CACH,CAAAqB,MAAM,KAAI,CAACA,MAAM,CAACR,QADf;IAEVI,GAFU,CAEN,CAAAI,MAAM,KAAIA,MAAM,CAACL,MAAP,CAAcG,IAAd,CAFJ,CAAb;;IAIA,OAAOhC,EAAE,CAACmC,GAAH,CAAOF,IAAP,EAAa,CAAAR,CAAC,KAAIA,CAAC,CAACW,CAApB,CAAP;EACD,CAND,CADJ;EAQI,EATN;EAUAhB,GAAG,CAACiB,SAAJ,CAAc,wBAAd,EAAwCC,MAAxC;EACAC,UAAU,CAAC,MAAM;IACfnB,GAAG,CAACiB,SAAJ,CAAc,wBAAd,EAAwCC,MAAxC;IACA,MAAME,WAAW,GAAGpB,GAAG;IACpBqB,MADiB,CACV,eADU;IAEjBC,MAFiB,CAEV,GAFU;IAGjBC,IAHiB,CAGZ,OAHY,EAGH,uBAHG,CAApB;IAIAvB,GAAG;IACAiB,SADH,CACa,YADb;IAEGxB,MAFH,CAEU,CAACY,CAAD,EAAImB,CAAJ,KAAU,CAACtB,OAAD,IAAYsB,CAAC,KAAKpB,oBAAoB,GAAG,CAF7D;IAGGa,SAHH,CAGa,MAHb;IAIGQ,IAJH,CAIQ,SAASA,IAAT,CAAcpB,CAAd,EAAiBqB,KAAjB,EAAwB;MAC5B,MAAMC,OAAO,GAAG/C,EAAE,CAACyC,MAAH,CAAU,IAAV,CAAhB;MACA,MAAMO,aAAa,GAAGD,OAAO,CAACJ,IAAR,CAAa,WAAb,CAAtB;MACA,MAAMM,IAAI,GAAGC,UAAU,CAACH,OAAO,CAACJ,IAAR,CAAa,GAAb,CAAD,CAAvB;MACA,MAAMQ,IAAI,GAAGD,UAAU,CAACH,OAAO,CAACJ,IAAR,CAAa,GAAb,CAAD,CAAvB;MACA,MAAMS,SAAS,GAAGF,UAAU,CAACH,OAAO,CAACJ,IAAR,CAAa,OAAb,CAAD,CAA5B;MACA,MAAMU,UAAU,GAAGH,UAAU,CAACH,OAAO,CAACJ,IAAR,CAAa,QAAb,CAAD,CAA7B;MACA,MAAMW,OAAO,GAAGd,WAAW;MACxBE,MADa,CACN,MADM;MAEba,IAFa,CAERrC,MAAM,CAACI,OAAO,GAAGM,kBAAkB,CAACkB,KAAD,CAArB,GAA+BrB,CAAC,CAACW,CAAzC,CAFE;MAGbO,IAHa,CAGR,WAHQ,EAGKK,aAHL;MAIbL,IAJa,CAIR,OAJQ,EAIC,iBAJD,CAAhB;;MAMA;MACA,MAAMa,IAAI,GAAGF,OAAO,CAACG,IAAR,GAAeC,OAAf,EAAb;MACA,MAAMC,UAAU,GAAGH,IAAI,CAACI,KAAxB;MACA,MAAMC,WAAW,GAAGL,IAAI,CAACM,MAAzB;MACAR,OAAO,CAACX,IAAR,CAAa,GAAb,EAAkBM,IAAI,GAAGG,SAAS,GAAG,CAAnB,GAAuBO,UAAU,GAAG,CAAtD;MACA,IAAI,qCAAAZ,OAAO,CAACJ,IAAR,CAAa,OAAb,kBAA+B,UAA/B,CAAJ,EAAgD;QAC9CW,OAAO,CAACX,IAAR,CAAa,GAAb,EAAkBQ,IAAI,GAAG,CAAzB;MACD,CAFD,MAEO;QACLG,OAAO,CAACX,IAAR,CAAa,GAAb,EAAkBQ,IAAI,GAAGE,UAAP,GAAoBQ,WAAtC;MACD;IACF,CA3BH;EA4BD,CAlCS,EAkCPvD,cAlCO,CAAV;AAmCD;;AAED;AACA,SAASyD,eAAT,CAAyBC,SAAzB,EAAoCC,eAApC,EAAqD;EACnD,IAAID,SAAS,KAAK,QAAlB,EAA4B;IAC1B,OAAQ,OAAMA,SAAS,CAACE,KAAV,CAAgB,CAAhB,EAAmB,CAAC,CAApB,CAAuB,MAArC;EACD;;EAED,OAAOD,eAAe,GAAG/D,SAAS,CAACiE,QAAV,CAAmBH,SAAnB,CAAH,GAAmCA,SAAzD;AACD;;AAED;AACA;AACA,OAAO,SAASI,8BAAT;AACL3C,CADK;AAEL4C,aAFK;AAGLC,cAHK;AAIL;EACA,IAAIC,OAAO,GAAG,EAAd;EACAA,OAAO;EACL;EACC,2BAA0BF,aAAa,CAAC5C,CAAC,CAACjB,KAAH,CAAU,WADlD;EAEA,2BAHF;EAIAiB,CAAC,CAACS,MAAF,CAASsC,IAAT,CAAc,CAACC,CAAD,EAAIC,CAAJ,KAAWD,CAAC,CAACjE,KAAF,IAAWkE,CAAC,CAAClE,KAAb,GAAqB,CAAC,CAAtB,GAA0B,CAAnD;EACAiB,CAAC,CAACS,MAAF,CAASyC,OAAT,CAAiB,CAAAzC,MAAM,KAAI;IACzB,MAAM0C,GAAG,GAAGb,eAAe,CAAC7B,MAAM,CAAC0C,GAAR,EAAa,IAAb,CAA3B;IACAL,OAAO;IACJ,cAAarC,MAAM,CAAC2C,SAAP,GAAmB,MAAnB,GAA4B,EAAG,IAA7C;IACC;IACC3C,MAAM,CAAC2C,SAAP,GAAmB,GAAnB,GAAyB;IAC1B,MAHD;IAIA,OAJA;IAKC;IACC3C,MAAM,CAAC2C,SAAP,GAAmB,OAAnB,GAA6B;IAC9B,uBAAsB3C,MAAM,CAAC4C,KAAM,IAPpC;IAQA,SARA;IASA,OATA;IAUC,OAAMF,GAAI,OAVX;IAWC,OAAMN,cAAc,CAACpC,MAAM,CAAC1B,KAAR,CAAe,OAXpC;IAYA,OAbF;EAcD,CAhBD;EAiBA+D,OAAO,IAAI,kBAAX;;EAEA,OAAOrE,SAAS,CAACiE,QAAV,CAAmBI,OAAnB,CAAP;AACD;;AAED,OAAO,SAASQ,6BAAT,CAAuCtD,CAAvC,EAA0C6C,cAA1C,EAA0D;EAC/D,IAAIC,OAAO,GAAG,EAAd;EACAA,OAAO;EACL;EACC,2BAA0B9C,CAAC,CAACjB,KAAM,WADnC;EAEA,2BAHF;EAIAiB,CAAC,CAACS,MAAF,CAASsC,IAAT,CAAc,CAACC,CAAD,EAAIC,CAAJ,KAAWD,CAAC,CAACjE,KAAF,IAAWkE,CAAC,CAAClE,KAAb,GAAqB,CAAC,CAAtB,GAA0B,CAAnD;EACAiB,CAAC,CAACS,MAAF,CAASyC,OAAT,CAAiB,CAAAzC,MAAM,KAAI;IACzB,MAAM0C,GAAG,GAAGb,eAAe,CAAC7B,MAAM,CAAC0C,GAAR,EAAa,IAAb,CAA3B;IACAL,OAAO;IACJ,cAAarC,MAAM,CAAC2C,SAAP,GAAmB,MAAnB,GAA4B,EAAG,IAA7C;IACC;IACC3C,MAAM,CAAC2C,SAAP,GAAmB,GAAnB,GAAyB;IAC1B,MAHD;IAIA,OAJA;IAKC;IACC3C,MAAM,CAAC2C,SAAP,GAAmB,OAAnB,GAA6B;IAC9B,uBAAsB3C,MAAM,CAAC4C,KAAM,IAPpC;IAQA,SARA;IASA,OATA;IAUC,OAAMF,GAAI,OAVX;IAWC,OAAMN,cAAc,CAACpC,MAAM,CAAC1B,KAAR,CAAe,OAXpC;IAYA,OAbF;EAcD,CAhBD;EAiBA+D,OAAO,IAAI,kBAAX;;EAEA,OAAOrE,SAAS,CAACiE,QAAV,CAAmBI,OAAnB,CAAP;AACD;;AAED,OAAO,SAASS,+BAAT;AACLvD,CADK;AAEL4C,aAFK;AAGLC,cAHK;AAILW,KAJK;AAKL;EACA,MAAMC,KAAK;EACTD,KAAK,CAACE,KAAN,OAAkB,QAAlB;EACI;EACAnF,EAAE,CAACmC,GAAH,CAAOV,CAAC,CAACS,MAAT,EAAiB,CAAAkD,CAAC,KAAIA,CAAC,CAAC5E,KAAxB,CAFJ;EAGI;EACAiB,CAAC,CAACS,MAAF,CAAST,CAAC,CAACS,MAAF,CAASP,MAAT,GAAkB,CAA3B,EAA8BnB,KALpC;EAMA,IAAI+D,OAAO,GAAG,EAAd;EACAA,OAAO;EACL;EACC,2BAA0BF,aAAa,CAAC5C,CAAC,CAACjB,KAAH,CAAU,WADlD;EAEA,2BAFA;EAGA,6FAJF;EAKAiB,CAAC,CAACS,MAAF,CAASyC,OAAT,CAAiB,CAAAzC,MAAM,KAAI;IACzB,MAAM0C,GAAG,GAAGb,eAAe,CAAC7B,MAAM,CAAC0C,GAAR,EAAa,IAAb,CAA3B;IACA,IAAIS,OAAO,GAAG,EAAd;IACA,IAAInD,MAAM,CAAC2C,SAAX,EAAsB;MACpBQ,OAAO,GAAG,yCAAV;IACD,CAFD,MAEO,IAAInD,MAAM,CAAC0C,GAAP,KAAe,OAAnB,EAA4B;MACjCS,OAAO,GAAG,qCAAV;IACD;IACDd,OAAO;IACJ,cAAac,OAAQ,0BAAyBnD,MAAM,CAAC4C,KAAM,IAA5D;IACC,qBAAoB5C,MAAM,CAAC4C,KAAM;IAChC5C,MAAM,CAAC0C,GAAP,KAAe,OAAf,GAAyB,EAAzB,GAA8B;IAC/B,OAHD;IAIC,OAAMA,GAAI,OAJX;IAKC,OAAMN,cAAc,CAACpC,MAAD,qCAACA,MAAM,CAAEoD,KAAT,qBAAC,cAAelD,CAAhB,CAAmB,OALxC;IAMC,OAAM,CAAE,MAAMF,MAAM,CAAC1B,KAAd,GAAuB0E,KAAxB,EAA+BK,OAA/B,CAAuC,CAAvC,CAA0C,QANjD;IAOA,OARF;EASD,CAjBD;EAkBAhB,OAAO,IAAI,kBAAX;;EAEA,OAAOrE,SAAS,CAACiE,QAAV,CAAmBI,OAAnB,CAAP;AACD;;AAED,OAAO,SAASiB,+BAAT,CAAyC/D,CAAzC,EAA4CgE,UAA5C,EAAwDC,WAAxD,EAAqE;EAC1E,MAAMC,YAAY,GAAGF,UAAU,CAAChE,CAAC,CAACjB,KAAH,CAA/B;EACA,IAAI+D,OAAO,GAAG,EAAd;;EAEAA,OAAO;EACL;EACC,2BAA0BoB,YAAa,WADxC;EAEA,2BAHF;;EAKAlE,CAAC,CAACS,MAAF,CAASyC,OAAT,CAAiB,CAACzC,MAAD,EAASU,CAAT,KAAe;IAC9B,MAAMgD,UAAU,GAAGF,WAAW,CAAC9C,CAAD,CAA9B;IACA,MAAMgC,GAAG,GAAGb,eAAe,CAAC7B,MAAM,CAAC0C,GAAR,EAAa,KAAb,CAA3B;IACAL,OAAO;IACL;IACC,iCAAgCrC,MAAM,CAAC4C,KAAM,gBAD9C;IAEC,mBAAkBF,GAAI,OAFvB;IAGC,qBAAoBgB,UAAU,CAAC1D,MAAM,CAAC1B,KAAR,CAAe,YAJhD;EAKD,CARD;;EAUA+D,OAAO,IAAI,kBAAX;;EAEA,OAAOA,OAAP;AACD;;AAED,OAAO,SAASsB,wBAAT,CAAkCpE,CAAlC,EAAqCgE,UAArC,EAAiDG,UAAjD,EAA6D;EAClE,MAAMD,YAAY,GAAGF,UAAU,CAAChE,CAAC,CAACjB,KAAH,CAA/B;EACA,IAAI+D,OAAO,GAAG,EAAd;;EAEAA,OAAO;EACL;EACC,2BAA0BoB,YAAa,WADxC;EAEA,2BAHF;;EAKAlE,CAAC,CAACS,MAAF,CAASyC,OAAT,CAAiB,CAAAzC,MAAM,KAAI;IACzB,IAAIA,MAAM,CAAC2C,SAAX,EAAsB;MACpB,IAAIiB,KAAK,GAAG,EAAZ;MACA,IAAI5D,MAAM,CAAC0C,GAAP,KAAe,SAAnB,EAA8B;QAC5BkB,KAAK,GAAG5D,MAAM,CAAC0C,GAAf;MACD,CAFD,MAEO;QACLkB,KAAK,GAAI,GAAE5D,MAAM,CAAC0C,GAAI,6BAAtB;MACD;MACDL,OAAO;MACL;MACC,iCAAgCrC,MAAM,CAAC4C,KAAM,gBAD9C;MAEC,mBAAkBgB,KAAM,OAFzB;MAGC,qBAAoBF,UAAU,CAAC1D,MAAM,CAAC1B,KAAR,CAAe,YAJhD;IAKD;EACF,CAdD;;EAgBA+D,OAAO,IAAI,kBAAX;;EAEA,OAAOrE,SAAS,CAACiE,QAAV,CAAmBI,OAAnB,CAAP;AACD;;AAED,SAASwB,QAAT,CAAkBC,uBAAlB,EAA2C;EACzC,OAAOA,uBAAuB,CAACF,KAAxB,IAAiCE,uBAAxC;AACD;;AAED,SAASC,aAAT,CAAuBC,IAAvB,EAA6BC,IAA7B,EAAmC;EACjC,OAAQ,WAAUD,IAAK,YAAWC,IAAK,YAAvC;AACD;;AAED,OAAO,SAASC,4BAAT;;;;;;;;;AASJ,KAT0C,EAC3Cd,KAD2C,EAE3Ce,MAF2C,EAG3CC,MAH2C,EAI3CC,MAJ2C,EAK3CC,SAL2C,EAM3Cf,UAN2C,EAO3CG,UAP2C,EAQ3Ca,aAR2C,EAS1C;EACD,IAAIrB,CAAC,GAAG,SAAR;EACAA,CAAC;EACE,yBAAwBE,KAAK,CAACR,KAAM,KAArC;EACC,WAAUQ,KAAK,CAACe,MAAD,CAAS,cAAaf,KAAK,CAACoB,KAAM,GADlD;EAEA,YAHF;EAIAtB,CAAC,IAAIa,aAAa,CAACF,QAAQ,CAACO,MAAD,CAAT,EAAmBb,UAAU,CAACH,KAAK,CAACqB,CAAP,CAA7B,CAAlB;EACAvB,CAAC,IAAIa,aAAa,CAACF,QAAQ,CAACQ,MAAD,CAAT,EAAmBX,UAAU,CAACN,KAAK,CAAClD,CAAP,CAA7B,CAAlB;EACAgD,CAAC,IAAIa,aAAa,CAACF,QAAQ,CAACS,SAAD,CAAT,EAAsBC,aAAa,CAACnB,KAAK,CAACsB,IAAP,CAAnC,CAAlB;EACAxB,CAAC,IAAI,UAAL;;EAEA,OAAOA,CAAP;AACD;;AAED;AACA,OAAO,SAASyB,YAAT,CAAsBC,YAAtB,EAAoC;EACzC,MAAMC,OAAO,GAAGC,QAAQ,CAACC,gBAAT,CAA0B,YAA1B,CAAhB;EACA,IAAIF,OAAO,CAACpF,MAAR,GAAiB,CAArB,EAAwB;IACtB;IACA;IACAoF,OAAO,CAACpC,OAAR,CAAgB,CAAAuC,CAAC,KAAI;MACnB,IAAIJ,YAAJ,EAAkB;QAChBI,CAAC,CAAC5E,MAAF;MACD,CAFD,MAEO;QACL;QACA4E,CAAC,CAAC/B,KAAF,CAAQgC,OAAR,GAAkB,CAAlB;MACD;IACF,CAPD;EAQD;AACF;;AAED,OAAO,SAASC,wBAAT,CAAkCC,IAAlC,EAAwC;EAC7C,OAAQ,WAAUA,IAAK,EAAvB;AACD;;AAED,OAAO,SAASC,aAAT,CAAuBD,IAAvB,EAA6B;EAClC,MAAME,aAAa,GAAI,IAAGH,wBAAwB,CAACC,IAAD,CAAO,EAAzD;EACA,MAAMG,MAAM,GAAGR,QAAQ,CAACS,aAAT,CAAuBF,aAAvB,CAAf;EACA,IAAIC,MAAJ,EAAY;IACVA,MAAM,CAAClF,MAAP;EACD;AACF;;AAED,OAAO,SAASoF,WAAT,CAAqBzC,KAArB,EAA4B;EACjC,MAAM0C,YAAY;EAChB1C,KAAK,CAAC2C,uBAAN,IAAiC3C,KAAK,CAAC2C,uBAAN,EAAjC;EACI3C,KAAK,CAAC4C,gBADV;EAEI5C,KAHN;EAIA,MAAM6C,oBAAoB,GAAGH,YAAY,CAACpD,OAAb,CAAqBwD,gBAArB,EAA7B;EACAJ,YAAY,CAACpD,OAAb,CAAqBwD,gBAArB,CAAsC,CAAAtG,CAAC,KAAI;IACzC,IAAI8C,OAAO,GAAI,OAAf;IACAA,OAAO,IAAIuD,oBAAoB,CAACrG,CAAD,CAA/B;IACA8C,OAAO,IAAI,QAAX;;IAEA,OAAOA,OAAP;EACD,CAND;AAOD,C,cAbemD,W;;AAehB,OAAO,SAASM,UAAT,CAAoBC,KAApB,EAA2B;EAChC,OAAOhI,KAAK;EACT0C,IADI,CACC,OADD,EACW,UAASsF,KAAK,CAACC,kBAAN,IAA4B,EAAG,EADnD;EAEJC,SAFI,CAEM,GAFN;EAGJC,MAHI,CAGG,CAAC,CAAC,CAAF,EAAK,CAAL,CAHH;EAIJC,IAJI,CAIC,CAAA5G,CAAC,KAAI;IACT,IAAI,CAACA,CAAL,EAAQ;MACN,OAAO,EAAP;IACD;IACD,MAAM6G,KAAK;IACT7G,CAAC,CAACwG,KAAK,CAACM,WAAP,CAAD,IAAwB9G,CAAC,CAACwG,KAAK,CAACM,WAAP,CAAD,CAAqB5G,MAArB,GAA8B,CAAtD;IACK,GAAEF,CAAC,CAACwG,KAAK,CAACM,WAAP,CAAoB,MAAKN,KAAK,CAACO,IAAK,EAD5C;IAEIP,KAAK,CAACO,IAHZ;IAIA,MAAMC,IAAI,GAAGC,KAAK,CAACC,OAAN,CAAcV,KAAK,CAACW,kBAApB;IACTX,KAAK,CAACW,kBAAN,CAAyB9G,GAAzB,CAA6B,CAAA+G,CAAC,KAAIpH,CAAC,CAACoH,CAAD,CAAnC,CADS;IAETC,MAAM,CAACjH,MAAP,CAAcJ,CAAd,CAFJ;;IAIA,OAAQ,gBAAe6G,KAAM,4BAA2BG,IAAI,CAACzH,IAAL;IACtD,IADsD;IAEtD,QAFF;EAGD,CAnBI,CAAP;AAoBD;;AAED,OAAO,SAAS+H,eAAT,CAAyB3H,GAAzB,EAA8B4H,SAA9B,EAAyC;EAC9C;EACA;EACA,MAAMC,SAAS,GAAG7H,GAAG,CAACiB,SAAJ,CAAe,IAAG2G,SAAU,cAA5B,CAAlB;EACA,IAAIC,SAAS,CAACtH,MAAV,GAAmB,CAAvB,EAA0B;IACxB,MAAMuH,OAAO,GAAGD,SAAS,CAAC,CAAD,CAAT,CAAanH,GAAb,CAAiB,CAAAyB,IAAI,KAAIA,IAAI,CAAC4F,qBAAL,EAAzB,CAAhB;;IAEA,OAAOC,IAAI,CAACC,IAAL,CAAUD,IAAI,CAACE,GAAL,CAAS,CAAT,EAAY,GAAGJ,OAAf,CAAV,CAAP;EACD;;EAED,OAAO,CAAP;AACD;;AAED,OAAO,SAASK,WAAT,CAAqBC,KAArB,EAA4BC,UAA5B,EAA6C,KAAjBA,UAAiB,cAAjBA,UAAiB,GAAJ,EAAI;EAClD;EACA;EACA,MAAMC,aAAa,GAAG,CAAAtE,CAAC,KAAIqE,UAAU,CAACrE,CAAD,CAAV,IAAiBA,CAA5C;;EAEA,OAAOsD,KAAK,CAACC,OAAN,CAAca,KAAd,KAAwBA,KAAK,CAAC7H,MAAN,GAAe,CAAvC;EACH6H,KAAK;EACF1H,GADH,CACO,CAAA6H,CAAC,KAAKtJ,kBAAkB,CAACU,IAAnB,CAAwB4I,CAAxB,IAA6BA,CAA7B,GAAiCD,aAAa,CAACC,CAAD,CAD3D;EAEG3I,IAFH,CAEQ,IAFR,CADG;EAIH0I,aAAa,CAACF,KAAD,CAJjB;AAKD;;AAED,MAAMI,aAAa,GAAG,EAAtB;;AAEA,OAAO,SAASC,oBAAT,CAA8BxI,IAA9B,EAAoCC,OAApC,EAA6CwI,QAA7C,EAAuD;EAC5D,MAAMC,QAAQ,GAAGzI,OAAO;EACpBtB,EAAE,CAACsJ,GAAH,CAAOjI,IAAP,EAAa,CAAAI,CAAC,KAAIA,CAAC,CAACI,MAAF,CAASF,MAA3B,CADoB;EAEpB3B,EAAE,CAACmC,GAAH,CAAOd,IAAP,EAAa,CAAAI,CAAC,KAAIA,CAAC,CAACI,MAAF,CAASF,MAA3B,CAFJ;;EAIA,MAAMqI,QAAQ,GAAGD,QAAQ,GAAGH,aAA5B;;EAEA,OAAOR,IAAI,CAACE,GAAL,CAASU,QAAT,EAAmBF,QAAnB,CAAP;AACD;;AAED,OAAO,SAASG,SAAT,CAAmB7E,CAAnB,EAAsB;EAC3B;EACA,MAAM8E,CAAC,GAAGC,MAAM,CAAC/E,CAAD,CAAhB;;EAEA,OAAO+E,MAAM,CAACC,KAAP,CAAaF,CAAb,IAAkB9E,CAAlB,GAAsB8E,CAA7B;AACD;;AAED,OAAO,SAASG,kBAAT,CAA4BC,MAA5B,EAAoC;EACzC,IAAIA,MAAM,CAACC,IAAP,CAAY,CAAA9I,CAAC,KAAIA,CAAC,CAAC+I,WAAF,KAAkBC,SAAnC,CAAJ,EAAmD;IACjD,OAAO,IAAP;EACD;;EAED,OAAOH,MAAM,CAACxI,GAAP,CAAW,CAAAL,CAAC,KAAIA,CAAC,CAAC+I,WAAF,GAAgBtG,KAAhB,CAAsB,CAAtB,EAAyB,CAAC,CAA1B,CAAhB,EAA8ClD,IAA9C,CAAmD,KAAnD,CAAP;AACD;;AAED,OAAO,SAAS0J,iBAAT,CAA2BC,IAA3B,EAAiCC,UAAjC,EAA6C;EAClD,IAAID,IAAI,IAAIA,IAAI,CAACE,UAAb,IAA2BD,UAAU,KAAKH,SAA9C,EAAyD;IACvDE,IAAI,CAACE,UAAL,CAAgBD,UAAhB;EACD;AACF;;AAED,OAAO,SAASE,cAAT,CAAwBzJ,IAAxB,EAA8B;EACnC,IAAIqH,KAAK,CAACC,OAAN,CAActH,IAAd,KAAuBA,IAAI,CAACM,MAAL,GAAc,CAArC,IAA0C+G,KAAK,CAACC,OAAN,CAActH,IAAI,CAAC,CAAD,CAAJ,CAAQQ,MAAtB,CAA9C,EAA6E;IAC3E,MAAMkJ,OAAO,GAAG1J,IAAI;IACjBR,MADa,CACN,CAAAY,CAAC,KAAI,CAACA,CAAC,CAACC,QADF;IAEbI,GAFa,CAET,CAAAkJ,GAAG,KAAIhL,EAAE,CAACsK,MAAH,CAAUU,GAAG,CAACnJ,MAAd,EAAsB,CAAAoJ,CAAC,KAAIA,CAAC,CAAC7I,CAA7B,CAFE,CAAhB;IAGA,MAAM8I,QAAQ,GAAGlL,EAAE,CAACmL,GAAH,CAAOJ,OAAP,EAAgB,gBAAC,CAACI,GAAD,CAAD,gBAAWA,GAAX,EAAhB,CAAjB;IACA,MAAMC,QAAQ,GAAGpL,EAAE,CAACsJ,GAAH,CAAOyB,OAAP,EAAgB,gBAAC,GAAGzB,GAAH,CAAD,gBAAaA,GAAb,EAAhB,CAAjB;;IAEA,OAAO,CAAC4B,QAAD,EAAWE,QAAX,CAAP;EACD;;EAED,OAAO,CAAC,CAAD,EAAI,CAAJ,CAAP;AACD;;AAED,OAAO,SAASC,qBAAT,CAA+BhK,IAA/B,EAAqC;EAC1C,IAAIqH,KAAK,CAACC,OAAN,CAActH,IAAd,KAAuBA,IAAI,CAACM,MAAL,GAAc,CAArC,IAA0C+G,KAAK,CAACC,OAAN,CAActH,IAAI,CAAC,CAAD,CAAJ,CAAQQ,MAAtB,CAA9C,EAA6E;IAC3E,MAAMK,MAAM,GAAGb,IAAI;IAChBR,MADY,CACL,CAAAY,CAAC,KAAI,CAACA,CAAC,CAACC,QADH;IAEZI,GAFY,CAER,CAAAL,CAAC,KAAIA,CAAC,CAACI,MAAF,CAASC,GAAT,CAAa,CAAAmJ,CAAC,KAAIA,CAAC,CAAC7I,CAApB,CAFG,CAAf;IAGA,MAAMkJ,aAAa,GAAGpJ,MAAM,CAAC,CAAD,CAAN,CAAUJ,GAAV,CAAc,CAACyJ,CAAD,EAAI3I,CAAJ;IAClCV,MAAM,CAACsJ,MAAP,CAAc,CAACC,GAAD,EAAMC,GAAN,KAAcD,GAAG,GAAGC,GAAG,CAAC9I,CAAD,CAArC,EAA0C,CAA1C,CADoB,CAAtB;;;IAIA,OAAO,CAACwG,IAAI,CAAC+B,GAAL,CAAS,CAAT,EAAY,GAAGG,aAAf,CAAD,EAAgClC,IAAI,CAACE,GAAL,CAAS,CAAT,EAAY,GAAGgC,aAAf,CAAhC,CAAP;EACD;;EAED,OAAO,CAAC,CAAD,EAAI,CAAJ,CAAP;AACD,C,iLA3aKjL,kB,kKAEAC,c,8JAEUC,e,+JAeAU,wB,wKAMAE,a,6JAoDP4C,e,+JAUOK,8B,8KAiCAW,6B,6KA6BAC,+B,+KAyCAQ,+B,+KAwBAK,wB,wKA8BPE,Q,wJAIAE,a,6JAIOG,4B,4KAwBAS,Y,4JAgBAO,wB,wKAIAE,a,6JAQAI,W,2JAeAM,U,0JAuBAe,e,+JAaAQ,W,2JAYVK,a,6JAEUC,oB,oKAUAI,S,yJAOAI,kB,kKAQAK,iB,iKAMAI,c,8JAcAO,qB"},"metadata":{},"sourceType":"module"}