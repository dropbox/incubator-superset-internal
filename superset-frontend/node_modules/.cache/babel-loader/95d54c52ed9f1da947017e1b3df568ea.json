{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useSelector } from 'react-redux';\nimport { FeatureFlag } from '@superset-ui/core';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport { useCallback, useEffect, useState } from 'react';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { useFilters, useNativeFiltersDataMask } from '../nativeFilters/FilterBar/state';\n// eslint-disable-next-line import/prefer-default-export\nexport const useNativeFilters = () => {\n  const [isInitialized, setIsInitialized] = useState(false);\n  const canEdit = useSelector((_ref) => {let { dashboardInfo } = _ref;return dashboardInfo.dash_edit_perm;});\n  const filters = useFilters();\n  const filterValues = Object.values(filters);\n  const expandFilters = getUrlParam(URL_PARAMS.expandFilters);\n  const [dashboardFiltersOpen, setDashboardFiltersOpen] = useState(expandFilters != null ? expandFilters : !!filterValues.length);\n  const nativeFiltersEnabled = isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS) && (\n  canEdit || !canEdit && filterValues.length !== 0);\n  const requiredFirstFilter = filterValues.filter((filter) => filter.requiredFirst);\n  const dataMask = useNativeFiltersDataMask();\n  const showDashboard = isInitialized ||\n  !nativeFiltersEnabled ||\n  !(nativeFiltersEnabled &&\n  requiredFirstFilter.length &&\n  requiredFirstFilter.find((_ref2) => {var _dataMask$id, _dataMask$id$filterSt;let { id } = _ref2;return ((_dataMask$id = dataMask[id]) == null ? void 0 : (_dataMask$id$filterSt = _dataMask$id.filterState) == null ? void 0 : _dataMask$id$filterSt.value) === undefined;}));\n  const toggleDashboardFiltersOpen = useCallback((visible) => {\n    setDashboardFiltersOpen(visible != null ? visible : !dashboardFiltersOpen);\n  }, [dashboardFiltersOpen]);\n  useEffect(() => {\n    if (expandFilters === false ||\n    filterValues.length === 0 && nativeFiltersEnabled) {\n      toggleDashboardFiltersOpen(false);\n    } else\n    {\n      toggleDashboardFiltersOpen(true);\n    }\n  }, [filterValues.length]);\n  useEffect(() => {\n    if (showDashboard) {\n      setIsInitialized(true);\n    }\n  }, [showDashboard]);\n  return {\n    showDashboard,\n    dashboardFiltersOpen,\n    toggleDashboardFiltersOpen,\n    nativeFiltersEnabled };\n\n};__signature__(useNativeFilters, \"useState{[isInitialized, setIsInitialized](false)}\\nuseSelector{canEdit}\\nuseFilters{filters}\\nuseState{[dashboardFiltersOpen, setDashboardFiltersOpen](expandFilters ?? !!filterValues.length)}\\nuseNativeFiltersDataMask{dataMask}\\nuseCallback{toggleDashboardFiltersOpen}\\nuseEffect{}\\nuseEffect{}\", () => [useSelector, useFilters, useNativeFiltersDataMask]);;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(useNativeFilters, \"useNativeFilters\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/state.ts\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"mappings":"wSAAA;;;;;;;;;;;;;;;;;;AAkBA,SAASA,WAAT,QAA4B,aAA5B;AACA,SAASC,WAAT,QAA4B,mBAA5B;AACA,SAASC,gBAAT,QAAiC,kBAAjC;AACA,SAASC,WAAT,EAAsBC,SAAtB,EAAiCC,QAAjC,QAAiD,OAAjD;AACA,SAASC,UAAT,QAA2B,eAA3B;AACA,SAASC,WAAT,QAA4B,oBAA5B;AAEA,SACEC,UADF,EAEEC,wBAFF,QAGO,kCAHP;AAKA;AACA,OAAO,MAAMC,gBAAgB,GAAG,MAAK;EACnC,MAAM,CAACC,aAAD,EAAgBC,gBAAhB,IAAoCP,QAAQ,CAAC,KAAD,CAAlD;EACA,MAAMQ,OAAO,GAAGb,WAAW,CACzB,eAAC,EAAEc,aAAF,EAAD,eAAuBA,aAAa,CAACC,cAArC,EADyB,CAA3B;EAIA,MAAMC,OAAO,GAAGR,UAAU,EAA1B;EACA,MAAMS,YAAY,GAAGC,MAAM,CAACC,MAAP,CAAcH,OAAd,CAArB;EACA,MAAMI,aAAa,GAAGb,WAAW,CAACD,UAAU,CAACc,aAAZ,CAAjC;EACA,MAAM,CAACC,oBAAD,EAAuBC,uBAAvB,IAAkDjB,QAAQ,CAC9De,aAD8D,WAC9DA,aAD8D,GAC7C,CAAC,CAACH,YAAY,CAACM,MAD8B,CAAhE;EAIA,MAAMC,oBAAoB,GACxBtB,gBAAgB,CAACD,WAAW,CAACwB,wBAAb,CAAhB;EACCZ,OAAO,IAAK,CAACA,OAAD,IAAYI,YAAY,CAACM,MAAb,KAAwB,CADjD,CADF;EAIA,MAAMG,mBAAmB,GAAGT,YAAY,CAACU,MAAb,CAC1B,OAAM,KAAIA,MAAM,CAACC,aADS,CAA5B;EAGA,MAAMC,QAAQ,GAAGpB,wBAAwB,EAAzC;EACA,MAAMqB,aAAa,GACjBnB,aAAa;EACb,CAACa,oBADD;EAEA,EACEA,oBAAoB;EACpBE,mBAAmB,CAACH,MADpB;EAEAG,mBAAmB,CAACK,IAApB,CACE,wDAAC,EAAEC,EAAF,EAAD,gBAAY,yBAAQ,CAACA,EAAD,CAAR,2DAAcC,WAAd,2CAA2BC,KAA3B,MAAqCC,SAAjD,EADF,CAHF,CAHF;EAWA,MAAMC,0BAA0B,GAAGjC,WAAW,CAC5C,CAACkC,OAAD,KAAsB;IACpBf,uBAAuB,CAACe,OAAD,WAACA,OAAD,GAAY,CAAChB,oBAAb,CAAvB;EACD,CAH2C,EAI5C,CAACA,oBAAD,CAJ4C,CAA9C;EAOAjB,SAAS,CAAC,MAAK;IACb,IACEgB,aAAa,KAAK,KAAlB;IACCH,YAAY,CAACM,MAAb,KAAwB,CAAxB,IAA6BC,oBAFhC,EAGE;MACAY,0BAA0B,CAAC,KAAD,CAA1B;IACD,CALD;IAKO;MACLA,0BAA0B,CAAC,IAAD,CAA1B;IACD;EACF,CATQ,EASN,CAACnB,YAAY,CAACM,MAAd,CATM,CAAT;EAWAnB,SAAS,CAAC,MAAK;IACb,IAAI0B,aAAJ,EAAmB;MACjBlB,gBAAgB,CAAC,IAAD,CAAhB;IACD;EACF,CAJQ,EAIN,CAACkB,aAAD,CAJM,CAAT;EAMA,OAAO;IACLA,aADK;IAELT,oBAFK;IAGLe,0BAHK;IAILZ,oBAJK,EAAP;;AAMD,CA9DM,C,cAAMd,gB,oTAEKV,W,EAIAQ,U,EAcCC,wB,oLApBNC,gB","names":["useSelector","FeatureFlag","isFeatureEnabled","useCallback","useEffect","useState","URL_PARAMS","getUrlParam","useFilters","useNativeFiltersDataMask","useNativeFilters","isInitialized","setIsInitialized","canEdit","dashboardInfo","dash_edit_perm","filters","filterValues","Object","values","expandFilters","dashboardFiltersOpen","setDashboardFiltersOpen","length","nativeFiltersEnabled","DASHBOARD_NATIVE_FILTERS","requiredFirstFilter","filter","requiredFirst","dataMask","showDashboard","find","id","filterState","value","undefined","toggleDashboardFiltersOpen","visible"],"sourceRoot":"","sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/dashboard/components/DashboardBuilder/state.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useSelector } from 'react-redux';\nimport { FeatureFlag } from '@superset-ui/core';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport { useCallback, useEffect, useState } from 'react';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { RootState } from 'src/dashboard/types';\nimport {\n  useFilters,\n  useNativeFiltersDataMask,\n} from '../nativeFilters/FilterBar/state';\n\n// eslint-disable-next-line import/prefer-default-export\nexport const useNativeFilters = () => {\n  const [isInitialized, setIsInitialized] = useState(false);\n  const canEdit = useSelector<RootState, boolean>(\n    ({ dashboardInfo }) => dashboardInfo.dash_edit_perm,\n  );\n\n  const filters = useFilters();\n  const filterValues = Object.values(filters);\n  const expandFilters = getUrlParam(URL_PARAMS.expandFilters);\n  const [dashboardFiltersOpen, setDashboardFiltersOpen] = useState(\n    expandFilters ?? !!filterValues.length,\n  );\n\n  const nativeFiltersEnabled =\n    isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS) &&\n    (canEdit || (!canEdit && filterValues.length !== 0));\n\n  const requiredFirstFilter = filterValues.filter(\n    filter => filter.requiredFirst,\n  );\n  const dataMask = useNativeFiltersDataMask();\n  const showDashboard =\n    isInitialized ||\n    !nativeFiltersEnabled ||\n    !(\n      nativeFiltersEnabled &&\n      requiredFirstFilter.length &&\n      requiredFirstFilter.find(\n        ({ id }) => dataMask[id]?.filterState?.value === undefined,\n      )\n    );\n\n  const toggleDashboardFiltersOpen = useCallback(\n    (visible?: boolean) => {\n      setDashboardFiltersOpen(visible ?? !dashboardFiltersOpen);\n    },\n    [dashboardFiltersOpen],\n  );\n\n  useEffect(() => {\n    if (\n      expandFilters === false ||\n      (filterValues.length === 0 && nativeFiltersEnabled)\n    ) {\n      toggleDashboardFiltersOpen(false);\n    } else {\n      toggleDashboardFiltersOpen(true);\n    }\n  }, [filterValues.length]);\n\n  useEffect(() => {\n    if (showDashboard) {\n      setIsInitialized(true);\n    }\n  }, [showDashboard]);\n\n  return {\n    showDashboard,\n    dashboardFiltersOpen,\n    toggleDashboardFiltersOpen,\n    nativeFiltersEnabled,\n  };\n};\n"]},"metadata":{},"sourceType":"module"}