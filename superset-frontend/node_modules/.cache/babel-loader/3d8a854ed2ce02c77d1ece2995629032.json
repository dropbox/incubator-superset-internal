{"ast":null,"code":"function _EMOTION_STRINGIFIED_CSS_ERROR__() {return \"You have tried to stringify object returned from `css` function. It isn't supposed to be used directly (e.g. as value of the `className` prop), but rather handed to emotion so it can handle it (e.g. as value of `css` prop).\";}import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\"; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport rison from 'rison';\nimport PropTypes from 'prop-types';\nimport { CompactPicker } from 'react-color';\nimport Button from 'src/components/Button';\nimport {\nt,\nSupersetClient,\ngetCategoricalSchemeRegistry,\ngetChartMetadataRegistry,\nvalidateNonEmpty,\nisValidExpression,\nstyled,\ngetColumnLabel,\nwithTheme } from\n'@superset-ui/core';\n\nimport SelectControl from 'src/explore/components/controls/SelectControl';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport {\nANNOTATION_SOURCE_TYPES,\nANNOTATION_TYPES,\nANNOTATION_TYPES_METADATA,\nDEFAULT_ANNOTATION_TYPE,\nrequiresQuery,\nANNOTATION_SOURCE_TYPES_METADATA } from\n'src/modules/AnnotationTypes';\nimport PopoverSection from 'src/components/PopoverSection';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { EmptyStateSmall } from 'src/components/EmptyState';\nimport { FILTER_OPTIONS_LIMIT } from 'src/explore/constants';import { jsx as ___EmotionJSX } from \"@emotion/react\";\n\nconst AUTOMATIC_COLOR = '';\n\nconst propTypes = {\n  name: PropTypes.string,\n  annotationType: PropTypes.string,\n  sourceType: PropTypes.string,\n  color: PropTypes.string,\n  opacity: PropTypes.string,\n  style: PropTypes.string,\n  width: PropTypes.number,\n  showMarkers: PropTypes.bool,\n  hideLine: PropTypes.bool,\n  value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  overrides: PropTypes.object,\n  show: PropTypes.bool,\n  showLabel: PropTypes.bool,\n  titleColumn: PropTypes.string,\n  descriptionColumns: PropTypes.arrayOf(PropTypes.string),\n  timeColumn: PropTypes.string,\n  intervalEndColumn: PropTypes.string,\n  vizType: PropTypes.string,\n\n  error: PropTypes.string,\n  colorScheme: PropTypes.string,\n\n  addAnnotationLayer: PropTypes.func,\n  removeAnnotationLayer: PropTypes.func,\n  close: PropTypes.func };\n\n\nconst defaultProps = {\n  name: '',\n  annotationType: DEFAULT_ANNOTATION_TYPE,\n  sourceType: '',\n  color: AUTOMATIC_COLOR,\n  opacity: '',\n  style: 'solid',\n  width: 1,\n  showMarkers: false,\n  hideLine: false,\n  overrides: {},\n  colorScheme: 'd3Category10',\n  show: true,\n  showLabel: false,\n  titleColumn: '',\n  descriptionColumns: [],\n  timeColumn: '',\n  intervalEndColumn: '',\n\n  addAnnotationLayer: () => {},\n  removeAnnotationLayer: () => {},\n  close: () => {} };\n\n\nconst NotFoundContentWrapper = styled.div`\n  && > div:first-child {\n    padding-left: 0;\n    padding-right: 0;\n  }\n`;\n\nconst NotFoundContent = () =>\n___EmotionJSX(NotFoundContentWrapper, null,\n___EmotionJSX(EmptyStateSmall, {\n  title: t('No annotation layers'),\n  description:\n  ___EmotionJSX(\"span\", null,\n  t('Add an annotation layer'), ' ',\n  ___EmotionJSX(\"a\", {\n    href: \"/annotationlayer/list\",\n    target: \"_blank\",\n    rel: \"noopener noreferrer\" },\n\n  t('here')), \".\"),\n\n\n\n\n  image: \"empty.svg\" }));var _ref5 = process.env.NODE_ENV === \"production\" ? { name: \"1h52dri\", styles: \"overflow:hidden;text-overflow:ellipsis;white-space:nowrap\" } : { name: \"1jn9azd-AnnotationLayer\", styles: \"overflow:hidden;text-overflow:ellipsis;white-space:nowrap;label:AnnotationLayer;\", map: \"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi9Vc2Vycy9ib2dkYW5reXJ5bGl1ay9jb2RlL29wZW5zb3VyY2Uvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2V4cGxvcmUvY29tcG9uZW50cy9jb250cm9scy9Bbm5vdGF0aW9uTGF5ZXJDb250cm9sL0Fubm90YXRpb25MYXllci5qc3giXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBcWFRIiwiZmlsZSI6Ii9Vc2Vycy9ib2dkYW5reXJ5bGl1ay9jb2RlL29wZW5zb3VyY2Uvc3VwZXJzZXQvc3VwZXJzZXQtZnJvbnRlbmQvc3JjL2V4cGxvcmUvY29tcG9uZW50cy9jb250cm9scy9Bbm5vdGF0aW9uTGF5ZXJDb250cm9sL0Fubm90YXRpb25MYXllci5qc3giLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIExpY2Vuc2VkIHRvIHRoZSBBcGFjaGUgU29mdHdhcmUgRm91bmRhdGlvbiAoQVNGKSB1bmRlciBvbmVcbiAqIG9yIG1vcmUgY29udHJpYnV0b3IgbGljZW5zZSBhZ3JlZW1lbnRzLiAgU2VlIHRoZSBOT1RJQ0UgZmlsZVxuICogZGlzdHJpYnV0ZWQgd2l0aCB0aGlzIHdvcmsgZm9yIGFkZGl0aW9uYWwgaW5mb3JtYXRpb25cbiAqIHJlZ2FyZGluZyBjb3B5cmlnaHQgb3duZXJzaGlwLiAgVGhlIEFTRiBsaWNlbnNlcyB0aGlzIGZpbGVcbiAqIHRvIHlvdSB1bmRlciB0aGUgQXBhY2hlIExpY2Vuc2UsIFZlcnNpb24gMi4wICh0aGVcbiAqIFwiTGljZW5zZVwiKTsgeW91IG1heSBub3QgdXNlIHRoaXMgZmlsZSBleGNlcHQgaW4gY29tcGxpYW5jZVxuICogd2l0aCB0aGUgTGljZW5zZS4gIFlvdSBtYXkgb2J0YWluIGEgY29weSBvZiB0aGUgTGljZW5zZSBhdFxuICpcbiAqICAgaHR0cDovL3d3dy5hcGFjaGUub3JnL2xpY2Vuc2VzL0xJQ0VOU0UtMi4wXG4gKlxuICogVW5sZXNzIHJlcXVpcmVkIGJ5IGFwcGxpY2FibGUgbGF3IG9yIGFncmVlZCB0byBpbiB3cml0aW5nLFxuICogc29mdHdhcmUgZGlzdHJpYnV0ZWQgdW5kZXIgdGhlIExpY2Vuc2UgaXMgZGlzdHJpYnV0ZWQgb24gYW5cbiAqIFwiQVMgSVNcIiBCQVNJUywgV0lUSE9VVCBXQVJSQU5USUVTIE9SIENPTkRJVElPTlMgT0YgQU5ZXG4gKiBLSU5ELCBlaXRoZXIgZXhwcmVzcyBvciBpbXBsaWVkLiAgU2VlIHRoZSBMaWNlbnNlIGZvciB0aGVcbiAqIHNwZWNpZmljIGxhbmd1YWdlIGdvdmVybmluZyBwZXJtaXNzaW9ucyBhbmQgbGltaXRhdGlvbnNcbiAqIHVuZGVyIHRoZSBMaWNlbnNlLlxuICovXG5pbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHJpc29uIGZyb20gJ3Jpc29uJztcbmltcG9ydCBQcm9wVHlwZXMgZnJvbSAncHJvcC10eXBlcyc7XG5pbXBvcnQgeyBDb21wYWN0UGlja2VyIH0gZnJvbSAncmVhY3QtY29sb3InO1xuaW1wb3J0IEJ1dHRvbiBmcm9tICdzcmMvY29tcG9uZW50cy9CdXR0b24nO1xuaW1wb3J0IHtcbiAgdCxcbiAgU3VwZXJzZXRDbGllbnQsXG4gIGdldENhdGVnb3JpY2FsU2NoZW1lUmVnaXN0cnksXG4gIGdldENoYXJ0TWV0YWRhdGFSZWdpc3RyeSxcbiAgdmFsaWRhdGVOb25FbXB0eSxcbiAgaXNWYWxpZEV4cHJlc3Npb24sXG4gIHN0eWxlZCxcbiAgZ2V0Q29sdW1uTGFiZWwsXG4gIHdpdGhUaGVtZSxcbn0gZnJvbSAnQHN1cGVyc2V0LXVpL2NvcmUnO1xuXG5pbXBvcnQgU2VsZWN0Q29udHJvbCBmcm9tICdzcmMvZXhwbG9yZS9jb21wb25lbnRzL2NvbnRyb2xzL1NlbGVjdENvbnRyb2wnO1xuaW1wb3J0IFRleHRDb250cm9sIGZyb20gJ3NyYy9leHBsb3JlL2NvbXBvbmVudHMvY29udHJvbHMvVGV4dENvbnRyb2wnO1xuaW1wb3J0IENoZWNrYm94Q29udHJvbCBmcm9tICdzcmMvZXhwbG9yZS9jb21wb25lbnRzL2NvbnRyb2xzL0NoZWNrYm94Q29udHJvbCc7XG5pbXBvcnQge1xuICBBTk5PVEFUSU9OX1NPVVJDRV9UWVBFUyxcbiAgQU5OT1RBVElPTl9UWVBFUyxcbiAgQU5OT1RBVElPTl9UWVBFU19NRVRBREFUQSxcbiAgREVGQVVMVF9BTk5PVEFUSU9OX1RZUEUsXG4gIHJlcXVpcmVzUXVlcnksXG4gIEFOTk9UQVRJT05fU09VUkNFX1RZUEVTX01FVEFEQVRBLFxufSBmcm9tICdzcmMvbW9kdWxlcy9Bbm5vdGF0aW9uVHlwZXMnO1xuaW1wb3J0IFBvcG92ZXJTZWN0aW9uIGZyb20gJ3NyYy9jb21wb25lbnRzL1BvcG92ZXJTZWN0aW9uJztcbmltcG9ydCBDb250cm9sSGVhZGVyIGZyb20gJ3NyYy9leHBsb3JlL2NvbXBvbmVudHMvQ29udHJvbEhlYWRlcic7XG5pbXBvcnQgeyBFbXB0eVN0YXRlU21hbGwgfSBmcm9tICdzcmMvY29tcG9uZW50cy9FbXB0eVN0YXRlJztcbmltcG9ydCB7IEZJTFRFUl9PUFRJT05TX0xJTUlUIH0gZnJvbSAnc3JjL2V4cGxvcmUvY29uc3RhbnRzJztcblxuY29uc3QgQVVUT01BVElDX0NPTE9SID0gJyc7XG5cbmNvbnN0IHByb3BUeXBlcyA9IHtcbiAgbmFtZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgYW5ub3RhdGlvblR5cGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIHNvdXJjZVR5cGU6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGNvbG9yOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBvcGFjaXR5OiBQcm9wVHlwZXMuc3RyaW5nLFxuICBzdHlsZTogUHJvcFR5cGVzLnN0cmluZyxcbiAgd2lkdGg6IFByb3BUeXBlcy5udW1iZXIsXG4gIHNob3dNYXJrZXJzOiBQcm9wVHlwZXMuYm9vbCxcbiAgaGlkZUxpbmU6IFByb3BUeXBlcy5ib29sLFxuICB2YWx1ZTogUHJvcFR5cGVzLm9uZU9mVHlwZShbUHJvcFR5cGVzLnN0cmluZywgUHJvcFR5cGVzLm51bWJlcl0pLFxuICBvdmVycmlkZXM6IFByb3BUeXBlcy5vYmplY3QsXG4gIHNob3c6IFByb3BUeXBlcy5ib29sLFxuICBzaG93TGFiZWw6IFByb3BUeXBlcy5ib29sLFxuICB0aXRsZUNvbHVtbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgZGVzY3JpcHRpb25Db2x1bW5zOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMuc3RyaW5nKSxcbiAgdGltZUNvbHVtbjogUHJvcFR5cGVzLnN0cmluZyxcbiAgaW50ZXJ2YWxFbmRDb2x1bW46IFByb3BUeXBlcy5zdHJpbmcsXG4gIHZpelR5cGU6IFByb3BUeXBlcy5zdHJpbmcsXG5cbiAgZXJyb3I6IFByb3BUeXBlcy5zdHJpbmcsXG4gIGNvbG9yU2NoZW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuXG4gIGFkZEFubm90YXRpb25MYXllcjogUHJvcFR5cGVzLmZ1bmMsXG4gIHJlbW92ZUFubm90YXRpb25MYXllcjogUHJvcFR5cGVzLmZ1bmMsXG4gIGNsb3NlOiBQcm9wVHlwZXMuZnVuYyxcbn07XG5cbmNvbnN0IGRlZmF1bHRQcm9wcyA9IHtcbiAgbmFtZTogJycsXG4gIGFubm90YXRpb25UeXBlOiBERUZBVUxUX0FOTk9UQVRJT05fVFlQRSxcbiAgc291cmNlVHlwZTogJycsXG4gIGNvbG9yOiBBVVRPTUFUSUNfQ09MT1IsXG4gIG9wYWNpdHk6ICcnLFxuICBzdHlsZTogJ3NvbGlkJyxcbiAgd2lkdGg6IDEsXG4gIHNob3dNYXJrZXJzOiBmYWxzZSxcbiAgaGlkZUxpbmU6IGZhbHNlLFxuICBvdmVycmlkZXM6IHt9LFxuICBjb2xvclNjaGVtZTogJ2QzQ2F0ZWdvcnkxMCcsXG4gIHNob3c6IHRydWUsXG4gIHNob3dMYWJlbDogZmFsc2UsXG4gIHRpdGxlQ29sdW1uOiAnJyxcbiAgZGVzY3JpcHRpb25Db2x1bW5zOiBbXSxcbiAgdGltZUNvbHVtbjogJycsXG4gIGludGVydmFsRW5kQ29sdW1uOiAnJyxcblxuICBhZGRBbm5vdGF0aW9uTGF5ZXI6ICgpID0+IHt9LFxuICByZW1vdmVBbm5vdGF0aW9uTGF5ZXI6ICgpID0+IHt9LFxuICBjbG9zZTogKCkgPT4ge30sXG59O1xuXG5jb25zdCBOb3RGb3VuZENvbnRlbnRXcmFwcGVyID0gc3R5bGVkLmRpdmBcbiAgJiYgPiBkaXY6Zmlyc3QtY2hpbGQge1xuICAgIHBhZGRpbmctbGVmdDogMDtcbiAgICBwYWRkaW5nLXJpZ2h0OiAwO1xuICB9XG5gO1xuXG5jb25zdCBOb3RGb3VuZENvbnRlbnQgPSAoKSA9PiAoXG4gIDxOb3RGb3VuZENvbnRlbnRXcmFwcGVyPlxuICAgIDxFbXB0eVN0YXRlU21hbGxcbiAgICAgIHRpdGxlPXt0KCdObyBhbm5vdGF0aW9uIGxheWVycycpfVxuICAgICAgZGVzY3JpcHRpb249e1xuICAgICAgICA8c3Bhbj5cbiAgICAgICAgICB7dCgnQWRkIGFuIGFubm90YXRpb24gbGF5ZXInKX17JyAnfVxuICAgICAgICAgIDxhXG4gICAgICAgICAgICBocmVmPVwiL2Fubm90YXRpb25sYXllci9saXN0XCJcbiAgICAgICAgICAgIHRhcmdldD1cIl9ibGFua1wiXG4gICAgICAgICAgICByZWw9XCJub29wZW5lciBub3JlZmVycmVyXCJcbiAgICAgICAgICA+XG4gICAgICAgICAgICB7dCgnaGVyZScpfVxuICAgICAgICAgIDwvYT5cbiAgICAgICAgICAuXG4gICAgICAgIDwvc3Bhbj5cbiAgICAgIH1cbiAgICAgIGltYWdlPVwiZW1wdHkuc3ZnXCJcbiAgICAvPlxuICA8L05vdEZvdW5kQ29udGVudFdyYXBwZXI+XG4pO1xuXG5jbGFzcyBBbm5vdGF0aW9uTGF5ZXIgZXh0ZW5kcyBSZWFjdC5QdXJlQ29tcG9uZW50IHtcbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG4gICAgY29uc3Qge1xuICAgICAgbmFtZSxcbiAgICAgIGFubm90YXRpb25UeXBlLFxuICAgICAgc291cmNlVHlwZSxcbiAgICAgIGNvbG9yLFxuICAgICAgb3BhY2l0eSxcbiAgICAgIHN0eWxlLFxuICAgICAgd2lkdGgsXG4gICAgICBzaG93TWFya2VycyxcbiAgICAgIGhpZGVMaW5lLFxuICAgICAgdmFsdWUsXG4gICAgICBvdmVycmlkZXMsXG4gICAgICBzaG93LFxuICAgICAgc2hvd0xhYmVsLFxuICAgICAgdGl0bGVDb2x1bW4sXG4gICAgICBkZXNjcmlwdGlvbkNvbHVtbnMsXG4gICAgICB0aW1lQ29sdW1uLFxuICAgICAgaW50ZXJ2YWxFbmRDb2x1bW4sXG4gICAgICB2aXpUeXBlLFxuICAgIH0gPSBwcm9wcztcblxuICAgIC8vIE9ubHkgYWxsb3cgb3ZlcnJpZGUgd2hvbGUgdGltZV9yYW5nZVxuICAgIGlmICgnc2luY2UnIGluIG92ZXJyaWRlcyB8fCAndW50aWwnIGluIG92ZXJyaWRlcykge1xuICAgICAgb3ZlcnJpZGVzLnRpbWVfcmFuZ2UgPSBudWxsO1xuICAgICAgZGVsZXRlIG92ZXJyaWRlcy5zaW5jZTtcbiAgICAgIGRlbGV0ZSBvdmVycmlkZXMudW50aWw7XG4gICAgfVxuXG4gICAgLy8gQ2hlY2sgaWYgYW5ub3RhdGlvblR5cGUgaXMgc3VwcG9ydGVkIGJ5IHRoaXMgY2hhcnRcbiAgICBjb25zdCBtZXRhZGF0YSA9IGdldENoYXJ0TWV0YWRhdGFSZWdpc3RyeSgpLmdldCh2aXpUeXBlKTtcbiAgICBjb25zdCBzdXBwb3J0ZWRBbm5vdGF0aW9uVHlwZXMgPSBtZXRhZGF0YT8uc3VwcG9ydGVkQW5ub3RhdGlvblR5cGVzIHx8IFtdO1xuICAgIGNvbnN0IHZhbGlkQW5ub3RhdGlvblR5cGUgPSBzdXBwb3J0ZWRBbm5vdGF0aW9uVHlwZXMuaW5jbHVkZXMoXG4gICAgICBhbm5vdGF0aW9uVHlwZSxcbiAgICApXG4gICAgICA/IGFubm90YXRpb25UeXBlXG4gICAgICA6IHN1cHBvcnRlZEFubm90YXRpb25UeXBlc1swXTtcblxuICAgIHRoaXMuc3RhdGUgPSB7XG4gICAgICAvLyBiYXNlXG4gICAgICBuYW1lLFxuICAgICAgYW5ub3RhdGlvblR5cGU6IHZhbGlkQW5ub3RhdGlvblR5cGUsXG4gICAgICBzb3VyY2VUeXBlLFxuICAgICAgdmFsdWUsXG4gICAgICBvdmVycmlkZXMsXG4gICAgICBzaG93LFxuICAgICAgc2hvd0xhYmVsLFxuICAgICAgLy8gc2xpY2VcbiAgICAgIHRpdGxlQ29sdW1uLFxuICAgICAgZGVzY3JpcHRpb25Db2x1bW5zLFxuICAgICAgdGltZUNvbHVtbixcbiAgICAgIGludGVydmFsRW5kQ29sdW1uLFxuICAgICAgLy8gZGlzcGxheVxuICAgICAgY29sb3I6IGNvbG9yIHx8IEFVVE9NQVRJQ19DT0xPUixcbiAgICAgIG9wYWNpdHksXG4gICAgICBzdHlsZSxcbiAgICAgIHdpZHRoLFxuICAgICAgc2hvd01hcmtlcnMsXG4gICAgICBoaWRlTGluZSxcbiAgICAgIC8vIHJlZkRhdGFcbiAgICAgIGlzTmV3OiAhbmFtZSxcbiAgICAgIGlzTG9hZGluZ09wdGlvbnM6IHRydWUsXG4gICAgICB2YWx1ZU9wdGlvbnM6IFtdLFxuICAgIH07XG4gICAgdGhpcy5zdWJtaXRBbm5vdGF0aW9uID0gdGhpcy5zdWJtaXRBbm5vdGF0aW9uLmJpbmQodGhpcyk7XG4gICAgdGhpcy5kZWxldGVBbm5vdGF0aW9uID0gdGhpcy5kZWxldGVBbm5vdGF0aW9uLmJpbmQodGhpcyk7XG4gICAgdGhpcy5hcHBseUFubm90YXRpb24gPSB0aGlzLmFwcGx5QW5ub3RhdGlvbi5iaW5kKHRoaXMpO1xuICAgIHRoaXMuZmV0Y2hPcHRpb25zID0gdGhpcy5mZXRjaE9wdGlvbnMuYmluZCh0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUFubm90YXRpb25UeXBlID0gdGhpcy5oYW5kbGVBbm5vdGF0aW9uVHlwZS5iaW5kKHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlQW5ub3RhdGlvblNvdXJjZVR5cGUgPVxuICAgICAgdGhpcy5oYW5kbGVBbm5vdGF0aW9uU291cmNlVHlwZS5iaW5kKHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlVmFsdWUgPSB0aGlzLmhhbmRsZVZhbHVlLmJpbmQodGhpcyk7XG4gICAgdGhpcy5pc1ZhbGlkRm9ybSA9IHRoaXMuaXNWYWxpZEZvcm0uYmluZCh0aGlzKTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIGNvbnN0IHsgYW5ub3RhdGlvblR5cGUsIHNvdXJjZVR5cGUsIGlzTG9hZGluZ09wdGlvbnMgfSA9IHRoaXMuc3RhdGU7XG4gICAgdGhpcy5mZXRjaE9wdGlvbnMoYW5ub3RhdGlvblR5cGUsIHNvdXJjZVR5cGUsIGlzTG9hZGluZ09wdGlvbnMpO1xuICB9XG5cbiAgY29tcG9uZW50RGlkVXBkYXRlKHByZXZQcm9wcywgcHJldlN0YXRlKSB7XG4gICAgaWYgKHByZXZTdGF0ZS5zb3VyY2VUeXBlICE9PSB0aGlzLnN0YXRlLnNvdXJjZVR5cGUpIHtcbiAgICAgIHRoaXMuZmV0Y2hPcHRpb25zKHRoaXMuc3RhdGUuYW5ub3RhdGlvblR5cGUsIHRoaXMuc3RhdGUuc291cmNlVHlwZSwgdHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgZ2V0U3VwcG9ydGVkU291cmNlVHlwZXMoYW5ub3RhdGlvblR5cGUpIHtcbiAgICAvLyBHZXQgdmlzIHR5cGVzIHRoYXQgY2FuIGJlIHNvdXJjZS5cbiAgICBjb25zdCBzb3VyY2VzID0gZ2V0Q2hhcnRNZXRhZGF0YVJlZ2lzdHJ5KClcbiAgICAgIC5lbnRyaWVzKClcbiAgICAgIC5maWx0ZXIoKHsgdmFsdWU6IGNoYXJ0TWV0YWRhdGEgfSkgPT5cbiAgICAgICAgY2hhcnRNZXRhZGF0YS5jYW5CZUFubm90YXRpb25UeXBlKGFubm90YXRpb25UeXBlKSxcbiAgICAgIClcbiAgICAgIC5tYXAoKHsga2V5LCB2YWx1ZTogY2hhcnRNZXRhZGF0YSB9KSA9PiAoe1xuICAgICAgICB2YWx1ZToga2V5LFxuICAgICAgICBsYWJlbDogY2hhcnRNZXRhZGF0YS5uYW1lLFxuICAgICAgfSkpO1xuICAgIC8vIFByZXBlbmQgbmF0aXZlIHNvdXJjZSBpZiBhcHBsaWNhYmxlXG4gICAgaWYgKEFOTk9UQVRJT05fVFlQRVNfTUVUQURBVEFbYW5ub3RhdGlvblR5cGVdPy5zdXBwb3J0TmF0aXZlU291cmNlKSB7XG4gICAgICBzb3VyY2VzLnVuc2hpZnQoQU5OT1RBVElPTl9TT1VSQ0VfVFlQRVNfTUVUQURBVEEuTkFUSVZFKTtcbiAgICB9XG4gICAgcmV0dXJuIHNvdXJjZXM7XG4gIH1cblxuICBpc1ZhbGlkRm9ybXVsYUFubm90YXRpb24oZXhwcmVzc2lvbiwgYW5ub3RhdGlvblR5cGUpIHtcbiAgICBpZiAoYW5ub3RhdGlvblR5cGUgPT09IEFOTk9UQVRJT05fVFlQRVMuRk9STVVMQSkge1xuICAgICAgcmV0dXJuIGlzVmFsaWRFeHByZXNzaW9uKGV4cHJlc3Npb24pO1xuICAgIH1cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGlzVmFsaWRGb3JtKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIG5hbWUsXG4gICAgICBhbm5vdGF0aW9uVHlwZSxcbiAgICAgIHNvdXJjZVR5cGUsXG4gICAgICB2YWx1ZSxcbiAgICAgIHRpbWVDb2x1bW4sXG4gICAgICBpbnRlcnZhbEVuZENvbHVtbixcbiAgICB9ID0gdGhpcy5zdGF0ZTtcbiAgICBjb25zdCBlcnJvcnMgPSBbXG4gICAgICB2YWxpZGF0ZU5vbkVtcHR5KG5hbWUpLFxuICAgICAgdmFsaWRhdGVOb25FbXB0eShhbm5vdGF0aW9uVHlwZSksXG4gICAgICB2YWxpZGF0ZU5vbkVtcHR5KHZhbHVlKSxcbiAgICBdO1xuICAgIGlmIChzb3VyY2VUeXBlICE9PSBBTk5PVEFUSU9OX1NPVVJDRV9UWVBFUy5OQVRJVkUpIHtcbiAgICAgIGlmIChhbm5vdGF0aW9uVHlwZSA9PT0gQU5OT1RBVElPTl9UWVBFUy5FVkVOVCkge1xuICAgICAgICBlcnJvcnMucHVzaCh2YWxpZGF0ZU5vbkVtcHR5KHRpbWVDb2x1bW4pKTtcbiAgICAgIH1cbiAgICAgIGlmIChhbm5vdGF0aW9uVHlwZSA9PT0gQU5OT1RBVElPTl9UWVBFUy5JTlRFUlZBTCkge1xuICAgICAgICBlcnJvcnMucHVzaCh2YWxpZGF0ZU5vbkVtcHR5KHRpbWVDb2x1bW4pKTtcbiAgICAgICAgZXJyb3JzLnB1c2godmFsaWRhdGVOb25FbXB0eShpbnRlcnZhbEVuZENvbHVtbikpO1xuICAgICAgfVxuICAgIH1cbiAgICBlcnJvcnMucHVzaCghdGhpcy5pc1ZhbGlkRm9ybXVsYUFubm90YXRpb24odmFsdWUsIGFubm90YXRpb25UeXBlKSk7XG4gICAgcmV0dXJuICFlcnJvcnMuZmlsdGVyKHggPT4geCkubGVuZ3RoO1xuICB9XG5cbiAgaGFuZGxlQW5ub3RhdGlvblR5cGUoYW5ub3RhdGlvblR5cGUpIHtcbiAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgIGFubm90YXRpb25UeXBlLFxuICAgICAgc291cmNlVHlwZTogbnVsbCxcbiAgICAgIHZhbHVlOiBudWxsLFxuICAgIH0pO1xuICB9XG5cbiAgaGFuZGxlQW5ub3RhdGlvblNvdXJjZVR5cGUoc291cmNlVHlwZSkge1xuICAgIGNvbnN0IHsgc291cmNlVHlwZTogcHJldlNvdXJjZVR5cGUgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBpZiAocHJldlNvdXJjZVR5cGUgIT09IHNvdXJjZVR5cGUpIHtcbiAgICAgIHRoaXMuc2V0U3RhdGUoeyBzb3VyY2VUeXBlLCB2YWx1ZTogbnVsbCwgaXNMb2FkaW5nT3B0aW9uczogdHJ1ZSB9KTtcbiAgICB9XG4gIH1cblxuICBoYW5kbGVWYWx1ZSh2YWx1ZSkge1xuICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgdmFsdWUsXG4gICAgICBkZXNjcmlwdGlvbkNvbHVtbnM6IFtdLFxuICAgICAgaW50ZXJ2YWxFbmRDb2x1bW46IG51bGwsXG4gICAgICB0aW1lQ29sdW1uOiBudWxsLFxuICAgICAgdGl0bGVDb2x1bW46IG51bGwsXG4gICAgICBvdmVycmlkZXM6IHsgdGltZV9yYW5nZTogbnVsbCB9LFxuICAgIH0pO1xuICB9XG5cbiAgZmV0Y2hPcHRpb25zKGFubm90YXRpb25UeXBlLCBzb3VyY2VUeXBlLCBpc0xvYWRpbmdPcHRpb25zKSB7XG4gICAgaWYgKGlzTG9hZGluZ09wdGlvbnMpIHtcbiAgICAgIGlmIChzb3VyY2VUeXBlID09PSBBTk5PVEFUSU9OX1NPVVJDRV9UWVBFUy5OQVRJVkUpIHtcbiAgICAgICAgY29uc3QgcXVlcnlQYXJhbXMgPSByaXNvbi5lbmNvZGUoe1xuICAgICAgICAgIHBhZ2U6IDAsXG4gICAgICAgICAgcGFnZV9zaXplOiBGSUxURVJfT1BUSU9OU19MSU1JVCxcbiAgICAgICAgfSk7XG4gICAgICAgIFN1cGVyc2V0Q2xpZW50LmdldCh7XG4gICAgICAgICAgZW5kcG9pbnQ6IGAvYXBpL3YxL2Fubm90YXRpb25fbGF5ZXIvP3E9JHtxdWVyeVBhcmFtc31gLFxuICAgICAgICB9KS50aGVuKCh7IGpzb24gfSkgPT4ge1xuICAgICAgICAgIGNvbnN0IGxheWVycyA9IGpzb25cbiAgICAgICAgICAgID8ganNvbi5yZXN1bHQubWFwKGxheWVyID0+ICh7XG4gICAgICAgICAgICAgICAgdmFsdWU6IGxheWVyLmlkLFxuICAgICAgICAgICAgICAgIGxhYmVsOiBsYXllci5uYW1lLFxuICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgIDogW107XG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBpc0xvYWRpbmdPcHRpb25zOiBmYWxzZSxcbiAgICAgICAgICAgIHZhbHVlT3B0aW9uczogbGF5ZXJzLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAocmVxdWlyZXNRdWVyeShzb3VyY2VUeXBlKSkge1xuICAgICAgICBjb25zdCBxdWVyeVBhcmFtcyA9IHJpc29uLmVuY29kZSh7XG4gICAgICAgICAgZmlsdGVyczogW1xuICAgICAgICAgICAge1xuICAgICAgICAgICAgICBjb2w6ICdpZCcsXG4gICAgICAgICAgICAgIG9wcjogJ2NoYXJ0X293bmVkX2NyZWF0ZWRfZmF2b3JlZF9ieV9tZScsXG4gICAgICAgICAgICAgIHZhbHVlOiB0cnVlLFxuICAgICAgICAgICAgfSxcbiAgICAgICAgICBdLFxuICAgICAgICAgIG9yZGVyX2NvbHVtbjogJ3NsaWNlX25hbWUnLFxuICAgICAgICAgIG9yZGVyX2RpcmVjdGlvbjogJ2FzYycsXG4gICAgICAgICAgcGFnZTogMCxcbiAgICAgICAgICBwYWdlX3NpemU6IEZJTFRFUl9PUFRJT05TX0xJTUlULFxuICAgICAgICB9KTtcbiAgICAgICAgU3VwZXJzZXRDbGllbnQuZ2V0KHtcbiAgICAgICAgICBlbmRwb2ludDogYC9hcGkvdjEvY2hhcnQvP3E9JHtxdWVyeVBhcmFtc31gLFxuICAgICAgICB9KS50aGVuKCh7IGpzb24gfSkgPT4ge1xuICAgICAgICAgIGNvbnN0IHJlZ2lzdHJ5ID0gZ2V0Q2hhcnRNZXRhZGF0YVJlZ2lzdHJ5KCk7XG4gICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICBpc0xvYWRpbmdPcHRpb25zOiBmYWxzZSxcbiAgICAgICAgICAgIHZhbHVlT3B0aW9uczoganNvbi5yZXN1bHRcbiAgICAgICAgICAgICAgLmZpbHRlcih4ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCBtZXRhZGF0YSA9IHJlZ2lzdHJ5LmdldCh4LnZpel90eXBlKTtcbiAgICAgICAgICAgICAgICByZXR1cm4gbWV0YWRhdGEgJiYgbWV0YWRhdGEuY2FuQmVBbm5vdGF0aW9uVHlwZShhbm5vdGF0aW9uVHlwZSk7XG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAgIC5tYXAoeCA9PiAoe1xuICAgICAgICAgICAgICAgIHZhbHVlOiB4LmlkLFxuICAgICAgICAgICAgICAgIGxhYmVsOiB4LnNsaWNlX25hbWUsXG4gICAgICAgICAgICAgICAgc2xpY2U6IHtcbiAgICAgICAgICAgICAgICAgIC4uLngsXG4gICAgICAgICAgICAgICAgICBkYXRhOiB7XG4gICAgICAgICAgICAgICAgICAgIC4uLnguZm9ybV9kYXRhLFxuICAgICAgICAgICAgICAgICAgICBncm91cGJ5OiB4LmZvcm1fZGF0YS5ncm91cGJ5Py5tYXAoY29sdW1uID0+XG4gICAgICAgICAgICAgICAgICAgICAgZ2V0Q29sdW1uTGFiZWwoY29sdW1uKSxcbiAgICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgfSkpLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2V0U3RhdGUoe1xuICAgICAgICAgIGlzTG9hZGluZ09wdGlvbnM6IGZhbHNlLFxuICAgICAgICAgIHZhbHVlT3B0aW9uczogW10sXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGRlbGV0ZUFubm90YXRpb24oKSB7XG4gICAgdGhpcy5wcm9wcy5yZW1vdmVBbm5vdGF0aW9uTGF5ZXIoKTtcbiAgICB0aGlzLnByb3BzLmNsb3NlKCk7XG4gIH1cblxuICBhcHBseUFubm90YXRpb24oKSB7XG4gICAgaWYgKHRoaXMuaXNWYWxpZEZvcm0oKSkge1xuICAgICAgY29uc3QgYW5ub3RhdGlvbkZpZWxkcyA9IFtcbiAgICAgICAgJ25hbWUnLFxuICAgICAgICAnYW5ub3RhdGlvblR5cGUnLFxuICAgICAgICAnc291cmNlVHlwZScsXG4gICAgICAgICdjb2xvcicsXG4gICAgICAgICdvcGFjaXR5JyxcbiAgICAgICAgJ3N0eWxlJyxcbiAgICAgICAgJ3dpZHRoJyxcbiAgICAgICAgJ3Nob3dNYXJrZXJzJyxcbiAgICAgICAgJ2hpZGVMaW5lJyxcbiAgICAgICAgJ3ZhbHVlJyxcbiAgICAgICAgJ292ZXJyaWRlcycsXG4gICAgICAgICdzaG93JyxcbiAgICAgICAgJ3Nob3dMYWJlbCcsXG4gICAgICAgICd0aXRsZUNvbHVtbicsXG4gICAgICAgICdkZXNjcmlwdGlvbkNvbHVtbnMnLFxuICAgICAgICAndGltZUNvbHVtbicsXG4gICAgICAgICdpbnRlcnZhbEVuZENvbHVtbicsXG4gICAgICBdO1xuICAgICAgY29uc3QgbmV3QW5ub3RhdGlvbiA9IHt9O1xuICAgICAgYW5ub3RhdGlvbkZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcbiAgICAgICAgaWYgKHRoaXMuc3RhdGVbZmllbGRdICE9PSBudWxsKSB7XG4gICAgICAgICAgbmV3QW5ub3RhdGlvbltmaWVsZF0gPSB0aGlzLnN0YXRlW2ZpZWxkXTtcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGlmIChuZXdBbm5vdGF0aW9uLmNvbG9yID09PSBBVVRPTUFUSUNfQ09MT1IpIHtcbiAgICAgICAgbmV3QW5ub3RhdGlvbi5jb2xvciA9IG51bGw7XG4gICAgICB9XG5cbiAgICAgIHRoaXMucHJvcHMuYWRkQW5ub3RhdGlvbkxheWVyKG5ld0Fubm90YXRpb24pO1xuICAgICAgdGhpcy5zZXRTdGF0ZSh7IGlzTmV3OiBmYWxzZSB9KTtcbiAgICB9XG4gIH1cblxuICBzdWJtaXRBbm5vdGF0aW9uKCkge1xuICAgIHRoaXMuYXBwbHlBbm5vdGF0aW9uKCk7XG4gICAgdGhpcy5wcm9wcy5jbG9zZSgpO1xuICB9XG5cbiAgcmVuZGVyT3B0aW9uKG9wdGlvbikge1xuICAgIHJldHVybiAoXG4gICAgICA8c3BhblxuICAgICAgICBjc3M9e3tcbiAgICAgICAgICBvdmVyZmxvdzogJ2hpZGRlbicsXG4gICAgICAgICAgdGV4dE92ZXJmbG93OiAnZWxsaXBzaXMnLFxuICAgICAgICAgIHdoaXRlU3BhY2U6ICdub3dyYXAnLFxuICAgICAgICB9fVxuICAgICAgICB0aXRsZT17b3B0aW9uLmxhYmVsfVxuICAgICAgPlxuICAgICAgICB7b3B0aW9uLmxhYmVsfVxuICAgICAgPC9zcGFuPlxuICAgICk7XG4gIH1cblxuICByZW5kZXJWYWx1ZUNvbmZpZ3VyYXRpb24oKSB7XG4gICAgY29uc3Qge1xuICAgICAgYW5ub3RhdGlvblR5cGUsXG4gICAgICBzb3VyY2VUeXBlLFxuICAgICAgdmFsdWUsXG4gICAgICB2YWx1ZU9wdGlvbnMsXG4gICAgICBpc0xvYWRpbmdPcHRpb25zLFxuICAgIH0gPSB0aGlzLnN0YXRlO1xuICAgIGxldCBsYWJlbCA9ICcnO1xuICAgIGxldCBkZXNjcmlwdGlvbiA9ICcnO1xuICAgIGlmIChyZXF1aXJlc1F1ZXJ5KHNvdXJjZVR5cGUpKSB7XG4gICAgICBpZiAoc291cmNlVHlwZSA9PT0gQU5OT1RBVElPTl9TT1VSQ0VfVFlQRVMuTkFUSVZFKSB7XG4gICAgICAgIGxhYmVsID0gdCgnQW5ub3RhdGlvbiBsYXllcicpO1xuICAgICAgICBkZXNjcmlwdGlvbiA9IHQoJ1NlbGVjdCB0aGUgQW5ub3RhdGlvbiBMYXllciB5b3Ugd291bGQgbGlrZSB0byB1c2UuJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBsYWJlbCA9IHQoJ0NoYXJ0Jyk7XG4gICAgICAgIGRlc2NyaXB0aW9uID0gdChcbiAgICAgICAgICBgVXNlIGFub3RoZXIgZXhpc3RpbmcgY2hhcnQgYXMgYSBzb3VyY2UgZm9yIGFubm90YXRpb25zIGFuZCBvdmVybGF5cy5cbiAgICAgICAgICBZb3VyIGNoYXJ0IG11c3QgYmUgb25lIG9mIHRoZXNlIHZpc3VhbGl6YXRpb24gdHlwZXM6IFslc11gLFxuICAgICAgICAgIHRoaXMuZ2V0U3VwcG9ydGVkU291cmNlVHlwZXMoYW5ub3RhdGlvblR5cGUpXG4gICAgICAgICAgICAubWFwKHggPT4geC5sYWJlbClcbiAgICAgICAgICAgIC5qb2luKCcsICcpLFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoYW5ub3RhdGlvblR5cGUgPT09IEFOTk9UQVRJT05fVFlQRVMuRk9STVVMQSkge1xuICAgICAgbGFiZWwgPSB0KCdGb3JtdWxhJyk7XG4gICAgICBkZXNjcmlwdGlvbiA9IHQoYEV4cGVjdHMgYSBmb3JtdWxhIHdpdGggZGVwZW5kaW5nIHRpbWUgcGFyYW1ldGVyICd4J1xuICAgICAgICBpbiBtaWxsaXNlY29uZHMgc2luY2UgZXBvY2guIG1hdGhqcyBpcyB1c2VkIHRvIGV2YWx1YXRlIHRoZSBmb3JtdWxhcy5cbiAgICAgICAgRXhhbXBsZTogJzJ4KzUnYCk7XG4gICAgfVxuICAgIGlmIChyZXF1aXJlc1F1ZXJ5KHNvdXJjZVR5cGUpKSB7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8U2VsZWN0Q29udHJvbFxuICAgICAgICAgIGFyaWFMYWJlbD17dCgnQW5ub3RhdGlvbiBsYXllciB2YWx1ZScpfVxuICAgICAgICAgIG5hbWU9XCJhbm5vdGF0aW9uLWxheWVyLXZhbHVlXCJcbiAgICAgICAgICBzaG93SGVhZGVyXG4gICAgICAgICAgaG92ZXJlZFxuICAgICAgICAgIGRlc2NyaXB0aW9uPXtkZXNjcmlwdGlvbn1cbiAgICAgICAgICBsYWJlbD17bGFiZWx9XG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJcIlxuICAgICAgICAgIG9wdGlvbnM9e3ZhbHVlT3B0aW9uc31cbiAgICAgICAgICBpc0xvYWRpbmc9e2lzTG9hZGluZ09wdGlvbnN9XG4gICAgICAgICAgdmFsdWU9e3ZhbHVlfVxuICAgICAgICAgIG9uQ2hhbmdlPXt0aGlzLmhhbmRsZVZhbHVlfVxuICAgICAgICAgIHZhbGlkYXRpb25FcnJvcnM9eyF2YWx1ZSA/IFsnTWFuZGF0b3J5J10gOiBbXX1cbiAgICAgICAgICBvcHRpb25SZW5kZXJlcj17dGhpcy5yZW5kZXJPcHRpb259XG4gICAgICAgICAgbm90Rm91bmRDb250ZW50PXs8Tm90Rm91bmRDb250ZW50IC8+fVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG4gICAgaWYgKGFubm90YXRpb25UeXBlID09PSBBTk5PVEFUSU9OX1RZUEVTLkZPUk1VTEEpIHtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxUZXh0Q29udHJvbFxuICAgICAgICAgIG5hbWU9XCJhbm5vdGF0aW9uLWxheWVyLXZhbHVlXCJcbiAgICAgICAgICBob3ZlcmVkXG4gICAgICAgICAgc2hvd0hlYWRlclxuICAgICAgICAgIGRlc2NyaXB0aW9uPXtkZXNjcmlwdGlvbn1cbiAgICAgICAgICBsYWJlbD17bGFiZWx9XG4gICAgICAgICAgcGxhY2Vob2xkZXI9XCJcIlxuICAgICAgICAgIHZhbHVlPXt2YWx1ZX1cbiAgICAgICAgICBvbkNoYW5nZT17dGhpcy5oYW5kbGVWYWx1ZX1cbiAgICAgICAgICB2YWxpZGF0aW9uRXJyb3JzPXtcbiAgICAgICAgICAgICF0aGlzLmlzVmFsaWRGb3JtdWxhQW5ub3RhdGlvbih2YWx1ZSwgYW5ub3RhdGlvblR5cGUpXG4gICAgICAgICAgICAgID8gW3QoJ0JhZCBmb3JtdWxhLicpXVxuICAgICAgICAgICAgICA6IFtdXG4gICAgICAgICAgfVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuICcnO1xuICB9XG5cbiAgcmVuZGVyU2xpY2VDb25maWd1cmF0aW9uKCkge1xuICAgIGNvbnN0IHtcbiAgICAgIGFubm90YXRpb25UeXBlLFxuICAgICAgc291cmNlVHlwZSxcbiAgICAgIHZhbHVlLFxuICAgICAgdmFsdWVPcHRpb25zLFxuICAgICAgb3ZlcnJpZGVzLFxuICAgICAgdGl0bGVDb2x1bW4sXG4gICAgICB0aW1lQ29sdW1uLFxuICAgICAgaW50ZXJ2YWxFbmRDb2x1bW4sXG4gICAgICBkZXNjcmlwdGlvbkNvbHVtbnMsXG4gICAgfSA9IHRoaXMuc3RhdGU7XG4gICAgY29uc3QgeyBzbGljZSB9ID0gdmFsdWVPcHRpb25zLmZpbmQoeCA9PiB4LnZhbHVlID09PSB2YWx1ZSkgfHwge307XG4gICAgaWYgKHNvdXJjZVR5cGUgIT09IEFOTk9UQVRJT05fU09VUkNFX1RZUEVTLk5BVElWRSAmJiBzbGljZSkge1xuICAgICAgY29uc3QgY29sdW1ucyA9IChzbGljZS5kYXRhLmdyb3VwYnkgfHwgW10pXG4gICAgICAgIC5jb25jYXQoc2xpY2UuZGF0YS5hbGxfY29sdW1ucyB8fCBbXSlcbiAgICAgICAgLm1hcCh4ID0+ICh7IHZhbHVlOiB4LCBsYWJlbDogeCB9KSk7XG4gICAgICBjb25zdCB0aW1lQ29sdW1uT3B0aW9ucyA9IHNsaWNlLmRhdGEuaW5jbHVkZV90aW1lXG4gICAgICAgID8gW3sgdmFsdWU6ICdfX3RpbWVzdGFtcCcsIGxhYmVsOiAnX190aW1lc3RhbXAnIH1dLmNvbmNhdChjb2x1bW5zKVxuICAgICAgICA6IGNvbHVtbnM7XG4gICAgICByZXR1cm4gKFxuICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblJpZ2h0OiAnMnJlbScgfX0+XG4gICAgICAgICAgPFBvcG92ZXJTZWN0aW9uXG4gICAgICAgICAgICBpc1NlbGVjdGVkXG4gICAgICAgICAgICB0aXRsZT17dCgnQW5ub3RhdGlvbiBTbGljZSBDb25maWd1cmF0aW9uJyl9XG4gICAgICAgICAgICBpbmZvPXt0KGBUaGlzIHNlY3Rpb24gYWxsb3dzIHlvdSB0byBjb25maWd1cmUgaG93IHRvIHVzZSB0aGUgc2xpY2VcbiAgICAgICAgICAgICAgdG8gZ2VuZXJhdGUgYW5ub3RhdGlvbnMuYCl9XG4gICAgICAgICAgPlxuICAgICAgICAgICAgeyhhbm5vdGF0aW9uVHlwZSA9PT0gQU5OT1RBVElPTl9UWVBFUy5FVkVOVCB8fFxuICAgICAgICAgICAgICBhbm5vdGF0aW9uVHlwZSA9PT0gQU5OT1RBVElPTl9UWVBFUy5JTlRFUlZBTCkgJiYgKFxuICAgICAgICAgICAgICA8U2VsZWN0Q29udHJvbFxuICAgICAgICAgICAgICAgIGFyaWFMYWJlbD17dCgnQW5ub3RhdGlvbiBsYXllciB0aW1lIGNvbHVtbicpfVxuICAgICAgICAgICAgICAgIGhvdmVyZWRcbiAgICAgICAgICAgICAgICBuYW1lPVwiYW5ub3RhdGlvbi1sYXllci10aW1lLWNvbHVtblwiXG4gICAgICAgICAgICAgICAgbGFiZWw9e1xuICAgICAgICAgICAgICAgICAgYW5ub3RhdGlvblR5cGUgPT09IEFOTk9UQVRJT05fVFlQRVMuSU5URVJWQUxcbiAgICAgICAgICAgICAgICAgICAgPyB0KCdJbnRlcnZhbCBzdGFydCBjb2x1bW4nKVxuICAgICAgICAgICAgICAgICAgICA6IHQoJ0V2ZW50IHRpbWUgY29sdW1uJylcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb249e3QoXG4gICAgICAgICAgICAgICAgICAnVGhpcyBjb2x1bW4gbXVzdCBjb250YWluIGRhdGUvdGltZSBpbmZvcm1hdGlvbi4nLFxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvbkVycm9ycz17IXRpbWVDb2x1bW4gPyBbJ01hbmRhdG9yeSddIDogW119XG4gICAgICAgICAgICAgICAgY2xlYXJhYmxlPXtmYWxzZX1cbiAgICAgICAgICAgICAgICBvcHRpb25zPXt0aW1lQ29sdW1uT3B0aW9uc31cbiAgICAgICAgICAgICAgICB2YWx1ZT17dGltZUNvbHVtbn1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17diA9PiB0aGlzLnNldFN0YXRlKHsgdGltZUNvbHVtbjogdiB9KX1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICl9XG4gICAgICAgICAgICB7YW5ub3RhdGlvblR5cGUgPT09IEFOTk9UQVRJT05fVFlQRVMuSU5URVJWQUwgJiYgKFxuICAgICAgICAgICAgICA8U2VsZWN0Q29udHJvbFxuICAgICAgICAgICAgICAgIGFyaWFMYWJlbD17dCgnQW5ub3RhdGlvbiBsYXllciBpbnRlcnZhbCBlbmQnKX1cbiAgICAgICAgICAgICAgICBob3ZlcmVkXG4gICAgICAgICAgICAgICAgbmFtZT1cImFubm90YXRpb24tbGF5ZXItaW50ZXJ2YWxFbmRcIlxuICAgICAgICAgICAgICAgIGxhYmVsPXt0KCdJbnRlcnZhbCBFbmQgY29sdW1uJyl9XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb249e3QoXG4gICAgICAgICAgICAgICAgICAnVGhpcyBjb2x1bW4gbXVzdCBjb250YWluIGRhdGUvdGltZSBpbmZvcm1hdGlvbi4nLFxuICAgICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgICAgdmFsaWRhdGlvbkVycm9ycz17IWludGVydmFsRW5kQ29sdW1uID8gWydNYW5kYXRvcnknXSA6IFtdfVxuICAgICAgICAgICAgICAgIG9wdGlvbnM9e2NvbHVtbnN9XG4gICAgICAgICAgICAgICAgdmFsdWU9e2ludGVydmFsRW5kQ29sdW1ufVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt2YWx1ZSA9PiB0aGlzLnNldFN0YXRlKHsgaW50ZXJ2YWxFbmRDb2x1bW46IHZhbHVlIH0pfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICAgIDxTZWxlY3RDb250cm9sXG4gICAgICAgICAgICAgIGFyaWFMYWJlbD17dCgnQW5ub3RhdGlvbiBsYXllciB0aXRsZSBjb2x1bW4nKX1cbiAgICAgICAgICAgICAgaG92ZXJlZFxuICAgICAgICAgICAgICBuYW1lPVwiYW5ub3RhdGlvbi1sYXllci10aXRsZVwiXG4gICAgICAgICAgICAgIGxhYmVsPXt0KCdUaXRsZSBDb2x1bW4nKX1cbiAgICAgICAgICAgICAgZGVzY3JpcHRpb249e3QoJ1BpY2sgYSB0aXRsZSBmb3IgeW91IGFubm90YXRpb24uJyl9XG4gICAgICAgICAgICAgIG9wdGlvbnM9e1t7IHZhbHVlOiAnJywgbGFiZWw6IHQoJ05vbmUnKSB9XS5jb25jYXQoY29sdW1ucyl9XG4gICAgICAgICAgICAgIHZhbHVlPXt0aXRsZUNvbHVtbn1cbiAgICAgICAgICAgICAgb25DaGFuZ2U9e3ZhbHVlID0+IHRoaXMuc2V0U3RhdGUoeyB0aXRsZUNvbHVtbjogdmFsdWUgfSl9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgICAge2Fubm90YXRpb25UeXBlICE9PSBBTk5PVEFUSU9OX1RZUEVTLlRJTUVfU0VSSUVTICYmIChcbiAgICAgICAgICAgICAgPFNlbGVjdENvbnRyb2xcbiAgICAgICAgICAgICAgICBhcmlhTGFiZWw9e3QoJ0Fubm90YXRpb24gbGF5ZXIgZGVzY3JpcHRpb24gY29sdW1ucycpfVxuICAgICAgICAgICAgICAgIGhvdmVyZWRcbiAgICAgICAgICAgICAgICBuYW1lPVwiYW5ub3RhdGlvbi1sYXllci10aXRsZVwiXG4gICAgICAgICAgICAgICAgbGFiZWw9e3QoJ0Rlc2NyaXB0aW9uIENvbHVtbnMnKX1cbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj17dChcbiAgICAgICAgICAgICAgICAgIFwiUGljayBvbmUgb3IgbW9yZSBjb2x1bW5zIHRoYXQgc2hvdWxkIGJlIHNob3duIGluIHRoZSBhbm5vdGF0aW9uLiBJZiB5b3UgZG9uJ3Qgc2VsZWN0IGEgY29sdW1uIGFsbCBvZiB0aGVtIHdpbGwgYmUgc2hvd24uXCIsXG4gICAgICAgICAgICAgICAgKX1cbiAgICAgICAgICAgICAgICBtdWx0aVxuICAgICAgICAgICAgICAgIG9wdGlvbnM9e2NvbHVtbnN9XG4gICAgICAgICAgICAgICAgdmFsdWU9e2Rlc2NyaXB0aW9uQ29sdW1uc31cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17dmFsdWUgPT4gdGhpcy5zZXRTdGF0ZSh7IGRlc2NyaXB0aW9uQ29sdW1uczogdmFsdWUgfSl9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICApfVxuICAgICAgICAgICAgPGRpdiBzdHlsZT17eyBtYXJnaW5Ub3A6ICcxcmVtJyB9fT5cbiAgICAgICAgICAgICAgPENoZWNrYm94Q29udHJvbFxuICAgICAgICAgICAgICAgIGhvdmVyZWRcbiAgICAgICAgICAgICAgICBuYW1lPVwiYW5ub3RhdGlvbi1vdmVycmlkZS10aW1lX3JhbmdlXCJcbiAgICAgICAgICAgICAgICBsYWJlbD17dCgnT3ZlcnJpZGUgdGltZSByYW5nZScpfVxuICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uPXt0KGBUaGlzIGNvbnRyb2xzIHdoZXRoZXIgdGhlIFwidGltZV9yYW5nZVwiIGZpZWxkIGZyb20gdGhlIGN1cnJlbnRcbiAgICAgICAgICAgICAgICAgIHZpZXcgc2hvdWxkIGJlIHBhc3NlZCBkb3duIHRvIHRoZSBjaGFydCBjb250YWluaW5nIHRoZSBhbm5vdGF0aW9uIGRhdGEuYCl9XG4gICAgICAgICAgICAgICAgdmFsdWU9eyd0aW1lX3JhbmdlJyBpbiBvdmVycmlkZXN9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9e3YgPT4ge1xuICAgICAgICAgICAgICAgICAgZGVsZXRlIG92ZXJyaWRlcy50aW1lX3JhbmdlO1xuICAgICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVzOiB7IC4uLm92ZXJyaWRlcywgdGltZV9yYW5nZTogbnVsbCB9LFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBvdmVycmlkZXM6IHsgLi4ub3ZlcnJpZGVzIH0gfSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPENoZWNrYm94Q29udHJvbFxuICAgICAgICAgICAgICAgIGhvdmVyZWRcbiAgICAgICAgICAgICAgICBuYW1lPVwiYW5ub3RhdGlvbi1vdmVycmlkZS10aW1lZ3JhaW5cIlxuICAgICAgICAgICAgICAgIGxhYmVsPXt0KCdPdmVycmlkZSB0aW1lIGdyYWluJyl9XG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb249e3QoYFRoaXMgY29udHJvbHMgd2hldGhlciB0aGUgdGltZSBncmFpbiBmaWVsZCBmcm9tIHRoZSBjdXJyZW50XG4gICAgICAgICAgICAgICAgICB2aWV3IHNob3VsZCBiZSBwYXNzZWQgZG93biB0byB0aGUgY2hhcnQgY29udGFpbmluZyB0aGUgYW5ub3RhdGlvbiBkYXRhLmApfVxuICAgICAgICAgICAgICAgIHZhbHVlPXsndGltZV9ncmFpbl9zcWxhJyBpbiBvdmVycmlkZXN9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9e3YgPT4ge1xuICAgICAgICAgICAgICAgICAgZGVsZXRlIG92ZXJyaWRlcy50aW1lX2dyYWluX3NxbGE7XG4gICAgICAgICAgICAgICAgICBkZWxldGUgb3ZlcnJpZGVzLmdyYW51bGFyaXR5O1xuICAgICAgICAgICAgICAgICAgaWYgKHYpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zZXRTdGF0ZSh7XG4gICAgICAgICAgICAgICAgICAgICAgb3ZlcnJpZGVzOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAuLi5vdmVycmlkZXMsXG4gICAgICAgICAgICAgICAgICAgICAgICB0aW1lX2dyYWluX3NxbGE6IG51bGwsXG4gICAgICAgICAgICAgICAgICAgICAgICBncmFudWxhcml0eTogbnVsbCxcbiAgICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2V0U3RhdGUoeyBvdmVycmlkZXM6IHsgLi4ub3ZlcnJpZGVzIH0gfSk7XG4gICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfX1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAgPFRleHRDb250cm9sXG4gICAgICAgICAgICAgICAgaG92ZXJlZFxuICAgICAgICAgICAgICAgIG5hbWU9XCJhbm5vdGF0aW9uLWxheWVyLXRpbWVzaGlmdFwiXG4gICAgICAgICAgICAgICAgbGFiZWw9e3QoJ1RpbWUgU2hpZnQnKX1cbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj17dChgVGltZSBkZWx0YSBpbiBuYXR1cmFsIGxhbmd1YWdlXG4gICAgICAgICAgICAgICAgICAoZXhhbXBsZTogIDI0IGhvdXJzLCA3IGRheXMsIDU2IHdlZWtzLCAzNjUgZGF5cylgKX1cbiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj1cIlwiXG4gICAgICAgICAgICAgICAgdmFsdWU9e292ZXJyaWRlcy50aW1lX3NoaWZ0fVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt2ID0+XG4gICAgICAgICAgICAgICAgICB0aGlzLnNldFN0YXRlKHsgb3ZlcnJpZGVzOiB7IC4uLm92ZXJyaWRlcywgdGltZV9zaGlmdDogdiB9IH0pXG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgPC9Qb3BvdmVyU2VjdGlvbj5cbiAgICAgICAgPC9kaXY+XG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gJyc7XG4gIH1cblxuICByZW5kZXJEaXNwbGF5Q29uZmlndXJhdGlvbigpIHtcbiAgICBjb25zdCB7XG4gICAgICBjb2xvcixcbiAgICAgIG9wYWNpdHksXG4gICAgICBzdHlsZSxcbiAgICAgIHdpZHRoLFxuICAgICAgc2hvd01hcmtlcnMsXG4gICAgICBoaWRlTGluZSxcbiAgICAgIGFubm90YXRpb25UeXBlLFxuICAgIH0gPSB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGNvbG9yU2NoZW1lID0gZ2V0Q2F0ZWdvcmljYWxTY2hlbWVSZWdpc3RyeSgpXG4gICAgICAuZ2V0KHRoaXMucHJvcHMuY29sb3JTY2hlbWUpXG4gICAgICAuY29sb3JzLmNvbmNhdCgpO1xuICAgIGlmIChcbiAgICAgIGNvbG9yICYmXG4gICAgICBjb2xvciAhPT0gQVVUT01BVElDX0NPTE9SICYmXG4gICAgICAhY29sb3JTY2hlbWUuZmluZCh4ID0+IHgudG9Mb3dlckNhc2UoKSA9PT0gY29sb3IudG9Mb3dlckNhc2UoKSlcbiAgICApIHtcbiAgICAgIGNvbG9yU2NoZW1lLnB1c2goY29sb3IpO1xuICAgIH1cbiAgICByZXR1cm4gKFxuICAgICAgPFBvcG92ZXJTZWN0aW9uXG4gICAgICAgIGlzU2VsZWN0ZWRcbiAgICAgICAgdGl0bGU9e3QoJ0Rpc3BsYXkgY29uZmlndXJhdGlvbicpfVxuICAgICAgICBpbmZvPXt0KCdDb25maWd1cmUgeW91ciBob3cgeW91IG92ZXJsYXkgaXMgZGlzcGxheWVkIGhlcmUuJyl9XG4gICAgICA+XG4gICAgICAgIDxTZWxlY3RDb250cm9sXG4gICAgICAgICAgYXJpYUxhYmVsPXt0KCdBbm5vdGF0aW9uIGxheWVyIHN0cm9rZScpfVxuICAgICAgICAgIG5hbWU9XCJhbm5vdGF0aW9uLWxheWVyLXN0cm9rZVwiXG4gICAgICAgICAgbGFiZWw9e3QoJ1N0eWxlJyl9XG4gICAgICAgICAgLy8gc2VlICcuLi8uLi8uLi92aXN1YWxpemF0aW9ucy9udmQzX3Zpcy5jc3MnXG4gICAgICAgICAgb3B0aW9ucz17W1xuICAgICAgICAgICAgeyB2YWx1ZTogJ3NvbGlkJywgbGFiZWw6IHQoJ1NvbGlkJykgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6ICdkYXNoZWQnLCBsYWJlbDogdCgnRGFzaGVkJykgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6ICdsb25nRGFzaGVkJywgbGFiZWw6IHQoJ0xvbmcgZGFzaGVkJykgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6ICdkb3R0ZWQnLCBsYWJlbDogdCgnRG90dGVkJykgfSxcbiAgICAgICAgICBdfVxuICAgICAgICAgIHZhbHVlPXtzdHlsZX1cbiAgICAgICAgICBjbGVhcmFibGU9e2ZhbHNlfVxuICAgICAgICAgIG9uQ2hhbmdlPXt2ID0+IHRoaXMuc2V0U3RhdGUoeyBzdHlsZTogdiB9KX1cbiAgICAgICAgLz5cbiAgICAgICAgPFNlbGVjdENvbnRyb2xcbiAgICAgICAgICBhcmlhTGFiZWw9e3QoJ0Fubm90YXRpb24gbGF5ZXIgb3BhY2l0eScpfVxuICAgICAgICAgIG5hbWU9XCJhbm5vdGF0aW9uLWxheWVyLW9wYWNpdHlcIlxuICAgICAgICAgIGxhYmVsPXt0KCdPcGFjaXR5Jyl9XG4gICAgICAgICAgLy8gc2VlICcuLi8uLi8uLi92aXN1YWxpemF0aW9ucy9udmQzX3Zpcy5jc3MnXG4gICAgICAgICAgb3B0aW9ucz17W1xuICAgICAgICAgICAgeyB2YWx1ZTogJycsIGxhYmVsOiB0KCdTb2xpZCcpIH0sXG4gICAgICAgICAgICB7IHZhbHVlOiAnb3BhY2l0eUxvdycsIGxhYmVsOiAnMC4yJyB9LFxuICAgICAgICAgICAgeyB2YWx1ZTogJ29wYWNpdHlNZWRpdW0nLCBsYWJlbDogJzAuNScgfSxcbiAgICAgICAgICAgIHsgdmFsdWU6ICdvcGFjaXR5SGlnaCcsIGxhYmVsOiAnMC44JyB9LFxuICAgICAgICAgIF19XG4gICAgICAgICAgdmFsdWU9e29wYWNpdHl9XG4gICAgICAgICAgb25DaGFuZ2U9e3ZhbHVlID0+IHRoaXMuc2V0U3RhdGUoeyBvcGFjaXR5OiB2YWx1ZSB9KX1cbiAgICAgICAgLz5cbiAgICAgICAgPGRpdj5cbiAgICAgICAgICA8Q29udHJvbEhlYWRlciBsYWJlbD17dCgnQ29sb3InKX0gLz5cbiAgICAgICAgICA8ZGl2IHN0eWxlPXt7IGRpc3BsYXk6ICdmbGV4JywgZmxleERpcmVjdGlvbjogJ2NvbHVtbicgfX0+XG4gICAgICAgICAgICA8Q29tcGFjdFBpY2tlclxuICAgICAgICAgICAgICBjb2xvcj17Y29sb3J9XG4gICAgICAgICAgICAgIGNvbG9ycz17Y29sb3JTY2hlbWV9XG4gICAgICAgICAgICAgIG9uQ2hhbmdlQ29tcGxldGU9e3YgPT4gdGhpcy5zZXRTdGF0ZSh7IGNvbG9yOiB2LmhleCB9KX1cbiAgICAgICAgICAgIC8+XG4gICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgIHN0eWxlPXt7IG1hcmdpblRvcDogJzAuNXJlbScsIG1hcmdpbkJvdHRvbTogJzAuNXJlbScgfX1cbiAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9e2NvbG9yID09PSBBVVRPTUFUSUNfQ09MT1IgPyAnc3VjY2VzcycgOiAnZGVmYXVsdCd9XG4gICAgICAgICAgICAgIGJ1dHRvblNpemU9XCJ4c21hbGxcIlxuICAgICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiB0aGlzLnNldFN0YXRlKHsgY29sb3I6IEFVVE9NQVRJQ19DT0xPUiB9KX1cbiAgICAgICAgICAgID5cbiAgICAgICAgICAgICAge3QoJ0F1dG9tYXRpYyBDb2xvcicpfVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgICA8VGV4dENvbnRyb2xcbiAgICAgICAgICBuYW1lPVwiYW5ub3RhdGlvbi1sYXllci1zdHJva2Utd2lkdGhcIlxuICAgICAgICAgIGxhYmVsPXt0KCdMaW5lIHdpZHRoJyl9XG4gICAgICAgICAgaXNJbnRcbiAgICAgICAgICB2YWx1ZT17d2lkdGh9XG4gICAgICAgICAgb25DaGFuZ2U9e3YgPT4gdGhpcy5zZXRTdGF0ZSh7IHdpZHRoOiB2IH0pfVxuICAgICAgICAvPlxuICAgICAgICB7YW5ub3RhdGlvblR5cGUgPT09IEFOTk9UQVRJT05fVFlQRVMuVElNRV9TRVJJRVMgJiYgKFxuICAgICAgICAgIDxDaGVja2JveENvbnRyb2xcbiAgICAgICAgICAgIGhvdmVyZWRcbiAgICAgICAgICAgIG5hbWU9XCJhbm5vdGF0aW9uLWxheWVyLXNob3ctbWFya2Vyc1wiXG4gICAgICAgICAgICBsYWJlbD17dCgnU2hvdyBNYXJrZXJzJyl9XG4gICAgICAgICAgICBkZXNjcmlwdGlvbj17dCgnU2hvd3Mgb3IgaGlkZXMgbWFya2VycyBmb3IgdGhlIHRpbWUgc2VyaWVzJyl9XG4gICAgICAgICAgICB2YWx1ZT17c2hvd01hcmtlcnN9XG4gICAgICAgICAgICBvbkNoYW5nZT17diA9PiB0aGlzLnNldFN0YXRlKHsgc2hvd01hcmtlcnM6IHYgfSl9XG4gICAgICAgICAgLz5cbiAgICAgICAgKX1cbiAgICAgICAge2Fubm90YXRpb25UeXBlID09PSBBTk5PVEFUSU9OX1RZUEVTLlRJTUVfU0VSSUVTICYmIChcbiAgICAgICAgICA8Q2hlY2tib3hDb250cm9sXG4gICAgICAgICAgICBob3ZlcmVkXG4gICAgICAgICAgICBuYW1lPVwiYW5ub3RhdGlvbi1sYXllci1oaWRlLWxpbmVcIlxuICAgICAgICAgICAgbGFiZWw9e3QoJ0hpZGUgTGluZScpfVxuICAgICAgICAgICAgZGVzY3JpcHRpb249e3QoJ0hpZGVzIHRoZSBMaW5lIGZvciB0aGUgdGltZSBzZXJpZXMnKX1cbiAgICAgICAgICAgIHZhbHVlPXtoaWRlTGluZX1cbiAgICAgICAgICAgIG9uQ2hhbmdlPXt2ID0+IHRoaXMuc2V0U3RhdGUoeyBoaWRlTGluZTogdiB9KX1cbiAgICAgICAgICAvPlxuICAgICAgICApfVxuICAgICAgPC9Qb3BvdmVyU2VjdGlvbj5cbiAgICApO1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHsgaXNOZXcsIG5hbWUsIGFubm90YXRpb25UeXBlLCBzb3VyY2VUeXBlLCBzaG93LCBzaG93TGFiZWwgfSA9XG4gICAgICB0aGlzLnN0YXRlO1xuICAgIGNvbnN0IGlzVmFsaWQgPSB0aGlzLmlzVmFsaWRGb3JtKCk7XG4gICAgY29uc3QgbWV0YWRhdGEgPSBnZXRDaGFydE1ldGFkYXRhUmVnaXN0cnkoKS5nZXQodGhpcy5wcm9wcy52aXpUeXBlKTtcbiAgICBjb25zdCBzdXBwb3J0ZWRBbm5vdGF0aW9uVHlwZXMgPSBtZXRhZGF0YVxuICAgICAgPyBtZXRhZGF0YS5zdXBwb3J0ZWRBbm5vdGF0aW9uVHlwZXMubWFwKFxuICAgICAgICAgIHR5cGUgPT4gQU5OT1RBVElPTl9UWVBFU19NRVRBREFUQVt0eXBlXSxcbiAgICAgICAgKVxuICAgICAgOiBbXTtcbiAgICBjb25zdCBzdXBwb3J0ZWRTb3VyY2VUeXBlcyA9IHRoaXMuZ2V0U3VwcG9ydGVkU291cmNlVHlwZXMoYW5ub3RhdGlvblR5cGUpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDw+XG4gICAgICAgIHt0aGlzLnByb3BzLmVycm9yICYmIChcbiAgICAgICAgICA8c3BhbiBzdHlsZT17eyBjb2xvcjogdGhpcy5wcm9wcy50aGVtZS5jb2xvcnMuZXJyb3IuYmFzZSB9fT5cbiAgICAgICAgICAgIEVSUk9SOiB7dGhpcy5wcm9wcy5lcnJvcn1cbiAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICl9XG4gICAgICAgIDxkaXYgc3R5bGU9e3sgZGlzcGxheTogJ2ZsZXgnLCBmbGV4RGlyZWN0aW9uOiAncm93JyB9fT5cbiAgICAgICAgICA8ZGl2IHN0eWxlPXt7IG1hcmdpblJpZ2h0OiAnMnJlbScgfX0+XG4gICAgICAgICAgICA8UG9wb3ZlclNlY3Rpb25cbiAgICAgICAgICAgICAgaXNTZWxlY3RlZFxuICAgICAgICAgICAgICB0aXRsZT17dCgnTGF5ZXIgY29uZmlndXJhdGlvbicpfVxuICAgICAgICAgICAgICBpbmZvPXt0KCdDb25maWd1cmUgdGhlIGJhc2ljcyBvZiB5b3VyIEFubm90YXRpb24gTGF5ZXIuJyl9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxUZXh0Q29udHJvbFxuICAgICAgICAgICAgICAgIG5hbWU9XCJhbm5vdGF0aW9uLWxheWVyLW5hbWVcIlxuICAgICAgICAgICAgICAgIGxhYmVsPXt0KCdOYW1lJyl9XG4gICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9XCJcIlxuICAgICAgICAgICAgICAgIHZhbHVlPXtuYW1lfVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt2ID0+IHRoaXMuc2V0U3RhdGUoeyBuYW1lOiB2IH0pfVxuICAgICAgICAgICAgICAgIHZhbGlkYXRpb25FcnJvcnM9eyFuYW1lID8gW3QoJ01hbmRhdG9yeScpXSA6IFtdfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8Q2hlY2tib3hDb250cm9sXG4gICAgICAgICAgICAgICAgbmFtZT1cImFubm90YXRpb24tbGF5ZXItaGlkZVwiXG4gICAgICAgICAgICAgICAgbGFiZWw9e3QoJ0hpZGUgbGF5ZXInKX1cbiAgICAgICAgICAgICAgICB2YWx1ZT17IXNob3d9XG4gICAgICAgICAgICAgICAgb25DaGFuZ2U9e3YgPT4gdGhpcy5zZXRTdGF0ZSh7IHNob3c6ICF2IH0pfVxuICAgICAgICAgICAgICAvPlxuICAgICAgICAgICAgICA8Q2hlY2tib3hDb250cm9sXG4gICAgICAgICAgICAgICAgbmFtZT1cImFubm90YXRpb24tbGFiZWwtc2hvd1wiXG4gICAgICAgICAgICAgICAgbGFiZWw9e3QoJ1Nob3cgbGFiZWwnKX1cbiAgICAgICAgICAgICAgICB2YWx1ZT17c2hvd0xhYmVsfVxuICAgICAgICAgICAgICAgIGhvdmVyZWRcbiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbj17dCgnV2hldGhlciB0byBhbHdheXMgc2hvdyB0aGUgYW5ub3RhdGlvbiBsYWJlbCcpfVxuICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXt2ID0+IHRoaXMuc2V0U3RhdGUoeyBzaG93TGFiZWw6IHYgfSl9XG4gICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgIDxTZWxlY3RDb250cm9sXG4gICAgICAgICAgICAgICAgYXJpYUxhYmVsPXt0KCdBbm5vdGF0aW9uIGxheWVyIHR5cGUnKX1cbiAgICAgICAgICAgICAgICBob3ZlcmVkXG4gICAgICAgICAgICAgICAgZGVzY3JpcHRpb249e3QoJ0Nob29zZSB0aGUgYW5ub3RhdGlvbiBsYXllciB0eXBlJyl9XG4gICAgICAgICAgICAgICAgbGFiZWw9e3QoJ0Fubm90YXRpb24gbGF5ZXIgdHlwZScpfVxuICAgICAgICAgICAgICAgIG5hbWU9XCJhbm5vdGF0aW9uLWxheWVyLXR5cGVcIlxuICAgICAgICAgICAgICAgIGNsZWFyYWJsZT17ZmFsc2V9XG4gICAgICAgICAgICAgICAgb3B0aW9ucz17c3VwcG9ydGVkQW5ub3RhdGlvblR5cGVzfVxuICAgICAgICAgICAgICAgIHZhbHVlPXthbm5vdGF0aW9uVHlwZX1cbiAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5oYW5kbGVBbm5vdGF0aW9uVHlwZX1cbiAgICAgICAgICAgICAgLz5cbiAgICAgICAgICAgICAge3N1cHBvcnRlZFNvdXJjZVR5cGVzLmxlbmd0aCA+IDAgJiYgKFxuICAgICAgICAgICAgICAgIDxTZWxlY3RDb250cm9sXG4gICAgICAgICAgICAgICAgICBhcmlhTGFiZWw9e3QoJ0Fubm90YXRpb24gc291cmNlIHR5cGUnKX1cbiAgICAgICAgICAgICAgICAgIGhvdmVyZWRcbiAgICAgICAgICAgICAgICAgIGRlc2NyaXB0aW9uPXt0KCdDaG9vc2UgdGhlIHNvdXJjZSBvZiB5b3VyIGFubm90YXRpb25zJyl9XG4gICAgICAgICAgICAgICAgICBsYWJlbD17dCgnQW5ub3RhdGlvbiBzb3VyY2UnKX1cbiAgICAgICAgICAgICAgICAgIG5hbWU9XCJhbm5vdGF0aW9uLXNvdXJjZS10eXBlXCJcbiAgICAgICAgICAgICAgICAgIG9wdGlvbnM9e3N1cHBvcnRlZFNvdXJjZVR5cGVzfVxuICAgICAgICAgICAgICAgICAgbm90Rm91bmRDb250ZW50PXs8Tm90Rm91bmRDb250ZW50IC8+fVxuICAgICAgICAgICAgICAgICAgdmFsdWU9e3NvdXJjZVR5cGV9XG4gICAgICAgICAgICAgICAgICBvbkNoYW5nZT17dGhpcy5oYW5kbGVBbm5vdGF0aW9uU291cmNlVHlwZX1cbiAgICAgICAgICAgICAgICAgIHZhbGlkYXRpb25FcnJvcnM9eyFzb3VyY2VUeXBlID8gW3QoJ01hbmRhdG9yeScpXSA6IFtdfVxuICAgICAgICAgICAgICAgIC8+XG4gICAgICAgICAgICAgICl9XG4gICAgICAgICAgICAgIHt0aGlzLnJlbmRlclZhbHVlQ29uZmlndXJhdGlvbigpfVxuICAgICAgICAgICAgPC9Qb3BvdmVyU2VjdGlvbj5cbiAgICAgICAgICA8L2Rpdj5cbiAgICAgICAgICB7dGhpcy5yZW5kZXJTbGljZUNvbmZpZ3VyYXRpb24oKX1cbiAgICAgICAgICB7dGhpcy5yZW5kZXJEaXNwbGF5Q29uZmlndXJhdGlvbigpfVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAgPGRpdiBzdHlsZT17eyBkaXNwbGF5OiAnZmxleCcsIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicgfX0+XG4gICAgICAgICAge2lzTmV3ID8gKFxuICAgICAgICAgICAgPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBvbkNsaWNrPXsoKSA9PiB0aGlzLnByb3BzLmNsb3NlKCl9PlxuICAgICAgICAgICAgICB7dCgnQ2FuY2VsJyl9XG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICApIDogKFxuICAgICAgICAgICAgPEJ1dHRvbiBidXR0b25TaXplPVwic21hbGxcIiBvbkNsaWNrPXt0aGlzLmRlbGV0ZUFubm90YXRpb259PlxuICAgICAgICAgICAgICB7dCgnUmVtb3ZlJyl9XG4gICAgICAgICAgICA8L0J1dHRvbj5cbiAgICAgICAgICApfVxuICAgICAgICAgIDxkaXY+XG4gICAgICAgICAgICA8QnV0dG9uXG4gICAgICAgICAgICAgIGJ1dHRvblNpemU9XCJzbWFsbFwiXG4gICAgICAgICAgICAgIGRpc2FibGVkPXshaXNWYWxpZH1cbiAgICAgICAgICAgICAgb25DbGljaz17dGhpcy5hcHBseUFubm90YXRpb259XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHt0KCdBcHBseScpfVxuICAgICAgICAgICAgPC9CdXR0b24+XG5cbiAgICAgICAgICAgIDxCdXR0b25cbiAgICAgICAgICAgICAgYnV0dG9uU2l6ZT1cInNtYWxsXCJcbiAgICAgICAgICAgICAgYnV0dG9uU3R5bGU9XCJwcmltYXJ5XCJcbiAgICAgICAgICAgICAgZGlzYWJsZWQ9eyFpc1ZhbGlkfVxuICAgICAgICAgICAgICBvbkNsaWNrPXt0aGlzLnN1Ym1pdEFubm90YXRpb259XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIHt0KCdPSycpfVxuICAgICAgICAgICAgPC9CdXR0b24+XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgIDwvZGl2PlxuICAgICAgPC8+XG4gICAgKTtcbiAgfVxufVxuXG5Bbm5vdGF0aW9uTGF5ZXIucHJvcFR5cGVzID0gcHJvcFR5cGVzO1xuQW5ub3RhdGlvbkxheWVyLmRlZmF1bHRQcm9wcyA9IGRlZmF1bHRQcm9wcztcblxuZXhwb3J0IGRlZmF1bHQgd2l0aFRoZW1lKEFubm90YXRpb25MYXllcik7XG4iXX0= */\", toString: _EMOTION_STRINGIFIED_CSS_ERROR__ };\n\n\n\n\nclass AnnotationLayer extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const {\n      name,\n      annotationType,\n      sourceType,\n      color,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      value,\n      overrides,\n      show,\n      showLabel,\n      titleColumn,\n      descriptionColumns,\n      timeColumn,\n      intervalEndColumn,\n      vizType } =\n    props;\n\n    // Only allow override whole time_range\n    if ('since' in overrides || 'until' in overrides) {\n      overrides.time_range = null;\n      delete overrides.since;\n      delete overrides.until;\n    }\n\n    // Check if annotationType is supported by this chart\n    const metadata = getChartMetadataRegistry().get(vizType);\n    const supportedAnnotationTypes = (metadata == null ? void 0 : metadata.supportedAnnotationTypes) || [];\n    const validAnnotationType = _includesInstanceProperty(supportedAnnotationTypes).call(supportedAnnotationTypes,\n    annotationType) ?\n\n    annotationType :\n    supportedAnnotationTypes[0];\n\n    this.state = {\n      // base\n      name,\n      annotationType: validAnnotationType,\n      sourceType,\n      value,\n      overrides,\n      show,\n      showLabel,\n      // slice\n      titleColumn,\n      descriptionColumns,\n      timeColumn,\n      intervalEndColumn,\n      // display\n      color: color || AUTOMATIC_COLOR,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      // refData\n      isNew: !name,\n      isLoadingOptions: true,\n      valueOptions: [] };\n\n    this.submitAnnotation = this.submitAnnotation.bind(this);\n    this.deleteAnnotation = this.deleteAnnotation.bind(this);\n    this.applyAnnotation = this.applyAnnotation.bind(this);\n    this.fetchOptions = this.fetchOptions.bind(this);\n    this.handleAnnotationType = this.handleAnnotationType.bind(this);\n    this.handleAnnotationSourceType =\n    this.handleAnnotationSourceType.bind(this);\n    this.handleValue = this.handleValue.bind(this);\n    this.isValidForm = this.isValidForm.bind(this);\n  }\n\n  componentDidMount() {\n    const { annotationType, sourceType, isLoadingOptions } = this.state;\n    this.fetchOptions(annotationType, sourceType, isLoadingOptions);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.sourceType !== this.state.sourceType) {\n      this.fetchOptions(this.state.annotationType, this.state.sourceType, true);\n    }\n  }\n\n  getSupportedSourceTypes(annotationType) {var _ANNOTATION_TYPES_MET;\n    // Get vis types that can be source.\n    const sources = getChartMetadataRegistry().\n    entries().\n    filter((_ref) => {let { value: chartMetadata } = _ref;return (\n        chartMetadata.canBeAnnotationType(annotationType));}).\n\n    map((_ref2) => {let { key, value: chartMetadata } = _ref2;return {\n        value: key,\n        label: chartMetadata.name };});\n\n    // Prepend native source if applicable\n    if ((_ANNOTATION_TYPES_MET = ANNOTATION_TYPES_METADATA[annotationType]) != null && _ANNOTATION_TYPES_MET.supportNativeSource) {\n      sources.unshift(ANNOTATION_SOURCE_TYPES_METADATA.NATIVE);\n    }\n    return sources;\n  }\n\n  isValidFormulaAnnotation(expression, annotationType) {\n    if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      return isValidExpression(expression);\n    }\n    return true;\n  }\n\n  isValidForm() {\n    const {\n      name,\n      annotationType,\n      sourceType,\n      value,\n      timeColumn,\n      intervalEndColumn } =\n    this.state;\n    const errors = [\n    validateNonEmpty(name),\n    validateNonEmpty(annotationType),\n    validateNonEmpty(value)];\n\n    if (sourceType !== ANNOTATION_SOURCE_TYPES.NATIVE) {\n      if (annotationType === ANNOTATION_TYPES.EVENT) {\n        errors.push(validateNonEmpty(timeColumn));\n      }\n      if (annotationType === ANNOTATION_TYPES.INTERVAL) {\n        errors.push(validateNonEmpty(timeColumn));\n        errors.push(validateNonEmpty(intervalEndColumn));\n      }\n    }\n    errors.push(!this.isValidFormulaAnnotation(value, annotationType));\n    return !errors.filter((x) => x).length;\n  }\n\n  handleAnnotationType(annotationType) {\n    this.setState({\n      annotationType,\n      sourceType: null,\n      value: null });\n\n  }\n\n  handleAnnotationSourceType(sourceType) {\n    const { sourceType: prevSourceType } = this.state;\n\n    if (prevSourceType !== sourceType) {\n      this.setState({ sourceType, value: null, isLoadingOptions: true });\n    }\n  }\n\n  handleValue(value) {\n    this.setState({\n      value,\n      descriptionColumns: [],\n      intervalEndColumn: null,\n      timeColumn: null,\n      titleColumn: null,\n      overrides: { time_range: null } });\n\n  }\n\n  fetchOptions(annotationType, sourceType, isLoadingOptions) {\n    if (isLoadingOptions) {\n      if (sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n        const queryParams = rison.encode({\n          page: 0,\n          page_size: FILTER_OPTIONS_LIMIT });\n\n        SupersetClient.get({\n          endpoint: `/api/v1/annotation_layer/?q=${queryParams}` }).\n        then((_ref3) => {let { json } = _ref3;\n          const layers = json ?\n          json.result.map((layer) => ({\n            value: layer.id,\n            label: layer.name })) :\n\n          [];\n          this.setState({\n            isLoadingOptions: false,\n            valueOptions: layers });\n\n        });\n      } else if (requiresQuery(sourceType)) {\n        const queryParams = rison.encode({\n          filters: [\n          {\n            col: 'id',\n            opr: 'chart_owned_created_favored_by_me',\n            value: true }],\n\n\n          order_column: 'slice_name',\n          order_direction: 'asc',\n          page: 0,\n          page_size: FILTER_OPTIONS_LIMIT });\n\n        SupersetClient.get({\n          endpoint: `/api/v1/chart/?q=${queryParams}` }).\n        then((_ref4) => {let { json } = _ref4;\n          const registry = getChartMetadataRegistry();\n          this.setState({\n            isLoadingOptions: false,\n            valueOptions: json.result.\n            filter((x) => {\n              const metadata = registry.get(x.viz_type);\n              return metadata && metadata.canBeAnnotationType(annotationType);\n            }).\n            map((x) => {var _x$form_data$groupby;return {\n                value: x.id,\n                label: x.slice_name,\n                slice: {\n                  ...x,\n                  data: {\n                    ...x.form_data,\n                    groupby: (_x$form_data$groupby = x.form_data.groupby) == null ? void 0 : _x$form_data$groupby.map((column) =>\n                    getColumnLabel(column)) } } };}) });\n\n\n\n\n\n        });\n      } else {\n        this.setState({\n          isLoadingOptions: false,\n          valueOptions: [] });\n\n      }\n    }\n  }\n\n  deleteAnnotation() {\n    this.props.removeAnnotationLayer();\n    this.props.close();\n  }\n\n  applyAnnotation() {\n    if (this.isValidForm()) {\n      const annotationFields = [\n      'name',\n      'annotationType',\n      'sourceType',\n      'color',\n      'opacity',\n      'style',\n      'width',\n      'showMarkers',\n      'hideLine',\n      'value',\n      'overrides',\n      'show',\n      'showLabel',\n      'titleColumn',\n      'descriptionColumns',\n      'timeColumn',\n      'intervalEndColumn'];\n\n      const newAnnotation = {};\n      annotationFields.forEach((field) => {\n        if (this.state[field] !== null) {\n          newAnnotation[field] = this.state[field];\n        }\n      });\n\n      if (newAnnotation.color === AUTOMATIC_COLOR) {\n        newAnnotation.color = null;\n      }\n\n      this.props.addAnnotationLayer(newAnnotation);\n      this.setState({ isNew: false });\n    }\n  }\n\n  submitAnnotation() {\n    this.applyAnnotation();\n    this.props.close();\n  }\n\n  renderOption(option) {\n    return (\n      ___EmotionJSX(\"span\", {\n        css: _ref5,\n\n\n\n\n        title: option.label },\n\n      option.label));\n\n\n  }\n\n  renderValueConfiguration() {\n    const {\n      annotationType,\n      sourceType,\n      value,\n      valueOptions,\n      isLoadingOptions } =\n    this.state;\n    let label = '';\n    let description = '';\n    if (requiresQuery(sourceType)) {\n      if (sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n        label = t('Annotation layer');\n        description = t('Select the Annotation Layer you would like to use.');\n      } else {\n        label = t('Chart');\n        description = t(\n        `Use another existing chart as a source for annotations and overlays.\n          Your chart must be one of these visualization types: [%s]`,\n        this.getSupportedSourceTypes(annotationType).\n        map((x) => x.label).\n        join(', '));\n\n      }\n    } else if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      label = t('Formula');\n      description = t(`Expects a formula with depending time parameter 'x'\n        in milliseconds since epoch. mathjs is used to evaluate the formulas.\n        Example: '2x+5'`);\n    }\n    if (requiresQuery(sourceType)) {\n      return (\n        ___EmotionJSX(SelectControl, {\n          ariaLabel: t('Annotation layer value'),\n          name: \"annotation-layer-value\",\n          showHeader: true,\n          hovered: true,\n          description: description,\n          label: label,\n          placeholder: \"\",\n          options: valueOptions,\n          isLoading: isLoadingOptions,\n          value: value,\n          onChange: this.handleValue,\n          validationErrors: !value ? ['Mandatory'] : [],\n          optionRenderer: this.renderOption,\n          notFoundContent: ___EmotionJSX(NotFoundContent, null) }));\n\n\n    }\n    if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      return (\n        ___EmotionJSX(TextControl, {\n          name: \"annotation-layer-value\",\n          hovered: true,\n          showHeader: true,\n          description: description,\n          label: label,\n          placeholder: \"\",\n          value: value,\n          onChange: this.handleValue,\n          validationErrors:\n          !this.isValidFormulaAnnotation(value, annotationType) ?\n          [t('Bad formula.')] :\n          [] }));\n\n\n\n    }\n    return '';\n  }\n\n  renderSliceConfiguration() {\n    const {\n      annotationType,\n      sourceType,\n      value,\n      valueOptions,\n      overrides,\n      titleColumn,\n      timeColumn,\n      intervalEndColumn,\n      descriptionColumns } =\n    this.state;\n    const { slice } = valueOptions.find((x) => x.value === value) || {};\n    if (sourceType !== ANNOTATION_SOURCE_TYPES.NATIVE && slice) {\n      const columns = (slice.data.groupby || []).\n      concat(slice.data.all_columns || []).\n      map((x) => ({ value: x, label: x }));\n      const timeColumnOptions = slice.data.include_time ?\n      [{ value: '__timestamp', label: '__timestamp' }].concat(columns) :\n      columns;\n      return (\n        ___EmotionJSX(\"div\", { style: { marginRight: '2rem' } },\n        ___EmotionJSX(PopoverSection, {\n          isSelected: true,\n          title: t('Annotation Slice Configuration'),\n          info: t(`This section allows you to configure how to use the slice\n              to generate annotations.`) },\n\n        (annotationType === ANNOTATION_TYPES.EVENT ||\n        annotationType === ANNOTATION_TYPES.INTERVAL) &&\n        ___EmotionJSX(SelectControl, {\n          ariaLabel: t('Annotation layer time column'),\n          hovered: true,\n          name: \"annotation-layer-time-column\",\n          label:\n          annotationType === ANNOTATION_TYPES.INTERVAL ?\n          t('Interval start column') :\n          t('Event time column'),\n\n          description: t(\n          'This column must contain date/time information.'),\n\n          validationErrors: !timeColumn ? ['Mandatory'] : [],\n          clearable: false,\n          options: timeColumnOptions,\n          value: timeColumn,\n          onChange: (v) => this.setState({ timeColumn: v }) }),\n\n\n        annotationType === ANNOTATION_TYPES.INTERVAL &&\n        ___EmotionJSX(SelectControl, {\n          ariaLabel: t('Annotation layer interval end'),\n          hovered: true,\n          name: \"annotation-layer-intervalEnd\",\n          label: t('Interval End column'),\n          description: t(\n          'This column must contain date/time information.'),\n\n          validationErrors: !intervalEndColumn ? ['Mandatory'] : [],\n          options: columns,\n          value: intervalEndColumn,\n          onChange: (value) => this.setState({ intervalEndColumn: value }) }),\n\n\n        ___EmotionJSX(SelectControl, {\n          ariaLabel: t('Annotation layer title column'),\n          hovered: true,\n          name: \"annotation-layer-title\",\n          label: t('Title Column'),\n          description: t('Pick a title for you annotation.'),\n          options: [{ value: '', label: t('None') }].concat(columns),\n          value: titleColumn,\n          onChange: (value) => this.setState({ titleColumn: value }) }),\n\n        annotationType !== ANNOTATION_TYPES.TIME_SERIES &&\n        ___EmotionJSX(SelectControl, {\n          ariaLabel: t('Annotation layer description columns'),\n          hovered: true,\n          name: \"annotation-layer-title\",\n          label: t('Description Columns'),\n          description: t(\n          \"Pick one or more columns that should be shown in the annotation. If you don't select a column all of them will be shown.\"),\n\n          multi: true,\n          options: columns,\n          value: descriptionColumns,\n          onChange: (value) => this.setState({ descriptionColumns: value }) }),\n\n\n        ___EmotionJSX(\"div\", { style: { marginTop: '1rem' } },\n        ___EmotionJSX(CheckboxControl, {\n          hovered: true,\n          name: \"annotation-override-time_range\",\n          label: t('Override time range'),\n          description: t(`This controls whether the \"time_range\" field from the current\n                  view should be passed down to the chart containing the annotation data.`),\n          value: 'time_range' in overrides,\n          onChange: (v) => {\n            delete overrides.time_range;\n            if (v) {\n              this.setState({\n                overrides: { ...overrides, time_range: null } });\n\n            } else {\n              this.setState({ overrides: { ...overrides } });\n            }\n          } }),\n\n        ___EmotionJSX(CheckboxControl, {\n          hovered: true,\n          name: \"annotation-override-timegrain\",\n          label: t('Override time grain'),\n          description: t(`This controls whether the time grain field from the current\n                  view should be passed down to the chart containing the annotation data.`),\n          value: 'time_grain_sqla' in overrides,\n          onChange: (v) => {\n            delete overrides.time_grain_sqla;\n            delete overrides.granularity;\n            if (v) {\n              this.setState({\n                overrides: {\n                  ...overrides,\n                  time_grain_sqla: null,\n                  granularity: null } });\n\n\n            } else {\n              this.setState({ overrides: { ...overrides } });\n            }\n          } }),\n\n        ___EmotionJSX(TextControl, {\n          hovered: true,\n          name: \"annotation-layer-timeshift\",\n          label: t('Time Shift'),\n          description: t(`Time delta in natural language\n                  (example:  24 hours, 7 days, 56 weeks, 365 days)`),\n          placeholder: \"\",\n          value: overrides.time_shift,\n          onChange: (v) =>\n          this.setState({ overrides: { ...overrides, time_shift: v } }) })))));\n\n\n\n\n\n\n    }\n    return '';\n  }\n\n  renderDisplayConfiguration() {\n    const {\n      color,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      annotationType } =\n    this.state;\n    const colorScheme = getCategoricalSchemeRegistry().\n    get(this.props.colorScheme).\n    colors.concat();\n    if (\n    color &&\n    color !== AUTOMATIC_COLOR &&\n    !colorScheme.find((x) => x.toLowerCase() === color.toLowerCase()))\n    {\n      colorScheme.push(color);\n    }\n    return (\n      ___EmotionJSX(PopoverSection, {\n        isSelected: true,\n        title: t('Display configuration'),\n        info: t('Configure your how you overlay is displayed here.') },\n\n      ___EmotionJSX(SelectControl, {\n        ariaLabel: t('Annotation layer stroke'),\n        name: \"annotation-layer-stroke\",\n        label: t('Style')\n        // see '../../../visualizations/nvd3_vis.css'\n        , options: [\n        { value: 'solid', label: t('Solid') },\n        { value: 'dashed', label: t('Dashed') },\n        { value: 'longDashed', label: t('Long dashed') },\n        { value: 'dotted', label: t('Dotted') }],\n\n        value: style,\n        clearable: false,\n        onChange: (v) => this.setState({ style: v }) }),\n\n      ___EmotionJSX(SelectControl, {\n        ariaLabel: t('Annotation layer opacity'),\n        name: \"annotation-layer-opacity\",\n        label: t('Opacity')\n        // see '../../../visualizations/nvd3_vis.css'\n        , options: [\n        { value: '', label: t('Solid') },\n        { value: 'opacityLow', label: '0.2' },\n        { value: 'opacityMedium', label: '0.5' },\n        { value: 'opacityHigh', label: '0.8' }],\n\n        value: opacity,\n        onChange: (value) => this.setState({ opacity: value }) }),\n\n      ___EmotionJSX(\"div\", null,\n      ___EmotionJSX(ControlHeader, { label: t('Color') }),\n      ___EmotionJSX(\"div\", { style: { display: 'flex', flexDirection: 'column' } },\n      ___EmotionJSX(CompactPicker, {\n        color: color,\n        colors: colorScheme,\n        onChangeComplete: (v) => this.setState({ color: v.hex }) }),\n\n      ___EmotionJSX(Button, {\n        style: { marginTop: '0.5rem', marginBottom: '0.5rem' },\n        buttonStyle: color === AUTOMATIC_COLOR ? 'success' : 'default',\n        buttonSize: \"xsmall\",\n        onClick: () => this.setState({ color: AUTOMATIC_COLOR }) },\n\n      t('Automatic Color')))),\n\n\n\n      ___EmotionJSX(TextControl, {\n        name: \"annotation-layer-stroke-width\",\n        label: t('Line width'),\n        isInt: true,\n        value: width,\n        onChange: (v) => this.setState({ width: v }) }),\n\n      annotationType === ANNOTATION_TYPES.TIME_SERIES &&\n      ___EmotionJSX(CheckboxControl, {\n        hovered: true,\n        name: \"annotation-layer-show-markers\",\n        label: t('Show Markers'),\n        description: t('Shows or hides markers for the time series'),\n        value: showMarkers,\n        onChange: (v) => this.setState({ showMarkers: v }) }),\n\n\n      annotationType === ANNOTATION_TYPES.TIME_SERIES &&\n      ___EmotionJSX(CheckboxControl, {\n        hovered: true,\n        name: \"annotation-layer-hide-line\",\n        label: t('Hide Line'),\n        description: t('Hides the Line for the time series'),\n        value: hideLine,\n        onChange: (v) => this.setState({ hideLine: v }) })));\n\n\n\n\n  }\n\n  render() {\n    const { isNew, name, annotationType, sourceType, show, showLabel } =\n    this.state;\n    const isValid = this.isValidForm();\n    const metadata = getChartMetadataRegistry().get(this.props.vizType);\n    const supportedAnnotationTypes = metadata ?\n    metadata.supportedAnnotationTypes.map(\n    (type) => ANNOTATION_TYPES_METADATA[type]) :\n\n    [];\n    const supportedSourceTypes = this.getSupportedSourceTypes(annotationType);\n\n    return (\n      ___EmotionJSX(React.Fragment, null,\n      this.props.error &&\n      ___EmotionJSX(\"span\", { style: { color: this.props.theme.colors.error.base } }, \"ERROR: \",\n      this.props.error),\n\n\n      ___EmotionJSX(\"div\", { style: { display: 'flex', flexDirection: 'row' } },\n      ___EmotionJSX(\"div\", { style: { marginRight: '2rem' } },\n      ___EmotionJSX(PopoverSection, {\n        isSelected: true,\n        title: t('Layer configuration'),\n        info: t('Configure the basics of your Annotation Layer.') },\n\n      ___EmotionJSX(TextControl, {\n        name: \"annotation-layer-name\",\n        label: t('Name'),\n        placeholder: \"\",\n        value: name,\n        onChange: (v) => this.setState({ name: v }),\n        validationErrors: !name ? [t('Mandatory')] : [] }),\n\n      ___EmotionJSX(CheckboxControl, {\n        name: \"annotation-layer-hide\",\n        label: t('Hide layer'),\n        value: !show,\n        onChange: (v) => this.setState({ show: !v }) }),\n\n      ___EmotionJSX(CheckboxControl, {\n        name: \"annotation-label-show\",\n        label: t('Show label'),\n        value: showLabel,\n        hovered: true,\n        description: t('Whether to always show the annotation label'),\n        onChange: (v) => this.setState({ showLabel: v }) }),\n\n      ___EmotionJSX(SelectControl, {\n        ariaLabel: t('Annotation layer type'),\n        hovered: true,\n        description: t('Choose the annotation layer type'),\n        label: t('Annotation layer type'),\n        name: \"annotation-layer-type\",\n        clearable: false,\n        options: supportedAnnotationTypes,\n        value: annotationType,\n        onChange: this.handleAnnotationType }),\n\n      supportedSourceTypes.length > 0 &&\n      ___EmotionJSX(SelectControl, {\n        ariaLabel: t('Annotation source type'),\n        hovered: true,\n        description: t('Choose the source of your annotations'),\n        label: t('Annotation source'),\n        name: \"annotation-source-type\",\n        options: supportedSourceTypes,\n        notFoundContent: ___EmotionJSX(NotFoundContent, null),\n        value: sourceType,\n        onChange: this.handleAnnotationSourceType,\n        validationErrors: !sourceType ? [t('Mandatory')] : [] }),\n\n\n      this.renderValueConfiguration())),\n\n\n      this.renderSliceConfiguration(),\n      this.renderDisplayConfiguration()),\n\n      ___EmotionJSX(\"div\", { style: { display: 'flex', justifyContent: 'space-between' } },\n      isNew ?\n      ___EmotionJSX(Button, { buttonSize: \"small\", onClick: () => this.props.close() },\n      t('Cancel')) :\n\n\n      ___EmotionJSX(Button, { buttonSize: \"small\", onClick: this.deleteAnnotation },\n      t('Remove')),\n\n\n      ___EmotionJSX(\"div\", null,\n      ___EmotionJSX(Button, {\n        buttonSize: \"small\",\n        disabled: !isValid,\n        onClick: this.applyAnnotation },\n\n      t('Apply')),\n\n\n      ___EmotionJSX(Button, {\n        buttonSize: \"small\",\n        buttonStyle: \"primary\",\n        disabled: !isValid,\n        onClick: this.submitAnnotation },\n\n      t('OK'))))));\n\n\n\n\n\n  }}\n\n\nAnnotationLayer.propTypes = propTypes;\nAnnotationLayer.defaultProps = defaultProps;\n\nexport default withTheme(AnnotationLayer);","map":{"version":3,"names":["React","rison","PropTypes","CompactPicker","Button","t","SupersetClient","getCategoricalSchemeRegistry","getChartMetadataRegistry","validateNonEmpty","isValidExpression","styled","getColumnLabel","withTheme","SelectControl","TextControl","CheckboxControl","ANNOTATION_SOURCE_TYPES","ANNOTATION_TYPES","ANNOTATION_TYPES_METADATA","DEFAULT_ANNOTATION_TYPE","requiresQuery","ANNOTATION_SOURCE_TYPES_METADATA","PopoverSection","ControlHeader","EmptyStateSmall","FILTER_OPTIONS_LIMIT","AUTOMATIC_COLOR","propTypes","name","string","annotationType","sourceType","color","opacity","style","width","number","showMarkers","bool","hideLine","value","oneOfType","overrides","object","show","showLabel","titleColumn","descriptionColumns","arrayOf","timeColumn","intervalEndColumn","vizType","error","colorScheme","addAnnotationLayer","func","removeAnnotationLayer","close","defaultProps","NotFoundContentWrapper","div","NotFoundContent","AnnotationLayer","PureComponent","constructor","props","time_range","since","until","metadata","get","supportedAnnotationTypes","validAnnotationType","state","isNew","isLoadingOptions","valueOptions","submitAnnotation","bind","deleteAnnotation","applyAnnotation","fetchOptions","handleAnnotationType","handleAnnotationSourceType","handleValue","isValidForm","componentDidMount","componentDidUpdate","prevProps","prevState","getSupportedSourceTypes","sources","entries","filter","chartMetadata","canBeAnnotationType","map","key","label","supportNativeSource","unshift","NATIVE","isValidFormulaAnnotation","expression","FORMULA","errors","EVENT","push","INTERVAL","x","length","setState","prevSourceType","queryParams","encode","page","page_size","endpoint","then","json","layers","result","layer","id","filters","col","opr","order_column","order_direction","registry","viz_type","slice_name","slice","data","form_data","groupby","column","annotationFields","newAnnotation","forEach","field","renderOption","option","renderValueConfiguration","description","join","renderSliceConfiguration","find","columns","concat","all_columns","timeColumnOptions","include_time","marginRight","v","TIME_SERIES","marginTop","time_grain_sqla","granularity","time_shift","renderDisplayConfiguration","colors","toLowerCase","display","flexDirection","hex","marginBottom","render","isValid","type","supportedSourceTypes","theme","base","justifyContent"],"sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/explore/components/controls/AnnotationLayerControl/AnnotationLayer.jsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport rison from 'rison';\nimport PropTypes from 'prop-types';\nimport { CompactPicker } from 'react-color';\nimport Button from 'src/components/Button';\nimport {\n  t,\n  SupersetClient,\n  getCategoricalSchemeRegistry,\n  getChartMetadataRegistry,\n  validateNonEmpty,\n  isValidExpression,\n  styled,\n  getColumnLabel,\n  withTheme,\n} from '@superset-ui/core';\n\nimport SelectControl from 'src/explore/components/controls/SelectControl';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport {\n  ANNOTATION_SOURCE_TYPES,\n  ANNOTATION_TYPES,\n  ANNOTATION_TYPES_METADATA,\n  DEFAULT_ANNOTATION_TYPE,\n  requiresQuery,\n  ANNOTATION_SOURCE_TYPES_METADATA,\n} from 'src/modules/AnnotationTypes';\nimport PopoverSection from 'src/components/PopoverSection';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { EmptyStateSmall } from 'src/components/EmptyState';\nimport { FILTER_OPTIONS_LIMIT } from 'src/explore/constants';\n\nconst AUTOMATIC_COLOR = '';\n\nconst propTypes = {\n  name: PropTypes.string,\n  annotationType: PropTypes.string,\n  sourceType: PropTypes.string,\n  color: PropTypes.string,\n  opacity: PropTypes.string,\n  style: PropTypes.string,\n  width: PropTypes.number,\n  showMarkers: PropTypes.bool,\n  hideLine: PropTypes.bool,\n  value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  overrides: PropTypes.object,\n  show: PropTypes.bool,\n  showLabel: PropTypes.bool,\n  titleColumn: PropTypes.string,\n  descriptionColumns: PropTypes.arrayOf(PropTypes.string),\n  timeColumn: PropTypes.string,\n  intervalEndColumn: PropTypes.string,\n  vizType: PropTypes.string,\n\n  error: PropTypes.string,\n  colorScheme: PropTypes.string,\n\n  addAnnotationLayer: PropTypes.func,\n  removeAnnotationLayer: PropTypes.func,\n  close: PropTypes.func,\n};\n\nconst defaultProps = {\n  name: '',\n  annotationType: DEFAULT_ANNOTATION_TYPE,\n  sourceType: '',\n  color: AUTOMATIC_COLOR,\n  opacity: '',\n  style: 'solid',\n  width: 1,\n  showMarkers: false,\n  hideLine: false,\n  overrides: {},\n  colorScheme: 'd3Category10',\n  show: true,\n  showLabel: false,\n  titleColumn: '',\n  descriptionColumns: [],\n  timeColumn: '',\n  intervalEndColumn: '',\n\n  addAnnotationLayer: () => {},\n  removeAnnotationLayer: () => {},\n  close: () => {},\n};\n\nconst NotFoundContentWrapper = styled.div`\n  && > div:first-child {\n    padding-left: 0;\n    padding-right: 0;\n  }\n`;\n\nconst NotFoundContent = () => (\n  <NotFoundContentWrapper>\n    <EmptyStateSmall\n      title={t('No annotation layers')}\n      description={\n        <span>\n          {t('Add an annotation layer')}{' '}\n          <a\n            href=\"/annotationlayer/list\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            {t('here')}\n          </a>\n          .\n        </span>\n      }\n      image=\"empty.svg\"\n    />\n  </NotFoundContentWrapper>\n);\n\nclass AnnotationLayer extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const {\n      name,\n      annotationType,\n      sourceType,\n      color,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      value,\n      overrides,\n      show,\n      showLabel,\n      titleColumn,\n      descriptionColumns,\n      timeColumn,\n      intervalEndColumn,\n      vizType,\n    } = props;\n\n    // Only allow override whole time_range\n    if ('since' in overrides || 'until' in overrides) {\n      overrides.time_range = null;\n      delete overrides.since;\n      delete overrides.until;\n    }\n\n    // Check if annotationType is supported by this chart\n    const metadata = getChartMetadataRegistry().get(vizType);\n    const supportedAnnotationTypes = metadata?.supportedAnnotationTypes || [];\n    const validAnnotationType = supportedAnnotationTypes.includes(\n      annotationType,\n    )\n      ? annotationType\n      : supportedAnnotationTypes[0];\n\n    this.state = {\n      // base\n      name,\n      annotationType: validAnnotationType,\n      sourceType,\n      value,\n      overrides,\n      show,\n      showLabel,\n      // slice\n      titleColumn,\n      descriptionColumns,\n      timeColumn,\n      intervalEndColumn,\n      // display\n      color: color || AUTOMATIC_COLOR,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      // refData\n      isNew: !name,\n      isLoadingOptions: true,\n      valueOptions: [],\n    };\n    this.submitAnnotation = this.submitAnnotation.bind(this);\n    this.deleteAnnotation = this.deleteAnnotation.bind(this);\n    this.applyAnnotation = this.applyAnnotation.bind(this);\n    this.fetchOptions = this.fetchOptions.bind(this);\n    this.handleAnnotationType = this.handleAnnotationType.bind(this);\n    this.handleAnnotationSourceType =\n      this.handleAnnotationSourceType.bind(this);\n    this.handleValue = this.handleValue.bind(this);\n    this.isValidForm = this.isValidForm.bind(this);\n  }\n\n  componentDidMount() {\n    const { annotationType, sourceType, isLoadingOptions } = this.state;\n    this.fetchOptions(annotationType, sourceType, isLoadingOptions);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.sourceType !== this.state.sourceType) {\n      this.fetchOptions(this.state.annotationType, this.state.sourceType, true);\n    }\n  }\n\n  getSupportedSourceTypes(annotationType) {\n    // Get vis types that can be source.\n    const sources = getChartMetadataRegistry()\n      .entries()\n      .filter(({ value: chartMetadata }) =>\n        chartMetadata.canBeAnnotationType(annotationType),\n      )\n      .map(({ key, value: chartMetadata }) => ({\n        value: key,\n        label: chartMetadata.name,\n      }));\n    // Prepend native source if applicable\n    if (ANNOTATION_TYPES_METADATA[annotationType]?.supportNativeSource) {\n      sources.unshift(ANNOTATION_SOURCE_TYPES_METADATA.NATIVE);\n    }\n    return sources;\n  }\n\n  isValidFormulaAnnotation(expression, annotationType) {\n    if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      return isValidExpression(expression);\n    }\n    return true;\n  }\n\n  isValidForm() {\n    const {\n      name,\n      annotationType,\n      sourceType,\n      value,\n      timeColumn,\n      intervalEndColumn,\n    } = this.state;\n    const errors = [\n      validateNonEmpty(name),\n      validateNonEmpty(annotationType),\n      validateNonEmpty(value),\n    ];\n    if (sourceType !== ANNOTATION_SOURCE_TYPES.NATIVE) {\n      if (annotationType === ANNOTATION_TYPES.EVENT) {\n        errors.push(validateNonEmpty(timeColumn));\n      }\n      if (annotationType === ANNOTATION_TYPES.INTERVAL) {\n        errors.push(validateNonEmpty(timeColumn));\n        errors.push(validateNonEmpty(intervalEndColumn));\n      }\n    }\n    errors.push(!this.isValidFormulaAnnotation(value, annotationType));\n    return !errors.filter(x => x).length;\n  }\n\n  handleAnnotationType(annotationType) {\n    this.setState({\n      annotationType,\n      sourceType: null,\n      value: null,\n    });\n  }\n\n  handleAnnotationSourceType(sourceType) {\n    const { sourceType: prevSourceType } = this.state;\n\n    if (prevSourceType !== sourceType) {\n      this.setState({ sourceType, value: null, isLoadingOptions: true });\n    }\n  }\n\n  handleValue(value) {\n    this.setState({\n      value,\n      descriptionColumns: [],\n      intervalEndColumn: null,\n      timeColumn: null,\n      titleColumn: null,\n      overrides: { time_range: null },\n    });\n  }\n\n  fetchOptions(annotationType, sourceType, isLoadingOptions) {\n    if (isLoadingOptions) {\n      if (sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n        const queryParams = rison.encode({\n          page: 0,\n          page_size: FILTER_OPTIONS_LIMIT,\n        });\n        SupersetClient.get({\n          endpoint: `/api/v1/annotation_layer/?q=${queryParams}`,\n        }).then(({ json }) => {\n          const layers = json\n            ? json.result.map(layer => ({\n                value: layer.id,\n                label: layer.name,\n              }))\n            : [];\n          this.setState({\n            isLoadingOptions: false,\n            valueOptions: layers,\n          });\n        });\n      } else if (requiresQuery(sourceType)) {\n        const queryParams = rison.encode({\n          filters: [\n            {\n              col: 'id',\n              opr: 'chart_owned_created_favored_by_me',\n              value: true,\n            },\n          ],\n          order_column: 'slice_name',\n          order_direction: 'asc',\n          page: 0,\n          page_size: FILTER_OPTIONS_LIMIT,\n        });\n        SupersetClient.get({\n          endpoint: `/api/v1/chart/?q=${queryParams}`,\n        }).then(({ json }) => {\n          const registry = getChartMetadataRegistry();\n          this.setState({\n            isLoadingOptions: false,\n            valueOptions: json.result\n              .filter(x => {\n                const metadata = registry.get(x.viz_type);\n                return metadata && metadata.canBeAnnotationType(annotationType);\n              })\n              .map(x => ({\n                value: x.id,\n                label: x.slice_name,\n                slice: {\n                  ...x,\n                  data: {\n                    ...x.form_data,\n                    groupby: x.form_data.groupby?.map(column =>\n                      getColumnLabel(column),\n                    ),\n                  },\n                },\n              })),\n          });\n        });\n      } else {\n        this.setState({\n          isLoadingOptions: false,\n          valueOptions: [],\n        });\n      }\n    }\n  }\n\n  deleteAnnotation() {\n    this.props.removeAnnotationLayer();\n    this.props.close();\n  }\n\n  applyAnnotation() {\n    if (this.isValidForm()) {\n      const annotationFields = [\n        'name',\n        'annotationType',\n        'sourceType',\n        'color',\n        'opacity',\n        'style',\n        'width',\n        'showMarkers',\n        'hideLine',\n        'value',\n        'overrides',\n        'show',\n        'showLabel',\n        'titleColumn',\n        'descriptionColumns',\n        'timeColumn',\n        'intervalEndColumn',\n      ];\n      const newAnnotation = {};\n      annotationFields.forEach(field => {\n        if (this.state[field] !== null) {\n          newAnnotation[field] = this.state[field];\n        }\n      });\n\n      if (newAnnotation.color === AUTOMATIC_COLOR) {\n        newAnnotation.color = null;\n      }\n\n      this.props.addAnnotationLayer(newAnnotation);\n      this.setState({ isNew: false });\n    }\n  }\n\n  submitAnnotation() {\n    this.applyAnnotation();\n    this.props.close();\n  }\n\n  renderOption(option) {\n    return (\n      <span\n        css={{\n          overflow: 'hidden',\n          textOverflow: 'ellipsis',\n          whiteSpace: 'nowrap',\n        }}\n        title={option.label}\n      >\n        {option.label}\n      </span>\n    );\n  }\n\n  renderValueConfiguration() {\n    const {\n      annotationType,\n      sourceType,\n      value,\n      valueOptions,\n      isLoadingOptions,\n    } = this.state;\n    let label = '';\n    let description = '';\n    if (requiresQuery(sourceType)) {\n      if (sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n        label = t('Annotation layer');\n        description = t('Select the Annotation Layer you would like to use.');\n      } else {\n        label = t('Chart');\n        description = t(\n          `Use another existing chart as a source for annotations and overlays.\n          Your chart must be one of these visualization types: [%s]`,\n          this.getSupportedSourceTypes(annotationType)\n            .map(x => x.label)\n            .join(', '),\n        );\n      }\n    } else if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      label = t('Formula');\n      description = t(`Expects a formula with depending time parameter 'x'\n        in milliseconds since epoch. mathjs is used to evaluate the formulas.\n        Example: '2x+5'`);\n    }\n    if (requiresQuery(sourceType)) {\n      return (\n        <SelectControl\n          ariaLabel={t('Annotation layer value')}\n          name=\"annotation-layer-value\"\n          showHeader\n          hovered\n          description={description}\n          label={label}\n          placeholder=\"\"\n          options={valueOptions}\n          isLoading={isLoadingOptions}\n          value={value}\n          onChange={this.handleValue}\n          validationErrors={!value ? ['Mandatory'] : []}\n          optionRenderer={this.renderOption}\n          notFoundContent={<NotFoundContent />}\n        />\n      );\n    }\n    if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      return (\n        <TextControl\n          name=\"annotation-layer-value\"\n          hovered\n          showHeader\n          description={description}\n          label={label}\n          placeholder=\"\"\n          value={value}\n          onChange={this.handleValue}\n          validationErrors={\n            !this.isValidFormulaAnnotation(value, annotationType)\n              ? [t('Bad formula.')]\n              : []\n          }\n        />\n      );\n    }\n    return '';\n  }\n\n  renderSliceConfiguration() {\n    const {\n      annotationType,\n      sourceType,\n      value,\n      valueOptions,\n      overrides,\n      titleColumn,\n      timeColumn,\n      intervalEndColumn,\n      descriptionColumns,\n    } = this.state;\n    const { slice } = valueOptions.find(x => x.value === value) || {};\n    if (sourceType !== ANNOTATION_SOURCE_TYPES.NATIVE && slice) {\n      const columns = (slice.data.groupby || [])\n        .concat(slice.data.all_columns || [])\n        .map(x => ({ value: x, label: x }));\n      const timeColumnOptions = slice.data.include_time\n        ? [{ value: '__timestamp', label: '__timestamp' }].concat(columns)\n        : columns;\n      return (\n        <div style={{ marginRight: '2rem' }}>\n          <PopoverSection\n            isSelected\n            title={t('Annotation Slice Configuration')}\n            info={t(`This section allows you to configure how to use the slice\n              to generate annotations.`)}\n          >\n            {(annotationType === ANNOTATION_TYPES.EVENT ||\n              annotationType === ANNOTATION_TYPES.INTERVAL) && (\n              <SelectControl\n                ariaLabel={t('Annotation layer time column')}\n                hovered\n                name=\"annotation-layer-time-column\"\n                label={\n                  annotationType === ANNOTATION_TYPES.INTERVAL\n                    ? t('Interval start column')\n                    : t('Event time column')\n                }\n                description={t(\n                  'This column must contain date/time information.',\n                )}\n                validationErrors={!timeColumn ? ['Mandatory'] : []}\n                clearable={false}\n                options={timeColumnOptions}\n                value={timeColumn}\n                onChange={v => this.setState({ timeColumn: v })}\n              />\n            )}\n            {annotationType === ANNOTATION_TYPES.INTERVAL && (\n              <SelectControl\n                ariaLabel={t('Annotation layer interval end')}\n                hovered\n                name=\"annotation-layer-intervalEnd\"\n                label={t('Interval End column')}\n                description={t(\n                  'This column must contain date/time information.',\n                )}\n                validationErrors={!intervalEndColumn ? ['Mandatory'] : []}\n                options={columns}\n                value={intervalEndColumn}\n                onChange={value => this.setState({ intervalEndColumn: value })}\n              />\n            )}\n            <SelectControl\n              ariaLabel={t('Annotation layer title column')}\n              hovered\n              name=\"annotation-layer-title\"\n              label={t('Title Column')}\n              description={t('Pick a title for you annotation.')}\n              options={[{ value: '', label: t('None') }].concat(columns)}\n              value={titleColumn}\n              onChange={value => this.setState({ titleColumn: value })}\n            />\n            {annotationType !== ANNOTATION_TYPES.TIME_SERIES && (\n              <SelectControl\n                ariaLabel={t('Annotation layer description columns')}\n                hovered\n                name=\"annotation-layer-title\"\n                label={t('Description Columns')}\n                description={t(\n                  \"Pick one or more columns that should be shown in the annotation. If you don't select a column all of them will be shown.\",\n                )}\n                multi\n                options={columns}\n                value={descriptionColumns}\n                onChange={value => this.setState({ descriptionColumns: value })}\n              />\n            )}\n            <div style={{ marginTop: '1rem' }}>\n              <CheckboxControl\n                hovered\n                name=\"annotation-override-time_range\"\n                label={t('Override time range')}\n                description={t(`This controls whether the \"time_range\" field from the current\n                  view should be passed down to the chart containing the annotation data.`)}\n                value={'time_range' in overrides}\n                onChange={v => {\n                  delete overrides.time_range;\n                  if (v) {\n                    this.setState({\n                      overrides: { ...overrides, time_range: null },\n                    });\n                  } else {\n                    this.setState({ overrides: { ...overrides } });\n                  }\n                }}\n              />\n              <CheckboxControl\n                hovered\n                name=\"annotation-override-timegrain\"\n                label={t('Override time grain')}\n                description={t(`This controls whether the time grain field from the current\n                  view should be passed down to the chart containing the annotation data.`)}\n                value={'time_grain_sqla' in overrides}\n                onChange={v => {\n                  delete overrides.time_grain_sqla;\n                  delete overrides.granularity;\n                  if (v) {\n                    this.setState({\n                      overrides: {\n                        ...overrides,\n                        time_grain_sqla: null,\n                        granularity: null,\n                      },\n                    });\n                  } else {\n                    this.setState({ overrides: { ...overrides } });\n                  }\n                }}\n              />\n              <TextControl\n                hovered\n                name=\"annotation-layer-timeshift\"\n                label={t('Time Shift')}\n                description={t(`Time delta in natural language\n                  (example:  24 hours, 7 days, 56 weeks, 365 days)`)}\n                placeholder=\"\"\n                value={overrides.time_shift}\n                onChange={v =>\n                  this.setState({ overrides: { ...overrides, time_shift: v } })\n                }\n              />\n            </div>\n          </PopoverSection>\n        </div>\n      );\n    }\n    return '';\n  }\n\n  renderDisplayConfiguration() {\n    const {\n      color,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      annotationType,\n    } = this.state;\n    const colorScheme = getCategoricalSchemeRegistry()\n      .get(this.props.colorScheme)\n      .colors.concat();\n    if (\n      color &&\n      color !== AUTOMATIC_COLOR &&\n      !colorScheme.find(x => x.toLowerCase() === color.toLowerCase())\n    ) {\n      colorScheme.push(color);\n    }\n    return (\n      <PopoverSection\n        isSelected\n        title={t('Display configuration')}\n        info={t('Configure your how you overlay is displayed here.')}\n      >\n        <SelectControl\n          ariaLabel={t('Annotation layer stroke')}\n          name=\"annotation-layer-stroke\"\n          label={t('Style')}\n          // see '../../../visualizations/nvd3_vis.css'\n          options={[\n            { value: 'solid', label: t('Solid') },\n            { value: 'dashed', label: t('Dashed') },\n            { value: 'longDashed', label: t('Long dashed') },\n            { value: 'dotted', label: t('Dotted') },\n          ]}\n          value={style}\n          clearable={false}\n          onChange={v => this.setState({ style: v })}\n        />\n        <SelectControl\n          ariaLabel={t('Annotation layer opacity')}\n          name=\"annotation-layer-opacity\"\n          label={t('Opacity')}\n          // see '../../../visualizations/nvd3_vis.css'\n          options={[\n            { value: '', label: t('Solid') },\n            { value: 'opacityLow', label: '0.2' },\n            { value: 'opacityMedium', label: '0.5' },\n            { value: 'opacityHigh', label: '0.8' },\n          ]}\n          value={opacity}\n          onChange={value => this.setState({ opacity: value })}\n        />\n        <div>\n          <ControlHeader label={t('Color')} />\n          <div style={{ display: 'flex', flexDirection: 'column' }}>\n            <CompactPicker\n              color={color}\n              colors={colorScheme}\n              onChangeComplete={v => this.setState({ color: v.hex })}\n            />\n            <Button\n              style={{ marginTop: '0.5rem', marginBottom: '0.5rem' }}\n              buttonStyle={color === AUTOMATIC_COLOR ? 'success' : 'default'}\n              buttonSize=\"xsmall\"\n              onClick={() => this.setState({ color: AUTOMATIC_COLOR })}\n            >\n              {t('Automatic Color')}\n            </Button>\n          </div>\n        </div>\n        <TextControl\n          name=\"annotation-layer-stroke-width\"\n          label={t('Line width')}\n          isInt\n          value={width}\n          onChange={v => this.setState({ width: v })}\n        />\n        {annotationType === ANNOTATION_TYPES.TIME_SERIES && (\n          <CheckboxControl\n            hovered\n            name=\"annotation-layer-show-markers\"\n            label={t('Show Markers')}\n            description={t('Shows or hides markers for the time series')}\n            value={showMarkers}\n            onChange={v => this.setState({ showMarkers: v })}\n          />\n        )}\n        {annotationType === ANNOTATION_TYPES.TIME_SERIES && (\n          <CheckboxControl\n            hovered\n            name=\"annotation-layer-hide-line\"\n            label={t('Hide Line')}\n            description={t('Hides the Line for the time series')}\n            value={hideLine}\n            onChange={v => this.setState({ hideLine: v })}\n          />\n        )}\n      </PopoverSection>\n    );\n  }\n\n  render() {\n    const { isNew, name, annotationType, sourceType, show, showLabel } =\n      this.state;\n    const isValid = this.isValidForm();\n    const metadata = getChartMetadataRegistry().get(this.props.vizType);\n    const supportedAnnotationTypes = metadata\n      ? metadata.supportedAnnotationTypes.map(\n          type => ANNOTATION_TYPES_METADATA[type],\n        )\n      : [];\n    const supportedSourceTypes = this.getSupportedSourceTypes(annotationType);\n\n    return (\n      <>\n        {this.props.error && (\n          <span style={{ color: this.props.theme.colors.error.base }}>\n            ERROR: {this.props.error}\n          </span>\n        )}\n        <div style={{ display: 'flex', flexDirection: 'row' }}>\n          <div style={{ marginRight: '2rem' }}>\n            <PopoverSection\n              isSelected\n              title={t('Layer configuration')}\n              info={t('Configure the basics of your Annotation Layer.')}\n            >\n              <TextControl\n                name=\"annotation-layer-name\"\n                label={t('Name')}\n                placeholder=\"\"\n                value={name}\n                onChange={v => this.setState({ name: v })}\n                validationErrors={!name ? [t('Mandatory')] : []}\n              />\n              <CheckboxControl\n                name=\"annotation-layer-hide\"\n                label={t('Hide layer')}\n                value={!show}\n                onChange={v => this.setState({ show: !v })}\n              />\n              <CheckboxControl\n                name=\"annotation-label-show\"\n                label={t('Show label')}\n                value={showLabel}\n                hovered\n                description={t('Whether to always show the annotation label')}\n                onChange={v => this.setState({ showLabel: v })}\n              />\n              <SelectControl\n                ariaLabel={t('Annotation layer type')}\n                hovered\n                description={t('Choose the annotation layer type')}\n                label={t('Annotation layer type')}\n                name=\"annotation-layer-type\"\n                clearable={false}\n                options={supportedAnnotationTypes}\n                value={annotationType}\n                onChange={this.handleAnnotationType}\n              />\n              {supportedSourceTypes.length > 0 && (\n                <SelectControl\n                  ariaLabel={t('Annotation source type')}\n                  hovered\n                  description={t('Choose the source of your annotations')}\n                  label={t('Annotation source')}\n                  name=\"annotation-source-type\"\n                  options={supportedSourceTypes}\n                  notFoundContent={<NotFoundContent />}\n                  value={sourceType}\n                  onChange={this.handleAnnotationSourceType}\n                  validationErrors={!sourceType ? [t('Mandatory')] : []}\n                />\n              )}\n              {this.renderValueConfiguration()}\n            </PopoverSection>\n          </div>\n          {this.renderSliceConfiguration()}\n          {this.renderDisplayConfiguration()}\n        </div>\n        <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n          {isNew ? (\n            <Button buttonSize=\"small\" onClick={() => this.props.close()}>\n              {t('Cancel')}\n            </Button>\n          ) : (\n            <Button buttonSize=\"small\" onClick={this.deleteAnnotation}>\n              {t('Remove')}\n            </Button>\n          )}\n          <div>\n            <Button\n              buttonSize=\"small\"\n              disabled={!isValid}\n              onClick={this.applyAnnotation}\n            >\n              {t('Apply')}\n            </Button>\n\n            <Button\n              buttonSize=\"small\"\n              buttonStyle=\"primary\"\n              disabled={!isValid}\n              onClick={this.submitAnnotation}\n            >\n              {t('OK')}\n            </Button>\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nAnnotationLayer.propTypes = propTypes;\nAnnotationLayer.defaultProps = defaultProps;\n\nexport default withTheme(AnnotationLayer);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}