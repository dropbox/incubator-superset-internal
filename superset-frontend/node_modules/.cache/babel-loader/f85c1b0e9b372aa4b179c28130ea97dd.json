{"ast":null,"code":"/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t, getNumberFormatter, smartDateVerboseFormatter, computeMaxFontSize, BRAND_COLOR, styled } from '@superset-ui/core';\nimport Echart from '../components/Echart';import { jsx as ___EmotionJSX } from \"@emotion/react\";\nconst defaultNumberFormatter = getNumberFormatter();\nconst PROPORTION = {\n  // text size: proportion of the chart container sans trendline\n  KICKER: 0.1,\n  HEADER: 0.3,\n  SUBHEADER: 0.125,\n  // trendline size: proportion of the whole chart container\n  TRENDLINE: 0.3 };\n\nclass BigNumberVis extends React.PureComponent {\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n  getClassName() {\n    const { className, showTrendLine, bigNumberFallback } = this.props;\n    const names = `superset-legacy-chart-big-number ${className} ${bigNumberFallback ? 'is-fallback-value' : ''}`;\n    if (showTrendLine)\n    return names;\n    return `${names} no-trendline`;\n  }\n  createTemporaryContainer() {\n    const container = document.createElement('div');\n    container.className = this.getClassName();\n    container.style.position = 'absolute'; // so it won't disrupt page layout\n    container.style.opacity = '0'; // and not visible\n    return container;\n  }\n  renderFallbackWarning() {\n    const { bigNumberFallback, formatTime, showTimestamp } = this.props;\n    if (!formatTime || !bigNumberFallback || showTimestamp)\n    return null;\n    return ___EmotionJSX(\"span\", { className: \"alert alert-warning\", role: \"alert\", title: t(`Last available value seen on %s`, formatTime(bigNumberFallback[0])) },\n    t('Not up to date'));\n\n  }\n  renderKicker(maxHeight) {\n    const { timestamp, showTimestamp, formatTime, width } = this.props;\n    if (!formatTime ||\n    !showTimestamp ||\n    typeof timestamp === 'string' ||\n    typeof timestamp === 'boolean')\n    return null;\n    const text = timestamp === null ? '' : formatTime(timestamp);\n    const container = this.createTemporaryContainer();\n    document.body.append(container);\n    const fontSize = computeMaxFontSize({\n      text,\n      maxWidth: width,\n      maxHeight,\n      className: 'kicker',\n      container });\n\n    container.remove();\n    return ___EmotionJSX(\"div\", { className: \"kicker\", style: {\n        fontSize,\n        height: maxHeight } },\n\n    text);\n\n  }\n  renderHeader(maxHeight) {\n    const { bigNumber, headerFormatter, width, colorThresholdFormatters } = this.props;\n    // @ts-ignore\n    const text = bigNumber === null ? t('No data') : headerFormatter(bigNumber);\n    const hasThresholdColorFormatter = Array.isArray(colorThresholdFormatters) &&\n    colorThresholdFormatters.length > 0;\n    let numberColor;\n    if (hasThresholdColorFormatter) {\n      colorThresholdFormatters.forEach((formatter) => {\n        const formatterResult = bigNumber ?\n        formatter.getColorFromValue(bigNumber) :\n        false;\n        if (formatterResult) {\n          numberColor = formatterResult;\n        }\n      });\n    } else\n    {\n      numberColor = 'black';\n    }\n    const container = this.createTemporaryContainer();\n    document.body.append(container);\n    const fontSize = computeMaxFontSize({\n      text,\n      maxWidth: width - 8,\n      maxHeight,\n      className: 'header-line',\n      container });\n\n    container.remove();\n    const onContextMenu = (e) => {\n      if (this.props.onContextMenu) {\n        e.preventDefault();\n        this.props.onContextMenu(e.nativeEvent.clientX, e.nativeEvent.clientY);\n      }\n    };\n    return ___EmotionJSX(\"div\", { className: \"header-line\", style: {\n        fontSize,\n        height: maxHeight,\n        color: numberColor },\n      onContextMenu: onContextMenu },\n    text);\n\n  }\n  renderSubheader(maxHeight) {\n    const { bigNumber, subheader, width, bigNumberFallback } = this.props;\n    let fontSize = 0;\n    const NO_DATA_OR_HASNT_LANDED = t('No data after filtering or data is NULL for the latest time record');\n    const NO_DATA = t('Try applying different filters or ensuring your datasource has data');\n    let text = subheader;\n    if (bigNumber === null) {\n      text = bigNumberFallback ? NO_DATA : NO_DATA_OR_HASNT_LANDED;\n    }\n    if (text) {\n      const container = this.createTemporaryContainer();\n      document.body.append(container);\n      fontSize = computeMaxFontSize({\n        text,\n        maxWidth: width,\n        maxHeight,\n        className: 'subheader-line',\n        container });\n\n      container.remove();\n      return ___EmotionJSX(\"div\", { className: \"subheader-line\", style: {\n          fontSize,\n          height: maxHeight } },\n\n      text);\n\n    }\n    return null;\n  }\n  renderTrendline(maxHeight) {\n    const { width, trendLineData, echartOptions, refs } = this.props;\n    // if can't find any non-null values, no point rendering the trendline\n    if (!(trendLineData != null && trendLineData.some((d) => d[1] !== null))) {\n      return null;\n    }\n    const eventHandlers = {\n      contextmenu: (eventParams) => {\n        if (this.props.onContextMenu) {\n          eventParams.event.stop();\n          const { data } = eventParams;\n          if (data) {var _this$props$formData, _this$props$formData2, _this$props$xValueFor, _this$props;\n            const pointerEvent = eventParams.event.event;\n            const drillToDetailFilters = [];\n            drillToDetailFilters.push({\n              col: (_this$props$formData = this.props.formData) == null ? void 0 : _this$props$formData.granularitySqla,\n              grain: (_this$props$formData2 = this.props.formData) == null ? void 0 : _this$props$formData2.timeGrainSqla,\n              op: '==',\n              val: data[0],\n              formattedVal: (_this$props$xValueFor = (_this$props = this.props).xValueFormatter) == null ? void 0 : _this$props$xValueFor.call(_this$props, data[0]) });\n\n            this.props.onContextMenu(pointerEvent.clientX, pointerEvent.clientY, { drillToDetail: drillToDetailFilters });\n          }\n        }\n      } };\n\n    return echartOptions && ___EmotionJSX(Echart, { refs: refs, width: Math.floor(width), height: maxHeight, echartOptions: echartOptions, eventHandlers: eventHandlers });\n  }\n  render() {\n    const { showTrendLine, height, kickerFontSize, headerFontSize, subheaderFontSize } = this.props;\n    const className = this.getClassName();\n    if (showTrendLine) {\n      const chartHeight = Math.floor(PROPORTION.TRENDLINE * height);\n      const allTextHeight = height - chartHeight;\n      return ___EmotionJSX(\"div\", { className: className },\n      ___EmotionJSX(\"div\", { className: \"text-container\", style: { height: allTextHeight } },\n      this.renderFallbackWarning(),\n      this.renderKicker(Math.ceil((kickerFontSize || 0) * (1 - PROPORTION.TRENDLINE) * height)),\n      this.renderHeader(Math.ceil(headerFontSize * (1 - PROPORTION.TRENDLINE) * height)),\n      this.renderSubheader(Math.ceil(subheaderFontSize * (1 - PROPORTION.TRENDLINE) * height))),\n\n      this.renderTrendline(chartHeight));\n\n    }\n    return ___EmotionJSX(\"div\", { className: className, style: { height } },\n    this.renderFallbackWarning(),\n    this.renderKicker((kickerFontSize || 0) * height),\n    this.renderHeader(Math.ceil(headerFontSize * height)),\n    this.renderSubheader(Math.ceil(subheaderFontSize * height)));\n\n  }}BigNumberVis.defaultProps = { className: '', headerFormatter: defaultNumberFormatter, formatTime: smartDateVerboseFormatter, headerFontSize: PROPORTION.HEADER, kickerFontSize: PROPORTION.KICKER, mainColor: BRAND_COLOR, showTimestamp: false, showTrendLine: false, startYAxisAtZero: true, subheader: '', subheaderFontSize: PROPORTION.SUBHEADER, timeRangeFixed: false };\n\nexport default styled(BigNumberVis)`\n  ${(_ref) => {let { theme } = _ref;return `\n    font-family: ${theme.typography.families.sansSerif};\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: flex-start;\n\n    &.no-trendline .subheader-line {\n      padding-bottom: 0.3em;\n    }\n\n    .text-container {\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: flex-start;\n      .alert {\n        font-size: ${theme.typography.sizes.s};\n        margin: -0.5em 0 0.4em;\n        line-height: 1;\n        padding: ${theme.gridUnit}px;\n        border-radius: ${theme.gridUnit}px;\n      }\n    }\n\n    .kicker {\n      line-height: 1em;\n      padding-bottom: 2em;\n    }\n\n    .header-line {\n      position: relative;\n      line-height: 1em;\n      span {\n        position: absolute;\n        bottom: 0;\n      }\n    }\n\n    .subheader-line {\n      line-height: 1em;\n      padding-bottom: 0;\n    }\n\n    &.is-fallback-value {\n      .kicker,\n      .header-line,\n      .subheader-line {\n        opacity: ${theme.opacity.mediumHeavy};\n      }\n    }\n  `;}}\n`;","map":{"version":3,"mappings":"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","names":["React","t","getNumberFormatter","smartDateVerboseFormatter","computeMaxFontSize","BRAND_COLOR","styled","Echart","defaultNumberFormatter","PROPORTION","KICKER","HEADER","SUBHEADER","TRENDLINE","BigNumberVis","PureComponent","getClassName","className","showTrendLine","bigNumberFallback","props","names","createTemporaryContainer","container","document","createElement","style","position","opacity","renderFallbackWarning","formatTime","showTimestamp","renderKicker","maxHeight","timestamp","width","text","body","append","fontSize","maxWidth","remove","height","renderHeader","bigNumber","headerFormatter","colorThresholdFormatters","hasThresholdColorFormatter","Array","isArray","length","numberColor","forEach","formatterResult","formatter","getColorFromValue","onContextMenu","e","preventDefault","nativeEvent","clientX","clientY","color","renderSubheader","subheader","NO_DATA_OR_HASNT_LANDED","NO_DATA","renderTrendline","trendLineData","echartOptions","refs","some","d","eventHandlers","contextmenu","eventParams","event","stop","data","pointerEvent","drillToDetailFilters","push","col","formData","granularitySqla","grain","timeGrainSqla","op","val","formattedVal","xValueFormatter","drillToDetail","Math","floor","render","kickerFontSize","headerFontSize","subheaderFontSize","chartHeight","allTextHeight","ceil","defaultProps","mainColor","startYAxisAtZero","timeRangeFixed","theme","typography","families","sansSerif","sizes","s","gridUnit","mediumHeavy"],"sourceRoot":"","sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/plugin-chart-echarts/src/BigNumber/BigNumberViz.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { MouseEvent } from 'react';\nimport {\n  t,\n  getNumberFormatter,\n  smartDateVerboseFormatter,\n  computeMaxFontSize,\n  BRAND_COLOR,\n  styled,\n  BinaryQueryObjectFilterClause,\n} from '@superset-ui/core';\nimport Echart from '../components/Echart';\nimport { BigNumberVizProps } from './types';\nimport { EventHandlers } from '../types';\n\nconst defaultNumberFormatter = getNumberFormatter();\n\nconst PROPORTION = {\n  // text size: proportion of the chart container sans trendline\n  KICKER: 0.1,\n  HEADER: 0.3,\n  SUBHEADER: 0.125,\n  // trendline size: proportion of the whole chart container\n  TRENDLINE: 0.3,\n};\n\nclass BigNumberVis extends React.PureComponent<BigNumberVizProps> {\n  static defaultProps = {\n    className: '',\n    headerFormatter: defaultNumberFormatter,\n    formatTime: smartDateVerboseFormatter,\n    headerFontSize: PROPORTION.HEADER,\n    kickerFontSize: PROPORTION.KICKER,\n    mainColor: BRAND_COLOR,\n    showTimestamp: false,\n    showTrendLine: false,\n    startYAxisAtZero: true,\n    subheader: '',\n    subheaderFontSize: PROPORTION.SUBHEADER,\n    timeRangeFixed: false,\n  };\n\n  getClassName() {\n    const { className, showTrendLine, bigNumberFallback } = this.props;\n    const names = `superset-legacy-chart-big-number ${className} ${\n      bigNumberFallback ? 'is-fallback-value' : ''\n    }`;\n    if (showTrendLine) return names;\n    return `${names} no-trendline`;\n  }\n\n  createTemporaryContainer() {\n    const container = document.createElement('div');\n    container.className = this.getClassName();\n    container.style.position = 'absolute'; // so it won't disrupt page layout\n    container.style.opacity = '0'; // and not visible\n    return container;\n  }\n\n  renderFallbackWarning() {\n    const { bigNumberFallback, formatTime, showTimestamp } = this.props;\n    if (!formatTime || !bigNumberFallback || showTimestamp) return null;\n    return (\n      <span\n        className=\"alert alert-warning\"\n        role=\"alert\"\n        title={t(\n          `Last available value seen on %s`,\n          formatTime(bigNumberFallback[0]),\n        )}\n      >\n        {t('Not up to date')}\n      </span>\n    );\n  }\n\n  renderKicker(maxHeight: number) {\n    const { timestamp, showTimestamp, formatTime, width } = this.props;\n    if (\n      !formatTime ||\n      !showTimestamp ||\n      typeof timestamp === 'string' ||\n      typeof timestamp === 'boolean'\n    )\n      return null;\n\n    const text = timestamp === null ? '' : formatTime(timestamp);\n\n    const container = this.createTemporaryContainer();\n    document.body.append(container);\n    const fontSize = computeMaxFontSize({\n      text,\n      maxWidth: width,\n      maxHeight,\n      className: 'kicker',\n      container,\n    });\n    container.remove();\n\n    return (\n      <div\n        className=\"kicker\"\n        style={{\n          fontSize,\n          height: maxHeight,\n        }}\n      >\n        {text}\n      </div>\n    );\n  }\n\n  renderHeader(maxHeight: number) {\n    const { bigNumber, headerFormatter, width, colorThresholdFormatters } =\n      this.props;\n    // @ts-ignore\n    const text = bigNumber === null ? t('No data') : headerFormatter(bigNumber);\n\n    const hasThresholdColorFormatter =\n      Array.isArray(colorThresholdFormatters) &&\n      colorThresholdFormatters.length > 0;\n\n    let numberColor;\n    if (hasThresholdColorFormatter) {\n      colorThresholdFormatters!.forEach(formatter => {\n        const formatterResult = bigNumber\n          ? formatter.getColorFromValue(bigNumber as number)\n          : false;\n        if (formatterResult) {\n          numberColor = formatterResult;\n        }\n      });\n    } else {\n      numberColor = 'black';\n    }\n\n    const container = this.createTemporaryContainer();\n    document.body.append(container);\n    const fontSize = computeMaxFontSize({\n      text,\n      maxWidth: width - 8, // Decrease 8px for more precise font size\n      maxHeight,\n      className: 'header-line',\n      container,\n    });\n    container.remove();\n\n    const onContextMenu = (e: MouseEvent<HTMLDivElement>) => {\n      if (this.props.onContextMenu) {\n        e.preventDefault();\n        this.props.onContextMenu(e.nativeEvent.clientX, e.nativeEvent.clientY);\n      }\n    };\n\n    return (\n      <div\n        className=\"header-line\"\n        style={{\n          fontSize,\n          height: maxHeight,\n          color: numberColor,\n        }}\n        onContextMenu={onContextMenu}\n      >\n        {text}\n      </div>\n    );\n  }\n\n  renderSubheader(maxHeight: number) {\n    const { bigNumber, subheader, width, bigNumberFallback } = this.props;\n    let fontSize = 0;\n\n    const NO_DATA_OR_HASNT_LANDED = t(\n      'No data after filtering or data is NULL for the latest time record',\n    );\n    const NO_DATA = t(\n      'Try applying different filters or ensuring your datasource has data',\n    );\n    let text = subheader;\n    if (bigNumber === null) {\n      text = bigNumberFallback ? NO_DATA : NO_DATA_OR_HASNT_LANDED;\n    }\n    if (text) {\n      const container = this.createTemporaryContainer();\n      document.body.append(container);\n      fontSize = computeMaxFontSize({\n        text,\n        maxWidth: width,\n        maxHeight,\n        className: 'subheader-line',\n        container,\n      });\n      container.remove();\n\n      return (\n        <div\n          className=\"subheader-line\"\n          style={{\n            fontSize,\n            height: maxHeight,\n          }}\n        >\n          {text}\n        </div>\n      );\n    }\n    return null;\n  }\n\n  renderTrendline(maxHeight: number) {\n    const { width, trendLineData, echartOptions, refs } = this.props;\n\n    // if can't find any non-null values, no point rendering the trendline\n    if (!trendLineData?.some(d => d[1] !== null)) {\n      return null;\n    }\n\n    const eventHandlers: EventHandlers = {\n      contextmenu: eventParams => {\n        if (this.props.onContextMenu) {\n          eventParams.event.stop();\n          const { data } = eventParams;\n          if (data) {\n            const pointerEvent = eventParams.event.event;\n            const drillToDetailFilters: BinaryQueryObjectFilterClause[] = [];\n            drillToDetailFilters.push({\n              col: this.props.formData?.granularitySqla,\n              grain: this.props.formData?.timeGrainSqla,\n              op: '==',\n              val: data[0],\n              formattedVal: this.props.xValueFormatter?.(data[0]),\n            });\n            this.props.onContextMenu(\n              pointerEvent.clientX,\n              pointerEvent.clientY,\n              { drillToDetail: drillToDetailFilters },\n            );\n          }\n        }\n      },\n    };\n\n    return (\n      echartOptions && (\n        <Echart\n          refs={refs}\n          width={Math.floor(width)}\n          height={maxHeight}\n          echartOptions={echartOptions}\n          eventHandlers={eventHandlers}\n        />\n      )\n    );\n  }\n\n  render() {\n    const {\n      showTrendLine,\n      height,\n      kickerFontSize,\n      headerFontSize,\n      subheaderFontSize,\n    } = this.props;\n    const className = this.getClassName();\n\n    if (showTrendLine) {\n      const chartHeight = Math.floor(PROPORTION.TRENDLINE * height);\n      const allTextHeight = height - chartHeight;\n\n      return (\n        <div className={className}>\n          <div className=\"text-container\" style={{ height: allTextHeight }}>\n            {this.renderFallbackWarning()}\n            {this.renderKicker(\n              Math.ceil(\n                (kickerFontSize || 0) * (1 - PROPORTION.TRENDLINE) * height,\n              ),\n            )}\n            {this.renderHeader(\n              Math.ceil(headerFontSize * (1 - PROPORTION.TRENDLINE) * height),\n            )}\n            {this.renderSubheader(\n              Math.ceil(\n                subheaderFontSize * (1 - PROPORTION.TRENDLINE) * height,\n              ),\n            )}\n          </div>\n          {this.renderTrendline(chartHeight)}\n        </div>\n      );\n    }\n\n    return (\n      <div className={className} style={{ height }}>\n        {this.renderFallbackWarning()}\n        {this.renderKicker((kickerFontSize || 0) * height)}\n        {this.renderHeader(Math.ceil(headerFontSize * height))}\n        {this.renderSubheader(Math.ceil(subheaderFontSize * height))}\n      </div>\n    );\n  }\n}\n\nexport default styled(BigNumberVis)`\n  ${({ theme }) => `\n    font-family: ${theme.typography.families.sansSerif};\n    position: relative;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: flex-start;\n\n    &.no-trendline .subheader-line {\n      padding-bottom: 0.3em;\n    }\n\n    .text-container {\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: flex-start;\n      .alert {\n        font-size: ${theme.typography.sizes.s};\n        margin: -0.5em 0 0.4em;\n        line-height: 1;\n        padding: ${theme.gridUnit}px;\n        border-radius: ${theme.gridUnit}px;\n      }\n    }\n\n    .kicker {\n      line-height: 1em;\n      padding-bottom: 2em;\n    }\n\n    .header-line {\n      position: relative;\n      line-height: 1em;\n      span {\n        position: absolute;\n        bottom: 0;\n      }\n    }\n\n    .subheader-line {\n      line-height: 1em;\n      padding-bottom: 0;\n    }\n\n    &.is-fallback-value {\n      .kicker,\n      .header-line,\n      .subheader-line {\n        opacity: ${theme.opacity.mediumHeavy};\n      }\n    }\n  `}\n`;\n"]},"metadata":{},"sourceType":"module"}