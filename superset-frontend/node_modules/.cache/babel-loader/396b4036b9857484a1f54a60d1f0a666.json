{"ast":null,"code":"import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\"; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useCallback, useEffect } from 'react';\n/* eslint camelcase: 0 */\nimport URI from 'urijs';\nimport {\nbuildQueryContext,\nensureIsArray,\ngetChartBuildQueryRegistry,\ngetChartMetadataRegistry,\nSupersetClient } from\n'@superset-ui/core';\nimport { availableDomains } from 'src/utils/hostNamesConfig';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { optionLabel } from 'src/utils/common';\nimport { URL_PARAMS } from 'src/constants';\nimport {\nMULTI_OPERATORS,\nOPERATOR_ENUM_TO_OPERATOR_TYPE,\nUNSAVED_CHART_ID } from\n'src/explore/constants';\nimport { DashboardStandaloneMode } from 'src/dashboard/util/constants';\n\nexport function getChartKey(explore) {var _ref, _slice$slice_id;\n  const { slice, form_data } = explore;\n  return (_ref = (_slice$slice_id = slice == null ? void 0 : slice.slice_id) != null ? _slice$slice_id : form_data == null ? void 0 : form_data.slice_id) != null ? _ref : UNSAVED_CHART_ID;\n}\n\nlet requestCounter = 0;\nexport function getHostName(allowDomainSharding) {if (allowDomainSharding === void 0) {allowDomainSharding = false;}\n  let currentIndex = 0;\n  if (allowDomainSharding) {\n    currentIndex = requestCounter % availableDomains.length;\n    requestCounter += 1;\n\n    // if domain sharding is enabled, skip main domain for fetching chart API\n    // leave main domain free for other calls like fav star, save change, etc.\n    // to make dashboard be responsive when it's loading large number of charts\n    if (currentIndex === 0) {\n      currentIndex += 1;\n      requestCounter += 1;\n    }\n  }\n  return availableDomains[currentIndex];\n}\n\nexport function getAnnotationJsonUrl(slice_id, force) {\n  if (slice_id === null || slice_id === undefined) {\n    return null;\n  }\n\n  const uri = URI(window.location.search);\n  return uri.\n  pathname('/api/v1/chart/data').\n  search({\n    form_data: safeStringify({ slice_id }),\n    force }).\n\n  toString();\n}\n\nexport function getURIDirectory(endpointType) {var _context;if (endpointType === void 0) {endpointType = 'base';}\n  // Building the directory part of the URI\n  if (\n  _includesInstanceProperty(_context = ['full', 'json', 'csv', 'query', 'results', 'samples']).call(_context,\n  endpointType))\n\n  {\n    return '/superset/explore_json/';\n  }\n  return '/explore/';\n}\n\nexport function mountExploreUrl(endpointType, extraSearch, force) {if (extraSearch === void 0) {extraSearch = {};}if (force === void 0) {force = false;}\n  const uri = new URI('/');\n  const directory = getURIDirectory(endpointType);\n  const search = uri.search(true);\n  Object.keys(extraSearch).forEach((key) => {\n    search[key] = extraSearch[key];\n  });\n  if (endpointType === URL_PARAMS.standalone.name) {\n    if (force) {\n      search.force = '1';\n    }\n    search.standalone = DashboardStandaloneMode.HIDE_NAV;\n  }\n  return uri.directory(directory).search(search).toString();\n}\n\nexport function getChartDataUri(_ref2) {let { path, qs, allowDomainSharding = false } = _ref2;\n  // The search params from the window.location are carried through,\n  // but can be specified with curUrl (used for unit tests to spoof\n  // the window.location).\n  let uri = new URI({\n    protocol: window.location.protocol.slice(0, -1),\n    hostname: getHostName(allowDomainSharding),\n    port: window.location.port ? window.location.port : '',\n    path });\n\n  if (qs) {\n    uri = uri.search(qs);\n  }\n  return uri;\n}\n\n/**\n * This gets the minimal url for the given form data.\n * If there are dashboard overrides present in the form data,\n * they will not be included in the url.\n */\nexport function getExploreUrl(_ref3)\n\n\n\n\n\n\n\n{let { formData, endpointType = 'base', force = false, curUrl = null, requestParams = {}, allowDomainSharding = false, method = 'POST' } = _ref3;\n  if (!formData.datasource) {\n    return null;\n  }\n\n  // label_colors should not pollute the URL\n  // eslint-disable-next-line no-param-reassign\n  delete formData.label_colors;\n\n  let uri = getChartDataUri({ path: '/', allowDomainSharding });\n  if (curUrl) {\n    uri = URI(URI(curUrl).search());\n  }\n\n  const directory = getURIDirectory(endpointType);\n\n  // Building the querystring (search) part of the URI\n  const search = uri.search(true);\n  const { slice_id, extra_filters, adhoc_filters, viz_type } = formData;\n  if (slice_id) {\n    const form_data = { slice_id };\n    if (method === 'GET') {\n      form_data.viz_type = viz_type;\n      if (extra_filters && extra_filters.length) {\n        form_data.extra_filters = extra_filters;\n      }\n      if (adhoc_filters && adhoc_filters.length) {\n        form_data.adhoc_filters = adhoc_filters;\n      }\n    }\n    search.form_data = safeStringify(form_data);\n  }\n  if (force) {\n    search.force = 'true';\n  }\n  if (endpointType === 'csv') {\n    search.csv = 'true';\n  }\n  if (endpointType === URL_PARAMS.standalone.name) {\n    search.standalone = '1';\n  }\n  if (endpointType === 'query') {\n    search.query = 'true';\n  }\n  if (endpointType === 'results') {\n    search.results = 'true';\n  }\n  if (endpointType === 'samples') {\n    search.samples = 'true';\n  }\n  const paramNames = Object.keys(requestParams);\n  if (paramNames.length) {\n    paramNames.forEach((name) => {\n      if (requestParams.hasOwnProperty(name)) {\n        search[name] = requestParams[name];\n      }\n    });\n  }\n  return uri.search(search).directory(directory).toString();\n}\n\nexport const shouldUseLegacyApi = (formData) => {\n  const vizMetadata = getChartMetadataRegistry().get(formData.viz_type);\n  return vizMetadata ? vizMetadata.useLegacyApi : false;\n};\n\nexport const buildV1ChartDataPayload = (_ref4) =>\n\n\n\n\n\n\n{var _getChartBuildQueryRe;let { formData, force, resultFormat, resultType, setDataMask, ownState } = _ref4;\n  const buildQuery = (_getChartBuildQueryRe =\n  getChartBuildQueryRegistry().get(formData.viz_type)) != null ? _getChartBuildQueryRe :\n  (buildQueryformData) =>\n  buildQueryContext(buildQueryformData, (baseQueryObject) => [\n  {\n    ...baseQueryObject }]);\n\n\n  return buildQuery(\n  {\n    ...formData,\n    force,\n    result_format: resultFormat,\n    result_type: resultType },\n\n  {\n    ownState,\n    hooks: {\n      setDataMask } });\n\n\n\n};\n\nexport const getLegacyEndpointType = (_ref5) => {let { resultType, resultFormat } = _ref5;return (\n    resultFormat === 'csv' ? resultFormat : resultType);};\n\nexport const exportChart = (_ref6) =>\n\n\n\n\n\n{let { formData, resultFormat = 'json', resultType = 'full', force = false, ownState = {} } = _ref6;\n  let url;\n  let payload;\n  if (shouldUseLegacyApi(formData)) {\n    const endpointType = getLegacyEndpointType({ resultFormat, resultType });\n    url = getExploreUrl({\n      formData,\n      endpointType,\n      allowDomainSharding: false });\n\n    payload = formData;\n  } else {\n    url = '/api/v1/chart/data';\n    payload = buildV1ChartDataPayload({\n      formData,\n      force,\n      resultFormat,\n      resultType,\n      ownState });\n\n  }\n\n  SupersetClient.postForm(url, { form_data: safeStringify(payload) });\n};\n\nexport const exploreChart = (formData, requestParams) => {\n  const url = getExploreUrl({\n    formData,\n    endpointType: 'base',\n    allowDomainSharding: false,\n    requestParams });\n\n  SupersetClient.postForm(url, { form_data: safeStringify(formData) });\n};\n\nexport const useDebouncedEffect = (effect, delay, deps) => {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const callback = useCallback(effect, deps);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      callback();\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [callback, delay]);\n};\n\nexport const getSimpleSQLExpression = (subject, operator, comparator) => {var _subject$column_name;\n  const isMulti =\n  [...MULTI_OPERATORS].\n  map((op) => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation).\n  indexOf(operator) >= 0;\n  // If returned value is an object after changing dataset\n  let expression =\n  typeof subject === 'object' ? (_subject$column_name = subject == null ? void 0 : subject.column_name) != null ? _subject$column_name : '' : subject != null ? subject : '';\n  if (subject && operator) {\n    expression += ` ${operator}`;\n    const firstValue =\n    isMulti && Array.isArray(comparator) ? comparator[0] : comparator;\n    const comparatorArray = ensureIsArray(comparator);\n    const isString =\n    firstValue !== undefined && Number.isNaN(Number(firstValue));\n    const quote = isString ? \"'\" : '';\n    const [prefix, suffix] = isMulti ? ['(', ')'] : ['', ''];\n    const formattedComparators = comparatorArray.\n    map((val) => optionLabel(val)).\n    map(\n    (val) =>\n    `${quote}${isString ? String(val).replace(\"'\", \"''\") : val}${quote}`);\n\n    if (comparatorArray.length > 0) {\n      expression += ` ${prefix}${formattedComparators.join(', ')}${suffix}`;\n    }\n  }\n  return expression;\n};\n\nexport function formatSelectOptions(options) {\n  return options.map((opt) => [opt, opt.toString()]);\n}","map":{"version":3,"names":["useCallback","useEffect","URI","buildQueryContext","ensureIsArray","getChartBuildQueryRegistry","getChartMetadataRegistry","SupersetClient","availableDomains","safeStringify","optionLabel","URL_PARAMS","MULTI_OPERATORS","OPERATOR_ENUM_TO_OPERATOR_TYPE","UNSAVED_CHART_ID","DashboardStandaloneMode","getChartKey","explore","slice","form_data","slice_id","requestCounter","getHostName","allowDomainSharding","currentIndex","length","getAnnotationJsonUrl","force","undefined","uri","window","location","search","pathname","toString","getURIDirectory","endpointType","mountExploreUrl","extraSearch","directory","Object","keys","forEach","key","standalone","name","HIDE_NAV","getChartDataUri","path","qs","protocol","hostname","port","getExploreUrl","formData","curUrl","requestParams","method","datasource","label_colors","extra_filters","adhoc_filters","viz_type","csv","query","results","samples","paramNames","hasOwnProperty","shouldUseLegacyApi","vizMetadata","get","useLegacyApi","buildV1ChartDataPayload","resultFormat","resultType","setDataMask","ownState","buildQuery","buildQueryformData","baseQueryObject","result_format","result_type","hooks","getLegacyEndpointType","exportChart","url","payload","postForm","exploreChart","useDebouncedEffect","effect","delay","deps","callback","handler","setTimeout","clearTimeout","getSimpleSQLExpression","subject","operator","comparator","isMulti","map","op","operation","indexOf","expression","column_name","firstValue","Array","isArray","comparatorArray","isString","Number","isNaN","quote","prefix","suffix","formattedComparators","val","String","replace","join","formatSelectOptions","options","opt"],"sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/explore/exploreUtils/index.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useCallback, useEffect } from 'react';\n/* eslint camelcase: 0 */\nimport URI from 'urijs';\nimport {\n  buildQueryContext,\n  ensureIsArray,\n  getChartBuildQueryRegistry,\n  getChartMetadataRegistry,\n  SupersetClient,\n} from '@superset-ui/core';\nimport { availableDomains } from 'src/utils/hostNamesConfig';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { optionLabel } from 'src/utils/common';\nimport { URL_PARAMS } from 'src/constants';\nimport {\n  MULTI_OPERATORS,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n  UNSAVED_CHART_ID,\n} from 'src/explore/constants';\nimport { DashboardStandaloneMode } from 'src/dashboard/util/constants';\n\nexport function getChartKey(explore) {\n  const { slice, form_data } = explore;\n  return slice?.slice_id ?? form_data?.slice_id ?? UNSAVED_CHART_ID;\n}\n\nlet requestCounter = 0;\nexport function getHostName(allowDomainSharding = false) {\n  let currentIndex = 0;\n  if (allowDomainSharding) {\n    currentIndex = requestCounter % availableDomains.length;\n    requestCounter += 1;\n\n    // if domain sharding is enabled, skip main domain for fetching chart API\n    // leave main domain free for other calls like fav star, save change, etc.\n    // to make dashboard be responsive when it's loading large number of charts\n    if (currentIndex === 0) {\n      currentIndex += 1;\n      requestCounter += 1;\n    }\n  }\n  return availableDomains[currentIndex];\n}\n\nexport function getAnnotationJsonUrl(slice_id, force) {\n  if (slice_id === null || slice_id === undefined) {\n    return null;\n  }\n\n  const uri = URI(window.location.search);\n  return uri\n    .pathname('/api/v1/chart/data')\n    .search({\n      form_data: safeStringify({ slice_id }),\n      force,\n    })\n    .toString();\n}\n\nexport function getURIDirectory(endpointType = 'base') {\n  // Building the directory part of the URI\n  if (\n    ['full', 'json', 'csv', 'query', 'results', 'samples'].includes(\n      endpointType,\n    )\n  ) {\n    return '/superset/explore_json/';\n  }\n  return '/explore/';\n}\n\nexport function mountExploreUrl(endpointType, extraSearch = {}, force = false) {\n  const uri = new URI('/');\n  const directory = getURIDirectory(endpointType);\n  const search = uri.search(true);\n  Object.keys(extraSearch).forEach(key => {\n    search[key] = extraSearch[key];\n  });\n  if (endpointType === URL_PARAMS.standalone.name) {\n    if (force) {\n      search.force = '1';\n    }\n    search.standalone = DashboardStandaloneMode.HIDE_NAV;\n  }\n  return uri.directory(directory).search(search).toString();\n}\n\nexport function getChartDataUri({ path, qs, allowDomainSharding = false }) {\n  // The search params from the window.location are carried through,\n  // but can be specified with curUrl (used for unit tests to spoof\n  // the window.location).\n  let uri = new URI({\n    protocol: window.location.protocol.slice(0, -1),\n    hostname: getHostName(allowDomainSharding),\n    port: window.location.port ? window.location.port : '',\n    path,\n  });\n  if (qs) {\n    uri = uri.search(qs);\n  }\n  return uri;\n}\n\n/**\n * This gets the minimal url for the given form data.\n * If there are dashboard overrides present in the form data,\n * they will not be included in the url.\n */\nexport function getExploreUrl({\n  formData,\n  endpointType = 'base',\n  force = false,\n  curUrl = null,\n  requestParams = {},\n  allowDomainSharding = false,\n  method = 'POST',\n}) {\n  if (!formData.datasource) {\n    return null;\n  }\n\n  // label_colors should not pollute the URL\n  // eslint-disable-next-line no-param-reassign\n  delete formData.label_colors;\n\n  let uri = getChartDataUri({ path: '/', allowDomainSharding });\n  if (curUrl) {\n    uri = URI(URI(curUrl).search());\n  }\n\n  const directory = getURIDirectory(endpointType);\n\n  // Building the querystring (search) part of the URI\n  const search = uri.search(true);\n  const { slice_id, extra_filters, adhoc_filters, viz_type } = formData;\n  if (slice_id) {\n    const form_data = { slice_id };\n    if (method === 'GET') {\n      form_data.viz_type = viz_type;\n      if (extra_filters && extra_filters.length) {\n        form_data.extra_filters = extra_filters;\n      }\n      if (adhoc_filters && adhoc_filters.length) {\n        form_data.adhoc_filters = adhoc_filters;\n      }\n    }\n    search.form_data = safeStringify(form_data);\n  }\n  if (force) {\n    search.force = 'true';\n  }\n  if (endpointType === 'csv') {\n    search.csv = 'true';\n  }\n  if (endpointType === URL_PARAMS.standalone.name) {\n    search.standalone = '1';\n  }\n  if (endpointType === 'query') {\n    search.query = 'true';\n  }\n  if (endpointType === 'results') {\n    search.results = 'true';\n  }\n  if (endpointType === 'samples') {\n    search.samples = 'true';\n  }\n  const paramNames = Object.keys(requestParams);\n  if (paramNames.length) {\n    paramNames.forEach(name => {\n      if (requestParams.hasOwnProperty(name)) {\n        search[name] = requestParams[name];\n      }\n    });\n  }\n  return uri.search(search).directory(directory).toString();\n}\n\nexport const shouldUseLegacyApi = formData => {\n  const vizMetadata = getChartMetadataRegistry().get(formData.viz_type);\n  return vizMetadata ? vizMetadata.useLegacyApi : false;\n};\n\nexport const buildV1ChartDataPayload = ({\n  formData,\n  force,\n  resultFormat,\n  resultType,\n  setDataMask,\n  ownState,\n}) => {\n  const buildQuery =\n    getChartBuildQueryRegistry().get(formData.viz_type) ??\n    (buildQueryformData =>\n      buildQueryContext(buildQueryformData, baseQueryObject => [\n        {\n          ...baseQueryObject,\n        },\n      ]));\n  return buildQuery(\n    {\n      ...formData,\n      force,\n      result_format: resultFormat,\n      result_type: resultType,\n    },\n    {\n      ownState,\n      hooks: {\n        setDataMask,\n      },\n    },\n  );\n};\n\nexport const getLegacyEndpointType = ({ resultType, resultFormat }) =>\n  resultFormat === 'csv' ? resultFormat : resultType;\n\nexport const exportChart = ({\n  formData,\n  resultFormat = 'json',\n  resultType = 'full',\n  force = false,\n  ownState = {},\n}) => {\n  let url;\n  let payload;\n  if (shouldUseLegacyApi(formData)) {\n    const endpointType = getLegacyEndpointType({ resultFormat, resultType });\n    url = getExploreUrl({\n      formData,\n      endpointType,\n      allowDomainSharding: false,\n    });\n    payload = formData;\n  } else {\n    url = '/api/v1/chart/data';\n    payload = buildV1ChartDataPayload({\n      formData,\n      force,\n      resultFormat,\n      resultType,\n      ownState,\n    });\n  }\n\n  SupersetClient.postForm(url, { form_data: safeStringify(payload) });\n};\n\nexport const exploreChart = (formData, requestParams) => {\n  const url = getExploreUrl({\n    formData,\n    endpointType: 'base',\n    allowDomainSharding: false,\n    requestParams,\n  });\n  SupersetClient.postForm(url, { form_data: safeStringify(formData) });\n};\n\nexport const useDebouncedEffect = (effect, delay, deps) => {\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  const callback = useCallback(effect, deps);\n\n  useEffect(() => {\n    const handler = setTimeout(() => {\n      callback();\n    }, delay);\n\n    return () => {\n      clearTimeout(handler);\n    };\n  }, [callback, delay]);\n};\n\nexport const getSimpleSQLExpression = (subject, operator, comparator) => {\n  const isMulti =\n    [...MULTI_OPERATORS]\n      .map(op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation)\n      .indexOf(operator) >= 0;\n  // If returned value is an object after changing dataset\n  let expression =\n    typeof subject === 'object' ? subject?.column_name ?? '' : subject ?? '';\n  if (subject && operator) {\n    expression += ` ${operator}`;\n    const firstValue =\n      isMulti && Array.isArray(comparator) ? comparator[0] : comparator;\n    const comparatorArray = ensureIsArray(comparator);\n    const isString =\n      firstValue !== undefined && Number.isNaN(Number(firstValue));\n    const quote = isString ? \"'\" : '';\n    const [prefix, suffix] = isMulti ? ['(', ')'] : ['', ''];\n    const formattedComparators = comparatorArray\n      .map(val => optionLabel(val))\n      .map(\n        val =>\n          `${quote}${isString ? String(val).replace(\"'\", \"''\") : val}${quote}`,\n      );\n    if (comparatorArray.length > 0) {\n      expression += ` ${prefix}${formattedComparators.join(', ')}${suffix}`;\n    }\n  }\n  return expression;\n};\n\nexport function formatSelectOptions(options) {\n  return options.map(opt => [opt, opt.toString()]);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}