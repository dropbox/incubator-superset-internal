{"ast":null,"code":"import _isEmpty from \"lodash/isEmpty\";(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t, SupersetClient } from '@superset-ui/core';\nimport rison from 'rison';\nimport {\naddDangerToast,\naddSuccessToast } from\n'src/components/MessageToasts/actions';\n\n\nexport const SET_REPORT = 'SET_REPORT';\nexport function setReport(report, resourceId, creationMethod, filterField) {\n  return { type: SET_REPORT, report, resourceId, creationMethod, filterField };\n}\n\nexport function fetchUISpecificReport(_ref)\n\n\n\n\n{let { userId, filterField, creationMethod, resourceId } = _ref;\n  const queryParams = rison.encode({\n    filters: [\n    {\n      col: filterField,\n      opr: 'eq',\n      value: resourceId },\n\n    {\n      col: 'creation_method',\n      opr: 'eq',\n      value: creationMethod },\n\n    {\n      col: 'created_by',\n      opr: 'rel_o_m',\n      value: userId }] });\n\n\n\n  return function fetchUISpecificReportThunk(dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/report/?q=${queryParams}` }).\n\n    then((_ref2) => {let { json } = _ref2;\n      dispatch(setReport(json, resourceId, creationMethod, filterField));\n    }).\n    catch(() =>\n    dispatch(\n    addDangerToast(\n    t(\n    'There was an issue fetching reports attached to this dashboard.'))));\n\n\n\n\n  };\n}\n\nconst structureFetchAction = (dispatch, getState) => {\n  const state = getState();\n  const { user, dashboardInfo, charts, explore } = state;\n  if (!_isEmpty(dashboardInfo)) {\n    dispatch(\n    fetchUISpecificReport({\n      userId: user.userId,\n      filterField: 'dashboard_id',\n      creationMethod: 'dashboards',\n      resourceId: dashboardInfo.id }));\n\n\n  } else {var _explore$user;\n    const [chartArr] = Object.keys(charts);\n    dispatch(\n    fetchUISpecificReport({\n      userId: ((_explore$user = explore.user) == null ? void 0 : _explore$user.userId) || (user == null ? void 0 : user.userId),\n      filterField: 'chart_id',\n      creationMethod: 'charts',\n      resourceId: charts[chartArr].id }));\n\n\n  }\n};\n\nexport const ADD_REPORT = 'ADD_REPORT';\n\nexport const addReport = (report) => (dispatch) =>\nSupersetClient.post({\n  endpoint: `/api/v1/report/`,\n  jsonPayload: report }).\nthen((_ref3) => {let { json } = _ref3;\n  dispatch({ type: ADD_REPORT, json });\n  dispatch(addSuccessToast(t('The report has been created')));\n});\n\nexport const EDIT_REPORT = 'EDIT_REPORT';\n\nexport const editReport = (id, report) => (dispatch) =>\nSupersetClient.put({\n  endpoint: `/api/v1/report/${id}`,\n  jsonPayload: report }).\nthen((_ref4) => {let { json } = _ref4;\n  dispatch({ type: EDIT_REPORT, json });\n  dispatch(addSuccessToast(t('Report updated')));\n});\n\nexport function toggleActive(report, isActive) {\n  return function toggleActiveThunk(dispatch) {\n    return SupersetClient.put({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`),\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        active: isActive }) }).\n\n\n    catch(() => {\n      dispatch(\n      addDangerToast(\n      t('We were unable to active or deactivate this report.')));\n\n\n    }).\n    finally(() => {\n      dispatch(structureFetchAction);\n    });\n  };\n}\n\nexport const DELETE_REPORT = 'DELETE_REPORT';\n\nexport function deleteActiveReport(report) {\n  return function deleteActiveReportThunk(dispatch) {\n    return SupersetClient.delete({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`) }).\n\n    catch(() => {\n      dispatch(addDangerToast(t('Your report could not be deleted')));\n    }).\n    finally(() => {\n      dispatch({ type: DELETE_REPORT, report });\n      dispatch(addSuccessToast(t('Deleted: %s', report.name)));\n    });\n  };\n};(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(SET_REPORT, \"SET_REPORT\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(setReport, \"setReport\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(fetchUISpecificReport, \"fetchUISpecificReport\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(structureFetchAction, \"structureFetchAction\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(ADD_REPORT, \"ADD_REPORT\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(addReport, \"addReport\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(EDIT_REPORT, \"EDIT_REPORT\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(editReport, \"editReport\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(toggleActive, \"toggleActive\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(DELETE_REPORT, \"DELETE_REPORT\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");reactHotLoader.register(deleteActiveReport, \"deleteActiveReport\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["t","SupersetClient","rison","addDangerToast","addSuccessToast","SET_REPORT","setReport","report","resourceId","creationMethod","filterField","type","fetchUISpecificReport","userId","queryParams","encode","filters","col","opr","value","fetchUISpecificReportThunk","dispatch","get","endpoint","then","json","catch","structureFetchAction","getState","state","user","dashboardInfo","charts","explore","id","chartArr","Object","keys","ADD_REPORT","addReport","post","jsonPayload","EDIT_REPORT","editReport","put","toggleActive","isActive","toggleActiveThunk","encodeURI","headers","body","JSON","stringify","active","finally","DELETE_REPORT","deleteActiveReport","deleteActiveReportThunk","delete","name"],"sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/src/reports/actions/reports.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t, SupersetClient } from '@superset-ui/core';\nimport rison from 'rison';\nimport {\n  addDangerToast,\n  addSuccessToast,\n} from 'src/components/MessageToasts/actions';\nimport { isEmpty } from 'lodash';\n\nexport const SET_REPORT = 'SET_REPORT';\nexport function setReport(report, resourceId, creationMethod, filterField) {\n  return { type: SET_REPORT, report, resourceId, creationMethod, filterField };\n}\n\nexport function fetchUISpecificReport({\n  userId,\n  filterField,\n  creationMethod,\n  resourceId,\n}) {\n  const queryParams = rison.encode({\n    filters: [\n      {\n        col: filterField,\n        opr: 'eq',\n        value: resourceId,\n      },\n      {\n        col: 'creation_method',\n        opr: 'eq',\n        value: creationMethod,\n      },\n      {\n        col: 'created_by',\n        opr: 'rel_o_m',\n        value: userId,\n      },\n    ],\n  });\n  return function fetchUISpecificReportThunk(dispatch) {\n    return SupersetClient.get({\n      endpoint: `/api/v1/report/?q=${queryParams}`,\n    })\n      .then(({ json }) => {\n        dispatch(setReport(json, resourceId, creationMethod, filterField));\n      })\n      .catch(() =>\n        dispatch(\n          addDangerToast(\n            t(\n              'There was an issue fetching reports attached to this dashboard.',\n            ),\n          ),\n        ),\n      );\n  };\n}\n\nconst structureFetchAction = (dispatch, getState) => {\n  const state = getState();\n  const { user, dashboardInfo, charts, explore } = state;\n  if (!isEmpty(dashboardInfo)) {\n    dispatch(\n      fetchUISpecificReport({\n        userId: user.userId,\n        filterField: 'dashboard_id',\n        creationMethod: 'dashboards',\n        resourceId: dashboardInfo.id,\n      }),\n    );\n  } else {\n    const [chartArr] = Object.keys(charts);\n    dispatch(\n      fetchUISpecificReport({\n        userId: explore.user?.userId || user?.userId,\n        filterField: 'chart_id',\n        creationMethod: 'charts',\n        resourceId: charts[chartArr].id,\n      }),\n    );\n  }\n};\n\nexport const ADD_REPORT = 'ADD_REPORT';\n\nexport const addReport = report => dispatch =>\n  SupersetClient.post({\n    endpoint: `/api/v1/report/`,\n    jsonPayload: report,\n  }).then(({ json }) => {\n    dispatch({ type: ADD_REPORT, json });\n    dispatch(addSuccessToast(t('The report has been created')));\n  });\n\nexport const EDIT_REPORT = 'EDIT_REPORT';\n\nexport const editReport = (id, report) => dispatch =>\n  SupersetClient.put({\n    endpoint: `/api/v1/report/${id}`,\n    jsonPayload: report,\n  }).then(({ json }) => {\n    dispatch({ type: EDIT_REPORT, json });\n    dispatch(addSuccessToast(t('Report updated')));\n  });\n\nexport function toggleActive(report, isActive) {\n  return function toggleActiveThunk(dispatch) {\n    return SupersetClient.put({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`),\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify({\n        active: isActive,\n      }),\n    })\n      .catch(() => {\n        dispatch(\n          addDangerToast(\n            t('We were unable to active or deactivate this report.'),\n          ),\n        );\n      })\n      .finally(() => {\n        dispatch(structureFetchAction);\n      });\n  };\n}\n\nexport const DELETE_REPORT = 'DELETE_REPORT';\n\nexport function deleteActiveReport(report) {\n  return function deleteActiveReportThunk(dispatch) {\n    return SupersetClient.delete({\n      endpoint: encodeURI(`/api/v1/report/${report.id}`),\n    })\n      .catch(() => {\n        dispatch(addDangerToast(t('Your report could not be deleted')));\n      })\n      .finally(() => {\n        dispatch({ type: DELETE_REPORT, report });\n        dispatch(addSuccessToast(t('Deleted: %s', report.name)));\n      });\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}