{"ast":null,"code":"import _includesInstanceProperty from \"@babel/runtime-corejs3/core-js-stable/instance/includes\"; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport isTruthy from './utils/isTruthy';\nimport {\ntokenizeToNumericArray,\ntokenizeToStringArray } from\n'./utils/tokenize';\nimport { formatLabel } from './utils';\n\nconst NOOP = () => {};\n\nconst grabD3Format = (datasource, targetMetric) => {\n  let foundFormatter;\n  const { metrics = [] } = datasource || {};\n  metrics.forEach((metric) => {\n    if (metric.d3format && metric.metric_name === targetMetric) {\n      foundFormatter = metric.d3format;\n    }\n  });\n\n  return foundFormatter;\n};\n\nexport default function transformProps(chartProps) {var _context;\n  const {\n    width,\n    height,\n    annotationData,\n    datasource,\n    formData,\n    hooks,\n    queriesData } =\n  chartProps;\n\n  const { onAddFilter = NOOP, onError = NOOP } = hooks;\n\n  const {\n    annotationLayers,\n    barStacked,\n    bottomMargin,\n    colorPicker,\n    colorScheme,\n    comparisonType,\n    contribution,\n    donut,\n    entity,\n    labelsOutside,\n    leftMargin,\n    lineInterpolation,\n    maxBubbleSize,\n    metric,\n    metrics = [],\n    orderBars,\n    pieLabelType,\n    reduceXTicks,\n    richTooltip,\n    sendTimeRange,\n    showBarValue,\n    showBrush,\n    showControls,\n    showLabels,\n    showLegend,\n    showMarkers,\n    size,\n    stackedStyle,\n    vizType,\n    x,\n    xAxisFormat,\n    xAxisLabel,\n    xAxisShowminmax,\n    xLogScale,\n    xTicksLayout,\n    y,\n    yAxisBounds,\n    yAxis2Bounds,\n    yAxisLabel,\n    yAxisShowminmax,\n    yAxis2Showminmax,\n    yLogScale,\n    sliceId } =\n  formData;\n\n  let {\n    markerLabels,\n    markerLines,\n    markerLineLabels,\n    markers,\n    numberFormat,\n    rangeLabels,\n    ranges,\n    yAxisFormat } =\n  formData;\n\n  const rawData = queriesData[0].data || [];\n  const data = Array.isArray(rawData) ?\n  rawData.map((row) => ({\n    ...row,\n    values: row.values.map((value) => ({ ...value })),\n    key: formatLabel(row.key, datasource.verboseMap) })) :\n\n  rawData;\n\n  if (vizType === 'pie') {\n    numberFormat = numberFormat || grabD3Format(datasource, metric);\n  } else if (\n  _includesInstanceProperty(_context = ['line', 'dist_bar', 'bar', 'area']).call(_context, chartProps.formData.vizType))\n  {\n    yAxisFormat =\n    yAxisFormat ||\n    grabD3Format(datasource, metrics.length > 0 ? metrics[0] : undefined);\n  } else if (vizType === 'bullet') {\n    ranges = tokenizeToNumericArray(ranges) || [0, data.measures * 1.1];\n    rangeLabels = tokenizeToStringArray(rangeLabels);\n    markerLabels = tokenizeToStringArray(markerLabels);\n    markerLines = tokenizeToNumericArray(markerLines);\n    markerLineLabels = tokenizeToStringArray(markerLineLabels);\n    markers = tokenizeToNumericArray(markers);\n  }\n\n  return {\n    width,\n    height,\n    data,\n    annotationData,\n    annotationLayers,\n    areaStackedStyle: stackedStyle,\n    baseColor: colorPicker,\n    bottomMargin,\n    colorScheme,\n    comparisonType,\n    contribution,\n    entity,\n    isBarStacked: barStacked,\n    isDonut: donut,\n    isPieLabelOutside: labelsOutside,\n    leftMargin,\n    lineInterpolation,\n    markerLabels,\n    markerLines,\n    markerLineLabels,\n    markers,\n    maxBubbleSize: parseInt(maxBubbleSize, 10),\n    numberFormat,\n    onBrushEnd: isTruthy(sendTimeRange) ?\n    (timeRange) => {\n      onAddFilter('__time_range', timeRange, false, true);\n    } :\n    undefined,\n    onError,\n    orderBars,\n    pieLabelType,\n    rangeLabels,\n    ranges,\n    reduceXTicks,\n    showBarValue,\n    showBrush,\n    showControls,\n    showLabels,\n    showLegend,\n    showMarkers,\n    sizeField: size,\n    useRichTooltip: richTooltip,\n    vizType,\n    xAxisFormat,\n    xAxisLabel,\n    xAxisShowMinMax: xAxisShowminmax,\n    xField: x,\n    xIsLogScale: xLogScale,\n    xTicksLayout,\n    yAxisFormat,\n    yAxisBounds,\n    yAxis2Bounds,\n    yAxisLabel,\n    yAxisShowMinMax: yAxisShowminmax,\n    yAxis2ShowMinMax: yAxis2Showminmax,\n    yField: y,\n    yIsLogScale: yLogScale,\n    sliceId };\n\n}","map":{"version":3,"names":["isTruthy","tokenizeToNumericArray","tokenizeToStringArray","formatLabel","NOOP","grabD3Format","datasource","targetMetric","foundFormatter","metrics","forEach","metric","d3format","metric_name","transformProps","chartProps","width","height","annotationData","formData","hooks","queriesData","onAddFilter","onError","annotationLayers","barStacked","bottomMargin","colorPicker","colorScheme","comparisonType","contribution","donut","entity","labelsOutside","leftMargin","lineInterpolation","maxBubbleSize","orderBars","pieLabelType","reduceXTicks","richTooltip","sendTimeRange","showBarValue","showBrush","showControls","showLabels","showLegend","showMarkers","size","stackedStyle","vizType","x","xAxisFormat","xAxisLabel","xAxisShowminmax","xLogScale","xTicksLayout","y","yAxisBounds","yAxis2Bounds","yAxisLabel","yAxisShowminmax","yAxis2Showminmax","yLogScale","sliceId","markerLabels","markerLines","markerLineLabels","markers","numberFormat","rangeLabels","ranges","yAxisFormat","rawData","data","Array","isArray","map","row","values","value","key","verboseMap","length","undefined","measures","areaStackedStyle","baseColor","isBarStacked","isDonut","isPieLabelOutside","parseInt","onBrushEnd","timeRange","sizeField","useRichTooltip","xAxisShowMinMax","xField","xIsLogScale","yAxisShowMinMax","yAxis2ShowMinMax","yField","yIsLogScale"],"sources":["/Users/zhaorui/src/incubator-superset-internal/superset-frontend/plugins/legacy-preset-chart-nvd3/src/transformProps.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport isTruthy from './utils/isTruthy';\nimport {\n  tokenizeToNumericArray,\n  tokenizeToStringArray,\n} from './utils/tokenize';\nimport { formatLabel } from './utils';\n\nconst NOOP = () => {};\n\nconst grabD3Format = (datasource, targetMetric) => {\n  let foundFormatter;\n  const { metrics = [] } = datasource || {};\n  metrics.forEach(metric => {\n    if (metric.d3format && metric.metric_name === targetMetric) {\n      foundFormatter = metric.d3format;\n    }\n  });\n\n  return foundFormatter;\n};\n\nexport default function transformProps(chartProps) {\n  const {\n    width,\n    height,\n    annotationData,\n    datasource,\n    formData,\n    hooks,\n    queriesData,\n  } = chartProps;\n\n  const { onAddFilter = NOOP, onError = NOOP } = hooks;\n\n  const {\n    annotationLayers,\n    barStacked,\n    bottomMargin,\n    colorPicker,\n    colorScheme,\n    comparisonType,\n    contribution,\n    donut,\n    entity,\n    labelsOutside,\n    leftMargin,\n    lineInterpolation,\n    maxBubbleSize,\n    metric,\n    metrics = [],\n    orderBars,\n    pieLabelType,\n    reduceXTicks,\n    richTooltip,\n    sendTimeRange,\n    showBarValue,\n    showBrush,\n    showControls,\n    showLabels,\n    showLegend,\n    showMarkers,\n    size,\n    stackedStyle,\n    vizType,\n    x,\n    xAxisFormat,\n    xAxisLabel,\n    xAxisShowminmax,\n    xLogScale,\n    xTicksLayout,\n    y,\n    yAxisBounds,\n    yAxis2Bounds,\n    yAxisLabel,\n    yAxisShowminmax,\n    yAxis2Showminmax,\n    yLogScale,\n    sliceId,\n  } = formData;\n\n  let {\n    markerLabels,\n    markerLines,\n    markerLineLabels,\n    markers,\n    numberFormat,\n    rangeLabels,\n    ranges,\n    yAxisFormat,\n  } = formData;\n\n  const rawData = queriesData[0].data || [];\n  const data = Array.isArray(rawData)\n    ? rawData.map(row => ({\n        ...row,\n        values: row.values.map(value => ({ ...value })),\n        key: formatLabel(row.key, datasource.verboseMap),\n      }))\n    : rawData;\n\n  if (vizType === 'pie') {\n    numberFormat = numberFormat || grabD3Format(datasource, metric);\n  } else if (\n    ['line', 'dist_bar', 'bar', 'area'].includes(chartProps.formData.vizType)\n  ) {\n    yAxisFormat =\n      yAxisFormat ||\n      grabD3Format(datasource, metrics.length > 0 ? metrics[0] : undefined);\n  } else if (vizType === 'bullet') {\n    ranges = tokenizeToNumericArray(ranges) || [0, data.measures * 1.1];\n    rangeLabels = tokenizeToStringArray(rangeLabels);\n    markerLabels = tokenizeToStringArray(markerLabels);\n    markerLines = tokenizeToNumericArray(markerLines);\n    markerLineLabels = tokenizeToStringArray(markerLineLabels);\n    markers = tokenizeToNumericArray(markers);\n  }\n\n  return {\n    width,\n    height,\n    data,\n    annotationData,\n    annotationLayers,\n    areaStackedStyle: stackedStyle,\n    baseColor: colorPicker,\n    bottomMargin,\n    colorScheme,\n    comparisonType,\n    contribution,\n    entity,\n    isBarStacked: barStacked,\n    isDonut: donut,\n    isPieLabelOutside: labelsOutside,\n    leftMargin,\n    lineInterpolation,\n    markerLabels,\n    markerLines,\n    markerLineLabels,\n    markers,\n    maxBubbleSize: parseInt(maxBubbleSize, 10),\n    numberFormat,\n    onBrushEnd: isTruthy(sendTimeRange)\n      ? timeRange => {\n          onAddFilter('__time_range', timeRange, false, true);\n        }\n      : undefined,\n    onError,\n    orderBars,\n    pieLabelType,\n    rangeLabels,\n    ranges,\n    reduceXTicks,\n    showBarValue,\n    showBrush,\n    showControls,\n    showLabels,\n    showLegend,\n    showMarkers,\n    sizeField: size,\n    useRichTooltip: richTooltip,\n    vizType,\n    xAxisFormat,\n    xAxisLabel,\n    xAxisShowMinMax: xAxisShowminmax,\n    xField: x,\n    xIsLogScale: xLogScale,\n    xTicksLayout,\n    yAxisFormat,\n    yAxisBounds,\n    yAxis2Bounds,\n    yAxisLabel,\n    yAxisShowMinMax: yAxisShowminmax,\n    yAxis2ShowMinMax: yAxis2Showminmax,\n    yField: y,\n    yIsLogScale: yLogScale,\n    sliceId,\n  };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}