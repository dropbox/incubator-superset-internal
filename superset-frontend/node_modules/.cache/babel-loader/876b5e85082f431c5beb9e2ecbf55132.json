{"ast":null,"code":"(function () {var enterModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.enterModule : undefined;enterModule && enterModule(module);})();var __signature__ = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default.signature : function (a) {return a;}; /**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable func-names, react/sort-prop-types */\nimport d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport 'd3-svg-legend';\nimport d3tip from 'd3-tip';\nimport {\ngetColumnLabel,\ngetMetricLabel,\ngetNumberFormatter,\nNumberFormats,\ngetSequentialSchemeRegistry } from\n'@superset-ui/core';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    records: PropTypes.arrayOf(\n    PropTypes.shape({\n      x: PropTypes.string,\n      y: PropTypes.string,\n      v: PropTypes.number,\n      perc: PropTypes.number,\n      rank: PropTypes.number })),\n\n\n    extents: PropTypes.arrayOf(PropTypes.number) }),\n\n  width: PropTypes.number,\n  height: PropTypes.number,\n  bottomMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  colorScheme: PropTypes.string,\n  columnX: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  columnY: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  leftMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  metric: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  normalized: PropTypes.bool,\n  numberFormat: PropTypes.string,\n  showLegend: PropTypes.bool,\n  showPercentage: PropTypes.bool,\n  showValues: PropTypes.bool,\n  sortXAxis: PropTypes.string,\n  sortYAxis: PropTypes.string,\n  xScaleInterval: PropTypes.number,\n  yScaleInterval: PropTypes.number,\n  yAxisBounds: PropTypes.arrayOf(PropTypes.number) };\n\n\nfunction cmp(a, b) {\n  return a > b ? 1 : -1;\n}\n\nconst DEFAULT_PROPERTIES = {\n  minChartWidth: 150,\n  minChartHeight: 150,\n  marginLeft: 35,\n  marginBottom: 35,\n  marginTop: 10,\n  marginRight: 10 };\n\n\n// Inspired from http://bl.ocks.org/mbostock/3074470\n// https://jsfiddle.net/cyril123/h0reyumq/\nfunction Heatmap(element, props) {\n  const {\n    data,\n    width,\n    height,\n    bottomMargin,\n    canvasImageRendering,\n    colorScheme,\n    columnX,\n    columnY,\n    leftMargin,\n    metric,\n    normalized,\n    numberFormat,\n    showLegend,\n    showPercentage,\n    showValues,\n    sortXAxis,\n    sortYAxis,\n    xScaleInterval,\n    yScaleInterval,\n    yAxisBounds } =\n  props;\n\n  const { records, extents } = data;\n\n  const margin = {\n    top: 10,\n    right: 10,\n    bottom: 35,\n    left: 35 };\n\n\n  let showY = true;\n  let showX = true;\n  const pixelsPerCharX = 4.5; // approx, depends on font size\n  let pixelsPerCharY = 6; // approx, depends on font size\n\n  const valueFormatter = getNumberFormatter(numberFormat);\n\n  // Dynamically adjusts  based on max x / y category lengths\n  function adjustMargins() {\n    let longestX = 1;\n    let longestY = 1;\n\n    records.forEach((datum) => {\n      if (typeof datum.y === 'number') pixelsPerCharY = 7;\n      longestX = Math.max(\n      longestX,\n      datum.x && datum.x.toString().length || 1);\n\n      longestY = Math.max(\n      longestY,\n      datum.y && datum.y.toString().length || 1);\n\n    });\n\n    if (leftMargin === 'auto') {\n      margin.left = Math.ceil(Math.max(margin.left, pixelsPerCharY * longestY));\n    } else {\n      margin.left = leftMargin;\n    }\n\n    if (showLegend) {\n      margin.right += 40;\n    }\n\n    margin.bottom =\n    bottomMargin === 'auto' ?\n    Math.ceil(Math.max(margin.bottom, pixelsPerCharX * longestX)) :\n    bottomMargin;\n  }\n\n  // Check if x axis \"x\" position is outside of the container and rotate labels 90deg\n  function checkLabelPosition(container) {\n    const xAxisNode = container.select('.x.axis').node();\n\n    if (!xAxisNode) {\n      return;\n    }\n\n    if (\n    xAxisNode.getBoundingClientRect().x + 4 <\n    container.node().getBoundingClientRect().x)\n    {\n      container.\n      selectAll('.x.axis').\n      selectAll('text').\n      attr('transform', 'rotate(-90)').\n      attr('x', -6).\n      attr('y', 0).\n      attr('dy', '0.3em');\n    }\n  }\n\n  function ordScale(k, rangeBands, sortMethod) {\n    let domain = {};\n    const actualKeys = {}; // hack to preserve type of keys when number\n    records.forEach((d) => {\n      domain[d[k]] = (domain[d[k]] || 0) + d.v;\n      actualKeys[d[k]] = d[k];\n    });\n    // Not using object.keys() as it converts to strings\n    const keys = Object.keys(actualKeys).map((s) => actualKeys[s]);\n    if (sortMethod === 'alpha_asc') {\n      domain = keys.sort(cmp);\n    } else if (sortMethod === 'alpha_desc') {\n      domain = keys.sort(cmp).reverse();\n    } else if (sortMethod === 'value_desc') {\n      domain = Object.keys(domain).sort((a, b) =>\n      domain[a] > domain[b] ? -1 : 1);\n\n    } else if (sortMethod === 'value_asc') {\n      domain = Object.keys(domain).sort((a, b) =>\n      domain[b] > domain[a] ? -1 : 1);\n\n    }\n\n    if (k === 'y' && rangeBands) {\n      domain.reverse();\n    }\n\n    if (rangeBands) {\n      return d3.scale.ordinal().domain(domain).rangeBands(rangeBands);\n    }\n\n    return d3.scale.ordinal().domain(domain).range(d3.range(domain.length));\n  }\n\n  // eslint-disable-next-line no-param-reassign\n  element.innerHTML = '';\n  const matrix = {};\n\n  adjustMargins();\n\n  let hmWidth = width - (margin.left + margin.right);\n  let hmHeight = height - (margin.bottom + margin.top);\n  const hideYLabel = () => {\n    margin.left =\n    leftMargin === 'auto' ? DEFAULT_PROPERTIES.marginLeft : leftMargin;\n    hmWidth = width - (margin.left + margin.right);\n    showY = false;\n  };\n\n  const hideXLabel = () => {\n    margin.bottom =\n    bottomMargin === 'auto' ? DEFAULT_PROPERTIES.marginBottom : bottomMargin;\n    hmHeight = height - (margin.bottom + margin.top);\n    showX = false;\n  };\n\n  // Hide Y Labels\n  if (hmWidth < DEFAULT_PROPERTIES.minChartWidth) {\n    hideYLabel();\n  }\n\n  // Hide X Labels\n  if (\n  hmHeight < DEFAULT_PROPERTIES.minChartHeight ||\n  hmWidth < DEFAULT_PROPERTIES.minChartWidth)\n  {\n    hideXLabel();\n  }\n\n  if (showY && hmHeight < DEFAULT_PROPERTIES.minChartHeight) {\n    hideYLabel();\n  }\n\n  const fp = getNumberFormatter(NumberFormats.PERCENT);\n\n  const xScale = ordScale('x', null, sortXAxis);\n  const yScale = ordScale('y', null, sortYAxis);\n  const xRbScale = ordScale('x', [0, hmWidth], sortXAxis);\n  const yRbScale = ordScale('y', [hmHeight, 0], sortYAxis);\n  const X = 0;\n  const Y = 1;\n  const heatmapDim = [xRbScale.domain().length, yRbScale.domain().length];\n\n  const minBound = yAxisBounds[0] || 0;\n  const maxBound = yAxisBounds[1] || 1;\n  const colorScale = getSequentialSchemeRegistry().\n  get(colorScheme).\n  createLinearScale([minBound, maxBound]);\n\n  const scale = [\n  d3.scale.linear().domain([0, heatmapDim[X]]).range([0, hmWidth]),\n  d3.scale.linear().domain([0, heatmapDim[Y]]).range([0, hmHeight])];\n\n\n  const container = d3.select(element);\n  container.classed('superset-legacy-chart-heatmap', true);\n\n  const canvas = container.\n  append('canvas').\n  attr('width', heatmapDim[X]).\n  attr('height', heatmapDim[Y]).\n  style('width', `${hmWidth}px`).\n  style('height', `${hmHeight}px`).\n  style('image-rendering', canvasImageRendering).\n  style('left', `${margin.left}px`).\n  style('top', `${margin.top}px`).\n  style('position', 'absolute');\n\n  const svg = container.\n  append('svg').\n  attr('width', width).\n  attr('height', height).\n  attr('class', 'heatmap-container').\n  style('position', 'relative');\n\n  if (showValues) {\n    const cells = svg.\n    selectAll('rect').\n    data(records).\n    enter().\n    append('g').\n    attr('transform', `translate(${margin.left}, ${margin.top})`);\n\n    cells.\n    append('text').\n    attr('transform', (d) => `translate(${xRbScale(d.x)}, ${yRbScale(d.y)})`).\n    attr('y', yRbScale.rangeBand() / 2).\n    attr('x', xRbScale.rangeBand() / 2).\n    attr('text-anchor', 'middle').\n    attr('dy', '.35em').\n    text((d) => valueFormatter(d.v)).\n    attr(\n    'font-size',\n    `${Math.min(yRbScale.rangeBand(), xRbScale.rangeBand()) / 3}px`).\n\n    attr('fill', (d) => d.v >= extents[1] / 2 ? 'white' : 'black');\n  }\n\n  if (showLegend) {\n    const colorLegend = d3.legend.\n    color().\n    labelFormat(valueFormatter).\n    scale(colorScale).\n    shapePadding(0).\n    cells(10).\n    shapeWidth(10).\n    shapeHeight(10).\n    labelOffset(3);\n\n    svg.\n    append('g').\n    attr('transform', `translate(${width - 40}, ${margin.top})`).\n    call(colorLegend);\n  }\n\n  const tip = d3tip().\n  attr('class', 'd3-tip').\n  offset(function () {\n    const k = d3.mouse(this);\n    const x = k[0] - hmWidth / 2;\n\n    return [k[1] - 20, x];\n  }).\n  html(function () {\n    let s = '';\n    const k = d3.mouse(this);\n    const m = Math.floor(scale[0].invert(k[0]));\n    const n = Math.floor(scale[1].invert(k[1]));\n    if (m in matrix && n in matrix[m]) {\n      const obj = matrix[m][n];\n      s += `<div><b>${getColumnLabel(columnX)}: </b>${obj.x}<div>`;\n      s += `<div><b>${getColumnLabel(columnY)}: </b>${obj.y}<div>`;\n      s += `<div><b>${getMetricLabel(metric)}: </b>${valueFormatter(\n      obj.v)\n      }<div>`;\n      if (showPercentage) {\n        s += `<div><b>%: </b>${fp(normalized ? obj.rank : obj.perc)}<div>`;\n      }\n      tip.style('display', null);\n    } else {\n      // this is a hack to hide the tooltip because we have map it to a single <rect>\n      // d3-tip toggles opacity and calling hide here is undone by the lib after this call\n      tip.style('display', 'none');\n    }\n\n    return s;\n  });\n\n  const rect = svg.\n  append('g').\n  attr('transform', `translate(${margin.left}, ${margin.top})`).\n  append('rect').\n  classed('background-rect', true).\n  on('mousemove', tip.show).\n  on('mouseout', tip.hide).\n  attr('width', hmWidth).\n  attr('height', hmHeight);\n\n  rect.call(tip);\n\n  if (showX) {\n    const xAxis = d3.svg.\n    axis().\n    scale(xRbScale).\n    outerTickSize(0).\n    tickValues(xRbScale.domain().filter((d, i) => !(i % xScaleInterval))).\n    orient('bottom');\n\n    svg.\n    append('g').\n    attr('class', 'x axis').\n    attr('transform', `translate(${margin.left},${margin.top + hmHeight})`).\n    call(xAxis).\n    selectAll('text').\n    attr('x', -4).\n    attr('y', 10).\n    attr('dy', '0.3em').\n    style('text-anchor', 'end').\n    attr('transform', 'rotate(-45)');\n  }\n\n  if (showY) {\n    const yAxis = d3.svg.\n    axis().\n    scale(yRbScale).\n    outerTickSize(0).\n    tickValues(yRbScale.domain().filter((d, i) => !(i % yScaleInterval))).\n    orient('left');\n\n    svg.\n    append('g').\n    attr('class', 'y axis').\n    attr('transform', `translate(${margin.left},${margin.top})`).\n    call(yAxis);\n  }\n\n  checkLabelPosition(container);\n  const context = canvas.node().getContext('2d');\n  context.imageSmoothingEnabled = false;\n\n  // Compute the pixel colors; scaled by CSS.\n  function createImageObj() {\n    const imageObj = new Image();\n    const image = context.createImageData(heatmapDim[0], heatmapDim[1]);\n    const pixs = {};\n    records.forEach((d) => {\n      const c = d3.rgb(colorScale(normalized ? d.rank : d.perc));\n      const x = xScale(d.x);\n      const y = yScale(d.y);\n      pixs[x + y * xScale.domain().length] = c;\n      if (matrix[x] === undefined) {\n        matrix[x] = {};\n      }\n      if (matrix[x][y] === undefined) {\n        matrix[x][y] = d;\n      }\n    });\n\n    let p = 0;\n    for (let i = 0; i < heatmapDim[0] * heatmapDim[1]; i += 1) {\n      let c = pixs[i];\n      let alpha = 255;\n      if (c === undefined) {\n        c = d3.rgb('#F00');\n        alpha = 0;\n      }\n      image.data[p + 0] = c.r;\n      image.data[p + 1] = c.g;\n      image.data[p + 2] = c.b;\n      image.data[p + 3] = alpha;\n      p += 4;\n    }\n    context.putImageData(image, 0, 0);\n    imageObj.src = canvas.node().toDataURL();\n  }\n  createImageObj();\n}\n\nHeatmap.displayName = 'Heatmap';\nHeatmap.propTypes = propTypes;const _default =\n\nHeatmap;export default _default;;(function () {var reactHotLoader = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.default : undefined;if (!reactHotLoader) {return;}reactHotLoader.register(propTypes, \"propTypes\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js\");reactHotLoader.register(cmp, \"cmp\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js\");reactHotLoader.register(DEFAULT_PROPERTIES, \"DEFAULT_PROPERTIES\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js\");reactHotLoader.register(Heatmap, \"Heatmap\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js\");reactHotLoader.register(_default, \"default\", \"/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js\");})();;(function () {var leaveModule = typeof reactHotLoaderGlobal !== 'undefined' ? reactHotLoaderGlobal.leaveModule : undefined;leaveModule && leaveModule(module);})();","map":{"version":3,"names":["d3","PropTypes","d3tip","getColumnLabel","getMetricLabel","getNumberFormatter","NumberFormats","getSequentialSchemeRegistry","propTypes","data","shape","records","arrayOf","x","string","y","v","number","perc","rank","extents","width","height","bottomMargin","oneOfType","colorScheme","columnX","object","columnY","leftMargin","metric","normalized","bool","numberFormat","showLegend","showPercentage","showValues","sortXAxis","sortYAxis","xScaleInterval","yScaleInterval","yAxisBounds","cmp","a","b","DEFAULT_PROPERTIES","minChartWidth","minChartHeight","marginLeft","marginBottom","marginTop","marginRight","Heatmap","element","props","canvasImageRendering","margin","top","right","bottom","left","showY","showX","pixelsPerCharX","pixelsPerCharY","valueFormatter","adjustMargins","longestX","longestY","forEach","datum","Math","max","toString","length","ceil","checkLabelPosition","container","xAxisNode","select","node","getBoundingClientRect","selectAll","attr","ordScale","k","rangeBands","sortMethod","domain","actualKeys","d","keys","Object","map","s","sort","reverse","scale","ordinal","range","innerHTML","matrix","hmWidth","hmHeight","hideYLabel","hideXLabel","fp","PERCENT","xScale","yScale","xRbScale","yRbScale","X","Y","heatmapDim","minBound","maxBound","colorScale","get","createLinearScale","linear","classed","canvas","append","style","svg","cells","enter","rangeBand","text","min","colorLegend","legend","color","labelFormat","shapePadding","shapeWidth","shapeHeight","labelOffset","call","tip","offset","mouse","html","m","floor","invert","n","obj","rect","on","show","hide","xAxis","axis","outerTickSize","tickValues","filter","i","orient","yAxis","context","getContext","imageSmoothingEnabled","createImageObj","imageObj","Image","image","createImageData","pixs","c","rgb","undefined","p","alpha","r","g","putImageData","src","toDataURL","displayName"],"sources":["/Users/bogdankyryliuk/code/opensource/superset/superset-frontend/plugins/legacy-plugin-chart-heatmap/src/Heatmap.js"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable func-names, react/sort-prop-types */\nimport d3 from 'd3';\nimport PropTypes from 'prop-types';\nimport 'd3-svg-legend';\nimport d3tip from 'd3-tip';\nimport {\n  getColumnLabel,\n  getMetricLabel,\n  getNumberFormatter,\n  NumberFormats,\n  getSequentialSchemeRegistry,\n} from '@superset-ui/core';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    records: PropTypes.arrayOf(\n      PropTypes.shape({\n        x: PropTypes.string,\n        y: PropTypes.string,\n        v: PropTypes.number,\n        perc: PropTypes.number,\n        rank: PropTypes.number,\n      }),\n    ),\n    extents: PropTypes.arrayOf(PropTypes.number),\n  }),\n  width: PropTypes.number,\n  height: PropTypes.number,\n  bottomMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  colorScheme: PropTypes.string,\n  columnX: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  columnY: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  leftMargin: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  metric: PropTypes.oneOfType([PropTypes.string, PropTypes.object]),\n  normalized: PropTypes.bool,\n  numberFormat: PropTypes.string,\n  showLegend: PropTypes.bool,\n  showPercentage: PropTypes.bool,\n  showValues: PropTypes.bool,\n  sortXAxis: PropTypes.string,\n  sortYAxis: PropTypes.string,\n  xScaleInterval: PropTypes.number,\n  yScaleInterval: PropTypes.number,\n  yAxisBounds: PropTypes.arrayOf(PropTypes.number),\n};\n\nfunction cmp(a, b) {\n  return a > b ? 1 : -1;\n}\n\nconst DEFAULT_PROPERTIES = {\n  minChartWidth: 150,\n  minChartHeight: 150,\n  marginLeft: 35,\n  marginBottom: 35,\n  marginTop: 10,\n  marginRight: 10,\n};\n\n// Inspired from http://bl.ocks.org/mbostock/3074470\n// https://jsfiddle.net/cyril123/h0reyumq/\nfunction Heatmap(element, props) {\n  const {\n    data,\n    width,\n    height,\n    bottomMargin,\n    canvasImageRendering,\n    colorScheme,\n    columnX,\n    columnY,\n    leftMargin,\n    metric,\n    normalized,\n    numberFormat,\n    showLegend,\n    showPercentage,\n    showValues,\n    sortXAxis,\n    sortYAxis,\n    xScaleInterval,\n    yScaleInterval,\n    yAxisBounds,\n  } = props;\n\n  const { records, extents } = data;\n\n  const margin = {\n    top: 10,\n    right: 10,\n    bottom: 35,\n    left: 35,\n  };\n\n  let showY = true;\n  let showX = true;\n  const pixelsPerCharX = 4.5; // approx, depends on font size\n  let pixelsPerCharY = 6; // approx, depends on font size\n\n  const valueFormatter = getNumberFormatter(numberFormat);\n\n  // Dynamically adjusts  based on max x / y category lengths\n  function adjustMargins() {\n    let longestX = 1;\n    let longestY = 1;\n\n    records.forEach(datum => {\n      if (typeof datum.y === 'number') pixelsPerCharY = 7;\n      longestX = Math.max(\n        longestX,\n        (datum.x && datum.x.toString().length) || 1,\n      );\n      longestY = Math.max(\n        longestY,\n        (datum.y && datum.y.toString().length) || 1,\n      );\n    });\n\n    if (leftMargin === 'auto') {\n      margin.left = Math.ceil(Math.max(margin.left, pixelsPerCharY * longestY));\n    } else {\n      margin.left = leftMargin;\n    }\n\n    if (showLegend) {\n      margin.right += 40;\n    }\n\n    margin.bottom =\n      bottomMargin === 'auto'\n        ? Math.ceil(Math.max(margin.bottom, pixelsPerCharX * longestX))\n        : bottomMargin;\n  }\n\n  // Check if x axis \"x\" position is outside of the container and rotate labels 90deg\n  function checkLabelPosition(container) {\n    const xAxisNode = container.select('.x.axis').node();\n\n    if (!xAxisNode) {\n      return;\n    }\n\n    if (\n      xAxisNode.getBoundingClientRect().x + 4 <\n      container.node().getBoundingClientRect().x\n    ) {\n      container\n        .selectAll('.x.axis')\n        .selectAll('text')\n        .attr('transform', 'rotate(-90)')\n        .attr('x', -6)\n        .attr('y', 0)\n        .attr('dy', '0.3em');\n    }\n  }\n\n  function ordScale(k, rangeBands, sortMethod) {\n    let domain = {};\n    const actualKeys = {}; // hack to preserve type of keys when number\n    records.forEach(d => {\n      domain[d[k]] = (domain[d[k]] || 0) + d.v;\n      actualKeys[d[k]] = d[k];\n    });\n    // Not using object.keys() as it converts to strings\n    const keys = Object.keys(actualKeys).map(s => actualKeys[s]);\n    if (sortMethod === 'alpha_asc') {\n      domain = keys.sort(cmp);\n    } else if (sortMethod === 'alpha_desc') {\n      domain = keys.sort(cmp).reverse();\n    } else if (sortMethod === 'value_desc') {\n      domain = Object.keys(domain).sort((a, b) =>\n        domain[a] > domain[b] ? -1 : 1,\n      );\n    } else if (sortMethod === 'value_asc') {\n      domain = Object.keys(domain).sort((a, b) =>\n        domain[b] > domain[a] ? -1 : 1,\n      );\n    }\n\n    if (k === 'y' && rangeBands) {\n      domain.reverse();\n    }\n\n    if (rangeBands) {\n      return d3.scale.ordinal().domain(domain).rangeBands(rangeBands);\n    }\n\n    return d3.scale.ordinal().domain(domain).range(d3.range(domain.length));\n  }\n\n  // eslint-disable-next-line no-param-reassign\n  element.innerHTML = '';\n  const matrix = {};\n\n  adjustMargins();\n\n  let hmWidth = width - (margin.left + margin.right);\n  let hmHeight = height - (margin.bottom + margin.top);\n  const hideYLabel = () => {\n    margin.left =\n      leftMargin === 'auto' ? DEFAULT_PROPERTIES.marginLeft : leftMargin;\n    hmWidth = width - (margin.left + margin.right);\n    showY = false;\n  };\n\n  const hideXLabel = () => {\n    margin.bottom =\n      bottomMargin === 'auto' ? DEFAULT_PROPERTIES.marginBottom : bottomMargin;\n    hmHeight = height - (margin.bottom + margin.top);\n    showX = false;\n  };\n\n  // Hide Y Labels\n  if (hmWidth < DEFAULT_PROPERTIES.minChartWidth) {\n    hideYLabel();\n  }\n\n  // Hide X Labels\n  if (\n    hmHeight < DEFAULT_PROPERTIES.minChartHeight ||\n    hmWidth < DEFAULT_PROPERTIES.minChartWidth\n  ) {\n    hideXLabel();\n  }\n\n  if (showY && hmHeight < DEFAULT_PROPERTIES.minChartHeight) {\n    hideYLabel();\n  }\n\n  const fp = getNumberFormatter(NumberFormats.PERCENT);\n\n  const xScale = ordScale('x', null, sortXAxis);\n  const yScale = ordScale('y', null, sortYAxis);\n  const xRbScale = ordScale('x', [0, hmWidth], sortXAxis);\n  const yRbScale = ordScale('y', [hmHeight, 0], sortYAxis);\n  const X = 0;\n  const Y = 1;\n  const heatmapDim = [xRbScale.domain().length, yRbScale.domain().length];\n\n  const minBound = yAxisBounds[0] || 0;\n  const maxBound = yAxisBounds[1] || 1;\n  const colorScale = getSequentialSchemeRegistry()\n    .get(colorScheme)\n    .createLinearScale([minBound, maxBound]);\n\n  const scale = [\n    d3.scale.linear().domain([0, heatmapDim[X]]).range([0, hmWidth]),\n    d3.scale.linear().domain([0, heatmapDim[Y]]).range([0, hmHeight]),\n  ];\n\n  const container = d3.select(element);\n  container.classed('superset-legacy-chart-heatmap', true);\n\n  const canvas = container\n    .append('canvas')\n    .attr('width', heatmapDim[X])\n    .attr('height', heatmapDim[Y])\n    .style('width', `${hmWidth}px`)\n    .style('height', `${hmHeight}px`)\n    .style('image-rendering', canvasImageRendering)\n    .style('left', `${margin.left}px`)\n    .style('top', `${margin.top}px`)\n    .style('position', 'absolute');\n\n  const svg = container\n    .append('svg')\n    .attr('width', width)\n    .attr('height', height)\n    .attr('class', 'heatmap-container')\n    .style('position', 'relative');\n\n  if (showValues) {\n    const cells = svg\n      .selectAll('rect')\n      .data(records)\n      .enter()\n      .append('g')\n      .attr('transform', `translate(${margin.left}, ${margin.top})`);\n\n    cells\n      .append('text')\n      .attr('transform', d => `translate(${xRbScale(d.x)}, ${yRbScale(d.y)})`)\n      .attr('y', yRbScale.rangeBand() / 2)\n      .attr('x', xRbScale.rangeBand() / 2)\n      .attr('text-anchor', 'middle')\n      .attr('dy', '.35em')\n      .text(d => valueFormatter(d.v))\n      .attr(\n        'font-size',\n        `${Math.min(yRbScale.rangeBand(), xRbScale.rangeBand()) / 3}px`,\n      )\n      .attr('fill', d => (d.v >= extents[1] / 2 ? 'white' : 'black'));\n  }\n\n  if (showLegend) {\n    const colorLegend = d3.legend\n      .color()\n      .labelFormat(valueFormatter)\n      .scale(colorScale)\n      .shapePadding(0)\n      .cells(10)\n      .shapeWidth(10)\n      .shapeHeight(10)\n      .labelOffset(3);\n\n    svg\n      .append('g')\n      .attr('transform', `translate(${width - 40}, ${margin.top})`)\n      .call(colorLegend);\n  }\n\n  const tip = d3tip()\n    .attr('class', 'd3-tip')\n    .offset(function () {\n      const k = d3.mouse(this);\n      const x = k[0] - hmWidth / 2;\n\n      return [k[1] - 20, x];\n    })\n    .html(function () {\n      let s = '';\n      const k = d3.mouse(this);\n      const m = Math.floor(scale[0].invert(k[0]));\n      const n = Math.floor(scale[1].invert(k[1]));\n      if (m in matrix && n in matrix[m]) {\n        const obj = matrix[m][n];\n        s += `<div><b>${getColumnLabel(columnX)}: </b>${obj.x}<div>`;\n        s += `<div><b>${getColumnLabel(columnY)}: </b>${obj.y}<div>`;\n        s += `<div><b>${getMetricLabel(metric)}: </b>${valueFormatter(\n          obj.v,\n        )}<div>`;\n        if (showPercentage) {\n          s += `<div><b>%: </b>${fp(normalized ? obj.rank : obj.perc)}<div>`;\n        }\n        tip.style('display', null);\n      } else {\n        // this is a hack to hide the tooltip because we have map it to a single <rect>\n        // d3-tip toggles opacity and calling hide here is undone by the lib after this call\n        tip.style('display', 'none');\n      }\n\n      return s;\n    });\n\n  const rect = svg\n    .append('g')\n    .attr('transform', `translate(${margin.left}, ${margin.top})`)\n    .append('rect')\n    .classed('background-rect', true)\n    .on('mousemove', tip.show)\n    .on('mouseout', tip.hide)\n    .attr('width', hmWidth)\n    .attr('height', hmHeight);\n\n  rect.call(tip);\n\n  if (showX) {\n    const xAxis = d3.svg\n      .axis()\n      .scale(xRbScale)\n      .outerTickSize(0)\n      .tickValues(xRbScale.domain().filter((d, i) => !(i % xScaleInterval)))\n      .orient('bottom');\n\n    svg\n      .append('g')\n      .attr('class', 'x axis')\n      .attr('transform', `translate(${margin.left},${margin.top + hmHeight})`)\n      .call(xAxis)\n      .selectAll('text')\n      .attr('x', -4)\n      .attr('y', 10)\n      .attr('dy', '0.3em')\n      .style('text-anchor', 'end')\n      .attr('transform', 'rotate(-45)');\n  }\n\n  if (showY) {\n    const yAxis = d3.svg\n      .axis()\n      .scale(yRbScale)\n      .outerTickSize(0)\n      .tickValues(yRbScale.domain().filter((d, i) => !(i % yScaleInterval)))\n      .orient('left');\n\n    svg\n      .append('g')\n      .attr('class', 'y axis')\n      .attr('transform', `translate(${margin.left},${margin.top})`)\n      .call(yAxis);\n  }\n\n  checkLabelPosition(container);\n  const context = canvas.node().getContext('2d');\n  context.imageSmoothingEnabled = false;\n\n  // Compute the pixel colors; scaled by CSS.\n  function createImageObj() {\n    const imageObj = new Image();\n    const image = context.createImageData(heatmapDim[0], heatmapDim[1]);\n    const pixs = {};\n    records.forEach(d => {\n      const c = d3.rgb(colorScale(normalized ? d.rank : d.perc));\n      const x = xScale(d.x);\n      const y = yScale(d.y);\n      pixs[x + y * xScale.domain().length] = c;\n      if (matrix[x] === undefined) {\n        matrix[x] = {};\n      }\n      if (matrix[x][y] === undefined) {\n        matrix[x][y] = d;\n      }\n    });\n\n    let p = 0;\n    for (let i = 0; i < heatmapDim[0] * heatmapDim[1]; i += 1) {\n      let c = pixs[i];\n      let alpha = 255;\n      if (c === undefined) {\n        c = d3.rgb('#F00');\n        alpha = 0;\n      }\n      image.data[p + 0] = c.r;\n      image.data[p + 1] = c.g;\n      image.data[p + 2] = c.b;\n      image.data[p + 3] = alpha;\n      p += 4;\n    }\n    context.putImageData(image, 0, 0);\n    imageObj.src = canvas.node().toDataURL();\n  }\n  createImageObj();\n}\n\nHeatmap.displayName = 'Heatmap';\nHeatmap.propTypes = propTypes;\n\nexport default Heatmap;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}