{"version":3,"sources":["../../../src/views/view.js"],"names":["View","props","id","x","y","width","height","projectionMatrix","fovy","near","far","modelMatrix","viewportInstance","type","Viewport","constructor","displayName","_parseDimensions","equals","bind","Object","seal","view","viewChanged","viewState","filterViewState","viewportDimensions","getDimensions","_getViewport","newViewState","key","_x","_y","_width","_height","defaultOpts","opts","controller","ViewportType"],"mappings":"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","sourcesContent":["import Viewport from '../viewports/viewport';\nimport {parsePosition, getPosition} from '../utils/positions';\nimport {deepEqual} from '../utils/deep-equal';\nimport assert from '../utils/assert';\n\nexport default class View {\n  constructor(props = {}) {\n    const {\n      id = null,\n\n      // Window width/height in pixels (for pixel projection)\n      x = 0,\n      y = 0,\n      width = '100%',\n      height = '100%',\n\n      // Viewport Options\n      projectionMatrix = null, // Projection matrix\n      fovy = 50, // Perspective projection parameters, used if projectionMatrix not supplied\n      near = 0.1, // Distance of near clipping plane\n      far = 1000, // Distance of far clipping plane\n      modelMatrix = null, // A model matrix to be applied to position, to match the layer props API\n\n      // A View can be a wrapper for a viewport instance\n      viewportInstance = null,\n\n      // Internal: Viewport Type\n      type = Viewport // TODO - default to WebMercator?\n    } = props;\n\n    assert(!viewportInstance || viewportInstance instanceof Viewport);\n    this.viewportInstance = viewportInstance;\n\n    // Id\n    this.id = id || this.constructor.displayName || 'view';\n    this.type = type;\n\n    this.props = {\n      ...props,\n      id: this.id,\n      projectionMatrix,\n      fovy,\n      near,\n      far,\n      modelMatrix\n    };\n\n    // Extents\n    this._parseDimensions({x, y, width, height});\n\n    // Bind methods for easy access\n    this.equals = this.equals.bind(this);\n\n    Object.seal(this);\n  }\n\n  equals(view) {\n    if (this === view) {\n      return true;\n    }\n\n    // if `viewportInstance` is set, it is the only prop that is used\n    // Delegate to `Viewport.equals`\n    if (this.viewportInstance) {\n      return view.viewportInstance && this.viewportInstance.equals(view.viewportInstance);\n    }\n\n    const viewChanged = deepEqual(this.props, view.props);\n\n    return viewChanged;\n  }\n\n  // Build a `Viewport` from a view descriptor\n  // TODO - add support for autosizing viewports using width and height\n  makeViewport({width, height, viewState}) {\n    if (this.viewportInstance) {\n      return this.viewportInstance;\n    }\n\n    viewState = this.filterViewState(viewState);\n\n    // Resolve relative viewport dimensions\n    const viewportDimensions = this.getDimensions({width, height});\n    return this._getViewport(viewState, viewportDimensions);\n  }\n\n  getViewStateId() {\n    switch (typeof this.props.viewState) {\n      case 'string':\n        // if View.viewState is a string, return it\n        return this.props.viewState;\n\n      case 'object':\n        // If it is an object, return its id component\n        return this.props.viewState && this.props.viewState.id;\n\n      default:\n        return this.id;\n    }\n  }\n\n  // Allows view to override (or completely define) viewState\n  filterViewState(viewState) {\n    if (this.props.viewState && typeof this.props.viewState === 'object') {\n      // If we have specified an id, then intent is to override,\n      // If not, completely specify the view state\n      if (!this.props.viewState.id) {\n        return this.props.viewState;\n      }\n\n      // Merge in all props from View's viewState, except id\n      const newViewState = {...viewState};\n      for (const key in this.props.viewState) {\n        if (key !== 'id') {\n          newViewState[key] = this.props.viewState[key];\n        }\n      }\n      return newViewState;\n    }\n\n    return viewState;\n  }\n\n  // Resolve relative viewport dimensions into actual dimensions (y='50%', width=800 => y=400)\n  getDimensions({width, height}) {\n    return {\n      x: getPosition(this._x, width),\n      y: getPosition(this._y, height),\n      width: getPosition(this._width, width),\n      height: getPosition(this._height, height)\n    };\n  }\n\n  // Used by sub classes to resolve controller props\n  _getControllerProps(defaultOpts) {\n    let opts = this.props.controller;\n\n    if (!opts) {\n      return null;\n    }\n    if (opts === true) {\n      return defaultOpts;\n    }\n    if (typeof opts === 'function') {\n      opts = {type: opts};\n    }\n    return {...defaultOpts, ...opts};\n  }\n\n  // Overridable method\n  _getViewport(viewState, viewportDimensions) {\n    // Get the type of the viewport\n    const {type: ViewportType} = this;\n    return new ViewportType({...viewState, ...this.props, ...viewportDimensions});\n  }\n\n  // Parse relative viewport dimension descriptors (e.g {y: '50%', height: '50%'})\n  _parseDimensions({x, y, width, height}) {\n    this._x = parsePosition(x);\n    this._y = parsePosition(y);\n    this._width = parsePosition(width);\n    this._height = parsePosition(height);\n  }\n}\n"],"file":"view.js"}