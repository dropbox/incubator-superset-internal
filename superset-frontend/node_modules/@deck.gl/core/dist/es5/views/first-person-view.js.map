{"version":3,"sources":["../../../src/views/first-person-view.js"],"names":["getDirectionFromBearingAndPitch","bearing","pitch","spherical","SphericalCoordinates","direction","toVector3","normalize","FirstPersonViewport","props","modelMatrix","up","dir","center","transformDirection","zoom","scale","Math","pow","viewMatrix","Matrix4","lookAt","eye","Viewport","FirstPersonView","type","_getControllerProps","FirstPersonController","View","displayName"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAAA;;AACA;;AACA;;AACA;;AACA;;;;;;;;;;AAEA,SAASA,+BAAT,OAA2D;AAAA,MAAjBC,OAAiB,QAAjBA,OAAiB;AAAA,MAARC,KAAQ,QAARA,KAAQ;AACzD,MAAMC,SAAS,GAAG,IAAIC,2BAAJ,CAAyB;AAACH,IAAAA,OAAO,EAAPA,OAAD;AAAUC,IAAAA,KAAK,EAALA;AAAV,GAAzB,CAAlB;AACA,MAAMG,SAAS,GAAGF,SAAS,CAACG,SAAV,GAAsBC,SAAtB,EAAlB;AACA,SAAOF,SAAP;AACD;;IAEKG,mB;;;;;AACJ,+BAAYC,KAAZ,EAAmB;AAAA;AAAA,6BAQbA,KARa,CAIfC,WAJe;AAAA,QAIfA,WAJe,mCAID,IAJC;AAAA,yBAQbD,KARa,CAKfR,OALe;AAAA,QAKfA,OALe,+BAKL,CALK;AAAA,uBAQbQ,KARa,CAMfP,KANe;AAAA,QAMfA,KANe,6BAMP,CANO;AAAA,oBAQbO,KARa,CAOfE,EAPe;AAAA,QAOfA,EAPe,0BAOV,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAPU;AAWjB,QAAMC,GAAG,GAAGZ,+BAA+B,CAAC;AAC1CC,MAAAA,OAAO,EAAPA,OAD0C;AAG1CC,MAAAA,KAAK,EAAEA,KAAK,KAAK,CAAC,EAAX,GAAgB,MAAhB,GAAyB,KAAKA;AAHK,KAAD,CAA3C;AAOA,QAAMW,MAAM,GAAGH,WAAW,GAAGA,WAAW,CAACI,kBAAZ,CAA+BF,GAA/B,CAAH,GAAyCA,GAAnE;AAGA,QAAMG,IAAI,GAAG,+BAAaN,KAAb,CAAb;AACA,QAAMO,KAAK,GAAGC,IAAI,CAACC,GAAL,CAAS,CAAT,EAAYH,IAAZ,CAAd;AACA,QAAMI,UAAU,GAAG,IAAIC,aAAJ,GAAcC,MAAd,CAAqB;AAACC,MAAAA,GAAG,EAAE,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,CAAN;AAAiBT,MAAAA,MAAM,EAANA,MAAjB;AAAyBF,MAAAA,EAAE,EAAFA;AAAzB,KAArB,EAAmDK,KAAnD,CAAyDA,KAAzD,CAAnB;AAvBiB,6DA0BZP,KA1BY;AA2BfM,MAAAA,IAAI,EAAJA,IA3Be;AA4BfI,MAAAA,UAAU,EAAVA;AA5Be;AA8BlB;;;EA/B+BI,iB;;IAkCbC,e;;;;;AACnB,2BAAYf,KAAZ,EAAmB;AAAA;AAAA,8DAEZA,KAFY;AAGfgB,MAAAA,IAAI,EAAEjB;AAHS;AAKlB;;;;wBAEgB;AACf,aAAO,KAAKkB,mBAAL,CAAyB;AAC9BD,QAAAA,IAAI,EAAEE;AADwB,OAAzB,CAAP;AAGD;;;EAZ0CC,a;;;AAe7CJ,eAAe,CAACK,WAAhB,GAA8B,iBAA9B","sourcesContent":["import View from './view';\nimport Viewport from '../viewports/viewport';\nimport {getMeterZoom} from '@math.gl/web-mercator';\nimport {Matrix4, _SphericalCoordinates as SphericalCoordinates} from 'math.gl';\nimport FirstPersonController from '../controllers/first-person-controller';\n\nfunction getDirectionFromBearingAndPitch({bearing, pitch}) {\n  const spherical = new SphericalCoordinates({bearing, pitch});\n  const direction = spherical.toVector3().normalize();\n  return direction;\n}\n\nclass FirstPersonViewport extends Viewport {\n  constructor(props) {\n    // TODO - push direction handling into Matrix4.lookAt\n    const {\n      // view matrix arguments\n      modelMatrix = null,\n      bearing = 0,\n      pitch = 0,\n      up = [0, 0, 1] // Defines up direction, default positive z axis,\n    } = props;\n\n    // Always calculate direction from bearing and pitch\n    const dir = getDirectionFromBearingAndPitch({\n      bearing,\n      // Avoid \"pixel project matrix not invertible\" error\n      pitch: pitch === -90 ? 0.0001 : 90 + pitch\n    });\n\n    // Direction is relative to model coordinates, of course\n    const center = modelMatrix ? modelMatrix.transformDirection(dir) : dir;\n\n    // Just the direction. All the positioning is done in viewport.js\n    const zoom = getMeterZoom(props);\n    const scale = Math.pow(2, zoom);\n    const viewMatrix = new Matrix4().lookAt({eye: [0, 0, 0], center, up}).scale(scale);\n\n    super({\n      ...props,\n      zoom,\n      viewMatrix\n    });\n  }\n}\n\nexport default class FirstPersonView extends View {\n  constructor(props) {\n    super({\n      ...props,\n      type: FirstPersonViewport\n    });\n  }\n\n  get controller() {\n    return this._getControllerProps({\n      type: FirstPersonController\n    });\n  }\n}\n\nFirstPersonView.displayName = 'FirstPersonView';\n"],"file":"first-person-view.js"}