"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.generateCertificate = void 0;
const node_forge_1 = __importDefault(require("node-forge"));
const crypto_1 = __importDefault(require("crypto"));
async function generateCertificate({ days = 1 } = {}) {
    const keys = node_forge_1.default.pki.rsa.generateKeyPair(2048);
    const cert = node_forge_1.default.pki.createCertificate();
    cert.publicKey = keys.publicKey;
    cert.serialNumber = '01' + crypto_1.default.randomBytes(19).toString('hex'); // 1 octet = 8 bits = 1 byte = 2 hex chars
    cert.validity.notBefore = new Date();
    cert.validity.notAfter = new Date(new Date().getTime() + 1000 * 60 * 60 * 24 * days);
    const attrs = [
        { name: 'countryName', value: 'AU' },
        { shortName: 'ST', value: 'Some-State' },
        { name: 'organizationName', value: 'Internet Widgits Pty Ltd' },
    ];
    cert.setSubject(attrs);
    cert.setIssuer(attrs);
    cert.setExtensions([{ name: 'subjectAltName', altNames: [] }]);
    cert.sign(keys.privateKey);
    return {
        cert: node_forge_1.default.pki.certificateToPem(cert),
        key: node_forge_1.default.pki.privateKeyToPem(keys.privateKey),
    };
}
exports.generateCertificate = generateCertificate;
