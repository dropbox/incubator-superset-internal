const assert = require('assert');
const chunkify = require('../src/chunkify');

describe('chunkify', () => {
  function split(str, breakpoints) {
    return [0, ...breakpoints].map((breakpoint, index, breakpoints) => {
      return str.substring(breakpoint, breakpoints[index + 1]);
    });
  }

  it('works with latin (1 byte)', async () => {
    const str = 'abcdefgh1234';
    const chunks = split(str, chunkify(str, 4));
    assert.strictEqual(chunks.length, 3);
    assert.deepStrictEqual(chunks, ['abcd', 'efgh', '1234']);
  });

  it('works with cyrillic (2 bytes)', async () => {
    const str = 'Ğ°Ğ±Ğ²Ğ³Ò‘Ğ´ĞµÑ”1234';
    const chunks = split(str, chunkify(str, 4));
    assert.strictEqual(chunks.length, 5);
    assert.deepStrictEqual(chunks, ['Ğ°Ğ±', 'Ğ²Ğ³', 'Ò‘Ğ´', 'ĞµÑ”', '1234']);
  });

  it('works with currency signs (3 bytes)', async () => {
    const str = 'â‚¬â‚­â‚´';
    const chunks = split(str, chunkify(str, 4));
    assert.strictEqual(chunks.length, 3);
    assert.deepStrictEqual(chunks, ['â‚¬', 'â‚­', 'â‚´']);
  });

  it('works with emoji (4 bytes)', async () => {
    const str = 'ğŸ˜ŠğŸ¥ºğŸ˜‰ğŸ˜';
    const chunks = split(str, chunkify('ğŸ˜ŠğŸ¥ºğŸ˜‰ğŸ˜', 4));
    assert.strictEqual(chunks.length, 4);
    assert.deepStrictEqual(chunks, ['ğŸ˜Š', 'ğŸ¥º', 'ğŸ˜‰', 'ğŸ˜']);
  });
});
