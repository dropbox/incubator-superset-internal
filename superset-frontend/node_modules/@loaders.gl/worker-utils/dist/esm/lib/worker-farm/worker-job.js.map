{"version":3,"sources":["../../../../src/lib/worker-farm/worker-job.ts"],"names":["assert","WorkerJob","constructor","jobName","workerThread","name","isRunning","_resolve","_reject","result","Promise","resolve","reject","postMessage","type","payload","source","done","value","error"],"mappings":";AAEA,SAAQA,MAAR,QAAqB,qBAArB;AAKA,eAAe,MAAMC,SAAN,CAAgB;AAU7BC,EAAAA,WAAW,CAACC,OAAD,EAAkBC,YAAlB,EAA8C;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AAAA;;AACvD,SAAKC,IAAL,GAAYF,OAAZ;AACA,SAAKC,YAAL,GAAoBA,YAApB;AACA,SAAKE,SAAL,GAAiB,IAAjB;;AACA,SAAKC,QAAL,GAAgB,MAAM,CAAE,CAAxB;;AACA,SAAKC,OAAL,GAAe,MAAM,CAAE,CAAvB;;AACA,SAAKC,MAAL,GAAc,IAAIC,OAAJ,CAAY,CAACC,OAAD,EAAUC,MAAV,KAAqB;AAC7C,WAAKL,QAAL,GAAgBI,OAAhB;AACA,WAAKH,OAAL,GAAeI,MAAf;AACD,KAHa,CAAd;AAID;;AAMDC,EAAAA,WAAW,CAACC,IAAD,EAA0BC,OAA1B,EAA+D;AACxE,SAAKX,YAAL,CAAkBS,WAAlB,CAA8B;AAC5BG,MAAAA,MAAM,EAAE,YADoB;AAE5BF,MAAAA,IAF4B;AAG5BC,MAAAA;AAH4B,KAA9B;AAKD;;AAKDE,EAAAA,IAAI,CAACC,KAAD,EAAc;AAChBlB,IAAAA,MAAM,CAAC,KAAKM,SAAN,CAAN;AACA,SAAKA,SAAL,GAAiB,KAAjB;;AACA,SAAKC,QAAL,CAAcW,KAAd;AACD;;AAKDC,EAAAA,KAAK,CAACA,KAAD,EAAc;AACjBnB,IAAAA,MAAM,CAAC,KAAKM,SAAN,CAAN;AACA,SAAKA,SAAL,GAAiB,KAAjB;;AACA,SAAKE,OAAL,CAAaW,KAAb;AACD;;AAlD4B","sourcesContent":["import type {WorkerMessageType, WorkerMessagePayload} from '../../types';\nimport WorkerThread from './worker-thread';\nimport {assert} from '../env-utils/assert';\n\n/**\n * Represents one Job handled by a WorkerPool or WorkerFarm\n */\nexport default class WorkerJob {\n  readonly name: string;\n  readonly workerThread: WorkerThread;\n  isRunning: boolean;\n  /** Promise that resolves when Job is done */\n  readonly result: Promise<any>;\n\n  private _resolve: (value: any) => void;\n  private _reject: (reason?: any) => void;\n\n  constructor(jobName: string, workerThread: WorkerThread) {\n    this.name = jobName;\n    this.workerThread = workerThread;\n    this.isRunning = true;\n    this._resolve = () => {};\n    this._reject = () => {};\n    this.result = new Promise((resolve, reject) => {\n      this._resolve = resolve;\n      this._reject = reject;\n    });\n  }\n\n  /**\n   * Send a message to the job's worker thread\n   * @param data any data structure, ideally consisting mostly of transferrable objects\n   */\n  postMessage(type: WorkerMessageType, payload: WorkerMessagePayload): void {\n    this.workerThread.postMessage({\n      source: 'loaders.gl', // Lets worker ignore unrelated messages\n      type,\n      payload\n    });\n  }\n\n  /**\n   * Call to resolve the `result` Promise with the supplied value\n   */\n  done(value): void {\n    assert(this.isRunning);\n    this.isRunning = false;\n    this._resolve(value);\n  }\n\n  /**\n   * Call to reject the `result` Promise with the supplied error\n   */\n  error(error): void {\n    assert(this.isRunning);\n    this.isRunning = false;\n    this._reject(error);\n  }\n}\n"],"file":"worker-job.js"}