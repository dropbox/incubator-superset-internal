{"version":3,"sources":["../../../../src/lib/binary-vector-tile/vector-tile-feature.js"],"names":["getPolygonSignedArea","endPos","cmd","cmdLen","length","x","y","i","TEST_EXPORTS","classifyRings","VectorTileFeature","types","constructor","pbf","end","extent","keys","values","firstPassData","properties","type","id","_pbf","_geometry","_keys","_values","_firstPassData","readFields","readFeature","loadGeometry","pos","readVarint","lines","data","readSVarint","push","start","Error","_toBinaryCoordinates","transform","geom","coordLength","pointFeaturesCount","pointPositionsCount","lineFeaturesCount","linePathsCount","linePositionsCount","classified","polygonFeaturesCount","polygonObjectsCount","polygonRingsCount","polygonPositionsCount","result","geometry","toBinaryCoordinates","options","z","size","Math","pow","x0","y0","project","j","jl","y2","PI","atan","exp","len","areas","polygons","ringAreas","polygon","ccw","offset","startIndex","endIndex","shape","slice","area","before","after","concat","undefined","tag","feature","readTag","key","value"],"mappings":"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","sourcesContent":["// This code is forked from https://github.com/mapbox/vector-tile-js under BSD 3-clause license.\n/* eslint-disable */\n\nimport {getPolygonSignedArea} from '@math.gl/polygon';\n\n// Reduce GC by reusing variables\nlet endPos, cmd, cmdLen, length, x, y, i;\n\nexport const TEST_EXPORTS = {\n  classifyRings\n};\n\nexport default class VectorTileFeature {\n  static get types() {\n    return ['Unknown', 'Point', 'LineString', 'Polygon'];\n  }\n\n  constructor(pbf, end, extent, keys, values, firstPassData) {\n    // Public\n    this.properties = {};\n    this.extent = extent;\n    this.type = 0;\n    this.id = null;\n\n    // Private\n    this._pbf = pbf;\n    this._geometry = -1;\n    this._keys = keys;\n    this._values = values;\n    this._firstPassData = firstPassData;\n\n    pbf.readFields(readFeature, this, end);\n  }\n\n  // eslint-disable-next-line complexity, max-statements\n  loadGeometry() {\n    const pbf = this._pbf;\n    pbf.pos = this._geometry;\n\n    endPos = pbf.readVarint() + pbf.pos;\n    cmd = 1;\n    length = 0;\n    x = 0;\n    y = 0;\n    i = 0;\n\n    // Note: I attempted to replace the `data` array with a\n    // Float32Array, but performance was worse, both using\n    // `set()` and direct index access. Also, we cannot\n    // know how large the buffer should be, so it would\n    // increase memory usage\n    const lines = []; // Indices where lines start\n    const data = []; // Flat array of coordinate data\n\n    while (pbf.pos < endPos) {\n      if (length <= 0) {\n        cmdLen = pbf.readVarint();\n        cmd = cmdLen & 0x7;\n        length = cmdLen >> 3;\n      }\n\n      length--;\n\n      if (cmd === 1 || cmd === 2) {\n        x += pbf.readSVarint();\n        y += pbf.readSVarint();\n\n        if (cmd === 1) {\n          // New line\n          lines.push(i);\n        }\n        data.push(x, y);\n        i += 2;\n      } else if (cmd === 7) {\n        // Workaround for https://github.com/mapbox/mapnik-vector-tile/issues/90\n        if (i > 0) {\n          const start = lines[lines.length - 1]; // start index of polygon\n          data.push(data[start], data[start + 1]); // closePolygon\n          i += 2;\n        }\n      } else {\n        throw new Error(`unknown command ${cmd}`);\n      }\n    }\n\n    return {data, lines};\n  }\n\n  _toBinaryCoordinates(transform) {\n    // Expands the protobuf data to an intermediate `lines`\n    // data format, which maps closely to the binary data buffers.\n    // It is similar to GeoJSON, but rather than storing the coordinates\n    // in multidimensional arrays, we have a 1D `data` with all the\n    // coordinates, and then index into this using the `lines`\n    // parameter, e.g.\n    //\n    // geometry: {\n    //   type: 'Point', data: [1,2], lines: [0]\n    // }\n    // geometry: {\n    //   type: 'LineString', data: [1,2,3,4,...], lines: [0]\n    // }\n    // geometry: {\n    //   type: 'Polygon', data: [1,2,3,4,...], lines: [[0, 2]]\n    // }\n    // Thus the lines member lets us look up the relevant range\n    // from the data array.\n    // The Multi* versions of the above types share the same data\n    // structure, just with multiple elements in the lines array\n    let geom = this.loadGeometry();\n\n    // Apply the supplied transformation to data\n    transform(geom.data, this);\n\n    const coordLength = 2;\n\n    switch (this.type) {\n      case 1: // Point\n        this._firstPassData.pointFeaturesCount++;\n        this._firstPassData.pointPositionsCount += geom.lines.length;\n        break;\n\n      case 2: // LineString\n        this._firstPassData.lineFeaturesCount++;\n        this._firstPassData.linePathsCount += geom.lines.length;\n        this._firstPassData.linePositionsCount += geom.data.length / coordLength;\n        break;\n\n      case 3: // Polygon\n        const classified = classifyRings(geom);\n\n        // Unlike Point & LineString geom.lines is a 2D array, thanks\n        // to the classifyRings method\n        this._firstPassData.polygonFeaturesCount++;\n        this._firstPassData.polygonObjectsCount += classified.lines.length;\n\n        for (const lines of classified.lines) {\n          this._firstPassData.polygonRingsCount += lines.length;\n        }\n        this._firstPassData.polygonPositionsCount += classified.data.length / coordLength;\n\n        // @ts-ignore\n        geom = classified;\n        break;\n    }\n\n    geom.type = VectorTileFeature.types[this.type];\n    if (geom.lines.length > 1) {\n      geom.type = `Multi${geom.type}`;\n    }\n\n    const result = {\n      type: 'Feature',\n      geometry: geom,\n      properties: this.properties\n    };\n\n    if (this.id !== null) {\n      result.id = this.id;\n    }\n\n    return result;\n  }\n\n  toBinaryCoordinates(options) {\n    if (typeof options === 'function') {\n      return this._toBinaryCoordinates(options);\n    }\n    const {x, y, z} = options;\n    const size = this.extent * Math.pow(2, z);\n    const x0 = this.extent * x;\n    const y0 = this.extent * y;\n\n    function project(data) {\n      for (let j = 0, jl = data.length; j < jl; j += 2) {\n        data[j] = ((data[j] + x0) * 360) / size - 180;\n        const y2 = 180 - ((data[j + 1] + y0) * 360) / size;\n        data[j + 1] = (360 / Math.PI) * Math.atan(Math.exp((y2 * Math.PI) / 180)) - 90;\n      }\n    }\n    return this._toBinaryCoordinates(project);\n  }\n}\n\n/**\n * Classifies an array of rings into polygons with outer rings and holes\n * The function also detects holes which have zero area and\n * removes them. In doing so it modifies the input\n * `geom.data` array to remove the unneeded data\n */\nfunction classifyRings(geom) {\n  const len = geom.lines.length;\n\n  if (len <= 1) {\n    return {\n      data: geom.data,\n      areas: [[getPolygonSignedArea(geom.data)]],\n      lines: [geom.lines]\n    };\n  }\n\n  const areas = [];\n  const polygons = [];\n  let ringAreas;\n  let polygon;\n  let ccw;\n  let offset = 0;\n\n  for (let i = 0, startIndex, endIndex; i < len; i++) {\n    startIndex = geom.lines[i] - offset;\n\n    endIndex = geom.lines[i + 1] - offset || geom.data.length;\n    const shape = geom.data.slice(startIndex, endIndex);\n    const area = getPolygonSignedArea(shape);\n\n    if (area === 0) {\n      // This polygon has no area, so remove it from the shape\n      // Remove the section from the data array\n      const before = geom.data.slice(0, startIndex);\n      const after = geom.data.slice(endIndex);\n      geom.data = before.concat(after);\n\n      // Need to offset any remaining indices as we have\n      // modified the data buffer\n      offset += endIndex - startIndex;\n\n      // Do not add this index to the output and process next shape\n      continue;\n    }\n\n    if (ccw === undefined) ccw = area < 0;\n\n    if (ccw === area < 0) {\n      if (polygon) {\n        areas.push(ringAreas);\n        polygons.push(polygon);\n      }\n      polygon = [startIndex];\n      ringAreas = [area];\n    } else {\n      // @ts-ignore\n      ringAreas.push(area);\n      // @ts-ignore\n      polygon.push(startIndex);\n    }\n  }\n  if (ringAreas) areas.push(ringAreas);\n  if (polygon) polygons.push(polygon);\n\n  return {areas, lines: polygons, data: geom.data};\n}\n\n// All code below is unchanged from the original Mapbox implemenation\n\nfunction readFeature(tag, feature, pbf) {\n  if (tag === 1) feature.id = pbf.readVarint();\n  else if (tag === 2) readTag(pbf, feature);\n  else if (tag === 3) feature.type = pbf.readVarint();\n  else if (tag === 4) feature._geometry = pbf.pos;\n}\n\nfunction readTag(pbf, feature) {\n  const end = pbf.readVarint() + pbf.pos;\n\n  while (pbf.pos < end) {\n    const key = feature._keys[pbf.readVarint()];\n    const value = feature._values[pbf.readVarint()];\n    feature.properties[key] = value;\n  }\n}\n"],"file":"vector-tile-feature.js"}