"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.makeSchemaFromAttributes = makeSchemaFromAttributes;

var _schema = require("@loaders.gl/schema");

function makeSchemaFromAttributes(attributes, loaderData, indices) {
  var metadataMap = makeMetadata(loaderData.metadata);
  var fields = [];
  var namedLoaderDataAttributes = transformAttributesLoaderData(loaderData.attributes);

  for (var _attributeName in attributes) {
    var attribute = attributes[_attributeName];
    var field = getArrowFieldFromAttribute(_attributeName, attribute, namedLoaderDataAttributes[_attributeName]);
    fields.push(field);
  }

  if (indices) {
    var indicesField = getArrowFieldFromAttribute('indices', indices);
    fields.push(indicesField);
  }

  return new _schema.Schema(fields, metadataMap);
}

function transformAttributesLoaderData(loaderData) {
  var result = {};

  for (var _key in loaderData) {
    var dracoAttribute = loaderData[_key];
    result[dracoAttribute.name || 'undefined'] = dracoAttribute;
  }

  return result;
}

function getArrowFieldFromAttribute(attributeName, attribute, loaderData) {
  var metadataMap = loaderData ? makeMetadata(loaderData.metadata) : undefined;
  var type = (0, _schema.getArrowTypeFromTypedArray)(attribute.value);
  return new _schema.Field(attributeName, new _schema.FixedSizeList(attribute.size, new _schema.Field('value', type)), false, metadataMap);
}

function makeMetadata(metadata) {
  var metadataMap = new Map();

  for (var _key2 in metadata) {
    metadataMap.set("".concat(_key2, ".string"), JSON.stringify(metadata[_key2]));
  }

  return metadataMap;
}
//# sourceMappingURL=schema-attribute-utils.js.map