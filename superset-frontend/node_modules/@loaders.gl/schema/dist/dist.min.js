!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n=e();for(var r in n)("object"==typeof exports?exports:t)[r]=n[r]}}(window,(function(){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var s=e[r]={i:r,l:!1,exports:{}};return t[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(r,s,function(e){return t[e]}.bind(null,s));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=1)}([,function(t,e,n){(function(e){const r=n(3),s="undefined"==typeof window?e:window;s.loaders=s.loaders||{},t.exports=Object.assign(s.loaders,r)}).call(this,n(2))},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){"use strict";function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.r(e),n.d(e,"TableBatchBuilder",(function(){return f})),n.d(e,"RowTableBatchAggregator",(function(){return c})),n.d(e,"ColumnarTableBatchAggregator",(function(){return l})),n.d(e,"convertToObjectRow",(function(){return i})),n.d(e,"convertToArrayRow",(function(){return o})),n.d(e,"getMeshSize",(function(){return m})),n.d(e,"getMeshBoundingBox",(function(){return p})),n.d(e,"Schema",(function(){return g})),n.d(e,"Field",(function(){return I})),n.d(e,"DataType",(function(){return D})),n.d(e,"Null",(function(){return j})),n.d(e,"Binary",(function(){return G})),n.d(e,"Bool",(function(){return N})),n.d(e,"Int",(function(){return F})),n.d(e,"Int8",(function(){return E})),n.d(e,"Int16",(function(){return U})),n.d(e,"Int32",(function(){return C})),n.d(e,"Int64",(function(){return R})),n.d(e,"Uint8",(function(){return L})),n.d(e,"Uint16",(function(){return z})),n.d(e,"Uint32",(function(){return P})),n.d(e,"Uint64",(function(){return $})),n.d(e,"Float",(function(){return W})),n.d(e,"Float16",(function(){return V})),n.d(e,"Float32",(function(){return H})),n.d(e,"Float64",(function(){return Q})),n.d(e,"Utf8",(function(){return J})),n.d(e,"Date",(function(){return X})),n.d(e,"DateDay",(function(){return Z})),n.d(e,"DateMillisecond",(function(){return tt})),n.d(e,"Time",(function(){return nt})),n.d(e,"TimeMillisecond",(function(){return st})),n.d(e,"TimeSecond",(function(){return rt})),n.d(e,"Timestamp",(function(){return it})),n.d(e,"TimestampSecond",(function(){return ot})),n.d(e,"TimestampMillisecond",(function(){return at})),n.d(e,"TimestampMicrosecond",(function(){return ct})),n.d(e,"TimestampNanosecond",(function(){return ut})),n.d(e,"Interval",(function(){return ht})),n.d(e,"IntervalDayTime",(function(){return dt})),n.d(e,"IntervalYearMonth",(function(){return ft})),n.d(e,"FixedSizeList",(function(){return mt})),n.d(e,"deduceTableSchema",(function(){return pt})),n.d(e,"getTypeInfo",(function(){return gt})),n.d(e,"getArrowTypeFromTypedArray",(function(){return St})),n.d(e,"AsyncQueue",(function(){return Bt}));class s{constructor(t,e){if(r(this,"schema",void 0),r(this,"options",void 0),r(this,"length",0),r(this,"rows",null),r(this,"cursor",0),r(this,"_headers",[]),this.options=e,this.schema=t,!Array.isArray(t)){this._headers=[];for(const e in t)this._headers[t[e].index]=t[e].name}}rowCount(){return this.length}addArrayRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.rows=this.rows||new Array(100),this.rows[this.length]=t,this.length++}addObjectRow(t,e){Number.isFinite(e)&&(this.cursor=e),this.rows=this.rows||new Array(100),this.rows[this.length]=t,this.length++}getBatch(){let t=this.rows;if(!t)return null;t=t.slice(0,this.length),this.rows=null;return{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}}}function i(t,e){if(!t)throw new Error("null row");if(!e)throw new Error("no headers");const n={};for(let r=0;r<e.length;r++)n[e[r]]=t[r];return n}function o(t,e){if(!t)throw new Error("null row");if(!e)throw new Error("no headers");const n=new Array(e.length);for(let r=0;r<e.length;r++)n[r]=t[e[r]];return n}function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class c{constructor(t,e){if(a(this,"schema",void 0),a(this,"options",void 0),a(this,"length",0),a(this,"objectRows",null),a(this,"arrayRows",null),a(this,"cursor",0),a(this,"_headers",[]),this.options=e,this.schema=t,!Array.isArray(t)){this._headers=[];for(const e in t)this._headers[t[e].index]=t[e].name}}rowCount(){return this.length}addArrayRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this.options.shape){case"object-row-table":const n=i(t,this._headers);this.addObjectRow(n,e);break;case"array-row-table":this.arrayRows=this.arrayRows||new Array(100),this.arrayRows[this.length]=t,this.length++}}addObjectRow(t,e){switch(Number.isFinite(e)&&(this.cursor=e),this.options.shape){case"array-row-table":const n=o(t,this._headers);this.addArrayRow(n,e);break;case"object-row-table":this.objectRows=this.objectRows||new Array(100),this.objectRows[this.length]=t,this.length++}}getBatch(){let t=this.arrayRows||this.objectRows;return t?(t=t.slice(0,this.length),this.arrayRows=null,this.objectRows=null,{shape:this.options.shape,batchType:"data",data:t,length:this.length,schema:this.schema,cursor:this.cursor}):null}}function u(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class l{constructor(t,e){u(this,"schema",void 0),u(this,"length",0),u(this,"allocated",0),u(this,"columns",{}),this.schema=t,this._reallocateColumns()}rowCount(){return this.length}addArrayRow(t){this._reallocateColumns();let e=0;for(const n in this.columns)this.columns[n][this.length]=t[e++];this.length++}addObjectRow(t){this._reallocateColumns();for(const e in t)this.columns[e][this.length]=t[e];this.length++}getBatch(){this._pruneColumns();const t=Array.isArray(this.schema)?this.columns:{};if(!Array.isArray(this.schema))for(const e in this.schema){const n=this.schema[e];t[n.name]=this.columns[n.index]}this.columns={};return{shape:"columnar-table",batchType:"data",data:t,schema:this.schema,length:this.length}}_reallocateColumns(){if(!(this.length<this.allocated)){this.allocated=this.allocated>0?this.allocated*=2:100,this.columns={};for(const t in this.schema){const e=this.schema[t],n=e.type||Float32Array,r=this.columns[e.index];if(r&&ArrayBuffer.isView(r)){const t=new n(this.allocated);t.set(r),this.columns[e.index]=t}else r?(r.length=this.allocated,this.columns[e.index]=r):this.columns[e.index]=new n(this.allocated)}}}_pruneColumns(){for(const[t,e]of Object.entries(this.columns))this.columns[t]=e.slice(0,this.length)}}function h(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}const d={shape:"array-row-table",batchSize:"auto",batchDebounceMs:0,limit:0,_limitMB:0};class f{constructor(t,e){h(this,"schema",void 0),h(this,"options",void 0),h(this,"aggregator",null),h(this,"batchCount",0),h(this,"bytesUsed",0),h(this,"isChunkComplete",!1),h(this,"lastBatchEmittedMs",Date.now()),h(this,"totalLength",0),h(this,"totalBytes",0),h(this,"rowBytes",0),this.schema=t,this.options={...d,...e}}limitReached(){var t,e;return!!(Boolean(null===(t=this.options)||void 0===t?void 0:t.limit)&&this.totalLength>=this.options.limit)||!!(Boolean(null===(e=this.options)||void 0===e?void 0:e._limitMB)&&this.totalBytes/1e6>=this.options._limitMB)}addRow(t){this.limitReached()||(this.totalLength++,this.rowBytes=this.rowBytes||this._estimateRowMB(t),this.totalBytes+=this.rowBytes,Array.isArray(t)?this.addArrayRow(t):this.addObjectRow(t))}addArrayRow(t){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addArrayRow(t)}addObjectRow(t){if(!this.aggregator){const t=this._getTableBatchType();this.aggregator=new t(this.schema,this.options)}this.aggregator.addObjectRow(t)}chunkComplete(t){t instanceof ArrayBuffer&&(this.bytesUsed+=t.byteLength),"string"==typeof t&&(this.bytesUsed+=t.length),this.isChunkComplete=!0}getFullBatch(t){return this._isFull()?this._getBatch(t):null}getFinalBatch(t){return this._getBatch(t)}_estimateRowMB(t){return Array.isArray(t)?8*t.length:8*Object.keys(t).length}_isFull(){if(!this.aggregator||0===this.aggregator.rowCount())return!1;if("auto"===this.options.batchSize){if(!this.isChunkComplete)return!1}else if(this.options.batchSize>this.aggregator.rowCount())return!1;return!(this.options.batchDebounceMs>Date.now()-this.lastBatchEmittedMs)&&(this.isChunkComplete=!1,this.lastBatchEmittedMs=Date.now(),!0)}_getBatch(t){if(!this.aggregator)return null;null!=t&&t.bytesUsed&&(this.bytesUsed=t.bytesUsed);const e=this.aggregator.getBatch();return e.count=this.batchCount,e.bytesUsed=this.bytesUsed,Object.assign(e,t),this.batchCount++,this.aggregator=null,e}_getTableBatchType(){switch(this.options.shape){case"row-table":return s;case"array-row-table":case"object-row-table":return c;case"columnar-table":return l;case"arrow-table":if(!f.ArrowBatch)throw new Error("TableBatchBuilder");return f.ArrowBatch;default:throw new Error("TableBatchBuilder")}}}function m(t){let e=0;for(const n in t){const r=t[n];ArrayBuffer.isView(r)&&(e+=r.byteLength*r.BYTES_PER_ELEMENT)}return e}function p(t){let e=1/0,n=1/0,r=1/0,s=-1/0,i=-1/0,o=-1/0;const a=t.POSITION?t.POSITION.value:[],c=a&&a.length;for(let t=0;t<c;t+=3){const c=a[t],u=a[t+1],l=a[t+2];e=c<e?c:e,n=u<n?u:n,r=l<r?l:r,s=c>s?c:s,i=u>i?u:i,o=l>o?l:o}return[[e,n,r],[s,i,o]]}function y(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}h(f,"ArrowBatch",void 0);class g{constructor(t,e){y(this,"fields",void 0),y(this,"metadata",void 0),function(t,e){if(!t)throw new Error(e||"loader assertion failed.")}(Array.isArray(t)),function(t){const e={};for(const n of t)e[n.name]&&console.warn("Schema: duplicated field name",n.name,n),e[n.name]=!0}(t),this.fields=t,this.metadata=e||new Map}compareTo(t){if(this.metadata!==t.metadata)return!1;if(this.fields.length!==t.fields.length)return!1;for(let e=0;e<this.fields.length;++e)if(!this.fields[e].compareTo(t.fields[e]))return!1;return!0}select(...t){const e=Object.create(null);for(const n of t)e[n]=!0;const n=this.fields.filter(t=>e[t.name]);return new g(n,this.metadata)}selectAt(...t){const e=t.map(t=>this.fields[t]).filter(Boolean);return new g(e,this.metadata)}assign(t){let e,n=this.metadata;if(t instanceof g){const r=t;e=r.fields,n=b(b(new Map,this.metadata),r.metadata)}else e=t;const r=Object.create(null);for(const t of this.fields)r[t.name]=t;for(const t of e)r[t.name]=t;const s=Object.values(r);return new g(s,n)}}function b(t,e){return new Map([...t||new Map,...e||new Map])}function w(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class I{constructor(t,e,n=!1,r=new Map){w(this,"name",void 0),w(this,"type",void 0),w(this,"nullable",void 0),w(this,"metadata",void 0),this.name=t,this.type=e,this.nullable=n,this.metadata=r}get typeId(){return this.type&&this.type.typeId}clone(){return new I(this.name,this.type,this.nullable,this.metadata)}compareTo(t){return this.name===t.name&&this.type===t.type&&this.nullable===t.nullable&&this.metadata===t.metadata}toString(){return`${this.type}${this.nullable?", nullable":""}${this.metadata?", metadata: "+this.metadata:""}`}}let S,T,v,B,x,A,_,O;function M(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}!function(t){t[t.NONE=0]="NONE",t[t.Null=1]="Null",t[t.Int=2]="Int",t[t.Float=3]="Float",t[t.Binary=4]="Binary",t[t.Utf8=5]="Utf8",t[t.Bool=6]="Bool",t[t.Decimal=7]="Decimal",t[t.Date=8]="Date",t[t.Time=9]="Time",t[t.Timestamp=10]="Timestamp",t[t.Interval=11]="Interval",t[t.List=12]="List",t[t.Struct=13]="Struct",t[t.Union=14]="Union",t[t.FixedSizeBinary=15]="FixedSizeBinary",t[t.FixedSizeList=16]="FixedSizeList",t[t.Map=17]="Map",t[t.Dictionary=-1]="Dictionary",t[t.Int8=-2]="Int8",t[t.Int16=-3]="Int16",t[t.Int32=-4]="Int32",t[t.Int64=-5]="Int64",t[t.Uint8=-6]="Uint8",t[t.Uint16=-7]="Uint16",t[t.Uint32=-8]="Uint32",t[t.Uint64=-9]="Uint64",t[t.Float16=-10]="Float16",t[t.Float32=-11]="Float32",t[t.Float64=-12]="Float64",t[t.DateDay=-13]="DateDay",t[t.DateMillisecond=-14]="DateMillisecond",t[t.TimestampSecond=-15]="TimestampSecond",t[t.TimestampMillisecond=-16]="TimestampMillisecond",t[t.TimestampMicrosecond=-17]="TimestampMicrosecond",t[t.TimestampNanosecond=-18]="TimestampNanosecond",t[t.TimeSecond=-19]="TimeSecond",t[t.TimeMillisecond=-20]="TimeMillisecond",t[t.TimeMicrosecond=-21]="TimeMicrosecond",t[t.TimeNanosecond=-22]="TimeNanosecond",t[t.DenseUnion=-23]="DenseUnion",t[t.SparseUnion=-24]="SparseUnion",t[t.IntervalDayTime=-25]="IntervalDayTime",t[t.IntervalYearMonth=-26]="IntervalYearMonth"}(S||(S={}));class D{static isNull(t){return t&&t.typeId===S.Null}static isInt(t){return t&&t.typeId===S.Int}static isFloat(t){return t&&t.typeId===S.Float}static isBinary(t){return t&&t.typeId===S.Binary}static isUtf8(t){return t&&t.typeId===S.Utf8}static isBool(t){return t&&t.typeId===S.Bool}static isDecimal(t){return t&&t.typeId===S.Decimal}static isDate(t){return t&&t.typeId===S.Date}static isTime(t){return t&&t.typeId===S.Time}static isTimestamp(t){return t&&t.typeId===S.Timestamp}static isInterval(t){return t&&t.typeId===S.Interval}static isList(t){return t&&t.typeId===S.List}static isStruct(t){return t&&t.typeId===S.Struct}static isUnion(t){return t&&t.typeId===S.Union}static isFixedSizeBinary(t){return t&&t.typeId===S.FixedSizeBinary}static isFixedSizeList(t){return t&&t.typeId===S.FixedSizeList}static isMap(t){return t&&t.typeId===S.Map}static isDictionary(t){return t&&t.typeId===S.Dictionary}get typeId(){return S.NONE}compareTo(t){return this===t}}class j extends D{get typeId(){return S.Null}get[Symbol.toStringTag](){return"Null"}toString(){return"Null"}}class N extends D{get typeId(){return S.Bool}get[Symbol.toStringTag](){return"Bool"}toString(){return"Bool"}}T=Symbol.toStringTag;class F extends D{constructor(t,e){super(),M(this,"isSigned",void 0),M(this,"bitWidth",void 0),this.isSigned=t,this.bitWidth=e}get typeId(){return S.Int}get[T](){return"Int"}toString(){return`${this.isSigned?"I":"Ui"}nt${this.bitWidth}`}}class E extends F{constructor(){super(!0,8)}}class U extends F{constructor(){super(!0,16)}}class C extends F{constructor(){super(!0,32)}}class R extends F{constructor(){super(!0,64)}}class L extends F{constructor(){super(!1,8)}}class z extends F{constructor(){super(!1,16)}}class P extends F{constructor(){super(!1,32)}}class $ extends F{constructor(){super(!1,64)}}const Y=16,k=32,q=64;v=Symbol.toStringTag;class W extends D{constructor(t){super(),M(this,"precision",void 0),this.precision=t}get typeId(){return S.Float}get[v](){return"Float"}toString(){return"Float"+this.precision}}class V extends W{constructor(){super(Y)}}class H extends W{constructor(){super(k)}}class Q extends W{constructor(){super(q)}}class G extends D{constructor(){super()}get typeId(){return S.Binary}toString(){return"Binary"}get[Symbol.toStringTag](){return"Binary"}}class J extends D{get typeId(){return S.Utf8}get[Symbol.toStringTag](){return"Utf8"}toString(){return"Utf8"}}const K={DAY:0,MILLISECOND:1};B=Symbol.toStringTag;class X extends D{constructor(t){super(),M(this,"unit",void 0),this.unit=t}get typeId(){return S.Date}get[B](){return"Date"}toString(){return`Date${32*(this.unit+1)}<${K[this.unit]}>`}}class Z extends X{constructor(){super(K.DAY)}}class tt extends X{constructor(){super(K.MILLISECOND)}}const et={SECOND:1,MILLISECOND:1e3,MICROSECOND:1e6,NANOSECOND:1e9};x=Symbol.toStringTag;class nt extends D{constructor(t,e){super(),M(this,"unit",void 0),M(this,"bitWidth",void 0),this.unit=t,this.bitWidth=e}get typeId(){return S.Time}toString(){return`Time${this.bitWidth}<${et[this.unit]}>`}get[x](){return"Time"}}class rt extends nt{constructor(){super(et.SECOND,32)}}class st extends nt{constructor(){super(et.MILLISECOND,32)}}A=Symbol.toStringTag;class it extends D{constructor(t,e=null){super(),M(this,"unit",void 0),M(this,"timezone",void 0),this.unit=t,this.timezone=e}get typeId(){return S.Timestamp}get[A](){return"Timestamp"}toString(){return`Timestamp<${et[this.unit]}${this.timezone?", "+this.timezone:""}>`}}class ot extends it{constructor(t=null){super(et.SECOND,t)}}class at extends it{constructor(t=null){super(et.MILLISECOND,t)}}class ct extends it{constructor(t=null){super(et.MICROSECOND,t)}}class ut extends it{constructor(t=null){super(et.NANOSECOND,t)}}const lt={DAY_TIME:0,YEAR_MONTH:1};_=Symbol.toStringTag;class ht extends D{constructor(t){super(),M(this,"unit",void 0),this.unit=t}get typeId(){return S.Interval}get[_](){return"Interval"}toString(){return`Interval<${lt[this.unit]}>`}}class dt extends ht{constructor(){super(lt.DAY_TIME)}}class ft extends ht{constructor(){super(lt.YEAR_MONTH)}}O=Symbol.toStringTag;class mt extends D{constructor(t,e){super(),M(this,"listSize",void 0),M(this,"children",void 0),this.listSize=t,this.children=[e]}get typeId(){return S.FixedSizeList}get valueType(){return this.children[0].type}get valueField(){return this.children[0]}get[O](){return"FixedSizeList"}toString(){return`FixedSizeList[${this.listSize}]<${this.valueType}>`}}function pt(t,e){const n=Array.isArray(t)?function(t){const e={};if(t.length){const n=t[0];for(const t in n){const r=n[t];e[t]=yt(r)}}return e}(t):function(t){const e={};for(const n in t){const r=t[n];if(ArrayBuffer.isView(r))e[n]=r.constructor;else if(r.length){const t=r[0];e[n]=yt(t)}e[n]=e[n]||null}return e}(t);return Object.assign(n,e)}function yt(t){return t instanceof Date?Date:t instanceof Number?Float32Array:"string"==typeof t?String:null}function gt(t){return{typeId:t.typeId,ArrayType:t.ArrayType,typeName:t.toString(),typeEnumName:It(t.typeId),precision:t.precision}}let bt,wt=null;function It(t){if(!wt){wt={};for(const t in S)wt[S[t]]=t}return wt[t]}function St(t){switch(t.constructor){case Int8Array:return new E;case Uint8Array:return new L;case Int16Array:return new U;case Uint16Array:return new z;case Int32Array:return new C;case Uint32Array:return new P;case Float32Array:return new H;case Float64Array:return new Q;default:throw new Error("array type not supported")}}function Tt(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}class vt extends Array{enqueue(t){return this.push(t)}dequeue(){return this.shift()}}bt=Symbol.asyncIterator;class Bt{constructor(){Tt(this,"_values",void 0),Tt(this,"_settlers",void 0),Tt(this,"_closed",void 0),this._values=new vt,this._settlers=new vt,this._closed=!1}close(){for(;this._settlers.length>0;)this._settlers.dequeue().resolve({done:!0});this._closed=!0}[bt](){return this}enqueue(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");const e=this._settlers.dequeue();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.enqueue(t)}next(){if(this._values.length>0){const t=this._values.dequeue();return t instanceof Error?Promise.reject(t):Promise.resolve({value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0})}return new Promise((t,e)=>{this._settlers.enqueue({resolve:t,reject:e})})}}}])}));
//# sourceMappingURL=dist.min.js.map