{"version":3,"sources":["../../../src/classes/spherical-coordinates.js"],"names":["EPSILON","EARTH_RADIUS_METERS","SphericalCoordinates","phi","theta","radius","bearing","undefined","pitch","altitude","radiusScale","check","formatString","config","printTypes","f","formatValue","other","v","Math","PI","copy","lng","lat","z","vec3","length","atan2","acos","Vector3","rotateX","radians","rotateZ","max","min","Number","isFinite","Error"],"mappings":"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","sourcesContent":["// Copyright (c) 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n// Adaptation of THREE.js Spherical class, under MIT license\nimport {formatValue, equals, config} from '../lib/common';\nimport {degrees, radians, clamp} from '../lib/common';\nimport Vector3 from './vector3';\n\n// @ts-ignore: error TS2307: Cannot find module 'gl-matrix/...'.\nimport * as vec3 from 'gl-matrix/vec3';\n\n// TODO - import epsilon\nconst EPSILON = 0.000001;\n\nconst EARTH_RADIUS_METERS = 6.371e6;\n\n// Todo [rho, theta, phi] ?\nexport default class SphericalCoordinates {\n  // @ts-ignore TS2740: Type '{}' is missing the following properties from type\n  // eslint-disable-next-line complexity\n  constructor({\n    phi = 0,\n    theta = 0,\n    radius = 1,\n    bearing = undefined,\n    pitch = undefined,\n    altitude = undefined,\n    radiusScale = EARTH_RADIUS_METERS\n  } = {}) {\n    this.phi = phi;\n    this.theta = theta;\n    // TODO - silently accepts illegal 0\n    this.radius = radius || altitude || 1; // radial distance from center\n    this.radiusScale = radiusScale || 1; // Used by lngLatZ\n\n    if (bearing !== undefined) {\n      this.bearing = bearing; // up / down towards top and bottom pole\n    }\n    if (pitch !== undefined) {\n      this.pitch = pitch; // around the equator of the sphere\n    }\n    this.check();\n  }\n\n  toString() {\n    return this.formatString(config);\n  }\n\n  formatString({printTypes = false}) {\n    const f = formatValue;\n    return `${printTypes ? 'Spherical' : ''}\\\n[rho:${f(this.radius)},theta:${f(this.theta)},phi:${f(this.phi)}]`;\n  }\n\n  equals(other) {\n    return (\n      equals(this.radius, other.radius) &&\n      equals(this.theta, other.theta) &&\n      equals(this.phi, other.phi)\n    );\n  }\n\n  exactEquals(other) {\n    return this.radius === other.radius && this.theta === other.theta && this.phi === other.phi;\n  }\n\n  /* eslint-disable brace-style */\n  // Cartographic (bearing 0 north, pitch 0 look from above)\n  get bearing() {\n    return 180 - degrees(this.phi);\n  }\n  set bearing(v) {\n    this.phi = Math.PI - radians(v);\n  }\n  get pitch() {\n    return degrees(this.theta);\n  }\n  set pitch(v) {\n    this.theta = radians(v);\n  }\n  // get pitch() { return 90 - degrees(this.phi); }\n  // set pitch(v) { this.phi = radians(v) + Math.PI / 2; }\n  // get altitude() { return this.radius - 1; } // relative altitude\n\n  // lnglatZ coordinates\n  get longitude() {\n    return degrees(this.phi);\n  }\n  get latitude() {\n    return degrees(this.theta);\n  }\n  get lng() {\n    return degrees(this.phi);\n  }\n  get lat() {\n    return degrees(this.theta);\n  }\n  get z() {\n    return (this.radius - 1) * this.radiusScale;\n  }\n  /* eslint-enable brace-style */\n\n  set(radius, phi, theta) {\n    this.radius = radius;\n    this.phi = phi;\n    this.theta = theta;\n    return this.check();\n  }\n\n  clone() {\n    return new SphericalCoordinates().copy(this);\n  }\n\n  copy(other) {\n    this.radius = other.radius;\n    this.phi = other.phi;\n    this.theta = other.theta;\n    return this.check();\n  }\n\n  fromLngLatZ([lng, lat, z]) {\n    this.radius = 1 + z / this.radiusScale;\n    this.phi = radians(lat);\n    this.theta = radians(lng);\n  }\n\n  fromVector3(v) {\n    this.radius = vec3.length(v);\n    if (this.radius > 0) {\n      this.theta = Math.atan2(v[0], v[1]); // equator angle around y-up axis\n      this.phi = Math.acos(clamp(v[2] / this.radius, -1, 1)); // polar angle\n    }\n    return this.check();\n  }\n\n  toVector3() {\n    return new Vector3(0, 0, this.radius)\n      .rotateX({radians: this.theta})\n      .rotateZ({radians: this.phi});\n  }\n\n  // restrict phi to be betwee EPS and PI-EPS\n  makeSafe() {\n    this.phi = Math.max(EPSILON, Math.min(Math.PI - EPSILON, this.phi));\n    return this;\n  }\n\n  check() {\n    // this.makeSafe();\n    if (!Number.isFinite(this.phi) || !Number.isFinite(this.theta) || !(this.radius > 0)) {\n      throw new Error('SphericalCoordinates: some fields set to invalid numbers');\n    }\n    return this;\n  }\n}\n"],"file":"spherical-coordinates.js"}