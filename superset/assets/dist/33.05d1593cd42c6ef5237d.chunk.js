(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{2737:function(e,t,r){"use strict";r.d(t,"a",function(){return s});var a=r(12),n=r.n(a),o=[1,0,1,0,0,0,0];function i(e,t){var r=parseInt(n()(t).format("x"),10);return parseInt(n()(t).add(e).format("x"),10)-r}function s(e,t){var r,a,s=n()(Math.min.apply(Math,e)),l=n()(Math.max.apply(Math,e));if(-1!==t.indexOf("/")){var u=t.split("/",2);u[0].endsWith("Z")?(a=n()(u[0]),r=n.a.duration(u[1])):(a=n()(u[1]),r=n.a.duration(u[0]))}else a=function(e,t){var r=n()(e).subtract(t),a=e.toArray(),i=r.toArray(),s=a.map(function(e,t){return i[t]!==e}).indexOf(!0),l=a.map(function(e,t){if(t===s){var r=e-i[t];return e-(e-o[t])%r}return t<s||-1===s?e:o[t]});return n()(l)}(s,r=n.a.duration(t));var c,p=s.valueOf();for(c=a.clone();c.valueOf()<p;)c.add(r);for(;c.valueOf()>p;)c.subtract(r);var d,f=l.valueOf();for(d=a.clone();d.valueOf()>f;)d.subtract(r);for(;d.valueOf()<f;)d.add(r);var h=null==t?[c,d]:[c,c.clone().add(r)],m=e.every(function(e){return null===e});return{start:parseInt(c.format("x"),10),end:parseInt(d.format("x"),10),getStep:i.bind(this,r),values:h.map(function(e){return parseInt(e.format("x"),10)}),disabled:m}}},2739:function(e,t,r){"use strict";var a=r(1),n=r.n(a),o=r(0),i=r.n(o),s=r(2736),l=r(1336),u=r.n(l),c=r(8),p=r(1881),d=r.n(p);r(2169),r(2741);function f(e){return n.a.createElement("span",{className:"BootstrapSliderWrapper"},n.a.createElement(d.a,e))}r(2742);function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var m={start:i.a.number.isRequired,step:i.a.number.isRequired,end:i.a.number.isRequired,values:i.a.array.isRequired,onChange:i.a.func,loopDuration:i.a.number,maxFrames:i.a.number,orientation:i.a.oneOf(["horizontal","vertical"]),reversed:i.a.bool,disabled:i.a.bool,range:i.a.bool},g=function(e){function t(t){var r;(r=e.call(this,t)||this).state={intervalId:null};var a=t.end-t.start,n=Math.min(t.maxFrames,a/t.step),o=a/n;return r.intervalMilliseconds=t.loopDuration/n,r.increment=o<t.step?t.step:o-o%t.step,r.onChange=r.onChange.bind(h(r)),r.play=r.play.bind(h(r)),r.pause=r.pause.bind(h(r)),r.stepBackward=r.stepBackward.bind(h(r)),r.stepForward=r.stepForward.bind(h(r)),r.getPlayClass=r.getPlayClass.bind(h(r)),r.formatter=r.formatter.bind(h(r)),r}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var r=t.prototype;return r.componentDidMount=function(){u.a.bind(["space"],this.play)},r.componentWillUnmount=function(){u.a.unbind(["space"])},r.onChange=function(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()},r.getPlayClass=function(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"},r.play=function(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{var e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}},r.pause=function(){clearInterval(this.state.intervalId),this.setState({intervalId:null})},r.stepForward=function(){var e=this,t=this.props,r=t.start,a=t.end,n=t.step,o=t.values;if(!t.disabled){var i=(Array.isArray(o)?o:[o,o+n]).map(function(t){return t+e.increment}),s=i[1]>a?i[0]-r:0;this.props.onChange(i.map(function(e){return e-s}))}},r.stepBackward=function(){var e=this,t=this.props,r=t.start,a=t.end,n=t.step,o=t.values;if(!t.disabled){var i=(Array.isArray(o)?o:[o,o+n]).map(function(t){return t-e.increment}),s=i[0]<r?a-i[1]:0;this.props.onChange(i.map(function(e){return e+s}))}},r.formatter=function(e){if(this.props.disabled)return Object(c.b)("Data has no time steps");var t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map(function(e){return new Date(e).toUTCString()}).join(" : ")},r.render=function(){var e=this.props,t=e.start,r=e.end,a=e.step,o=e.orientation,i=e.reversed,s=e.disabled,l=e.range,u=e.values;return n.a.createElement("div",{className:"play-slider"},n.a.createElement("div",{className:"play-slider-controls padded"},n.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),n.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),n.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),n.a.createElement("div",{className:"play-slider-scrobbler padded"},n.a.createElement(f,{value:l?u:u[0],range:l,formatter:this.formatter,change:this.onChange,min:t,max:r,step:a,orientation:o,reversed:i,disabled:s?"disabled":"enabled"})))},t}(n.a.PureComponent);function v(){return(v=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)}g.propTypes=m,g.defaultProps={onChange:function(){},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0},r.d(t,"a",function(){return y});var b={getLayers:i.a.func.isRequired,start:i.a.number.isRequired,end:i.a.number.isRequired,getStep:i.a.func,values:i.a.array.isRequired,aggregation:i.a.bool,disabled:i.a.bool,viewport:i.a.object.isRequired,children:i.a.node,mapStyle:i.a.string,mapboxApiAccessToken:i.a.string.isRequired,setControlValue:i.a.func,onViewportChange:i.a.func,onValuesChange:i.a.func},y=function(e){function t(t){var r;return(r=e.call(this,t)||this).onViewportChange=r.onViewportChange.bind(function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(r)),r}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var r=t.prototype;return r.onViewportChange=function(e){var t=this.props.disabled?v({},e):v({},e,{height:e.height+20});this.props.onViewportChange(t)},r.render=function(){var e=this.props,t=e.start,r=e.end,a=e.getStep,o=e.disabled,i=e.aggregation,l=e.children,u=e.getLayers,c=e.values,p=e.onValuesChange,d=e.viewport,f=e.setControlValue,h=e.mapStyle,m=e.mapboxApiAccessToken,b=u(c),y=v({},d,{height:o?d.height:d.height-20});return n.a.createElement("div",null,n.a.createElement(s.a,{viewport:y,layers:b,setControlValue:f,mapStyle:h,mapboxApiAccessToken:m,onViewportChange:this.onViewportChange}),!o&&n.a.createElement(g,{start:t,end:r,step:a(t),values:c,range:!i,onChange:p}),l)},t}(n.a.Component);y.propTypes=b,y.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:function(){},onViewportChange:function(){},onValuesChange:function(){}}},2741:function(e,t,r){},2742:function(e,t,r){},2744:function(e,t,r){"use strict";r.d(t,"a",function(){return u});var a=r(1),n=r.n(a),o=r(0),i=r.n(o),s=r(578);r(2745);var l={categories:i.a.object,toggleCategory:i.a.func,showSingleCategory:i.a.func,format:i.a.string,position:i.a.oneOf([null,"tl","tr","bl","br"])},u=function(e){function t(){return e.apply(this,arguments)||this}!function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}(t,e);var r=t.prototype;return r.format=function(e){if(!this.props.format)return e;var t=parseFloat(e);return Object(s.b)(this.props.format,t)},r.formatCategoryLabel=function(e){if(!this.props.format)return e;if(e.includes(" - ")){var t=e.split(" - ");return this.format(t[0])+" - "+this.format(t[1])}return this.format(e)},r.render=function(){var e,t=this;if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;var r=Object.entries(this.props.categories).map(function(e){var r=e[0],a=e[1],o={color:"rgba("+a.color.join(", ")+")"},i=a.enabled?"◼":"◻";return n.a.createElement("li",{key:r},n.a.createElement("a",{href:"#",onClick:function(){return t.props.toggleCategory(r)},onDoubleClick:function(){return t.props.showSingleCategory(r)}},n.a.createElement("span",{style:o},i)," ",t.formatCategoryLabel(r)))}),a="t"===this.props.position.charAt(0)?"top":"bottom",o="r"===this.props.position.charAt(1)?"right":"left",i=((e={position:"absolute"})[a]="0px",e[o]="10px",e);return n.a.createElement("div",{className:"legend",style:i},n.a.createElement("ul",{className:"categories"},r))},t}(n.a.PureComponent);u.propTypes=l,u.defaultProps={categories:{},toggleCategory:function(){},showSingleCategory:function(){},format:null,position:"tr"}},2745:function(e,t,r){},2751:function(e,t){},2752:function(e,t){},2753:function(e,t){},2855:function(e,t,r){"use strict";r.r(t);var a=r(1),n=r.n(a),o=r(0),i=r.n(o),s=r(2738),l=r(2739),u=r(2744),c=r(2740),p=r(23),d=r(183),f=r(272),h=r(888),m=r(2748),g=10;function v(e,t,r){var a=e.break_points,n=e.num_buckets;if(!t)return[];if(void 0===a||0===a.length){var o=n?parseInt(n,10):g,i=Object(p.extent)(t,r),s=i[0],l=i[1];if(void 0===s)return[];var u=(l-s)/o,c=0===u?0:Math.max(0,Math.ceil(Math.log10(1/u))),d=l>l.toFixed(c)?1:0;return Array(o+1+d).fill().map(function(e,t){return(s+t*u).toFixed(c)})}return a.sort(function(e,t){return parseFloat(e)-parseFloat(t)})}function b(e,t,r){var a,n,o=e.break_points,i=e.num_buckets,s=e.linear_color_scheme,l=e.opacity,u=o||i?v({break_points:o,num_buckets:i},t,r):null,c=Array.isArray(s)?new f.a({colors:s,id:"custom"}):Object(h.a)().get(s);if(null!==u){var g=u.length-1,b=1<g?c.getColors(g):[c.colors[c.colors.length-1]],y=b[0],C=b[b.length-1];b.unshift(y),b.push(C);var _=u.map(function(e){return parseFloat(e)});a=Object(d.i)().domain(_).range(b),n=function(e){return e>u[g]||e<u[0]}}else a=c.createLinearScale(Object(p.extent)(t,r)),n=function(){return!1};return function(e){var t=r(e),o=Object(m.hexToRGB)(a(t));return o[3]=n(t)?0:l/100*255,o}}var y=r(2725),C=r(2737),_=r(2735);function w(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(){return(O=Object.assign||function(e){for(var t,r=1;r<arguments.length;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)}r.d(t,"getLayer",function(){return k});function k(e,t,r,a,o,i,l){var u=e,p=u.fill_color_picker,d=u.stroke_color_picker,f=[].concat(t.data.features);if(null!=l&&l.forEach(function(e){f=f.filter(e)}),u.js_data_mutator){var h=Object(_.a)(u.js_data_mutator);f=h(f)}var m=u.metric?u.metric.label||u.metric:null,g=null===u.metric?function(){return[p.r,p.g,p.b,255*p.a]}:b(u,f,function(e){return e[m]}),v=function(e){var t=g(e);return 0<o.length&&-1===o.indexOf(e[u.line_column])&&(t[3]/=2),t},C=u.line_column&&u.metric&&0<=["geohash","zipcode"].indexOf(u.line_type)?function(e){return function(t){var r=e.metric.label||e.metric;return n.a.createElement("div",{className:"deckgl-tooltip"},n.a.createElement(c.a,{label:e.line_column+": ",value:""+t.object[e.line_column]}),e.metric&&n.a.createElement(c.a,{label:r+": ",value:""+t.object[r]}))}}(u):void 0;return new s.f(O({id:"path-layer-"+u.slice_id,data:f,pickable:!0,filled:u.filled,stroked:u.stroked,getPolygon:function(e){return e.polygon},getFillColor:v,getLineColor:[d.r,d.g,d.b,255*d.a],getLineWidth:u.line_width,extruded:u.extruded,getElevation:function(e){return function(e,t){return 0===t(e)[3]?0:e.elevation}(e,v)},elevationScale:u.multiplier,fp64:!0},Object(y.a)(u,a,C,i)))}var j={formData:i.a.object.isRequired,payload:i.a.object.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func},x=function(e){function t(r){var a;return(a=e.call(this,r)||this).state=t.getDerivedStateFromProps(r),a.getLayers=a.getLayers.bind(w(a)),a.onSelect=a.onSelect.bind(w(a)),a.onValuesChange=a.onValuesChange.bind(w(a)),a.onViewportChange=a.onViewportChange.bind(w(a)),a}(function(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t})(t,e),t.getDerivedStateFromProps=function(e,t){if(t&&e.payload.form_data===t.formData)return null;var r=e.payload.data.features||[],a=r.map(function(e){return e.__timestamp}),n=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",o=Object(C.a)(a,n);return{start:o.start,end:o.end,getStep:o.getStep,values:o.values,disabled:o.disabled,viewport:e.formData.autozoom?Object(y.b)(e.viewport,function(e){return e.map(function(e){return e.polygon}).flat()}(r)):e.viewport,selected:[],lastClick:0,formData:e.payload.form_data}};var r=t.prototype;return r.onSelect=function(e){var t=this.props,r=t.formData,a=t.onAddFilter,n=new Date,o=n-this.state.lastClick<=250,i=[].concat(this.state.selected);if(o)i.splice(0,i.length,e);else if(r.toggle_polygons){var s=i.indexOf(e);-1===s?i.push(e):i.splice(s,1)}else i.splice(0,1,e);this.setState({selected:i,lastClick:n}),r.table_filter&&a(r.line_column,i,!1,!0)},r.onValuesChange=function(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})},r.onViewportChange=function(e){this.setState({viewport:e})},r.getLayers=function(e){if(void 0===this.props.payload.data.features)return[];var t=[];return e[0]===e[1]||e[1]===this.end?t.push(function(t){return t.__timestamp>=e[0]&&t.__timestamp<=e[1]}):t.push(function(t){return t.__timestamp>=e[0]&&t.__timestamp<e[1]}),[k(this.props.formData,this.props.payload,this.props.onAddFilter,this.props.setTooltip,this.state.selected,this.onSelect,t)]},r.render=function(){var e=this.props,t=e.payload,r=e.formData,a=e.setControlValue,o=this.state,i=o.start,s=o.end,c=o.getStep,p=o.values,d=o.disabled,f=o.viewport,h=r,m=h.metric?h.metric.label||h.metric:null,g=function(e,t,r){var a=v(e,t,r),n=b(e,t,r),o={};return a.slice(1).forEach(function(t,r){var i,s=a[r]+" - "+a[r+1],l=.5*(parseFloat(a[r])+parseFloat(a[r+1])),u=e.metric?e.metric.label||e.metric:null;o[s]={color:n((i={},i[u||e.metric]=l,i)),enabled:!0}}),o}(r,t.data.features,function(e){return e[m]});return n.a.createElement("div",{style:{position:"relative"}},n.a.createElement(l.a,{getLayers:this.getLayers,start:i,end:s,getStep:c,values:p,onValuesChange:this.onValuesChange,disabled:d,viewport:f,onViewportChange:this.onViewportChange,mapboxApiAccessToken:t.data.mapboxApiKey,mapStyle:r.mapbox_style,setControlValue:a,aggregation:!0},null!==r.metric&&n.a.createElement(u.a,{categories:g,position:r.legend_position,format:r.legend_format})))},t}(n.a.Component);x.propTypes=j,x.defaultProps={onAddFilter:function(){},setTooltip:function(){}};t.default=x}}]);
