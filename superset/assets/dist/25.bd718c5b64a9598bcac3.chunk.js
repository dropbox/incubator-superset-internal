(window.webpackJsonp=window.webpackJsonp||[]).push([[25,28,29,30,31,32,33,35,39],{2737:function(t,e,r){"use strict";r.d(e,"a",function(){return s});var a=r(12),o=r.n(a),n=[1,0,1,0,0,0,0];function i(t,e){var r=parseInt(o()(e).format("x"),10);return parseInt(o()(e).add(t).format("x"),10)-r}function s(t,e){var r,a,s=o()(Math.min.apply(Math,t)),l=o()(Math.max.apply(Math,t));if(-1!==e.indexOf("/")){var c=e.split("/",2);c[0].endsWith("Z")?(a=o()(c[0]),r=o.a.duration(c[1])):(a=o()(c[1]),r=o.a.duration(c[0]))}else a=function(t,e){var r=o()(t).subtract(e),a=t.toArray(),i=r.toArray(),s=a.map(function(t,e){return i[e]!==t}).indexOf(!0),l=a.map(function(t,e){if(e===s){var r=t-i[e];return t-(t-n[e])%r}return e<s||-1===s?t:n[e]});return o()(l)}(s,r=o.a.duration(e));var u,p=s.valueOf();for(u=a.clone();u.valueOf()<p;)u.add(r);for(;u.valueOf()>p;)u.subtract(r);var d,f=l.valueOf();for(d=a.clone();d.valueOf()>f;)d.subtract(r);for(;d.valueOf()<f;)d.add(r);var h=null==e?[u,d]:[u,u.clone().add(r)],m=t.every(function(t){return null===t});return{start:parseInt(u.format("x"),10),end:parseInt(d.format("x"),10),getStep:i.bind(this,r),values:h.map(function(t){return parseInt(t.format("x"),10)}),disabled:m}}},2739:function(t,e,r){"use strict";var a=r(1),o=r.n(a),n=r(0),i=r.n(n),s=r(2736),l=r(1336),c=r.n(l),u=r(8),p=r(1881),d=r.n(p);r(2169),r(2741);function f(t){return o.a.createElement("span",{className:"BootstrapSliderWrapper"},o.a.createElement(d.a,t))}r(2742);function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var m={start:i.a.number.isRequired,step:i.a.number.isRequired,end:i.a.number.isRequired,values:i.a.array.isRequired,onChange:i.a.func,loopDuration:i.a.number,maxFrames:i.a.number,orientation:i.a.oneOf(["horizontal","vertical"]),reversed:i.a.bool,disabled:i.a.bool,range:i.a.bool},g=function(t){function e(e){var r;(r=t.call(this,e)||this).state={intervalId:null};var a=e.end-e.start,o=Math.min(e.maxFrames,a/e.step),n=a/o;return r.intervalMilliseconds=e.loopDuration/o,r.increment=n<e.step?e.step:n-n%e.step,r.onChange=r.onChange.bind(h(r)),r.play=r.play.bind(h(r)),r.pause=r.pause.bind(h(r)),r.stepBackward=r.stepBackward.bind(h(r)),r.stepForward=r.stepForward.bind(h(r)),r.getPlayClass=r.getPlayClass.bind(h(r)),r.formatter=r.formatter.bind(h(r)),r}!function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}(e,t);var r=e.prototype;return r.componentDidMount=function(){c.a.bind(["space"],this.play)},r.componentWillUnmount=function(){c.a.unbind(["space"])},r.onChange=function(t){this.props.onChange(t.target.value),null!=this.state.intervalId&&this.pause()},r.getPlayClass=function(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"},r.play=function(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{var t=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:t})}},r.pause=function(){clearInterval(this.state.intervalId),this.setState({intervalId:null})},r.stepForward=function(){var t=this,e=this.props,r=e.start,a=e.end,o=e.step,n=e.values;if(!e.disabled){var i=(Array.isArray(n)?n:[n,n+o]).map(function(e){return e+t.increment}),s=i[1]>a?i[0]-r:0;this.props.onChange(i.map(function(t){return t-s}))}},r.stepBackward=function(){var t=this,e=this.props,r=e.start,a=e.end,o=e.step,n=e.values;if(!e.disabled){var i=(Array.isArray(n)?n:[n,n+o]).map(function(e){return e-t.increment}),s=i[0]<r?a-i[1]:0;this.props.onChange(i.map(function(t){return t+s}))}},r.formatter=function(t){if(this.props.disabled)return Object(u.b)("Data has no time steps");var e=t;return Array.isArray(t)?t[0]===t[1]&&(e=[t[0]]):e=[t],e.map(function(t){return new Date(t).toUTCString()}).join(" : ")},r.render=function(){var t=this.props,e=t.start,r=t.end,a=t.step,n=t.orientation,i=t.reversed,s=t.disabled,l=t.range,c=t.values;return o.a.createElement("div",{className:"play-slider"},o.a.createElement("div",{className:"play-slider-controls padded"},o.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),o.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),o.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),o.a.createElement("div",{className:"play-slider-scrobbler padded"},o.a.createElement(f,{value:l?c:c[0],range:l,formatter:this.formatter,change:this.onChange,min:e,max:r,step:a,orientation:n,reversed:i,disabled:s?"disabled":"enabled"})))},e}(o.a.PureComponent);function b(){return(b=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}g.propTypes=m,g.defaultProps={onChange:function(){},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0},r.d(e,"a",function(){return y});var v={getLayers:i.a.func.isRequired,start:i.a.number.isRequired,end:i.a.number.isRequired,getStep:i.a.func,values:i.a.array.isRequired,aggregation:i.a.bool,disabled:i.a.bool,viewport:i.a.object.isRequired,children:i.a.node,mapStyle:i.a.string,mapboxApiAccessToken:i.a.string.isRequired,setControlValue:i.a.func,onViewportChange:i.a.func,onValuesChange:i.a.func},y=function(t){function e(e){var r;return(r=t.call(this,e)||this).onViewportChange=r.onViewportChange.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r)),r}!function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}(e,t);var r=e.prototype;return r.onViewportChange=function(t){var e=this.props.disabled?b({},t):b({},t,{height:t.height+20});this.props.onViewportChange(e)},r.render=function(){var t=this.props,e=t.start,r=t.end,a=t.getStep,n=t.disabled,i=t.aggregation,l=t.children,c=t.getLayers,u=t.values,p=t.onValuesChange,d=t.viewport,f=t.setControlValue,h=t.mapStyle,m=t.mapboxApiAccessToken,v=c(u),y=b({},d,{height:n?d.height:d.height-20});return o.a.createElement("div",null,o.a.createElement(s.a,{viewport:y,layers:v,setControlValue:f,mapStyle:h,mapboxApiAccessToken:m,onViewportChange:this.onViewportChange}),!n&&o.a.createElement(g,{start:e,end:r,step:a(e),values:u,range:!i,onChange:p}),l)},e}(o.a.Component);y.propTypes=v,y.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:function(){},onViewportChange:function(){},onValuesChange:function(){}}},2741:function(t,e,r){},2742:function(t,e,r){},2743:function(t,e,r){"use strict";var a=r(1),o=r.n(a),n=r(0),i=r.n(n),s=r(1335),l=r(2736),c=r(179),u=r(2739),p=r(2744),d=r(2748),f=r(2737),h=r(2735),m=r(2725);function g(){return(g=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}function b(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}var v=c.CategoricalColorNamespace.getScale;var y={formData:i.a.object.isRequired,mapboxApiKey:i.a.string.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,getLayer:i.a.func.isRequired,getPoints:i.a.func.isRequired,payload:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func},_=function(t){function e(e){var r;return(r=t.call(this,e)||this).state=r.getStateFromProps(e),r.getLayers=r.getLayers.bind(b(r)),r.onValuesChange=r.onValuesChange.bind(b(r)),r.onViewportChange=r.onViewportChange.bind(b(r)),r.toggleCategory=r.toggleCategory.bind(b(r)),r.showSingleCategory=r.showSingleCategory.bind(b(r)),r}!function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}(e,t);var r=e.prototype;return r.UNSAFE_componentWillReceiveProps=function(t){t.payload.form_data!==this.state.formData&&this.setState(g({},this.getStateFromProps(t)))},r.onValuesChange=function(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})},r.onViewportChange=function(t){this.setState({viewport:t})},r.getStateFromProps=function(t,e){var r=t.payload.data.features||[],a=r.map(function(t){return t.__timestamp}),o=function(t,e){var r=t.color_picker||{r:0,g:0,b:0,a:1},a=[r.r,r.g,r.b,255*r.a],o=v(t.color_scheme),n={};return e.forEach(function(e){var i;null==e.cat_color||n.hasOwnProperty(e.cat_color)||(i=t.dimension?Object(d.hexToRGB)(o(e.cat_color),255*r.a):a,n[e.cat_color]={color:i,enabled:!0})}),n}(t.formData,r);if(e&&t.payload.form_data===e.formData)return g({},e,{categories:o});var n=t.payload.form_data.time_grain_sqla||t.payload.form_data.granularity||"P1D",i=Object(f.a)(a,n);return{start:i.start,end:i.end,getStep:i.getStep,values:i.values,disabled:i.disabled,viewport:t.formData.autozoom?Object(m.b)(t.viewport,t.getPoints(r)):t.viewport,selected:[],lastClick:0,formData:t.payload.form_data,categories:o}},r.getLayers=function(t){var e=this.props,r=e.getLayer,a=e.payload,o=e.formData,n=e.onAddFilter,i=e.setTooltip,s=a.data.features?[].concat(a.data.features):[];(s=this.addColor(s,o),o.js_data_mutator)&&(s=Object(h.a)(o.js_data_mutator)(s));s=t[0]===t[1]||t[1]===this.end?s.filter(function(e){return e.__timestamp>=t[0]&&e.__timestamp<=t[1]}):s.filter(function(e){return e.__timestamp>=t[0]&&e.__timestamp<t[1]});var l=this.state.categories;return o.dimension&&(s=s.filter(function(t){return l[t.cat_color]&&l[t.cat_color].enabled})),[r(o,g({},a,{data:g({},a.data,{features:s})}),n,i)]},r.addColor=function(t,e){var r=e.color_picker||{r:0,g:0,b:0,a:1},a=v(e.color_scheme);return t.map(function(t){return e.dimension?g({},t,{color:Object(d.hexToRGB)(a(t.cat_color),255*r.a)}):t})},r.toggleCategory=function(t){var e,r=this.state.categories[t],a=g({},this.state.categories,((e={})[t]=g({},r,{enabled:!r.enabled}),e));Object.values(a).every(function(t){return!t.enabled})&&Object.values(a).forEach(function(t){t.enabled=!0}),this.setState({categories:a})},r.showSingleCategory=function(t){var e=g({},this.state.categories);Object.values(e).forEach(function(t){t.enabled=!1}),e[t].enabled=!0,this.setState({categories:e})},r.render=function(){return o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(u.a,{getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,onValuesChange:this.onValuesChange,disabled:this.state.disabled,viewport:this.state.viewport,onViewportChange:this.onViewportChange,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue},o.a.createElement(p.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))},e}(o.a.PureComponent);function j(){return(j=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}_.propTypes=y,r.d(e,"b",function(){return O}),r.d(e,"a",function(){return k});var C={formData:i.a.object.isRequired,payload:i.a.object.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func},w={onAddFilter:function(){},setTooltip:function(){}};function O(t,e){var r=function(r){function a(t){var a=r.call(this,t)||this,o=t.viewport,n=t.formData.autozoom?Object(m.b)(o,e(t.payload.data.features)):o;return a.state={viewport:n,layer:a.computeLayer(t)},a.onViewportChange=a.onViewportChange.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(a)),a}!function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}(a,r);var n=a.prototype;return n.UNSAFE_componentWillReceiveProps=function(t){var e=j({},t.formData,{viewport:null}),r=j({},this.props.formData,{viewport:null});Object(s.isEqual)(e,r)&&t.payload===this.props.payload||this.setState({layer:this.computeLayer(t)})},n.onViewportChange=function(t){this.setState({viewport:t})},n.computeLayer=function(e){var r=e.formData,a=e.payload,o=e.onAddFilter,n=e.setTooltip;return t(r,a,o,n)},n.render=function(){var t=this.props,e=t.formData,r=t.payload,a=t.setControlValue,n=this.state,i=n.layer,s=n.viewport;return o.a.createElement(l.a,{mapboxApiAccessToken:r.data.mapboxApiKey,viewport:s,layers:[i],mapStyle:e.mapbox_style,setControlValue:a,onViewportChange:this.onViewportChange})},a}(o.a.PureComponent);return r.propTypes=C,r.defaultProps=w,r}function k(t,e){function r(r){var a=r.formData,n=r.payload,i=r.setControlValue,s=r.onAddFilter,l=r.setTooltip,c=r.viewport;return o.a.createElement(_,{formData:a,mapboxApiKey:n.data.mapboxApiKey,setControlValue:i,viewport:c,getLayer:t,payload:n,onAddFilter:s,setTooltip:l,getPoints:e})}return r.propTypes=C,r.defaultProps=w,r}},2744:function(t,e,r){"use strict";r.d(e,"a",function(){return c});var a=r(1),o=r.n(a),n=r(0),i=r.n(n),s=r(578);r(2745);var l={categories:i.a.object,toggleCategory:i.a.func,showSingleCategory:i.a.func,format:i.a.string,position:i.a.oneOf([null,"tl","tr","bl","br"])},c=function(t){function e(){return t.apply(this,arguments)||this}!function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}(e,t);var r=e.prototype;return r.format=function(t){if(!this.props.format)return t;var e=parseFloat(t);return Object(s.b)(this.props.format,e)},r.formatCategoryLabel=function(t){if(!this.props.format)return t;if(t.includes(" - ")){var e=t.split(" - ");return this.format(e[0])+" - "+this.format(e[1])}return this.format(t)},r.render=function(){var t,e=this;if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;var r=Object.entries(this.props.categories).map(function(t){var r=t[0],a=t[1],n={color:"rgba("+a.color.join(", ")+")"},i=a.enabled?"◼":"◻";return o.a.createElement("li",{key:r},o.a.createElement("a",{href:"#",onClick:function(){return e.props.toggleCategory(r)},onDoubleClick:function(){return e.props.showSingleCategory(r)}},o.a.createElement("span",{style:n},i)," ",e.formatCategoryLabel(r)))}),a="t"===this.props.position.charAt(0)?"top":"bottom",n="r"===this.props.position.charAt(1)?"right":"left",i=((t={position:"absolute"})[a]="0px",t[n]="10px",t);return o.a.createElement("div",{className:"legend",style:i},o.a.createElement("ul",{className:"categories"},r))},e}(o.a.PureComponent);c.propTypes=l,c.defaultProps={categories:{},toggleCategory:function(){},showSingleCategory:function(){},format:null,position:"tr"}},2745:function(t,e,r){},2751:function(t,e){},2752:function(t,e){},2753:function(t,e){},2806:function(t,e,r){"use strict";r.r(e),r.d(e,"getLayer",function(){return p});var a=r(2738),o=r(1),n=r.n(o),i=r(8),s=r(2725),l=r(2743),c=r(2740);function u(){return(u=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}function p(t,e,r,o){var l=e.data.features,p=t.color_picker,d=t.target_color_picker;return new a.a(u({data:l,getSourceColor:function(t){return t.sourceColor||t.color||[p.r,p.g,p.b,255*p.a]},getTargetColor:function(t){return t.targetColor||t.color||[d.r,d.g,d.b,255*d.a]},id:"path-layer-"+t.slice_id,strokeWidth:t.stroke_width?t.stroke_width:3},Object(s.a)(t,o,function(t){return function(e){return n.a.createElement("div",{className:"deckgl-tooltip"},n.a.createElement(c.a,{label:Object(i.b)("Start (Longitude, Latitude)")+": ",value:e.object.sourcePosition[0]+", "+e.object.sourcePosition[1]}),n.a.createElement(c.a,{label:Object(i.b)("End (Longitude, Latitude)")+": ",value:e.object.targetPosition[0]+", "+e.object.targetPosition[1]}),t.dimension&&n.a.createElement(c.a,{label:t.dimension+": ",value:""+e.object.cat_color}))}}(t))))}e.default=Object(l.a)(p,function(t){var e=[];return t.forEach(function(t){e.push(t.sourcePosition),e.push(t.targetPosition)}),e})},2830:function(t,e,r){"use strict";r.r(e),r.d(e,"getLayer",function(){return y});var a=r(1),o=r.n(a),n=r(0),i=r.n(n),s=r(2738),l=r(2736),c=r(2748),u=r(2735),p=r(2725),d=r(2740);function f(){return(f=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}var h,m={fillColor:"fillColor",color:"fillColor",fill:"fillColor","fill-color":"fillColor",strokeColor:"strokeColor","stroke-color":"strokeColor","stroke-width":"strokeWidth"},g=function(t,e){var r={};return Object.keys(t).forEach(function(e){e in m?r[m[e]]=t[e]:r[e]=t[e]}),"string"==typeof t.fillColor&&(r.fillColor=Object(c.hexToRGB)(t.fillColor)),"string"==typeof t.strokeColor&&(r.strokeColor=Object(c.hexToRGB)(t.strokeColor)),f({},r,{},e)},b=function(t,e,r){if(t&&t.features&&t.features.forEach(function(a){b(a,e,t.extraProps||r)}),t&&t.geometry){var a=f({},t,{properties:g(t.properties,e)});a.extraProps||(a.extraProps=r),h.push(a)}};function v(t){return t.object.extraProps&&o.a.createElement("div",{className:"deckgl-tooltip"},Object.keys(t.object.extraProps).map(function(e,r){return o.a.createElement(d.a,{key:"prop-"+r,label:e+": ",value:""+t.object.extraProps[e]})}))}function y(t,e,r,a){var o,n=t,i=n.fill_color_picker,l=n.stroke_color_picker,c=[i.r,i.g,i.b,255*i.a],d=[l.r,l.g,l.b,255*l.a],m={};return 0<c[3]&&(m.fillColor=c),0<d[3]&&(m.strokeColor=d),h=[],b(e.data,m),n.js_data_mutator&&(o=Object(u.a)(n.js_data_mutator),h=o(h)),new s.b(f({id:"geojson-layer-"+n.slice_id,filled:n.filled,data:h,stroked:n.stroked,extruded:n.extruded,pointRadiusScale:n.point_radius_scale},Object(p.a)(n,a,v)))}var _={formData:i.a.object.isRequired,payload:i.a.object.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func};function j(t){var e=t.formData,r=t.payload,a=t.setControlValue,n=(t.onAddFilter,t.setTooltip),i=t.viewport,s=y(e,r,0,n);return o.a.createElement(l.a,{mapboxApiAccessToken:r.data.mapboxApiKey,viewport:i,layers:[s],mapStyle:e.mapbox_style,setControlValue:a})}j.propTypes=_,j.defaultProps={onAddFilter:function(){},setTooltip:function(){}},e.default=j},2831:function(t,e,r){"use strict";r.r(e),r.d(e,"getLayer",function(){return f});var a=r(2738),o=r(1),n=r.n(o),i=r(8),s=r(2725),l=r(2735),c=r(2743),u=r(2740);function p(){return(p=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}function d(t){return n.a.createElement("div",{className:"deckgl-tooltip"},n.a.createElement(u.a,{label:Object(i.b)("Longitude and Latitude")+": ",value:t.object.position[0]+", "+t.object.position[1]}),n.a.createElement(u.a,{label:Object(i.b)("Height")+": ",value:""+t.object.elevationValue}))}function f(t,e,r,o){var n=t,i=n.color_picker,c=e.data.features.map(function(t){return p({},t,{color:[i.r,i.g,i.b,255*i.a]})});n.js_data_mutator&&(c=Object(l.a)(n.js_data_mutator)(c));var u=Object(s.c)(n.js_agg_function,function(t){return t.weight});return new a.c(p({id:"grid-layer-"+n.slice_id,data:c,pickable:!0,cellSize:n.grid_size,minColor:[0,0,0,0],extruded:n.extruded,maxColor:[i.r,i.g,i.b,255*i.a],outline:!1,getElevationValue:u,getColorValue:u},Object(s.a)(n,o,d)))}e.default=Object(c.b)(f,function(t){return t.map(function(t){return t.position})})},2832:function(t,e,r){"use strict";r.r(e),r.d(e,"getLayer",function(){return f});var a=r(2738),o=r(1),n=r.n(o),i=r(8),s=r(2725),l=r(2735),c=r(2743),u=r(2740);function p(){return(p=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}function d(t){return n.a.createElement("div",{className:"deckgl-tooltip"},n.a.createElement(u.a,{label:Object(i.b)("Centroid (Longitude and Latitude)")+": ",value:"("+t.object.centroid[0]+", "+t.object.centroid[1]+")"}),n.a.createElement(u.a,{label:Object(i.b)("Height")+": ",value:""+t.object.elevationValue}))}function f(t,e,r,o){var n=t,i=n.color_picker,c=e.data.features.map(function(t){return p({},t,{color:[i.r,i.g,i.b,255*i.a]})});n.js_data_mutator&&(c=Object(l.a)(n.js_data_mutator)(c));var u=Object(s.c)(n.js_agg_function,function(t){return t.weight});return new a.d(p({id:"hex-layer-"+n.slice_id,data:c,pickable:!0,radius:n.grid_size,minColor:[0,0,0,0],extruded:n.extruded,maxColor:[i.r,i.g,i.b,255*i.a],outline:!1,getElevationValue:u,getColorValue:u},Object(s.a)(n,o,d)))}e.default=Object(c.b)(f,function(t){return t.map(function(t){return t.position})})},2833:function(t,e,r){"use strict";r.r(e),r.d(e,"getLayer",function(){return b});var a=r(1),o=r.n(a),n=r(0),i=r.n(n),s=r(2738),l=r(8),c=r(2739),u=r(2737),p=r(2735),d=r(2725),f=r(2740);function h(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function m(){return(m=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}function g(t){return o.a.createElement("div",{className:"deckgl-tooltip"},o.a.createElement(f.a,{label:Object(l.b)("Longitude and Latitude")+": ",value:t.object.position[0]+", "+t.object.position[1]}),o.a.createElement(f.a,{label:Object(l.b)("Weight")+": ",value:""+t.object.weight}))}function b(t,e,r,a,o,n,i){var l=t,c=l.color_picker,u=e.data.features.map(function(t){return m({},t,{color:[c.r,c.g,c.b,255*c.a]})});if(l.js_data_mutator){var f=Object(p.a)(l.js_data_mutator);u=f(u)}return null!=i&&i.forEach(function(t){u=u.filter(t)}),new s.h(m({id:"screengrid-layer-"+l.slice_id,data:u,pickable:!0,cellSizePixels:l.grid_size,minColor:[c.r,c.g,c.b,0],maxColor:[c.r,c.g,c.b,255*c.a],outline:!1,getWeight:function(t){return t.weight||0}},Object(d.a)(l,a,g)))}var v={formData:i.a.object.isRequired,payload:i.a.object.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func},y=function(t){function e(r){var a;return(a=t.call(this,r)||this).state=e.getDerivedStateFromProps(r),a.getLayers=a.getLayers.bind(h(a)),a.onValuesChange=a.onValuesChange.bind(h(a)),a.onViewportChange=a.onViewportChange.bind(h(a)),a}(function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e})(e,t),e.getDerivedStateFromProps=function(t,e){if(e&&t.payload.form_data===e.formData)return null;var r=t.payload.data.features||[],a=r.map(function(t){return t.__timestamp}),o=t.payload.form_data.time_grain_sqla||t.payload.form_data.granularity||"P1D",n=Object(u.a)(a,o);return{start:n.start,end:n.end,getStep:n.getStep,values:n.values,disabled:n.disabled,viewport:t.formData.autozoom?Object(d.b)(t.viewport,function(t){return t.map(function(t){return t.position})}(r)):t.viewport,selected:[],lastClick:0,formData:t.payload.form_data}};var r=e.prototype;return r.onValuesChange=function(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})},r.onViewportChange=function(t){this.setState({viewport:t})},r.getLayers=function(t){var e=[];return t[0]===t[1]||t[1]===this.end?e.push(function(e){return e.__timestamp>=t[0]&&e.__timestamp<=t[1]}):e.push(function(e){return e.__timestamp>=t[0]&&e.__timestamp<t[1]}),[b(this.props.formData,this.props.payload,this.props.onAddFilter,this.props.setTooltip)]},r.render=function(){var t=this.props,e=t.formData,r=t.payload,a=t.setControlValue;return o.a.createElement("div",null,o.a.createElement(c.a,{getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,onValuesChange:this.onValuesChange,disabled:this.state.disabled,viewport:this.state.viewport,onViewportChange:this.onViewportChange,mapboxApiAccessToken:r.data.mapboxApiKey,mapStyle:e.mapbox_style,setControlValue:a,aggregation:!0}))},e}(o.a.PureComponent);y.propTypes=v,y.defaultProps={onAddFilter:function(){},setTooltip:function(){}},e.default=y},2834:function(t,e,r){"use strict";r.r(e),r.d(e,"getLayer",function(){return d});var a=r(2738),o=r(1),n=r.n(o),i=r(2725),s=r(2735),l=r(2743),c=r(2740);function u(){return(u=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}function p(t){return t.object.extraProps&&n.a.createElement("div",{className:"deckgl-tooltip"},Object.keys(t.object.extraProps).map(function(e,r){return n.a.createElement(c.a,{key:"prop-"+r,label:e+": ",value:""+t.object.extraProps[e]})}))}function d(t,e,r,o){var n=t,l=n.color_picker,c=[l.r,l.g,l.b,255*l.a],d=e.data.features.map(function(t){return u({},t,{path:t.path,width:n.line_width,color:c})});n.js_data_mutator&&(d=Object(s.a)(n.js_data_mutator)(d));return new a.e(u({id:"path-layer-"+n.slice_id,data:d,rounded:!0,widthScale:1},Object(i.a)(n,o,p)))}e.default=Object(l.b)(d,function(t){var e=[];return t.forEach(function(t){e=e.concat(t.path)}),e})},2854:function(t,e,r){"use strict";r.r(e);var a=r(2738),o=r(1),n=r.n(o),i=r(8),s=r(2725),l=r(2743),c=r(2740);var u=1609.34;function p(){return(p=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}function d(t,e,r,o){var l=t,d=e.data.features.map(function(t){var e=function(t,e){return"square_m"===t?Math.sqrt(e/Math.PI):"radius_m"===t?e:"radius_km"===t?1e3*e:"radius_miles"===t?e*u:"square_km"===t?1e3*Math.sqrt(e/Math.PI):"square_miles"===t?Math.sqrt(e/Math.PI)*u:null}(l.point_unit,t.radius)||10;if(l.multiplier&&(e*=l.multiplier),t.color)return p({},t,{radius:e});var r=l.color_picker||{r:0,g:0,b:0,a:1};return p({},t,{radius:e,color:[r.r,r.g,r.b,255*r.a]})});return new a.g(p({id:"scatter-layer-"+l.slice_id,data:d,fp64:!0,radiusMinPixels:l.min_radius||null,radiusMaxPixels:l.max_radius||null,outline:!1},Object(s.a)(l,o,function(t){return function(e){return n.a.createElement("div",{className:"deckgl-tooltip"},n.a.createElement(c.a,{label:Object(i.b)("Longitude and Latitude")+": ",value:e.object.position[0]+", "+e.object.position[1]}),e.object.cat_color&&n.a.createElement(c.a,{label:Object(i.b)("Category")+": ",value:""+e.object.cat_color}),e.object.metric&&n.a.createElement(c.a,{label:t.point_radius_fixed.value.label+": ",value:""+e.object.metric}))}}(l))))}r.d(e,"getLayer",function(){return d});e.default=Object(l.a)(d,function(t){return t.map(function(t){return t.position})})},2855:function(t,e,r){"use strict";r.r(e);var a=r(1),o=r.n(a),n=r(0),i=r.n(n),s=r(2738),l=r(2739),c=r(2744),u=r(2740),p=r(23),d=r(183),f=r(272),h=r(888),m=r(2748),g=10;function b(t,e,r){var a=t.break_points,o=t.num_buckets;if(!e)return[];if(void 0===a||0===a.length){var n=o?parseInt(o,10):g,i=Object(p.extent)(e,r),s=i[0],l=i[1];if(void 0===s)return[];var c=(l-s)/n,u=0===c?0:Math.max(0,Math.ceil(Math.log10(1/c))),d=l>l.toFixed(u)?1:0;return Array(n+1+d).fill().map(function(t,e){return(s+e*c).toFixed(u)})}return a.sort(function(t,e){return parseFloat(t)-parseFloat(e)})}function v(t,e,r){var a,o,n=t.break_points,i=t.num_buckets,s=t.linear_color_scheme,l=t.opacity,c=n||i?b({break_points:n,num_buckets:i},e,r):null,u=Array.isArray(s)?new f.a({colors:s,id:"custom"}):Object(h.a)().get(s);if(null!==c){var g=c.length-1,v=1<g?u.getColors(g):[u.colors[u.colors.length-1]],y=v[0],_=v[v.length-1];v.unshift(y),v.push(_);var j=c.map(function(t){return parseFloat(t)});a=Object(d.i)().domain(j).range(v),o=function(t){return t>c[g]||t<c[0]}}else a=u.createLinearScale(Object(p.extent)(e,r)),o=function(){return!1};return function(t){var e=r(t),n=Object(m.hexToRGB)(a(e));return n[3]=o(e)?0:l/100*255,n}}var y=r(2725),_=r(2737),j=r(2735);function C(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function w(){return(w=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}r.d(e,"getLayer",function(){return O});function O(t,e,r,a,n,i,l){var c=t,p=c.fill_color_picker,d=c.stroke_color_picker,f=[].concat(e.data.features);if(null!=l&&l.forEach(function(t){f=f.filter(t)}),c.js_data_mutator){var h=Object(j.a)(c.js_data_mutator);f=h(f)}var m=c.metric?c.metric.label||c.metric:null,g=null===c.metric?function(){return[p.r,p.g,p.b,255*p.a]}:v(c,f,function(t){return t[m]}),b=function(t){var e=g(t);return 0<n.length&&-1===n.indexOf(t[c.line_column])&&(e[3]/=2),e},_=c.line_column&&c.metric&&0<=["geohash","zipcode"].indexOf(c.line_type)?function(t){return function(e){var r=t.metric.label||t.metric;return o.a.createElement("div",{className:"deckgl-tooltip"},o.a.createElement(u.a,{label:t.line_column+": ",value:""+e.object[t.line_column]}),t.metric&&o.a.createElement(u.a,{label:r+": ",value:""+e.object[r]}))}}(c):void 0;return new s.f(w({id:"path-layer-"+c.slice_id,data:f,pickable:!0,filled:c.filled,stroked:c.stroked,getPolygon:function(t){return t.polygon},getFillColor:b,getLineColor:[d.r,d.g,d.b,255*d.a],getLineWidth:c.line_width,extruded:c.extruded,getElevation:function(t){return function(t,e){return 0===e(t)[3]?0:t.elevation}(t,b)},elevationScale:c.multiplier,fp64:!0},Object(y.a)(c,a,_,i)))}var k={formData:i.a.object.isRequired,payload:i.a.object.isRequired,setControlValue:i.a.func.isRequired,viewport:i.a.object.isRequired,onAddFilter:i.a.func,setTooltip:i.a.func},S=function(t){function e(r){var a;return(a=t.call(this,r)||this).state=e.getDerivedStateFromProps(r),a.getLayers=a.getLayers.bind(C(a)),a.onSelect=a.onSelect.bind(C(a)),a.onValuesChange=a.onValuesChange.bind(C(a)),a.onViewportChange=a.onViewportChange.bind(C(a)),a}(function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e})(e,t),e.getDerivedStateFromProps=function(t,e){if(e&&t.payload.form_data===e.formData)return null;var r=t.payload.data.features||[],a=r.map(function(t){return t.__timestamp}),o=t.payload.form_data.time_grain_sqla||t.payload.form_data.granularity||"P1D",n=Object(_.a)(a,o);return{start:n.start,end:n.end,getStep:n.getStep,values:n.values,disabled:n.disabled,viewport:t.formData.autozoom?Object(y.b)(t.viewport,function(t){return t.map(function(t){return t.polygon}).flat()}(r)):t.viewport,selected:[],lastClick:0,formData:t.payload.form_data}};var r=e.prototype;return r.onSelect=function(t){var e=this.props,r=e.formData,a=e.onAddFilter,o=new Date,n=o-this.state.lastClick<=250,i=[].concat(this.state.selected);if(n)i.splice(0,i.length,t);else if(r.toggle_polygons){var s=i.indexOf(t);-1===s?i.push(t):i.splice(s,1)}else i.splice(0,1,t);this.setState({selected:i,lastClick:o}),r.table_filter&&a(r.line_column,i,!1,!0)},r.onValuesChange=function(t){this.setState({values:Array.isArray(t)?t:[t,t+this.state.getStep(t)]})},r.onViewportChange=function(t){this.setState({viewport:t})},r.getLayers=function(t){if(void 0===this.props.payload.data.features)return[];var e=[];return t[0]===t[1]||t[1]===this.end?e.push(function(e){return e.__timestamp>=t[0]&&e.__timestamp<=t[1]}):e.push(function(e){return e.__timestamp>=t[0]&&e.__timestamp<t[1]}),[O(this.props.formData,this.props.payload,this.props.onAddFilter,this.props.setTooltip,this.state.selected,this.onSelect,e)]},r.render=function(){var t=this.props,e=t.payload,r=t.formData,a=t.setControlValue,n=this.state,i=n.start,s=n.end,u=n.getStep,p=n.values,d=n.disabled,f=n.viewport,h=r,m=h.metric?h.metric.label||h.metric:null,g=function(t,e,r){var a=b(t,e,r),o=v(t,e,r),n={};return a.slice(1).forEach(function(e,r){var i,s=a[r]+" - "+a[r+1],l=.5*(parseFloat(a[r])+parseFloat(a[r+1])),c=t.metric?t.metric.label||t.metric:null;n[s]={color:o((i={},i[c||t.metric]=l,i)),enabled:!0}}),n}(r,e.data.features,function(t){return t[m]});return o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(l.a,{getLayers:this.getLayers,start:i,end:s,getStep:u,values:p,onValuesChange:this.onValuesChange,disabled:d,viewport:f,onViewportChange:this.onViewportChange,mapboxApiAccessToken:e.data.mapboxApiKey,mapStyle:r.mapbox_style,setControlValue:a,aggregation:!0},null!==r.metric&&o.a.createElement(c.a,{categories:g,position:r.legend_position,format:r.legend_format})))},e}(o.a.Component);S.propTypes=k,S.defaultProps={onAddFilter:function(){},setTooltip:function(){}};e.default=S},3097:function(t,e,r){"use strict";r.r(e);var a=r(1),o=r.n(a),n=r(1335),i=r.n(n),s=r(0),l=r.n(s),c=r(178),u=r(2736),p=r(270),d=r.n(p);var f=8e3;function h(t,e,r,a){if(void 0===r&&(r=!0),void 0===a&&(a={}),!t.datasource)return null;var o=new d.a("/"),n=function(t,e){void 0===e&&(e="base");var r="/superset/explore/";return 0<=["json","csv","query","results","samples"].indexOf(e)&&(r="/superset/explore_json/"),r}(0,e),i=o.search(!0);Object.keys(a).forEach(function(t){i[t]=a[t]}),i.form_data=function(t){var e=new Set;return JSON.stringify(t,function(t,r){if("object"==typeof r&&null!==r){if(e.has(r))try{return JSON.parse(JSON.stringify(r))}catch(t){return}e.add(r)}return r})}(t),"standalone"===e&&(i.standalone="true");var s=o.directory(n).search(i).toString();return!r&&s.length>f?h({datasource:t.datasource,viz_type:t.viz_type},e,!1,{URL_IS_TOO_LONG_TO_SHARE:null}):s}var m=r(2831),g=r(2833),b=r(2834),v=r(2832),y=r(2854),_=r(2830),j=r(2806),C=r(2855),w={deck_grid:m.getLayer,deck_screengrid:g.getLayer,deck_path:b.getLayer,deck_hex:v.getLayer,deck_scatter:y.getLayer,deck_geojson:_.getLayer,deck_arc:j.getLayer,deck_polygon:C.getLayer};function O(){return(O=Object.assign||function(t){for(var e,r=1;r<arguments.length;r++)for(var a in e=arguments[r])Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t}).apply(this,arguments)}var k={formData:l.a.object.isRequired,payload:l.a.object.isRequired,setControlValue:l.a.func.isRequired,viewport:l.a.object.isRequired,onAddFilter:l.a.func,setTooltip:l.a.func,onSelect:l.a.func},S=function(t){function e(e){var r;return(r=t.call(this,e)||this).state={subSlicesLayers:{}},r.onViewportChange=r.onViewportChange.bind(function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r)),r}!function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}(e,t);var r=e.prototype;return r.componentDidMount=function(){var t=this.props,e=t.formData,r=t.payload;this.loadLayers(e,r)},r.UNSAFE_componentWillReceiveProps=function(t){var e=t.formData,r=t.payload;!i.a.isEqual(this.props.formData.deck_slices,t.formData.deck_slices)&&this.loadLayers(e,r)},r.onViewportChange=function(t){this.setState({viewport:t})},r.loadLayers=function(t,e,r){var a=this;this.setState({subSlicesLayers:{},viewport:r}),e.data.slices.forEach(function(e){var r=[].concat(e.form_data.filters||[],t.filters||[],t.extra_filters||[]),o=O({},e,{form_data:O({},e.form_data,{filters:r})});c.a.get({endpoint:h(o.form_data,"json")}).then(function(t){var e,r=t.json,n=w[o.form_data.viz_type](o.form_data,r,a.props.onAddFilter,a.props.setTooltip,[],a.props.onSelect);a.setState({subSlicesLayers:O({},a.state.subSlicesLayers,(e={},e[o.slice_id]=n,e))})}).catch(function(){})})},r.render=function(){var t=this.props,e=t.payload,r=t.formData,a=t.setControlValue,n=this.state.subSlicesLayers,i=Object.values(n);return o.a.createElement(u.a,{mapboxApiAccessToken:e.data.mapboxApiKey,viewport:this.state.viewport||this.props.viewport,onViewportChange:this.onViewportChange,layers:i,mapStyle:r.mapbox_style,setControlValue:a})},e}(o.a.PureComponent);S.propTypes=k,S.defaultProps={onAddFilter:function(){},setTooltip:function(){},onSelect:function(){}};e.default=S}}]);
