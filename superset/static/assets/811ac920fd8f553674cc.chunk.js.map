{"version":3,"file":"811ac920fd8f553674cc.chunk.js","mappings":"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","sources":["webpack://superset/../../../src/utils/color-utils.ts","webpack://superset/./node_modules/@luma.gl/shadertools/dist/esm/modules/picking/picking.js","webpack://superset/../../../../src/shaderlib/picking/picking.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/components/Tooltip.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/DeckGLContainer.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/TooltipRow.tsx","webpack://superset/../../../src/screen-grid-layer/screen-grid-layer-vertex.glsl.ts","webpack://superset/../../../src/screen-grid-layer/screen-grid-cell-layer.ts","webpack://superset/../../../src/screen-grid-layer/screen-grid-layer-fragment.glsl.ts","webpack://superset/../../../src/screen-grid-layer/screen-grid-layer.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/Screengrid/Screengrid.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/layers/common.tsx","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/colors.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/computeBoundsFromPoints.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/fitViewport.ts","webpack://superset/./plugins/legacy-preset-chart-deckgl/src/utils/sandbox.ts"],"sourcesContent":["// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport const defaultColorRange: [number, number, number][] = [\n  [255, 255, 178],\n  [254, 217, 118],\n  [254, 178, 76],\n  [253, 141, 60],\n  [240, 59, 32],\n  [189, 0, 38]\n];\n\n// Converts a colorRange array to a flat array with 4 components per color\nexport function colorRangeToFlatArray(colorRange, normalize = false, ArrayType = Float32Array) {\n  let flatArray;\n\n  if (Number.isFinite(colorRange[0])) {\n    // its already a flat array.\n    flatArray = new ArrayType(colorRange);\n  } else {\n    // flatten it\n    flatArray = new ArrayType(colorRange.length * 4);\n    let index = 0;\n\n    for (let i = 0; i < colorRange.length; i++) {\n      const color = colorRange[i];\n      flatArray[index++] = color[0];\n      flatArray[index++] = color[1];\n      flatArray[index++] = color[2];\n      flatArray[index++] = Number.isFinite(color[3]) ? color[3] : 255;\n    }\n  }\n\n  if (normalize) {\n    for (let i = 0; i < flatArray.length; i++) {\n      flatArray[i] /= 255;\n    }\n  }\n  return flatArray;\n}\n","const DEFAULT_HIGHLIGHT_COLOR = new Uint8Array([0, 255, 255, 255]);\nconst DEFAULT_MODULE_OPTIONS = {\n  pickingSelectedColor: null,\n  pickingHighlightColor: DEFAULT_HIGHLIGHT_COLOR,\n  pickingActive: false,\n  pickingAttribute: false\n};\n\nfunction getUniforms() {\n  let opts = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : DEFAULT_MODULE_OPTIONS;\n  const uniforms = {};\n\n  if (opts.pickingSelectedColor !== undefined) {\n    if (!opts.pickingSelectedColor) {\n      uniforms.picking_uSelectedColorValid = 0;\n    } else {\n      const selectedColor = opts.pickingSelectedColor.slice(0, 3);\n      uniforms.picking_uSelectedColorValid = 1;\n      uniforms.picking_uSelectedColor = selectedColor;\n    }\n  }\n\n  if (opts.pickingHighlightColor) {\n    const color = Array.from(opts.pickingHighlightColor, x => x / 255);\n\n    if (!Number.isFinite(color[3])) {\n      color[3] = 1;\n    }\n\n    uniforms.picking_uHighlightColor = color;\n  }\n\n  if (opts.pickingActive !== undefined) {\n    uniforms.picking_uActive = Boolean(opts.pickingActive);\n    uniforms.picking_uAttribute = Boolean(opts.pickingAttribute);\n  }\n\n  return uniforms;\n}\n\nconst vs = \"uniform bool picking_uActive;\\nuniform bool picking_uAttribute;\\nuniform vec3 picking_uSelectedColor;\\nuniform bool picking_uSelectedColorValid;\\n\\nout vec4 picking_vRGBcolor_Avalid;\\n\\nconst float COLOR_SCALE = 1. / 255.;\\n\\nbool picking_isColorValid(vec3 color) {\\n  return dot(color, vec3(1.0)) > 0.001;\\n}\\n\\nbool isVertexPicked(vec3 vertexColor) {\\n  return\\n    picking_uSelectedColorValid &&\\n    !picking_isColorValid(abs(vertexColor - picking_uSelectedColor));\\n}\\n\\nvoid picking_setPickingColor(vec3 pickingColor) {\\n  if (picking_uActive) {\\n    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));\\n\\n    if (!picking_uAttribute) {\\n      picking_vRGBcolor_Avalid.rgb = pickingColor * COLOR_SCALE;\\n    }\\n  } else {\\n    picking_vRGBcolor_Avalid.a = float(isVertexPicked(pickingColor));\\n  }\\n}\\n\\nvoid picking_setPickingAttribute(float value) {\\n  if (picking_uAttribute) {\\n    picking_vRGBcolor_Avalid.r = value;\\n  }\\n}\\nvoid picking_setPickingAttribute(vec2 value) {\\n  if (picking_uAttribute) {\\n    picking_vRGBcolor_Avalid.rg = value;\\n  }\\n}\\nvoid picking_setPickingAttribute(vec3 value) {\\n  if (picking_uAttribute) {\\n    picking_vRGBcolor_Avalid.rgb = value;\\n  }\\n}\\n\";\nconst fs = \"uniform bool picking_uActive;\\nuniform vec3 picking_uSelectedColor;\\nuniform vec4 picking_uHighlightColor;\\n\\nin vec4 picking_vRGBcolor_Avalid;\\nvec4 picking_filterHighlightColor(vec4 color) {\\n  if (picking_uActive) {\\n    return color;\\n  }\\n  bool selected = bool(picking_vRGBcolor_Avalid.a);\\n\\n  if (selected) {\\n    float highLightAlpha = picking_uHighlightColor.a;\\n    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);\\n    float highLightRatio = highLightAlpha / blendedAlpha;\\n\\n    vec3 blendedRGB = mix(color.rgb, picking_uHighlightColor.rgb, highLightRatio);\\n    return vec4(blendedRGB, blendedAlpha);\\n  } else {\\n    return color;\\n  }\\n}\\nvec4 picking_filterPickingColor(vec4 color) {\\n  if (picking_uActive) {\\n    if (picking_vRGBcolor_Avalid.a == 0.0) {\\n      discard;\\n    }\\n    return picking_vRGBcolor_Avalid;\\n  }\\n  return color;\\n}\\nvec4 picking_filterColor(vec4 color) {\\n  vec4 highightColor = picking_filterHighlightColor(color);\\n  return picking_filterPickingColor(highightColor);\\n}\\n\\n\";\nexport const picking = {\n  name: 'picking',\n  vs,\n  fs,\n  getUniforms\n};\n//# sourceMappingURL=picking.js.map","import {picking} from '@luma.gl/core';\nimport type {ShaderModule} from '../../types/types';\n\ntype PickingModuleSettings = {\n  /** Set to a picking color to visually highlight that item */\n  pickingSelectedColor?: [number, number, number] | null;\n  /** Color of the highlight */\n  pickingHighlightColor?: [number, number, number, number];\n  /** Set to true when rendering to off-screen \"picking\" buffer */\n  pickingActive?: boolean;\n  /** Set to true when picking an attribute value instead of object index */\n  pickingAttribute?: boolean;\n};\n\nexport default {\n  inject: {\n    'vs:DECKGL_FILTER_GL_POSITION': `\n    // for picking depth values\n    picking_setPickingAttribute(position.z / position.w);\n  `,\n    'vs:DECKGL_FILTER_COLOR': `\n  picking_setPickingColor(geometry.pickingColor);\n  `,\n    // TODO - this should be declared in the luma module\n    'fs:#decl': `\nuniform bool picking_uAttribute;\n  `,\n    'fs:DECKGL_FILTER_COLOR': {\n      order: 99,\n      injection: `\n  // use highlight color if this fragment belongs to the selected object.\n  color = picking_filterHighlightColor(color);\n\n  // use picking color if rendering to picking FBO.\n  color = picking_filterPickingColor(color);\n    `\n    }\n  },\n  ...picking\n} as ShaderModule<PickingModuleSettings>;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { styled, safeHtmlSpan } from '@superset-ui/core';\nimport React, { ReactNode } from 'react';\n\nexport type TooltipProps = {\n  tooltip:\n    | {\n        x: number;\n        y: number;\n        content: ReactNode;\n      }\n    | null\n    | undefined;\n};\n\nconst StyledDiv = styled.div<{ top: number; left: number }>`\n  ${({ theme, top, left }) => `\n    position: absolute;\n    top: ${top}px;\n    left: ${left}px;\n    padding: ${theme.gridUnit * 2}px;\n    margin: ${theme.gridUnit * 2}px;\n    background: ${theme.colors.grayscale.dark2};\n    color: ${theme.colors.grayscale.light5};\n    maxWidth: 300px;\n    fontSize: ${theme.typography.sizes.s}px;\n    zIndex: 9;\n    pointerEvents: none;\n  `}\n`;\n\nexport default function Tooltip(props: TooltipProps) {\n  const { tooltip } = props;\n  if (typeof tooltip === 'undefined' || tooltip === null) {\n    return null;\n  }\n\n  const { x, y, content } = tooltip;\n  const safeContent =\n    typeof content === 'string' ? safeHtmlSpan(content) : content;\n\n  return (\n    <StyledDiv top={y} left={x}>\n      {safeContent}\n    </StyledDiv>\n  );\n}\n","/* eslint-disable react/jsx-sort-default-props */\n/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/jsx-handler-names */\n/* eslint-disable react/forbid-prop-types */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  forwardRef,\n  memo,\n  ReactNode,\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { isEqual } from 'lodash';\nimport { StaticMap } from 'react-map-gl';\nimport DeckGL, { Layer } from 'deck.gl/typed';\nimport { JsonObject, JsonValue, styled, usePrevious } from '@superset-ui/core';\nimport Tooltip, { TooltipProps } from './components/Tooltip';\nimport 'mapbox-gl/dist/mapbox-gl.css';\nimport { Viewport } from './utils/fitViewport';\n\nconst TICK = 250; // milliseconds\n\nexport type DeckGLContainerProps = {\n  viewport: Viewport;\n  setControlValue?: (control: string, value: JsonValue) => void;\n  mapStyle?: string;\n  mapboxApiAccessToken: string;\n  children?: ReactNode;\n  width: number;\n  height: number;\n  layers: (Layer | (() => Layer))[];\n  onViewportChange?: (viewport: Viewport) => void;\n};\n\nexport const DeckGLContainer = memo(\n  forwardRef((props: DeckGLContainerProps, ref) => {\n    const [tooltip, setTooltip] = useState<TooltipProps['tooltip']>(null);\n    const [lastUpdate, setLastUpdate] = useState<number | null>(null);\n    const [viewState, setViewState] = useState(props.viewport);\n    const prevViewport = usePrevious(props.viewport);\n\n    useImperativeHandle(ref, () => ({ setTooltip }), []);\n\n    const tick = useCallback(() => {\n      // Rate limiting updating viewport controls as it triggers lots of renders\n      if (lastUpdate && Date.now() - lastUpdate > TICK) {\n        const setCV = props.setControlValue;\n        if (setCV) {\n          setCV('viewport', viewState);\n        }\n        setLastUpdate(null);\n      }\n    }, [lastUpdate, props.setControlValue, viewState]);\n\n    useEffect(() => {\n      const timer = setInterval(tick, TICK);\n      return clearInterval(timer);\n    }, [tick]);\n\n    useEffect(() => {\n      if (!isEqual(props.viewport, prevViewport)) {\n        setViewState(props.viewport);\n      }\n    }, [prevViewport, props.viewport]);\n\n    const onViewStateChange = useCallback(\n      ({ viewState }: { viewState: JsonObject }) => {\n        setViewState(viewState as Viewport);\n        setLastUpdate(Date.now());\n      },\n      [],\n    );\n\n    const layers = useCallback(() => {\n      // Support for layer factory\n      if (props.layers.some(l => typeof l === 'function')) {\n        return props.layers.map(l =>\n          typeof l === 'function' ? l() : l,\n        ) as Layer[];\n      }\n\n      return props.layers as Layer[];\n    }, [props.layers]);\n\n    const { children = null, height, width } = props;\n\n    return (\n      <>\n        <div style={{ position: 'relative', width, height }}>\n          <DeckGL\n            controller\n            width={width}\n            height={height}\n            layers={layers()}\n            viewState={viewState}\n            glOptions={{ preserveDrawingBuffer: true }}\n            onViewStateChange={onViewStateChange}\n          >\n            <StaticMap\n              preserveDrawingBuffer\n              mapStyle={props.mapStyle || 'light'}\n              mapboxApiAccessToken={props.mapboxApiAccessToken}\n            />\n          </DeckGL>\n          {children}\n        </div>\n        <Tooltip tooltip={tooltip} />\n      </>\n    );\n  }),\n);\n\nexport const DeckGLContainerStyledWrapper = styled(DeckGLContainer)`\n  .deckgl-tooltip > div {\n    overflow: hidden;\n    text-overflow: ellipsis;\n  }\n`;\n\nexport type DeckGLContainerHandle = typeof DeckGLContainer & {\n  setTooltip: (tooltip: ReactNode) => void;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\n\ntype TooltipRowProps = {\n  label: string;\n  value: string;\n};\n\nconst TooltipRow = ({ label, value }: TooltipRowProps) => (\n  <div>\n    {label}\n    <strong>{value}</strong>\n  </div>\n);\n\nexport default TooltipRow;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nexport default `\\\n#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\nuniform sampler2D maxTexture;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float maxWeight = texture2D(maxTexture, vec2(0.5)).r;\n\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n\n  // Set color to be rendered to picking fbo (also used to check for selection highlight).\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n`;\n","// Copyright (c) 2015 - 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport GL from '@luma.gl/constants';\nimport {Model, Geometry, FEATURES, hasFeatures, Texture2D, DefaultProps} from '@luma.gl/core';\nimport {Layer, LayerProps, log, picking, UpdateParameters} from '@deck.gl/core';\nimport {defaultColorRange, colorRangeToFlatArray} from '../utils/color-utils';\nimport vs from './screen-grid-layer-vertex.glsl';\nimport fs from './screen-grid-layer-fragment.glsl';\nimport type {_ScreenGridLayerProps} from './screen-grid-layer';\n\nconst DEFAULT_MINCOLOR = [0, 0, 0, 0];\nconst DEFAULT_MAXCOLOR = [0, 255, 0, 255];\nconst COLOR_PROPS = ['minColor', 'maxColor', 'colorRange', 'colorDomain'];\n\nconst defaultProps: DefaultProps<ScreenGridCellLayerProps> = {\n  cellSizePixels: {value: 100, min: 1},\n  cellMarginPixels: {value: 2, min: 0, max: 5},\n\n  colorDomain: null,\n  colorRange: defaultColorRange\n};\n\n/** All properties supported by ScreenGridCellLayer. */\nexport type ScreenGridCellLayerProps<DataT = any> = _ScreenGridCellLayerProps<DataT> & LayerProps;\n\n/** Proprties added by ScreenGridCellLayer. */\nexport type _ScreenGridCellLayerProps<DataT> = _ScreenGridLayerProps<DataT> & {\n  maxTexture: Texture2D;\n};\n\nexport default class ScreenGridCellLayer<DataT = any, ExtraPropsT extends {} = {}> extends Layer<\n  ExtraPropsT & Required<_ScreenGridCellLayerProps<DataT>>\n> {\n  static layerName = 'ScreenGridCellLayer';\n  static defaultProps = defaultProps;\n\n  static isSupported(gl) {\n    return hasFeatures(gl, [FEATURES.TEXTURE_FLOAT]);\n  }\n\n  state!: Layer['state'] & {\n    model: Model;\n  };\n  getShaders() {\n    return {vs, fs, modules: [picking]};\n  }\n\n  initializeState() {\n    const {gl} = this.context;\n    const attributeManager = this.getAttributeManager()!;\n    attributeManager.addInstanced({\n      // eslint-disable-next-line @typescript-eslint/unbound-method\n      instancePositions: {size: 3, update: this.calculateInstancePositions},\n      instanceCounts: {size: 4, noAlloc: true}\n    });\n    this.setState({\n      model: this._getModel(gl)\n    });\n  }\n\n  shouldUpdateState({changeFlags}) {\n    // 'instanceCounts' buffer contetns change on viewport change.\n    return changeFlags.somethingChanged;\n  }\n\n  updateState(params: UpdateParameters<this>) {\n    super.updateState(params);\n\n    const {oldProps, props, changeFlags} = params;\n\n    const attributeManager = this.getAttributeManager()!;\n    if (props.numInstances !== oldProps.numInstances) {\n      attributeManager.invalidateAll();\n    } else if (oldProps.cellSizePixels !== props.cellSizePixels) {\n      attributeManager.invalidate('instancePositions');\n    }\n\n    this._updateUniforms(oldProps, props, changeFlags);\n  }\n\n  draw({uniforms}) {\n    const {parameters, maxTexture} = this.props;\n    const minColor = this.props.minColor || DEFAULT_MINCOLOR;\n    const maxColor = this.props.maxColor || DEFAULT_MAXCOLOR;\n\n    // If colorDomain not specified we use default domain [1, maxCount]\n    // maxCount value will be sampled form maxTexture in vertex shader.\n    const colorDomain = this.props.colorDomain || [1, 0];\n    const {model} = this.state;\n    model\n      .setUniforms(uniforms)\n      .setUniforms({\n        minColor,\n        maxColor,\n        maxTexture,\n        colorDomain\n      })\n      .draw({\n        parameters: {\n          depthTest: false,\n          depthMask: false,\n          ...parameters\n        }\n      });\n  }\n\n  calculateInstancePositions(attribute, {numInstances}) {\n    const {width, height} = this.context.viewport;\n    const {cellSizePixels} = this.props;\n    const numCol = Math.ceil(width / cellSizePixels);\n\n    const {value, size} = attribute;\n\n    for (let i = 0; i < numInstances; i++) {\n      const x = i % numCol;\n      const y = Math.floor(i / numCol);\n      value[i * size + 0] = ((x * cellSizePixels) / width) * 2 - 1;\n      value[i * size + 1] = 1 - ((y * cellSizePixels) / height) * 2;\n      value[i * size + 2] = 0;\n    }\n  }\n\n  // Private Methods\n\n  _getModel(gl: WebGLRenderingContext): Model {\n    return new Model(gl, {\n      ...this.getShaders(),\n      id: this.props.id,\n      geometry: new Geometry({\n        drawMode: GL.TRIANGLE_FAN,\n        attributes: {\n          positions: new Float32Array([0, 0, 0, 1, 0, 0, 1, 1, 0, 0, 1, 0])\n        }\n      }),\n      isInstanced: true\n    });\n  }\n\n  _shouldUseMinMax(): boolean {\n    const {minColor, maxColor, colorDomain, colorRange} = this.props;\n    if (minColor || maxColor) {\n      log.deprecated('ScreenGridLayer props: minColor and maxColor', 'colorRange, colorDomain')();\n      return true;\n    }\n    // minColor and maxColor not supplied, check if colorRange or colorDomain supplied.\n    // NOTE: colorDomain and colorRange are experimental features, use them only when supplied.\n    if (colorDomain || colorRange) {\n      return false;\n    }\n    // None specified, use default minColor and maxColor\n    return true;\n  }\n\n  _updateUniforms(oldProps, props, changeFlags): void {\n    const {model} = this.state;\n    if (COLOR_PROPS.some(key => oldProps[key] !== props[key])) {\n      model.setUniforms({shouldUseMinMax: this._shouldUseMinMax()});\n    }\n\n    if (oldProps.colorRange !== props.colorRange) {\n      model.setUniforms({colorRange: colorRangeToFlatArray(props.colorRange)});\n    }\n\n    if (\n      oldProps.cellMarginPixels !== props.cellMarginPixels ||\n      oldProps.cellSizePixels !== props.cellSizePixels ||\n      changeFlags.viewportChanged\n    ) {\n      const {width, height} = this.context.viewport;\n      const {cellSizePixels, cellMarginPixels} = this.props;\n      const margin = cellSizePixels > cellMarginPixels ? cellMarginPixels : 0;\n\n      const cellScale = new Float32Array([\n        ((cellSizePixels - margin) / width) * 2,\n        (-(cellSizePixels - margin) / height) * 2,\n        1\n      ]);\n      model.setUniforms({cellScale});\n    }\n  }\n}\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\n/* fragment shader for the grid-layer */\nexport default `\\\n#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n`;\n","// Copyright (c) 2015 - 2017 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {\n  Accessor,\n  Color,\n  GetPickingInfoParams,\n  Layer,\n  LayerContext,\n  LayersList,\n  log,\n  PickingInfo,\n  Position,\n  UpdateParameters,\n  DefaultProps\n} from '@deck.gl/core';\nimport GL from '@luma.gl/constants';\nimport type {Texture2D} from '@luma.gl/core';\nimport GPUGridAggregator from '../utils/gpu-grid-aggregation/gpu-grid-aggregator';\nimport {AGGREGATION_OPERATION, getValueFunc} from '../utils/aggregation-operation-utils';\nimport ScreenGridCellLayer from './screen-grid-cell-layer';\nimport GridAggregationLayer, {GridAggregationLayerProps} from '../grid-aggregation-layer';\nimport {getFloatTexture} from '../utils/resource-utils.js';\n\nconst defaultProps: DefaultProps<ScreenGridLayerProps> = {\n  ...ScreenGridCellLayer.defaultProps,\n  getPosition: {type: 'accessor', value: d => d.position},\n  getWeight: {type: 'accessor', value: 1},\n\n  gpuAggregation: true,\n  aggregation: 'SUM'\n};\n\nconst POSITION_ATTRIBUTE_NAME = 'positions';\nconst DIMENSIONS = {\n  data: {\n    props: ['cellSizePixels']\n  },\n  weights: {\n    props: ['aggregation'],\n    accessors: ['getWeight']\n  }\n};\n\n/** All properties supported by ScreenGridLayer. */\nexport type ScreenGridLayerProps<DataT = any> = _ScreenGridLayerProps<DataT> &\n  GridAggregationLayerProps<DataT>;\n\n/** Properties added by ScreenGridLayer. */\nexport type _ScreenGridLayerProps<DataT> = {\n  /**\n   * Unit width/height of the bins.\n   * @default 100\n   */\n  cellSizePixels?: number;\n\n  /**\n   * Cell margin size in pixels.\n   * @default 2\n   */\n  cellMarginPixels?: number;\n\n  /**\n   * Expressed as an rgba array, minimal color that could be rendered by a tile.\n   * @default [0, 0, 0, 255]\n   * @deprecated Deprecated in version 5.2.0, use `colorRange` and `colorDomain` instead.\n   */\n  minColor?: Color | null;\n\n  /**\n   * Expressed as an rgba array, maximal color that could be rendered by a tile.\n   * @default [0, 255, 0, 255]\n   * @deprecated Deprecated in version 5.2.0, use `colorRange` and `colorDomain` instead.\n   */\n  maxColor?: Color | null;\n\n  /**\n   * Color scale input domain. The color scale maps continues numeric domain into discrete color range.\n   * @default [1, max(weight)]\n   */\n  colorDomain?: [number, number] | null;\n\n  /**\n   * Specified as an array of colors [color1, color2, ...].\n   *\n   * @default `6-class YlOrRd` - [colorbrewer](http://colorbrewer2.org/#type=sequential&scheme=YlOrRd&n=6)\n   */\n  colorRange?: Color[];\n\n  /**\n   * Method called to retrieve the position of each object.\n   *\n   * @default d => d.position\n   */\n  getPosition?: Accessor<DataT, Position>;\n\n  /**\n   * The weight of each object.\n   *\n   * @default 1\n   */\n  getWeight?: Accessor<DataT, number>;\n\n  /**\n   * Perform aggregation is performed on GPU.\n   *\n   * NOTE: GPU Aggregation requires WebGL2 support by the browser.\n   * When `gpuAggregation` is set to true and browser doesn't support WebGL2, aggregation falls back to CPU.\n   *\n   * @default true\n   */\n  gpuAggregation?: boolean;\n\n  /**\n   * Defines the type of aggregation operation\n   *\n   * V valid values are 'SUM', 'MEAN', 'MIN' and 'MAX'.\n   *\n   * @default 'SUM'\n   */\n  aggregation?: 'SUM' | 'MEAN' | 'MIN' | 'MAX';\n};\n\n/** Aggregates data into histogram bins and renders them as a grid. */\nexport default class ScreenGridLayer<\n  DataT = any,\n  ExtraProps extends {} = {}\n> extends GridAggregationLayer<DataT, ExtraProps & Required<_ScreenGridLayerProps<DataT>>> {\n  static layerName = 'ScreenGridLayer';\n  static defaultProps = defaultProps;\n\n  state!: GridAggregationLayer<DataT>['state'] & {\n    supported: boolean;\n    gpuGridAggregator?: any;\n    gpuAggregation?: any;\n    weights?: any;\n    maxTexture?: Texture2D;\n  };\n\n  initializeState() {\n    const {gl} = this.context;\n    if (!ScreenGridCellLayer.isSupported(gl)) {\n      // max aggregated value is sampled from a float texture\n      this.setState({supported: false});\n      log.error(`ScreenGridLayer: ${this.id} is not supported on this browser`)();\n      return;\n    }\n    super.initializeAggregationLayer({\n      dimensions: DIMENSIONS,\n      // @ts-expect-error\n      getCellSize: props => props.cellSizePixels // TODO\n    });\n    const weights = {\n      count: {\n        size: 1,\n        operation: AGGREGATION_OPERATION.SUM,\n        needMax: true,\n        maxTexture: getFloatTexture(gl, {id: `${this.id}-max-texture`})\n      }\n    };\n    this.setState({\n      supported: true,\n      projectPoints: true, // aggregation in screen space\n      weights,\n      subLayerData: {attributes: {}},\n      maxTexture: weights.count.maxTexture,\n      positionAttributeName: 'positions',\n      posOffset: [0, 0],\n      translation: [1, -1]\n    });\n    const attributeManager = this.getAttributeManager()!;\n    attributeManager.add({\n      [POSITION_ATTRIBUTE_NAME]: {\n        size: 3,\n        accessor: 'getPosition',\n        type: GL.DOUBLE,\n        fp64: this.use64bitPositions()\n      },\n      // this attribute is used in gpu aggregation path only\n      count: {size: 3, accessor: 'getWeight'}\n    });\n  }\n\n  shouldUpdateState({changeFlags}: UpdateParameters<this>) {\n    return this.state.supported && changeFlags.somethingChanged;\n  }\n\n  updateState(opts: UpdateParameters<this>) {\n    super.updateState(opts);\n  }\n\n  renderLayers(): LayersList | Layer {\n    if (!this.state.supported) {\n      return [];\n    }\n    const {maxTexture, numRow, numCol, weights} = this.state;\n    const {updateTriggers} = this.props;\n    const {aggregationBuffer} = weights.count;\n    const CellLayerClass = this.getSubLayerClass('cells', ScreenGridCellLayer);\n\n    return new CellLayerClass(\n      this.props,\n      this.getSubLayerProps({\n        id: 'cell-layer',\n        updateTriggers\n      }),\n      {\n        data: {attributes: {instanceCounts: aggregationBuffer}},\n        maxTexture,\n        numInstances: numRow * numCol\n      }\n    );\n  }\n\n  finalizeState(context: LayerContext): void {\n    super.finalizeState(context);\n\n    const {aggregationBuffer, maxBuffer, maxTexture} = this.state;\n\n    aggregationBuffer?.delete();\n    maxBuffer?.delete();\n    maxTexture?.delete();\n  }\n\n  getPickingInfo({info}: GetPickingInfoParams): PickingInfo {\n    const {index} = info;\n    if (index >= 0) {\n      const {gpuGridAggregator, gpuAggregation, weights} = this.state;\n      // Get count aggregation results\n      const aggregationResults = gpuAggregation\n        ? gpuGridAggregator.getData('count')\n        : weights.count;\n\n      // Each instance (one cell) is aggregated into single pixel,\n      // Get current instance's aggregation details.\n      info.object = GPUGridAggregator.getAggregationData({\n        pixelIndex: index,\n        ...aggregationResults\n      });\n    }\n\n    return info;\n  }\n\n  // Aggregation Overrides\n\n  updateResults({aggregationData, maxData}) {\n    const {count} = this.state.weights;\n    count.aggregationData = aggregationData;\n    count.aggregationBuffer.setData({data: aggregationData});\n    count.maxData = maxData;\n    count.maxTexture.setImageData({data: maxData});\n  }\n\n  /* eslint-disable complexity, max-statements */\n  updateAggregationState(opts) {\n    const cellSize = opts.props.cellSizePixels;\n    const cellSizeChanged = opts.oldProps.cellSizePixels !== cellSize;\n    const {viewportChanged} = opts.changeFlags;\n    let gpuAggregation = opts.props.gpuAggregation;\n    if (this.state.gpuAggregation !== opts.props.gpuAggregation) {\n      if (gpuAggregation && !GPUGridAggregator.isSupported(this.context.gl)) {\n        log.warn('GPU Grid Aggregation not supported, falling back to CPU')();\n        gpuAggregation = false;\n      }\n    }\n    const gpuAggregationChanged = gpuAggregation !== this.state.gpuAggregation;\n    this.setState({\n      gpuAggregation\n    });\n\n    const positionsChanged = this.isAttributeChanged(POSITION_ATTRIBUTE_NAME);\n\n    const {dimensions} = this.state;\n    const {data, weights} = dimensions;\n    const aggregationDataDirty =\n      positionsChanged ||\n      gpuAggregationChanged ||\n      viewportChanged ||\n      this.isAggregationDirty(opts, {\n        compareAll: gpuAggregation, // check for all (including extentions props) when using gpu aggregation\n        dimension: data\n      });\n    const aggregationWeightsDirty = this.isAggregationDirty(opts, {dimension: weights});\n\n    this.setState({\n      aggregationDataDirty,\n      aggregationWeightsDirty\n    });\n\n    const {viewport} = this.context;\n\n    if (viewportChanged || cellSizeChanged) {\n      const {width, height} = viewport;\n      const numCol = Math.ceil(width / cellSize);\n      const numRow = Math.ceil(height / cellSize);\n      this.allocateResources(numRow, numCol);\n      this.setState({\n        // transformation from clipspace to screen(pixel) space\n        scaling: [width / 2, -height / 2, 1],\n\n        gridOffset: {xOffset: cellSize, yOffset: cellSize},\n        width,\n        height,\n        numCol,\n        numRow\n      });\n    }\n\n    if (aggregationWeightsDirty) {\n      this._updateAccessors(opts);\n    }\n    if (aggregationDataDirty || aggregationWeightsDirty) {\n      this._resetResults();\n    }\n  }\n  /* eslint-enable complexity, max-statements */\n\n  // Private\n\n  _updateAccessors(opts) {\n    const {getWeight, aggregation, data} = opts.props;\n    const {count} = this.state.weights;\n    if (count) {\n      count.getWeight = getWeight;\n      count.operation = AGGREGATION_OPERATION[aggregation];\n    }\n    this.setState({getValue: getValueFunc(aggregation, getWeight, {data})});\n  }\n\n  _resetResults() {\n    const {count} = this.state.weights;\n    if (count) {\n      count.aggregationData = null;\n    }\n  }\n}\n","/* eslint-disable react/sort-prop-types */\n/* eslint-disable react/jsx-handler-names */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint no-underscore-dangle: [\"error\", { \"allow\": [\"\", \"__timestamp\"] }] */\n\nimport React, { memo, useCallback, useEffect, useRef, useState } from 'react';\nimport { ScreenGridLayer } from 'deck.gl/typed';\nimport { JsonObject, JsonValue, QueryFormData, t } from '@superset-ui/core';\nimport { noop } from 'lodash';\nimport sandboxedEval from '../../utils/sandbox';\nimport { commonLayerProps } from '../common';\nimport TooltipRow from '../../TooltipRow';\n// eslint-disable-next-line import/extensions\nimport fitViewport, { Viewport } from '../../utils/fitViewport';\nimport {\n  DeckGLContainerHandle,\n  DeckGLContainerStyledWrapper,\n} from '../../DeckGLContainer';\nimport { TooltipProps } from '../../components/Tooltip';\n\nfunction getPoints(data: JsonObject[]) {\n  return data.map(d => d.position);\n}\n\nfunction setTooltipContent(o: JsonObject) {\n  return (\n    <div className=\"deckgl-tooltip\">\n      <TooltipRow\n        // eslint-disable-next-line prefer-template\n        label={t('Longitude and Latitude') + ': '}\n        value={`${o.coordinate[0]}, ${o.coordinate[1]}`}\n      />\n      <TooltipRow\n        // eslint-disable-next-line prefer-template\n        label={t('Weight') + ': '}\n        value={`${o.object.cellWeight}`}\n      />\n    </div>\n  );\n}\n\nexport function getLayer(\n  formData: QueryFormData,\n  payload: JsonObject,\n  onAddFilter: () => void,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n) {\n  const fd = formData;\n  const c = fd.color_picker;\n  let data = payload.data.features.map((d: JsonObject) => ({\n    ...d,\n    color: [c.r, c.g, c.b, 255 * c.a],\n  }));\n\n  if (fd.js_data_mutator) {\n    // Applying user defined data mutator if defined\n    const jsFnMutator = sandboxedEval(fd.js_data_mutator);\n    data = jsFnMutator(data);\n  }\n\n  // Passing a layer creator function instead of a layer since the\n  // layer needs to be regenerated at each render\n  return new ScreenGridLayer({\n    id: `screengrid-layer-${fd.slice_id}` as const,\n    data,\n    cellSizePixels: fd.grid_size,\n    minColor: [c.r, c.g, c.b, 0],\n    maxColor: [c.r, c.g, c.b, 255 * c.a],\n    outline: false,\n    getWeight: d => d.weight || 0,\n    ...commonLayerProps(fd, setTooltip, setTooltipContent),\n  });\n}\n\nexport type DeckGLScreenGridProps = {\n  formData: QueryFormData;\n  payload: JsonObject;\n  setControlValue: (control: string, value: JsonValue) => void;\n  viewport: Viewport;\n  width: number;\n  height: number;\n  onAddFilter: () => void;\n};\n\nconst DeckGLScreenGrid = (props: DeckGLScreenGridProps) => {\n  const containerRef = useRef<DeckGLContainerHandle>();\n\n  const getAdjustedViewport = useCallback(() => {\n    const features = props.payload.data.features || [];\n\n    const { width, height, formData } = props;\n\n    if (formData.autozoom) {\n      return fitViewport(props.viewport, {\n        width,\n        height,\n        points: getPoints(features),\n      });\n    }\n    return props.viewport;\n  }, [props]);\n\n  const [stateFormData, setStateFormData] = useState(props.payload.form_data);\n  const [viewport, setViewport] = useState(getAdjustedViewport());\n\n  useEffect(() => {\n    if (props.payload.form_data !== stateFormData) {\n      setViewport(getAdjustedViewport());\n      setStateFormData(props.payload.form_data);\n    }\n  }, [getAdjustedViewport, props.payload.form_data, stateFormData]);\n\n  const setTooltip = useCallback((tooltip: TooltipProps['tooltip']) => {\n    const { current } = containerRef;\n    if (current) {\n      current.setTooltip(tooltip);\n    }\n  }, []);\n\n  const getLayers = useCallback(() => {\n    const layer = getLayer(props.formData, props.payload, noop, setTooltip);\n\n    return [layer];\n  }, [props.formData, props.payload, setTooltip]);\n\n  const { formData, payload, setControlValue } = props;\n\n  return (\n    <div>\n      <DeckGLContainerStyledWrapper\n        ref={containerRef}\n        viewport={viewport}\n        layers={getLayers()}\n        setControlValue={setControlValue}\n        mapStyle={formData.mapbox_style}\n        mapboxApiAccessToken={payload.data.mapboxApiKey}\n        width={props.width}\n        height={props.height}\n      />\n    </div>\n  );\n};\n\nexport default memo(DeckGLScreenGrid);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactNode } from 'react';\nimport * as d3array from 'd3-array';\nimport { JsonObject, JsonValue, QueryFormData } from '@superset-ui/core';\nimport sandboxedEval from '../utils/sandbox';\nimport { TooltipProps } from '../components/Tooltip';\n\nexport function commonLayerProps(\n  formData: QueryFormData,\n  setTooltip: (tooltip: TooltipProps['tooltip']) => void,\n  setTooltipContent: (content: JsonObject) => ReactNode,\n  onSelect?: (value: JsonValue) => void,\n) {\n  const fd = formData;\n  let onHover;\n  let tooltipContentGenerator = setTooltipContent;\n  if (fd.js_tooltip) {\n    tooltipContentGenerator = sandboxedEval(fd.js_tooltip);\n  }\n  if (tooltipContentGenerator) {\n    onHover = (o: JsonObject) => {\n      if (o.picked) {\n        setTooltip({\n          content: tooltipContentGenerator(o),\n          x: o.x,\n          y: o.y,\n        });\n      } else {\n        setTooltip(null);\n      }\n      return true;\n    };\n  }\n  let onClick;\n  if (fd.js_onclick_href) {\n    onClick = (o: any) => {\n      const href = sandboxedEval(fd.js_onclick_href)(o);\n      window.open(href);\n      return true;\n    };\n  } else if (fd.table_filter && onSelect !== undefined) {\n    onClick = (o: any) => {\n      onSelect(o.object[fd.line_column]);\n      return true;\n    };\n  }\n\n  return {\n    onClick,\n    onHover,\n    pickable: Boolean(onHover),\n  };\n}\n\nconst percentiles = {\n  p1: 0.01,\n  p5: 0.05,\n  p95: 0.95,\n  p99: 0.99,\n};\n\n/* Get a stat function that operates on arrays, aligns with control=js_agg_function  */\nexport function getAggFunc(\n  type = 'sum',\n  accessor: ((object: any) => number | undefined) | null = null,\n) {\n  if (type === 'count') {\n    return (arr: number[]) => arr.length;\n  }\n  let d3func: (\n    iterable: Array<unknown>,\n    accessor?: (object: JsonObject) => number | undefined,\n  ) => number[] | number | undefined;\n  if (type in percentiles) {\n    d3func = (arr, acc: (object: JsonObject) => number | undefined) => {\n      let sortedArr;\n      if (accessor) {\n        sortedArr = arr.sort((o1: JsonObject, o2: JsonObject) =>\n          d3array.ascending(accessor(o1), accessor(o2)),\n        );\n      } else {\n        sortedArr = arr.sort(d3array.ascending);\n      }\n\n      return d3array.quantile(sortedArr, percentiles[type], acc);\n    };\n  } else {\n    d3func = d3array[type];\n  }\n  if (!accessor) {\n    return (arr: JsonObject[]) => d3func(arr);\n  }\n\n  return (arr: JsonObject[]) => d3func(arr.map(x => accessor(x)));\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { rgb } from 'd3-color';\n\n// eslint-disable-next-line import/prefer-default-export\nexport function hexToRGB(\n  hex: string | undefined,\n  alpha = 255,\n): [number, number, number, number] {\n  if (!hex) {\n    return [0, 0, 0, alpha];\n  }\n  const { r, g, b } = rgb(hex);\n\n  return [r, g, b, alpha];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { extent as d3Extent } from 'd3-array';\nimport { Point, Range } from '../types';\n\nconst LAT_LIMIT: Range = [-90, 90];\nconst LNG_LIMIT: Range = [-180, 180];\n\n/**\n * Expand a coordinate range by `padding` and within limits, if needed\n */\nfunction expandIfNeeded(\n  [curMin, curMax]: Range,\n  [minBound, maxBound]: Range,\n  padding = 0.25,\n) {\n  return curMin < curMax\n    ? [curMin, curMax]\n    : [\n        Math.max(minBound, curMin - padding),\n        Math.min(maxBound, curMax + padding),\n      ];\n}\n\nexport default function computeBoundsFromPoints(\n  points: Point[],\n): [Point, Point] {\n  const latBounds = expandIfNeeded(\n    d3Extent(points, (x: Point) => x[1]) as Range,\n    LAT_LIMIT,\n  );\n  const lngBounds = expandIfNeeded(\n    d3Extent(points, (x: Point) => x[0]) as Range,\n    LNG_LIMIT,\n  );\n  return [\n    [lngBounds[0], latBounds[0]],\n    [lngBounds[1], latBounds[1]],\n  ];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { fitBounds } from '@math.gl/web-mercator';\nimport computeBoundsFromPoints from './computeBoundsFromPoints';\nimport { Point } from '../types';\n\nexport type Viewport = {\n  longitude: number;\n  latitude: number;\n  zoom: number;\n  bearing?: number;\n  pitch?: number;\n};\n\nexport type FitViewportOptions = {\n  points: Point[];\n  width: number;\n  height: number;\n  minExtent?: number;\n  maxZoom?: number;\n  offset?: [number, number];\n  padding?: number;\n};\n\nexport default function fitViewport(\n  originalViewPort: Viewport,\n  {\n    points,\n    width,\n    height,\n    minExtent,\n    maxZoom,\n    offset,\n    padding = 20,\n  }: FitViewportOptions,\n): Viewport {\n  const { bearing, pitch } = originalViewPort;\n  const bounds = computeBoundsFromPoints(points);\n\n  try {\n    return {\n      ...fitBounds({\n        bounds,\n        width,\n        height,\n        minExtent,\n        maxZoom,\n        offset,\n        padding,\n      }),\n      bearing,\n      pitch,\n    };\n  } catch (error) {\n    // eslint-disable-next-line no-console\n    console.error('Could not fit viewport', error);\n  }\n\n  return originalViewPort;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// A safe alternative to JS's eval\nimport vm, { Context, RunningScriptOptions } from 'vm';\nimport _ from 'underscore';\nimport * as d3array from 'd3-array';\nimport * as colors from './colors';\n\n// Objects exposed here should be treated like a public API\n// if `underscore` had backwards incompatible changes in a future release, we'd\n// have to be careful about bumping the library as those changes could break user charts\nconst GLOBAL_CONTEXT = {\n  console,\n  _,\n  colors,\n  d3array,\n};\n\n// Copied/modified from https://github.com/hacksparrow/safe-eval/blob/master/index.js\nexport default function sandboxedEval(\n  code: string,\n  context?: Context,\n  opts?: RunningScriptOptions | string,\n) {\n  const sandbox = {};\n  const resultKey = `SAFE_EVAL_${Math.floor(Math.random() * 1000000)}`;\n  sandbox[resultKey] = {};\n  const codeToEval = `${resultKey}=${code}`;\n  const sandboxContext = { ...GLOBAL_CONTEXT, ...context };\n  Object.keys(sandboxContext).forEach(key => {\n    sandbox[key] = sandboxContext[key];\n  });\n  try {\n    vm.runInNewContext(codeToEval, sandbox, opts);\n\n    return sandbox[resultKey];\n  } catch (error) {\n    return () => error;\n  }\n}\n"],"names":["defaultColorRange","colorRangeToFlatArray","colorRange","normalize","ArrayType","flatArray","Float32Array","Number","isFinite","length","index","i","color","DEFAULT_MODULE_OPTIONS","pickingSelectedColor","pickingHighlightColor","Uint8Array","pickingActive","pickingAttribute","inject","order","injection","name","vs","fs","getUniforms","opts","arguments","undefined","uniforms","selectedColor","slice","picking_uSelectedColorValid","picking_uSelectedColor","Array","from","x","picking_uHighlightColor","picking_uActive","Boolean","picking_uAttribute","StyledDiv","styled","div","_ref","theme","top","left","gridUnit","colors","grayscale","dark2","light5","typography","sizes","s","Tooltip","props","tooltip","y","content","safeContent","safeHtmlSpan","___EmotionJSX","DeckGLContainer","memo","forwardRef","ref","setTooltip","useState","lastUpdate","setLastUpdate","viewState","setViewState","viewport","prevViewport","usePrevious","useImperativeHandle","tick","useCallback","Date","now","setCV","setControlValue","useEffect","timer","setInterval","clearInterval","_isEqual","onViewStateChange","layers","some","l","map","children","height","width","React","style","position","DeckGL","controller","glOptions","preserveDrawingBuffer","StaticMap","mapStyle","mapboxApiAccessToken","DeckGLContainerStyledWrapper","label","value","DEFAULT_MINCOLOR","DEFAULT_MAXCOLOR","COLOR_PROPS","defaultProps","cellSizePixels","min","cellMarginPixels","max","colorDomain","ScreenGridCellLayer","Layer","constructor","_defineProperty","gl","hasFeatures","FEATURES","TEXTURE_FLOAT","getShaders","modules","picking","initializeState","this","context","getAttributeManager","addInstanced","instancePositions","size","update","calculateInstancePositions","instanceCounts","noAlloc","setState","model","_getModel","shouldUpdateState","changeFlags","somethingChanged","updateState","params","super","oldProps","attributeManager","numInstances","invalidateAll","invalidate","_updateUniforms","draw","_ref2","parameters","maxTexture","minColor","maxColor","state","setUniforms","depthTest","depthMask","attribute","_ref3","numCol","Math","ceil","floor","Model","id","geometry","Geometry","drawMode","attributes","positions","isInstanced","_shouldUseMinMax","log","deprecated","key","shouldUseMinMax","viewportChanged","margin","cellScale","getPosition","type","d","getWeight","gpuAggregation","aggregation","POSITION_ATTRIBUTE_NAME","DIMENSIONS","data","weights","accessors","ScreenGridLayer","GridAggregationLayer","isSupported","supported","error","concat","initializeAggregationLayer","dimensions","getCellSize","count","operation","AGGREGATION_OPERATION","SUM","needMax","getFloatTexture","projectPoints","subLayerData","positionAttributeName","posOffset","translation","add","accessor","fp64","use64bitPositions","renderLayers","numRow","updateTriggers","aggregationBuffer","getSubLayerClass","getSubLayerProps","finalizeState","maxBuffer","delete","getPickingInfo","info","gpuGridAggregator","aggregationResults","getData","object","GPUGridAggregator","getAggregationData","pixelIndex","updateResults","aggregationData","maxData","setData","setImageData","updateAggregationState","cellSize","cellSizeChanged","warn","gpuAggregationChanged","positionsChanged","isAttributeChanged","aggregationDataDirty","isAggregationDirty","compareAll","dimension","aggregationWeightsDirty","allocateResources","scaling","gridOffset","xOffset","yOffset","_updateAccessors","_resetResults","getValue","getValueFunc","setTooltipContent","o","className","TooltipRow","t","coordinate","cellWeight","getLayer","formData","payload","onAddFilter","fd","c","color_picker","features","r","g","b","a","js_data_mutator","sandboxedEval","jsFnMutator","slice_id","grid_size","outline","weight","commonLayerProps","DeckGLScreenGrid","containerRef","useRef","getAdjustedViewport","autozoom","fitViewport","points","stateFormData","setStateFormData","form_data","setViewport","current","getLayers","_noop","mapbox_style","mapboxApiKey","onSelect","onHover","onClick","tooltipContentGenerator","js_tooltip","picked","js_onclick_href","href","window","open","table_filter","line_column","pickable","percentiles","p1","p5","p95","p99","getAggFunc","arr","d3func","acc","sortedArr","sort","o1","o2","d3array","hexToRGB","hex","alpha","rgb","LAT_LIMIT","LNG_LIMIT","expandIfNeeded","padding","curMin","curMax","minBound","maxBound","originalViewPort","minExtent","maxZoom","offset","bearing","pitch","bounds","latBounds","d3Extent","lngBounds","computeBoundsFromPoints","fitBounds","console","GLOBAL_CONTEXT","_","code","sandbox","resultKey","random","codeToEval","sandboxContext","Object","keys","forEach","vm"],"sourceRoot":""}