"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[4502],{95413:(e,a,t)=>{t.d(a,{Y:()=>s});var l=t(61988);const s={name:(0,l.t)("Data"),tabs:[{name:"Databases",label:(0,l.t)("Databases"),url:"/databaseview/list/",usesRouter:!0},{name:"Datasets",label:(0,l.t)("Datasets"),url:"/tablemodelview/list/",usesRouter:!0},{name:"Saved queries",label:(0,l.t)("Saved queries"),url:"/savedqueryview/list/",usesRouter:!0},{name:"Query history",label:(0,l.t)("Query history"),url:"/superset/sqllab/history/",usesRouter:!0}]}},30075:(e,a,t)=>{t.r(a),t.d(a,{default:()=>q});var l=t(51995),s=t(61988),o=t(31069),n=t(67294),i=t(15926),d=t.n(i),r=t(37703),c=t(35755),u=t(38703),b=t(91877),p=t(93185),m=t(34858),h=t(40768),_=t(14114),Z=t(20755),v=t(17198),f=t(58593),w=t(70163),S=t(70695),g=t(18782),y=t(95413),C=t(32228),E=t(6238),D=t(11965);const x=(0,l.iK)(w.Z.Check)`
  color: ${({theme:e})=>e.colors.grayscale.dark1};
`,N=(0,l.iK)(w.Z.CancelX)`
  color: ${({theme:e})=>e.colors.grayscale.dark1};
`,k=l.iK.div`
  color: ${({theme:e})=>e.colors.grayscale.base};

  .action-button {
    display: inline-block;
    height: 100%;
  }
`;function A({value:e}){return e?(0,D.tZ)(x,null):(0,D.tZ)(N,null)}const q=(0,_.ZP)((function({addDangerToast:e,addSuccessToast:a}){const{state:{loading:t,resourceCount:l,resourceCollection:i},hasPerm:_,fetchData:x,refreshData:N}=(0,m.Yi)("database",(0,s.t)("database"),e),q=(0,r.v9)((e=>e.user)),[L,H]=(0,c.Kx)({databaseAdded:c.dJ}),[T,z]=(0,n.useState)(!1),[O,U]=(0,n.useState)(null),[$,I]=(0,n.useState)(null),[Q,R]=(0,n.useState)(!1),X=(0,S.i5)(q),V=Q||X,[M,Y]=(0,n.useState)(!1),{roles:j}=q,{CSV_EXTENSIONS:B,COLUMNAR_EXTENSIONS:K,EXCEL_EXTENSIONS:P,ALLOWED_EXTENSIONS:F}=(0,r.v9)((e=>e.common.conf));function J({database:e=null,modalOpen:a=!1}={}){I(e),z(a)}(0,n.useEffect)((()=>{null!=L&&L.databaseAdded&&(H({databaseAdded:void 0}),N())}),[L,H,N]);const W=_("can_write"),G=_("can_write"),ee=_("can_write"),ae=_("can_export")&&(0,b.cr)(p.T.VERSIONED_EXPORT),{canUploadCSV:te,canUploadColumnar:le,canUploadExcel:se}=(0,h.Mc)(j,B,K,P,F),oe=X&&!Q,ne=[{label:(0,s.t)("Upload file to database"),childs:[{label:(0,s.t)("Upload CSV"),name:"Upload CSV file",url:"/csvtodatabaseview/form",perm:te&&V,disable:oe},{label:(0,s.t)("Upload columnar file"),name:"Upload columnar file",url:"/columnartodatabaseview/form",perm:le&&V,disable:oe},{label:(0,s.t)("Upload Excel file"),name:"Upload Excel file",url:"/exceltodatabaseview/form",perm:se&&V,disable:oe}]}];(0,n.useEffect)((()=>{o.Z.get({endpoint:`/api/v1/database/?q=${d().encode({filters:[{col:"allow_file_upload",opr:"upload_is_enabled",value:!0}]})}`}).then((({json:e})=>{R(e.count>=1)}))}),[T]);const ie={activeChild:"Databases",dropDownLinks:ne.map((e=>(e.childs=e.childs.filter((e=>e.perm)),e))),...y.Y};W&&(ie.buttons=[{"data-test":"btn-create-database",name:(0,D.tZ)(n.Fragment,null,(0,D.tZ)("i",{className:"fa fa-plus"})," ",(0,s.t)("Database")," "),buttonStyle:"primary",onClick:()=>{J({modalOpen:!0})}}]);const de=(0,n.useMemo)((()=>[{accessor:"database_name",Header:(0,s.t)("Database")},{accessor:"backend",Header:(0,s.t)("Backend"),size:"lg",disableSortBy:!0},{accessor:"allow_run_async",Header:(0,D.tZ)(f.u,{id:"allow-run-async-header-tooltip",title:(0,s.t)("Asynchronous query execution"),placement:"top"},(0,D.tZ)("span",null,(0,s.t)("AQE"))),Cell:({row:{original:{allow_run_async:e}}})=>(0,D.tZ)(A,{value:e}),size:"sm"},{accessor:"allow_dml",Header:(0,D.tZ)(f.u,{id:"allow-dml-header-tooltip",title:(0,s.t)("Allow data manipulation language"),placement:"top"},(0,D.tZ)("span",null,(0,s.t)("DML"))),Cell:({row:{original:{allow_dml:e}}})=>(0,D.tZ)(A,{value:e}),size:"sm"},{accessor:"allow_file_upload",Header:(0,s.t)("CSV upload"),Cell:({row:{original:{allow_file_upload:e}}})=>(0,D.tZ)(A,{value:e}),size:"md"},{accessor:"expose_in_sqllab",Header:(0,s.t)("Expose in SQL Lab"),Cell:({row:{original:{expose_in_sqllab:e}}})=>(0,D.tZ)(A,{value:e}),size:"md"},{accessor:"created_by",disableSortBy:!0,Header:(0,s.t)("Created by"),Cell:({row:{original:{created_by:e}}})=>e?`${e.first_name} ${e.last_name}`:"",size:"xl"},{Cell:({row:{original:{changed_on_delta_humanized:e}}})=>e,Header:(0,s.t)("Last modified"),accessor:"changed_on_delta_humanized",size:"xl"},{Cell:({row:{original:e}})=>G||ee||ae?(0,D.tZ)(k,{className:"actions"},ee&&(0,D.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{return a=e,o.Z.get({endpoint:`/api/v1/database/${a.id}/related_objects/`}).then((({json:e={}})=>{U({...a,chart_count:e.charts.count,dashboard_count:e.dashboards.count,sqllab_tab_count:e.sqllab_tab_states.count})})).catch((0,h.v$)((e=>(0,s.t)("An error occurred while fetching database related data: %s",e))));var a}},(0,D.tZ)(f.u,{id:"delete-action-tooltip",title:(0,s.t)("Delete database"),placement:"bottom"},(0,D.tZ)(w.Z.Trash,null))),ae&&(0,D.tZ)(f.u,{id:"export-action-tooltip",title:(0,s.t)("Export"),placement:"bottom"},(0,D.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>{var a;void 0!==(a=e).id&&((0,C.Z)("database",[a.id],(()=>{Y(!1)})),Y(!0))}},(0,D.tZ)(w.Z.Share,null))),G&&(0,D.tZ)(f.u,{id:"edit-action-tooltip",title:(0,s.t)("Edit"),placement:"bottom"},(0,D.tZ)("span",{role:"button",tabIndex:0,className:"action-button",onClick:()=>J({database:e,modalOpen:!0})},(0,D.tZ)(w.Z.EditAlt,null)))):null,Header:(0,s.t)("Actions"),id:"actions",hidden:!G&&!ee,disableSortBy:!0}]),[ee,G,ae]),re=(0,n.useMemo)((()=>[{Header:(0,s.t)("Expose in SQL Lab"),id:"expose_in_sqllab",input:"select",operator:g.p.equals,unfilteredLabel:"All",selects:[{label:"Yes",value:!0},{label:"No",value:!1}]},{Header:(0,D.tZ)(f.u,{id:"allow-run-async-filter-header-tooltip",title:(0,s.t)("Asynchronous query execution"),placement:"top"},(0,D.tZ)("span",null,(0,s.t)("AQE"))),id:"allow_run_async",input:"select",operator:g.p.equals,unfilteredLabel:"All",selects:[{label:"Yes",value:!0},{label:"No",value:!1}]},{Header:(0,s.t)("Search"),id:"database_name",input:"search",operator:g.p.contains}]),[]);return(0,D.tZ)(n.Fragment,null,(0,D.tZ)(Z.Z,ie),(0,D.tZ)(E.Z,{databaseId:null==$?void 0:$.id,show:T,onHide:J,onDatabaseAdd:()=>{N()}}),O&&(0,D.tZ)(v.Z,{description:(0,s.t)("The database %s is linked to %s charts that appear on %s dashboards and users have %s SQL Lab tabs using this database open. Are you sure you want to continue? Deleting the database will break those objects.",O.database_name,O.chart_count,O.dashboard_count,O.sqllab_tab_count),onConfirm:()=>{O&&function({id:t,database_name:l}){o.Z.delete({endpoint:`/api/v1/database/${t}`}).then((()=>{N(),a((0,s.t)("Deleted: %s",l)),U(null)}),(0,h.v$)((a=>e((0,s.t)("There was an issue deleting %s: %s",l,a)))))}(O)},onHide:()=>U(null),open:!0,title:(0,s.t)("Delete Database?")}),(0,D.tZ)(g.Z,{className:"database-list-view",columns:de,count:l,data:i,fetchData:x,filters:re,initialSort:[{id:"changed_on_delta_humanized",desc:!0}],loading:t,pageSize:25}),M&&(0,D.tZ)(u.Z,null))}))}}]);
//# sourceMappingURL=ac0e45c6984fd9c3ac00.chunk.js.map