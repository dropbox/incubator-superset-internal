(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{1631:function(e,t,n){var a;!function(i,r,o){if(i){for(var s,l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},u={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},c={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},g={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},d=1;d<20;++d)l[111+d]="f"+d;for(d=0;d<=9;++d)l[d+96]=d.toString();x.prototype.bind=function(e,t,n){return e=e instanceof Array?e:[e],this._bindMultiple.call(this,e,t,n),this},x.prototype.unbind=function(e,t){return this.bind.call(this,e,(function(){}),t)},x.prototype.trigger=function(e,t){return this._directMap[e+":"+t]&&this._directMap[e+":"+t]({},e),this},x.prototype.reset=function(){return this._callbacks={},this._directMap={},this},x.prototype.stopCallback=function(e,t){return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&(!function e(t,n){return null!==t&&t!==r&&(t===n||e(t.parentNode,n))}(t,this.target)&&("INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable))},x.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},x.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);s=null},x.init=function(){var e=x(r);for(var t in e)"_"!==t.charAt(0)&&(x[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},x.init(),i.Mousetrap=x,e.exports&&(e.exports=x),void 0===(a=function(){return x}.call(t,n,t,e))||(e.exports=a)}function h(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function f(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return l[e.which]?l[e.which]:u[e.which]?u[e.which]:String.fromCharCode(e.which).toLowerCase()}function p(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function v(e,t,n){return n||(n=function(){if(!s)for(var e in s={},l)e>95&&e<112||l.hasOwnProperty(e)&&(s[l[e]]=e);return s}()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function m(e,t){var n,a,i,r=[];for(n=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),i=0;i<n.length;++i)a=n[i],g[a]&&(a=g[a]),t&&"keypress"!=t&&c[a]&&(a=c[a],r.push("shift")),p(a)&&r.push(a);return{key:a,modifiers:r,action:t=v(a,r,t)}}function x(e){var t=this;if(e=e||r,!(t instanceof x))return new x(e);t.target=e,t._callbacks={},t._directMap={};var n,a={},i=!1,o=!1,s=!1;function l(e){e=e||{};var t,n=!1;for(t in a)e[t]?n=!0:a[t]=0;n||(s=!1)}function u(e,n,i,r,o,s){var l,u,c,g,d=[],h=i.type;if(!t._callbacks[e])return[];for("keyup"==h&&p(e)&&(n=[e]),l=0;l<t._callbacks[e].length;++l)if(u=t._callbacks[e][l],(r||!u.seq||a[u.seq]==u.level)&&h==u.action&&("keypress"==h&&!i.metaKey&&!i.ctrlKey||(c=n,g=u.modifiers,c.sort().join(",")===g.sort().join(",")))){var f=!r&&u.combo==o,v=r&&u.seq==r&&u.level==s;(f||v)&&t._callbacks[e].splice(l,1),d.push(u)}return d}function c(e,n,a,i){t.stopCallback(n,n.target||n.srcElement,a,i)||!1===e(n,a)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(n),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(n))}function g(e){"number"!=typeof e.which&&(e.which=e.keyCode);var n=f(e);n&&("keyup"!=e.type||i!==n?t.handleKey(n,function(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(e),e):i=!1)}function d(e,t,r,o){function u(t){return function(){s=t,++a[e],clearTimeout(n),n=setTimeout(l,1e3)}}function g(t){c(r,t,e),"keyup"!==o&&(i=f(t)),setTimeout(l,10)}a[e]=0;for(var d=0;d<t.length;++d){var h=d+1===t.length?g:u(o||m(t[d+1]).action);v(t[d],h,o,e,d)}}function v(e,n,a,i,r){t._directMap[e+":"+a]=n;var o,s=(e=e.replace(/\s+/g," ")).split(" ");s.length>1?d(e,s,n,a):(o=m(e,a),t._callbacks[o.key]=t._callbacks[o.key]||[],u(o.key,o.modifiers,{type:o.action},i,e,r),t._callbacks[o.key][i?"unshift":"push"]({callback:n,modifiers:o.modifiers,action:o.action,seq:i,level:r,combo:e}))}t._handleKey=function(e,t,n){var a,i=u(e,t,n),r={},g=0,d=!1;for(a=0;a<i.length;++a)i[a].seq&&(g=Math.max(g,i[a].level));for(a=0;a<i.length;++a)if(i[a].seq){if(i[a].level!=g)continue;d=!0,r[i[a].seq]=1,c(i[a].callback,n,i[a].combo,i[a].seq)}else d||c(i[a].callback,n,i[a].combo);var h="keypress"==n.type&&o;n.type!=s||p(e)||h||l(r),o=d&&"keydown"==n.type},t._bindMultiple=function(e,t,n){for(var a=0;a<e.length;++a)v(e[a],t,n)},h(e,"keypress",g),h(e,"keydown",g),h(e,"keyup",g)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},3690:function(e,t,n){"use strict";n.d(t,"a",(function(){return T}));var a=n(1342),i=n(62),r=n(30),o=n(28),s=n(800);function l(e,t){var n=s.c([],t,e);return s.b(n,n,1/n[3]),n}var u=n(143),c=n(203),g=n(1033);function d(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var h=Math.PI,f=h/4,p=h/180,v=180/h;function m(e){return Math.pow(2,e)}function x(e){var t=Object(i.a)(e,2),n=t[0],a=t[1];d(Number.isFinite(n)),d(Number.isFinite(a)&&a>=-90&&a<=90,"invalid latitude");var r=a*p;return[512*(n*p+h)/(2*h),512*(h+Math.log(Math.tan(f+.5*r)))/(2*h)]}function b(e){var t=Object(i.a)(e,2),n=t[0],a=t[1],r=n/512*(2*h)-h,o=2*(Math.atan(Math.exp(a/512*(2*h)-h))-f);return[r*v,o*v]}function M(e){var t=e.latitude,n=e.longitude,a=e.highPrecision,i=void 0!==a&&a;d(Number.isFinite(t)&&Number.isFinite(n));var r={},o=Math.cos(t*p),s=512/360/o,l=512/4003e4/o;if(r.unitsPerMeter=[l,l,l],r.metersPerUnit=[1/l,1/l,1/l],r.unitsPerDegree=[512/360,s,l],r.degreesPerUnit=[.703125,1/s,1/l],i){var u=p*Math.tan(t*p)/o,c=512/360*u/2,g=512/4003e4*u,h=g/s*l;r.unitsPerDegree2=[0,c,g],r.unitsPerMeter2=[h,0,h]}return r}function y(e){var t=e.height,n=e.pitch,a=e.bearing,i=e.altitude,r=e.scale,o=e.center,s=void 0===o?null:o,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return u.o(l,l,[0,0,-i]),u.k(l,l,-n*p),u.m(l,l,a*p),r/=t,u.n(l,l,[r,r,r]),s&&u.o(l,l,g.d([],s)),l}function w(e){var t=e.width,n=e.height,a=e.pitch,i=function(e){var t=e.width,n=e.height,a=e.altitude,i=void 0===a?1.5:a,r=e.pitch,o=void 0===r?0:r,s=e.nearZMultiplier,l=void 0===s?1:s,u=e.farZMultiplier,c=void 0===u?1:u,g=o*p,d=Math.atan(.5/i),h=Math.sin(d)*i/Math.sin(Math.min(Math.max(Math.PI/2-g-d,.01),Math.PI-.01));return{fov:2*d,aspect:t/n,focalDistance:i,near:l,far:(Math.sin(g)*h+i)*c}}({width:t,height:n,altitude:e.altitude,pitch:a,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),r=i.fov,o=i.aspect,s=i.near,l=i.far;return u.i([],r,o,s,l)}function C(e,t){var n=Object(i.a)(e,3),a=n[0],r=n[1],o=n[2],s=void 0===o?0:o;return d(Number.isFinite(a)&&Number.isFinite(r)&&Number.isFinite(s)),l(t,[a,r,s,1])}function P(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=Object(i.a)(e,3),r=a[0],o=a[1],s=a[2];if(d(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(s)){var u=l(t,[r,o,s,1]);return u}var g=l(t,[r,o,0,1]),h=l(t,[r,o,1,1]),f=g[2],p=h[2],v=f===p?0:((n||0)-f)/(p-f);return c.d([],g,h,v)}function S(e){var t=e.width,n=e.height,a=e.bounds,r=e.minExtent,o=void 0===r?0:r,s=e.maxZoom,l=void 0===s?24:s,u=e.padding,c=void 0===u?0:u,g=e.offset,h=void 0===g?[0,0]:g,f=Object(i.a)(a,2),p=Object(i.a)(f[0],2),v=p[0],m=p[1],x=Object(i.a)(f[1],2),b=x[0],M=x[1];if(Number.isFinite(c)){c={top:c,bottom:c,left:c,right:c}}else d(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var y=new _({width:t,height:n,longitude:0,latitude:0,zoom:0}),w=y.project([v,M]),C=y.project([b,m]),P=[Math.max(Math.abs(C[0]-w[0]),o),Math.max(Math.abs(C[1]-w[1]),o)],S=[t-c.left-c.right-2*Math.abs(h[0]),n-c.top-c.bottom-2*Math.abs(h[1])];d(S[0]>0&&S[1]>0);var j=S[0]/P[0],A=S[1]/P[1],k=(c.right-c.left)/2/j,O=(c.bottom-c.top)/2/A,F=[(C[0]+w[0])/2+k,(C[1]+w[1])/2+O],z=y.unproject(F),D=Math.min(l,y.zoom+Math.log2(Math.abs(Math.min(j,A))));return d(Number.isFinite(D)),{longitude:z[0],latitude:z[1],zoom:D}}var j=Math.PI/180;function A(e){var t,n,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=e.width,r=e.height,o=e.unproject,s={targetZ:a},l=o([0,r],s),u=o([i,r],s),c=Math.atan(.5/e.altitude),g=(90-e.pitch)*j;return c>g-.01?(t=k(e,0,a),n=k(e,i,a)):(t=o([0,0],s),n=o([i,0],s)),[l,u,n,t]}function k(e,t,n){var a=e.pixelUnprojectionMatrix,i=l(a,[t,0,1,1]),r=l(a,[t,e.height,1,1]),o=(n*e.distanceScales.unitsPerMeter[2]-i[2])/(r[2]-i[2]),s=b(c.d([],i,r,o));return s[2]=n,s}var _=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:1,height:1},n=t.width,a=t.height,i=t.latitude,o=void 0===i?0:i,s=t.longitude,l=void 0===s?0:s,u=t.zoom,c=void 0===u?0:u,g=t.pitch,d=void 0===g?0:g,h=t.bearing,f=void 0===h?0:h,p=t.altitude,v=void 0===p?1.5:p,b=t.nearZMultiplier,C=void 0===b?.02:b,P=t.farZMultiplier,S=void 0===P?1.01:P;Object(r.a)(this,e),n=n||1,a=a||1;var j=m(c);v=Math.max(.75,v);var A=x([l,o]);A[2]=0,this.projectionMatrix=w({width:n,height:a,pitch:d,altitude:v,nearZMultiplier:C,farZMultiplier:S}),this.viewMatrix=y({height:a,scale:j,center:A,pitch:d,bearing:f,altitude:v}),this.width=n,this.height=a,this.scale=j,this.latitude=o,this.longitude=l,this.zoom=c,this.pitch=d,this.bearing=f,this.altitude=v,this.center=A,this.distanceScales=M(this),this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}return Object(o.a)(e,[{key:"_initMatrices",value:function(){var e=this.width,t=this.height,n=this.projectionMatrix,a=this.viewMatrix,i=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u.g(i,i,n),u.g(i,i,a),this.viewProjectionMatrix=i;var r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u.n(r,r,[e/2,-t/2,1]),u.o(r,r,[1,-1,0]),u.g(r,r,i);var o=u.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r);if(!o)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=r,this.pixelUnprojectionMatrix=o}},{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&u.b(t.projectionMatrix,this.projectionMatrix)&&u.b(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,a=void 0===n||n,r=this.projectPosition(e),o=C(r,this.pixelProjectionMatrix),s=Object(i.a)(o,2),l=s[0],u=s[1],c=a?u:this.height-u;return 2===e.length?[l,c]:[l,c,o[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,a=void 0===n||n,r=t.targetZ,o=void 0===r?void 0:r,s=Object(i.a)(e,3),l=s[0],u=s[1],c=s[2],g=a?u:this.height-u,d=o&&o*this.distanceScales.unitsPerMeter[2],h=P([l,g,c],this.pixelUnprojectionMatrix,d),f=this.unprojectPosition(h),p=Object(i.a)(f,3),v=p[0],m=p[1],x=p[2];return Number.isFinite(c)?[v,m,x]:Number.isFinite(o)?[v,m,o]:[v,m]}},{key:"projectPosition",value:function(e){var t=x(e),n=Object(i.a)(t,2);return[n[0],n[1],(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:"unprojectPosition",value:function(e){var t=b(e),n=Object(i.a)(t,2);return[n[0],n[1],(e[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(e){return x(e)}},{key:"unprojectFlat",value:function(e){return b(e)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t=e.lngLat,n=P(e.pos,this.pixelUnprojectionMatrix),a=x(t),i=c.a([],a,c.e([],n));return b(c.a([],this.center,i))}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this.width,i=this.height,r=S(Object.assign({width:a,height:i,bounds:t},n)),o=r.longitude,s=r.latitude,l=r.zoom;return new e({width:a,height:i,longitude:o,latitude:s,zoom:l})}},{key:"getBounds",value:function(e){var t=this.getBoundingRegion(e),n=Math.min.apply(Math,Object(a.a)(t.map((function(e){return e[0]})))),i=Math.max.apply(Math,Object(a.a)(t.map((function(e){return e[0]}))));return[[n,Math.min.apply(Math,Object(a.a)(t.map((function(e){return e[1]}))))],[i,Math.max.apply(Math,Object(a.a)(t.map((function(e){return e[1]}))))]]}},{key:"getBoundingRegion",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return A(this,e.z||0)}}]),e}();var O=n(14);const F=[-90,90],z=[-180,180];function D(e,t,n){let[a,i]=e,[r,o]=t;return void 0===n&&(n=.25),a<i?[a,i]:[Math.max(r,a-n),Math.min(o,i+n)]}function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function T(e,t){let{points:n,width:a,height:i,minExtent:r,maxZoom:o,offset:s,padding:l=20}=t;const{bearing:u,pitch:c}=e,g=function(e){const t=D(Object(O.extent)(e,e=>e[1]),F),n=D(Object(O.extent)(e,e=>e[0]),z);return[[n[0],t[0]],[n[1],t[1]]]}(n);try{return R({},S({bounds:g,width:a,height:i,minExtent:r,maxZoom:o,offset:s,padding:l}),{bearing:u,pitch:c})}catch(e){console.error("Could not fit viewport",e)}return e}},3695:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var a=n(13),i=n.n(a);const r=[1,0,1,0,0,0,0];function o(e,t){const n=parseInt(i()(t).format("x"),10);return parseInt(i()(t).add(e).format("x"),10)-n}function s(e,t){const n=i()(Math.min(...e)),a=i()(Math.max(...e));let s,l,u;if(t.includes("/")){const e=t.split("/",2);e[0].endsWith("Z")?(l=i()(e[0]),s=i.a.duration(e[1])):(l=i()(e[1]),s=i.a.duration(e[0]))}else s=i.a.duration(t),l=function(e,t){const n=i()(e).subtract(t),a=e.toArray(),o=n.toArray(),s=a.map((e,t)=>o[t]!==e).indexOf(!0),l=a.map((e,t)=>{if(t===s){const n=e-o[t];return e-(e-r[t])%n}return t<s||-1===s?e:r[t]});return i()(l)}(n,s);const c=n.valueOf();for(u=l.clone();u.valueOf()<c;)u.add(s);for(;u.valueOf()>c;)u.subtract(s);let g;const d=a.valueOf();for(g=l.clone();g.valueOf()>d;)g.subtract(s);for(;g.valueOf()<d;)g.add(s);const h=null!=t?[u,u.clone().add(s)]:[u,g],f=e.every(e=>null===e);return{start:parseInt(u.format("x"),10),end:parseInt(g.format("x"),10),getStep:o.bind(this,s),values:h.map(e=>parseInt(e.format("x"),10)),disabled:f}}},3696:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return s}));var a={SUM:1,MEAN:2,MIN:3,MAX:4};function i(e,t){return e+t}function r(e,t){return t>e?t:e}function o(e,t){return t<e?t:e}function s(e,t){switch(a[e.toUpperCase()]||a.SUM){case a.MIN:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(o,1/0):null}(e,t)};case a.SUM:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(i,0):null}(e,t)};case a.MEAN:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(i,0)/n.length:null}(e,t)};case a.MAX:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(r,-1/0):null}(e,t)};default:return null}}},3698:function(e,t,n){"use strict";n.d(t,"a",(function(){return x}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(3697),l=n(1631),u=n.n(l),c=n(3),g=n(2463),d=n.n(g);n(2635),n(3702);function h(e){return i.a.createElement("span",{className:"BootstrapSliderWrapper"},i.a.createElement(d.a,e))}n(3703);const f={start:o.a.number.isRequired,step:o.a.number.isRequired,end:o.a.number.isRequired,values:o.a.array.isRequired,onChange:o.a.func,loopDuration:o.a.number,maxFrames:o.a.number,orientation:o.a.oneOf(["horizontal","vertical"]),reversed:o.a.bool,disabled:o.a.bool,range:o.a.bool};class p extends i.a.PureComponent{constructor(e){super(e),this.state={intervalId:null};const t=e.end-e.start,n=Math.min(e.maxFrames,t/e.step),a=t/n;this.intervalMilliseconds=e.loopDuration/n,this.increment=a<e.step?e.step:a-a%e.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){u.a.bind(["space"],this.play)}componentWillUnmount(){u.a.unbind(["space"])}onChange(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:e,end:t,step:n,values:a,disabled:i}=this.props;if(i)return;const r=(Array.isArray(a)?a:[a,a+n]).map(e=>e+this.increment),o=r[1]>t?r[0]-e:0;this.props.onChange(r.map(e=>e-o))}stepBackward(){const{start:e,end:t,step:n,values:a,disabled:i}=this.props;if(i)return;const r=(Array.isArray(a)?a:[a,a+n]).map(e=>e-this.increment),o=r[0]<e?t-r[1]:0;this.props.onChange(r.map(e=>e+o))}formatter(e){if(this.props.disabled)return Object(c.t)("Data has no time steps");let t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map(e=>new Date(e).toUTCString()).join(" : ")}render(){const{start:e,end:t,step:n,orientation:a,reversed:r,disabled:o,range:s,values:l}=this.props;return i.a.createElement("div",{className:"play-slider"},i.a.createElement("div",{className:"play-slider-controls padded"},i.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),i.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),i.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),i.a.createElement("div",{className:"play-slider-scrobbler padded"},i.a.createElement(h,{value:s?l:l[0],range:s,formatter:this.formatter,change:this.onChange,min:e,max:t,step:n,orientation:a,reversed:r,disabled:o?"disabled":"enabled"})))}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}p.propTypes=f,p.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0};const m={getLayers:o.a.func.isRequired,start:o.a.number.isRequired,end:o.a.number.isRequired,getStep:o.a.func,values:o.a.array.isRequired,aggregation:o.a.bool,disabled:o.a.bool,viewport:o.a.object.isRequired,children:o.a.node,mapStyle:o.a.string,mapboxApiAccessToken:o.a.string.isRequired,setControlValue:o.a.func,onValuesChange:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired};class x extends i.a.PureComponent{constructor(){super(...arguments),v(this,"containerRef",i.a.createRef()),v(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})}render(){const{start:e,end:t,getStep:n,disabled:a,aggregation:r,children:o,getLayers:l,values:u,onValuesChange:c,viewport:g,setControlValue:d,mapStyle:h,mapboxApiAccessToken:f,height:v,width:m}=this.props,x=l(u);return i.a.createElement("div",null,i.a.createElement(s.a,{ref:this.containerRef,viewport:g,layers:x,setControlValue:d,mapStyle:h,mapboxApiAccessToken:f,bottomMargin:a?0:20,width:m,height:v}),!a&&i.a.createElement(p,{start:e,end:t,step:n(e),values:u,range:!r,onChange:c}),o)}}x.propTypes=m,x.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:()=>{},onValuesChange:()=>{}}},3702:function(e,t,n){},3703:function(e,t,n){},3707:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return i}));var a=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function i(e,t,n){var a=new t(4*e.length);return e.forEach((function(e,t){var i=4*t;a[i]=e[0],a[i+1]=e[1],a[i+2]=e[2],a[i+3]=Number.isFinite(e[3])?e[3]:n})),a}},3713:function(e,t){},3717:function(e,t,n){"use strict";n.d(t,"a",(function(){return U}));var a,i=n(11),r=n(62),o=n(30),s=n(28),l=n(3943),u=n(3930),c=n(3931),g=n(3859),d=n(3719),h=n(3923),f=n(3818),p=n(3940),v=n(3933),m=n(3691),x=n(60),b=n(3696),M={dataChanged:!0,viewportChanged:!0,cellSizeChanged:!0},y={changeFlags:M,projectPoints:!1,useGPU:!0,fp64:!1,viewport:null,gridTransformMatrix:null,createBufferObjects:!0},w=[32775,32774],C=[32776,32774],P=[32776,32775],S=(a={},Object(i.a)(a,b.a.SUM,32774),Object(i.a)(a,b.a.MEAN,32774),Object(i.a)(a,b.a.MIN,w),Object(i.a)(a,b.a.MAX,C),a),j={size:1,operation:b.a.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},A=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],k="#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec2 positions;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform mat4 uProjectionMatrix;\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result =  uProjectionMatrix * pos;\n  return result.xy/result.w;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 0, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(vec3(positions, 0), vec2(0, 0), vec3(0, 0, 0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n  pos = floor(pos / cellSize);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",_="#define SHADER_NAME gpu-aggregation-to-grid-vs-64\n\nattribute vec2 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform vec2 uProjectionMatrixFP64[16];\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvoid project_to_pixel(vec2 pos, vec2 pos64xyLow, out vec2 pixelXY64[2]) {\n\n  vec2 result64[4];\n  vec2 position64[4];\n  position64[0] = vec2(pos.x, pos64xyLow.x);\n  position64[1] = vec2(pos.y, pos64xyLow.y);\n  position64[2] = vec2(0., 0.);\n  position64[3] = vec2(1., 0.);\n  mat4_vec4_mul_fp64(uProjectionMatrixFP64, position64,\n  result64);\n\n  pixelXY64[0] = div_fp64(result64[0], result64[3]);\n  pixelXY64[1] = div_fp64(result64[1], result64[3]);\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec2 windowPos = positions;\n  vec2 windowPos64xyLow = positions64xyLow;\n  if (projectPoints) {\n    vec2 projectedXY[2];\n    project_position_fp64(windowPos, windowPos64xyLow, projectedXY);\n    windowPos.x = projectedXY[0].x;\n    windowPos.y = projectedXY[1].x;\n    windowPos64xyLow.x = projectedXY[0].y;\n    windowPos64xyLow.y = projectedXY[1].y;\n  }\n\n  vec2 pixelXY64[2];\n  project_to_pixel(windowPos, windowPos64xyLow, pixelXY64);\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  vec2 pos = vec2(x, y);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",O="#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n}\n",F=n(3788),z=n(3737);function D(e,t){var n,a=t.width,r=void 0===a?1:a,o=t.height,s=void 0===o?1:o;return new F.a(e,{data:null,format:34836,type:5126,border:0,mipmaps:!1,parameters:(n={},Object(i.a)(n,10240,9728),Object(i.a)(n,10241,9728),n),dataFormat:6408,width:r,height:s})}function R(e,t){var n=t.id,a=t.width,r=void 0===a?1:a,o=t.height,s=void 0===o?1:o,l=t.texture;return new z.a(e,{id:n,width:r,height:s,attachments:Object(i.a)({},36064,l)})}function T(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!e||e.length<t?new Float32Array(t).fill(n):e}var N=l.a.fp64ifyMatrix4,E=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],B={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},U=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(o.a)(this,e),this.id=n.id||"gpu-grid-aggregator",this.shaderCache=n.shaderCache||null,this.gl=t,this.state={weights:null,gridPositions:null,positionsBuffer:null,positions64xyLowBuffer:null,vertexCount:0,fp64:null,useGPU:null,numCol:0,numRow:0,windowSize:null,cellSize:null,weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Object(u.d)(t)&&Object(c.c)(this.gl,g.a.BLEND_EQUATION_MINMAX,g.a.COLOR_ATTACHMENT_RGBA32F,g.a.TEXTURE_FLOAT)}return Object(s.a)(e,null,[{key:"getAggregationData",value:function(e){var t=e.aggregationData,n=e.maxData,a=e.minData,i=e.maxMinData,r=4*e.pixelIndex,o={};return t&&(o.cellCount=t[r+3],o.cellWeight=t[r]),i?(o.maxCellWieght=i[0],o.minCellWeight=i[3]):(n&&(o.maxCellWieght=n[0],o.totalCount=n[3]),a&&(o.minCellWeight=a[0],o.totalCount=n[3])),o}},{key:"getCellData",value:function(e){for(var t=e.countsData,n=e.size,a=void 0===n?1:n,i=t.length/4,r=new Float32Array(i*a),o=new Uint32Array(i),s=0;s<i;s++){for(var l=0;l<a;l++)r[s*a+l]=t[4*s+l];o[s]=t[4*s+3]}return{cellCounts:o,cellWeights:r}}},{key:"isSupported",value:function(e){return Object(u.d)(e)&&Object(c.c)(e,g.a.BLEND_EQUATION_MINMAX,g.a.COLOR_ATTACHMENT_RGBA32F,g.a.TEXTURE_FLOAT)}}]),Object(s.a)(e,[{key:"delete",value:function(){var e=this.gridAggregationModel,t=this.allAggregationModel,n=this.meanTransform,a=this.state,i=a.positionsBuffer,r=a.positions64xyLowBuffer,o=a.textures,s=a.framebuffers,l=a.maxMinFramebuffers,u=a.minFramebuffers,c=a.maxFramebuffers,g=a.meanTextures,d=a.resources;e&&e.delete(),t&&t.delete(),n&&n.delete(),i&&i.delete(),r&&r.delete(),this.deleteResources([s,o,l,u,c,g,d])}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setState({results:{}});var t=this.getAggregationParams(e);this.updateGridSize(t);var n=t.useGPU;return this._hasGPUSupport&&n?this.runAggregationOnGPU(t):(n&&m.a.info("GPUGridAggregator: GPU Aggregation not supported, falling back to CPU")(),this.runAggregationOnCPU(t))}},{key:"getData",value:function(e){var t={},n=this.state.results;for(var a in n[e].aggregationData||(n[e].aggregationData=n[e].aggregationBuffer.getData()),t.aggregationData=n[e].aggregationData,B){var i=B[a];(n[e][a]||n[e][i])&&(n[e][a]=n[e][a]||n[e][i].getData(),t[a]=n[e][a])}return t}},{key:"deleteResources",value:function(e){(e=Array.isArray(e)?e:[e]).forEach((function(e){for(var t in e)e[t].delete()}))}},{key:"getAggregationParams",value:function(e){var t=Object.assign({},y,e),n=t.useGPU,a=t.gridTransformMatrix,i=t.viewport,r=t.weights,o=t.projectPoints,s=t.cellSize;return this.state.useGPU!==n&&(t.changeFlags=Object.assign({},t.changeFlags,M)),!s||this.state.cellSize&&this.state.cellSize[0]===s[0]&&this.state.cellSize[1]===s[1]||(t.changeFlags.cellSizeChanged=!0,this.setState({cellSize:s})),this.validateProps(t,e),this.setState({useGPU:n}),t.gridTransformMatrix=(o?i.viewportMatrix:a)||A,r&&(t.weights=this.normalizeWeightParams(r),this.setState({weights:t.weights})),t}},{key:"normalizeWeightParams",value:function(e){var t={};for(var n in e)t[n]=Object.assign({},j,e[n]);return t}},{key:"setState",value:function(e){Object.assign(this.state,e)}},{key:"shouldTransformToGrid",value:function(e){var t=e.projectPoints,n=e.changeFlags;return!!(!this.state.gridPositions||n.dataChanged||t&&n.viewportChanged)}},{key:"updateGridSize",value:function(e){var t=e.viewport,n=e.cellSize,a=e.width||t.width,i=e.height||t.height,r=Math.ceil(a/n[0]),o=Math.ceil(i/n[1]);this.setState({numCol:r,numRow:o,windowSize:[a,i]})}},{key:"validateProps",value:function(e,t){var n=e.changeFlags,a=e.projectPoints,i=e.gridTransformMatrix;m.a.assert(n.dataChanged||n.viewportChanged||n.cellSizeChanged),m.a.assert(!n.dataChanged||t.positions&&t.weights&&(!t.projectPositions||t.viewport)&&t.cellSize),m.a.assert(!n.cellSizeChanged||t.cellSize),m.a.assert(!(n.viewportChanged&&a)||t.viewport),a&&i&&m.a.warn("projectPoints is true, gridTransformMatrix is ignored")()}},{key:"calculateAggregationData",value:function(e){var t=e.weights,n=e.results,a=e.cellIndex,i=e.posIndex;for(var r in t){for(var o=t[r],s=o.values,l=o.size,u=o.operation,c=n[r].aggregationData,g=0;g<l;g++){var d=a+g,h=s[3*i+g];if(0===c[a+3])c[d]=h;else switch(u){case b.a.SUM:case b.a.MEAN:c[d]+=h;break;case b.a.MIN:c[d]=Math.min(c[d],h);break;case b.a.MAX:c[d]=Math.max(c[d],h);break;default:m.a.assert(!1)}}c[a+3]++}}},{key:"calculateMeanMaxMinData",value:function(e){var t=e.validCellIndices,n=e.results,a=e.weights;t.forEach((function(e){for(var t in n){for(var i=a[t],r=i.size,o=i.needMin,s=i.needMax,l=i.operation,u=n[t],c=u.aggregationData,g=u.minData,d=u.maxData,h=u.maxMinData,f=o||s,p=l===b.a.MEAN,v=o&&s&&a[t].combineMaxMin,m=c[e+4-1],x=0;x<r&&(f||p);x++){var M=e+x,y=c[M];p&&(c[M]/=m,y=c[M]),v?h[x]=Math.max(h[x],y):(o&&(g[x]=Math.min(g[x],y)),s&&(d[x]=Math.max(d[x],y)))}v?h[3]=Math.min(h[3],c[e+0]):(o&&(g[3]+=m),s&&(d[3]+=m))}}))}},{key:"initCPUResults",value:function(e){var t=e.weights||this.state.weights,n=this.state,a=n.numCol,i=n.numRow,r={};for(var o in t){var s=t[o],l=s.aggregationData,u=s.minData,c=s.maxData,g=s.maxMinData,d=t[o],h=d.needMin,f=d.needMax,p=h&&f&&t[o].combineMaxMin;l=T(l,a*i*4),p?((g=T(g,4)).fill(-1/0,0,3),g[3]=1/0):(h&&((u=T(u,4,1/0))[3]=0),f&&((c=T(c,4,-1/0))[3]=0)),r[o]=Object.assign({},t[o],{aggregationData:l,minData:u,maxData:c,maxMinData:g})}return r}},{key:"runAggregationOnCPU",value:function(e){var t,n,a=e.positions,i=e.cellSize,o=e.gridTransformMatrix,s=e.viewport,l=e.projectPoints,u=e.weights,c=this.state,g=c.numCol,d=c.numRow,h=this.initCPUResults(e),f=this.shouldTransformToGrid(e),p=[0,0,0];m.a.assert(f||e.changeFlags.cellSizeChanged),f?(n=a.length/2,t=new Float64Array(a.length),this.setState({gridPositions:t})):(t=this.state.gridPositions,u=this.state.weights,n=t.length/2);for(var v=new Set,b=0;b<n;b++){var M=void 0,y=void 0;if(f){if(p[0]=a[2*b],p[1]=a[2*b+1],l){var w=s.project(p),C=Object(r.a)(w,2);M=C[0],y=C[1]}else{var P=Object(x.k)(p,o),S=Object(r.a)(P,2);M=S[0],y=S[1]}t[2*b]=M,t[2*b+1]=y}else M=t[2*b],y=t[2*b+1];var j=Math.floor(M/i[0]),A=Math.floor(y/i[1]);if(j>=0&&j<g&&A>=0&&A<d){var k=4*(j+A*g);v.add(k),this.calculateAggregationData({weights:u,results:h,cellIndex:k,posIndex:b})}}return this.calculateMeanMaxMinData({validCellIndices:v,results:h,weights:u}),this.updateAggregationBuffers(e,h),this.setState({results:h}),h}},{key:"updateCPUResultBuffer",value:function(e){var t=e.gl,n=e.bufferName,a=e.id,i=e.data,r=e.result,o=this.state.resources,s="cpu-result-".concat(a,"-").concat(n);r[n]=r[n]||o[s],r[n]?r[n].setData({data:i}):(o[s]=new d.a(t,i),r[n]=o[s])}},{key:"updateAggregationBuffers",value:function(e,t){if(e.createBufferObjects){var n=e.weights||this.state.weights;for(var a in t){var i=t[a],r=i.aggregationData,o=i.minData,s=i.maxData,l=i.maxMinData,u=n[a],c=u.needMin,g=u.needMax,d=c&&g&&n[a].combineMaxMin;this.updateCPUResultBuffer({gl:this.gl,bufferName:"aggregationBuffer",id:a,data:r,result:t[a]}),d?this.updateCPUResultBuffer({gl:this.gl,bufferName:"maxMinBuffer",id:a,data:l,result:t[a]}):(c&&this.updateCPUResultBuffer({gl:this.gl,bufferName:"minBuffer",id:a,data:o,result:t[a]}),g&&this.updateCPUResultBuffer({gl:this.gl,bufferName:"maxBuffer",id:a,data:s,result:t[a]}))}}}},{key:"getAggregateData",value:function(e){var t={},n=this.state,a=n.textures,i=n.framebuffers,r=n.maxMinFramebuffers,o=n.minFramebuffers,s=n.maxFramebuffers,l=n.weights;for(var u in l){t[u]={};var c=l[u],g=c.needMin,d=c.needMax,f=c.combineMaxMin;t[u].aggregationTexture=a[u],t[u].aggregationBuffer=Object(h.c)(i[u],{target:l[u].aggregationBuffer,sourceType:5126}),g&&d&&f?t[u].maxMinBuffer=Object(h.c)(r[u],{target:l[u].maxMinBuffer,sourceType:5126}):(g&&(t[u].minBuffer=Object(h.c)(o[u],{target:l[u].minBuffer,sourceType:5126})),d&&(t[u].maxBuffer=Object(h.c)(s[u],{target:l[u].maxBuffer,sourceType:5126})))}return this.trackGPUResultBuffers(t,l),t}},{key:"getAggregationModel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.gl,n=this.shaderCache;return new f.a(t,{id:"Gird-Aggregation-Model",vs:e?_:k,fs:O,modules:e?["fp64","project64"]:["project32"],shaderCache:n,vertexCount:0,drawMode:0})}},{key:"getAllAggregationModel",value:function(){var e=this.gl,t=this.shaderCache,n=this.state,a=n.numCol,i=n.numRow;return new f.a(e,{id:"All-Aggregation-Model",vs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\n\nvoid main(void) {\n  vec2 pos = vec2(-1.0, -1.0);\n  vec2 offset = 1.0 / vec2(gridSize);\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  int yIndex = gl_InstanceID / gridSize[0];\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",modules:["fp64"],shaderCache:t,vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:a*i,attributes:{position:[0,0]}})}},{key:"getMeanTransform",value:function(e){return this.meanTransform?this.meanTransform.update(e):this.meanTransform=new p.a(this.gl,Object.assign({},{vs:"#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n}\n",_targetTextureVarying:"meanValues"},e)),this.meanTransform}},{key:"renderAggregateData",value:function(e){var t=e.cellSize,n=e.viewport,a=e.gridTransformMatrix,i=e.projectPoints,r=this.state,o=r.numCol,s=r.numRow,l=r.windowSize,u=r.maxMinFramebuffers,c=r.minFramebuffers,g=r.maxFramebuffers,d=r.weights,h=[o,s],f={blend:!0,depthTest:!1,blendFunc:[1,1]},p={viewport:n},v={windowSize:l,cellSize:t,gridSize:h,uProjectionMatrix:a,uProjectionMatrixFP64:N(a),projectPoints:i};for(var m in d){var x=d[m],b=x.needMin,M=x.needMax,y=b&&M&&d[m].combineMaxMin;this.renderToWeightsTexture({id:m,parameters:f,moduleSettings:p,uniforms:v,gridSize:h}),y?this.renderToMaxMinTexture({id:m,parameters:Object.assign({},f,{blendEquation:P}),gridSize:h,minOrMaxFb:u[m],clearParams:{clearColor:[0,0,0,3402823466e29]},combineMaxMin:y}):(b&&this.renderToMaxMinTexture({id:m,parameters:Object.assign({},f,{blendEquation:w}),gridSize:h,minOrMaxFb:c[m],clearParams:{clearColor:[3402823466e29,3402823466e29,3402823466e29,0]},combineMaxMin:y}),M&&this.renderToMaxMinTexture({id:m,parameters:Object.assign({},f,{blendEquation:C}),gridSize:h,minOrMaxFb:g[m],combineMaxMin:y}))}}},{key:"renderToMaxMinTexture",value:function(e){var t=e.id,n=e.parameters,a=e.gridSize,i=e.minOrMaxFb,r=e.combineMaxMin,o=e.clearParams,s=void 0===o?{}:o,l=this.state.framebuffers,u=this.gl,c=this.allAggregationModel;i.bind(),u.viewport(0,0,a[0],a[1]),Object(v.a)(u,s,(function(){u.clear(16384)})),c.draw({parameters:n,uniforms:{uSampler:l[t].texture,gridSize:a,combineMaxMin:r}}),i.unbind()}},{key:"renderToWeightsTexture",value:function(e){var t=e.id,n=e.parameters,a=e.moduleSettings,r=e.uniforms,o=e.gridSize,s=this.state,l=s.framebuffers,u=s.equations,c=s.weightAttributes,g=s.weights,d=this.gl,h=this.gridAggregationModel,f=g[t].operation;l[t].bind(),d.viewport(0,0,o[0],o[1]);var p=f===b.a.MIN?[3402823466e29,3402823466e29,3402823466e29,0]:[0,0,0,0];Object(v.a)(d,{clearColor:p},(function(){d.clear(16384)}));var m={weights:c[t]};if(h.draw({parameters:Object.assign({},n,{blendEquation:u[t]}),moduleSettings:a,uniforms:r,attributes:m}),l[t].unbind(),f===b.a.MEAN){var x=this.state,M=x.meanTextures,y=x.textures,w={_sourceTextures:{aggregationValues:M[t]},_targetTexture:y[t],elementCount:y[t].width*y[t].height};this.getMeanTransform(w).run({parameters:{blend:!1,depthTest:!1}}),l[t].attach(Object(i.a)({},36064,y[t]))}}},{key:"runAggregationOnGPU",value:function(e){this.updateModels(e),this.setupFramebuffers(e),this.renderAggregateData(e);var t=this.getAggregateData(e);return this.setState({results:t}),t}},{key:"setupFramebuffers",value:function(e){var t=this.state,n=t.numCol,a=t.numRow,r=t.textures,o=t.framebuffers,s=t.maxMinFramebuffers,l=t.minFramebuffers,u=t.maxFramebuffers,c=t.resources,g=t.meanTextures,d=t.equations,h=t.weights,f={width:n,height:a};for(var p in h){var v=h[p],m=v.needMin,x=v.needMax,M=v.combineMaxMin,y=v.operation;r[p]=h[p].aggregationTexture||r[p]||D(this.gl,{id:"".concat(p,"-texture"),width:n,height:a}),r[p].resize(f);var w=r[p];y===b.a.MEAN&&(g[p]=g[p]||D(this.gl,{id:"".concat(p,"-mean-texture"),width:n,height:a}),g[p].resize(f),w=g[p]),o[p]?o[p].attach(Object(i.a)({},36064,w)):o[p]=R(this.gl,{id:"".concat(p,"-fb"),width:n,height:a,texture:w}),o[p].resize(f),d[p]=S[y],(m||x)&&(m&&x&&M?s[p]||(c["".concat(p,"-maxMin")]=D(this.gl,{id:"".concat(p,"-maxMinTex")}),s[p]=R(this.gl,{id:"".concat(p,"-maxMinFb"),texture:c["".concat(p,"-maxMin")]})):(m&&(l[p]||(c["".concat(p,"-min")]=D(this.gl,{id:"".concat(p,"-minTex")}),l[p]=R(this.gl,{id:"".concat(p,"-minFb"),texture:c["".concat(p,"-min")]}))),x&&(u[p]||(c["".concat(p,"-max")]=D(this.gl,{id:"".concat(p,"-maxTex")}),u[p]=R(this.gl,{id:"".concat(p,"-maxFb"),texture:c["".concat(p,"-max")]})))))}}},{key:"setupModels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.gridAggregationModel&&this.gridAggregationModel.delete(),this.gridAggregationModel=this.getAggregationModel(e),this.allAggregationModel||(this.allAggregationModel=this.getAllAggregationModel())}},{key:"setupWeightAttributes",value:function(e){var t=this.state,n=t.weightAttributes,a=t.vertexCount,i=t.weights,r=t.resources;for(var o in i){var s=i[o].values;if(Array.isArray(s)||s.constructor===Float32Array){m.a.assert(s.length/3===a);var l=Array.isArray(s)?new Float32Array(s):s;n[o]instanceof d.a?n[o].setData(l):(r["".concat(o,"-buffer")]=new d.a(this.gl,l),n[o]=r["".concat(o,"-buffer")])}else m.a.assert(s instanceof d.a),n[o]=s}}},{key:"trackGPUResultBuffers",value:function(e,t){var n=this.state.resources;for(var a in e)if(e[a])for(var i=0;i<E.length;i++){var r=E[i];if(e[a][r]&&t[a][r]!==e[a][r]){var o="gpu-result-".concat(a,"-").concat(r);n[o]&&n[o].delete(),n[o]=e[a][r]}}}},{key:"updateModels",value:function(e){var t=this.gl,n=e.positions,a=e.positions64xyLow,i=e.changeFlags,r=this.state,o=r.numCol,s=r.numRow,l={},u=!1;if(e.fp64!==this.state.fp64&&(this.setupModels(e.fp64),this.setState({fp64:e.fp64}),u=!0),i.dataChanged||!this.state.positionsBuffer){var c=this.state,g=c.positionsBuffer,h=c.positions64xyLowBuffer;g&&g.delete(),h&&h.delete();var f=n.length/2;g=new d.a(t,new Float32Array(n)),h=new d.a(t,{data:new Float32Array(a),accessor:{size:2}}),this.setState({positionsBuffer:g,positions64xyLowBuffer:h,vertexCount:f}),this.setupWeightAttributes(e),u=!0}if(u){var p=this.state,v=p.vertexCount,m=p.positionsBuffer,x=p.positions64xyLowBuffer;l.positions=m,e.fp64&&(l.positions64xyLow=x),this.gridAggregationModel.setVertexCount(v),this.gridAggregationModel.setAttributes(l)}(i.cellSizeChanged||i.viewportChanged)&&this.allAggregationModel.setInstanceCount(o*s)}}]),e}()},3821:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return L}));var a=n(1),i=n.n(a),r=n(0),o=n.n(r),s=n(30),l=n(28),u=n(53),c=n(48),g=n(785),d=n(54),h=n(3687),f=n(3746),p=n(3691),v=n(3770),m=n(3718),x=n(3707),b=n(3717),M=n(3696),y=n(3930),w=n(3818),C=n(3778),P=n(3719),S=h.a.count,j=[0,0,0,0],A=[0,255,0,255],k=["minColor","maxColor","colorRange","colorDomain"],_={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:x.b,getPosition:{type:"accessor",value:function(e){return e.position}},getWeight:{type:"accessor",value:function(e){return[1,0,0]}},gpuAggregation:!0,aggregation:"SUM"},O=function(e){function t(){return Object(s.a)(this,t),Object(u.a)(this,Object(c.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"getShaders",value:function(){var e=Object(y.d)(this.context.gl)?{vs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 instancePositions;\nin vec4 instanceCounts;\nin vec3 instancePickingColors;\n\nlayout(std140) uniform;\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform AggregationData\n{\n  vec4 maxCount;\n} aggregationData;\n\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\n\nout vec4 vColor;\nout float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r ;\n  float maxWeight = aggregationData.maxCount.r;\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\nin float vSampleCount;\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  fragColor = vColor;\n\n  fragColor = picking_filterColor(fragColor);\n}\n"}:{vs:"#define SHADER_NAME screen-grid-layer-vertex-shader-webgl1\n#define RANGE_COUNT 6\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform float maxWeight;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#define SHADER_NAME screen-grid-layer-fragment-shader-webgl1\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  gl_FragColor = picking_filterColor(gl_FragColor);\n}\n"};return e.modules=["picking"],e}},{key:"initializeState",value:function(){var e=this.getAttributeManager(),t=this.context.gl;e.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,transition:!0,accessor:["getPosition","getWeight"],update:this.calculateInstanceCounts,noAlloc:!0}});var n={id:"".concat(this.id,"-aggregator"),shaderCache:this.context.shaderCache},a=this._getMaxCountBuffer(t),i={color:{size:1,operation:M.a.SUM,needMax:!0,maxBuffer:a}};this.setState({model:this._getModel(t),gpuGridAggregator:new b.a(t,n),maxBuffer:a,weights:i}),this._setupUniformBuffer()}},{key:"shouldUpdateState",value:function(e){return e.changeFlags.somethingChanged}},{key:"updateState",value:function(e){Object(g.a)(Object(c.a)(t.prototype),"updateState",this).call(this,e),this._updateUniforms(e),e.changeFlags.dataChanged&&this._processData();var n=this._getAggregationChangeFlags(e);n&&this._updateAggregation(n)}},{key:"finalizeState",value:function(){Object(g.a)(Object(c.a)(t.prototype),"finalizeState",this).call(this);var e=this.state,n=e.aggregationBuffer,a=e.maxBuffer;e.gpuGridAggregator.delete(),n&&n.delete(),a&&a.delete()}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.gl,a=this.props.parameters,i=void 0===a?{}:a,r=this.props.minColor||j,o=this.props.maxColor||A,s=this.props.colorDomain||[1,0],l=this.state,u=l.model,c=l.maxBuffer,g=l.cellScale,d=l.shouldUseMinMax,h=l.colorRange,f=l.maxWeight,p={minColor:r,maxColor:o,cellScale:g,colorRange:h,colorDomain:s,shouldUseMinMax:d};Object(y.d)(n)?c.bind({target:35345}):p.maxWeight=f,t=Object.assign(p,t),u.draw({uniforms:t,parameters:Object.assign({depthTest:!1,depthMask:!1},i)}),Object(y.d)(n)&&c.unbind()}},{key:"calculateInstancePositions",value:function(e,t){for(var n=t.numInstances,a=this.context.viewport,i=a.width,r=a.height,o=this.props.cellSizePixels,s=this.state.numCol,l=e.value,u=e.size,c=0;c<n;c++){var g=c%s,d=Math.floor(c/s);l[c*u+0]=g*o/i*2-1,l[c*u+1]=1-d*o/r*2,l[c*u+2]=0}}},{key:"calculateInstanceCounts",value:function(e,t){t.numInstances;var n=this.state.aggregationBuffer;e.update({buffer:n})}},{key:"getPickingInfo",value:function(e){var t=e.info,n=(e.mode,t.index);if(n>=0){var a=this.state.gpuGridAggregator.getData("color");t.object=b.a.getAggregationData(Object.assign({pixelIndex:n},a))}return t}},{key:"_getAggregationChangeFlags",value:function(e){var t=e.oldProps,n=e.props,a=e.changeFlags,i=n.cellSizePixels!==t.cellSizePixels||n.cellMarginPixels!==t.cellMarginPixels,r=a.dataChanged||n.aggregation!==t.aggregation,o=a.viewportChanged;return i||r||o?{cellSizeChanged:i,dataChanged:r,viewportChanged:o}:null}},{key:"_getModel",value:function(e){return new w.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new C.a({drawMode:6,attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_getMaxCountBuffer",value:function(e){return new P.a(e,{byteLength:16,index:0,accessor:{size:4}})}},{key:"_processData",value:function(){var e=this.props,t=e.data,n=e.getPosition,a=e.getWeight,i=S(t),r=new Float64Array(2*i),o=new Float32Array(3*i),s=this.state.weights,l=Object(f.a)(t),u=l.iterable,c=l.objectInfo,g=!0,d=!1,h=void 0;try{for(var p,v=u[Symbol.iterator]();!(g=(p=v.next()).done);g=!0){var m=p.value;c.index++;var x=n(m,c),b=a(m,c),M=c.index;r[2*M]=x[0],r[2*M+1]=x[1],Array.isArray(b)?(o[3*M]=b[0],o[3*M+1]=b[1],o[3*M+2]=b[2]):o[3*M]=b}}catch(e){d=!0,h=e}finally{try{g||null==v.return||v.return()}finally{if(d)throw h}}s.color.values=o,this.setState({positions:r})}},{key:"_setupUniformBuffer",value:function(){var e=this.context.gl;if(Object(y.d)(e)){var t=this.state.model.program.handle,n=e.getUniformBlockIndex(t,"AggregationData");e.uniformBlockBinding(t,n,0)}}},{key:"_shouldUseMinMax",value:function(){var e=this.props,t=e.minColor,n=e.maxColor,a=e.colorDomain,i=e.colorRange;return t||n?(p.a.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!a&&!i}},{key:"_updateAggregation",value:function(e){var t=this.getAttributeManager();(e.cellSizeChanged||e.viewportChanged)&&(this._updateGridParams(),t.invalidateAll());var n=this.props,a=n.cellSizePixels,i=n.gpuAggregation,r=this.state,o=r.positions,s=r.weights,l=this.context.viewport;s.color.operation=M.a[this.props.aggregation.toUpperCase()]||M.a.SUM;var u=!1,c=null;this.context.viewport instanceof v.a?u=!0:(u=!1,c=l.pixelProjectionMatrix);var g=this.state.gpuGridAggregator.run({positions:o,weights:s,cellSize:[a,a],viewport:l,changeFlags:e,useGPU:i,projectPoints:u,gridTransformMatrix:c}),d=g.color.maxData&&Number.isFinite(g.color.maxData[0])?g.color.maxData[0]:0;this.setState({maxWeight:d}),t.invalidate("instanceCounts")}},{key:"_updateUniforms",value:function(e){var t=e.oldProps,n=e.props,a=e.changeFlags,i={};if(k.some((function(e){return t[e]!==n[e]}))&&(i.shouldUseMinMax=this._shouldUseMinMax()),t.colorRange!==n.colorRange&&(i.colorRange=Object(x.a)(n.colorRange,Float32Array,255)),t.cellMarginPixels!==n.cellMarginPixels||t.cellSizePixels!==n.cellSizePixels||a.viewportChanged){var r=this.context.viewport,o=r.width,s=r.height,l=this.props,u=l.cellSizePixels,c=l.cellMarginPixels,g=u>c?c:0;i.cellScale=new Float32Array([(u-g)/o*2,-(u-g)/s*2,1])}this.setState(i)}},{key:"_updateGridParams",value:function(){var e=this.context.viewport,t=e.width,n=e.height,a=this.props.cellSizePixels,i=this.context.gl,r=Math.ceil(t/a),o=Math.ceil(n/a),s=r*o,l=4*s*4,u=this.state.aggregationBuffer;u&&u.delete(),u=new P.a(i,{byteLength:l,accessor:{size:4,type:5126,divisor:1}}),this.state.weights.color.aggregationBuffer=u,this.setState({numCol:r,numRow:o,numInstances:s,aggregationBuffer:u})}}]),t}(m.a);O.layerName="ScreenGridLayer",O.defaultProps=_;var F=n(3),z=n(3698),D=n(3695),R=n(3694),T=n(3700),N=n(3701),E=n(3690);function B(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function U(){return(U=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e}).apply(this,arguments)}function I(e){return i.a.createElement("div",{className:"deckgl-tooltip"},i.a.createElement(N.a,{label:Object(F.t)("Longitude and Latitude")+": ",value:e.coordinate[0]+", "+e.coordinate[1]}),i.a.createElement(N.a,{label:Object(F.t)("Weight")+": ",value:""+e.object.weight}))}function L(e,t,n,a,i,r,o){const s=e,l=s.color_picker;let u=t.data.features.map(e=>U({},e,{color:[l.r,l.g,l.b,255*l.a]}));if(s.js_data_mutator){const e=Object(R.a)(s.js_data_mutator);u=e(u)}return null!=o&&o.forEach(e=>{u=u.filter(t=>e(t))}),new O(U({id:"screengrid-layer-"+s.slice_id,data:u,pickable:!0,cellSizePixels:s.grid_size,minColor:[l.r,l.g,l.b,0],maxColor:[l.r,l.g,l.b,255*l.a],outline:!1,getWeight:e=>e.weight||0},Object(T.a)(s,a,I)))}const q={formData:o.a.object.isRequired,payload:o.a.object.isRequired,setControlValue:o.a.func.isRequired,viewport:o.a.object.isRequired,onAddFilter:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired},G={onAddFilter(){}};class V extends i.a.PureComponent{constructor(e){super(e),B(this,"containerRef",i.a.createRef()),B(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=V.getDerivedStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(e,t){if(t&&e.payload.form_data===t.formData)return null;const n=e.payload.data.features||[],a=n.map(e=>e.__timestamp),i=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:r,end:o,getStep:s,values:l,disabled:u}=Object(D.a)(a,i),{width:c,height:g,formData:d}=e;let{viewport:h}=e;var f;return d.autozoom&&(h=Object(E.a)(h,{width:c,height:g,points:(f=n,f.map(e=>e.position))})),{start:r,end:o,getStep:s,values:l,disabled:u,viewport:h,selected:[],lastClick:0,formData:e.payload.form_data}}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getLayers(e){const t=[];return e[0]===e[1]||e[1]===this.end?t.push(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):t.push(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]),[L(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip)]}render(){const{formData:e,payload:t,setControlValue:n}=this.props;return i.a.createElement("div",null,i.a.createElement(z.a,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,width:this.props.width,height:this.props.height,mapboxApiAccessToken:t.data.mapboxApiKey,mapStyle:e.mapbox_style,setControlValue:n,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange}))}}V.propTypes=q,V.defaultProps=G;t.default=V}}]);