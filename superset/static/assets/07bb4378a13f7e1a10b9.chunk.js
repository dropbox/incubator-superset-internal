"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[704],{33738:(e,t,r)=>{r.r(t),r.d(t,{default:()=>f});var a=r(78580),l=r.n(a),n=r(67294),s=r(16355),u=r(5364),c=r(51115),i=r(67190),o=r(10581),h=r(63475),d=r(6915),p=r(11965);function f(e){let{height:t,width:r,echartOptions:a,setDataMask:f,labelMap:g,labelMapB:m,groupby:b,groupbyB:v,selectedValues:y,formData:w,emitCrossFilters:k,seriesBreakdown:F,onContextMenu:x,xValueFormatter:E,xAxis:I,refs:C,coltypeMapping:V}=e;const M=(0,n.useCallback)((e=>e<F),[F]),N=(0,n.useCallback)(((e,t)=>{const r=Object.values(y||{});let a;a=l()(r).call(r,e)?r.filter((t=>t!==e)):[e];const n=M(t)?b:v,s=M(t)?g:m,u=a.map((e=>null==s?void 0:s[e])).filter((e=>!!e));return{dataMask:{extraFormData:{filters:0===a.length?[]:[...n.map(((e,t)=>{const r=u.map((e=>e[t]));return null==r?{col:e,op:"IS NULL"}:{col:e,op:"IN",val:r}}))]},filterState:{value:u.length?u:null,selectedValues:a.length?a:null}},isCurrentValueSelected:l()(r).call(r,e)}}),[b,v,M,g,m,y]),O=(0,n.useCallback)(((e,t)=>{k&&f(N(e,t).dataMask)}),[k,f,N]),B={click:e=>{const{seriesName:t,seriesIndex:r}=e;O(t,r)},mouseout:()=>{d.aI.name=""},mouseover:e=>{d.aI.name=e.seriesName},contextmenu:async e=>{if(x){e.event.stop();const{data:t,seriesName:r,seriesIndex:a}=e,l=e.event.event,n=[],h=[],p=M(a),f=[...e.name?[e.name]:[],...(p?g:m)[e.seriesName]];t&&I.type===s.we.time&&n.push({col:I.label===u.W3?w.granularitySqla:I.label,grain:w.timeGrainSqla,op:"==",val:t[0],formattedVal:E(t[0])}),[...t&&I.type===s.we.category?[I.label]:[],...p?w.groupby:w.groupbyB].forEach(((e,t)=>n.push({col:e,op:"==",val:f[t],formattedVal:String(f[t])}))),[...p?w.groupby:w.groupbyB].forEach(((e,t)=>h.push({col:e,op:"==",val:f[t],formattedVal:(0,d.mj)(f[t],{timeFormatter:(0,c.bt)(w.dateFormat),numberFormatter:(0,i.JB)(w.numberFormat),coltype:null==V?void 0:V[(0,o.Z)(e)]})}))),x(l.clientX,l.clientY,{drillToDetail:n,crossFilter:N(r,a),drillBy:{filters:h,groupbyFieldName:p?"groupby":"groupby_b",adhocFilterFieldName:p?"adhoc_filters":"adhoc_filters_b"}})}}};return(0,p.tZ)(h.Z,{refs:C,height:t,width:r,echartOptions:a,eventHandlers:B,selectedValues:y})}},63475:(e,t,r)=>{r.d(t,{Z:()=>h});var a=r(78580),l=r.n(a),n=r(67294),s=r(51995),u=r(31431),c=r(11965);const i=s.iK.div`
  height: ${e=>{let{height:t}=e;return t}};
  width: ${e=>{let{width:t}=e;return t}};
`;function o(e,t){let{width:r,height:a,echartOptions:s,eventHandlers:o,zrEventHandlers:h,selectedValues:d={},refs:p}=e;const f=(0,n.useRef)(null);p&&(p.divRef=f);const g=(0,n.useRef)(),m=(0,n.useMemo)((()=>Object.keys(d)||[]),[d]),b=(0,n.useRef)([]);(0,n.useImperativeHandle)(t,(()=>({getEchartInstance:()=>g.current}))),(0,n.useEffect)((()=>{f.current&&(g.current||(g.current=(0,u.S1)(f.current)),Object.entries(o||{}).forEach((e=>{var t,r;let[a,l]=e;null==(t=g.current)||t.off(a),null==(r=g.current)||r.on(a,l)})),Object.entries(h||{}).forEach((e=>{var t,r;let[a,l]=e;null==(t=g.current)||t.getZr().off(a),null==(r=g.current)||r.getZr().on(a,l)})),g.current.setOption(s,!0))}),[s,o,h]),(0,n.useEffect)((()=>{g.current&&(g.current.dispatchAction({type:"downplay",dataIndex:b.current.filter((e=>!l()(m).call(m,e)))}),m.length&&g.current.dispatchAction({type:"highlight",dataIndex:m}),b.current=m)}),[m]);const v=(0,n.useCallback)((e=>{let{width:t,height:r}=e;g.current&&g.current.resize({width:t,height:r})}),[]);return(0,n.useEffect)((()=>(v({width:r,height:a}),()=>{var e;return null==(e=g.current)?void 0:e.dispose()})),[]),(0,n.useLayoutEffect)((()=>{v({width:r,height:a})}),[r,a,v]),(0,c.tZ)(i,{ref:f,height:a,width:r})}const h=(0,n.forwardRef)(o)}}]);
//# sourceMappingURL=07bb4378a13f7e1a10b9.chunk.js.map