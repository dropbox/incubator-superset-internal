(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[6579],{11409:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ADD_QUERY_EDITOR:()=>Z,CHANGE_DATA_PREVIEW_ID:()=>he,CLEAR_INACTIVE_QUERIES:()=>de,CLEAR_QUERY_RESULTS:()=>ue,CLONE_QUERY_TO_NEW_TAB:()=>w,COLLAPSE_TABLE:()=>M,COST_ESTIMATE_FAILED:()=>fe,COST_ESTIMATE_RETURNED:()=>ge,COST_ESTIMATE_STARTED:()=>me,CREATE_DATASOURCE_FAILED:()=>be,CREATE_DATASOURCE_STARTED:()=>ve,CREATE_DATASOURCE_SUCCESS:()=>_e,CtasEnum:()=>Ce,END_QUERY:()=>O,EXPAND_TABLE:()=>N,LOAD_QUERY_EDITOR:()=>X,MERGE_TABLE:()=>I,MIGRATE_QUERY:()=>K,MIGRATE_QUERY_EDITOR:()=>G,MIGRATE_TABLE:()=>Y,MIGRATE_TAB_HISTORY:()=>Q,QUERY_EDITOR_PERSIST_HEIGHT:()=>B,QUERY_EDITOR_SAVED:()=>x,QUERY_EDITOR_SETDB:()=>k,QUERY_EDITOR_SET_AUTORUN:()=>U,QUERY_EDITOR_SET_FUNCTION_NAMES:()=>H,QUERY_EDITOR_SET_QUERY_LIMIT:()=>q,QUERY_EDITOR_SET_SCHEMA:()=>P,QUERY_EDITOR_SET_SELECTED_TEXT:()=>j,QUERY_EDITOR_SET_SQL:()=>$,QUERY_EDITOR_SET_TEMPLATE_PARAMS:()=>V,QUERY_EDITOR_SET_TITLE:()=>F,QUERY_EDITOR_TOGGLE_LEFT_BAR:()=>z,QUERY_FAILED:()=>ce,QUERY_SUCCESS:()=>le,REFRESH_QUERIES:()=>ne,REMOVE_DATA_PREVIEW:()=>pe,REMOVE_QUERY:()=>L,REMOVE_QUERY_EDITOR:()=>R,REMOVE_TABLES:()=>D,REQUEST_QUERY_RESULTS:()=>se,RESET_STATE:()=>C,RUN_QUERY:()=>ae,SET_ACTIVE_QUERY_EDITOR:()=>J,SET_ACTIVE_SOUTHPANE_TAB:()=>te,SET_DATABASES:()=>W,SET_TABLES:()=>ee,SET_USER_OFFLINE:()=>re,START_QUERY:()=>oe,STOP_QUERY:()=>ie,UPDATE_QUERY_EDITOR:()=>A,addDangerToast:()=>Te,addInfoToast:()=>ye,addNewQueryEditor:()=>We,addQueryEditor:()=>Ke,addSavedQueryToTabState:()=>ht,addSuccessToast:()=>Ee,addTable:()=>Et,addWarningToast:()=>Se,changeDataPreviewId:()=>Ct,clearInactiveQueries:()=>Me,clearQueryResults:()=>$e,cloneQueryToNewTab:()=>Je,collapseTable:()=>xt,convertQueryToClient:()=>Re,convertQueryToServer:()=>we,createCtasDatasource:()=>$t,createDatasource:()=>Ut,createDatasourceFailed:()=>Ft,createDatasourceStarted:()=>kt,createDatasourceSuccess:()=>Pt,estimateQueryCost:()=>Ne,expandTable:()=>At,fetchQueryResults:()=>je,getUpToDateQuery:()=>Ie,loadQueryEditor:()=>et,mergeTable:()=>yt,migrateQueryEditorFromLocalStorage:()=>Ye,persistEditorHeight:()=>Dt,popDatasourceQuery:()=>Mt,popQuery:()=>Nt,popSavedQuery:()=>Lt,popStoredQuery:()=>Ot,postStopQuery:()=>Ge,queryEditorSetAndSaveSql:()=>ft,queryEditorSetAutorun:()=>dt,queryEditorSetDb:()=>lt,queryEditorSetQueryLimit:()=>vt,queryEditorSetSchema:()=>ct,queryEditorSetSelectedText:()=>bt,queryEditorSetSql:()=>gt,queryEditorSetTemplateParams:()=>_t,queryEditorSetTitle:()=>ut,queryFailed:()=>Fe,querySuccess:()=>Pe,reFetchQueryResults:()=>Zt,reRunQuery:()=>ze,refreshQueries:()=>Rt,removeAllOtherQueryEditors:()=>it,removeDataPreview:()=>qe,removeQuery:()=>st,removeQueryEditor:()=>ot,removeTables:()=>wt,requestQueryResults:()=>Ve,resetState:()=>De,runQuery:()=>He,runQueryFromSqlEditor:()=>Be,runTablePreviewQuery:()=>Tt,saveQuery:()=>pt,scheduleQuery:()=>Le,setActiveQueryEditor:()=>Xe,setActiveSouthPaneTab:()=>rt,setDatabases:()=>Qe,setTables:()=>tt,setUserOffline:()=>It,startQuery:()=>ke,stopQuery:()=>Ue,switchQueryEditor:()=>nt,syncTable:()=>St,toggleLeftBar:()=>at,updateQueryEditor:()=>Oe,updateSavedQuery:()=>mt});var r=n(78580),a=n.n(r),o=n(14670),i=n.n(o),s=n(15926),l=n.n(s),c=n(55867),d=n(31069),u=n(93185),p=n(63137),h=n.n(p),m=n(67523),g=n.n(m),f=n(44814),v=n(72570),_=n(98286),b=n(66785),y=n(3741),E=n(97381);const T=/^Untitled Query (\d+)$/,S="Untitled Query ",C="RESET_STATE",Z="ADD_QUERY_EDITOR",A="UPDATE_QUERY_EDITOR",x="QUERY_EDITOR_SAVED",w="CLONE_QUERY_TO_NEW_TAB",R="REMOVE_QUERY_EDITOR",I="MERGE_TABLE",D="REMOVE_TABLES",O="END_QUERY",L="REMOVE_QUERY",N="EXPAND_TABLE",M="COLLAPSE_TABLE",k="QUERY_EDITOR_SETDB",P="QUERY_EDITOR_SET_SCHEMA",F="QUERY_EDITOR_SET_TITLE",U="QUERY_EDITOR_SET_AUTORUN",$="QUERY_EDITOR_SET_SQL",q="QUERY_EDITOR_SET_QUERY_LIMIT",V="QUERY_EDITOR_SET_TEMPLATE_PARAMS",j="QUERY_EDITOR_SET_SELECTED_TEXT",H="QUERY_EDITOR_SET_FUNCTION_NAMES",B="QUERY_EDITOR_PERSIST_HEIGHT",z="QUERY_EDITOR_TOGGLE_LEFT_BAR",G="MIGRATE_QUERY_EDITOR",Q="MIGRATE_TAB_HISTORY",Y="MIGRATE_TABLE",K="MIGRATE_QUERY",W="SET_DATABASES",J="SET_ACTIVE_QUERY_EDITOR",X="LOAD_QUERY_EDITOR",ee="SET_TABLES",te="SET_ACTIVE_SOUTHPANE_TAB",ne="REFRESH_QUERIES",re="SET_USER_OFFLINE",ae="RUN_QUERY",oe="START_QUERY",ie="STOP_QUERY",se="REQUEST_QUERY_RESULTS",le="QUERY_SUCCESS",ce="QUERY_FAILED",de="CLEAR_INACTIVE_QUERIES",ue="CLEAR_QUERY_RESULTS",pe="REMOVE_DATA_PREVIEW",he="CHANGE_DATA_PREVIEW_ID",me="COST_ESTIMATE_STARTED",ge="COST_ESTIMATE_RETURNED",fe="COST_ESTIMATE_FAILED",ve="CREATE_DATASOURCE_STARTED",_e="CREATE_DATASOURCE_SUCCESS",be="CREATE_DATASOURCE_FAILED",ye=v.bM,Ee=v.ws,Te=v.Gb,Se=v.Dz,Ce={TABLE:"TABLE",VIEW:"VIEW"},Ze=(0,c.t)("The query couldn't be loaded"),Ae={id:"remoteId",db_id:"dbId",label:"name",template_parameters:"templateParams"},xe=e=>t=>g()(t,((t,n)=>n in e?e[n]:n)),we=xe(h()(Ae)),Re=xe(Ae);function Ie(e,t,n){const{sqlLab:{unsavedQueryEditor:r}}=e,a=null!=n?n:t.id;return{...t,...a===r.id&&r}}function De(){return{type:C}}function Oe(e){return{type:A,alterations:e}}function Le(e){return t=>d.Z.post({endpoint:"/savedqueryviewapi/api/create",postPayload:e,stringify:!1}).then((()=>t(Ee((0,c.t)("Your query has been scheduled. To see details of your query, navigate to Saved queries"))))).catch((()=>t(Te((0,c.t)("Your query could not be scheduled")))))}function Ne(e){return(t,n)=>{const{dbId:r,schema:a,sql:o,selectedText:i,templateParams:s}=Ie(n(),e),l={database_id:r,schema:a,sql:i||o,template_params:JSON.parse(s||"{}")};return Promise.all([t({type:me,query:e}),d.Z.post({endpoint:"/api/v1/sqllab/estimate/",body:JSON.stringify(l),headers:{"Content-Type":"application/json"}}).then((n=>{let{json:r}=n;return t({type:ge,query:e,json:r})})).catch((n=>(0,_.O$)(n).then((n=>{const r=n.error||n.statusText||(0,c.t)("Failed at retrieving results");return t({type:fe,query:e,error:r})}))))])}}function Me(e){return{type:de,interval:e}}function ke(e){return Object.assign(e,{id:e.id?e.id:i().generate(),progress:0,startDttm:(0,f.zO)(),state:e.runAsync?"pending":"running",cached:!1}),{type:oe,query:e}}function Pe(e,t){return function(n){var r;const a=null==t||null==(r=t.query)?void 0:r.sqlEditorId;return(a&&!e.isDataPreview&&(0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.put({endpoint:encodeURI(`/tabstateview/${a}`),postPayload:{latest_query_id:e.id}}):Promise.resolve()).then((()=>n({type:le,query:e,results:t}))).catch((()=>n(Te((0,c.t)("An error occurred while storing the latest query id in the backend. Please contact your administrator if this problem persists.")))))}}function Fe(e,t,n,r){return function(a){const o=!e.isDataPreview&&(0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.put({endpoint:encodeURI(`/tabstateview/${e.sqlEditorId}`),postPayload:{latest_query_id:e.id}}):Promise.resolve(),i={has_err:!0,start_offset:e.startDttm,ts:(new Date).getTime()};return null==r||r.forEach((e=>{var t;let{error_type:n,extra:r}=e;((null==r||null==(t=r.issue_codes)?void 0:t.map((e=>{let{message:t}=e;return t})))||[n]).forEach((e=>{a((0,E.logEvent)(y.Im,{...i,error_type:n,error_details:e}))}))})),o.catch((()=>a(Te((0,c.t)("An error occurred while storing the latest query id in the backend. Please contact your administrator if this problem persists."))))).then((()=>a({type:ce,query:e,msg:t,link:n,errors:r})))}}function Ue(e){return{type:ie,query:e}}function $e(e){return{type:ue,query:e}}function qe(e){return{type:pe,table:e}}function Ve(e){return{type:se,query:e}}function je(e,t){return function(n){n(Ve(e));const r=l().encode({key:e.resultsKey,rows:t||null});return d.Z.get({endpoint:`/api/v1/sqllab/results/?q=${r}`,parseMethod:"json-bigint"}).then((t=>{let{json:r}=t;return n(Pe(e,r))})).catch((t=>(0,_.O$)(t).then((t=>{const r=t.error||t.statusText||(0,c.t)("Failed at retrieving results");return n(Fe(e,r,t.link,t.errors))}))))}}function He(e){return function(t){t(ke(e));const n={client_id:e.id,database_id:e.dbId,json:!0,runAsync:e.runAsync,schema:e.schema,sql:e.sql,sql_editor_id:e.sqlEditorId,tab:e.tab,tmp_table_name:e.tempTable,select_as_cta:e.ctas,ctas_method:e.ctas_method,templateParams:e.templateParams,queryLimit:e.queryLimit,expand_data:!0},r=window.location.search||"";return d.Z.post({endpoint:`/api/v1/sqllab/execute/${r}`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"},parseMethod:"json-bigint"}).then((n=>{let{json:r}=n;e.runAsync||t(Pe(e,r))})).catch((n=>(0,_.O$)(n).then((n=>{let r=n.error||n.message||n.statusText||(0,c.t)("Unknown error");a()(r).call(r,"CSRF token")&&(r=(0,c.t)(b.Z.SESSION_TIMED_OUT)),t(Fe(e,r,n.link,n.errors))}))))}}function Be(e,t,n,r,a,o){return function(i,s){const l=Ie(s(),t,t.id);i(He({dbId:l.dbId,sql:l.selectedText||l.sql,sqlEditorId:l.id,tab:l.name,schema:l.schema,tempTable:r,templateParams:l.templateParams,queryLimit:l.queryLimit||n,runAsync:!!e&&e.allow_run_async,ctas:a,ctas_method:o,updateTabState:!l.selectedText}))}}function ze(e){return function(t){t(He({...e,id:i().generate()}))}}function Ge(e){return function(t){return d.Z.post({endpoint:"/api/v1/query/stop",body:JSON.stringify({client_id:e.id}),headers:{"Content-Type":"application/json"}}).then((()=>t(Ue(e)))).then((()=>t(Ee((0,c.t)("Query was stopped."))))).catch((()=>t(Te((0,c.t)("Failed at stopping query. %s",e.id)))))}}function Qe(e){return{type:W,databases:e}}function Ye(e,t,n){return function(r){return d.Z.post({endpoint:"/tabstateview/",postPayload:{queryEditor:e}}).then((a=>{let{json:o}=a;const i={...e,id:o.id.toString()};return r({type:G,oldQueryEditor:e,newQueryEditor:i}),r({type:Q,oldId:e.id,newId:i.id}),Promise.all([...t.map((e=>function(e,t,n){return d.Z.post({endpoint:encodeURI("/tableschemaview/"),postPayload:{table:{...e,queryEditorId:t}}}).then((r=>{let{json:a}=r;const o={...e,id:a.id,queryEditorId:t};return n({type:Y,oldTable:e,newTable:o})})).catch((()=>n(Se((0,c.t)("Unable to migrate table schema state to backend. Superset will retry later. Please contact your administrator if this problem persists.")))))}(e,i.id,r))),...n.map((e=>function(e,t,n){return d.Z.post({endpoint:encodeURI(`/tabstateview/${t}/migrate_query`),postPayload:{queryId:e}}).then((()=>n({type:K,queryId:e,queryEditorId:t}))).catch((()=>n(Se((0,c.t)("Unable to migrate query state to backend. Superset will retry later. Please contact your administrator if this problem persists.")))))}(e.id,i.id,r)))])})).catch((()=>r(Se((0,c.t)("Unable to migrate query editor state to backend. Superset will retry later. Please contact your administrator if this problem persists.")))))}}function Ke(e){return function(t){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.post({endpoint:"/tabstateview/",postPayload:{queryEditor:e}}):Promise.resolve({json:{id:i().generate()}})).then((n=>{let{json:r}=n;const a={...e,id:r.id.toString()};return t({type:Z,queryEditor:a})})).catch((()=>t(Te((0,c.t)("Unable to add a new tab to the backend. Please contact your administrator.")))))}}function We(){return function(e,t){const{sqlLab:{queryEditors:n,tabHistory:r,unsavedQueryEditor:a,defaultDbId:o,databases:i},common:s}=t(),l=n.find((e=>e.id===r[r.length-1])),d=Object.values(i).map((e=>e.id)),p=d.length>0?Math.min(...d):void 0,{dbId:h,schema:m,queryLimit:g,autorun:f}={...n[0],...l,...a.id===(null==l?void 0:l.id)&&a},v=(0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?"":(0,c.t)("-- Note: Unless you save your query, these tabs will NOT persist if you clear your cookies or change browsers.\n\n"),_=function(e,t){void 0===t&&(t="Untitled Query 1");const n=(0,c.t)(t);if(e.length>0){const t=e.filter((e=>{var t;return null==(t=e.name)?void 0:t.match(T)})).map((e=>+e.name.replace(S,"")));if(t.length>0){const e=Math.max(...t);return(0,c.t)("%s%s",S,e+1)}return n}return n}(n||[]);return e(Ke({dbId:h||o||p,schema:null!=m?m:null,autorun:null!=f&&f,sql:`${v}SELECT ...`,queryLimit:g||s.conf.DEFAULT_SQLLAB_LIMIT,name:_}))}}function Je(e,t){return function(n,r){const a=r(),{queryEditors:o,tabHistory:i}=a.sqlLab,s=o.find((e=>e.id===i[i.length-1]));return n(Ke({name:(0,c.t)("Copy of %s",s.name),dbId:e.dbId?e.dbId:null,schema:e.schema?e.schema:null,autorun:t,sql:e.sql,queryLimit:s.queryLimit,maxRow:s.maxRow,templateParams:s.templateParams}))}}function Xe(e){return function(t){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.post({endpoint:encodeURI(`/tabstateview/${e.id}/activate`)}):Promise.resolve()).then((()=>t({type:J,queryEditor:e}))).catch((n=>404!==n.status?t(Te((0,c.t)("An error occurred while setting the active tab. Please contact your administrator."))):t({type:R,queryEditor:e})))}}function et(e){return{type:X,queryEditor:e}}function tt(e){const t=e.filter((e=>null!==e.description)).map((e=>{const{columns:t,selectStar:n,primaryKey:r,foreignKeys:a,indexes:o,dataPreviewQueryId:i}=e.description;return{dbId:e.database_id,queryEditorId:e.tab_state_id.toString(),schema:e.schema,name:e.table,expanded:e.expanded,id:e.id,dataPreviewQueryId:i,columns:t,selectStar:n,primaryKey:r,foreignKeys:a,indexes:o,isMetadataLoading:!1,isExtraMetadataLoading:!1}}));return{type:ee,tables:t}}function nt(e,t){return function(n){(0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)&&e&&!e.loaded?d.Z.get({endpoint:encodeURI(`/tabstateview/${e.id}`)}).then((e=>{var r,a;let{json:o}=e;const i={id:o.id.toString(),loaded:!0,name:o.label,sql:o.sql,selectedText:null,latestQueryId:null==(r=o.latest_query)?void 0:r.id,autorun:o.autorun,dbId:o.database_id,templateParams:o.template_params,schema:o.schema,queryLimit:o.query_limit,remoteId:null==(a=o.saved_query)?void 0:a.id,validationResult:{id:null,errors:[],completed:!1},hideLeftBar:o.hide_left_bar};n(et(i)),n(tt(o.table_schemas||[])),n(Xe(i)),o.latest_query&&o.latest_query.resultsKey&&n(je(o.latest_query,t))})).catch((t=>404!==t.status?n(Te((0,c.t)("An error occurred while fetching tab state"))):n({type:R,queryEditor:e}))):n(Xe(e))}}function rt(e){return{type:te,tabId:e}}function at(e){const t=!e.hideLeftBar;return function(n){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{hide_left_bar:t}}):Promise.resolve()).then((()=>n({type:z,queryEditor:e,hideLeftBar:t}))).catch((()=>n(Te((0,c.t)("An error occurred while hiding the left bar. Please contact your administrator.")))))}}function ot(e){return function(t){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.delete({endpoint:encodeURI(`/tabstateview/${e.id}`)}):Promise.resolve()).then((()=>t({type:R,queryEditor:e}))).catch((()=>t(Te((0,c.t)("An error occurred while removing tab. Please contact your administrator.")))))}}function it(e){return function(t,n){var r;const{sqlLab:a}=n();null==(r=a.queryEditors)||r.forEach((n=>{n.id!==e.id&&t(ot(n))}))}}function st(e){return function(t){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.delete({endpoint:encodeURI(`/tabstateview/${e.sqlEditorId}/query/${e.id}`)}):Promise.resolve()).then((()=>t({type:L,query:e}))).catch((()=>t(Te((0,c.t)("An error occurred while removing query. Please contact your administrator.")))))}}function lt(e,t){return function(n){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{database_id:t}}):Promise.resolve()).then((()=>n({type:k,queryEditor:e,dbId:t}))).catch((()=>n(Te((0,c.t)("An error occurred while setting the tab database ID. Please contact your administrator.")))))}}function ct(e,t){return function(n){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)&&"object"==typeof e?d.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{schema:t}}):Promise.resolve()).then((()=>n({type:P,queryEditor:e||{},schema:t}))).catch((()=>n(Te((0,c.t)("An error occurred while setting the tab schema. Please contact your administrator.")))))}}function dt(e,t){return function(n){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{autorun:t}}):Promise.resolve()).then((()=>n({type:U,queryEditor:e,autorun:t}))).catch((()=>n(Te((0,c.t)("An error occurred while setting the tab autorun. Please contact your administrator.")))))}}function ut(e,t,n){return function(r){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.put({endpoint:encodeURI(`/tabstateview/${n}`),postPayload:{label:t}}):Promise.resolve()).then((()=>r({type:F,queryEditor:{...e,id:n},name:t}))).catch((()=>r(Te((0,c.t)("An error occurred while setting the tab name. Please contact your administrator.")))))}}function pt(e,t){const{id:n,...r}=we(e);return n=>d.Z.post({endpoint:"/api/v1/saved_query/",jsonPayload:we(r)}).then((r=>{const a=Re({id:r.json.id,...r.json.result});return n({type:x,query:e,clientId:t,result:a}),n(ut(e,e.name,t)),a})).catch((()=>n(Te((0,c.t)("Your query could not be saved")))))}const ht=(e,t)=>n=>((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.put({endpoint:`/tabstateview/${e.id}`,postPayload:{saved_query_id:t.remoteId}}):Promise.resolve()).catch((()=>{n(Te((0,c.t)("Your query was not properly saved")))})).then((()=>{n(Ee((0,c.t)("Your query was saved")))}));function mt(e,t){const{id:n,...r}=we(e);return n=>d.Z.put({endpoint:`/api/v1/saved_query/${e.remoteId}`,jsonPayload:we(r)}).then((()=>{n(Ee((0,c.t)("Your query was updated"))),n(ut(e,e.name,t))})).catch((e=>{const t=(0,c.t)("Your query could not be updated");console.error(t,e),n(Te(t))})).then((()=>n(Oe(e))))}function gt(e,t){return{type:$,queryEditor:e,sql:t}}function ft(e,t){return function(n,r){const a=Ie(r(),e);return n(gt(a,t)),(0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.put({endpoint:encodeURI(`/tabstateview/${a.id}`),postPayload:{sql:t,latest_query_id:a.latestQueryId}}).catch((()=>n(Te((0,c.t)('An error occurred while storing your query in the backend. To avoid losing your changes, please save your query using the "Save Query" button.'))))):Promise.resolve()}}function vt(e,t){return function(n){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{query_limit:t}}):Promise.resolve()).then((()=>n({type:q,queryEditor:e,queryLimit:t}))).catch((()=>n(Te((0,c.t)("An error occurred while setting the tab name. Please contact your administrator.")))))}}function _t(e,t){return function(n){return n({type:V,queryEditor:e,templateParams:t}),((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.put({endpoint:encodeURI(`/tabstateview/${e.id}`),postPayload:{template_params:t}}):Promise.resolve()).catch((()=>n(Te((0,c.t)("An error occurred while setting the tab template parameters. Please contact your administrator.")))))}}function bt(e,t){return{type:j,queryEditor:e,sql:t}}function yt(e,t,n){return{type:I,table:e,query:t,prepend:n}}function Et(e,t,n){return function(r,a){const o=Ie(a(),e,e.id);r(yt({dbId:o.dbId,queryEditorId:o.id,schema:n,name:t,id:i().generate(),expanded:!0},null,!0))}}function Tt(e){return function(t,n){const{sqlLab:{databases:r}}=n(),a=r[e.dbId],{dbId:o}=e;if(a&&!a.disable_data_preview){const n={id:i().generate(),dbId:o,sql:e.selectStar,tableName:e.name,sqlEditorId:null,tab:"",runAsync:a.allow_run_async,ctas:!1,isDataPreview:!0};return Promise.all([t(yt({id:e.id,dbId:e.dbId,schema:e.schema,name:e.name,queryEditorId:e.queryEditorId,dataPreviewQueryId:n.id},n)),t(He(n))])}return Promise.resolve()}}function St(e,t){return function(n){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.post({endpoint:encodeURI("/tableschemaview/"),postPayload:{table:{...t,...e}}}):Promise.resolve({json:{id:e.id}})).then((r=>{let{json:a}=r;const o={...e,id:a.id};n(yt({...o,expanded:!0,initialized:!0})),e.dataPreviewQueryId||n(Tt({...t,...o}))})).catch((()=>n(Te((0,c.t)("An error occurred while fetching table metadata. Please contact your administrator.")))))}}function Ct(e,t){return{type:he,oldQueryId:e,newQuery:t}}function Zt(e){return function(t){const n={id:i().generate(),dbId:e.dbId,sql:e.sql,tableName:e.tableName,sqlEditorId:null,tab:"",runAsync:!1,ctas:!1,queryLimit:e.queryLimit,isDataPreview:e.isDataPreview};t(He(n)),t(Ct(e.id,n))}}function At(e){return function(t){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.post({endpoint:encodeURI(`/tableschemaview/${e.id}/expanded`),postPayload:{expanded:!0}}):Promise.resolve()).then((()=>t({type:N,table:e}))).catch((()=>t(Te((0,c.t)("An error occurred while expanding the table schema. Please contact your administrator.")))))}}function xt(e){return function(t){return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?d.Z.post({endpoint:encodeURI(`/tableschemaview/${e.id}/expanded`),postPayload:{expanded:!1}}):Promise.resolve()).then((()=>t({type:M,table:e}))).catch((()=>t(Te((0,c.t)("An error occurred while collapsing the table schema. Please contact your administrator.")))))}}function wt(e){return function(t){var n;const r=null!=(n=null==e?void 0:e.filter(Boolean))?n:[];return((0,u.cr)(u.TT.SQLLAB_BACKEND_PERSISTENCE)?Promise.all(r.map((e=>d.Z.delete({endpoint:encodeURI(`/tableschemaview/${e.id}`)})))):Promise.resolve()).then((()=>t({type:D,tables:r}))).catch((()=>t(Te((0,c.t)("An error occurred while removing the table schema. Please contact your administrator.")))))}}function Rt(e){return{type:ne,alteredQueries:e}}function It(e){return{type:re,offline:e}}function Dt(e,t,n){return{type:B,queryEditor:e,northPercent:t,southPercent:n}}function Ot(e){return function(t){return d.Z.get({endpoint:`/kv/${e}`}).then((e=>{let{json:n}=e;return t(Ke({name:n.name?n.name:(0,c.t)("Shared query"),dbId:n.dbId?parseInt(n.dbId,10):null,schema:n.schema?n.schema:null,autorun:!!n.autorun&&n.autorun,sql:n.sql?n.sql:"SELECT ...",templateParams:n.templateParams}))})).catch((()=>t(Te(Ze))))}}function Lt(e){return function(t){return d.Z.get({endpoint:`/savedqueryviewapi/api/get/${e}`}).then((e=>{let{json:n}=e;const r={...Re(n.result),loaded:!0,autorun:!1};return t(Ke(r))})).catch((()=>t(Te(Ze))))}}function Nt(e){return function(t){return d.Z.get({endpoint:`/api/v1/query/${e}`}).then((e=>{let{json:n}=e;const r=n.result,a={dbId:r.database.id,schema:r.schema,sql:r.sql,name:(0,c.t)("Copy of %s",r.tab_name),autorun:!1};return t(Ke(a))})).catch((()=>t(Te(Ze))))}}function Mt(e,t){return function(n){const r=(0,c.t)("Query"),a=e.split("__")[0];return d.Z.get({endpoint:`/api/v1/dataset/${a}?q=(keys:!(none))`}).then((e=>{let{json:a}=e;return n(Ke({name:`${r} ${a.result.name}`,dbId:a.result.database.id,schema:a.result.schema,autorun:void 0!==t,sql:t||a.result.select_star}))})).catch((()=>n(Te((0,c.t)("The datasource couldn't be loaded")))))}}function kt(){return{type:ve}}function Pt(e){const t=`${e.id}__table`;return{type:_e,datasource:t}}function Ft(e){return{type:be,err:e}}function Ut(e){return t=>{t(kt());const{dbId:n,schema:r,datasourceName:a,sql:o}=e;return d.Z.post({endpoint:"/api/v1/dataset/",headers:{"Content-Type":"application/json"},body:JSON.stringify({database:n,schema:r,sql:o,table_name:a,is_managed_externally:!1,external_url:null})}).then((e=>{let{json:n}=e;return t(Pt(n)),Promise.resolve(n)})).catch((e=>((0,_.O$)(e).then((e=>{t(Te(e.error))})),t(Ft((0,c.t)("An error occurred while creating the data source"))),Promise.reject())))}}function $t(e){return t=>(t(kt()),d.Z.post({endpoint:"/api/v1/dataset/get_or_create/",jsonPayload:e}).then((e=>{let{json:n}=e;return t(Pt(n.result)),n.result})).catch((()=>{const e=(0,c.t)("An error occurred while creating the data source");return t(Ft(e)),Promise.reject(new Error(e))})))}},52256:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ADD_CHART:()=>ee,ANNOTATION_QUERY_FAILED:()=>$,ANNOTATION_QUERY_STARTED:()=>F,ANNOTATION_QUERY_SUCCESS:()=>k,CHART_RENDERING_FAILED:()=>I,CHART_RENDERING_SUCCEEDED:()=>O,CHART_UPDATE_FAILED:()=>w,CHART_UPDATE_STARTED:()=>T,CHART_UPDATE_STOPPED:()=>A,CHART_UPDATE_SUCCEEDED:()=>C,DYNAMIC_PLUGIN_CONTROLS_READY:()=>V,GET_SAVED_CHART:()=>re,POST_CHART_FORM_DATA:()=>oe,REMOVE_CHART:()=>N,RENDER_TRIGGERED:()=>Q,TRIGGER_QUERY:()=>z,UPDATE_CHART_ID:()=>J,UPDATE_QUERY_FORM_DATA:()=>K,addChart:()=>te,annotationQueryFailed:()=>q,annotationQueryStarted:()=>U,annotationQuerySuccess:()=>P,chartRenderingFailed:()=>D,chartRenderingSucceeded:()=>L,chartUpdateFailed:()=>R,chartUpdateStarted:()=>S,chartUpdateStopped:()=>x,chartUpdateSucceeded:()=>Z,dynamicPluginControlsReady:()=>j,exploreJSON:()=>ne,getChartDataRequest:()=>H,getDatasourceSamples:()=>ce,getSavedChart:()=>ae,postChartFormData:()=>ie,redirectSQLLab:()=>se,refreshChart:()=>le,removeChart:()=>M,renderTriggered:()=>Y,runAnnotationQuery:()=>B,triggerQuery:()=>G,updateChartId:()=>X,updateQueryFormData:()=>W});var r=n(78580),a=n.n(r),o=n(30381),i=n.n(o),s=n(93185),l=n(31069),c=n(55867),d=n(37731),u=n(35854),p=n(12515),h=n(10945),m=n(72570),g=n(97381),f=n(3741),v=n(98286),_=n(9679),b=n(86374),y=n(74599),E=n(77997);const T="CHART_UPDATE_STARTED";function S(e,t,n){return{type:T,queryController:e,latestQueryFormData:t,key:n}}const C="CHART_UPDATE_SUCCEEDED";function Z(e,t){return{type:C,queriesResponse:e,key:t}}const A="CHART_UPDATE_STOPPED";function x(e){return{type:A,key:e}}const w="CHART_UPDATE_FAILED";function R(e,t){return{type:w,queriesResponse:e,key:t}}const I="CHART_RENDERING_FAILED";function D(e,t,n){return{type:I,error:e,key:t,stackTrace:n}}const O="CHART_RENDERING_SUCCEEDED";function L(e){return{type:O,key:e}}const N="REMOVE_CHART";function M(e){return{type:N,key:e}}const k="ANNOTATION_QUERY_SUCCESS";function P(e,t,n){return{type:k,annotation:e,queryResponse:t,key:n}}const F="ANNOTATION_QUERY_STARTED";function U(e,t,n){return{type:F,annotation:e,queryController:t,key:n}}const $="ANNOTATION_QUERY_FAILED";function q(e,t,n){return{type:$,annotation:e,queryResponse:t,key:n}}const V="DYNAMIC_PLUGIN_CONTROLS_READY",j=()=>(e,t)=>{const n=t(),r=(0,u.R3)(n.explore,n.explore.form_data);e({type:V,key:r.slice_id.value,controlsState:r})};async function H(e){let{formData:t,setDataMask:n=(()=>{}),resultFormat:r="json",resultType:a="full",force:o=!1,method:i="POST",requestParams:c={},ownState:d={}}=e,u={...c};b._&&(u={...u,mode:"cors",credentials:"include"});const[h,m]=(0,p.hz)(t);return h?async function(e,t,n,r,a,o,i){var c;void 0===a&&(a="POST"),void 0===o&&(o={});const d=(0,p.pd)({resultFormat:t,resultType:n}),u=b._&&(null==(c=o)?void 0:c.dashboard_id),h=(0,p.H6)({formData:e,endpointType:d,force:r,allowDomainSharding:u,method:a,requestParams:o.dashboard_id?{dashboard_id:o.dashboard_id}:{}}),m={...o,url:h,postPayload:{form_data:e},parseMethod:i};return((0,s.cr)(s.TT.CLIENT_CACHE)?l.Z.get:l.Z.post)(m).then((e=>{let{json:t,response:n}=e;return{response:n,json:{result:[t]}}}))}(t,r,a,o,i,u,m):(async(e,t,n,r,a,o,i,s)=>{const c=(0,p.u)({formData:e,resultType:n,resultFormat:t,force:r,setDataMask:o,ownState:i}),{slice_id:d}=e,{dashboard_id:u}=a,h={};void 0!==d&&(h.form_data=`{"slice_id":${d}}`),void 0!==u&&(h.dashboard_id=u),!1!==r&&(h.force=r);const m=b._&&(null==a?void 0:a.dashboard_id),g=(0,p.kN)({path:"/api/v1/chart/data",qs:h,allowDomainSharding:m}).toString(),f={...a,url:g,headers:{"Content-Type":"application/json"},body:JSON.stringify(c),parseMethod:s};return l.Z.post(f)})(t,r,a,o,u,n,d,m)}function B(e){let{annotation:t,timeout:n=60,formData:r=null,key:o,isDashboardRequest:i=!1,force:s=!1}=e;return function(e,c){var d;const u=o||Object.keys(c().charts)[0],m={...r||c().charts[u].latestQueryFormData};if(!(0,h.m7)(t.sourceType))return Promise.resolve();const g=m.time_grain_sqla||m.granularity;m.time_grain_sqla=g,m.granularity=g;const f=Object.keys(t.overrides);(a()(f).call(f,"since")||a()(f).call(f,"until"))&&(t.overrides={...t.overrides,time_range:null});const _=Object.keys(t.overrides).reduce(((e,n)=>({...e,[n]:t.overrides[n]||m[n]})),{});if(!i&&m){const e=m.extra_filters&&m.extra_filters.length>0;_.extra_filters=e?m.extra_filters:void 0}const b=(0,p.xW)(t.value,s),y=new AbortController,{signal:E}=y;e(U(t,y,u));const T=null==m||null==(d=m.annotation_layers)?void 0:d.findIndex((e=>e.name===t.name));return T>=0&&(m.annotation_layers[T].overrides=_),l.Z.post({url:b,signal:E,timeout:1e3*n,headers:{"Content-Type":"application/json"},jsonPayload:(0,p.u)({formData:m,force:s,resultFormat:"json",resultType:"full"})}).then((n=>{var r,a,o;let{json:i}=n;const s=null==i||null==(r=i.result)||null==(a=r[0])||null==(o=a.annotation_data)?void 0:o[t.name];return e(P(t,{data:s},u))})).catch((n=>(0,v.O$)(n).then((n=>{var r;"timeout"===n.statusText?e(q(t,{error:"Query timeout"},u)):a()(r=(n.error||"").toLowerCase()).call(r,"no data")?e(P(t,n,u)):"abort"!==n.statusText&&e(q(t,n,u))}))))}}const z="TRIGGER_QUERY";function G(e,t){return void 0===e&&(e=!0),{type:z,value:e,key:t}}const Q="RENDER_TRIGGERED";function Y(e,t){return{type:Q,value:e,key:t}}const K="UPDATE_QUERY_FORM_DATA";function W(e,t){return{type:K,value:e,key:t}}const J="UPDATE_CHART_ID";function X(e,t){return void 0===t&&(t=0),{type:J,newId:e,key:t}}const ee="ADD_CHART";function te(e,t){return{type:ee,chart:e,key:t}}function ne(e,t,n,r,a,o,l){return void 0===t&&(t=!1),void 0===n&&(n=60),async c=>{const d=f.Yd.getTimestamp(),u=new AbortController,h={signal:u.signal,timeout:1e3*n};o&&(h.dashboard_id=o);const m=H({setDataMask:t=>{c((0,y.eG)(e.slice_id,t))},formData:e,resultFormat:"json",resultType:"full",force:t,method:a,requestParams:h,ownState:l});c(S(u,e,r));const _=m.then((t=>{let{response:n,json:r}=t;if((0,s.cr)(s.TT.GLOBAL_ASYNC_QUERIES)){const t="result"in r?r.result:r,[a]=(0,p.hz)(e);switch(n.status){case 200:return Promise.resolve(t);case 202:return a?(0,E.YJ)(t[0]):(0,E.YJ)(t);default:throw new Error(`Received unexpected response status (${n.status}) while fetching chart data`)}}return r.result})).then((n=>(n.forEach((n=>c((0,g.logEvent)(f.W9,{slice_id:r,applied_filters:n.applied_filters,is_cached:n.is_cached,force_refresh:t,row_count:n.rowcount,datasource:e.datasource,start_offset:d,ts:(new Date).getTime(),duration:f.Yd.getTimestamp()-d,has_extra_filters:e.extra_filters&&e.extra_filters.length>0,viz_type:e.viz_type,data_age:n.is_cached?i()(new Date).diff(i().utc(n.cached_dttm)):null})))),c(Z(n,r))))).catch((t=>{if((0,s.cr)(s.TT.GLOBAL_ASYNC_QUERIES))return c(R([t],r));const n=(t,n)=>{c((0,g.logEvent)(f.W9,{slice_id:r,has_err:!0,is_cached:n,error_details:t,datasource:e.datasource,start_offset:d,ts:(new Date).getTime(),duration:f.Yd.getTimestamp()-d}))};return"AbortError"===t.name?(n("abort"),c(x(r))):(0,v.O$)(t).then((e=>("timeout"===t.statusText?n("timeout"):n(e.error,e.is_cached),c(R([e],r)))))})),[b]=(0,p.hz)(e),T=b&&e.annotation_layers||[],C=o>0;return Promise.all([_,c(G(!1,r)),c(W(e,r)),...T.map((a=>c(B({annotation:a,timeout:n,formData:e,key:r,isDashboardRequest:C,force:t}))))])}}const re="GET_SAVED_CHART";function ae(e,t,n,r,a,o){return void 0===t&&(t=!1),void 0===n&&(n=60),ne(e,t,n,r,"GET",a,o)}const oe="POST_CHART_FORM_DATA";function ie(e,t,n,r,a,o){return void 0===t&&(t=!1),void 0===n&&(n=60),ne(e,t,n,r,"POST",a,o)}function se(e){return t=>{H({formData:e,resultFormat:"json",resultType:"query"}).then((t=>{let{json:n}=t;const r={datasourceKey:e.datasource,sql:n.result[0].query};l.Z.postForm("/superset/sqllab/",{form_data:(0,_.o)(r)})})).catch((()=>t((0,m.Gb)((0,c.t)("An error occurred while loading the SQL")))))}}function le(e,t,n){return(r,a)=>{var o;const i=(a().charts||{})[e],s=a().dashboardInfo.common.conf.SUPERSET_WEBSERVER_TIMEOUT;i.latestQueryFormData&&0!==Object.keys(i.latestQueryFormData).length&&r(ie(i.latestQueryFormData,t,s,i.id,n,null==(o=a().dataMask[i.id])?void 0:o.ownState))}}const ce=async(e,t,n,r,a,o)=>{try{const i={force:n,datasource_type:e,datasource_id:t};return(0,d.Z)(a)&&(0,d.Z)(o)&&(i.per_page=a,i.page=o),(await l.Z.post({endpoint:"/datasource/samples",jsonPayload:r,searchParams:i})).json.result}catch(e){const t=await(0,v.O$)(e);throw new Error(t.message||t.error||(0,c.t)("Sorry, an error occurred"),{cause:e})}}},57902:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(67294),a=n(45697),o=n.n(a),i=n(55867),s=n(72875),l=n(11965);const c={children:o().node.isRequired,onError:o().func,showMessage:o().bool};class d extends r.Component{constructor(e){super(e),this.state={error:null,info:null}}componentDidCatch(e,t){this.props.onError&&this.props.onError(e,t),this.setState({error:e,info:t})}render(){const{error:e,info:t}=this.state;if(e){const n=e.toString(),r=(0,l.tZ)("span",null,(0,l.tZ)("strong",null,(0,i.t)("Unexpected error")),n?`: ${n}`:"");return this.props.showMessage?(0,l.tZ)(s.Z,{subtitle:r,copyText:r,stackTrace:t?t.componentStack:null}):null}return this.props.children}}d.propTypes=c,d.defaultProps={onError:()=>{},showMessage:!0}},81395:(e,t,n)=>{"use strict";n.d(t,{KJ:()=>s,M6:()=>u,P_:()=>g,cK:()=>f,fK:()=>i,ib:()=>m,ku:()=>c,l3:()=>l,l6:()=>v,oT:()=>p,oW:()=>d,yz:()=>h});var r=n(78580),a=n.n(r);function o(e,t){var n;return a()(n=e().dashboardState.sliceIds).call(n,t)}const i="ADD_FILTER";function s(e,t,n){return(r,a)=>o(a,e)?r({type:i,chartId:e,component:t,form_data:n}):a().dashboardFilters}const l="REMOVE_FILTER";function c(e){return(t,n)=>o(n,e)?t({type:l,chartId:e}):n().dashboardFilters}const d="CHANGE_FILTER";function u(e,t,n){return(r,a)=>{if(o(a,e)){const o=a().dashboardLayout.present;return r({type:d,chartId:e,newSelectedValues:t,merge:n,components:o})}return a().dashboardFilters}}const p="UPDATE_DIRECT_PATH_TO_FILTER";function h(e,t){return(n,r)=>o(r,e)?n({type:p,chartId:e,path:t}):r().dashboardFilters}const m="UPDATE_LAYOUT_COMPONENTS";function g(e){return t=>{t({type:m,components:e})}}const f="UPDATE_DASHBOARD_FILTERS_SCOPE";function v(e){return t=>{t({type:f,scopes:e})}}},12885:(e,t,n)=>{"use strict";n.d(t,{J0:()=>y,YA:()=>T,bK:()=>f,CB:()=>_,Mu:()=>C,L1:()=>I,aZ:()=>w,qL:()=>A,nj:()=>p,x_:()=>N,LM:()=>E,Ww:()=>v,v7:()=>b,g3:()=>Z,_p:()=>D,az:()=>L,iO:()=>x,Ou:()=>O,WZ:()=>m,A7:()=>g});var r=n(21090),a=n(55867),o=n(72570),i=n(81255),s=n(80621),l=n(47456),c=n(95173),d=n(81395),u=n(9467);const p="UPDATE_COMPONENTS";function h(e){return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return(t,r)=>{const a=e(...n);t("function"==typeof a?a(t,r):a);const{dashboardLayout:o,dashboardState:i}=r();if(a.type!==p||!a.payload||!a.payload.nextComponents){const e=o.present;t((0,d.P_)(e))}i.hasUnsavedChanges||t((0,u.if)(!0))}}}const m=h((e=>({type:p,payload:{nextComponents:e}})));function g(e){return(t,n)=>{const{dashboardLayout:r}=n();t(m({[s.M2]:{...r.present[s.M2],meta:{text:e}}}))}}const f="DASHBOARD_TITLE_CHANGED";function v(e){return{type:f,text:e}}const _="DELETE_COMPONENT",b=h(((e,t)=>({type:_,payload:{id:e,parentId:t}}))),y="CREATE_COMPONENT",E=h((e=>({type:y,payload:{dropResult:e}}))),T="CREATE_TOP_LEVEL_TABS",S=h((e=>({type:T,payload:{dropResult:e}}))),C="DELETE_TOP_LEVEL_TABS",Z=h((()=>({type:C,payload:{}}))),A="RESIZE_COMPONENT";function x(e){let{id:t,width:n,height:r}=e;return(e,a)=>{const{dashboardLayout:o}=a(),{present:i}=o,s=i[t],l=n&&s.meta.width!==n,c=r&&s.meta.height!==r;if(s&&(l||c)){const a={[t]:{...s,meta:{...s.meta,width:n||s.meta.width,height:r||s.meta.height}}};e(m(a))}}}const w="MOVE_COMPONENT",R=h((e=>({type:w,payload:{dropResult:e}}))),I="HANDLE_COMPONENT_DROP";function D(e){return(t,n)=>{const r=function(e,t){const n=(0,l.Z)({dropResult:e,layout:t});return"number"==typeof n&&n<0}(e,n().dashboardLayout.present);if(r)return t((0,o.Dz)((0,a.t)("There is not enough space for this component. Try decreasing its width, or increasing the destination width.")));const{source:d,destination:u}=e,p=u&&u.id===s._4,h=d.id===s.D0,m=n().dashboardLayout.present[s._4],g=m&&m.children?m.children[0]:"";if(p)t(S(e));else if(u&&h)t(E(e));else{if(d.type===i.yR&&u.type===i.yR&&d.id===g&&u.id!==g)return t((0,o.Dz)((0,a.t)("Can not move top level tab into nested tabs")));u&&d&&(u.id!==d.id||u.index!==d.index)&&t(R(e))}const{dashboardFilters:f,dashboardLayout:v}=n();if(!h){const{present:e}=v,n=e[d.id]||{},r=e[u.id]||{};if((n.type===i.yR||n.type===i.Os)&&n.children&&0===n.children.length){const n=(0,c.Z)({childId:d.id,layout:e});t(b(d.id,n))}(function(e){let{dashboardFilters:t={},source:n=[],destination:r=[]}=e;const a=new Set(n),o=new Set(r);return[].concat(...Object.values(t).map((e=>{let{scopes:t}=e;return[].concat(...Object.values(t).map((e=>{let{scope:t}=e;return t})))}))).some((e=>o.has(e)!==a.has(e)))})({dashboardFilters:f,source:(n.parents||[]).concat(d.id),destination:(r.parents||[]).concat(u.id)})&&t((0,o.Dz)((0,a.t)("This chart has been moved to a different filter scope.")))}return null}}function O(){return(e,t)=>{e(r.zF.undo());const{dashboardLayout:n,dashboardState:a}=t();0!==n.past.length||a.maxUndoHistoryExceeded||a.updatedColorScheme||e((0,u.if)(!1))}}const L=h(r.zF.redo),N="UPDATE_COMPONENTS_PARENTS_LIST"},9467:(e,t,n)=>{"use strict";n.d(t,{BD:()=>M,P0:()=>Y,bs:()=>ce,sm:()=>de,ec:()=>he,k5:()=>pe,Ii:()=>W,Vd:()=>k,qJ:()=>oe,hD:()=>ae,nV:()=>Se,J$:()=>be,FF:()=>Ne,RU:()=>Ee,$f:()=>G,mq:()=>Ze,r$:()=>Re,n1:()=>De,w9:()=>ne,yV:()=>X,ee:()=>L,oJ:()=>ge,ek:()=>j,Z9:()=>P,H9:()=>q,Iw:()=>xe,Be:()=>B,Pi:()=>ve,Mn:()=>le,Lb:()=>U,Qt:()=>Le,z2:()=>K,YC:()=>ue,Yy:()=>me,Vv:()=>J,rL:()=>_e,M8:()=>se,TN:()=>$,dr:()=>V,$_:()=>Ce,uW:()=>ye,sL:()=>Me,E2:()=>Te,Mb:()=>Q,GH:()=>Ae,zL:()=>Ie,uN:()=>Oe,Qo:()=>re,fE:()=>ee,if:()=>N,O8:()=>fe,WL:()=>H,oY:()=>we,Sn:()=>z});var r=n(78580),a=n.n(r),o=n(21090),i=n(15926),s=n.n(i),l=n(31069),c=n(55867),d=n(55786),u=n(93185),p=n(78161),h=n(52256),m=n(37863),g=n(35854),f=n(98286),v=n(80621),_=n(52838),b=n(72570),y=n(11370),E=n(43399),T=n(9679),S=n(97381),C=n(3741),Z=n(12885),A=n(41295),x=n(50810),w=n(81395),R=n(52794),I=n(9531);const D=new Set(["json_metadata","position_json"]);function O(e,t){return t.split(".").reduce(((e,t)=>{const n=null==e?void 0:e[t];return D.has(t)&&n?JSON.parse(n):n}),e)}const L="SET_UNSAVED_CHANGES";function N(e){return{type:L,payload:{hasUnsavedChanges:e}}}const M="ADD_SLICE",k="REMOVE_SLICE",P="TOGGLE_FAVE_STAR";function F(e){return{type:P,isStarred:e}}function U(e){return function(t){return l.Z.get({endpoint:`/api/v1/dashboard/favorite_status/?q=${s().encode([e])}`}).then((e=>{var n,r;let{json:a}=e;t(F(!(null==a||null==(n=a.result)||null==(r=n[0])||!r.value)))})).catch((()=>t((0,b.Gb)((0,c.t)("There was an issue fetching the favorite status of this dashboard.")))))}}function $(e,t){return function(n){const r=`/api/v1/dashboard/${e}/favorites/`;return(t?l.Z.delete({endpoint:r}):l.Z.post({endpoint:r})).then((()=>{n(F(!t))})).catch((()=>n((0,b.Gb)((0,c.t)("There was an issue favoriting this dashboard.")))))}}const q="TOGGLE_PUBLISHED";function V(e,t){return function(n){return l.Z.put({endpoint:`/api/v1/dashboard/${e}`,headers:{"Content-Type":"application/json"},body:JSON.stringify({published:t})}).then((()=>{n((0,b.ws)(t?(0,c.t)("This dashboard is now published"):(0,c.t)("This dashboard is now hidden"))),n(function(e){return{type:q,isPublished:e}}(t))})).catch((()=>{n((0,b.Gb)((0,c.t)("You do not have permissions to edit this dashboard.")))}))}}const j="TOGGLE_EXPAND_SLICE";function H(e){return{type:j,sliceId:e}}const B="UPDATE_CSS";function z(e){return{type:B,css:e}}const G="SET_EDIT_MODE";function Q(e){return{type:G,editMode:e}}const Y="ON_CHANGE";function K(){return{type:Y}}const W="ON_SAVE";function J(e){return{type:W,lastModifiedTime:e}}const X="SET_REFRESH_FREQUENCY";function ee(e,t){return void 0===t&&(t=!1),{type:X,refreshFrequency:e,isPersistent:t}}function te(e){return t=>{t(J(e)),t(o.zF.clearHistory())}}const ne="SET_OVERRIDE_CONFIRM";function re(e){return{type:ne,overwriteConfirmMetadata:e}}const ae="SAVE_DASHBOARD_STARTED",oe="SAVE_DASHBOARD_FINISHED";function ie(){return{type:oe}}function se(e,t,n){return(r,o)=>{var i,s,p,h,m,g,x,L,N,M;r({type:Z.x_}),r({type:ae});const{dashboardFilters:k,dashboardLayout:P}=o(),F=P.present;Object.values(k).forEach((e=>{var t;const{chartId:n}=e,a=e.directPathToFilter.slice().pop(),o=((null==(t=F[a])?void 0:t.parents)||[]).slice();o.push(a),r((0,w.yz)(n,o))}));const U=(0,y.Z)((0,E.De)()),$=function(e){return Object.values(e).reduce(((e,t)=>{let{chartId:n,scopes:r}=t;return{...e,[n]:Object.keys(r).reduce(((e,t)=>({...e,[t]:r[t]})),{})}}),{})}(k),{certified_by:q,certification_details:V,css:j,dashboard_title:H,owners:B,roles:z,slug:G}=e,Q=e=>void 0!==e.id,Y=null==(i=e.metadata)?void 0:i.cross_filters_enabled,K={...e,certified_by:q||"",certification_details:q&&V?V:"",css:j||"",dashboard_title:H||(0,c.t)("[ untitled dashboard ]"),owners:(0,d.Z)(B).map((e=>Q(e)?e.id:e)),roles:(0,u.cr)(u.TT.DASHBOARD_RBAC)?(0,d.Z)(z).map((e=>Q(e)?e.id:e)):void 0,slug:G||null,metadata:{...e.metadata,color_namespace:(null==(s=e.metadata)?void 0:s.color_namespace)||void 0,color_scheme:(null==(p=e.metadata)?void 0:p.color_scheme)||"",color_scheme_domain:(null==(h=e.metadata)?void 0:h.color_scheme_domain)||[],expanded_slices:(null==(m=e.metadata)?void 0:m.expanded_slices)||{},label_colors:(null==(g=e.metadata)?void 0:g.label_colors)||{},shared_label_colors:(null==(x=e.metadata)?void 0:x.shared_label_colors)||{},refresh_frequency:(null==(L=e.metadata)?void 0:L.refresh_frequency)||0,timed_refresh_immune_slices:(null==(N=e.metadata)?void 0:N.timed_refresh_immune_slices)||[],cross_filters_enabled:(0,_.U)(Y)}},W=()=>{const{dashboardLayout:e,charts:t,dashboardInfo:{metadata:n}}=o();return(0,_.g)(e.present,n,t)},J=async e=>{const{error:t,message:n}=await(0,f.O$)(e);let a=(0,c.t)("Sorry, an unknown error occurred");t&&(a=(0,c.t)("Sorry, there was an error saving this dashboard: %s",t)),"string"==typeof n&&"Forbidden"===n&&(a=(0,c.t)("You do not have permission to edit this dashboard")),r(ie()),r((0,b.Gb)(a))};if(a()(M=[v.TN,v.NT]).call(M,n)){let a={},o={};(0,u.cr)(u.TT.DASHBOARD_CROSS_FILTERS)&&({chartConfiguration:a,globalChartConfiguration:o}=W());const i=n===v.NT?e:{certified_by:K.certified_by,certification_details:K.certification_details,css:K.css,dashboard_title:K.dashboard_title,slug:K.slug,owners:K.owners,roles:K.roles,json_metadata:(0,T.o)({...(null==K?void 0:K.metadata)||{},default_filters:(0,T.o)(U),filter_scopes:$,chart_configuration:a,global_chart_configuration:o})},s=()=>l.Z.put({endpoint:`/api/v1/dashboard/${t}`,headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}).then((e=>(e=>{const n=e.json.result,a=e.json.last_modified_time;if(n.json_metadata){const e=JSON.parse(n.json_metadata);r((0,A.a8)({metadata:e})),e.chart_configuration&&r({type:A.Jy,chartConfiguration:e.chart_configuration}),e.native_filter_configuration&&r({type:R.qe,filterConfig:e.native_filter_configuration})}return a&&r(te(a)),r(ie()),window.history.pushState({event:"dashboard_properties_changed"},"",`/superset/dashboard/${G||t}/`),r((0,b.ws)((0,c.t)("This dashboard was saved successfully."))),r(re(void 0)),e})(e))).catch((e=>J(e)));return new Promise(((e,a)=>{(0,u.cr)(u.TT.CONFIRM_DASHBOARD_DIFF)&&n!==v.NT?l.Z.get({endpoint:`/api/v1/dashboard/${t}`}).then((n=>{const o=n.json.result,s=(l=o,c=i,I.yT.map((e=>({keyPath:e,...e.split(".").find((e=>D.has(e)))?{oldValue:JSON.stringify(O(l,e),null,2)||"{}",newValue:JSON.stringify(O(c,e),null,2)||"{}"}:{oldValue:O(l,e)||"",newValue:O(c,e)||""}}))).filter((e=>{let{oldValue:t,newValue:n}=e;return t!==n})));var l,c;return s.length>0?(r(re({updatedAt:o.changed_on,updatedBy:o.changed_by_name,overwriteConfirmItems:s,dashboardId:t,data:i})),a(s)):e()})):e()})).then(s).catch((e=>{const n=(0,c.t)("Please confirm the overwrite values.");r((0,S.logEvent)(C.yw,{dashboard_id:t,items:e})),r((0,b.Gb)(n))}))}"positions"in K&&!("positions"in K.metadata)&&(K.metadata.positions=K.positions),K.metadata.default_filters=(0,T.o)(U),K.metadata.filter_scopes=$;const X={dashboard_title:K.dashboard_title,css:K.css,duplicate_slices:K.duplicate_slices,json_metadata:JSON.stringify(K.metadata)};return l.Z.post({endpoint:`/api/v1/dashboard/${t}/copy/`,jsonPayload:X}).then((e=>(e=>{const t=e.json.result.last_modified_time;if(t&&r(te(t)),(0,u.cr)(u.TT.DASHBOARD_CROSS_FILTERS)){const{chartConfiguration:e,globalChartConfiguration:t}=W();r((0,A.Mi)({chartConfiguration:e,globalChartConfiguration:t}))}return r(ie()),r((0,b.ws)((0,c.t)("This dashboard was saved successfully."))),e})(e))).catch((e=>J(e)))}}function le(e,t,n,r){return void 0===e&&(e=[]),void 0===t&&(t=!1),void 0===n&&(n=0),(a,o)=>{if(!n)return void e.forEach((e=>a((0,h.refreshChart)(e,t,r))));const{metadata:i}=o().dashboardInfo,s=Math.max(n,i.stagger_time||5e3);"boolean"!=typeof i.stagger_refresh&&(i.stagger_refresh=void 0===i.stagger_refresh||"true"===i.stagger_refresh);const l=i.stagger_refresh?s/(e.length-1):0;e.forEach(((e,n)=>{setTimeout((()=>a((0,h.refreshChart)(e,t,r))),l*n)}))}}const ce="ON_FILTERS_REFRESH",de="ON_FILTERS_REFRESH_SUCCESS";function ue(){return{type:de}}const pe="ON_REFRESH_SUCCESS",he="ON_REFRESH";function me(e,t,n,r){return void 0===e&&(e=[]),void 0===t&&(t=!1),void 0===n&&(n=0),a=>{a({type:he}),((e,t,n,r,a)=>new Promise((o=>{a(le(e,t,n,r)),o()})))(e,t,n,r,a).then((()=>{a({type:pe}),a({type:ce})}))}}const ge="SHOW_BUILDER_PANE";function fe(){return{type:ge}}function ve(e,t){return(n,r)=>{const{sliceEntities:a}=r(),o=a.slices[e];if(!o)return n((0,b.Dz)("Sorry, there is no chart definition associated with the chart trying to be added."));const i={...o.form_data,slice_id:o.slice_id},s={...m.u,id:e,form_data:(0,g.oN)(i)};return Promise.all([n((0,h.addChart)(s,e)),n((0,x.QR)(i.datasource))]).then((()=>{n({type:M,slice:o}),o&&"filter_box"===o.viz_type&&n((0,w.KJ)(e,t,o.form_data))}))}}function _e(e){return(t,n)=>{const r=n().sliceEntities.slices[e];r&&"filter_box"===r.viz_type&&t((0,w.ku)(e)),t({type:k,sliceId:e}),t((0,h.removeChart)(e)),(0,p.ZP)().removeSlice(e)}}const be="SET_COLOR_SCHEME";function ye(e){return{type:be,colorScheme:e}}const Ee="SET_DIRECT_PATH";function Te(e){return{type:Ee,path:e}}const Se="SET_ACTIVE_TABS";function Ce(e,t){return{type:Se,tabId:e,prevTabId:t}}const Ze="SET_FOCUSED_FILTER_FIELD";function Ae(e,t){return{type:Ze,chartId:e,column:t}}const xe="UNSET_FOCUSED_FILTER_FIELD";function we(e,t){return{type:xe,chartId:e,column:t}}const Re="SET_FULL_SIZE_CHART_ID";function Ie(e){return{type:Re,chartId:e}}const De="SET_MAX_UNDO_HISTORY_EXCEEDED";function Oe(e){return void 0===e&&(e=!0),{type:De,payload:{maxUndoHistoryExceeded:e}}}function Le(){return(e,t)=>{const{dashboardLayout:n}=t(),r=n.past.length;return e((0,b.Dz)((0,c.t)("You have used all %(historyLength)s undo slots and will not be able to fully undo subsequent actions. You may save your current state to reset the history.",{historyLength:r})))}}const Ne="SET_DATASETS_STATUS";function Me(e){return{type:Ne,status:e}}},4305:(e,t,n)=>{"use strict";n.d(t,{$:()=>w,Y:()=>R});var r=n(78580),a=n.n(r),o=n(93185),i=n(37863),s=n(37927),l=n(39759),c=n(35854),d=n(43399),u=n(12617),p=n(22318),h=n(52838),m=n(39023),g=n(80621),f=n(81255),v=n(53046),_=n(56967),b=n(28428),y=n(16454),E=n(27600),T=n(23525),S=n(42190),C=n(70400),Z=n(41295),A=n(37418),x=n(52004);const w="HYDRATE_DASHBOARD",R=e=>{let{history:t,dashboard:n,charts:r,dataMask:R,activeTabs:I}=e;return(e,D)=>{const{user:O,common:L,dashboardState:N}=D(),{metadata:M,position_data:k}=n,P=(0,C.Z)("regular"),F="true"===(0,C.Z)("reserved").edit;let U={};r.forEach((e=>{e.slice_id=e.form_data.slice_id}));try{U=(0,T.eY)(E.KD.preselectFilters)||JSON.parse(M.default_filters)}catch(e){}null!=M&&M.shared_label_colors&&(0,Z.fO)(M,null==M?void 0:M.shared_label_colors),null!=M&&M.label_colors&&(0,Z.fO)(M,null==M?void 0:M.label_colors);const $=k&&Object.keys(k).length>0?k:{[g.Zn]:"v2",[g._4]:{type:f.U0,id:g._4,children:[g.PV]},[g.PV]:{type:f.BG,id:g.PV,children:[],parents:[g._4]}},q={};Object.values($).forEach((e=>{e.type===f.dW&&(q[e.meta.chartId]=e.id)}));const V=function(e){void 0===e&&(e={});let t=e[g._4];return t=t&&t.children.length&&e[t.children[0]].type===f.yR?e[e[t.children[0]].children[0]]:e[t.children[0]],t.id}($),j=$[V];let H,B=0;const z=(null==M?void 0:M.filter_scopes)||{},G={},Q={},Y={},K=new Set,W=new Map;r.forEach((e=>{const t=e.slice_id,n={...e.form_data,url_params:{...e.form_data.url_params,...P}};if(G[t]={...i.u,id:t,form_data:(0,c.oN)(n)},Y[t]={slice_id:t,slice_url:e.slice_url,slice_name:e.slice_name,form_data:e.form_data,viz_type:e.form_data.viz_type,datasource:e.form_data.datasource,description:e.description,description_markeddown:e.description_markeddown,owners:e.owners,modified:e.modified,changed_on:new Date(e.changed_on).getTime()},K.add(t),!q[t]&&$[V]){var r;(0===B||B+g.fw>g.cz)&&(H=(0,b.Z)(f.Os,(j.parents||[]).slice()),$[H.id]=H,j.children.push(H.id),B=0);const t=(0,b.Z)(f.dW,{chartId:e.slice_id},(H.parents||[]).slice()),n=(null!=(r=W.get(e.slice_id))?r:0)+1;t.id=`${f.dW}-explore-${e.slice_id}-${n}`,W.set(e.slice_id,n),$[t.id]=t,H.children.push(t.id),q[t.meta.chartId]=t.id,B+=g.fw}if("filter_box"===e.form_data.viz_type){var o;const n=(0,v.Z)(e.form_data);let{columns:r}=n;const{labels:i}=n;U[t]&&Object.keys(r).forEach((e=>{U[t][e]&&(r={...r,[e]:U[t][e]})}));const s=Object.keys(r).reduce(((e,n)=>{const r={...z[t]},{scope:a,immune:o}={...m.GI,...r[n]};return{...e,[n]:{scope:a,immune:o}}}),{}),l=q[t],c=($[l].parents||[]).slice();c.push(l),Q[t]={...m.Mj,chartId:t,componentId:l,datasourceId:e.form_data.datasource,filterName:e.slice_name,directPathToFilter:c,columns:r,labels:i,scopes:s,isDateFilter:a()(o=Object.keys(r)).call(o,y.TIME_RANGE)}}const s=q[t];s&&$[s]&&($[s].meta.sliceName=e.slice_name)})),Object.values($).some((e=>e.id!==g._4&&!e.parents))&&(0,A.Z)({currentComponent:$[g._4],layout:$}),(0,d.DU)({dashboardFilters:Q,components:$}),$[g.M2]={id:g.M2,type:f.Vl,meta:{text:n.dashboard_title}};const J={past:[],present:$,future:[]},X=(0,T.eY)(E.KD.dashboardFocusedChart);let ee;if(X){const e=Object.values(J.present).find((e=>{var t;return(null==(t=e.meta)?void 0:t.chartId)===X}));ee=null==e?void 0:e.id;const n=new URLSearchParams(window.location.search);n.delete(E.KD.dashboardFocusedChart.name),t.replace({search:n.toString()})}const te=ee||(0,_.Z)();let ne=N.directPathToChild||[];$[te]&&(ne=($[te].parents||[]).slice(),ne.push(te));const re=(0,l.a)({filterConfig:(null==M?void 0:M.native_filter_configuration)||[]});if((0,o.cr)(o.TT.DASHBOARD_CROSS_FILTERS)){const{chartConfiguration:e,globalChartConfiguration:t}=(0,h.g)(J.present,M,G);M.chart_configuration=e,M.global_chart_configuration=t}const{roles:ae}=O,oe=(0,p.Ms)(n,O),ie=(0,h.U)(M.cross_filters_enabled);return e({type:w,data:{sliceEntities:{...s.b,slices:Y,isLoading:!1},charts:G,dashboardInfo:{...n,metadata:M,userId:O.userId?String(O.userId):null,dash_edit_perm:oe,dash_save_perm:(0,p.Xg)(n,O),dash_share_perm:(0,u.R)("can_share_dashboard","Superset",ae),superset_can_explore:(0,u.R)("can_explore","Superset",ae),superset_can_share:(0,u.R)("can_share_chart","Superset",ae),superset_can_csv:(0,u.R)("can_csv","Superset",ae),common:{flash_messages:null==L?void 0:L.flash_messages,conf:null==L?void 0:L.conf},filterBarOrientation:(0,o.cr)(o.TT.HORIZONTAL_FILTER_BAR)&&M.filter_bar_orientation||x.Bp.VERTICAL,crossFiltersEnabled:ie},dataMask:R,dashboardFilters:Q,nativeFilters:re,dashboardState:{preselectNativeFilters:(0,T.eY)(E.KD.nativeFilters),sliceIds:Array.from(K),directPathToChild:ne,directPathLastUpdated:Date.now(),focusedFilterField:null,expandedSlices:(null==M?void 0:M.expanded_slices)||{},refreshFrequency:(null==M?void 0:M.refresh_frequency)||0,shouldPersistRefreshFrequency:!1,css:n.css||"",colorNamespace:(null==M?void 0:M.color_namespace)||null,colorScheme:(null==M?void 0:M.color_scheme)||null,editMode:oe&&F,isPublished:n.published,hasUnsavedChanges:!1,dashboardIsSaving:!1,maxUndoHistoryExceeded:!1,lastModifiedTime:n.changed_on,isRefreshing:!1,isFiltersRefreshing:!1,activeTabs:I||(null==N?void 0:N.activeTabs)||[],datasetsStatus:S.ni.LOADING},dashboardLayout:J}})}}},39023:(e,t,n)=>{"use strict";n.d(t,{GI:()=>p,Mj:()=>h,ZP:()=>g});var r=n(78580),a=n.n(r),o=n(81395),i=n(4305),s=n(16454),l=n(80621),c=n(53046),d=n(43399),u=n(20194);const p={scope:[l._4],immune:[]},h={chartId:null,componentId:null,filterName:null,datasourceId:null,directPathToFilter:[],isDateFilter:!1,isInstantFilter:!0,columns:{},labels:{},scopes:{}},m=[o.fK,o.l3,o.oW];function g(e,t){void 0===e&&(e={});const n={[o.fK](){var e;const{chartId:n,component:r,form_data:o}=t,{columns:i,labels:l}=(0,c.Z)(o),d=Object.keys(i).reduce(((e,t)=>({...e,[t]:p})),{}),u=r?(r.parents||[]).slice().concat(r.id):[];return{...h,chartId:n,componentId:r.id,datasourceId:o.datasource,filterName:r.meta.sliceName,directPathToFilter:u,columns:i,labels:l,scopes:d,isInstantFilter:!!o.instant_filtering,isDateFilter:a()(e=Object.keys(i)).call(e,s.TIME_RANGE)}},[o.oW](e){const{newSelectedValues:n,merge:r}=t,a=Object.keys(n).reduce(((e,t)=>r&&t in e?{...e,[t]:[...e[t],...n[t]]}:{...e,[t]:n[t]}),{...e.columns});return{...e,columns:a}},[o.oT](e){const{path:n}=t;return{...e,directPathToFilter:n}}};if(t.type===o.ib)return(0,d.DU)({dashboardFilters:e,components:t.components}),e;if(t.type===o.cK){const n=t.scopes,r=Object.entries(n).reduce(((e,t)=>{const[n,{scope:r,immune:a}]=t,{chartId:o,column:i}=(0,u._)(n),s={...e[o].scopes,[i]:{scope:r,immune:a}};return{...e,[o]:{...e[o],scopes:s}}}),e);return(0,d.DU)({dashboardFilters:r}),r}if(t.type===o.l3){const{chartId:n}=t,{[n]:r,...a}=e;return(0,d.DU)({dashboardFilters:a}),a}if(t.type===i.$)return t.data.dashboardFilters;if(t.type in n){const r={...e,[t.chartId]:n[t.type](e[t.chartId])};return a()(m).call(m,t.type)&&(0,d.DU)({dashboardFilters:r}),r}return e}},37927:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s,b:()=>i});var r=n(55867),a=n(38523),o=n(4305);const i={slices:{},isLoading:!0,errorMessage:null,lastUpdated:0};function s(e,t){void 0===e&&(e=i);const n={[o.$]:()=>({...t.data.sliceEntities}),[a.D2]:()=>({...e,isLoading:!0}),[a.JV]:()=>({...e,isLoading:!1,slices:{...e.slices,...t.payload.slices},lastUpdated:(new Date).getTime()}),[a.EO]:()=>({isLoading:!1,slices:{...t.payload.slices},lastUpdated:(new Date).getTime()}),[a.cK]:()=>({...e,isLoading:!1,lastUpdated:(new Date).getTime(),errorMessage:t.payload.error||(0,r.t)("Could not fetch all saved charts")})};return t.type in n?n[t.type]():e}},43399:(e,t,n)=>{"use strict";n.d(t,{DU:()=>C,De:()=>y,Z3:()=>E,_f:()=>T,up:()=>S});var r=n(58809),a=n.n(r),o=n(8816),i=n.n(o),s=n(83927),l=n.n(s),c=n(41609),d=n.n(c),u=n(78580),p=n.n(u),h=n(20194),m=n(81255),g=n(39023);let f=[],v={},_={},b={};function y(){return v}function E(e){return p()(f).call(f,e)}function T(e,t){if(!(e in _)){const n=Object.entries(t||v).filter((t=>{let[,{scope:n}]=t;return p()(n).call(n,e)}));_[e]=i()(a()((e=>{let[t]=e;return(0,h._)(t).column})),l()((e=>{let[,{values:t}]=e;return t})))(n)}return _[e]}function S(e){let{filterScope:t}=e;function n(e,t,r){void 0===e&&(e=[]),void 0===t&&(t={}),void 0===r&&(r=[]),t&&(t.type===m.dW&&t.meta&&t.meta.chartId&&!p()(r).call(r,t.meta.chartId)?e.push(t.meta.chartId):t.children&&t.children.forEach((t=>n(e,b[t],r))))}const r=[],{scope:a,immune:o}=t||g.GI;return a.forEach((e=>n(r,b[e],o))),r}function C(e){let{dashboardFilters:t={},components:n={}}=e;f=Object.values(t).map((e=>e.chartId)),d()(n)||(b=n),_={},v=Object.values(t).reduce(((e,t)=>{const{chartId:n,columns:r,scopes:a}=t,o={};return Object.keys(r).forEach((e=>{if(Array.isArray(r[e])?r[e].length:void 0!==r[e]){const t=S({filterScope:a[e]}).filter((e=>n!==e));o[(0,h.w)({chartId:n,column:e})]={values:r[e],scope:t}}})),{...e,...o}}),{})}},47456:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(80621),a=n(95173),o=n(72673),i=n(28428);function s(e){let{dropResult:t,layout:n}=e;const{source:s,destination:l,dragging:c}=t,d=s.id===r.D0?(0,i.Z)(c.type):n[c.id]||{};if(s.id===l.id)return d.meta.width;const{width:u,minimumWidth:p}=(0,o.Z)({component:d,components:n}),{width:h,occupiedWidth:m}=(0,o.Z)({id:l.id,components:n});let g=Number(h-m);if(Number.isNaN(g)){const{width:e,occupiedWidth:t}=(0,o.Z)({id:(0,a.Z)({childId:l.id,layout:n}),components:n});g=Number(e-t)}return Number.isNaN(g)||Number.isNaN(Number(u))||g>=u?u:g>=p?g:-1}},72673:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(95173),a=n(80621),o=n(81255);function i(e){let{id:t,components:n}=e;const r=n[t];if(!r)return 0;let a=0;return(r.children||[]).forEach((e=>{const t=n[e]||{};a+=(t.meta||{}).width||0})),a}function s(e){let{id:t,component:n,components:l={}}=e;const c={width:void 0,occupiedWidth:void 0,minimumWidth:void 0},d=n||l[t];return d?(c.width=(d.meta||{}).width,c.occupiedWidth=c.width,d.type===o.Os?(c.width=s({id:(0,r.Z)({childId:d.id,layout:l}),components:l}).width||a.cz,c.occupiedWidth=i({id:d.id,components:l}),c.minimumWidth=c.occupiedWidth||a.cx):d.type===o.BA?(c.minimumWidth=a.cx,c.occupiedWidth=0,(d.children||[]).forEach((e=>{l[e].type===o.Os&&(c.minimumWidth=Math.max(c.minimumWidth,i({id:e,components:l})))}))):d.type!==o.t&&d.type!==o.xh&&d.type!==o.dW||(c.minimumWidth=a.cx),c):c}},53046:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(69856);function a(e){void 0===e&&(e={});const{date_filter:t,filter_configs:n=[],show_sqla_time_column:a,show_sqla_time_granularity:o}=e;let i=n.reduce(((e,t)=>{let{columns:n,labels:a}=e,o=t[r.ft.DEFAULT_VALUE];return""===o&&(o=null),o&&t[r.ft.MULTIPLE]&&(o=t.defaultValue.split(";")),{columns:{...n,[t.column]:t.vals||o},labels:{...a,[t.column]:t.label}}}),{columns:{},labels:{}});if(t){let t={...i.columns,[r.i2.time_range]:e.time_range};const n={...i.labels,...Object.entries(r.i2).reduce(((e,t)=>{let[n,a]=t;return{...e,[a]:r.m_[n]}}),{})};o&&(t={...t,[r.i2.time_grain_sqla]:e.time_grain_sqla}),a&&(t={...t,[r.i2.granularity_sqla]:e.granularity_sqla}),i={...i,columns:t,labels:n}}return i}},28428:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(14670),a=n.n(r),o=n(55867),i=n(81255),s=n(80621);const l={[i.dW]:{width:s.fw,height:50},[i.BA]:{width:s.fw,background:s.HE},[i.hE]:null,[i.Nc]:{text:(0,o.t)("New header"),headerSize:s.OE,background:s.HE},[i.xh]:{width:s.fw,height:50},[i.Os]:{background:s.HE},[i.yR]:null,[i.gn]:{text:"",defaultText:(0,o.t)("Tab title"),placeholder:(0,o.t)("Tab title")},[i.t]:{width:s.cz,background:s.HE}};function c(e){return`${e}-${a().generate()}`}function d(e,t,n){return void 0===n&&(n=[]),{type:e,id:c(e),children:[],parents:n,meta:{...l[e],...t}}}},11370:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(20194);function a(e){return Object.entries(e).reduce(((e,t)=>{const[n,{values:a}]=t,{chartId:o,column:i}=(0,r._)(n),s={...e[o],[i]:a};return{...e,[o]:s}}),{})}},37418:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(68492);function a(e){let{currentComponent:t,layout:n={}}=e;if(t&&n)if(n[t.id]){const e=Array.isArray(t.parents)?t.parents.slice():[];e.push(t.id),Array.isArray(t.children)&&t.children.forEach((t=>{n[t]?(n[t]={...n[t],parents:e},a({currentComponent:n[t],layout:n})):r.Z.warn(`The current layout does not contain a component with the id: ${t}.  Skipping this component`)}))}else r.Z.warn(`The current layout does not contain a component with the id: ${null==t?void 0:t.id}.  Skipping this component`)}},19485:(e,t,n)=>{"use strict";n.r(t),n.d(t,{FETCH_DASHBOARDS_FAILED:()=>g,FETCH_DASHBOARDS_SUCCEEDED:()=>h,SAVE_SLICE_FAILED:()=>b,SAVE_SLICE_SUCCESS:()=>E,SET_SAVE_CHART_MODAL_VISIBILITY:()=>v,createDashboard:()=>w,createSlice:()=>x,fetchDashboardsFailed:()=>f,fetchDashboardsSucceeded:()=>m,getSliceDashboards:()=>R,getSlicePayload:()=>C,saveSliceFailed:()=>y,saveSliceSuccess:()=>T,setSaveChartModalVisibility:()=>_,updateSlice:()=>A});var r=n(41609),a=n.n(r),o=n(15926),i=n.n(o),s=n(55867),l=n(31069),c=n(72570),d=n(12515),u=n(69856);const p=/^adhoc_filters/,h="FETCH_DASHBOARDS_SUCCEEDED";function m(e){return{type:h,choices:e}}const g="FETCH_DASHBOARDS_FAILED";function f(e){return{type:g,userId:e}}const v="SET_SAVE_CHART_MODAL_VISIBILITY";function _(e){return{type:v,isVisible:e}}const b="SAVE_SLICE_FAILED";function y(){return{type:b}}const E="SAVE_SLICE_SUCCESS";function T(e){return{type:E,data:e}}const S=e=>Object.entries(e).reduce(((e,t)=>{let[n,r]=t;return p.test(n)?{...e,[n]:null==r?void 0:r.filter((e=>!e.isExtra))}:e}),{}),C=function(e,t,n,r,o){var i,s,l,c;void 0===o&&(o={});let p=S(t);a()(null==(i=p)?void 0:i.adhoc_filters)&&!a()(o)&&(p=S(o)),a()(null==(s=p)?void 0:s.adhoc_filters)&&a()(o)&&(null==t||null==(l=t.adhoc_filters)||null==(c=l[0])?void 0:c.operator)===u.d.TEMPORAL_RANGE&&(p.adhoc_filters=[{...t.adhoc_filters[0],comparator:"No filter"}]);const h={...t,...p,dashboards:n},[m,g]=h.datasource.split("__");return{params:JSON.stringify(h),slice_name:e,viz_type:h.viz_type,datasource_id:parseInt(m,10),datasource_type:g,dashboards:n,owners:r,query_context:JSON.stringify((0,d.u)({formData:h,force:!1,resultFormat:"json",resultType:"full",setDataMask:null,ownState:null}))}},Z=(e,t,n)=>{const r=[];return e?r.push((0,c.ws)((0,s.t)("Chart [%s] has been saved",t))):r.push((0,c.ws)((0,s.t)("Chart [%s] has been overwritten",t))),n&&(n.new?r.push((0,c.ws)((0,s.t)("Dashboard [%s] just got created and chart [%s] was added to it",n.title,t))):r.push((0,c.ws)((0,s.t)("Chart [%s] was added to dashboard [%s]",t,n.title)))),r},A=(e,t,n,r)=>async(a,o)=>{const{slice_id:i,owners:s,form_data:c}=e,{explore:{form_data:{url_params:d,...u}}}=o();try{const e=await l.Z.put({endpoint:`/api/v1/chart/${i}`,jsonPayload:C(t,u,n,s,c)});return a(T()),Z(!1,t,r).map(a),e.json}catch(e){throw a(y()),e}},x=(e,t,n)=>async(r,a)=>{const{explore:{form_data:{url_params:o,...i}}}=a();try{const a=await l.Z.post({endpoint:"/api/v1/chart/",jsonPayload:C(e,i,t)});return r(T()),Z(!0,e,n).map(r),a.json}catch(e){throw r(y()),e}},w=e=>async t=>{try{return(await l.Z.post({endpoint:"/api/v1/dashboard/",jsonPayload:{dashboard_title:e}})).json}catch(e){throw t(y()),e}},R=e=>async t=>{try{return(await l.Z.get({endpoint:`/api/v1/chart/${e.slice_id}?q=${i().encode({columns:["dashboards.id"]})}`})).json.result.dashboards.map((e=>{let{id:t}=e;return t}))}catch(e){throw t(y()),e}}},79069:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m});var r=n(5872),a=n.n(r),o=n(67294),i=n(45697),s=n.n(i),l=n(51995),c=n(11965),d=n(82342),u=n(87253);const p={value:s().bool,label:s().string,onChange:s().func},h=l.iK.div`
  ${e=>{let{theme:t}=e;return c.iv`
    .ControlHeader label {
      color: ${t.colors.grayscale.dark1};
    }
    span[role='checkbox'] {
      padding-right: ${2*t.gridUnit}px;
    }
  `}}
`;class m extends o.Component{onChange(){this.props.onChange(!this.props.value)}renderCheckbox(){return(0,c.tZ)(u.ZP,{onChange:this.onChange.bind(this),checked:!!this.props.value})}render(){return this.props.label?(0,c.tZ)(h,null,(0,c.tZ)(d.Z,a()({},this.props,{leftNode:this.renderCheckbox(),onClick:this.onChange.bind(this)}))):this.renderCheckbox()}}m.propTypes=p,m.defaultProps={value:!1,onChange:()=>{}}},28543:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(69856),a=n(56565),o=n(61641);const i=[...r.qB].map((e=>r.LT[e].operation));class s{constructor(e){var t;this.expressionType=e.expressionType||o.v.SIMPLE,this.expressionType===o.v.SIMPLE?(this.subject=e.subject,this.operator=null==(t=e.operator)?void 0:t.toUpperCase(),this.operatorId=e.operatorId,this.comparator=e.comparator,[r.d.IS_TRUE,r.d.IS_FALSE].indexOf(e.operatorId)>=0&&(this.comparator=e.operatorId===r.d.IS_TRUE),[r.d.IS_NULL,r.d.IS_NOT_NULL].indexOf(e.operatorId)>=0&&(this.comparator=null),this.clause=e.clause||o.P.WHERE,this.sqlExpression=null):this.expressionType===o.v.SQL&&(this.sqlExpression="string"==typeof e.sqlExpression?e.sqlExpression:(0,a.c)(e,{useSimple:!0}),this.clause=e.clause,e.operator&&i.indexOf(e.operator)>=0?(this.subject=e.subject,this.operator=e.operator,this.operatorId=e.operatorId):(this.subject=null,this.operator=null),this.comparator=null),this.isExtra=!!e.isExtra,this.isNew=!!e.isNew,this.datasourceWarning=!!e.datasourceWarning,this.filterOptionName=e.filterOptionName||`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}duplicateWith(e){return new s({...this,isNew:!1,...e})}equals(e){return e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.operator===this.operator&&e.operatorId===this.operatorId&&e.comparator===this.comparator&&e.subject===this.subject}isValid(){const e=[r.d.IS_NOT_NULL,r.d.IS_NULL].map((e=>r.LT[e].operation)),t=[r.d.IS_TRUE,r.d.IS_FALSE].map((e=>r.LT[e].operation));if(this.expressionType===o.v.SIMPLE){if(e.indexOf(this.operator)>=0)return!(!this.operator||!this.subject);if(t.indexOf(this.operator)>=0)return!(!this.subject||null===this.comparator);if(this.operator&&this.subject&&this.clause)if(Array.isArray(this.comparator)){if(this.comparator.length>0)return!0}else if(null!==this.comparator)return!0}else if(this.expressionType===o.v.SQL)return!(!this.sqlExpression||!this.clause);return!1}getDefaultLabel(){const e=this.translateToSql();return e.length<43?e:`${e.substring(0,40)}...`}getTooltipTitle(){return this.translateToSql()}translateToSql(){return(0,a.c)(this)}}},61890:(e,t,n)=>{"use strict";n.d(t,{Z:()=>N});var r=n(67294),a=n(45697),o=n.n(a),i=n(31069),s=n(68492),l=n(55867),c=n(55786),d=n(68135),u=n(82342),p=n(17536),h=n(27130),m=n(19113),g=n(69856),f=n(40266),v=n(33334),_=n(70163),b=n(74069),y=n(96055),E=n(42753),T=n(7848),S=n(11965);function C(e){let{adhocFilter:t,options:n,datasource:r,onFilterEdit:a,onRemoveFilter:o,partitionColumn:i,onMoveLabel:s,onDropLabel:l,index:c,sections:d,operators:u}=e;const{actualTimeRange:p,title:h}=(0,T.w)(t);return(0,S.tZ)(y.Z,{sections:d,operators:u,adhocFilter:t,options:n,datasource:r,onFilterEdit:a,partitionColumn:i},(0,S.tZ)(v.yz,{label:null!=p?p:t.getDefaultLabel(),tooltipTitle:null!=h?h:t.getTooltipTitle(),onRemove:o,onMoveLabel:s,onDropLabel:l,index:c,type:E.g.FilterOption,withCaret:!0,isExtra:t.isExtra}))}var Z=n(28543),A=n(61641);const x=o().oneOfType([o().shape({expressionType:o().oneOf([A.v.SIMPLE]).isRequired,clause:o().oneOf([A.P.HAVING,A.P.WHERE]).isRequired,subject:o().string.isRequired,comparator:o().oneOfType([o().string,o().arrayOf(o().string)]).isRequired}),o().shape({expressionType:o().oneOf([A.v.SQL]).isRequired,clause:o().oneOf([A.P.WHERE,A.P.HAVING]).isRequired,sqlExpression:o().string.isRequired})]);var w=n(72201);const{warning:R}=b.Z,I=o().oneOfType([o().string,p.Z]),D={label:o().oneOfType([o().object,o().string]),name:o().string,sections:o().arrayOf(o().string),operators:o().arrayOf(o().string),onChange:o().func,value:o().arrayOf(x),datasource:o().object,columns:o().arrayOf(w.Z),savedMetrics:o().arrayOf(h.Z),selectedMetrics:o().oneOfType([I,o().arrayOf(I)]),isLoading:o().bool,canDelete:o().func};function O(e){return e&&!(e instanceof Z.Z)&&e.expressionType}class L extends r.Component{constructor(e){super(e),this.optionsForSelect=this.optionsForSelect.bind(this),this.onRemoveFilter=this.onRemoveFilter.bind(this),this.onNewFilter=this.onNewFilter.bind(this),this.onFilterEdit=this.onFilterEdit.bind(this),this.moveLabel=this.moveLabel.bind(this),this.onChange=this.onChange.bind(this),this.mapOption=this.mapOption.bind(this),this.getMetricExpression=this.getMetricExpression.bind(this),this.removeFilter=this.removeFilter.bind(this);const t=(this.props.value||[]).map((e=>O(e)?new Z.Z(e):e));this.optionRenderer=e=>(0,S.tZ)(f.Z,{option:e}),this.valueRenderer=(e,t)=>(0,S.tZ)(C,{key:t,index:t,adhocFilter:e,onFilterEdit:this.onFilterEdit,options:this.state.options,sections:this.props.sections,operators:this.props.operators,datasource:this.props.datasource,onRemoveFilter:e=>{e.stopPropagation(),this.onRemoveFilter(t)},onMoveLabel:this.moveLabel,onDropLabel:()=>this.props.onChange(this.state.values),partitionColumn:this.state.partitionColumn}),this.state={values:t,options:this.optionsForSelect(this.props),partitionColumn:null}}componentDidMount(){const{datasource:e}=this.props;if(e&&"table"===e.type){var t;const n=null==(t=e.database)?void 0:t.id,{datasource_name:r,schema:a,is_sqllab_view:o}=e;!o&&n&&r&&a&&i.Z.get({endpoint:`/api/v1/database/${n}/table_extra/${r}/${a}/`}).then((e=>{let{json:t}=e;if(t&&t.partitions){const{partitions:e}=t;e&&e.cols&&1===Object.keys(e.cols).length&&this.setState({partitionColumn:e.cols[0]})}})).catch((e=>{s.Z.error("fetch extra_table_metadata:",e.statusText)}))}}UNSAFE_componentWillReceiveProps(e){this.props.columns!==e.columns&&this.setState({options:this.optionsForSelect(e)}),this.props.value!==e.value&&this.setState({values:(e.value||[]).map((e=>O(e)?new Z.Z(e):e))})}removeFilter(e){const t=[...this.state.values];t.splice(e,1),this.setState((e=>({...e,values:t}))),this.props.onChange(t)}onRemoveFilter(e){const{canDelete:t}=this.props,{values:n}=this.state,r=null==t?void 0:t(n[e],n);"string"!=typeof r?this.removeFilter(e):R({title:(0,l.t)("Warning"),content:r})}onNewFilter(e){const t=this.mapOption(e);t&&this.setState((e=>({...e,values:[...e.values,t]})),(()=>{this.props.onChange(this.state.values)}))}onFilterEdit(e){this.props.onChange(this.state.values.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}onChange(e){const t=(e||[]).map((e=>this.mapOption(e))).filter((e=>e));this.props.onChange(t)}getMetricExpression(e){return this.props.savedMetrics.find((t=>t.metric_name===e)).expression}moveLabel(e,t){const{values:n}=this.state,r=[...n];[r[t],r[e]]=[r[e],r[t]],this.setState({values:r})}mapOption(e){return e instanceof Z.Z?e:e.saved_metric_name?new Z.Z({expressionType:A.v.SQL,subject:this.getMetricExpression(e.saved_metric_name),operator:g.LT[g.d.GREATER_THAN].operation,comparator:0,clause:A.P.HAVING}):e.label?new Z.Z({expressionType:A.v.SQL,subject:new m.Z(e).translateToSql(),operator:g.LT[g.d.GREATER_THAN].operation,comparator:0,clause:A.P.HAVING}):e.column_name?new Z.Z({expressionType:A.v.SIMPLE,subject:e.column_name,operator:g.LT[g.d.EQUALS].operation,comparator:"",clause:A.P.WHERE,isNew:!0}):null}optionsForSelect(e){return[...e.columns,...(0,c.Z)(e.selectedMetrics).map((e=>e&&("string"==typeof e?{saved_metric_name:e}:new m.Z(e))))].filter((e=>e)).reduce(((e,t)=>(t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof m.Z&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>(e.saved_metric_name||e.column_name||e.label).localeCompare(t.saved_metric_name||t.column_name||t.label)))}addNewFilterPopoverTrigger(e){return(0,S.tZ)(y.Z,{operators:this.props.operators,sections:this.props.sections,adhocFilter:new Z.Z({}),datasource:this.props.datasource,options:this.state.options,onFilterEdit:this.onNewFilter,partitionColumn:this.state.partitionColumn},e)}render(){const{theme:e}=this.props;return(0,S.tZ)("div",{className:"metrics-select"},(0,S.tZ)(v.gM,null,(0,S.tZ)(u.Z,this.props),this.addNewFilterPopoverTrigger((0,S.tZ)(v.IG,null,(0,S.tZ)(_.Z.PlusLarge,{iconSize:"s",iconColor:e.colors.grayscale.light5})))),(0,S.tZ)(v.yj,null,this.state.values.length>0?this.state.values.map(((e,t)=>this.valueRenderer(e,t))):this.addNewFilterPopoverTrigger((0,S.tZ)(v.SW,null,(0,S.tZ)(_.Z.PlusSmall,{iconColor:e.colors.grayscale.light1}),(0,l.t)("Add filter")))))}}L.propTypes=D,L.defaultProps={name:"",onChange:()=>{},columns:[],savedMetrics:[],selectedMetrics:[]};const N=(0,d.b)(L)},72201:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(45697),a=n.n(r);const o=a().shape({column_name:a().string.isRequired,type:a().string})},19113:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s,v:()=>a});var r=n(69856);const a={SIMPLE:"SIMPLE",SQL:"SQL"};function o(e){if(e.sqlExpression&&r.Q_.test(e.sqlExpression)){const t=e.sqlExpression.indexOf(")"),n=e.sqlExpression.substring(0,t).lastIndexOf("(");if(t>0&&n>0)return e.sqlExpression.substring(n+1,t)}return null}function i(e){if(e.sqlExpression&&r.Q_.test(e.sqlExpression)){const t=e.sqlExpression.indexOf("(");if(t>0)return e.sqlExpression.substring(0,t)}return null}class s{constructor(e){if(this.expressionType=e.expressionType||a.SIMPLE,this.expressionType===a.SIMPLE){const t=o(e);this.column=e.column||t&&{column_name:t},this.aggregate=e.aggregate||i(e),this.sqlExpression=null}else this.expressionType===a.SQL&&(this.sqlExpression=e.sqlExpression,this.column=null,this.aggregate=null);this.datasourceWarning=!!e.datasourceWarning,this.hasCustomLabel=!(!e.hasCustomLabel||!e.label),this.label=this.hasCustomLabel?e.label:this.getDefaultLabel(),this.optionName=e.optionName||`metric_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}getDefaultLabel(){return this.translateToSql({useVerboseName:!0})}translateToSql(e){if(void 0===e&&(e={useVerboseName:!1,transformCountDistinct:!1}),this.expressionType===a.SIMPLE){var t,n;const a=this.aggregate||"",o=e.useVerboseName&&null!=(t=this.column)&&t.verbose_name?`(${this.column.verbose_name})`:null!=(n=this.column)&&n.column_name?`(${this.column.column_name})`:"";return e.transformCountDistinct&&a===r.YY.COUNT_DISTINCT&&/^\(.*\)$/.test(o)?`COUNT(DISTINCT ${o.slice(1,-1)})`:a+o}return this.expressionType===a.SQL?this.sqlExpression:""}duplicateWith(e){return new s({...this,...e})}equals(e){return e.label===this.label&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.aggregate===this.aggregate&&(e.column&&e.column.column_name)===(this.column&&this.column.column_name)}isValid(){return this.expressionType===a.SIMPLE?!(!this.column||!this.aggregate):this.expressionType===a.SQL&&!!this.sqlExpression}inferSqlExpressionAggregate(){return i(this)}inferSqlExpressionColumn(){return o(this)}}},40266:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d}),n(67294);var r=n(45697),a=n.n(r),o=n(34087),i=n(17536),s=n(99963),l=n(11965);const c={option:a().oneOfType([o.Z,a().shape({saved_metric_name:a().string.isRequired}),i.Z]).isRequired};function d(e){let{option:t}=e;return t.saved_metric_name?(0,l.tZ)(s.l,{column:{column_name:t.saved_metric_name,type:"expression"},showType:!0}):t.column_name?(0,l.tZ)(s.l,{column:t,showType:!0}):t.label?(0,l.tZ)(s.l,{column:{column_name:t.label,type:"expression"},showType:!0}):null}d.propTypes=c},17536:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(45697),a=n.n(r),o=n(69856),i=n(34087),s=n(19113);const l=a().oneOfType([a().shape({expressionType:a().oneOf([s.v.SIMPLE]).isRequired,column:i.Z.isRequired,aggregate:a().oneOf(Object.keys(o.YY)).isRequired,label:a().string.isRequired}),a().shape({expressionType:a().oneOf([s.v.SQL]).isRequired,sqlExpression:a().string.isRequired,label:a().string.isRequired})])},34087:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(45697),a=n.n(r);const o=a().shape({column_name:a().string.isRequired,type:a().string})},27130:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(45697),a=n.n(r);const o=a().shape({metric_name:a().string,verbose_name:a().string,expression:a().string})},82199:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(67294),a=n(45697),o=n.n(a),i=n(1111),s=n(55867),l=n(11965),c=n(81315),d=n(82342);const u={ariaLabel:o().string,autoFocus:o().bool,choices:o().array,clearable:o().bool,description:o().oneOfType([o().string,o().node]),disabled:o().bool,freeForm:o().bool,isLoading:o().bool,mode:o().string,multi:o().bool,isMulti:o().bool,name:o().string.isRequired,onChange:o().func,onFocus:o().func,onSelect:o().func,onDeselect:o().func,value:o().oneOfType([o().string,o().number,o().array]),default:o().oneOfType([o().string,o().number,o().array]),showHeader:o().bool,optionRenderer:o().func,valueKey:o().string,options:o().array,placeholder:o().string,filterOption:o().func,tokenSeparators:o().arrayOf(o().string),notFoundContent:o().object,label:o().string,renderTrigger:o().bool,validationErrors:o().array,rightNode:o().node,leftNode:o().node,onClick:o().func,hovered:o().bool,tooltipOnClick:o().func,warning:o().string,danger:o().string};class p extends r.PureComponent{constructor(e){super(e),this.state={options:this.getOptions(e)},this.onChange=this.onChange.bind(this),this.handleFilterOptions=this.handleFilterOptions.bind(this)}UNSAFE_componentWillReceiveProps(e){if(!(0,i.Z)(e.choices,this.props.choices)||!(0,i.Z)(e.options,this.props.options)){const t=this.getOptions(e);this.setState({options:t})}}onChange(e){const{valueKey:t}=this.props;let n=e;Array.isArray(e)&&(n=e.map((e=>void 0!==(null==e?void 0:e[t])?e[t]:e))),"object"==typeof e&&void 0!==(null==e?void 0:e[t])&&(n=e[t]),this.props.onChange(n,[])}getOptions(e){const{choices:t,optionRenderer:n,valueKey:r}=e;let a=[];return e.options?a=e.options.map((e=>({...e,value:e[r],label:e.label||e[r],customLabel:n?n(e):void 0}))):t&&(a=t.map((e=>{if(Array.isArray(e)){const[t,n]=e.length>1?e:[e[0],e[0]];return{value:t,label:n}}return Object.is(e)?{...e,value:e[r],label:e.label||e[r]}:{value:e,label:e}}))),a}handleFilterOptions(e,t){const{filterOption:n}=this.props;return n({data:t},e)}render(){const{ariaLabel:e,autoFocus:t,clearable:n,disabled:r,filterOption:a,freeForm:o,isLoading:i,isMulti:u,label:p,multi:h,name:m,notFoundContent:g,onFocus:f,onSelect:v,onDeselect:_,placeholder:b,showHeader:y,tokenSeparators:E,value:T,description:S,renderTrigger:C,rightNode:Z,leftNode:A,validationErrors:x,onClick:w,hovered:R,tooltipOnClick:I,warning:D,danger:O}=this.props,L={name:m,label:p,description:S,renderTrigger:C,rightNode:Z,leftNode:A,validationErrors:x,onClick:w,hovered:R,tooltipOnClick:I,warning:D,danger:O},N={allowNewOptions:o,autoFocus:t,ariaLabel:e||("string"==typeof p?p:(0,s.t)("Select ...")),allowClear:n,disabled:r,filterOption:!a||"function"!=typeof a||this.handleFilterOptions,header:y&&(0,l.tZ)(d.Z,L),loading:i,mode:this.props.mode||(u||h?"multiple":"single"),name:`select-${m}`,onChange:this.onChange,onFocus:f,onSelect:v,onDeselect:_,options:this.state.options,placeholder:b,sortComparator:this.props.sortComparator,value:(()=>{const e=T||(void 0!==this.props.default?this.props.default:void 0);if(null!==e||this.state.options.find((e=>null===e.value)))return e})(),tokenSeparators:E,notFoundContent:g};return(0,l.tZ)("div",{css:e=>l.iv`
          .type-label {
            margin-right: ${2*e.gridUnit}px;
          }
          .Select__multi-value__label > span,
          .Select__option > span,
          .Select__single-value > span {
            display: flex;
            align-items: center;
          }
        `},(0,l.tZ)(c.Z,N))}}p.propTypes=u,p.defaultProps={autoFocus:!1,choices:[],clearable:!0,description:null,disabled:!1,freeForm:!1,isLoading:!1,label:null,multi:!1,onChange:()=>{},onFocus:()=>{},showHeader:!0,valueKey:"value"}},665:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var r=n(67294),a=n(45697),o=n.n(a),i=n(4715),s=n(55867),l=n(37921),c=n(99299),d=n(83734),u=n(87253),p=n(82342),h=n(82199),m=n(11965);const g="latlong",f="delimited",v="geohash",_={onChange:o().func,value:o().object,animation:o().bool,choices:o().array};class b extends r.Component{constructor(e){super(e);const t=e.value||{};let n;e.choices.length>0&&(n=e.choices[0][0]),this.state={type:t.type||g,delimiter:t.delimiter||",",latCol:t.latCol||n,lonCol:t.lonCol||n,lonlatCol:t.lonlatCol||n,reverseCheckbox:t.reverseCheckbox||!1,geohashCol:t.geohashCol||n,value:null,errors:[]},this.toggleCheckbox=this.toggleCheckbox.bind(this),this.onChange=this.onChange.bind(this),this.renderReverseCheckbox=this.renderReverseCheckbox.bind(this)}componentDidMount(){this.onChange()}onChange(){const{type:e}=this.state,t={type:e},n=[],r=(0,s.t)("Invalid lat/long configuration.");e===g?(t.latCol=this.state.latCol,t.lonCol=this.state.lonCol,t.lonCol&&t.latCol||n.push(r)):e===f?(t.lonlatCol=this.state.lonlatCol,t.delimiter=this.state.delimiter,t.reverseCheckbox=this.state.reverseCheckbox,t.lonlatCol&&t.delimiter||n.push(r)):e===v&&(t.geohashCol=this.state.geohashCol,t.reverseCheckbox=this.state.reverseCheckbox,t.geohashCol||n.push(r)),this.setState({value:t,errors:n}),this.props.onChange(t,n)}setType(e){this.setState({type:e},this.onChange)}toggleCheckbox(){this.setState((e=>({reverseCheckbox:!e.reverseCheckbox})),this.onChange)}renderLabelContent(){return this.state.errors.length>0?"N/A":this.state.type===g?`${this.state.lonCol} | ${this.state.latCol}`:this.state.type===f?`${this.state.lonlatCol}`:this.state.type===v?`${this.state.geohashCol}`:null}renderSelect(e,t){return(0,m.tZ)(h.Z,{ariaLabel:e,name:e,choices:this.props.choices,value:this.state[e],clearable:!1,onFocus:()=>{this.setType(t)},onChange:t=>{this.setState({[e]:t},this.onChange)}})}renderReverseCheckbox(){return(0,m.tZ)("span",null,(0,s.t)("Reverse lat/long "),(0,m.tZ)(u.ZP,{checked:this.state.reverseCheckbox,onChange:this.toggleCheckbox}))}renderPopoverContent(){return(0,m.tZ)("div",{style:{width:"300px"}},(0,m.tZ)(d.Z,{title:(0,s.t)("Longitude & Latitude columns"),isSelected:this.state.type===g,onSelect:this.setType.bind(this,g)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},(0,s.t)("Longitude"),this.renderSelect("lonCol",g)),(0,m.tZ)(i.JX,{xs:24,md:12},(0,s.t)("Latitude"),this.renderSelect("latCol",g)))),(0,m.tZ)(d.Z,{title:(0,s.t)("Delimited long & lat single column"),info:(0,s.t)("Multiple formats accepted, look the geopy.points Python library for more details"),isSelected:this.state.type===f,onSelect:this.setType.bind(this,f)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},(0,s.t)("Column"),this.renderSelect("lonlatCol",f)),(0,m.tZ)(i.JX,{xs:24,md:12},this.renderReverseCheckbox()))),(0,m.tZ)(d.Z,{title:(0,s.t)("Geohash"),isSelected:this.state.type===v,onSelect:this.setType.bind(this,v)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},(0,s.t)("Column"),this.renderSelect("geohashCol",v)),(0,m.tZ)(i.JX,{xs:24,md:12},this.renderReverseCheckbox()))))}render(){return(0,m.tZ)("div",null,(0,m.tZ)(p.Z,this.props),(0,m.tZ)(c.Z,{content:this.renderPopoverContent(),placement:"topLeft",trigger:"click"},(0,m.tZ)(l.Z,{className:"pointer"},this.renderLabelContent())))}}b.propTypes=_,b.defaultProps={onChange:()=>{},animation:!0,choices:[]}},42878:(e,t,n)=>{"use strict";n.d(t,{Z:()=>_});var r=n(5872),a=n.n(r),o=n(67294),i=n(45697),s=n.n(i),l=n(9875),c=n(55867),d=n(68135),u=n(35932),p=n(94670),h=n(1304),m=n(82342),g=n(11965);const f={name:s().string,onChange:s().func,initialValue:s().string,height:s().number,minLines:s().number,maxLines:s().number,offerEditInModal:s().bool,language:s().oneOf([null,"json","html","sql","markdown","javascript"]),aboveEditorSection:s().node,readOnly:s().bool,resize:s().oneOf([null,"block","both","horizontal","inline","none","vertical"]),textAreaStyles:s().object};class v extends o.Component{onControlChange(e){const{value:t}=e.target;this.props.onChange(t)}onAreaEditorChange(e){this.props.onChange(e)}renderEditor(e){void 0===e&&(e=!1);const t=e?40:this.props.minLines||12;if(this.props.language){const n={border:`1px solid ${this.props.theme.colors.grayscale.light1}`,minHeight:`${t}em`,width:"auto",...this.props.textAreaStyles};return this.props.resize&&(n.resize=this.props.resize),this.props.readOnly&&(n.backgroundColor="#f2f2f2"),(0,g.tZ)(p.YH,a()({mode:this.props.language,style:n,minLines:t,maxLines:e?1e3:this.props.maxLines,editorProps:{$blockScrolling:!0},defaultValue:this.props.initialValue,readOnly:this.props.readOnly,key:this.props.name},this.props,{onChange:this.onAreaEditorChange.bind(this)}))}return(0,g.tZ)(l.Kx,{placeholder:(0,c.t)("textarea"),onChange:this.onControlChange.bind(this),defaultValue:this.props.initialValue,disabled:this.props.readOnly,style:{height:this.props.height}})}renderModalBody(){return(0,g.tZ)(o.Fragment,null,(0,g.tZ)("div",null,this.props.aboveEditorSection),this.renderEditor(!0))}render(){const e=(0,g.tZ)(m.Z,this.props);return(0,g.tZ)("div",null,e,this.renderEditor(),this.props.offerEditInModal&&(0,g.tZ)(h.Z,{modalTitle:e,triggerNode:(0,g.tZ)(u.Z,{buttonSize:"small",className:"m-t-5"},(0,c.t)("Edit")," ",(0,g.tZ)("strong",null,this.props.language)," ",(0,c.t)("in modal")),modalBody:this.renderModalBody(!0),responsive:!0}))}}v.propTypes=f,v.defaultProps={onChange:()=>{},initialValue:"",height:250,minLines:3,maxLines:10,offerEditInModal:!0,readOnly:!1,resize:null,textAreaStyles:{}};const _=(0,d.b)(v)},92252:(e,t,n)=>{"use strict";n.d(t,{ai:()=>b}),n(67294);var r=n(81545),a=n(45511),o=n(55867),i=n(95826),s=n(75294),l=n(12515),c=n(69856),d=n(99963),u=n(11965);const p=(0,r.Z)(),h=(0,a.Z)(),m=[["SMART_NUMBER",(0,o.t)("Adaptive formatting")],["~g",(0,o.t)("Original value")],[",d",",d (12345.432 => 12,345)"],[".1s",".1s (12345.432 => 10k)"],[".3s",".3s (12345.432 => 12.3k)"],[",.1%",",.1% (12345.432 => 1,234,543.2%)"],[".3%",".3% (12345.432 => 1234543.200%)"],[".4r",".4r (12345.432 => 12350)"],[",.3f",",.3f (12345.432 => 12,345.432)"],["+,","+, (12345.432 => +12,345.432)"],["$,.2f","$,.2f (12345.432 => $12,345.43)"],["DURATION",(0,o.t)("Duration in ms (66000 => 1m 6s)")],["DURATION_SUB",(0,o.t)("Duration in ms (100.40008 => 100ms 400s 80ns)")]],g=((0,o.t)("Adaptive formatting"),{verbose_name:"Time",column_name:"__timestamp",description:(0,o.t)("A reference to the [Time] configuration, taking granularity into account")}),f={type:"SelectControl",multi:!0,freeForm:!0,label:(0,o.t)("Dimensions"),default:[],includeTime:!1,description:(0,o.t)("One or many columns to group by. High cardinality groupings should include a series limit to limit the number of fetched and rendered series."),optionRenderer:e=>(0,u.tZ)(d.l,{column:e,showType:!0}),valueKey:"column_name",filterOption:(e,t)=>{let{data:n}=e;return n.column_name&&n.column_name.toLowerCase().indexOf(t.toLowerCase())>=0||n.verbose_name&&n.verbose_name.toLowerCase().indexOf(t.toLowerCase())>=0},mapStateToProps:(e,t)=>{const n={};return e.datasource&&(n.options=e.datasource.columns.filter((e=>e.groupby)),t&&t.includeTime&&n.options.push(g)),n}},v={type:"MetricsControl",multi:!0,label:(0,o.t)("Metrics"),validators:[i.Z],mapStateToProps:e=>{const{datasource:t}=e;return{columns:t?t.columns:[],savedMetrics:t?t.metrics:[],datasource:t}},description:(0,o.t)("One or many metrics to display")},_={...v,multi:!1,label:(0,o.t)("Metric"),description:(0,o.t)("Metric")},b={metrics:v,metric:_,datasource:{type:"DatasourceControl",label:(0,o.t)("Dataset"),default:null,description:null,mapStateToProps:e=>{let{datasource:t}=e;return{datasource:t,isEditable:!!t}}},viz_type:{type:"VizTypeControl",default:"table",description:(0,o.t)("The type of visualization to display")},color_picker:{label:(0,o.t)("Fixed color"),description:(0,o.t)("Use this to define a static color for all circles"),type:"ColorPickerControl",default:{r:0,g:122,b:135,a:1},renderTrigger:!0},metric_2:{..._,label:(0,o.t)("Right axis metric"),clearable:!0,description:(0,o.t)("Choose a metric for right axis")},linear_color_scheme:{type:"ColorSchemeControl",label:(0,o.t)("Linear color scheme"),choices:()=>h.values().map((e=>[e.id,e.label])),default:h.getDefaultKey(),clearable:!1,description:"",renderTrigger:!0,schemes:()=>h.getMap(),isLinear:!0},secondary_metric:{..._,label:(0,o.t)("Color metric"),default:null,validators:[],description:(0,o.t)("A metric to use for color")},groupby:f,columns:{...f,label:(0,o.t)("Columns"),description:(0,o.t)("One or many controls to pivot as columns")},granularity:{type:"SelectControl",freeForm:!0,label:c.m_.granularity,default:"P1D",choices:[[null,(0,o.t)("all")],["PT5S",(0,o.t)("5 seconds")],["PT30S",(0,o.t)("30 seconds")],["PT1M",(0,o.t)("1 minute")],["PT5M",(0,o.t)("5 minutes")],["PT30M",(0,o.t)("30 minutes")],["PT1H",(0,o.t)("1 hour")],["PT6H",(0,o.t)("6 hour")],["P1D",(0,o.t)("1 day")],["P7D",(0,o.t)("7 days")],["P1W",(0,o.t)("week")],["week_starting_sunday",(0,o.t)("week starting Sunday")],["week_ending_saturday",(0,o.t)("week ending Saturday")],["P1M",(0,o.t)("month")],["P3M",(0,o.t)("quarter")],["P1Y",(0,o.t)("year")]],description:(0,o.t)("The time granularity for the visualization. Note that you can type and use simple natural language as in `10 seconds`,`1 day` or `56 weeks`")},granularity_sqla:{type:"SelectControl",label:c.m_.granularity_sqla,description:(0,o.t)("The time column for the visualization. Note that you can define arbitrary expression that return a DATETIME column in the table. Also note that the filter below is applied against this column or expression"),clearable:!1,optionRenderer:e=>(0,u.tZ)(d.l,{column:e,showType:!0}),valueKey:"column_name",mapStateToProps:e=>{const t={};return e.datasource&&(t.choices=e.datasource.granularity_sqla,t.default=null,e.datasource.main_dttm_col?t.default=e.datasource.main_dttm_col:t.choices&&t.choices.length>0&&(t.default=t.choices[0].column_name)),t}},time_grain_sqla:{type:"SelectControl",label:c.m_.time_grain_sqla,default:"P1D",description:(0,o.t)("The time granularity for the visualization. This applies a date transformation to alter your time column and defines a new time granularity. The options here are defined on a per database engine basis in the Superset source code."),mapStateToProps:e=>({choices:e.datasource?e.datasource.time_grain_sqla:null})},time_range:{type:"DateFilterControl",freeForm:!0,label:c.m_.time_range,default:(0,o.t)("No filter"),description:(0,o.t)('The time range for the visualization. All relative times, e.g. "Last month", "Last 7 days", "now", etc. are evaluated on the server using the server\'s local time (sans timezone). All tooltips and placeholder times are expressed in UTC (sans timezone). The timestamps are then evaluated by the database using the engine\'s local timezone. Note one can explicitly set the timezone per the ISO 8601 format if specifying either the start and/or end time.')},row_limit:{type:"SelectControl",freeForm:!0,label:(0,o.t)("Row limit"),validators:[s.Z],default:1e4,choices:(0,l.mG)([10,50,100,250,500,1e3,5e3,1e4,5e4]),description:(0,o.t)("Limits the number of rows that get displayed.")},limit:{type:"SelectControl",freeForm:!0,label:(0,o.t)("Series limit"),validators:[s.Z],choices:(0,l.mG)([5,10,25,50,100,500]),clearable:!0,description:(0,o.t)("Limits the number of series that get displayed. A joined subquery (or an extra phase where subqueries are not supported) is applied to limit the number of series that get fetched and rendered. This feature is useful when grouping by high cardinality column(s) though does increase the query complexity and cost.")},timeseries_limit_metric:{type:"MetricsControl",label:(0,o.t)("Sort by"),default:null,clearable:!0,description:(0,o.t)("Metric used to define how the top series are sorted if a series or row limit is present. If undefined reverts to the first metric (where appropriate)."),mapStateToProps:e=>({columns:e.datasource?e.datasource.columns:[],savedMetrics:e.datasource?e.datasource.metrics:[],datasource:e.datasource})},series:{...f,label:(0,o.t)("Dimensions"),multi:!1,default:null,description:(0,o.t)("Defines the grouping of entities. Each series is shown as a specific color on the chart and has a legend toggle")},entity:{...f,label:(0,o.t)("Entity"),default:null,multi:!1,validators:[i.Z],description:(0,o.t)("This defines the element to be plotted on the chart")},x:{..._,label:(0,o.t)("X Axis"),description:(0,o.t)("Metric assigned to the [X] axis"),default:null},y:{..._,label:(0,o.t)("Y Axis"),default:null,description:(0,o.t)("Metric assigned to the [Y] axis")},size:{..._,label:(0,o.t)("Bubble size"),default:null},y_axis_format:{type:"SelectControl",freeForm:!0,label:(0,o.t)("Y Axis Format"),renderTrigger:!0,default:"SMART_NUMBER",choices:m,description:"D3 format syntax: https://github.com/d3/d3-format",mapStateToProps:e=>{const t=e.controls&&e.controls.comparison_type&&"percentage"===e.controls.comparison_type.value;return{warning:t?(0,o.t)('When `Calculation type` is set to "Percentage change", the Y Axis Format is forced to `.1%`'):null,disabled:t}}},adhoc_filters:{type:"AdhocFilterControl",label:(0,o.t)("Filters"),default:null,description:"",mapStateToProps:e=>({columns:e.datasource?e.datasource.columns.filter((e=>e.filterable)):[],savedMetrics:e.datasource?e.datasource.metrics:[],datasource:e.datasource})},color_scheme:{type:"ColorSchemeControl",label:(0,o.t)("Color scheme"),default:p.getDefaultKey(),renderTrigger:!0,choices:()=>p.keys().map((e=>[e,e])),description:(0,o.t)("The color scheme for rendering chart"),schemes:()=>p.getMap()}}},12515:(e,t,n)=>{"use strict";n.d(t,{AH:()=>D,CB:()=>L,H6:()=>A,Jp:()=>b,bX:()=>O,hz:()=>x,kN:()=>Z,mG:()=>N,pd:()=>R,pe:()=>I,u:()=>w,xW:()=>T,y8:()=>C});var r=n(78580),a=n.n(r),o=n(67294),i=n(54998),s=n.n(i),l=n(11064),c=n(19427),d=n(61654),u=n(31069),p=n(55786),h=n(86374),m=n(9679),g=n(54076),f=n(27600),v=n(69856),_=n(80621);function b(e){var t,n;const{slice:r,form_data:a}=e;return null!=(t=null!=(n=null==r?void 0:r.slice_id)?n:null==a?void 0:a.slice_id)?t:v.xA}let y=0;function E(e){void 0===e&&(e=!1);let t=0;return e&&(t=y%h.X.length,y+=1,0===t&&(t+=1,y+=1)),h.X[t]}function T(e,t){return null==e?null:s()(window.location.search).pathname("/api/v1/chart/data").search({form_data:(0,m.o)({slice_id:e}),force:t}).toString()}function S(e){var t;return void 0===e&&(e="base"),a()(t=["full","json","csv","query","results","samples"]).call(t,e)?"/superset/explore_json/":"/explore/"}function C(e,t,n){void 0===t&&(t={}),void 0===n&&(n=!1);const r=new(s())("/"),a=S(e),o=r.search(!0);return Object.keys(t).forEach((e=>{o[e]=t[e]})),e===f.KD.standalone.name&&(n&&(o.force="1"),o.standalone=_._B.HIDE_NAV),r.directory(a).search(o).toString()}function Z(e){let{path:t,qs:n,allowDomainSharding:r=!1}=e,a=new(s())({protocol:window.location.protocol.slice(0,-1),hostname:E(r),port:window.location.port?window.location.port:"",path:t});return n&&(a=a.search(n)),a}function A(e){let{formData:t,endpointType:n="base",force:r=!1,curUrl:a=null,requestParams:o={},allowDomainSharding:i=!1,method:l="POST"}=e;if(!t.datasource)return null;delete t.label_colors;let c=Z({path:"/",allowDomainSharding:i});a&&(c=s()(s()(a).search()));const d=S(n),u=c.search(!0),{slice_id:p,extra_filters:h,adhoc_filters:g,viz_type:v}=t;if(p){const e={slice_id:p};"GET"===l&&(e.viz_type=v,h&&h.length&&(e.extra_filters=h),g&&g.length&&(e.adhoc_filters=g)),u.form_data=(0,m.o)(e)}r&&(u.force="true"),"csv"===n&&(u.csv="true"),n===f.KD.standalone.name&&(u.standalone="1"),"query"===n&&(u.query="true"),"results"===n&&(u.results="true"),"samples"===n&&(u.samples="true");const _=Object.keys(o);return _.length&&_.forEach((e=>{o.hasOwnProperty(e)&&(u[e]=o[e])})),c.search(u).directory(d).toString()}const x=e=>{var t,n;const r=(0,l.Z)().get(e.viz_type);return[null!=(t=null==r?void 0:r.useLegacyApi)&&t,null!=(n=null==r?void 0:r.parseMethod)?n:"json-bigint"]},w=e=>{var t;let{formData:n,force:r,resultFormat:a,resultType:o,setDataMask:i,ownState:s}=e;return(null!=(t=(0,c.Z)().get(n.viz_type))?t:e=>(0,d.Z)(e,(e=>[{...e}])))({...n,force:r,result_format:a,result_type:o},{ownState:s,hooks:{setDataMask:i}})},R=e=>{let{resultType:t,resultFormat:n}=e;return"csv"===n?n:t},I=e=>{let t,n,{formData:r,resultFormat:a="json",resultType:o="full",force:i=!1,ownState:s={}}=e;const[l,c]=x(r);l?(t=A({formData:r,endpointType:R({resultFormat:a,resultType:o}),allowDomainSharding:!1}),n=r):(t="/api/v1/chart/data",n=w({formData:r,force:i,resultFormat:a,resultType:o,ownState:s,parseMethod:c})),u.Z.postForm(t,{form_data:(0,m.o)(n)})},D=(e,t)=>{const n=A({formData:e,endpointType:"base",allowDomainSharding:!1,requestParams:t});u.Z.postForm(n,{form_data:(0,m.o)(e)})},O=(e,t,n)=>{const r=(0,o.useCallback)(e,n);(0,o.useEffect)((()=>{const e=setTimeout((()=>{r()}),t);return()=>{clearTimeout(e)}}),[r,t])},L=(e,t,n)=>{var r;const a=[...v.qK].map((e=>v.LT[e].operation)).indexOf(t)>=0;let o="object"==typeof e?null!=(r=null==e?void 0:e.column_name)?r:"":null!=e?e:"";if(e&&t){o+=` ${t}`;const e=a&&Array.isArray(n)?n[0]:n,r=(0,p.Z)(n),i=void 0!==e&&Number.isNaN(Number(e)),s=i?"'":"",[l,c]=a?["(",")"]:["",""],d=r.map((e=>(0,g.lo)(e))).map((e=>`${s}${i?String(e).replace("'","''"):e}${s}`));r.length>0&&(o+=` ${l}${d.join(", ")}${c}`)}return o};function N(e){return e.map((e=>[e,e.toString()]))}},35854:(e,t,n)=>{"use strict";n.d(t,{R3:()=>i,oN:()=>s});var r=n(37687),a=n(10331),o=n(92252);function i(e,t){var n;const o={...t},i=o.viz_type||(null==(n=e.common)?void 0:n.conf.DEFAULT_VIZ_TYPE)||"table";!function(e){e.y_axis_zero&&(e.y_axis_bounds=[0,null])}(o);const s=(0,a.mi)(i,e.datasource.type,e,o),l=(0,r.Z)().get(i)||{};return l.onInit?l.onInit(s):s}function s(e){const t=e.datasource.split("__")[1],n=e.viz_type,r=(0,a.mi)(n,t,null,e),o=(0,a.Hu)(r),i={};return Object.keys(r).concat(Object.keys(e)).forEach((t=>{void 0===e[t]?i[t]=o[t]:i[t]=e[t]})),i}const l={...o.ai};Object.keys(o.ai).forEach((e=>{l[e].value=o.ai[e].default})),(0,a.Hu)(l)},10945:(e,t,n)=>{"use strict";n.d(t,{DT:()=>i,J_:()=>o,S4:()=>c,dS:()=>l,m7:()=>d,qy:()=>s});var r=n(55867);function a(e){return Object.keys(e).reduce(((e,t)=>{const n=e;return n[t]=t,n}),{})}const o={FORMULA:{value:"FORMULA",label:(0,r.t)("Formula")},EVENT:{value:"EVENT",label:(0,r.t)("Event"),supportNativeSource:!0},INTERVAL:{value:"INTERVAL",label:(0,r.t)("Interval"),supportNativeSource:!0},TIME_SERIES:{value:"TIME_SERIES",label:(0,r.t)("Time series")}},i=a(o),s=i.FORMULA,l={NATIVE:{value:"NATIVE",label:"Superset annotation"}},c=a(l);function d(e){return!!e}},61358:(e,t,n)=>{"use strict";n.d(t,{Aw:()=>u,Dr:()=>g,J8:()=>h,M:()=>v,MZ:()=>b,Me:()=>f,_M:()=>_,cq:()=>m,jt:()=>d});var r=n(41609),a=n.n(r),o=n(31069),i=n(55867),s=n(15926),l=n.n(s),c=n(72570);const d="SET_REPORT";function u(e){let{userId:t,filterField:n,creationMethod:r,resourceId:a}=e;const s=l().encode({filters:[{col:n,opr:"eq",value:a},{col:"creation_method",opr:"eq",value:r},{col:"created_by",opr:"rel_o_m",value:t}]});return function(e){return o.Z.get({endpoint:`/api/v1/report/?q=${s}`}).then((t=>{let{json:o}=t;e(function(e,t,n,r){return{type:d,report:e,resourceId:t,creationMethod:n,filterField:r}}(o,a,r,n))})).catch((()=>e((0,c.Gb)((0,i.t)("There was an issue fetching reports attached to this dashboard.")))))}}const p=(e,t)=>{const n=t(),{user:r,dashboardInfo:o,charts:i,explore:s}=n;if(a()(o)){var l;const[t]=Object.keys(i);e(u({userId:(null==(l=s.user)?void 0:l.userId)||(null==r?void 0:r.userId),filterField:"chart_id",creationMethod:"charts",resourceId:i[t].id}))}else e(u({userId:r.userId,filterField:"dashboard_id",creationMethod:"dashboards",resourceId:o.id}))},h="ADD_REPORT",m=e=>t=>o.Z.post({endpoint:"/api/v1/report/",jsonPayload:e}).then((e=>{let{json:n}=e;t({type:h,json:n}),t((0,c.ws)((0,i.t)("The report has been created")))})),g="EDIT_REPORT",f=(e,t)=>n=>o.Z.put({endpoint:`/api/v1/report/${e}`,jsonPayload:t}).then((e=>{let{json:t}=e;n({type:g,json:t}),n((0,c.ws)((0,i.t)("Report updated")))}));function v(e,t){return function(n){return o.Z.put({endpoint:encodeURI(`/api/v1/report/${e.id}`),headers:{"Content-Type":"application/json"},body:JSON.stringify({active:t})}).catch((()=>{n((0,c.Gb)((0,i.t)("We were unable to active or deactivate this report.")))})).finally((()=>{n(p)}))}}const _="DELETE_REPORT";function b(e){return function(t){return o.Z.delete({endpoint:encodeURI(`/api/v1/report/${e.id}`)}).catch((()=>{t((0,c.Gb)((0,i.t)("Your report could not be deleted")))})).finally((()=>{t({type:_,report:e}),t((0,c.ws)((0,i.t)("Deleted: %s",e.name)))}))}}},79217:(e,t,n)=>{"use strict";n.d(t,{z:()=>r});const r=e=>{var t;return{columns:e.columns,name:(null==e?void 0:e.datasource_name)||(null==e?void 0:e.name)||"Untitled",dbId:(null==e||null==(t=e.database)?void 0:t.id)||(null==e?void 0:e.dbId),sql:(null==e?void 0:e.sql)||"",schema:null==e?void 0:e.schema}}},44814:(e,t,n)=>{"use strict";n.d(t,{zO:()=>i,zQ:()=>o});var r=n(30381),a=n.n(r);const o=function(e,t,n){void 0===n&&(n="HH:mm:ss.SS");const r=t-e;return a()(new Date(r)).utc().format(n)},i=function(){return a()().utc().valueOf()}},86374:(e,t,n)=>{"use strict";n.d(t,{X:()=>o,_:()=>i});var r=n(93185),a=n(20292);const o=function(){if(!document.getElementById("app"))return[];const e=new Set([window.location.hostname]);if("1"===new URLSearchParams(window.location.search).get("disableDomainSharding"))return Array.from(e);const t=(0,a.Z)();return(0,r.fG)(t.common.feature_flags),t&&t.common&&t.common.conf&&t.common.conf.SUPERSET_WEBSERVER_DOMAINS&&t.common.conf.SUPERSET_WEBSERVER_DOMAINS.forEach((t=>{e.add(t)})),Array.from(e)}(),i=o.length>1},16454:(e,t,n)=>{"use strict";n.r(t),n.d(t,{TIME_RANGE:()=>he,default:()=>ve});var r=n(23279),a=n.n(r),o=n(78580),i=n.n(o),s=n(67294),l=n(45697),c=n.n(l),d=n(4065),u=n(5872),p=n.n(u),h=n(82492),m=n.n(h),g=n(48533),f=n(75912),v=n(95742),_=n(80454),b=n.n(_),y=n(51995),E=n(37789),T=n(12766),S=n(320),C=n(74061),Z=n(11965);function A(e){let{children:t,...n}=e;const{maxHeight:r,selectProps:a,theme:o,getStyles:i,cx:l,innerRef:c,isMulti:d,className:u}=n,{windowListRef:p,windowListInnerRef:h}=a,m=(0,s.useRef)(null),g=p||m;let{optionHeight:f}=a;f||(f=o?function(e){let{spacing:{baseUnit:t,lineHeight:n}}=e;return 4*t+n}(o):30);const v=f*t.length;return(0,s.useEffect)((()=>{const e=function(e){return Array.isArray(e)?e.findIndex((e=>{let{props:{isFocused:t=!1}={}}=e;return t}))||0:-1}(t);g.current&&e&&g.current.scrollToItem(e)}),[t,g]),(0,Z.tZ)(C.t7,{css:i("menuList",n),className:l({"menu-list":!0,"menu-list--is-multi":d},u),ref:g,outerRef:c,innerRef:h,height:Math.min(v,r),width:"100%",itemData:t,itemCount:t.length,itemSize:f},(e=>{let{data:t,index:n,style:r}=e;return(0,Z.tZ)("div",{style:r},t[n])}))}const{MenuList:x}=g.F,w=100;function R(e){let{children:t,...n}=e;const{windowThreshold:r=w}=n.selectProps;return Array.isArray(t)&&t.length>r?(0,Z.tZ)(A,n,t):(0,Z.tZ)(x,n,t)}function I(e){return(0,s.forwardRef)(((t,n)=>{const{components:r={},...a}=t,o={...r,MenuList:R};return(0,Z.tZ)(e,p()({components:o,ref:n},a))}))}const D=I(E.ZP),O=I(T.ZP),L=I(S.Z),N="Select",M="Select",k=e=>({primary:e.colors.success.base,danger:e.colors.error.base,warning:e.colors.warning.base,indicator:e.colors.info.base,almostBlack:e.colors.grayscale.dark1,grayDark:e.colors.grayscale.dark1,grayLight:e.colors.grayscale.light2,gray:e.colors.grayscale.light1,grayBg:e.colors.grayscale.light4,grayBgDarker:e.colors.grayscale.light3,grayBgDarkest:e.colors.grayscale.light2,grayHeading:e.colors.grayscale.light1,menuHover:e.colors.grayscale.light3,lightest:e.colors.grayscale.light5,darkest:e.colors.grayscale.dark2,grayBorder:e.colors.grayscale.light2,grayBorderLight:e.colors.grayscale.light3,grayBorderDark:e.colors.grayscale.light1,textDefault:e.colors.grayscale.dark1,textDarkest:e.colors.grayscale.dark2,dangerLight:e.colors.error.light1}),P={container:(e,t)=>{let{theme:{spacing:{minWidth:n}}}=t;return[e,Z.iv`
      min-width: ${n};
    `]},placeholder:e=>[e,Z.iv`
      white-space: nowrap;
    `],indicatorSeparator:()=>Z.iv`
    display: none;
  `,indicatorsContainer:e=>[e,Z.iv`
      i {
        width: 1em;
        display: inline-block;
      }
    `],clearIndicator:e=>[e,Z.iv`
      padding: 4px 0 4px 6px;
    `],control:(e,t)=>{let{isFocused:n,menuIsOpen:r,theme:{borderRadius:a,colors:o}}=t;const i=n&&!r;let s=o.grayBorder;return(i||r)&&(s=o.grayBorderDark),[e,Z.iv`
        border-color: ${s};
        box-shadow: ${i?"inset 0 1px 1px rgba(0,0,0,.075), 0 0 0 3px rgba(0,0,0,.1)":"none"};
        border-radius: ${r?`${a}px ${a}px 0 0`:`${a}px`};
        &:hover {
          border-color: ${s};
          box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);
        }
        flex-wrap: nowrap;
        padding-left: 1px;
      `]},menu:(e,t)=>{let{theme:{zIndex:n}}=t;return[e,Z.iv`
      padding-bottom: 2em;
      z-index: ${n}; /* override at least multi-page pagination */
      width: auto;
      min-width: 100%;
      max-width: 80vw;
      background: none;
      box-shadow: none;
      border: 0;
    `]},menuList:(e,t)=>{let{theme:{borderRadius:n,colors:r}}=t;return[e,Z.iv`
      background: ${r.lightest};
      border-radius: 0 0 ${n}px ${n}px;
      border: 1px solid ${r.grayBorderDark};
      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);
      margin-top: -1px;
      border-top-color: ${r.grayBorderLight};
      min-width: 100%;
      width: auto;
      border-radius: 0 0 ${n}px ${n}px;
      padding-top: 0;
      padding-bottom: 0;
    `]},option:(e,t)=>{let{isDisabled:n,isFocused:r,isSelected:a,theme:{colors:o,spacing:{lineHeight:i,fontSize:s},weights:l}}=t,c=o.textDefault,d=o.lightest;return r?d=o.grayBgDarker:n&&(c="#ccc"),[e,Z.iv`
        cursor: pointer;
        line-height: ${i}px;
        font-size: ${s}px;
        background-color: ${d};
        color: ${c};
        font-weight: ${a?l.bold:l.normal};
        white-space: nowrap;
        &:hover:active {
          background-color: ${o.grayBg};
        }
      `]},valueContainer:(e,t)=>{let{isMulti:n,hasValue:r,theme:{spacing:{baseUnit:a}}}=t;return[e,Z.iv`
      padding-left: ${n&&r?1:3*a}px;
    `]},multiValueLabel:(e,t)=>{let{theme:{spacing:{baseUnit:n}}}=t;return{...e,paddingLeft:1.2*n,paddingRight:1.2*n}},input:(e,t)=>{var n;let{selectProps:r}=t;return[e,Z.iv`
      margin-left: 0;
      vertical-align: middle;
      ${null!=r&&r.isMulti&&null!=r&&null!=(n=r.value)&&n.length?"padding: 0 6px; width: 100%":"padding: 0; flex: 1 1 auto;"};
    `]},menuPortal:e=>({...e,zIndex:1030})},F={background:"none",border:"none",outline:"none",padding:0},{ClearIndicator:U,DropdownIndicator:$,Option:q,Input:V,SelectContainer:j}=g.F,H={SelectContainer:e=>{let{children:t,...n}=e;const{selectProps:{assistiveText:r}}=n;return(0,Z.tZ)("div",null,(0,Z.tZ)(j,n,t),r&&(0,Z.tZ)("span",{css:e=>({marginLeft:3,fontSize:e.typography.sizes.s,color:e.colors.grayscale.light1})},r))},Option:e=>{let{children:t,innerProps:n,data:r,...a}=e;return(0,Z.tZ)(q,p()({},a,{data:r,css:null!=r&&r.style?r.style:null,innerProps:n}),t)},ClearIndicator:e=>(0,Z.tZ)(U,e,(0,Z.tZ)("i",{className:"fa"},"")),DropdownIndicator:e=>(0,Z.tZ)($,e,(0,Z.tZ)("i",{className:"fa fa-caret-"+(e.selectProps.menuIsOpen?"up":"down")})),Input:e=>{const{getStyles:t}=e;return(0,Z.tZ)(V,p()({},e,{css:t("input",e),autoComplete:"chrome-off",inputStyle:F}))}},B={valueContainer:(e,t)=>{let{getValue:n,theme:{spacing:{baseUnit:r}},isMulti:a}=t;return{...e,paddingLeft:n().length>0?1:3*r,overflow:a&&n().length>0?"visible":"hidden"}},singleValue:(e,t)=>{const{getStyles:n}=t;return{...n("multiValue",t),".metric-option":n("multiValueLabel",t)}}};function z(e){const t=(0,v.JN)(e,{withRef:!0}),n=H;function r(r){let a;const{selectRef:o,labelKey:i="label",valueKey:s="value",themeConfig:l,stylesConfig:c={},optionRenderer:d,valueRenderer:u,valueRenderedAsLabel:h,onPaste:_,multi:E=!1,clearable:T,sortable:S=!0,forceOverflow:C,className:A=N,classNamePrefix:x=M,options:w,value:R,components:I,isMulti:D,isClearable:L,minMenuHeight:F=100,maxMenuHeight:U=220,filterOption:$,ignoreAccents:q=!1,asText:V=(e=>String(null!=e?e:"")),getOptionValue:j=(e=>"string"==typeof e?e:e[s]),getOptionLabel:H=(e=>"string"==typeof e?e:V(e[i])||V(e[s])),formatOptionLabel:z=((e,t)=>{let{context:n}=t;return"value"===n?u?u(e):H(e):d?d(e):H(e)}),...G}=r,Q=function(e,t,n){if(void 0===t&&(t=[]),void 0===n&&(n="value"),null==e||""===e)return[];const r=Array.isArray((t[0]||{}).options)?t.flatMap((e=>e.options||[])):t;return(Array.isArray(e)?e:[e]).map((t=>{const a=(e||{}).hasOwnProperty(n)?t[n]:t;return r.find((e=>e===a||e[n]===a))||t}))}(R,w||[],s),Y=void 0===D?E:D,K=void 0===L?T:L,W=Y&&S&&Array.isArray(Q)&&Q.length>1,J=W?t:e,X={...n,...I};if(W){X.MultiValue=(ee=X.MultiValue||g.F.MultiValue,(0,v.W8)((e=>(0,Z.tZ)(ee,p()({},e,{innerProps:{onMouseDown:e=>{e.preventDefault(),e.stopPropagation()}}})))));const e={getHelperDimensions:e=>{let{node:t}=e;return t.getBoundingClientRect()},axis:"xy",onSortEnd:e=>{let{oldIndex:t,newIndex:n}=e;const r=b()(Q,t,n);G.onChange&&G.onChange(r,{action:"set-value"})},distance:4};Object.assign(G,e)}var ee;if((void 0===h?Y:h)&&!c.valueContainer&&Object.assign(c,B),_){const e=X.Input||g.F.Input;X.Input=t=>(0,Z.tZ)(e,p()({},t,{onPaste:_}))}e===O&&(G.getNewOptionData=(e,t)=>({label:t||e,[s]:e,isNew:!0})),C&&Object.assign(G,{closeMenuOnScroll:e=>{var t,n,r;const o=null==(t=a)||null==(n=t.state)?void 0:n.menuIsOpen,i=e.target;return o&&i&&!(null!=(r=i.classList)&&r.contains("Select__menu-list"))},menuPosition:"fixed"});const te=(0,y.Fg)();return(0,Z.tZ)(J,p()({ref:e=>{a=W&&e&&"refs"in e?e.refs.wrappedInstance:e,"function"==typeof o?o(a):o&&"current"in o&&(o.current=a)},className:A,classNamePrefix:x,isMulti:Y,isClearable:K,options:w,value:Q,minMenuHeight:F,maxMenuHeight:U,filterOption:void 0!==$?$:(0,f.c)({ignoreAccents:q}),styles:{...P,...c},theme:e=>m()(e,(e=>({borderRadius:e.borderRadius,zIndex:11,colors:k(e),spacing:{baseUnit:3,menuGutter:0,controlHeight:34,lineHeight:19,fontSize:14,minWidth:"6.5em"},weights:e.typography.weights}))(te),l),formatOptionLabel:z,getOptionLabel:H,getOptionValue:j,components:X},G))}return s.memo(r)}const G=z(D),Q=z(O),Y=z(L);class K extends s.Component{constructor(e){super(e),this.onPaste=this.onPaste.bind(this)}onPaste(e){if(!this.props.isMulti)return;e.preventDefault();const t=e.clipboardData.getData("Text");if(!t)return;const n=`[${this.props.separator}]+`,r=t.split(new RegExp(n)).map((e=>e.trim())),a=this.props.isValidNewOption,o=this.props.value||[],i={},s={};this.props.options.forEach((e=>{i[e[this.props.valueKey]]=1}));let l=[];o.forEach((e=>{l.push({[this.props.labelKey]:e,[this.props.valueKey]:e}),s[e]=1})),l=l.concat(r.filter((e=>{const t=!s[e];return s[e]=1,t&&(a?a({[this.props.labelKey]:e}):!!e)})).map((e=>{const t={[this.props.labelKey]:e,[this.props.valueKey]:e};return i[e]||this.props.options.unshift(t),t}))),l.length&&this.props.onChange&&this.props.onChange(l)}render(){const{selectWrap:e,...t}=this.props;return(0,Z.tZ)(e,p()({},t,{onPaste:this.onPaste}))}}K.propTypes={separator:c().array,selectWrap:c().elementType,selectRef:c().func,onChange:c().func.isRequired,valueKey:c().string,labelKey:c().string,options:c().array,isMulti:c().bool,value:c().any,isValidNewOption:c().func,noResultsText:c().string,forceOverflow:c().bool},K.defaultProps={separator:[",","\n","\t",";"],selectWrap:G,valueKey:"value",labelKey:"label",options:[],isMulti:!1};var W=n(64749);const J=(0,y.iK)((e=>(0,Z.tZ)(W.default,p()({getPopupContainer:e=>e.parentNode},e))))`
  display: block;
`,X=(0,y.iK)(W.default)`
  &.ant-select-single {
    .ant-select-selector {
      height: 36px;
      padding: 0 11px;
      background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light3}};
      border: none;

      .ant-select-selection-search-input {
        height: 100%;
      }

      .ant-select-selection-item,
      .ant-select-selection-placeholder {
        line-height: 35px;
        color: ${e=>{let{theme:t}=e;return t.colors.grayscale.dark1}};
      }
    }
  }
`;Object.assign(J,{Option:W.default.Option}),Object.assign(X,{Option:W.default.Option});var ee=n(35932),te=n(55786),ne=n(31069),re=n(55867),ae=n(68135),oe=n(27600),ie=n(49238),se=n(1090),le=n(61357),ce=n(71839),de=n(92252),ue=n(12515),pe=n(69856);const he=pe.i2.time_range,me={chartId:c().number.isRequired,origSelectedValues:c().object,datasource:c().object.isRequired,instantFiltering:c().bool,filtersFields:c().arrayOf(c().shape({field:c().string,label:c().string})),filtersChoices:c().objectOf(c().arrayOf(c().shape({id:c().string,text:c().string,filter:c().string,metric:c().number}))),onChange:c().func,onFilterMenuOpen:c().func,onFilterMenuClose:c().func,showDateFilter:c().bool,showSqlaTimeGrain:c().bool,showSqlaTimeColumn:c().bool},ge=y.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: flex;\n    flex-direction: column;\n    margin-bottom: ${2*t.gridUnit+2}px;\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    label {\n      display: flex;\n      font-weight: ${t.typography.weights.bold};\n    }\n\n    .filter-badge-container {\n      width: 30px;\n      padding-right: ${2*t.gridUnit+2}px;\n    }\n\n    .filter-badge-container + div {\n      width: 100%;\n    }\n  `}}
`;class fe extends s.PureComponent{constructor(e){super(e),this.onCloseDateFilterControl=()=>this.onFilterMenuClose(he),this.state={selectedValues:e.origSelectedValues,hasChanged:!1},this.debouncerCache={},this.maxValueCache={},this.changeFilter=this.changeFilter.bind(this),this.onFilterMenuOpen=this.onFilterMenuOpen.bind(this),this.onOpenDateFilterControl=this.onOpenDateFilterControl.bind(this),this.onFilterMenuClose=this.onFilterMenuClose.bind(this)}onFilterMenuOpen(e){return this.props.onFilterMenuOpen(this.props.chartId,e)}onFilterMenuClose(e){return this.props.onFilterMenuClose(this.props.chartId,e)}onOpenDateFilterControl(){return this.onFilterMenuOpen(he)}getControlData(e){const{selectedValues:t}=this.state,n={...de.ai[e],name:e,key:`control-${e}`,value:t[pe.i2[e]],actions:{setControlValue:this.changeFilter}},r=n.mapStateToProps;return r?{...n,...r(this.props)}:n}getKnownMax(e,t){return this.maxValueCache[e]=Math.max(this.maxValueCache[e]||0,(0,d.max)(t||this.props.filtersChoices[e]||[],(e=>e.metric))),this.maxValueCache[e]}clickApply(){const{selectedValues:e}=this.state;this.setState({hasChanged:!1},(()=>{this.props.onChange(e,!1)}))}changeFilter(e,t){const n=pe.i2[e]||e;let r=null;var a;if(null!==t)if(Array.isArray(t))r=t.map((e=>"string"==typeof e?e:e.value));else if(i()(a=Object.values(pe.i2)).call(a,n)){var o;r=null!=(o=t.value)?o:t}else{var s;r=(0,te.Z)(null!=(s=t.value)?s:t)}this.setState((e=>({selectedValues:{...e.selectedValues,[n]:r},hasChanged:!0})),(()=>{this.props.instantFiltering&&this.props.onChange({[n]:r},!1)}))}debounceLoadOptions(e){return e in this.debouncerCache||(this.debouncerCache[e]=a()(((t,n)=>{this.loadOptions(e,t).then(n)}),oe.M$)),this.debouncerCache[e]}transformOptions(e,t){const n=void 0===t?(0,d.max)(e,(e=>e.metric)):t;return e.map((e=>{const t=Math.round(e.metric/n*100),r="lightgrey",a={backgroundImage:`linear-gradient(to right, ${r}, ${r} ${t}%, rgba(0,0,0,0) ${t}%`};let o=e.id;return!0===o?o=oe.Ly:!1===o&&(o=oe.gz),{value:e.id,label:o,style:a}}))}async loadOptions(e,t){var n;void 0===t&&(t="");const r=t.toLowerCase(),a=this.props.filtersFields.find((t=>t.key===e)).asc,o={...this.props.rawFormData,adhoc_filters:t?[{clause:"WHERE",expressionType:"SIMPLE",subject:e,operator:"ILIKE",comparator:`%${r}%`}]:null},{json:i}=await ne.Z.get({url:(0,ue.H6)({formData:o,endpointType:"json",method:"GET"})}),s=((null==i||null==(n=i.data)?void 0:n[e])||[]).filter((e=>e.id));return s&&0!==s.length?(r&&s.sort(((e,t)=>{const n=e.id.toLowerCase(),o=t.id.toLowerCase().startsWith(r)-n.startsWith(r);return 0===o?(e.metric-t.metric)*(a?1:-1):o})),this.transformOptions(s,this.getKnownMax(e,s))):[]}renderDateFilter(){const{showDateFilter:e}=this.props,t=pe.m_.time_range;return e?(0,Z.tZ)("div",{className:"row space-1"},(0,Z.tZ)("div",{className:"col-lg-12 col-xs-12"},(0,Z.tZ)(se.ZP,{name:he,label:t,description:(0,re.t)("Select start and end date"),onChange:e=>{this.changeFilter(he,e)},onOpenDateFilterControl:this.onOpenDateFilterControl,onCloseDateFilterControl:this.onCloseDateFilterControl,value:this.state.selectedValues[he]||"No filter",endpoints:["inclusive","exclusive"]}))):null}renderDatasourceFilters(){const{showSqlaTimeGrain:e,showSqlaTimeColumn:t}=this.props,n=[],r=[];return e&&r.push("time_grain_sqla"),t&&r.push("granularity_sqla"),r.length&&n.push((0,Z.tZ)(le.Z,{key:"sqla-filters",controls:r.map((e=>(0,Z.tZ)(ce.Z,this.getControlData(e))))})),n}renderSelect(e){const{filtersChoices:t}=this.props,{selectedValues:n}=this.state;this.debouncerCache={},this.maxValueCache={},Object.keys(n).filter((e=>e in t)).forEach((e=>{if(!n[e])return;const r=t[e]||(t[e]=[]),a=new Set(r.map((e=>e.id)));(Array.isArray(n[e])?n[e]:[n[e]]).filter((e=>null!==e&&!a.has(e))).forEach((t=>{r.unshift({filter:e,id:t,text:t,metric:0})}))}));const{key:r,label:a,[pe.ft.MULTIPLE]:o,[pe.ft.DEFAULT_VALUE]:i,[pe.ft.CLEARABLE]:s,[pe.ft.SEARCH_ALL_OPTIONS]:l}=e,c=t[r]||[];let d=n[r]||null;return void 0===d&&i&&(d=o?i.split(";"):i),(0,Z.tZ)(K,{cacheOptions:!0,loadOptions:this.debounceLoadOptions(r),defaultOptions:this.transformOptions(c),key:r,placeholder:(0,re.t)("Type or Select [%s]",a),isMulti:o,isClearable:s,value:d,options:this.transformOptions(c),onChange:e=>{e!==d&&this.changeFilter(r,e)},onMenuOpen:()=>this.onFilterMenuOpen(r),onBlur:()=>this.onFilterMenuClose(r),onMenuClose:()=>this.onFilterMenuClose(r),selectWrap:l&&c.length>=pe.cM?Y:Q,noResultsText:(0,re.t)("No results found"),forceOverflow:!0})}renderFilters(){const{filtersFields:e=[]}=this.props;return e.map((e=>{const{label:t,key:n}=e;return(0,Z.tZ)(ge,{key:n,className:"filter-container"},(0,Z.tZ)(ie.lX,{htmlFor:`LABEL-${n}`},t),this.renderSelect(e))}))}render(){const{instantFiltering:e,width:t,height:n}=this.props,{zIndex:r,gridUnit:a}=this.props.theme;return(0,Z.tZ)(s.Fragment,null,(0,Z.tZ)(Z.xB,{styles:Z.iv`
            .dashboard .filter_box .slice_container > div:not(.alert) {
              padding-top: 0;
            }

            .filter_box {
              padding: ${2*a+2}px 0;
              overflow: visible !important;

              &:hover {
                z-index: ${r.max};
              }
            }
          `}),(0,Z.tZ)("div",{style:{width:t,height:n,overflow:"auto"}},this.renderDateFilter(),this.renderDatasourceFilters(),this.renderFilters(),!e&&(0,Z.tZ)(ee.Z,{buttonSize:"small",buttonStyle:"primary",onClick:this.clickApply.bind(this),disabled:!this.state.hasChanged},(0,re.t)("Apply"))))}}fe.propTypes=me,fe.defaultProps={origSelectedValues:{},onChange:()=>{},onFilterMenuOpen:()=>{},onFilterMenuClose:()=>{},showDateFilter:!1,showSqlaTimeGrain:!1,showSqlaTimeColumn:!1,instantFiltering:!1};const ve=(0,ae.b)(fe)},74082:e=>{const t=[null];e.exports=t.length<=1?t[0]:t},61819:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(21804),a=n.n(r),o=(n(67294),n(51995)),i=n(55867),s=n(51776),l=n(11965);const c=o.iK.div`
  margin-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,d=function(e){let{certifiedBy:t,details:n,metricName:r}=e;const d=(0,o.Fg)();return(0,l.tZ)(s.Z,{id:`${a()(r)}-tooltip`,title:(0,l.tZ)("div",null,t&&(0,l.tZ)(c,null,(0,i.t)("Certified by %s",t)),(0,l.tZ)("div",null,n))},(0,l.tZ)("svg",{xmlns:"http://www.w3.org/2000/svg",enableBackground:"new 0 0 24 24",height:"14",viewBox:"0 0 24 24",width:"14"},(0,l.tZ)("g",null,(0,l.tZ)("path",{fill:d.colors.primary.base,d:"M23,12l-2.44-2.79l0.34-3.69l-3.61-0.82L15.4,1.5L12,2.96L8.6,1.5L6.71,4.69L3.1,5.5L3.44,9.2L1,12l2.44,2.79l-0.34,3.7 l3.61,0.82L8.6,22.5l3.4-1.47l3.4,1.46l1.89-3.19l3.61-0.82l-0.34-3.69L23,12z M9.38,16.01L7,13.61c-0.39-0.39-0.39-1.02,0-1.41 l0.07-0.07c0.39-0.39,1.03-0.39,1.42,0l1.61,1.62l5.15-5.16c0.39-0.39,1.03-0.39,1.42,0l0.07,0.07c0.39,0.39,0.39,1.02,0,1.41 l-5.92,5.94C10.41,16.4,9.78,16.4,9.38,16.01z"}))))}},65634:(e,t,n)=>{"use strict";n.d(t,{E:()=>p});var r=n(67294),a=n(51995),o=n(11965),i=n(51776),s=n(63351),l=n(61819),c=n(71963),d=n(60605);const u=a.iK.span`
  display: flex;
  align-items: center;
  svg {
    margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`;function p(e){let{column:t,labelRef:n,showType:a=!1}=e;const{expression:p,column_name:h,type_generic:m}=t,g=p&&p!==h,f=g?"expression":m,[v,_]=(0,r.useState)(t.column_name),[b,y]=(0,r.useState)(t.type);return(0,r.useLayoutEffect)((()=>{_((0,c.ZK)(t,n)),y((0,c.GX)(t))}),[n,t]),(0,o.tZ)(u,null,a&&void 0!==f&&(0,o.tZ)(i.u,{id:"metric-type-tooltip",title:b,placement:"bottomRight",align:{offset:[8,-2]}},(0,o.tZ)("span",null,(0,o.tZ)(s.j,{type:f}))),(0,o.tZ)(i.u,{id:"metric-name-tooltip",title:v},(0,o.tZ)("span",{className:"option-label column-option-label",css:e=>o.iv`
            margin-right: ${e.gridUnit}px;
          `,ref:n},(0,c.ok)(t))),g&&(0,o.tZ)(d.Z,{sqlExpression:p}),t.is_certified&&(0,o.tZ)(l.Z,{metricName:t.metric_name,certifiedBy:t.certified_by,details:t.certification_details}))}},63351:(e,t,n)=>{"use strict";n.d(t,{j:()=>x,Z:()=>w});var r,a=n(67294),o=n(51995),i=n(11965),s=n(55867),l=n(88889),c=n(63270),d=n(30071);function u(){return u=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u.apply(this,arguments)}function p(e,t){let{title:n,titleId:o,...i}=e;return a.createElement("svg",u({width:24,height:24,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":o},i),n?a.createElement("title",{id:o},n):null,r||(r=a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M6.988 10.809l-1.031 4.84c-.184.867-.57 1.576-1.16 2.126-.59.551-1.197.827-1.822.827-.344 0-.597-.066-.76-.197a.61.61 0 01-.242-.495.7.7 0 01.152-.445c.102-.13.248-.194.44-.194.12 0 .227.028.319.082a.978.978 0 01.243.206c.055.066.116.156.185.27l.178.292c.301-.023.558-.226.77-.61.214-.382.398-.929.554-1.64l1.079-5.062H4.75l.123-.534h1.13l.083-.398c.094-.453.242-.861.445-1.225.203-.363.434-.672.692-.925.254-.25.542-.447.864-.59.322-.142.632-.213.929-.213.343 0 .596.065.758.196a.61.61 0 01.244.495.727.727 0 01-.144.446c-.096.128-.245.193-.448.193a.614.614 0 01-.317-.08.895.895 0 01-.24-.207 1.921 1.921 0 01-.187-.276 3.843 3.843 0 00-.176-.287c-.27.012-.508.19-.715.534-.207.343-.395.916-.562 1.716l-.13.621H8.57l-.123.534H6.988zm2.225 2.261c0-1.758.45-3.183 1.387-4.424h.713c-.694.89-1.236 2.774-1.236 4.424 0 1.66.537 3.54 1.236 4.429H10.6c-.938-1.24-1.387-2.666-1.387-4.429zm5.288.957h-.078l-1.25 1.988h-.952l1.802-2.632L12.2 10.75h1.001l1.25 1.958h.078l1.236-1.958h.952l-1.787 2.598 1.811 2.666h-.996l-1.245-1.988zm5.23-.952c0 1.758-.45 3.184-1.387 4.424h-.713c.693-.889 1.235-2.773 1.235-4.424 0-1.66-.537-3.54-1.235-4.429h.713c.937 1.24 1.386 2.666 1.386 4.43z",fill:"currentColor"})))}const h=a.forwardRef(p);var m;function g(){return g=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},g.apply(this,arguments)}function f(e,t){let{title:n,titleId:r,...o}=e;return a.createElement("svg",g({width:24,height:24,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},o),n?a.createElement("title",{id:r},n):null,m||(m=a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 4h-1v16h1V4zm3.248 8.475c0 2.343.913 3.691 2.5 3.691 1.582 0 2.49-1.338 2.49-3.677 0-2.334-.923-3.7-2.49-3.7-1.577 0-2.5 1.361-2.5 3.686zM5.579 9.93V16h.879V8.954h-.874l-1.875 1.348v.928l1.792-1.3h.078zm12.169 5.468c1.04 0 1.607-1.035 1.607-2.924 0-1.87-.577-2.915-1.607-2.915s-1.616 1.054-1.616 2.915c0 1.884.576 2.924 1.616 2.924z",fill:"currentColor"})))}const v=a.forwardRef(f);var _;function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},b.apply(this,arguments)}function y(e,t){let{title:n,titleId:r,...o}=e;return a.createElement("svg",b({width:24,height:24,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},o),n?a.createElement("title",{id:r},n):null,_||(_=a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M5.91 16.14c-1.14 0-2.047-.671-2.047-1.843 0-1.375 1.215-1.621 2.328-1.766 1.094-.14 1.547-.117 1.547-.562 0-.778-.41-1.235-1.265-1.235-.88 0-1.36.47-1.563.907l-.875-.313c.469-1.094 1.5-1.406 2.406-1.406.766 0 2.22.219 2.22 2.125V16h-.923v-.813h-.047c-.187.391-.734.954-1.78.954zm.14-.828c1.095 0 1.688-.734 1.688-1.484v-.844c-.156.188-1.203.297-1.593.344-.72.094-1.36.313-1.36 1.016 0 .64.531.969 1.266.969zM9.799 16V8h.921v2.953h.079c.203-.312.562-1.031 1.734-1.031 1.516 0 2.563 1.203 2.563 3.094 0 1.906-1.047 3.109-2.547 3.109-1.157 0-1.547-.719-1.75-1.047h-.11V16h-.89zm.906-3c0 1.36.61 2.297 1.719 2.297 1.156 0 1.75-1.016 1.75-2.297 0-1.266-.579-2.25-1.75-2.25-1.125 0-1.72.906-1.72 2.25zm7.684 3.125c-1.687 0-2.719-1.297-2.719-3.094 0-1.828 1.079-3.11 2.704-3.11 1.265 0 2.218.75 2.375 1.876h-.922c-.14-.547-.625-1.047-1.438-1.047-1.078 0-1.797.89-1.797 2.25 0 1.39.703 2.297 1.797 2.297.719 0 1.266-.39 1.438-1.047h.922c-.157 1.063-1.032 1.875-2.36 1.875z",fill:"currentColor"})))}const E=a.forwardRef(y);var T;function S(){return S=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},S.apply(this,arguments)}function C(e,t){let{title:n,titleId:r,...o}=e;return a.createElement("svg",S({width:24,height:24,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":r},o),n?a.createElement("title",{id:r},n):null,T||(T=a.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M10 8h1v2h2V8h1v2h2v1h-2v2h2v1h-2v2h-1v-2h-2v2h-1v-2H8v-1h2v-2H8v-1h2V8zm3 5v-2h-2v2h2z",fill:"currentColor"})))}const Z=a.forwardRef(C),A=o.iK.div`
  ${e=>{let{theme:t}=e;return i.iv`
    display: flex;
    justify-content: center;
    align-items: center;
    width: ${6*t.gridUnit}px;
    height: ${6*t.gridUnit}px;
    margin-right: ${t.gridUnit}px;

    && svg {
      margin-right: 0;
      margin-left: 0;
      width: 100%;
      height: 100%;
    }
  `}};
`;function x(e){let{type:t}=e,n=(0,i.tZ)(c.Z,{"aria-label":(0,s.t)("unknown type icon")});return""===t||"expression"===t?n=(0,i.tZ)(h,{"aria-label":(0,s.t)("function type icon")}):t===l.Z.STRING?n=(0,i.tZ)(E,{"aria-label":(0,s.t)("string type icon")}):t===l.Z.NUMERIC?n=(0,i.tZ)(Z,{"aria-label":(0,s.t)("numeric type icon")}):t===l.Z.BOOLEAN?n=(0,i.tZ)(v,{"aria-label":(0,s.t)("boolean type icon")}):t===l.Z.TEMPORAL&&(n=(0,i.tZ)(d.Z,{"aria-label":(0,s.t)("temporal type icon")})),(0,i.tZ)(A,null,n)}const w=x},46666:(e,t,n)=>{"use strict";n.d(t,{U:()=>r});const r=n(51995).iK.div`
  font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}};
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`},9882:(e,t,n)=>{"use strict";n.d(t,{V:()=>l,Z:()=>c});var r=n(21804),a=n.n(r),o=(n(67294),n(55867)),i=n(51776),s=n(11965);function l(e){let{label:t,tooltip:n,bsStyle:r,onClick:l,icon:c="info-circle",className:d="text-muted",placement:u="right",iconsStyle:p={}}=e;const h=`fa fa-${c} ${d} ${r?`text-${r}`:""}`,m=(0,s.tZ)("i",{role:"button","aria-label":(0,o.t)("Show info tooltip"),tabIndex:0,className:h,style:{cursor:l?"pointer":void 0,...p},onClick:l,onKeyPress:l&&(e=>{"Enter"!==e.key&&" "!==e.key||l()})});return n?(0,s.tZ)(i.u,{id:`${a()(t)}-tooltip`,title:n,placement:u},m):m}const c=l},51384:(e,t,n)=>{"use strict";n.d(t,{m:()=>m});var r=n(67294),a=n(51995),o=n(11965),i=n(78186),s=n(9882),l=n(63351),c=n(61819),d=n(51776),u=n(71963),p=n(60605);const h=a.iK.div`
  align-items: center;
  display: flex;

  > svg {
    margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`;function m(e){let{metric:t,labelRef:n,openInNewWindow:a=!1,showFormula:m=!0,showType:g=!1,shouldShowTooltip:f=!0,url:v=""}=e;const _=t.verbose_name||t.metric_name||t.label,b=v?(0,o.tZ)("a",{href:v,target:a?"_blank":"",rel:"noreferrer"},_):_,y=(0,o.tZ)("span",{className:"option-label metric-option-label",css:e=>o.iv`
        margin-right: ${e.gridUnit}px;
      `,ref:n},b),E=t.warning_markdown||t.warning_text,[T,S]=(0,r.useState)(t.metric_name);return(0,r.useLayoutEffect)((()=>{S((0,u.Lk)(t,n))}),[n,t]),(0,o.tZ)(h,{className:"metric-option"},g&&(0,o.tZ)(l.j,{type:"expression"}),f?(0,o.tZ)(d.Z,{id:"metric-name-tooltip",title:T},y):y,m&&t.expression&&(0,o.tZ)(p.Z,{sqlExpression:t.expression}),t.is_certified&&(0,o.tZ)(c.Z,{metricName:t.metric_name,certifiedBy:t.certified_by,details:t.certification_details}),E&&(0,o.tZ)(s.Z,{className:"text-warning",icon:"warning",tooltip:(0,o.tZ)(i.Z,{source:E}),label:`warn-${t.metric_name}`,iconsStyle:{marginLeft:0}}))}},60605:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(5872),a=n.n(r),o=(n(67294),n(19181)),i=n(74981),s=n(85369),l=n(51995),c=n(11965),d=n(55867);n(89899);const u=(0,l.iK)(s.Z)`
  ${e=>{let{theme:t}=e;return c.iv`
    color: ${t.colors.grayscale.base};
    font-size: ${t.typography.sizes.s}px;
    & svg {
      margin-left: ${t.gridUnit}px;
      margin-right: ${t.gridUnit}px;
    }
  `}}
`,p=e=>{const t=(0,l.Fg)();return(0,c.tZ)(o.Z,a()({content:(0,c.tZ)(i.default,{mode:"sql",value:e.sqlExpression,editorProps:{$blockScrolling:!0},setOptions:{highlightActiveLine:!1,highlightGutterLine:!1},minLines:2,maxLines:6,readOnly:!0,wrapEnabled:!0,style:{border:`1px solid ${t.colors.grayscale.light2}`,background:t.colors.secondary.light5,maxWidth:100*t.gridUnit}}),placement:"bottomLeft",arrowPointAtCenter:!0,title:(0,d.t)("SQL expression")},e),(0,c.tZ)(u,null))}},51776:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d,u:()=>c});var r=n(5872),a=n.n(r),o=n(67294),i=n(51995),s=n(11965),l=n(31097);const c=e=>{let{overlayStyle:t,color:n,...r}=e;const c=(0,i.Fg)(),d=`${c.colors.grayscale.dark2}e6`;return(0,s.tZ)(o.Fragment,null,(0,s.tZ)(s.xB,{styles:s.iv`
          .ant-tooltip-open {
            display: inline-block;
            &::after {
              content: '';
              display: block;
            }
          }
        `}),(0,s.tZ)(l.Z,a()({overlayStyle:{fontSize:c.typography.sizes.s,lineHeight:"1.6",maxWidth:62*c.gridUnit,minWidth:30*c.gridUnit,...t},align:{offset:[0,1]},color:d||n,trigger:"hover",placement:"bottom",mouseLeaveDelay:0},r)))},d=c},71963:(e,t,n)=>{"use strict";n.d(t,{GX:()=>p,Lk:()=>m,ZK:()=>h,ok:()=>u});var r=n(67294),a=n(51995),o=n(11965),i=n(55867);const s=a.iK.div`
  ${e=>{let{theme:t}=e;return o.iv`
    display: flex;
    flex-direction: column;
    font-size: ${t.typography.sizes.s}px;
    line-height: 1.2;

    &:not(:last-of-type) {
      margin-bottom: ${2*t.gridUnit}px;
    }
    &:last-of-type {
      display: -webkit-box;
      -webkit-line-clamp: 40;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  `}}
`,l=a.iK.span`
  ${e=>{let{theme:t}=e;return o.iv`
    font-weight: ${t.typography.weights.bold};
  `}}
`,c=e=>{let{label:t,text:n}=e;return(0,o.tZ)(s,null,(0,o.tZ)(l,null,t),(0,o.tZ)("span",null,n))},d=e=>{var t,n;return!!((null==e||null==(t=e.current)?void 0:t.scrollWidth)>(null==e||null==(n=e.current)?void 0:n.clientWidth))},u=e=>e.verbose_name||e.column_name,p=e=>e.type?(0,o.tZ)(c,{label:(0,i.t)("Column datatype"),text:e.type.toLowerCase()}):null,h=(e,t)=>e.column_name&&e.verbose_name||e.description||d(t)?(0,o.tZ)(r.Fragment,null,e.column_name&&(0,o.tZ)(c,{label:(0,i.t)("Column name"),text:e.column_name}),e.verbose_name&&(0,o.tZ)(c,{label:(0,i.t)("Label"),text:e.verbose_name}),e.description&&(0,o.tZ)(c,{label:(0,i.t)("Description"),text:e.description})):null,m=(e,t)=>e.verbose_name||e.description||e.label||d(t)?(0,o.tZ)(r.Fragment,null,(0,o.tZ)(c,{label:(0,i.t)("Metric name"),text:e.metric_name}),(e.label||e.verbose_name)&&(0,o.tZ)(c,{label:(0,i.t)("Label"),text:e.label||e.verbose_name}),e.description&&(0,o.tZ)(c,{label:(0,i.t)("Description"),text:e.description})):null},35622:(e,t,n)=>{"use strict";n.d(t,{CV:()=>p,DS:()=>d,LU:()=>u,PJ:()=>m,YY:()=>g,ZK:()=>f,cm:()=>h,m_:()=>c});var r=n(55867),a=n(5364),o=n(88889),i=n(46078),s=n(20620),l=n(38575);const c={time_range:(0,r.t)("Time Range"),granularity_sqla:(0,r.t)("Time Column"),time_grain_sqla:(0,r.t)("Time Grain"),granularity:(0,r.t)("Time Granularity")},d={[a.W3]:(0,r.t)("Time")},u={verbose_name:d[a.W3],column_name:a.W3,type_generic:o.Z.TEMPORAL,description:(0,r.t)("A reference to the [Time] configuration, taking granularity into account")},p={column_name:a.W3,type:i.i9.Query,is_dttm:!1},h={[s.n.aggregate]:(0,r.t)("Aggregate"),[s.n.raw]:(0,r.t)("Raw records")},m={sort_series_type:l.Id.Sum,sort_series_ascending:!1},g=[[l.Id.Name,(0,r.t)("Category name")],[l.Id.Sum,(0,r.t)("Total value")],[l.Id.Min,(0,r.t)("Minimum value")],[l.Id.Max,(0,r.t)("Maximum value")],[l.Id.Avg,(0,r.t)("Average value")]],f={sort_series_type:l.Id.Name,sort_series_ascending:!0}},356:(e,t,n)=>{"use strict";n.d(t,{M:()=>W,Z:()=>J});var r=n(11965),a=n(67294),o=n(51995),i=n(55867),s=n(9882),l=n(51776);function c(e){let{name:t,description:n,label:a,tooltipOnClick:o,onClick:c,warning:d,danger:u,leftNode:p,rightNode:h,validationErrors:m=[],renderTrigger:g=!1,hovered:f=!1,required:v=!1}=e;if(!a)return null;const _=m.length>0?"text-danger":"";return(0,r.tZ)("div",{className:"ControlHeader"},(0,r.tZ)("div",{className:"pull-left"},(0,r.tZ)("label",{className:"control-label",htmlFor:t},p&&(0,r.tZ)("span",null,p),(0,r.tZ)("span",{role:"button",tabIndex:0,onClick:c,className:_,style:{cursor:c?"pointer":""}},a)," ",d&&(0,r.tZ)("span",null,(0,r.tZ)(l.u,{id:"error-tooltip",placement:"top",title:d},(0,r.tZ)("i",{className:"fa fa-exclamation-circle text-warning"}))," "),u&&(0,r.tZ)("span",null,(0,r.tZ)(l.u,{id:"error-tooltip",placement:"top",title:u},(0,r.tZ)("i",{className:"fa fa-exclamation-circle text-danger"}))," "),m.length>0&&(0,r.tZ)("span",null,(0,r.tZ)(l.u,{id:"error-tooltip",placement:"top",title:m.join(" ")},(0,r.tZ)("i",{className:"fa fa-exclamation-circle text-danger"}))," "),f?(0,r.tZ)("span",null,n&&(0,r.tZ)("span",null,(0,r.tZ)(s.V,{label:(0,i.t)("description"),tooltip:n,placement:"top",onClick:o})," "),g&&(0,r.tZ)("span",null,(0,r.tZ)(s.V,{label:(0,i.t)("bolt"),tooltip:(0,i.t)("Changing this control takes effect instantly"),placement:"top",icon:"bolt"})," ")):null,v&&(0,r.tZ)("span",{className:"text-danger m-l-4"},(0,r.tZ)("strong",null,"*")))),h&&(0,r.tZ)("div",{className:"pull-right"},h),(0,r.tZ)("div",{className:"clearfix"}))}function d(e){let{value:t,options:n,onChange:a,...i}=e;const s=t||n[0][0],l=(0,o.Fg)();return(0,r.tZ)("div",{css:(0,r.iv)({".btn svg":{position:"relative",top:"0.2em"},".btn:focus":{outline:"none"},".control-label":{color:l.colors.grayscale.base,marginBottom:l.gridUnit},".control-label + .btn-group":{marginTop:"1px"},".btn-group .btn-default":{color:l.colors.grayscale.dark1},".btn-group .btn.active":{background:l.colors.grayscale.light4,fontWeight:l.typography.weights.bold,boxShadow:"none"}},"","")},(0,r.tZ)(c,i),(0,r.tZ)("div",{className:"btn-group btn-group-sm"},n.map((e=>{let[t,n]=e;return(0,r.tZ)("button",{key:JSON.stringify(t),type:"button",className:"btn btn-default "+(t===s?"active":""),onClick:()=>{a(t)}},n)}))))}var u=n(78580),p=n.n(u),h=n(19181),m=n(63351),g=n(5872),f=n.n(g),v=n(88889),_=n(23279),b=n.n(_),y=n(68122);function E(e){let{children:t}=e;const{gridUnit:n}=(0,o.Fg)();return(0,r.tZ)("div",{css:(0,r.iv)({display:"flex",flexWrap:"nowrap",margin:-2*n,marginBottom:n},"","")},t)}function T(e){let{onChange:t,value:n,children:i}=e;const s=(0,o.Fg)(),l=(0,a.useMemo)((()=>({0:t,[y.o]:b()(t,y.o)})),[t]),c=a.Children.map(i,(e=>{if("children"in e.props){const r=Array.isArray(e.props.children)?100/e.props.children.length+"%":void 0;return a.cloneElement(e,{children:a.Children.map(e.props.children,(e=>{const{name:o,width:i,debounceDelay:s=y.o,onChange:c}=e.props;return a.cloneElement(e,{width:i||r,value:null==n?void 0:n[o],debounceDelay:void 0,onChange(e){c&&c(e),s in l||(l[s]=b()(t,s)),l[s]({...n,[o]:e})}})}))})}return e}));return(0,r.tZ)("div",{css:(0,r.iv)({label:{textTransform:"uppercase",color:s.colors.text.label,fontSize:s.typography.sizes.s}},"","")},c)}var S=n(31955),C=n(36795),Z=n(77808),A=n(31059),x=n(64749);const{Option:w}=x.default;function R(e){let{creatable:t,onSearch:n,dropdownMatchSelectWidth:o=!1,minWidth:i="100%",showSearch:s=!0,onChange:l,options:c,children:d,value:u,...p}=e;const[h,m]=(0,a.useState)(),g=s||t,v=g?e=>{t&&m(e),n&&n(e)}:void 0,_=null==c?void 0:c.some((e=>{let[t]=e;return t===h})),b=null==c?void 0:c.some((e=>{let[t]=e;return t===u})),y=g?(e,t)=>{m(""),l&&l(e,t)}:l;return(0,r.tZ)(x.default,f()({dropdownMatchSelectWidth:o,showSearch:g,onSearch:v,onChange:y,value:u},p,{css:(0,r.iv)({minWidth:i},"","")}),null==c?void 0:c.map((e=>{let[t,n]=e;return(0,r.tZ)(w,{value:t},n)})),d,u&&!b&&(0,r.tZ)(w,{key:u,value:u},u),h&&!_&&(0,r.tZ)(w,{key:h,value:h},h))}R.Option=w;const I={Slider:S.Z,InputNumber:C.Z,Input:Z.Z,Select:R,Checkbox:A.default,RadioButtonControl:d};function D(e){let{name:t,label:n,description:i,width:l,validators:d,required:u,onChange:p,value:h,defaultValue:m,controlType:g,...v}=e;const{gridUnit:_}=(0,o.Fg)(),[b,y]=(0,a.useState)(!1),[E,T]=(0,a.useState)(void 0===h?m:h),[S,C]=(0,a.useState)(),Z=e=>{const t=e&&"object"==typeof e&&"target"in e?"checkbox"===e.target.type||"radio"===e.target.type?e.target.checked:e.target.value:e,n=(null==d?void 0:d.map((e=>!(!u&&function(e){return null==e||""===e}(t))&&e(t))).filter((e=>!!e)))||[];C(n),T(t),0===n.length&&p&&p(t)},A=I[g];return(0,r.tZ)("div",{css:(0,r.iv)({margin:2*_,width:l},"",""),onMouseEnter:()=>y(!0),onMouseLeave:()=>y(!1)},"Checkbox"===g?(0,r.tZ)(I.Checkbox,{checked:E,onChange:Z},n," ",b&&i&&(0,r.tZ)(s.Z,{tooltip:i})):(0,r.tZ)(a.Fragment,null,n&&(0,r.tZ)(c,{name:t,label:n,description:i,validationErrors:S,hovered:b,required:u}),(0,r.tZ)(A,f()({},v,{value:E,onChange:Z}))))}var O=n(872),L=n(61437),N=n(38798),M=n(14031),k=n(58842);const P={controlType:"Select",label:(0,i.t)("D3 format"),description:k.YD,options:k.F6,defaultValue:k.F6[0][0],creatable:!0,minWidth:"14em",debounceDelay:500},F={controlType:"Select",label:(0,i.t)("D3 format"),description:k.oq,options:k.HC,defaultValue:k.HC[0][0],creatable:!0,minWidth:"10em",debounceDelay:500},U={controlType:"Slider",label:(0,i.t)("Fraction digits"),description:(0,i.t)("Number of decimal digits to round numbers to"),min:0,step:1,max:100,defaultValue:100},$={controlType:"InputNumber",label:(0,i.t)("Min Width"),description:(0,i.t)("Default minimal column width in pixels, actual width may still be larger than this if other columns don't need much space"),width:120,placeholder:(0,i.t)("auto"),debounceDelay:400,validators:[O.Z]},q={controlType:"RadioButtonControl",label:(0,i.t)("Text align"),description:(0,i.t)("Horizontal alignment"),width:130,debounceDelay:50,defaultValue:"left",options:[["left",(0,r.tZ)(L.E,{title:(0,i.t)("Left")})],["center",(0,r.tZ)(M.X,{title:(0,i.t)("Center")})],["right",(0,r.tZ)(N.l,{title:(0,i.t)("Right")})]]},V={controlType:"Checkbox",label:(0,i.t)("Show cell bars"),description:(0,i.t)("Whether to display a bar chart background in table columns"),defaultValue:!0,debounceDelay:200},j={controlType:"Checkbox",label:(0,i.t)("Align +/-"),description:(0,i.t)("Whether to align positive and negative values in cell bar chart at 0"),defaultValue:!1,debounceDelay:200},H={controlType:"Checkbox",label:(0,i.t)("Color +/-"),description:(0,i.t)("Whether to colorize numeric values by if they are positive or negative"),defaultValue:!1,debounceDelay:200},B={controlType:"Checkbox",label:(0,i.t)("Truncate Cells"),description:(0,i.t)('Truncate long cells to the "min width" set above'),defaultValue:!1,debounceDelay:400},z={d3NumberFormat:P,d3SmallNumberFormat:{...P,label:(0,i.t)("Small number format"),description:(0,i.t)("D3 number format for numbers between -1.0 and 1.0, useful when you want to have different significant digits for small and large numbers")},d3TimeFormat:F,fractionDigits:U,columnWidth:$,truncateLongCells:B,horizontalAlign:q,showCellBars:V,alignPositiveNegative:j,colorPositiveNegative:H},G={[v.Z.STRING]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"left"}}],["truncateLongCells"]],[v.Z.NUMERIC]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"right"}}],["d3NumberFormat"],["d3SmallNumberFormat"],["alignPositiveNegative","colorPositiveNegative"],["showCellBars"]],[v.Z.TEMPORAL]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"left"}}],["d3TimeFormat"]],[v.Z.BOOLEAN]:[["columnWidth",{name:"horizontalAlign",override:{defaultValue:"left"}}]]};function Q(e){let{column:t,configFormLayout:n,onChange:a}=e;return(0,r.tZ)(T,{onChange:a,value:t.config},n[void 0===t.type?v.Z.STRING:t.type].map(((e,t)=>(0,r.tZ)(E,{key:t},e.map((e=>{const t="string"==typeof e?e:e.name,n="string"==typeof e?{}:"override"in e?e.override:e.config,a={...t in z?z[t]:void 0,...n};return(0,r.tZ)(D,f()({key:t,name:t},a))}))))))}const Y=a.memo((function(e){let{column:t,onChange:n,configFormLayout:a}=e;const{colors:i,gridUnit:s}=(0,o.Fg)(),l=6*s;return(0,r.tZ)(h.Z,{title:t.name,content:()=>(0,r.tZ)(Q,{column:t,onChange:n,configFormLayout:a}),trigger:"click",placement:"right"},(0,r.tZ)("div",{css:(0,r.iv)({display:"flex",alignItems:"center",cursor:"pointer",padding:`${s}px ${2*s}px`,borderBottom:`1px solid ${i.grayscale.light2}`,position:"relative",paddingRight:l,"&:last-child":{borderBottom:"none"},"&:hover":{background:i.grayscale.light4},"> .fa":{color:i.grayscale.light2},"&:hover > .fa":{color:i.grayscale.light1}},"")},(0,r.tZ)(m.Z,{type:t.type}),t.name,(0,r.tZ)("i",{className:"fa fa-caret-right",css:(0,r.iv)({position:"absolute",right:3*s,top:3*s},"")})))}));var K=n(35622);const W={},J={RadioButtonControl:d,ColumnConfigControl:function(e){let{queryResponse:t,appliedColumnNames:n=[],value:s,onChange:l,configFormLayout:d=G,...u}=e;const{colnames:h,coltypes:m}=t||{};let g=[],f=[];if(0===n.length)g=h||[],f=m||[];else{const e=new Set(n);null==h||h.forEach(((t,n)=>{e.has(t)&&(g.push(t),f.push(null==m?void 0:m[n]))}))}const v=(0,o.Fg)(),_=(0,a.useMemo)((()=>{var e;const t={};return null==(e=g)||e.forEach(((e,n)=>{var r;t[e]={name:K.DS[e]||e,type:null==(r=f)?void 0:r[n],config:(null==s?void 0:s[e])||{}}})),t}),[s,g,f]),[b,y]=(0,a.useState)(!1),E=e=>_[e]||{};if(!g||0===g.length)return null;const T=g.length>12,S=T&&!b?g.slice(0,10):g;return(0,r.tZ)(a.Fragment,null,(0,r.tZ)(c,u),(0,r.tZ)("div",{css:(0,r.iv)({border:`1px solid ${v.colors.grayscale.light2}`,borderRadius:v.gridUnit},"","")},S.map((e=>(0,r.tZ)(Y,{key:e,column:E(e),onChange:t=>((e,t)=>{if(l){const n=g&&s?Object.fromEntries(Object.entries(s).filter((e=>{let[t]=e;return p()(g).call(g,t)}))):{...s};l({...n,[e]:t})}})(e,t),configFormLayout:d}))),T&&(0,r.tZ)("div",{role:"button",tabIndex:-1,css:(0,r.iv)({padding:2*v.gridUnit,textAlign:"center",cursor:"pointer",textTransform:"uppercase",fontSize:v.typography.sizes.xs,color:v.colors.text.label,":hover":{backgroundColor:v.colors.grayscale.light4}},"",""),onClick:()=>y(!b)},b?(0,r.tZ)(a.Fragment,null,(0,r.tZ)("i",{className:"fa fa-angle-up"}),"  ",(0,i.t)("Show less columns")):(0,r.tZ)(a.Fragment,null,(0,r.tZ)("i",{className:"fa fa-angle-down"})," ",(0,i.t)("Show all columns")))))}}},53769:(e,t,n)=>{"use strict";n.d(t,{$c:()=>A,Pi:()=>R,QF:()=>_,RW:()=>b,UQ:()=>w,Z8:()=>v,aG:()=>Z,db:()=>T,iQ:()=>E,iR:()=>x,lC:()=>f,pO:()=>I,ql:()=>y,sH:()=>C,x$:()=>S,xM:()=>g});var r=n(78580),a=n.n(r),o=n(67294),i=n(55867),s=n(95826),l=n(93185),c=n(38575),d=n(35622),u=n(65634),p=n(19835),h=n(83389),m=n(11965);const g={type:"DndColumnSelect",label:(0,i.t)("Dimensions"),multi:!0,freeForm:!0,clearable:!0,default:[],includeTime:!1,description:(0,i.t)("One or many columns to group by. High cardinality groupings should include a sort by metric and series limit to limit the number of fetched and rendered series."),optionRenderer:e=>(0,m.tZ)(u.E,{showType:!0,column:e}),valueRenderer:e=>(0,m.tZ)(u.E,{column:e}),valueKey:"column_name",allowAll:!0,filterOption:(e,t)=>{var n,r,o,i;let{data:s}=e;return(null==(n=s.column_name)?void 0:a()(r=n.toLowerCase()).call(r,t.toLowerCase()))||(null==(o=s.verbose_name)?void 0:a()(i=o.toLowerCase()).call(i,t.toLowerCase()))||!1},promptTextCreator:e=>e,mapStateToProps(e,t){var n;const r={},{datasource:a}=e;if(null!=a&&null!=(n=a.columns[0])&&n.hasOwnProperty("groupby")){const e=a.columns.filter((e=>e.groupby));null!=t&&t.includeTime&&e.unshift(d.LU),r.options=e,r.savedMetrics=a.metrics||[]}else{const e=(null==a?void 0:a.columns)||[];null!=t&&t.includeTime&&e.unshift(d.CV),r.options=e}return r},commaChoosesOption:!1},f={...g,label:(0,i.t)("Columns"),description:(0,i.t)("One or many columns to pivot as columns")},v={...g,label:(0,i.t)("Dimension"),multi:!1,default:null,description:(0,i.t)("Defines the grouping of entities. Each series is shown as a specific color on the chart and has a legend toggle")},_={...g,label:(0,i.t)("Entity"),default:null,multi:!1,validators:[s.Z],description:(0,i.t)("This defines the element to be plotted on the chart")},b={type:"DndFilterSelect",label:(0,i.t)("Filters"),default:[],description:"",mapStateToProps:e=>{let{datasource:t,form_data:n}=e;return{columns:(0,c.It)(t)?t.columns.filter((e=>e.filterable)):(null==t?void 0:t.columns)||[],savedMetrics:(0,p.R)(t),selectedMetrics:n.metrics||(n.metric?[n.metric]:[]),datasource:t}},provideFormDataToProps:!0,...h.sy},y={type:"DndMetricSelect",multi:!0,label:(0,i.t)("Metrics"),validators:[s.Z],mapStateToProps:e=>{let{datasource:t}=e;return{columns:(null==t?void 0:t.columns)||[],savedMetrics:(0,p.R)(t),datasource:t,datasourceType:null==t?void 0:t.type}},description:(0,i.t)("One or many metrics to display")},E={...y,multi:!1,label:(0,i.t)("Metric"),description:(0,i.t)("Metric")},T={...E,label:(0,i.t)("Right Axis Metric"),clearable:!0,description:(0,i.t)("Choose a metric for right axis")},S={type:"DndMetricSelect",label:(0,i.t)("Sort by"),default:null,description:(0,i.t)("Metric used to define how the top series are sorted if a series or row limit is present. If undefined reverts to the first metric (where appropriate)."),mapStateToProps:e=>{let{datasource:t}=e;return{columns:(null==t?void 0:t.columns)||[],savedMetrics:(0,p.R)(t),datasource:t,datasourceType:null==t?void 0:t.type}}},C={...E,label:(0,i.t)("Bubble Size"),description:(0,i.t)("Metric used to calculate bubble size"),default:null},Z={...E,label:(0,i.t)("X Axis"),description:(0,i.t)("Metric assigned to the [X] axis"),default:null},A={...E,label:(0,i.t)("Y Axis"),description:(0,i.t)("Metric assigned to the [Y] axis"),default:null},x={...E,label:(0,i.t)("Color Metric"),default:null,validators:[],description:(0,i.t)("A metric to use for color")},w={...v,...h.V7,label:d.m_.granularity_sqla,description:(0,i.t)("The time column for the visualization. Note that you can define arbitrary expression that return a DATETIME column in the table. Also note that the filter below is applied against this column or expression"),default:e=>e.default,clearable:!1,canDelete:!1,ghostButtonText:(0,i.t)("Drop a temporal column here or click"),optionRenderer:e=>(0,m.tZ)(u.E,{showType:!0,column:e}),valueRenderer:e=>(0,m.tZ)(u.E,{column:e}),valueKey:"column_name"},R={...g,...h.P2};function I(e,t){return function(n){return(0,o.useMemo)((()=>(0,l.cr)(l.TT.ENABLE_EXPLORE_DRAG_AND_DROP)),[])?(0,m.tZ)(e,n):(0,m.tZ)(t,n)}}},83389:(e,t,n)=>{"use strict";n.d(t,{P2:()=>d,V7:()=>u,sy:()=>p});var r=n(55867),a=n(95826),o=n(11146),i=n(55786),s=n(5364),l=n(45211);const c=e=>"horizontal"===(null==e?void 0:e.orientation)?{label:(0,r.t)("Y-axis"),description:(0,r.t)("Dimension to use on y-axis.")}:{label:(0,r.t)("X-axis"),description:(0,r.t)("Dimension to use on x-axis.")},d={label:e=>c(null==e?void 0:e.form_data).label,multi:!1,description:e=>c(null==e?void 0:e.form_data).description,validators:[a.Z],initialValue:(e,t)=>{var n,r;if(o.O6&&null!=t&&null!=(n=t.form_data)&&n.granularity_sqla&&(null==(r=t.form_data)||!r.x_axis)&&(null==e||!e.value))return t.form_data.granularity_sqla},default:void 0},u={mapStateToProps:e=>{let{datasource:t}=e;const n=(0,l.X)(t);return{options:n.temporalColumns,default:n.defaultTemporalColumn,isTemporal:!0}}},p={initialValue:(e,t)=>{var n,r,a,c;if(!o.O6||null!=t&&null!=(n=t.controls)&&null!=(r=n.time_range)&&r.value||(0,i.Z)(e.value).findIndex((e=>"TEMPORAL_RANGE"===(null==e?void 0:e.operator)))>-1)return;if(null!=t&&null!=(a=t.form_data)&&a.granularity_sqla&&null!=t&&null!=(c=t.form_data)&&c.time_range)return[...(0,i.Z)(e.value),{clause:"WHERE",subject:t.form_data.granularity_sqla,operator:"TEMPORAL_RANGE",comparator:t.form_data.time_range,expressionType:"SIMPLE"}];const d=(null==t?void 0:t.datasource)&&(0,l.X)(t.datasource).defaultTemporalColumn;var u,p;return o.O6&&d?[...(0,i.Z)(e.value),{clause:"WHERE",subject:d,operator:"TEMPORAL_RANGE",comparator:(null==t||null==(u=t.common)||null==(p=u.conf)?void 0:p.DEFAULT_TIME_FILTER)||s.vM,expressionType:"SIMPLE"}]:void 0}}},39650:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>j});var r=n(41609),a=n.n(r),o=n(78580),i=n.n(o),s=n(81545),l=n(45511),c=n(55867),d=n(37731),u=n(11146),p=n(72813),h=n(5364),m=n(75294),g=n(62363),f=n(55786),v=n(6126),_=n(58842),b=n(35622),y=n(53769);const E=(0,s.Z)(),T=(0,l.Z)(),S=[5,10,25,50,100,500],C=document.getElementById("app"),{user:Z}=JSON.parse((null==C?void 0:C.getAttribute("data-bootstrap"))||"{}"),A={type:"DatasourceControl",label:(0,c.t)("Datasource"),default:null,description:null,mapStateToProps:e=>{let{datasource:t,form_data:n}=e;return{datasource:t,form_data:n,user:Z}}},x={type:"VizTypeControl",label:(0,c.t)("Visualization Type"),default:"table",description:(0,c.t)("The type of visualization to display")},w={type:"ColorPickerControl",label:(0,c.t)("Fixed Color"),description:(0,c.t)("Use this to define a static color for all circles"),default:{r:0,g:122,b:135,a:1},renderTrigger:!0},R={type:"ColorSchemeControl",label:(0,c.t)("Linear Color Scheme"),choices:()=>T.values().map((e=>[e.id,e.label])),default:T.getDefaultKey(),clearable:!1,description:"",renderTrigger:!0,schemes:()=>T.getMap(),isLinear:!0,mapStateToProps:e=>{var t;return{dashboardId:null==e||null==(t=e.form_data)?void 0:t.dashboardId}}},I={type:"SelectControl",freeForm:!0,label:b.m_.granularity,default:"one day",choices:[[null,(0,c.t)("all")],["PT5S",(0,c.t)("5 seconds")],["PT30S",(0,c.t)("30 seconds")],["PT1M",(0,c.t)("1 minute")],["PT5M",(0,c.t)("5 minutes")],["PT30M",(0,c.t)("30 minutes")],["PT1H",(0,c.t)("1 hour")],["PT6H",(0,c.t)("6 hour")],["P1D",(0,c.t)("1 day")],["P7D",(0,c.t)("7 days")],["P1W",(0,c.t)("week")],["week_starting_sunday",(0,c.t)("week starting Sunday")],["week_ending_saturday",(0,c.t)("week ending Saturday")],["P1M",(0,c.t)("month")],["P3M",(0,c.t)("quarter")],["P1Y",(0,c.t)("year")]],description:(0,c.t)("The time granularity for the visualization. Note that you can type and use simple natural language as in `10 seconds`, `1 day` or `56 weeks`")},D={type:"SelectControl",label:b.m_.time_grain_sqla,placeholder:(0,c.t)("None"),initialValue:(e,t)=>{var n,r;return(0,d.Z)(t)?null!=t&&t.metadata||"time_grain_sqla"in(null!=(n=null==t?void 0:t.form_data)?n:{})?null==t||null==(r=t.form_data)?void 0:r.time_grain_sqla:"P1D":e.value},description:(0,c.t)("The time granularity for the visualization. This applies a date transformation to alter your time column and defines a new time granularity. The options here are defined on a per database engine basis in the Superset source code."),mapStateToProps:e=>{let{datasource:t}=e;return{choices:(null==t?void 0:t.time_grain_sqla)||[]}},visibility:e=>{let{controls:t}=e;if(!u.O6)return!0;const n=null==t?void 0:t.x_axis,r=null==n?void 0:n.value;return!!(0,p.GA)(r)||!!(0,p.s9)(r)&&!(null==(a=(null!=(o=null==n?void 0:n.options)?o:[]).find((e=>(null==e?void 0:e.column_name)===r)))||!a.is_dttm);var a,o}},O={type:"DateFilterControl",freeForm:!0,label:b.m_.time_range,default:h.vM,description:(0,c.t)('The time range for the visualization. All relative times, e.g. "Last month", "Last 7 days", "now", etc. are evaluated on the server using the server\'s local time (sans timezone). All tooltips and placeholder times are expressed in UTC (sans timezone). The timestamps are then evaluated by the database using the engine\'s local timezone. Note one can explicitly set the timezone per the ISO 8601 format if specifying either the start and/or end time.')},L={type:"SelectControl",freeForm:!0,label:(0,c.t)("Row limit"),validators:[m.Z],default:1e4,choices:(0,v.m)([10,50,100,250,500,1e3,5e3,1e4,5e4]),description:(0,c.t)("Limits the number of rows that get displayed.")},N={type:"CheckboxControl",label:(0,c.t)("Sort Descending"),default:!0,description:(0,c.t)("Whether to sort descending or ascending"),visibility:e=>{let{controls:t}=e;return Boolean((null==t?void 0:t.timeseries_limit_metric.value)&&!a()(null==t?void 0:t.timeseries_limit_metric.value))}},M={type:"SelectControl",freeForm:!0,label:(0,c.t)("Series limit"),placeholder:(0,c.t)("None"),validators:[m.Z],choices:(0,v.m)(S),clearable:!0,description:(0,c.t)("Limits the number of series that get displayed. A joined subquery (or an extra phase where subqueries are not supported) is applied to limit the number of series that get fetched and rendered. This feature is useful when grouping by high cardinality column(s) though does increase the query complexity and cost.")},k={type:"SelectControl",freeForm:!0,label:(0,c.t)("Series limit"),placeholder:(0,c.t)("None"),validators:[m.Z],choices:(0,v.m)(S),description:(0,c.t)("Limits the number of series that get displayed. A joined subquery (or an extra phase where subqueries are not supported) is applied to limit the number of series that get fetched and rendered. This feature is useful when grouping by high cardinality column(s) though does increase the query complexity and cost.")},P={type:"SelectControl",freeForm:!0,label:(0,c.t)("Y Axis Format"),renderTrigger:!0,default:_.Ul,choices:_.F6,description:_.YD,tokenSeparators:["\n","\t",";"],filterOption:(e,t)=>{var n,r;let{data:a}=e;return i()(n=a.label).call(n,t)||i()(r=a.value).call(r,t)},mapStateToProps:e=>{var t,n;return{choices:(null==(t=e.controls)||null==(n=t.comparison_type)?void 0:n.value)===g.wj.Percentage?_.F6.filter((e=>{var t;return i()(t=e[0]).call(t,"%")})):_.F6}}},F={type:"SelectControl",freeForm:!0,label:(0,c.t)("Time format"),renderTrigger:!0,default:_._r,choices:_.HC,description:_.oq,filterOption:(e,t)=>{var n,r;let{data:a}=e;return i()(n=a.label).call(n,t)||i()(r=a.value).call(r,t)}},U={type:"ColorSchemeControl",label:(0,c.t)("Color Scheme"),default:E.getDefaultKey(),renderTrigger:!0,choices:()=>E.keys().map((e=>[e,e])),description:(0,c.t)("The color scheme for rendering chart"),schemes:()=>E.getMap(),mapStateToProps:e=>{var t;return{dashboardId:null==e||null==(t=e.form_data)?void 0:t.dashboardId}}},$={type:"CheckboxControl",label:(0,c.t)("Truncate Metric"),default:!0,description:(0,c.t)("Whether to truncate metrics")},q={type:"CheckboxControl",label:(0,c.t)("Show empty columns"),default:!0,description:(0,c.t)("Show empty columns")},V={type:"HiddenControl",initialValue:(e,t)=>{var n;return Object.fromEntries((0,f.Z)(null==t||null==(n=t.datasource)?void 0:n.columns).filter((e=>e.is_dttm)).map((e=>{var t;return[null!=(t=e.column_name)?t:e.name,e.is_dttm]})))}},j={metrics:y.ql,metric:y.iQ,datasource:A,viz_type:x,color_picker:w,metric_2:y.db,linear_color_scheme:R,secondary_metric:y.iR,groupby:y.xM,columns:y.lC,granularity:I,granularity_sqla:y.UQ,time_grain_sqla:D,time_range:O,row_limit:L,limit:M,timeseries_limit_metric:y.x$,orderby:y.x$,order_desc:N,series:y.Z8,entity:y.QF,x:y.aG,y:y.$c,size:y.sH,y_axis_format:P,x_axis_time_format:F,adhoc_filters:y.RW,color_scheme:U,series_columns:y.lC,series_limit:k,series_limit_metric:y.x$,legacy_order_by:y.x$,truncate_metric:$,x_axis:y.Pi,show_empty_columns:q,temporal_columns_lookup:V}},38575:(e,t,n)=>{"use strict";n.d(t,{D_:()=>l,Id:()=>u,It:()=>c,JQ:()=>d,O9:()=>a,pp:()=>r,vD:()=>o,xN:()=>i,zy:()=>s});const r=e=>{var t,n;return(null==e||null==(t=e.standardizedFormData)?void 0:t.controls)&&(null==e||null==(n=e.standardizedFormData)?void 0:n.memorizedFormData)&&Array.isArray(e.standardizedFormData.controls.metrics)&&Array.isArray(e.standardizedFormData.controls.columns)};var a;!function(e){e.NONE="None",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_OR_EQUAL="",e.LESS_OR_EQUAL="",e.EQUAL="=",e.NOT_EQUAL="",e.BETWEEN="< x <",e.BETWEEN_OR_EQUAL=" x ",e.BETWEEN_OR_LEFT_EQUAL=" x <",e.BETWEEN_OR_RIGHT_EQUAL="< x "}(a||(a={}));const o=[a.BETWEEN,a.BETWEEN_OR_EQUAL,a.BETWEEN_OR_LEFT_EQUAL,a.BETWEEN_OR_RIGHT_EQUAL];function i(e){return!!e&&"column_name"in e}function s(e){return"column_name"in e&&"expression"in e&&!!e.expression}function l(e){return null!==e}function c(e){return!!e&&"columns"in e}function d(e){return!!e&&"results"in e&&"sql"in e}var u;!function(e){e.Name="name",e.Max="max",e.Min="min",e.Sum="sum",e.Avg="avg"}(u||(u={}))},58842:(e,t,n)=>{"use strict";n.d(t,{F6:()=>u,HC:()=>h,Ul:()=>m,YD:()=>s,_r:()=>g,oq:()=>p,pj:()=>l,u6:()=>c});var r=n(55867),a=n(67190),o=n(45636),i=n(78900);const s=(0,r.t)("D3 format syntax: https://github.com/d3/d3-format"),l=(0,r.t)('Only applies when "Label Type" is set to show values.'),c=(0,r.t)('Only applies when "Label Type" is not set to a percentage.'),d=[",d",".1s",".3s",",.1%",".2%",".3%",".4r",",.1f",",.2f",",.3f","+,","$,.2f"].map((e=>[e,`${e} (${(0,a.JB)(e).preview()})`])),u=[[o.Z.SMART_NUMBER,(0,r.t)("Adaptive formatting")],["~g",(0,r.t)("Original value")],...d,["DURATION",(0,r.t)("Duration in ms (66000 => 1m 6s)")],["DURATION_SUB",(0,r.t)("Duration in ms (1.40008 => 1ms 400s 80ns)")]],p=(0,r.t)("D3 time format syntax: https://github.com/d3/d3-time-format"),h=[[i.Z.id,(0,r.t)("Adaptive formatting")],["%d/%m/%Y","%d/%m/%Y | 14/01/2019"],["%m/%d/%Y","%m/%d/%Y | 01/14/2019"],["%Y-%m-%d","%Y-%m-%d | 2019-01-14"],["%Y-%m-%d %H:%M:%S","%Y-%m-%d %H:%M:%S | 2019-01-14 01:32:10"],["%d-%m-%Y %H:%M:%S","%d-%m-%Y %H:%M:%S | 14-01-2019 01:32:10"],["%H:%M:%S","%H:%M:%S | 01:32:10"]],m=u[0][0],g=h[0][0]},19835:(e,t,n)=>{"use strict";n.d(t,{R:()=>a});var r=n(46078);const a=e=>null!=e&&e.hasOwnProperty("metrics")?(null==e?void 0:e.metrics)||[]:r.BH},89368:(e,t,n)=>{"use strict";n.d(t,{$:()=>i,q:()=>s});var r=n(67294),a=n(356),o=n(39650);function i(e){return"string"==typeof e&&e in a.Z?a.Z[e]:e}function s(e,t){if(void 0===t&&(t={}),"string"==typeof e&&e in o.ZP){const n=e;return{name:n,config:{...o.ZP[n],...t[n]}}}if(!e||"string"==typeof e||r.isValidElement(e))return e;if("name"in e&&"config"in e)return{...e,config:{...e.config,type:i(e.config.type)}};if("override"in e&&e.name in o.ZP){const{name:t,override:n}=e;return{name:t,config:{...o.ZP[t],...n}}}return null}},20002:(e,t,n)=>{"use strict";n.d(t,{u:()=>o});var r=n(1875),a=n(38575);const o=(0,r.Z)(class{constructor(){this.controls=void 0,this.controls={metrics:[],columns:[]}}setStandardizedControls(e){if((0,a.pp)(e)){const{controls:t}=e.standardizedFormData;this.controls={metrics:t.metrics,columns:t.columns}}}shiftMetric(){return this.controls.metrics.shift()}shiftColumn(){return this.controls.columns.shift()}popAllMetrics(){return this.controls.metrics.splice(0,this.controls.metrics.length)}popAllColumns(){return this.controls.columns.splice(0,this.controls.columns.length)}clear(){this.controls={metrics:[],columns:[]}}})},45211:(e,t,n)=>{"use strict";n.d(t,{X:()=>i,x:()=>s});var r=n(55786),a=n(37731),o=n(38575);function i(e){const t={temporalColumns:[],defaultTemporalColumn:void 0};var n,i,s;return(0,o.It)(e)&&(t.temporalColumns=(0,r.Z)(e.columns).filter((e=>e.is_dttm))),(0,o.JQ)(e)&&(t.temporalColumns=(0,r.Z)(e.columns).filter((e=>e.is_dttm))),(0,o.It)(e)&&(t.defaultTemporalColumn=e.main_dttm_col),(0,a.Z)(t.defaultTemporalColumn)||(t.defaultTemporalColumn=null!=(n=null==(i=t.temporalColumns[0])?void 0:i.column_name)?n:null==(s=t.temporalColumns[0])?void 0:s.name),t}function s(e,t){const n=i(t).temporalColumns;for(let t=0;t<n.length;t+=1)if(n[t].column_name===e)return!0;return!1}},6126:(e,t,n)=>{"use strict";function r(e){return e.map((e=>Array.isArray(e)?e:[e,e.toString()]))}function a(e,t){const n=[];for(let r=e;r<=t;r+=1)n.push([r,r.toString()]);return n}n.d(t,{B:()=>a,m:()=>r})},19427:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(90537),a=n(1875);class o extends r.Z{constructor(){super({name:"ChartBuildQuery",overwritePolicy:r.r.WARN})}}const i=(0,a.Z)(o)},37687:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(90537),a=n(1875);class o extends r.Z{constructor(){super({name:"ChartControlPanel"})}}const i=(0,a.Z)(o)},11064:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(90537),a=n(1875);class o extends r.Z{constructor(){super({name:"ChartMetadata",overwritePolicy:r.r.WARN})}}const i=(0,a.Z)(o)},16355:(e,t,n)=>{"use strict";var r,a,o;n.d(t,{Df:()=>o,Tr:()=>a,ZP:()=>c,cg:()=>r,eH:()=>s,t$:()=>i,we:()=>l}),function(e){e.INTERACTIVE_CHART="INTERACTIVE_CHART",e.NATIVE_FILTER="NATIVE_FILTER",e.DRILL_TO_DETAIL="DRILL_TO_DETAIL",e.DRILL_BY="DRILL_BY"}(r||(r={})),function(e){e.EXPLORE="EXPLORE",e.DASHBOARD="DASHBOARD",e.FILTER_BAR="FILTER_BAR",e.FILTER_CONFIG_MODAL="FILTER_CONFIG_MODAL",e.EMBEDDED="EMBEDDED"}(a||(a={})),function(e){e.DEPRECATED="DEPRECATED",e.FEATURED="FEATURED"}(o||(o={}));const i={[o.DEPRECATED]:"This chart uses features or modules which are no longer actively maintained. It will eventually be replaced or removed.",[o.FEATURED]:"This chart was tested and verified, so the overall experience should be stable."},s={[o.DEPRECATED]:{weight:-.1},[o.FEATURED]:{weight:.1}};var l;!function(e){e.category="category",e.value="value",e.time="time",e.log="log"}(l||(l={}));const c={}},28062:(e,t,n)=>{"use strict";n.r(t),n.d(t,{DEFAULT_NAMESPACE:()=>l,default:()=>i,getColor:()=>d,getNamespace:()=>c,getScale:()=>u});var r=n(97466),a=n(81545),o=n(86041);class i{constructor(e){this.name=void 0,this.forcedItems=void 0,this.scales=void 0,this.name=e,this.scales={},this.forcedItems={}}getScale(e){var t,n;const o=null!=(t=null!=e?e:(0,a.Z)().getDefaultKey())?t:"",i=(0,a.Z)().get(o);return new r.Z(null!=(n=null==i?void 0:i.colors)?n:[],this.forcedItems)}setColor(e,t){return this.forcedItems[(0,o.Z)(e)]=t,this}resetColors(){this.forcedItems={}}}const s={},l="GLOBAL";function c(e){void 0===e&&(e=l);const t=s[e];if(t)return t;const n=new i(e);return s[e]=n,n}function d(e,t,n){return c(n).getScale(t).getColor(e)}function u(e,t){return c(t).getScale(e)}},97466:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d});var r=n(99481),a=n(54732),o=n(86041),i=n(78161),s=n(25130),l=n(93185);class c extends a.Z{constructor(e,t){void 0===t&&(t={}),super(((e,t)=>this.getColor(e,t))),this.originColors=void 0,this.colors=void 0,this.scale=void 0,this.parentForcedColors=void 0,this.forcedColors=void 0,this.multiple=void 0,this.originColors=e,this.colors=e,this.scale=(0,r.Z)(),this.scale.range(e),Object.entries(t).forEach((n=>{let[r,a]=n;"number"==typeof a&&(t[r]=e[a%e.length])})),this.parentForcedColors=t,this.forcedColors={},this.multiple=0}removeSharedLabelColorFromRange(e,t){const n=new Set(this.originColors);e.forEach(((e,r)=>{r!==t&&n.delete(e)})),Object.entries(this.parentForcedColors).forEach((e=>{let[r,a]=e;r!==t&&n.delete(a)})),this.range(n.size>0?[...n]:this.originColors)}getColor(e,t){var n,r;const a=(0,o.Z)(e),c=(0,i.ZP)(),d=c.getColorMap(),u=d.get(a);let p=(null==(n=this.parentForcedColors)?void 0:n[a])||(null==(r=this.forcedColors)?void 0:r[a])||u;if((0,l.cr)(l.TT.USE_ANALAGOUS_COLORS)){const e=Math.floor(this.domain().length/this.originColors.length);if(e>this.multiple){this.multiple=e;const t=(0,s.Gh)(this.originColors,e);this.range(this.originColors.concat(t))}}const h=this.scale(a);return p||(p=h,(0,l.cr)(l.TT.AVOID_COLORS_COLLISION)&&(this.removeSharedLabelColorFromRange(d,a),p=this.scale(a))),c.addSlice(a,p,t),p}setColor(e,t){return this.forcedColors[(0,o.Z)(e)]=t,this}getColorMap(){const e={};return this.scale.domain().forEach((t=>{e[t.toString()]=this.scale(t)})),{...e,...this.forcedColors,...this.parentForcedColors}}copy(){const e=new c(this.scale.range(),this.parentForcedColors);return e.forcedColors={...this.forcedColors},e.domain(this.domain()),e.unknown(this.unknown()),e}domain(e){return void 0===e?this.scale.domain():(this.scale.domain(e),this)}range(e){return void 0===e?this.scale.range():(this.colors=e,this.scale.range(e),this)}unknown(e){return void 0===e?this.scale.unknown():(this.scale.unknown(e),this)}}const d=c},78161:(e,t,n)=>{"use strict";n.d(t,{Ag:()=>r,Xs:()=>l,ZP:()=>c});var r,a=n(78580),o=n.n(a),i=n(28062),s=n(1875);!function(e){e[e.dashboard=0]="dashboard",e[e.explore=1]="explore"}(r||(r={}));class l{constructor(){this.sliceLabelMap=void 0,this.colorMap=void 0,this.source=void 0,this.sliceLabelMap=new Map,this.colorMap=new Map,this.source=r.dashboard}updateColorMap(e,t){const n=i.getNamespace(e),r=new Map;this.colorMap.clear(),this.sliceLabelMap.forEach((e=>{const a=n.getScale(t);e.forEach((e=>{const t=a(e);r.set(e,t)}))})),this.colorMap=r}getColorMap(){return this.colorMap}addSlice(e,t,n){if(this.source!==r.dashboard||void 0===n)return;const a=this.sliceLabelMap.get(n)||[];o()(a).call(a,e)||(a.push(e),this.sliceLabelMap.set(n,a)),this.colorMap.set(e,t)}removeSlice(e){if(this.source!==r.dashboard)return;this.sliceLabelMap.delete(e);const t=new Map;this.sliceLabelMap.forEach((e=>{e.forEach((e=>{t.set(e,this.colorMap.get(e))}))})),this.colorMap=t}reset(){new Map(this.colorMap).forEach(((e,t)=>{this.colorMap.set(t,"")}))}clear(){this.sliceLabelMap.clear(),this.colorMap.clear()}}const c=(0,s.Z)(l)},86041:(e,t,n)=>{"use strict";function r(e){return String(e).trim()}n.d(t,{Z:()=>r})},25130:(e,t,n)=>{"use strict";n.d(t,{Gh:()=>s,Qg:()=>i,Zf:()=>l});var r=n(17621),a=n.n(r);const o=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/;function i(e,t){void 0===t&&(t=186);let n=0,r=0,a=0;if(e.length>7){const t=o.exec(e);if(!t)throw new Error(`Invalid color: ${e}`);n=parseInt(t[1],10),r=parseInt(t[2],10),a=parseInt(t[3],10)}else{let t=e;if(t.startsWith("#")&&(t=t.substring(1)),3===t.length&&(t=[t[0],t[0],t[1],t[1],t[2],t[2]].join("")),6!==t.length)throw new Error(`Invalid color: ${e}`);n=parseInt(t.slice(0,2),16),r=parseInt(t.slice(2,4),16),a=parseInt(t.slice(4,6),16)}return.299*n+.587*r+.114*a>t?"#000":"#FFF"}function s(e,t){const n=[],r=e.map((e=>a()(e).analogous(t+3).slice(3)));for(;null!=(o=r[r.length-1])&&o.length;){var o;r.forEach((e=>{const t=e.shift();n.push(t.toHexString())}))}return n}function l(e,t){if(t>1||t<0)throw new Error(`The opacity should between 0 and 1, but got: ${t}`);return`${e}${`0${Math.round(255*t).toString(16).toUpperCase()}`.slice(-2)}`}},78186:(e,t,n)=>{"use strict";n.d(t,{Z:()=>g});var r=n(1469),a=n.n(r),o=n(30236),i=n.n(o),s=n(67294),l=n(46478),c=n(82781),d=n(61608),u=n(34775),p=n(27495),h=n(93185),m=n(11965);const g=function(e){let{source:t,htmlSanitization:n=!0,htmlSchemaOverrides:r={}}=e;const o=(0,h.cr)(h.TT.ESCAPE_MARKDOWN_HTML),g=(0,s.useMemo)((()=>{const e=[];if(!o&&(e.push(u.Z),n)){const t=function(e,t){return i()(e,t,((e,t)=>a()(e)?e.concat(t):void 0))}(c.R,r);e.push([d.Z,t])}return e}),[o,n,r]);return(0,m.tZ)(l.D,{rehypePlugins:g,remarkPlugins:[p.Z],skipHtml:!1},t)}},68122:(e,t,n)=>{"use strict";n.d(t,{M:()=>a,o:()=>r});const r=250,a=500},81847:(e,t,n)=>{"use strict";n.d(t,{YW:()=>i,mc:()=>s,vO:()=>o});const r={},a=e=>`__superset__/${e}`;async function o(e,t){const n=a(e);if(!window[n]&&!r[e]){const a=t();r[e]=a,window[n]=await a}return r[e]}async function i(e){return Promise.all(Object.entries(e).map((e=>{let[t,n]=e;return o(t,n)})))}function s(){Object.keys(r).forEach((e=>{delete window[a(e)],delete r[e]}))}},53652:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=class{constructor(e){this.name="TypedRegistry",this.records=void 0,this.records=e}get(e){return this.records[e]}set(e,t){this.records[e]=t}}},67706:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(46078);class a{constructor(e){this.id=void 0,this.type=void 0;const[t,n]=e.split("__");this.id=parseInt(t,10),this.type=r.i9.Table,this.type="query"===n?r.i9.Query:this.type}toString(){return`${this.id}__${this.type}`}toObject(){return{id:this.id,type:this.type}}}},61654:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(65946),a=n(67706),o=n(78444),i=n(11146);const s=e=>[e];function l(e,t){const{queryFields:n,buildQuery:l=s}="function"==typeof t?{buildQuery:t,queryFields:{}}:t||{};let c=l((0,r.Z)(e,n));return c.forEach((e=>{Array.isArray(e.post_processing)&&(e.post_processing=e.post_processing.filter(Boolean))})),(0,i.SR)(e)&&(c=c.map((t=>(0,o.T)(e,t)))),{datasource:new a.Z(e.datasource).toObject(),force:e.force||!1,queries:c,form_data:e,result_format:e.result_format||"json",result_type:e.result_type||"full"}}},65946:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(62446),a=n(78580),o=n.n(a),i=n(46306),s=n(78483);function l(e){let t=e;return o()(e).call(e,"--")&&(t=`${e}\n`),`(${t})`}var c=n(69363),d=n(5364),u=n(37731);function p(e,t){var n,a;const{annotation_layers:o=[],extra_form_data:p,time_range:h,since:m,until:g,row_limit:f,row_offset:v,order_desc:_,limit:b,timeseries_limit_metric:y,granularity:E,url_params:T={},custom_params:S={},series_columns:C,series_limit:Z,series_limit_metric:A,...x}=e,{adhoc_filters:w=[],filters:R=[],custom_form_data:I={},...D}=p||{},O=Number(f),L=Number(v),{metrics:N,columns:M,orderby:k}=(0,c.Z)(x,t),P=function(e){const t={},n=[],r={},a={filters:n,extras:r,applied_time_extras:t},o={__time_range:"time_range",__time_col:"granularity_sqla",__time_grain:"time_grain_sqla",__granularity:"granularity"};return(e.extra_filters||[]).forEach((e=>{if(e.col in o){const n=e.col;a[o[n]]=e.val,t[n]=e.val}else n.push(e)})),r.time_grain_sqla=a.time_grain_sqla||e.time_grain_sqla,a.granularity=a.granularity_sqla||e.granularity||e.granularity_sqla,delete a.granularity_sqla,delete a.time_grain_sqla,a}(e),{filters:F}=P,U={filters:[...F,...R],adhoc_filters:[...e.adhoc_filters||[],...w]},$=function(e){const{adhoc_filters:t,extras:n={},filters:r=[],where:a}=e,o=r,c=[];a&&c.push(a);const d=[];return(t||[]).forEach((e=>{const{clause:t}=e;if((0,i.Ki)(e)){const n=(0,s.Z)(e);"WHERE"===t&&o.push(n)}else{const{sqlExpression:n}=e;"WHERE"===t?c.push(n):d.push(n)}})),n.having=d.map(l).join(" AND "),n.where=c.map(l).join(" AND "),{filters:o,extras:n}}({...e,...P,...U});let q={time_range:h||void 0,since:m||void 0,until:g||void 0,granularity:E||void 0,...P,...$,columns:M,metrics:N,orderby:k,annotation_layers:o,row_limit:null==f||Number.isNaN(O)?void 0:O,row_offset:null==v||Number.isNaN(L)?void 0:L,series_columns:C,series_limit:null!=Z?Z:(0,u.Z)(b)?Number(b):0,series_limit_metric:null!=(n=null!=(a=(e=>{if((0,r.I0)(e))return e})(A))?a:y)?n:void 0,order_desc:void 0===_||_,url_params:T||void 0,custom_params:S};return q=function(e,t){const n={...e},{extras:r={}}=n;return Object.entries(d.gn).forEach((e=>{let[r,a]=e;const o=t[r];void 0!==o&&(n[a]=o)})),d.fn.forEach((e=>{e in t&&(r[e]=t[e])})),Object.keys(r).length>0&&(n.extras=r),n}(q,D),{...q,custom_form_data:I}}},5364:(e,t,n)=>{"use strict";n.d(t,{Ay:()=>c,Ci:()=>i,NU:()=>l,W3:()=>r,fn:()=>o,gn:()=>s,vM:()=>a});const r="__timestamp",a="No filter",o=["relative_start","relative_end","time_grain_sqla"],i=["adhoc_filters","filters","interactive_groupby","interactive_highlight","interactive_drilldown","custom_form_data"],s={granularity:"granularity",granularity_sqla:"granularity",time_column:"time_column",time_grain:"time_grain",time_range:"time_range"},l=Object.keys(s),c=[...l,...o]},78483:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(46306);function a(e){const{subject:t}=e;if((0,r._l)(e)){const{operator:n}=e;return{col:t,op:n}}if((0,r.kC)(e)){const{operator:n}=e;return{col:t,op:n,val:e.comparator}}const{operator:n}=e;return{col:t,op:n,val:e.comparator}}},69363:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(78580),a=n.n(r),o=n(55867),i=n(74765),s=n(5364),l=n(10581),c=n(56652),d=n(20620),u=n(11146);function p(e,t){const n={metric:"metrics",metric_2:"metrics",secondary_metric:"metrics",x:"metrics",y:"metrics",size:"metrics",all_columns:"columns",series:"groupby",order_by_cols:"orderby",...t},{query_mode:r,include_time:p,...h}=e;let m=[],g=[],f=[];return Object.entries(h).forEach((e=>{let[t,a]=e;if(null==a)return;let o=n[t]||t;r===d.n.aggregate&&"columns"===o||(r!==d.n.raw||"groupby"!==o&&"metrics"!==o)&&("groupby"===o&&(o="columns"),"metrics"===o?g=g.concat(a):"columns"===o?m=m.concat(a):"orderby"===o&&(f=f.concat(a)))})),u.O6||!p||a()(m).call(m,s.W3)||m.unshift(s.W3),{columns:(0,i.Z)(m.filter((e=>""!==e)),l.Z),metrics:r===d.n.raw?void 0:(0,i.Z)(g,c.Z),orderby:f.length>0?f.map((e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){throw new Error((0,o.t)("Found invalid orderby options"))}return e})):void 0}}},10581:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(72813);function a(e){return(0,r.s9)(e)?e:null!=e&&e.label?e.label:null==e?void 0:e.sqlExpression}},56652:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(62446);function a(e){return(0,r.AG)(e)?e:e.label?e.label:(0,r.nX)(e)?`${e.aggregate}(${e.column.columnName||e.column.column_name})`:e.sqlExpression}},11146:(e,t,n)=>{"use strict";n.d(t,{Bw:()=>c,M8:()=>d,O6:()=>l,SR:()=>s});var r=n(72813),a=n(93185),o=n(5364),i=n(10581);const s=e=>(0,r.Gk)(e.x_axis),l=(0,a.cr)(a.TT.GENERIC_CHART_AXES),c=e=>{if(e.granularity_sqla||e.x_axis)return s(e)?e.x_axis:o.W3},d=e=>{const t=c(e);if(t)return(0,i.Z)(t)}},78444:(e,t,n)=>{"use strict";n.d(t,{T:()=>s});var r=n(57557),a=n.n(r),o=n(72813),i=n(11146);function s(e,t){if(!(0,i.SR)(e))return t;const{columns:n,extras:r}=t,s=[...n||[]],l=null==n?void 0:n.findIndex((t=>(0,o.s9)(t)&&(0,o.s9)(e.x_axis)&&t===e.x_axis||(0,o.GA)(t)&&(0,o.GA)(e.x_axis)&&t.sqlExpression===e.x_axis.sqlExpression));if(void 0!==l&&l>-1&&e.x_axis&&Array.isArray(n)){(0,o.GA)(n[l])?s[l]={timeGrain:null==r?void 0:r.time_grain_sqla,columnType:"BASE_AXIS",...n[l]}:s[l]={timeGrain:null==r?void 0:r.time_grain_sqla,columnType:"BASE_AXIS",sqlExpression:e.x_axis,label:e.x_axis,expressionType:"SQL"};const i=a()(t,["extras.time_grain_sqla","is_timeseries"]);return i.columns=s,i}return t}},62363:(e,t,n)=>{"use strict";var r,a;n.d(t,{ZP:()=>o,su:()=>r,wj:()=>a}),function(e){e.Mean="mean",e.Sum="sum",e.Std="std",e.Cumsum="cumsum"}(r||(r={})),function(e){e.Values="values",e.Difference="difference",e.Percentage="percentage",e.Ratio="ratio"}(a||(a={}));const o={}},72813:(e,t,n)=>{"use strict";function r(e){return"string"==typeof e}function a(e){return"string"!=typeof e&&void 0!==(null==e?void 0:e.sqlExpression)&&void 0!==(null==e?void 0:e.label)&&(void 0===(null==e?void 0:e.expressionType)||"SQL"===(null==e?void 0:e.expressionType))}function o(e){return r(e)||a(e)}n.d(t,{GA:()=>a,Gk:()=>o,ZP:()=>i,s9:()=>r});const i={}},10916:(e,t,n)=>{"use strict";var r,a;function o(e){return e.type===r.NATIVE_FILTER}function i(e){var t,n;return o(e)&&(null==(t=e.dataMask)||null==(n=t.filterState)?void 0:n.value)}function s(e){return e.type===r.DIVIDER}n.d(t,{BE:()=>r,S0:()=>i,ZP:()=>l,gT:()=>a,kI:()=>o,nY:()=>s}),function(e){e.NATIVE_FILTER="NATIVE_FILTER",e.DIVIDER="DIVIDER"}(r||(r={})),function(e){e.NativeFilters="nativeFilters",e.CrossFilters="crossFilters"}(a||(a={}));const l={}},46078:(e,t,n)=>{"use strict";var r;n.d(t,{BH:()=>a,ZP:()=>o,i9:()=>r}),function(e){e.Table="table",e.Query="query",e.Dataset="dataset",e.SlTable="sl_table",e.SavedQuery="saved_query"}(r||(r={}));const a=[{metric_name:"COUNT(*)",expression:"COUNT(*)"}],o={}},46306:(e,t,n)=>{"use strict";n.d(t,{Ki:()=>a,VK:()=>l,_l:()=>i,jz:()=>o,kC:()=>s});var r=n(31612);function a(e){return"SIMPLE"===e.expressionType}function o(e){return"SQL"===e.expressionType}function i(e){return(0,r.CW)(e.operator)}function s(e){return(0,r.VU)(e.operator)}function l(e){return(0,r.XA)(e.operator)}},62446:(e,t,n)=>{"use strict";function r(e){return"string"==typeof e}function a(e){return"string"!=typeof e&&"SIMPLE"===(null==e?void 0:e.expressionType)}function o(e){return"string"!=typeof e&&"SQL"===(null==e?void 0:e.expressionType)}function i(e){return r(e)||a(e)||o(e)}n.d(t,{AG:()=>r,I0:()=>i,ZP:()=>s,nX:()=>a,q5:()=>o});const s={}},31612:(e,t,n)=>{"use strict";n.d(t,{CW:()=>a,VU:()=>i,XA:()=>l});const r=new Set(["IS NOT NULL","IS NULL"]);function a(e){return r.has(e)}const o=new Set(["==","!=",">","<",">=","<=","ILIKE","LIKE","REGEX","TEMPORAL_RANGE"]);function i(e){return o.has(e)}const s=new Set(["IN","NOT IN"]);function l(e){return s.has(e)}},20620:(e,t,n)=>{"use strict";var r;n.d(t,{Z:()=>a,n:()=>r}),function(e){e.aggregate="aggregate",e.raw="raw"}(r||(r={}));const a={}},88889:(e,t,n)=>{"use strict";var r;n.d(t,{C:()=>a,Z:()=>r}),function(e){e[e.NUMERIC=0]="NUMERIC",e[e.STRING=1]="STRING",e[e.TEMPORAL=2]="TEMPORAL",e[e.BOOLEAN=3]="BOOLEAN"}(r||(r={}));const a={}},75049:(e,t,n)=>{"use strict";n.d(t,{I:()=>i});var r=n(53652),a=n(1875);class o extends r.Z{constructor(){super(...arguments),this.name="ExtensionsRegistry"}}const i=(0,a.Z)(o,{})},32103:(e,t,n)=>{"use strict";n.d(t,{Kv:()=>s,T4:()=>l,Ul:()=>c,Z6:()=>i,ZU:()=>d}),n(67294);var r=n(68924),a=n(11965);const o=new r.FilterXSS({whiteList:{...(0,r.getDefaultWhiteList)(),span:["style","class","title"],div:["style","class"],a:["style","class","href","title","target"],img:["style","class","src","alt","title","width","height"],video:["autoplay","controls","loop","preload","src","height","width","muted"]},stripIgnoreTag:!0,css:!1});function i(e){return o.process(e)}function s(e){return/<[^>]+>/.test(e)}function l(e){return s(e)?i(e):e}function c(e){return s(e)?(0,a.tZ)("span",{className:"safe-html-wrapper",dangerouslySetInnerHTML:{__html:i(e)}}):e}function d(e){return e.replace(/<[^>]*>/g,"")}},37731:(e,t,n)=>{"use strict";function r(e){return null!=e}n.d(t,{Z:()=>r})},1111:(e,t,n)=>{"use strict";function r(e,t){return e===t||!e&&!t||!!(e&&t&&e.length===t.length&&e.every(((e,n)=>e===t[n])))}n.d(t,{Z:()=>r})},74765:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=function(e,t){if(t){const n=new Set;return e.filter((e=>{const r=t(e);return!n.has(r)&&(n.add(r),!0)}))}return[...new Set(e)]}},75294:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(55867);function a(e){return!(!e||!Number.isNaN(Number(e))&&parseInt(e,10)===Number(e))&&(0,r.t)("is expected to be an integer")}},99298:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(55867);function a(e){return!(!e||!Number.isNaN(Number(e)))&&(0,r.t)("is expected to be a number")}},95826:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(55867);function a(e){return!!(null==e||""===e||Array.isArray(e)&&0===e.length)&&(0,r.t)("cannot be empty")}},872:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(55867);function a(e){return!("string"==typeof e&&e.trim().length>0&&Number.isFinite(Number(e.trim()))||"number"==typeof e&&Number.isFinite(e))&&(0,r.t)("is expected to be a number")}},47710:(e,t,n)=>{"use strict";n.d(t,{W:()=>L});var r=n(47037),a=n.n(r),o=n(41609),i=n.n(o),s=n(78580),l=n.n(s),c=n(67294),d=n(87183),u=n(4715),p=n(9875),h=n(74069),m=n(35932),g=n(51995),f=n(31069),v=n(55867),_=n(28216),b=n(30381),y=n.n(b),E=n(15926),T=n.n(E),S=n(11409),C=n(72570),Z=n(28241),A=n(12515),x=n(40219),w=n(27600),R=n(11965);const I=g.iK.div`
  .sdm-body {
    margin: 0 8px;
  }
  .sdm-input {
    margin-left: 45px;
    width: 401px;
  }
  .sdm-autocomplete {
    width: 401px;
    align-self: center;
  }
  .sdm-radio {
    display: block;
    height: 30px;
    margin: 10px 0px;
    line-height: 30px;
  }
  .sdm-overwrite-msg {
    margin: 7px;
  }
  .sdm-overwrite-container {
    flex: 1 1 auto;
    display: flex;
  }
`,D=async(e,t,n,r,a,o)=>{const i=`api/v1/dataset/${t}?override_columns=${o}`,s=JSON.stringify({sql:n,columns:r,owners:a,database_id:e});return(await f.Z.put({endpoint:i,headers:{"Content-Type":"application/json"},body:s})).json.result},O=(0,v.t)("Untitled Dataset"),L=e=>{let{visible:t,onHide:n,buttonTextOnSave:r,buttonTextOnOverwrite:o,modalDescription:s,datasource:g,openWindow:b=!0,formData:E={}}=e;const L=(0,_.v9)((e=>{var t,n;return(null==(t=e.common)||null==(n=t.conf)?void 0:n.DEFAULT_VIZ_TYPE)||"table"})),N=()=>`${(null==g?void 0:g.name)||O} ${y()().format("MM/DD/YYYY HH:mm:ss")}`,[M,k]=(0,c.useState)(N()),[P,F]=(0,c.useState)(Z.fT.SAVE_NEW),[U,$]=(0,c.useState)(!1),[q,V]=(0,c.useState)({}),[j,H]=(0,c.useState)(void 0),[B,z]=(0,c.useState)(!1),G=(0,_.v9)((e=>(0,Z.aY)(e))),Q=(0,_.I0)(),Y=e=>{b?window.open(e,"_blank","noreferrer"):window.location.href=e},K={...Z.C9,...E||{}},W=(0,c.useCallback)((async function(e){void 0===e&&(e="");const{userId:t}=G,n=T().encode({filters:[{col:"table_name",opr:"ct",value:e},{col:"owners",opr:"rel_m_m",value:t}],order_column:"changed_on_delta_humanized",order_direction:"desc"});return f.Z.get({endpoint:`/api/v1/dataset?q=${n}`}).then((e=>({data:e.json.result.map((e=>({value:e.table_name,label:e.table_name,datasetid:e.id,owners:e.owners}))),totalCount:e.json.count})))}),[G]),J=P===Z.fT.SAVE_NEW&&0===M.length||P===Z.fT.OVERWRITE_DATASET&&i()(j);return(0,R.tZ)(h.Z,{show:t,title:(0,v.t)("Save or Overwrite Dataset"),onHide:n,footer:(0,R.tZ)(c.Fragment,null,P===Z.fT.SAVE_NEW&&(0,R.tZ)(m.Z,{disabled:J,buttonStyle:"primary",onClick:()=>{var e,t;z(!0);const r=null!=(e=null==g?void 0:g.columns)?e:[];let o;if(a()(null==g?void 0:g.templateParams)){const e=JSON.parse(g.templateParams);e._filters&&(delete e._filters,o=JSON.stringify(e))}Q((0,S.createDatasource)({sql:g.sql,dbId:g.dbId||(null==g||null==(t=g.database)?void 0:t.id),schema:null==g?void 0:g.schema,templateParams:o,datasourceName:M})).then((e=>(0,x.nv)(e.id,"table",{...K,datasource:`${e.id}__table`,..."table"===L&&{all_columns:r.map((e=>e.column_name))}}))).then((e=>{z(!1);const t=(0,A.y8)(null,{[w.KD.formDataKey.name]:e});Y(t),k(N()),n()})).catch((()=>{z(!1),(0,C.Gb)((0,v.t)("An error occurred saving dataset"))}))},loading:B},r),P===Z.fT.OVERWRITE_DATASET&&(0,R.tZ)(c.Fragment,null,U&&(0,R.tZ)(m.Z,{onClick:()=>{$(!1),V({})}},(0,v.t)("Back")),(0,R.tZ)(m.Z,{className:"md",buttonStyle:"primary",onClick:async()=>{var e,t,r;if(!U)return void $(!0);z(!0);const[,a]=await Promise.all([D(null==g?void 0:g.dbId,null==q?void 0:q.datasetid,null==g?void 0:g.sql,null==g||null==(e=g.columns)?void 0:e.map((e=>({column_name:e.column_name,type:e.type,is_dttm:e.is_dttm}))),null==q||null==(t=q.owners)?void 0:t.map((e=>e.id)),!0),(0,x.nv)(q.datasetid,"table",{...K,datasource:`${q.datasetid}__table`,..."table"===L&&{all_columns:null==g||null==(r=g.columns)?void 0:r.map((e=>e.column_name))}})]);z(!1);const o=(0,A.y8)(null,{[w.KD.formDataKey.name]:a});Y(o),$(!1),k(N()),n()},disabled:J,loading:B},o)))},(0,R.tZ)(I,null,!U&&(0,R.tZ)("div",{className:"sdm-body"},s&&(0,R.tZ)("div",{className:"sdm-prompt"},s),(0,R.tZ)(d.Y.Group,{onChange:e=>{F(Number(e.target.value))},value:P},(0,R.tZ)(d.Y,{className:"sdm-radio",value:1},(0,v.t)("Save as new"),(0,R.tZ)(p.II,{className:"sdm-input",value:M,onChange:e=>{k(e.target.value)},disabled:1!==P})),(0,R.tZ)("div",{className:"sdm-overwrite-container"},(0,R.tZ)(d.Y,{className:"sdm-radio",value:2},(0,v.t)("Overwrite existing")),(0,R.tZ)("div",{className:"sdm-autocomplete"},(0,R.tZ)(u.qb,{allowClear:!0,showSearch:!0,placeholder:(0,v.t)("Select or type dataset name"),ariaLabel:(0,v.t)("Existing dataset"),onChange:(e,t)=>{V(t),H(e)},options:e=>W(e),value:j,filterOption:(e,t)=>{var n;return l()(n=t.value.toLowerCase()).call(n,e.toLowerCase())},disabled:2!==P,getPopupContainer:()=>document.body}))))),U&&(0,R.tZ)("div",{className:"sdm-overwrite-msg"},(0,v.t)("Are you sure you want to overwrite this dataset?"))))}},44904:(e,t,n)=>{"use strict";n.d(t,{Em:()=>i,GJ:()=>A,IY:()=>a,N2:()=>C,OI:()=>R,TU:()=>b,U$:()=>y,Yn:()=>Z,Yo:()=>_,b$:()=>E,bR:()=>s,eU:()=>l,ev:()=>c,fM:()=>g,hC:()=>f,iJ:()=>x,lV:()=>m,lr:()=>w,oN:()=>h,rD:()=>S,rP:()=>u,rp:()=>d,uC:()=>o,xj:()=>p,zY:()=>v,zf:()=>T});var r=n(55867);const a={offline:"danger",failed:"danger",pending:"info",fetching:"info",running:"warning",stopped:"danger",success:"success"},o={offline:(0,r.t)("offline"),failed:(0,r.t)("failed"),pending:(0,r.t)("pending"),fetching:(0,r.t)("fetching"),running:(0,r.t)("running"),stopped:(0,r.t)("stopped"),success:(0,r.t)("success")},i={success:"success",failed:"failed",running:"running",offline:"offline",pending:"pending"},s={success:(0,r.t)("success"),failed:(0,r.t)("failed"),running:(0,r.t)("running"),offline:(0,r.t)("offline"),pending:(0,r.t)("pending")},l=5,c=3,d=51,u=400,p=10,h=30,m=70,g=2e3,f=600,v=100,_=1024,b=2,y=864e5,E=5120,T=1024,S=.9,C=8e3,Z=100,A=90,x=60,w=55,R=50},28241:(e,t,n)=>{"use strict";n.d(t,{C9:()=>o,aY:()=>r,fT:()=>a});const r=e=>{if(e.hasOwnProperty("sqlLab")){const{sqlLab:{user:t}}=e;return t}const{user:t}=e;return t};var a;!function(e){e[e.SAVE_NEW=1]="SAVE_NEW",e[e.OVERWRITE_DATASET=2]="OVERWRITE_DATASET"}(a||(a={}));const o={metrics:[],groupby:[],time_range:"No filter",row_limit:1e3}},33313:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(44904);const a=["AND","AS","ASC","AVG","BY","CASE","COUNT","CREATE","CROSS","DATABASE","DEFAULT","DELETE","DESC","DISTINCT","DROP","ELSE","END","FOREIGN","FROM","GRANT","GROUP","HAVING","IF","INNER","INSERT","JOIN","KEY","LEFT","LIMIT","MAX","MIN","NATURAL","NOT","NULL","OFFSET","ON","OR","ORDER","OUTER","PRIMARY","REFERENCES","RIGHT","SELECT","SUM","TABLE","THEN","TYPE","UNION","UPDATE","WHEN","WHERE"].concat(["BIGINT","BINARY","BIT","CHAR","DATE","DECIMAL","DOUBLE","FLOAT","INT","INTEGER","MONEY","NUMBER","NUMERIC","REAL","SET","TEXT","TIMESTAMP","VARCHAR"]).map((e=>({meta:"sql",name:e,score:r.Yn,value:e})))},29487:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(5872),a=n.n(r),o=n(11965),i=(n(67294),n(4863)),s=n(51995),l=n(70163);function c(e){const{type:t="info",description:n,showIcon:r=!0,closable:c=!0,roomBelow:d=!1,children:u}=e,p=(0,s.Fg)(),{colors:h,typography:m,gridUnit:g}=p,{alert:f,error:v,info:_,success:b}=h;let y=_,E=l.Z.InfoSolid;return"error"===t?(y=v,E=l.Z.ErrorSolid):"warning"===t?(y=f,E=l.Z.AlertSolid):"success"===t&&(y=b,E=l.Z.CircleCheckSolid),(0,o.tZ)(i.default,a()({role:"alert",showIcon:r,icon:(0,o.tZ)(E,{"aria-label":`${t} icon`}),closeText:c&&(0,o.tZ)(l.Z.XSmall,{"aria-label":"close icon"}),css:(0,o.iv)({marginBottom:d?4*g:0,padding:`${2*g}px ${3*g}px`,alignItems:"flex-start",border:0,backgroundColor:y.light2,"& .ant-alert-icon":{marginRight:2*g},"& .ant-alert-message":{color:y.dark2,fontSize:m.sizes.m,fontWeight:n?m.weights.bold:m.weights.normal},"& .ant-alert-description":{color:y.dark2,fontSize:m.sizes.m}},"","")},e),u)}},94670:(e,t,n)=>{"use strict";n.d(t,{Ad:()=>v,YH:()=>g,Z5:()=>_,cE:()=>m,iO:()=>p,ry:()=>f,up:()=>h});var r=n(5872),a=n.n(r),o=n(67294),i=n(53239),s=n(67913),l=n(38325),c=n(11965);const d={"mode/sql":()=>n.e(8883).then(n.t.bind(n,48883,23)),"mode/markdown":()=>Promise.all([n.e(9794),n.e(5802),n.e(4832),n.e(6061)]).then(n.t.bind(n,66061,23)),"mode/css":()=>Promise.all([n.e(5802),n.e(4972)]).then(n.t.bind(n,94972,23)),"mode/json":()=>n.e(8750).then(n.t.bind(n,58750,23)),"mode/yaml":()=>n.e(741).then(n.t.bind(n,60741,23)),"mode/html":()=>Promise.all([n.e(9794),n.e(5802),n.e(4832),n.e(1258)]).then(n.t.bind(n,71258,23)),"mode/javascript":()=>Promise.all([n.e(9794),n.e(4579)]).then(n.t.bind(n,54579,23)),"theme/textmate":()=>n.e(2089).then(n.t.bind(n,2089,23)),"theme/github":()=>n.e(440).then(n.t.bind(n,50440,23)),"ext/language_tools":()=>n.e(5335).then(n.t.bind(n,75335,23)),"ext/searchbox":()=>n.e(8656).then(n.t.bind(n,68656,23))};function u(e,t){let{defaultMode:r,defaultTheme:u,defaultTabSize:p=2,fontFamily:h="Menlo, Consolas, Courier New, Ubuntu Mono, source-code-pro, Lucida Console, monospace",placeholder:m}=void 0===t?{}:t;return(0,s.Z)((async()=>{var t,s;const{default:m}=await Promise.resolve().then(n.bind(n,74981));await Promise.all(e.map((e=>d[e]())));const g=r||(null==(t=e.find((e=>e.startsWith("mode/"))))?void 0:t.replace("mode/","")),f=u||(null==(s=e.find((e=>e.startsWith("theme/"))))?void 0:s.replace("theme/",""));return(0,o.forwardRef)((function(e,t){let{keywords:n,mode:r=g,theme:s=f,tabSize:d=p,defaultValue:u="",...v}=e;const _=(0,i.acequire)("ace/ext/language_tools"),b=(0,l.Z)((e=>{const t={getCompletions:(t,n,a,o,i)=>{Number.isNaN(parseInt(o,10))&&n.getMode().$id===`ace/mode/${r}`&&i(null,e)}};_.setCompleters([t])}));return(0,o.useEffect)((()=>{n&&b(n)}),[n,b]),(0,c.tZ)(m,a()({ref:t,mode:r,theme:s,tabSize:d,defaultValue:u,setOptions:{fontFamily:h}},v))}))}),m)}const p=u(["mode/sql","theme/github","ext/language_tools","ext/searchbox"]),h=u(["mode/sql","theme/github","ext/language_tools","ext/searchbox"],{placeholder:()=>(0,c.tZ)("div",{style:{height:"100%"}},(0,c.tZ)("div",{style:{width:41,height:"100%",background:"#e8e8e8"}}),(0,c.tZ)("div",{className:"ace_content"}))}),m=u(["mode/markdown","theme/textmate"]),g=u(["mode/markdown","mode/sql","mode/json","mode/html","mode/javascript","theme/textmate"]),f=u(["mode/css","theme/github"]),v=u(["mode/json","theme/github"]),_=u(["mode/json","mode/yaml","theme/github"])},67913:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(5872),a=n.n(r),o=n(67294),i=n(38703),s=n(11965);function l(e){let{width:t,height:n,showLoadingForImport:r=!1,placeholderStyle:a}=e;return n&&(0,s.tZ)("div",{key:"async-asm-placeholder",style:{width:t,height:n,...a}},r&&(0,s.tZ)(i.Z,{position:"floating"}))||null}function c(e,t){let n,r;function i(){return n||(n=e instanceof Promise?e:e()),r||n.then((e=>{r=e.default||e})),n}void 0===t&&(t=l);const c=(0,o.forwardRef)((function(e,n){const[l,c]=(0,o.useState)(void 0!==r);(0,o.useEffect)((()=>{let e=!0;return l||i().then((()=>{e&&c(!0)})),()=>{e=!1}}));const d=r||t;return d?(0,s.tZ)(d,a()({ref:d===r?n:null},e)):null}));return c.preload=i,c}},37863:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h,u:()=>p});var r=n(57557),a=n.n(r),o=n(55867),i=n(4305),s=n(50810),l=n(10331),c=n(76445),d=n(44814),u=n(52256);const p={id:0,chartAlert:null,chartStatus:"loading",chartStackTrace:null,chartUpdateEndTime:null,chartUpdateStartTime:0,latestQueryFormData:{},sliceFormData:null,queryController:null,queriesResponse:null,triggerQuery:!0,lastRendered:0};function h(e,t){void 0===e&&(e={});const n={[u.ADD_CHART]:()=>({...p,...t.chart}),[u.CHART_UPDATE_SUCCEEDED]:e=>({...e,chartStatus:"success",chartAlert:null,queriesResponse:t.queriesResponse,chartUpdateEndTime:(0,d.zO)()}),[u.CHART_UPDATE_STARTED]:e=>({...e,chartStatus:"loading",chartStackTrace:null,chartAlert:null,chartUpdateEndTime:null,chartUpdateStartTime:(0,d.zO)(),queryController:t.queryController}),[u.CHART_UPDATE_STOPPED]:e=>({...e,chartStatus:"stopped",chartAlert:(0,o.t)("Updating chart was stopped"),chartUpdateEndTime:(0,d.zO)()}),[u.CHART_RENDERING_SUCCEEDED]:e=>({...e,chartStatus:"rendered",chartUpdateEndTime:(0,d.zO)()}),[u.CHART_RENDERING_FAILED]:e=>({...e,chartStatus:"failed",chartStackTrace:t.stackTrace,chartAlert:(0,o.t)("An error occurred while rendering the visualization: %s",t.error)}),[u.CHART_UPDATE_FAILED](e){var n,r,a,i;return{...e,chartStatus:"failed",chartAlert:t.queriesResponse?null==(n=t.queriesResponse)||null==(r=n[0])?void 0:r.error:(0,o.t)("Network error."),chartUpdateEndTime:(0,d.zO)(),queriesResponse:t.queriesResponse,chartStackTrace:t.queriesResponse?null==(a=t.queriesResponse)||null==(i=a[0])?void 0:i.stacktrace:null}},[u.DYNAMIC_PLUGIN_CONTROLS_READY]:e=>({...e,sliceFormData:(0,l.Hu)(t.controlsState)}),[u.TRIGGER_QUERY]:e=>({...e,triggerQuery:t.value,chartStatus:"loading"}),[u.RENDER_TRIGGERED]:e=>({...e,lastRendered:t.value}),[u.UPDATE_QUERY_FORM_DATA]:e=>({...e,latestQueryFormData:t.value}),[u.ANNOTATION_QUERY_STARTED](e){var n;null!=(n=e.annotationQuery)&&n[t.annotation.name]&&e.annotationQuery[t.annotation.name].abort();const r={...e.annotationQuery,[t.annotation.name]:t.queryController};return{...e,annotationQuery:r}},[u.ANNOTATION_QUERY_SUCCESS](e){const n={...e.annotationData,[t.annotation.name]:t.queryResponse.data},r={...e.annotationError};delete r[t.annotation.name];const a={...e.annotationQuery};return delete a[t.annotation.name],{...e,annotationData:n,annotationError:r,annotationQuery:a}},[u.ANNOTATION_QUERY_FAILED](e){const n={...e.annotationData};delete n[t.annotation.name];const r={...e.annotationError,[t.annotation.name]:t.queryResponse?t.queryResponse.error:(0,o.t)("Network error.")},a={...e.annotationQuery};return delete a[t.annotation.name],{...e,annotationData:n,annotationError:r,annotationQuery:a}}};if(t.type===u.REMOVE_CHART)return a()(e,[t.key]);if(t.type===u.UPDATE_CHART_ID){const{newId:n,key:r}=t;return e[n]={...e[r],id:n},delete e[r],e}return t.type===i.$||t.type===c._?{...t.data.charts}:t.type===s.Rn.SET_DATASOURCES?Object.fromEntries(Object.entries(e).map((e=>{let[t,n]=e;return[t,"failed"===n.chartStatus&&n.chartStackTrace?{...n,chartStatus:"",chartStackTrace:null,chartAlert:null}:n]}))):t.type in n?{...e,[t.key]:n[t.type](e[t.key])}:e}},13842:(e,t,n)=>{"use strict";n.d(t,{dc:()=>i,lU:()=>o,zq:()=>s}),n(67294);var r=n(51995),a=n(11965);const o=()=>{const e=(0,r.Fg)();return(0,a.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.tZ)("path",{d:"M16 0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.11 18 18 17.1 18 16V2C18 0.9 17.11 0 16 0Z",fill:e.colors.primary.base}),(0,a.tZ)("path",{d:"M7 14L2 9L3.41 7.59L7 11.17L14.59 3.58L16 5L7 14Z",fill:"white"}))},i=()=>{const e=(0,r.Fg)();return(0,a.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.tZ)("path",{d:"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z",fill:e.colors.grayscale.light1}),(0,a.tZ)("path",{d:"M14 10H4V8H14V10Z",fill:"white"}))},s=()=>{const e=(0,r.Fg)();return(0,a.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,a.tZ)("path",{d:"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z",fill:e.colors.grayscale.light2}),(0,a.tZ)("path",{d:"M16 2V16H2V2H16V2Z",fill:"white"}))}},87253:(e,t,n)=>{"use strict";n.d(t,{lU:()=>s.lU,zq:()=>s.zq,ZP:()=>i}),n(67294);var r=n(51995),a=n(11965);const o=r.iK.span`
  &,
  & svg {
    vertical-align: top;
  }
`;function i(e){let{checked:t,onChange:n,style:r,className:i}=e;return(0,a.tZ)(o,{style:r,onClick:()=>{n(!t)},role:"checkbox",tabIndex:0,"aria-checked":t,"aria-label":"Checkbox",className:i||""},t?(0,a.tZ)(s.lU,null):(0,a.tZ)(s.zq,null))}var s=n(13842)},43700:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i}),n(67294);var r=n(51995),a=n(46445),o=n(11965);const i=Object.assign((0,r.iK)((e=>{let{light:t,bigger:n,bold:r,animateArrows:i,...s}=e;return(0,o.tZ)(a.Z,s)}))`
    .ant-collapse-item {
      .ant-collapse-header {
        font-weight: ${e=>{let{bold:t,theme:n}=e;return t?n.typography.weights.bold:n.typography.weights.normal}};
        font-size: ${e=>{let{bigger:t,theme:n}=e;return t?4*n.gridUnit+"px":"inherit"}};

        .ant-collapse-arrow svg {
          transition: ${e=>{let{animateArrows:t}=e;return t?"transform 0.24s":"none"}};
        }

        ${e=>{let{expandIconPosition:t}=e;return t&&"right"===t&&"\n            .anticon.anticon-right.ant-collapse-arrow > svg {\n              transform: rotate(90deg) !important;\n            }\n          "}}

        ${e=>{let{light:t,theme:n}=e;return t&&`\n            color: ${n.colors.grayscale.light4};\n            .ant-collapse-arrow svg {\n              color: ${n.colors.grayscale.light4};\n            }\n          `}}

        ${e=>{let{ghost:t,bordered:n,theme:r}=e;return t&&n&&`\n            border-bottom: 1px solid ${r.colors.grayscale.light3};\n          `}}
      }
      .ant-collapse-content {
        .ant-collapse-content-box {
          .loading.inline {
            margin: ${e=>{let{theme:t}=e;return 12*t.gridUnit}}px auto;
            display: block;
          }
        }
      }
    }
    .ant-collapse-item-active {
      .ant-collapse-header {
        ${e=>{let{expandIconPosition:t}=e;return t&&"right"===t&&"\n            .anticon.anticon-right.ant-collapse-arrow > svg {\n              transform: rotate(-90deg) !important;\n            }\n          "}}
      }
    }
  `,{Panel:a.Z.Panel})},77775:(e,t,n)=>{"use strict";n.d(t,{Q:()=>A,W:()=>N});var r=n(67294),a=n(29487),o=n(55867),i=n(51995),s=n(31069),l=n(76962),c=n(74069),d=n(35932),u=n(34858),p=n(12515),h=n(27600),m=n(98286),g=n(38703),f=n(9875),v=n(33228),_=n(14114),b=n(34581),y=n(11965);const E=(0,o.t)("Warning! Changing the dataset may break the chart if the metadata does not exist."),T=(0,o.t)("Changing the dataset may break the chart if the chart relies on columns or metadata that does not exist in the target dataset"),S=(0,i.iK)(c.Z)`
  .ant-modal-body {
    display: flex;
    flex-direction: column;
  }
`,C=i.iK.div`
  .btn-container {
    display: flex;
    justify-content: flex-end;
    padding: 0px 15px;
    margin: 10px 0 0 0;
  }

  .confirm-modal-container {
    margin: 9px;
  }
`,Z=i.iK.span`
  cursor: pointer;
  color: ${e=>{let{theme:t}=e;return t.colors.primary.dark1}};
  &: hover {
    color: ${e=>{let{theme:t}=e;return t.colors.primary.dark2}};
  }
`,A=(0,_.ZP)((e=>{let{addDangerToast:t,addSuccessToast:n,onChange:i,onDatasourceSave:c,onHide:_,show:A}=e;const[x,w]=(0,r.useState)(void 0),[R,I]=(0,r.useState)(0),[D,O]=(0,r.useState)(v.dY),[L,N]=(0,r.useState)(!1),[M,k]=(0,r.useState)(),P=(0,r.useRef)(null),{state:{loading:F,resourceCollection:U,resourceCount:$},fetchData:q}=(0,u.Yi)("dataset",(0,o.t)("dataset"),t),V=(0,r.useCallback)((e=>{N(!0),k(e)}),[]),j={pageIndex:R,pageSize:v.IV,filters:[],sortBy:D};(0,p.bX)((()=>{q({...j,...x&&{filters:[{id:"table_name",operator:"ct",value:x}]}})}),h.M$,[x,R,D]),(0,r.useEffect)((()=>{A&&(async()=>{setTimeout((()=>{var e;return null==P||null==(e=P.current)?void 0:e.focus()}),200)})()}),[t,q,i,c,_,V,A]);const H=[{Cell:e=>{let{row:{original:t}}=e;return(0,y.tZ)(Z,{role:"button",tabIndex:0,onClick:()=>V({type:"table",...t})},null==t?void 0:t.table_name)},Header:(0,o.t)("Name"),accessor:"table_name"},{Header:(0,o.t)("Type"),accessor:"kind",disableSortBy:!0},{Header:(0,o.t)("Schema"),accessor:"schema"},{Header:(0,o.t)("Connection"),accessor:"database.database_name",disableSortBy:!0},{Cell:e=>{let{row:{original:{owners:t=[]}}}=e;return(0,y.tZ)(b.Z,{users:t})},Header:(0,o.t)("Owners"),id:"owners",disableSortBy:!0}];return(0,y.tZ)(S,{show:A,onHide:_,responsive:!0,title:(0,o.t)("Swap dataset"),width:L?"432px":"",height:L?"auto":"540px",hideFooter:!L,footer:(0,y.tZ)(r.Fragment,null,L&&(0,y.tZ)(C,null,(0,y.tZ)("div",{className:"btn-container"},(0,y.tZ)(d.Z,{onClick:()=>{N(!1)}},(0,o.t)("Cancel")),(0,y.tZ)(d.Z,{className:"proceed-btn",buttonStyle:"primary",onClick:()=>{s.Z.get({endpoint:`/api/v1/dataset/${null==M?void 0:M.id}`}).then((e=>{let{json:t}=e;t.result.type="table",c(t.result),i(`${null==M?void 0:M.id}__table`)})).catch((e=>{(0,m.O$)(e).then((e=>{let{error:n,message:r}=e;const a=n?n.error||n.statusText||n:r;t(a)}))})),_(),n((0,o.t)("Successfully changed dataset!"))}},(0,o.t)("Proceed")))))},(0,y.tZ)(r.Fragment,null,!L&&(0,y.tZ)(r.Fragment,null,(0,y.tZ)(a.Z,{roomBelow:!0,type:"warning",css:e=>({marginBottom:4*e.gridUnit}),message:(0,y.tZ)(r.Fragment,null,(0,y.tZ)("strong",null,(0,o.t)("Warning!"))," ",T)}),(0,y.tZ)(f.II,{ref:P,type:"text",value:x,placeholder:(0,o.t)("Search / Filter"),onChange:e=>{var t;const n=null!=(t=e.target.value)?t:"";w(n),I(0)}}),F&&(0,y.tZ)(g.Z,null),!F&&(0,y.tZ)(l.Z,{columns:H,data:U,pageSize:v.IV,initialPageIndex:R,initialSortBy:D,totalCount:$,onServerPagination:e=>{I(e.pageIndex),e.sortBy&&O(e.sortBy.length>0?e.sortBy:v.dY)},className:"table-condensed",emptyWrapperType:l.u.Small,serverPagination:!0,isPaginationSticky:!0,scrollTable:!0})),L&&(0,y.tZ)(r.Fragment,null,E)))}));var x=n(37731),w=n(93185),R=n(67913),I=n(28216);const D=(0,R.Z)((()=>Promise.all([n.e(1216),n.e(3727),n.e(6217),n.e(1862)]).then(n.bind(n,1862)))),O=(0,i.iK)(c.Z)`
  .modal-content {
    height: 900px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }

  .modal-header {
    flex: 0 1 auto;
  }
  .modal-body {
    flex: 1 1 auto;
    overflow: auto;
  }

  .modal-footer {
    flex: 0 1 auto;
  }
`;function L(e){const t=null!=e&&e.certified_by||null!=e&&e.certification_details?{certified_by:null==e?void 0:e.certified_by,details:null==e?void 0:e.certification_details}:void 0;return JSON.stringify({certification:t,warning_markdown:null==e?void 0:e.warning_markdown})}const N=(0,_.ZP)((e=>{var t;let{addSuccessToast:n,datasource:i,onDatasourceSave:l,onHide:u,show:p}=e;const[h,g]=(0,r.useState)({...i,metrics:null==i||null==(t=i.metrics)?void 0:t.map((e=>({...e,currency:JSON.parse(e.currency||"null")})))}),f=(0,I.v9)((e=>{var t;return null==(t=e.common)?void 0:t.currencies})),[v,_]=(0,r.useState)([]),[b,E]=(0,r.useState)(!1),[T,S]=(0,r.useState)(!1),C=(0,r.useRef)(null),[Z,A]=c.Z.useModal(),R=()=>{var e,t,r,a,i;const c=(null==(e=h.tableSelector)?void 0:e.schema)||(null==(t=h.databaseSelector)?void 0:t.schema)||h.schema;E(!0),s.Z.put({endpoint:`/api/v1/dataset/${h.id}`,jsonPayload:{table_name:h.table_name,database_id:null==(r=h.database)?void 0:r.id,sql:h.sql,filter_select_enabled:h.filter_select_enabled,fetch_values_predicate:h.fetch_values_predicate,schema:c,description:h.description,main_dttm_col:h.main_dttm_col,normalize_columns:h.normalize_columns,offset:h.offset,default_endpoint:h.default_endpoint,cache_timeout:""===h.cache_timeout?null:h.cache_timeout,is_sqllab_view:h.is_sqllab_view,template_params:h.template_params,extra:h.extra,is_managed_externally:h.is_managed_externally,external_url:h.external_url,metrics:null==h||null==(a=h.metrics)?void 0:a.map((e=>{const t={expression:e.expression,description:e.description,metric_name:e.metric_name,metric_type:e.metric_type,d3format:e.d3format||null,currency:(0,x.Z)(e.currency)?JSON.stringify(e.currency):null,verbose_name:e.verbose_name,warning_text:e.warning_text,uuid:e.uuid,extra:L(e)};return Number.isNaN(Number(e.id))||(t.id=e.id),t})),columns:null==h||null==(i=h.columns)?void 0:i.map((e=>({id:"number"==typeof e.id?e.id:void 0,column_name:e.column_name,type:e.type,advanced_data_type:e.advanced_data_type,verbose_name:e.verbose_name,description:e.description,expression:e.expression,filterable:e.filterable,groupby:e.groupby,is_active:e.is_active,is_dttm:e.is_dttm,python_date_format:e.python_date_format||null,uuid:e.uuid,extra:L(e)}))),owners:h.owners.map((e=>e.value||e.id))}}).then((()=>(n((0,o.t)("The dataset has been saved")),s.Z.get({endpoint:`/api/v1/dataset/${null==h?void 0:h.id}`})))).then((e=>{let{json:t}=e;t.result.type="table",l({...t.result,owners:h.owners}),u()})).catch((e=>{E(!1),(0,m.O$)(e).then((e=>{let{error:t}=e;Z.error({title:(0,o.t)("Error"),content:t||(0,o.t)("An error has occurred"),okButtonProps:{danger:!0,className:"btn-danger"}})}))}))},N=!(0,w.cr)(w.TT.DISABLE_LEGACY_DATASOURCE_EDITOR);return(0,y.tZ)(O,{show:p,onHide:u,title:(0,y.tZ)("span",null,(0,o.t)("Edit Dataset "),(0,y.tZ)("strong",null,h.table_name)),maskClosable:!T,footer:(0,y.tZ)(r.Fragment,null,N&&(0,y.tZ)(d.Z,{buttonSize:"small",buttonStyle:"default",className:"m-r-5",onClick:()=>{window.location.href=h.edit_url||h.url}},(0,o.t)("Use legacy datasource editor")),(0,y.tZ)(d.Z,{buttonSize:"small",className:"m-r-5",onClick:u},(0,o.t)("Cancel")),(0,y.tZ)(d.Z,{buttonSize:"small",buttonStyle:"primary",onClick:()=>{C.current=Z.confirm({title:(0,o.t)("Confirm save"),content:(0,y.tZ)("div",null,(0,y.tZ)(a.Z,{css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),type:"warning",showIcon:!0,message:(0,o.t)("The dataset configuration exposed here\n                affects all the charts using this dataset.\n                Be mindful that changing settings\n                here may affect other charts\n                in undesirable ways.")}),(0,o.t)("Are you sure you want to save and apply changes?")),onOk:R,icon:null,okText:(0,o.t)("OK"),cancelText:(0,o.t)("Cancel")})},disabled:b||v.length>0||h.is_managed_externally,tooltip:h.is_managed_externally?(0,o.t)("This dataset is managed externally, and can't be edited in Superset"):""},(0,o.t)("Save"))),responsive:!0},(0,y.tZ)(D,{showLoadingForImport:!0,height:500,datasource:h,onChange:(e,t)=>{g({...e,metrics:null==e?void 0:e.metrics.map((e=>({...e,is_certified:(null==e?void 0:e.certified_by)||(null==e?void 0:e.certification_details)})))}),_(t)},setIsEditing:S,currencies:f}),A)}))},62276:(e,t,n)=>{"use strict";n.d(t,{M:()=>s,S:()=>i});var r=n(60593),a=n(51995);const o=r.Z.RangePicker,i=(0,a.iK)(o)`
  border-radius: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,s=r.Z},14278:(e,t,n)=>{"use strict";n.d(t,{EM:()=>y,Zn:()=>m,gp:()=>g});var r=n(14176),a=n.n(r),o=n(67294),i=n(11064),s=n(22102),l=n(93185),c=n(81847),d=n(68492),u=n(11965);const p=(0,i.Z)(),h={loading:!0,dynamicPlugins:{},keys:[],mountedPluginMetadata:{},fetchAll:()=>{}},m=o.createContext(h),g=()=>(0,o.useContext)(m);function f(){return{keys:p.keys(),mountedPluginMetadata:a()(p.getMap(),(e=>void 0===e))}}function v(e,t){switch(t.type){case"begin":{const n={...e.dynamicPlugins};return t.keys.forEach((e=>{n[e]={key:e,error:null,mounting:!0}})),{...e,loading:t.keys.length>0,dynamicPlugins:n}}case"complete":return{...e,loading:Object.values(e.dynamicPlugins).some((e=>e.mounting&&e.key!==t.key)),dynamicPlugins:{...e.dynamicPlugins,[t.key]:{key:t.key,mounting:!1,error:t.error}}};case"changed keys":return{...e,...f()};default:return e}}const _=(0,s.Z)({method:"GET",endpoint:"/dynamic-plugins/api/read"}),b={react:()=>Promise.resolve().then(n.t.bind(n,67294,19)),lodash:()=>n.e(6486).then(n.t.bind(n,96486,23)),"react-dom":()=>Promise.resolve().then(n.t.bind(n,90731,19)),"@superset-ui/chart-controls":()=>n.e(8989).then(n.bind(n,48989)),"@superset-ui/core":()=>Promise.all([n.e(1216),n.e(2087),n.e(981),n.e(6377),n.e(8795),n.e(868),n.e(4854)]).then(n.bind(n,77069))},y=e=>{let{children:t}=e;const[n,r]=(0,o.useReducer)(v,h,(e=>({...e,...f(),fetchAll:a,loading:(0,l.cr)(l.TT.DYNAMIC_PLUGINS)})));async function a(){try{await(0,c.YW)(b);const{result:e}=await _({});r({type:"begin",keys:e.map((e=>e.key))}),await Promise.all(e.map((async e=>{let t=null;try{await import(e.bundle_url)}catch(n){d.Z.error(`Failed to load plugin ${e.key} with the following error:`,n.stack),t=n}r({type:"complete",key:e.key,error:t})})))}catch(e){d.Z.error("Failed to load dynamic plugins",e.stack||e)}}return(0,o.useEffect)((()=>{(0,l.cr)(l.TT.DYNAMIC_PLUGINS)&&a();const e=()=>{r({type:"changed keys"})};return p.addListener(e),()=>{p.removeListener(e)}}),[]),(0,u.tZ)(m.Provider,{value:n},t)}},94301:(e,t,n)=>{"use strict";n.d(t,{Tc:()=>S,UX:()=>Z,XJ:()=>E,x3:()=>T}),n(67294);var r,a=n(51995),o=n(11965),i=n(55867),s=n(4715),l=n(35932);!function(e){e[e.Small=0]="Small",e[e.Medium=1]="Medium",e[e.Big=2]="Big"}(r||(r={}));const c=a.iK.div`
  ${e=>{let{theme:t}=e;return o.iv`
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
    align-items: center;
    justify-content: center;
    padding: ${4*t.gridUnit}px;
    text-align: center;

    & .ant-empty-image svg {
      width: auto;
    }

    & a,
    & span[role='button'] {
      color: inherit;
      text-decoration: underline;
      &:hover {
        color: ${t.colors.grayscale.base};
      }
    }
  `}}
`,d=a.iK.div``,u=a.iK.p`
  ${e=>{let{theme:t}=e;return o.iv`
    font-size: ${t.typography.sizes.m}px;
    color: ${t.colors.grayscale.light1};
    margin: ${2*t.gridUnit}px 0 0 0;
    font-weight: ${t.typography.weights.bold};
  `}}
`,p=(0,a.iK)(u)`
  ${e=>{let{theme:t}=e;return o.iv`
    font-size: ${t.typography.sizes.l}px;
    color: ${t.colors.grayscale.light1};
    margin-top: ${4*t.gridUnit}px;
  `}}
`,h=a.iK.p`
  ${e=>{let{theme:t}=e;return o.iv`
    font-size: ${t.typography.sizes.s}px;
    color: ${t.colors.grayscale.light1};
    margin: ${2*t.gridUnit}px 0 0 0;
  `}}
`,m=(0,a.iK)(h)`
  ${e=>{let{theme:t}=e;return o.iv`
    font-size: ${t.typography.sizes.m}px;
  `}}
`,g=(0,a.iK)(h)`
  ${e=>{let{theme:t}=e;return o.iv`
    margin-top: ${t.gridUnit}px;
    line-height: 1.2;
  `}}
`,f=(0,a.iK)(l.Z)`
  ${e=>{let{theme:t}=e;return o.iv`
    margin-top: ${4*t.gridUnit}px;
    z-index: 1;
  `}}
`,v=e=>"string"==typeof e?`/static/assets/images/${e}`:e,_=e=>{switch(e){case r.Small:return{height:"50px"};case r.Medium:return{height:"80px"};case r.Big:return{height:"150px"};default:return{height:"50px"}}},b=e=>{let{image:t,size:n}=e;return(0,o.tZ)(s.HY,{description:!1,image:v(t),imageStyle:_(n)})},y=e=>{e.preventDefault(),e.stopPropagation()},E=e=>{let{title:t,image:n,description:a,buttonAction:i,buttonText:s,className:l}=e;return(0,o.tZ)(c,{className:l},n&&(0,o.tZ)(b,{image:n,size:r.Big}),(0,o.tZ)(d,{css:e=>o.iv`
        max-width: ${150*e.gridUnit}px;
      `},(0,o.tZ)(p,null,t),a&&(0,o.tZ)(m,null,a),i&&s&&(0,o.tZ)(f,{buttonStyle:"primary",onClick:i,onMouseDown:y},s)))},T=e=>{let{title:t,image:n,description:a,buttonAction:i,buttonText:s}=e;return(0,o.tZ)(c,null,n&&(0,o.tZ)(b,{image:n,size:r.Medium}),(0,o.tZ)(d,{css:e=>o.iv`
        max-width: ${100*e.gridUnit}px;
      `},(0,o.tZ)(u,null,t),a&&(0,o.tZ)(h,null,a),s&&i&&(0,o.tZ)(f,{buttonStyle:"primary",onClick:i,onMouseDown:y},s)))},S=e=>{let{title:t,image:n,description:a}=e;return(0,o.tZ)(c,null,n&&(0,o.tZ)(b,{image:n,size:r.Small}),(0,o.tZ)(d,{css:e=>o.iv`
        max-width: ${75*e.gridUnit}px;
      `},(0,o.tZ)(u,null,t),a&&(0,o.tZ)(g,null,a)))},C={NO_DATABASES_MATCH_TITLE:(0,i.t)("No databases match your search"),NO_DATABASES_AVAILABLE_TITLE:(0,i.t)("There are no databases available"),MANAGE_YOUR_DATABASES_TEXT:(0,i.t)("Manage your databases"),HERE_TEXT:(0,i.t)("here")},Z=e=>(0,o.tZ)(S,{image:"empty.svg",title:e?C.NO_DATABASES_MATCH_TITLE:C.NO_DATABASES_AVAILABLE_TITLE,description:(0,o.tZ)("p",null,C.MANAGE_YOUR_DATABASES_TEXT," ",(0,o.tZ)("a",{href:"/databaseview/list"},C.HERE_TEXT))})},72875:(e,t,n)=>{"use strict";n.d(t,{Z:()=>c});var r=n(67294),a=n(55867),o=n(92869),i=n(91178),s=n(11965);const l=(0,a.t)("Unexpected error");function c(e){let{title:t=l,error:n,subtitle:a,copyText:c,link:d,stackTrace:u,source:p,description:h,fallback:m}=e;if(n){const e=(0,o.Z)().get(n.error_type);if(e)return(0,s.tZ)(e,{error:n,source:p,subtitle:a})}return m?(0,s.tZ)(r.Fragment,null,m):(0,s.tZ)(i.Z,{level:"warning",title:t,subtitle:a,copyText:c,description:h,source:p,body:d||u?(0,s.tZ)(r.Fragment,null,d&&(0,s.tZ)("a",{href:d,target:"_blank",rel:"noopener noreferrer"},"(Request Access)"),(0,s.tZ)("br",null),u&&(0,s.tZ)("pre",null,u)):void 0})}},34581:(e,t,n)=>{"use strict";n.d(t,{Z:()=>m}),n(67294);var r=n(81545),a=n(51995),o=n(58593),i=n(4715);var s,l,c=n(11965);const d=null!=(s=null==(l=(0,r.Z)().get())?void 0:l.colors)?s:[],u=e=>`\n  width: ${6*e.gridUnit}px;\n  height: ${6*e.gridUnit}px;\n  line-height: ${6*e.gridUnit}px;\n  font-size: ${e.typography.sizes.m}px;\n`,p=(0,a.iK)(i.qE)`
  ${e=>{let{theme:t}=e;return u(t)}}
`,h=(0,a.iK)(i.qE.Group)`
  .ant-avatar {
    ${e=>{let{theme:t}=e;return u(t)}}
  }
`;function m(e){let{users:t,maxCount:n=4}=e;return(0,c.tZ)(h,{maxCount:n},t.map((e=>{var t,n;let{first_name:r,last_name:a,id:i}=e;const s=`${r} ${a}`,l=function(e,t){return e?t[function(e,t){const n=[...e].map((e=>e.charCodeAt(0))),r=n.length,a=r%(t-1)+1,o=n.reduce(((e,t)=>e+t))%t;let i=n[0]%t;return[...new Array(r)].forEach((()=>{i=(a*i+o)%t})),i}(e,t.length)]:"transparent"}(`${i}-${r}-${a}`,d);return(0,c.tZ)(o.u,{key:s,title:s,placement:"top"},(0,c.tZ)(p,{key:s,style:{backgroundColor:l,borderColor:l}},null==r||null==(t=r[0])?void 0:t.toLocaleUpperCase(),null==a||null==(n=a[0])?void 0:n.toLocaleUpperCase()))})))}},4591:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(97538);const a=(0,n(51995).iK)(r.Z.Item)`
  ${e=>{let{theme:t}=e;return`\n    .ant-form-item-label {\n      padding-bottom: ${t.gridUnit}px;\n      & > label {\n        text-transform: uppercase;\n        font-size: ${t.typography.sizes.s}px;\n        color: ${t.colors.grayscale.base};\n\n        &.ant-form-item-required:not(.ant-form-item-required-mark-optional) {\n          &::before {\n            display: none;\n          }\n          &::after {\n            display: inline-block;\n            color: ${t.colors.error.base};\n            font-size: ${t.typography.sizes.s}px;\n            content: '*';\n          }\n        }\n      }\n    }\n  `}}
`},2857:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s}),n(67294);var r=n(51995),a=n(11965);const o=r.iK.label`
  text-transform: uppercase;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,i=r.iK.label`
  text-transform: uppercase;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  &::after {
    display: inline-block;
    margin-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    color: ${e=>{let{theme:t}=e;return t.colors.error.base}};
    font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.m}}px;
    content: '*';
  }
`;function s(e){let{children:t,htmlFor:n,required:r=!1,className:s}=e;const l=r?i:o;return(0,a.tZ)(l,{htmlFor:n,className:s},t)}},87858:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Z});var r,a=n(5872),o=n.n(a),i=n(67294),s=n(77808),l=n(31097),c=n(51995),d=n(11965),u=n(55867),p=n(8272),h=n(70163);function m(){return m=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},m.apply(this,arguments)}function g(e,t){let{title:n,titleId:a,...o}=e;return i.createElement("svg",m({width:24,height:24,fill:"none",xmlns:"http://www.w3.org/2000/svg",ref:t,"aria-labelledby":a},o),n?i.createElement("title",{id:a},n):null,r||(r=i.createElement("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M12 7a1 1 0 00-1 1v4a1 1 0 102 0V8a1 1 0 00-1-1zm0 8a1 1 0 100 2 1 1 0 000-2zm9.71-7.44l-5.27-5.27a1.05 1.05 0 00-.71-.29H8.27a1.05 1.05 0 00-.71.29L2.29 7.56a1.05 1.05 0 00-.29.71v7.46c.004.265.107.518.29.71l5.27 5.27c.192.183.445.286.71.29h7.46a1.05 1.05 0 00.71-.29l5.27-5.27a1.05 1.05 0 00.29-.71V8.27a1.05 1.05 0 00-.29-.71zM20 15.31L15.31 20H8.69L4 15.31V8.69L8.69 4h6.62L20 8.69v6.62z",fill:"currentColor"})))}const f=i.forwardRef(g);var v=n(4591),_=n(2857);const b=(0,c.iK)(s.Z)`
  margin: ${e=>{let{theme:t}=e;return`${t.gridUnit}px 0 ${2*t.gridUnit}px`}};
`,y=(0,c.iK)(s.Z.Password)`
  margin: ${e=>{let{theme:t}=e;return`${t.gridUnit}px 0 ${2*t.gridUnit}px`}};
`,E=(0,c.iK)("div")`
  input::-webkit-outer-spin-button,
  input::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }
  margin-bottom: ${e=>{let{theme:t}=e;return 3*t.gridUnit}}px;
  .ant-form-item {
    margin-bottom: 0;
  }
`,T=c.iK.div`
  display: flex;
  align-items: center;
`,S=(0,c.iK)(_.Z)`
  margin-bottom: 0;
`,C=d.iv`
  &.anticon > * {
    line-height: 0;
  }
`,Z=e=>{let{label:t,validationMethods:n,errorMessage:r,helpText:a,required:i=!1,hasTooltip:s=!1,tooltipText:c,id:m,className:g,visibilityToggle:_,...Z}=e;return(0,d.tZ)(E,{className:g},(0,d.tZ)(T,null,(0,d.tZ)(S,{htmlFor:m,required:i},t),s&&(0,d.tZ)(p.Z,{tooltip:`${c}`,viewBox:"0 -1 24 24"})),(0,d.tZ)(v.Z,{css:e=>((e,t)=>d.iv`
  .ant-form-item-children-icon {
    display: none;
  }
  ${t&&`.ant-form-item-control-input-content {\n      position: relative;\n      &:after {\n        content: ' ';\n        display: inline-block;\n        background: ${e.colors.error.base};\n        mask: url(${f});\n        mask-size: cover;\n        width: ${4*e.gridUnit}px;\n        height: ${4*e.gridUnit}px;\n        position: absolute;\n        right: ${1.25*e.gridUnit}px;\n        top: ${2.75*e.gridUnit}px;\n      }\n    }`}
`)(e,!!r),validateTrigger:Object.keys(n),validateStatus:r?"error":"success",help:r||a,hasFeedback:!!r},_||"password"===Z.name?(0,d.tZ)(y,o()({},Z,n,{iconRender:e=>e?(0,d.tZ)(l.Z,{title:(0,u.t)("Hide password.")},(0,d.tZ)(h.Z.EyeInvisibleOutlined,{iconSize:"m",css:C})):(0,d.tZ)(l.Z,{title:(0,u.t)("Show password.")},(0,d.tZ)(h.Z.EyeOutlined,{iconSize:"m",css:C})),role:"textbox"})):(0,d.tZ)(b,o()({},Z,n))))}},49238:(e,t,n)=>{"use strict";n.d(t,{l0:()=>s,xJ:()=>l.Z,lX:()=>c.Z,QA:()=>d.Z}),n(67294);var r=n(97538),a=n(51995),o=n(11965);const i=(0,a.iK)(r.Z)`
  &.ant-form label {
    font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  }
  .ant-form-item {
    margin-bottom: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
  }
`;function s(e){return(0,o.tZ)(i,e)}var l=n(4591),c=n(2857),d=n(87858)},8272:(e,t,n)=>{"use strict";n.d(t,{Z:()=>u}),n(67294);var r=n(51995),a=n(58593),o=n(70163),i=n(11965);const s=(0,r.iK)(a.u)`
  cursor: pointer;
  path:first-of-type {
    fill: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  }
`,l=r.iK.span`
  display: -webkit-box;
  -webkit-line-clamp: 20;
  -webkit-box-orient: vertical;
  overflow: hidden;
  text-overflow: ellipsis;
`,c={fontSize:"12px",lineHeight:"16px"},d="rgba(0,0,0,0.9)";function u(e){let{tooltip:t,placement:n="right",trigger:r="hover",overlayStyle:a=c,bgColor:u=d,viewBox:p="0 -2 24 24"}=e;return(0,i.tZ)(s,{title:(0,i.tZ)(l,null,t),placement:n,trigger:r,overlayStyle:a,color:u},(0,i.tZ)(o.Z.InfoSolidSmall,{className:"info-solid-small",viewBox:p}))}},9875:(e,t,n)=>{"use strict";n.d(t,{II:()=>i,Kx:()=>l,Rn:()=>s});var r=n(51995),a=n(77808),o=n(36795);const i=(0,r.iK)(a.Z)`
  border: 1px solid ${e=>{let{theme:t}=e;return t.colors.secondary.light3}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}}px;
`,s=(0,r.iK)(o.Z)`
  border: 1px solid ${e=>{let{theme:t}=e;return t.colors.secondary.light3}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}}px;
`,l=(0,r.iK)(a.Z.TextArea)`
  border: 1px solid ${e=>{let{theme:t}=e;return t.colors.secondary.light3}};
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}}px;
`},83862:(e,t,n)=>{"use strict";n.d(t,{$:()=>c,v:()=>l});var r=n(51995),a=n(43865);const o=(0,r.iK)(a.Z.Item)`
  > a {
    text-decoration: none;
  }

  &.ant-menu-item {
    height: ${e=>{let{theme:t}=e;return 8*t.gridUnit}}px;
    line-height: ${e=>{let{theme:t}=e;return 8*t.gridUnit}}px;
    a {
      border-bottom: none;
      transition: background-color ${e=>{let{theme:t}=e;return t.transitionTiming}}s;
      &:after {
        content: '';
        position: absolute;
        bottom: -3px;
        left: 50%;
        width: 0;
        height: 3px;
        opacity: 0;
        transform: translateX(-50%);
        transition: all ${e=>{let{theme:t}=e;return t.transitionTiming}}s;
        background-color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
      }
      &:focus {
        border-bottom: none;
        background-color: transparent;
        @media (max-width: 767px) {
          background-color: ${e=>{let{theme:t}=e;return t.colors.primary.light5}};
        }
      }
    }
  }

  &.ant-menu-item,
  &.ant-dropdown-menu-item {
    span[role='button'] {
      display: inline-block;
      width: 100%;
    }
    transition-duration: 0s;
  }
`,i=(0,r.iK)(a.Z)`
  line-height: 51px;
  border: none;

  & > .ant-menu-item,
  & > .ant-menu-submenu {
    vertical-align: inherit;
    &:hover {
      color: ${e=>{let{theme:t}=e;return t.colors.grayscale.dark1}};
    }
  }

  &:not(.ant-menu-dark) > .ant-menu-submenu,
  &:not(.ant-menu-dark) > .ant-menu-item {
    &:hover {
      border-bottom: none;
    }
  }

  &:not(.ant-menu-dark) > .ant-menu-submenu,
  &:not(.ant-menu-dark) > .ant-menu-item {
    margin: 0px;
  }

  & > .ant-menu-item > a {
    padding: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
  }
`,s=(0,r.iK)(a.Z.SubMenu)`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.dark1}};
  border-bottom: none;
  .ant-menu-submenu-open,
  .ant-menu-submenu-active {
    background-color: ${e=>{let{theme:t}=e;return t.colors.primary.light5}};
    .ant-menu-submenu-title {
      color: ${e=>{let{theme:t}=e;return t.colors.grayscale.dark1}};
      background-color: ${e=>{let{theme:t}=e;return t.colors.primary.light5}};
      border-bottom: none;
      margin: 0;
      &:after {
        opacity: 1;
        width: calc(100% - 1);
      }
    }
  }
  .ant-menu-submenu-title {
    position: relative;
    top: ${e=>{let{theme:t}=e;return-t.gridUnit-3}}px;
    &:after {
      content: '';
      position: absolute;
      bottom: -3px;
      left: 50%;
      width: 0;
      height: 3px;
      opacity: 0;
      transform: translateX(-50%);
      transition: all ${e=>{let{theme:t}=e;return t.transitionTiming}}s;
      background-color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
    }
  }
  .ant-menu-submenu-arrow {
    top: 67%;
  }
  & > .ant-menu-submenu-title {
    padding: 0 ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px 0
      ${e=>{let{theme:t}=e;return 3*t.gridUnit}}px !important;
    span[role='img'] {
      position: absolute;
      right: ${e=>{let{theme:t}=e;return-t.gridUnit-2}}px;
      top: ${e=>{let{theme:t}=e;return 5.25*t.gridUnit}}px;
      svg {
        font-size: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
        color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
      }
    }
    & > span {
      position: relative;
      top: 7px;
    }
    &:hover {
      color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
    }
  }
`,l=Object.assign(a.Z,{Item:o}),c=Object.assign(i,{Item:o,SubMenu:s,Divider:a.Z.Divider,ItemGroup:a.Z.ItemGroup})},1304:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(67294),a=n(74069),o=n(35932),i=n(11965);const s=r.forwardRef(((e,t)=>{const[n,s]=(0,r.useState)(!1),{beforeOpen:l=(()=>{}),onExit:c=(()=>{}),isButton:d=!1,resizable:u=!1,draggable:p=!1,className:h="",tooltip:m,modalFooter:g,triggerNode:f,destroyOnClose:v=!0,modalBody:_,draggableConfig:b={},resizableConfig:y={},modalTitle:E,responsive:T,width:S,maxWidth:C}=e,Z=()=>{s(!1),null==c||c()},A=e=>{e.preventDefault(),null==l||l(),s(!0)};return t&&(t.current={close:Z,open:A}),(0,i.tZ)(r.Fragment,null,d&&(0,i.tZ)(o.Z,{className:"modal-trigger",tooltip:m,onClick:A},f),!d&&(0,i.tZ)("span",{onClick:A,role:"button"},f),(0,i.tZ)(a.Z,{className:h,show:n,onHide:Z,title:E,footer:g,hideFooter:!g,width:S,maxWidth:C,responsive:T,resizable:u,resizableConfig:y,draggable:p,draggableConfig:b,destroyOnClose:v},_))}))},99299:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o}),n(67294);var r=n(19181),a=n(11965);const o=e=>(0,a.tZ)(r.Z,e)},83734:(e,t,n)=>{"use strict";n.d(t,{Z:()=>s});var r=n(11965),a=(n(67294),n(51995)),o=n(58593),i=n(70163);function s(e){let{title:t,isSelected:n,children:s,onSelect:l,info:c}=e;const d=(0,a.Fg)();return(0,r.tZ)("div",{css:(0,r.iv)({paddingBottom:2*d.gridUnit,opacity:n?1:d.opacity.mediumHeavy},"","")},(0,r.tZ)("div",{role:"button",tabIndex:0,onClick:l,css:(0,r.iv)({display:"flex",alignItems:"center",cursor:l?"pointer":"default"},"","")},(0,r.tZ)("strong",null,t),c&&(0,r.tZ)(o.u,{title:c,css:(0,r.iv)({marginLeft:d.gridUnit},"","")},(0,r.tZ)(i.Z.InfoSolidSmall,{role:"img",width:14,height:14,iconColor:d.colors.grayscale.light1})),(0,r.tZ)(i.Z.Check,{role:"img",iconColor:n?d.colors.primary.base:d.colors.grayscale.base})),(0,r.tZ)("div",{css:(0,r.iv)({marginLeft:d.gridUnit,marginTop:d.gridUnit},"","")},s))}},87183:(e,t,n)=>{"use strict";n.d(t,{Y:()=>s});var r=n(51995),a=n(47933);const o=(0,r.iK)(a.ZP)`
  .ant-radio-inner {
    top: -1px;
    left: 2px;
    width: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
    height: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
    border-width: 2px;
    border-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  }

  .ant-radio.ant-radio-checked {
    .ant-radio-inner {
      border-width: ${e=>{let{theme:t}=e;return t.gridUnit+1}}px;
      border-color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
    }

    .ant-radio-inner::after {
      background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light5}};
      top: 0;
      left: 0;
      width: ${e=>{let{theme:t}=e;return t.gridUnit+2}}px;
      height: ${e=>{let{theme:t}=e;return t.gridUnit+2}}px;
    }
  }

  .ant-radio:hover,
  .ant-radio:focus {
    .ant-radio-inner {
      border-color: ${e=>{let{theme:t}=e;return t.colors.primary.dark1}};
    }
  }
`,i=(0,r.iK)(a.ZP.Group)`
  font-size: inherit;
`,s=Object.assign(o,{Group:i,Button:a.ZP.Button})},86057:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l});var r=n(11965),a=(n(67294),n(51995)),o=n(78186),i=n(70163),s=n(58593);const l=function(e){let{warningMarkdown:t,size:n,marginRight:l}=e;const c=(0,a.Fg)();return(0,r.tZ)(s.u,{id:"warning-tooltip",title:(0,r.tZ)(o.Z,{source:t})},(0,r.tZ)(i.Z.AlertSolid,{iconColor:c.colors.alert.base,iconSize:n,css:(0,r.iv)({marginRight:null!=l?l:2*c.gridUnit},"","")}))}},41295:(e,t,n)=>{"use strict";n.d(t,{$A:()=>u,C6:()=>b,Fl:()=>v,Jy:()=>m,Mi:()=>g,Mn:()=>_,a8:()=>h,fO:()=>p,nH:()=>f});var r=n(47037),a=n.n(r),o=n(28062),i=n(22102),s=n(55867),l=n(98286),c=n(72570),d=n(9467);const u="DASHBOARD_INFO_UPDATED";function p(e,t){const n=o.getNamespace(null==e?void 0:e.color_namespace),r=a()(t)?JSON.parse(t):t;Object.keys(r).forEach((e=>{n.setColor(e,r[e])}))}function h(e){const{metadata:t}=e;return o.getNamespace(null==t?void 0:t.color_namespace).resetColors(),null!=t&&t.shared_label_colors&&p(t,null==t?void 0:t.shared_label_colors),null!=t&&t.label_colors&&p(t,null==t?void 0:t.label_colors),{type:u,newInfo:e}}const m="SAVE_CHART_CONFIG_COMPLETE",g=e=>{let{chartConfiguration:t,globalChartConfiguration:n}=e;return async(e,r)=>{e({type:"SAVE_CHART_CONFIG_BEGIN",chartConfiguration:t,globalChartConfiguration:n});const{id:a,metadata:o}=r().dashboardInfo,l=(0,i.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${a}`});try{const r=await l({json_metadata:JSON.stringify({...o,chart_configuration:null!=t?t:o.chart_configuration,global_chart_configuration:null!=n?n:o.global_chart_configuration})});e(h({metadata:JSON.parse(r.result.json_metadata)})),e({type:m,chartConfiguration:t,globalChartConfiguration:n})}catch(r){e({type:"SAVE_CHART_CONFIG_FAIL",chartConfiguration:t,globalChartConfiguration:n}),e((0,c.Gb)((0,s.t)("Failed to save cross-filter scoping")))}}},f="SET_FILTER_BAR_ORIENTATION",v="SET_CROSS_FILTERS_ENABLED";function _(e){return async(t,n)=>{const{id:r,metadata:a}=n().dashboardInfo,o=(0,i.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${r}`});try{const n=await o({json_metadata:JSON.stringify({...a,filter_bar_orientation:e})}),r=n.result,i=n.last_modified_time;if(r.json_metadata){const e=JSON.parse(r.json_metadata);e.filter_bar_orientation&&t((s=e.filter_bar_orientation,{type:f,filterBarOrientation:s}))}i&&t((0,d.Vv)(i))}catch(e){const n=await(0,l.HR)(e,"dashboard");throw t((0,c.Gb)(n)),e}var s}}function b(e){return async(t,n)=>{const{id:r,metadata:a}=n().dashboardInfo,o=(0,i.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${r}`});try{const n=await o({json_metadata:JSON.stringify({...a,cross_filters_enabled:e})}),r=n.result,i=n.last_modified_time;r.json_metadata&&t(function(e){return{type:v,crossFiltersEnabled:e}}(JSON.parse(r.json_metadata).cross_filters_enabled)),i&&t((0,d.Vv)(i))}catch(e){const n=await(0,l.HR)(e,"dashboard");throw t((0,c.Gb)(n)),e}}}},50810:(e,t,n)=>{"use strict";n.d(t,{Fy:()=>o,QR:()=>s,Rn:()=>r});var r,a=n(31069);function o(e){return{type:r.SET_DATASOURCES,datasources:e}}function i(e,t){return{type:r.SET_DATASOURCE,key:t,datasource:e}}function s(e){return(t,n)=>{const{datasources:r}=n(),o=r[e];return o?t(i(o,e)):a.Z.get({endpoint:`/superset/fetch_datasource_metadata?datasourceKey=${e}`}).then((n=>{let{json:r}=n;return t(i(r,e))}))}}!function(e){e.SET_DATASOURCES="SET_DATASOURCES",e.SET_DATASOURCE="SET_DATASOURCE"}(r||(r={}))},52794:(e,t,n)=>{"use strict";n.d(t,{$7:()=>b,$l:()=>f,DU:()=>C,RY:()=>u,T6:()=>_,TT:()=>T,Up:()=>y,X8:()=>v,Zp:()=>d,jE:()=>E,kN:()=>c,pi:()=>h,qN:()=>S,qe:()=>l,ql:()=>g,rF:()=>A,rR:()=>Z,xQ:()=>m,xk:()=>p});var r=n(50361),a=n.n(r),o=n(22102),i=n(74599),s=n(41295);const l="SET_FILTER_CONFIG_COMPLETE",c="SET_IN_SCOPE_STATUS_OF_FILTERS",d="SET_FILTER_SETS_COMPLETE",u=e=>async(t,n)=>{var r;t({type:"SET_FILTER_CONFIG_BEGIN",filterConfig:e});const{id:a,metadata:c}=n().dashboardInfo,d=null==(r=n().nativeFilters)?void 0:r.filters,u=(0,o.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${a}`}),p=e.map((e=>{const t=d[e.id];return t?{...t,...e}:e}));try{const e=await u({json_metadata:JSON.stringify({...c,native_filter_configuration:p})});t((0,s.a8)({metadata:JSON.parse(e.result.json_metadata)})),t({type:l,filterConfig:p}),t((0,i.Ft)(p,d))}catch(e){t({type:"SET_FILTER_CONFIG_FAIL",filterConfig:p}),t({type:i.u3,filterConfig:p})}},p=e=>async(t,n)=>{var r;const o=null==(r=n().nativeFilters)?void 0:r.filters,i=e.map((e=>({...o[e.filterId],chartsInScope:e.chartsInScope,tabsInScope:e.tabsInScope})));t({type:c,filterConfig:i});const l=a()(n().dashboardInfo.metadata),d=l.native_filter_configuration.map((e=>{const t=i.find((t=>t.id===e.id));return t?{...t,...e}:e}));l.native_filter_configuration=d,t((0,s.a8)({metadata:l}))},h=e=>async t=>{const n=(0,o.Z)({method:"GET",endpoint:`/api/v1/dashboard/${e}/filtersets`});t({type:"SET_FILTER_SETS_BEGIN"});const r=await n(null);t({type:d,filterSets:r.ids.map(((e,t)=>({...r.result[t].params,id:e,name:r.result[t].name})))})},m=e=>async(t,n)=>{const r=n().dashboardInfo.id,a=(0,o.Z)({method:"POST",endpoint:`/api/v1/dashboard/${r}/filtersets`});t({type:"CREATE_FILTER_SET_BEGIN"});const i={...e};delete i.name,await a({name:e.name,owner_type:"Dashboard",owner_id:r,json_metadata:JSON.stringify(i)}),t({type:"CREATE_FILTER_SET_COMPLETE"}),t(h(r))},g=e=>async(t,n)=>{const r=n().dashboardInfo.id,a=(0,o.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${r}/filtersets/${e.id}`});t({type:"UPDATE_FILTER_SET_BEGIN"});const i={...e};delete i.id,delete i.name,await a({name:e.name,json_metadata:JSON.stringify(i)}),t({type:"UPDATE_FILTER_SET_COMPLETE"}),t(h(r))},f=e=>async(t,n)=>{const r=n().dashboardInfo.id,a=(0,o.Z)({method:"DELETE",endpoint:`/api/v1/dashboard/${r}/filtersets/${e}`});t({type:"DELETE_FILTER_SET_BEGIN"}),await a({}),t({type:"DELETE_FILTER_SET_COMPLETE"}),t(h(r))},v="SET_FOCUSED_NATIVE_FILTER",_="UNSET_FOCUSED_NATIVE_FILTER";function b(e){return{type:v,id:e}}function y(){return{type:_}}const E="SET_HOVERED_NATIVE_FILTER",T="UNSET_HOVERED_NATIVE_FILTER";function S(e){return{type:E,id:e}}function C(){return{type:T}}const Z="UPDATE_CASCADE_PARENT_IDS";function A(e,t){return{type:Z,id:e,parentIds:t}}},38523:(e,t,n)=>{"use strict";n.d(t,{D2:()=>p,EO:()=>u,Ff:()=>m,JV:()=>d,cK:()=>h,ex:()=>g});var r=n(15926),a=n.n(r),o=n(93185),i=n(31069),s=n(55867),l=n(72570),c=n(98286);const d="ADD_SLICES",u="SET_SLICES",p="FETCH_ALL_SLICES_STARTED",h="FETCH_ALL_SLICES_FAILED";function m(e){return t=>{t(function(e){return{type:u,payload:{slices:e}}}(e))}}function g(e,t,n){return void 0===n&&(n="changed_on"),r=>{r({type:p});const u=t?[{col:"slice_name",opr:"chart_all_text",value:t}]:[];return(0,o.cr)(o.TT.DASHBOARD_NATIVE_FILTERS)&&u.push({col:"viz_type",opr:"neq",value:"filter_box"}),e&&u.push({col:"owners",opr:"rel_m_m",value:e}),i.Z.get({endpoint:`/api/v1/chart/?q=${a().encode({columns:["changed_on_delta_humanized","changed_on_utc","datasource_id","datasource_type","datasource_url","datasource_name_text","description_markeddown","description","id","params","slice_name","thumbnail_url","url","viz_type","owners.id","created_by.id"],filters:u,page_size:200,order_column:"changed_on"===n?"changed_on_delta_humanized":n,order_direction:"changed_on"===n?"desc":"asc"})}`}).then((e=>{let{json:t}=e;const{result:n}=t,a=(e=>e.reduce(((e,t)=>{let n=JSON.parse(t.params);var r,a;return n={...n,datasource:(r=t.datasource_id,a=t.datasource_type,`${r}__${a}`||n.datasource)},{...e,[t.id]:{slice_id:t.id,slice_url:t.url,slice_name:t.slice_name,form_data:n,datasource_name:t.datasource_name_text,datasource_url:t.datasource_url,datasource_id:t.datasource_id,datasource_type:t.datasource_type,changed_on:new Date(t.changed_on_utc).getTime(),description:t.description,description_markdown:t.description_markeddown,viz_type:t.viz_type,modified:t.changed_on_delta_humanized,changed_on_humanized:t.changed_on_delta_humanized,thumbnail_url:t.thumbnail_url,owners:t.owners,created_by:t.created_by}}}),{}))(n);return r(function(e){return{type:d,payload:{slices:e}}}(a))})).catch((e=>(0,c.O$)(e).then((e=>{let{error:t}=e;r(function(e){return{type:h,payload:{error:e}}}(t||(0,s.t)("Could not fetch all saved charts"))),r((0,l.Gb)((0,s.t)("Sorry there was an error fetching saved charts: ")+t))}))))}}},92242:(e,t,n)=>{"use strict";n.d(t,{EJ:()=>m,G$:()=>p,GA:()=>h,Ky:()=>f,QN:()=>_,W6:()=>v,rW:()=>g,uh:()=>u});var r=n(78580),a=n.n(r),o=n(14670),i=n.n(o),s=n(8868),l=n(68492),c=n(10916),d=n(80621);const u=function(e,t,n){if(void 0===n&&(n=[]),a()(n).call(n,t))return!0;const r=e.get(t);return!!r&&r.some((r=>u(e,r,[...n,t])))},p=async(e,t,n)=>{try{let t;try{t=await e.validateFields()}catch(e){var r;if(null!=e&&null!=(r=e.errorFields)&&r.length||null==e||!e.outOfDate)throw e;t=e.values}return t}catch(e){if(l.Z.warn("Filter configuration failed:",e),!e.errorFields||!e.errorFields.length)return null;const r=e.errorFields;if(!r.some((e=>e.name[1]===t))){const e=r.find((e=>"filters"===e.name[0]));e&&n(e.name[1])}return null}},h=(e,t,n,r,a)=>async()=>{const o=t.filter((e=>!n[e])).map((t=>{var n,r,o,i;const l=null==(n=a.filters)?void 0:n[t];if(!l)return e[t];if(l.type===c.BE.DIVIDER)return{id:t,type:c.BE.DIVIDER,scope:{rootPath:[d._4],excluded:[]},title:l.title,description:l.description};const u={};return l.dataset&&(u.datasetId=l.dataset.value),l.dataset&&l.column&&(u.column={name:l.column}),{id:t,adhoc_filters:l.adhoc_filters,time_range:l.time_range,controlValues:null!=(r=l.controlValues)?r:{},granularity_sqla:l.granularity_sqla,requiredFirst:Object.values(null!=(o=l.requiredFirst)?o:{}).find((e=>e)),name:l.name,filterType:l.filterType,targets:[u],defaultDataMask:null!=(i=l.defaultDataMask)?i:(0,s.H)(),cascadeParentIds:l.dependencies||[],scope:l.scope,sortMetric:l.sortMetric,type:l.type,description:(l.description||"").trim()}}));await r(o)},m=(e,t,n)=>r=>{const a=window.setTimeout((()=>{(n=>{e((e=>({...e,[n]:{isPending:!1}}))),t((e=>e.filter((e=>e!==n))))})(r)}),5e3);e((e=>({...e,[r]:{isPending:!0,timerId:a}}))),n(!1)},g="NATIVE_FILTER-",f="NATIVE_FILTER_DIVIDER-",v=e=>`${e===c.BE.NATIVE_FILTER?g:f}${i().generate()}`,_=e=>e.map((e=>e.id))},1510:(e,t,n)=>{"use strict";n.d(t,{Rz:()=>b,X3:()=>f,on:()=>m,vk:()=>g,zi:()=>h});var r=n(78580),a=n.n(r),o=n(5364),i=n(16355),s=n(93185),l=n(70400),c=n(81255),d=n(80621),u=n(20292);const p=()=>{var e,t;const n=(0,u.Z)();return(null==n||null==(e=n.common)||null==(t=e.conf)?void 0:t.NATIVE_FILTER_DEFAULT_ROW_LIMIT)||1e3},h=e=>{var t;let{datasetId:n,dependencies:r={},groupby:a,defaultDataMask:o,controlValues:i,filterType:s,sortMetric:c,adhoc_filters:d,time_range:u,granularity_sqla:h,type:m,dashboardId:g,id:f}=e;const v={};return n&&(v.datasource=`${n}__table`),a&&(v.groupby=[a]),c&&(v.sortMetric=c),{...i,...v,adhoc_filters:null!=d?d:[],extra_filters:[],extra_form_data:r,granularity_sqla:h,metrics:["count"],row_limit:p(),showSearch:!0,defaultValue:null==o||null==(t=o.filterState)?void 0:t.value,time_range:u,url_params:(0,l.Z)("regular"),inView:!0,viz_type:s,type:m,dashboardId:g,native_filter_id:f}};function m(e,t){void 0===e&&(e={}),void 0===t&&(t={});const n={};return o.Ci.forEach((r=>{const a=[...e[r]||[],...t[r]||[]];a.length&&(n[r]=a)})),o.Ay.forEach((r=>{const a=e[r];void 0!==a&&(n[r]=a);const o=t[r];void 0!==o&&(n[r]=o)})),n}function g(e,t){let n={};return t.forEach((t=>{var r,a;n=m(n,null!=(r=null==(a=e[t])?void 0:a.extraFormData)?r:{})})),n}function f(e){return!a()(e).call(e,i.cg.NATIVE_FILTER)||(0,s.cr)(s.TT.DASHBOARD_FILTERS_EXPERIMENTAL)&&(0,s.cr)(s.TT.DASHBOARD_CROSS_FILTERS)&&a()(e).call(e,i.cg.INTERACTIVE_CHART)}const v=(e,t)=>{var n;return(null==e||null==(n=e[t])?void 0:n.type)===c.gn},_=(e,t,n,r,o,i)=>{var s,l,d,u,p,h;i.has(n)||(i.add(n),(null==e||null==(s=e[n])?void 0:s.type)===c.dW&&a()(t).call(t,null==(l=e[n])||null==(d=l.meta)?void 0:d.chartId)&&r.forEach(o.add,o),0===(null==e||null==(u=e[n])||null==(p=u.children)?void 0:p.length)||v(e,n)&&o.has(n)||null==(h=e[n])||h.children.forEach((n=>_(e,t,n,v(e,n)?[...r,n]:r,o,i))))},b=(e,t)=>{const n=e[d._4].children[0],r=n!==d.PV,a=new Set,o=new Set;var i,s;return r?null==(i=e[n])||null==(s=i.children)||s.forEach((n=>_(e,t,n,[n],a,o))):Object.values(e).filter((e=>(null==e?void 0:e.type)===c.gn)).forEach((n=>_(e,t,n.id,[n.id],a,o))),a}},9531:(e,t,n)=>{"use strict";n.d(t,{I6:()=>l,Ky:()=>i,UN:()=>d,XX:()=>p,a7:()=>u,aF:()=>c,eV:()=>m,gz:()=>s,tw:()=>o,yT:()=>h});var r=n(46078),a=n(80621);const o={id:0,type:r.i9.Table,uid:"_placeholder_",datasource_name:"",table_name:"",columns:[],column_types:[],metrics:[],column_formats:{},currency_formats:{},verbose_map:{},main_dttm_col:"",description:""},i=53,s=32,l=260,c=550,d=80,u=46,p=374,h=["css","json_metadata.filter_scopes"],m={rootPath:[a._4],excluded:[]}},39759:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i,a:()=>o});var r=n(52794),a=n(4305);function o(e){let{filterSetsConfig:t,filterConfig:n,state:r}=e;const a={},o={};var i;if(n?(n.forEach((e=>{const{id:t}=e;o[t]=e})),a.filters=o):a.filters=null!=(i=null==r?void 0:r.filters)?i:{},t){const e={};t.forEach((t=>{const{id:n}=t;e[n]=t})),a.filterSets=e}else{var s;a.filterSets=null!=(s=null==r?void 0:r.filterSets)?s:{}}return a.focusedFilterId=void 0,a}function i(e,t){switch(void 0===e&&(e={filters:{},filterSets:{}}),t.type){case a.$:return{filters:t.data.nativeFilters.filters,filterSets:t.data.nativeFilters.filterSets};case r.qe:case r.kN:return o({filterConfig:t.filterConfig,state:e});case r.Zp:return o({filterSetsConfig:t.filterSets,state:e});case r.X8:return{...e,focusedFilterId:t.id};case r.T6:return{...e,focusedFilterId:void 0};case r.jE:return{...e,hoveredFilterId:t.id};case r.TT:return{...e,hoveredFilterId:void 0};case r.rR:return{...e,filters:{...e.filters,[t.id]:{...e.filters[t.id],cascadeParentIds:t.parentIds}}};default:return e}}},52004:(e,t,n)=>{"use strict";var r;n.d(t,{$:()=>a,Bp:()=>r,_6:()=>o}),function(e){e.VERTICAL="VERTICAL",e.HORIZONTAL="HORIZONTAL"}(r||(r={}));const a="global",o=e=>e===a},81255:(e,t,n)=>{"use strict";n.d(t,{BA:()=>a,BG:()=>i,F0:()=>u,Nc:()=>c,Os:()=>p,U0:()=>s,Vl:()=>o,ZP:()=>f,dW:()=>r,gn:()=>m,hE:()=>l,t:()=>g,xh:()=>d,yR:()=>h});const r="CHART",a="COLUMN",o="HEADER",i="GRID",s="ROOT",l="DIVIDER",c="HEADER",d="MARKDOWN",u="NEW_COMPONENT_SOURCE",p="ROW",h="TABS",m="TAB",g="DYNAMIC",f={CHART_TYPE:r,COLUMN_TYPE:a,DASHBOARD_HEADER_TYPE:o,DASHBOARD_GRID_TYPE:i,DASHBOARD_ROOT_TYPE:s,DIVIDER_TYPE:l,HEADER_TYPE:c,MARKDOWN_TYPE:d,NEW_COMPONENT_SOURCE_TYPE:u,ROW_TYPE:p,TABS_TYPE:h,TAB_TYPE:m,DYNAMIC_TYPE:g}},80621:(e,t,n)=>{"use strict";n.d(t,{AA:()=>T,Bu:()=>L,C3:()=>p,D0:()=>s,ES:()=>d,Ep:()=>N,HE:()=>w,Jd:()=>l,M2:()=>a,Mu:()=>v,NN:()=>g,NT:()=>D,Nb:()=>c,OE:()=>Z,PV:()=>r,Q9:()=>R,TN:()=>I,Xk:()=>m,Z1:()=>u,Zn:()=>i,_4:()=>o,_B:()=>k,b5:()=>x,cd:()=>_,cx:()=>E,cz:()=>y,dU:()=>M,es:()=>b,fw:()=>S,gR:()=>f,kS:()=>O,pQ:()=>A,u_:()=>C,vD:()=>h});const r="GRID_ID",a="HEADER_ID",o="ROOT_ID",i="DASHBOARD_VERSION_KEY",s="NEW_COMPONENTS_SOURCE_ID",l="NEW_CHART_ID",c="NEW_COLUMN_ID",d="NEW_DIVIDER_ID",u="NEW_HEADER_ID",p="NEW_MARKDOWN_ID",h="NEW_ROW_ID",m="NEW_TAB_ID",g="NEW_TABS_ID",f="NEW_DYNAMIC_COMPONENT",v=0,_=8,b=2*_,y=12,E=1,T=5,S=4,C="SMALL_HEADER",Z="MEDIUM_HEADER",A="LARGE_HEADER",x="BACKGROUND_WHITE",w="BACKGROUND_TRANSPARENT",R=50,I="overwrite",D="overwriteConfirmed",O="newDashboard",L=65535,N=["LABEL"],M="ALL_FILTERS_ROOT";var k;!function(e){e[e.NONE=0]="NONE",e[e.HIDE_NAV=1]="HIDE_NAV",e[e.HIDE_NAV_AND_TITLE=2]="HIDE_NAV_AND_TITLE",e[e.REPORT=3]="REPORT"}(k||(k={}))},52838:(e,t,n)=>{"use strict";n.d(t,{U:()=>m,g:()=>g});var r=n(50361),a=n.n(r),o=n(78580),i=n.n(o),s=n(93185),l=n(37731),c=n(11064),d=n(16355),u=n(32873),p=n(52004),h=n(9531);const m=e=>(0,s.cr)(s.TT.DASHBOARD_CROSS_FILTERS)&&(void 0===e||e),g=(e,t,n)=>{var r;if(!(0,s.cr)(s.TT.DASHBOARD_CROSS_FILTERS))return;const o=null!=(r=t.global_chart_configuration)&&r.scope?{scope:t.global_chart_configuration.scope,chartsInScope:(0,u.Q)(t.global_chart_configuration.scope,Object.values(n).map((e=>e.id)),e)}:{scope:h.eV,chartsInScope:Object.values(n).map((e=>e.id))},m={};return Object.values(e).forEach((r=>{var s,h,g,f,v,_;const b=null==(s=r.meta)?void 0:s.chartId;if(!(0,l.Z)(b))return;const y=null!=(h=null==(g=null!=(f=(0,c.Z)().get(null==(v=n[b])||null==(_=v.form_data)?void 0:_.viz_type))?f:{})?void 0:g.behaviors)?h:[];var E;i()(y).call(y,d.cg.INTERACTIVE_CHART)&&(null!=(E=t.chart_configuration)&&E[b]&&(m[b]=a()(t.chart_configuration[b])),m[b]||(m[b]={id:b,crossFilters:{scope:p.$}}),m[b].crossFilters.chartsInScope=(0,p._6)(m[b].crossFilters.scope)?o.chartsInScope.filter((e=>e!==Number(b))):(0,u.Q)(m[b].crossFilters.scope,Object.values(n).map((e=>e.id)),e))})),{chartConfiguration:m,globalChartConfiguration:o}}},70400:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(17563);const a=new Set(["standalone","edit"]);function o(e){const t=r.parse(window.location.search);return Object.entries(t).reduce(((t,n)=>{let[r,o]=n;return"regular"===e&&a.has(r)||"reserved"===e&&!a.has(r)?t:Array.isArray(o)?{...t,[r]:o[0]}:{...t,[r]:o}}),{})}},95173:(e,t,n)=>{"use strict";n.d(t,{Z:()=>i});var r=n(78580),a=n.n(r);const o={};function i(e){let t=null;if(e){const{childId:r,layout:i={}}=e;if(o[r]){var n;const e=(null==i?void 0:i[o[r]])||{};if(null!=e&&e.children&&null!=e&&null!=(n=e.children)&&null!=a()(n)&&a()(n).call(n,r))return e.id}t=function(e){let t=null;if(e){const{childId:r,layout:o={}}=e;if(o){const e=Object.keys(o);for(let i=0;i<=e.length-1;i+=1){var n;const s=e[i],l=o[s]||{};if(s!==r&&null!=l&&null!=(n=l.children)&&null!=a()(n)&&a()(n).call(n,r)){t=s;break}}}}return t}({childId:r,layout:i}),o[r]=t}return t}},32873:(e,t,n)=>{"use strict";n.d(t,{Q:()=>i});var r=n(78580),a=n.n(r),o=n(81255);function i(e,t,n){const r=Object.values(n);return t.filter((t=>{var n,i,s;return!a()(n=e.excluded).call(n,t)&&(null==(i=r.find((e=>{var n;return(null==e?void 0:e.type)===o.dW&&(null==(n=e.meta)?void 0:n.chartId)===t})))||null==(s=i.parents)?void 0:s.some((t=>{var n;return a()(n=e.rootPath).call(n,t)})))}))}},20194:(e,t,n)=>{"use strict";function r(e){let{chartId:t,column:n}=e;return`${t}_${n}`}n.d(t,{_:()=>o,w:()=>r});const a=/^([0-9]+)_(.*)$/;function o(e){const t=a.exec(e);if(!t)throw new Error("Cannot parse invalid filter key");return{chartId:parseInt(t[1],10),column:t[2]}}},56967:(e,t,n)=>{"use strict";function r(){return(window.location.hash||"#").substring(1)}n.d(t,{Z:()=>r})},22318:(e,t,n)=>{"use strict";n.d(t,{Ms:()=>d,Xg:()=>p,i5:()=>l,N$:()=>u});var r=n(93185),a=n(68630),o=n.n(a);function i(e){return function(e){return o()(e)&&"username"in e}(e)&&"permissions"in e&&"roles"in e}var s=n(12617);const l=e=>i(e)&&Object.keys(e.roles||{}).some((e=>"admin"===e.toLowerCase())),c=(e,t)=>i(t)&&e.owners.some((e=>e.id===t.userId)),d=(e,t)=>i(t)&&(l(t)||c(e,t))&&(0,s.R)("can_write","Dashboard",null==t?void 0:t.roles);function u(e,t,n){return l(e)||i(e)&&Object.values(e.roles||{}).flat().some((e=>e[0]===n&&e[1]===t))}const p=(e,t)=>i(t)&&(0,s.R)("can_write","Dashboard",null==t?void 0:t.roles)&&(!(0,r.cr)(r.TT.DASHBOARD_RBAC)||l(t)||c(e,t))},74599:(e,t,n)=>{"use strict";n.d(t,{A:()=>i,Ch:()=>o,Ft:()=>c,eG:()=>d,mO:()=>s,sh:()=>p,u3:()=>l,ze:()=>u});var r=n(93185),a=n(8868);const o="CLEAR_DATA_MASK_STATE",i="UPDATE_DATA_MASK",s="SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE",l="SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL";function c(e,t){return{type:s,filterConfig:e,filters:t}}function d(e,t){const n=(0,r.cr)(r.TT.DASHBOARD_NATIVE_FILTERS)||(0,r.cr)(r.TT.DASHBOARD_CROSS_FILTERS);return{type:i,filterId:e,dataMask:n?t:{}}}function u(e){return d(e,(0,a.H)(e))}function p(){return{type:o}}},8868:(e,t,n)=>{"use strict";n.d(t,{H:()=>c,Z:()=>u});var r=n(12902),a=n(93185),o=n(92242),i=n(4305),s=n(74599),l=n(99543);function c(e,t){void 0===t&&(t={});let n={};return e&&(n={id:e}),{...n,extraFormData:{},filterState:{},ownState:{},...t}}function d(e,t,n,r,a){e.forEach((e=>{var n;const o=r||{};t[e.id]={...c(e.id),...e.defaultDataMask,...o[e.id]},a&&!(0,l.JB)(e.defaultDataMask,null==(n=a[e.id])?void 0:n.defaultDataMask,{ignoreUndefined:!0})&&(t[e.id]={...t[e.id],...e.defaultDataMask})})),Object.values(n).forEach((e=>{String(null==e?void 0:e.id).startsWith(o.rW)||(t[null==e?void 0:e.id]=e)}))}const u=(0,r.ZP)(((e,t)=>{var n,r,o,l;const u={};switch(t.type){case s.Ch:return u;case s.A:return e[t.filterId]={...c(t.filterId),...e[t.filterId],...t.dataMask},e;case i.$:var p,h;return(0,a.cr)(a.TT.DASHBOARD_CROSS_FILTERS)&&Object.keys(null==(p=t.data.dashboardInfo)||null==(h=p.metadata)?void 0:h.chart_configuration).forEach((e=>{u[e]={...c(e)}})),d(null!=(n=null==(r=t.data.dashboardInfo)||null==(o=r.metadata)?void 0:o.native_filter_configuration)?n:[],u,e,t.data.dataMask),u;case s.mO:return d(null!=(l=t.filterConfig)?l:[],u,e,t.filters),u;default:return e}}),{})},99068:(e,t,n)=>{"use strict";n.d(t,{AG:()=>s,yn:()=>d});var r=n(31069),a=n(72570),o=n(98286),i=n(651);const s="SET_DATASOURCE";function l(e){return{type:s,datasource:e}}function c(e){return function(t,n){const{explore:{datasource:r}}=n();t(l(e)),t((0,i.updateFormDataByDatasource)(r,e))}}const d={setDatasource:l,changeDatasource:c,saveDataset:function(e){let{schema:t,sql:n,database:i,templateParams:s,datasourceName:l,columns:d}=e;return async function(e){try{const{json:{data:a}}=await r.Z.post({endpoint:"/api/v1/dataset/",headers:{"Content-Type":"application/json"},body:JSON.stringify({database:null==i?void 0:i.id,table_name:l,schema:t,sql:n,template_params:s,columns:d})});return e(c(a)),a}catch(t){throw(0,o.O$)(t).then((t=>{e((0,a.Gb)(t.error))})),t}}}}},651:(e,t,n)=>{"use strict";n.r(t),n.d(t,{CREATE_NEW_SLICE:()=>L,FETCH_DATASOURCES_STARTED:()=>h,FETCH_DATASOURCES_SUCCEEDED:()=>g,FETCH_DATASOURCE_SUCCEEDED:()=>u,FETCH_FAVE_STAR:()=>b,POST_DATASOURCE_STARTED:()=>d,SAVE_FAVE_STAR:()=>E,SET_EXPLORE_CONTROLS:()=>Z,SET_FIELD_VALUE:()=>S,SET_FORCE_QUERY:()=>P,SET_FORM_DATA:()=>x,SET_SAVE_ACTION:()=>D,SLICE_UPDATED:()=>M,TOGGLE_FAVE_STAR:()=>v,UPDATE_CHART_TITLE:()=>R,UPDATE_FORM_DATA_BY_DATASOURCE:()=>l,createNewSlice:()=>N,exploreActions:()=>U,fetchDatasourceSucceeded:()=>p,fetchDatasourcesStarted:()=>m,fetchDatasourcesSucceeded:()=>f,fetchFaveStar:()=>y,saveFaveStar:()=>T,setControlValue:()=>C,setExploreControls:()=>A,setForceQuery:()=>F,setFormData:()=>w,setSaveAction:()=>O,sliceUpdated:()=>k,toggleFaveStar:()=>_,updateChartTitle:()=>I,updateFormDataByDatasource:()=>c});var r=n(15926),a=n.n(r),o=n(31069),i=n(55867),s=n(72570);const l="UPDATE_FORM_DATA_BY_DATASOURCE";function c(e,t){return{type:l,prevDatasource:e,newDatasource:t}}const d="POST_DATASOURCE_STARTED",u="FETCH_DATASOURCE_SUCCEEDED";function p(){return{type:u}}const h="FETCH_DATASOURCES_STARTED";function m(){return{type:h}}const g="FETCH_DATASOURCES_SUCCEEDED";function f(){return{type:g}}const v="TOGGLE_FAVE_STAR";function _(e){return{type:v,isStarred:e}}const b="FETCH_FAVE_STAR";function y(e){return function(t){o.Z.get({endpoint:`/api/v1/chart/favorite_status/?q=${a().encode([e])}`}).then((e=>{var n,r;let{json:a}=e;t(_(!(null==a||null==(n=a.result)||null==(r=n[0])||!r.value)))}))}}const E="SAVE_FAVE_STAR";function T(e,t){return function(n){const r=`/api/v1/chart/${e}/favorites/`;(t?o.Z.delete({endpoint:r}):o.Z.post({endpoint:r})).then((()=>n(_(!t)))).catch((()=>{n((0,s.Gb)((0,i.t)("An error occurred while starring this chart")))}))}}const S="SET_FIELD_VALUE";function C(e,t,n){return{type:S,controlName:e,value:t,validationErrors:n}}const Z="UPDATE_EXPLORE_CONTROLS";function A(e){return{type:Z,formData:e}}const x="UPDATE_FORM_DATA";function w(e){return{type:x,formData:e}}const R="UPDATE_CHART_TITLE";function I(e){return{type:R,sliceName:e}}const D="SET_SAVE_ACTION";function O(e){return{type:D,saveAction:e}}const L="CREATE_NEW_SLICE";function N(e,t,n,r,a){return{type:L,can_add:e,can_download:t,can_overwrite:n,slice:r,form_data:a}}const M="SLICE_UPDATED";function k(e){return{type:M,slice:e}}const P="SET_FORCE_QUERY";function F(e){return{type:P,force:e}}const U={...s.s2,fetchDatasourcesStarted:m,fetchDatasourcesSucceeded:f,toggleFaveStar:_,fetchFaveStar:y,saveFaveStar:T,setControlValue:C,setExploreControls:A,updateChartTitle:I,createNewSlice:N,sliceUpdated:k,setForceQuery:F}},76445:(e,t,n)=>{"use strict";n.d(t,{_:()=>b,u:()=>y});var r,a=n(78580),o=n.n(a),i=n(12515),s=n(35854),l=n(5364),c=n(11146),d=n(10581),u=n(55786),p=n(81545),h=n(45511),m=n(10331),g=n(42313),f=n(23525),v=n(27600),_=n(12617);!function(e){e.CATEGORICAL="CATEGORICAL",e.SEQUENTIAL="SEQUENTIAL"}(r||(r={}));const b="HYDRATE_EXPLORE",y=e=>{let{form_data:t,slice:n,dataset:a,metadata:y,saveAction:E=null}=e;return(e,T)=>{var S,C,Z;const{user:A,datasources:x,charts:w,sliceEntities:R,common:I,explore:D}=T(),O=(0,f.eY)(v.KD.sliceId),L=(0,f.eY)(v.KD.dashboardId),N=O?null==R||null==(S=R.slices)?void 0:S[O]:null,M=null!=n?n:N,k=null!=t?t:null==M?void 0:M.form_data;if(!k.viz_type){const e=(null==I?void 0:I.conf.DEFAULT_VIZ_TYPE)||"table";k.viz_type=(0,f.eY)(v.KD.vizType)||e}var P;k.time_range||(k.time_range=(null==I||null==(P=I.conf)?void 0:P.DEFAULT_TIME_FILTER)||l.vM),c.O6&&k.include_time&&k.granularity_sqla&&(null==(C=k.groupby)||!C.some((e=>(0,d.Z)(e)===(0,d.Z)(k.granularity_sqla))))&&(k.groupby=[k.granularity_sqla,...(0,u.Z)(k.groupby)],k.granularity_sqla=void 0),L&&(k.dashboardId=L);const F=a,U={form_data:k,slice:M,datasource:F},$=(0,s.R3)(U,k),q=$.color_scheme&&"color_scheme",V=$.linear_color_scheme&&"linear_color_scheme",j=e=>{const t="CATEGORICAL"===e?(0,p.Z)():(0,h.Z)(),n="CATEGORICAL"===e?q:V,r=t.defaultKey,a="CATEGORICAL"===e?"supersetColors":"superset_seq_1",o=k[n],i=!!t.get(o,!0);o&&!i&&($[n].value=r||a)};q&&j(r.CATEGORICAL),V&&j(r.SEQUENTIAL);const H={can_add:(0,_.R)("can_write","Chart",null==A?void 0:A.roles),can_download:(0,_.R)("can_csv","Superset",null==A?void 0:A.roles),can_overwrite:o()(Z=(0,u.Z)(null==n?void 0:n.owners)).call(Z,null==A?void 0:A.userId),isDatasourceMetaLoading:!1,isStarred:!1,triggerRender:!1,datasource:F,controls:$,form_data:k,slice:M,controlsTransferred:D.controlsTransferred,standalone:(0,f.eY)(v.KD.standalone),force:(0,f.eY)(v.KD.force),metadata:y,saveAction:E,common:I};Object.entries(H.controls).forEach((e=>{let[t,n]=e;H.controls[t]=(0,m.RO)(n,H)}));const B=M?(0,m.Hu)($):null,z=(0,i.Jp)(U),G={id:z,chartAlert:null,chartStatus:null,chartStackTrace:null,chartUpdateEndTime:null,chartUpdateStartTime:0,latestQueryFormData:(0,m.Hu)(H.controls),sliceFormData:B,queryController:null,queriesResponse:null,triggerQuery:!1,lastRendered:0};return e({type:b,data:{charts:{...w,[z]:G},datasources:{...x,[(0,g.T)(F)]:F},saveModal:{dashboards:[],saveModalAlert:null,isVisible:!1},explore:H}})}}},71839:(e,t,n)=>{"use strict";n.d(t,{Z:()=>zr});var r=n(5872),a=n.n(r),o=n(18446),i=n.n(o),s=n(67294),l=n(51995),c=n(85716),d=n(57902),u=n(356),p=n(78580),h=n.n(p),m=n(45697),g=n.n(m),f=n(4715),v=n(28216),_=n(55867),b=n(68135),y=n(9882),E=n(67913),T=n(12515),S=n(52256),C=n(11965);function Z(e){const{selectable:t,children:n,...r}=e,o=(0,l.Fg)(),i={"&.ant-list-item":{padding:`${o.gridUnit+2}px ${3*o.gridUnit}px`,":first-of-type":{borderTopLeftRadius:o.gridUnit,borderTopRightRadius:o.gridUnit},":last-of-type":{borderBottomLeftRadius:o.gridUnit,borderBottomRightRadius:o.gridUnit}}};return t&&(i["&:hover"]={cursor:"pointer",backgroundColor:o.colors.grayscale.light4}),(0,C.tZ)(f.aV.Item,a()({},r,{css:i}),n)}var A=n(27845);const x=(0,E.Z)((()=>Promise.all([n.e(2087),n.e(5094)]).then(n.bind(n,25094))),(()=>(0,C.tZ)("div",{style:{width:450,height:368}}))),w={colorScheme:g().string.isRequired,annotationError:g().object,annotationQuery:g().object,vizType:g().string,validationErrors:g().array,name:g().string.isRequired,actions:g().object,value:g().arrayOf(g().object),onChange:g().func,refreshAnnotationData:g().func};class R extends s.PureComponent{constructor(e){super(e),this.state={popoverVisible:{},addedAnnotationIndex:null},this.addAnnotationLayer=this.addAnnotationLayer.bind(this),this.removeAnnotationLayer=this.removeAnnotationLayer.bind(this),this.handleVisibleChange=this.handleVisibleChange.bind(this)}componentDidMount(){x.preload()}UNSAFE_componentWillReceiveProps(e){const{name:t,annotationError:n,validationErrors:r,value:a}=e;Object.keys(n).length&&!r.length&&this.props.actions.setControlValue(t,a,Object.keys(n)),!Object.keys(n).length&&r.length&&this.props.actions.setControlValue(t,a,[])}addAnnotationLayer(e,t){let n=this.props.value;h()(n).call(n,e)?n=n.map((n=>n===e?t:n)):(n=[...n,t],this.setState({addedAnnotationIndex:n.length-1})),this.props.refreshAnnotationData({annotation:t,force:!0}),this.props.onChange(n)}handleVisibleChange(e,t){this.setState((n=>({popoverVisible:{...n.popoverVisible,[t]:e}})))}removeAnnotationLayer(e){const t=this.props.value.filter((t=>t!==e)),n=(0,A.j)();n&&n.style.setProperty("overflow-y","auto","important"),this.props.onChange(t)}renderPopover(e,t,n){const r=(null==t?void 0:t.name)||"_new";return(0,C.tZ)("div",{id:`annotation-pop-${r}`},(0,C.tZ)(x,a()({},t,{error:n,colorScheme:this.props.colorScheme,vizType:this.props.vizType,addAnnotationLayer:e=>this.addAnnotationLayer(t,e),removeAnnotationLayer:()=>this.removeAnnotationLayer(t),close:()=>{this.handleVisibleChange(!1,e),this.setState({addedAnnotationIndex:null})}})))}renderInfo(e){const{annotationError:t,annotationQuery:n,theme:r}=this.props;return n[e.name]?(0,C.tZ)("i",{className:"fa fa-refresh",style:{color:r.colors.primary.base},"aria-hidden":!0}):t[e.name]?(0,C.tZ)(y.V,{label:"validation-errors",bsStyle:"danger",tooltip:t[e.name]}):e.show?"":(0,C.tZ)("span",{style:{color:r.colors.error.base}}," Hidden ")}render(){const{addedAnnotationIndex:e}=this.state,t=this.props.value[e],n=this.props.value.map(((e,t)=>(0,C.tZ)(A.Z,{key:t,trigger:"click",title:(0,_.t)("Edit annotation layer"),css:e=>({"&:hover":{cursor:"pointer",backgroundColor:e.colors.grayscale.light4}}),content:this.renderPopover(t,e,this.props.annotationError[e.name]),visible:this.state.popoverVisible[t],onVisibleChange:e=>this.handleVisibleChange(e,t)},(0,C.tZ)(Z,{selectable:!0},(0,C.tZ)("span",null,e.name),(0,C.tZ)("span",{style:{float:"right"}},this.renderInfo(e))))));return(0,C.tZ)("div",null,(0,C.tZ)(f.aV,{bordered:!0,css:e=>({borderRadius:e.gridUnit})},n,(0,C.tZ)(A.Z,{trigger:"click",content:this.renderPopover("add",t),title:(0,_.t)("Add annotation layer"),visible:this.state.popoverVisible.add,destroyTooltipOnHide:!0,onVisibleChange:e=>this.handleVisibleChange(e,"add")},(0,C.tZ)(Z,{selectable:!0},(0,C.tZ)("i",{className:"fa fa-plus"})," "," ",(0,_.t)("Add annotation layer")))))}}R.propTypes=w,R.defaultProps={vizType:"",value:[],annotationError:{},annotationQuery:{},onChange:()=>{}};const I=(0,b.b)(R),D=(0,v.$j)((function(e){var t,n;let{charts:r,explore:a}=e;const o=r[(0,T.Jp)(a)]||r[0]||{};return{colorScheme:null==(t=a.controls)||null==(n=t.color_scheme)?void 0:n.value,annotationError:o.annotationError,annotationQuery:o.annotationQuery,vizType:a.controls.viz_type.value}}),(function(e){return{refreshAnnotationData:t=>e((0,S.runAnnotationQuery)(t))}}))(I);var O=n(23279),L=n.n(O),N=n(9875),M=n(82342);const k=l.iK.div`
  display: flex;
`,P=(0,l.iK)(N.Rn)`
  flex: 1;
  margin-right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,F=(0,l.iK)(N.Rn)`
  flex: 1;
  margin-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,U=e=>null===e||Number.isNaN(Number(e))?null:Number(e);function $(e){let{onChange:t=(()=>{}),value:n=[null,null],...r}=e;const[a,o]=(0,s.useState)([U(n[0]),U(n[1])]),i=n[0],l=n[1],c=(0,s.useRef)(L()(t,300)).current,d=e=>{o(e),c([void 0===e[0]?null:e[0],void 0===e[1]?null:e[1]])};return(0,s.useEffect)((()=>{o([U(i),U(l)])}),[i,l]),(0,C.tZ)("div",null,(0,C.tZ)(M.Z,r),(0,C.tZ)(k,null,(0,C.tZ)(P,{placeholder:(0,_.t)("Min"),onChange:e=>{d([U(e),a[1]])},value:null===a[0]?void 0:a[0]}),(0,C.tZ)(F,{placeholder:(0,_.t)("Max"),onChange:e=>{d([a[0],U(e)])},value:null===a[1]?void 0:a[1]})))}var q=n(79069),V=n(14670),j=n.n(V),H=n(95742),B=n(70163),z=n(33334);const G={name:g().string.isRequired,label:g().string,description:g().string,placeholder:g().string,addTooltip:g().string,itemGenerator:g().func,keyAccessor:g().func,onChange:g().func,value:g().oneOfType([g().array]),isFloat:g().bool,isInt:g().bool,controlName:g().string.isRequired},Q={label:null,description:null,onChange:()=>{},placeholder:(0,_.t)("Empty collection"),itemGenerator:()=>({key:j().generate()}),keyAccessor:e=>e.key,value:[],addTooltip:(0,_.t)("Add an item")},Y=(0,H.W8)(Z),K=(0,H.JN)(f.aV),W=(0,H.W6)((()=>(0,C.tZ)("i",{role:"img","aria-label":"drag",className:"fa fa-bars text-primary",style:{cursor:"ns-resize"}})));var J={name:"11g6mpt",styles:"justify-content:flex-start"};class X extends s.Component{constructor(e){super(e),this.onAdd=this.onAdd.bind(this)}onChange(e,t){const n=[...this.props.value];n[e]={...this.props.value[e],...t},this.props.onChange(n)}onAdd(){this.props.onChange(this.props.value.concat([this.props.itemGenerator()]))}onSortEnd(e){let{oldIndex:t,newIndex:n}=e;this.props.onChange((0,H.Rp)(this.props.value,t,n))}removeItem(e){this.props.onChange(this.props.value.filter(((t,n)=>e!==n)))}renderList(){if(0===this.props.value.length)return(0,C.tZ)("div",{className:"text-muted"},this.props.placeholder);const e=Hr[this.props.controlName];return(0,C.tZ)(K,{useDragHandle:!0,lockAxis:"y",onSortEnd:this.onSortEnd.bind(this),bordered:!0,css:e=>({borderRadius:e.gridUnit})},this.props.value.map(((t,n)=>{const{label:r,...o}=this.props;return(0,C.tZ)(Y,{className:"clearfix",css:J,key:this.props.keyAccessor(t),index:n},(0,C.tZ)(W,null),(0,C.tZ)("div",{css:e=>({flex:1,marginLeft:2*e.gridUnit,marginRight:2*e.gridUnit})},(0,C.tZ)(e,a()({},o,t,{onChange:this.onChange.bind(this,n)}))),(0,C.tZ)(y.V,{icon:"times",label:"remove-item",tooltip:(0,_.t)("Remove item"),bsStyle:"primary",onClick:this.removeItem.bind(this,n)}))})))}render(){const{theme:e}=this.props;return(0,C.tZ)("div",{className:"CollectionControl"},(0,C.tZ)(z.gM,null,(0,C.tZ)(M.Z,this.props),(0,C.tZ)(z.IG,{onClick:this.onAdd},(0,C.tZ)(B.Z.PlusLarge,{iconSize:"s",iconColor:e.colors.grayscale.light5}))),this.renderList())}}X.propTypes=G,X.defaultProps=Q;const ee=(0,b.b)(X);var te=n(24198),ne=n(81545),re=n(99299);const ae={onChange:g().func,value:g().object},oe={position:"absolute",width:"50px",height:"20px",top:"0px",left:"0px",right:"0px",bottom:"0px"},ie=l.iK.div`
  ${e=>{let{theme:t}=e;return`\n      width: 50px;\n      height: 20px;\n      position: relative;\n      padding: ${t.gridUnit}px;\n      borderRadius: ${t.borderRadius}px;\n      display: inline-block;\n      cursor: pointer;\n    `}}
`,se={color:{...oe,borderRadius:"2px"},checkerboard:{...oe,background:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==") left center'}};class le extends s.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){this.props.onChange(e.rgb)}renderPopover(){const e=(0,ne.Z)().get().colors.filter(((e,t)=>t<7));return(0,C.tZ)("div",{id:"filter-popover",className:"color-popover"},(0,C.tZ)(te.xS,{color:this.props.value,onChange:this.onChange,presetColors:e}))}render(){const e=this.props.value||{r:0,g:0,b:0,a:0},t={...se.color,background:`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`};return(0,C.tZ)("div",null,(0,C.tZ)(M.Z,this.props),(0,C.tZ)(re.Z,{trigger:"click",placement:"right",content:this.renderPopover()},(0,C.tZ)(ie,null,(0,C.tZ)("div",{style:se.checkerboard}),(0,C.tZ)("div",{style:t}))))}}le.propTypes=ae,le.defaultProps={onChange:()=>{}};var ce=n(76787),de=n(47037),ue=n.n(de),pe=n(46078),he=n(31069),me=n(45211),ge=n(23525),fe=n(83862),ve=n(58593),_e=n(77775),be=n(35932),ye=n(91178),Ee=n(86057),Te=n(27600),Se=n(79217),Ce=n(22318),Ze=n(1304),Ae=n(13218),xe=n.n(Ae);const we=(0,_.t)("Close"),Re=(0,_.t)("Save as Dataset"),Ie=(0,_.t)("Open in SQL Lab"),De=e=>(0,C.tZ)("div",null,(0,C.tZ)(be.Z,{onClick:()=>{null==e||null==e.closeModal||e.closeModal(),null==e||null==e.changeDatasource||e.changeDatasource()}},Re),(0,C.tZ)(be.Z,{onClick:()=>(()=>{const{datasource:t}=e;if(xe()(t)){const{id:e,type:n,sql:r}=t;((e,t,n)=>{const r={datasourceKey:`${e}__${t}`,sql:n};he.Z.postForm("/superset/sqllab/",r)})(e,n,r)}})()},Ie),(0,C.tZ)(be.Z,{buttonStyle:"primary",onClick:()=>{null==e||null==e.closeModal||e.closeModal()}},we));var Oe=n(85626),Le=n(47710),Ne=n(9679);const Me={actions:g().object.isRequired,onChange:g().func,value:g().string,datasource:g().object.isRequired,form_data:g().object.isRequired,isEditable:g().bool,onDatasourceSave:g().func},ke=l.iK.div`
  .data-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
    padding: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
    padding-right: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }
  .error-alert {
    margin: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }
  .ant-dropdown-trigger {
    margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    box-shadow: none;
    &:active {
      box-shadow: none;
    }
  }
  .btn-group .open .dropdown-toggle {
    box-shadow: none;
    &.button-default {
      background: none;
    }
  }
  i.angle {
    color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  }
  svg.datasource-modal-trigger {
    color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
    cursor: pointer;
  }
  .title-select {
    flex: 1 1 100%;
    display: inline-block;
    background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light3}};
    padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}}px;
    text-align: center;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
  }
  .datasource-svg {
    margin-right: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    flex: none;
  }
  span[aria-label='dataset-physical'] {
    color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  }
  span[aria-label='more-vert'] {
    color: ${e=>{let{theme:t}=e;return t.colors.primary.base}};
  }
`,Pe="change_dataset",Fe="view_in_sql_lab",Ue="edit_dataset",$e="save_as_dataset",qe={[pe.i9.Query]:(0,C.tZ)(B.Z.ConsoleSqlOutlined,{className:"datasource-svg"}),[pe.i9.Table]:(0,C.tZ)(B.Z.DatasetPhysical,{className:"datasource-svg"})};class Ve extends s.PureComponent{constructor(e){super(e),this.onDatasourceSave=e=>{var t,n,r;this.props.actions.changeDatasource(e);const{temporalColumns:a,defaultTemporalColumn:o}=(0,me.X)(e),{columns:i}=e,s=null==(t=this.props.form_data)?void 0:t.granularity_sqla,l=null==(n=i.find((e=>{let{column_name:t}=e;return t===s})))?void 0:n.is_dttm,c=null==(r=i.find((e=>{let{column_name:t}=e;return t===o})))?void 0:r.is_dttm;if("table"===e.type&&!l){const e=c?o:null==a?void 0:a[0];this.props.actions.setControlValue("granularity_sqla",e||null)}this.props.onDatasourceSave&&this.props.onDatasourceSave(e)},this.toggleShowDatasource=()=>{this.setState((e=>{let{showDatasource:t}=e;return{showDatasource:!t}}))},this.toggleChangeDatasourceModal=()=>{this.setState((e=>{let{showChangeDatasourceModal:t}=e;return{showChangeDatasourceModal:!t}}))},this.toggleEditDatasourceModal=()=>{this.setState((e=>{let{showEditDatasourceModal:t}=e;return{showEditDatasourceModal:!t}}))},this.toggleSaveDatasetModal=()=>{this.setState((e=>{let{showSaveDatasetModal:t}=e;return{showSaveDatasetModal:!t}}))},this.handleMenuItemClick=e=>{let{key:t}=e;switch(t){case Pe:this.toggleChangeDatasourceModal();break;case Ue:this.toggleEditDatasourceModal();break;case Fe:{const{datasource:e}=this.props,t={datasourceKey:`${e.id}__${e.type}`,sql:e.sql};he.Z.postForm("/superset/sqllab/",{form_data:(0,Ne.o)(t)})}break;case $e:this.toggleSaveDatasetModal()}},this.state={showEditDatasourceModal:!1,showChangeDatasourceModal:!1,showSaveDatasetModal:!1}}render(){var e,t,n;const{showChangeDatasourceModal:r,showEditDatasourceModal:a,showSaveDatasetModal:o}=this.state,{datasource:i,onChange:l,theme:c}=this.props,d=!(null!=i&&i.id);let u=!1;if(d){const e=(0,ge.eY)(Te.KD.datasourceId),t=(0,ge.eY)(Te.KD.sliceId);e||t||(u=!0)}const{user:p}=this.props,m=(null==(e=i.owners)?void 0:h()(t=e.map((e=>e.id||e.value))).call(t,p.userId))||(0,Ce.i5)(p),g=(0,Ce.N$)(p,"SQL Lab","menu_access"),v=(0,_.t)("Edit dataset"),b=(0,C.tZ)(fe.v,{onClick:this.handleMenuItemClick},this.props.isEditable&&!d&&(0,C.tZ)(fe.v.Item,{key:Ue,disabled:!m},m?v:(0,C.tZ)(ve.u,{title:(0,_.t)("You must be a dataset owner in order to edit. Please reach out to a dataset owner to request modifications or edit access.")},v)),(0,C.tZ)(fe.v.Item,{key:Pe},(0,_.t)("Swap dataset")),!d&&g&&(0,C.tZ)(fe.v.Item,{key:Fe},(0,_.t)("View in SQL Lab"))),y=(0,C.tZ)(fe.v,{onClick:this.handleMenuItemClick},(0,C.tZ)(fe.v.Item,{key:"query_preview"},(0,C.tZ)(Ze.Z,{triggerNode:(0,C.tZ)("span",null,(0,_.t)("Query preview")),modalTitle:(0,_.t)("Query preview"),modalBody:(0,C.tZ)(Oe.Z,{sql:(null==i?void 0:i.sql)||(null==i?void 0:i.select_star)||""}),modalFooter:(0,C.tZ)(De,{changeDatasource:this.toggleSaveDatasetModal,datasource:i}),draggable:!1,resizable:!1,responsive:!0})),g&&(0,C.tZ)(fe.v.Item,{key:Fe},(0,_.t)("View in SQL Lab")),(0,C.tZ)(fe.v.Item,{key:$e},(0,_.t)("Save as dataset"))),{health_check_message:E}=i;let T;if(null!=i&&i.extra)if(ue()(i.extra))try{T=JSON.parse(i.extra)}catch{}else T=i.extra;const S=d?(0,_.t)("Missing dataset"):(e=>"query"===(null==e?void 0:e.type)?null==e?void 0:e.sql:(null==e?void 0:e.name)||"")(i),Z=S;return(0,C.tZ)(ke,{className:"DatasourceControl"},(0,C.tZ)("div",{className:"data-container"},qe[null==i?void 0:i.type],((e,t)=>(null==e?void 0:e.length)>25?(0,C.tZ)(ve.u,{title:t},(0,C.tZ)("span",{className:"title-select"},e)):(0,C.tZ)("span",{title:t,className:"title-select"},e))(S,Z),E&&(0,C.tZ)(ve.u,{title:E},(0,C.tZ)(B.Z.AlertSolid,{iconColor:c.colors.warning.base})),(null==(n=T)?void 0:n.warning_markdown)&&(0,C.tZ)(Ee.Z,{warningMarkdown:T.warning_markdown}),(0,C.tZ)(f.Gj,{overlay:i.type===pe.i9.Query?y:b,trigger:["click"]},(0,C.tZ)(B.Z.MoreVert,{className:"datasource-modal-trigger"}))),d&&u&&(0,C.tZ)("div",{className:"error-alert"},(0,C.tZ)(ye.Z,{level:"warning",title:(0,_.t)("Missing URL parameters"),source:"explore",subtitle:(0,C.tZ)(s.Fragment,null,(0,C.tZ)("p",null,(0,_.t)("The URL is missing the dataset_id or slice_id parameters.")))})),d&&!u&&(0,C.tZ)("div",{className:"error-alert"},(0,C.tZ)(ye.Z,{level:"warning",title:(0,_.t)("Missing dataset"),source:"explore",subtitle:(0,C.tZ)(s.Fragment,null,(0,C.tZ)("p",null,(0,_.t)("The dataset linked to this chart may have been deleted.")),(0,C.tZ)("p",null,(0,C.tZ)(be.Z,{buttonStyle:"primary",onClick:()=>this.handleMenuItemClick({key:Pe})},(0,_.t)("Swap dataset"))))})),a&&(0,C.tZ)(_e.W,{datasource:i,show:a,onDatasourceSave:this.onDatasourceSave,onHide:this.toggleEditDatasourceModal}),r&&(0,C.tZ)(_e.Q,{onDatasourceSave:this.onDatasourceSave,onHide:this.toggleChangeDatasourceModal,show:r,onChange:l}),o&&(0,C.tZ)(Le.W,{visible:o,onHide:this.toggleSaveDatasetModal,buttonTextOnSave:(0,_.t)("Save"),buttonTextOnOverwrite:(0,_.t)("Overwrite"),modalDescription:(0,_.t)("Save this query as a virtual dataset to continue exploring"),datasource:(0,Se.z)(i),openWindow:!1,formData:this.props.form_data}))}}Ve.propTypes=Me,Ve.defaultProps={onChange:()=>{},onDatasourceSave:null,value:null,isEditable:!0};const je=(0,b.b)(Ve);var He=n(1090),Be=n(37921),ze=n(43700),Ge=n(79684),Qe=n(55786),Ye=n(34087),Ke=n(42753),We=n(19113),Je=n(27130);const Xe=l.iK.span`
  display: inline-block;
  padding: 2px 0;
`,et=(0,l.iK)(N.II)`
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}};
  height: 26px;
  padding-left: ${e=>{let{theme:t}=e;return 2.5*t.gridUnit}}px;
`,tt=e=>{let{title:t,isEditDisabled:n,onChange:r}=e;const[a,o]=(0,s.useState)(!1),[i,l]=(0,s.useState)(!1),c=(0,_.t)("My metric"),d=(0,s.useCallback)((()=>o(!0)),[]),u=(0,s.useCallback)((()=>o(!1)),[]),p=(0,s.useCallback)((()=>l(!0)),[]),h=(0,s.useCallback)((()=>l(!1)),[]),m=(0,s.useCallback)((e=>{"Enter"===e.key&&(e.preventDefault(),h())}),[h]),g=(0,s.useCallback)((e=>{""===e.target.value&&r(e),h()}),[r,h]);return n?(0,C.tZ)("span",null,(null==t?void 0:t.label)||c):i?(0,C.tZ)(et,{type:"text",placeholder:null==t?void 0:t.label,value:null!=t&&t.hasCustomLabel?t.label:"",autoFocus:!0,onChange:r,onBlur:g,onKeyPress:m}):(0,C.tZ)(ve.u,{placement:"top",title:(0,_.t)("Click to edit label")},(0,C.tZ)("span",{className:"AdhocMetricEditPopoverTitle inline-editable",onMouseOver:d,onMouseOut:u,onClick:p,onBlur:h,role:"button",tabIndex:0},(0,C.tZ)(Xe,null,(null==t?void 0:t.label)||c),"",(0,C.tZ)("i",{className:"fa fa-pencil",style:{color:a?"black":"grey"}})))};var nt=n(63325),rt=n(37731),at=n(71262),ot=n(94301),it=n(49238),st=n(94670),lt=n(33313),ct=n(54076),dt=n(69856),ut=n(99963);const pt={onChange:g().func.isRequired,onClose:g().func.isRequired,onResize:g().func.isRequired,getCurrentTab:g().func,getCurrentLabel:g().func,adhocMetric:g().instanceOf(We.Z).isRequired,columns:g().arrayOf(Ye.Z),savedMetricsOptions:g().arrayOf(Je.Z),savedMetric:Je.Z,datasource:g().object,isNewMetric:g().bool,isLabelModified:g().bool},ht={columns:[],getCurrentTab:ct.EI,isNewMetric:!1},mt=(0,l.iK)(f.Ph)`
  .metric-option {
    & > svg {
      min-width: ${e=>{let{theme:t}=e;return 4*t.gridUnit+"px"}};
    }
    & > .option-label {
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
`,gt="SAVED";class ft extends s.PureComponent{constructor(e){super(e),this.defaultActiveTabKey=this.getDefaultTab(),this.onSave=this.onSave.bind(this),this.onResetStateAndClose=this.onResetStateAndClose.bind(this),this.onColumnChange=this.onColumnChange.bind(this),this.onAggregateChange=this.onAggregateChange.bind(this),this.onSavedMetricChange=this.onSavedMetricChange.bind(this),this.onSqlExpressionChange=this.onSqlExpressionChange.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTabChange=this.onTabChange.bind(this),this.handleAceEditorRef=this.handleAceEditorRef.bind(this),this.refreshAceEditor=this.refreshAceEditor.bind(this),this.getDefaultTab=this.getDefaultTab.bind(this),this.state={adhocMetric:this.props.adhocMetric,savedMetric:this.props.savedMetric,width:dt.kc,height:dt.H7},document.addEventListener("mouseup",this.onMouseUp)}componentDidMount(){this.props.getCurrentTab(this.defaultActiveTabKey)}componentDidUpdate(e,t){var n,r,a,o,i,s,l,c,d,u,p,h,m;(null==(n=t.adhocMetric)?void 0:n.sqlExpression)===(null==(r=this.state.adhocMetric)?void 0:r.sqlExpression)&&(null==(a=t.adhocMetric)?void 0:a.aggregate)===(null==(o=this.state.adhocMetric)?void 0:o.aggregate)&&(null==(i=t.adhocMetric)||null==(s=i.column)?void 0:s.column_name)===(null==(l=this.state.adhocMetric)||null==(c=l.column)?void 0:c.column_name)&&(null==(d=t.savedMetric)?void 0:d.metric_name)===(null==(u=this.state.savedMetric)?void 0:u.metric_name)||this.props.getCurrentLabel({savedMetricLabel:(null==(p=this.state.savedMetric)?void 0:p.verbose_name)||(null==(h=this.state.savedMetric)?void 0:h.metric_name),adhocMetricLabel:null==(m=this.state.adhocMetric)?void 0:m.getDefaultLabel()})}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}getDefaultTab(){const{adhocMetric:e,savedMetric:t,savedMetricsOptions:n,isNewMetric:r}=this.props;return(0,rt.Z)(e.column)||(0,rt.Z)(e.sqlExpression)?e.expressionType:(r||t.metric_name)&&Array.isArray(n)&&n.length>0?gt:e.expressionType}onSave(){var e;const{adhocMetric:t,savedMetric:n}=this.state,r=null!=n&&n.metric_name?n:t,a=null!=(e=this.props.savedMetric)&&e.metric_name?this.props.savedMetric:this.props.adhocMetric;this.props.onChange({...r},a),this.props.onClose()}onResetStateAndClose(){this.setState({adhocMetric:this.props.adhocMetric,savedMetric:this.props.savedMetric},this.props.onClose)}onColumnChange(e){const t=this.props.columns.find((t=>t.column_name===e));this.setState((e=>({adhocMetric:e.adhocMetric.duplicateWith({column:t,expressionType:We.v.SIMPLE}),savedMetric:void 0})))}onAggregateChange(e){this.setState((t=>({adhocMetric:t.adhocMetric.duplicateWith({aggregate:e,expressionType:We.v.SIMPLE}),savedMetric:void 0})))}onSavedMetricChange(e){const t=this.props.savedMetricsOptions.find((t=>t.metric_name===e));this.setState((e=>({savedMetric:t,adhocMetric:e.adhocMetric.duplicateWith({column:void 0,aggregate:void 0,sqlExpression:void 0,expressionType:We.v.SIMPLE})})))}onSqlExpressionChange(e){this.setState((t=>({adhocMetric:t.adhocMetric.duplicateWith({sqlExpression:e,expressionType:We.v.SQL}),savedMetric:void 0})))}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),dt.kc),height:Math.max(this.dragStartHeight+(e.clientY-this.dragStartY),dt.H7)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.refreshAceEditor(),this.props.getCurrentTab(e)}handleAceEditorRef(e){e&&(this.aceEditorRef=e)}refreshAceEditor(){setTimeout((()=>{this.aceEditorRef&&this.aceEditorRef.editor.resize()}),0)}renderColumnOption(e){const t={...e};return t.metric_name&&!t.verbose_name&&(t.verbose_name=t.metric_name),(0,C.tZ)(ut.l,{column:t,showType:!0})}renderMetricOption(e){return(0,C.tZ)(ut.B,{metric:e,showType:!0})}render(){var e;const{adhocMetric:t,savedMetric:n,columns:r,savedMetricsOptions:o,onChange:i,onClose:l,onResize:c,datasource:d,isNewMetric:u,isLabelModified:p,...h}=this.props,{adhocMetric:m,savedMetric:g}=this.state,v=lt.Z.concat(r.map((e=>({name:e.column_name,value:e.column_name,score:50,meta:"column"})))),b=m.column&&m.column.column_name||m.inferSqlExpressionColumn(),y={ariaLabel:(0,_.t)("Select column"),placeholder:(0,_.t)("%s column(s)",r.length),value:b,onChange:this.onColumnChange,allowClear:!0,autoFocus:!b},E={ariaLabel:(0,_.t)("Select aggregate options"),placeholder:(0,_.t)("%s aggregates(s)",dt.Ps.length),value:m.aggregate||m.inferSqlExpressionAggregate(),onChange:this.onAggregateChange,allowClear:!0,autoFocus:!!b},T={ariaLabel:(0,_.t)("Select saved metrics"),placeholder:(0,_.t)("%s saved metric(s)",null!=(e=null==o?void 0:o.length)?e:0),value:null==g?void 0:g.metric_name,onChange:this.onSavedMetricChange,allowClear:!0,autoFocus:!0},S=m.isValid()||(null==g?void 0:g.metric_name),Z=p||u||!m.equals(t)||!(void 0===(null==g?void 0:g.metric_name)&&void 0===(null==n?void 0:n.metric_name))&&(null==g?void 0:g.metric_name)!==(null==n?void 0:n.metric_name);let A={};if(null!=d&&d.extra)try{A=JSON.parse(d.extra)}catch{}return(0,C.tZ)(it.l0,a()({layout:"vertical",id:"metrics-edit-popover"},h),(0,C.tZ)(at.ZP,{id:"adhoc-metric-edit-tabs",defaultActiveKey:this.defaultActiveTabKey,className:"adhoc-metric-edit-tabs",style:{height:this.state.height,width:this.state.width},onChange:this.onTabChange,allowOverflow:!0},(0,C.tZ)(at.ZP.TabPane,{key:gt,tab:(0,_.t)("Saved")},(0,Qe.Z)(o).length>0?(0,C.tZ)(it.xJ,{label:(0,_.t)("Saved metric")},(0,C.tZ)(mt,a()({options:(0,Qe.Z)(o).map((e=>({value:e.metric_name,label:e.metric_name,customLabel:this.renderMetricOption(e),key:e.id})))},T))):d.type===pe.i9.Table?(0,C.tZ)(ot.Tc,{image:"empty.svg",title:(0,_.t)("No saved metrics found"),description:(0,_.t)('Add metrics to dataset in "Edit datasource" modal')}):(0,C.tZ)(ot.Tc,{image:"empty.svg",title:(0,_.t)("No saved metrics found"),description:(0,C.tZ)(s.Fragment,null,(0,C.tZ)("span",{tabIndex:0,role:"button",onClick:()=>{this.props.handleDatasetModal(!0),this.props.onClose()}},(0,_.t)("Create a dataset")),(0,_.t)(" to add metrics"))})),(0,C.tZ)(at.ZP.TabPane,{key:We.v.SIMPLE,tab:A.disallow_adhoc_metrics?(0,C.tZ)(ve.u,{title:(0,_.t)("Simple ad-hoc metrics are not enabled for this dataset")},(0,_.t)("Simple")):(0,_.t)("Simple"),disabled:A.disallow_adhoc_metrics},(0,C.tZ)(it.xJ,{label:(0,_.t)("column")},(0,C.tZ)(f.Ph,a()({options:r.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,key:e.id,customLabel:this.renderColumnOption(e)})))},y))),(0,C.tZ)(it.xJ,{label:(0,_.t)("aggregate")},(0,C.tZ)(f.Ph,a()({options:dt.Ps.map((e=>({value:e,label:e,key:e})))},E)))),(0,C.tZ)(at.ZP.TabPane,{key:We.v.SQL,tab:A.disallow_adhoc_metrics?(0,C.tZ)(ve.u,{title:(0,_.t)("Custom SQL ad-hoc metrics are not enabled for this dataset")},(0,_.t)("Custom SQL")):(0,_.t)("Custom SQL"),disabled:A.disallow_adhoc_metrics},(0,C.tZ)(st.iO,{showLoadingForImport:!0,ref:this.handleAceEditorRef,keywords:v,height:this.state.height-80+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:m.sqlExpression||m.translateToSql({transformCountDistinct:!0}),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0}))),(0,C.tZ)("div",null,(0,C.tZ)(be.Z,{buttonSize:"small",onClick:this.onResetStateAndClose,cta:!0},(0,_.t)("Close")),(0,C.tZ)(be.Z,{disabled:!S||!Z,buttonStyle:"primary",buttonSize:"small",onClick:this.onSave,cta:!0},(0,_.t)("Save")),(0,C.tZ)("i",{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"fa fa-expand edit-popover-resize text-muted"})))}}ft.propTypes=pt,ft.defaultProps=ht;class vt extends s.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.onLabelChange=this.onLabelChange.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.getCurrentTab=this.getCurrentTab.bind(this),this.getCurrentLabel=this.getCurrentLabel.bind(this),this.onChange=this.onChange.bind(this),this.handleDatasetModal=this.handleDatasetModal.bind(this),this.state={adhocMetric:e.adhocMetric,popoverVisible:!1,title:{label:e.adhocMetric.label,hasCustomLabel:e.adhocMetric.hasCustomLabel},currentLabel:"",labelModified:!1,isTitleEditDisabled:!1,showSaveDatasetModal:!1}}static getDerivedStateFromProps(e,t){return t.adhocMetric.optionName!==e.adhocMetric.optionName?{adhocMetric:e.adhocMetric,title:{label:e.adhocMetric.label,hasCustomLabel:e.adhocMetric.hasCustomLabel},currentLabel:"",labelModified:!1}:{adhocMetric:e.adhocMetric}}onLabelChange(e){var t;const{verbose_name:n,metric_name:r}=this.props.savedMetric,a=null==(t=this.props.adhocMetric)?void 0:t.getDefaultLabel(),o=e.target.value;this.setState((e=>({title:{label:o||e.currentLabel||n||r||a,hasCustomLabel:!!o},labelModified:!0})))}onPopoverResize(){this.forceUpdate()}handleDatasetModal(e){this.setState({showSaveDatasetModal:e})}closePopover(){this.togglePopover(!1),this.setState({labelModified:!1})}togglePopover(e){this.setState({popoverVisible:e})}getCurrentTab(e){this.setState({isTitleEditDisabled:e===gt})}getCurrentLabel(e){let{savedMetricLabel:t,adhocMetricLabel:n}=e;const r=t||n;this.setState({currentLabel:r,labelModified:!0}),!t&&this.state.title.hasCustomLabel||this.setState({title:{label:r,hasCustomLabel:!1}})}onChange(e,t){this.props.onMetricEdit({...e,...this.state.title},t)}render(){const{adhocMetric:e,savedMetric:t,columns:n,savedMetricsOptions:r,datasource:a,isControlledComponent:o}=this.props,{verbose_name:i,metric_name:l}=t,{hasCustomLabel:c,label:d}=e,u=c?d:e.getDefaultLabel(),p=this.state.labelModified?this.state.title:{label:i||l||u,hasCustomLabel:c},{visible:h,togglePopover:m,closePopover:g}=o?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},f=(0,C.tZ)(nt.b,null,(0,C.tZ)(ft,{adhocMetric:e,columns:n,savedMetricsOptions:r,savedMetric:t,datasource:a,handleDatasetModal:this.handleDatasetModal,onResize:this.onPopoverResize,onClose:g,onChange:this.onChange,getCurrentTab:this.getCurrentTab,getCurrentLabel:this.getCurrentLabel,isNewMetric:this.props.isNew,isLabelModified:this.state.labelModified&&u!==this.state.title.label})),v=(0,C.tZ)(tt,{title:p,onChange:this.onLabelChange,isEditDisabled:this.state.isTitleEditDisabled});return(0,C.tZ)(s.Fragment,null,this.state.showSaveDatasetModal&&(0,C.tZ)(Le.W,{visible:this.state.showSaveDatasetModal,onHide:()=>this.handleDatasetModal(!1),buttonTextOnSave:(0,_.t)("Save"),buttonTextOnOverwrite:(0,_.t)("Overwrite"),modalDescription:(0,_.t)("Save this query as a virtual dataset to continue exploring"),datasource:a}),(0,C.tZ)(A.Z,{placement:"right",trigger:"click",content:f,defaultVisible:h,visible:h,onVisibleChange:m,title:v,destroyTooltipOnHide:!0},this.props.children))}}const _t=vt,bt={adhocMetric:g().instanceOf(We.Z),onMetricEdit:g().func.isRequired,onRemoveMetric:g().func,columns:g().arrayOf(Ye.Z),savedMetricsOptions:g().arrayOf(Je.Z),savedMetric:Je.Z,datasource:g().object,onMoveLabel:g().func,onDropLabel:g().func,index:g().number,type:g().string,multi:g().bool,datasourceWarningMessage:g().string};class yt extends s.PureComponent{constructor(e){super(e),this.onRemoveMetric=this.onRemoveMetric.bind(this)}onRemoveMetric(e){null==e||e.stopPropagation(),this.props.onRemoveMetric(this.props.index)}render(){const{adhocMetric:e,onMetricEdit:t,columns:n,savedMetricsOptions:r,savedMetric:a,datasource:o,onMoveLabel:i,onDropLabel:s,index:l,type:c,multi:d,datasourceWarningMessage:u}=this.props;return(0,C.tZ)(_t,{adhocMetric:e,onMetricEdit:t,columns:n,savedMetricsOptions:r,savedMetric:a,datasource:o},(0,C.tZ)(z.yz,{savedMetric:a,adhocMetric:e,label:e.label,onRemove:this.onRemoveMetric,onMoveLabel:i,onDropLabel:s,index:l,type:null!=c?c:Ke.g.AdhocMetricOption,withCaret:!0,isFunction:!0,multi:d,datasourceWarningMessage:u}))}}const Et=yt;yt.propTypes=bt;const Tt={option:g().oneOfType([g().object,g().string]).isRequired,index:g().number.isRequired,onMetricEdit:g().func,onRemoveMetric:g().func,onMoveLabel:g().func,onDropLabel:g().func,columns:g().arrayOf(Ye.Z),savedMetrics:g().arrayOf(Je.Z),savedMetricsOptions:g().arrayOf(Je.Z),multi:g().bool,datasource:g().object,datasourceWarningMessage:g().string};function St(e){let t,{option:n,onMetricEdit:r,onRemoveMetric:a,columns:o,savedMetrics:i,savedMetricsOptions:s,datasource:l,onMoveLabel:c,onDropLabel:d,index:u,type:p,multi:h,datasourceWarningMessage:m}=e;var g;if("string"==typeof n?(g=n,t=i.find((e=>e.metric_name===g))):n.metric_name&&(t=n),n instanceof We.Z||t){var f;const e={onMetricEdit:r,onRemoveMetric:a,columns:o,savedMetricsOptions:s,datasource:l,adhocMetric:n instanceof We.Z?n:new We.Z({}),onMoveLabel:c,onDropLabel:d,index:u,savedMetric:null!=(f=t)?f:{},type:p,multi:h,datasourceWarningMessage:m};return(0,C.tZ)(Et,e)}return null}St.propTypes=Tt;var Ct=n(17536);const Zt={name:g().string.isRequired,onChange:g().func,value:g().oneOfType([g().arrayOf(g().oneOfType([g().string,Ct.Z])),g().oneOfType([g().string,Ct.Z])]),columns:g().arrayOf(Ye.Z),savedMetrics:g().arrayOf(Je.Z),isLoading:g().bool,multi:g().bool,clearable:g().bool,datasource:g().object};function At(e,t,n){var r;return null!=(r=null==e?void 0:e.filter((e=>Array.isArray(t)?!h()(t).call(t,e.metric_name)||e.metric_name===n:e)))?r:[]}function xt(e){return e&&!(e instanceof We.Z)&&e.expressionType}function wt(e){return e?Array.isArray(e)?e.map((e=>xt(e)?new We.Z(e):e)):xt(e)?[new We.Z(e)]:[e]:[]}const Rt={metric_name:"",expression:""},It=e=>{let{onChange:t,multi:n,value:r,columns:a,savedMetrics:o,datasource:d,...u}=e;const[p,h]=(0,s.useState)(wt(r)),m=(0,l.Fg)(),g=(0,c.D)(a),f=(0,c.D)(o),v=(0,s.useCallback)((e=>{if(null===e)return void t(null);const r=(0,Qe.Z)(e).map((e=>e.metric_name?e.metric_name:e)).filter((e=>e));t(n?r:r[0])}),[n,t]),b=(0,s.useCallback)((e=>{const t=[...p,e];h(t),v(t)}),[v,p]),y=(0,s.useCallback)(((e,t)=>{const n=p.map((n=>n!==t.metric_name&&void 0===n.optionName||n.optionName!==t.optionName?n:e));h(n),v(n)}),[v,p]),E=(0,s.useCallback)((e=>{if(!Array.isArray(p))return;const t=[...p];t.splice(e,1),h(t),v(t)}),[v,p]),T=(0,s.useCallback)(((e,t)=>{const n=[...p];[n[t],n[e]]=[n[e],n[t]],h(n)}),[p]),S=(0,s.useCallback)((()=>!n&&p.length>0),[n,p.length]),Z=(0,s.useMemo)((()=>At(o,r,null)),[r,o]),A=(0,s.useMemo)((()=>new We.Z({})),[p]),x=(0,s.useCallback)((e=>S()?e:(0,C.tZ)(_t,{adhocMetric:A,onMetricEdit:b,columns:a,savedMetricsOptions:Z,savedMetric:Rt,datasource:d,isNew:!0},e)),[a,d,S,A,b,Z]);(0,s.useEffect)((()=>{if(r&&(!i()(g,a)||!i()(f,o))){const e=((e,t,n)=>(0,Qe.Z)(e).filter((e=>"string"==typeof e||e.metric_name?null==n?void 0:n.some((t=>t.metric_name===e||t.metric_name===e.metric_name)):null==t?void 0:t.some((t=>!e.column||e.column.column_name===t.column_name)))))(r,a,o);i()(e,r)||v(e)}}),[a,v,o]),(0,s.useEffect)((()=>{h(wt(r))}),[r]);const w=(0,s.useCallback)((()=>v(p)),[v,p]),R=(0,s.useCallback)(((e,t)=>(0,C.tZ)(St,{key:t,index:t,option:e,onMetricEdit:y,onRemoveMetric:E,columns:a,datasource:d,savedMetrics:o,savedMetricsOptions:At(o,p,null==p?void 0:p[t]),onMoveLabel:T,onDropLabel:w,multi:n})),[a,d,T,n,w,y,E,o,p]);return(0,C.tZ)("div",{className:"metrics-select"},(0,C.tZ)(z.gM,null,(0,C.tZ)(M.Z,u),x((0,C.tZ)(z.IG,{disabled:S()},(0,C.tZ)(B.Z.PlusLarge,{iconSize:"s",iconColor:m.colors.grayscale.light5})))),(0,C.tZ)(z.yj,null,p.length>0?p.map(((e,t)=>R(e,t))):x((0,C.tZ)(z.SW,null,(0,C.tZ)(B.Z.PlusSmall,{iconColor:m.colors.grayscale.light1}),(0,_.t)("Add metric")))))};It.propTypes=Zt,It.defaultProps={onChange:()=>{},clearable:!0,savedMetrics:[],columns:[]};const Dt=It;var Ot=n(83734);const Lt="fix",Nt="metric",Mt={onChange:g().func,value:g().object,isFloat:g().bool,datasource:g().object.isRequired,default:g().shape({type:g().oneOf(["fix","metric"]),value:g().oneOfType([g().string,g().number])})},kt={onChange:()=>{},default:{type:Lt,value:5}};class Pt extends s.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this),this.setType=this.setType.bind(this),this.setFixedValue=this.setFixedValue.bind(this),this.setMetric=this.setMetric.bind(this);const t=(e.value?e.value.type:e.default.type)||Lt,n=(e.value?e.value.value:e.default.value)||"100";this.state={type:t,fixedValue:t===Lt?n:"",metricValue:t===Nt?n:null}}onChange(){this.props.onChange({type:this.state.type,value:this.state.type===Lt?this.state.fixedValue:this.state.metricValue})}setType(e){this.setState({type:e},this.onChange)}setFixedValue(e){this.setState({fixedValue:e},this.onChange)}setMetric(e){this.setState({metricValue:e},this.onChange)}render(){const e=(this.props.value||this.props.default).type||Lt,t=this.props.datasource?this.props.datasource.columns:null,n=this.props.datasource?this.props.datasource.metrics:null;return(0,C.tZ)("div",null,(0,C.tZ)(M.Z,this.props),(0,C.tZ)(ze.Z,{ghost:!0,css:e=>(0,C.iv)("&.ant-collapse>.ant-collapse-item.ant-collapse-no-arrow>.ant-collapse-header{border:0px;padding:0px 0px ",2*e.gridUnit,"px 0px;display:inline-block;}&.ant-collapse-ghost>.ant-collapse-item>.ant-collapse-content>.ant-collapse-content-box{padding:0px;& .well{margin-bottom:0px;padding:",2*e.gridUnit,"px;}}","")},(0,C.tZ)(ze.Z.Panel,{showArrow:!1,header:(0,C.tZ)(Be.Z,{onClick:()=>{}},this.state.type===Lt&&(0,C.tZ)("span",null,this.state.fixedValue),this.state.type===Nt&&(0,C.tZ)("span",null,(0,C.tZ)("span",null,(0,_.t)("metric"),": "),(0,C.tZ)("strong",null,this.state.metricValue?this.state.metricValue.label:null)))},(0,C.tZ)("div",{className:"well"},(0,C.tZ)(Ot.Z,{title:(0,_.t)("Fixed"),isSelected:e===Lt,onSelect:()=>{this.setType(Lt)}},(0,C.tZ)(Ge.Z,{isFloat:!0,onChange:this.setFixedValue,onFocus:()=>{this.setType(Lt)},value:this.state.fixedValue})),(0,C.tZ)(Ot.Z,{title:(0,_.t)("Based on a metric"),isSelected:e===Nt,onSelect:()=>{this.setType(Nt)}},(0,C.tZ)(Dt,{name:"metric",columns:t,savedMetrics:n,multi:!1,onFocus:()=>{this.setType(Nt)},onChange:this.setMetric,value:this.state.metricValue,datasource:this.props.datasource}))))))}}Pt.propTypes=Mt,Pt.defaultProps=kt;var Ft=n(14114),Ut=n(98286);function $t(e){return void 0!==e.value}const qt=(0,Ft.ZP)((e=>{let{addDangerToast:t,allowClear:n=!0,ariaLabel:r,dataEndpoint:a,multi:o=!0,mutator:i,onChange:l,placeholder:c,value:d,...u}=e;const[p,h]=(0,s.useState)([]);return(0,s.useEffect)((()=>{he.Z.get({endpoint:a}).then((e=>{const t=i?i(e.json):e.json.result;h(t)})).catch((e=>(0,Ut.O$)(e).then((e=>{const{error:n}=e;t((0,_.t)("Error while fetching data: %s",n))}))))}),[t,a,i]),(0,C.tZ)(f.Ph,{allowClear:n,ariaLabel:r||(0,_.t)("Select ..."),value:(()=>{const e=d||(void 0!==u.default?u.default:void 0);if(null!==e||p.find((e=>null===e.value)))return e})(),header:(0,C.tZ)(M.Z,u),mode:o?"multiple":"single",onChange:e=>{let t=e;Array.isArray(e)&&(t=e.map((e=>$t(e)?e.value:e))),$t(e)&&(t=e.value),l(t)},options:p,placeholder:c})}));var Vt=n(82199),jt=n(36155),Ht={name:"mlsake",styles:"margin-left:0;margin-right:0"};function Bt(e){return(0,C.tZ)(jt.Z,a()({},e,{css:Ht}))}var zt=n(665),Gt=n(42878);const Qt={label:g().string,tooltip:g().string,colType:g().string,width:g().string,height:g().string,timeLag:g().oneOfType([g().string,g().number]),timeRatio:g().string,comparisonType:g().string,showYAxis:g().bool,yAxisBounds:g().array,bounds:g().array,d3format:g().string,dateFormat:g().string,onChange:g().func},Yt={label:(0,_.t)("Time series columns"),tooltip:"",colType:"",width:"",height:"",timeLag:"",timeRatio:"",comparisonType:"",showYAxis:!1,yAxisBounds:[null,null],bounds:[null,null],d3format:"",dateFormat:""},Kt=[{value:"value",label:(0,_.t)("Actual value"),key:"value"},{value:"diff",label:(0,_.t)("Difference"),key:"diff"},{value:"perc",label:(0,_.t)("Percentage"),key:"perc"},{value:"perc_change",label:(0,_.t)("Percentage change"),key:"perc_change"}],Wt=[{value:"time",label:(0,_.t)("Time comparison"),key:"time"},{value:"contrib",label:(0,_.t)("Contribution"),key:"contrib"},{value:"spark",label:(0,_.t)("Sparkline"),key:"spark"},{value:"avg",label:(0,_.t)("Period average"),key:"avg"}],Jt=(0,l.iK)(f.X2)`
  margin-top: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  display: flex;
  align-items: center;
`,Xt=(0,l.iK)(f.JX)`
  display: flex;
  align-items: center;
`,en=(0,l.iK)(y.V)`
  margin-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
`,tn=l.iK.div`
  margin-top: ${e=>{let{theme:t}=e;return 5*t.gridUnit}}px;
  display: flex;
  justify-content: center;
`;class nn extends s.Component{constructor(e){super(e),this.onSave=this.onSave.bind(this),this.onClose=this.onClose.bind(this),this.resetState=this.resetState.bind(this),this.initialState=this.initialState.bind(this),this.onPopoverVisibleChange=this.onPopoverVisibleChange.bind(this),this.state=this.initialState()}initialState(){return{label:this.props.label,tooltip:this.props.tooltip,colType:this.props.colType,width:this.props.width,height:this.props.height,timeLag:this.props.timeLag||0,timeRatio:this.props.timeRatio,comparisonType:this.props.comparisonType,showYAxis:this.props.showYAxis,yAxisBounds:this.props.yAxisBounds,bounds:this.props.bounds,d3format:this.props.d3format,dateFormat:this.props.dateFormat,popoverVisible:!1}}resetState(){const e=this.initialState();this.setState({...e})}onSave(){this.props.onChange(this.state),this.setState({popoverVisible:!1})}onClose(){this.resetState()}onSelectChange(e,t){this.setState({[e]:t})}onTextInputChange(e,t){this.setState({[e]:t.target.value})}onCheckboxChange(e,t){this.setState({[e]:t})}onBoundsChange(e){this.setState({bounds:e})}onPopoverVisibleChange(e){e?this.setState({popoverVisible:e}):this.resetState()}onYAxisBoundsChange(e){this.setState({yAxisBounds:e})}textSummary(){return`${this.props.label}`}formRow(e,t,n,r){return(0,C.tZ)(Jt,null,(0,C.tZ)(Xt,{xs:24,md:11},e,(0,C.tZ)(en,{placement:"top",tooltip:t,label:n})),(0,C.tZ)(f.JX,{xs:24,md:13},r))}renderPopover(){return(0,C.tZ)("div",{id:"ts-col-popo",style:{width:320}},this.formRow((0,_.t)("Label"),(0,_.t)("The column header label"),"time-lag",(0,C.tZ)(N.II,{value:this.state.label,onChange:this.onTextInputChange.bind(this,"label"),placeholder:(0,_.t)("Label")})),this.formRow((0,_.t)("Tooltip"),(0,_.t)("Column header tooltip"),"col-tooltip",(0,C.tZ)(N.II,{value:this.state.tooltip,onChange:this.onTextInputChange.bind(this,"tooltip"),placeholder:(0,_.t)("Tooltip")})),this.formRow((0,_.t)("Type"),(0,_.t)("Type of comparison, value difference or percentage"),"col-type",(0,C.tZ)(f.Ph,{ariaLabel:(0,_.t)("Type"),value:this.state.colType||void 0,onChange:this.onSelectChange.bind(this,"colType"),options:Wt})),(0,C.tZ)("hr",null),"spark"===this.state.colType&&this.formRow((0,_.t)("Width"),(0,_.t)("Width of the sparkline"),"spark-width",(0,C.tZ)(N.II,{value:this.state.width,onChange:this.onTextInputChange.bind(this,"width"),placeholder:(0,_.t)("Width")})),"spark"===this.state.colType&&this.formRow((0,_.t)("Height"),(0,_.t)("Height of the sparkline"),"spark-width",(0,C.tZ)(N.II,{value:this.state.height,onChange:this.onTextInputChange.bind(this,"height"),placeholder:(0,_.t)("Height")})),["time","avg"].indexOf(this.state.colType)>=0&&this.formRow((0,_.t)("Time lag"),(0,_.t)("Number of periods to compare against"),"time-lag",(0,C.tZ)(N.II,{value:this.state.timeLag,onChange:this.onTextInputChange.bind(this,"timeLag"),placeholder:(0,_.t)("Time Lag")})),["spark"].indexOf(this.state.colType)>=0&&this.formRow((0,_.t)("Time ratio"),(0,_.t)("Number of periods to ratio against"),"time-ratio",(0,C.tZ)(N.II,{value:this.state.timeRatio,onChange:this.onTextInputChange.bind(this,"timeRatio"),placeholder:(0,_.t)("Time Ratio")})),"time"===this.state.colType&&this.formRow((0,_.t)("Type"),(0,_.t)("Type of comparison, value difference or percentage"),"comp-type",(0,C.tZ)(f.Ph,{ariaLabel:(0,_.t)("Type"),value:this.state.comparisonType||void 0,onChange:this.onSelectChange.bind(this,"comparisonType"),options:Kt})),"spark"===this.state.colType&&this.formRow((0,_.t)("Show Y-axis"),(0,_.t)("Show Y-axis on the sparkline. Will display the manually set min/max if set or min/max values in the data otherwise."),"show-y-axis-bounds",(0,C.tZ)(q.Z,{value:this.state.showYAxis,onChange:this.onCheckboxChange.bind(this,"showYAxis")})),"spark"===this.state.colType&&this.formRow((0,_.t)("Y-axis bounds"),(0,_.t)("Manually set min/max values for the y-axis."),"y-axis-bounds",(0,C.tZ)($,{value:this.state.yAxisBounds,onChange:this.onYAxisBoundsChange.bind(this)})),"spark"!==this.state.colType&&this.formRow((0,_.t)("Color bounds"),(0,_.t)("Number bounds used for color encoding from red to blue.\n               Reverse the numbers for blue to red. To get pure red or blue,\n               you can enter either only min or max."),"bounds",(0,C.tZ)($,{value:this.state.bounds,onChange:this.onBoundsChange.bind(this)})),this.formRow((0,_.t)("Number format"),(0,_.t)("Optional d3 number format string"),"d3-format",(0,C.tZ)(N.II,{value:this.state.d3format,onChange:this.onTextInputChange.bind(this,"d3format"),placeholder:(0,_.t)("Number format string")})),"spark"===this.state.colType&&this.formRow((0,_.t)("Date format"),(0,_.t)("Optional d3 date format string"),"date-format",(0,C.tZ)(N.II,{value:this.state.dateFormat,onChange:this.onTextInputChange.bind(this,"dateFormat"),placeholder:(0,_.t)("Date format string")})),(0,C.tZ)(tn,null,(0,C.tZ)(be.Z,{buttonSize:"small",onClick:this.onClose,cta:!0},(0,_.t)("Close")),(0,C.tZ)(be.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave,cta:!0},(0,_.t)("Save"))))}render(){return(0,C.tZ)("span",null,this.textSummary()," ",(0,C.tZ)(A.Z,{trigger:"click",content:this.renderPopover(),title:(0,_.t)("Column Configuration"),visible:this.state.popoverVisible,onVisibleChange:this.onPopoverVisibleChange},(0,C.tZ)(y.V,{icon:"edit",className:"text-primary",label:"edit-ts-column"})))}}nn.propTypes=Qt,nn.defaultProps=Yt;var rn=n(79512);const an=["longitude","latitude","zoom","bearing","pitch"],on={onChange:g().func,value:g().shape({longitude:g().number,latitude:g().number,zoom:g().number,bearing:g().number,pitch:g().number}),default:g().object,name:g().string.isRequired};class sn extends s.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e,t){this.props.onChange({...this.props.value,[e]:t})}renderTextControl(e){return(0,C.tZ)("div",{key:e},(0,C.tZ)(it.lX,null,e),(0,C.tZ)(Ge.Z,{value:this.props.value[e],onChange:this.onChange.bind(this,e),isFloat:!0}))}renderPopover(){return(0,C.tZ)("div",{id:`filter-popover-${this.props.name}`},an.map((e=>this.renderTextControl(e))))}renderLabel(){return this.props.value.longitude&&this.props.value.latitude?`${(0,rn.decimal2sexagesimal)(this.props.value.longitude)} | ${(0,rn.decimal2sexagesimal)(this.props.value.latitude)}`:"N/A"}render(){return(0,C.tZ)("div",null,(0,C.tZ)(M.Z,this.props),(0,C.tZ)(re.Z,{container:document.body,trigger:"click",placement:"right",content:this.renderPopover(),title:(0,_.t)("Viewport")},(0,C.tZ)(Be.Z,{className:"pointer"},this.renderLabel())))}}sn.propTypes=on,sn.defaultProps={onChange:()=>{},default:{type:"fix",value:5},value:{longitude:6.85236157047845,latitude:31.222656842808707,zoom:1,bearing:0,pitch:0}};var ln=n(11064),cn=n(14278),dn=n(74069),un=n(20292),pn=n(13284);const hn=[{name:"echarts_timeseries_line",icon:(0,C.tZ)(B.Z.LineChartTile,null)},{name:"echarts_timeseries_bar",icon:(0,C.tZ)(B.Z.BarChartTile,null)},{name:"echarts_area",icon:(0,C.tZ)(B.Z.AreaChartTile,null)},{name:"table",icon:(0,C.tZ)(B.Z.TableChartTile,null)},{name:"big_number_total",icon:(0,C.tZ)(B.Z.BigNumberChartTile,null)},{name:"pie",icon:(0,C.tZ)(B.Z.PieChartTile,null)}],mn={iconSize:"l",css:e=>C.iv`
    padding: ${e.gridUnit}px;
    & > * {
      line-height: 0;
    }
  `},gn=e=>{var t;let{isActive:n,isRendered:r,vizMeta:o,onTileClick:i}=e;const{mountedPluginMetadata:c}=(0,cn.gp)(),d=(0,s.useRef)(null),u=(0,l.Fg)(),p=2*u.transitionTiming,[h,m]=(0,s.useState)(!1),[g,f]=(0,s.useState)(!1),[v,b]=(0,s.useState)(!1),y=o.name?(null==(t=c[o.name])?void 0:t.name)||`${o.name}`:(0,_.t)("Select Viz Type"),E=(0,s.useCallback)((()=>{i(o.name),f(!0),m(!1),setTimeout((()=>{f(!1)}),1e3*p)}),[i,p,o.name]);(0,s.useEffect)((()=>{b(Boolean(!g&&(!n||d.current&&d.current.scrollWidth>d.current.clientWidth)))}),[n,g]);const T=(0,s.useMemo)((()=>n?{}:{role:"button",tabIndex:0,onClick:E}),[E,n]);let S=null;return v&&(S=r?(0,_.t)("Currently rendered: %s",y):y),(0,C.tZ)(ve.u,{title:S,onVisibleChange:e=>m(e),visible:h&&!g,placement:"top",mouseEnterDelay:.4},(0,C.tZ)("div",a()({},T,{css:C.iv`
          display: flex;
          align-items: center;
          text-transform: uppercase;

          color: ${u.colors.grayscale.base};
          font-weight: ${u.typography.weights.bold};
          border-radius: 6px;
          white-space: nowrap;
          overflow: hidden;
          max-width: fit-content;

          ${!n&&C.iv`
            flex-shrink: 0;
            width: ${6*u.gridUnit}px;
            background-color: transparent;
            transition: none;
            &:hover svg path {
              fill: ${u.colors.primary.base};
              transition: fill ${u.transitionTiming}s ease-out;
            }
          `}

          ${n&&C.iv`
            width: 100%;
            background-color: ${u.colors.grayscale.light4};
            transition: width ${p}s ease-out,
              background-color ${p}s ease-out;
            cursor: default;
            svg path {
              fill: ${u.colors.primary.base};
            }
          `}
        `}),o.icon," ",(0,C.tZ)("span",{css:C.iv`
            overflow: hidden;
            text-overflow: ellipsis;
            min-width: 0;
            padding-right: ${u.gridUnit}px;
          `,ref:d},y)))},fn=s.memo((e=>{let{currentSelection:t,onChange:n}=e;const r=(0,v.v9)((e=>{var t,n,r;return null==(t=e.charts)||null==(n=t[(0,T.Jp)(e.explore)])||null==(r=n.latestQueryFormData)?void 0:r.viz_type})),o=(0,s.useMemo)((()=>{const e=[...hn];return t&&hn.every((e=>e.name!==t))&&t!==r&&e.unshift({name:t,icon:(0,C.tZ)(B.Z.MonitorOutlined,a()({},mn,{"aria-label":"monitor"}))}),r&&hn.every((e=>e.name!==r))&&e.unshift({name:r,icon:(0,C.tZ)(B.Z.CheckSquareOutlined,a()({},mn,{"aria-label":"check-square"}))}),e}),[t,r]);return(0,C.tZ)("div",{css:e=>C.iv`
          display: flex;
          justify-content: space-between;
          column-gap: ${e.gridUnit}px;
        `},o.map((e=>(0,C.tZ)(gn,{vizMeta:e,isActive:t===e.name,isRendered:r===e.name,onTileClick:n,key:e.name}))))})),vn=(0,un.Z)().common.conf.VIZ_TYPE_DENYLIST||[],_n=(0,ln.Z)();function bn(e){let{vizType:t}=e;return(0,cn.gp)().loading||_n.has(t)?null:(0,C.tZ)("div",{className:"text-danger",css:e=>C.iv`
        margin-top: ${e.gridUnit}px;
      `},(0,C.tZ)("i",{className:"fa fa-exclamation-circle text-danger"})," ",(0,C.tZ)("small",null,(0,_.t)("This visualization type is not supported.")))}const yn=(0,l.iK)(dn.Z)`
  .ant-modal-body {
    padding: 0;
  }
`;var En=n(61890);const Tn={marginTop:"5px",minHeight:"30px"},Sn={textAlign:"right"},Cn={label:g().string.isRequired,tooltip:g().string,control:g().node.isRequired,isCheckbox:g().bool};function Zn(e){let{label:t,tooltip:n,control:r,isCheckbox:a}=e;const o=(0,C.tZ)("span",null,t," ",n&&(0,C.tZ)(y.V,{placement:"top",label:t,tooltip:n}));return a?(0,C.tZ)(f.X2,{style:Tn,gutter:16},(0,C.tZ)(f.JX,{xs:24,md:8,style:Sn},r),(0,C.tZ)(f.JX,{xs:24,md:16},o)):(0,C.tZ)(f.X2,{style:Tn,gutter:16},(0,C.tZ)(f.JX,{xs:24,md:8,style:Sn},o),(0,C.tZ)(f.JX,{xs:24,md:16},r))}Zn.propTypes=Cn,Zn.defaultProps={tooltip:null,isCheckbox:!1};const An=new Set(["TINYINT","SMALLINT","INT","INTEGER","BIGINT","LONG"]),xn=new Set(["FLOAT","DOUBLE","REAL","NUMERIC","DECIMAL","MONEY"]),wn={datasource:g().object.isRequired,onChange:g().func,asc:g().bool,clearable:g().bool,multiple:g().bool,column:g().string,label:g().string,metric:g().string,searchAllOptions:g().bool,defaultValue:g().string},Rn={width:350};class In extends s.Component{constructor(e){super(e);const{column:t,metric:n,asc:r,clearable:a,multiple:o,searchAllOptions:i,label:s,defaultValue:l}=e;this.state={column:t,metric:n,label:s,asc:r,clearable:a,multiple:o,searchAllOptions:i,defaultValue:l},this.onChange=this.onChange.bind(this),this.onControlChange=this.onControlChange.bind(this)}onChange(){this.props.onChange(this.state)}onControlChange(e,t){let n=t;const{column:r,multiple:a}=this.state;if(t&&!a&&e===dt.ft.DEFAULT_VALUE){const{datasource:e}=this.props,a=e.columns.find((e=>e.column_name===r));if(a&&a.type){const e=a.type.toUpperCase();"BOOLEAN"===e?n="true"===t:An.has(e)?n=Number.isNaN(Number(t))?null:parseInt(t,10):xn.has(e)&&(n=Number.isNaN(Number(t))?null:parseFloat(t))}}this.setState({[e]:n},this.onChange)}setType(){}textSummary(){return this.state.column||"N/A"}renderForm(){return(0,C.tZ)("div",null,(0,C.tZ)(Zn,{label:(0,_.t)("Column"),control:(0,C.tZ)(f.Ph,{ariaLabel:(0,_.t)("Column"),value:this.state.column,name:"column",options:this.props.datasource.columns.filter((e=>e.column_name!==this.state.column)).map((e=>({value:e.column_name,label:e.column_name}))).concat([{value:this.state.column,label:this.state.column}]),onChange:e=>this.onControlChange("column",e)})}),(0,C.tZ)(Zn,{label:(0,_.t)("Label"),control:(0,C.tZ)(Ge.Z,{value:this.state.label,name:"label",onChange:e=>this.onControlChange("label",e)})}),(0,C.tZ)(Zn,{label:(0,_.t)("Default"),tooltip:(0,_.t)("(optional) default value for the filter, when using the multiple option, you can use a semicolon-delimited list of options."),control:(0,C.tZ)(Ge.Z,{value:this.state.defaultValue,name:"defaultValue",onChange:e=>this.onControlChange(dt.ft.DEFAULT_VALUE,e)})}),(0,C.tZ)(Zn,{label:(0,_.t)("Sort metric"),tooltip:(0,_.t)("Metric to sort the results by"),control:(0,C.tZ)(f.Ph,{ariaLabel:(0,_.t)("Sort metric"),value:this.state.metric,name:"column",options:this.props.datasource.metrics.filter((e=>e.metric_name!==this.state.metric)).map((e=>({value:e.metric_name,label:e.metric_name}))).concat([{value:this.state.metric,label:this.state.metric}]),onChange:e=>this.onControlChange("metric",e)})}),(0,C.tZ)(Zn,{label:(0,_.t)("Sort ascending"),tooltip:(0,_.t)("Check for sorting ascending"),isCheckbox:!0,control:(0,C.tZ)(q.Z,{value:this.state.asc,onChange:e=>this.onControlChange("asc",e)})}),(0,C.tZ)(Zn,{label:(0,_.t)("Allow multiple selections"),isCheckbox:!0,tooltip:(0,_.t)("Multiple selections allowed, otherwise filter is limited to a single value"),control:(0,C.tZ)(q.Z,{value:this.state.multiple,onChange:e=>this.onControlChange(dt.ft.MULTIPLE,e)})}),(0,C.tZ)(Zn,{label:(0,_.t)("Search all filter options"),tooltip:(0,_.t)("By default, each filter loads at most 1000 choices at the initial page load. Check this box if you have more than 1000 filter values and want to enable dynamically searching that loads filter values as users type (may add stress to your database)."),isCheckbox:!0,control:(0,C.tZ)(q.Z,{value:this.state.searchAllOptions,onChange:e=>this.onControlChange(dt.ft.SEARCH_ALL_OPTIONS,e)})}),(0,C.tZ)(Zn,{label:(0,_.t)("Required"),tooltip:(0,_.t)("User must select a value for this filter"),isCheckbox:!0,control:(0,C.tZ)(q.Z,{value:!this.state.clearable,onChange:e=>this.onControlChange("clearable",!e)})}))}renderPopover(){return(0,C.tZ)("div",{id:"ts-col-popo",style:Rn},this.renderForm())}render(){return(0,C.tZ)("span",null,this.textSummary()," ",(0,C.tZ)(A.Z,{trigger:"click",content:this.renderPopover(),title:(0,_.t)("Filter configuration")},(0,C.tZ)(y.V,{icon:"edit",className:"text-primary",label:"edit-ts-column"})))}}In.propTypes=wn,In.defaultProps={onChange:()=>{},asc:!0,clearable:!0,multiple:!0,searchAllOptions:!1};var Dn,On=n(81315);!function(e){e.NONE="None",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_OR_EQUAL="",e.LESS_OR_EQUAL="",e.EQUAL="=",e.NOT_EQUAL="",e.BETWEEN="< x <",e.BETWEEN_OR_EQUAL=" x ",e.BETWEEN_OR_LEFT_EQUAL=" x <",e.BETWEEN_OR_RIGHT_EQUAL="< x "}(Dn||(Dn={}));const Ln=[Dn.BETWEEN,Dn.BETWEEN_OR_EQUAL,Dn.BETWEEN_OR_LEFT_EQUAL,Dn.BETWEEN_OR_RIGHT_EQUAL],Nn=(0,l.iK)(N.Rn)`
  width: 100%;
`,Mn=l.iK.div`
  display: flex;
  justify-content: flex-end;
`,kn=[{value:Dn.NONE,label:(0,_.t)("None")},{value:Dn.GREATER_THAN,label:">"},{value:Dn.LESS_THAN,label:"<"},{value:Dn.GREATER_OR_EQUAL,label:""},{value:Dn.LESS_OR_EQUAL,label:""},{value:Dn.EQUAL,label:"="},{value:Dn.NOT_EQUAL,label:""},{value:Dn.BETWEEN,label:"< x <"},{value:Dn.BETWEEN_OR_EQUAL,label:" x "},{value:Dn.BETWEEN_OR_LEFT_EQUAL,label:" x <"},{value:Dn.BETWEEN_OR_RIGHT_EQUAL,label:"< x "}],Pn=(e,t)=>n=>(r,a)=>n&&a&&!e(Number(n),Number(a))?Promise.reject(new Error(t)):Promise.resolve(),Fn=Pn(((e,t)=>e>t),(0,_.t)("This value should be smaller than the right target value")),Un=Pn(((e,t)=>e<t),(0,_.t)("This value should be greater than the left target value")),$n=e=>e&&h()(Ln).call(Ln,e),qn=e=>!e||e===Dn.NONE,Vn=[{required:!0,message:(0,_.t)("Required")}],jn=[{required:!0,message:(0,_.t)("Required")},e=>{let{getFieldValue:t}=e;return{validator:Fn(t("targetValueRight"))}}],Hn=[{required:!0,message:(0,_.t)("Required")},e=>{let{getFieldValue:t}=e;return{validator:Un(t("targetValueLeft"))}}],Bn=["targetValueRight"],zn=["targetValueLeft"],Gn=(e,t)=>qn(e.operator)!==qn(t.operator)||$n(e.operator)!==$n(t.operator),Qn=(0,C.tZ)(it.xJ,{name:"operator",label:(0,_.t)("Operator"),rules:Vn,initialValue:kn[0].value},(0,C.tZ)(On.Z,{ariaLabel:(0,_.t)("Operator"),options:kn})),Yn=e=>{let{getFieldValue:t}=e;return qn(t("operator"))?(0,C.tZ)(f.X2,{gutter:12},(0,C.tZ)(f.JX,{span:6},Qn)):$n(t("operator"))?(0,C.tZ)(f.X2,{gutter:12},(0,C.tZ)(f.JX,{span:9},(0,C.tZ)(it.xJ,{name:"targetValueLeft",label:(0,_.t)("Left value"),rules:jn,dependencies:Bn,validateTrigger:"onBlur",trigger:"onBlur"},(0,C.tZ)(Nn,null))),(0,C.tZ)(f.JX,{span:6},Qn),(0,C.tZ)(f.JX,{span:9},(0,C.tZ)(it.xJ,{name:"targetValueRight",label:(0,_.t)("Right value"),rules:Hn,dependencies:zn,validateTrigger:"onBlur",trigger:"onBlur"},(0,C.tZ)(Nn,null)))):(0,C.tZ)(f.X2,{gutter:12},(0,C.tZ)(f.JX,{span:6},Qn),(0,C.tZ)(f.JX,{span:18},(0,C.tZ)(it.xJ,{name:"targetValue",label:(0,_.t)("Target value"),rules:Vn},(0,C.tZ)(Nn,null))))},Kn=e=>{var t;let{config:n,onChange:r,columns:a=[]}=e;const o=[{value:(i=(0,l.Fg)()).colors.success.light1,label:(0,_.t)("success")},{value:i.colors.alert.light1,label:(0,_.t)("alert")},{value:i.colors.error.light1,label:(0,_.t)("error")},{value:i.colors.success.dark1,label:(0,_.t)("success dark")},{value:i.colors.alert.dark1,label:(0,_.t)("alert dark")},{value:i.colors.error.dark1,label:(0,_.t)("error dark")}];var i;return(0,C.tZ)(it.l0,{onFinish:r,initialValues:n,requiredMark:"optional",layout:"vertical"},(0,C.tZ)(f.X2,{gutter:12},(0,C.tZ)(f.JX,{span:12},(0,C.tZ)(it.xJ,{name:"column",label:(0,_.t)("Column"),rules:Vn,initialValue:null==(t=a[0])?void 0:t.value},(0,C.tZ)(On.Z,{ariaLabel:(0,_.t)("Select column"),options:a}))),(0,C.tZ)(f.JX,{span:12},(0,C.tZ)(it.xJ,{name:"colorScheme",label:(0,_.t)("Color scheme"),rules:Vn,initialValue:o[0].value},(0,C.tZ)(On.Z,{ariaLabel:(0,_.t)("Color scheme"),options:o})))),(0,C.tZ)(it.xJ,{noStyle:!0,shouldUpdate:Gn},Yn),(0,C.tZ)(it.xJ,null,(0,C.tZ)(Mn,null,(0,C.tZ)(be.Z,{htmlType:"submit",buttonStyle:"primary"},(0,_.t)("Apply")))))},Wn=e=>{let{title:t,columns:n,onChange:r,config:o,children:i,...l}=e;const[c,d]=(0,s.useState)(!1),u=(0,s.useCallback)((e=>{d(!1),r(e)}),[r]);return(0,C.tZ)(re.Z,a()({title:t,content:(0,C.tZ)(Kn,{onChange:u,config:o,columns:n}),visible:c,onVisibleChange:d,trigger:["click"],overlayStyle:{width:"450px"}},l),i)},Jn=l.iK.div`
  ${e=>{let{theme:t}=e;return C.iv`
    padding: ${t.gridUnit}px;
    border: solid 1px ${t.colors.grayscale.light2};
    border-radius: ${t.gridUnit}px;
  `}}
`,Xn=(0,l.iK)(z.EQ)`
  &,
  & > div {
    margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    :last-child {
      margin-bottom: 0;
    }
  }
`,er=l.iK.button`
  ${e=>{let{theme:t}=e;return C.iv`
    color: ${t.colors.grayscale.light1};
    height: 100%;
    width: ${6*t.gridUnit}px;
    border: none;
    border-right: solid 1px ${t.colors.grayscale.dark2}0C;
    padding: 0;
    outline: none;
    border-bottom-left-radius: 3px;
    border-top-left-radius: 3px;
  `}}
`;var tr=n(22068);function nr(e){let{displayGhostButton:t=!0,accept:n,valuesRenderer:r,...a}=e;const o=(0,l.Fg)(),[{isOver:i,canDrop:c},d]=(0,tr.L)({accept:n,drop:e=>{a.onDrop(e),null==a.onDropValue||a.onDropValue(e.value)},canDrop:e=>{var t;return a.canDrop(e)&&(null==(t=null==a.canDropValue?void 0:a.canDropValue(e.value))||t)},collect:e=>({isOver:e.isOver(),canDrop:e.canDrop(),type:e.getItemType()})}),u=(0,s.useMemo)((()=>r()),[r]);return(0,C.tZ)("div",{ref:d},(0,C.tZ)(z.gM,null,(0,C.tZ)(M.Z,a)),(0,C.tZ)(z.H$,{canDrop:c,isOver:i},u,t&&(0,C.tZ)(z.SW,{cancelHover:!a.onClickGhostButton,onClick:a.onClickGhostButton},(0,C.tZ)(B.Z.PlusSmall,{iconColor:o.colors.grayscale.light1}),(0,_.t)(a.ghostButtonText))))}var rr=n(41609),ar=n.n(rr),or=n(72813),ir=n(38575),sr=n(53769),lr=n(27034);const cr=(0,l.iK)(y.V)`
  margin: 0 ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`;function dr(e){let{children:t,index:n,clickClose:r,withCaret:a,isExtra:o,datasourceWarningMessage:i,canDelete:c=!0}=e;const d=(0,l.Fg)(),u=(0,s.useCallback)((e=>{e.stopPropagation(),r(n)}),[r,n]);return(0,C.tZ)(z.EQ,{withCaret:a},c&&(0,C.tZ)(z.gu,{role:"button",onClick:u},(0,C.tZ)(B.Z.XSmall,{iconColor:d.colors.grayscale.light1})),(0,C.tZ)(z.__,null,t),(!!i||o)&&(0,C.tZ)(cr,{icon:"exclamation-triangle",placement:"top",bsStyle:"warning",tooltip:i||(0,_.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),a&&(0,C.tZ)(z.Ne,null,(0,C.tZ)(B.Z.CaretRight,{iconColor:d.colors.grayscale.light1})))}const ur=l.iK.div`
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`;function pr(e){const{index:t,label:n,tooltipTitle:r,column:o,type:i,onShiftOptions:l,clickClose:c,withCaret:d,isExtra:u,datasourceWarningMessage:p,canDelete:h=!0,...m}=e,g=(0,s.useRef)(null),f=(0,s.useRef)(null),[{isDragging:v},_]=(0,lr.c)({item:{type:i,dragIndex:t},collect:e=>({isDragging:e.isDragging()})}),[,b]=(0,tr.L)({accept:i,hover:(e,n)=>{var r;if(!g.current)return;const{dragIndex:a}=e,o=t;if(a===o)return;const i=null==(r=g.current)?void 0:r.getBoundingClientRect(),s=(i.bottom-i.top)/2,c=n.getClientOffset(),d=c?c.y-i.top:0;a<o&&d<s||a>o&&d>s||(l(a,o),e.dragIndex=o)}}),y=!v&&r&&n&&r!==n||!v&&f&&f.current&&f.current.scrollWidth>f.current.clientWidth,E=()=>y?(0,C.tZ)(ve.u,{title:r||n},(0,C.tZ)("span",null,n)):(0,C.tZ)("span",null,n),T=()=>{const e=o&&(0,or.GA)(o)?{verbose_name:o.label,expression:o.sqlExpression}:o;return(0,C.tZ)(ut.l,{column:e,labelRef:f,showType:!0})};return _(b(g)),(0,C.tZ)(z.a7,a()({ref:g},m),(0,C.tZ)(dr,{index:t,clickClose:c,withCaret:d,isExtra:u,datasourceWarningMessage:p,canDelete:h},(0,C.tZ)((()=>n?(0,C.tZ)(ur,{ref:f},(0,C.tZ)(E,null)):o?(0,C.tZ)(ur,null,(0,C.tZ)(T,null)):null),null)))}const hr=e=>(0,ir.xN)(e)?e.column_name:e;class mr{constructor(e,t,n){this.values=void 0,this.options=void 0,this.multi=void 0,this.options=e,this.multi=t,this.values=(0,Qe.Z)(n).map((t=>t&&(0,or.s9)(t)&&t in e?e[t]:(0,or.s9)(t)?null:t)).filter(Boolean)}add(e){(0,or.s9)(e)&&e in this.options?this.values.push(this.options[e]):(0,or.s9)(e)||this.values.push(e)}del(e){this.values.splice(e,1)}replace(e,t){this.values[e]&&(this.values[e]=(0,or.s9)(t)?this.options[t]:t)}swap(e,t){[this.values[e],this.values[t]]=[this.values[t],this.values[e]]}has(e){return this.values.some((t=>(0,or.s9)(e)?t.column_name===e||t.label===e:t.column_name===e.label||t.label===e.label))}getValues(){return this.multi?this.values.map(hr):this.values.length>0?hr(this.values[0]):void 0}}var gr=n(23493),fr=n.n(gr);const vr=(0,l.iK)(f.Ph)`
  .metric-option {
    & > svg {
      min-width: ${e=>{let{theme:t}=e;return 4*t.gridUnit+"px"}};
    }
    & > .option-label {
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
`,_r=e=>{let{columns:t,editedColumn:n,onChange:r,onClose:a,setDatasetModal:o,setLabel:i,getCurrentTab:l,label:c,isTemporal:d}=e;const u=(0,v.v9)((e=>e.explore.datasource.type)),[p]=(0,s.useState)(c),[h,m,g]=(e=>e?(0,or.GA)(e)?[e,void 0,void 0]:(0,ir.zy)(e)?[void 0,e,void 0]:[void 0,void 0,e]:[void 0,void 0,void 0])(n),[b,y]=(0,s.useState)(h),[E,T]=(0,s.useState)(m),[S,Z]=(0,s.useState)(g),[A,x,w]=function(e,t){const[n,r]=(0,s.useState)(dt.kc),[a,o]=(0,s.useState)(dt.H7),[i,l]=(0,s.useState)(0),[c,d]=(0,s.useState)(0),[u,p]=(0,s.useState)(0),[h,m]=(0,s.useState)(0),[g,f]=(0,s.useState)(n),[v,_]=(0,s.useState)(a),[b,y]=(0,s.useState)(!1),E=(0,s.useCallback)((e=>{e.preventDefault(),l(e.clientX),d(e.clientY)}),[]),T=(0,s.useCallback)((()=>{y(!1)}),[]),S=(0,s.useCallback)((e=>{p(e.clientX),m(e.clientY),y(!0)}),[]);(0,s.useEffect)((()=>{b?document.addEventListener("mousemove",E):(f(n),_(a),document.removeEventListener("mousemove",E))}),[E,b]);const Z=(0,s.useCallback)(fr()((e=>{let{dragStartX:t,dragStartY:n,dragStartWidth:a,dragStartHeight:i,clientX:s,clientY:l,minWidth:c,minHeight:d}=e;r(Math.max(a+(s-t),c)),o(Math.max(i+(l-n),d))}),50),[o,r]);return(0,s.useEffect)((()=>{b&&Z({dragStartX:u,dragStartY:h,dragStartWidth:g,dragStartHeight:v,clientX:i,clientY:c,minWidth:e,minHeight:t})}),[b,i,c,g,v,u,h]),(0,s.useEffect)((()=>(document.addEventListener("mouseup",T),()=>document.removeEventListener("mouseup",T))),[T]),[(0,C.tZ)("i",{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:S,className:"fa fa-expand edit-popover-resize text-muted"}),n,a]}(dt.kc,dt.H7),R=(0,s.useRef)(null),[I,D]=(0,s.useMemo)((()=>null==t?void 0:t.reduce(((e,t)=>(t.expression?e[0].push(t):e[1].push(t),e)),[[],[]])),[t]),O=(0,s.useCallback)((e=>{y({label:c,sqlExpression:e,expressionType:"SQL"}),Z(void 0),T(void 0)}),[c]),L=(0,s.useCallback)((e=>{const t=I.find((t=>t.column_name===e));T(t),Z(void 0),y(void 0),i((null==t?void 0:t.verbose_name)||(null==t?void 0:t.column_name)||"")}),[I,i]),N=(0,s.useCallback)((e=>{const t=D.find((t=>t.column_name===e));T(void 0),Z(t),y(void 0),i((null==t?void 0:t.verbose_name)||(null==t?void 0:t.column_name)||"")}),[i,D]),M=h?"sqlExpression":g||0===I.length?"simple":"saved";(0,s.useEffect)((()=>{l(M)}),[M,l]);const k=(0,s.useCallback)((()=>{b&&b.label!==c&&(b.label=c);const e=b||E||S;e&&(r(e),a())}),[b,c,r,a,E,S]),P=(0,s.useCallback)((()=>{T(m),Z(g),y(h),a()}),[h,m,g,a]),F=(0,s.useCallback)((e=>{var t;l(e),null==(t=R.current)||t.editor.focus()}),[l]),U=(0,s.useCallback)((()=>{var e;null==(e=R.current)||e.editor.resize()}),[]),$=()=>{o&&o(!0),a()},q=b||E||S,V=p!==c||(null==E?void 0:E.column_name)!==(null==m?void 0:m.column_name)||(null==S?void 0:S.column_name)!==(null==g?void 0:g.column_name)||(null==b?void 0:b.sqlExpression)!==(null==h?void 0:h.sqlExpression),j=(0,_.t)("Saved expressions"),H=(0,_.t)("Column");return(0,C.tZ)(it.l0,{layout:"vertical",id:"metrics-edit-popover"},(0,C.tZ)(at.ZP,{id:"adhoc-metric-edit-tabs",defaultActiveKey:M,onChange:F,className:"adhoc-metric-edit-tabs",allowOverflow:!0,css:C.iv`
          height: ${w}px;
          width: ${x}px;
        `},(0,C.tZ)(at.ZP.TabPane,{key:"saved",tab:(0,_.t)("Saved")},I.length>0?(0,C.tZ)(it.xJ,{label:j},(0,C.tZ)(vr,{ariaLabel:j,value:null==E?void 0:E.column_name,onChange:L,allowClear:!0,autoFocus:!E,placeholder:(0,_.t)("%s column(s)",I.length),options:I.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,customLabel:(0,C.tZ)(ut.l,{column:e,showType:!0}),key:e.column_name})))})):u===pe.i9.Table?(0,C.tZ)(ot.Tc,{image:"empty.svg",title:d?(0,_.t)("No temporal columns found"):(0,_.t)("No saved expressions found"),description:d?(0,_.t)('Add calculated temporal columns to dataset in "Edit datasource" modal'):(0,_.t)('Add calculated columns to dataset in "Edit datasource" modal')}):(0,C.tZ)(ot.Tc,{image:"empty.svg",title:d?(0,_.t)("No temporal columns found"):(0,_.t)("No saved expressions found"),description:d?(0,C.tZ)(s.Fragment,null,(0,C.tZ)("span",{role:"button",tabIndex:0,onClick:$},(0,_.t)("Create a dataset"))," ",(0,_.t)(" to mark a column as a time column")):(0,C.tZ)(s.Fragment,null,(0,C.tZ)("span",{role:"button",tabIndex:0,onClick:$},(0,_.t)("Create a dataset"))," ",(0,_.t)(" to add calculated columns"))})),(0,C.tZ)(at.ZP.TabPane,{key:"simple",tab:(0,_.t)("Simple")},d&&0===D.length?(0,C.tZ)(ot.Tc,{image:"empty.svg",title:(0,_.t)("No temporal columns found"),description:u===pe.i9.Table?(0,_.t)('Mark a column as temporal in "Edit datasource" modal'):(0,C.tZ)(s.Fragment,null,(0,C.tZ)("span",{role:"button",tabIndex:0,onClick:$},(0,_.t)("Create a dataset"))," ",(0,_.t)(" to mark a column as a time column"))}):(0,C.tZ)(it.xJ,{label:H},(0,C.tZ)(f.Ph,{ariaLabel:H,value:null==S?void 0:S.column_name,onChange:N,allowClear:!0,autoFocus:!S,placeholder:(0,_.t)("%s column(s)",D.length),options:D.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,customLabel:(0,C.tZ)(ut.l,{column:e,showType:!0}),key:e.column_name})))}))),(0,C.tZ)(at.ZP.TabPane,{key:"sqlExpression",tab:(0,_.t)("Custom SQL")},(0,C.tZ)(st.iO,{value:(null==b?void 0:b.sqlExpression)||(null==S?void 0:S.column_name)||(null==E?void 0:E.expression),onFocus:U,showLoadingForImport:!0,onChange:O,width:"100%",height:w-80+"px",showGutter:!1,editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0,ref:R}))),(0,C.tZ)("div",null,(0,C.tZ)(be.Z,{buttonSize:"small",onClick:P,cta:!0},(0,_.t)("Close")),(0,C.tZ)(be.Z,{disabled:!q||!V,buttonStyle:"primary",buttonSize:"small",onClick:k,cta:!0},(0,_.t)("Save")),A))},br=(0,l.iK)(N.II)`
  border-radius: ${e=>{let{theme:t}=e;return t.borderRadius}};
  height: 26px;
  padding-left: ${e=>{let{theme:t}=e;return 2.5*t.gridUnit}}px;
`,yr=e=>{let{title:t,onChange:n,isEditDisabled:r,hasCustomLabel:a}=e;const[o,i]=(0,s.useState)(!1),[l,c]=(0,s.useState)(!1),d=(0,s.useCallback)((()=>{i(!0)}),[]),u=(0,s.useCallback)((()=>{i(!1)}),[]),p=(0,s.useCallback)((()=>{c(!0)}),[]),h=(0,s.useCallback)((()=>{c(!1)}),[]),m=(0,s.useCallback)((e=>{""===e.target.value&&n(e),h()}),[h,n]),g=(0,_.t)("My column");return r?(0,C.tZ)("span",null,t||g):l?(0,C.tZ)(br,{type:"text",placeholder:t,value:a?t:"",autoFocus:!0,onChange:n,onBlur:m}):(0,C.tZ)(ve.u,{placement:"top",title:(0,_.t)("Click to edit label")},(0,C.tZ)("span",{className:"AdhocMetricEditPopoverTitle inline-editable",onMouseOver:d,onMouseOut:u,onClick:p,onBlur:h,role:"button",tabIndex:0},t||g,"",(0,C.tZ)("i",{className:"fa fa-pencil",style:{color:o?"black":"grey"}})))},Er=(0,_.t)("My column"),Tr=e=>{let{columns:t,editedColumn:n,onColumnEdit:r,isControlledComponent:a,children:o,isTemporal:i,...l}=e;const c=(0,v.v9)((e=>e.explore.datasource)),[d,u]=(0,s.useState)(Er),[p,h]=(0,s.useState)(!1),[m,g]=(0,s.useState)(!0),[f,b]=(0,s.useState)(!1),[y,E]=(0,s.useState)(!1);let T=Er;n&&(0,ir.xN)(n)?T=n.verbose_name||n.column_name:n&&(0,or.GA)(n)&&(T=n.label||Er),(0,s.useEffect)((()=>{u(T)}),[T,p]);const S=(0,s.useCallback)((e=>{h(e)}),[]),Z=(0,s.useCallback)((()=>{h(!1)}),[]),{visible:x,handleTogglePopover:w,handleClosePopover:R}=a?{visible:l.visible,handleTogglePopover:l.togglePopover,handleClosePopover:l.closePopover}:{visible:p,handleTogglePopover:S,handleClosePopover:Z},I=(0,s.useCallback)((e=>{g("sqlExpression"!==e)}),[]),D=(0,s.useMemo)((()=>(0,C.tZ)(nt.b,null,(0,C.tZ)(_r,{editedColumn:n,columns:t,setDatasetModal:E,onClose:R,onChange:r,label:d,setLabel:u,getCurrentTab:I,isTemporal:i}))),[t,n,I,R,i,r,d]),O=(0,s.useCallback)((e=>{u(e.target.value),b(!0)}),[]),L=(0,s.useMemo)((()=>(0,C.tZ)(yr,{title:d,onChange:O,isEditDisabled:m,hasCustomLabel:f})),[f,m,O,d]);return(0,C.tZ)(s.Fragment,null,y&&(0,C.tZ)(Le.W,{visible:y,onHide:()=>E(!1),buttonTextOnSave:(0,_.t)("Save"),buttonTextOnOverwrite:(0,_.t)("Overwrite"),modalDescription:(0,_.t)("Save this query as a virtual dataset to continue exploring"),datasource:c}),(0,C.tZ)(A.Z,{trigger:"click",content:D,defaultVisible:x,visible:x,onVisibleChange:w,title:L,destroyTooltipOnHide:!0},o))},Sr=(0,sr.pO)((function(e){const{value:t,options:n,multi:r=!0,onChange:o,canDelete:i=!0,ghostButtonText:l,name:c,label:d,isTemporal:u}=e,[p,h]=(0,s.useState)(!1),m=(0,s.useMemo)((()=>{const e=Object.fromEntries(n.map((e=>[e.column_name,e])));return new mr(e,r,t)}),[r,n,t]),g=(0,s.useCallback)((e=>{const t=e.value;m.multi||ar()(m.values)?m.add(t.column_name):m.replace(0,t.column_name),o(m.getValues())}),[o,m]),f=(0,s.useCallback)((e=>{const t=e.value.column_name;return t in m.options&&!m.has(t)}),[m]),v=(0,s.useCallback)((e=>{m.del(e),o(m.getValues())}),[o,m]),b=(0,s.useCallback)(((e,t)=>{m.swap(e,t),o(m.getValues())}),[o,m]),y=(0,s.useCallback)((()=>m.values.map(((e,t)=>{const r=(0,or.GA)(e)&&e.datasourceWarning?(0,_.t)("This column might be incompatible with current dataset"):void 0;return(0,C.tZ)(Tr,{key:t,columns:n,onColumnEdit:e=>{(0,ir.xN)(e)?m.replace(t,e.column_name):m.replace(t,e),o(m.getValues())},editedColumn:e,isTemporal:u},(0,C.tZ)(pr,{key:t,index:t,clickClose:v,onShiftOptions:b,type:`${Ke.g.ColumnOption}_${c}_${d}`,canDelete:i,column:e,datasourceWarningMessage:r,withCaret:!0}))}))),[i,u,d,c,o,v,b,m,n]),E=(0,s.useCallback)((e=>{(0,ir.xN)(e)?m.add(e.column_name):m.add(e),o(m.getValues())}),[o,m]),T=(0,s.useCallback)((e=>{h(e)}),[]),S=(0,s.useCallback)((()=>{T(!1)}),[T]),Z=(0,s.useCallback)((()=>{T(!0)}),[T]),A=(0,s.useMemo)((()=>null!=l?l:(0,_.tn)("Drop a column here or click","Drop columns here or click",r?2:1)),[l,r]);return(0,C.tZ)("div",null,(0,C.tZ)(nr,a()({onDrop:g,canDrop:f,valuesRenderer:y,accept:Ke.g.Column,displayGhostButton:r||0===m.values.length,ghostButtonText:A,onClickGhostButton:Z},e)),(0,C.tZ)(Tr,{columns:n,onColumnEdit:E,isControlledComponent:!0,togglePopover:T,closePopover:S,visible:p,isTemporal:u},(0,C.tZ)("div",null)))}),Vt.Z);var Cr=n(68492),Zr=n(11146),Ar=n(96055),xr=n(28543),wr=n(7848);function Rr(e){let{adhocFilter:t,options:n,datasource:r,onFilterEdit:a,onShiftOptions:o,onClickClose:i,partitionColumn:s,index:l}=e;const{actualTimeRange:c,title:d}=(0,wr.w)(t);return(0,C.tZ)(Ar.Z,{key:l,adhocFilter:t,options:n,datasource:r,onFilterEdit:a,partitionColumn:s},(0,C.tZ)(pr,{key:l,index:l,label:null!=c?c:t.getDefaultLabel(),tooltipTitle:null!=d?d:t.getTooltipTitle(),clickClose:i,onShiftOptions:o,type:Ke.g.FilterOption,withCaret:!0,isExtra:t.isExtra,datasourceWarningMessage:t.datasourceWarning?(0,_.t)("This filter might be incompatible with current dataset"):void 0}))}var Ir=n(61314),Dr=n(61641);const{warning:Or}=dn.Z,Lr=[Ke.g.Column,Ke.g.Metric,Ke.g.MetricOption,Ke.g.AdhocMetricOption],Nr=e=>!(e instanceof xr.Z)&&(null==e?void 0:e.expressionType),Mr=(0,sr.pO)((e=>{var t;const{datasource:n,onChange:r=(()=>{}),name:o,canDelete:i}=e,l=Array.from(null!=(t=e.value)?t:[]),[c,d]=(0,s.useState)(l.map((e=>Nr(e)?new xr.Z(e):e))),[u,p]=(0,s.useState)(void 0),[h,m]=(0,s.useState)(!1),[g,f]=(0,s.useState)({}),v=(e,t)=>[...e,...[...(null==t?void 0:t.metrics)||[],null==t?void 0:t.metric].map((e=>e&&("string"==typeof e?{saved_metric_name:e}:new We.Z(e))))].filter((e=>e)).reduce(((e,t)=>("saved_metric_name"in t&&t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):"column_name"in t&&t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof We.Z&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>{var n,r;return null!=(n=null==(r=e.saved_metric_name||e.column_name||e.label)?void 0:r.localeCompare(t.saved_metric_name||t.column_name||t.label||""))?n:0})),[b,y]=(0,s.useState)(v(e.columns,e.formData));(0,s.useEffect)((()=>{if(n&&"table"===n.type){var e;const t=null==(e=n.database)?void 0:e.id,{datasource_name:r,schema:a,is_sqllab_view:o}=n;!o&&t&&r&&a&&he.Z.get({endpoint:`/api/v1/database/${t}/table_extra/${r}/${a}/`}).then((e=>{let{json:t}=e;if(null!=t&&t.partitions){const{partitions:e}=t;null!=e&&e.cols&&1===Object.keys(e.cols).length&&p(e.cols[0])}})).catch((e=>{Cr.Z.error("fetch extra_table_metadata:",e.statusText)}))}}),[n]),(0,s.useEffect)((()=>{y(v(e.columns,e.formData))}),[e.columns,e.formData]),(0,s.useEffect)((()=>{d((e.value||[]).map((e=>Nr(e)?new xr.Z(e):e)))}),[e.value]);const E=(0,s.useCallback)((e=>{const t=[...c];t.splice(e,1),d(t),r(t)}),[r,c]),T=(0,s.useCallback)((e=>{const t=null==i?void 0:i(c[e],c);"string"!=typeof t?E(e):Or({title:(0,_.t)("Warning"),content:t})}),[i,E,c]),S=(0,s.useCallback)(((e,t)=>{const n=[...c];[n[t],n[e]]=[n[e],n[t]],d(n)}),[c]),Z=(0,s.useCallback)((t=>{var n;return null==(n=e.savedMetrics.find((e=>e.metric_name===t)))?void 0:n.expression}),[e.savedMetrics]),A=(0,s.useCallback)((e=>{if(e instanceof xr.Z)return e;const t=e;return t.saved_metric_name?new xr.Z({expressionType:Dr.v.SQL,subject:Z(t.saved_metric_name),operator:dt.LT[dt.d.GREATER_THAN].operation,operatorId:dt.d.GREATER_THAN,comparator:0,clause:Dr.P.HAVING}):t.label?new xr.Z({expressionType:Dr.v.SQL,subject:new We.Z(e).translateToSql(),operator:dt.LT[dt.d.GREATER_THAN].operation,operatorId:dt.d.GREATER_THAN,comparator:0,clause:Dr.P.HAVING}):t.column_name?new xr.Z({expressionType:Dr.v.SIMPLE,subject:t.column_name,operator:dt.LT[dt.d.EQUALS].operation,operatorId:dt.d.EQUALS,comparator:"",clause:Dr.P.WHERE,isNew:!0}):null}),[n.type,Z]),x=(0,s.useCallback)((e=>{r(c.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}),[r,c]),w=(0,s.useCallback)((e=>{const t=A(e);if(t){const e=[...c,t];d(e),r(e)}}),[A,r,c]),R=(0,s.useCallback)((e=>{m(e)}),[]),I=(0,s.useCallback)((()=>{R(!1)}),[R]),D=(0,s.useCallback)((()=>c.map(((e,t)=>(0,C.tZ)(Rr,{index:t,adhocFilter:e,options:b,datasource:n,onFilterEdit:x,partitionColumn:u,onClickClose:T,onShiftOptions:S})))),[T,x,S,b,u,n,c]),O=(0,s.useCallback)((()=>{f({}),R(!0)}),[R]),L=(0,Ir.Ct)(),N=(0,s.useMemo)((()=>{if(null==(t=g)?void 0:t.metric_name)return new xr.Z({expressionType:Dr.v.SQL,clause:Dr.P.HAVING,sqlExpression:null==g?void 0:g.expression});var t;if(g instanceof We.Z)return new xr.Z({expressionType:Dr.v.SQL,clause:Dr.P.HAVING,sqlExpression:null==g?void 0:g.translateToSql()});const n={subject:null==g?void 0:g.column_name};return n.subject&&(n.operator=dt.LT[dt.d.IN].operation,n.operatorId=dt.d.IN),Zr.O6&&(0,ir.xN)(g)&&(0,me.x)(null==g?void 0:g.column_name,e.datasource)&&(n.operator=dt.d.TEMPORAL_RANGE,n.operatorId=dt.d.TEMPORAL_RANGE,n.comparator=L),new xr.Z(n)}),[g]),M=(0,s.useCallback)((()=>!0),[]),k=(0,s.useCallback)((e=>{f(e.value),R(!0)}),[o,R]);return(0,C.tZ)(s.Fragment,null,(0,C.tZ)(nr,a()({onDrop:k,canDrop:M,valuesRenderer:D,accept:Lr,ghostButtonText:(0,_.t)("Drop columns/metrics here or click"),onClickGhostButton:O},e)),(0,C.tZ)(Ar.Z,{adhocFilter:N,options:b,datasource:n,onFilterEdit:w,partitionColumn:u,isControlledComponent:!0,visible:h,togglePopover:R,closePopover:I,requireSave:!!g}))}),En.Z);var kr=n(62446),Pr=n(88889);const Fr={},Ur=[Ke.g.Column,Ke.g.Metric],$r=(e,t,n)=>e?(0,Qe.Z)(e).filter((e=>(0,kr.AG)(e)?t.some((t=>t.metric_name===e)):!(0,kr.nX)(e)||n.some((t=>t.column_name===e.column.column_name)))).map((e=>{if(!(t=e)||t instanceof We.Z||"string"==typeof t||!t.expressionType)return e;var t;if((0,kr.nX)(e)){const t=n.find((t=>t.column_name===e.column.column_name));if(t)return new We.Z({...e,column:t})}return new We.Z(e)})):[],qr=(e,t,n)=>{var r;return null!=(r=null==e?void 0:e.filter((e=>{var r;return Array.isArray(t)?!h()(t).call(t,null!=(r=e.metric_name)?r:"")||e.metric_name===n:e})))?r:[]},Vr=(0,sr.pO)((e=>{const{onChange:t,multi:n}=e,r=(0,s.useCallback)((e=>{if(null===e)return void t(null);const r=(0,Qe.Z)(e).map((e=>e.metric_name?e.metric_name:e)).filter((e=>e));t(n?r:r[0])}),[n,t]),[o,i]=(0,s.useState)($r(e.value,e.savedMetrics,e.columns)),[l,c]=(0,s.useState)({}),[d,u]=(0,s.useState)(!1);(0,s.useEffect)((()=>{i($r(e.value,e.savedMetrics,e.columns))}),[JSON.stringify(e.value),JSON.stringify(e.savedMetrics),JSON.stringify(e.columns)]);const p=(0,s.useCallback)((e=>!("metric"===e.type&&h()(o).call(o,e.value.metric_name))),[o]),m=(0,s.useCallback)((t=>{const n=e.multi?[...o,t]:[t];i(n),r(n)}),[r,e.multi,o]),g=(0,s.useCallback)(((e,t)=>{if(t instanceof We.Z&&t.equals(e))return;const n=o.map((n=>("metric_name"in t&&n===t.metric_name||void 0!==n.optionName)&&n.optionName===t.optionName?e:n));i(n),r(n)}),[r,o]),f=(0,s.useCallback)((e=>{if(!Array.isArray(o))return;const t=[...o];t.splice(e,1),i(t),r(t)}),[r,o]),v=(0,s.useCallback)(((e,t)=>{const n=[...o];[n[t],n[e]]=[n[e],n[t]],i(n)}),[o]),b=(0,s.useMemo)((()=>qr(e.savedMetrics,e.value)),[e.savedMetrics,e.value]),y=(0,s.useCallback)((t=>{var n;return qr(e.savedMetrics,e.value,null==(n=e.value)?void 0:n[t])}),[e.savedMetrics,e.value]),E=(0,s.useCallback)((()=>t(n?o:o[0])),[n,t,o]),T=(0,s.useCallback)(((t,r)=>(0,C.tZ)(St,{key:r,index:r,option:t,onMetricEdit:g,onRemoveMetric:f,columns:e.columns,savedMetrics:e.savedMetrics,savedMetricsOptions:y(r),datasource:e.datasource,onMoveLabel:v,onDropLabel:E,type:`${Ke.g.AdhocMetricOption}_${e.name}_${e.label}`,multi:n,datasourceWarningMessage:t instanceof We.Z&&t.datasourceWarning?(0,_.t)("This metric might be incompatible with current dataset"):void 0})),[y,E,v,n,g,f,e.columns,e.datasource,e.label,e.name,e.savedMetrics]),S=(0,s.useCallback)((()=>o.map(((e,t)=>T(e,t)))),[o,T]),Z=(0,s.useCallback)((e=>{u(e)}),[]),A=(0,s.useCallback)((()=>{Z(!1)}),[Z]),x=(0,s.useCallback)((e=>{e.type===Ke.g.Metric&&m(e.value),e.type===Ke.g.Column&&(c(e),Z(!0))}),[m,Z]),w=(0,s.useCallback)((()=>{c({}),Z(!0)}),[Z]),R=(0,s.useMemo)((()=>{if((null==(e=l)?void 0:e.value)&&(null==e?void 0:e.type)&&l.type===Ke.g.Column){const e=l.value,t={column:e};return e.type_generic===Pr.Z.NUMERIC?t.aggregate=dt.YY.SUM:e.type_generic!==Pr.Z.STRING&&e.type_generic!==Pr.Z.BOOLEAN&&e.type_generic!==Pr.Z.TEMPORAL||(t.aggregate=dt.YY.COUNT_DISTINCT),new We.Z(t)}var e;return new We.Z({})}),[l]),I=(0,_.tn)("Drop a column/metric here or click","Drop columns/metrics here or click",n?2:1);return(0,C.tZ)("div",{className:"metrics-select"},(0,C.tZ)(nr,a()({onDrop:x,canDrop:p,valuesRenderer:S,accept:Ur,ghostButtonText:I,displayGhostButton:n||0===o.length,onClickGhostButton:w},e)),(0,C.tZ)(_t,{adhocMetric:R,onMetricEdit:m,columns:e.columns,savedMetricsOptions:b,savedMetric:Fr,datasource:e.datasource,isControlledComponent:!0,visible:d,togglePopover:Z,closePopover:A,isNew:!0},(0,C.tZ)("div",null)))}),Dt),jr={AnnotationLayerControl:D,BoundsControl:$,CheckboxControl:q.Z,CollectionControl:ee,ColorPickerControl:le,ColorSchemeControl:ce.Z,DatasourceControl:je,DateFilterControl:He.ZP,DndColumnSelectControl:nr,DndColumnSelect:Sr,DndFilterSelect:Mr,DndMetricSelect:Vr,FixedOrMetricControl:Pt,HiddenControl:function(e){return(0,C.tZ)(N.II,{type:"hidden",value:e.value})},SelectAsyncControl:qt,SelectControl:Vt.Z,SliderControl:function(e){let{default:t,name:n,label:r,description:o,renderTrigger:i,rightNode:l,leftNode:c,validationErrors:d,hovered:u,warning:p,danger:h,onClick:m,tooltipOnClick:g,onChange:f=(()=>{}),...v}=e;const _={name:n,label:r,description:o,renderTrigger:i,rightNode:l,leftNode:c,validationErrors:d,onClick:m,hovered:u,tooltipOnClick:g,warning:p,danger:h};return(0,C.tZ)(s.Fragment,null,(0,C.tZ)(M.Z,_),(0,C.tZ)(Bt,a()({},v,{onChange:f,defaultValue:t})))},SpatialControl:zt.Z,TextAreaControl:Gt.Z,TextControl:Ge.Z,TimeSeriesColumnControl:nn,ViewportControl:sn,VizTypeControl:e=>{let{value:t,onChange:n=ct.EI,isModalOpenInit:r}=e;const[a,o]=(0,s.useState)(!!r),[i,l]=(0,s.useState)(0),[c,d]=(0,s.useState)(t),u=(0,s.useCallback)((()=>{o(!0)}),[]),p=(0,s.useCallback)((()=>{n(c),o(!1)}),[c,n]),h=(0,s.useCallback)((()=>{o(!1),l((e=>e+1)),d(t)}),[t]);return(0,C.tZ)(s.Fragment,null,(0,C.tZ)("div",{css:e=>C.iv`
          min-width: ${72*e.gridUnit}px;
          max-width: fit-content;
        `},(0,C.tZ)(fn,{onChange:n,currentSelection:t}),t&&(0,C.tZ)(bn,{vizType:t})),(0,C.tZ)("div",{css:e=>C.iv`
          display: flex;
          justify-content: flex-end;
          margin-top: ${3*e.gridUnit}px;
          color: ${e.colors.grayscale.base};
          text-decoration: underline;
        `},(0,C.tZ)("span",{role:"button",tabIndex:0,onClick:u},(0,_.t)("View all charts"))),(0,C.tZ)(yn,{show:a,onHide:h,title:(0,_.t)("Select a visualization type"),primaryButtonName:(0,_.t)("Select"),disablePrimaryButton:!c,onHandledPrimaryAction:p,maxWidth:`${pn.UB}px`,responsive:!0},(0,C.tZ)(pn.ZP,{key:i,selectedViz:c,onChange:d,onDoubleClick:p,denyList:vn})))},MetricsControl:Dt,AdhocFilterControl:En.Z,FilterBoxItemControl:In,ConditionalFormattingControl:e=>{let{value:t,onChange:n,columnOptions:r,verboseMap:a,removeIrrelevantConditions:o,...i}=e;const c=(0,l.Fg)(),[d,u]=(0,s.useState)(null!=t?t:[]);return(0,s.useEffect)((()=>{n&&n(d)}),[d,n]),(0,s.useEffect)((()=>{if(o){const e=d.filter((e=>r.some((t=>(null==t?void 0:t.value)===(null==e?void 0:e.column)))));e.length!==d.length&&o&&u(e)}}),[d,r,o]),(0,C.tZ)("div",null,(0,C.tZ)(M.Z,i),(0,C.tZ)(Jn,null,d.map(((e,t)=>(0,C.tZ)(Xn,{key:t},(0,C.tZ)(er,{onClick:()=>(e=>{u((t=>t.filter(((t,n)=>n!==e))))})(t)},(0,C.tZ)(B.Z.XSmall,{iconColor:c.colors.grayscale.light1})),(0,C.tZ)(Wn,{title:(0,_.t)("Edit formatter"),config:e,columns:r,onChange:e=>((e,t)=>{const n=[...d];n.splice(t,1,e),u(n)})(e,t),destroyTooltipOnHide:!0},(0,C.tZ)(z.EQ,{withCaret:!0},(0,C.tZ)(z.__,null,(e=>{var t;let{column:n,operator:r,targetValue:o,targetValueLeft:i,targetValueRight:s}=e;const l=null!=(t=n&&(null==a?void 0:a[n]))?t:n;switch(r){case Dn.NONE:return`${l}`;case Dn.BETWEEN:return`${i} ${Dn.LESS_THAN} ${l} ${Dn.LESS_THAN} ${s}`;case Dn.BETWEEN_OR_EQUAL:return`${i} ${Dn.LESS_OR_EQUAL} ${l} ${Dn.LESS_OR_EQUAL} ${s}`;case Dn.BETWEEN_OR_LEFT_EQUAL:return`${i} ${Dn.LESS_OR_EQUAL} ${l} ${Dn.LESS_THAN} ${s}`;case Dn.BETWEEN_OR_RIGHT_EQUAL:return`${i} ${Dn.LESS_THAN} ${l} ${Dn.LESS_OR_EQUAL} ${s}`;default:return`${l} ${r} ${o}`}})(e)),(0,C.tZ)(z.Ne,null,(0,C.tZ)(B.Z.CaretRight,{iconColor:c.colors.grayscale.light1}))))))),(0,C.tZ)(Wn,{title:(0,_.t)("Add new formatter"),columns:r,onChange:e=>{u((t=>[...t,e]))},destroyTooltipOnHide:!0},(0,C.tZ)(z.SW,null,(0,C.tZ)(B.Z.PlusSmall,{iconColor:c.colors.grayscale.light1}),(0,_.t)("Add new color formatter")))))},XAxisSortControl:function(e){const[t,n]=(0,s.useState)(e.value);return(0,s.useEffect)((()=>{e.shouldReset&&(e.onChange(void 0),n(null))}),[e.shouldReset,e.value]),(0,C.tZ)(Vt.Z,a()({},e,{value:t}))},...u.Z},Hr=jr,Br=l.iK.div`
  padding-bottom: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`;function zr(e){const{actions:{setControlValue:t},name:n,type:r,hidden:o,isVisible:l,resetOnHide:u=!0}=e,[p,h]=(0,s.useState)(!1),m=(0,c.D)(l),g=(0,s.useCallback)(((e,r)=>t(n,e,r)),[n,t]);if((0,s.useEffect)((()=>{!0===m&&!1===l&&void 0!==e.default&&!i()(e.value,e.default)&&u&&(null==t||t(n,e.default))}),[n,m,l,t,e.value,e.default]),!r||!1===l)return null;const f="string"==typeof r?Hr[r]:r;return f?(0,C.tZ)(Br,{className:"Control",style:o?{display:"none"}:void 0,onMouseEnter:()=>h(!0),onMouseLeave:()=>h(!1)},(0,C.tZ)(d.Z,null,(0,C.tZ)(f,a()({onChange:g,hovered:p},e)))):(console.warn(`Unknown controlType: ${r}`),null)}},82342:(e,t,n)=>{"use strict";n.d(t,{Z:()=>p});var r=n(67294),a=n(11965),o=n(51995),i=n(55867),s=n(9882),l=n(58593),c=n(49238),d=n(70163);const u=a.iv`
  &.anticon {
    font-size: unset;
    .anticon {
      line-height: unset;
      vertical-align: unset;
    }
  }
`,p=e=>{let{name:t,label:n,description:p,validationErrors:h=[],renderTrigger:m=!1,rightNode:g,leftNode:f,onClick:v,hovered:_=!1,tooltipOnClick:b=(()=>{}),warning:y,danger:E}=e;const{gridUnit:T,colors:S}=(0,o.Fg)(),C=(0,r.useRef)(!1),Z=(0,r.useMemo)((()=>(h.length||(C.current=!0),C.current?h.length?S.error.base:"unset":S.alert.base)),[S.error.base,S.alert.base,h.length]);return n?(0,a.tZ)("div",{className:"ControlHeader"},(0,a.tZ)("div",{className:"pull-left"},(0,a.tZ)(c.lX,{css:e=>a.iv`
            margin-bottom: ${.5*e.gridUnit}px;
            position: relative;
          `},f&&(0,a.tZ)("span",null,f),(0,a.tZ)("span",{role:"button",tabIndex:0,onClick:v,style:{cursor:v?"pointer":""}},n)," ",y&&(0,a.tZ)("span",null,(0,a.tZ)(l.u,{id:"error-tooltip",placement:"top",title:y},(0,a.tZ)(d.Z.AlertSolid,{iconColor:S.alert.base,iconSize:"s"}))," "),E&&(0,a.tZ)("span",null,(0,a.tZ)(l.u,{id:"error-tooltip",placement:"top",title:E},(0,a.tZ)(d.Z.ErrorSolid,{iconColor:S.error.base,iconSize:"s"}))," "),(null==h?void 0:h.length)>0&&(0,a.tZ)("span",null,(0,a.tZ)(l.u,{id:"error-tooltip",placement:"top",title:null==h?void 0:h.join(" ")},(0,a.tZ)(d.Z.ExclamationCircleOutlined,{css:a.iv`
                    ${u}
                    color: ${Z};
                  `}))," "),_?(0,a.tZ)("span",{css:()=>a.iv`
          position: absolute;
          top: 50%;
          right: 0;
          padding-left: ${T}px;
          transform: translate(100%, -50%);
          white-space: nowrap;
        `},p&&(0,a.tZ)("span",null,(0,a.tZ)(l.u,{id:"description-tooltip",title:p,placement:"top"},(0,a.tZ)(d.Z.InfoCircleOutlined,{css:u,onClick:b}))," "),m&&(0,a.tZ)("span",null,(0,a.tZ)(s.V,{label:(0,i.t)("bolt"),tooltip:(0,i.t)("Changing this control takes effect instantly"),placement:"top",icon:"bolt"})," ")):null)),g&&(0,a.tZ)("div",{className:"pull-right"},g),(0,a.tZ)("div",{className:"clearfix"})):null}},61357:(e,t,n)=>{"use strict";n.d(t,{Z:()=>o});var r=n(67294),a=n(11965);function o(e){let{controls:t}=e;const n=(0,r.useCallback)((e=>"HiddenControl"===(null==e?void 0:e.props.type)||!1===(null==e?void 0:e.props.isVisible)),[]),o=t.filter((e=>!n(e))),i=o.length?12/o.length:12;return(0,a.tZ)("div",{className:"row"},t.map(((e,t)=>(0,a.tZ)("div",{className:`col-lg-${i} col-xs-12`,style:{display:n(e)?"none":"block"},key:t},e))))}},50909:(e,t,n)=>{"use strict";n.d(t,{C4:()=>k,HS:()=>R,_q:()=>F,m:()=>w,qi:()=>x,uy:()=>I});var r=n(11965),a=n(78580),o=n.n(a),i=n(67294),s=n(51995),l=n(55867),c=n(51115),d=n(42846),u=n(88889),p=n(32103),h=n(23279),m=n.n(h),g=n(4715),f=n(9875),v=n(27600),_=n(87183),b=n(70163),y=n(35932),E=n(99299),T=n(54076),S=n(13433),C=n(89555),Z=n(61587);const A=(0,s.iK)("span")`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
`,x=(0,s.iK)(y.Z)`
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;

  // needed to override button's first-of-type margin: 0
  && {
    margin: 0 ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  }

  i {
    padding: 0 ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`,w=e=>{let{data:t,columns:n}=e;const a=(0,s.Fg)();return(0,r.tZ)(S.Z,{text:t&&n?(0,T.Mv)(t,n):"",wrapped:!1,copyNode:(0,r.tZ)(b.Z.CopyOutlined,{iconColor:a.colors.grayscale.base,iconSize:"l","aria-label":(0,l.t)("Copy"),role:"button",css:r.iv`
            &.anticon > * {
              line-height: 0;
            }
          `})})},R=e=>{let{onChangeHandler:t}=e;const n=(0,s.Fg)(),a=m()(t,v.M$);return(0,r.tZ)(f.II,{prefix:(0,r.tZ)(b.Z.Search,{iconColor:n.colors.grayscale.base}),placeholder:(0,l.t)("Search"),onChange:e=>{const t=e.target.value;a(t)},css:r.iv`
        width: 200px;
        margin-right: ${2*n.gridUnit}px;
      `})},I=e=>{var t;let{data:n,loading:a}=e;return(0,r.tZ)(C.Z,{rowcount:null!=(t=null==n?void 0:n.length)?t:0,loading:a})};var D;!function(e){e.Formatted="formatted",e.Original="original"}(D||(D={}));const O=e=>{let{onChange:t,value:n}=e;return(0,r.tZ)(_.Y.Group,{value:n,onChange:t},(0,r.tZ)(g.T,{direction:"vertical"},(0,r.tZ)(_.Y,{value:D.Formatted},(0,l.t)("Formatted date")),(0,r.tZ)(_.Y,{value:D.Original},(0,l.t)("Original value"))))},L=s.iK.div`
  display: flex;
  flex-direction: column;

  padding: ${e=>{let{theme:t}=e;return 4*t.gridUnit+"px"}};
`,N=s.iK.span`
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
  margin-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  text-transform: uppercase;
`,M=e=>{let{columnName:t,onTimeColumnChange:n,datasourceId:a,isOriginalTimeColumn:o}=e;const c=(0,s.Fg)(),d=e=>{n(t,e.target.value)},u=(0,i.useMemo)((()=>a?(0,r.tZ)(L,{onClick:e=>e.stopPropagation()},(0,r.tZ)(r.xB,{styles:r.iv`
              .column-formatting-popover .ant-popover-inner-content {
                padding: 0;
              }
            `}),(0,r.tZ)(N,null,(0,l.t)("Column Formatting")),(0,r.tZ)(O,{onChange:d,value:o?D.Original:D.Formatted})):null),[a,o]);return a?(0,r.tZ)("span",null,(0,r.tZ)(E.Z,{overlayClassName:"column-formatting-popover",trigger:"click",content:u,placement:"bottomLeft",arrowPointAtCenter:!0},(0,r.tZ)(b.Z.SettingOutlined,{iconSize:"m",iconColor:c.colors.grayscale.light1,css:(0,r.iv)({marginRight:`${c.gridUnit}px`},"",""),onClick:e=>e.stopPropagation()})),t):(0,r.tZ)("span",null,t)},k=(e,t)=>{const n=(0,i.useMemo)((()=>{var e;return null!=(e=null==t?void 0:t.map((e=>Object.values(e).map((e=>e?e.toString().toLowerCase():(0,l.t)("N/A"))))))?e:[]}),[t]);return(0,i.useMemo)((()=>null!=t&&t.length?t.filter(((t,r)=>n[r].some((t=>null==t?void 0:o()(t).call(t,e.toLowerCase()))))):[]),[t,e,n])},P=(0,c.bt)(d.Z.DATABASE_DATETIME),F=(e,t,n,a,s,l,c)=>{const[d,h]=(0,i.useState)((0,Z.W)(a)),m=(e,t)=>{if(a)if(t!==D.Original||o()(d).call(d,e)){if(t===D.Formatted&&o()(d).call(d,e)){const t=(0,Z.W)(a);t.splice(t.indexOf(e),1),(0,Z.e)(a,t),h(t)}}else{const t=(0,Z.W)(a);t.push(e),(0,Z.e)(a,t),h(t)}};return(0,i.useEffect)((()=>{s&&h((0,Z.W)(a))}),[a,s]),(0,i.useMemo)((()=>e&&null!=n&&n.length?e.filter((e=>{var t;return o()(t=Object.keys(n[0])).call(t,e)})).map(((e,i)=>{const s=null==t?void 0:t[i],h=n[0][e],g=s===u.Z.TEMPORAL?d.indexOf(e):-1,f=o()(d).call(d,e);return{id:e||i,accessor:t=>t[e],Header:s===u.Z.TEMPORAL&&"string"!=typeof h?(0,r.tZ)(M,{columnName:e,datasourceId:a,onTimeColumnChange:m,isOriginalTimeColumn:f}):e,Cell:e=>{let{value:t}=e;return!0===t?v.Ly:!1===t?v.gz:null===t?(0,r.tZ)(A,null,v.Wq):s===u.Z.TEMPORAL&&-1===g&&"number"==typeof t?P(t):"string"==typeof t&&c?(0,p.Ul)(t):String(t)},...null==l?void 0:l[e]}})):[]),[e,n,t,a,l,d])}},61587:(e,t,n)=>{"use strict";n.d(t,{W:()=>o,e:()=>i});var r=n(55786),a=n(61337);const o=e=>{const t=(0,a.rV)(a.dR.explore__data_table_original_formatted_time_columns,{});return void 0===e?[]:(0,r.Z)(t[e])},i=(e,t)=>{const n=(0,a.rV)(a.dR.explore__data_table_original_formatted_time_columns,{});(0,a.LS)(a.dR.explore__data_table_original_formatted_time_columns,{...n,[e]:t})}},42753:(e,t,n)=>{"use strict";var r;n.d(t,{g:()=>r}),function(e){e.Column="column",e.ColumnOption="columnOption",e.AdhocColumnOption="adhocColumn",e.Metric="metric",e.MetricOption="metricOption",e.AdhocMetricOption="adhocMetric",e.FilterOption="filterOption"}(r||(r={}))},63325:(e,t,n)=>{"use strict";n.d(t,{b:()=>r});const r=n(51995).iK.div`
  .edit-popover-resize {
    transform: scaleX(-1);
    float: right;
    margin-top: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
    margin-right: ${e=>{let{theme:t}=e;return-2*t.gridUnit}}px;
    cursor: nwse-resize;
  }
  .filter-sql-editor {
    border: ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}} solid thin;
  }
`},89555:(e,t,n)=>{"use strict";n.d(t,{Z:()=>l}),n(67294);var r=n(67190),a=n(55867),o=n(37921),i=n(58593),s=n(11965);function l(e){const{rowcount:t=0,limit:n,loading:l}=e,c=t===n,d=c||0===t&&!l?"danger":"default",u=(0,r.JB)()(t),p=(0,s.tZ)(o.Z,{type:d},l?(0,a.t)("Loading..."):(0,s.tZ)("span",null,(0,a.tn)("%s row","%s rows",t,u)));return c?(0,s.tZ)(i.u,{id:"tt-rowcount-tooltip",title:(0,s.tZ)("span",null,(0,a.t)("Limit reached"))},p):p}},76787:(e,t,n)=>{"use strict";n.d(t,{Z:()=>T});var r=n(5872),a=n.n(r),o=n(23560),i=n.n(o),s=n(78580),l=n.n(s),c=n(67294),d=n(51995),u=n(55867),p=n(4715),h=n(82342),m=n(58593),g=n(70163),f=n(11965);function v(e){const{id:t,label:n,colors:r}=e,[a,o]=(0,c.useState)(!1),i=(0,c.useRef)(null),s=(0,c.useRef)(null),l=()=>r.map(((e,n)=>(0,f.tZ)("span",{key:`${t}-${n}`,css:t=>f.iv`
          padding-left: ${t.gridUnit/2}px;
          :before {
            content: '';
            display: inline-block;
            background-color: ${e};
            border: 1px solid ${"white"===e?"black":e};
            width: 9px;
            height: 10px;
          }
        `})));return(0,f.tZ)(m.u,{"data-testid":"tooltip",overlayClassName:"color-scheme-tooltip",title:()=>(0,f.tZ)(c.Fragment,null,(0,f.tZ)("span",null,n),(0,f.tZ)("div",null,l())),key:t,visible:a},(0,f.tZ)("span",{className:"color-scheme-option",onMouseEnter:()=>{const e=i.current,t=s.current;e&&t&&(e.scrollWidth>e.offsetWidth||e.scrollHeight>e.offsetHeight||t.scrollWidth>t.offsetWidth||t.scrollHeight>t.offsetHeight)&&o(!0)},onMouseLeave:()=>{o(!1)},css:f.iv`
          display: flex;
          align-items: center;
          justify-content: flex-start;
        `},(0,f.tZ)("span",{className:"color-scheme-label",ref:i,css:e=>f.iv`
            min-width: 125px;
            padding-right: ${2*e.gridUnit}px;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
          `},n),(0,f.tZ)("span",{ref:s,css:e=>f.iv`
            flex: 100%;
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
            padding-right: ${e.gridUnit}px;
          `},l())))}const _=(0,d.iK)(g.Z.AlertSolid)`
  color: ${e=>{let{theme:t}=e;return t.colors.alert.base}};
`,b=(0,u.t)("This color scheme is being overridden by custom label colors.\n    Check the JSON metadata in the Advanced settings"),y=(0,u.t)("The color scheme is determined by the related dashboard.\n        Edit the color scheme in the dashboard properties."),E=e=>{let{label:t,hasCustomLabelColors:n,dashboardId:r}=e;if(n||r){const e=n?b:y;return(0,f.tZ)(c.Fragment,null,t," ",(0,f.tZ)(m.u,{title:e},(0,f.tZ)(_,{iconSize:"s"})))}return(0,f.tZ)(c.Fragment,null,t)},T=e=>{let{hasCustomLabelColors:t=!1,dashboardId:n,label:r=(0,u.t)("Color scheme"),name:o,onChange:s=(()=>{}),value:d,clearable:g=!1,defaultScheme:_,choices:b=[],schemes:T={},isLinear:S,...C}=e;const Z=(0,c.useMemo)((()=>{if(n)return"dashboard";let e=d||_;if("SUPERSET_DEFAULT"===e){var t;const n=i()(T)?T():T;e=null==n||null==(t=n.SUPERSET_DEFAULT)?void 0:t.id}return e}),[n,_,T,d]),A=(0,c.useMemo)((()=>{if(n)return[{value:"dashboard",label:(0,u.t)("dashboard"),customLabel:(0,f.tZ)(m.u,{title:y},(0,u.t)("Dashboard scheme"))}];const e=i()(T)?T():T,t=i()(b)?b():b,r=[];return t.filter((e=>{const t=e[0],n="SUPERSET_DEFAULT"!==t&&!l()(r).call(r,t);return r.push(t),n})).map((t=>{var n;let[r]=t;const a=e[r];let o=[];return a&&(o=S?a.getColors(10):a.colors),{customLabel:(0,f.tZ)(v,{id:a.id,label:a.label,colors:o}),label:(null==e||null==(n=e[r])?void 0:n.label)||r,value:r}}))}),[b,n,S,T]);return(0,f.tZ)(p.Ph,{header:(0,f.tZ)(h.Z,a()({},C,{label:(0,f.tZ)(E,{label:r,hasCustomLabelColors:t,dashboardId:n})})),ariaLabel:(0,u.t)("Select color scheme"),allowClear:g,disabled:!!n,name:`select-${o}`,onChange:e=>s(e),options:A,placeholder:(0,u.t)("Select scheme"),value:Z})}},27845:(e,t,n)=>{"use strict";n.d(t,{Z:()=>d,j:()=>l});var r=n(5872),a=n.n(r),o=n(67294),i=n(99299),s=n(11965);const l=()=>{var e;return null==(e=document.getElementById("controlSections"))?void 0:e.lastElementChild},c=e=>{var t,n;const r=null==(t=window)?void 0:t.innerHeight,a=null==e||null==(n=e.getBoundingClientRect())?void 0:n.top;return r&&a?a/r:0},d=e=>{let{getPopupContainer:t,getVisibilityRatio:n=c,visible:r,destroyTooltipOnHide:d=!1,...u}=e;const p=(0,o.useRef)(),[h,m]=(0,o.useState)(void 0===r?u.defaultVisible:r),[g,f]=o.useState("right"),v=(0,o.useCallback)((()=>{const e=n(p.current);f(e<.35&&"rightTop"!==g?"rightTop":e>.65&&"rightBottom"!==g?"rightBottom":"right")}),[n]),_=(0,o.useCallback)((e=>{const t=l();t&&t.style.setProperty("overflow-y",e?"hidden":"auto","important")}),[v]),b=(0,o.useCallback)((e=>(p.current=e,(null==t?void 0:t(e))||document.body)),[v,t]),y=(0,o.useCallback)((e=>{void 0===e&&_(e),m(!!e),null==u.onVisibleChange||u.onVisibleChange(!!e)}),[u,_]),E=(0,o.useCallback)((e=>{"Escape"===e.key&&(m(!1),null==u.onVisibleChange||u.onVisibleChange(!1))}),[u]);return(0,o.useEffect)((()=>{void 0!==r&&m(!!r)}),[r]),(0,o.useEffect)((()=>{void 0!==h&&_(h)}),[h,_]),(0,o.useEffect)((()=>(h&&document.addEventListener("keydown",E),()=>{document.removeEventListener("keydown",E)})),[E,h]),(0,o.useEffect)((()=>{h&&v()}),[h,v]),(0,s.tZ)(i.Z,a()({},u,{visible:h,arrowPointAtCenter:!0,placement:g,onVisibleChange:y,getPopupContainer:b,destroyTooltipOnHide:d}))}},74092:(e,t,n)=>{"use strict";n.d(t,{Z:()=>Y});var r=n(67294),a=n(51995),o=n(11965),i=n(3297),s=n(5364),l=n(55867),c=n(35932),d=n(82342),u=n(74069),p=n(4715),h=n(70163),m=n(81315),g=n(58593),f=n(12515),v=n(27600),_=n(54076),b=n(27845),y=n(61314),E=n(87183);function T(e){let t="Last week";return y.bk.has(e.value)?t=e.value:e.onChange(t),(0,o.tZ)(r.Fragment,null,(0,o.tZ)("div",{className:"section-title"},(0,l.t)("Configure Time Range: Last...")),(0,o.tZ)(E.Y.Group,{value:t,onChange:t=>e.onChange(t.target.value)},y.Sm.map((e=>{let{value:t,label:n}=e;return(0,o.tZ)(E.Y,{key:t,value:t,className:"vertical-radio"},n)}))))}var S=n(31209);function C(e){let{onChange:t,value:n}=e;return(0,r.useEffect)((()=>{y.LY.has(n)||t(S.gT)}),[t,n]),y.LY.has(n)?(0,o.tZ)(r.Fragment,null,(0,o.tZ)("div",{className:"section-title"},(0,l.t)("Configure Time Range: Previous...")),(0,o.tZ)(E.Y.Group,{value:n,onChange:e=>t(e.target.value)},y._S.map((e=>{let{value:t,label:n}=e;return(0,o.tZ)(E.Y,{key:t,value:t,className:"vertical-radio"},n)})))):null}var Z=n(93754),A=n.n(Z),x=n(28216),w=n(58146),R=n(9875),I=n(62276),D=n(9882);function O(e){var t;const{customRange:n,matchedFlag:r}=(0,y.c_)(e.value);r||e.onChange((0,y.jK)(n));const{sinceDatetime:a,sinceMode:i,sinceGrain:s,sinceGrainValue:c,untilDatetime:d,untilMode:u,untilGrain:h,untilGrainValue:g,anchorValue:f,anchorMode:v}={...n};function _(t,r){e.onChange((0,y.jK)({...n,[t]:r}))}function b(t,r){A()(r)&&r>0&&e.onChange((0,y.jK)({...n,[t]:r}))}const T=(0,x.v9)((e=>{var t;return null==e||null==(t=e.common)?void 0:t.locale})),S=null==(t=w.locales[y.ZU[T]])?void 0:t.DatePicker;return(0,o.tZ)("div",null,(0,o.tZ)("div",{className:"section-title"},(0,l.t)("Configure custom time range")),(0,o.tZ)(p.X2,{gutter:24},(0,o.tZ)(p.JX,{span:12},(0,o.tZ)("div",{className:"control-label"},(0,l.t)("START (INCLUSIVE)")," ",(0,o.tZ)(D.V,{tooltip:(0,l.t)("Start date included in time range"),placement:"right"})),(0,o.tZ)(m.Z,{ariaLabel:(0,l.t)("START (INCLUSIVE)"),options:y._d,value:i,onChange:e=>_("sinceMode",e)}),"specific"===i&&(0,o.tZ)(p.X2,null,(0,o.tZ)(I.M,{showTime:!0,defaultValue:(0,y.DL)(a),onChange:e=>_("sinceDatetime",e.format(y.KZ)),allowClear:!1,locale:S})),"relative"===i&&(0,o.tZ)(p.X2,{gutter:8},(0,o.tZ)(p.JX,{span:11},(0,o.tZ)(R.Rn,{placeholder:(0,l.t)("Relative quantity"),value:Math.abs(c),min:1,defaultValue:1,onChange:e=>b("sinceGrainValue",e||1),onStep:e=>b("sinceGrainValue",e||1)})),(0,o.tZ)(p.JX,{span:13},(0,o.tZ)(m.Z,{ariaLabel:(0,l.t)("Relative period"),options:y.kj,value:s,onChange:e=>_("sinceGrain",e)})))),(0,o.tZ)(p.JX,{span:12},(0,o.tZ)("div",{className:"control-label"},(0,l.t)("END (EXCLUSIVE)")," ",(0,o.tZ)(D.V,{tooltip:(0,l.t)("End date excluded from time range"),placement:"right"})),(0,o.tZ)(m.Z,{ariaLabel:(0,l.t)("END (EXCLUSIVE)"),options:y.hj,value:u,onChange:e=>_("untilMode",e)}),"specific"===u&&(0,o.tZ)(p.X2,null,(0,o.tZ)(I.M,{showTime:!0,defaultValue:(0,y.DL)(d),onChange:e=>_("untilDatetime",e.format(y.KZ)),allowClear:!1,locale:S})),"relative"===u&&(0,o.tZ)(p.X2,{gutter:8},(0,o.tZ)(p.JX,{span:11},(0,o.tZ)(R.Rn,{placeholder:(0,l.t)("Relative quantity"),value:g,min:1,defaultValue:1,onChange:e=>b("untilGrainValue",e||1),onStep:e=>b("untilGrainValue",e||1)})),(0,o.tZ)(p.JX,{span:13},(0,o.tZ)(m.Z,{ariaLabel:(0,l.t)("Relative period"),options:y.Ae,value:h,onChange:e=>_("untilGrain",e)}))))),"relative"===i&&"relative"===u&&(0,o.tZ)("div",{className:"control-anchor-to"},(0,o.tZ)("div",{className:"control-label"},(0,l.t)("Anchor to")),(0,o.tZ)(p.X2,{align:"middle"},(0,o.tZ)(p.JX,null,(0,o.tZ)(E.Y.Group,{onChange:function(t){const r=t.target.value;"now"===r?e.onChange((0,y.jK)({...n,anchorValue:"now",anchorMode:r})):e.onChange((0,y.jK)({...n,anchorValue:y.V7,anchorMode:r}))},defaultValue:"now",value:v},(0,o.tZ)(E.Y,{key:"now",value:"now"},(0,l.t)("NOW")),(0,o.tZ)(E.Y,{key:"specific",value:"specific"},(0,l.t)("Date/Time")))),"now"!==v&&(0,o.tZ)(p.JX,null,(0,o.tZ)(I.M,{showTime:!0,defaultValue:(0,y.DL)(f),onChange:e=>_("anchorValue",e.format(y.KZ)),allowClear:!1,className:"control-anchor-to-datetime",locale:S})))))}var L=n(78580),N=n.n(L),M=n(5872),k=n.n(M);const P=(0,o.tZ)(r.Fragment,null,(0,o.tZ)("div",null,(0,o.tZ)("h3",null,"DATETIME"),(0,o.tZ)("p",null,(0,l.t)("Return to specific datetime.")),(0,o.tZ)("h4",null,(0,l.t)("Syntax")),(0,o.tZ)("pre",null,(0,o.tZ)("code",null,"datetime([string])")),(0,o.tZ)("h4",null,(0,l.t)("Example")),(0,o.tZ)("pre",null,(0,o.tZ)("code",null,'datetime("2020-03-01 12:00:00")\ndatetime("now")\ndatetime("last year")'))),(0,o.tZ)("div",null,(0,o.tZ)("h3",null,"DATEADD"),(0,o.tZ)("p",null,(0,l.t)("Moves the given set of dates by a specified interval.")),(0,o.tZ)("h4",null,(0,l.t)("Syntax")),(0,o.tZ)("pre",null,(0,o.tZ)("code",null,"dateadd([datetime], [integer], [dateunit])\ndateunit = (year | quarter | month | week | day | hour | minute | second)")),(0,o.tZ)("h4",null,(0,l.t)("Example")),(0,o.tZ)("pre",null,(0,o.tZ)("code",null,'dateadd(datetime("today"), -13, day)\ndateadd(datetime("2020-03-01"), 2, day)'))),(0,o.tZ)("div",null,(0,o.tZ)("h3",null,"DATETRUNC"),(0,o.tZ)("p",null,(0,l.t)("Truncates the specified date to the accuracy specified by the date unit.")),(0,o.tZ)("h4",null,(0,l.t)("Syntax")),(0,o.tZ)("pre",null,(0,o.tZ)("code",null,"datetrunc([datetime], [dateunit])\ndateunit = (year | quarter | month | week)")),(0,o.tZ)("h4",null,(0,l.t)("Example")),(0,o.tZ)("pre",null,(0,o.tZ)("code",null,'datetrunc(datetime("2020-03-01"), week)\ndatetrunc(datetime("2020-03-01"), month)'))),(0,o.tZ)("div",null,(0,o.tZ)("h3",null,"LASTDAY"),(0,o.tZ)("p",null,(0,l.t)("Get the last date by the date unit.")),(0,o.tZ)("h4",null,(0,l.t)("Syntax")),(0,o.tZ)("pre",null,(0,o.tZ)("code",null,"lastday([datetime], [dateunit])\ndateunit = (year | month | week)")),(0,o.tZ)("h4",null,(0,l.t)("Example")),(0,o.tZ)("pre",null,(0,o.tZ)("code",null,'lastday(datetime("today"), month)'))),(0,o.tZ)("div",null,(0,o.tZ)("h3",null,"HOLIDAY"),(0,o.tZ)("p",null,(0,l.t)("Get the specify date for the holiday")),(0,o.tZ)("h4",null,(0,l.t)("Syntax")),(0,o.tZ)("pre",null,(0,o.tZ)("code",null,"holiday([string])\nholiday([holiday string], [datetime])\nholiday([holiday string], [datetime], [country name])")),(0,o.tZ)("h4",null,(0,l.t)("Example")),(0,o.tZ)("pre",null,(0,o.tZ)("code",null,'holiday("new year")\nholiday("christmas", datetime("2019"))\nholiday("christmas", dateadd(datetime("2019"), 1, year))\nholiday("christmas", datetime("2 years ago"))\nholiday("Easter Monday", datetime("2019"), "UK")')))),F=e=>{const t=(0,a.Fg)();return(0,o.tZ)(o.ms,null,(n=>{let{css:r}=n;return(0,o.tZ)(g.u,k()({overlayClassName:r`
            .ant-tooltip-content {
              min-width: ${125*t.gridUnit}px;
              max-height: 410px;
              overflow-y: scroll;

              .ant-tooltip-inner {
                max-width: ${125*t.gridUnit}px;
                h3 {
                  font-size: ${t.typography.sizes.m}px;
                  font-weight: ${t.typography.weights.bold};
                }
                h4 {
                  font-size: ${t.typography.sizes.m}px;
                  font-weight: ${t.typography.weights.bold};
                }
                pre {
                  border: none;
                  text-align: left;
                  word-break: break-word;
                  font-size: ${t.typography.sizes.s}px;
                }
              }
            }
          `},e))}))};function U(e){return(0,o.tZ)(F,k()({title:P},e))}function $(e){return N()(e).call(e,y.UD)?e:e.startsWith("Last")?[e,""].join(y.UD):e.startsWith("Next")?["",e].join(y.UD):y.UD}function q(e){const t=$(e.value||""),[n,a]=t.split(y.UD);function i(t,r){"since"===t?e.onChange(`${r}${y.UD}${a}`):e.onChange(`${n}${y.UD}${r}`)}return t!==e.value&&e.onChange($(e.value||"")),(0,o.tZ)(r.Fragment,null,(0,o.tZ)("div",{className:"section-title"},(0,l.t)("Configure Advanced Time Range "),(0,o.tZ)(U,{placement:"rightBottom"},(0,o.tZ)("i",{className:"fa fa-info-circle text-muted"}))),(0,o.tZ)("div",{className:"control-label"},(0,l.t)("START (INCLUSIVE)")," ",(0,o.tZ)(D.V,{tooltip:(0,l.t)("Start date included in time range"),placement:"right"})),(0,o.tZ)(R.II,{key:"since",value:n,onChange:e=>i("since",e.target.value)}),(0,o.tZ)("div",{className:"control-label"},(0,l.t)("END (EXCLUSIVE)")," ",(0,o.tZ)(D.V,{tooltip:(0,l.t)("End date excluded from time range"),placement:"right"})),(0,o.tZ)(R.II,{key:"until",value:a,onChange:e=>i("until",e.target.value)}))}const V="#45BED6",j=a.iK.div`
  ${e=>{let{theme:t,isActive:n,isPlaceholder:r}=e;return o.iv`
    width: 100%;
    height: ${8*t.gridUnit}px;

    display: flex;
    align-items: center;
    flex-wrap: nowrap;

    padding: 0 ${3*t.gridUnit}px;

    background-color: ${t.colors.grayscale.light5};

    border: 1px solid
      ${n?V:t.colors.grayscale.light2};
    border-radius: ${t.borderRadius}px;

    cursor: pointer;

    transition: border-color 0.3s cubic-bezier(0.65, 0.05, 0.36, 1);
    :hover,
    :focus {
      border-color: ${V};
    }

    .date-label-content {
      color: ${r?t.colors.grayscale.light1:t.colors.grayscale.dark1};
      overflow: hidden;
      text-overflow: ellipsis;
      min-width: 0;
      flex-shrink: 1;
      white-space: nowrap;
    }

    span[role='img'] {
      margin-left: auto;
      padding-left: ${t.gridUnit}px;

      & > span[role='img'] {
        line-height: 0;
      }
    }
  `}}
`,H=(0,r.forwardRef)(((e,t)=>{const n=(0,a.Fg)();return(0,o.tZ)(j,k()({},e,{tabIndex:0}),(0,o.tZ)("span",{className:"date-label-content",ref:t},e.label),(0,o.tZ)(h.Z.CalendarOutlined,{iconSize:"s",iconColor:n.colors.grayscale.base}))})),B=(0,a.iK)(m.Z)`
  width: 272px;
`,z=a.iK.div`
  ${e=>{let{theme:t}=e;return o.iv`
    .ant-row {
      margin-top: 8px;
    }

    .ant-input-number {
      width: 100%;
    }

    .ant-picker {
      padding: 4px 17px 4px;
      border-radius: 4px;
      width: 100%;
    }

    .ant-divider-horizontal {
      margin: 16px 0;
    }

    .control-label {
      font-size: 11px;
      font-weight: ${t.typography.weights.medium};
      color: ${t.colors.grayscale.light2};
      line-height: 16px;
      text-transform: uppercase;
      margin: 8px 0;
    }

    .vertical-radio {
      display: block;
      height: 40px;
      line-height: 40px;
    }

    .section-title {
      font-style: normal;
      font-weight: ${t.typography.weights.bold};
      font-size: 15px;
      line-height: 24px;
      margin-bottom: 8px;
    }

    .control-anchor-to {
      margin-top: 16px;
    }

    .control-anchor-to-datetime {
      width: 217px;
    }

    .footer {
      text-align: right;
    }
  `}}
`,G=a.iK.span`
  span {
    margin-right: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    vertical-align: middle;
  }
  .text {
    vertical-align: middle;
  }
  .error {
    color: ${e=>{let{theme:t}=e;return t.colors.error.base}};
  }
`,Q=(e,t,n)=>e?(0,o.tZ)("div",null,t&&(0,o.tZ)("strong",null,t),n&&(0,o.tZ)("div",{css:e=>o.iv`
            margin-top: ${e.gridUnit}px;
          `},n)):n||null;function Y(e){var t;const{onChange:n,onOpenPopover:m=_.EI,onClosePopover:E=_.EI,overlayStyle:S="Popover",isOverflowingFilterBar:Z=!1}=e,A=(0,y.Ct)(),x=null!=(t=e.value)?t:A,[w,R]=(0,r.useState)(x),[I,D]=(0,r.useState)(!1),L=(0,r.useMemo)((()=>(0,y.X0)(x)),[x]),[N,M]=(0,r.useState)(L),[k,P]=(0,r.useState)(x),[F,U]=(0,r.useState)(x),[$,V]=(0,r.useState)(!1),[j,Y]=(0,r.useState)(x),[K,W]=(0,r.useState)(x),J=(0,a.Fg)(),[X,ee]=(0,i.Z)();function te(){U(x),M(L),D(!1),E()}(0,r.useEffect)((()=>{if(x===s.vM)return R(s.vM),W(null),void V(!0);(0,y.z1)(x).then((e=>{let{value:t,error:n}=e;n?(Y(n||""),V(!1),W(x||null)):("Common"===L||"Calendar"===L||"No filter"===L?(R(x),W(Q(ee,x,t))):(R(t||""),W(Q(ee,t,x))),V(!0)),P(x),Y(t||x)}))}),[L,ee,X,x]),(0,f.bX)((()=>{if(F===s.vM)return Y(s.vM),P(s.vM),void V(!0);k!==F&&(0,y.z1)(F).then((e=>{let{value:t,error:n}=e;n?(Y(n||""),V(!1)):(Y(t||""),V(!0)),P(F)}))}),v.M$,[F]);const ne=()=>{I?te():(U(x),M(L),D(!0),m())},re=(0,o.tZ)(z,null,(0,o.tZ)("div",{className:"control-label"},(0,l.t)("RANGE TYPE")),(0,o.tZ)(B,{ariaLabel:(0,l.t)("RANGE TYPE"),options:y.un,value:N,onChange:function(e){e===s.vM&&U(s.vM),M(e)}}),"No filter"!==N&&(0,o.tZ)(p.iz,null),"Common"===N&&(0,o.tZ)(T,{value:F,onChange:U}),"Calendar"===N&&(0,o.tZ)(C,{value:F,onChange:U}),"Advanced"===N&&(0,o.tZ)(q,{value:F,onChange:U}),"Custom"===N&&(0,o.tZ)(O,{value:F,onChange:U}),"No filter"===N&&(0,o.tZ)("div",null),(0,o.tZ)(p.iz,null),(0,o.tZ)("div",null,(0,o.tZ)("div",{className:"section-title"},(0,l.t)("Actual time range")),$&&(0,o.tZ)("div",null,j),!$&&(0,o.tZ)(G,{className:"warning"},(0,o.tZ)(h.Z.ErrorSolidSmall,{iconColor:J.colors.error.base}),(0,o.tZ)("span",{className:"text error"},j))),(0,o.tZ)(p.iz,null),(0,o.tZ)("div",{className:"footer"},(0,o.tZ)(c.Z,{buttonStyle:"secondary",cta:!0,key:"cancel",onClick:te},(0,l.t)("CANCEL")),(0,o.tZ)(c.Z,{buttonStyle:"primary",cta:!0,disabled:!$,key:"apply",onClick:function(){n(F),D(!1),E()}},(0,l.t)("APPLY")))),ae=(0,o.tZ)(G,null,(0,o.tZ)(h.Z.EditAlt,{iconColor:J.colors.grayscale.base}),(0,o.tZ)("span",{className:"text"},(0,l.t)("Edit time range"))),oe=(0,o.tZ)(b.Z,{placement:"right",trigger:"click",content:re,title:ae,defaultVisible:I,visible:I,onVisibleChange:ne,overlayStyle:{width:"600px"},getPopupContainer:e=>Z?e.parentNode:document.body,destroyTooltipOnHide:!0},(0,o.tZ)(g.u,{placement:"top",title:K,getPopupContainer:e=>e.parentElement},(0,o.tZ)(H,{label:w,isActive:I,isPlaceholder:w===s.vM,ref:X}))),ie=(0,o.tZ)(r.Fragment,null,(0,o.tZ)(g.u,{placement:"top",title:K,getPopupContainer:e=>e.parentElement},(0,o.tZ)(H,{onClick:ne,label:w,isActive:I,isPlaceholder:w===s.vM,ref:X})),(0,o.tZ)(u.Z,{title:ae,show:I,onHide:ne,width:"600px",hideFooter:!0,zIndex:1030},re));return(0,o.tZ)(r.Fragment,null,(0,o.tZ)(d.Z,e),"Modal"===S?ie:oe)}},1090:(e,t,n)=>{"use strict";n.d(t,{ZP:()=>r.Z,z1:()=>a.z1});var r=n(74092),a=n(61314)},31209:(e,t,n)=>{"use strict";n.d(t,{MZ:()=>a,gT:()=>r,po:()=>o});const r="previous calendar week",a="previous calendar month",o="previous calendar year"},61314:(e,t,n)=>{"use strict";n.d(t,{_S:()=>C,LY:()=>O,gn:()=>Z,Sm:()=>T,bk:()=>D,MI:()=>S,un:()=>E,ZU:()=>k,V7:()=>M,KZ:()=>L,UD:()=>h,kj:()=>x,_d:()=>R,Ae:()=>w,hj:()=>I,c_:()=>Y,jK:()=>K,DL:()=>G,z1:()=>v,X0:()=>f,Ct:()=>_});var r=n(78580),a=n.n(r),o=n(30381),i=n.n(o),s=n(15926),l=n.n(s),c=n(5364),d=n(31069),u=n(98286),p=n(28216);const h=" : ",m=(e,t)=>e.replace("T00:00:00","")||(t?"-":""),g=function(e,t){void 0===t&&(t="col");const n=e.split(h);return 1===n.length?e:`${m(n[0],!0)}  ${t} < ${m(n[1])}`},f=e=>S.has(e)?"Common":Z.has(e)?"Calendar":e===c.vM?"No filter":Y(e).matchedFlag?"Custom":"Advanced",v=async function(e,t){void 0===t&&(t="col");const n=`/api/v1/time_range/?q=${l().encode_uri(e)}`;try{var r,a,o,i;const e=await d.Z.get({endpoint:n}),l=(s=(null==e||null==(r=e.json)||null==(a=r.result)?void 0:a.since)||"",c=(null==e||null==(o=e.json)||null==(i=o.result)?void 0:i.until)||"",`${s}${h}${c}`);return{value:g(l,t)}}catch(e){const t=await(0,u.O$)(e);return{error:t.message||t.error||e.statusText}}var s,c};function _(){var e;return null!=(e=(0,p.v9)((e=>{var t,n;return null==e||null==(t=e.common)||null==(n=t.conf)?void 0:n.DEFAULT_TIME_FILTER})))?e:c.vM}var b=n(55867),y=n(31209);const E=[{value:"Common",label:(0,b.t)("Last")},{value:"Calendar",label:(0,b.t)("Previous")},{value:"Custom",label:(0,b.t)("Custom")},{value:"Advanced",label:(0,b.t)("Advanced")},{value:"No filter",label:(0,b.t)("No filter")}],T=[{value:"Last day",label:(0,b.t)("last day")},{value:"Last week",label:(0,b.t)("last week")},{value:"Last month",label:(0,b.t)("last month")},{value:"Last quarter",label:(0,b.t)("last quarter")},{value:"Last year",label:(0,b.t)("last year")}],S=new Set(T.map((e=>{let{value:t}=e;return t}))),C=[{value:y.gT,label:(0,b.t)("previous calendar week")},{value:y.MZ,label:(0,b.t)("previous calendar month")},{value:y.po,label:(0,b.t)("previous calendar year")}],Z=new Set(C.map((e=>{let{value:t}=e;return t}))),A=[{value:"second",label:e=>(0,b.t)("Seconds %s",e)},{value:"minute",label:e=>(0,b.t)("Minutes %s",e)},{value:"hour",label:e=>(0,b.t)("Hours %s",e)},{value:"day",label:e=>(0,b.t)("Days %s",e)},{value:"week",label:e=>(0,b.t)("Weeks %s",e)},{value:"month",label:e=>(0,b.t)("Months %s",e)},{value:"quarter",label:e=>(0,b.t)("Quarters %s",e)},{value:"year",label:e=>(0,b.t)("Years %s",e)}],x=A.map((e=>({value:e.value,label:e.label((0,b.t)("Before"))}))),w=A.map((e=>({value:e.value,label:e.label((0,b.t)("After"))}))),R=[{value:"specific",label:(0,b.t)("Specific Date/Time")},{value:"relative",label:(0,b.t)("Relative Date/Time")},{value:"now",label:(0,b.t)("Now")},{value:"today",label:(0,b.t)("Midnight")}],I=R.slice(),D=new Set(["Last day","Last week","Last month","Last quarter","Last year"]),O=new Set([y.gT,y.MZ,y.po]),L="YYYY-MM-DD[T]HH:mm:ss",N=i()().utc().startOf("day").subtract(7,"days").format(L),M=i()().utc().startOf("day").format(L),k={en:"en_US",fr:"fr_FR",es:"es_ES",it:"it_IT",zh:"zh_CN",ja:"ja_JP",de:"de_DE",pt:"pt_PT",pt_BR:"pt_BR",ru:"ru_RU",ko:"ko_KR",sk:"sk_SK",sl:"sl_SI",nl:"nl_NL"};var P;!function(e){e.commonFrame="common-frame",e.modalOverlay="modal-overlay",e.popoverOverlay="time-range-trigger",e.noFilter="no-filter",e.cancelButton="cancel-button",e.applyButton="date-filter-control__apply-button"}(P||(P={}));const F=String.raw`\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.\d+)?(?:(?:[+-]\d\d:\d\d)|Z)?`,U=String.raw`(?:TODAY|NOW)`,$=String.raw`[+-]?[1-9][0-9]*`,q=String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`,V=RegExp(String.raw`^DATEADD\(DATETIME\("(${F}|${U})"\),\s(${$}),\s(${q})\)$`,"i"),j=RegExp(String.raw`^${F}$|^${U}$`,"i"),H=["now","today"],B={sinceDatetime:N,sinceMode:"relative",sinceGrain:"day",sinceGrainValue:-7,untilDatetime:M,untilMode:"specific",untilGrain:"day",untilGrainValue:7,anchorMode:"now",anchorValue:"now"},z=["specific","today","now"],G=e=>"now"===e?i()().utc().startOf("second"):"today"===e?i()().utc().startOf("day"):i()(e),Q=e=>G(e).format(L),Y=e=>{const t=e.split(h);if(2===t.length){const[e,n]=t;if(j.test(e)&&j.test(n)){const t=a()(H).call(H,e)?e:"specific",r=a()(H).call(H,n)?n:"specific";return{customRange:{...B,sinceDatetime:e,untilDatetime:n,sinceMode:t,untilMode:r},matchedFlag:!0}}const r=e.match(V);if(r&&j.test(n)&&a()(e).call(e,n)){const[e,t,o]=r.slice(1),i=a()(H).call(H,n)?n:"specific";return{customRange:{...B,sinceGrain:o,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilDatetime:e,sinceMode:"relative",untilMode:i},matchedFlag:!0}}const o=n.match(V);if(j.test(e)&&o&&a()(n).call(n,e)){const[t,n,r]=[...o.slice(1)],i=a()(H).call(H,e)?e:"specific";return{customRange:{...B,untilGrain:r,untilGrainValue:parseInt(n,10),sinceDatetime:t,untilDatetime:t,untilMode:"relative",sinceMode:i},matchedFlag:!0}}if(r&&o){const[e,t,n]=[...r.slice(1)],[a,i,s]=[...o.slice(1)];if(e===a)return{customRange:{...B,sinceGrain:n,sinceGrainValue:parseInt(t,10),sinceDatetime:e,untilGrain:s,untilGrainValue:parseInt(i,10),untilDatetime:a,anchorValue:e,sinceMode:"relative",untilMode:"relative",anchorMode:"now"===e?"now":"specific"},matchedFlag:!0}}}return{customRange:B,matchedFlag:!1}},K=e=>{const{sinceDatetime:t,sinceMode:n,sinceGrain:r,sinceGrainValue:o,untilDatetime:i,untilMode:s,untilGrain:l,untilGrainValue:c,anchorValue:d}={...e};if(a()(z).call(z,n)&&a()(z).call(z,s))return`${"specific"===n?Q(t):n} : ${"specific"===s?Q(i):s}`;if(a()(z).call(z,n)&&"relative"===s){const e="specific"===n?Q(t):n;return`${e} : DATEADD(DATETIME("${e}"), ${c}, ${l})`}if("relative"===n&&a()(z).call(z,s)){const e="specific"===s?Q(i):s;return`DATEADD(DATETIME("${e}"), ${-Math.abs(o)}, ${r}) : ${e}`}return`DATEADD(DATETIME("${d}"), ${-Math.abs(o)}, ${r}) : DATEADD(DATETIME("${d}"), ${c}, ${l})`}},96055:(e,t,n)=>{"use strict";n.d(t,{Z:()=>ne});var r=n(67294),a=n(5872),o=n.n(a),i=n(45697),s=n.n(i),l=n(35932),c=n(51995),d=n(55867),u=n(57902),p=n(71262),h=n(17536),m=n(28543),g=n(78580),f=n.n(g),v=n(4591),_=n(4715),b=n(37731),y=n(11146),E=n(31069),T=n(93185),S=n(69856),C=n(40266),Z=n(58593),A=n(9875),x=n(54076),w=n(45211),R=n(23279),I=n.n(R),D=n(55786),O=n(15926),L=n.n(O);const N={parsedAdvancedDataType:"",advancedDataTypeOperatorList:[],errorMessage:""};var M=n(7848),k=n(61314),P=n(61641),F=n(11965);const U=(0,c.iK)(A.II)`
  margin-bottom: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
`,$=((0,c.iK)(v.Z)`
  &.ant-row.ant-form-item {
    margin: 0;
  }
`,(0,c.iK)(_.Ph)`
  .ant-select-selector::after {
    content: ${e=>{let{labelText:t}=e;return t||"\\A0"}};
    display: inline-block;
    white-space: nowrap;
    color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
    width: max-content;
  }
`),q=e=>{var t,n;const{onSubjectChange:a,onOperatorChange:i,isOperatorRelevant:s,onComparatorChange:l,onDatePickerChange:c}=(e=>{const t=(0,k.Ct)(),n=(t,n)=>{var r;const a=null==(r=e.datasource.columns)?void 0:r.find((e=>e.column_name===n)),o=!!a&&("BOOL"===a.type||"BOOLEAN"===a.type),i=!!a&&("INT"===a.type||"INTEGER"===a.type),s=!!a&&!!a.expression;if(t&&t===S.d.LATEST_PARTITION){const{partitionColumn:t}=e;return t&&n&&n===t}return(!t||t!==S.d.TEMPORAL_RANGE)&&(t===S.d.IS_TRUE||t===S.d.IS_FALSE?o||i||s:o?t===S.d.IS_NULL||t===S.d.IS_NOT_NULL:e.adhocFilter.clause!==P.P.HAVING||-1!==S.Ak.indexOf(t))};return{onSubjectChange:r=>{const a=e.options.find((e=>"column_name"in e&&e.column_name===r||"optionName"in e&&e.optionName===r));let o,i="";a&&"column_name"in a?(i=a.column_name,o=P.P.WHERE):a&&"saved_metric_name"in a?(i=a.saved_metric_name,o=P.P.HAVING):null!=a&&a.label&&(i=a.label,o=P.P.HAVING);let{operator:s,operatorId:l,comparator:c}=e.adhocFilter;s=s&&l&&n(l,i)?S.LT[l].operation:null,(0,b.Z)(s)||(s=S.d.IN,l=S.d.IN,c=void 0),y.O6&&(0,w.x)(r,e.datasource)&&(i=r,s=S.d.TEMPORAL_RANGE,l=S.d.TEMPORAL_RANGE,c=t),e.onChange(e.adhocFilter.duplicateWith({subject:i,clause:o,operator:s,expressionType:P.v.SIMPLE,operatorId:l,comparator:c}))},onOperatorChange:t=>{const n=e.adhocFilter.comparator;let r;r=S.qK.has(t)?Array.isArray(n)?n:[n].filter((e=>e)):Array.isArray(n)?n[0]:n,t!==S.d.IS_TRUE&&t!==S.d.IS_FALSE||(r=S.d.IS_TRUE===t),t&&S.qB.has(t)?e.onChange(e.adhocFilter.duplicateWith({subject:e.adhocFilter.subject,clause:P.P.WHERE,operatorId:t,operator:S.LT[t].operation,expressionType:P.v.SQL,datasource:e.datasource})):e.onChange(e.adhocFilter.duplicateWith({operatorId:t,operator:S.LT[t].operation,comparator:r,expressionType:P.v.SIMPLE}))},onComparatorChange:t=>{e.onChange(e.adhocFilter.duplicateWith({comparator:t,expressionType:P.v.SIMPLE}))},isOperatorRelevant:n,clearOperator:()=>{e.onChange(e.adhocFilter.duplicateWith({operatorId:void 0,operator:void 0}))},onDatePickerChange:(t,n)=>{e.onChange(e.adhocFilter.duplicateWith({subject:t,operator:S.d.TEMPORAL_RANGE,comparator:n,expressionType:P.v.SIMPLE}))}}})(e),[u,p]=(0,r.useState)([]),[h,m]=(0,r.useState)(e.adhocFilter.comparator),[g,v]=(0,r.useState)(!1),{advancedDataTypesState:A,subjectAdvancedDataType:R,fetchAdvancedDataTypeValueCallback:O,fetchSubjectAdvancedDataType:q}=(e=>{const[t,n]=(0,r.useState)(N),[a,o]=(0,r.useState)(),i=(0,r.useCallback)(((t,r,a)=>{const o=(0,D.Z)(t);a?I()((()=>{const t=`/api/v1/advanced_data_type/convert?q=${L().encode({type:a,values:o})}`;E.Z.get({endpoint:t}).then((t=>{let{json:r}=t;n({parsedAdvancedDataType:r.result.display_value,advancedDataTypeOperatorList:r.result.valid_filter_operators,errorMessage:r.result.error_message}),e(!r.result.error_message)})).catch((()=>{n({parsedAdvancedDataType:"",advancedDataTypeOperatorList:r.advancedDataTypeOperatorList,errorMessage:(0,d.t)("Failed to retrieve advanced type")}),e(!1)}))}),600)():n(N)}),[e]);return{advancedDataTypesState:t,subjectAdvancedDataType:a,setAdvancedDataTypesState:n,fetchAdvancedDataTypeValueCallback:i,fetchSubjectAdvancedDataType:e=>{const t=e.options.find((t=>"column_name"in t&&t.column_name===e.adhocFilter.subject||"optionName"in t&&t.optionName===e.adhocFilter.subject));t&&"advanced_data_type"in t?o(t.advanced_data_type):e.validHandler(!0)}}})(e.validHandler),V=(e,t)=>{var n;return R?s(e,t)&&f()(n=A.advancedDataTypeOperatorList).call(n,e):s(e,t)},j=()=>{const e=(()=>{var e;const t=Array.isArray(h)?h.filter((e=>f()(u).call(u,e))).length:0;return null!=(e=(null==u?void 0:u.length)-t)?e:0})(),t=(0,d.t)("%s option(s)",e);return e?t:""};let H=e.options;const{subject:B,operator:z,operatorId:G}=e.adhocFilter,Q={ariaLabel:(0,d.t)("Select subject"),value:null!=B?B:void 0,onChange:e=>{m(void 0),a(e)},notFoundContent:(0,d.t)("No such column found. To filter on a metric, try the Custom SQL tab."),autoFocus:!B,placeholder:""};Q.placeholder=e.adhocFilter.clause===P.P.WHERE?(0,d.t)("%s column(s)",H.length):(0,d.t)("To filter on a metric, use Custom SQL tab."),H=e.options.filter((e=>"column_name"in e&&e.column_name));const Y={placeholder:(0,d.t)("%s operator(s)",(null!=(t=e.operators)?t:S.GS).filter((e=>V(e,B))).length),value:G,onChange:i,autoFocus:!!Q.value&&!z,ariaLabel:(0,d.t)("Select operator")},K=!!Q.value&&!!Y.value,W={allowClear:!0,allowNewOptions:!0,ariaLabel:(0,d.t)("Comparator option"),mode:S.qK.has(G)?"multiple":"single",loading:g,value:h,onChange:l,notFoundContent:(0,d.t)("Type a value here"),disabled:f()(S.yi).call(S.yi,G),placeholder:j(),autoFocus:K},J=h&&h.length>0&&j(),X=(0,M.v)({columnName:e.adhocFilter.subject,timeRange:e.adhocFilter.operator===S.d.TEMPORAL_RANGE?e.adhocFilter.comparator:void 0,datasource:e.datasource,onChange:c});(0,r.useEffect)((()=>{X||(()=>{const{datasource:t}=e,n=e.adhocFilter.subject,r=e.adhocFilter.clause===P.P.HAVING;if(n&&t&&t.filter_select&&!r){const e=new AbortController,{signal:r}=e;g&&e.abort(),v(!0),E.Z.get({signal:r,endpoint:`/api/v1/datasource/${t.type}/${t.id}/column/${n}/values/`}).then((e=>{let{json:t}=e;p(t.result.map((e=>({value:e,label:(0,x.lo)(e)})))),v(!1)})).catch((()=>{p([]),v(!1)}))}})()}),[e.adhocFilter.subject]),(0,r.useEffect)((()=>{(0,T.cr)(T.TT.ENABLE_ADVANCED_DATA_TYPES)&&q(e)}),[e.adhocFilter.subject]),(0,r.useEffect)((()=>{(0,T.cr)(T.TT.ENABLE_ADVANCED_DATA_TYPES)&&O(void 0===h?"":h,A,R)}),[h,R,O]),(0,r.useEffect)((()=>{(0,T.cr)(T.TT.ENABLE_ADVANCED_DATA_TYPES)&&m(e.adhocFilter.comparator)}),[e.adhocFilter.comparator]);const ee=(0,F.tZ)(_.Ph,o()({css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),options:H.map((e=>{return{value:"column_name"in e&&e.column_name||"optionName"in e&&e.optionName||"",label:"saved_metric_name"in e&&e.saved_metric_name||"column_name"in e&&e.column_name||"label"in e&&e.label,key:"id"in e&&e.id||"optionName"in e&&e.optionName||void 0,customLabel:(t=e,(0,F.tZ)(C.Z,{option:t}))};var t}))},Q)),te=(0,F.tZ)(r.Fragment,null,(0,F.tZ)(_.Ph,o()({css:e=>({marginBottom:4*e.gridUnit}),options:(null!=(n=e.operators)?n:S.GS).filter((e=>V(e,B))).map(((e,t)=>({value:e,label:S.LT[e].display,key:e,order:t})))},Y)),S.qK.has(G)||u.length>0?(0,F.tZ)(Z.u,{title:A.errorMessage||A.parsedAdvancedDataType},(0,F.tZ)($,o()({labelText:J,options:u},W))):(0,F.tZ)(Z.u,{title:A.errorMessage||A.parsedAdvancedDataType},(0,F.tZ)(U,{name:"filter-value",ref:e=>{e&&K&&e.focus()},onChange:e=>{const{value:t}=e.target;m(t),l(t)},value:h,placeholder:(0,d.t)("Filter value (case sensitive)"),disabled:f()(S.yi).call(S.yi,G)})));return(0,F.tZ)(r.Fragment,null,ee,null!=X?X:te)};var V=n(94670),j=n(33313),H=n(72201);const B={adhocFilter:s().instanceOf(m.Z).isRequired,onChange:s().func.isRequired,options:s().arrayOf(s().oneOfType([H.Z,s().shape({saved_metric_name:s().string.isRequired}),h.Z])).isRequired,height:s().number.isRequired,activeKey:s().string.isRequired},z=(0,c.iK)(_.Ph)`
  ${e=>{let{theme:t}=e;return`\n    width: ${30*t.gridUnit}px;\n    marginRight: ${t.gridUnit}px;\n  `}}
`;class G extends r.Component{constructor(e){super(e),this.onSqlExpressionChange=this.onSqlExpressionChange.bind(this),this.onSqlExpressionClauseChange=this.onSqlExpressionClauseChange.bind(this),this.handleAceEditorRef=this.handleAceEditorRef.bind(this),this.selectProps={ariaLabel:(0,d.t)("Select column")}}componentDidUpdate(){this.aceEditorRef&&this.aceEditorRef.editor.resize()}onSqlExpressionClauseChange(e){this.props.onChange(this.props.adhocFilter.duplicateWith({clause:e,expressionType:P.v.SQL}))}onSqlExpressionChange(e){this.props.onChange(this.props.adhocFilter.duplicateWith({sqlExpression:e,expressionType:P.v.SQL}))}handleAceEditorRef(e){e&&(this.aceEditorRef=e)}render(){const{adhocFilter:e,height:t,options:n}=this.props,r={placeholder:(0,d.t)("choose WHERE or HAVING..."),value:e.clause,onChange:this.onSqlExpressionClauseChange},a=j.Z.concat(n.map((e=>e.column_name?{name:e.column_name,value:e.column_name,score:50,meta:"option"}:null)).filter(Boolean)),i=Object.keys(P.P).map((e=>({label:e,value:e})));return(0,F.tZ)("span",null,(0,F.tZ)("div",{className:"filter-edit-clause-section"},(0,F.tZ)(z,o()({options:i},this.selectProps,r)),(0,F.tZ)("span",{className:"filter-edit-clause-info"},(0,F.tZ)("strong",null,"WHERE")," ",(0,d.t)("Filters by columns"),(0,F.tZ)("br",null),(0,F.tZ)("strong",null,"HAVING")," ",(0,d.t)("Filters by metrics"))),(0,F.tZ)("div",{css:e=>({marginTop:4*e.gridUnit})},(0,F.tZ)(V.iO,{ref:this.handleAceEditorRef,keywords:a,height:t-130+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:e.sqlExpression||e.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0})))}}G.propTypes=B;const Q={adhocFilter:s().instanceOf(m.Z).isRequired,onChange:s().func.isRequired,onClose:s().func.isRequired,onResize:s().func.isRequired,options:s().arrayOf(s().oneOfType([H.Z,s().shape({saved_metric_name:s().string.isRequired}),h.Z])).isRequired,datasource:s().object,partitionColumn:s().string,theme:s().object,sections:s().arrayOf(s().string),operators:s().arrayOf(s().string),requireSave:s().bool},Y=c.iK.i`
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,K=c.iK.div`
  .adhoc-filter-edit-tabs > .nav-tabs {
    margin-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;

    & > li > a {
      padding: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    }
  }

  #filter-edit-popover {
    max-width: none;
  }

  .filter-edit-clause-info {
    font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.xs}}px;
    padding-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }

  .filter-edit-clause-section {
    display: inline-flex;
  }

  .adhoc-filter-simple-column-dropdown {
    margin-top: ${e=>{let{theme:t}=e;return 5*t.gridUnit}}px;
  }
`,W=c.iK.div`
  margin-top: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`;class J extends r.Component{constructor(e){var t,n;super(e),this.onSave=this.onSave.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onAdhocFilterChange=this.onAdhocFilterChange.bind(this),this.setSimpleTabIsValid=this.setSimpleTabIsValid.bind(this),this.adjustHeight=this.adjustHeight.bind(this),this.onTabChange=this.onTabChange.bind(this),this.state={adhocFilter:this.props.adhocFilter,width:S.kc,height:S.H7,activeKey:(null==(t=this.props)||null==(n=t.adhocFilter)?void 0:n.expressionType)||"SIMPLE",isSimpleTabValid:!0},this.popoverContentRef=r.createRef()}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}onAdhocFilterChange(e){this.setState({adhocFilter:e})}setSimpleTabIsValid(e){this.setState({isSimpleTabValid:e})}onSave(){this.props.onChange(this.state.adhocFilter),this.props.onClose()}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),S.kc),height:Math.max(this.dragStartHeight+(e.clientY-this.dragStartY),S.H7)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.setState({activeKey:e})}adjustHeight(e){this.setState((t=>({height:t.height+e})))}render(){const{adhocFilter:e,options:t,onChange:n,onClose:r,onResize:a,datasource:i,partitionColumn:s,theme:c,operators:h,requireSave:m,...g}=this.props,{adhocFilter:f}=this.state,v=f.isValid(),_=m||!f.equals(e);return(0,F.tZ)(K,o()({id:"filter-edit-popover"},g,{ref:this.popoverContentRef}),(0,F.tZ)(p.ZP,{id:"adhoc-filter-edit-tabs",defaultActiveKey:f.expressionType,className:"adhoc-filter-edit-tabs",style:{minHeight:this.state.height,width:this.state.width},allowOverflow:!0,onChange:this.onTabChange},(0,F.tZ)(p.ZP.TabPane,{className:"adhoc-filter-edit-tab",key:P.v.SIMPLE,tab:(0,d.t)("Simple")},(0,F.tZ)(u.Z,null,(0,F.tZ)(q,{operators:h,adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:t,datasource:i,onHeightChange:this.adjustHeight,partitionColumn:s,popoverRef:this.popoverContentRef.current,validHandler:this.setSimpleTabIsValid}))),(0,F.tZ)(p.ZP.TabPane,{className:"adhoc-filter-edit-tab",key:P.v.SQL,tab:(0,d.t)("Custom SQL")},(0,F.tZ)(u.Z,null,(0,F.tZ)(G,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,height:this.state.height,activeKey:this.state.activeKey})))),(0,F.tZ)(W,null,(0,F.tZ)(l.Z,{buttonSize:"small",onClick:this.props.onClose,cta:!0},(0,d.t)("Close")),(0,F.tZ)(l.Z,{disabled:!v||!this.state.isSimpleTabValid||!_,buttonStyle:"primary",buttonSize:"small",className:"m-r-5",onClick:this.onSave,cta:!0},(0,d.t)("Save")),(0,F.tZ)(Y,{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"fa fa-expand edit-popover-resize text-muted"})))}}J.propTypes=Q;var X=n(63325),ee=n(27845);class te extends r.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.state={popoverVisible:!1}}onPopoverResize(){this.forceUpdate()}closePopover(){this.togglePopover(!1)}togglePopover(e){this.setState({popoverVisible:e})}render(){const{adhocFilter:e,isControlledComponent:t}=this.props,{visible:n,togglePopover:r,closePopover:a}=t?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},o=(0,F.tZ)(X.b,null,(0,F.tZ)(J,{adhocFilter:e,options:this.props.options,datasource:this.props.datasource,partitionColumn:this.props.partitionColumn,onResize:this.onPopoverResize,onClose:a,sections:this.props.sections,operators:this.props.operators,onChange:this.props.onFilterEdit,requireSave:this.props.requireSave}));return(0,F.tZ)(ee.Z,{trigger:"click",content:o,defaultVisible:n,visible:n,onVisibleChange:r,destroyTooltipOnHide:!0},this.props.children)}}const ne=te},61641:(e,t,n)=>{"use strict";var r,a;n.d(t,{P:()=>a,v:()=>r}),function(e){e.SIMPLE="SIMPLE",e.SQL="SQL"}(r||(r={})),function(e){e.HAVING="HAVING",e.WHERE="WHERE"}(a||(a={}))},7848:(e,t,n)=>{"use strict";n.d(t,{v:()=>g,w:()=>l});var r=n(67294),a=n(5364),o=n(1090),i=n(69856),s=n(61641);const l=e=>{const[t,n]=(0,r.useState)({});return(0,r.useEffect)((()=>{e.operator===i.d.TEMPORAL_RANGE&&e.expressionType===s.v.SIMPLE||n({}),e.operator===i.d.TEMPORAL_RANGE&&e.comparator===a.vM&&n({actualTimeRange:`${e.subject} (${a.vM})`,title:a.vM}),e.operator===i.d.TEMPORAL_RANGE&&e.expressionType===s.v.SIMPLE&&e.comparator!==a.vM&&t.title!==e.comparator&&(0,o.z1)(e.comparator,e.subject).then((t=>{let{value:r,error:a}=t;n(a?{actualTimeRange:`${e.subject} (${e.comparator})`,title:a}:{actualTimeRange:null!=r?r:"",title:e.comparator})}))}),[e]),t};var c=n(11146),d=n(55867),u=n(45211),p=n(74092),h=n(82342),m=n(11965);const g=e=>{let{columnName:t,timeRange:n,datasource:a,onChange:o}=e;return c.O6&&(0,u.x)(t,a)?(0,m.tZ)(r.Fragment,null,(0,m.tZ)(h.Z,{label:(0,d.t)("Time Range")}),(0,m.tZ)(p.Z,{value:n,name:"time_range",onChange:e=>o(t,e),overlayStyle:"Modal"})):void 0}},56565:(e,t,n)=>{"use strict";n.d(t,{c:()=>s});var r=n(46306),a=n(69856),o=n(12515);const i={"==":"=","!=":"<>",">":">","<":"<",">=":">=","<=":"<=",IN:"IN","NOT IN":"NOT IN",LIKE:"LIKE",ILIKE:"ILIKE",REGEX:"REGEX","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL","IS TRUE":"IS TRUE","IS FALSE":"IS FALSE","LATEST PARTITION":e=>{let{datasource:t}=e;return`= '{{ presto.latest_partition('${t.schema}.${t.datasource_name}') }}'`}},s=function(e,t){let{useSimple:n}=void 0===t?{useSimple:!1}:t;if((0,r.Ki)(e)||n){const{subject:t,operator:n}=e,r="comparator"in e?e.comparator:void 0,s=n&&n===a.LT[a.d.LATEST_PARTITION].operation?i[n](e):i[n];return(0,o.CB)(t,s,r)}return(0,r.jz)(e)?e.sqlExpression:""}},33334:(e,t,n)=>{"use strict";n.d(t,{EQ:()=>f,H$:()=>C,IG:()=>A,Ne:()=>b,SW:()=>Z,__:()=>v,a7:()=>g,gM:()=>T,gu:()=>y,yj:()=>S,yz:()=>x});var r=n(5872),a=n.n(r),o=n(67294),i=n(22068),s=n(27034),l=n(51995),c=n(55867),d=n(9882),u=n(58593),p=n(70163),h=n(99963),m=n(11965);const g=l.iK.div`
  margin-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  :last-child {
    margin-bottom: 0;
  }
`,f=l.iK.div`
  display: flex;
  align-items: center;
  width: 100%;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  height: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
  background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light3}};
  border-radius: 3px;
  cursor: ${e=>{let{withCaret:t}=e;return t?"pointer":"default"}};
`,v=l.iK.div`
  ${e=>{let{theme:t}=e;return`\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${t.gridUnit}px;\n    svg {\n      margin-right: ${t.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${2*t.gridUnit}px;\n      margin-left: ${t.gridUnit}px;\n      font-weight: ${t.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}}
`,_=l.iK.span`
  overflow: hidden;
  text-overflow: ellipsis;
`,b=l.iK.div`
  height: 100%;
  border-left: solid 1px ${e=>{let{theme:t}=e;return t.colors.grayscale.dark2}}0C;
  margin-left: auto;
`,y=l.iK.div`
  height: 100%;
  width: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
  border-right: solid 1px ${e=>{let{theme:t}=e;return t.colors.grayscale.dark2}}0C;
  cursor: pointer;
`,E=(0,l.iK)(d.V)`
  margin: 0 ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,T=l.iK.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`,S=l.iK.div`
  padding: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  border: solid 1px ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  border-radius: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,C=l.iK.div`
  padding: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  border: ${e=>{let{canDrop:t,isOver:n,theme:r}=e;return t?`dashed 1px ${r.colors.info.dark1}`:n&&!t?`dashed 1px ${r.colors.error.dark1}`:`solid 1px ${r.colors.grayscale.light2}`}};
  border-radius: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
`,Z=l.iK.div`
  display: flex;
  align-items: center;
  width: 100%;
  height: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
  padding-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
  border: dashed 1px ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  border-radius: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  cursor: ${e=>{let{cancelHover:t}=e;return t?"inherit":"pointer"}};

  :hover {
    background-color: ${e=>{let{cancelHover:t,theme:n}=e;return t?"inherit":n.colors.grayscale.light4}};
  }

  :active {
    background-color: ${e=>{let{cancelHover:t,theme:n}=e;return t?"inherit":n.colors.grayscale.light3}};
  }
`,A=l.iK.button`
  display: flex;
  align-items: center;
  justify-content: center;
  height: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
  width: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;
  padding: 0;
  background-color: ${e=>{let{theme:t}=e;return t.colors.primary.dark1}};
  border: none;
  border-radius: 2px;

  :disabled {
    cursor: not-allowed;
    background-color: ${e=>{let{theme:t}=e;return t.colors.grayscale.light1}};
  }
`,x=e=>{let{label:t,savedMetric:n,adhocMetric:r,onRemove:d,onMoveLabel:T,onDropLabel:S,withCaret:C,isFunction:Z,type:A,index:x,isExtra:w,datasourceWarningMessage:R,tooltipTitle:I,multi:D=!0,...O}=e;const L=(0,l.Fg)(),N=(0,o.useRef)(null),M=(0,o.useRef)(null),k=null==n?void 0:n.metric_name,[,P]=(0,i.L)({accept:A,drop(){D&&(null==S||S())},hover(e,t){var n;if(!D)return;if(!N.current)return;const r=e.index,a=x;if(r===a)return;const o=null==(n=N.current)?void 0:n.getBoundingClientRect(),i=(o.bottom-o.top)/2,s=t.getClientOffset(),l=null!=s&&s.y?(null==s?void 0:s.y)-o.top:0;r<a&&l<i||r>a&&l>i||(null==T||T(r,a),e.index=a)}}),[{isDragging:F},U]=(0,s.c)({item:{type:A,index:x,value:null!=n&&n.metric_name?n:r},collect:e=>({isDragging:e.isDragging()})});return U(P(N)),(0,m.tZ)(g,{ref:N},(0,m.tZ)(f,a()({withCaret:C},O),(0,m.tZ)(y,{role:"button",onClick:d},(0,m.tZ)(p.Z.XSmall,{iconColor:L.colors.grayscale.light1})),(0,m.tZ)(v,null,Z&&(0,m.tZ)(p.Z.FieldDerived,null),(()=>{const e=!F&&"string"==typeof t&&I&&t&&I!==t||!F&&M&&M.current&&M.current.scrollWidth>M.current.clientWidth;return n&&k?(0,m.tZ)(h.B,{metric:n,labelRef:M,shouldShowTooltip:!F}):e?(0,m.tZ)(u.u,{title:I||t},(0,m.tZ)(_,{ref:M},t)):(0,m.tZ)(_,{ref:M},t)})()),(!!R||w)&&(0,m.tZ)(E,{icon:"exclamation-triangle",placement:"top",bsStyle:"warning",tooltip:R||(0,c.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),C&&(0,m.tZ)(b,null,(0,m.tZ)(p.Z.CaretRight,{iconColor:L.colors.grayscale.light1}))))}},79684:(e,t,n)=>{"use strict";n.d(t,{Z:()=>h});var r=n(67294),a=n(99298),o=n(75294),i=n(23279),s=n.n(i),l=n(27600),c=n(82342),d=n(9875),u=n(11965);const p=e=>null==e?"":String(e);class h extends r.Component{constructor(e){super(e),this.initialValue=void 0,this.onChange=e=>{var t,n;let r=e;const i=[];if(""!==e&&this.props.isFloat){const t=(0,a.Z)(e);t?i.push(t):r=e.match(/.*([.0])$/g)?e:parseFloat(e)}if(""!==e&&this.props.isInt){const t=(0,o.Z)(e);t?i.push(t):r=parseInt(e,10)}null==(t=(n=this.props).onChange)||t.call(n,r,i)},this.debouncedOnChange=s()((e=>{this.onChange(e)}),l.oP),this.onChangeWrapper=e=>{const{value:t}=e.target;this.setState({value:t},(()=>{this.debouncedOnChange(t)}))},this.initialValue=e.value,this.state={value:p(this.initialValue)}}render(){let{value:e}=this.state;return this.initialValue!==this.props.value&&(this.initialValue=this.props.value,e=p(this.props.value)),(0,u.tZ)("div",null,(0,u.tZ)(c.Z,this.props),(0,u.tZ)(d.II,{type:"text",placeholder:this.props.placeholder,onChange:this.onChangeWrapper,onFocus:this.props.onFocus,value:e,disabled:this.props.disabled,"aria-label":this.props.label}))}}},85626:(e,t,n)=>{"use strict";n.d(t,{Z:()=>f}),n(67294);var r=n(51995),a=n(42110),o=n(120),i=n(13433),s=n(50909),l=n(53459),c=n(49889),d=n(33743),u=n(22489),p=n(11965);const h=(0,r.iK)(s.qi)`
  && {
    margin: 0 0 ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  }
`;a.Z.registerLanguage("markdown",l.Z),a.Z.registerLanguage("html",c.Z),a.Z.registerLanguage("sql",d.Z),a.Z.registerLanguage("json",u.Z);const m=r.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,g=(0,r.iK)(a.Z)`
  flex: 1;
`,f=e=>{const{sql:t,language:n="sql"}=e;return(0,p.tZ)(m,{key:t},(0,p.tZ)(i.Z,{text:t,shouldShowText:!1,copyNode:(0,p.tZ)(h,{buttonSize:"xsmall"},(0,p.tZ)("i",{className:"fa fa-clipboard"}))}),(0,p.tZ)(g,{language:n,style:o.Z},t))}},13284:(e,t,n)=>{"use strict";n.d(t,{UB:()=>A,ZP:()=>W});var r,a=n(5872),o=n.n(a),i=n(78580),s=n.n(i),l=n(67294),c=n(74221),d=n(94184),u=n.n(d),p=n(55867),h=n(51995),m=n(11965),g=n(16355),f=n(4715),v=n(58593),_=n(9875),b=n(37921),y=n(14278),E=n(70163),T=n(1510),S=n(64239);!function(e){e.ALL_CHARTS="ALL_CHARTS",e.CATEGORY="CATEGORY",e.TAGS="TAGS",e.RECOMMENDED_TAGS="RECOMMENDED_TAGS"}(r||(r={}));const C=["line","big_number","big_number_total","table","pivot_table_v2","echarts_timeseries_line","echarts_area","echarts_timeseries_bar","echarts_timeseries_scatter","pie","mixed_timeseries","filter_box","dist_bar","area","bar","deck_polygon","time_table","histogram","deck_scatter","deck_hex","time_pivot","deck_arc","heatmap","deck_grid","deck_screengrid","treemap_v2","box_plot","sunburst","sankey","word_cloud","mapbox","kepler","cal_heatmap","rose","bubble","deck_geojson","horizon","deck_multi","compare","partition","event_flow","deck_path","graph_chart","world_map","paired_ttest","para","country_map"],Z=new Set(C),A=1090,x=(0,p.t)("Other"),w=(0,p.t)("All charts"),R=[(0,p.t)("Popular"),(0,p.t)("ECharts"),(0,p.t)("Advanced-Analytics")],I=h.iK.div`
  ${e=>{let{isSelectedVizMetadata:t}=e;return`\n    display: grid;\n    grid-template-rows: ${t?"auto minmax(100px, 1fr) minmax(200px, 35%)":"auto minmax(100px, 1fr)"};\n    // em is used here because the sidebar should be sized to fit the longest standard tag\n    grid-template-columns: minmax(14em, auto) 5fr;\n    grid-template-areas:\n      'sidebar search'\n      'sidebar main'\n      'details details';\n    height: 70vh;\n    overflow: auto;\n  `}}
`,D=h.iK.h3`
  margin-top: 0;
  margin-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.l}}px;
  font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
  line-height: ${e=>{let{theme:t}=e;return 6*t.gridUnit}}px;
`,O=h.iK.div`
  grid-area: sidebar;
  display: flex;
  flex-direction: column;
  border-right: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  overflow: auto;

  .ant-collapse .ant-collapse-item {
    .ant-collapse-header {
      font-size: ${e=>{let{theme:t}=e;return t.typography.sizes.s}}px;
      color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
      padding-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
      padding-bottom: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    }
    .ant-collapse-content .ant-collapse-content-box {
      display: flex;
      flex-direction: column;
      padding: 0 ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
    }
  }
`,L=h.iK.div`
  grid-area: main;
  overflow-y: auto;
`,N=h.iK.div`
  ${e=>{let{theme:t}=e;return`\n    grid-area: search;\n    margin-top: ${3*t.gridUnit}px;\n    margin-bottom: ${t.gridUnit}px;\n    margin-left: ${3*t.gridUnit}px;\n    margin-right: ${3*t.gridUnit}px;\n    .ant-input-affix-wrapper {\n      padding-left: ${2*t.gridUnit}px;\n    }\n  `}}
`,M=h.iK.div`
  display: flex;
  justify-content: center;
  align-items: center;
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
`,k=h.iK.button`
  ${e=>{let{theme:t}=e;return`\n    all: unset; // remove default button styles\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    margin: ${t.gridUnit}px 0;\n    padding: 0 ${t.gridUnit}px;\n    border-radius: ${t.borderRadius}px;\n    line-height: 2em;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    position: relative;\n\n    &:focus {\n      outline: initial;\n    }\n\n    &.selected {\n      background-color: ${t.colors.primary.base};\n      color: ${t.colors.primary.light5};\n\n      svg {\n        color: ${t.colors.primary.light5};\n      }\n\n      &:hover {\n        .cancel {\n          visibility: visible;\n        }\n      }\n    }\n\n    & span:first-of-type svg {\n      margin-top: ${1.5*t.gridUnit}px;\n    }\n\n    .cancel {\n      visibility: hidden;\n    }\n  `}}
`,P=h.iK.div`
  overflow: auto;
  display: grid;
  grid-template-columns: repeat(
    auto-fill,
    ${e=>{let{theme:t}=e;return 24*t.gridUnit}}px
  );
  grid-auto-rows: max-content;
  justify-content: space-evenly;
  grid-gap: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
  justify-items: center;
  // for some reason this padding doesn't seem to apply at the bottom of the container. Why is a mystery.
  padding: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,F=e=>m.iv`
  grid-area: details;
  border-top: 1px solid ${e.colors.grayscale.light2};
`,U=e=>m.iv`
  padding: ${4*e.gridUnit}px;
  display: grid;
  grid-template-columns: 1fr 1fr;
  grid-template-rows: auto auto 1fr;
  grid-template-areas:
    'viz-name examples-header'
    'viz-tags examples'
    'description examples';
`,$=h.iK.div`
  grid-area: viz-tags;
  width: ${e=>{let{theme:t}=e;return 120*t.gridUnit}}px;
  padding-right: ${e=>{let{theme:t}=e;return 14*t.gridUnit}}px;
  padding-bottom: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`,q=h.iK.p`
  grid-area: description;
  overflow: auto;
  padding-right: ${e=>{let{theme:t}=e;return 14*t.gridUnit}}px;
  margin: 0;
`,V=h.iK.div`
  grid-area: examples;
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  overflow: auto;
  gap: ${e=>{let{theme:t}=e;return 4*t.gridUnit}}px;

  img {
    height: 100%;
    border-radius: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    border: 1px solid ${e=>{let{theme:t}=e;return t.colors.grayscale.light2}};
  }
`,j=e=>m.iv`
  cursor: pointer;
  width: ${24*e.gridUnit}px;
  position: relative;

  img {
    min-width: ${24*e.gridUnit}px;
    min-height: ${24*e.gridUnit}px;
    border: 1px solid ${e.colors.grayscale.light2};
    border-radius: ${e.gridUnit}px;
    transition: border-color ${e.transitionTiming};
  }

  &.selected img {
    border: 2px solid ${e.colors.primary.light2};
  }

  &:hover:not(.selected) img {
    border: 1px solid ${e.colors.grayscale.light1};
  }

  .viztype-label {
    margin-top: ${2*e.gridUnit}px;
    text-align: center;
  }
`,H=h.iK.div`
  ${e=>{let{theme:t}=e;return`\n    border: 1px solid ${t.colors.primary.dark1};\n    box-sizing: border-box;\n    border-radius: ${t.gridUnit}px;\n    background: ${t.colors.grayscale.light5};\n    line-height: ${2.5*t.gridUnit}px;\n    color: ${t.colors.primary.dark1};\n    font-size: ${t.typography.sizes.s}px;\n    font-weight: ${t.typography.weights.bold};\n    text-align: center;\n    padding: ${.5*t.gridUnit}px ${t.gridUnit}px;\n    text-transform: uppercase;\n    cursor: pointer;\n\n    div {\n      transform: scale(0.83,0.83);\n    }\n  `}}
`,B=h.iK.div`
  position: absolute;
  right: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
  top: ${e=>{let{theme:t}=e;return 19*t.gridUnit}}px;
`,z=h.iK.div`
  display: inline-block !important;
  margin-left: ${e=>{let{theme:t}=e;return 2*t.gridUnit}}px;
`;function G(e){return Z.has(e.key)?C.indexOf(e.key):C.length}const Q=e=>{let{entry:t,selectedViz:n,setSelectedViz:r,onDoubleClick:a}=e;const o=(0,h.Fg)(),{key:i,value:s}=t,l=n===t.key;return(0,m.tZ)("div",{role:"button",css:j(o),tabIndex:0,className:l?"selected":"",onClick:()=>r(i),onDoubleClick:a},(0,m.tZ)("img",{alt:s.name,width:"100%",className:"viztype-selector "+(l?"selected":""),src:s.thumbnail}),(0,m.tZ)("div",{className:"viztype-label"},s.name),s.label&&(0,m.tZ)(B,null,(0,m.tZ)(H,null,(0,m.tZ)("div",null,(0,p.t)(s.label)))))},Y=e=>{let{vizEntries:t,...n}=e;return(0,m.tZ)(P,null,t.map((e=>(0,m.tZ)(Q,o()({key:e.key},n,{entry:e})))))},K=e=>{let{selector:t,sectionId:n,icon:r,isSelected:a,onClick:o,className:i}=e;const s=(0,l.useRef)(null);return(0,l.useEffect)((()=>{a&&queueMicrotask((()=>(0,S.default)(s.current,{behavior:"smooth",scrollMode:"if-needed"})))}),[]),(0,m.tZ)(k,{ref:s,key:t,name:t,className:u()(i,a&&"selected"),onClick:()=>o(t,n)},r,t)};function W(e){var t,n;const{selectedViz:a,onChange:o,onDoubleClick:i,className:d}=e,{mountedPluginMetadata:u}=(0,y.gp)(),h=(0,l.useRef)(),[S,C]=(0,l.useState)(""),[Z,A]=(0,l.useState)(!0),k=Z&&!!S,P=a?u[a]:null,j=(0,l.useMemo)((()=>{const t=Object.entries(u).map((e=>{let[t,n]=e;return{key:t,value:n}})).filter((t=>{var n;let{key:r}=t;return!s()(n=e.denyList).call(n,r)})).filter((e=>{let{value:t}=e;return(0,T.X3)(t.behaviors||[])&&!t.deprecated}));return t.sort(((e,t)=>G(e)-G(t))),t}),[u]),B=(0,l.useMemo)((()=>{const e={};return j.forEach((t=>{const n=t.value.category||x;e[n]||(e[n]=[]),e[n].push(t)})),e}),[j]),Q=(0,l.useMemo)((()=>Object.keys(B).sort(((e,t)=>e===x?1:t===x?-1:e.localeCompare(t)))),[B]),W=(0,l.useMemo)((()=>{const e={};return j.forEach((t=>{(t.value.tags||[]).forEach((n=>{e[n]||(e[n]=[]),e[n].push(t)}))})),e}),[j]),J=(0,l.useMemo)((()=>Object.keys(W).sort(((e,t)=>e.localeCompare(t))).filter((e=>-1===R.indexOf(e)))),[W]),X=(0,l.useMemo)((()=>j.sort(((e,t)=>e.key.localeCompare(t.key)))),[j]),[ee,te]=(0,l.useState)((()=>(null==P?void 0:P.category)||R[0])),[ne,re]=(0,l.useState)((()=>null!=P&&P.category?r.CATEGORY:r.RECOMMENDED_TAGS)),ae=(0,l.useMemo)((()=>new c.Z(j,{ignoreLocation:!0,threshold:.3,keys:[{name:"value.name",weight:4},{name:"value.tags",weight:2},"value.description"]})),[j]),oe=(0,l.useMemo)((()=>""===S.trim()?[]:ae.search(S).map((e=>e.item)).sort(((e,t)=>{var n,r;const a=null==(n=e.value)?void 0:n.label,o=null==(r=t.value)?void 0:r.label,i=a&&g.eH[a]?g.eH[a].weight:0;return(o&&g.eH[o]?g.eH[o].weight:0)-i}))),[S,ae]),ie=(0,l.useCallback)((()=>{A(!0)}),[]),se=(0,l.useCallback)((e=>C(e.target.value)),[]),le=(0,l.useCallback)((()=>{A(!1),C(""),h.current.blur()}),[]),ce=(0,l.useCallback)(((e,t)=>{Z&&le(),te(e),re(t);const n=P&&((e,t)=>t===e.category||t===x&&null==e.category||(e.tags||[]).indexOf(t)>-1)(P,e);e===ee||n||o(null)}),[le,Z,ee,P,o]),de=(0,l.useMemo)((()=>({[r.RECOMMENDED_TAGS]:{title:(0,p.t)("Recommended tags"),icon:(0,m.tZ)(E.Z.Tags,null),selectors:R},[r.CATEGORY]:{title:(0,p.t)("Category"),icon:(0,m.tZ)(E.Z.Category,null),selectors:Q},[r.TAGS]:{title:(0,p.t)("Tags"),icon:(0,m.tZ)(E.Z.Tags,null),selectors:J}})),[Q,J]);return(0,m.tZ)(I,{className:d,isSelectedVizMetadata:Boolean(P)},(0,m.tZ)(O,null,(0,m.tZ)(K,{css:e=>{let{gridUnit:t}=e;return m.iv`
              margin: ${2*t}px;
              margin-bottom: 0;
            `},sectionId:r.ALL_CHARTS,selector:w,icon:(0,m.tZ)(E.Z.Ballot,null),isSelected:!k&&w===ee&&r.ALL_CHARTS===ne,onClick:ce}),(0,m.tZ)(f.Ol,{expandIconPosition:"right",ghost:!0,defaultActiveKey:Object.keys(de)},Object.keys(de).map((e=>{const t=de[e];return(0,m.tZ)(f.Ol.Panel,{header:(0,m.tZ)("span",{className:"header"},t.title),key:e},t.selectors.map((n=>(0,m.tZ)(K,{key:n,selector:n,sectionId:e,icon:t.icon,isSelected:!k&&n===ee&&e===ne,onClick:ce}))))})))),(0,m.tZ)(N,null,(0,m.tZ)(_.II,{type:"text",ref:h,value:S,placeholder:(0,p.t)("Search all charts"),onChange:se,onFocus:ie,prefix:(0,m.tZ)(M,null,(0,m.tZ)(E.Z.Search,{iconSize:"m"})),suffix:(0,m.tZ)(M,null,S&&(0,m.tZ)(E.Z.XLarge,{iconSize:"m",onClick:le}))})),(0,m.tZ)(L,null,(0,m.tZ)(Y,{vizEntries:k?oe:ee===w&&ne===r.ALL_CHARTS?X:ne===r.CATEGORY&&B[ee]?B[ee]:ne!==r.TAGS&&ne!==r.RECOMMENDED_TAGS||!W[ee]?[]:W[ee],selectedViz:a,setSelectedViz:o,onDoubleClick:i})),P?(0,m.tZ)("div",{css:e=>[F(e),U(e)]},(0,m.tZ)(l.Fragment,null,(0,m.tZ)(D,{css:m.iv`
                grid-area: viz-name;
                position: relative;
              `},null==P?void 0:P.name,(null==P?void 0:P.label)&&(0,m.tZ)(v.u,{id:"viz-badge-tooltip",placement:"top",title:null!=(t=P.labelExplanation)?t:g.t$[P.label]},(0,m.tZ)(z,null,(0,m.tZ)(H,null,(0,m.tZ)("div",null,(0,p.t)(P.label)))))),(0,m.tZ)($,null,null==P?void 0:P.tags.map((e=>(0,m.tZ)(b.Z,{key:e},e)))),(0,m.tZ)(q,null,(null==P?void 0:P.description)||(0,p.t)("No description available.")),(0,m.tZ)(D,{css:m.iv`
                grid-area: examples-header;
              `},!(null==P||null==(n=P.exampleGallery)||!n.length)&&(0,p.t)("Examples")),(0,m.tZ)(V,null,((null==P?void 0:P.exampleGallery)||[]).map((e=>(0,m.tZ)("img",{src:e.url,alt:e.caption,title:e.caption})))))):null)}},99963:(e,t,n)=>{"use strict";n.d(t,{B:()=>l,l:()=>c}),n(67294);var r=n(51995),a=n(51384),o=n(65634),i=n(11965);const s=r.iK.div`
  width: 100%;
  > span {
    display: flex;
    align-items: center;
  }

  .option-label {
    display: inline-block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    & ~ i {
      margin-left: ${e=>{let{theme:t}=e;return t.gridUnit}}px;
    }
  }
  .type-label {
    margin-right: ${e=>{let{theme:t}=e;return 3*t.gridUnit}}px;
    width: ${e=>{let{theme:t}=e;return 7*t.gridUnit}}px;
    display: inline-block;
    text-align: center;
    font-weight: ${e=>{let{theme:t}=e;return t.typography.weights.bold}};
  }
`,l=e=>(0,i.tZ)(s,null,(0,i.tZ)(a.m,e)),c=e=>(0,i.tZ)(s,null,(0,i.tZ)(o.E,e))},69856:(e,t,n)=>{"use strict";n.d(t,{Ak:()=>c,GS:()=>l,H7:()=>_,LT:()=>s,Ps:()=>o,Q_:()=>h,YY:()=>a,cM:()=>f,d:()=>i,ft:()=>g,i2:()=>v,kc:()=>b,m_:()=>m,qB:()=>u,qK:()=>d,xA:()=>y,yi:()=>p});var r=n(55867);const a={AVG:"AVG",COUNT:"COUNT",COUNT_DISTINCT:"COUNT_DISTINCT",MAX:"MAX",MIN:"MIN",SUM:"SUM"},o=Object.values(a);var i;!function(e){e.EQUALS="EQUALS",e.NOT_EQUALS="NOT_EQUALS",e.LESS_THAN="LESS_THAN",e.LESS_THAN_OR_EQUAL="LESS_THAN_OR_EQUAL",e.GREATER_THAN="GREATER_THAN",e.GREATER_THAN_OR_EQUAL="GREATER_THAN_OR_EQUAL",e.IN="IN",e.NOT_IN="NOT_IN",e.LIKE="LIKE",e.ILIKE="ILIKE",e.IS_NOT_NULL="IS_NOT_NULL",e.IS_NULL="IS_NULL",e.LATEST_PARTITION="LATEST_PARTITION",e.IS_TRUE="IS_TRUE",e.IS_FALSE="IS_FALSE",e.TEMPORAL_RANGE="TEMPORAL_RANGE"}(i||(i={}));const s={[i.EQUALS]:{display:(0,r.t)("Equal to (=)"),operation:"=="},[i.NOT_EQUALS]:{display:(0,r.t)("Not equal to ()"),operation:"!="},[i.LESS_THAN]:{display:(0,r.t)("Less than (<)"),operation:"<"},[i.LESS_THAN_OR_EQUAL]:{display:(0,r.t)("Less or equal (<=)"),operation:"<="},[i.GREATER_THAN]:{display:(0,r.t)("Greater than (>)"),operation:">"},[i.GREATER_THAN_OR_EQUAL]:{display:(0,r.t)("Greater or equal (>=)"),operation:">="},[i.IN]:{display:(0,r.t)("In"),operation:"IN"},[i.NOT_IN]:{display:(0,r.t)("Not in"),operation:"NOT IN"},[i.LIKE]:{display:(0,r.t)("Like"),operation:"LIKE"},[i.ILIKE]:{display:(0,r.t)("Like (case insensitive)"),operation:"ILIKE"},[i.IS_NOT_NULL]:{display:(0,r.t)("Is not null"),operation:"IS NOT NULL"},[i.IS_NULL]:{display:(0,r.t)("Is null"),operation:"IS NULL"},[i.LATEST_PARTITION]:{display:(0,r.t)("use latest_partition template"),operation:"LATEST PARTITION"},[i.IS_TRUE]:{display:(0,r.t)("Is true"),operation:"=="},[i.IS_FALSE]:{display:(0,r.t)("Is false"),operation:"=="},[i.TEMPORAL_RANGE]:{display:(0,r.t)("TEMPORAL_RANGE"),operation:"TEMPORAL_RANGE"}},l=Object.values(i),c=(i.LIKE,i.ILIKE,[i.EQUALS,i.NOT_EQUALS,i.LESS_THAN,i.LESS_THAN_OR_EQUAL,i.GREATER_THAN,i.GREATER_THAN_OR_EQUAL]),d=new Set([i.IN,i.NOT_IN]),u=new Set([i.LATEST_PARTITION,i.TEMPORAL_RANGE]),p=[i.IS_NOT_NULL,i.IS_NULL,i.LATEST_PARTITION,i.IS_TRUE,i.IS_FALSE],h=/^(LONG|DOUBLE|FLOAT)?(SUM|AVG|MAX|MIN|COUNT)\([A-Z0-9_."]*\)$/i,m={time_range:(0,r.t)("Time range"),granularity_sqla:(0,r.t)("Time column"),time_grain_sqla:(0,r.t)("Time grain"),granularity:(0,r.t)("Time granularity")},g={CLEARABLE:"clearable",DEFAULT_VALUE:"defaultValue",MULTIPLE:"multiple",SEARCH_ALL_OPTIONS:"searchAllOptions",SORT_ASCENDING:"asc",SORT_METRIC:"metric"},f=1e3,v={time_range:"__time_range",granularity_sqla:"__time_col",time_grain_sqla:"__time_grain",granularity:"__granularity"},_=240,b=320,y=0},10331:(e,t,n)=>{"use strict";n.d(t,{os:()=>U,RO:()=>C,mi:()=>A,Bx:()=>T,vP:()=>Z,YY:()=>D,Hu:()=>x,Bq:()=>y});var r={};n.r(r),n.d(r,{NVD3TimeSeries:()=>_,annotations:()=>v,colorScheme:()=>g,datasourceAndVizType:()=>m,sqlaTimeSeries:()=>f});var a=n(78580),o=n.n(a),i=n(30845),s=n(46078),l=n(37687),c=n(38575),d=n(89368),u=(n(67294),n(55867)),p=n(46666),h=n(11965);const m={controlSetRows:[["datasource"],["viz_type"],[{name:"slice_id",config:{type:"HiddenControl",label:(0,u.t)("Chart ID"),hidden:!0,description:(0,u.t)("The id of the active chart")}},{name:"cache_timeout",config:{type:"HiddenControl",label:(0,u.t)("Cache Timeout (seconds)"),hidden:!0,description:(0,u.t)("The number of seconds before expiring the cache")}},{name:"url_params",config:{type:"HiddenControl",label:(0,u.t)("URL parameters"),hidden:!0,description:(0,u.t)("Extra parameters for use in jinja templated queries")}}]]},g={label:(0,u.t)("Color scheme"),controlSetRows:[["color_scheme"]]},f={label:(0,u.t)("Time"),description:(0,u.t)("Time related form attributes"),expanded:!0,controlSetRows:[["granularity_sqla"],["time_range"]]},v={label:(0,u.t)("Annotations and layers"),tabOverride:"data",expanded:!0,controlSetRows:[[{name:"annotation_layers",config:{type:"AnnotationLayerControl",label:"",default:[],description:(0,u.t)("Annotation layers"),renderTrigger:!0,tabOverride:"data"}}]]},_=[{label:(0,u.t)("Query"),expanded:!0,controlSetRows:[["metrics"],["adhoc_filters"],["groupby"],["limit","timeseries_limit_metric"],["order_desc"],[{name:"contribution",config:{type:"CheckboxControl",label:(0,u.t)("Contribution"),default:!1,description:(0,u.t)("Compute the contribution to the total")}}],["row_limit",null]]},{label:(0,u.t)("Advanced analytics"),tabOverride:"data",description:(0,u.t)("This section contains options that allow for advanced analytical post processing of query results"),controlSetRows:[[(0,h.tZ)(p.U,null,(0,u.t)("Rolling window"))],[{name:"rolling_type",config:{type:"SelectControl",label:(0,u.t)("Rolling function"),default:"None",choices:[["None",(0,u.t)("None")],["mean",(0,u.t)("mean")],["sum",(0,u.t)("sum")],["std",(0,u.t)("std")],["cumsum",(0,u.t)("cumsum")]],description:(0,u.t)("Defines a rolling window function to apply, works along with the [Periods] text box")}},{name:"rolling_periods",config:{type:"TextControl",label:(0,u.t)("Periods"),isInt:!0,description:(0,u.t)("Defines the size of the rolling window function, relative to the time granularity selected")}},{name:"min_periods",config:{type:"TextControl",label:(0,u.t)("Min periods"),isInt:!0,description:(0,u.t)('The minimum number of rolling periods required to show a value. For instance if you do a cumulative sum on 7 days you may want your "Min Period" to be 7, so that all data points shown are the total of 7 periods. This will hide the "ramp up" taking place over the first 7 periods')}}],[(0,h.tZ)(p.U,null,(0,u.t)("Time comparison"))],[{name:"time_compare",config:{type:"SelectControl",multi:!0,freeForm:!0,label:(0,u.t)("Time shift"),choices:[["1 day",(0,u.t)("1 day")],["1 week",(0,u.t)("1 week")],["28 days",(0,u.t)("28 days")],["30 days",(0,u.t)("30 days")],["52 weeks",(0,u.t)("52 weeks")],["1 year",(0,u.t)("1 year")],["104 weeks",(0,u.t)("104 weeks")],["2 years",(0,u.t)("2 years")],["156 weeks",(0,u.t)("156 weeks")],["3 years",(0,u.t)("3 years")]],description:(0,u.t)("Overlay one or more timeseries from a relative time period. Expects relative time deltas in natural language (example: 24 hours, 7 days, 52 weeks, 365 days). Free text is supported.")}},{name:"comparison_type",config:{type:"SelectControl",label:(0,u.t)("Calculation type"),default:"values",choices:[["values",(0,u.t)("Actual values")],["absolute",(0,u.t)("Difference")],["percentage",(0,u.t)("Percentage change")],["ratio",(0,u.t)("Ratio")]],description:(0,u.t)("How to display time shifts: as individual lines; as the difference between the main time series and each time shift; as the percentage change; or as the ratio between series and time shifts.")}}],[(0,h.tZ)(p.U,null,(0,u.t)("Resample"))],[{name:"resample_rule",config:{type:"SelectControl",freeForm:!0,label:(0,u.t)("Rule"),default:null,choices:[["1T",(0,u.t)("1T")],["1H",(0,u.t)("1H")],["1D",(0,u.t)("1D")],["7D",(0,u.t)("7D")],["1M",(0,u.t)("1M")],["1AS",(0,u.t)("1AS")]],description:(0,u.t)("Pandas resample rule")}},{name:"resample_method",config:{type:"SelectControl",freeForm:!0,label:(0,u.t)("Method"),default:null,choices:[["asfreq",(0,u.t)("asfreq")],["bfill",(0,u.t)("bfill")],["ffill",(0,u.t)("ffill")],["median",(0,u.t)("median")],["mean",(0,u.t)("mean")],["sum",(0,u.t)("sum")]],description:(0,u.t)("Pandas resample method")}}]]}],b=(0,i.Z)(((e,t)=>{const{sectionOverrides:n={},controlOverrides:a,controlPanelSections:i=[]}=t,l={...r};Object.entries(n).forEach((e=>{let[t,n]=e;"object"==typeof n&&n.constructor===Object?l[t]={...l[t],...n}:l[t]=n}));const{datasourceAndVizType:u}=l,p=[s.i9.Query,s.i9.Table],h=o()(p).call(p,e)?["granularity"]:["granularity_sqla","time_grain_sqla"];return[u].concat(i.filter(c.D_)).map((e=>{const{controlSetRows:t}=e;return{...e,controlSetRows:(null==t?void 0:t.map((e=>e.filter((e=>"string"!=typeof e||!o()(h).call(h,e))).map((e=>(0,d.q)(e,a))))))||[]}}))}));function y(e,t){const n=(0,l.Z)().get(e)||{};return b(t,n)}const E=(0,i.Z)(((e,t)=>{const{controlOverrides:n={},controlPanelSections:r=[]}=t,a=(0,d.q)(function(e,t){var n;return null!=(n=e.filter(c.D_).map((e=>e.controlSetRows)).flat(2).find((e=>t===e||null!==e&&"object"==typeof e&&"name"in e&&e.name===t)))?n:null}(r,e),n);return a&&"config"in a?a.config:a})),T=function(e,t){const n=(0,l.Z)().get(t)||{};return E(e,n)};var S=n(55786);function C(e,t){const{mapStateToProps:n}=e;let r={...e},{value:a}=r;return n&&t&&(r={...e,...n.call(e,t,e)},a=a||r.value),"function"==typeof r.initialValue&&(r.initialValue=r.initialValue(r,t),"function"==typeof r.initialValue&&delete r.initialValue),r.initialValue&&(a=r.initialValue,delete r.initialValue),"function"==typeof r.default&&(r.default=r.default(r,t),"function"==typeof r.default&&delete r.default),r.default&&void 0===a&&(a=r.default),a&&r.multi&&!Array.isArray(a)&&(a=[a]),r.value=a,function(e,t){const n=e.validators,{externalValidationErrors:r=[]}=e,a=[];n&&n.length>0&&n.forEach((n=>{const r=n.call(e,e.value,t);r&&a.push(r)}));const o=[...a,...r];return{...e,validationErrors:o}}(function(e){if("SelectControl"===e.type&&!e.freeForm&&e.choices&&e.value){const t={...e},n=e.choices,r=(0,S.Z)(e.value),a=n.map((e=>e[0]));if(e.multi&&r.length>0)return t.value=r.filter((e=>o()(a).call(a,e))),t;if(!e.multi&&!o()(a).call(a,r[0]))return t.value=null,t}return e}(r),r)}function Z(e,t,n){if(!e)return null;const r={...e,value:n};return null!=t&&t.controls||null===t?C(r,t):r}function A(e,t,n,r){const a={};return y(e,t).forEach((e=>e.controlSetRows.forEach((e=>e.forEach((e=>{if(null!=e&&e.config&&e.name){const{config:t,name:o}=e;a[o]=Z(t,n,r[o])}})))))),a}function x(e){const t={};return Object.keys(e).forEach((n=>{const r=e[n];t[n]=r.value})),t}var w=n(62446),R=n(46306);const I=(e,t,n)=>t.options&&"string"==typeof n&&t.options.some((e=>Array.isArray(e)?e[0]===n:e.column_name===n))?e.columns.some((e=>e.column_name===n)):t.savedMetrics&&(0,w.AG)(n)&&t.savedMetrics.some((e=>e.metric_name===n))?e.metrics.some((e=>e.metric_name===n)):t.columns&&((0,w.nX)(n)||(0,R.Ki)(n))&&t.columns.some((e=>{var t;return e.column_name===(null==(t=n.column)?void 0:t.column_name)||e.column_name===n.subject}))?e.columns.some((e=>{var t;return e.column_name===(null==(t=n.column)?void 0:t.column_name)||e.column_name===n.subject})):!!(0,w.q5)(n)&&(Object.assign(n,{datasourceWarning:!0}),!0),D=(e,t,n)=>{if(null!=n){if(Array.isArray(n)){const r=n.filter((n=>I(e,t,n)));return r.length>0?r:t.default}return I(e,t,n)?n:t.default}};var O=n(57557),L=n.n(O),N=n(20002),M=n(35854);const k=["metric","metrics","metric_2","size","x","y","secondary_metric"],P=["groupby","columns","groupbyColumns","groupbyRows","entity","series","series_columns"],F=["granularity_sqla","time_grain_sqla","time_range","adhoc_filters","limit","timeseries_limit_metric","series_limit_metric","order_desc","row_limit","x_axis","rolling_type","rolling_periods","min_periods","time_compare","comparison_type","resample_rule","resample_method"];class U{constructor(e){var t,n;this.sfd=void 0;const r=Object.freeze(e),a=null==r||null==(t=r.standardizedFormData)?void 0:t.memorizedFormData,o=r.viz_type;let i,s=new Map;if(Array.isArray(a)&&a.length>0&&r.datasource===(null==(n=a.slice(-1)[0][1])?void 0:n.datasource))s=new Map(r.standardizedFormData.memorizedFormData),s.has(o)&&s.delete(o),s.set(o,r),i=U.getStandardizedControls(r);else{const e=L()(r,"standardizedFormData");s.set(o,e),i=U.getStandardizedControls(e)}this.sfd={controls:i,memorizedFormData:s}}static getStandardizedControls(e){const t={metrics:[],columns:[]};if(Object.entries(e).forEach((e=>{let[n,r]=e;o()(k).call(k,n)&&t.metrics.push(...(0,S.Z)(r)),o()(P).call(P,n)&&t.columns.push(...(0,S.Z)(r))})),(0,c.pp)(e)){const{metrics:n,columns:r}=e.standardizedFormData.controls;t.metrics.push(...n),t.columns.push(...r)}return t}getLatestFormData(e){return this.has(e)?this.get(e):this.memorizedFormData.slice(-1)[0][1]}get standardizedControls(){return this.sfd.controls}get memorizedFormData(){return Array.from(this.sfd.memorizedFormData.entries())}serialize(){return{controls:this.standardizedControls,memorizedFormData:this.memorizedFormData}}has(e){return this.sfd.memorizedFormData.has(e)}get(e){return this.sfd.memorizedFormData.get(e)}transform(e,t){const n=this.getLatestFormData(e),r={};F.forEach((e=>{e in t.form_data&&(r[e]=t.form_data[e])}));const a=(0,M.R3)(t,{...n,...r,viz_type:e}),o={...x(a),standardizedFormData:this.serialize()};let i={formData:o,controlsState:a};const s=(0,l.Z)().get(e);if(null!=s&&s.formDataOverrides){(0,N.u)().setStandardizedControls(o);const e={...s.formDataOverrides(o),standardizedFormData:{controls:{...(0,N.u)().controls},memorizedFormData:this.memorizedFormData}};(0,N.u)().clear(),i={formData:e,controlsState:(0,M.R3)(t,e)}}return i.controlsState=(0,M.R3)({...t,controls:i.controlsState},i.formData),i}}},40219:(e,t,n)=>{"use strict";n.d(t,{BR:()=>s,LW:()=>u,nv:()=>d});var r=n(57557),a=n.n(r),o=n(31069);const i=["url_params"],s=e=>a()(e,i),l=(e,t)=>{let n="api/v1/explore/form_data";return e&&(n=n.concat(`/${e}`)),t&&(n=n.concat(`?tab_id=${t}`)),n},c=(e,t,n,r)=>{const a={datasource_id:e,datasource_type:t,form_data:JSON.stringify(s(n))};return r&&(a.chart_id=r),a},d=(e,t,n,r,a)=>o.Z.post({endpoint:l(void 0,a),jsonPayload:c(e,t,n,r)}).then((e=>e.json.key)),u=(e,t,n,r,a,i)=>o.Z.put({endpoint:l(n,i),jsonPayload:c(e,t,r,a)}).then((e=>e.json.message))},33228:(e,t,n)=>{"use strict";n.d(t,{IV:()=>a,dY:()=>o,iX:()=>i,mI:()=>s});var r=n(55867);const a=25,o=[{id:"changed_on_delta_humanized",desc:!0}],i=(0,r.t)('The passwords for the databases below are needed in order to import them together with the datasets. Please note that the "Secure Extra" and "Certificate" sections of the database configuration are not present in export files, and should be added manually after the import if they are needed.'),s=(0,r.t)("You are importing one or more datasets that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?")},39589:(e,t,n)=>{"use strict";var r,a;n.d(t,{Z:()=>a,g:()=>r}),function(e){e.Charts="CHARTS",e.Dashboards="DASHBOARDS",e.Recents="RECENTS",e.SavedQueries="SAVED_QUERIES"}(r||(r={})),function(e){e.GOOGLE_SHEETS="gsheets",e.DB_CONNECTION="dbconnection",e.DATASET_CREATION="datasetCreation"}(a||(a={}))},42190:(e,t,n)=>{"use strict";n.d(t,{l6:()=>s,ni:()=>r,s_:()=>c});var r,a=n(22102),o=n(67294);!function(e){e.LOADING="loading",e.COMPLETE="complete",e.ERROR="error"}(r||(r={}));const i={status:r.LOADING,result:null,error:null};function s(e,t){return(0,o.useMemo)((()=>{if(e.status!==r.COMPLETE)return e;try{return{...e,result:t(e.result)}}catch(e){return{status:r.ERROR,result:null,error:e}}}),[e,t])}const l=e=>e.result;function c(e){return s(function(e){const[t,n]=(0,o.useState)(i),s=(0,o.useRef)((()=>{}));return(0,o.useEffect)((()=>{n(i),s.current();let t=!1;return s.current=()=>{t=!0},(0,a.Z)({method:"GET",endpoint:e})({}).then((e=>{t||n({status:r.COMPLETE,result:e,error:null})})).catch((e=>{t||n({status:r.ERROR,result:null,error:e})})),()=>{t=!0}}),[e]),t}(e),l)}},10362:(e,t,n)=>{"use strict";n.d(t,{h:()=>l});var r=n(15926),a=n.n(r),o=n(98286),i=n(30848),s=n(31069);const l=(0,i.LC)({reducerPath:"queryApi",tagTypes:["Schemas","Tables","DatabaseFunctions","QueryValidations","TableMetadatas"],endpoints:()=>({}),baseQuery:(e,t)=>{let{endpoint:n,urlParams:r,transformResponse:i,method:l="GET",parseMethod:c="json",...d}=e;return s.Z.request({...d,endpoint:`${n}${r?`?q=${a().encode(r)}`:""}`,method:l,parseMethod:c,signal:t.signal}).then((e=>{var t;return{data:null!=(t=null==i?void 0:i(e))?t:e}})).catch((e=>(0,o.O$)(e).then((e=>({error:e})))))}})},38325:(e,t,n)=>{"use strict";n.d(t,{Z:()=>a});var r=n(97654);function a(e){return(0,r.Z)(e)}},3741:(e,t,n)=>{"use strict";n.d(t,{$b:()=>s,Eh:()=>y,Ep:()=>d,Ev:()=>o,FY:()=>b,H3:()=>p,Im:()=>w,Iq:()=>l,P$:()=>T,PC:()=>g,Ph:()=>_,Qg:()=>v,S:()=>h,TA:()=>E,TD:()=>c,TG:()=>O,TY:()=>N,W9:()=>r,Wl:()=>i,Yd:()=>M,ZX:()=>x,aD:()=>a,br:()=>f,g3:()=>I,kV:()=>S,n2:()=>Z,oK:()=>m,qL:()=>D,vH:()=>u,xD:()=>L,xE:()=>A,yw:()=>C,zf:()=>R});const r="load_chart",a="render_chart",o="hide_browser_tab",i="mount_dashboard",s="mount_explorer",l="select_dashboard_tab",c="force_refresh_chart",d="change_explore_controls",u="toggle_edit_dashboard",p="force_refresh_dashboard",h="periodic_render_dashboard",m="explore_dashboard_chart",g="export_csv_dashboard_chart",f="export_xlsx_dashboard_chart",v="change_dashboard_filter",_="dataset_creation_empty_cancellation",b="dataset_creation_database_cancellation",y="dataset_creation_schema_cancellation",E="dataset_creation_table_cancellation",T="dataset_creation_success",S="spa_navigation",C="confirm_overwrite_dashboard_metadata",Z="dashboard_download_as_image",A="chart_download_as_image",x="sqllab_warn_local_storage_usage",w="sqllab_fetch_failed_query",R="drill_by_modal_opened",I="further_drill_by",D="drill_by_edit_chart",O="drill_by_breadcrumb_clicked",L="sqllab_monitor_local_storage_usage",N=new Set([r,a,o,w]),M=(new Set([i,l,m,c,g,v,d,u,p,h,s,C,Z,A]),{timeOriginOffset:0,markTimeOrigin(){this.timeOriginOffset=window.performance.now()},getTimestamp(){return Math.round(window.performance.now()-this.timeOriginOffset)}})},97381:(e,t,n)=>{"use strict";n.r(t),n.d(t,{LOG_EVENT:()=>r,logEvent:()=>a});const r="LOG_EVENT";function a(e,t){return n=>n({type:r,payload:{eventName:e,eventData:t}})}},77997:(e,t,n)=>{"use strict";n.d(t,{YJ:()=>b});var r=n(31069),a=n(55786),o=n(68492),i=n(22102),s=n(93185),l=n(20292),c=n(98286);const d="polling",u="last_async_event_id";let p,h,m,g,f,v,_;const b=async e=>new Promise(((t,n)=>{const i=e.job_id;var s;s=async e=>{switch(e.status){case"done":{let{data:o,status:i}=await(async e=>{let t,n="success";try{const{json:n}=await r.Z.get({endpoint:String(e.result_url)});t="result"in n?n.result:n}catch(e){n="error",t=await(0,c.O$)(e)}return{status:n,data:t}})(e);o=(0,a.Z)(o),"success"===i?t(o):n(o);break}case"error":{const t=(0,c.MV)(e);n(t);break}default:o.Z.warn("received event with status",e.status)}var s;f[s=i]&&delete f[s]},f[i]=s})),y=(0,i.Z)({method:"GET",endpoint:"/api/v1/async_event/"}),E=async e=>{e.forEach((e=>{const t=e.job_id,n=f[t];n?(n(e),delete v[t]):(v[t]||(v[t]=0),v[t]+=1,v[t]<=6?setTimeout((()=>{E([e])}),100*v[t]):(delete v[t],o.Z.warn("listener not found for job_id",e.job_id))),(e=>{_=e.id;try{localStorage.setItem(u,_)}catch(e){o.Z.warn("Error saving event Id to localStorage",e)}})(e)}))},T=async()=>{const e=_?{last_id:_}:{};if(Object.keys(f).length)try{const{result:t}=await y(e);null!=t&&t.length&&await E(t)}catch(e){o.Z.warn(e)}h===d&&(g=window.setTimeout(T,m))};let S,C,Z=0;const A=()=>{let e=p.GLOBAL_ASYNC_QUERIES_WEBSOCKET_URL;_&&(e+=`?last_id=${_}`),C=new WebSocket(e),C.addEventListener("open",(()=>{o.Z.log("WebSocket connected"),clearTimeout(S),Z=0})),C.addEventListener("close",(()=>{S=setTimeout((()=>{Z+=1,Z<=6?A():(o.Z.warn("WebSocket not available, falling back to async polling"),T())}),2500)})),C.addEventListener("error",(()=>{C.readyState<2&&C.close()})),C.addEventListener("message",(async e=>{let t=[];try{t=[JSON.parse(e.data)],await E(t)}catch(e){o.Z.warn(e)}}))};(e=>{if((0,s.cr)(s.TT.GLOBAL_ASYNC_QUERIES)){g&&clearTimeout(g),f={},v={},_=null,p=(0,l.Z)().common.conf,h=p.GLOBAL_ASYNC_QUERIES_TRANSPORT||d,m=p.GLOBAL_ASYNC_QUERIES_POLLING_DELAY||500;try{_=localStorage.getItem(u)}catch(e){o.Z.warn("Failed to fetch last event Id from localStorage")}h===d&&T(),"ws"===h&&A()}})()},12617:(e,t,n)=>{"use strict";n.d(t,{R:()=>r});const r=(0,n(30845).Z)(((e,t,n)=>!!n&&Object.values(n).some((n=>n.some((n=>{let[r,a]=n;return r===e&&a===t}))))))},42313:(e,t,n)=>{"use strict";n.d(t,{T:()=>r});const r=e=>{var t,n;return null!=(t=e.uid)?t:`${null!=(n=e.id)?n:"None"}__${e.type}`}},61337:(e,t,n)=>{"use strict";var r;function a(e,t){try{const n=localStorage.getItem(e);return null===n?t:JSON.parse(n)}catch{return t}}function o(e,t){try{localStorage.setItem(e,JSON.stringify(t))}catch{}}function i(e,t){return a(e,t)}function s(e,t){o(e,t)}n.d(t,{I_:()=>o,LS:()=>s,OH:()=>a,dR:()=>r,rV:()=>i}),function(e){e.filter_box_transition_snoozed_at="filter_box_transition_snoozed_at",e.db="db",e.chart_split_sizes="chart_split_sizes",e.controls_width="controls_width",e.datasource_width="datasource_width",e.is_datapanel_open="is_datapanel_open",e.homepage_chart_filter="homepage_chart_filter",e.homepage_dashboard_filter="homepage_dashboard_filter",e.homepage_collapse_state="homepage_collapse_state",e.homepage_activity_filter="homepage_activity_filter",e.datasetname_set_successful="datasetname_set_successful",e.sqllab__is_autocomplete_enabled="sqllab__is_autocomplete_enabled",e.explore__data_table_original_formatted_time_columns="explore__data_table_original_formatted_time_columns",e.dashboard__custom_filter_bar_widths="dashboard__custom_filter_bar_widths",e.dashboard__explore_context="dashboard__explore_context",e.dashboard__editor_show_only_my_charts="dashboard__editor_show_only_my_charts",e.common__resizable_sidebar_widths="common__resizable_sidebar_widths"}(r||(r={}))},9679:(e,t,n)=>{"use strict";function r(e){const t=new Set;return JSON.stringify(e,((e,n)=>{if("object"==typeof n&&null!==n){if(t.has(n))try{return JSON.parse(JSON.stringify(n))}catch(e){return}t.add(n)}return n}))}n.d(t,{o:()=>r})},8911:(e,t,n)=>{"use strict";n.d(t,{Z:()=>r});const r=(()=>{try{return n(74082)||{}}catch(e){return{}}})()},23525:(e,t,n)=>{"use strict";n.d(t,{Nm:()=>E,TO:()=>S,YE:()=>y,eY:()=>m,en:()=>C});var r=n(41609),a=n.n(r),o=n(78580),i=n.n(o),s=n(31069),l=n(37731),c=n(15926),d=n.n(c),u=n(27600),p=n(43399),h=n(11370);function m(e){let{name:t,type:n}=e;const r=new URLSearchParams(window.location.search).get(t);switch(n){case"number":return r?"true"===r.toLowerCase()?1:"false"===r.toLowerCase()?0:Number.isNaN(Number(r))?null:Number(r):null;case"object":return r?JSON.parse(r):null;case"boolean":return r?"false"!==r.toLowerCase()&&"0"!==r:null;case"rison":if(!r)return null;try{return d().decode(r)}catch{return r}default:return r}}function g(e){const t=new URLSearchParams;return new URLSearchParams(window.location.search).forEach(((n,r)=>{i()(e).call(e,r)||t.append(r,n)})),t}function f(e){const t=[];return e.forEach(((e,n)=>t.push([n,e]))),t}function v(e){const t=e||u.$O,n=g(t),r=(0,p.De)();return a()(r)||i()(t).call(t,u.KD.preselectFilters.name)||n.append(u.KD.preselectFilters.name,JSON.stringify((0,h.Z)((0,p.De)()))),f(n)}function _(){const e=g(u.Rv),t=(0,p.De)();return a()(t)||e.append(u.KD.preselectFilters.name,JSON.stringify((0,h.Z)((0,p.De)()))),f(e)}function b(e,t){return s.Z.post({endpoint:e,jsonPayload:t}).then((e=>e.json.url))}function y(e,t){return b("/api/v1/explore/permalink",{formData:e,urlParams:v(t)})}function E(e){let{dashboardId:t,dataMask:n,activeTabs:r,anchor:a}=e;return b(`/api/v1/dashboard/${t}/permalink`,{urlParams:_(),dataMask:n,activeTabs:r,anchor:a})}const T=/^([^:/?#]+:)?(?:(\/\/)?([^/?#]*))?([^?#]+)?(\?[^#]*)?(#.*)?/;function S(e){const t=e.match(T)||[];return"string"==typeof t[1]&&t[1].length>0||"//"===t[2]||"string"==typeof t[3]&&t[3].length>0}function C(e){const t=e.match(T)||[];return!S(e)||(0,l.Z)(t[1])||e.startsWith("//")?e:`//${e}`}},34858:(e,t,n)=>{"use strict";n.d(t,{LE:()=>v,NE:()=>y,PW:()=>_,Yi:()=>f,_l:()=>R,bR:()=>T,cb:()=>x,fF:()=>E,h1:()=>w,jb:()=>C,rM:()=>S,xx:()=>A,z:()=>Z});var r=n(78580),a=n.n(r),o=n(15926),i=n.n(o),s=n(67294),l=n(31069),c=n(55867),d=n(22102),u=n(40768),p=n(10222),h=n(98286),m=n(8911);const g=e=>"string"==typeof e?e:Object.entries(e).map((e=>{let[t,n]=e;return Array.isArray(n)?`(${t}) ${n.join(", ")}`:`(${t}) ${n}`})).join("\n");function f(e,t,n,r,a,o,d){void 0===r&&(r=!0),void 0===a&&(a=[]),void 0===d&&(d=!0);const[p,h]=(0,s.useState)({count:0,collection:a,loading:d,lastFetchDataConfig:null,permissions:[],bulkSelectEnabled:!1});function m(e){h((t=>({...t,...e})))}(0,s.useEffect)((()=>{r&&l.Z.get({endpoint:`/api/v1/${e}/_info?q=${i().encode({keys:["permissions"]})}`}).then((e=>{let{json:t={}}=e;m({permissions:t.permissions})}),(0,u.v$)((e=>n((0,c.t)("An error occurred while fetching %s info: %s",t,e)))))}),[]);const g=(0,s.useCallback)((r=>{let{pageIndex:a,pageSize:s,sortBy:d,filters:p}=r;m({lastFetchDataConfig:{filters:p,pageIndex:a,pageSize:s,sortBy:d},loading:!0});const h=(o||[]).concat(p).map((e=>{let{id:t,operator:n,value:r}=e;return{col:t,opr:n,value:r&&"object"==typeof r&&"value"in r?r.value:r}})),g=i().encode_uri({order_column:d[0].id,order_direction:d[0].desc?"desc":"asc",page:a,page_size:s,...h.length?{filters:h}:{}});return l.Z.get({endpoint:`/api/v1/${e}/?q=${g}`}).then((e=>{let{json:t={}}=e;m({collection:t.result,count:t.count,lastFetched:(new Date).toISOString()})}),(0,u.v$)((e=>n((0,c.t)("An error occurred while fetching %ss: %s",t,e))))).finally((()=>{m({loading:!1})}))}),[o]);return{state:{loading:p.loading,resourceCount:p.count,resourceCollection:p.collection,bulkSelectEnabled:p.bulkSelectEnabled,lastFetched:p.lastFetched},setResourceCollection:e=>m({collection:e}),hasPerm:function(e){return!!p.permissions.length&&Boolean(p.permissions.find((t=>t===e)))},fetchData:g,toggleBulkSelect:function(){m({bulkSelectEnabled:!p.bulkSelectEnabled})},refreshData:e=>p.lastFetchDataConfig?g(p.lastFetchDataConfig):e?g(e):null}}function v(e,t,n,r){void 0===r&&(r="");const[a,o]=(0,s.useState)({loading:!1,resource:null,error:null});function i(e){o((t=>({...t,...e})))}return{state:a,setResource:e=>i({resource:e}),fetchResource:(0,s.useCallback)((a=>{i({loading:!0});const o=`/api/v1/${e}/${a}`,s=""!==r?`${o}/${r}`:o;return l.Z.get({endpoint:s}).then((e=>{let{json:t={}}=e;return i({resource:t.result,error:null}),t.result}),(0,u.v$)((e=>{n((0,c.t)("An error occurred while fetching %ss: %s",t,g(e))),i({error:e})}))).finally((()=>{i({loading:!1})}))}),[n,e,t]),createResource:(0,s.useCallback)((function(r,a){return void 0===a&&(a=!1),i({loading:!0}),l.Z.post({endpoint:`/api/v1/${e}/`,body:JSON.stringify(r),headers:{"Content-Type":"application/json"}}).then((e=>{let{json:t={}}=e;return i({resource:{id:t.id,...t.result},error:null}),t.id}),(0,u.v$)((e=>{a||n((0,c.t)("An error occurred while creating %ss: %s",t,g(e))),i({error:e})}))).finally((()=>{i({loading:!1})}))}),[n,e,t]),updateResource:(0,s.useCallback)((function(r,a,o,s){return void 0===o&&(o=!1),void 0===s&&(s=!0),s&&i({loading:!0}),l.Z.put({endpoint:`/api/v1/${e}/${r}`,body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((e=>{let{json:t={}}=e;return i({resource:{...t.result,id:t.id},error:null}),t.result}),(0,u.v$)((e=>(o||n((0,c.t)("An error occurred while fetching %ss: %s",t,JSON.stringify(e))),i({error:e}),e)))).finally((()=>{s&&i({loading:!1})}))}),[n,e,t]),clearError:()=>i({error:null})}}function _(e,t,n){const[r,a]=(0,s.useState)({loading:!1,passwordsNeeded:[],alreadyExists:[],sshPasswordNeeded:[],sshPrivateKeyNeeded:[],sshPrivateKeyPasswordNeeded:[],failed:!1});function o(e){a((t=>({...t,...e})))}return{state:r,importResource:(0,s.useCallback)((function(r,a,i,s,d,p){void 0===a&&(a={}),void 0===i&&(i={}),void 0===s&&(s={}),void 0===d&&(d={}),void 0===p&&(p=!1),o({loading:!0,failed:!1});const m=new FormData;m.append("formData",r);const g=(0,c.t)("Please re-export your file and try importing again");return a&&m.append("passwords",JSON.stringify(a)),p&&m.append("overwrite","true"),i&&m.append("ssh_tunnel_passwords",JSON.stringify(i)),s&&m.append("ssh_tunnel_private_keys",JSON.stringify(s)),d&&m.append("ssh_tunnel_private_key_passwords",JSON.stringify(d)),l.Z.post({endpoint:`/api/v1/${e}/import/`,body:m,headers:{Accept:"application/json"}}).then((()=>(o({passwordsNeeded:[],alreadyExists:[],sshPasswordNeeded:[],sshPrivateKeyNeeded:[],sshPrivateKeyPasswordNeeded:[],failed:!1}),!0))).catch((e=>(0,h.O$)(e).then((e=>(o({failed:!0}),e.errors?((0,u.Er)(e.errors)?n((0,c.t)("An error occurred while importing %s: %s",t,[...e.errors.map((e=>e.message)),g].join(".\n"))):o({passwordsNeeded:(0,u.$u)(e.errors),sshPasswordNeeded:(0,u.dK)(e.errors),sshPrivateKeyNeeded:(0,u.ru)(e.errors),sshPrivateKeyPasswordNeeded:(0,u.z9)(e.errors),alreadyExists:(0,u.cE)(e.errors)}),!1):(n((0,c.t)("An error occurred while importing %s: %s",t,e.message||e.error)),!1)))))).finally((()=>{o({loading:!1})}))}),[])}}const b={chart:(0,d.Z)({requestType:"rison",method:"GET",endpoint:"/api/v1/chart/favorite_status/"}),dashboard:(0,d.Z)({requestType:"rison",method:"GET",endpoint:"/api/v1/dashboard/favorite_status/"})};function y(e,t,n){const[r,a]=(0,s.useState)({}),o=e=>a((t=>({...t,...e})));return(0,s.useEffect)((()=>{t.length&&b[e](t).then((e=>{let{result:t}=e;const n=t.reduce(((e,t)=>(e[t.id]=t.value,e)),{});o(n)}),(0,u.v$)((e=>n((0,c.t)("There was an error fetching the favorite status: %s",e)))))}),[t,e,n]),[(0,s.useCallback)(((t,r)=>{const a=`/api/v1/${e}/${t}/favorites/`;(r?l.Z.delete({endpoint:a}):l.Z.post({endpoint:a})).then((()=>{o({[t]:!r})}),(0,u.v$)((e=>n((0,c.t)("There was an error saving the favorite status: %s",e)))))}),[e]),r]}const E=(e,t)=>{const[n,r]=(0,s.useState)(null);return{sliceCurrentlyEditing:n,handleChartUpdated:function(n){const r=t.map((e=>e.id===n.id?{...e,...n}:e));e(r)},openChartEditModal:function(e){r({slice_id:e.id,slice_name:e.slice_name,description:e.description,cache_timeout:e.cache_timeout,certified_by:e.certified_by,certification_details:e.certification_details,is_managed_externally:e.is_managed_externally})},closeChartEditModal:function(){r(null)}}},T=(e,t,n)=>{(0,p.Z)((()=>Promise.resolve(`${window.location.origin}/superset/sqllab?savedQueryId=${e}`))).then((()=>{n((0,c.t)("Link Copied!"))})).catch((()=>{t((0,c.t)("Sorry, your browser does not support copying."))}))},S=()=>m.Z.DB_IMAGES,C=()=>m.Z.DB_CONNECTION_ALERTS,Z=()=>m.Z.DB_CONNECTION_DOC_LINKS,A=(e,t,n)=>{l.Z.post({endpoint:"api/v1/database/test_connection/",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((()=>{n((0,c.t)("Connection looks good!"))}),(0,u.v$)((e=>{t((0,c.t)("ERROR: %s",g(e)))})))};function x(){const[e,t]=(0,s.useState)(null);return[e,(0,s.useCallback)((()=>{l.Z.get({endpoint:"/api/v1/database/available/"}).then((e=>{let{json:n}=e;t(n)}))}),[t])]}function w(){const[e,t]=(0,s.useState)(null);return[e,(0,s.useCallback)((function(e,n){var r,o;return void 0===n&&(n=!1),null!=e&&null!=(r=e.parameters)&&r.ssh?(t(null),[]):l.Z.post({endpoint:"/api/v1/database/validate_parameters/",body:JSON.stringify((o=e,o&&Array.isArray(null==o?void 0:o.catalog)?{...o,catalog:Object.assign({},...o.catalog.map((e=>({[e.name]:e.value}))))}:o)),headers:{"Content-Type":"application/json"}}).then((()=>{t(null)})).catch((e=>{if("function"==typeof e.json)return e.json().then((e=>{let{errors:r=[]}=e;const o=r.filter((e=>{var t;return!a()(t=["CONNECTION_MISSING_PARAMETERS_ERROR","CONNECTION_ACCESS_DENIED_ERROR"]).call(t,e.error_type)||n})).reduce(((e,t)=>{var n;let{error_type:r,extra:a,message:o}=t;return a.catalog?a.catalog.name?{...e,error_type:r,[a.catalog.idx]:{name:o}}:a.catalog.url?{...e,error_type:r,[a.catalog.idx]:{url:o}}:{...e,error_type:r,[a.catalog.idx]:{name:o,url:o}}:a.invalid?{...e,[a.invalid[0]]:o,error_type:r}:a.missing?{...e,error_type:r,...Object.assign({},...a.missing.map((e=>({[e]:"This is a required field"}))))}:null!=(n=a.issue_codes)&&n.length?{...e,error_type:r,description:o||(null==(i=a.issue_codes[0])?void 0:i.message)}:e;var i}),{});return t(o),o}));console.error(e)}))}),[t]),t]}const R=(e,t,n)=>{var r;return n?null==(r=e.reports[t])?void 0:r[n]:null}},12:(e,t,n)=>{"use strict";var r,a;n.d(t,{F:()=>r,J:()=>a}),function(e){e.Favorite="Favorite",e.Mine="Mine",e.Other="Other",e.Viewed="Viewed",e.Created="Created",e.Edited="Edited"}(r||(r={})),function(e){e.id="id",e.changed_on="changed_on",e.database="database",e.database_name="database.database_name",e.schema="schema",e.sql="sql",e.executed_sql="executed_sql",e.sql_tables="sql_tables",e.status="status",e.tab_name="tab_name",e.user="user",e.user_first_name="user.first_name",e.start_time="start_time",e.end_time="end_time",e.rows="rows",e.tmp_table_name="tmp_table_name",e.tracking_url="tracking_url"}(a||(a={}))},40768:(e,t,n)=>{"use strict";n.d(t,{$u:()=>V,B1:()=>C,Er:()=>G,Gm:()=>R,IB:()=>D,IV:()=>E,Iu:()=>I,Ld:()=>S,Mc:()=>Y,ZB:()=>M,_L:()=>N,cE:()=>z,dK:()=>j,eX:()=>b,if:()=>K,iv:()=>O,mq:()=>L,ru:()=>H,tm:()=>A,v$:()=>w,wk:()=>x,xF:()=>Z,xL:()=>k,z9:()=>B});var r=n(25325),a=n.n(r),o=n(78580),i=n.n(o),s=n(51995),l=n(31069),c=n(55867),d=n(68492),u=n(11965),p=n(15926),h=n.n(p),m=n(98286),g=n(8911),f=n(12617),v=n(39589),_=n(12);(()=>{const e=h(),t=[];for(let e=0;e<16;e+=1)for(let n=0;n<16;n+=1){if(e+n===0)continue;const r=String.fromCharCode(16*e+n);/\w|[-_./~]/.test(r)||t.push(`\\u00${e.toString(16)}${n.toString(16)}`)}e.not_idchar=t.join(""),e.not_idstart="-0123456789";const n=`[^${e.not_idstart}${e.not_idchar}][^${e.not_idchar}]*`;e.id_ok=new RegExp(`^${n}$`),e.next_id=new RegExp(n,"g")})();const b=s.iK.div`
  color: ${e=>{let{theme:t}=e;return t.colors.grayscale.base}};
`,y=e=>(t,n,r,a)=>async function(r,o,i){var s;void 0===r&&(r="");const c=`/api/v1/${t}/${e}/${n}`,d=h().encode_uri({filter:r,page:o,page_size:i}),{json:u={}}=await l.Z.get({endpoint:`${c}?q=${d}`});let p=!1;const m=a?{label:`${a.firstName} ${a.lastName}`,value:a.userId}:void 0,g=[];return null==u||null==(s=u.result)||s.filter((e=>{let{text:t}=e;return t.trim().length>0})).forEach((e=>{let{text:t,value:n}=e;m&&n===m.value&&t===m.label?p=!0:g.push({label:t,value:n})})),!m||r&&!p||g.unshift(m),{data:g,totalCount:null==u?void 0:u.count}},E=5,T=e=>{const t={order_column:"changed_on_delta_humanized",order_direction:"desc",page:0,page_size:E,filters:e};return e||delete t.filters,h().encode(t)},S=e=>{const t={edited:[{col:"changed_by",opr:"rel_o_m",value:`${e}`}]},n=[l.Z.get({endpoint:`/api/v1/dashboard/?q=${T(t.edited)}`}),l.Z.get({endpoint:`/api/v1/chart/?q=${T(t.edited)}`})];return Promise.all(n).then((e=>{var t,n;let[r,a]=e;return{editedDash:null==(t=a.json)?void 0:t.result.slice(0,3),editedChart:null==(n=r.json)?void 0:n.result.slice(0,3)}})).catch((e=>e))},C=function(e,t,n){return void 0===n&&(n=[{col:"owners",opr:"rel_m_m",value:`${e}`}]),l.Z.get({endpoint:`/api/v1/${t}/?q=${T(n)}`}).then((e=>{var t;return null==(t=e.json)?void 0:t.result}))},Z=(e,t,n,r)=>l.Z.get({endpoint:t}).then((e=>{const t={},a=[l.Z.get({endpoint:`/api/v1/chart/?q=${T(r)}`}),l.Z.get({endpoint:`/api/v1/dashboard/?q=${T(r)}`})];return Promise.all(a).then((n=>{let[r,a]=n;return t.other=[...r.json.result,...a.json.result],t.viewed=e.json.result,t})).catch((e=>n((0,c.t)("There was an error fetching your recent activity:"),e)))})),A=y("related"),x=y("distinct");function w(e){return async t=>{const n=await(0,m.O$)(t),r=null==n?void 0:n.errors,a=await g.Z;null!=r&&r.length&&null!=a&&a.ERRORS&&r[0].error_type in a.ERRORS&&(n.message=a.ERRORS[r[0].error_type]),d.Z.error(t),e(n.message||n.error)}}function R(e,t,n,r,a,o){let{id:i,slice_name:s}=e;const d={pageIndex:0,pageSize:E,sortBy:[{id:"changed_on_delta_humanized",desc:!0}],filters:[{id:"created_by",operator:"rel_o_m",value:`${o}`}]};l.Z.delete({endpoint:`/api/v1/chart/${i}`}).then((()=>{"Mine"===a?r(d):r(),t((0,c.t)("Deleted: %s",s))}),(()=>{n((0,c.t)("There was an issue deleting: %s",s))}))}function I(e,t,n,r,a,o){let{id:i,dashboard_title:s}=e;return l.Z.delete({endpoint:`/api/v1/dashboard/${i}`}).then((()=>{"Mine"===a?t({pageIndex:0,pageSize:E,sortBy:[{id:"changed_on_delta_humanized",desc:!0}],filters:[{id:"owners",operator:"rel_m_m",value:`${o}`}]}):t(),n((0,c.t)("Deleted: %s",s))}),w((e=>r((0,c.t)("There was an issue deleting %s: %s",s,e)))))}function D(e,t){let n=e.split("\n");return n.length>=t&&(n=n.slice(0,t),n.push("...")),n.join("\n")}const O=5,L=[576,768,992,1200].map((e=>`@media (max-width: ${e}px)`)),N=s.iK.div`
  ${e=>{let{showThumbnails:t,theme:n}=e;return`\n    overflow: hidden;\n    display: grid;\n    grid-gap: ${12*n.gridUnit}px ${4*n.gridUnit}px;\n    grid-template-columns: repeat(auto-fit, 300px);\n    max-height: ${t?"314":"148"}px;\n    margin-top: ${-6*n.gridUnit}px;\n    padding: ${t?`${8*n.gridUnit+3}px ${9*n.gridUnit}px`:`${8*n.gridUnit+1}px ${9*n.gridUnit}px`};\n  `}}
`,M=s.iK.div`
  cursor: pointer;
  a {
    text-decoration: none;
  }
  .ant-card-cover > div {
    /* Height is calculated based on 300px width, to keep the same aspect ratio as the 800*450 thumbnails */
    height: 168px;
  }
`,k=e=>u.iv`
  margin: auto ${2*e.gridUnit}px auto 0;
  color: ${e.colors.grayscale.base};
`,P=e=>{var t;return"object"==typeof e&&Array.isArray(e._schema)&&!(null==(t=e._schema)||!t.find((e=>"Must provide a password for the database"===e)))},F=e=>{var t;return"object"==typeof e&&Array.isArray(e._schema)&&!(null==(t=e._schema)||!t.find((e=>"Must provide a password for the ssh tunnel"===e)))},U=e=>{var t;return"object"==typeof e&&Array.isArray(e._schema)&&!(null==(t=e._schema)||!t.find((e=>"Must provide a private key for the ssh tunnel"===e)))},$=e=>{var t;return"object"==typeof e&&Array.isArray(e._schema)&&!(null==(t=e._schema)||!t.find((e=>"Must provide a private key password for the ssh tunnel"===e)))},q=e=>"string"==typeof e&&i()(e).call(e,"already exists and `overwrite=true` was not passed"),V=e=>e.map((e=>Object.entries(e.extra).filter((e=>{let[,t]=e;return P(t)})).map((e=>{let[t]=e;return t})))).flat(),j=e=>e.map((e=>Object.entries(e.extra).filter((e=>{let[,t]=e;return F(t)})).map((e=>{let[t]=e;return t})))).flat(),H=e=>e.map((e=>Object.entries(e.extra).filter((e=>{let[,t]=e;return U(t)})).map((e=>{let[t]=e;return t})))).flat(),B=e=>e.map((e=>Object.entries(e.extra).filter((e=>{let[,t]=e;return $(t)})).map((e=>{let[t]=e;return t})))).flat(),z=e=>e.map((e=>Object.entries(e.extra).filter((e=>{let[,t]=e;return q(t)})).map((e=>{let[t]=e;return t})))).flat(),G=e=>e.some((e=>{const t=Object.entries(e.extra).filter((e=>{let[t]=e;return"issue_codes"!==t}));return 0===t.length||!t.every((e=>{let[,t]=e;return P(t)||q(t)||F(t)||U(t)||$(t)}))})),Q=(e,t)=>void 0!==e&&a()(e,t).length>0,Y=(e,t,n,r,a)=>{const o=(0,f.R)("can_this_form_get","CsvToDatabaseView",e)&&Q(t,a),i=Q(n,a)&&(0,f.R)("can_this_form_get","ColumnarToDatabaseView",e),s=Q(r,a)&&(0,f.R)("can_this_form_get","ExcelToDatabaseView",e);return{canUploadCSV:o,canUploadColumnar:i,canUploadExcel:s,canUploadData:o||i||s}};function K(e,t,n,r){var a;return e===_.F.Created||t===v.g.SavedQueries&&e===_.F.Mine?[{id:"created_by",operator:"rel_o_m",value:`${null==n?void 0:n.userId}`}]:t===v.g.SavedQueries&&e===_.F.Favorite?[{id:"id",operator:"saved_query_is_fav",value:!0}]:e===_.F.Mine&&n?[{id:"owners",operator:"rel_m_m",value:`${n.userId}`}]:e===_.F.Favorite&&i()(a=[v.g.Dashboards,v.g.Charts]).call(a,t)?[{id:"id",operator:t===v.g.Dashboards?"dashboard_is_favorite":"chart_is_favorite",value:!0}]:e===_.F.Other?(r||[]).map((e=>({id:e.col,operator:e.opr,value:e.value}))):[]}},71255:(e,t,n)=>{"use strict";n.d(t,{Cy:()=>ie,zn:()=>ce,h:()=>de});var r=n(29829),a=n(53894),o=n(10362),i=n(61806),s=n(37863),l=n(8868),c=n(57557),d=n.n(c),u=n(61358),p=n(41295),h=n(4305),m=n(9467),g=n(39023),f=n(39759),v=n(24350),_=n.n(v),b=n(50810),y=n(37927),E=n(21090),T=n(80621),S=n(12885),C=n(81255);function Z(e){return[C.BA,C.dW,C.xh,C.t].indexOf(e.type)>-1}var A=n(95173),x=n(47456),w=n(37418),R=n(28428);const I={[C.BG]:{[C.dW]:!0,[C.BA]:!0,[C.xh]:!0},[C.gn]:{[C.dW]:!0,[C.BA]:!0,[C.xh]:!0}};function D(e){let{parentType:t,childType:n}=e;if(!t||!n)return!1;const r=I[t];return!!r&&Boolean(r[n])}function O(e){let{dropResult:t,layout:n}=e;const{dragging:r,destination:a}=t,o=r.type,i=n[a.id],s=i.type;let l=(0,R.Z)(o,r.meta);l.parents=(i.parents||[]).concat(i.id),Z(r)&&(l.meta.width=(0,x.Z)({dropResult:t,layout:n})||void 0);const c=D({parentType:s,childType:o}),d={[l.id]:l};if(c){const e=(0,R.Z)(C.Os);e.children=[l.id],e.parents=(i.parents||[]).concat(i.id),d[e.id]=e,l.parents=e.parents.concat(e.id),l=e}else if(o===C.yR){const e=(0,R.Z)(C.gn);e.parents=(i.parents||[]).concat(i.id),l.children=[e.id],d[e.id]=e}const u=[...i.children];return u.splice(a.index,0,l.id),d[a.id]={...i,children:u},d}function L(e,t,n){const r=null==n?void 0:n[e];if(r){delete n[e];const{children:a=[]}=r;null==a||null==a.forEach||a.forEach((t=>{L(t,e,n)}));const o=null==n?void 0:n[t];if(Array.isArray(null==o?void 0:o.children)){const r=o.children.indexOf(e);if(r>-1){const e=[...o.children];e.splice(r,1),n[t]={...o,children:e}}}}}const N={[h.$]:(e,t)=>({...t.data.dashboardLayout.present}),[S.nj](e,t){const{payload:{nextComponents:n}}=t;return{...e,...n}},[S.CB](e,t){var n;const{payload:{id:r,parentId:a}}=t;if(!(a&&r&&e[r]&&e[a]))return e;const o={...e};L(r,a,o);const i=o[a];return(null==i?void 0:i.type)===C.Os&&0===(null==i||null==(n=i.children)?void 0:n.length)&&L(a,(0,A.Z)({childId:a,layout:o}),o),o},[S.J0](e,t){const{payload:{dropResult:n}}=t,r=O({dropResult:n,layout:e});return{...e,...r}},[S.aZ](e,t){const{payload:{dropResult:n}}=t,{source:r,destination:a,dragging:o}=n;if(!r||!a||!o)return e;const i=function(e){let{entitiesMap:t,source:n,destination:r}=e;const a=[...t[n.id].children],o=[...t[r.id].children],i=a[n.index];if(n.id===r.id){const e=function(e,t,n){const r=[...e],[a]=r.splice(t,1);return r.splice(n,0,a),r}(a,n.index,r.index);return{...t,[n.id]:{...t[n.id],children:e}}}return a.splice(n.index,1),o.splice(r.index,0,i),{...t,[n.id]:{...t[n.id],children:a},[r.id]:{...t[r.id],children:o}}}({entitiesMap:e,source:r,destination:a});if(Z(i[o.id])){const t=(0,x.Z)({dropResult:n,layout:e})||void 0;(i[o.id].meta||{}).width!==t&&(i[o.id]={...i[o.id],meta:{...i[o.id].meta,width:t}})}if(D({parentType:a.type,childType:o.type})){const e=i[a.id],t=e.children,n=(0,R.Z)(C.Os);n.children=[t[a.index]],n.parents=(e.parents||[]).concat(a.id),t[a.index]=n.id,i[n.id]=n}return{...e,...i}},[S.YA](e,t){const{payload:{dropResult:n}}=t,{source:r,dragging:a}=n,o=e[T._4],i=o.children[0],s=e[i];if(r.id!==T.D0){const t=e[a.id].children[0],n=e[t],r=[...s.children].filter((e=>e!==a.id));return{...e,[T._4]:{...o,children:[a.id]},[i]:{...s,children:[]},[t]:{...n,children:[...n.children,...r]}}}const l=O({dropResult:n,layout:e}),c=Object.values(l),d=c.find((e=>e.type===C.gn)),u=c.find((e=>e.type===C.yR));return d.children=[...s.children],l[i]={...s,children:[]},l[T._4]={...o,children:[u.id]},{...e,...l}},[S.Mu](e){const t=e[T._4],n=t.children[0],r=e[n];if(r.type!==C.yR)return e;let a=[];const o={...e};return r.children.forEach((t=>{const n=e[t];a=[...a,...n.children],delete o[t]})),delete o[n],o[T._4]={...t,children:[T.PV]},o[T.PV]={...e[T.PV],children:a},o},[S.x_](e){const t={...e};return(0,w.Z)({currentComponent:t[T._4],layout:t}),{...t}},[S.bK]:(e,t)=>({...e,[T.M2]:{...e[T.M2],meta:{...e[T.M2].meta,text:t.text}}})},M=(0,E.ZP)((function(e,t){return void 0===e&&(e={}),t.type in N?(0,N[t.type])(e,t):e}),{limit:T.Q9+2,ignoreInitialState:!0,filter:(0,E.an)([h.$,S.nj,S.CB,S.J0,S.YA,S.Mu,S.qL,S.aZ,S.L1])});var k=n(14670),P=n.n(k),F=n(31069),U=n(9679),$=n(97381),q=n(3741),V=n(23279),j=n.n(V);const H=new class{constructor(e){let{callback:t=(()=>{}),sizeThreshold:n=1e3,delayThreshold:r=1e3}=e;this.queue=[],this.sizeThreshold=n,this.delayThreshold=r,this.trigger=j()(this.trigger.bind(this),this.delayThreshold),this.callback=t}append(e){this.queue.push(e),this.trigger()}trigger(){if(this.queue.length>0){const e=this.queue.splice(0,this.sizeThreshold);this.callback.call(null,e),this.queue.length>0&&this.trigger()}}}({callback:e=>{if(e.length<=0)return;let t="/superset/log/?explode=events";const{source:n,source_id:r}=e[0];if("dashboard"===n?t+=`&dashboard_id=${r}`:"slice"===n&&(t+=`&slice_id=${r}`),navigator.sendBeacon){const n=new FormData;n.append("events",(0,U.o)(e)),F.Z.getGuestToken()&&n.append("guest_token",F.Z.getGuestToken()),navigator.sendBeacon(t,n)}else F.Z.post({endpoint:t,postPayload:{events:e},parseMethod:null})},sizeThreshold:1024,delayThreshold:1e3});let B=0;const z=e=>t=>n=>{var r;if(n.type!==$.LOG_EVENT)return t(n);const{dashboardInfo:a,explore:o,impressionId:i,dashboardLayout:s,sqlLab:l}=e.getState();let c={impression_id:i,version:"v2"};if(null!=a&&a.id)c={source:"dashboard",source_id:a.id,...c};else if(null!=o&&o.slice)c={source:"explore",source_id:o.slice?o.slice.slice_id:0,...c};else if(l){const e=l.queryEditors.find((e=>{let{id:t}=e;return t===l.tabHistory.slice(-1)[0]}));c={source:"sqlLab",source_id:null==e?void 0:e.id,db_id:null==e?void 0:e.dbId,schema:null==e?void 0:e.schema}}const{eventName:d}=n.payload;let{eventData:u={}}=n.payload;if(u={...c,ts:(new Date).getTime(),event_name:d,...u},q.TY.has(d)?u={...u,event_type:"timing",trigger_event:B}:(B=P().generate(),u={...u,event_type:"user",event_id:B,visibility:document.visibilityState}),u.target_id&&null!=s&&null!=(r=s.present)&&r[u.target_id]){const{meta:e}=s.present[u.target_id];u.target_name=e.chartId?e.sliceName:e.text}return H.append(u),u};var G=n(19485),Q=n(76445),Y=n(78580),K=n.n(Y),W=n(55786),J=n(52256),X=n(35854),ee=n(10331),te=n(651),ne=n(42313),re=n(99068);const ae=e=>function(t){return void 0===t&&(t=e),t},oe=(0,n(20292).Z)(),ie="USER_LOADED",se=e=>[a.Z,z,o.h.middleware],le={messageToasts:i.Z,common:ae(oe.common),user:function(e,t){return void 0===e&&(e=oe.user||{}),t.type===ie?t.user:e},impressionId:ae(P().generate()),charts:s.Z,datasources:(e,t)=>t.type===b.Rn.SET_DATASOURCES?function(e,t){return t.type===b.Rn.SET_DATASOURCES?{...e,..._()(t.datasources,"uid")}:t.type===b.Rn.SET_DATASOURCE?{...e,[t.key]:t.datasource}:e||{}}(e,t):function(e,t){return t.type===re.AG?{...e,[(0,ne.T)(t.datasource)]:t.datasource}:t.type===Q._?{...t.data.datasources}:e||{}}(e,t),dashboardInfo:function(e,t){switch(void 0===e&&(e={}),t.type){case p.$A:return{...e,...t.newInfo,last_modified_time:Math.round((new Date).getTime()/1e3)};case h.$:return{...e,...t.data.dashboardInfo};case p.nH:return{...e,filterBarOrientation:t.filterBarOrientation};case p.Fl:return{...e,crossFiltersEnabled:t.crossFiltersEnabled};default:return e}},dashboardFilters:g.ZP,dataMask:l.Z,nativeFilters:f.Z,dashboardState:function(e,t){void 0===e&&(e={});const n={[h.$]:()=>({...e,...t.data.dashboardState}),[m.Be]:()=>({...e,css:t.css}),[m.BD](){const n=new Set(e.sliceIds);return n.add(t.slice.slice_id),{...e,sliceIds:Array.from(n)}},[m.Vd](){const{sliceId:n}=t,r=new Set(e.sliceIds);return r.delete(n),{...e,sliceIds:Array.from(r)}},[m.Z9]:()=>({...e,isStarred:t.isStarred}),[m.H9]:()=>({...e,isPublished:t.isPublished}),[m.$f]:()=>({...e,editMode:t.editMode}),[m.n1](){const{maxUndoHistoryExceeded:n=!0}=t.payload;return{...e,maxUndoHistoryExceeded:n}},[m.oJ]:()=>({...e}),[m.J$]:()=>({...e,colorScheme:t.colorScheme,updatedColorScheme:!0}),[m.ek](){const n={...e.expandedSlices},{sliceId:r}=t;return n[r]?delete n[r]:n[r]=!0,{...e,expandedSlices:n}},[m.P0]:()=>({...e,hasUnsavedChanges:!0}),[m.hD]:()=>({...e,dashboardIsSaving:!0}),[m.qJ]:()=>({...e,dashboardIsSaving:!1}),[m.Ii]:()=>({...e,hasUnsavedChanges:!1,maxUndoHistoryExceeded:!1,editMode:!1,updatedColorScheme:!1,lastModifiedTime:t.lastModifiedTime}),[m.ee](){const{hasUnsavedChanges:n}=t.payload;return{...e,hasUnsavedChanges:n}},[m.yV]:()=>({...e,refreshFrequency:t.refreshFrequency,shouldPersistRefreshFrequency:t.isPersistent,hasUnsavedChanges:t.isPersistent}),[m.ec]:()=>({...e,isRefreshing:!0}),[m.bs]:()=>({...e,isFiltersRefreshing:!0}),[m.sm]:()=>({...e,isFiltersRefreshing:!1}),[m.k5]:()=>({...e,isRefreshing:!1}),[m.RU]:()=>({...e,directPathToChild:t.path,directPathLastUpdated:Date.now()}),[m.nV](){const n=new Set(e.activeTabs);return n.delete(t.prevTabId),n.add(t.tabId),{...e,activeTabs:Array.from(n)}},[m.w9]:()=>({...e,overwriteConfirmMetadata:t.overwriteConfirmMetadata}),[m.mq]:()=>({...e,focusedFilterField:{chartId:t.chartId,column:t.column}}),[m.Iw]:()=>e.focusedFilterField&&t.chartId===e.focusedFilterField.chartId&&t.column===e.focusedFilterField.column?{...e,focusedFilterField:null}:e,[m.r$]:()=>({...e,fullSizeChartId:t.chartId}),[m.FF]:()=>({...e,datasetsStatus:t.status})};return t.type in n?n[t.type]():e},dashboardLayout:M,sliceEntities:y.Z,reports:function(e,t){void 0===e&&(e={});const n={[u.jt](){var n,r,a;const{report:o,resourceId:i,creationMethod:s,filterField:l}=t,c=null==(n=o.result)?void 0:n.find((e=>e[l]===i));if(c)return{...e,[s]:{...e[s],[i]:c}};if(null!=(r=e)&&null!=(a=r[s])&&a[i]){const t={...e};return delete t[s][i],t}return{...e}},[u.J8](){const{result:n,id:r}=t.json,a={...n,id:r},o=a.dashboard||a.chart;return{...e,[a.creation_method]:{...e[a.creation_method],[o]:a}}},[u.Dr](){const n={...t.json.result,id:t.json.id},r=n.dashboard||n.chart;return{...e,[n.creation_method]:{...e[n.creation_method],[r]:n}}},[u._M](){const{report:n}=t,r=n.dashboard||n.chart;return{...e,[n.creation_method]:{...d()(e[n.creation_method],r)}}}};return t.type in n?n[t.type]():e},saveModal:function(e,t){void 0===e&&(e={});const n={[G.SET_SAVE_CHART_MODAL_VISIBILITY]:()=>({...e,isVisible:t.isVisible}),[G.FETCH_DASHBOARDS_SUCCEEDED]:()=>({...e,dashboards:t.choices}),[G.FETCH_DASHBOARDS_FAILED]:()=>({...e,saveModalAlert:`fetching dashboards failed for ${t.userId}`}),[G.SAVE_SLICE_FAILED]:()=>({...e,saveModalAlert:"Failed to save slice"}),[G.SAVE_SLICE_SUCCESS]:t=>({...e,data:t}),[Q._]:()=>({...t.data.saveModal})};return t.type in n?n[t.type]():e},explore:function(e,t){void 0===e&&(e={});const n={[J.DYNAMIC_PLUGIN_CONTROLS_READY]:()=>({...e,controls:t.controlsState}),[te.TOGGLE_FAVE_STAR]:()=>({...e,isStarred:t.isStarred}),[te.POST_DATASOURCE_STARTED]:()=>({...e,isDatasourceMetaLoading:!0}),[te.UPDATE_FORM_DATA_BY_DATASOURCE](){const n={...e.form_data},{prevDatasource:r,newDatasource:a}=t,o={...e.controls},i=[];r.id===a.id&&r.type===a.type||(n.datasource=a.uid),Object.entries(o).forEach((e=>{let[t,r]=e;("column_name"===r.valueKey||"savedMetrics"in r||"columns"in r||"options"in r&&!Array.isArray(r.options))&&(n[t]=(0,ee.YY)(a,r,r.value),(0,W.Z)(n[t]).length>0&&n[t]!==o[t].default&&i.push(t))}));const s={...e,controls:o,datasource:t.newDatasource};return{...s,form_data:n,controls:(0,X.R3)(s,n),controlsTransferred:i}},[te.FETCH_DATASOURCES_STARTED]:()=>({...e,isDatasourcesLoading:!0}),[te.SET_FIELD_VALUE](){const{controlName:n,value:r,validationErrors:a}=t;let o={...e.form_data,[n]:r};const i=e.form_data.metrics,s=e.form_data.column_config,l=o.viz_type;"metrics"===n&&i&&s&&(r.forEach(((e,t)=>{var n,r;(null==e?void 0:e.label)!==(null==(n=i[t])?void 0:n.label)&&s[null==(r=i[t])?void 0:r.label]&&(s[e.label]=s[i[t].label],delete s[i[t].label])})),o.column_config=s);const c=e.controls[t.controlName]||(0,ee.Bx)(t.controlName,l)||{},d={...(0,ee.vP)(c,e,t.value)},u={...e.controls.column_config,...s&&{value:s}},p={...e,controls:{...e.controls,[n]:d,..."metrics"===n&&{column_config:u}}},h={};Array.isArray(d.rerender)&&d.rerender.forEach((e=>{h[e]={...(0,ee.vP)(p.controls[e],p,p.controls[e].value)}}));const m=d.validationErrors||[];(a||[]).forEach((e=>{K()(m).call(m,e)||m.push(e)}));const g=m&&m.length>0,f="viz_type"===t.controlName&&t.value!==e.controls.viz_type.value;let v=e.controls;if(f){const n=new ee.os(e.form_data).transform(t.value,e);o=n.formData,v=n.controlsState}return{...e,form_data:o,triggerRender:d.renderTrigger&&!g,controls:{...v,[t.controlName]:{...d,validationErrors:m},...h}}},[te.SET_EXPLORE_CONTROLS]:()=>({...e,controls:(0,X.R3)(e,t.formData)}),[te.SET_FORM_DATA]:()=>({...e,form_data:t.formData}),[te.UPDATE_CHART_TITLE]:()=>({...e,sliceName:t.sliceName}),[te.SET_SAVE_ACTION]:()=>({...e,saveAction:t.saveAction}),[te.CREATE_NEW_SLICE]:()=>({...e,slice:t.slice,controls:(0,X.R3)(e,t.form_data),can_add:t.can_add,can_download:t.can_download,can_overwrite:t.can_overwrite}),[te.SLICE_UPDATED](){var n;return{...e,slice:{...e.slice,...t.slice,owners:t.slice.owners?t.slice.owners.map((e=>e.value)):null},sliceName:null!=(n=t.slice.slice_name)?n:e.sliceName,metadata:{...e.metadata,owners:t.slice.owners?t.slice.owners.map((e=>e.label)):null}}},[te.SET_FORCE_QUERY]:()=>({...e,force:t.force}),[Q._]:()=>({...t.data.explore})};return t.type in n?n[t.type]():e}};function ce(e){let{disableDebugger:t=!1,initialState:n={},rootReducers:a=le,...i}=void 0===e?{}:e;return(0,r.xC)({preloadedState:n,reducer:{[o.h.reducerPath]:o.h.reducer,...a},middleware:se,devTools:!1,...i})}const de=ce()}}]);
//# sourceMappingURL=6579.65651e6c5fa3bb12582a.entry.js.map