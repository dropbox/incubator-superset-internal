{"version":3,"file":"7919f5dfe4abd96372c7.chunk.js","mappings":"6RAaIA,EAAqCC,EAAQ,OAI7CC,GAFAF,EAAqCC,EAAQ,OAEhC,WAGf,IAAIE,EAAOC,KAipBX,IAAK,IAAIC,KAhpBTF,EAAKG,KAAMC,EAAAA,EAAAA,KACRC,KAAK,QAAS,UACdC,UAAU,KACVC,OAAO,EAAE,EAAG,IACZC,MACCC,GAAM,WACJT,EAAKU,QAAQC,cAAcF,EAAEG,eAAeZ,EAAKU,QAAQG,eACzDJ,EAAEK,sBAIRd,EAAKe,WAAYX,EAAAA,EAAAA,KACdC,KAAK,QAAS,UACdC,UAAU,KACVC,OAAO,EAAE,EAAG,IACZC,MAAKC,GAAKT,EAAKU,QAAQG,eAAeJ,KAEzCR,KAAKe,gBAAkB,CAAC,OAAQ,MAAO,MAAO,OAG9Cf,KAAKS,QAAU,CAIbO,aAAc,eAIdC,aAAa,EAObC,MAAO,GAGPC,SAAU,GAGVC,YAAa,EAGbC,WAAY,EAEZC,aAAc,EAEdC,aAAc,CAAC,EAAG,EAAG,EAAG,GAExBX,eAAgBJ,GAAKA,EAErBE,cAAeF,GAAKA,EAEpBgB,OAAQ,OAERC,UAAW,MAIXC,SAAU,KAIVC,SAAU,KAIVC,mBAAmB,EAInBC,MAAO,IAAIC,KAEXC,QAAS,KAETC,QAAS,KAQTC,KAAM,GAINC,SAAUlC,KAAKe,gBAAgB,GAK/BoB,gBAAiB,KAKjBC,mBAAoB,KAIpBC,2BAA2B,EAI3BC,YAAY,EAKZC,qBAAqB,EAIrBC,wBAAwB,EAGxBC,MAAO,CAELC,SAAU,SAIVC,MAAO,SAGPrC,OAAQ,CACNsC,EAAG,EACHC,EAAG,GAGLC,OAAQ,KAGRC,MAAO,IAGPC,OAAQ,MAQVC,OAAQ,CAAC,GAAI,GAAI,GAAI,IAGrBC,eAAe,EAEfC,eAAgB,GAEhBC,kBAAmB,EAEnBC,aAAc,CAAC,EAAG,EAAG,EAAG,GAKxBC,uBAAwB,SAIxBC,yBAA0B,OAI1BC,kBAAmB,aAcnBC,aAAc,KAWdC,UAAW,GAOXC,SAAU,CAAC,OAAQ,SASnBC,kBAAmB,KAGnBC,qBAAsB,CACpBC,MAAO,SACPC,OAAQ,qCAUVC,oBAAqB,KASrBC,oBAAqB,KAGrBC,kBAAmB,CACjBC,OAAOxD,EAAAA,EAAAA,GAAE,0BACTyD,OAAOzD,EAAAA,EAAAA,GAAE,kCACT0D,OAAO1D,EAAAA,EAAAA,GAAE,2BAIX2D,kBAAmB,IAEnBC,cAAc,EAEdC,kBAAkB,EAElBC,cAAe,cAEfC,SAAS,EAOTC,QAAS,KAITC,UAAW,KAGXC,oBAAqB,KAGrBC,wBAAyB,KAGzBC,WAAY,KAMZC,cAAe,SAAUC,GAEvB,MAKM3E,EAAyC,GALrB,CAAA4E,IACxB,MAAMC,EAAM,IAAIrD,KAAKoD,EAAKE,cAAe,EAAG,GACtCC,EAAM,IAAIvD,KAAKoD,EAAKE,cAAe,EAAG,GAC5C,OAAOE,KAAKC,IAAIJ,EAAIK,oBAAqBH,EAAIG,oBAA7C,EAEaC,CAAkB,IAAI3D,MACrC,IAAI4D,EAAU,CAAC,EACf,IAAK,IAAIC,KAAaV,EAAY,CAChC,MAAMW,EAAQX,EAAWU,GACzBA,EAAYE,SAASF,EAAW,IAChCD,EAAQC,EAAYrF,GAAUsF,CAC/B,CACD,OAAOF,CACR,EAGDI,YAAa,KAQbC,mBAAoB,KAQpBC,mBAAoB,MAGtBhG,KAAKiG,YAAc,CACjBC,IAAK,CACHC,KAAM,SACNC,MAAO,GACPC,cAAe,GACfC,iBAAkB,GAClBC,oBAAqB,EACrBC,IAAK,SAAUhG,GACb,OAAOT,EAAK0G,sBAAsBjG,EACnC,EACDkG,OAAQ,SAAUlG,GAChB,OAAOT,EAAK4G,yBAAyBnG,EACtC,EACDkC,SAAU,CACRE,EAAG,SAAUpC,GACX,OAAO8E,KAAKsB,MAAMpG,EAAEqG,aAAe9G,EAAKkG,YAAYC,IAAIM,IAAIhG,GAC7D,EACDqC,EAAG,SAAUrC,GACX,OAAOA,EAAEqG,aAAe9G,EAAKkG,YAAYC,IAAIM,IAAIhG,EAClD,GAEHsG,OAAQ,CACN5B,KAAM,uBACNjC,OAAQ,GACR8D,UAAW,MAEbC,YAAa,SAAUxG,GACrB,OAAO,IAAIsB,KACTtB,EAAE4E,cACF5E,EAAEyG,WACFzG,EAAE0G,UACF1G,EAAE2G,WACF3G,EAAEqG,cACFO,SACH,GAEHC,KAAM,CACJlB,KAAM,OACNC,MAAO,GACPC,cAAe,SAAU7F,GACvB,OAAQT,EAAKU,QAAQe,QACnB,IAAK,MACH,OAAO,GACT,IAAK,OACH,OAAO,IACT,IAAK,QACH,OACE,IACCzB,EAAKU,QAAQ+B,uBACVzC,EAAKuH,mBAAmB9G,GACxB,IAGX,EACD8F,iBAAkB,EAClBC,oBAAqB,SAAU/F,GAC7B,OAAQT,EAAKU,QAAQe,QACnB,IAAK,MACH,OAAO,EACT,IAAK,OACH,OAAO,GACT,IAAK,QACH,OAAOzB,EAAKU,QAAQ+B,uBAChBzC,EAAKuH,mBAAmB9G,GACxB,GAET,EACDgG,IAAK,SAAUhG,GACb,OAAOT,EAAK0G,sBAAsBjG,EACnC,EACDkG,OAAQ,SAAUlG,GAChB,OAAOT,EAAK4G,yBAAyBnG,EACtC,EACDkC,SAAU,CACRE,EAAG,SAAUpC,GACX,MAA4B,UAAxBT,EAAKU,QAAQe,OACXzB,EAAKU,QAAQiB,SAAW,GAAK3B,EAAKU,QAAQkB,SAAW,EAChD2D,KAAKsB,OACTpG,EAAE2G,WAAiC,IAAnB3G,EAAE0G,UAAY,IAC7BnH,EAAKkG,YAAYoB,KAAKb,IAAIhG,IAI9B8E,KAAKsB,MAAMpG,EAAE2G,WAAapH,EAAKkG,YAAYoB,KAAKb,IAAIhG,IAChC,GAAnBA,EAAE0G,UAAY,GAEgB,SAAxBnH,EAAKU,QAAQe,OAClBzB,EAAKU,QAAQiB,SAAW,GAAK3B,EAAKU,QAAQkB,SAAW,EAChD2D,KAAKsB,OACTpG,EAAE2G,WAAkC,GAArBpH,EAAKwH,WAAW/G,IAC9BT,EAAKkG,YAAYoB,KAAKb,IAAIhG,IAI9B8E,KAAKsB,MAAMpG,EAAE2G,WAAapH,EAAKkG,YAAYoB,KAAKb,IAAIhG,IAC/B,EAArBT,EAAKwH,WAAW/G,GAGb8E,KAAKsB,MAAMpG,EAAE2G,WAAapH,EAAKkG,YAAYoB,KAAKb,IAAIhG,GAC5D,EACDqC,EAAG,SAAUrC,GACX,IAAIgH,EAAIhH,EAAE2G,WACV,GAAIpH,EAAKU,QAAQiB,SAAW,GAAK3B,EAAKU,QAAQkB,SAAW,EACvD,OAAQ5B,EAAKU,QAAQe,QACnB,IAAK,QACHgG,GAAyB,IAAnBhH,EAAE0G,UAAY,GACpB,MACF,IAAK,OACHM,GAA0B,GAArBzH,EAAKwH,WAAW/G,GAI3B,OAAO8E,KAAKsB,MAAMY,EAAIzH,EAAKkG,YAAYoB,KAAKb,IAAIhG,GACjD,GAEHsG,OAAQ,CACN5B,KAAM,qBACNjC,OAAQ,QACR8D,UAAW,MAEbC,YAAa,SAAUxG,GACrB,OAAO,IAAIsB,KACTtB,EAAE4E,cACF5E,EAAEyG,WACFzG,EAAE0G,UACF1G,EAAE2G,YACFC,SACH,GAEHK,IAAK,CACHtB,KAAM,MACNC,MAAO,GACPC,cAAe,SAAU7F,GACvB,OAAQT,EAAKU,QAAQe,QACnB,IAAK,OACH,OAAO,EACT,IAAK,QACH,OAAOzB,EAAKU,QAAQ+B,uBAChBzC,EAAKuH,mBAAmB9G,GACxB,GACN,IAAK,OACH,OAAOT,EAAKU,QAAQ+B,uBAChBzC,EAAK2H,kBAAkBlH,GACvB,IAET,EACD+F,oBAAqB,SAAU/F,GAE7B,OADAA,EAAI,IAAIsB,KAAKtB,GACLT,EAAKU,QAAQe,QACnB,IAAK,OACH,OAAO,EACT,IAAK,QACH,OAAOzB,EAAKU,QAAQ+B,yBACjBzC,EAAKU,QAAQ8B,oBACZxC,EAAK4H,cACH,IAAI7F,KAAKtB,EAAE4E,cAAe5E,EAAEyG,WAAa,EAAG,IAE5ClH,EAAK4H,cAAcnH,GACnB,EACF,EACN,IAAK,OACH,OAAOT,EAAKU,QAAQ+B,uBAChBzC,EAAK4H,cAAc,IAAI7F,KAAKtB,EAAE4E,cAAe,GAAI,KAC/CrF,EAAK4H,cAAc,IAAI7F,KAAKtB,EAAE4E,cAAe,IAC7C,EACF,GAET,EACDkB,iBAAkB,EAClBE,IAAK,SAAUhG,GACb,OAAOT,EAAK0G,sBAAsBjG,EACnC,EACDkG,OAAQ,SAAUlG,GAChB,OAAOT,EAAK4G,yBAAyBnG,EACtC,EACDkC,SAAU,CACRE,EAAG,SAAUpC,GACX,OAAQT,EAAKU,QAAQe,QACnB,IAAK,OACH,OAAO8D,KAAKsB,MACV7G,EAAKwH,WAAW/G,GAAKT,EAAKkG,YAAYwB,IAAIjB,IAAIhG,IAElD,IAAK,QACH,OAAIT,EAAKU,QAAQiB,SAAW,GAAK3B,EAAKU,QAAQkB,SAAW,EAChD2D,KAAKsB,OACTpG,EAAE0G,UAAY,GAAKnH,EAAKkG,YAAYwB,IAAIjB,IAAIhG,IAI/CT,EAAK4H,cAAcnH,GACnBT,EAAK4H,cAAc,IAAI7F,KAAKtB,EAAE4E,cAAe5E,EAAEyG,aAEnD,IAAK,OACH,OAAIlH,EAAKU,QAAQiB,SAAW,GAAK3B,EAAKU,QAAQkB,SAAW,EAChD2D,KAAKsB,OACT7G,EAAK6H,aAAapH,GAAK,GAAKT,EAAKkG,YAAYwB,IAAIjB,IAAIhG,IAGnDT,EAAK4H,cAAcnH,GAE/B,EACDqC,EAAG,SAAUrC,GACX,IAAIgH,EAAIzH,EAAKwH,WAAW/G,GACxB,GAAIT,EAAKU,QAAQiB,SAAW,GAAK3B,EAAKU,QAAQkB,SAAW,EACvD,OAAQ5B,EAAKU,QAAQe,QACnB,IAAK,OACHgG,EAAIzH,EAAK6H,aAAapH,GAAK,EAC3B,MACF,IAAK,OACHgH,EAAIzH,EAAKwH,WAAW/G,GACpB,MACF,IAAK,QACHgH,EAAIhH,EAAE0G,UAAY,EAIxB,OAAO5B,KAAKsB,MAAMY,EAAIzH,EAAKkG,YAAYwB,IAAIjB,IAAIhG,GAChD,GAEHsG,OAAQ,CACN5B,KAAM,gBACNjC,OAAQ,QACR8D,UAAW,MAEbC,YAAa,SAAUxG,GACrB,OAAO,IAAIsB,KAAKtB,EAAE4E,cAAe5E,EAAEyG,WAAYzG,EAAE0G,WAAWE,SAC7D,GAEHS,KAAM,CACJ1B,KAAM,OACNC,MAAO,GACPC,cAAe,GACfE,oBAAqB,SAAU/F,GAE7B,OADAA,EAAI,IAAIsB,KAAKtB,GACLT,EAAKU,QAAQe,QACnB,IAAK,OACH,OAAOzB,EAAKkG,YAAY4B,KAAKxB,cAC/B,IAAK,QACH,OAAOtG,EAAKU,QAAQ+B,uBAChBzC,EAAK4H,cACH,IAAI7F,KAAKtB,EAAE4E,cAAe5E,EAAEyG,WAAa,EAAG,IAC1ClH,EAAK4H,cAAcnH,GACvB,EAET,EACD8F,iBAAkB,EAClBE,IAAK,SAAUhG,GACb,OAAOT,EAAK0G,sBAAsBjG,EACnC,EACDkG,OAAQ,SAAUlG,GAChB,OAAOT,EAAK4G,yBAAyBnG,EACtC,EACDkC,SAAU,CACRE,EAAG,SAAUpC,GACX,OAAQT,EAAKU,QAAQe,QACnB,IAAK,OACH,OAAO8D,KAAKsB,MACV7G,EAAK4H,cAAcnH,GAAKT,EAAKkG,YAAY4B,KAAKrB,IAAIhG,IAEtD,IAAK,QACH,OAAO8E,KAAKsB,MACV7G,EAAK+H,mBAAmBtH,GAAKT,EAAKkG,YAAY4B,KAAKrB,IAAIhG,IAG9D,EACDqC,EAAG,SAAUrC,GACX,OAAOT,EAAK4H,cAAcnH,GAAKT,EAAKkG,YAAY4B,KAAKrB,IAAIhG,EAC1D,GAEHsG,OAAQ,CACN5B,KAAM,cACNjC,OAAQ,cACR8D,UAAW,MAEbC,YAAa,SAAUxG,GACrB,IAAIuH,EAAK,IAAIjG,KAAKtB,EAAE4E,cAAe5E,EAAEyG,WAAYzG,EAAE0G,WAE/Cc,EAAUD,EAAGE,UAAYlI,EAAKU,QAAQmB,kBAAoB,EAAI,GAKlE,OAJIoG,EAAU,IACZA,EAAU,GAEZD,EAAGG,QAAQH,EAAGb,UAAYc,GACnBD,EAAGX,SACX,GAEHe,MAAO,CACLhC,KAAM,QACNC,MAAO,GACPC,cAAe,GACfE,oBAAqB,GACrBD,iBAAkB,EAClBE,IAAK,WACH,OAAOzG,EAAK0G,uBACb,EACDC,OAAQ,WACN,OAAO3G,EAAK4G,0BACb,EACDjE,SAAU,CACRE,EAAG,SAAUpC,GACX,OAAO8E,KAAKsB,MAAMpG,EAAEyG,WAAalH,EAAKkG,YAAYkC,MAAM3B,IAAIhG,GAC7D,EACDqC,EAAG,SAAUrC,GACX,OAAOA,EAAEyG,WAAalH,EAAKkG,YAAYkC,MAAM3B,IAAIhG,EAClD,GAEHsG,OAAQ,CACN5B,KAAM,QACNjC,OAAQ,KACR8D,UAAW,MAEbC,YAAa,SAAUxG,GACrB,OAAO,IAAIsB,KAAKtB,EAAE4E,cAAe5E,EAAEyG,YAAYG,SAChD,GAEHgB,KAAM,CACJjC,KAAM,OACNC,MAAO,GACPI,IAAK,WACH,OAAOzG,EAAKU,QAAQkB,UAAY,CACjC,EACD+E,OAAQ,WACN,OAAO3G,EAAKU,QAAQiB,UAAY,CACjC,EACDgB,SAAU,CACRE,EAAG,WACD,OAAO,CACR,EACDC,EAAG,WACD,OAAO,CACR,GAEHiE,OAAQ,CACN5B,KAAM,KACNjC,OAAQ,KACR8D,UAAW,MAEbC,YAAa,SAAUxG,GACrB,OAAO,IAAIsB,KAAKtB,EAAE4E,eAAegC,SAClC,IAIYpH,KAAKiG,YACpB,GAAIjG,KAAKiG,YAAYoC,eAAepI,GAAO,CACzC,IAAIO,EAAIR,KAAKiG,YAAYhG,GACzBD,KAAKiG,YAAY,KAAOhG,GAAQ,CAC9BkG,KAAM,KAAOlG,EACbmG,MAAO5F,EAAEP,KACToG,cAAe7F,EAAE6F,cACjBC,iBAAkB9F,EAAE8F,iBACpBC,oBAAqB/F,EAAE+F,oBACvBC,IAAKhG,EAAEkG,OACPA,OAAQlG,EAAEgG,IACV9D,SAAU,CACRE,EAAGpC,EAAEkC,SAASG,EACdA,EAAGrC,EAAEkC,SAASE,GAEhBkE,OAAQtG,EAAEsG,OACVE,YAAaxG,EAAEwG,YAElB,CAoKH,SAASsB,EAAE9H,EAAG+H,GACZ,IAAIxF,EACFhD,EAAKU,QAAQU,SACXpB,EAAKkG,YAAYlG,EAAKU,QAAQgB,WAAWiF,OAAOlG,GAClDT,EAAKU,QAAQW,YACXrB,EAAKkG,YAAYlG,EAAKU,QAAQgB,WAAWiF,OAAOlG,GACpD,OAAyB,IAArBgI,UAAUC,SAA0B,IAAVF,EACpBxF,GACNhD,EAAK2I,2BACL3I,EAAKU,QAAQa,aACbvB,EAAKU,QAAQc,aAAa,GAC1BxB,EAAKU,QAAQc,aAAa,IAEvBwB,CACR,CAGD,SAAS4F,EAAEnI,EAAG+H,GACZ,IAAIvF,EACFjD,EAAKU,QAAQU,SAAWpB,EAAKkG,YAAYlG,EAAKU,QAAQgB,WAAW+E,IAAIhG,GACrET,EAAKU,QAAQW,YACXrB,EAAKkG,YAAYlG,EAAKU,QAAQgB,WAAW+E,IAAIhG,GAQjD,OAPyB,IAArBgI,UAAUC,SAA0B,IAAVF,IAC5BvF,GACEjD,EAAKU,QAAQa,aACbvB,EAAK6I,0BACL7I,EAAKU,QAAQc,aAAa,GAC1BxB,EAAKU,QAAQc,aAAa,IAEvByB,CACR,CA9LDhD,KAAK6I,gBAAkB,KAEvB7I,KAAK8I,YAAa,EAIlB9I,KAAK+I,SAAWnJ,EAAGoJ,MAEnBhJ,KAAKiJ,SAAW,CACdlG,MAAO,EACPC,OAAQ,GAGVhD,KAAKkJ,UAAY,CACfnG,MAAO,EACPC,OAAQ,GAGVhD,KAAKmJ,cAAgB,EACrBnJ,KAAKoJ,eAAiB,EAGtBpJ,KAAKqJ,oBAAsB,EAC3BrJ,KAAKsJ,uBAAyB,EAC9BtJ,KAAKuJ,iBAAmB,EAExBvJ,KAAKwJ,sBAAwB,GAE7BxJ,KAAKyJ,KAAO,KACZzJ,KAAK0E,QAAU,KAEf1E,KAAK0J,mBAAoB,EACzB1J,KAAK2J,mBAAoB,EAEzB3J,KAAK4J,eAAiB,IAAIC,EAC1B7J,KAAK8J,OAAS,KACd9J,KAAK+J,YAAc,KAInB/J,KAAKgK,UAAY,GAMjBhK,KAAKiK,MAAQ,WAiCX,OAhCAlK,EACGmK,UAAUnK,EAAKU,QAAQoB,OACvBmH,KAAI,SAAUxI,GACb,OAAOA,EAAE4G,SACV,IACA4B,KAAI,SAAUxI,GACbT,EAAKgJ,SAASoB,IACZ3J,EACAT,EAAKqK,aAAa5J,GAAGwI,KAAI,SAAUxI,GACjC,MAAO,CACLG,EAAGZ,EAAKkG,YAAYlG,EAAKU,QAAQgB,WAAWuF,YAAYxG,GACxDK,EAAG,KAEN,IAEJ,IAEHd,EAAK0J,KAAO7J,EACTyK,OAAOtK,EAAKU,QAAQO,cACpBsJ,OAAO,OACPlK,KAAK,QAAS,yBAEjBL,EAAK0J,KAAKrJ,KAAK,IAAK,GAAGA,KAAK,IAAK,GAAGkK,OAAO,OAAOlK,KAAK,QAAS,SAEhEL,EAAK+J,OAAS,IAAIA,EAAO/J,GAErBA,EAAKU,QAAQQ,aASnB,WACElB,EAAKwK,oBAC6B,QAAhCxK,EAAKU,QAAQgC,MAAMC,UACa,WAAhC3C,EAAKU,QAAQgC,MAAMC,SAErB3C,EAAK6I,0BAC2B,OAA9B7I,EAAKU,QAAQgC,MAAMO,OACfsC,KAAKC,IAAI,GAA4B,EAAxBxF,EAAKU,QAAQU,UAC1BpB,EAAKU,QAAQgC,MAAMO,OACzBjD,EAAK2I,2BAA6B,EAGG,KAAnC3I,EAAKU,QAAQmD,mBACiB,OAA9B7D,EAAKU,QAAQgC,MAAMO,SAEnBjD,EAAK6I,0BAA4B,GAG9B7I,EAAKwK,sBACRxK,EAAK6I,0BAA4B,EACjC7I,EAAK2I,2BAA6B3I,EAAKU,QAAQgC,MAAMM,OAGvDhD,EAAKyK,SAK6B,IAA9BzK,EAAKU,QAAQ8D,cACf3E,EAAGyK,OAAOtK,EAAKU,QAAQ8D,cAAckG,GACnC,SAAW1K,EAAKU,QAAQgE,eACxB,WAEE,OADA7E,EAAG8K,MAAMC,iBACF5K,EAAK6K,eAAe,EAC5B,KAIiC,IAAlC7K,EAAKU,QAAQ+D,kBACf5E,EAAGyK,OAAOtK,EAAKU,QAAQ+D,kBAAkBiG,GACvC,SAAW1K,EAAKU,QAAQgE,eACxB,WAEE,OADA7E,EAAG8K,MAAMC,iBACF5K,EAAK8K,mBAAmB,EAChC,IAIL9K,EAAK+J,OAAOgB,OACV/K,EAAKkJ,SAASlG,MACZhD,EAAKU,QAAQa,aACbvB,EAAKU,QAAQW,aAEjBrB,EAAK6E,YAEL,IAAImG,EAAUhL,EAAKiL,gBAGfjL,EAAKU,QAAQ6B,WACfvC,EAAKkL,SACHlL,EAAKU,QAAQwB,KACb,IAAIH,KAAKiJ,EAAQ,IACjBhL,EAAKqK,aAAaW,EAAQA,EAAQtC,OAAS,IAAIyC,OAC/C,WACEnL,EAAKoL,OACLpL,EAAKgF,YACN,IAGHhF,EAAKgF,aAGPhF,EAAKqL,0BAA0BL,EAAQ,IACvChL,EAAKsL,0BAA0BtL,EAAKuL,gBAAgBlE,UACrD,CAlFGmE,GAEFxL,EAAK0J,KAAK+B,KAAKzL,EAAKG,KACpBH,EAAK0J,KAAK+B,KAAKzL,EAAKe,YAEb,CACR,EAqHDd,KAAKwK,MAAQ,SAAUiB,GACrB,IAAIhL,EAAUV,EAAKU,QAEM,IAArB+H,UAAUC,SACZgD,GAAgB,GAIlB,IAAIC,EAAY3L,EAAK0J,KAClBY,OAAO,UACPsB,UAAU,iBACV1J,MACC,WACE,IAAIA,EAAOlC,EAAKiL,gBAChB,OAAOS,IAAkB1L,EAAKoJ,cAAgBlH,EAAK2J,UAAY3J,CAChE,IACD,SAAUzB,GACR,OAAOA,CACR,IAEDqL,EAAoB,EACpBC,EAAmB,EAMnBC,EAAML,EACPM,QACA1B,OAAO,OACPlK,KAAK,SAAS,SAAUI,GACvB,OAAO8H,EAAE9H,GAAG,EACb,IACAJ,KAAK,UAAU,SAAUI,GACxB,OAAOmI,EAAEnI,GAAG,EACb,IACAJ,KAAK,KAAK,SAAUI,GACnB,OAAIC,EAAQ8B,qBACVxC,EAAKkJ,SAASlG,MAAQuC,KAAKC,IAAIxF,EAAKkJ,SAASlG,MAAOuF,EAAE9H,GAAG,IAClD,GAEAyL,EAAkBzL,EAAGT,EAAKkJ,SAAU,QAASX,EAAE9H,GAAG,GAE5D,IACAJ,KAAK,KAAK,SAAUI,GACnB,OAAIC,EAAQ8B,oBACH0J,EAAkBzL,EAAGT,EAAKkJ,SAAU,SAAUN,EAAEnI,GAAG,KAE1DT,EAAKkJ,SAASjG,OAASsC,KAAKC,IAAIxF,EAAKkJ,SAASjG,OAAQ2F,EAAEnI,GAAG,IACpD,EAEV,IACAJ,KAAK,SAAS,SAAUI,GACvB,IAAI0L,EAAY,eACZhH,EAAO,IAAIpD,KAAKtB,GACpB,OAAQC,EAAQe,QACd,IAAK,OACH0K,GAAa,MAAQhH,EAAKiC,WAE5B,IAAK,MACH+E,GAAa,MAAQhH,EAAKgC,UAAY,OAAShC,EAAK+C,SAEtD,IAAK,OACHiE,GAAa,MAAQnM,EAAK4H,cAAczC,GAE1C,IAAK,QACHgH,GAAa,OAAShH,EAAK+B,WAAa,GAE1C,IAAK,OACHiF,GAAa,MAAQhH,EAAKE,cAE9B,OAAO8G,CACR,IAGH,SAASD,EAAkBE,EAAalD,EAAUmD,EAAMC,GACtD,IAAIC,EAAM,EACV,OAAQb,GACN,KAAK,EAKH,OAJAa,EAAMrD,EAASmD,GAEfnD,EAASmD,IAASC,EAClBtM,EAAK6J,eAAe2C,YAAYJ,EAAaG,GACtCA,EAET,KAAKvM,EAAKqJ,eAOR,OANArJ,EAAK6J,eAAe2C,YAAYJ,EAAalD,EAASmD,IAEtDP,EAAoBQ,EACpBP,EAAmB/L,EAAK6J,eAAe4C,qBAAqB,GAE5DzM,EAAK6J,eAAe6C,aAAaX,GAC1B7C,EAASmD,GAElB,KAAKrM,EAAKoJ,cAQR,OALA0C,IAFAS,GAAOD,GAGPP,EAAmB7C,EAASmD,GAAQrM,EAAK6J,eAAe8C,UAExD3M,EAAK6J,eAAe2C,YAAYJ,EAAaG,GAC7CvM,EAAK6J,eAAe+C,YAAYd,GACzBS,EAEZ,CA/BDvM,EAAK8I,gBAAkBkD,EAiCvBA,EACGzB,OAAO,QACPlK,KAAK,SAAS,SAAUI,GACvB,OAAO8H,EAAE9H,GAAG,GAAQC,EAAQa,aAAeb,EAAQW,WACpD,IACAhB,KAAK,UAAU,SAAUI,GACxB,OAAOmI,EAAEnI,GAAG,GAAQC,EAAQa,aAAeb,EAAQW,WACpD,IACAhB,KAAK,QAAS,qBAKjB,IAAIwM,EAAoBb,EACrBzB,OAAO,OACPlK,KAAK,KAAK,WACT,MAA+B,SAA3BK,EAAQgC,MAAMC,SACT3C,EAAK2I,2BAA6BjI,EAAQc,aAAa,GAEvDd,EAAQc,aAAa,EAE/B,IACAnB,KAAK,KAAK,WACT,MAA+B,QAA3BK,EAAQgC,MAAMC,SACT3C,EAAK6I,0BAA4BnI,EAAQc,aAAa,GAEtDd,EAAQc,aAAa,EAE/B,IACAnB,KAAK,QAAS,yBACbyM,EAAOD,EACRjB,UAAU,KACV1J,MAAK,SAAUzB,GACd,OAAOT,EAAKgJ,SAAS+D,IAAItM,EAC1B,IACAwL,QACA1B,OAAO,KA8HV,SAASyC,EAAaC,GACpB,OAAQvM,EAAQgC,MAAMK,QACpB,IAAK,QACHkK,EAAU5M,KAAK,aAAa,SAAUI,GACpC,IAAIyM,EAAI,eACR,OAAQxM,EAAQgC,MAAMC,UACpB,IAAK,QACHuK,GAAK,cAAgB3E,EAAE9H,GAAK,OAAS8H,EAAE9H,GAAK,IAC5C,MACF,IAAK,OACHyM,GAAK,iBAAmBlN,EAAK2I,2BAA6B,IAI9D,OAAOuE,CACR,IACD,MACF,IAAK,OACHD,EAAU5M,KAAK,aAAa,SAAUI,GACpC,IAAIyM,EAAI,gBACR,OAAQxM,EAAQgC,MAAMC,UACpB,IAAK,QACHuK,GACE,eACC3E,EAAE9H,GAAKT,EAAK2I,4BACb,MACAJ,EAAE9H,GACF,IACF,MACF,IAAK,OACHyM,GACE,cACAlN,EAAK2I,2BACL,MACA3I,EAAK2I,2BACL,IAIN,OAAOuE,CACR,IAGN,CAxKDJ,EACGvC,OAAO,QACPlK,KAAK,SAAS,SAAUI,GACvB,MACE,aACAT,EAAKmN,sBAAsB1M,EAAEG,IACR,OAApBF,EAAQkE,QAAmB,gBAAkB,GAEjD,IACAvE,KAAK,QAASK,EAAQU,UACtBf,KAAK,SAAUK,EAAQU,UACvBf,KAAK,KAAK,SAAUI,GACnB,OAAOT,EAAKoN,mBAAmB3M,EAAEG,EAClC,IACAP,KAAK,KAAK,SAAUI,GACnB,OAAOT,EAAKqN,mBAAmB5M,EAAEG,EAClC,IACA8J,GAAG,SAAS,SAAUjK,GACrB,GAAwB,OAApBC,EAAQkE,QACV,OAAO5E,EAAK4E,QAAQ,IAAI7C,KAAKtB,EAAEG,GAAIH,EAAEK,EAExC,IACA2K,MAAK,SAAUwB,GACVvM,EAAQY,WAAa,GACvB2L,EACG5M,KAAK,KAAMK,EAAQY,YACnBjB,KAAK,KAAMK,EAAQY,YAID,OAArBtB,EAAKgK,aACoB,OAAzBtJ,EAAQgD,cACRhD,EAAQgD,aAAa4E,eAAe,SAEpC2E,EAAU5M,KAAK,OAAQK,EAAQgD,aAAa4J,MAG1C5M,EAAQiE,SACVsI,EACGvC,GAAG,aAAa,SAAUjK,GACzBT,EAAKG,IAAIoN,KAAK9M,EAAGR,KAClB,IACAyK,GAAG,YAAY,WACd1K,EAAKG,IAAIqN,KAAK/M,EACf,GAEN,IAGEC,EAAQiE,SACXmI,EAAKvC,OAAO,SAASkD,MAAK,SAAUhN,GAClC,OAAOT,EAAK0N,WAAW,IAAI3L,KAAKtB,EAAEG,GAAIF,EAAQuD,oBAC/C,IAM+B,KAA9BvD,EAAQmD,mBACVmI,EACGzB,OAAO,QACPlK,KAAK,QAAS,eACdA,KAAK,KAAK,SAAUI,GACnB,IAAIqC,EAAIpC,EAAQc,aAAa,GAC7B,OAAQd,EAAQgC,MAAMC,UACpB,IAAK,MACHG,GAAK9C,EAAK6I,0BAA4B,EACtC,MACF,IAAK,SACH/F,GAAK8F,EAAEnI,GAAKT,EAAK6I,0BAA4B,EAGjD,OACE/F,EACApC,EAAQgC,MAAMnC,OAAOuC,GACQ,UAAzBpC,EAAQgC,MAAMK,QACa,UAA3BrC,EAAQgC,MAAMC,UACU,SAAzBjC,EAAQgC,MAAMK,QACc,SAA3BrC,EAAQgC,MAAMC,UACX,EACD,EAET,IACAtC,KAAK,KAAK,SAAUI,GACnB,IAAIoC,EAAInC,EAAQc,aAAa,GAC7B,OAAQd,EAAQgC,MAAMC,UACpB,IAAK,QACHE,GAAK0F,EAAE9H,GACP,MACF,IAAK,SACL,IAAK,MACHoC,GAAK0F,EAAE9H,GAAK,EAGhB,MAA4B,UAAxBC,EAAQgC,MAAME,MAEdC,EACA7C,EAAK2I,2BACLjI,EAAQgC,MAAMnC,OAAOsC,GACO,UAAzBnC,EAAQgC,MAAMK,QAAsB,EAAI,GAGxCF,EAAInC,EAAQgC,MAAMnC,OAAOsC,CACjC,IACAxC,KAAK,eAAe,WACnB,OAAQK,EAAQgC,MAAME,OACpB,IAAK,QACL,IAAK,OACH,MAAO,QACT,IAAK,MACL,IAAK,QACH,MAAO,MACT,QACE,MAAO,SAEZ,IACAvC,KAAK,qBAAqB,WACzB,OAAOL,EAAKwK,oBAAsB,SAAW,KAC9C,IACAiD,MAAK,SAAUhN,GACd,OAAOT,EAAK0N,WAAW,IAAI3L,KAAKtB,GAAIC,EAAQmD,kBAC7C,IACA4H,KAAKuB,GAmD0B,OAAhCtM,EAAQwD,qBACV4I,EACGvC,OAAO,QACPlK,KAAK,SAAS,SAAUI,GACvB,MAAO,iBAAmBT,EAAKmN,sBAAsB1M,EAAEG,EACxD,IACAP,KAAK,KAAK,SAAUI,GACnB,OAAOT,EAAKoN,mBAAmB3M,EAAEG,GAAKF,EAAQU,SAAW,CAC1D,IACAf,KAAK,KAAK,SAAUI,GACnB,OAAOT,EAAKqN,mBAAmB5M,EAAEG,GAAKF,EAAQU,SAAW,CAC1D,IACAf,KAAK,cAAe,UACpBA,KAAK,oBAAqB,WAC1BoN,MAAK,SAAUhN,GACd,OAAOT,EAAK0N,WAAW,IAAI3L,KAAKtB,EAAEG,GAAIF,EAAQwD,oBAC/C,KAOiB,IAAlBwH,GACFC,EACGgC,aACAC,SAASlN,EAAQ6D,mBACjBlE,KAAK,KAAK,SAAUI,GACnB,OAAOC,EAAQ8B,oBACX,EACAxC,EAAK6J,eAAegE,YAAYpN,EACrC,IACAJ,KAAK,KAAK,SAAUI,GACnB,OAAOC,EAAQ8B,oBACXxC,EAAK6J,eAAegE,YAAYpN,GAChC,CACL,IAGL,IAAIqN,EAAY9N,EAAKkJ,SAASlG,MAC1B+K,EAAa/N,EAAKkJ,SAASjG,OAE3BvC,EAAQ8B,oBACVxC,EAAKkJ,SAASjG,QAAU6I,EAAoBC,EAE5C/L,EAAKkJ,SAASlG,OAAS8I,EAAoBC,EAI7CJ,EACGqC,OACAL,aACAC,SAASlN,EAAQ6D,mBACjBlE,KAAK,KAAK,SAAUI,GACnB,GAAIC,EAAQ8B,oBACV,OAAO,EAEP,OAAQkJ,GACN,KAAK1L,EAAKoJ,cACR,OAAO7D,KAAKY,IAAInG,EAAKkJ,SAASlG,MAAO8K,GACvC,KAAK9N,EAAKqJ,eACR,OAAQd,EAAE9H,GAAG,GAGpB,IACAJ,KAAK,KAAK,SAAUI,GACnB,IAAIC,EAAQ8B,oBAQV,OAAO,EAPP,OAAQkJ,GACN,KAAK1L,EAAKoJ,cACR,OAAO7D,KAAKY,IAAInG,EAAKkJ,SAASjG,OAAQ8K,GACxC,KAAK/N,EAAKqJ,eACR,OAAQT,EAAEnI,GAAG,GAKpB,IACAwN,SAGHjO,EAAKkO,QACN,CACF,GAEDnO,EAAWoO,UAAY,CAQrBC,KAAM,SAAUC,GAGd,IAAIC,EAASrO,KAETS,EAAW4N,EAAO5N,QAAU6N,EAAeD,EAAO5N,QAAS2N,GAO/D,GAmIA,WACE,IACGC,EAAOpI,YAAYoC,eAAe5H,EAAQe,SACxB,QAAnBf,EAAQe,QAC2B,OAAnCf,EAAQe,OAAO+M,UAAU,EAAG,GAE5B,MAAM,IAAIC,MAAM,eAAiB/N,EAAQe,OAAS,kBAGpD,IACG6M,EAAOpI,YAAYoC,eAAe5H,EAAQgB,YACrB,SAAtBhB,EAAQgB,UAER,MAAM,IAAI+M,MACR,kBAAoB/N,EAAQgB,UAAY,kBAI5C,GACE4M,EAAOpI,YAAYxF,EAAQe,QAAQ4E,OACnCiI,EAAOpI,YAAYxF,EAAQgB,WAAW2E,MAEtC,MAAM,IAAIoI,MACR,IACE/N,EAAQgB,UACR,kCACAhB,EAAQe,OACR,IAKP,CAtKDiN,GACAC,EAAiBjO,EAAQO,cAAc,EAAO,iBAEY,IAAtDqN,EAAOtN,gBAAgB4N,QAAQlO,EAAQyB,UACzC,MAAM,IAAIsM,MACR,kBAAoB/N,EAAQyB,SAAW,4BAI3C,GAA8C,OAA1CtC,EAAGyK,OAAO5J,EAAQO,cAAc,GAAG,GACrC,MAAM,IAAIwN,MACR,aACE/N,EAAQO,aACR,+CAIN,IACE0N,EAAiBjO,EAAQ8D,cAAc,EAAM,gBAC7CmK,EAAiBjO,EAAQ+D,kBAAkB,EAAM,mBAIlD,CAHC,MAAOoK,GAEP,OADAC,QAAQC,IAAIF,EAAMG,UACX,CACR,CAIIX,EAAS/F,eAAe,eAC3BrI,KAAKS,QAAQgB,UAqFf,SAA6BD,GAC3B,OAAQA,GACN,IAAK,OACH,MAAO,QACT,IAAK,QAEL,IAAK,OACH,MAAO,MACT,IAAK,MACH,MAAO,OACT,QACE,MAAO,MAEZ,CAlG0BwN,CAAoBZ,EAAS5M,SAIrB,iBAA1Bf,EAAQgE,eACW,KAA1BhE,EAAQgE,gBAERoK,QAAQC,IACN,+DAEFrO,EAAQgE,cAAgB,eAI1B,IAwPuBmB,EAxPnBqH,EAAI,CACN,OACA,aACA,UACA,YACA,gBACA,0BACA,sBACA,eAGF,IAAK,IAAIgC,KAAKhC,EACRmB,EAAS/F,eAAe4E,EAAEgC,MAC5BxO,EAAQwM,EAAEgC,IAAMb,EAASnB,EAAEgC,KAwC/B,SAASP,EAAiBQ,EAAUC,EAAYhJ,GAC9C,IACIgJ,IAA2B,IAAbD,GACdA,aAAoBE,SACA,iBAAbF,IACI,KAAbA,EAEA,OAAO,EAET,MAAM,IAAIV,MAAM,OAASrI,EAAO,gBACjC,CAyID,SAASkJ,EAAoBzJ,GAU3B,OATqB,iBAAVA,IACTA,EAAQ,CAACA,IAGN0J,MAAMC,QAAQ3J,KACjBiJ,QAAQC,IAAI,wDACZlJ,EAAQ,CAAC,IAGHA,EAAM6C,QACZ,KAAK,EACH,MAAO,CAAC7C,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,IAC9C,KAAK,EACH,MAAO,CAACA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,IAC9C,KAAK,EACH,MAAO,CAACA,EAAM,GAAIA,EAAM,GAAIA,EAAM,GAAIA,EAAM,IAC9C,KAAK,EACH,OAAOA,EACT,QACE,OAAOA,EAAM4J,MAAM,EAAG,GAE3B,CAwCD,OArPA/O,EAAQuD,oBACiC,iBAAhCvD,EAAQuD,qBACwB,mBAAhCvD,EAAQuD,oBACXvD,EAAQuD,oBACRhE,KAAKiG,YAAYxF,EAAQgB,WAAWqF,OAAO5B,KACjDzE,EAAQmD,kBAC+B,iBAA9BnD,EAAQmD,mBACsB,mBAA9BnD,EAAQmD,kBACXnD,EAAQmD,kBACR5D,KAAKiG,YAAYxF,EAAQe,QAAQsF,OAAO7D,OAC9CxC,EAAQwD,oBACkC,iBAAhCxD,EAAQwD,qBACkB,KAAhCxD,EAAQwD,qBAC6B,mBAAhCxD,EAAQwD,oBACXxD,EAAQwD,oBACR,KACNxD,EAAQc,aAAe8N,EAAoB5O,EAAQc,cACnDd,EAAQ4C,aAAegM,EAAoB5O,EAAQ4C,cACnD5C,EAAQiD,UAAY2K,EAAOoB,kBAAkBhP,EAAQiD,WACrDjD,EAAQkD,SAkMR,SAAwBiC,GACtB,MAAqB,iBAAVA,EACF,CAACA,EAAOA,GAAmB,KAAVA,EAAe,IAAM,KAG3C0J,MAAMC,QAAQ3J,GACK,IAAjBA,EAAM6C,OACD,CAAC7C,EAAM,GAAIA,EAAM,GAAK,KACpBA,EAAM6C,OAAS,EACjB7C,EAAM4J,MAAM,EAAG,GAGjB5J,EAGF,CAAC,OAAQ,QACjB,CAlNkB8J,CAAejP,EAAQkD,UAC1ClD,EAAQiB,UAmNekE,EAnNUnF,EAAQiB,UAoNxB,EAAIkE,EAAQ,KAnN7BnF,EAAQkB,SAsNR,SAAuBiE,GACrB,OAAIA,EAAQ,GAAKnF,EAAQiB,SAAW,GAClCmN,QAAQC,IACN,0EAEK,MAEFlJ,EAAQ,EAAIA,EAAQ,IAC5B,CA9NkB+J,CAAclP,EAAQkB,UACpCyM,EAAS/F,eAAe,iBA2I7B,WACE,OAAQ5H,EAAQ6C,wBACd,IAAK,MACH7C,EAAQ4C,aAAa,GAAKgL,EAAO7E,sBACjC,MACF,IAAK,SACH/I,EAAQ4C,aAAa,GAAKgL,EAAO7E,sBACjC,MACF,IAAK,SACL,IAAK,SACH/I,EAAQ4C,aAC+B,UAArC5C,EAAQ8C,yBAAuC,EAAI,GACjD8K,EAAO7E,sBAEhB,CAxJCoG,GA2FF,WAEE,IACGxB,EAAS/F,eAAe,UACxB+F,EAAS/F,eAAe,WACtB+F,EAAS3L,MAAM4F,eAAe,SACjC,CACA,OAAQ5H,EAAQgC,MAAMC,UACpB,IAAK,OACHjC,EAAQgC,MAAME,MAAQ,QACtB,MACF,IAAK,QACHlC,EAAQgC,MAAME,MAAQ,OACtB,MACF,QACElC,EAAQgC,MAAME,MAAQ,SAGG,SAAzBlC,EAAQgC,MAAMK,OAChBrC,EAAQgC,MAAME,MAAQ,QACY,UAAzBlC,EAAQgC,MAAMK,SACvBrC,EAAQgC,MAAME,MAAQ,OAEzB,GAGEyL,EAAS/F,eAAe,UACxB+F,EAAS/F,eAAe,WACtB+F,EAAS3L,MAAM4F,eAAe,aAGJ,SAA3B5H,EAAQgC,MAAMC,UACa,UAA3BjC,EAAQgC,MAAMC,WAEdjC,EAAQgC,MAAMnC,OAAS,CACrBsC,EAAG,GACHC,EAAG,KAIV,CAjIDgN,GA4NO7P,KAAKiK,OACb,EAQDwF,kBAAmB,SAAU7J,GAO3B,OAJK0J,MAAMC,QAAQ3J,KACjBA,EAAQ,CAACA,IAGJA,EACJoD,KAAI,SAAU/G,GACb,MAAa,QAATA,EACK,IAAIH,KAETG,aAAgBH,MACXG,CAGV,IACA6N,QAAO,SAAUtP,GAChB,OAAa,IAANA,CACR,GACJ,EASD2K,KAAM,SAAUY,GAGd,IAAIsC,EAASrO,KACTS,EAAU4N,EAAO5N,QAEI,IAArB+H,UAAUC,SACZsD,EAAMsC,EAAO5E,KAAKkC,UAAU,kBAG9B,IAAIkB,EAAOd,EACRJ,UAAU,OACVA,UAAU,KACV1J,MAAK,SAAUzB,GACd,OAAO6N,EAAOtF,SAAS+D,IAAItM,EAC5B,IAIH,SAASuP,EAASC,GAChB,GAA2B,OAAvB3B,EAAOtE,YACT,OAAO,EAGTiG,EAAQ5P,KAAK,QAAQ,SAAUI,GAC7B,OACU,OAARA,EAAEK,GACFJ,EAAQ4H,eAAe,+BACtB5H,EAAQ4B,2BAEL5B,EAAQgD,aAAa4E,eAAe,QAC/B5H,EAAQgD,aAAa4J,KAKL,OAAzB5M,EAAQgD,cACRhD,EAAQgD,aAAa4E,eAAe,WAC3B,IAAR7H,EAAEK,GACQ,OAARL,EAAEK,GACDJ,EAAQ4H,eAAe,8BACvB5H,EAAQ4B,2BAEL5B,EAAQgD,aAAaK,MAI5BtD,EAAEK,EAAI,GACNJ,EAAQwC,OAAO,GAAK,GACK,OAAzBxC,EAAQgD,cACRhD,EAAQgD,aAAa4E,eAAe,YAE7B5H,EAAQgD,aAAawM,SAGvB5B,EAAOtE,YACZzE,KAAKY,IAAI1F,EAAEK,EAAGJ,EAAQwC,OAAOxC,EAAQwC,OAAOwF,OAAS,IAExD,GACF,CAqDD,SAASyH,EAAoBF,GACgB,mBAAhCvP,EAAQwD,qBACjB+L,EAAQxC,MAAK,SAAUhN,GACrB,OAAOC,EAAQwD,oBAAoBzD,EAAEG,EAAGH,EAAEK,EAC3C,GAEJ,CAzDDgM,EACGa,aACAC,SAASlN,EAAQ6D,mBACjB+F,OAAO,QACPjK,KAAK,SAAS,SAAUI,GACvB,IAAI2P,EAAY9B,EAAOnB,sBAAsB1M,EAAEG,GAAGyP,OAAOC,MAAM,KAC3DC,EAAWjC,EAAOkC,eAAe/P,EAAEG,EAAG,IAAImB,MAC1C0O,EAAWnC,EAAOoC,YAAYjQ,EAAEG,EAAG,IAAImB,MAgC3C,OA7ByB,OAAvBuM,EAAOtE,aACE,OAARvJ,EAAEK,GACDJ,EAAQ4H,eAAe,+BACtB5H,EAAQ4B,4BACR5B,EAAQgD,aAAa4E,eAAe,UAEvC8H,EAAUO,KAAK,cAGbF,EACFL,EAAUO,KAAK,OACLJ,GACVH,EAAUO,KAAK,UAGL,OAARlQ,EAAEK,EACJsP,EAAUO,KACRrC,EAAOvE,OAAO6G,SAASnQ,EAAEK,EAA0B,OAAvBwN,EAAOtE,cAE5BtJ,EAAQ4B,2BAA6BiO,GAC9CH,EAAUO,KACRrC,EAAOvE,OAAO6G,SAAS,EAA0B,OAAvBtC,EAAOtE,cAIb,OAApBtJ,EAAQkE,SACVwL,EAAUO,KAAK,gBAGVP,EAAUS,KAAK,IACvB,IACApF,KAAKuE,GAERlD,EACGa,aACAC,SAASlN,EAAQ6D,mBACjB+F,OAAO,SACPmD,MAAK,SAAUhN,GACd,OAAO6N,EAAOwC,kBAAkBrQ,EACjC,IAeHqM,EACGa,aACAC,SAASlN,EAAQ6D,mBACjB+F,OAAO,QACPjK,KAAK,SAAS,SAAUI,GACvB,MAAO,iBAAmB6N,EAAOnB,sBAAsB1M,EAAEG,EAC1D,IACA6K,KAAK0E,GACL9P,KAAK,QAAQI,IACZ,IAAKA,EAAEK,EAAG,MAAO,OACjB,MAAMiQ,EAAMzC,EAAOtE,YACjBzE,KAAKY,IAAI1F,EAAEK,EAAGJ,EAAQwC,OAAOxC,EAAQwC,OAAOwF,OAAS,KAEvD,OAAOsI,EAAAA,EAAAA,IAAoBD,EAAK,IAAhC,GAEL,EAWDE,uBAAwB,SAAUC,EAAWC,GAE3C,IAAK,IAAIC,KAAQD,EACf,GAAIA,EAAK7I,eAAe8I,GAAO,CAC7B,IAAIC,EAAS,IAAIC,OAAO,MAAQF,EAAO,MAAO,MAC9CF,EAAYA,EAAUK,QAAQF,EAAQF,EAAKC,GAC5C,CAEH,OAAOF,CACR,EAcDM,aAAc,SAAUC,EAAWC,EAAaC,GAG9C,SAA0B,IAArBlJ,UAAUC,QAAgBiJ,GAAqC,OAA5B1R,KAAKS,QAAQ+Q,MAId,mBAA5BxR,KAAKS,QAAQ+Q,IACK,mBAAhBC,IACTA,EAAcA,KAETzR,KAAKS,QAAQ+Q,GAAWG,MAAM3R,KAAMyR,KAE3C5C,QAAQC,IAAI,yBAA2B0C,EAAY,wBAC5C,GAEV,EAQD7M,QAAS,SAAUnE,EAAGoR,GAGpB,OAAO5R,KAAKuR,aAAa,UAAW,CAAC/Q,EAAGoR,GACzC,EAKDhN,UAAW,WAGT,OAAO5E,KAAKuR,aAAa,YAC1B,EAKDxM,WAAY,WAGV,IAAI8M,EAAW7R,KAAKuR,aAAa,aAAc,GAAIvR,KAAK8I,YAExD,OADA9I,KAAK8I,YAAa,EACX+I,CACR,EAQD/M,wBAAyB,SAAUjD,GAGjC,IAAIwM,EAASrO,KACb,OAAOA,KAAKuR,aAAa,2BAA2B,WAClD,IAAI9P,EAAY4M,EAAOjE,aAAavI,GACpC,MAAO,CAACJ,EAAUqQ,QAASrQ,EAAUyJ,MACtC,GACF,EAQDrG,oBAAqB,SAAUhD,GAG7B,IAAIwM,EAASrO,KACb,OAAOA,KAAKuR,aAAa,uBAAuB,WAC9C,IAAI9P,EAAY4M,EAAOjE,aAAavI,GACpC,MAAO,CAACJ,EAAUqQ,QAASrQ,EAAUyJ,MACtC,GACF,EAODlF,mBAAoB,SAAU+L,GAI5B,OADA/R,KAAK2J,kBAAoBoI,EAClB/R,KAAKuR,aAAa,qBAAsB,CAACQ,GACjD,EAODhM,mBAAoB,SAAUgM,GAI5B,OADA/R,KAAK0J,kBAAoBqI,EAClB/R,KAAKuR,aAAa,qBAAsB,CAACQ,GACjD,EAED3G,0BAA2B,SAAUlG,EAAM8M,GAGrChS,KAAKiS,mBAAmB/M,IAC1BlF,KAAKgG,oBAAmB,GAGD,IAArBwC,UAAUC,QACRzI,KAAK0J,oBAAsB1J,KAAKkS,mBAAmBF,IACrDhS,KAAK+F,oBAAmB,EAG7B,EAEDsF,0BAA2B,SAAUnG,EAAMiN,GAGrCnS,KAAKkS,mBAAmBhN,IAC1BlF,KAAK+F,oBAAmB,GAGD,IAArByC,UAAUC,QACRzI,KAAK2J,oBAAsB3J,KAAKiS,mBAAmBE,IACrDnS,KAAKgG,oBAAmB,EAG7B,EAEDF,YAAa,WAGX,OAAO9F,KAAKuR,aAAa,cAC1B,EAMDa,aAAcxS,EAAGkH,OAAO,MAExB2G,WAAY,SAAUjN,EAAGsG,GAOvB,GAJI0B,UAAUC,OAAS,IACrB3B,EAAS,SAGW,mBAAXA,EACT,OAAOA,EAAOtG,GAEd,IAAI6R,EAAIzS,EAAG0S,KAAKxL,OAAOA,GACvB,OAAOuL,EAAE7R,EAEZ,EAEDqQ,kBAAmB,SAAUrQ,GAG3B,GAAY,OAARA,EAAEK,GAAeb,KAAKS,QAAQ4B,0BAU3B,CACL,IAAIuD,EAAQpF,EAAEK,EAMd,OAJc,OAAV+E,GAAkB5F,KAAKS,QAAQ4B,4BACjCuD,EAAQ,GAGH5F,KAAKgR,uBACVhR,KAAKS,QAAQoD,qBAAqBE,OAClC,CACEwO,MAAOvS,KAAKoS,aAAaxM,GACzBO,KAAMnG,KAAKS,QAAQkD,SAAmB,IAAViC,EAAc,EAAI,GAC9CmB,UAAW/G,KAAKiG,YAAYjG,KAAKS,QAAQgB,WAAWqF,OAAOC,UAC3D7B,KAAMlF,KAAKyN,WACT,IAAI3L,KAAKtB,EAAEG,GACXX,KAAKS,QAAQuD,sBAIpB,CA5BC,OAAOhE,KAAKgR,uBACVhR,KAAKS,QAAQoD,qBAAqBC,MAClC,CACEoB,KAAMlF,KAAKyN,WACT,IAAI3L,KAAKtB,EAAEG,GACXX,KAAKS,QAAQuD,sBAwBtB,EAcD4G,eAAgB,SAAU4H,GAGxB,GAAIxS,KAAK0J,mBAA2B,IAAN8I,EAC5B,OAAO,EAGT,IAAIC,EAAQzS,KAAK0S,eACf1S,KAAKoJ,eACLpJ,KAAKkK,UAAUlK,KAAKsL,gBAAiBkH,IAMvC,OAHAxS,KAAK6E,oBAAoB4N,EAAME,KAC/B3S,KAAKqL,0BAA0BrL,KAAKsL,gBAAgBlE,UAAWqL,EAAM5Q,QAE9D,CACR,EAUDgJ,mBAAoB,SAAU2H,GAG5B,GAAIxS,KAAK2J,mBAA2B,IAAN6I,EAC5B,OAAO,EAGT,IAAIC,EAAQzS,KAAK0S,eACf1S,KAAKmJ,cACLnJ,KAAKkK,UAAUlK,KAAKgL,gBAAgB,IAAKwH,GAAG5G,WAM9C,OAHA5L,KAAK8E,wBAAwB2N,EAAM5Q,OACnC7B,KAAKoL,0BAA0BqH,EAAM5Q,MAAO4Q,EAAME,MAE3C,CACR,EAEDD,eAAgB,SAAUrS,EAAWuS,GAGnC,IAAIvE,EAASrO,KACT6S,EAAWxS,IAAcL,KAAKmJ,cAC9B2J,GAAK,EACLC,EAAQH,EAAWnK,OACnBsC,EAAU/K,KAAKgL,gBAEnB,SAASgI,EAAexS,GACtB,MAAO,CACLG,EAAG0N,EAAOpI,YAAYoI,EAAO5N,QAAQgB,WAAWuF,YAAYxG,GAC5DK,EAAG,KAEN,CAGD,OAASiS,EAAIC,GAAO,CAClB,GAAIF,GAAY7S,KAAKiS,mBAAmBW,EAAWE,IAAK,CACtDF,EAAaA,EAAWpD,MAAM,EAAGsD,EAAI,GACrC,KACD,CACD,IAAKD,GAAY7S,KAAKkS,mBAAmBU,EAAWE,IAAK,CACvDF,EAAaA,EAAWpD,MAAM,EAAGsD,GACjC,KACD,CACF,CAID,IAAKA,EAAI,EAAGC,GAFZH,EAAaA,EAAWpD,OAAOxP,KAAKS,QAAQS,QAEbuH,OAAQqK,EAAIC,EAAOD,GAAK,EACrD9S,KAAK+I,SAASoB,IACZyI,EAAWE,GAAG1L,UACdpH,KAAKoK,aAAawI,EAAWE,IAAI9J,IAAIgK,IAGvChT,KAAK+I,SAASiF,OAAO6E,EAAW9H,EAAQG,MAAQH,EAAQ+G,SAoB1D,OAjBA/G,EAAU/K,KAAKgL,gBAEX6H,IACFD,EAAaA,EAAWhH,WAG1B5L,KAAKwK,MAAMnK,GAEXL,KAAKiL,SACHjL,KAAKS,QAAQwB,KACb2Q,EAAW,GACX5S,KAAKoK,aAAawI,EAAWA,EAAWnK,OAAS,IAAIyC,OACrD,WACEmD,EAAOlD,KAAKkD,EAAOxF,gBACpB,IAGI,CACLhH,MAAO+Q,EAAWC,EAAW,EAAI,GACjCF,IAAK5H,EAAQA,EAAQtC,OAAS,GAEjC,EAQDyJ,mBAAoB,SAAUe,GAG5B,OAC2B,OAAzBjT,KAAKS,QAAQuB,SACbhC,KAAKS,QAAQuB,QAAQoF,UAAY6L,CAEpC,EAQDhB,mBAAoB,SAAUgB,GAG5B,OAC2B,OAAzBjT,KAAKS,QAAQsB,SACb/B,KAAKS,QAAQsB,QAAQqF,WAAa6L,CAErC,EAODjI,cAAe,WAGb,OAAOhL,KAAK+I,SACTmK,OACAlK,KAAI,SAAUxI,GACb,OAAOqF,SAASrF,EAAG,GACpB,IACA2S,MAAK,SAAUC,EAAGC,GACjB,OAAOD,EAAIC,CACZ,GACJ,EAMDlG,mBAAoB,SAAU3M,GAG5B,IAAI8S,EAAQtT,KAAKiG,YAAYjG,KAAKS,QAAQgB,WAAWiB,SAASE,EAC5D,IAAId,KAAKtB,IAEX,OAAO8S,EAAQtT,KAAKS,QAAQU,SAAWmS,EAAQtT,KAAKS,QAAQW,WAC7D,EAEDgM,mBAAoB,SAAU5M,GAG5B,IAAI8S,EAAQtT,KAAKiG,YAAYjG,KAAKS,QAAQgB,WAAWiB,SAASG,EAC5D,IAAIf,KAAKtB,IAEX,OAAO8S,EAAQtT,KAAKS,QAAQU,SAAWmS,EAAQtT,KAAKS,QAAQW,WAC7D,EAEDuF,yBAA0B,SAAUnG,GAGlC,GAAIR,KAAKS,QAAQkB,SAAW,EAAG,CAC7B,IAAImR,EAAI9S,KAAKiG,YAAYjG,KAAKS,QAAQgB,WAAW4E,cAIjD,MAHiB,mBAANyM,IACTA,EAAIA,EAAEtS,IAED8E,KAAKiO,KAAKT,EAAI9S,KAAKS,QAAQkB,SACnC,CAED,IAAI6R,EAAIxT,KAAKiG,YAAYjG,KAAKS,QAAQgB,WAAW8E,oBAIjD,MAHiB,mBAANiN,IACTA,EAAIA,EAAEhT,IAEDR,KAAKS,QAAQiB,UAAY8R,CACjC,EAED/M,sBAAuB,SAAUjG,GAG/B,GAAIR,KAAKS,QAAQiB,SAAW,EAAG,CAC7B,IAAIoR,EAAI9S,KAAKiG,YAAYjG,KAAKS,QAAQgB,WAAW4E,cAIjD,MAHiB,mBAANyM,IACTA,EAAIA,EAAEtS,IAED8E,KAAKiO,KAAKT,EAAI9S,KAAKS,QAAQiB,SACnC,CAED,IAAI8R,EAAIxT,KAAKiG,YAAYjG,KAAKS,QAAQgB,WAAW6E,iBAIjD,MAHiB,mBAANkN,IACTA,EAAIA,EAAEhT,IAEDR,KAAKS,QAAQkB,UAAY6R,CACjC,EAQDtG,sBAAuB,SAAU1M,GAK/B,GAFAA,EAAI,IAAIsB,KAAKtB,GAETR,KAAKS,QAAQiD,UAAU+E,OAAS,EAClC,IAAK,IAAIqK,KAAK9S,KAAKS,QAAQiD,UACzB,GAAI1D,KAAKyQ,YAAYzQ,KAAKS,QAAQiD,UAAUoP,GAAItS,GAC9C,OAAOR,KAAKyT,MAAMzT,KAAKS,QAAQiD,UAAUoP,IACrC,iBACA,aAIV,MAAO,EACR,EASDW,MAAO,SAAUjT,GAGf,OAAOR,KAAKyQ,YAAYjQ,EAAG,IAAIsB,KAChC,EAYD2O,YAAa,SAAUiD,EAAOC,GAW5B,OARMD,aAAiB5R,OACrB4R,EAAQ,IAAI5R,KAAK4R,IAGbC,aAAiB7R,OACrB6R,EAAQ,IAAI7R,KAAK6R,IAGX3T,KAAKS,QAAQgB,WACnB,IAAK,QACL,IAAK,MACH,OACEiS,EAAMtO,gBAAkBuO,EAAMvO,eAC9BsO,EAAMzM,aAAe0M,EAAM1M,YAC3ByM,EAAMxM,YAAcyM,EAAMzM,WAC1BwM,EAAMvM,aAAewM,EAAMxM,YAC3BuM,EAAM7M,eAAiB8M,EAAM9M,aAEjC,IAAK,SACL,IAAK,OACH,OACE6M,EAAMtO,gBAAkBuO,EAAMvO,eAC9BsO,EAAMzM,aAAe0M,EAAM1M,YAC3ByM,EAAMxM,YAAcyM,EAAMzM,WAC1BwM,EAAMvM,aAAewM,EAAMxM,WAE/B,IAAK,QACL,IAAK,MACH,OACEuM,EAAMtO,gBAAkBuO,EAAMvO,eAC9BsO,EAAMzM,aAAe0M,EAAM1M,YAC3ByM,EAAMxM,YAAcyM,EAAMzM,UAE9B,IAAK,SACL,IAAK,OACH,OACEwM,EAAMtO,gBAAkBuO,EAAMvO,eAC9BpF,KAAK2H,cAAc+L,KAAW1T,KAAK2H,cAAcgM,GAErD,IAAK,UACL,IAAK,QACH,OACED,EAAMtO,gBAAkBuO,EAAMvO,eAC9BsO,EAAMzM,aAAe0M,EAAM1M,WAE/B,QACE,OAAO,EAEZ,EASDsJ,eAAgB,SAAUmD,EAAOC,GAW/B,SAASC,EAAiB1O,EAAM2O,GAC9B,OAAQA,GACN,IAAK,QACL,IAAK,MACH,OAAO,IAAI/R,KACToD,EAAKE,cACLF,EAAK+B,WACL/B,EAAKgC,UACLhC,EAAKiC,WACLjC,EAAK2B,cACLO,UACJ,IAAK,SACL,IAAK,OACH,OAAO,IAAItF,KACToD,EAAKE,cACLF,EAAK+B,WACL/B,EAAKgC,UACLhC,EAAKiC,YACLC,UACJ,IAAK,QACL,IAAK,MACH,OAAO,IAAItF,KACToD,EAAKE,cACLF,EAAK+B,WACL/B,EAAKgC,WACLE,UACJ,IAAK,SACL,IAAK,OACL,IAAK,UACL,IAAK,QACH,OAAO,IAAItF,KAAKoD,EAAKE,cAAeF,EAAK+B,YAAYG,UACvD,QACE,OAAOlC,EAAKkC,UAEjB,CAED,OA5CMsM,aAAiB5R,OACrB4R,EAAQ,IAAI5R,KAAK4R,IAGbC,aAAiB7R,OACrB6R,EAAQ,IAAI7R,KAAK6R,IAwCjBC,EAAiBF,EAAO1T,KAAKS,QAAQgB,WACrCmS,EAAiBD,EAAO3T,KAAKS,QAAQgB,UAExC,EAWDmG,aAAchI,EAAG0S,KAAKxL,OAAO,MAO7Ba,cAAe,SAAUnH,GAOvB,QAHqC,IAAnCR,KAAKS,QAAQmB,kBACThC,EAAG0S,KAAKxL,OAAO,MACflH,EAAG0S,KAAKxL,OAAO,OACZtG,EACV,EAQDsH,mBAAoB,SAAUtH,GAGX,iBAANA,IACTA,EAAI,IAAIsB,KAAKtB,IAGf,IAAIsT,EAAuB9T,KAAK2H,cAC9B,IAAI7F,KAAKtB,EAAE4E,cAAe5E,EAAEyG,aAE9B,OAAOjH,KAAK2H,cAAcnH,GAAKsT,EAAuB,CACvD,EAQDC,oBAAqB,SAAUvT,GAGZ,iBAANA,IACTA,EAAI,IAAIsB,KAAKtB,GAEhB,EAQD8G,mBAAoB,SAAU9G,GAG5B,OAAOR,KAAKgU,cAAcxT,GAAG0G,SAC9B,EAQDQ,kBAAmB,SAAUlH,GAM3B,MAHiB,iBAANA,IACTA,EAAI,IAAIsB,KAAKtB,IAEwC,IAAhD,IAAIsB,KAAKtB,EAAE4E,cAAe,EAAG,IAAI6B,WAAmB,IAAM,GAClE,EAWDM,WAAY,SAAU/G,GAGpB,OAAuC,IAAnCR,KAAKS,QAAQmB,kBACRpB,EAAEyH,SAEW,IAAfzH,EAAEyH,SAAiB,EAAIzH,EAAEyH,SAAW,CAC5C,EAOD+L,cAAe,SAAUxT,GAMvB,MAHiB,iBAANA,IACTA,EAAI,IAAIsB,KAAKtB,IAER,IAAIsB,KAAKtB,EAAE4E,cAAe5E,EAAEyG,WAAa,EAAG,EACpD,EASDgN,SAAU,SAAU/O,EAAMqN,EAAO2B,GAG/B,IAAI1T,EAAI,IAAIsB,KAAKoD,GACjB,OAAQgP,GACN,IAAK,OACH1T,EAAE2T,SAAS3T,EAAE2G,WAAaoL,GAC1B,MACF,IAAK,MACH/R,EAAE2T,SAAS3T,EAAE2G,WAAqB,GAARoL,GAC1B,MACF,IAAK,OACH/R,EAAE2T,SAAS3T,EAAE2G,WAAqB,GAARoL,EAAa,GACvC,MACF,IAAK,QACH/R,EAAE4T,SAAS5T,EAAEyG,WAAasL,GAC1B,MACF,IAAK,OACH/R,EAAE6T,YAAY7T,EAAE4E,cAAgBmN,GAGpC,OAAO,IAAIzQ,KAAKtB,EACjB,EAaD8T,gBAAiB,SAAU9T,EAAGU,GAG5B,IAMIqT,EANA1S,EAAQ,IAAIC,KACdtB,EAAE4E,cACF5E,EAAEyG,WACFzG,EAAE0G,UACF1G,EAAE2G,YAaJ,OATEoN,EADErT,aAAiBY,KACZ,IAAIA,KACTZ,EAAMkE,cACNlE,EAAM+F,WACN/F,EAAMgG,UACNhG,EAAMiG,YAGD,IAAIrF,MAAMD,EAAgB,IAARX,EAAe,IAEnCtB,EAAG0S,KAAKkC,QAAQlP,KAAKY,IAAIrE,EAAO0S,GAAOjP,KAAKC,IAAI1D,EAAO0S,GAC/D,EASDE,cAAe,SAAUjU,EAAGU,GAG1B,IAAIW,EAAQ,IAAIC,KACdtB,EAAE4E,cACF5E,EAAEyG,WACFzG,EAAE0G,UACF1G,EAAE2G,YAEAoN,EAAO,KACPrT,aAAiBY,KACnByS,EAAO,IAAIzS,KACTZ,EAAMkE,cACNlE,EAAM+F,WACN/F,EAAMgG,UACNhG,EAAMiG,aAGRoN,EAAO,IAAIzS,KAAKD,IACXsS,SAASI,EAAKpN,WAAajG,GAGlC,IAAI6J,EAAUnL,EAAG0S,KAAKoC,MAAMpP,KAAKY,IAAIrE,EAAO0S,GAAOjP,KAAKC,IAAI1D,EAAO0S,IAI/DzB,EAAI,EACJC,EAAQhI,EAAQtC,OACpB,IAAKqK,EAAI,EAAGA,EAAIC,EAAOD,GAAK,EAC1B,GAAIA,EAAI,GAAK/H,EAAQ+H,GAAG3L,aAAe4D,EAAQ+H,EAAI,GAAG3L,WAAY,CAChEnH,KAAKgK,UAAU0G,KAAK3F,EAAQ+H,GAAG1L,WAC/B2D,EAAQ4J,OAAO7B,EAAG,GAClB,KACD,CAUH,MAJqB,iBAAV5R,GAAsB6J,EAAQtC,OAASnD,KAAKsP,IAAI1T,IACzD6J,EAAQ4J,OAAO5J,EAAQtC,OAAS,EAAG,GAG9BsC,CACR,EASD8J,aAAc,SAAUrU,EAAGU,GAGzB,IAAIW,EAAQ,IAAIC,KAAKtB,EAAE4E,cAAe5E,EAAEyG,WAAYzG,EAAE0G,WAClDqN,EAAO,KAQX,OAPIrT,aAAiBY,KACnByS,EAAO,IAAIzS,KAAKZ,EAAMkE,cAAelE,EAAM+F,WAAY/F,EAAMgG,YAE7DqN,EAAO,IAAIzS,KAAKD,GAChB0S,EAAO,IAAIzS,KAAKyS,EAAKrM,QAAQqM,EAAKrN,UAAYrB,SAAS3E,EAAO,OAGzDtB,EAAG0S,KAAKwC,KAAKxP,KAAKY,IAAIrE,EAAO0S,GAAOjP,KAAKC,IAAI1D,EAAO0S,GAC5D,EASDQ,cAAe,SAAUvU,EAAGU,GAG1B,IAAI8T,GAEmC,IAAnChV,KAAKS,QAAQmB,kBACfoT,EAAY,IAAIlT,KACdtB,EAAE4E,cACF5E,EAAEyG,WACFzG,EAAE0G,UAAY1G,EAAEyH,UAGC,IAAfzH,EAAEyH,SACJ+M,EAAY,IAAIlT,KAAKtB,EAAE4E,cAAe5E,EAAEyG,WAAYzG,EAAE0G,WAC9B,IAAf1G,EAAEyH,UACX+M,EAAY,IAAIlT,KAAKtB,EAAE4E,cAAe5E,EAAEyG,WAAYzG,EAAE0G,YAC5CgB,QAAQ8M,EAAU9N,UAAY,GAExC8N,EAAY,IAAIlT,KACdtB,EAAE4E,cACF5E,EAAEyG,WACFzG,EAAE0G,UAAY1G,EAAEyH,SAAW,GAKjC,IAAIgN,EAAU,IAAInT,KAAKkT,GAEnBT,EAAOrT,EAKX,MAJqB,iBAAVA,IACTqT,EAAO,IAAIzS,KAAKmT,EAAQ/M,QAAQ+M,EAAQ/N,UAAoB,EAARhG,MAGZ,IAAnClB,KAAKS,QAAQmB,kBAChBhC,EAAG0S,KAAK4C,QAAQ5P,KAAKY,IAAI8O,EAAWT,GAAOjP,KAAKC,IAAIyP,EAAWT,IAC/D3U,EAAG0S,KAAK6C,QAAQ7P,KAAKY,IAAI8O,EAAWT,GAAOjP,KAAKC,IAAIyP,EAAWT,GACpE,EASDa,eAAgB,SAAU5U,EAAGU,GAG3B,IAAIW,EAAQ,IAAIC,KAAKtB,EAAE4E,cAAe5E,EAAEyG,YACpCsN,EAAO,KAQX,OANEA,EADErT,aAAiBY,KACZ,IAAIA,KAAKZ,EAAMkE,cAAelE,EAAM+F,aAE3CsN,EAAO,IAAIzS,KAAKD,IACJuS,SAASG,EAAKtN,WAAa/F,GAGlCtB,EAAG0S,KAAK+C,OAAO/P,KAAKY,IAAIrE,EAAO0S,GAAOjP,KAAKC,IAAI1D,EAAO0S,GAC9D,EASDe,cAAe,SAAU9U,EAAGU,GAG1B,IACIqT,EADA1S,EAAQ,IAAIC,KAAKtB,EAAE4E,cAAe,GAQtC,OALEmP,EADErT,aAAiBY,KACZ,IAAIA,KAAKZ,EAAMkE,cAAe,GAE9B,IAAItD,KAAKtB,EAAE4E,cAAgBlE,EAAO,GAGpCtB,EAAG0S,KAAKiD,MAAMjQ,KAAKY,IAAIrE,EAAO0S,GAAOjP,KAAKC,IAAI1D,EAAO0S,GAC7D,EASDrK,UAAW,SAAUhF,EAAMhE,GAWzB,OARoB,iBAATgE,IACTA,EAAO,IAAIpD,KAAKoD,IAGdsD,UAAUC,OAAS,IACrBvH,EAAQlB,KAAKS,QAAQS,OAGflB,KAAKS,QAAQe,QACnB,IAAK,OACH,IAAIuJ,EAAU/K,KAAKyU,cAAcvP,EAAMhE,GAWvC,MAPqB,iBAAVA,GAAsB6J,EAAQtC,OAASvH,IAC5CA,EAAQ,EACV6J,EAAQ2F,KAAK1Q,KAAKyU,cAAc1J,EAAQA,EAAQtC,OAAS,GAAI,GAAG,IAEhEsC,EAAQ+G,MAAM9R,KAAKyU,cAAc1J,EAAQ,IAAK,GAAG,KAG9CA,EACT,IAAK,MACH,OAAO/K,KAAK6U,aAAa3P,EAAMhE,GACjC,IAAK,OACH,OAAOlB,KAAK+U,cAAc7P,EAAMhE,GAClC,IAAK,QACH,OAAOlB,KAAKoV,eAAelQ,EAAMhE,GACnC,IAAK,OACH,OAAOlB,KAAKsV,cAAcpQ,EAAMhE,GAErC,EAGDkJ,aAAc,SAAUlF,GAGF,iBAATA,IACTA,EAAO,IAAIpD,KAAKoD,IAGlB,IAAImJ,EAASrO,KAkEb,OAAQA,KAAKS,QAAQgB,WACnB,IAAK,QACL,IAAK,MACH,OAAOzB,KAAKsU,gBACVpP,EAnDwB,SAAUA,EAAM1D,GAC5C,OAAQA,GACN,IAAK,OACH,OAAO,GACT,IAAK,MACH,OAAO,KACT,IAAK,OACH,OAAO,MAEZ,CA2CKgU,CAAwBtQ,EAAMlF,KAAKS,QAAQe,SAE/C,IAAK,SACL,IAAK,OACH,OAAOxB,KAAKyU,cACVvP,EA3CyB,SAAUA,EAAM1D,GAC7C,OAAQA,GACN,IAAK,MACH,OAAO,GACT,IAAK,OACH,OAAO,IACT,IAAK,QACH,OAAyC,GAAlC6M,EAAO/G,mBAAmBpC,GAEtC,CAmCKuQ,CAAyBvQ,EAAMlF,KAAKS,QAAQe,SAEhD,IAAK,QACL,IAAK,MACH,OAAOxB,KAAK6U,aACV3P,EA7EwB,SAAUA,EAAM1D,GAC5C,OAAQA,GACN,IAAK,OACH,OAAO6M,EAAO3G,kBAAkBxC,GAClC,IAAK,QACH,OAAOmJ,EAAO/G,mBAAmBpC,GACnC,IAAK,OACH,OAAO,EAEZ,CAqEKwQ,CAAwBxQ,EAAMlF,KAAKS,QAAQe,SAE/C,IAAK,SACL,IAAK,OACH,OAAOxB,KAAK+U,cACV7P,EAzCyB,SAAUA,EAAM1D,GAC7C,GAAe,UAAXA,EAAoB,CACtB,IAAImU,EAAa,IAAI7T,KAAKoD,EAAKE,cAAeF,EAAK+B,WAAa,EAAG,GAC/D2O,EAAYvH,EAAO1G,cAAcgO,GACjCE,EAAcxH,EAAO1G,cACvB,IAAI7F,KAAKoD,EAAKE,cAAeF,EAAK+B,aAQpC,OALI4O,EAAcD,IAChBC,EAAc,EACdD,GAAa,GAGRA,EAAYC,EAAc,CAClC,CAAM,GAAe,SAAXrU,EACT,OAAO6M,EAAO1G,cAAc,IAAI7F,KAAKoD,EAAKE,cAAe,GAAI,IAEhE,CAyBK0Q,CAAyB5Q,EAAMlF,KAAKS,QAAQe,SAEhD,IAAK,UACL,IAAK,QACH,OAAOxB,KAAKoV,eAAelQ,EAAM,IAEtC,EAODoG,cAAe,SAAUkH,GAMvB,OAHyB,IAArBhK,UAAUC,SACZ+J,EAAI,GAECxS,KAAKkK,UACVlK,KAAKiU,SAASjU,KAAKgL,gBAAgBE,MAAOsH,EAAGxS,KAAKS,QAAQe,QAC1D,GACA,EACH,EAODuU,kBAAmB,SAAUvD,GAM3B,OAHyB,IAArBhK,UAAUC,SACZ+J,EAAI,GAECxS,KAAKkK,UACVlK,KAAKiU,SAASjU,KAAKgL,gBAAgB8G,SAAUU,EAAGxS,KAAKS,QAAQe,QAC7D,GACA,EACH,EAoBDyJ,SAAU,SACR+K,EACAC,EACAhB,EACAiB,EACAtR,EACAuR,GAIA,IAAIpW,EAAOC,KACPwI,UAAUC,OAAS,IACrB7D,GAAY,GAEV4D,UAAUC,OAAS,IACrB0N,EAAanW,KAAKuJ,kBAEpB,IAAI6M,EAAY,SAAUxH,EAAO3M,IACb,IAAd2C,EACuB,mBAAdA,EACT3C,EAAO2C,EAAU3C,GAC8B,mBAA/BlC,EAAKU,QAAQuE,cAC7B/C,EAAOlC,EAAKU,QAAQuE,cAAc/C,GAElC4M,QAAQC,IAAI,0DAGY,QAA1B/O,EAAKU,QAAQyB,UACa,QAA1BnC,EAAKU,QAAQyB,WAEbD,EAAOjC,KAAKqW,aAAapU,IAE3BlC,EAAKuW,WAAWrU,EAAMkU,EAAYF,EAAWhB,GACrB,mBAAbiB,GACTA,GAEH,EAED,cAAeF,GACb,IAAK,SACH,GAAe,KAAXA,EAEF,OADAI,EAAU,KAAM,CAAC,IACV,EAEP,IAAIG,EAAMvW,KAAKwW,SAASR,EAAQC,EAAWhB,GACvCwB,EAAc,MACmB,OAAjC1W,EAAKU,QAAQ0B,kBACfsU,EAAc,QAEhB,IAAIC,EAAU,KACuB,OAAjC3W,EAAKU,QAAQ0B,kBACfuU,EAAU1W,KAAKwW,SACbzW,EAAKU,QAAQ0B,gBACb8T,EACAhB,IAIJ,IAAI0B,EAAM,KACV,OAAQ3W,KAAKS,QAAQyB,UACnB,IAAK,OACHyU,EAAM/W,EAAGgX,KAAKL,GACd,MACF,IAAK,MACHI,EAAM/W,EAAGiX,IAAIN,GACb,MACF,IAAK,MACHI,EAAM/W,EAAGkX,IAAIP,GACb,MACF,IAAK,MACHI,EAAM/W,EAAG4N,KAAK+I,EAAK,cAKvB,GAAwC,OAApCxW,EAAKU,QAAQ2B,mBACf,IAAK,IAAI2U,KAAUhX,EAAKU,QAAQ2B,mBAC1BrC,EAAKU,QAAQ2B,mBAAmBiG,eAAe0O,IACjDJ,EAAII,OAAOA,EAAQhX,EAAKU,QAAQ2B,mBAAmB2U,IAO3D,OAFEJ,EAAIK,KAAKP,EAAaC,EAASN,IAE1B,EACT,IAAK,SACH,GAAIJ,IAAWiB,OAAOjB,GAEpB,OADAI,EAAU,KAAMJ,IACT,EAGX,QAEE,OADAI,EAAU,KAAM,CAAC,IACV,EAEZ,EAYDE,WAAY,SAAUrU,EAAMkU,EAAYF,EAAWhB,GAG7CkB,IAAenW,KAAKqJ,qBACtBrJ,KAAK+I,SAASmO,SAAQ,SAAUC,EAAKvR,GACnCA,EAAMsR,SAAQ,SAAUlH,EAASsD,EAAO8D,GACtCA,EAAM9D,GAAOzS,EAAI,IAClB,GACF,IAGH,IAAIwW,EAAO,CAAC,EAERC,EAAc,SAAU9W,GAC1B,OAAOA,EAAEG,CACV,EAGD,IAAK,IAAIH,KAAKyB,EAAM,CAClB,IAAIiD,EAAO,IAAIpD,KAAS,IAAJtB,GAChB+W,EAAavX,KAAKkK,UAAUhF,GAAM,GAAGkC,UAYzC,GATIpH,KAAKgK,UAAU2E,QAAQ4I,IAAe,GAGpCvX,KAAK+I,SAASyO,IAAID,EAAa,QACjCA,GAAc,OAMhBE,MAAMjX,IACLyB,EAAKoG,eAAe7H,IACpBR,KAAK+I,SAASyO,IAAID,IACjBA,IAAetB,GAAasB,GAActC,EAJ9C,CASA,IAAIyC,EAAiB1X,KAAK+I,SAAS+D,IAAIyK,GAElCF,EAAKhP,eAAekP,KACvBF,EAAKE,GAAcG,EAAe1O,IAAIsO,IAGxC,IAAIhE,EAAQ+D,EAAKE,GAAY5I,QAC3B3O,KAAKiG,YAAYjG,KAAKS,QAAQgB,WAAWuF,YAAY9B,IAGnDiR,IAAenW,KAAKsJ,wBAGjBmO,MAAMC,EAAepE,GAAOzS,GAFjC6W,EAAepE,GAAOzS,EAAIoB,EAAKzB,GAG7BkX,EAAepE,GAAOzS,GAAKoB,EAAKzB,EAhBnC,CAqBF,CACF,EAEDgW,SAAU,SAAUmB,EAAK1B,EAAWhB,GAWlC,OAHA0C,GAHAA,GADAA,EAAMA,EAAIrG,QAAQ,mBAAoB2E,EAAU7O,UAAY,MAClDkK,QAAQ,iBAAkB2D,EAAQ7N,UAAY,MAG9CkK,QAAQ,mBAAoB2E,EAAU2B,gBACtCtG,QAAQ,iBAAkB2D,EAAQ2C,cAG7C,EAEDvB,aAAc,SAAUpU,GAGtB,IAEI6Q,EAAGC,EAFHvS,EAAI,CAAC,EACL0S,EAAO+D,OAAO/D,KAAKjR,EAAK,IAE5B,IAAK6Q,EAAI,EAAGC,EAAQ9Q,EAAKwG,OAAQqK,EAAIC,EAAOD,GAAK,EAC/CtS,EAAEyB,EAAK6Q,GAAGI,EAAK,MAAQjR,EAAK6Q,GAAGI,EAAK,IAEtC,OAAO1S,CACR,EAWDyN,OAAQ,WAGN,IAAII,EAASrO,KACTS,EAAU4N,EAAO5N,QACjBoX,EAAcpX,EAAQyC,cACtBmL,EAAOvE,OAAOgO,OAAO,SACrBrX,EAAQ4C,aAAa,GACrB5C,EAAQ4C,aAAa,GACrB,EACA0U,EAAetX,EAAQyC,cACvBmL,EAAOvE,OAAOgO,OAAO,UACrBrX,EAAQ4C,aAAa,GACrB5C,EAAQ4C,aAAa,GACrB,EAEA2U,EACF3J,EAAOpF,SAASlG,MAAQtC,EAAQa,aAAeb,EAAQW,YACrD6W,EACF5J,EAAOpF,SAASjG,OAASvC,EAAQa,aAAeb,EAAQW,YAE1DpB,KAAKyJ,KACFiE,aACAC,SAASlN,EAAQ6D,mBACjBlE,KAAK,SAAS,WACb,MACqC,WAAnCK,EAAQ6C,wBAC2B,WAAnC7C,EAAQ6C,uBAED0U,EAAaH,EAEfvS,KAAKC,IAAIyS,EAAYH,EAC7B,IACAzX,KAAK,UAAU,WACd,MACqC,WAAnCK,EAAQ6C,wBAC2B,WAAnC7C,EAAQ6C,uBAEDgC,KAAKC,IAAI0S,EAAaF,GAExBE,EAAcF,CACtB,IAEH/X,KAAKyJ,KACFY,OAAO,UACPqD,aACAC,SAASlN,EAAQ6D,mBACjBlE,KAAK,KAAK,WACT,MAAuC,QAAnCK,EAAQ6C,uBACHyU,EAEF,CACR,IACA3X,KAAK,KAAK,WACT,MACsC,WAAnCK,EAAQ6C,wBAC4B,WAAnC7C,EAAQ6C,wBAC2B,SAArC7C,EAAQ8C,yBAIH,EAFEsU,CAGV,GACJ,EASDK,KAAM,SAAU1F,GAMd,OAHyB,IAArBhK,UAAUC,SACZ+J,EAAI,GAECxS,KAAK4K,eAAe4H,EAC5B,EAKD2F,SAAU,SAAU3F,GAMlB,OAHyB,IAArBhK,UAAUC,SACZ+J,EAAI,GAECxS,KAAK6K,mBAAmB2H,EAChC,EAaD4F,OAAQ,SAAUlT,EAAMmT,GAGlB7P,UAAUC,OAAS,IACrB4P,GAAQ,GAEV,IAAItN,EAAU/K,KAAKgL,gBACfsN,EAAcvN,EAAQ,GACtBwN,EAAaxN,EAAQA,EAAQtC,OAAS,GAE1C,OAAIvD,EAAOoT,EACFtY,KAAK6K,mBAAmB7K,KAAKkK,UAAUoO,EAAapT,GAAMuD,QAE7D4P,EACKrY,KAAK4K,eAAe5K,KAAKkK,UAAUoO,EAAapT,GAAMuD,QAG3DvD,EAAOqT,GACFvY,KAAK4K,eAAe5K,KAAKkK,UAAUqO,EAAYrT,GAAMuD,OAKjE,EAQD+P,OAAQ,WAGNxY,KAAKoY,OAAOpY,KAAKS,QAAQoB,OAAO,EACjC,EASD4W,OAAQ,SAAUC,EAAY9T,EAAWuR,GAGd,IAArB3N,UAAUC,SACZiQ,EAAa1Y,KAAKS,QAAQwB,MAExBuG,UAAUC,OAAS,IACrB7D,GAAY,GAEV4D,UAAUC,OAAS,IACrB0N,EAAanW,KAAKqJ,qBAGpB,IAAI0B,EAAU/K,KAAKgL,gBACfjL,EAAOC,KACXA,KAAKiL,SACHyN,EACA,IAAI5W,KAAKiJ,EAAQ,IACjB/K,KAAKoK,aAAaW,EAAQA,EAAQtC,OAAS,IAAIyC,OAC/C,WACEnL,EAAKoL,OACLpL,EAAK+F,aACN,GACDlB,EACAuR,EAEH,EAQDwC,UAAW,WAGT,IAAIC,EAAY5Y,KAAKS,QAAQwC,OAAOuM,MAAM,GACtChH,UAAUC,QAAU,GAAK6G,MAAMC,QAAQ/G,UAAU,MACnDxI,KAAKS,QAAQwC,OAASuF,UAAU,IAE9BA,UAAUC,QAAU,IAClB6G,MAAMC,QAAQ/G,UAAU,KAAOA,UAAU,GAAGC,QAAU,EACxDzI,KAAKS,QAAQgD,aAAe,CAAC+E,UAAU,GAAG,GAAIA,UAAU,GAAG,IAE3DxI,KAAKS,QAAQgD,aAAe+E,UAAU,KAKvCA,UAAUC,OAAS,IAAMoQ,EAAYD,EAAW5Y,KAAKS,QAAQwC,SAC9DuF,UAAUC,QAAU,KAEpBzI,KAAK8J,OAAOgP,cACZ9Y,KAAKmL,QAGPnL,KAAK8J,OAAOgB,OACV9K,KAAKiJ,SAASlG,MACZ/C,KAAKS,QAAQa,aACbtB,KAAKS,QAAQW,YAElB,EAOD2X,aAAc,WAGZ,QAAK/Y,KAAKS,QAAQyC,gBAGlBlD,KAAKS,QAAQyC,eAAgB,EAC7BlD,KAAK8J,OAAOkE,UACL,EACR,EAODgL,WAAY,WAGV,OAAIhZ,KAAKS,QAAQyC,gBAGjBlD,KAAKS,QAAQyC,eAAgB,EAC7BlD,KAAK8J,OAAOgB,OACV9K,KAAKiJ,SAASlG,MACZ/C,KAAKS,QAAQa,aACbtB,KAAKS,QAAQW,cAEV,EACR,EAWDsC,UAAW,SAAUwN,GAGnB,OAAKlR,KAAKS,QAAQiD,UAAY1D,KAAKyP,kBAAkByB,IAAOzI,OAAS,IACnEzI,KAAKmL,QACE,EAGV,EAWD8N,QAAS,SAAU/C,GAiBjB,OAdAlW,KAAKyJ,KACFiE,aACAC,SAAS3N,KAAKS,QAAQ6D,mBACtBlE,KAAK,QAAS,GACdA,KAAK,SAAU,GACf4N,SACAkL,KAAK,OAAO,WACa,mBAAbhD,EACTA,SAC6B,IAAbA,GAChBrH,QAAQC,IAAI,qDAEf,IAEI,IACR,EAEDqK,OAAQ,WAoBN,IAjBA,IAAIC,EAAS,CACX,yBAA0B,CAAC,EAC3B,SAAU,CAAC,EACX,cAAe,CAAC,EAChB,iBAAkB,CAAC,EACnB,WAAY,CAAC,EACb,qBAAsB,CAAC,EACvB,iBAAkB,CAAC,EACnB,WAAY,CAAC,EACb,qBAAsB,CAAC,EACvB,qBAAsB,CAAC,EACvB,eAAgB,CAAC,EACjB,kBAAmB,CAAC,EACpB,MAAO,CAAC,EACR,MAAO,CAAC,GAIJ5F,EAAI,EAAGT,EAAQ/S,KAAKS,QAAQwC,OAAOwF,OAAS,EAChD+K,GAAKT,EACLS,GAAK,EAEL4F,EAAO,KAAO5F,GAAK,CAAC,EAGtB,IAyC2B6F,EAzCvB5P,EAAOzJ,KAAKyJ,KAEZ6P,EAAkB,CAEpB,SACA,eACA,iBACA,mBACA,oBACA,iBACA,oBACA,OACA,eACA,YACA,SACA,eACA,aACA,aACA,sBACA,iBACA,oBACA,+BACA,6BACA,UACA,cACA,kBAGA,iBACA,cACA,OACA,YACA,eAGEC,EAAe,SAAUC,EAAWC,EAAU7T,IACL,IAAvC0T,EAAgB3K,QAAQ8K,KAC1BL,EAAOI,GAAWC,GAAY7T,EAEjC,EAOD,IAAK,IAAIoK,KAAWoJ,EAClB,GAAKA,EAAO/Q,eAAe2H,GAA3B,CAIA,IAAI0J,GAVqBL,EAUJrJ,EATdvG,EAAKY,OAAOgP,GAAG,GAAG,IAWzB,GAAY,OAARK,EAMJ,GAAI,qBAAsBC,OAAQ,CAChC,IAAIC,EAAKC,iBAAiBH,EAAK,MAC/B,GAAkB,IAAdE,EAAGnR,OACL,IAAK,IAAIqK,EAAI,EAAGA,EAAI8G,EAAGnR,OAAQqK,GAAK,EAClCyG,EAAavJ,EAAS4J,EAAGE,KAAKhH,GAAI8G,EAAGG,iBAAiBH,EAAGE,KAAKhH,UAMhE,IAAK,IAAI7D,KAAK2K,EACRA,EAAGvR,eAAe4G,IACpBsK,EAAavJ,EAASf,EAAG2K,EAAG3K,GAMnC,MAAM,GAAI,iBAAkByK,EAAK,CAChC,IAAIM,EAAMN,EAAIO,aACd,IAAK,IAAIzS,KAAKwS,EACZT,EAAavJ,EAASxI,EAAGwS,EAAIxS,GAEhC,CAjCA,CAoCH,IAAI0S,EACF,uHAGF,IAAK,IAAIC,KAASf,EAAQ,CAExB,IAAK,IAAIgB,KADTF,GAAUC,EAAQ,OACJf,EAAOe,GACnBD,GAAU,KAAOE,EAAI,IAAMhB,EAAOe,GAAOC,GAAK,MAEhDF,GAAU,KACX,CAMD,OAJAA,GAAU,eACVA,IAAU,IAAIG,eAAgBC,kBAAkBta,KAAKyJ,KAAK,GAAG,KACnD,QAGX,GAUH,IAAII,EAAiB,WAGnB7J,KAAKua,UAAY3a,EAAGoJ,KACrB,EAEDa,EAAeqE,UAAUN,YAAc,SAAUpN,GAG/C,OAAOR,KAAKua,UAAUzN,IAAItM,EAC3B,EAEDqJ,EAAeqE,UAAU1B,qBAAuB,SAAUsG,GAGxD,IAAI/H,EAAU/K,KAAKwa,UACnB,OAAOxa,KAAKua,UAAUzN,IAAI/B,EAAQ+H,GACnC,EAEDjJ,EAAeqE,UAAUxB,QAAU,WAGjC,IAAI3B,EAAU/K,KAAKwa,UACnB,OAAOxa,KAAKua,UAAUzN,IAAI/B,EAAQA,EAAQtC,OAAS,GACpD,EAEDoB,EAAeqE,UAAU3B,YAAc,SAAU/L,EAAGia,GAGlDza,KAAKua,UAAUpQ,IAAI3J,EAAGia,EACvB,EAED5Q,EAAeqE,UAAUzB,aAAe,SAAUX,GAGhD9L,KAAKua,UAAUrD,SAAQ,SAAUC,EAAKvR,GACpC5F,KAAKmK,IAAIgN,EAAKvR,EAAQkG,EACvB,IAED,IAAIf,EAAU/K,KAAKwa,UACnBxa,KAAKua,UAAUvM,OAAOjD,EAAQ,GAC/B,EAEDlB,EAAeqE,UAAUvB,YAAc,SAAUd,GAG/C7L,KAAKua,UAAUrD,SAAQ,SAAUC,EAAKvR,GACpC5F,KAAKmK,IAAIgN,EAAKvR,EAAQiG,EACvB,IAED,IAAId,EAAU/K,KAAKwa,UACnBxa,KAAKua,UAAUvM,OAAOjD,EAAQA,EAAQtC,OAAS,GAChD,EAEDoB,EAAeqE,UAAUsM,QAAU,WAGjC,OAAOxa,KAAKua,UAAUrH,OAAOC,MAAK,SAAUC,EAAGC,GAC7C,OAAOxN,SAASuN,EAAG,IAAMvN,SAASwN,EAAG,GACtC,GACF,EAMD,IAAIvJ,EAAS,SAAU4Q,GAGrB1a,KAAK0a,SAAWA,EAChB1a,KAAK2a,aAEiC,OAAlCD,EAASja,QAAQgD,cACnBzD,KAAK8Y,aAER,EAyUD,SAASxK,EAAesM,EAAMC,GAI5B,IAAK,IAAIrT,KAAKqT,EACZ,IAEMA,EAAKrT,GAAGsT,cAAgB7D,OAC1B2D,EAAKpT,GAAK8G,EAAesM,EAAKpT,GAAIqT,EAAKrT,IAEvCoT,EAAKpT,GAAKqT,EAAKrT,EAKlB,CAHC,MAAO6R,GAEPuB,EAAKpT,GAAKqT,EAAKrT,EAChB,CAGH,OAAOoT,CACR,CASD,SAAS/B,EAAYkC,EAAQC,GAI3B,IAAKA,IAAWD,EACd,OAAO,EAIT,GAAIA,EAAOtS,SAAWuS,EAAOvS,OAC3B,OAAO,EAGT,IAAK,IAAIqK,EAAI,EAAGA,EAAIiI,EAAOtS,OAAQqK,GAAK,EAEtC,GAAIiI,EAAOjI,aAAcxD,OAAS0L,EAAOlI,aAAcxD,OAErD,IAAKuJ,EAAYkC,EAAOjI,GAAIkI,EAAOlI,IACjC,OAAO,OAEJ,GAAIiI,EAAOjI,KAAOkI,EAAOlI,GAE9B,OAAO,EAGX,OAAO,CACR,CA7XDhJ,EAAOoE,UAAUyM,WAAa,WAG5B,IAAIla,EAAUT,KAAK0a,SAASja,QAC5BT,KAAKya,IAAM,CACT1X,MACEtC,EAAQ0C,gBAAkB1C,EAAQwC,OAAOwF,OAAS,GAClDhI,EAAQ2C,kBAAoB3C,EAAQwC,OAAOwF,OAC7CzF,OAAQvC,EAAQ0C,eAEnB,EAED2G,EAAOoE,UAAUF,OAAS,WAGxBhO,KAAK0a,SAASjR,KAAKY,OAAO,iBAAiB2D,SAC3ChO,KAAK0a,SAASzM,QACf,EAEDnE,EAAOoE,UAAUpD,OAAS,SAAU/H,GAGlC,IAAK/C,KAAK0a,SAASja,QAAQyC,cACzB,OAAO,EAGT,IAGI+X,EAHA5M,EAASrO,KACT0a,EAAW1a,KAAK0a,SAChBzX,EAASyX,EAASjR,KAElBhJ,EAAUia,EAASja,QAEvBT,KAAK2a,aAEL,IAAIO,EAAUza,EAAQwC,OAAOuM,MAAM,GACnC0L,EAAQxK,KAAKwK,EAAQA,EAAQzS,OAAS,GAAK,GAE3C,IAAI0S,EAAgBT,EAASjR,KAAKY,OAAO,iBAwEzC,SAAS+Q,EAAiBpO,GACxBA,EACG5M,KAAK,QAASK,EAAQ0C,gBACtB/C,KAAK,SAAUK,EAAQ0C,gBACvB/C,KAAK,KAAMK,EAAQ4a,kBACnBjb,KAAK,KAAMK,EAAQ4a,kBACnBjb,KAAK,KAAK,SAAUI,EAAGsS,GACtB,OAAOA,GAAKrS,EAAQ0C,eAAiB1C,EAAQ2C,kBAC9C,GACJ,CAsDD,SAASkY,IACP,OAAQ7a,EAAQ8C,0BACd,IAAK,QACH,MACqC,WAAnC9C,EAAQ6C,wBAC2B,WAAnC7C,EAAQ6C,uBAEDP,EAAQtC,EAAQ4C,aAAa,GAE/BN,EAAQsL,EAAOyJ,OAAO,SAAWrX,EAAQ4C,aAAa,GAC/D,IAAK,SACL,IAAK,SACH,OAAOiC,KAAKiW,MAAMxY,EAAQ,EAAIsL,EAAOyJ,OAAO,SAAW,GACzD,QACE,OAAOrX,EAAQ4C,aAAa,GAEjC,CAED,SAASmY,IACP,MAAuC,WAAnC/a,EAAQ6C,uBAERoX,EAASzR,SAASjG,OAClBvC,EAAQ4C,aAAa,GACrB5C,EAAQa,aACRb,EAAQW,YAGLX,EAAQ4C,aAAa,EAC7B,CAlK2B,OAAxB8X,EAAc,GAAG,GAEnBF,GADAhY,EAASkY,GACW9Q,OAAO,KAAKsB,UAAU,QAAQ1J,KAAKiZ,KAGvDjY,EACqC,QAAnCxC,EAAQ6C,uBACJL,EAAOwY,OAAO,MAAO,UACrBxY,EAAOqH,OAAO,QAEblK,KAAK,IAAKkb,KAAsBlb,KAAK,IAAKob,KAEjDP,EAAahY,EACV7C,KAAK,QAAS,gBACdA,KAAK,SAAUiO,EAAOyJ,OAAO,WAC7B1X,KAAK,QAASiO,EAAOyJ,OAAO,UAC5BxN,OAAO,KACPqB,YACA1J,KAAKiZ,IAGVD,EACGjP,QACA1B,OAAO,QACPkB,KAAK4P,GACLhb,KAAK,SAAS,SAAUI,GACvB,OAAOka,EAAS5Q,OAAO6G,SAASnQ,EAA4B,OAAzBka,EAAS3Q,YAC7C,IACA3J,KAAK,eAAgB,GACrBoL,MAAK,SAAUwB,GAEa,OAAzB0N,EAAS3Q,aACgB,OAAzBtJ,EAAQgD,cACRhD,EAAQgD,aAAa4E,eAAe,SAEpC2E,EAAU5M,KAAK,OAAQK,EAAQgD,aAAa4J,KAE/C,IACA/C,OAAO,SAEV2Q,EACGlN,OACAL,aACAC,SAASlN,EAAQ6D,mBACjBlE,KAAK,eAAgB,GACrB4N,SAEHiN,EACGvN,aACAgO,OAAM,SAAUlb,EAAGsS,GAClB,OAAQrS,EAAQ6D,kBAAoBwO,EAAK,EAC1C,IACAtH,KAAK4P,GACLhb,KAAK,eAAgB,GACrBoL,MAAK,SAAUwE,GACdA,EAAQ5P,KAAK,QAAQ,SAAUI,EAAGsS,GAChC,OAA6B,OAAzB4H,EAAS3Q,YACJ,GAGC,IAAN+I,EACK4H,EAAS3Q,YAAYvJ,EAAI,GAE3Bka,EAAS3Q,YAAYtJ,EAAQwC,OAAO6P,EAAI,GAChD,IAED9C,EAAQ5P,KAAK,SAAS,SAAUI,GAC9B,OAAOka,EAAS5Q,OAAO6G,SAASnQ,EAA4B,OAAzBka,EAAS3Q,YAC7C,GACF,IAaHkR,EAAW5Q,OAAO,SAASmD,MAAK,SAAUhN,EAAGsS,GAC3C,OAAU,IAANA,EACK4H,EAAS1J,uBAAuBvQ,EAAQyD,kBAAkBC,MAAO,CACtE+B,IAAKzF,EAAQwC,OAAO6P,GACpB3M,KAAM1F,EAAQkD,SAAS,KAEhBmP,IAAMoI,EAAQzS,OAAS,EACzBiS,EAAS1J,uBAAuBvQ,EAAQyD,kBAAkBG,MAAO,CACtEkB,IAAK9E,EAAQwC,OAAO6P,EAAI,GACxB3M,KAAM1F,EAAQkD,SAAS,KAGlB+W,EAAS1J,uBAAuBvQ,EAAQyD,kBAAkBE,MAAO,CACtEuX,KAAMlb,EAAQwC,OAAO6P,EAAI,GACzB8I,GAAInb,EAAQwC,OAAO6P,GACnB3M,KAAM1F,EAAQkD,SAAS,IAG5B,IACDsX,EACGxQ,GAAG,aAAa,SAAUjK,GACzBka,EAAS5Z,UAAUwM,KAAK9M,EAAGR,KAC5B,IACAyK,GAAG,YAAY,WACdiQ,EAAS5Z,UAAUyM,MACpB,IAEHtK,EACGyK,aACAC,SAASlN,EAAQ6D,mBACjBlE,KAAK,IAAKkb,KACVlb,KAAK,IAAKob,KACVpb,KAAK,QAASiO,EAAOyJ,OAAO,UAC5B1X,KAAK,SAAUiO,EAAOyJ,OAAO,WAEhC7U,EACGoH,OAAO,KACPqD,aACAC,SAASlN,EAAQ6D,mBACjBlE,KAAK,aAAa,WACjB,MAAkC,aAA9BK,EAAQ+C,kBAER,aACA/C,EAAQ0C,eAAiB,EACzB,IACA1C,EAAQ0C,eAAiB,EACzB,IAGG,EACR,IAgCHuX,EAASzM,QACV,EAUDnE,EAAOoE,UAAU4J,OAAS,SAAU1L,GAGlC,IAAIyP,EAA2D,eAA5C7b,KAAK0a,SAASja,QAAQ+C,kBAEzC,OAAQ4I,GACN,IAAK,QACH,OAAOpM,KAAKya,IAAIoB,EAAe,QAAU,UAC3C,IAAK,SACH,OAAO7b,KAAKya,IAAIoB,EAAe,SAAW,SAE/C,EAED/R,EAAOoE,UAAU4K,YAAc,WAG7B,IAAIrY,EAAUT,KAAK0a,SAASja,QAE5B,GAA6B,OAAzBA,EAAQgD,aAEV,OADAzD,KAAK0a,SAAS3Q,YAAc,MACrB,EAGT,IAAI+R,EAAc,GAElB,GAAIxM,MAAMC,QAAQ9O,EAAQgD,cACxBqY,EAAcrb,EAAQgD,iBACjB,KACLhD,EAAQgD,aAAa4E,eAAe,SACpC5H,EAAQgD,aAAa4E,eAAe,OAKpC,OADA5H,EAAQgD,aAAe,MAChB,EAHPqY,EAAc,CAACrb,EAAQgD,aAAayC,IAAKzF,EAAQgD,aAAa8B,IAI/D,CAED,IAUIwW,EAVAb,EAAUza,EAAQwC,OAAOuM,MAAM,GAE/B0L,EAAQ,GAAK,EACfA,EAAQc,QAAQ,GACPd,EAAQ,IAAM,GAEvBA,EAAQc,QACNd,EAAQ,IAAMA,EAAQA,EAAQzS,OAAS,GAAKyS,EAAQ,IAAMA,EAAQzS,QAKpEsT,EADEtb,EAAQgD,aAAa4E,eAAe,cACzB5H,EAAQgD,aAAasY,WAErBnc,EAAGqc,MACbC,SACAhb,MAAM4a,GACNK,YAAYvc,EAAGwc,gBACf5a,OAAO,CAAC5B,EAAGsG,IAAIgV,GAAUtb,EAAG2F,IAAI2V,KAGrC,IAAIzX,EAAeyX,EAAQlS,KAAI,SAAUgH,GACvC,OAAO+L,EAAW/L,EACnB,IAMD,OALAhQ,KAAK0a,SAAS3Q,YAAcnK,EAAGqc,MAC5BI,YACA7a,OAAOf,EAAQwC,QACf/B,MAAMuC,IAEF,CACR,EAWDqG,EAAOoE,UAAUyC,SAAW,SAAU6B,EAAG8J,GAGvC,GAAU,OAAN9J,GAAciF,MAAMjF,GACtB,MAAO,GAKT,IAFA,IAAIc,EAAQ,CAACtT,KAAK0a,SAASja,QAAQwC,OAAOwF,OAAS,GAG7CqK,EAAI,EAAGC,EAAQ/S,KAAK0a,SAASja,QAAQwC,OAAOwF,OAAS,EACzDqK,GAAKC,EACLD,GAAK,EACL,CACA,GAAI9S,KAAK0a,SAASja,QAAQwC,OAAO,GAAK,GAAKuP,EAAI,EAAG,CAChDc,EAAQ,CAAC,IAAK,KACd,KACD,CAED,GAAId,GAAKxS,KAAK0a,SAASja,QAAQwC,OAAO6P,GAAI,CACxCQ,EAAQ,CAACR,EAAI,GACb,KACD,CACF,CAOD,OALU,IAANN,GACFc,EAAM5C,KAAK,GAGb4C,EAAM0I,QAAQ,KACN1I,EAAM1C,KAAK,OAAS0L,EAAehJ,EAAM1C,KAAK,MAAQ,KAAKR,MACpE,EA6DD,UCh8HMmM,EAAY,CAChBta,KAAMua,IAAAA,MAAgB,CAKpBva,KAAMua,IAAAA,OACNhb,OAAQgb,IAAAA,OACRtb,MAAOsb,IAAAA,OAEP3a,MAAO2a,IAAAA,OACP3I,UAAW2I,IAAAA,SAEbxZ,OAAQwZ,IAAAA,OAERpb,YAAaob,IAAAA,OAEbnb,WAAYmb,IAAAA,OAEZrb,SAAUqb,IAAAA,OACVC,kBAAmBD,IAAAA,OACnBxD,WAAYwD,IAAAA,KACZE,eAAgBF,IAAAA,KAChBG,WAAYH,IAAAA,KACZI,MAAOJ,IAAAA,OACP9b,cAAe8b,IAAAA,KACf5b,eAAgB4b,IAAAA,KAChBK,WAAYL,IAAAA,OACZM,MAAON,IAAAA,QAGT,SAASO,EAAS/M,EAASgN,GACzB,MAAM,KACJ/a,EADI,OAEJe,EAFI,YAGJ5B,EAAc,EAHV,WAIJC,EAAa,EAJT,SAKJF,EAAW,GALP,kBAMJ8b,EANI,kBAOJR,EAPI,WAQJzD,EARI,eASJ0D,EATI,WAUJC,EAVI,MAWJC,EAXI,qBAYJM,EAZI,cAaJxc,EAbI,eAcJE,EAdI,WAeJic,EAfI,MAgBJC,GACEE,EAEEG,GAAYC,EAAAA,EAAAA,GAASpN,GACxBqN,QAAQ,kCAAkC,GAC1ClD,MAAM,SAAUnX,GACnBma,EAAUxR,UAAU,KAAKqC,SACzB,MAAMsP,EAAMH,EAAU7S,OAAO,OAEvBrG,EAAsB0Y,EACxB,CAACzX,EAAMU,IAAUhF,EAAegF,GAChC,KAEE2X,EAActb,EAAKA,KAEnBub,GAAc7c,EAAAA,EAAAA,GAAE,UAEtBsW,OAAO/D,KAAKqK,GAAarG,SAAQuG,IAC/B,MAAMC,EAAeJ,EAAIhT,OAAO,OAC5BoS,GACFgB,EAAalQ,KAAM,GAAEgQ,MAAgBX,EAAWY,IAAWA,KAE7D,MAAMxY,EAAasY,EAAYE,GACzBE,EC/FK,SAASC,EAAQC,GAC9B,IAAI3X,EACAX,EACJ,QAAgBuY,IAAZD,EACF,IAAK,MAAMjY,KAASgY,EACL,MAAThY,SACUkY,IAAR5X,EACEN,GAASA,IAAOM,EAAMX,EAAMK,IAE5BM,EAAMN,IAAOM,EAAMN,GACnBL,EAAMK,IAAOL,EAAMK,SAIxB,CACL,IAAI0N,GAAS,EACb,IAAK,IAAI1N,KAASgY,EACiC,OAA5ChY,EAAQiY,EAAQjY,IAAS0N,WAChBwK,IAAR5X,EACEN,GAASA,IAAOM,EAAMX,EAAMK,IAE5BM,EAAMN,IAAOM,EAAMN,GACnBL,EAAMK,IAAOL,EAAMK,IAI9B,CACD,MAAO,CAACM,EAAKX,EACd,CDmEmBwY,CAAS9G,OAAO/D,KAAKjO,IAAakS,GAAOlS,EAAWkS,KAC9DjD,GAAQyJ,EAAQ,GAAKA,EAAQ,KAAOf,EAAQ,GAC5Cb,GAAaiC,EAAAA,EAAAA,KAChBlR,IAAI2P,GACJwB,kBAAkBN,GAEf1a,EErGK,SAASpB,EAAO0S,EAAML,GACnCrS,GAASA,EAAO0S,GAAQA,EAAML,GAAQ1B,EAAIhK,UAAUC,QAAU,GAAK8L,EAAO1S,EAAOA,EAAQ,EAAG,GAAK2Q,EAAI,EAAI,GAAK0B,EAM9G,IAJA,IAAIpB,GAAK,EACLN,EAAoD,EAAhDlN,KAAKC,IAAI,EAAGD,KAAKiO,MAAMgB,EAAO1S,GAASqS,IAC3ChT,EAAQ,IAAIoO,MAAMkD,KAEbM,EAAIN,GACXtR,EAAM4R,GAAKjR,EAAQiR,EAAIoB,EAGzB,OAAOhT,CACR,CFyFkBgd,CAAQtB,GAAO5T,KAAI8J,GAAK6K,EAAQ,GAAKzJ,EAAOpB,IACrDrP,EAAeR,EAAO+F,KAAIpG,GAAKmZ,EAAWnZ,MAEpC,IAAI9C,GACZqO,KAAK,CACPtM,MAAOI,EAAKJ,MACZI,KAAMgD,EACNjE,aAAc0c,EAAaS,OAC3B7a,uBAAwB,MACxBnC,WACAC,cACAC,aACA8B,eAAgBhC,EAChBiC,kBAAmB,EACnBiY,iBAAkBha,EAClBqD,SAAS,EACTlD,OAAQyb,EACRxb,UAAWyb,EACXhc,MAAOe,EAAKf,MACZkd,UAAU,EACVnb,SACAQ,aAAc,CACZsY,aACA7V,IAAKzC,EAAa,GAClB8B,IAAK9B,EAAaA,EAAagF,OAAS,GACxC3E,MAAOgZ,EAAMuB,OAAOC,UAAUC,QAEhCrb,cAAe8V,EACfrV,SAAU,GACV/C,iBACAF,gBACAuD,uBA3BF,GA8BH,CAED8Y,EAASyB,YAAc,WACvBzB,EAASR,UAAYA,EAErB,UGpHMkC,GAAiBC,EAAAA,EAAAA,GAASC,GAE1B5B,EAAY,IAAkC,IAAlC,UAAE6B,KAAcC,GAAiB,EACjD,MAAM/B,GAAQgC,EAAAA,EAAAA,MACd,OACE,eAAKF,UAAWA,IACd,QAAC,KAAD,CACExF,OAAQY,EAAAA,EAAI;;;uBAGoB,EAAjB8C,EAAMiC;0BACHjC,EAAMuB,OAAOC,UAAUU;qBAC5BlC,EAAMuB,OAAOC,UAAUC;;;;yBAInBzB,EAAMmC,WAAWC,MAAMjS;;;;;;yBAMvB6P,EAAMmC,WAAWC,MAAMC;;;qBAG3BrC,EAAMuB,OAAOC,UAAUU;;;;;;;uBAOrBlC,EAAMiC;;;;;;;;uBAQNjC,EAAMiC;;qBAES,EAAjBjC,EAAMiC;;;;;;oBAMU,EAAjBjC,EAAMiC;;;;;;;uBAOHjC,EAAMiC;;;;aAMvB,QAACN,EAAD,OAAoBI,EAApB,CAAgC/B,MAAOA,KAzD3C,EA8DFC,EAASqC,aAAe,CACtBP,WAAY,CAAC,GAGf9B,EAASR,UAAY,CACnBqC,UAAWpC,IAAAA,OAAAA,WACXqC,WAAYrC,IAAAA,SAAmBA,IAAAA,MAGjC,SAAe6C,EAAAA,EAAAA,IAAOtC,EAAU;IAC3B,IAAD,IAAC,MAAED,GAAH,QAAgB,2DAEc,EAAjBA,EAAMiC,qKAMe,EAAjBjC,EAAMiC,kCACPjC,EAAMiC,8GAKQ,EAAjBjC,EAAMiC,kCACHjC,EAAMuB,OAAOC,UAAUU,wBAC5BlC,EAAMuB,OAAOC,UAAUC,iCACfzB,EAAMwC,qMAUfxC,EAAMuB,OAAOC,UAAUjR,2BAClByP,EAAMmC,WAAWC,MAAMC,2MAS5BrC,EAAMuB,OAAOC,UAAUiB,mGAIrBzC,EAAMuB,OAAOC,UAAUU,6GAKpBlC,EAAMmC,WAAWC,MAAMC,6LAShBrC,EAAMuB,OAAOC,UAAUjR,sBACnCyP,EAAMuB,OAAOC,UAAUjR,6EAIXyP,EAAMuB,OAAOmB,MAAMD,wBAC/BzC,EAAMuB,OAAOmB,MAAMD,+EAIPzC,EAAMuB,OAAOmB,MAAMC,wBAC/B3C,EAAMuB,OAAOmB,MAAMC,+EAIP3C,EAAMuB,OAAOqB,QAAQD,wBACjC3C,EAAMuB,OAAOqB,QAAQD,+EAIT3C,EAAMuB,OAAOqB,QAAQrS,sBACjCyP,EAAMuB,OAAOqB,QAAQrS,6EAITyP,EAAMuB,OAAOqB,QAAQC,uBACjC7C,EAAMuB,OAAOqB,QAAQC,+EAInB7C,EAAMuB,OAAOC,UAAUqB,qGAKzB7C,EAAMuB,OAAOC,UAAUqB,mFAIrB7C,EAAMuB,OAAOzP,MAAMvB,gFAIrByP,EAAMuB,OAAOzP,MAAMvB,6BACZyP,EAAMmC,WAAWW,QAAQC,sKASZ,EAAjB/C,EAAMiC,kCACHjC,EAAMuB,OAAOC,UAAUqB,wBAC5B7C,EAAMuB,OAAOC,UAAUmB,6BACnB3C,EAAMmC,WAAWC,MAAMjS,yJAMnB6P,EAAMwC,kDACGxC,EAAMuB,OAAOC,UAAUU,4SActClC,EAAMiC,sDAEDjC,EAAMiC,oCACNjC,EAAMiC,cAAcjC,EAAMiC,0CACtBjC,EAAMuB,OAAOC,UAAUqB,mBAxI7C;8DClDU,SAAUjB,EACtBoB,EACAC,GAEA,MAAMC,UAA4BC,EAAAA,UAGhCnF,YAAYkC,GACVkD,MAAMlD,GADgC,KAFxCG,eAEwC,EAEtCnd,KAAKmgB,gBAAkBngB,KAAKmgB,gBAAgBC,KAAKpgB,KAClD,CAEDqgB,oBACErgB,KAAKsgB,SACN,CAEDC,qBACEvgB,KAAKsgB,SACN,CAEDE,uBACExgB,KAAKmd,eAAYW,EACjB,MAAIiC,GAAAA,EAAWS,sBACbT,EAAUS,qBAAqBJ,KAAKpgB,KAApC+f,EAEH,CAEDI,gBAAgBM,GACdzgB,KAAKmd,UAAYsD,CAClB,CAEDH,UACMtgB,KAAKmd,WACP2C,EAAS9f,KAAKmd,UAAWnd,KAAKgd,MAEjC,CAED0D,SACE,MAAM,GAAEC,EAAF,UAAM/B,GAAc5e,KAAKgd,MAE/B,OAAO,eAAKyD,IAAKzgB,KAAKmgB,gBAAiBQ,GAAIA,EAAI/B,UAAWA,GAC3D,EAGH,MAAMgC,EACJZ,EAgBF,OAdIF,EAAStB,cACXoC,EAAgBpC,YAAcsB,EAAStB,aAGrCsB,EAASvD,YACXqE,EAAgBrE,UAAY,IACvBqE,EAAgBrE,aAChBuD,EAASvD,YAGZuD,EAASV,eACXwB,EAAgBxB,aAAeU,EAASV,cAGnCY,CACR,C","sources":["webpack://superset/./plugins/legacy-plugin-chart-calendar/src/vendor/cal-heatmap.js","webpack://superset/./plugins/legacy-plugin-chart-calendar/src/Calendar.js","webpack://superset/./plugins/legacy-plugin-chart-calendar/node_modules/d3-array/src/extent.js","webpack://superset/./plugins/legacy-plugin-chart-calendar/node_modules/d3-array/src/range.js","webpack://superset/./plugins/legacy-plugin-chart-calendar/src/ReactCalendar.jsx","webpack://superset/./packages/superset-ui-core/src/chart/components/reactify.tsx"],"sourcesContent":["// [LICENSE TBD]\n/* Copied and altered from http://cal-heatmap.com/ , alterations around:\n * - tuning tooltips\n * - supporting multi-colors scales\n * - legend format\n * - UTC handling\n */\n\n/* eslint-disable */\n\nimport d3tip from 'd3-tip';\nimport { getContrastingColor, t } from '@superset-ui/core';\n\nvar d3 = typeof require === 'function' ? require('d3') : window.d3;\n\nvar d3 = typeof require === 'function' ? require('d3') : window.d3;\n\nvar CalHeatMap = function () {\n  'use strict';\n\n  var self = this;\n  self.tip = d3tip()\n    .attr('class', 'd3-tip')\n    .direction('n')\n    .offset([-5, 0])\n    .html(\n      d => `\n      ${self.options.timeFormatter(d.t)}: <strong>${self.options.valueFormatter(\n        d.v,\n      )}</strong>\n    `,\n    );\n  self.legendTip = d3tip()\n    .attr('class', 'd3-tip')\n    .direction('n')\n    .offset([-5, 0])\n    .html(d => self.options.valueFormatter(d));\n\n  this.allowedDataType = ['json', 'csv', 'tsv', 'txt'];\n\n  // Default settings\n  this.options = {\n    // selector string of the container to append the graph to\n    // Accept any string value accepted by document.querySelector or CSS3\n    // or an Element object\n    itemSelector: '#cal-heatmap',\n\n    // Whether to paint the calendar on init()\n    // Used by testsuite to reduce testing time\n    paintOnLoad: true,\n\n    // ================================================\n    // DOMAIN\n    // ================================================\n\n    // Number of domain to display on the graph\n    range: 12,\n\n    // Size of each cell, in pixel\n    cellSize: 10,\n\n    // Padding between each cell, in pixel\n    cellPadding: 2,\n\n    // For rounded subdomain rectangles, in pixels\n    cellRadius: 0,\n\n    domainGutter: 2,\n\n    domainMargin: [0, 0, 0, 0],\n\n    valueFormatter: d => d,\n\n    timeFormatter: d => d,\n\n    domain: 'hour',\n\n    subDomain: 'min',\n\n    // Number of columns to split the subDomains to\n    // If not null, will takes precedence over rowLimit\n    colLimit: null,\n\n    // Number of rows to split the subDomains to\n    // Will be ignored if colLimit is not null\n    rowLimit: null,\n\n    // First day of the week is Monday\n    // 0 to start the week on Sunday\n    weekStartOnMonday: true,\n\n    // Start date of the graph\n    // @default now\n    start: new Date(),\n\n    minDate: null,\n\n    maxDate: null,\n\n    // ================================================\n    // DATA\n    // ================================================\n\n    // Data source\n    // URL, where to fetch the original datas\n    data: '',\n\n    // Data type\n    // Default: json\n    dataType: this.allowedDataType[0],\n\n    // Payload sent when using POST http method\n    // Leave to null (default) for GET request\n    // Expect a string, formatted like \"a=b;c=d\"\n    dataPostPayload: null,\n\n    // Additional headers sent when requesting data\n    // Expect an object formatted like:\n    // { 'X-CSRF-TOKEN': 'token' }\n    dataRequestHeaders: null,\n\n    // Whether to consider missing date:value from the datasource\n    // as equal to 0, or just leave them as missing\n    considerMissingDataAsZero: false,\n\n    // Load remote data on calendar creation\n    // When false, the calendar will be left empty\n    loadOnInit: true,\n\n    // Calendar orientation\n    // false: display domains side by side\n    // true : display domains one under the other\n    verticalOrientation: false,\n\n    // Domain dynamic width/height\n    // The width on a domain depends on the number of\n    domainDynamicDimension: true,\n\n    // Domain Label properties\n    label: {\n      // valid: top, right, bottom, left\n      position: 'bottom',\n\n      // Valid: left, center, right\n      // Also valid are the direct svg values: start, middle, end\n      align: 'center',\n\n      // By default, there is no margin/padding around the label\n      offset: {\n        x: 0,\n        y: 0,\n      },\n\n      rotate: null,\n\n      // Used only on vertical orientation\n      width: 100,\n\n      // Used only on horizontal orientation\n      height: null,\n    },\n\n    // ================================================\n    // LEGEND\n    // ================================================\n\n    // Threshold for the legend\n    legend: [10, 20, 30, 40],\n\n    // Whether to display the legend\n    displayLegend: true,\n\n    legendCellSize: 10,\n\n    legendCellPadding: 2,\n\n    legendMargin: [0, 0, 0, 0],\n\n    // Legend vertical position\n    // top: place legend above calendar\n    // bottom: place legend below the calendar\n    legendVerticalPosition: 'bottom',\n\n    // Legend horizontal position\n    // accepted values: left, center, right\n    legendHorizontalPosition: 'left',\n\n    // Legend rotation\n    // accepted values: horizontal, vertical\n    legendOrientation: 'horizontal',\n\n    // Objects holding all the heatmap different colors\n    // null to disable, and use the default css styles\n    //\n    // Examples:\n    // legendColors: {\n    //    min: \"green\",\n    //    max: \"red\",\n    //    empty: \"#ffffff\",\n    //    base: \"grey\",\n    //    overflow: \"red\",\n    //    colorScaler: null,\n    // }\n    legendColors: null,\n\n    // ================================================\n    // HIGHLIGHT\n    // ================================================\n\n    // List of dates to highlight\n    // Valid values:\n    // - []: don't highlight anything\n    // - \"now\": highlight the current date\n    // - an array of Date objects: highlight the specified dates\n    highlight: [],\n\n    // ================================================\n    // TEXT FORMATTING / i18n\n    // ================================================\n\n    // Name of the items to represent in the calendar\n    itemName: ['item', 'items'],\n\n    // Formatting of the domain label\n    // @default: null, will use the formatting according to domain type\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    domainLabelFormat: null,\n\n    // Formatting of the title displayed when hovering a subDomain cell\n    subDomainTitleFormat: {\n      empty: '{date}',\n      filled: '{count} {name} {connector} {date}',\n    },\n\n    // Formatting of the {date} used in subDomainTitleFormat\n    // @default: null, will use the formatting according to subDomain type\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    subDomainDateFormat: null,\n\n    // Formatting of the text inside each subDomain cell\n    // @default: null, no text\n    // Accept a string used as specifier by d3.time.format()\n    // or a function\n    //\n    // Refer to https://github.com/mbostock/d3/wiki/Time-Formatting\n    // for accepted date formatting used by d3.time.format()\n    subDomainTextFormat: null,\n\n    // Formatting of the title displayed when hovering a legend cell\n    legendTitleFormat: {\n      lower: t('less than {min} {name}'),\n      inner: t('between {down} and {up} {name}'),\n      upper: t('more than {max} {name}'),\n    },\n\n    // Animation duration, in ms\n    animationDuration: 500,\n\n    nextSelector: false,\n\n    previousSelector: false,\n\n    itemNamespace: 'cal-heatmap',\n\n    tooltip: false,\n\n    // ================================================\n    // EVENTS CALLBACK\n    // ================================================\n\n    // Callback when clicking on a time block\n    onClick: null,\n\n    // Callback after painting the empty calendar\n    // Can be used to trigger an API call, once the calendar is ready to be filled\n    afterLoad: null,\n\n    // Callback after loading the next domain in the calendar\n    afterLoadNextDomain: null,\n\n    // Callback after loading the previous domain in the calendar\n    afterLoadPreviousDomain: null,\n\n    // Callback after finishing all actions on the calendar\n    onComplete: null,\n\n    // Callback after fetching the datas, but before applying them to the calendar\n    // Used mainly to convert the datas if they're not formatted like expected\n    // Takes the fetched \"data\" object as argument, must return a json object\n    // formatted like {timestamp:count, timestamp2:count2},\n    afterLoadData: function (timestamps) {\n      // See https://github.com/wa0x6e/cal-heatmap/issues/126#issuecomment-373301803\n      const stdTimezoneOffset = date => {\n        const jan = new Date(date.getFullYear(), 0, 1);\n        const jul = new Date(date.getFullYear(), 6, 1);\n        return Math.max(jan.getTimezoneOffset(), jul.getTimezoneOffset());\n      };\n      const offset = stdTimezoneOffset(new Date()) * 60;\n      let results = {};\n      for (let timestamp in timestamps) {\n        const value = timestamps[timestamp];\n        timestamp = parseInt(timestamp, 10);\n        results[timestamp + offset] = value;\n      }\n      return results;\n    },\n\n    // Callback triggered after calling and completing update().\n    afterUpdate: null,\n\n    // Callback triggered after calling next().\n    // The `status` argument is equal to true if there is no\n    // more next domain to load\n    //\n    // This callback is also executed once, after calling previous(),\n    // only when the max domain is reached\n    onMaxDomainReached: null,\n\n    // Callback triggered after calling previous().\n    // The `status` argument is equal to true if there is no\n    // more previous domain to load\n    //\n    // This callback is also executed once, after calling next(),\n    // only when the min domain is reached\n    onMinDomainReached: null,\n  };\n\n  this._domainType = {\n    min: {\n      name: 'minute',\n      level: 10,\n      maxItemNumber: 60,\n      defaultRowNumber: 10,\n      defaultColumnNumber: 6,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          return Math.floor(d.getMinutes() / self._domainType.min.row(d));\n        },\n        y: function (d) {\n          return d.getMinutes() % self._domainType.min.row(d);\n        },\n      },\n      format: {\n        date: '%H:%M, %A %B %-e, %Y',\n        legend: '',\n        connector: 'at',\n      },\n      extractUnit: function (d) {\n        return new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate(),\n          d.getHours(),\n          d.getMinutes(),\n        ).getTime();\n      },\n    },\n    hour: {\n      name: 'hour',\n      level: 20,\n      maxItemNumber: function (d) {\n        switch (self.options.domain) {\n          case 'day':\n            return 24;\n          case 'week':\n            return 24 * 7;\n          case 'month':\n            return (\n              24 *\n              (self.options.domainDynamicDimension\n                ? self.getDayCountInMonth(d)\n                : 31)\n            );\n        }\n      },\n      defaultRowNumber: 6,\n      defaultColumnNumber: function (d) {\n        switch (self.options.domain) {\n          case 'day':\n            return 4;\n          case 'week':\n            return 28;\n          case 'month':\n            return self.options.domainDynamicDimension\n              ? self.getDayCountInMonth(d)\n              : 31;\n        }\n      },\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          if (self.options.domain === 'month') {\n            if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n              return Math.floor(\n                (d.getHours() + (d.getDate() - 1) * 24) /\n                  self._domainType.hour.row(d),\n              );\n            }\n            return (\n              Math.floor(d.getHours() / self._domainType.hour.row(d)) +\n              (d.getDate() - 1) * 4\n            );\n          } else if (self.options.domain === 'week') {\n            if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n              return Math.floor(\n                (d.getHours() + self.getWeekDay(d) * 24) /\n                  self._domainType.hour.row(d),\n              );\n            }\n            return (\n              Math.floor(d.getHours() / self._domainType.hour.row(d)) +\n              self.getWeekDay(d) * 4\n            );\n          }\n          return Math.floor(d.getHours() / self._domainType.hour.row(d));\n        },\n        y: function (d) {\n          var p = d.getHours();\n          if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n            switch (self.options.domain) {\n              case 'month':\n                p += (d.getDate() - 1) * 24;\n                break;\n              case 'week':\n                p += self.getWeekDay(d) * 24;\n                break;\n            }\n          }\n          return Math.floor(p % self._domainType.hour.row(d));\n        },\n      },\n      format: {\n        date: '%Hh, %A %B %-e, %Y',\n        legend: '%H:00',\n        connector: 'at',\n      },\n      extractUnit: function (d) {\n        return new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate(),\n          d.getHours(),\n        ).getTime();\n      },\n    },\n    day: {\n      name: 'day',\n      level: 30,\n      maxItemNumber: function (d) {\n        switch (self.options.domain) {\n          case 'week':\n            return 7;\n          case 'month':\n            return self.options.domainDynamicDimension\n              ? self.getDayCountInMonth(d)\n              : 31;\n          case 'year':\n            return self.options.domainDynamicDimension\n              ? self.getDayCountInYear(d)\n              : 366;\n        }\n      },\n      defaultColumnNumber: function (d) {\n        d = new Date(d);\n        switch (self.options.domain) {\n          case 'week':\n            return 1;\n          case 'month':\n            return self.options.domainDynamicDimension &&\n              !self.options.verticalOrientation\n              ? self.getWeekNumber(\n                  new Date(d.getFullYear(), d.getMonth() + 1, 0),\n                ) -\n                  self.getWeekNumber(d) +\n                  1\n              : 6;\n          case 'year':\n            return self.options.domainDynamicDimension\n              ? self.getWeekNumber(new Date(d.getFullYear(), 11, 31)) -\n                  self.getWeekNumber(new Date(d.getFullYear(), 0)) +\n                  1\n              : 54;\n        }\n      },\n      defaultRowNumber: 7,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          switch (self.options.domain) {\n            case 'week':\n              return Math.floor(\n                self.getWeekDay(d) / self._domainType.day.row(d),\n              );\n            case 'month':\n              if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n                return Math.floor(\n                  (d.getDate() - 1) / self._domainType.day.row(d),\n                );\n              }\n              return (\n                self.getWeekNumber(d) -\n                self.getWeekNumber(new Date(d.getFullYear(), d.getMonth()))\n              );\n            case 'year':\n              if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n                return Math.floor(\n                  (self.getDayOfYear(d) - 1) / self._domainType.day.row(d),\n                );\n              }\n              return self.getWeekNumber(d);\n          }\n        },\n        y: function (d) {\n          var p = self.getWeekDay(d);\n          if (self.options.colLimit > 0 || self.options.rowLimit > 0) {\n            switch (self.options.domain) {\n              case 'year':\n                p = self.getDayOfYear(d) - 1;\n                break;\n              case 'week':\n                p = self.getWeekDay(d);\n                break;\n              case 'month':\n                p = d.getDate() - 1;\n                break;\n            }\n          }\n          return Math.floor(p % self._domainType.day.row(d));\n        },\n      },\n      format: {\n        date: '%A %B %-e, %Y',\n        legend: '%e %b',\n        connector: 'on',\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear(), d.getMonth(), d.getDate()).getTime();\n      },\n    },\n    week: {\n      name: 'week',\n      level: 40,\n      maxItemNumber: 54,\n      defaultColumnNumber: function (d) {\n        d = new Date(d);\n        switch (self.options.domain) {\n          case 'year':\n            return self._domainType.week.maxItemNumber;\n          case 'month':\n            return self.options.domainDynamicDimension\n              ? self.getWeekNumber(\n                  new Date(d.getFullYear(), d.getMonth() + 1, 0),\n                ) - self.getWeekNumber(d)\n              : 5;\n        }\n      },\n      defaultRowNumber: 1,\n      row: function (d) {\n        return self.getSubDomainRowNumber(d);\n      },\n      column: function (d) {\n        return self.getSubDomainColumnNumber(d);\n      },\n      position: {\n        x: function (d) {\n          switch (self.options.domain) {\n            case 'year':\n              return Math.floor(\n                self.getWeekNumber(d) / self._domainType.week.row(d),\n              );\n            case 'month':\n              return Math.floor(\n                self.getMonthWeekNumber(d) / self._domainType.week.row(d),\n              );\n          }\n        },\n        y: function (d) {\n          return self.getWeekNumber(d) % self._domainType.week.row(d);\n        },\n      },\n      format: {\n        date: '%B Week #%W',\n        legend: '%B Week #%W',\n        connector: 'in',\n      },\n      extractUnit: function (d) {\n        var dt = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n        // According to ISO-8601, week number computation are based on week starting on Monday\n        var weekDay = dt.getDay() - (self.options.weekStartOnMonday ? 1 : 0);\n        if (weekDay < 0) {\n          weekDay = 6;\n        }\n        dt.setDate(dt.getDate() - weekDay);\n        return dt.getTime();\n      },\n    },\n    month: {\n      name: 'month',\n      level: 50,\n      maxItemNumber: 12,\n      defaultColumnNumber: 12,\n      defaultRowNumber: 1,\n      row: function () {\n        return self.getSubDomainRowNumber();\n      },\n      column: function () {\n        return self.getSubDomainColumnNumber();\n      },\n      position: {\n        x: function (d) {\n          return Math.floor(d.getMonth() / self._domainType.month.row(d));\n        },\n        y: function (d) {\n          return d.getMonth() % self._domainType.month.row(d);\n        },\n      },\n      format: {\n        date: '%B %Y',\n        legend: '%B',\n        connector: 'in',\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear(), d.getMonth()).getTime();\n      },\n    },\n    year: {\n      name: 'year',\n      level: 60,\n      row: function () {\n        return self.options.rowLimit || 1;\n      },\n      column: function () {\n        return self.options.colLimit || 1;\n      },\n      position: {\n        x: function () {\n          return 1;\n        },\n        y: function () {\n          return 1;\n        },\n      },\n      format: {\n        date: '%Y',\n        legend: '%Y',\n        connector: 'in',\n      },\n      extractUnit: function (d) {\n        return new Date(d.getFullYear()).getTime();\n      },\n    },\n  };\n\n  for (var type in this._domainType) {\n    if (this._domainType.hasOwnProperty(type)) {\n      var d = this._domainType[type];\n      this._domainType['x_' + type] = {\n        name: 'x_' + type,\n        level: d.type,\n        maxItemNumber: d.maxItemNumber,\n        defaultRowNumber: d.defaultRowNumber,\n        defaultColumnNumber: d.defaultColumnNumber,\n        row: d.column,\n        column: d.row,\n        position: {\n          x: d.position.y,\n          y: d.position.x,\n        },\n        format: d.format,\n        extractUnit: d.extractUnit,\n      };\n    }\n  }\n\n  // Record the address of the last inserted domain when browsing\n  this.lastInsertedSvg = null;\n\n  this._completed = false;\n\n  // Record all the valid domains\n  // Each domain value is a timestamp in milliseconds\n  this._domains = d3.map();\n\n  this.graphDim = {\n    width: 0,\n    height: 0,\n  };\n\n  this.legendDim = {\n    width: 0,\n    height: 0,\n  };\n\n  this.NAVIGATE_LEFT = 1;\n  this.NAVIGATE_RIGHT = 2;\n\n  // Various update mode when using the update() API\n  this.RESET_ALL_ON_UPDATE = 0;\n  this.RESET_SINGLE_ON_UPDATE = 1;\n  this.APPEND_ON_UPDATE = 2;\n\n  this.DEFAULT_LEGEND_MARGIN = 10;\n\n  this.root = null;\n  this.tooltip = null;\n\n  this._maxDomainReached = false;\n  this._minDomainReached = false;\n\n  this.domainPosition = new DomainPosition();\n  this.Legend = null;\n  this.legendScale = null;\n\n  // List of domains that are skipped because of DST\n  // All times belonging to these domains should be re-assigned to the previous domain\n  this.DSTDomain = [];\n\n  /**\n   * Display the graph for the first time\n   * @return bool True if the calendar is created\n   */\n  this._init = function () {\n    self\n      .getDomain(self.options.start)\n      .map(function (d) {\n        return d.getTime();\n      })\n      .map(function (d) {\n        self._domains.set(\n          d,\n          self.getSubDomain(d).map(function (d) {\n            return {\n              t: self._domainType[self.options.subDomain].extractUnit(d),\n              v: null,\n            };\n          }),\n        );\n      });\n\n    self.root = d3\n      .select(self.options.itemSelector)\n      .append('svg')\n      .attr('class', 'cal-heatmap-container');\n\n    self.root.attr('x', 0).attr('y', 0).append('svg').attr('class', 'graph');\n\n    self.Legend = new Legend(self);\n\n    if (self.options.paintOnLoad) {\n      _initCalendar();\n    }\n    self.root.call(self.tip);\n    self.root.call(self.legendTip);\n\n    return true;\n  };\n\n  function _initCalendar() {\n    self.verticalDomainLabel =\n      self.options.label.position === 'top' ||\n      self.options.label.position === 'bottom';\n\n    self.domainVerticalLabelHeight =\n      self.options.label.height === null\n        ? Math.max(25, self.options.cellSize * 2)\n        : self.options.label.height;\n    self.domainHorizontalLabelWidth = 0;\n\n    if (\n      self.options.domainLabelFormat === '' &&\n      self.options.label.height === null\n    ) {\n      self.domainVerticalLabelHeight = 0;\n    }\n\n    if (!self.verticalDomainLabel) {\n      self.domainVerticalLabelHeight = 0;\n      self.domainHorizontalLabelWidth = self.options.label.width;\n    }\n\n    self.paint();\n\n    // =========================================================================//\n    // ATTACHING DOMAIN NAVIGATION EVENT                    //\n    // =========================================================================//\n    if (self.options.nextSelector !== false) {\n      d3.select(self.options.nextSelector).on(\n        'click.' + self.options.itemNamespace,\n        function () {\n          d3.event.preventDefault();\n          return self.loadNextDomain(1);\n        },\n      );\n    }\n\n    if (self.options.previousSelector !== false) {\n      d3.select(self.options.previousSelector).on(\n        'click.' + self.options.itemNamespace,\n        function () {\n          d3.event.preventDefault();\n          return self.loadPreviousDomain(1);\n        },\n      );\n    }\n\n    self.Legend.redraw(\n      self.graphDim.width -\n        self.options.domainGutter -\n        self.options.cellPadding,\n    );\n    self.afterLoad();\n\n    var domains = self.getDomainKeys();\n\n    // Fill the graph with some datas\n    if (self.options.loadOnInit) {\n      self.getDatas(\n        self.options.data,\n        new Date(domains[0]),\n        self.getSubDomain(domains[domains.length - 1]).pop(),\n        function () {\n          self.fill();\n          self.onComplete();\n        },\n      );\n    } else {\n      self.onComplete();\n    }\n\n    self.checkIfMinDomainIsReached(domains[0]);\n    self.checkIfMaxDomainIsReached(self.getNextDomain().getTime());\n  }\n\n  // Return the width of the domain block, without the domain gutter\n  // @param int d Domain start timestamp\n  function w(d, outer) {\n    var width =\n      self.options.cellSize *\n        self._domainType[self.options.subDomain].column(d) +\n      self.options.cellPadding *\n        self._domainType[self.options.subDomain].column(d);\n    if (arguments.length === 2 && outer === true) {\n      return (width +=\n        self.domainHorizontalLabelWidth +\n        self.options.domainGutter +\n        self.options.domainMargin[1] +\n        self.options.domainMargin[3]);\n    }\n    return width;\n  }\n\n  // Return the height of the domain block, without the domain gutter\n  function h(d, outer) {\n    var height =\n      self.options.cellSize * self._domainType[self.options.subDomain].row(d) +\n      self.options.cellPadding *\n        self._domainType[self.options.subDomain].row(d);\n    if (arguments.length === 2 && outer === true) {\n      height +=\n        self.options.domainGutter +\n        self.domainVerticalLabelHeight +\n        self.options.domainMargin[0] +\n        self.options.domainMargin[2];\n    }\n    return height;\n  }\n\n  /**\n   *\n   *\n   * @param int navigationDir\n   */\n  this.paint = function (navigationDir) {\n    var options = self.options;\n\n    if (arguments.length === 0) {\n      navigationDir = false;\n    }\n\n    // Painting all the domains\n    var domainSvg = self.root\n      .select('.graph')\n      .selectAll('.graph-domain')\n      .data(\n        function () {\n          var data = self.getDomainKeys();\n          return navigationDir === self.NAVIGATE_LEFT ? data.reverse() : data;\n        },\n        function (d) {\n          return d;\n        },\n      );\n    var enteringDomainDim = 0;\n    var exitingDomainDim = 0;\n\n    // =========================================================================//\n    // PAINTING DOMAIN                              //\n    // =========================================================================//\n\n    var svg = domainSvg\n      .enter()\n      .append('svg')\n      .attr('width', function (d) {\n        return w(d, true);\n      })\n      .attr('height', function (d) {\n        return h(d, true);\n      })\n      .attr('x', function (d) {\n        if (options.verticalOrientation) {\n          self.graphDim.width = Math.max(self.graphDim.width, w(d, true));\n          return 0;\n        } else {\n          return getDomainPosition(d, self.graphDim, 'width', w(d, true));\n        }\n      })\n      .attr('y', function (d) {\n        if (options.verticalOrientation) {\n          return getDomainPosition(d, self.graphDim, 'height', h(d, true));\n        } else {\n          self.graphDim.height = Math.max(self.graphDim.height, h(d, true));\n          return 0;\n        }\n      })\n      .attr('class', function (d) {\n        var classname = 'graph-domain';\n        var date = new Date(d);\n        switch (options.domain) {\n          case 'hour':\n            classname += ' h_' + date.getHours();\n          /* falls through */\n          case 'day':\n            classname += ' d_' + date.getDate() + ' dy_' + date.getDay();\n          /* falls through */\n          case 'week':\n            classname += ' w_' + self.getWeekNumber(date);\n          /* falls through */\n          case 'month':\n            classname += ' m_' + (date.getMonth() + 1);\n          /* falls through */\n          case 'year':\n            classname += ' y_' + date.getFullYear();\n        }\n        return classname;\n      });\n    self.lastInsertedSvg = svg;\n\n    function getDomainPosition(domainIndex, graphDim, axis, domainDim) {\n      var tmp = 0;\n      switch (navigationDir) {\n        case false:\n          tmp = graphDim[axis];\n\n          graphDim[axis] += domainDim;\n          self.domainPosition.setPosition(domainIndex, tmp);\n          return tmp;\n\n        case self.NAVIGATE_RIGHT:\n          self.domainPosition.setPosition(domainIndex, graphDim[axis]);\n\n          enteringDomainDim = domainDim;\n          exitingDomainDim = self.domainPosition.getPositionFromIndex(1);\n\n          self.domainPosition.shiftRightBy(exitingDomainDim);\n          return graphDim[axis];\n\n        case self.NAVIGATE_LEFT:\n          tmp = -domainDim;\n\n          enteringDomainDim = -tmp;\n          exitingDomainDim = graphDim[axis] - self.domainPosition.getLast();\n\n          self.domainPosition.setPosition(domainIndex, tmp);\n          self.domainPosition.shiftLeftBy(enteringDomainDim);\n          return tmp;\n      }\n    }\n\n    svg\n      .append('rect')\n      .attr('width', function (d) {\n        return w(d, true) - options.domainGutter - options.cellPadding;\n      })\n      .attr('height', function (d) {\n        return h(d, true) - options.domainGutter - options.cellPadding;\n      })\n      .attr('class', 'domain-background');\n\n    // =========================================================================//\n    // PAINTING SUBDOMAINS                            //\n    // =========================================================================//\n    var subDomainSvgGroup = svg\n      .append('svg')\n      .attr('x', function () {\n        if (options.label.position === 'left') {\n          return self.domainHorizontalLabelWidth + options.domainMargin[3];\n        } else {\n          return options.domainMargin[3];\n        }\n      })\n      .attr('y', function () {\n        if (options.label.position === 'top') {\n          return self.domainVerticalLabelHeight + options.domainMargin[0];\n        } else {\n          return options.domainMargin[0];\n        }\n      })\n      .attr('class', 'graph-subdomain-group');\n    var rect = subDomainSvgGroup\n      .selectAll('g')\n      .data(function (d) {\n        return self._domains.get(d);\n      })\n      .enter()\n      .append('g');\n    rect\n      .append('rect')\n      .attr('class', function (d) {\n        return (\n          'graph-rect' +\n          self.getHighlightClassName(d.t) +\n          (options.onClick !== null ? ' hover_cursor' : '')\n        );\n      })\n      .attr('width', options.cellSize)\n      .attr('height', options.cellSize)\n      .attr('x', function (d) {\n        return self.positionSubDomainX(d.t);\n      })\n      .attr('y', function (d) {\n        return self.positionSubDomainY(d.t);\n      })\n      .on('click', function (d) {\n        if (options.onClick !== null) {\n          return self.onClick(new Date(d.t), d.v);\n        }\n      })\n      .call(function (selection) {\n        if (options.cellRadius > 0) {\n          selection\n            .attr('rx', options.cellRadius)\n            .attr('ry', options.cellRadius);\n        }\n\n        if (\n          self.legendScale !== null &&\n          options.legendColors !== null &&\n          options.legendColors.hasOwnProperty('base')\n        ) {\n          selection.attr('fill', options.legendColors.base);\n        }\n\n        if (options.tooltip) {\n          selection\n            .on('mouseover', function (d) {\n              self.tip.show(d, this);\n            })\n            .on('mouseout', function () {\n              self.tip.hide(d);\n            });\n        }\n      });\n\n    // Appending a title to each subdomain\n    if (!options.tooltip) {\n      rect.append('title').text(function (d) {\n        return self.formatDate(new Date(d.t), options.subDomainDateFormat);\n      });\n    }\n\n    // =========================================================================//\n    // PAINTING LABEL                              //\n    // =========================================================================//\n    if (options.domainLabelFormat !== '') {\n      svg\n        .append('text')\n        .attr('class', 'graph-label')\n        .attr('y', function (d) {\n          var y = options.domainMargin[0];\n          switch (options.label.position) {\n            case 'top':\n              y += self.domainVerticalLabelHeight / 2;\n              break;\n            case 'bottom':\n              y += h(d) + self.domainVerticalLabelHeight / 2;\n          }\n\n          return (\n            y +\n            options.label.offset.y *\n              ((options.label.rotate === 'right' &&\n                options.label.position === 'right') ||\n              (options.label.rotate === 'left' &&\n                options.label.position === 'left')\n                ? -1\n                : 1)\n          );\n        })\n        .attr('x', function (d) {\n          var x = options.domainMargin[3];\n          switch (options.label.position) {\n            case 'right':\n              x += w(d);\n              break;\n            case 'bottom':\n            case 'top':\n              x += w(d) / 2;\n          }\n\n          if (options.label.align === 'right') {\n            return (\n              x +\n              self.domainHorizontalLabelWidth -\n              options.label.offset.x *\n                (options.label.rotate === 'right' ? -1 : 1)\n            );\n          }\n          return x + options.label.offset.x;\n        })\n        .attr('text-anchor', function () {\n          switch (options.label.align) {\n            case 'start':\n            case 'left':\n              return 'start';\n            case 'end':\n            case 'right':\n              return 'end';\n            default:\n              return 'middle';\n          }\n        })\n        .attr('dominant-baseline', function () {\n          return self.verticalDomainLabel ? 'middle' : 'top';\n        })\n        .text(function (d) {\n          return self.formatDate(new Date(d), options.domainLabelFormat);\n        })\n        .call(domainRotate);\n    }\n\n    function domainRotate(selection) {\n      switch (options.label.rotate) {\n        case 'right':\n          selection.attr('transform', function (d) {\n            var s = 'rotate(90), ';\n            switch (options.label.position) {\n              case 'right':\n                s += 'translate(-' + w(d) + ' , -' + w(d) + ')';\n                break;\n              case 'left':\n                s += 'translate(0, -' + self.domainHorizontalLabelWidth + ')';\n                break;\n            }\n\n            return s;\n          });\n          break;\n        case 'left':\n          selection.attr('transform', function (d) {\n            var s = 'rotate(270), ';\n            switch (options.label.position) {\n              case 'right':\n                s +=\n                  'translate(-' +\n                  (w(d) + self.domainHorizontalLabelWidth) +\n                  ' , ' +\n                  w(d) +\n                  ')';\n                break;\n              case 'left':\n                s +=\n                  'translate(-' +\n                  self.domainHorizontalLabelWidth +\n                  ' , ' +\n                  self.domainHorizontalLabelWidth +\n                  ')';\n                break;\n            }\n\n            return s;\n          });\n          break;\n      }\n    }\n\n    // =========================================================================//\n    // PAINTING DOMAIN SUBDOMAIN CONTENT                    //\n    // =========================================================================//\n    if (options.subDomainTextFormat !== null) {\n      rect\n        .append('text')\n        .attr('class', function (d) {\n          return 'subdomain-text' + self.getHighlightClassName(d.t);\n        })\n        .attr('x', function (d) {\n          return self.positionSubDomainX(d.t) + options.cellSize / 2;\n        })\n        .attr('y', function (d) {\n          return self.positionSubDomainY(d.t) + options.cellSize / 2;\n        })\n        .attr('text-anchor', 'middle')\n        .attr('dominant-baseline', 'central')\n        .text(function (d) {\n          return self.formatDate(new Date(d.t), options.subDomainTextFormat);\n        });\n    }\n\n    // =========================================================================//\n    // ANIMATION                                //\n    // =========================================================================//\n\n    if (navigationDir !== false) {\n      domainSvg\n        .transition()\n        .duration(options.animationDuration)\n        .attr('x', function (d) {\n          return options.verticalOrientation\n            ? 0\n            : self.domainPosition.getPosition(d);\n        })\n        .attr('y', function (d) {\n          return options.verticalOrientation\n            ? self.domainPosition.getPosition(d)\n            : 0;\n        });\n    }\n\n    var tempWidth = self.graphDim.width;\n    var tempHeight = self.graphDim.height;\n\n    if (options.verticalOrientation) {\n      self.graphDim.height += enteringDomainDim - exitingDomainDim;\n    } else {\n      self.graphDim.width += enteringDomainDim - exitingDomainDim;\n    }\n\n    // At the time of exit, domainsWidth and domainsHeight already automatically shifted\n    domainSvg\n      .exit()\n      .transition()\n      .duration(options.animationDuration)\n      .attr('x', function (d) {\n        if (options.verticalOrientation) {\n          return 0;\n        } else {\n          switch (navigationDir) {\n            case self.NAVIGATE_LEFT:\n              return Math.min(self.graphDim.width, tempWidth);\n            case self.NAVIGATE_RIGHT:\n              return -w(d, true);\n          }\n        }\n      })\n      .attr('y', function (d) {\n        if (options.verticalOrientation) {\n          switch (navigationDir) {\n            case self.NAVIGATE_LEFT:\n              return Math.min(self.graphDim.height, tempHeight);\n            case self.NAVIGATE_RIGHT:\n              return -h(d, true);\n          }\n        } else {\n          return 0;\n        }\n      })\n      .remove();\n\n    // Resize the root container\n    self.resize();\n  };\n};\n\nCalHeatMap.prototype = {\n  /**\n   * Validate and merge user settings with default settings\n   *\n   * @param  {object} settings User settings\n   * @return {bool} False if settings contains error\n   */\n  /* jshint maxstatements:false */\n  init: function (settings) {\n    'use strict';\n\n    var parent = this;\n\n    var options = (parent.options = mergeRecursive(parent.options, settings));\n\n    // Fatal errors\n    // Stop script execution on error\n    validateDomainType();\n    validateSelector(options.itemSelector, false, 'itemSelector');\n\n    if (parent.allowedDataType.indexOf(options.dataType) === -1) {\n      throw new Error(\n        \"The data type '\" + options.dataType + \"' is not valid data type\",\n      );\n    }\n\n    if (d3.select(options.itemSelector)[0][0] === null) {\n      throw new Error(\n        \"The node '\" +\n          options.itemSelector +\n          \"' specified in itemSelector does not exists\",\n      );\n    }\n\n    try {\n      validateSelector(options.nextSelector, true, 'nextSelector');\n      validateSelector(options.previousSelector, true, 'previousSelector');\n    } catch (error) {\n      console.log(error.message);\n      return false;\n    }\n\n    // If other settings contains error, will fallback to default\n\n    if (!settings.hasOwnProperty('subDomain')) {\n      this.options.subDomain = getOptimalSubDomain(settings.domain);\n    }\n\n    if (\n      typeof options.itemNamespace !== 'string' ||\n      options.itemNamespace === ''\n    ) {\n      console.log(\n        'itemNamespace can not be empty, falling back to cal-heatmap',\n      );\n      options.itemNamespace = 'cal-heatmap';\n    }\n\n    // Don't touch these settings\n    var s = [\n      'data',\n      'onComplete',\n      'onClick',\n      'afterLoad',\n      'afterLoadData',\n      'afterLoadPreviousDomain',\n      'afterLoadNextDomain',\n      'afterUpdate',\n    ];\n\n    for (var k in s) {\n      if (settings.hasOwnProperty(s[k])) {\n        options[s[k]] = settings[s[k]];\n      }\n    }\n\n    options.subDomainDateFormat =\n      typeof options.subDomainDateFormat === 'string' ||\n      typeof options.subDomainDateFormat === 'function'\n        ? options.subDomainDateFormat\n        : this._domainType[options.subDomain].format.date;\n    options.domainLabelFormat =\n      typeof options.domainLabelFormat === 'string' ||\n      typeof options.domainLabelFormat === 'function'\n        ? options.domainLabelFormat\n        : this._domainType[options.domain].format.legend;\n    options.subDomainTextFormat =\n      (typeof options.subDomainTextFormat === 'string' &&\n        options.subDomainTextFormat !== '') ||\n      typeof options.subDomainTextFormat === 'function'\n        ? options.subDomainTextFormat\n        : null;\n    options.domainMargin = expandMarginSetting(options.domainMargin);\n    options.legendMargin = expandMarginSetting(options.legendMargin);\n    options.highlight = parent.expandDateSetting(options.highlight);\n    options.itemName = expandItemName(options.itemName);\n    options.colLimit = parseColLimit(options.colLimit);\n    options.rowLimit = parseRowLimit(options.rowLimit);\n    if (!settings.hasOwnProperty('legendMargin')) {\n      autoAddLegendMargin();\n    }\n    autoAlignLabel();\n\n    /**\n     * Validate that a queryString is valid\n     *\n     * @param  {Element|string|bool} selector   The queryString to test\n     * @param  {bool}  canBeFalse  Whether false is an accepted and valid value\n     * @param  {string} name    Name of the tested selector\n     * @throws {Error}        If the selector is not valid\n     * @return {bool}        True if the selector is a valid queryString\n     */\n    function validateSelector(selector, canBeFalse, name) {\n      if (\n        ((canBeFalse && selector === false) ||\n          selector instanceof Element ||\n          typeof selector === 'string') &&\n        selector !== ''\n      ) {\n        return true;\n      }\n      throw new Error('The ' + name + ' is not valid');\n    }\n\n    /**\n     * Return the optimal subDomain for the specified domain\n     *\n     * @param  {string} domain a domain name\n     * @return {string}        the subDomain name\n     */\n    function getOptimalSubDomain(domain) {\n      switch (domain) {\n        case 'year':\n          return 'month';\n        case 'month':\n          return 'day';\n        case 'week':\n          return 'day';\n        case 'day':\n          return 'hour';\n        default:\n          return 'min';\n      }\n    }\n\n    /**\n     * Ensure that the domain and subdomain are valid\n     *\n     * @throw {Error} when domain or subdomain are not valid\n     * @return {bool} True if domain and subdomain are valid and compatible\n     */\n    function validateDomainType() {\n      if (\n        !parent._domainType.hasOwnProperty(options.domain) ||\n        options.domain === 'min' ||\n        options.domain.substring(0, 2) === 'x_'\n      ) {\n        throw new Error(\"The domain '\" + options.domain + \"' is not valid\");\n      }\n\n      if (\n        !parent._domainType.hasOwnProperty(options.subDomain) ||\n        options.subDomain === 'year'\n      ) {\n        throw new Error(\n          \"The subDomain '\" + options.subDomain + \"' is not valid\",\n        );\n      }\n\n      if (\n        parent._domainType[options.domain].level <=\n        parent._domainType[options.subDomain].level\n      ) {\n        throw new Error(\n          \"'\" +\n            options.subDomain +\n            \"' is not a valid subDomain to '\" +\n            options.domain +\n            \"'\",\n        );\n      }\n\n      return true;\n    }\n\n    /**\n     * Fine-tune the label alignement depending on its position\n     *\n     * @return void\n     */\n    function autoAlignLabel() {\n      // Auto-align label, depending on it's position\n      if (\n        !settings.hasOwnProperty('label') ||\n        (settings.hasOwnProperty('label') &&\n          !settings.label.hasOwnProperty('align'))\n      ) {\n        switch (options.label.position) {\n          case 'left':\n            options.label.align = 'right';\n            break;\n          case 'right':\n            options.label.align = 'left';\n            break;\n          default:\n            options.label.align = 'center';\n        }\n\n        if (options.label.rotate === 'left') {\n          options.label.align = 'right';\n        } else if (options.label.rotate === 'right') {\n          options.label.align = 'left';\n        }\n      }\n\n      if (\n        !settings.hasOwnProperty('label') ||\n        (settings.hasOwnProperty('label') &&\n          !settings.label.hasOwnProperty('offset'))\n      ) {\n        if (\n          options.label.position === 'left' ||\n          options.label.position === 'right'\n        ) {\n          options.label.offset = {\n            x: 10,\n            y: 15,\n          };\n        }\n      }\n    }\n\n    /**\n     * If not specified, add some margin around the legend depending on its position\n     *\n     * @return void\n     */\n    function autoAddLegendMargin() {\n      switch (options.legendVerticalPosition) {\n        case 'top':\n          options.legendMargin[2] = parent.DEFAULT_LEGEND_MARGIN;\n          break;\n        case 'bottom':\n          options.legendMargin[0] = parent.DEFAULT_LEGEND_MARGIN;\n          break;\n        case 'middle':\n        case 'center':\n          options.legendMargin[\n            options.legendHorizontalPosition === 'right' ? 3 : 1\n          ] = parent.DEFAULT_LEGEND_MARGIN;\n      }\n    }\n\n    /**\n     * Expand a number of an array of numbers to an usable 4 values array\n     *\n     * @param  {integer|array} value\n     * @return {array}        array\n     */\n    function expandMarginSetting(value) {\n      if (typeof value === 'number') {\n        value = [value];\n      }\n\n      if (!Array.isArray(value)) {\n        console.log('Margin only takes an integer or an array of integers');\n        value = [0];\n      }\n\n      switch (value.length) {\n        case 1:\n          return [value[0], value[0], value[0], value[0]];\n        case 2:\n          return [value[0], value[1], value[0], value[1]];\n        case 3:\n          return [value[0], value[1], value[2], value[1]];\n        case 4:\n          return value;\n        default:\n          return value.slice(0, 4);\n      }\n    }\n\n    /**\n     * Convert a string to an array like [singular-form, plural-form]\n     *\n     * @param  {string|array} value Date to convert\n     * @return {array}       An array like [singular-form, plural-form]\n     */\n    function expandItemName(value) {\n      if (typeof value === 'string') {\n        return [value, value + (value !== '' ? 's' : '')];\n      }\n\n      if (Array.isArray(value)) {\n        if (value.length === 1) {\n          return [value[0], value[0] + 's'];\n        } else if (value.length > 2) {\n          return value.slice(0, 2);\n        }\n\n        return value;\n      }\n\n      return ['item', 'items'];\n    }\n\n    function parseColLimit(value) {\n      return value > 0 ? value : null;\n    }\n\n    function parseRowLimit(value) {\n      if (value > 0 && options.colLimit > 0) {\n        console.log(\n          'colLimit and rowLimit are mutually exclusive, rowLimit will be ignored',\n        );\n        return null;\n      }\n      return value > 0 ? value : null;\n    }\n\n    return this._init();\n  },\n\n  /**\n   * Convert a keyword or an array of keyword/date to an array of date objects\n   *\n   * @param  {string|array|Date} value Data to convert\n   * @return {array}       An array of Dates\n   */\n  expandDateSetting: function (value) {\n    'use strict';\n\n    if (!Array.isArray(value)) {\n      value = [value];\n    }\n\n    return value\n      .map(function (data) {\n        if (data === 'now') {\n          return new Date();\n        }\n        if (data instanceof Date) {\n          return data;\n        }\n        return false;\n      })\n      .filter(function (d) {\n        return d !== false;\n      });\n  },\n\n  /**\n   * Fill the calendar by coloring the cells\n   *\n   * @param array svg An array of html node to apply the transformation to (optional)\n   *                  It's used to limit the painting to only a subset of the calendar\n   * @return void\n   */\n  fill: function (svg) {\n    'use strict';\n\n    var parent = this;\n    var options = parent.options;\n\n    if (arguments.length === 0) {\n      svg = parent.root.selectAll('.graph-domain');\n    }\n\n    var rect = svg\n      .selectAll('svg')\n      .selectAll('g')\n      .data(function (d) {\n        return parent._domains.get(d);\n      });\n    /**\n     * Colorize the cell via a style attribute if enabled\n     */\n    function addStyle(element) {\n      if (parent.legendScale === null) {\n        return false;\n      }\n\n      element.attr('fill', function (d) {\n        if (\n          d.v === null &&\n          options.hasOwnProperty('considerMissingDataAsZero') &&\n          !options.considerMissingDataAsZero\n        ) {\n          if (options.legendColors.hasOwnProperty('base')) {\n            return options.legendColors.base;\n          }\n        }\n\n        if (\n          options.legendColors !== null &&\n          options.legendColors.hasOwnProperty('empty') &&\n          (d.v === 0 ||\n            (d.v === null &&\n              options.hasOwnProperty('considerMissingDataAsZero') &&\n              options.considerMissingDataAsZero))\n        ) {\n          return options.legendColors.empty;\n        }\n\n        if (\n          d.v < 0 &&\n          options.legend[0] > 0 &&\n          options.legendColors !== null &&\n          options.legendColors.hasOwnProperty('overflow')\n        ) {\n          return options.legendColors.overflow;\n        }\n\n        return parent.legendScale(\n          Math.min(d.v, options.legend[options.legend.length - 1]),\n        );\n      });\n    }\n\n    rect\n      .transition()\n      .duration(options.animationDuration)\n      .select('rect')\n      .attr('class', function (d) {\n        var htmlClass = parent.getHighlightClassName(d.t).trim().split(' ');\n        var pastDate = parent.dateIsLessThan(d.t, new Date());\n        var sameDate = parent.dateIsEqual(d.t, new Date());\n\n        if (\n          parent.legendScale === null ||\n          (d.v === null &&\n            options.hasOwnProperty('considerMissingDataAsZero') &&\n            !options.considerMissingDataAsZero &&\n            !options.legendColors.hasOwnProperty('base'))\n        ) {\n          htmlClass.push('graph-rect');\n        }\n\n        if (sameDate) {\n          htmlClass.push('now');\n        } else if (!pastDate) {\n          htmlClass.push('future');\n        }\n\n        if (d.v !== null) {\n          htmlClass.push(\n            parent.Legend.getClass(d.v, parent.legendScale === null),\n          );\n        } else if (options.considerMissingDataAsZero && pastDate) {\n          htmlClass.push(\n            parent.Legend.getClass(0, parent.legendScale === null),\n          );\n        }\n\n        if (options.onClick !== null) {\n          htmlClass.push('hover_cursor');\n        }\n\n        return htmlClass.join(' ');\n      })\n      .call(addStyle);\n\n    rect\n      .transition()\n      .duration(options.animationDuration)\n      .select('title')\n      .text(function (d) {\n        return parent.getSubDomainTitle(d);\n      });\n\n    function formatSubDomainText(element) {\n      if (typeof options.subDomainTextFormat === 'function') {\n        element.text(function (d) {\n          return options.subDomainTextFormat(d.t, d.v);\n        });\n      }\n    }\n\n    /**\n     * Change the subDomainText class if necessary\n     * Also change the text, e.g when text is representing the value\n     * instead of the date\n     */\n    rect\n      .transition()\n      .duration(options.animationDuration)\n      .select('text')\n      .attr('class', function (d) {\n        return 'subdomain-text' + parent.getHighlightClassName(d.t);\n      })\n      .call(formatSubDomainText)\n      .attr('fill', d => {\n        if (!d.v) return '#000';\n        const rgb = parent.legendScale(\n          Math.min(d.v, options.legend[options.legend.length - 1]),\n        );\n        return getContrastingColor(rgb, 135);\n      });\n  },\n\n  /**\n   * Sprintf like function.\n   * Replaces placeholders {0} in string with values from provided object.\n   *\n   * @param string formatted String containing placeholders.\n   * @param object args Object with properties to replace placeholders in string.\n   *\n   * @return String\n   */\n  formatStringWithObject: function (formatted, args) {\n    'use strict';\n    for (var prop in args) {\n      if (args.hasOwnProperty(prop)) {\n        var regexp = new RegExp('\\\\{' + prop + '\\\\}', 'gi');\n        formatted = formatted.replace(regexp, args[prop]);\n      }\n    }\n    return formatted;\n  },\n\n  // =========================================================================//\n  // EVENTS CALLBACK                              //\n  // =========================================================================//\n\n  /**\n   * Helper method for triggering event callback\n   *\n   * @param  string  eventName       Name of the event to trigger\n   * @param  array  successArgs     List of argument to pass to the callback\n   * @param  boolean  skip      Whether to skip the event triggering\n   * @return mixed  True when the triggering was skipped, false on error, else the callback function\n   */\n  triggerEvent: function (eventName, successArgs, skip) {\n    'use strict';\n\n    if ((arguments.length === 3 && skip) || this.options[eventName] === null) {\n      return true;\n    }\n\n    if (typeof this.options[eventName] === 'function') {\n      if (typeof successArgs === 'function') {\n        successArgs = successArgs();\n      }\n      return this.options[eventName].apply(this, successArgs);\n    } else {\n      console.log('Provided callback for ' + eventName + ' is not a function.');\n      return false;\n    }\n  },\n\n  /**\n   * Event triggered on a mouse click on a subDomain cell\n   *\n   * @param  Date    d    Date of the subdomain block\n   * @param  int    itemNb  Number of items in that date\n   */\n  onClick: function (d, itemNb) {\n    'use strict';\n\n    return this.triggerEvent('onClick', [d, itemNb]);\n  },\n\n  /**\n   * Event triggered after drawing the calendar, byt before filling it with data\n   */\n  afterLoad: function () {\n    'use strict';\n\n    return this.triggerEvent('afterLoad');\n  },\n\n  /**\n   * Event triggered after completing drawing and filling the calendar\n   */\n  onComplete: function () {\n    'use strict';\n\n    var response = this.triggerEvent('onComplete', [], this._completed);\n    this._completed = true;\n    return response;\n  },\n\n  /**\n   * Event triggered after shifting the calendar one domain back\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */\n  afterLoadPreviousDomain: function (start) {\n    'use strict';\n\n    var parent = this;\n    return this.triggerEvent('afterLoadPreviousDomain', function () {\n      var subDomain = parent.getSubDomain(start);\n      return [subDomain.shift(), subDomain.pop()];\n    });\n  },\n\n  /**\n   * Event triggered after shifting the calendar one domain above\n   *\n   * @param  Date    start  Domain start date\n   * @param  Date    end    Domain end date\n   */\n  afterLoadNextDomain: function (start) {\n    'use strict';\n\n    var parent = this;\n    return this.triggerEvent('afterLoadNextDomain', function () {\n      var subDomain = parent.getSubDomain(start);\n      return [subDomain.shift(), subDomain.pop()];\n    });\n  },\n\n  /**\n   * Event triggered after loading the leftmost domain allowed by minDate\n   *\n   * @param  boolean  reached True if the leftmost domain was reached\n   */\n  onMinDomainReached: function (reached) {\n    'use strict';\n\n    this._minDomainReached = reached;\n    return this.triggerEvent('onMinDomainReached', [reached]);\n  },\n\n  /**\n   * Event triggered after loading the rightmost domain allowed by maxDate\n   *\n   * @param  boolean  reached True if the rightmost domain was reached\n   */\n  onMaxDomainReached: function (reached) {\n    'use strict';\n\n    this._maxDomainReached = reached;\n    return this.triggerEvent('onMaxDomainReached', [reached]);\n  },\n\n  checkIfMinDomainIsReached: function (date, upperBound) {\n    'use strict';\n\n    if (this.minDomainIsReached(date)) {\n      this.onMinDomainReached(true);\n    }\n\n    if (arguments.length === 2) {\n      if (this._maxDomainReached && !this.maxDomainIsReached(upperBound)) {\n        this.onMaxDomainReached(false);\n      }\n    }\n  },\n\n  checkIfMaxDomainIsReached: function (date, lowerBound) {\n    'use strict';\n\n    if (this.maxDomainIsReached(date)) {\n      this.onMaxDomainReached(true);\n    }\n\n    if (arguments.length === 2) {\n      if (this._minDomainReached && !this.minDomainIsReached(lowerBound)) {\n        this.onMinDomainReached(false);\n      }\n    }\n  },\n\n  afterUpdate: function () {\n    'use strict';\n\n    return this.triggerEvent('afterUpdate');\n  },\n\n  // =========================================================================//\n  // FORMATTER                                //\n  // =========================================================================//\n\n  formatNumber: d3.format(',g'),\n\n  formatDate: function (d, format) {\n    'use strict';\n\n    if (arguments.length < 2) {\n      format = 'title';\n    }\n\n    if (typeof format === 'function') {\n      return format(d);\n    } else {\n      var f = d3.time.format(format);\n      return f(d);\n    }\n  },\n\n  getSubDomainTitle: function (d) {\n    'use strict';\n\n    if (d.v === null && !this.options.considerMissingDataAsZero) {\n      return this.formatStringWithObject(\n        this.options.subDomainTitleFormat.empty,\n        {\n          date: this.formatDate(\n            new Date(d.t),\n            this.options.subDomainDateFormat,\n          ),\n        },\n      );\n    } else {\n      var value = d.v;\n      // Consider null as 0\n      if (value === null && this.options.considerMissingDataAsZero) {\n        value = 0;\n      }\n\n      return this.formatStringWithObject(\n        this.options.subDomainTitleFormat.filled,\n        {\n          count: this.formatNumber(value),\n          name: this.options.itemName[value !== 1 ? 1 : 0],\n          connector: this._domainType[this.options.subDomain].format.connector,\n          date: this.formatDate(\n            new Date(d.t),\n            this.options.subDomainDateFormat,\n          ),\n        },\n      );\n    }\n  },\n\n  // =========================================================================//\n  // DOMAIN NAVIGATION                            //\n  // =========================================================================//\n\n  /**\n   * Shift the calendar one domain forward\n   *\n   * The new domain is loaded only if it's not beyond maxDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the next domain was loaded, else false\n   */\n  loadNextDomain: function (n) {\n    'use strict';\n\n    if (this._maxDomainReached || n === 0) {\n      return false;\n    }\n\n    var bound = this.loadNewDomains(\n      this.NAVIGATE_RIGHT,\n      this.getDomain(this.getNextDomain(), n),\n    );\n\n    this.afterLoadNextDomain(bound.end);\n    this.checkIfMaxDomainIsReached(this.getNextDomain().getTime(), bound.start);\n\n    return true;\n  },\n\n  /**\n   * Shift the calendar one domain backward\n   *\n   * The previous domain is loaded only if it's not beyond the minDate\n   *\n   * @param int n Number of domains to load\n   * @return bool True if the previous domain was loaded, else false\n   */\n  loadPreviousDomain: function (n) {\n    'use strict';\n\n    if (this._minDomainReached || n === 0) {\n      return false;\n    }\n\n    var bound = this.loadNewDomains(\n      this.NAVIGATE_LEFT,\n      this.getDomain(this.getDomainKeys()[0], -n).reverse(),\n    );\n\n    this.afterLoadPreviousDomain(bound.start);\n    this.checkIfMinDomainIsReached(bound.start, bound.end);\n\n    return true;\n  },\n\n  loadNewDomains: function (direction, newDomains) {\n    'use strict';\n\n    var parent = this;\n    var backward = direction === this.NAVIGATE_LEFT;\n    var i = -1;\n    var total = newDomains.length;\n    var domains = this.getDomainKeys();\n\n    function buildSubDomain(d) {\n      return {\n        t: parent._domainType[parent.options.subDomain].extractUnit(d),\n        v: null,\n      };\n    }\n\n    // Remove out of bound domains from list of new domains to prepend\n    while (++i < total) {\n      if (backward && this.minDomainIsReached(newDomains[i])) {\n        newDomains = newDomains.slice(0, i + 1);\n        break;\n      }\n      if (!backward && this.maxDomainIsReached(newDomains[i])) {\n        newDomains = newDomains.slice(0, i);\n        break;\n      }\n    }\n\n    newDomains = newDomains.slice(-this.options.range);\n\n    for (i = 0, total = newDomains.length; i < total; i += 1) {\n      this._domains.set(\n        newDomains[i].getTime(),\n        this.getSubDomain(newDomains[i]).map(buildSubDomain),\n      );\n\n      this._domains.remove(backward ? domains.pop() : domains.shift());\n    }\n\n    domains = this.getDomainKeys();\n\n    if (backward) {\n      newDomains = newDomains.reverse();\n    }\n\n    this.paint(direction);\n\n    this.getDatas(\n      this.options.data,\n      newDomains[0],\n      this.getSubDomain(newDomains[newDomains.length - 1]).pop(),\n      function () {\n        parent.fill(parent.lastInsertedSvg);\n      },\n    );\n\n    return {\n      start: newDomains[backward ? 0 : 1],\n      end: domains[domains.length - 1],\n    };\n  },\n\n  /**\n   * Return whether a date is inside the scope determined by maxDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar upper bound\n   */\n  maxDomainIsReached: function (datetimestamp) {\n    'use strict';\n\n    return (\n      this.options.maxDate !== null &&\n      this.options.maxDate.getTime() < datetimestamp\n    );\n  },\n\n  /**\n   * Return whether a date is inside the scope determined by minDate\n   *\n   * @param int datetimestamp The timestamp in ms to test\n   * @return bool True if the specified date correspond to the calendar lower bound\n   */\n  minDomainIsReached: function (datetimestamp) {\n    'use strict';\n\n    return (\n      this.options.minDate !== null &&\n      this.options.minDate.getTime() >= datetimestamp\n    );\n  },\n\n  /**\n   * Return the list of the calendar's domain timestamp\n   *\n   * @return Array a sorted array of timestamp\n   */\n  getDomainKeys: function () {\n    'use strict';\n\n    return this._domains\n      .keys()\n      .map(function (d) {\n        return parseInt(d, 10);\n      })\n      .sort(function (a, b) {\n        return a - b;\n      });\n  },\n\n  // =========================================================================//\n  // POSITIONNING                                //\n  // =========================================================================//\n\n  positionSubDomainX: function (d) {\n    'use strict';\n\n    var index = this._domainType[this.options.subDomain].position.x(\n      new Date(d),\n    );\n    return index * this.options.cellSize + index * this.options.cellPadding;\n  },\n\n  positionSubDomainY: function (d) {\n    'use strict';\n\n    var index = this._domainType[this.options.subDomain].position.y(\n      new Date(d),\n    );\n    return index * this.options.cellSize + index * this.options.cellPadding;\n  },\n\n  getSubDomainColumnNumber: function (d) {\n    'use strict';\n\n    if (this.options.rowLimit > 0) {\n      var i = this._domainType[this.options.subDomain].maxItemNumber;\n      if (typeof i === 'function') {\n        i = i(d);\n      }\n      return Math.ceil(i / this.options.rowLimit);\n    }\n\n    var j = this._domainType[this.options.subDomain].defaultColumnNumber;\n    if (typeof j === 'function') {\n      j = j(d);\n    }\n    return this.options.colLimit || j;\n  },\n\n  getSubDomainRowNumber: function (d) {\n    'use strict';\n\n    if (this.options.colLimit > 0) {\n      var i = this._domainType[this.options.subDomain].maxItemNumber;\n      if (typeof i === 'function') {\n        i = i(d);\n      }\n      return Math.ceil(i / this.options.colLimit);\n    }\n\n    var j = this._domainType[this.options.subDomain].defaultRowNumber;\n    if (typeof j === 'function') {\n      j = j(d);\n    }\n    return this.options.rowLimit || j;\n  },\n\n  /**\n   * Return a classname if the specified date should be highlighted\n   *\n   * @param  timestamp date Date of the current subDomain\n   * @return String the highlight class\n   */\n  getHighlightClassName: function (d) {\n    'use strict';\n\n    d = new Date(d);\n\n    if (this.options.highlight.length > 0) {\n      for (var i in this.options.highlight) {\n        if (this.dateIsEqual(this.options.highlight[i], d)) {\n          return this.isNow(this.options.highlight[i])\n            ? ' highlight-now'\n            : ' highlight';\n        }\n      }\n    }\n    return '';\n  },\n\n  /**\n   * Return whether the specified date is now,\n   * according to the type of subdomain\n   *\n   * @param  Date d The date to compare\n   * @return bool True if the date correspond to a subdomain cell\n   */\n  isNow: function (d) {\n    'use strict';\n\n    return this.dateIsEqual(d, new Date());\n  },\n\n  /**\n   * Return whether 2 dates are equals\n   * This function is subdomain-aware,\n   * and dates comparison are dependent of the subdomain\n   *\n   * @param  Date dateA First date to compare\n   * @param  Date dateB Secon date to compare\n   * @return bool true if the 2 dates are equals\n   */\n  /* jshint maxcomplexity: false */\n  dateIsEqual: function (dateA, dateB) {\n    'use strict';\n\n    if (!(dateA instanceof Date)) {\n      dateA = new Date(dateA);\n    }\n\n    if (!(dateB instanceof Date)) {\n      dateB = new Date(dateB);\n    }\n\n    switch (this.options.subDomain) {\n      case 'x_min':\n      case 'min':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate() &&\n          dateA.getHours() === dateB.getHours() &&\n          dateA.getMinutes() === dateB.getMinutes()\n        );\n      case 'x_hour':\n      case 'hour':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate() &&\n          dateA.getHours() === dateB.getHours()\n        );\n      case 'x_day':\n      case 'day':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth() &&\n          dateA.getDate() === dateB.getDate()\n        );\n      case 'x_week':\n      case 'week':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          this.getWeekNumber(dateA) === this.getWeekNumber(dateB)\n        );\n      case 'x_month':\n      case 'month':\n        return (\n          dateA.getFullYear() === dateB.getFullYear() &&\n          dateA.getMonth() === dateB.getMonth()\n        );\n      default:\n        return false;\n    }\n  },\n\n  /**\n   * Returns wether or not dateA is less than or equal to dateB. This function is subdomain aware.\n   * Performs automatic conversion of values.\n   * @param dateA may be a number or a Date\n   * @param dateB may be a number or a Date\n   * @returns {boolean}\n   */\n  dateIsLessThan: function (dateA, dateB) {\n    'use strict';\n\n    if (!(dateA instanceof Date)) {\n      dateA = new Date(dateA);\n    }\n\n    if (!(dateB instanceof Date)) {\n      dateB = new Date(dateB);\n    }\n\n    function normalizedMillis(date, subdomain) {\n      switch (subdomain) {\n        case 'x_min':\n        case 'min':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n            date.getHours(),\n            date.getMinutes(),\n          ).getTime();\n        case 'x_hour':\n        case 'hour':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n            date.getHours(),\n          ).getTime();\n        case 'x_day':\n        case 'day':\n          return new Date(\n            date.getFullYear(),\n            date.getMonth(),\n            date.getDate(),\n          ).getTime();\n        case 'x_week':\n        case 'week':\n        case 'x_month':\n        case 'month':\n          return new Date(date.getFullYear(), date.getMonth()).getTime();\n        default:\n          return date.getTime();\n      }\n    }\n\n    return (\n      normalizedMillis(dateA, this.options.subDomain) <\n      normalizedMillis(dateB, this.options.subDomain)\n    );\n  },\n\n  // =========================================================================//\n  // DATE COMPUTATION                              //\n  // =========================================================================//\n\n  /**\n   * Return the day of the year for the date\n   * @param  Date\n   * @return  int Day of the year [1,366]\n   */\n  getDayOfYear: d3.time.format('%j'),\n\n  /**\n   * Return the week number of the year\n   * Monday as the first day of the week\n   * @return int  Week number [0-53]\n   */\n  getWeekNumber: function (d) {\n    'use strict';\n\n    var f =\n      this.options.weekStartOnMonday === true\n        ? d3.time.format('%W')\n        : d3.time.format('%U');\n    return f(d);\n  },\n\n  /**\n   * Return the week number, relative to its month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Week number, relative to the month [0-5]\n   */\n  getMonthWeekNumber: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n\n    var monthFirstWeekNumber = this.getWeekNumber(\n      new Date(d.getFullYear(), d.getMonth()),\n    );\n    return this.getWeekNumber(d) - monthFirstWeekNumber - 1;\n  },\n\n  /**\n   * Return the number of weeks in the dates' year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of weeks in the date's year\n   */\n  getWeekNumberInYear: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n  },\n\n  /**\n   * Return the number of days in the date's month\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date's month\n   */\n  getDayCountInMonth: function (d) {\n    'use strict';\n\n    return this.getEndOfMonth(d).getDate();\n  },\n\n  /**\n   * Return the number of days in the date's year\n   *\n   * @param  int|Date d Date or timestamp in milliseconds\n   * @return int Number of days in the date's year\n   */\n  getDayCountInYear: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n    return new Date(d.getFullYear(), 1, 29).getMonth() === 1 ? 366 : 365;\n  },\n\n  /**\n   * Get the weekday from a date\n   *\n   * Return the week day number (0-6) of a date,\n   * depending on whether the week start on monday or sunday\n   *\n   * @param  Date d\n   * @return int The week day number (0-6)\n   */\n  getWeekDay: function (d) {\n    'use strict';\n\n    if (this.options.weekStartOnMonday === false) {\n      return d.getDay();\n    }\n    return d.getDay() === 0 ? 6 : d.getDay() - 1;\n  },\n\n  /**\n   * Get the last day of the month\n   * @param  Date|int  d  Date or timestamp in milliseconds\n   * @return Date      Last day of the month\n   */\n  getEndOfMonth: function (d) {\n    'use strict';\n\n    if (typeof d === 'number') {\n      d = new Date(d);\n    }\n    return new Date(d.getFullYear(), d.getMonth() + 1, 0);\n  },\n\n  /**\n   *\n   * @param  Date date\n   * @param  int count\n   * @param  string step\n   * @return Date\n   */\n  jumpDate: function (date, count, step) {\n    'use strict';\n\n    var d = new Date(date);\n    switch (step) {\n      case 'hour':\n        d.setHours(d.getHours() + count);\n        break;\n      case 'day':\n        d.setHours(d.getHours() + count * 24);\n        break;\n      case 'week':\n        d.setHours(d.getHours() + count * 24 * 7);\n        break;\n      case 'month':\n        d.setMonth(d.getMonth() + count);\n        break;\n      case 'year':\n        d.setFullYear(d.getFullYear() + count);\n    }\n\n    return new Date(d);\n  },\n\n  // =========================================================================//\n  // DOMAIN COMPUTATION                            //\n  // =========================================================================//\n\n  /**\n   * Return all the minutes between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of minutes\n   */\n  getMinuteDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(\n      d.getFullYear(),\n      d.getMonth(),\n      d.getDate(),\n      d.getHours(),\n    );\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(\n        range.getFullYear(),\n        range.getMonth(),\n        range.getDate(),\n        range.getHours(),\n      );\n    } else {\n      stop = new Date(+start + range * 1000 * 60);\n    }\n    return d3.time.minutes(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the hours between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of hours in the range, or a stop date\n   * @return array  An array of hours\n   */\n  getHourDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(\n      d.getFullYear(),\n      d.getMonth(),\n      d.getDate(),\n      d.getHours(),\n    );\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(\n        range.getFullYear(),\n        range.getMonth(),\n        range.getDate(),\n        range.getHours(),\n      );\n    } else {\n      stop = new Date(start);\n      stop.setHours(stop.getHours() + range);\n    }\n\n    var domains = d3.time.hours(Math.min(start, stop), Math.max(start, stop));\n\n    // Passing from DST to standard time\n    // If there are 25 hours, let's compress the duplicate hours\n    var i = 0;\n    var total = domains.length;\n    for (i = 0; i < total; i += 1) {\n      if (i > 0 && domains[i].getHours() === domains[i - 1].getHours()) {\n        this.DSTDomain.push(domains[i].getTime());\n        domains.splice(i, 1);\n        break;\n      }\n    }\n\n    // d3.time.hours is returning more hours than needed when changing\n    // from DST to standard time, because there is really 2 hours between\n    // 1am and 2am!\n    if (typeof range === 'number' && domains.length > Math.abs(range)) {\n      domains.splice(domains.length - 1, 1);\n    }\n\n    return domains;\n  },\n\n  /**\n   * Return all the days between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of days in the range, or a stop date\n   * @return array  An array of weeks\n   */\n  getDayDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), range.getMonth(), range.getDate());\n    } else {\n      stop = new Date(start);\n      stop = new Date(stop.setDate(stop.getDate() + parseInt(range, 10)));\n    }\n\n    return d3.time.days(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the weeks between 2 dates\n   *\n   * @param  Date  d  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of weeks\n   */\n  getWeekDomain: function (d, range) {\n    'use strict';\n\n    var weekStart;\n\n    if (this.options.weekStartOnMonday === false) {\n      weekStart = new Date(\n        d.getFullYear(),\n        d.getMonth(),\n        d.getDate() - d.getDay(),\n      );\n    } else {\n      if (d.getDay() === 1) {\n        weekStart = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n      } else if (d.getDay() === 0) {\n        weekStart = new Date(d.getFullYear(), d.getMonth(), d.getDate());\n        weekStart.setDate(weekStart.getDate() - 6);\n      } else {\n        weekStart = new Date(\n          d.getFullYear(),\n          d.getMonth(),\n          d.getDate() - d.getDay() + 1,\n        );\n      }\n    }\n\n    var endDate = new Date(weekStart);\n\n    var stop = range;\n    if (typeof range !== 'object') {\n      stop = new Date(endDate.setDate(endDate.getDate() + range * 7));\n    }\n\n    return this.options.weekStartOnMonday === true\n      ? d3.time.mondays(Math.min(weekStart, stop), Math.max(weekStart, stop))\n      : d3.time.sundays(Math.min(weekStart, stop), Math.max(weekStart, stop));\n  },\n\n  /**\n   * Return all the months between 2 dates\n   *\n   * @param  Date    d    A date\n   * @param  int|date  range  Number of months in the range, or a stop date\n   * @return array  An array of months\n   */\n  getMonthDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), d.getMonth());\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), range.getMonth());\n    } else {\n      stop = new Date(start);\n      stop = stop.setMonth(stop.getMonth() + range);\n    }\n\n    return d3.time.months(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Return all the years between 2 dates\n   *\n   * @param  Date  d  date  A date\n   * @param  int|date  range  Number of minutes in the range, or a stop date\n   * @return array  An array of hours\n   */\n  getYearDomain: function (d, range) {\n    'use strict';\n\n    var start = new Date(d.getFullYear(), 0);\n    var stop = null;\n    if (range instanceof Date) {\n      stop = new Date(range.getFullYear(), 0);\n    } else {\n      stop = new Date(d.getFullYear() + range, 0);\n    }\n\n    return d3.time.years(Math.min(start, stop), Math.max(start, stop));\n  },\n\n  /**\n   * Get an array of domain start dates\n   *\n   * @param  int|Date date A random date included in the wanted domain\n   * @param  int|Date range Number of dates to get, or a stop date\n   * @return Array of dates\n   */\n  getDomain: function (date, range) {\n    'use strict';\n\n    if (typeof date === 'number') {\n      date = new Date(date);\n    }\n\n    if (arguments.length < 2) {\n      range = this.options.range;\n    }\n\n    switch (this.options.domain) {\n      case 'hour':\n        var domains = this.getHourDomain(date, range);\n\n        // Case where an hour is missing, when passing from standard time to DST\n        // Missing hour is perfectly acceptabl in subDomain, but not in domains\n        if (typeof range === 'number' && domains.length < range) {\n          if (range > 0) {\n            domains.push(this.getHourDomain(domains[domains.length - 1], 2)[1]);\n          } else {\n            domains.shift(this.getHourDomain(domains[0], -2)[0]);\n          }\n        }\n        return domains;\n      case 'day':\n        return this.getDayDomain(date, range);\n      case 'week':\n        return this.getWeekDomain(date, range);\n      case 'month':\n        return this.getMonthDomain(date, range);\n      case 'year':\n        return this.getYearDomain(date, range);\n    }\n  },\n\n  /* jshint maxcomplexity: false */\n  getSubDomain: function (date) {\n    'use strict';\n\n    if (typeof date === 'number') {\n      date = new Date(date);\n    }\n\n    var parent = this;\n\n    /**\n     * @return int\n     */\n    var computeDaySubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'year':\n          return parent.getDayCountInYear(date);\n        case 'month':\n          return parent.getDayCountInMonth(date);\n        case 'week':\n          return 7;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeMinSubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'hour':\n          return 60;\n        case 'day':\n          return 60 * 24;\n        case 'week':\n          return 60 * 24 * 7;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeHourSubDomainSize = function (date, domain) {\n      switch (domain) {\n        case 'day':\n          return 24;\n        case 'week':\n          return 168;\n        case 'month':\n          return parent.getDayCountInMonth(date) * 24;\n      }\n    };\n\n    /**\n     * @return int\n     */\n    var computeWeekSubDomainSize = function (date, domain) {\n      if (domain === 'month') {\n        var endOfMonth = new Date(date.getFullYear(), date.getMonth() + 1, 0);\n        var endWeekNb = parent.getWeekNumber(endOfMonth);\n        var startWeekNb = parent.getWeekNumber(\n          new Date(date.getFullYear(), date.getMonth()),\n        );\n\n        if (startWeekNb > endWeekNb) {\n          startWeekNb = 0;\n          endWeekNb += 1;\n        }\n\n        return endWeekNb - startWeekNb + 1;\n      } else if (domain === 'year') {\n        return parent.getWeekNumber(new Date(date.getFullYear(), 11, 31));\n      }\n    };\n\n    switch (this.options.subDomain) {\n      case 'x_min':\n      case 'min':\n        return this.getMinuteDomain(\n          date,\n          computeMinSubDomainSize(date, this.options.domain),\n        );\n      case 'x_hour':\n      case 'hour':\n        return this.getHourDomain(\n          date,\n          computeHourSubDomainSize(date, this.options.domain),\n        );\n      case 'x_day':\n      case 'day':\n        return this.getDayDomain(\n          date,\n          computeDaySubDomainSize(date, this.options.domain),\n        );\n      case 'x_week':\n      case 'week':\n        return this.getWeekDomain(\n          date,\n          computeWeekSubDomainSize(date, this.options.domain),\n        );\n      case 'x_month':\n      case 'month':\n        return this.getMonthDomain(date, 12);\n    }\n  },\n\n  /**\n   * Get the n-th next domain after the calendar newest (rightmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */\n  getNextDomain: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.getDomain(\n      this.jumpDate(this.getDomainKeys().pop(), n, this.options.domain),\n      1,\n    )[0];\n  },\n\n  /**\n   * Get the n-th domain before the calendar oldest (leftmost) domain\n   * @param  int n\n   * @return Date The start date of the wanted domain\n   */\n  getPreviousDomain: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.getDomain(\n      this.jumpDate(this.getDomainKeys().shift(), -n, this.options.domain),\n      1,\n    )[0];\n  },\n\n  // =========================================================================//\n  // DATAS                                  //\n  // =========================================================================//\n\n  /**\n   * Fetch and interpret data from the datasource\n   *\n   * @param string|object source\n   * @param Date startDate\n   * @param Date endDate\n   * @param function callback\n   * @param function|boolean afterLoad function used to convert the data into a json object. Use true to use the afterLoad callback\n   * @param updateMode\n   *\n   * @return mixed\n   * - True if there are no data to load\n   * - False if data are loaded asynchronously\n   */\n  getDatas: function (\n    source,\n    startDate,\n    endDate,\n    callback,\n    afterLoad,\n    updateMode,\n  ) {\n    'use strict';\n\n    var self = this;\n    if (arguments.length < 5) {\n      afterLoad = true;\n    }\n    if (arguments.length < 6) {\n      updateMode = this.APPEND_ON_UPDATE;\n    }\n    var _callback = function (error, data) {\n      if (afterLoad !== false) {\n        if (typeof afterLoad === 'function') {\n          data = afterLoad(data);\n        } else if (typeof self.options.afterLoadData === 'function') {\n          data = self.options.afterLoadData(data);\n        } else {\n          console.log('Provided callback for afterLoadData is not a function.');\n        }\n      } else if (\n        self.options.dataType === 'csv' ||\n        self.options.dataType === 'tsv'\n      ) {\n        data = this.interpretCSV(data);\n      }\n      self.parseDatas(data, updateMode, startDate, endDate);\n      if (typeof callback === 'function') {\n        callback();\n      }\n    };\n\n    switch (typeof source) {\n      case 'string':\n        if (source === '') {\n          _callback(null, {});\n          return true;\n        } else {\n          var url = this.parseURI(source, startDate, endDate);\n          var requestType = 'GET';\n          if (self.options.dataPostPayload !== null) {\n            requestType = 'POST';\n          }\n          var payload = null;\n          if (self.options.dataPostPayload !== null) {\n            payload = this.parseURI(\n              self.options.dataPostPayload,\n              startDate,\n              endDate,\n            );\n          }\n\n          var xhr = null;\n          switch (this.options.dataType) {\n            case 'json':\n              xhr = d3.json(url);\n              break;\n            case 'csv':\n              xhr = d3.csv(url);\n              break;\n            case 'tsv':\n              xhr = d3.tsv(url);\n              break;\n            case 'txt':\n              xhr = d3.text(url, 'text/plain');\n              break;\n          }\n\n          // jshint maxdepth:5\n          if (self.options.dataRequestHeaders !== null) {\n            for (var header in self.options.dataRequestHeaders) {\n              if (self.options.dataRequestHeaders.hasOwnProperty(header)) {\n                xhr.header(header, self.options.dataRequestHeaders[header]);\n              }\n            }\n          }\n\n          xhr.send(requestType, payload, _callback);\n        }\n        return false;\n      case 'object':\n        if (source === Object(source)) {\n          _callback(null, source);\n          return false;\n        }\n      /* falls through */\n      default:\n        _callback(null, {});\n        return true;\n    }\n  },\n\n  /**\n   * Populate the calendar internal data\n   *\n   * @param object data\n   * @param constant updateMode\n   * @param Date startDate\n   * @param Date endDate\n   *\n   * @return void\n   */\n  parseDatas: function (data, updateMode, startDate, endDate) {\n    'use strict';\n\n    if (updateMode === this.RESET_ALL_ON_UPDATE) {\n      this._domains.forEach(function (key, value) {\n        value.forEach(function (element, index, array) {\n          array[index].v = null;\n        });\n      });\n    }\n\n    var temp = {};\n\n    var extractTime = function (d) {\n      return d.t;\n    };\n\n    /*jshint forin:false */\n    for (var d in data) {\n      var date = new Date(d * 1000);\n      var domainUnit = this.getDomain(date)[0].getTime();\n      // The current data belongs to a domain that was compressed\n      // Compress the data for the two duplicate hours into the same hour\n      if (this.DSTDomain.indexOf(domainUnit) >= 0) {\n        // Re-assign all data to the first or the second duplicate hours\n        // depending on which is visible\n        if (this._domains.has(domainUnit - 3600 * 1000)) {\n          domainUnit -= 3600 * 1000;\n        }\n      }\n\n      // Skip if data is not relevant to current domain\n      if (\n        isNaN(d) ||\n        !data.hasOwnProperty(d) ||\n        !this._domains.has(domainUnit) ||\n        !(domainUnit >= +startDate && domainUnit < +endDate)\n      ) {\n        continue;\n      }\n\n      var subDomainsData = this._domains.get(domainUnit);\n\n      if (!temp.hasOwnProperty(domainUnit)) {\n        temp[domainUnit] = subDomainsData.map(extractTime);\n      }\n\n      var index = temp[domainUnit].indexOf(\n        this._domainType[this.options.subDomain].extractUnit(date),\n      );\n\n      if (updateMode === this.RESET_SINGLE_ON_UPDATE) {\n        subDomainsData[index].v = data[d];\n      } else {\n        if (!isNaN(subDomainsData[index].v)) {\n          subDomainsData[index].v += data[d];\n        } else {\n          subDomainsData[index].v = data[d];\n        }\n      }\n    }\n  },\n\n  parseURI: function (str, startDate, endDate) {\n    'use strict';\n\n    // Use a timestamp in seconds\n    str = str.replace(/\\{\\{t:start\\}\\}/g, startDate.getTime() / 1000);\n    str = str.replace(/\\{\\{t:end\\}\\}/g, endDate.getTime() / 1000);\n\n    // Use a string date, following the ISO-8601\n    str = str.replace(/\\{\\{d:start\\}\\}/g, startDate.toISOString());\n    str = str.replace(/\\{\\{d:end\\}\\}/g, endDate.toISOString());\n\n    return str;\n  },\n\n  interpretCSV: function (data) {\n    'use strict';\n\n    var d = {};\n    var keys = Object.keys(data[0]);\n    var i, total;\n    for (i = 0, total = data.length; i < total; i += 1) {\n      d[data[i][keys[0]]] = +data[i][keys[1]];\n    }\n    return d;\n  },\n\n  /**\n   * Handle the calendar layout and dimension\n   *\n   * Expand and shrink the container depending on its children dimension\n   * Also rearrange the children position depending on their dimension,\n   * and the legend position\n   *\n   * @return void\n   */\n  resize: function () {\n    'use strict';\n\n    var parent = this;\n    var options = parent.options;\n    var legendWidth = options.displayLegend\n      ? parent.Legend.getDim('width') +\n        options.legendMargin[1] +\n        options.legendMargin[3]\n      : 0;\n    var legendHeight = options.displayLegend\n      ? parent.Legend.getDim('height') +\n        options.legendMargin[0] +\n        options.legendMargin[2]\n      : 0;\n\n    var graphWidth =\n      parent.graphDim.width - options.domainGutter - options.cellPadding;\n    var graphHeight =\n      parent.graphDim.height - options.domainGutter - options.cellPadding;\n\n    this.root\n      .transition()\n      .duration(options.animationDuration)\n      .attr('width', function () {\n        if (\n          options.legendVerticalPosition === 'middle' ||\n          options.legendVerticalPosition === 'center'\n        ) {\n          return graphWidth + legendWidth;\n        }\n        return Math.max(graphWidth, legendWidth);\n      })\n      .attr('height', function () {\n        if (\n          options.legendVerticalPosition === 'middle' ||\n          options.legendVerticalPosition === 'center'\n        ) {\n          return Math.max(graphHeight, legendHeight);\n        }\n        return graphHeight + legendHeight;\n      });\n\n    this.root\n      .select('.graph')\n      .transition()\n      .duration(options.animationDuration)\n      .attr('y', function () {\n        if (options.legendVerticalPosition === 'top') {\n          return legendHeight;\n        }\n        return 0;\n      })\n      .attr('x', function () {\n        if (\n          (options.legendVerticalPosition === 'middle' ||\n            options.legendVerticalPosition === 'center') &&\n          options.legendHorizontalPosition === 'left'\n        ) {\n          return legendWidth;\n        }\n        return 0;\n      });\n  },\n\n  // =========================================================================//\n  // PUBLIC API                                //\n  // =========================================================================//\n\n  /**\n   * Shift the calendar forward\n   */\n  next: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.loadNextDomain(n);\n  },\n\n  /**\n   * Shift the calendar backward\n   */\n  previous: function (n) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      n = 1;\n    }\n    return this.loadPreviousDomain(n);\n  },\n\n  /**\n   * Jump directly to a specific date\n   *\n   * JumpTo will scroll the calendar until the wanted domain with the specified\n   * date is visible. Unless you set reset to true, the wanted domain\n   * will not necessarily be the first (leftmost) domain of the calendar.\n   *\n   * @param Date date Jump to the domain containing that date\n   * @param bool reset Whether the wanted domain should be the first domain of the calendar\n   * @param bool True of the calendar was scrolled\n   */\n  jumpTo: function (date, reset) {\n    'use strict';\n\n    if (arguments.length < 2) {\n      reset = false;\n    }\n    var domains = this.getDomainKeys();\n    var firstDomain = domains[0];\n    var lastDomain = domains[domains.length - 1];\n\n    if (date < firstDomain) {\n      return this.loadPreviousDomain(this.getDomain(firstDomain, date).length);\n    } else {\n      if (reset) {\n        return this.loadNextDomain(this.getDomain(firstDomain, date).length);\n      }\n\n      if (date > lastDomain) {\n        return this.loadNextDomain(this.getDomain(lastDomain, date).length);\n      }\n    }\n\n    return false;\n  },\n\n  /**\n   * Navigate back to the start date\n   *\n   * @since  3.3.8\n   * @return void\n   */\n  rewind: function () {\n    'use strict';\n\n    this.jumpTo(this.options.start, true);\n  },\n\n  /**\n   * Update the calendar with new data\n   *\n   * @param  object|string    dataSource    The calendar's datasource, same type as this.options.data\n   * @param  boolean|function    afterLoad    Whether to execute afterLoad() on the data. Pass directly a function\n   * if you don't want to use the afterLoad() callback\n   */\n  update: function (dataSource, afterLoad, updateMode) {\n    'use strict';\n\n    if (arguments.length === 0) {\n      dataSource = this.options.data;\n    }\n    if (arguments.length < 2) {\n      afterLoad = true;\n    }\n    if (arguments.length < 3) {\n      updateMode = this.RESET_ALL_ON_UPDATE;\n    }\n\n    var domains = this.getDomainKeys();\n    var self = this;\n    this.getDatas(\n      dataSource,\n      new Date(domains[0]),\n      this.getSubDomain(domains[domains.length - 1]).pop(),\n      function () {\n        self.fill();\n        self.afterUpdate();\n      },\n      afterLoad,\n      updateMode,\n    );\n  },\n\n  /**\n   * Set the legend\n   *\n   * @param array legend an array of integer, representing the different threshold value\n   * @param array colorRange an array of 2 hex colors, for the minimum and maximum colors\n   */\n  setLegend: function () {\n    'use strict';\n\n    var oldLegend = this.options.legend.slice(0);\n    if (arguments.length >= 1 && Array.isArray(arguments[0])) {\n      this.options.legend = arguments[0];\n    }\n    if (arguments.length >= 2) {\n      if (Array.isArray(arguments[1]) && arguments[1].length >= 2) {\n        this.options.legendColors = [arguments[1][0], arguments[1][1]];\n      } else {\n        this.options.legendColors = arguments[1];\n      }\n    }\n\n    if (\n      (arguments.length > 0 && !arrayEquals(oldLegend, this.options.legend)) ||\n      arguments.length >= 2\n    ) {\n      this.Legend.buildColors();\n      this.fill();\n    }\n\n    this.Legend.redraw(\n      this.graphDim.width -\n        this.options.domainGutter -\n        this.options.cellPadding,\n    );\n  },\n\n  /**\n   * Remove the legend\n   *\n   * @return bool False if there is no legend to remove\n   */\n  removeLegend: function () {\n    'use strict';\n\n    if (!this.options.displayLegend) {\n      return false;\n    }\n    this.options.displayLegend = false;\n    this.Legend.remove();\n    return true;\n  },\n\n  /**\n   * Display the legend\n   *\n   * @return bool False if the legend was already displayed\n   */\n  showLegend: function () {\n    'use strict';\n\n    if (this.options.displayLegend) {\n      return false;\n    }\n    this.options.displayLegend = true;\n    this.Legend.redraw(\n      this.graphDim.width -\n        this.options.domainGutter -\n        this.options.cellPadding,\n    );\n    return true;\n  },\n\n  /**\n   * Highlight dates\n   *\n   * Add a highlight class to a set of dates\n   *\n   * @since  3.3.5\n   * @param  array Array of dates to highlight\n   * @return bool True if dates were highlighted\n   */\n  highlight: function (args) {\n    'use strict';\n\n    if ((this.options.highlight = this.expandDateSetting(args)).length > 0) {\n      this.fill();\n      return true;\n    }\n    return false;\n  },\n\n  /**\n   * Destroy the calendar\n   *\n   * Usage: cal = cal.destroy();\n   *\n   * @since  3.3.6\n   * @param function A callback function to trigger after destroying the calendar\n   * @return null\n   */\n  destroy: function (callback) {\n    'use strict';\n\n    this.root\n      .transition()\n      .duration(this.options.animationDuration)\n      .attr('width', 0)\n      .attr('height', 0)\n      .remove()\n      .each('end', function () {\n        if (typeof callback === 'function') {\n          callback();\n        } else if (typeof callback !== 'undefined') {\n          console.log('Provided callback for destroy() is not a function.');\n        }\n      });\n\n    return null;\n  },\n\n  getSVG: function () {\n    'use strict';\n\n    var styles = {\n      '.cal-heatmap-container': {},\n      '.graph': {},\n      '.graph-rect': {},\n      'rect.highlight': {},\n      'rect.now': {},\n      'rect.highlight-now': {},\n      'text.highlight': {},\n      'text.now': {},\n      'text.highlight-now': {},\n      '.domain-background': {},\n      '.graph-label': {},\n      '.subdomain-text': {},\n      '.q0': {},\n      '.qi': {},\n    };\n\n    for (\n      var j = 1, total = this.options.legend.length + 1;\n      j <= total;\n      j += 1\n    ) {\n      styles['.q' + j] = {};\n    }\n\n    var root = this.root;\n\n    var whitelistStyles = [\n      // SVG specific properties\n      'stroke',\n      'stroke-width',\n      'stroke-opacity',\n      'stroke-dasharray',\n      'stroke-dashoffset',\n      'stroke-linecap',\n      'stroke-miterlimit',\n      'fill',\n      'fill-opacity',\n      'fill-rule',\n      'marker',\n      'marker-start',\n      'marker-mid',\n      'marker-end',\n      'alignement-baseline',\n      'baseline-shift',\n      'dominant-baseline',\n      'glyph-orientation-horizontal',\n      'glyph-orientation-vertical',\n      'kerning',\n      'text-anchor',\n      'shape-rendering',\n\n      // Text Specific properties\n      'text-transform',\n      'font-family',\n      'font',\n      'font-size',\n      'font-weight',\n    ];\n\n    var filterStyles = function (attribute, property, value) {\n      if (whitelistStyles.indexOf(property) !== -1) {\n        styles[attribute][property] = value;\n      }\n    };\n\n    var getElement = function (e) {\n      return root.select(e)[0][0];\n    };\n\n    /* jshint forin:false */\n    for (var element in styles) {\n      if (!styles.hasOwnProperty(element)) {\n        continue;\n      }\n\n      var dom = getElement(element);\n\n      if (dom === null) {\n        continue;\n      }\n\n      // The DOM Level 2 CSS way\n      /* jshint maxdepth: false */\n      if ('getComputedStyle' in window) {\n        var cs = getComputedStyle(dom, null);\n        if (cs.length !== 0) {\n          for (var i = 0; i < cs.length; i += 1) {\n            filterStyles(element, cs.item(i), cs.getPropertyValue(cs.item(i)));\n          }\n\n          // Opera workaround. Opera doesn\"t support `item`/`length`\n          // on CSSStyleDeclaration.\n        } else {\n          for (var k in cs) {\n            if (cs.hasOwnProperty(k)) {\n              filterStyles(element, k, cs[k]);\n            }\n          }\n        }\n\n        // The IE way\n      } else if ('currentStyle' in dom) {\n        var css = dom.currentStyle;\n        for (var p in css) {\n          filterStyles(element, p, css[p]);\n        }\n      }\n    }\n\n    var string =\n      '<svg xmlns=\"http://www.w3.org/2000/svg\" ' +\n      'xmlns:xlink=\"http://www.w3.org/1999/xlink\"><style type=\"text/css\"><![CDATA[ ';\n\n    for (var style in styles) {\n      string += style + ' {\\n';\n      for (var l in styles[style]) {\n        string += '\\t' + l + ':' + styles[style][l] + ';\\n';\n      }\n      string += '}\\n';\n    }\n\n    string += ']]></style>';\n    string += new XMLSerializer().serializeToString(this.root[0][0]);\n    string += '</svg>';\n\n    return string;\n  },\n};\n\n// =========================================================================//\n// DOMAIN POSITION COMPUTATION                        //\n// =========================================================================//\n\n/**\n * Compute the position of a domain, relative to the calendar\n */\nvar DomainPosition = function () {\n  'use strict';\n\n  this.positions = d3.map();\n};\n\nDomainPosition.prototype.getPosition = function (d) {\n  'use strict';\n\n  return this.positions.get(d);\n};\n\nDomainPosition.prototype.getPositionFromIndex = function (i) {\n  'use strict';\n\n  var domains = this.getKeys();\n  return this.positions.get(domains[i]);\n};\n\nDomainPosition.prototype.getLast = function () {\n  'use strict';\n\n  var domains = this.getKeys();\n  return this.positions.get(domains[domains.length - 1]);\n};\n\nDomainPosition.prototype.setPosition = function (d, dim) {\n  'use strict';\n\n  this.positions.set(d, dim);\n};\n\nDomainPosition.prototype.shiftRightBy = function (exitingDomainDim) {\n  'use strict';\n\n  this.positions.forEach(function (key, value) {\n    this.set(key, value - exitingDomainDim);\n  });\n\n  var domains = this.getKeys();\n  this.positions.remove(domains[0]);\n};\n\nDomainPosition.prototype.shiftLeftBy = function (enteringDomainDim) {\n  'use strict';\n\n  this.positions.forEach(function (key, value) {\n    this.set(key, value + enteringDomainDim);\n  });\n\n  var domains = this.getKeys();\n  this.positions.remove(domains[domains.length - 1]);\n};\n\nDomainPosition.prototype.getKeys = function () {\n  'use strict';\n\n  return this.positions.keys().sort(function (a, b) {\n    return parseInt(a, 10) - parseInt(b, 10);\n  });\n};\n\n// =========================================================================//\n// LEGEND                                  //\n// =========================================================================//\n\nvar Legend = function (calendar) {\n  'use strict';\n\n  this.calendar = calendar;\n  this.computeDim();\n\n  if (calendar.options.legendColors !== null) {\n    this.buildColors();\n  }\n};\n\nLegend.prototype.computeDim = function () {\n  'use strict';\n\n  var options = this.calendar.options; // Shorter accessor for variable name mangling when minifying\n  this.dim = {\n    width:\n      options.legendCellSize * (options.legend.length + 1) +\n      options.legendCellPadding * options.legend.length,\n    height: options.legendCellSize,\n  };\n};\n\nLegend.prototype.remove = function () {\n  'use strict';\n\n  this.calendar.root.select('.graph-legend').remove();\n  this.calendar.resize();\n};\n\nLegend.prototype.redraw = function (width) {\n  'use strict';\n\n  if (!this.calendar.options.displayLegend) {\n    return false;\n  }\n\n  var parent = this;\n  var calendar = this.calendar;\n  var legend = calendar.root;\n  var legendItem;\n  var options = calendar.options; // Shorter accessor for variable name mangling when minifying\n\n  this.computeDim();\n\n  var _legend = options.legend.slice(0);\n  _legend.push(_legend[_legend.length - 1] + 1);\n\n  var legendElement = calendar.root.select('.graph-legend');\n  if (legendElement[0][0] !== null) {\n    legend = legendElement;\n    legendItem = legend.select('g').selectAll('rect').data(_legend);\n  } else {\n    // Creating the new legend DOM if it doesn't already exist\n    legend =\n      options.legendVerticalPosition === 'top'\n        ? legend.insert('svg', '.graph')\n        : legend.append('svg');\n\n    legend.attr('x', getLegendXPosition()).attr('y', getLegendYPosition());\n\n    legendItem = legend\n      .attr('class', 'graph-legend')\n      .attr('height', parent.getDim('height'))\n      .attr('width', parent.getDim('width'))\n      .append('g')\n      .selectAll()\n      .data(_legend);\n  }\n\n  legendItem\n    .enter()\n    .append('rect')\n    .call(legendCellLayout)\n    .attr('class', function (d) {\n      return calendar.Legend.getClass(d, calendar.legendScale === null);\n    })\n    .attr('fill-opacity', 0)\n    .call(function (selection) {\n      if (\n        calendar.legendScale !== null &&\n        options.legendColors !== null &&\n        options.legendColors.hasOwnProperty('base')\n      ) {\n        selection.attr('fill', options.legendColors.base);\n      }\n    })\n    .append('title');\n\n  legendItem\n    .exit()\n    .transition()\n    .duration(options.animationDuration)\n    .attr('fill-opacity', 0)\n    .remove();\n\n  legendItem\n    .transition()\n    .delay(function (d, i) {\n      return (options.animationDuration * i) / 10;\n    })\n    .call(legendCellLayout)\n    .attr('fill-opacity', 1)\n    .call(function (element) {\n      element.attr('fill', function (d, i) {\n        if (calendar.legendScale === null) {\n          return '';\n        }\n\n        if (i === 0) {\n          return calendar.legendScale(d - 1);\n        }\n        return calendar.legendScale(options.legend[i - 1]);\n      });\n\n      element.attr('class', function (d) {\n        return calendar.Legend.getClass(d, calendar.legendScale === null);\n      });\n    });\n\n  function legendCellLayout(selection) {\n    selection\n      .attr('width', options.legendCellSize)\n      .attr('height', options.legendCellSize)\n      .attr('rx', options.legendCellRadius)\n      .attr('ry', options.legendCellRadius)\n      .attr('x', function (d, i) {\n        return i * (options.legendCellSize + options.legendCellPadding);\n      });\n  }\n\n  legendItem.select('title').text(function (d, i) {\n    if (i === 0) {\n      return calendar.formatStringWithObject(options.legendTitleFormat.lower, {\n        min: options.legend[i],\n        name: options.itemName[1],\n      });\n    } else if (i === _legend.length - 1) {\n      return calendar.formatStringWithObject(options.legendTitleFormat.upper, {\n        max: options.legend[i - 1],\n        name: options.itemName[1],\n      });\n    } else {\n      return calendar.formatStringWithObject(options.legendTitleFormat.inner, {\n        down: options.legend[i - 1],\n        up: options.legend[i],\n        name: options.itemName[1],\n      });\n    }\n  });\n  legendItem\n    .on('mouseover', function (d) {\n      calendar.legendTip.show(d, this);\n    })\n    .on('mouseout', function () {\n      calendar.legendTip.hide();\n    });\n\n  legend\n    .transition()\n    .duration(options.animationDuration)\n    .attr('x', getLegendXPosition())\n    .attr('y', getLegendYPosition())\n    .attr('width', parent.getDim('width'))\n    .attr('height', parent.getDim('height'));\n\n  legend\n    .select('g')\n    .transition()\n    .duration(options.animationDuration)\n    .attr('transform', function () {\n      if (options.legendOrientation === 'vertical') {\n        return (\n          'rotate(90 ' +\n          options.legendCellSize / 2 +\n          ' ' +\n          options.legendCellSize / 2 +\n          ')'\n        );\n      }\n      return '';\n    });\n\n  function getLegendXPosition() {\n    switch (options.legendHorizontalPosition) {\n      case 'right':\n        if (\n          options.legendVerticalPosition === 'center' ||\n          options.legendVerticalPosition === 'middle'\n        ) {\n          return width + options.legendMargin[3];\n        }\n        return width - parent.getDim('width') - options.legendMargin[1];\n      case 'middle':\n      case 'center':\n        return Math.round(width / 2 - parent.getDim('width') / 2);\n      default:\n        return options.legendMargin[3];\n    }\n  }\n\n  function getLegendYPosition() {\n    if (options.legendVerticalPosition === 'bottom') {\n      return (\n        calendar.graphDim.height +\n        options.legendMargin[0] -\n        options.domainGutter -\n        options.cellPadding\n      );\n    }\n    return options.legendMargin[0];\n  }\n\n  calendar.resize();\n};\n\n/**\n * Return the dimension of the legend\n *\n * Takes into account rotation\n *\n * @param  string axis Width or height\n * @return int height or width in pixels\n */\nLegend.prototype.getDim = function (axis) {\n  'use strict';\n\n  var isHorizontal = this.calendar.options.legendOrientation === 'horizontal';\n\n  switch (axis) {\n    case 'width':\n      return this.dim[isHorizontal ? 'width' : 'height'];\n    case 'height':\n      return this.dim[isHorizontal ? 'height' : 'width'];\n  }\n};\n\nLegend.prototype.buildColors = function () {\n  'use strict';\n\n  var options = this.calendar.options; // Shorter accessor for variable name mangling when minifying\n\n  if (options.legendColors === null) {\n    this.calendar.legendScale = null;\n    return false;\n  }\n\n  var _colorRange = [];\n\n  if (Array.isArray(options.legendColors)) {\n    _colorRange = options.legendColors;\n  } else if (\n    options.legendColors.hasOwnProperty('min') &&\n    options.legendColors.hasOwnProperty('max')\n  ) {\n    _colorRange = [options.legendColors.min, options.legendColors.max];\n  } else {\n    options.legendColors = null;\n    return false;\n  }\n\n  var _legend = options.legend.slice(0);\n\n  if (_legend[0] > 0) {\n    _legend.unshift(0);\n  } else if (_legend[0] <= 0) {\n    // Let's guess the leftmost value, it we have to add one\n    _legend.unshift(\n      _legend[0] - (_legend[_legend.length - 1] - _legend[0]) / _legend.length,\n    );\n  }\n  var colorScale;\n  if (options.legendColors.hasOwnProperty('colorScale')) {\n    colorScale = options.legendColors.colorScale;\n  } else {\n    colorScale = d3.scale\n      .linear()\n      .range(_colorRange)\n      .interpolate(d3.interpolateHcl)\n      .domain([d3.min(_legend), d3.max(_legend)]);\n  }\n\n  var legendColors = _legend.map(function (element) {\n    return colorScale(element);\n  });\n  this.calendar.legendScale = d3.scale\n    .threshold()\n    .domain(options.legend)\n    .range(legendColors);\n\n  return true;\n};\n\n/**\n * Return the classname on the legend for the specified value\n *\n * @param integer n Value associated to a date\n * @param bool withCssClass Whether to display the css class used to style the cell.\n *                          Disabling will allow styling directly via html fill attribute\n *\n * @return string Classname according to the legend\n */\nLegend.prototype.getClass = function (n, withCssClass) {\n  'use strict';\n\n  if (n === null || isNaN(n)) {\n    return '';\n  }\n\n  var index = [this.calendar.options.legend.length + 1];\n\n  for (\n    var i = 0, total = this.calendar.options.legend.length - 1;\n    i <= total;\n    i += 1\n  ) {\n    if (this.calendar.options.legend[0] > 0 && n < 0) {\n      index = ['1', 'i'];\n      break;\n    }\n\n    if (n <= this.calendar.options.legend[i]) {\n      index = [i + 1];\n      break;\n    }\n  }\n\n  if (n === 0) {\n    index.push(0);\n  }\n\n  index.unshift('');\n  return (index.join(' r') + (withCssClass ? index.join(' q') : '')).trim();\n};\n\n/**\n * #source http://stackoverflow.com/a/383245/805649\n */\nfunction mergeRecursive(obj1, obj2) {\n  'use strict';\n\n  /*jshint forin:false */\n  for (var p in obj2) {\n    try {\n      // Property in destination object set; update its value.\n      if (obj2[p].constructor === Object) {\n        obj1[p] = mergeRecursive(obj1[p], obj2[p]);\n      } else {\n        obj1[p] = obj2[p];\n      }\n    } catch (e) {\n      // Property in destination object not set; create it and set its value.\n      obj1[p] = obj2[p];\n    }\n  }\n\n  return obj1;\n}\n\n/**\n * Check if 2 arrays are equals\n *\n * @link http://stackoverflow.com/a/14853974/805649\n * @param  array array the array to compare to\n * @return bool true of the 2 arrays are equals\n */\nfunction arrayEquals(arrayA, arrayB) {\n  'use strict';\n\n  // if the other array is a falsy value, return\n  if (!arrayB || !arrayA) {\n    return false;\n  }\n\n  // compare lengths - can save a lot of time\n  if (arrayA.length !== arrayB.length) {\n    return false;\n  }\n\n  for (var i = 0; i < arrayA.length; i += 1) {\n    // Check if we have nested arrays\n    if (arrayA[i] instanceof Array && arrayB[i] instanceof Array) {\n      // recurse into the nested arrays\n      if (!arrayEquals(arrayA[i], arrayB[i])) {\n        return false;\n      }\n    } else if (arrayA[i] !== arrayB[i]) {\n      // Warning - two different object instances will never be equal: {x:20} != {x:20}\n      return false;\n    }\n  }\n  return true;\n}\n\nexport default CalHeatMap;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport { extent as d3Extent, range as d3Range } from 'd3-array';\nimport { select as d3Select } from 'd3-selection';\nimport { getSequentialSchemeRegistry, t } from '@superset-ui/core';\nimport CalHeatMap from './vendor/cal-heatmap';\n\nconst propTypes = {\n  data: PropTypes.shape({\n    // Object hashed by metric name,\n    // then hashed by timestamp (in seconds, not milliseconds) as float\n    // the innermost value is count\n    // e.g. { count_distinct_something: { 1535034236.0: 3 } }\n    data: PropTypes.object,\n    domain: PropTypes.string,\n    range: PropTypes.number,\n    // timestamp in milliseconds\n    start: PropTypes.number,\n    subdomain: PropTypes.string,\n  }),\n  height: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellPadding: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellRadius: PropTypes.number,\n  // eslint-disable-next-line react/sort-prop-types\n  cellSize: PropTypes.number,\n  linearColorScheme: PropTypes.string,\n  showLegend: PropTypes.bool,\n  showMetricName: PropTypes.bool,\n  showValues: PropTypes.bool,\n  steps: PropTypes.number,\n  timeFormatter: PropTypes.func,\n  valueFormatter: PropTypes.func,\n  verboseMap: PropTypes.object,\n  theme: PropTypes.object,\n};\n\nfunction Calendar(element, props) {\n  const {\n    data,\n    height,\n    cellPadding = 3,\n    cellRadius = 0,\n    cellSize = 10,\n    domainGranularity,\n    linearColorScheme,\n    showLegend,\n    showMetricName,\n    showValues,\n    steps,\n    subdomainGranularity,\n    timeFormatter,\n    valueFormatter,\n    verboseMap,\n    theme,\n  } = props;\n\n  const container = d3Select(element)\n    .classed('superset-legacy-chart-calendar', true)\n    .style('height', height);\n  container.selectAll('*').remove();\n  const div = container.append('div');\n\n  const subDomainTextFormat = showValues\n    ? (date, value) => valueFormatter(value)\n    : null;\n\n  const metricsData = data.data;\n\n  const METRIC_TEXT = t('Metric');\n\n  Object.keys(metricsData).forEach(metric => {\n    const calContainer = div.append('div');\n    if (showMetricName) {\n      calContainer.text(`${METRIC_TEXT}: ${verboseMap[metric] || metric}`);\n    }\n    const timestamps = metricsData[metric];\n    const extents = d3Extent(Object.keys(timestamps), key => timestamps[key]);\n    const step = (extents[1] - extents[0]) / (steps - 1);\n    const colorScale = getSequentialSchemeRegistry()\n      .get(linearColorScheme)\n      .createLinearScale(extents);\n\n    const legend = d3Range(steps).map(i => extents[0] + step * i);\n    const legendColors = legend.map(x => colorScale(x));\n\n    const cal = new CalHeatMap();\n    cal.init({\n      start: data.start,\n      data: timestamps,\n      itemSelector: calContainer.node(),\n      legendVerticalPosition: 'top',\n      cellSize,\n      cellPadding,\n      cellRadius,\n      legendCellSize: cellSize,\n      legendCellPadding: 2,\n      legendCellRadius: cellRadius,\n      tooltip: true,\n      domain: domainGranularity,\n      subDomain: subdomainGranularity,\n      range: data.range,\n      browsing: true,\n      legend,\n      legendColors: {\n        colorScale,\n        min: legendColors[0],\n        max: legendColors[legendColors.length - 1],\n        empty: theme.colors.grayscale.light5,\n      },\n      displayLegend: showLegend,\n      itemName: '',\n      valueFormatter,\n      timeFormatter,\n      subDomainTextFormat,\n    });\n  });\n}\n\nCalendar.displayName = 'Calendar';\nCalendar.propTypes = propTypes;\n\nexport default Calendar;\n","export default function(values, valueof) {\n  let min;\n  let max;\n  if (valueof === undefined) {\n    for (const value of values) {\n      if (value != null) {\n        if (min === undefined) {\n          if (value >= value) min = max = value;\n        } else {\n          if (min > value) min = value;\n          if (max < value) max = value;\n        }\n      }\n    }\n  } else {\n    let index = -1;\n    for (let value of values) {\n      if ((value = valueof(value, ++index, values)) != null) {\n        if (min === undefined) {\n          if (value >= value) min = max = value;\n        } else {\n          if (min > value) min = value;\n          if (max < value) max = value;\n        }\n      }\n    }\n  }\n  return [min, max];\n}\n","export default function(start, stop, step) {\n  start = +start, stop = +stop, step = (n = arguments.length) < 2 ? (stop = start, start = 0, 1) : n < 3 ? 1 : +step;\n\n  var i = -1,\n      n = Math.max(0, Math.ceil((stop - start) / step)) | 0,\n      range = new Array(n);\n\n  while (++i < n) {\n    range[i] = start + i * step;\n  }\n\n  return range;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { reactify, styled, css, useTheme } from '@superset-ui/core';\nimport { Global } from '@emotion/react';\nimport Component from './Calendar';\n\nconst ReactComponent = reactify(Component);\n\nconst Calendar = ({ className, ...otherProps }) => {\n  const theme = useTheme();\n  return (\n    <div className={className}>\n      <Global\n        styles={css`\n          .d3-tip {\n            line-height: 1;\n            padding: ${theme.gridUnit * 3}px;\n            background: ${theme.colors.grayscale.dark2};\n            color: ${theme.colors.grayscale.light5};\n            border-radius: 4px;\n            pointer-events: none;\n            z-index: 1000;\n            font-size: ${theme.typography.sizes.s}px;\n          }\n          /* Creates a small triangle extender for the tooltip */\n          .d3-tip:after {\n            box-sizing: border-box;\n            display: inline;\n            font-size: ${theme.typography.sizes.xs};\n            width: 100%;\n            line-height: 1;\n            color: ${theme.colors.grayscale.dark2};\n            position: absolute;\n            pointer-events: none;\n          }\n          /* Northward tooltips */\n          .d3-tip.n:after {\n            content: '\\\\25BC';\n            margin: -${theme.gridUnit}px 0 0 0;\n            top: 100%;\n            left: 0;\n            text-align: center;\n          }\n          /* Eastward tooltips */\n          .d3-tip.e:after {\n            content: '\\\\25C0';\n            margin: -${theme.gridUnit}px 0 0 0;\n            top: 50%;\n            left: -${theme.gridUnit * 2}px;\n          }\n          /* Southward tooltips */\n          .d3-tip.s:after {\n            content: '\\\\25B2';\n            margin: 0;\n            top: -${theme.gridUnit * 2}px;\n            left: 0;\n            text-align: center;\n          }\n          /* Westward tooltips */\n          .d3-tip.w:after {\n            content: '\\\\25B6';\n            margin: -${theme.gridUnit}px 0 0 0px;\n            top: 50%;\n            left: 100%;\n          }\n        `}\n      />\n      <ReactComponent {...otherProps} theme={theme} />\n    </div>\n  );\n};\n\nCalendar.defaultProps = {\n  otherProps: {},\n};\n\nCalendar.propTypes = {\n  className: PropTypes.string.isRequired,\n  otherProps: PropTypes.objectOf(PropTypes.any),\n};\n\nexport default styled(Calendar)`\n  ${({ theme }) => `\n    .superset-legacy-chart-calendar {\n      padding: ${theme.gridUnit * 3}px;\n      position: static !important;\n      overflow: auto !important;\n    }\n\n    .superset-legacy-chart-calendar .ch-tooltip {\n      margin-left: ${theme.gridUnit * 5}px;\n      margin-top: ${theme.gridUnit}px;\n    }\n\n    .superset-legacy-chart-calendar .d3-tip {\n      line-height: 1;\n      padding: ${theme.gridUnit * 3}px;\n      background: ${theme.colors.grayscale.dark2};\n      color: ${theme.colors.grayscale.light5};\n      border-radius: ${theme.borderRadius}px;\n      pointer-events: none;\n      z-index: 1000;\n    }\n\n    .cal-heatmap-container {\n      display: block;\n    }\n\n    .cal-heatmap-container .graph-label {\n      fill: ${theme.colors.grayscale.base};\n      font-size: ${theme.typography.sizes.xs}px;\n    }\n\n    .cal-heatmap-container .graph,\n    .cal-heatmap-container .graph-legend rect {\n      shape-rendering: crispedges;\n    }\n\n    .cal-heatmap-container .graph-rect {\n      fill: ${theme.colors.grayscale.light2};\n    }\n\n    .cal-heatmap-container .graph-subdomain-group rect:hover {\n      stroke: ${theme.colors.grayscale.dark2};\n      stroke-width: 1px;\n    }\n\n    .cal-heatmap-container .subdomain-text {\n      font-size: ${theme.typography.sizes.xs}px;\n      pointer-events: none;\n    }\n\n    .cal-heatmap-container .hover_cursor:hover {\n      cursor: pointer;\n    }\n\n    .cal-heatmap-container .qi {\n      background-color: ${theme.colors.grayscale.base};\n      fill: ${theme.colors.grayscale.base};\n    }\n\n    .cal-heatmap-container .q1 {\n      background-color: ${theme.colors.alert.light2};\n      fill: ${theme.colors.alert.light2};\n    }\n\n    .cal-heatmap-container .q2 {\n      background-color: ${theme.colors.alert.light1};\n      fill: ${theme.colors.alert.light1};\n    }\n\n    .cal-heatmap-container .q3 {\n      background-color: ${theme.colors.success.light1};\n      fill: ${theme.colors.success.light1};\n    }\n\n    .cal-heatmap-container .q4 {\n      background-color: ${theme.colors.success.base};\n      fill: ${theme.colors.success.base};\n    }\n\n    .cal-heatmap-container .q5 {\n      background-color: ${theme.colors.success.dark1};\n      fill: ${theme.colors.success.dark1};\n    }\n\n    .cal-heatmap-container rect.highlight {\n      stroke: ${theme.colors.grayscale.dark1};\n      stroke-width: 1;\n    }\n\n    .cal-heatmap-container text.highlight {\n      fill: ${theme.colors.grayscale.dark1};\n    }\n\n    .cal-heatmap-container rect.highlight-now {\n      stroke: ${theme.colors.error.base};\n    }\n\n    .cal-heatmap-container text.highlight-now {\n      fill: ${theme.colors.error.base};\n      font-weight: ${theme.typography.weights.bold};\n    }\n\n    .cal-heatmap-container .domain-background {\n      fill: none;\n      shape-rendering: crispedges;\n    }\n\n    .ch-tooltip {\n      padding: ${theme.gridUnit * 2}px;\n      background: ${theme.colors.grayscale.dark1};\n      color: ${theme.colors.grayscale.light1};\n      font-size: ${theme.typography.sizes.s}px;\n      line-height: 1.4;\n      width: 140px;\n      position: absolute;\n      z-index: 99999;\n      text-align: center;\n      border-radius: ${theme.borderRadius}px;\n      box-shadow: 2px 2px 2px ${theme.colors.grayscale.dark2};\n      display: none;\n      box-sizing: border-box;\n    }\n\n    .ch-tooltip::after {\n      position: absolute;\n      width: 0;\n      height: 0;\n      border-color: transparent;\n      border-style: solid;\n      content: '';\n      padding: 0;\n      display: block;\n      bottom: -${theme.gridUnit}px;\n      left: 50%;\n      margin-left: -${theme.gridUnit}px;\n      border-width: ${theme.gridUnit}px ${theme.gridUnit}px 0;\n      border-top-color: ${theme.colors.grayscale.dark1};\n    }\n  `}\n`;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\n\n// TODO: Note that id and className can collide between Props and ReactifyProps\n// leading to (likely) unexpected behaviors. We should either require Props to not\n// contain an id/className, or not combine them (via intersection), instead preferring\n// wrapping (composition). As an example:\n// interface MyProps {\n//   id: number;\n// }\n// function myRender(container: HTMLDivElement, props: Readonly<MyProps>): void {\n//   props.id // unusable: id is string & number\n// }\n// new (reactify(myRender))({ id: 5 }); // error: id has to be string & number\n\nexport type ReactifyProps = {\n  id?: string;\n  className?: string;\n};\n\n// TODO: add more React lifecycle callbacks as needed\nexport type LifeCycleCallbacks = {\n  componentWillUnmount?: () => void;\n};\n\nexport interface RenderFuncType<Props> {\n  (container: HTMLDivElement, props: Readonly<Props & ReactifyProps>): void;\n  displayName?: string;\n  defaultProps?: Partial<Props & ReactifyProps>;\n  propTypes?: React.WeakValidationMap<Props & ReactifyProps>;\n}\n\nexport default function reactify<Props extends object>(\n  renderFn: RenderFuncType<Props>,\n  callbacks?: LifeCycleCallbacks,\n): React.ComponentClass<Props & ReactifyProps> {\n  class ReactifiedComponent extends React.Component<Props & ReactifyProps> {\n    container?: HTMLDivElement;\n\n    constructor(props: Props & ReactifyProps) {\n      super(props);\n      this.setContainerRef = this.setContainerRef.bind(this);\n    }\n\n    componentDidMount() {\n      this.execute();\n    }\n\n    componentDidUpdate() {\n      this.execute();\n    }\n\n    componentWillUnmount() {\n      this.container = undefined;\n      if (callbacks?.componentWillUnmount) {\n        callbacks.componentWillUnmount.bind(this)();\n      }\n    }\n\n    setContainerRef(ref: HTMLDivElement) {\n      this.container = ref;\n    }\n\n    execute() {\n      if (this.container) {\n        renderFn(this.container, this.props);\n      }\n    }\n\n    render() {\n      const { id, className } = this.props;\n\n      return <div ref={this.setContainerRef} id={id} className={className} />;\n    }\n  }\n\n  const ReactifiedClass: React.ComponentClass<Props & ReactifyProps> =\n    ReactifiedComponent;\n\n  if (renderFn.displayName) {\n    ReactifiedClass.displayName = renderFn.displayName;\n  }\n  // eslint-disable-next-line react/forbid-foreign-prop-types\n  if (renderFn.propTypes) {\n    ReactifiedClass.propTypes = {\n      ...ReactifiedClass.propTypes,\n      ...renderFn.propTypes,\n    };\n  }\n  if (renderFn.defaultProps) {\n    ReactifiedClass.defaultProps = renderFn.defaultProps;\n  }\n\n  return ReactifiedComponent;\n}\n"],"names":["d3","require","CalHeatMap","self","this","type","tip","d3tip","attr","direction","offset","html","d","options","timeFormatter","t","valueFormatter","v","legendTip","allowedDataType","itemSelector","paintOnLoad","range","cellSize","cellPadding","cellRadius","domainGutter","domainMargin","domain","subDomain","colLimit","rowLimit","weekStartOnMonday","start","Date","minDate","maxDate","data","dataType","dataPostPayload","dataRequestHeaders","considerMissingDataAsZero","loadOnInit","verticalOrientation","domainDynamicDimension","label","position","align","x","y","rotate","width","height","legend","displayLegend","legendCellSize","legendCellPadding","legendMargin","legendVerticalPosition","legendHorizontalPosition","legendOrientation","legendColors","highlight","itemName","domainLabelFormat","subDomainTitleFormat","empty","filled","subDomainDateFormat","subDomainTextFormat","legendTitleFormat","lower","inner","upper","animationDuration","nextSelector","previousSelector","itemNamespace","tooltip","onClick","afterLoad","afterLoadNextDomain","afterLoadPreviousDomain","onComplete","afterLoadData","timestamps","date","jan","getFullYear","jul","Math","max","getTimezoneOffset","stdTimezoneOffset","results","timestamp","value","parseInt","afterUpdate","onMaxDomainReached","onMinDomainReached","_domainType","min","name","level","maxItemNumber","defaultRowNumber","defaultColumnNumber","row","getSubDomainRowNumber","column","getSubDomainColumnNumber","floor","getMinutes","format","connector","extractUnit","getMonth","getDate","getHours","getTime","hour","getDayCountInMonth","getWeekDay","p","day","getDayCountInYear","getWeekNumber","getDayOfYear","week","getMonthWeekNumber","dt","weekDay","getDay","setDate","month","year","hasOwnProperty","w","outer","arguments","length","domainHorizontalLabelWidth","h","domainVerticalLabelHeight","lastInsertedSvg","_completed","_domains","map","graphDim","legendDim","NAVIGATE_LEFT","NAVIGATE_RIGHT","RESET_ALL_ON_UPDATE","RESET_SINGLE_ON_UPDATE","APPEND_ON_UPDATE","DEFAULT_LEGEND_MARGIN","root","_maxDomainReached","_minDomainReached","domainPosition","DomainPosition","Legend","legendScale","DSTDomain","_init","getDomain","set","getSubDomain","select","append","verticalDomainLabel","paint","on","event","preventDefault","loadNextDomain","loadPreviousDomain","redraw","domains","getDomainKeys","getDatas","pop","fill","checkIfMinDomainIsReached","checkIfMaxDomainIsReached","getNextDomain","_initCalendar","call","navigationDir","domainSvg","selectAll","reverse","enteringDomainDim","exitingDomainDim","svg","enter","getDomainPosition","classname","domainIndex","axis","domainDim","tmp","setPosition","getPositionFromIndex","shiftRightBy","getLast","shiftLeftBy","subDomainSvgGroup","rect","get","domainRotate","selection","s","getHighlightClassName","positionSubDomainX","positionSubDomainY","base","show","hide","text","formatDate","transition","duration","getPosition","tempWidth","tempHeight","exit","remove","resize","prototype","init","settings","parent","mergeRecursive","substring","Error","validateDomainType","validateSelector","indexOf","error","console","log","message","getOptimalSubDomain","k","selector","canBeFalse","Element","expandMarginSetting","Array","isArray","slice","expandDateSetting","expandItemName","parseRowLimit","autoAddLegendMargin","autoAlignLabel","filter","addStyle","element","overflow","formatSubDomainText","htmlClass","trim","split","pastDate","dateIsLessThan","sameDate","dateIsEqual","push","getClass","join","getSubDomainTitle","rgb","getContrastingColor","formatStringWithObject","formatted","args","prop","regexp","RegExp","replace","triggerEvent","eventName","successArgs","skip","apply","itemNb","response","shift","reached","upperBound","minDomainIsReached","maxDomainIsReached","lowerBound","formatNumber","f","time","count","n","bound","loadNewDomains","end","newDomains","backward","i","total","buildSubDomain","datetimestamp","keys","sort","a","b","index","ceil","j","isNow","dateA","dateB","normalizedMillis","subdomain","monthFirstWeekNumber","getWeekNumberInYear","getEndOfMonth","jumpDate","step","setHours","setMonth","setFullYear","getMinuteDomain","stop","minutes","getHourDomain","hours","splice","abs","getDayDomain","days","getWeekDomain","weekStart","endDate","mondays","sundays","getMonthDomain","months","getYearDomain","years","computeMinSubDomainSize","computeHourSubDomainSize","computeDaySubDomainSize","endOfMonth","endWeekNb","startWeekNb","computeWeekSubDomainSize","getPreviousDomain","source","startDate","callback","updateMode","_callback","interpretCSV","parseDatas","url","parseURI","requestType","payload","xhr","json","csv","tsv","header","send","Object","forEach","key","array","temp","extractTime","domainUnit","has","isNaN","subDomainsData","str","toISOString","legendWidth","getDim","legendHeight","graphWidth","graphHeight","next","previous","jumpTo","reset","firstDomain","lastDomain","rewind","update","dataSource","setLegend","oldLegend","arrayEquals","buildColors","removeLegend","showLegend","destroy","each","getSVG","styles","e","whitelistStyles","filterStyles","attribute","property","dom","window","cs","getComputedStyle","item","getPropertyValue","css","currentStyle","string","style","l","XMLSerializer","serializeToString","positions","getKeys","dim","calendar","computeDim","obj1","obj2","constructor","arrayA","arrayB","legendItem","_legend","legendElement","legendCellLayout","legendCellRadius","getLegendXPosition","round","getLegendYPosition","insert","delay","down","up","isHorizontal","_colorRange","colorScale","unshift","scale","linear","interpolate","interpolateHcl","threshold","withCssClass","propTypes","PropTypes","linearColorScheme","showMetricName","showValues","steps","verboseMap","theme","Calendar","props","domainGranularity","subdomainGranularity","container","d3Select","classed","div","metricsData","METRIC_TEXT","metric","calContainer","extents","values","valueof","undefined","d3Extent","getSequentialSchemeRegistry","createLinearScale","d3Range","node","browsing","colors","grayscale","light5","displayName","ReactComponent","reactify","Component","className","otherProps","useTheme","gridUnit","dark2","typography","sizes","xs","defaultProps","styled","borderRadius","light2","alert","light1","success","dark1","weights","bold","renderFn","callbacks","ReactifiedComponent","React","super","setContainerRef","bind","componentDidMount","execute","componentDidUpdate","componentWillUnmount","ref","render","id","ReactifiedClass"],"sourceRoot":""}