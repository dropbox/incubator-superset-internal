(window.webpackJsonp=window.webpackJsonp||[]).push([[17,18,19,20,21,22,23,24,25],{1631:function(e,t,n){var i;!function(o,a,r){if(o){for(var s,l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},c={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},u={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},d={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},g=1;g<20;++g)l[111+g]="f"+g;for(g=0;g<=9;++g)l[g+96]=g.toString();y.prototype.bind=function(e,t,n){return e=e instanceof Array?e:[e],this._bindMultiple.call(this,e,t,n),this},y.prototype.unbind=function(e,t){return this.bind.call(this,e,(function(){}),t)},y.prototype.trigger=function(e,t){return this._directMap[e+":"+t]&&this._directMap[e+":"+t]({},e),this},y.prototype.reset=function(){return this._callbacks={},this._directMap={},this},y.prototype.stopCallback=function(e,t){return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&(!function e(t,n){return null!==t&&t!==a&&(t===n||e(t.parentNode,n))}(t,this.target)&&("INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable))},y.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},y.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);s=null},y.init=function(){var e=y(a);for(var t in e)"_"!==t.charAt(0)&&(y[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},y.init(),o.Mousetrap=y,e.exports&&(e.exports=y),void 0===(i=function(){return y}.call(t,n,t,e))||(e.exports=i)}function p(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function f(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return l[e.which]?l[e.which]:c[e.which]?c[e.which]:String.fromCharCode(e.which).toLowerCase()}function h(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function v(e,t,n){return n||(n=function(){if(!s)for(var e in s={},l)e>95&&e<112||l.hasOwnProperty(e)&&(s[l[e]]=e);return s}()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function m(e,t){var n,i,o,a=[];for(n=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),o=0;o<n.length;++o)i=n[o],d[i]&&(i=d[i]),t&&"keypress"!=t&&u[i]&&(i=u[i],a.push("shift")),h(i)&&a.push(i);return{key:i,modifiers:a,action:t=v(i,a,t)}}function y(e){var t=this;if(e=e||a,!(t instanceof y))return new y(e);t.target=e,t._callbacks={},t._directMap={};var n,i={},o=!1,r=!1,s=!1;function l(e){e=e||{};var t,n=!1;for(t in i)e[t]?n=!0:i[t]=0;n||(s=!1)}function c(e,n,o,a,r,s){var l,c,u,d,g=[],p=o.type;if(!t._callbacks[e])return[];for("keyup"==p&&h(e)&&(n=[e]),l=0;l<t._callbacks[e].length;++l)if(c=t._callbacks[e][l],(a||!c.seq||i[c.seq]==c.level)&&p==c.action&&("keypress"==p&&!o.metaKey&&!o.ctrlKey||(u=n,d=c.modifiers,u.sort().join(",")===d.sort().join(",")))){var f=!a&&c.combo==r,v=a&&c.seq==a&&c.level==s;(f||v)&&t._callbacks[e].splice(l,1),g.push(c)}return g}function u(e,n,i,o){t.stopCallback(n,n.target||n.srcElement,i,o)||!1===e(n,i)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(n),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(n))}function d(e){"number"!=typeof e.which&&(e.which=e.keyCode);var n=f(e);n&&("keyup"!=e.type||o!==n?t.handleKey(n,function(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(e),e):o=!1)}function g(e,t,a,r){function c(t){return function(){s=t,++i[e],clearTimeout(n),n=setTimeout(l,1e3)}}function d(t){u(a,t,e),"keyup"!==r&&(o=f(t)),setTimeout(l,10)}i[e]=0;for(var g=0;g<t.length;++g){var p=g+1===t.length?d:c(r||m(t[g+1]).action);v(t[g],p,r,e,g)}}function v(e,n,i,o,a){t._directMap[e+":"+i]=n;var r,s=(e=e.replace(/\s+/g," ")).split(" ");s.length>1?g(e,s,n,i):(r=m(e,i),t._callbacks[r.key]=t._callbacks[r.key]||[],c(r.key,r.modifiers,{type:r.action},o,e,a),t._callbacks[r.key][o?"unshift":"push"]({callback:n,modifiers:r.modifiers,action:r.action,seq:o,level:a,combo:e}))}t._handleKey=function(e,t,n){var i,o=c(e,t,n),a={},d=0,g=!1;for(i=0;i<o.length;++i)o[i].seq&&(d=Math.max(d,o[i].level));for(i=0;i<o.length;++i)if(o[i].seq){if(o[i].level!=d)continue;g=!0,a[o[i].seq]=1,u(o[i].callback,n,o[i].combo,o[i].seq)}else g||u(o[i].callback,n,o[i].combo);var p="keypress"==n.type&&r;n.type!=s||h(e)||p||l(a),r=g&&"keydown"==n.type},t._bindMultiple=function(e,t,n){for(var i=0;i<e.length;++i)v(e[i],t,n)},p(e,"keypress",d),p(e,"keydown",d),p(e,"keyup",d)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},3690:function(e,t,n){"use strict";n.d(t,"a",(function(){return R}));var i=n(1342),o=n(62),a=n(30),r=n(28),s=n(800);function l(e,t){var n=s.c([],t,e);return s.b(n,n,1/n[3]),n}var c=n(143),u=n(203),d=n(1033);function g(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var p=Math.PI,f=p/4,h=p/180,v=180/p;function m(e){return Math.pow(2,e)}function y(e){var t=Object(o.a)(e,2),n=t[0],i=t[1];g(Number.isFinite(n)),g(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var a=i*h;return[512*(n*h+p)/(2*p),512*(p+Math.log(Math.tan(f+.5*a)))/(2*p)]}function x(e){var t=Object(o.a)(e,2),n=t[0],i=t[1],a=n/512*(2*p)-p,r=2*(Math.atan(Math.exp(i/512*(2*p)-p))-f);return[a*v,r*v]}function b(e){var t=e.latitude,n=e.longitude,i=e.highPrecision,o=void 0!==i&&i;g(Number.isFinite(t)&&Number.isFinite(n));var a={},r=Math.cos(t*h),s=512/360/r,l=512/4003e4/r;if(a.unitsPerMeter=[l,l,l],a.metersPerUnit=[1/l,1/l,1/l],a.unitsPerDegree=[512/360,s,l],a.degreesPerUnit=[.703125,1/s,1/l],o){var c=h*Math.tan(t*h)/r,u=512/360*c/2,d=512/4003e4*c,p=d/s*l;a.unitsPerDegree2=[0,u,d],a.unitsPerMeter2=[p,0,p]}return a}function P(e){var t=e.height,n=e.pitch,i=e.bearing,o=e.altitude,a=e.scale,r=e.center,s=void 0===r?null:r,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return c.o(l,l,[0,0,-o]),c.k(l,l,-n*h),c.m(l,l,i*h),a/=t,c.n(l,l,[a,a,a]),s&&c.o(l,l,d.d([],s)),l}function C(e){var t=e.width,n=e.height,i=e.pitch,o=function(e){var t=e.width,n=e.height,i=e.altitude,o=void 0===i?1.5:i,a=e.pitch,r=void 0===a?0:a,s=e.nearZMultiplier,l=void 0===s?1:s,c=e.farZMultiplier,u=void 0===c?1:c,d=r*h,g=Math.atan(.5/o),p=Math.sin(g)*o/Math.sin(Math.min(Math.max(Math.PI/2-d-g,.01),Math.PI-.01));return{fov:2*g,aspect:t/n,focalDistance:o,near:l,far:(Math.sin(d)*p+o)*u}}({width:t,height:n,altitude:e.altitude,pitch:i,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),a=o.fov,r=o.aspect,s=o.near,l=o.far;return c.i([],a,r,s,l)}function w(e,t){var n=Object(o.a)(e,3),i=n[0],a=n[1],r=n[2],s=void 0===r?0:r;return g(Number.isFinite(i)&&Number.isFinite(a)&&Number.isFinite(s)),l(t,[i,a,s,1])}function S(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Object(o.a)(e,3),a=i[0],r=i[1],s=i[2];if(g(Number.isFinite(a)&&Number.isFinite(r),"invalid pixel coordinate"),Number.isFinite(s)){var c=l(t,[a,r,s,1]);return c}var d=l(t,[a,r,0,1]),p=l(t,[a,r,1,1]),f=d[2],h=p[2],v=f===h?0:((n||0)-f)/(h-f);return u.d([],d,p,v)}function _(e){var t=e.width,n=e.height,i=e.bounds,a=e.minExtent,r=void 0===a?0:a,s=e.maxZoom,l=void 0===s?24:s,c=e.padding,u=void 0===c?0:c,d=e.offset,p=void 0===d?[0,0]:d,f=Object(o.a)(i,2),h=Object(o.a)(f[0],2),v=h[0],m=h[1],y=Object(o.a)(f[1],2),x=y[0],b=y[1];if(Number.isFinite(u)){u={top:u,bottom:u,left:u,right:u}}else g(Number.isFinite(u.top)&&Number.isFinite(u.bottom)&&Number.isFinite(u.left)&&Number.isFinite(u.right));var P=new A({width:t,height:n,longitude:0,latitude:0,zoom:0}),C=P.project([v,b]),w=P.project([x,m]),S=[Math.max(Math.abs(w[0]-C[0]),r),Math.max(Math.abs(w[1]-C[1]),r)],_=[t-u.left-u.right-2*Math.abs(p[0]),n-u.top-u.bottom-2*Math.abs(p[1])];g(_[0]>0&&_[1]>0);var M=_[0]/S[0],j=_[1]/S[1],O=(u.right-u.left)/2/M,k=(u.bottom-u.top)/2/j,L=[(w[0]+C[0])/2+O,(w[1]+C[1])/2+k],E=P.unproject(L),F=Math.min(l,P.zoom+Math.log2(Math.abs(Math.min(M,j))));return g(Number.isFinite(F)),{longitude:E[0],latitude:E[1],zoom:F}}var M=Math.PI/180;function j(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=e.width,a=e.height,r=e.unproject,s={targetZ:i},l=r([0,a],s),c=r([o,a],s),u=Math.atan(.5/e.altitude),d=(90-e.pitch)*M;return u>d-.01?(t=O(e,0,i),n=O(e,o,i)):(t=r([0,0],s),n=r([o,0],s)),[l,c,n,t]}function O(e,t,n){var i=e.pixelUnprojectionMatrix,o=l(i,[t,0,1,1]),a=l(i,[t,e.height,1,1]),r=(n*e.distanceScales.unitsPerMeter[2]-o[2])/(a[2]-o[2]),s=x(u.d([],o,a,r));return s[2]=n,s}var A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:1,height:1},n=t.width,i=t.height,o=t.latitude,r=void 0===o?0:o,s=t.longitude,l=void 0===s?0:s,c=t.zoom,u=void 0===c?0:c,d=t.pitch,g=void 0===d?0:d,p=t.bearing,f=void 0===p?0:p,h=t.altitude,v=void 0===h?1.5:h,x=t.nearZMultiplier,w=void 0===x?.02:x,S=t.farZMultiplier,_=void 0===S?1.01:S;Object(a.a)(this,e),n=n||1,i=i||1;var M=m(u);v=Math.max(.75,v);var j=y([l,r]);j[2]=0,this.projectionMatrix=C({width:n,height:i,pitch:g,altitude:v,nearZMultiplier:w,farZMultiplier:_}),this.viewMatrix=P({height:i,scale:M,center:j,pitch:g,bearing:f,altitude:v}),this.width=n,this.height=i,this.scale=M,this.latitude=r,this.longitude=l,this.zoom=u,this.pitch=g,this.bearing=f,this.altitude=v,this.center=j,this.distanceScales=b(this),this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}return Object(r.a)(e,[{key:"_initMatrices",value:function(){var e=this.width,t=this.height,n=this.projectionMatrix,i=this.viewMatrix,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.g(o,o,n),c.g(o,o,i),this.viewProjectionMatrix=o;var a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.n(a,a,[e/2,-t/2,1]),c.o(a,a,[1,-1,0]),c.g(a,a,o);var r=c.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],a);if(!r)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=a,this.pixelUnprojectionMatrix=r}},{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&c.b(t.projectionMatrix,this.projectionMatrix)&&c.b(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,i=void 0===n||n,a=this.projectPosition(e),r=w(a,this.pixelProjectionMatrix),s=Object(o.a)(r,2),l=s[0],c=s[1],u=i?c:this.height-c;return 2===e.length?[l,u]:[l,u,r[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,i=void 0===n||n,a=t.targetZ,r=void 0===a?void 0:a,s=Object(o.a)(e,3),l=s[0],c=s[1],u=s[2],d=i?c:this.height-c,g=r&&r*this.distanceScales.unitsPerMeter[2],p=S([l,d,u],this.pixelUnprojectionMatrix,g),f=this.unprojectPosition(p),h=Object(o.a)(f,3),v=h[0],m=h[1],y=h[2];return Number.isFinite(u)?[v,m,y]:Number.isFinite(r)?[v,m,r]:[v,m]}},{key:"projectPosition",value:function(e){var t=y(e),n=Object(o.a)(t,2);return[n[0],n[1],(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:"unprojectPosition",value:function(e){var t=x(e),n=Object(o.a)(t,2);return[n[0],n[1],(e[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(e){return y(e)}},{key:"unprojectFlat",value:function(e){return x(e)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t=e.lngLat,n=S(e.pos,this.pixelUnprojectionMatrix),i=y(t),o=u.a([],i,u.e([],n));return x(u.a([],this.center,o))}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,o=this.height,a=_(Object.assign({width:i,height:o,bounds:t},n)),r=a.longitude,s=a.latitude,l=a.zoom;return new e({width:i,height:o,longitude:r,latitude:s,zoom:l})}},{key:"getBounds",value:function(e){var t=this.getBoundingRegion(e),n=Math.min.apply(Math,Object(i.a)(t.map((function(e){return e[0]})))),o=Math.max.apply(Math,Object(i.a)(t.map((function(e){return e[0]}))));return[[n,Math.min.apply(Math,Object(i.a)(t.map((function(e){return e[1]}))))],[o,Math.max.apply(Math,Object(i.a)(t.map((function(e){return e[1]}))))]]}},{key:"getBoundingRegion",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return j(this,e.z||0)}}]),e}();var k=n(14);const L=[-90,90],E=[-180,180];function F(e,t,n){let[i,o]=e,[a,r]=t;return void 0===n&&(n=.25),i<o?[i,o]:[Math.max(a,i-n),Math.min(r,o+n)]}function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function R(e,t){let{points:n,width:i,height:o,minExtent:a,maxZoom:r,offset:s,padding:l=20}=t;const{bearing:c,pitch:u}=e,d=function(e){const t=F(Object(k.extent)(e,e=>e[1]),L),n=F(Object(k.extent)(e,e=>e[0]),E);return[[n[0],t[0]],[n[1],t[1]]]}(n);try{return D({},_({bounds:d,width:i,height:o,minExtent:a,maxZoom:r,offset:s,padding:l}),{bearing:c,pitch:u})}catch(e){console.error("Could not fit viewport",e)}return e}},3695:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(13),o=n.n(i);const a=[1,0,1,0,0,0,0];function r(e,t){const n=parseInt(o()(t).format("x"),10);return parseInt(o()(t).add(e).format("x"),10)-n}function s(e,t){const n=o()(Math.min(...e)),i=o()(Math.max(...e));let s,l,c;if(t.includes("/")){const e=t.split("/",2);e[0].endsWith("Z")?(l=o()(e[0]),s=o.a.duration(e[1])):(l=o()(e[1]),s=o.a.duration(e[0]))}else s=o.a.duration(t),l=function(e,t){const n=o()(e).subtract(t),i=e.toArray(),r=n.toArray(),s=i.map((e,t)=>r[t]!==e).indexOf(!0),l=i.map((e,t)=>{if(t===s){const n=e-r[t];return e-(e-a[t])%n}return t<s||-1===s?e:a[t]});return o()(l)}(n,s);const u=n.valueOf();for(c=l.clone();c.valueOf()<u;)c.add(s);for(;c.valueOf()>u;)c.subtract(s);let d;const g=i.valueOf();for(d=l.clone();d.valueOf()>g;)d.subtract(s);for(;d.valueOf()<g;)d.add(s);const p=null!=t?[c,c.clone().add(s)]:[c,d],f=e.every(e=>null===e);return{start:parseInt(c.format("x"),10),end:parseInt(d.format("x"),10),getStep:r.bind(this,s),values:p.map(e=>parseInt(e.format("x"),10)),disabled:f}}},3696:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s}));var i={SUM:1,MEAN:2,MIN:3,MAX:4};function o(e,t){return e+t}function a(e,t){return t>e?t:e}function r(e,t){return t<e?t:e}function s(e,t){switch(i[e.toUpperCase()]||i.SUM){case i.MIN:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(r,1/0):null}(e,t)};case i.SUM:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(o,0):null}(e,t)};case i.MEAN:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(o,0)/n.length:null}(e,t)};case i.MAX:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(a,-1/0):null}(e,t)};default:return null}}},3698:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var i=n(1),o=n.n(i),a=n(0),r=n.n(a),s=n(3697),l=n(1631),c=n.n(l),u=n(3),d=n(2463),g=n.n(d);n(2635),n(3702);function p(e){return o.a.createElement("span",{className:"BootstrapSliderWrapper"},o.a.createElement(g.a,e))}n(3703);const f={start:r.a.number.isRequired,step:r.a.number.isRequired,end:r.a.number.isRequired,values:r.a.array.isRequired,onChange:r.a.func,loopDuration:r.a.number,maxFrames:r.a.number,orientation:r.a.oneOf(["horizontal","vertical"]),reversed:r.a.bool,disabled:r.a.bool,range:r.a.bool};class h extends o.a.PureComponent{constructor(e){super(e),this.state={intervalId:null};const t=e.end-e.start,n=Math.min(e.maxFrames,t/e.step),i=t/n;this.intervalMilliseconds=e.loopDuration/n,this.increment=i<e.step?e.step:i-i%e.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){c.a.bind(["space"],this.play)}componentWillUnmount(){c.a.unbind(["space"])}onChange(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:e,end:t,step:n,values:i,disabled:o}=this.props;if(o)return;const a=(Array.isArray(i)?i:[i,i+n]).map(e=>e+this.increment),r=a[1]>t?a[0]-e:0;this.props.onChange(a.map(e=>e-r))}stepBackward(){const{start:e,end:t,step:n,values:i,disabled:o}=this.props;if(o)return;const a=(Array.isArray(i)?i:[i,i+n]).map(e=>e-this.increment),r=a[0]<e?t-a[1]:0;this.props.onChange(a.map(e=>e+r))}formatter(e){if(this.props.disabled)return Object(u.t)("Data has no time steps");let t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map(e=>new Date(e).toUTCString()).join(" : ")}render(){const{start:e,end:t,step:n,orientation:i,reversed:a,disabled:r,range:s,values:l}=this.props;return o.a.createElement("div",{className:"play-slider"},o.a.createElement("div",{className:"play-slider-controls padded"},o.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),o.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),o.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),o.a.createElement("div",{className:"play-slider-scrobbler padded"},o.a.createElement(p,{value:s?l:l[0],range:s,formatter:this.formatter,change:this.onChange,min:e,max:t,step:n,orientation:i,reversed:a,disabled:r?"disabled":"enabled"})))}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}h.propTypes=f,h.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0};const m={getLayers:r.a.func.isRequired,start:r.a.number.isRequired,end:r.a.number.isRequired,getStep:r.a.func,values:r.a.array.isRequired,aggregation:r.a.bool,disabled:r.a.bool,viewport:r.a.object.isRequired,children:r.a.node,mapStyle:r.a.string,mapboxApiAccessToken:r.a.string.isRequired,setControlValue:r.a.func,onValuesChange:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired};class y extends o.a.PureComponent{constructor(){super(...arguments),v(this,"containerRef",o.a.createRef()),v(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})}render(){const{start:e,end:t,getStep:n,disabled:i,aggregation:a,children:r,getLayers:l,values:c,onValuesChange:u,viewport:d,setControlValue:g,mapStyle:p,mapboxApiAccessToken:f,height:v,width:m}=this.props,y=l(c);return o.a.createElement("div",null,o.a.createElement(s.a,{ref:this.containerRef,viewport:d,layers:y,setControlValue:g,mapStyle:p,mapboxApiAccessToken:f,bottomMargin:i?0:20,width:m,height:v}),!i&&o.a.createElement(h,{start:e,end:t,step:n(e),values:c,range:!a,onChange:u}),r)}}y.propTypes=m,y.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:()=>{},onValuesChange:()=>{}}},3702:function(e,t,n){},3703:function(e,t,n){},3704:function(e,t,n){"use strict";n.d(t,"b",(function(){return _})),n.d(t,"a",(function(){return M}));var i=n(1),o=n.n(i),a=n(0),r=n.n(a),s=n(261),l=n(3697),c=n(72),u=n(3698),d=n(3705),g=n(3709),p=n(3695),f=n(3694),h=n(3690);function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function m(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{getScale:y}=c.CategoricalColorNamespace;const x={formData:r.a.object.isRequired,mapboxApiKey:r.a.string.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,getLayer:r.a.func.isRequired,getPoints:r.a.func.isRequired,payload:r.a.object.isRequired,onAddFilter:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired};class b extends o.a.PureComponent{constructor(e){super(e),m(this,"containerRef",o.a.createRef()),m(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState(v({},this.getStateFromProps(e)))}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const n=e.payload.data.features||[],i=n.map(e=>e.__timestamp),o=function(e,t){const n=e.color_picker||{r:0,g:0,b:0,a:1},i=[n.r,n.g,n.b,255*n.a],o=y(e.color_scheme),a={};return t.forEach(t=>{if(null!=t.cat_color&&!a.hasOwnProperty(t.cat_color)){let r;r=e.dimension?Object(g.hexToRGB)(o(t.cat_color),255*n.a):i,a[t.cat_color]={color:r,enabled:!0}}}),a}(e.formData,n);if(t&&e.payload.form_data===t.formData)return v({},t,{categories:o});const a=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:r,end:s,getStep:l,values:c,disabled:u}=Object(p.a)(i,a),{width:d,height:f,formData:m}=e;let{viewport:x}=e;return m.autozoom&&(x=Object(h.a)(x,{width:d,height:f,points:e.getPoints(n)})),{start:r,end:s,getStep:l,values:c,disabled:u,viewport:x,selected:[],lastClick:0,formData:e.payload.form_data,categories:o}}getLayers(e){const{getLayer:t,payload:n,formData:i,onAddFilter:o}=this.props;let a=n.data.features?[...n.data.features]:[];if(a=this.addColor(a,i),i.js_data_mutator){a=Object(f.a)(i.js_data_mutator)(a)}a=e[0]===e[1]||e[1]===this.end?a.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):a.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]);const r=this.state.categories;return i.dimension&&(a=a.filter(e=>r[e.cat_color]&&r[e.cat_color].enabled)),[t(i,v({},n,{data:v({},n.data,{features:a})}),o,this.setTooltip)]}addColor(e,t){const n=t.color_picker||{r:0,g:0,b:0,a:1},i=y(t.color_scheme);return e.map(e=>{let o;return t.dimension?(o=Object(g.hexToRGB)(i(e.cat_color),255*n.a),v({},e,{color:o})):e})}toggleCategory(e){const t=this.state.categories[e],n=v({},this.state.categories,{[e]:v({},t,{enabled:!t.enabled})});Object.values(n).every(e=>!e.enabled)&&Object.values(n).forEach(e=>{e.enabled=!0}),this.setState({categories:n})}showSingleCategory(e){const t=v({},this.state.categories);Object.values(t).forEach(e=>{e.enabled=!1}),t[e].enabled=!0,this.setState({categories:t})}render(){return o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(u.a,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},o.a.createElement(d.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function P(){return(P=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}b.propTypes=x;const w={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired},S={onAddFilter(){}};function _(e,t){class n extends o.a.PureComponent{constructor(e){super(e),C(this,"containerRef",o.a.createRef()),C(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)});const{width:n,height:i,formData:a}=e;let{viewport:r}=e;a.autozoom&&(r=Object(h.a)(r,{width:n,height:i,points:t(e.payload.data.features)})),this.state={viewport:r,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=P({},e.formData,{viewport:null}),n=P({},this.props.formData,{viewport:null});Object(s.isEqual)(t,n)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(t){const{formData:n,payload:i,onAddFilter:o}=t;return e(n,i,o,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:n,height:i,width:a}=this.props,{layer:r,viewport:s}=this.state;return o.a.createElement(l.a,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:s,layers:[r],mapStyle:e.mapbox_style,setControlValue:n,width:a,height:i,onViewportChange:this.onViewportChange})}}return n.propTypes=w,n.defaultProps=S,n}function M(e,t){function n(n){const{formData:i,payload:a,setControlValue:r,viewport:s,width:l,height:c}=n;return o.a.createElement(b,{formData:i,mapboxApiKey:a.data.mapboxApiKey,setControlValue:r,viewport:s,getLayer:e,payload:a,getPoints:t,width:l,height:c})}return n.propTypes=w,n.defaultProps=S,n}},3705:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(1),o=n.n(i),a=n(0),r=n.n(a),s=n(21);n(3706);const l={categories:r.a.object,toggleCategory:r.a.func,showSingleCategory:r.a.func,format:r.a.string,position:r.a.oneOf([null,"tl","tr","bl","br"])};class c extends o.a.PureComponent{format(e){if(!this.props.format)return e;const t=parseFloat(e);return Object(s.formatNumber)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(" - ")){const t=e.split(" - ");return this.format(t[0])+" - "+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map(e=>{let[t,n]=e;const i={color:"rgba("+n.color.join(", ")+")"},a=n.enabled?"◼":"◻";return o.a.createElement("li",{key:t},o.a.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(t),onDoubleClick:()=>this.props.showSingleCategory(t)},o.a.createElement("span",{style:i},a)," ",this.formatCategoryLabel(t)))}),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return o.a.createElement("div",{className:"legend",style:t},o.a.createElement("ul",{className:"categories"},e))}}c.propTypes=l,c.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:"tr"}},3706:function(e,t,n){},3707:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function o(e,t,n){var i=new t(4*e.length);return e.forEach((function(e,t){var o=4*t;i[o]=e[0],i[o+1]=e[1],i[o+2]=e[2],i[o+3]=Number.isFinite(e[3])?e[3]:n})),i}},3713:function(e,t){},3717:function(e,t,n){"use strict";n.d(t,"a",(function(){return I}));var i,o=n(11),a=n(62),r=n(30),s=n(28),l=n(3943),c=n(3930),u=n(3931),d=n(3859),g=n(3719),p=n(3923),f=n(3818),h=n(3940),v=n(3933),m=n(3691),y=n(60),x=n(3696),b={dataChanged:!0,viewportChanged:!0,cellSizeChanged:!0},P={changeFlags:b,projectPoints:!1,useGPU:!0,fp64:!1,viewport:null,gridTransformMatrix:null,createBufferObjects:!0},C=[32775,32774],w=[32776,32774],S=[32776,32775],_=(i={},Object(o.a)(i,x.a.SUM,32774),Object(o.a)(i,x.a.MEAN,32774),Object(o.a)(i,x.a.MIN,C),Object(o.a)(i,x.a.MAX,w),i),M={size:1,operation:x.a.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},j=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],O="#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec2 positions;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform mat4 uProjectionMatrix;\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result =  uProjectionMatrix * pos;\n  return result.xy/result.w;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 0, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(vec3(positions, 0), vec2(0, 0), vec3(0, 0, 0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n  pos = floor(pos / cellSize);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",A="#define SHADER_NAME gpu-aggregation-to-grid-vs-64\n\nattribute vec2 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform vec2 uProjectionMatrixFP64[16];\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvoid project_to_pixel(vec2 pos, vec2 pos64xyLow, out vec2 pixelXY64[2]) {\n\n  vec2 result64[4];\n  vec2 position64[4];\n  position64[0] = vec2(pos.x, pos64xyLow.x);\n  position64[1] = vec2(pos.y, pos64xyLow.y);\n  position64[2] = vec2(0., 0.);\n  position64[3] = vec2(1., 0.);\n  mat4_vec4_mul_fp64(uProjectionMatrixFP64, position64,\n  result64);\n\n  pixelXY64[0] = div_fp64(result64[0], result64[3]);\n  pixelXY64[1] = div_fp64(result64[1], result64[3]);\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec2 windowPos = positions;\n  vec2 windowPos64xyLow = positions64xyLow;\n  if (projectPoints) {\n    vec2 projectedXY[2];\n    project_position_fp64(windowPos, windowPos64xyLow, projectedXY);\n    windowPos.x = projectedXY[0].x;\n    windowPos.y = projectedXY[1].x;\n    windowPos64xyLow.x = projectedXY[0].y;\n    windowPos64xyLow.y = projectedXY[1].y;\n  }\n\n  vec2 pixelXY64[2];\n  project_to_pixel(windowPos, windowPos64xyLow, pixelXY64);\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  vec2 pos = vec2(x, y);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",k="#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n}\n",L=n(3788),E=n(3737);function F(e,t){var n,i=t.width,a=void 0===i?1:i,r=t.height,s=void 0===r?1:r;return new L.a(e,{data:null,format:34836,type:5126,border:0,mipmaps:!1,parameters:(n={},Object(o.a)(n,10240,9728),Object(o.a)(n,10241,9728),n),dataFormat:6408,width:a,height:s})}function D(e,t){var n=t.id,i=t.width,a=void 0===i?1:i,r=t.height,s=void 0===r?1:r,l=t.texture;return new E.a(e,{id:n,width:a,height:s,attachments:Object(o.a)({},36064,l)})}function R(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!e||e.length<t?new Float32Array(t).fill(n):e}var z=l.a.fp64ifyMatrix4,T=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],N={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},I=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(r.a)(this,e),this.id=n.id||"gpu-grid-aggregator",this.shaderCache=n.shaderCache||null,this.gl=t,this.state={weights:null,gridPositions:null,positionsBuffer:null,positions64xyLowBuffer:null,vertexCount:0,fp64:null,useGPU:null,numCol:0,numRow:0,windowSize:null,cellSize:null,weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Object(c.d)(t)&&Object(u.c)(this.gl,d.a.BLEND_EQUATION_MINMAX,d.a.COLOR_ATTACHMENT_RGBA32F,d.a.TEXTURE_FLOAT)}return Object(s.a)(e,null,[{key:"getAggregationData",value:function(e){var t=e.aggregationData,n=e.maxData,i=e.minData,o=e.maxMinData,a=4*e.pixelIndex,r={};return t&&(r.cellCount=t[a+3],r.cellWeight=t[a]),o?(r.maxCellWieght=o[0],r.minCellWeight=o[3]):(n&&(r.maxCellWieght=n[0],r.totalCount=n[3]),i&&(r.minCellWeight=i[0],r.totalCount=n[3])),r}},{key:"getCellData",value:function(e){for(var t=e.countsData,n=e.size,i=void 0===n?1:n,o=t.length/4,a=new Float32Array(o*i),r=new Uint32Array(o),s=0;s<o;s++){for(var l=0;l<i;l++)a[s*i+l]=t[4*s+l];r[s]=t[4*s+3]}return{cellCounts:r,cellWeights:a}}},{key:"isSupported",value:function(e){return Object(c.d)(e)&&Object(u.c)(e,d.a.BLEND_EQUATION_MINMAX,d.a.COLOR_ATTACHMENT_RGBA32F,d.a.TEXTURE_FLOAT)}}]),Object(s.a)(e,[{key:"delete",value:function(){var e=this.gridAggregationModel,t=this.allAggregationModel,n=this.meanTransform,i=this.state,o=i.positionsBuffer,a=i.positions64xyLowBuffer,r=i.textures,s=i.framebuffers,l=i.maxMinFramebuffers,c=i.minFramebuffers,u=i.maxFramebuffers,d=i.meanTextures,g=i.resources;e&&e.delete(),t&&t.delete(),n&&n.delete(),o&&o.delete(),a&&a.delete(),this.deleteResources([s,r,l,c,u,d,g])}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setState({results:{}});var t=this.getAggregationParams(e);this.updateGridSize(t);var n=t.useGPU;return this._hasGPUSupport&&n?this.runAggregationOnGPU(t):(n&&m.a.info("GPUGridAggregator: GPU Aggregation not supported, falling back to CPU")(),this.runAggregationOnCPU(t))}},{key:"getData",value:function(e){var t={},n=this.state.results;for(var i in n[e].aggregationData||(n[e].aggregationData=n[e].aggregationBuffer.getData()),t.aggregationData=n[e].aggregationData,N){var o=N[i];(n[e][i]||n[e][o])&&(n[e][i]=n[e][i]||n[e][o].getData(),t[i]=n[e][i])}return t}},{key:"deleteResources",value:function(e){(e=Array.isArray(e)?e:[e]).forEach((function(e){for(var t in e)e[t].delete()}))}},{key:"getAggregationParams",value:function(e){var t=Object.assign({},P,e),n=t.useGPU,i=t.gridTransformMatrix,o=t.viewport,a=t.weights,r=t.projectPoints,s=t.cellSize;return this.state.useGPU!==n&&(t.changeFlags=Object.assign({},t.changeFlags,b)),!s||this.state.cellSize&&this.state.cellSize[0]===s[0]&&this.state.cellSize[1]===s[1]||(t.changeFlags.cellSizeChanged=!0,this.setState({cellSize:s})),this.validateProps(t,e),this.setState({useGPU:n}),t.gridTransformMatrix=(r?o.viewportMatrix:i)||j,a&&(t.weights=this.normalizeWeightParams(a),this.setState({weights:t.weights})),t}},{key:"normalizeWeightParams",value:function(e){var t={};for(var n in e)t[n]=Object.assign({},M,e[n]);return t}},{key:"setState",value:function(e){Object.assign(this.state,e)}},{key:"shouldTransformToGrid",value:function(e){var t=e.projectPoints,n=e.changeFlags;return!!(!this.state.gridPositions||n.dataChanged||t&&n.viewportChanged)}},{key:"updateGridSize",value:function(e){var t=e.viewport,n=e.cellSize,i=e.width||t.width,o=e.height||t.height,a=Math.ceil(i/n[0]),r=Math.ceil(o/n[1]);this.setState({numCol:a,numRow:r,windowSize:[i,o]})}},{key:"validateProps",value:function(e,t){var n=e.changeFlags,i=e.projectPoints,o=e.gridTransformMatrix;m.a.assert(n.dataChanged||n.viewportChanged||n.cellSizeChanged),m.a.assert(!n.dataChanged||t.positions&&t.weights&&(!t.projectPositions||t.viewport)&&t.cellSize),m.a.assert(!n.cellSizeChanged||t.cellSize),m.a.assert(!(n.viewportChanged&&i)||t.viewport),i&&o&&m.a.warn("projectPoints is true, gridTransformMatrix is ignored")()}},{key:"calculateAggregationData",value:function(e){var t=e.weights,n=e.results,i=e.cellIndex,o=e.posIndex;for(var a in t){for(var r=t[a],s=r.values,l=r.size,c=r.operation,u=n[a].aggregationData,d=0;d<l;d++){var g=i+d,p=s[3*o+d];if(0===u[i+3])u[g]=p;else switch(c){case x.a.SUM:case x.a.MEAN:u[g]+=p;break;case x.a.MIN:u[g]=Math.min(u[g],p);break;case x.a.MAX:u[g]=Math.max(u[g],p);break;default:m.a.assert(!1)}}u[i+3]++}}},{key:"calculateMeanMaxMinData",value:function(e){var t=e.validCellIndices,n=e.results,i=e.weights;t.forEach((function(e){for(var t in n){for(var o=i[t],a=o.size,r=o.needMin,s=o.needMax,l=o.operation,c=n[t],u=c.aggregationData,d=c.minData,g=c.maxData,p=c.maxMinData,f=r||s,h=l===x.a.MEAN,v=r&&s&&i[t].combineMaxMin,m=u[e+4-1],y=0;y<a&&(f||h);y++){var b=e+y,P=u[b];h&&(u[b]/=m,P=u[b]),v?p[y]=Math.max(p[y],P):(r&&(d[y]=Math.min(d[y],P)),s&&(g[y]=Math.max(g[y],P)))}v?p[3]=Math.min(p[3],u[e+0]):(r&&(d[3]+=m),s&&(g[3]+=m))}}))}},{key:"initCPUResults",value:function(e){var t=e.weights||this.state.weights,n=this.state,i=n.numCol,o=n.numRow,a={};for(var r in t){var s=t[r],l=s.aggregationData,c=s.minData,u=s.maxData,d=s.maxMinData,g=t[r],p=g.needMin,f=g.needMax,h=p&&f&&t[r].combineMaxMin;l=R(l,i*o*4),h?((d=R(d,4)).fill(-1/0,0,3),d[3]=1/0):(p&&((c=R(c,4,1/0))[3]=0),f&&((u=R(u,4,-1/0))[3]=0)),a[r]=Object.assign({},t[r],{aggregationData:l,minData:c,maxData:u,maxMinData:d})}return a}},{key:"runAggregationOnCPU",value:function(e){var t,n,i=e.positions,o=e.cellSize,r=e.gridTransformMatrix,s=e.viewport,l=e.projectPoints,c=e.weights,u=this.state,d=u.numCol,g=u.numRow,p=this.initCPUResults(e),f=this.shouldTransformToGrid(e),h=[0,0,0];m.a.assert(f||e.changeFlags.cellSizeChanged),f?(n=i.length/2,t=new Float64Array(i.length),this.setState({gridPositions:t})):(t=this.state.gridPositions,c=this.state.weights,n=t.length/2);for(var v=new Set,x=0;x<n;x++){var b=void 0,P=void 0;if(f){if(h[0]=i[2*x],h[1]=i[2*x+1],l){var C=s.project(h),w=Object(a.a)(C,2);b=w[0],P=w[1]}else{var S=Object(y.k)(h,r),_=Object(a.a)(S,2);b=_[0],P=_[1]}t[2*x]=b,t[2*x+1]=P}else b=t[2*x],P=t[2*x+1];var M=Math.floor(b/o[0]),j=Math.floor(P/o[1]);if(M>=0&&M<d&&j>=0&&j<g){var O=4*(M+j*d);v.add(O),this.calculateAggregationData({weights:c,results:p,cellIndex:O,posIndex:x})}}return this.calculateMeanMaxMinData({validCellIndices:v,results:p,weights:c}),this.updateAggregationBuffers(e,p),this.setState({results:p}),p}},{key:"updateCPUResultBuffer",value:function(e){var t=e.gl,n=e.bufferName,i=e.id,o=e.data,a=e.result,r=this.state.resources,s="cpu-result-".concat(i,"-").concat(n);a[n]=a[n]||r[s],a[n]?a[n].setData({data:o}):(r[s]=new g.a(t,o),a[n]=r[s])}},{key:"updateAggregationBuffers",value:function(e,t){if(e.createBufferObjects){var n=e.weights||this.state.weights;for(var i in t){var o=t[i],a=o.aggregationData,r=o.minData,s=o.maxData,l=o.maxMinData,c=n[i],u=c.needMin,d=c.needMax,g=u&&d&&n[i].combineMaxMin;this.updateCPUResultBuffer({gl:this.gl,bufferName:"aggregationBuffer",id:i,data:a,result:t[i]}),g?this.updateCPUResultBuffer({gl:this.gl,bufferName:"maxMinBuffer",id:i,data:l,result:t[i]}):(u&&this.updateCPUResultBuffer({gl:this.gl,bufferName:"minBuffer",id:i,data:r,result:t[i]}),d&&this.updateCPUResultBuffer({gl:this.gl,bufferName:"maxBuffer",id:i,data:s,result:t[i]}))}}}},{key:"getAggregateData",value:function(e){var t={},n=this.state,i=n.textures,o=n.framebuffers,a=n.maxMinFramebuffers,r=n.minFramebuffers,s=n.maxFramebuffers,l=n.weights;for(var c in l){t[c]={};var u=l[c],d=u.needMin,g=u.needMax,f=u.combineMaxMin;t[c].aggregationTexture=i[c],t[c].aggregationBuffer=Object(p.c)(o[c],{target:l[c].aggregationBuffer,sourceType:5126}),d&&g&&f?t[c].maxMinBuffer=Object(p.c)(a[c],{target:l[c].maxMinBuffer,sourceType:5126}):(d&&(t[c].minBuffer=Object(p.c)(r[c],{target:l[c].minBuffer,sourceType:5126})),g&&(t[c].maxBuffer=Object(p.c)(s[c],{target:l[c].maxBuffer,sourceType:5126})))}return this.trackGPUResultBuffers(t,l),t}},{key:"getAggregationModel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.gl,n=this.shaderCache;return new f.a(t,{id:"Gird-Aggregation-Model",vs:e?A:O,fs:k,modules:e?["fp64","project64"]:["project32"],shaderCache:n,vertexCount:0,drawMode:0})}},{key:"getAllAggregationModel",value:function(){var e=this.gl,t=this.shaderCache,n=this.state,i=n.numCol,o=n.numRow;return new f.a(e,{id:"All-Aggregation-Model",vs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\n\nvoid main(void) {\n  vec2 pos = vec2(-1.0, -1.0);\n  vec2 offset = 1.0 / vec2(gridSize);\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  int yIndex = gl_InstanceID / gridSize[0];\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",modules:["fp64"],shaderCache:t,vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:i*o,attributes:{position:[0,0]}})}},{key:"getMeanTransform",value:function(e){return this.meanTransform?this.meanTransform.update(e):this.meanTransform=new h.a(this.gl,Object.assign({},{vs:"#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n}\n",_targetTextureVarying:"meanValues"},e)),this.meanTransform}},{key:"renderAggregateData",value:function(e){var t=e.cellSize,n=e.viewport,i=e.gridTransformMatrix,o=e.projectPoints,a=this.state,r=a.numCol,s=a.numRow,l=a.windowSize,c=a.maxMinFramebuffers,u=a.minFramebuffers,d=a.maxFramebuffers,g=a.weights,p=[r,s],f={blend:!0,depthTest:!1,blendFunc:[1,1]},h={viewport:n},v={windowSize:l,cellSize:t,gridSize:p,uProjectionMatrix:i,uProjectionMatrixFP64:z(i),projectPoints:o};for(var m in g){var y=g[m],x=y.needMin,b=y.needMax,P=x&&b&&g[m].combineMaxMin;this.renderToWeightsTexture({id:m,parameters:f,moduleSettings:h,uniforms:v,gridSize:p}),P?this.renderToMaxMinTexture({id:m,parameters:Object.assign({},f,{blendEquation:S}),gridSize:p,minOrMaxFb:c[m],clearParams:{clearColor:[0,0,0,3402823466e29]},combineMaxMin:P}):(x&&this.renderToMaxMinTexture({id:m,parameters:Object.assign({},f,{blendEquation:C}),gridSize:p,minOrMaxFb:u[m],clearParams:{clearColor:[3402823466e29,3402823466e29,3402823466e29,0]},combineMaxMin:P}),b&&this.renderToMaxMinTexture({id:m,parameters:Object.assign({},f,{blendEquation:w}),gridSize:p,minOrMaxFb:d[m],combineMaxMin:P}))}}},{key:"renderToMaxMinTexture",value:function(e){var t=e.id,n=e.parameters,i=e.gridSize,o=e.minOrMaxFb,a=e.combineMaxMin,r=e.clearParams,s=void 0===r?{}:r,l=this.state.framebuffers,c=this.gl,u=this.allAggregationModel;o.bind(),c.viewport(0,0,i[0],i[1]),Object(v.a)(c,s,(function(){c.clear(16384)})),u.draw({parameters:n,uniforms:{uSampler:l[t].texture,gridSize:i,combineMaxMin:a}}),o.unbind()}},{key:"renderToWeightsTexture",value:function(e){var t=e.id,n=e.parameters,i=e.moduleSettings,a=e.uniforms,r=e.gridSize,s=this.state,l=s.framebuffers,c=s.equations,u=s.weightAttributes,d=s.weights,g=this.gl,p=this.gridAggregationModel,f=d[t].operation;l[t].bind(),g.viewport(0,0,r[0],r[1]);var h=f===x.a.MIN?[3402823466e29,3402823466e29,3402823466e29,0]:[0,0,0,0];Object(v.a)(g,{clearColor:h},(function(){g.clear(16384)}));var m={weights:u[t]};if(p.draw({parameters:Object.assign({},n,{blendEquation:c[t]}),moduleSettings:i,uniforms:a,attributes:m}),l[t].unbind(),f===x.a.MEAN){var y=this.state,b=y.meanTextures,P=y.textures,C={_sourceTextures:{aggregationValues:b[t]},_targetTexture:P[t],elementCount:P[t].width*P[t].height};this.getMeanTransform(C).run({parameters:{blend:!1,depthTest:!1}}),l[t].attach(Object(o.a)({},36064,P[t]))}}},{key:"runAggregationOnGPU",value:function(e){this.updateModels(e),this.setupFramebuffers(e),this.renderAggregateData(e);var t=this.getAggregateData(e);return this.setState({results:t}),t}},{key:"setupFramebuffers",value:function(e){var t=this.state,n=t.numCol,i=t.numRow,a=t.textures,r=t.framebuffers,s=t.maxMinFramebuffers,l=t.minFramebuffers,c=t.maxFramebuffers,u=t.resources,d=t.meanTextures,g=t.equations,p=t.weights,f={width:n,height:i};for(var h in p){var v=p[h],m=v.needMin,y=v.needMax,b=v.combineMaxMin,P=v.operation;a[h]=p[h].aggregationTexture||a[h]||F(this.gl,{id:"".concat(h,"-texture"),width:n,height:i}),a[h].resize(f);var C=a[h];P===x.a.MEAN&&(d[h]=d[h]||F(this.gl,{id:"".concat(h,"-mean-texture"),width:n,height:i}),d[h].resize(f),C=d[h]),r[h]?r[h].attach(Object(o.a)({},36064,C)):r[h]=D(this.gl,{id:"".concat(h,"-fb"),width:n,height:i,texture:C}),r[h].resize(f),g[h]=_[P],(m||y)&&(m&&y&&b?s[h]||(u["".concat(h,"-maxMin")]=F(this.gl,{id:"".concat(h,"-maxMinTex")}),s[h]=D(this.gl,{id:"".concat(h,"-maxMinFb"),texture:u["".concat(h,"-maxMin")]})):(m&&(l[h]||(u["".concat(h,"-min")]=F(this.gl,{id:"".concat(h,"-minTex")}),l[h]=D(this.gl,{id:"".concat(h,"-minFb"),texture:u["".concat(h,"-min")]}))),y&&(c[h]||(u["".concat(h,"-max")]=F(this.gl,{id:"".concat(h,"-maxTex")}),c[h]=D(this.gl,{id:"".concat(h,"-maxFb"),texture:u["".concat(h,"-max")]})))))}}},{key:"setupModels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.gridAggregationModel&&this.gridAggregationModel.delete(),this.gridAggregationModel=this.getAggregationModel(e),this.allAggregationModel||(this.allAggregationModel=this.getAllAggregationModel())}},{key:"setupWeightAttributes",value:function(e){var t=this.state,n=t.weightAttributes,i=t.vertexCount,o=t.weights,a=t.resources;for(var r in o){var s=o[r].values;if(Array.isArray(s)||s.constructor===Float32Array){m.a.assert(s.length/3===i);var l=Array.isArray(s)?new Float32Array(s):s;n[r]instanceof g.a?n[r].setData(l):(a["".concat(r,"-buffer")]=new g.a(this.gl,l),n[r]=a["".concat(r,"-buffer")])}else m.a.assert(s instanceof g.a),n[r]=s}}},{key:"trackGPUResultBuffers",value:function(e,t){var n=this.state.resources;for(var i in e)if(e[i])for(var o=0;o<T.length;o++){var a=T[o];if(e[i][a]&&t[i][a]!==e[i][a]){var r="gpu-result-".concat(i,"-").concat(a);n[r]&&n[r].delete(),n[r]=e[i][a]}}}},{key:"updateModels",value:function(e){var t=this.gl,n=e.positions,i=e.positions64xyLow,o=e.changeFlags,a=this.state,r=a.numCol,s=a.numRow,l={},c=!1;if(e.fp64!==this.state.fp64&&(this.setupModels(e.fp64),this.setState({fp64:e.fp64}),c=!0),o.dataChanged||!this.state.positionsBuffer){var u=this.state,d=u.positionsBuffer,p=u.positions64xyLowBuffer;d&&d.delete(),p&&p.delete();var f=n.length/2;d=new g.a(t,new Float32Array(n)),p=new g.a(t,{data:new Float32Array(i),accessor:{size:2}}),this.setState({positionsBuffer:d,positions64xyLowBuffer:p,vertexCount:f}),this.setupWeightAttributes(e),c=!0}if(c){var h=this.state,v=h.vertexCount,m=h.positionsBuffer,y=h.positions64xyLowBuffer;l.positions=m,e.fp64&&(l.positions64xyLow=y),this.gridAggregationModel.setVertexCount(v),this.gridAggregationModel.setAttributes(l)}(o.cellSizeChanged||o.viewportChanged)&&this.allAggregationModel.setInstanceCount(r*s)}}]),e}()},3721:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return f})),n.d(t,"a",(function(){return h}));var i=n(3739),o=n.n(i);function a(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function r(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function s(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function l(e,t,n,i){for(var o=0;o<t;o++)if(e[n+o]!==e[i-t+o])return!1;return!0}function c(e,t,n,i){for(var o=t,a=n.length,r=0;r<a;r++)for(var l=0;l<i;l++)e[o++]=n[r][l]||0;if(!s(n))for(var c=0;c<i;c++)e[o++]=n[0][c]||0;return o}function u(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=arguments.length>5?arguments[5]:void 0,r=(a=a||n.length)-o;if(r<=0)return t;for(var s=t,c=0;c<r;c++)e[s++]=n[o+c];if(!l(n,i,o,a))for(var u=0;u<i;u++)e[s++]=n[o+u];return s}function d(e){return(s(e)?0:1)+e.length}function g(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;return n>=(i=i||e.length)?0:(l(e,t,n,i)?0:1)+(i-n)/t}function p(e,t){if(a(e),e.positions){var n=e,i=n.positions,o=n.holeIndices;if(o){for(var s=0,l=0;l<=o.length;l++)s+=g(e.positions,t,o[l-1],o[l]);return s}e=i}if(Number.isFinite(e[0]))return g(e,t);if(!r(e)){var c=0,u=!0,p=!1,f=void 0;try{for(var h,v=e[Symbol.iterator]();!(u=(h=v.next()).done);u=!0){c+=d(h.value)}}catch(e){p=!0,f=e}finally{try{u||null==v.return||v.return()}finally{if(p)throw f}}return c}return d(e)}function f(e,t,n){a(e),n=n||p(e,t);var i=new Float64Array(n*t),o=[];if(e.positions){var s=e,l=s.positions,d=s.holeIndices;if(d){for(var g=0,f=0;f<=d.length;f++)g=u(i,g,l,t,d[f-1],d[f]),o.push(g);return o.pop(),{positions:i,holeIndices:o}}e=l}if(Number.isFinite(e[0]))return u(i,0,e,t),{positions:i,holeIndices:null};if(!r(e)){var h=0,v=!0,m=!1,y=void 0;try{for(var x,b=e[Symbol.iterator]();!(v=(x=b.next()).done);v=!0){h=c(i,h,x.value,t),o.push(h)}}catch(e){m=!0,y=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw y}}return o.pop(),{positions:i,holeIndices:o}}return c(i,0,e,t),{positions:i,holeIndices:null}}function h(e,t){var n=null;return e.holeIndices&&(n=e.holeIndices.map((function(e){return e/t}))),o()(e.positions,n,t)}},3723:function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var i=n(30),o=n(28),a=n(53),r=n(48),s=n(785),l=n(54),c=n(3718),u=n(3818),d=n(3778),g=n(3687),p=n(3943),f=g.a.Tesselator,h=p.a.fp64LowPart,v=function(e){function t(e){var n=e.data,o=e.getGeometry,s=e.positionFormat,l=e.fp64;return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).call(this,{data:n,getGeometry:o,fp64:l,positionFormat:s,attributes:{startPositions:{size:3},endPositions:{size:3},leftPositions:{size:3},rightPositions:{size:3},startEndPositions64XyLow:{size:4,fp64Only:!0},neighborPositions64XyLow:{size:4,fp64Only:!0}}}))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"get",value:function(e){return this.attributes[e]}},{key:"getGeometrySize",value:function(e){return Math.max(0,this.getPathLength(e)-1)}},{key:"updateGeometryAttributes",value:function(e,t){var n=this.attributes,i=n.startPositions,o=n.endPositions,a=n.leftPositions,r=n.rightPositions,s=n.startEndPositions64XyLow,l=n.neighborPositions64XyLow,c=this.fp64,u=t.geometrySize+1;if(!(u<2))for(var d,g=this.isClosed(e),p=this.getPointOnPath(e,0),f=this.getPointOnPath(e,1),v=g?this.getPointOnPath(e,u-2):p,m=t.vertexStart,y=1;y<u;m++,y++)d=y+1<u?this.getPointOnPath(e,y+1):g?this.getPointOnPath(e,1):f,i[3*m]=p[0],i[3*m+1]=p[1],i[3*m+2]=p[2]||0,o[3*m]=f[0],o[3*m+1]=f[1],o[3*m+2]=f[2]||0,a[3*m]=v[0],a[3*m+1]=v[1],a[3*m+2]=v[2]||0,r[3*m]=d[0],r[3*m+1]=d[1],r[3*m+2]=d[2]||0,c&&(s[4*m]=h(p[0]),s[4*m+1]=h(p[1]),s[4*m+2]=h(f[0]),s[4*m+3]=h(f[1]),l[4*m]=h(v[0]),l[4*m+1]=h(v[1]),l[4*m+2]=h(d[0]),l[4*m+3]=h(d[1])),v=p,p=f,f=d}},{key:"getPathLength",value:function(e){return Number.isFinite(e[0])?e.length/this.positionSize:e.length}},{key:"getPointOnPath",value:function(e,t){if(Number.isFinite(e[0])){var n=this.positionSize;return[e[t*n],e[t*n+1],3===n?e[t*n+2]:0]}return e[t]}},{key:"isClosed",value:function(e){var t=this.getPathLength(e),n=this.getPointOnPath(e,0),i=this.getPointOnPath(e,t-1);return n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]}}]),t}(f),m="#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\nuniform float alignMode;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nfloat mod2(float a, float b) {\n  return a - floor(a / b) * b;\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\nbool dash_isFragInGap() {\n  float solidLength = vDashArray.x;\n  float gapLength = vDashArray.y;\n\n  float unitLength = solidLength + gapLength;\n\n  if (unitLength == 0.0) {\n    return false;\n  }\n\n  unitLength = mix(\n    unitLength,\n    vPathLength / round(vPathLength / unitLength),\n    alignMode\n  );\n\n  float offset = alignMode * solidLength / 2.0;\n\n  return gapLength > 0.0 &&\n    vPathPosition.y >= 0.0 &&\n    vPathPosition.y <= vPathLength &&\n    mod2(vPathPosition.y + offset, unitLength) > solidLength;\n}\n\nvoid main(void) {\n  if (jointType > 0.0 && vMiterLength > 0.0 && length(vCornerOffset) > 1.0) {\n    discard;\n  }\n  if (jointType == 0.0 && vMiterLength > miterLimit) {\n    discard;\n  }\n  if (vColor.a == 0.0 || dash_isFragInGap()) {\n    discard;\n  }\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",y=[0,0,0,255],x={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},rounded:!1,miterLimit:{type:"number",min:0,value:4},fp64:!1,dashJustified:!1,billboard:!1,getPath:{type:"accessor",value:function(e){return e.path}},getColor:{type:"accessor",value:y},getWidth:{type:"accessor",value:1},getDashArray:{type:"accessor",value:[0,0]}},b={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},P=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(){return this.use64bitProjection()?{vs:"\n#define SHADER_NAME path-layer-vertex-shader-64\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec4 instanceNeighborPositions64xyLow;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\nvec3 lineJoin(vec2 prevPoint64[2], vec2 currPoint64[2], vec2 nextPoint64[2]) {\n\n  float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n  float width = project_pixel_size(widthPixels);\n\n  vec2 deltaA64[2];\n  vec2 deltaB64[2];\n\n  vec2_sub_fp64(currPoint64, prevPoint64, deltaA64);\n  vec2_sub_fp64(nextPoint64, currPoint64, deltaB64);\n\n  vec2 lengthA64 = vec2_length_fp64(deltaA64);\n  vec2 lengthB64 = vec2_length_fp64(deltaB64);\n\n  vec2 deltaA = vec2(deltaA64[0].x, deltaA64[1].x);\n  vec2 deltaB = vec2(deltaB64[0].x, deltaB64[1].x);\n\n  float lenA = lengthA64.x;\n  float lenB = lengthB64.x;\n\n  vec2 offsetVec;\n  float offsetScale;\n  float offsetDirection;\n  lenA = lenA / width > EPSILON ? lenA : 0.0;\n  lenB = lenB / width > EPSILON ? lenB : 0.0;\n  vec2 dirA = lenA > 0. ? deltaA / lenA : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? deltaB / lenB : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = mix(perpB, perpA, positions.x);\n  float L = mix(lenB, lenA, positions.x);\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n  float cornerPosition = mix(\n    flipIfTrue(turnsRight == (positions.y > 0.0)),\n    0.0,\n    positions.z\n  );\n\n  offsetScale = 1.0 / max(sinHalfA, EPSILON);\n  cornerPosition *= float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n  offsetScale = mix(\n    offsetScale,\n    min(offsetScale, L / width / max(cosHalfA, EPSILON)),\n    float(cornerPosition < 0.0)\n  );\n\n  vMiterLength = mix(\n    offsetScale * cornerPosition,\n    mix(offsetScale, 0.0, cornerPosition),\n    step(0.0, cornerPosition)\n  ) - sinHalfA * jointType;\n  offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n  offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  float isStartCap = step(lenA, 1.0e-5);\n  float isEndCap = step(lenB, 1.0e-5);\n  float isCap = max(isStartCap, isEndCap);\n  cornerPosition = isCap * (1.0 - positions.z);\n  offsetVec = mix(offsetVec, mix(dirB, perpB, cornerPosition), isStartCap);\n  offsetVec = mix(offsetVec, mix(dirA, perpA, cornerPosition), isEndCap);\n  offsetScale = mix(\n    offsetScale,\n    mix(4.0 * jointType, 1.0, cornerPosition),\n    isCap\n  );\n  vMiterLength = mix(vMiterLength, 1.0 - cornerPosition, isCap);\n\n  offsetDirection = mix(\n    offsetDirection,\n    mix(flipIfTrue(isStartCap > 0.), positions.y, cornerPosition),\n    isCap\n  );\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vDashArray = instanceDashArrays;\n  vPathLength = L / width;\n  float isEnd = positions.x;\n  vec2 offsetFromStartOfPath = mix(vCornerOffset, vCornerOffset + deltaA / width, isEnd);\n  vec2 dir = mix(dirB, dirA, isEnd);\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return vec3(vCornerOffset * width, 0.0);\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n  vec2 projected_curr_position[2];\n  project_position_fp64(currPosition.xy, currPosition64xyLow, projected_curr_position);\n  float projected_curr_position_z = project_size(currPosition.z);\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec2 prevPosition64xyLow = mix(instanceNeighborPositions64xyLow.xy, instanceStartEndPositions64xyLow.xy, isEnd);\n\n  vec2 projected_prev_position[2];\n  project_position_fp64(prevPosition.xy, prevPosition64xyLow, projected_prev_position);\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec2 nextPosition64xyLow = mix(instanceStartEndPositions64xyLow.zw, instanceNeighborPositions64xyLow.zw, isEnd);\n\n  vec2 projected_next_position[2];\n  project_position_fp64(nextPosition.xy, nextPosition64xyLow, projected_next_position);\n\n  vec3 pos = lineJoin(projected_prev_position, projected_curr_position, projected_next_position);\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = sum_fp64(vec2(pos.x, 0.0), projected_curr_position[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vec2(pos.y, 0.0), projected_curr_position[1]);\n  vertex_pos_modelspace[2] = vec2(pos.z + projected_curr_position_z, 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_common_position_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",fs:m,modules:["project64","picking"]}:{vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec4 instanceNeighborPositions64xyLow;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  float relativePosition, bool isEnd, bool isJoint,\n  vec2 width\n) {\n  vec2 deltaA = (currPoint.xy - prevPoint.xy) / width;\n  vec2 deltaB = (nextPoint.xy - currPoint.xy) / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n  lenA = lenA > EPSILON ? lenA : 0.0;\n  lenB = lenB > EPSILON ? lenB : 0.0;\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  float offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  float cornerPosition = isJoint ?\n    0.0 :\n    flipIfTrue(turnsRight == (relativePosition > 0.0));\n  cornerPosition *=\n    float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) * cosHalfA);\n  if (cornerPosition < 0.0) {\n    offsetScale = min(offsetScale, L / max(cosHalfA, EPSILON));\n  }\n\n  vMiterLength = cornerPosition >= 0.0 ?\n    mix(offsetScale, 0.0, cornerPosition) :\n    offsetScale * cornerPosition;\n  vMiterLength -= sinHalfA * jointType;\n\n  float offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  bool isStartCap = step(0.0, -lenA) > 0.5;\n  bool isEndCap = step(0.0, -lenB) > 0.5;\n  bool isCap = isStartCap || isEndCap;\n  cornerPosition = isCap ? (1.0 - positions.z) : 0.;\n  if (isStartCap) {\n    offsetVec = mix(dirB, perpB, cornerPosition);\n  }\n  if (isEndCap) {\n    offsetVec = mix(dirA, perpA, cornerPosition);\n  }\n  if (isCap) {\n    offsetScale = mix(4.0 * jointType, 1.0, cornerPosition);\n    vMiterLength = 1.0 - cornerPosition;\n    offsetDirection = mix(flipIfTrue(isStartCap), positions.y, cornerPosition);\n  }\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vDashArray = instanceDashArrays;\n  vPathLength = L;\n  vec2 offsetFromStartOfPath = vCornerOffset;\n  if (isEnd) {\n    offsetFromStartOfPath += deltaA;\n  }\n  vec2 dir = isEnd ? dirA : dirB;\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return currPoint + vec3(vCornerOffset * width, 0.0);\n}\nvec3 lineJoin(vec3 prevPoint, vec3 currPoint, vec3 nextPoint) {\n\n  float relativePosition = positions.y;\n  bool isEnd = positions.x > EPSILON;\n  bool isJoint = positions.z > EPSILON;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n\n  return lineJoin(\n    prevPoint, currPoint, nextPoint,\n    relativePosition, isEnd, isJoint,\n    billboard ? project_pixel_size_to_clipspace(widthPixels) : project_pixel_size(widthPixels)\n  );\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec2 prevPosition64xyLow = mix(instanceNeighborPositions64xyLow.xy, instanceStartEndPositions64xyLow.xy, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec2 nextPosition64xyLow = mix(instanceStartEndPositions64xyLow.zw, instanceNeighborPositions64xyLow.zw, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64xyLow, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64xyLow, ZERO_OFFSET);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64xyLow, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64xyLow);\n    currPosition = project_position(currPosition, currPosition64xyLow);\n    nextPosition = project_position(nextPosition, nextPosition64xyLow);\n\n    vec3 pos = lineJoin(prevPosition, currPosition, nextPosition);\n    gl_Position = project_common_position_to_clipspace(vec4(pos, 1.0));\n  }\n}\n",fs:m,modules:["project32","picking"]}}},{key:"initializeState",value:function(){var e=this;this.getAttributeManager().addInstanced({instanceStartPositions:{size:3,transition:b,accessor:"getPath",update:this.calculateStartPositions,noAlloc:!0},instanceEndPositions:{size:3,transition:b,accessor:"getPath",update:this.calculateEndPositions,noAlloc:!0},instanceStartEndPositions64xyLow:{size:4,update:this.calculateInstanceStartEndPositions64xyLow,noAlloc:!0},instanceLeftPositions:{size:3,accessor:"getPath",update:this.calculateLeftPositions,noAlloc:!0},instanceRightPositions:{size:3,accessor:"getPath",update:this.calculateRightPositions,noAlloc:!0},instanceNeighborPositions64xyLow:{size:4,update:this.calculateInstanceNeighborPositions64xyLow,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:b,defaultValue:1},instanceDashArrays:{size:2,accessor:"getDashArray"},instanceColors:{size:4,type:5121,accessor:"getColor",transition:b,defaultValue:y},instancePickingColors:{size:3,type:5121,accessor:function(t,n){var i=n.index,o=n.target;return e.encodePickingColor(i,o)}}}),this.setState({pathTesselator:new v({})})}},{key:"updateState",value:function(e){var n=e.oldProps,i=e.props,o=e.changeFlags;Object(s.a)(Object(r.a)(t.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:o});var a=this.getAttributeManager();if(o.dataChanged||i.fp64!==n.fp64||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getPath)){var l=this.state.pathTesselator;l.updateGeometry({data:i.data,getGeometry:i.getPath,positionFormat:i.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:l.instanceCount,bufferLayout:l.bufferLayout}),a.invalidateAll()}if(i.fp64!==n.fp64){var c=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(c)}),a.invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.rounded,a=i.billboard,r=i.miterLimit,s=i.widthUnits,l=i.widthScale,c=i.widthMinPixels,u=i.widthMaxPixels,d=i.dashJustified,g="pixels"===s?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{jointType:Number(o),billboard:a,alignMode:Number(d),widthScale:l*g,miterLimit:r,widthMinPixels:c,widthMaxPixels:u})).draw()}},{key:"_getModel",value:function(e){return new u.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new d.a({drawMode:4,attributes:{indices:new Uint16Array([0,2,1,1,2,4,1,4,3,3,4,5]),positions:new Float32Array([0,0,1,0,-1,0,0,1,0,1,-1,0,1,1,0,1,0,1])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateStartPositions",value:function(e){var t=this.state.pathTesselator;e.bufferLayout=t.bufferLayout,e.value=t.get("startPositions")}},{key:"calculateEndPositions",value:function(e){var t=this.state.pathTesselator;e.bufferLayout=t.bufferLayout,e.value=t.get("endPositions")}},{key:"calculateInstanceStartEndPositions64xyLow",value:function(e){var t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.pathTesselator.get("startEndPositions64XyLow"):new Float32Array(4)}},{key:"calculateLeftPositions",value:function(e){var t=this.state.pathTesselator;e.value=t.get("leftPositions")}},{key:"calculateRightPositions",value:function(e){var t=this.state.pathTesselator;e.value=t.get("rightPositions")}},{key:"calculateInstanceNeighborPositions64xyLow",value:function(e){var t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.pathTesselator.get("neighborPositions64XyLow"):new Float32Array(4)}},{key:"clearPickingColor",value:function(e){for(var t=this.decodePickingColor(e),n=this.state.pathTesselator.bufferLayout,i=n[t],o=0,a=0;a<t;a++)o+=n[a];var r=this.getAttributeManager().attributes.instancePickingColors,s=r.value,l=o+i;s.fill(0,3*o,3*l),r.update({value:s})}}]),t}(c.a);P.layerName="PathLayer",P.defaultProps=x},3728:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var i=n(30),o=n(28),a=n(53),r=n(48),s=n(785),l=n(54),c=n(3718),u=n(3691),d=n(3712),g=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(e){Object(s.a)(Object(r.a)(t.prototype),"setState",this).call(this,e),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(e){return e.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(e,t){var n=this.props._subLayerProps;return t&&t.length||n&&n[e]}},{key:"getSubLayerClass",value:function(e,t){var n=this.props._subLayerProps;return n&&n[e]&&n[e].type||t}},{key:"getSubLayerProps",value:function(e){var t=this.props,n=t.opacity,i=t.pickable,o=t.visible,a=t.parameters,r=t.getPolygonOffset,s=t.highlightedObjectIndex,l=t.autoHighlight,c=t.highlightColor,u=t.coordinateSystem,d=t.coordinateOrigin,g=t.wrapLongitude,p=t.positionFormat,f=t.modelMatrix,h=t._subLayerProps,v={opacity:n,pickable:i,visible:o,parameters:a,getPolygonOffset:r,highlightedObjectIndex:s,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:d,wrapLongitude:g,positionFormat:p,modelMatrix:f};if(e){var m=h&&h[e.id],y=m&&m.updateTriggers;Object.assign(v,e,m,{id:"".concat(this.props.id,"-").concat(e.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers,y)})}return v}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var e=this.internalState.subLayers;e&&!this.needsUpdate()?u.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(e=this.renderLayers(),e=Object(d.b)(e,{filter:Boolean}),this.internalState.subLayers=e,u.a.log(2,"Composite layer rendered new subLayers ".concat(this),e)());var t=!0,n=!1,i=void 0;try{for(var o,a=e[Symbol.iterator]();!(t=(o=a.next()).done);t=!0){o.value.parent=this}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"isComposite",get:function(){return!0}}]),t}(c.a);g.layerName="CompositeLayer"},3729:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(11),o=n(62),a=n(30),r=n(28),s=function(e){return e.length},l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;Object(a.a)(this,e),this.sortedBins=this.getSortedBins(t,n),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}return Object(r.a)(e,[{key:"getSortedBins",value:function(e,t){return e.reduce((function(e,n,i){var o=t(n.points);return null!=o&&e.push({i:Number.isFinite(n.index)?n.index:i,value:o,counts:n.points.length}),e}),[]).sort((function(e,t){return e.value-t.value}))}},{key:"getValueRange",value:function(e){var t=Object(o.a)(e,2),n=t[0],i=t[1],a=this.sortedBins.length;if(!a)return[0,0];var r=Math.ceil(n/100*(a-1)),s=Math.floor(i/100*(a-1));return[this.sortedBins[r].value,this.sortedBins[s].value]}},{key:"getMaxCount",value:function(){var e=0;return this.sortedBins.forEach((function(t){return e=e>t.counts?e:t.counts})),e}},{key:"getBinMap",value:function(){return this.sortedBins.reduce((function(e,t){return Object.assign(e,Object(i.a)({},t.i,t))}),{})}}]),e}()},3730:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return a}));var i=n(3691);function o(e,t){return function(n){return function(e,t,n){var o=e[1]-e[0];if(o<=0)return i.a.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];var a=o/t.length,r=Math.floor((n-e[0])/a);return t[Math.max(Math.min(r,t.length-1),0)]}(e,t,n)}}function a(e,t){return function(n){return(n-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}}},3731:function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var i=n(30),o=n(28),a=n(53),r=n(48),s=n(785),l=n(54),c=n(3718),u=n(3762),d=n(3931),g=n(3859),p=n(3818),f=n(3778),h=n(3721),v=n(3687),m=n(3943),y=v.a.Tesselator,x=m.a.fp64LowPart,b=function(e){function t(e){var n=e.data,o=e.getGeometry,s=e.fp64,l=e.positionFormat,c=e.IndexType,u=void 0===c?Uint32Array:c;return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).call(this,{data:n,getGeometry:o,fp64:s,positionFormat:l,attributes:{positions:{size:3},positions64xyLow:{size:2,fp64Only:!0},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:u,size:1}}}))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"get",value:function(e){return"indices"===e?this.attributes.indices.subarray(0,this.vertexCount):this.attributes[e]}},{key:"getGeometrySize",value:function(e){return h.b(e,this.positionSize)}},{key:"updateGeometryAttributes",value:function(e,t){e=h.c(e,this.positionSize,t.geometrySize),this._updateIndices(e,t),this._updatePositions(e,t)}},{key:"_updateIndices",value:function(e,t){var n=t.geometryIndex,i=t.vertexStart,o=t.indexStart,a=this.attributes,r=this.indexLayout,s=this.typedArrayManager,l=a.indices,c=l.length,u=o,d=h.a(e,this.positionSize);c<u+d.length&&(c=2*(u+d.length),l=s.allocate(l,c,{type:l.constructor,size:1,copy:!0}));for(var g=0;g<d.length;g++)l[u++]=d[g]+i;r[n]=d.length,a.indices=l}},{key:"_updatePositions",value:function(e,t){for(var n=t.vertexStart,i=t.geometrySize,o=this.attributes,a=o.positions,r=o.positions64xyLow,s=o.vertexValid,l=this.fp64,c=this.positionSize,u=n,d=e.positions,g=e.holeIndices,p=0;p<i;p++){var f=d[p*c],h=d[p*c+1],v=c>2?d[p*c+2]:0;a[3*u]=f,a[3*u+1]=h,a[3*u+2]=v,l&&(r[2*u]=x(f),r[2*u+1]=x(h)),s[u]=1,u++}if(g)for(var m=0;m<g.length;m++)s[n+g[m]/c-1]=0;s[n+i-1]=0}}]),t}(y),P="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec2 positions64xyLow;\n  vec2 nextPositions64xyLow;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n  vec3 pos;\n  vec2 pos64xyLow;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64xyLow = mix(props.positions64xyLow, props.nextPositions64xyLow, vertexPositions.x);\n  isValid = vertexValid;\n#else\n  pos = props.positions;\n  pos64xyLow = props.positions64xyLow;\n  isValid = 1.0;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n  }\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(pos, pos64xyLow, vec3(0.), position_commonspace);\n\n  if (extruded) {\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(props.positions.y - props.nextPositions.y, props.nextPositions.x - props.positions.x, 0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, position_commonspace.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(props.pickingColors);\n}\n",C="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(P,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64xyLow = positions64xyLow;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),w="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 nextPositions;\nattribute vec2 nextPositions64xyLow;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(P,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = instancePositions;\n  props.positions64xyLow = instancePositions64xyLow;\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n  props.nextPositions = nextPositions;\n  props.nextPositions64xyLow = nextPositions64xyLow;\n\n  calculatePosition(props);\n}\n"),S=[0,0,0,255],_=new u.a,M={filled:!0,extruded:!1,wireframe:!1,fp64:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(e){return e.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:S},getLineColor:{type:"accessor",value:S},material:_},j={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},O=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(e){return{vs:e,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid < 0.5) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",defines:{},modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){var e=this,t=this.context.gl;this.setState({numInstances:0,polygonTesselator:new b({IndexType:!t||Object(d.b)(t,g.a.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var n=this.getAttributeManager();n.remove(["instancePickingColors"]),n.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,transition:j,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{positions:{offset:0,divisor:0},instancePositions:{offset:0,divisor:1},nextPositions:{offset:12,divisor:1}}},positions64xyLow:{size:2,update:this.calculatePositionsLow,noAlloc:!0,shaderAttributes:{positions64xyLow:{offset:0,divisor:0},instancePositions64xyLow:{offset:0,divisor:1},nextPositions64xyLow:{offset:8,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:j,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:4,type:5121,transition:j,accessor:"getFillColor",defaultValue:S,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:4,type:5121,transition:j,accessor:"getLineColor",defaultValue:S,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(t,n){var i=n.index,o=n.target;return e.encodePickingColor(i,o)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.extruded,o=n.filled,a=n.wireframe,r=n.elevationScale,s=this.state,l=s.topModel,c=s.sideModel,u=s.polygonTesselator,d=Object.assign({},t,{extruded:Boolean(i),elevationScale:r});c&&(c.setInstanceCount(u.instanceCount-1),c.setUniforms(d),a&&(c.setDrawMode(3),c.setUniforms({isWireframe:!0}).draw()),o&&(c.setDrawMode(6),c.setUniforms({isWireframe:!1}).draw())),l&&(l.setVertexCount(u.get("indices").length),l.setUniforms(d).draw())}},{key:"updateState",value:function(e){Object(s.a)(Object(r.a)(t.prototype),"updateState",this).call(this,e),this.updateGeometry(e);var n=e.props,i=e.oldProps,o=this.getAttributeManager();(n.fp64!==i.fp64||n.filled!==i.filled||n.extruded!==i.extruded)&&(this.state.models&&this.state.models.forEach((function(e){return e.delete()})),this.setState(this._getModels(this.context.gl)),o.invalidateAll())}},{key:"updateGeometry",value:function(e){var t=e.props,n=e.oldProps,i=e.changeFlags;if(i.dataChanged||t.fp64!==n.fp64||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){var o=this.state.polygonTesselator;o.updateGeometry({data:t.data,getGeometry:t.getPolygon,positionFormat:t.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:o.instanceCount,bufferLayout:o.bufferLayout}),this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(e){var t,n,i=this.props,o=i.id,a=i.filled,r=i.extruded;if(a){var s=this.getShaders(C);s.defines.NON_INSTANCED_MODEL=1,t=new p.a(e,Object.assign({},s,{id:"".concat(o,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0,shaderCache:this.context.shaderCache}))}return r&&((n=new p.a(e,Object.assign({},this.getShaders(w),{id:"".concat(o,"-side"),geometry:new f.a({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,1,0,1,0,0,1,0])}}}),instanceCount:0,isInstanced:1,shaderCache:this.context.shaderCache}))).userData.excludeAttributes={indices:!0}),{models:[n,t].filter(Boolean),topModel:t,sideModel:n}}},{key:"calculateIndices",value:function(e){var t=this.state.polygonTesselator;e.bufferLayout=t.indexLayout,e.value=t.get("indices")}},{key:"calculatePositions",value:function(e){var t=this.state.polygonTesselator;e.bufferLayout=t.bufferLayout,e.value=t.get("positions")}},{key:"calculatePositionsLow",value:function(e){var t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.polygonTesselator.get("positions64xyLow"):new Float32Array(2)}},{key:"calculateVertexValid",value:function(e){e.value=this.state.polygonTesselator.get("vertexValid")}},{key:"clearPickingColor",value:function(e){for(var t=this.decodePickingColor(e),n=this.state.polygonTesselator.bufferLayout,i=n[t],o=0,a=0;a<t;a++)o+=n[a];var r=this.getAttributeManager().attributes.pickingColors,s=r.value,l=o+i;s.fill(0,3*o,3*l),r.update({value:s})}}]),t}(c.a);O.layerName="SolidPolygonLayer",O.defaultProps=M},3739:function(e,t,n){"use strict";function i(e,t,n){n=n||2;var i,s,l,c,u,p,f,v=t&&t.length,m=v?t[0]*n:e.length,y=o(e,0,m,n,!0),x=[];if(!y||y.next===y.prev)return x;if(v&&(y=function(e,t,n,i){var r,s,l,c,u,p=[];for(r=0,s=t.length;r<s;r++)l=t[r]*i,c=r<s-1?t[r+1]*i:e.length,(u=o(e,l,c,i,!1))===u.next&&(u.steiner=!0),p.push(h(u));for(p.sort(d),r=0;r<p.length;r++)g(p[r],n),n=a(n,n.next);return n}(e,t,y,n)),e.length>80*n){i=l=e[0],s=c=e[1];for(var b=n;b<m;b+=n)(u=e[b])<i&&(i=u),(p=e[b+1])<s&&(s=p),u>l&&(l=u),p>c&&(c=p);f=0!==(f=Math.max(l-i,c-s))?1/f:0}return r(y,x,n,i,s,f),x}function o(e,t,n,i,o){var a,r;if(o===O(e,t,n,i)>0)for(a=t;a<n;a+=i)r=_(a,e[a],e[a+1],r);else for(a=n-i;a>=t;a-=i)r=_(a,e[a],e[a+1],r);return r&&x(r,r.next)&&(M(r),r=r.next),r}function a(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!x(i,i.next)&&0!==y(i.prev,i,i.next))i=i.next;else{if(M(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function r(e,t,n,i,o,d,g){if(e){!g&&d&&function(e,t,n,i){var o=e;do{null===o.z&&(o.z=f(o.x,o.y,t,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,n,i,o,a,r,s,l,c=1;do{for(n=e,e=null,a=null,r=0;n;){for(r++,i=n,s=0,t=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(o=n,n=n.nextZ,s--):(o=i,i=i.nextZ,l--),a?a.nextZ=o:e=o,o.prevZ=a,a=o;n=i}a.nextZ=null,c*=2}while(r>1)}(o)}(e,i,o,d);for(var p,h,v=e;e.prev!==e.next;)if(p=e.prev,h=e.next,d?l(e,i,o,d):s(e))t.push(p.i/n),t.push(e.i/n),t.push(h.i/n),M(e),e=h.next,v=h.next;else if((e=h)===v){g?1===g?r(e=c(a(e),t,n),t,n,i,o,d,2):2===g&&u(e,t,n,i,o,d):r(a(e),t,n,i,o,d,1);break}}}function s(e){var t=e.prev,n=e,i=e.next;if(y(t,n,i)>=0)return!1;for(var o=e.next.next;o!==e.prev;){if(v(t.x,t.y,n.x,n.y,i.x,i.y,o.x,o.y)&&y(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function l(e,t,n,i){var o=e.prev,a=e,r=e.next;if(y(o,a,r)>=0)return!1;for(var s=o.x<a.x?o.x<r.x?o.x:r.x:a.x<r.x?a.x:r.x,l=o.y<a.y?o.y<r.y?o.y:r.y:a.y<r.y?a.y:r.y,c=o.x>a.x?o.x>r.x?o.x:r.x:a.x>r.x?a.x:r.x,u=o.y>a.y?o.y>r.y?o.y:r.y:a.y>r.y?a.y:r.y,d=f(s,l,t,n,i),g=f(c,u,t,n,i),p=e.prevZ,h=e.nextZ;p&&p.z>=d&&h&&h.z<=g;){if(p!==e.prev&&p!==e.next&&v(o.x,o.y,a.x,a.y,r.x,r.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,h!==e.prev&&h!==e.next&&v(o.x,o.y,a.x,a.y,r.x,r.y,h.x,h.y)&&y(h.prev,h,h.next)>=0)return!1;h=h.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&v(o.x,o.y,a.x,a.y,r.x,r.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;h&&h.z<=g;){if(h!==e.prev&&h!==e.next&&v(o.x,o.y,a.x,a.y,r.x,r.y,h.x,h.y)&&y(h.prev,h,h.next)>=0)return!1;h=h.nextZ}return!0}function c(e,t,n){var i=e;do{var o=i.prev,r=i.next.next;!x(o,r)&&b(o,i,i.next,r)&&w(o,r)&&w(r,o)&&(t.push(o.i/n),t.push(i.i/n),t.push(r.i/n),M(i),M(i.next),i=e=r),i=i.next}while(i!==e);return a(i)}function u(e,t,n,i,o,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var u=S(l,c);return l=a(l,l.next),u=a(u,u.next),r(l,t,n,i,o,s),void r(u,t,n,i,o,s)}c=c.next}l=l.next}while(l!==e)}function d(e,t){return e.x-t.x}function g(e,t){if(t=function(e,t){var n,i=t,o=e.x,a=e.y,r=-1/0;do{if(a<=i.y&&a>=i.next.y&&i.next.y!==i.y){var s=i.x+(a-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=o&&s>r){if(r=s,s===o){if(a===i.y)return i;if(a===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(o===r)return n;var l,c=n,u=n.x,d=n.y,g=1/0;i=n;do{o>=i.x&&i.x>=u&&o!==i.x&&v(a<d?o:r,a,u,d,a<d?r:o,a,i.x,i.y)&&(l=Math.abs(a-i.y)/(o-i.x),w(i,e)&&(l<g||l===g&&(i.x>n.x||i.x===n.x&&p(n,i)))&&(n=i,g=l)),i=i.next}while(i!==c);return n}(e,t)){var n=S(t,e);a(t,t.next),a(n,n.next)}}function p(e,t){return y(e.prev,e,t.prev)<0&&y(t.next,e,e.next)<0}function f(e,t,n,i,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function h(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function v(e,t,n,i,o,a,r,s){return(o-r)*(t-s)-(e-r)*(a-s)>=0&&(e-r)*(i-s)-(n-r)*(t-s)>=0&&(n-r)*(a-s)-(o-r)*(i-s)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&b(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(w(e,t)&&w(t,e)&&function(e,t){var n=e,i=!1,o=(e.x+t.x)/2,a=(e.y+t.y)/2;do{n.y>a!=n.next.y>a&&n.next.y!==n.y&&o<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(y(e.prev,e,t.prev)||y(e,t.prev,t))||x(e,t)&&y(e.prev,e,e.next)>0&&y(t.prev,t,t.next)>0)}function y(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,n,i){var o=C(y(e,t,n)),a=C(y(e,t,i)),r=C(y(n,i,e)),s=C(y(n,i,t));return o!==a&&r!==s||(!(0!==o||!P(e,n,t))||(!(0!==a||!P(e,i,t))||(!(0!==r||!P(n,e,i))||!(0!==s||!P(n,t,i)))))}function P(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function C(e){return e>0?1:e<0?-1:0}function w(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function S(e,t){var n=new j(e.i,e.x,e.y),i=new j(t.i,t.x,t.y),o=e.next,a=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function _(e,t,n,i){var o=new j(e,t,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function M(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function j(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(e,t,n,i){for(var o=0,a=t,r=n-i;a<n;a+=i)o+=(e[r]-e[a])*(e[a+1]+e[r+1]),r=a;return o}e.exports=i,e.exports.default=i,i.deviation=function(e,t,n,i){var o=t&&t.length,a=o?t[0]*n:e.length,r=Math.abs(O(e,0,a,n));if(o)for(var s=0,l=t.length;s<l;s++){var c=t[s]*n,u=s<l-1?t[s+1]*n:e.length;r-=Math.abs(O(e,c,u,n))}var d=0;for(s=0;s<i.length;s+=3){var g=i[s]*n,p=i[s+1]*n,f=i[s+2]*n;d+=Math.abs((e[g]-e[f])*(e[p+1]-e[g+1])-(e[g]-e[p])*(e[f+1]-e[g+1]))}return 0===r&&0===d?0:Math.abs((d-r)/r)},i.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,o=0;o<e.length;o++){for(var a=0;a<e[o].length;a++)for(var r=0;r<t;r++)n.vertices.push(e[o][a][r]);o>0&&(i+=e[o-1].length,n.holes.push(i))}return n}},3757:function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var i=n(30),o=n(28),a=n(53),r=n(48),s=n(785),l=n(54),c=n(3746),u=n(3718),d=n(3943),g=n(3762),p=n(3818),f=n(163),h=n(3691),v=n(3932),m=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.id,o=void 0===n?Object(v.c)("column-geometry"):n,s=y(e),l=s.indices,c=s.attributes;return Object(a.a)(this,Object(r.a)(t).call(this,Object(f.a)({},e,{id:o,indices:l,attributes:c})))}return Object(l.a)(t,e),t}(n(3778).a);function y(e){var t=e.radius,n=e.height,i=void 0===n?1:n,o=e.nradial,a=void 0===o?10:o,r=e.vertices;h.a.assert(!r||r.length>=a);for(var s=a+1,l=3*s,c=2*Math.PI/a,u=new Uint16Array(3*a*2),d=new Float32Array(3*l),g=new Float32Array(3*l),p=0,f=0;f<s;f++)for(var v=f*c,m=r&&r[f%a],y=r&&r[(f+1)%a],x=Math.sin(v),b=Math.cos(v),P=0;P<2;P++)d[p+0]=m?m[0]:b*t,d[p+1]=m?m[1]:x*t,d[p+2]=(.5-P)*i,g[p+0]=m?y[0]-m[0]:b,g[p+1]=m?y[1]-m[1]:x,p+=3;for(var C=0;C<s;C++){var w=Math.floor(C/2)*Math.sign(C%2-.5),S=w*c,_=r&&r[(w+a)%a],M=Math.sin(S),j=Math.cos(S);d[p+0]=_?_[0]:j*t,d[p+1]=_?_[1]:M*t,d[p+2]=i/2,g[p+2]=1,p+=3}for(var O=0,A=0;A<a;A++)u[O++]=2*A+0,u[O++]=2*A+2,u[O++]=2*A+0,u[O++]=2*A+1,u[O++]=2*A+1,u[O++]=2*A+3;return{indices:u,attributes:{POSITION:{size:3,value:d},NORMAL:{size:3,value:g}}}}var x=d.a.fp64LowPart,b=new g.a,P=[0,0,0,255],C={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,fp64:!1,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:P},getLineColor:{type:"accessor",value:P},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:b,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},w=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  \n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceFillColors:{size:4,type:5121,transition:!0,accessor:"getFillColor",defaultValue:P},instanceLineColors:{size:4,type:5121,transition:!0,accessor:"getLineColor",defaultValue:P},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;Object(s.a)(Object(r.a)(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o});var a=n.fp64!==i.fp64;if(a){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),this.getAttributeManager().invalidateAll()}(a||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices)&&this._updateGeometry(n)}},{key:"getGeometry",value:function(e,t){var n=new m({radius:1,height:2,vertices:t,nradial:e}),i=0;if(t)for(var o=0;o<e;o++){var a=t[o];i+=Math.sqrt(a[0]*a[0]+a[1]*a[1])/e}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*i}),n}},{key:"_getModel",value:function(e){return new p.a(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_updateGeometry",value:function(e){var t=e.diskResolution,n=e.vertices,i=this.getGeometry(t,n);this.setState({fillVertexCount:i.attributes.POSITION.value.length/3,wireframeVertexCount:i.indices.value.length}),this.state.model.setProps({geometry:i})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.lineWidthUnits,a=i.lineWidthScale,r=i.lineWidthMinPixels,s=i.lineWidthMaxPixels,l=i.elevationScale,c=i.extruded,u=i.filled,d=i.stroked,g=i.wireframe,p=i.offset,f=i.coverage,h=i.radius,v=i.angle,m=this.state,y=m.model,x=m.fillVertexCount,b=m.wireframeVertexCount,P=m.edgeDistance,C="pixels"===o?n.distanceScales.metersPerPixel[2]:1;y.setUniforms(Object.assign({},t,{radius:h,angle:v/180*Math.PI,offset:p,extruded:c,coverage:f,elevationScale:l,edgeDistance:P,widthScale:a*C,widthMinPixels:r,widthMaxPixels:s})),c&&g&&(y.setProps({isIndexed:!0}),y.setVertexCount(b).setDrawMode(1).setUniforms({isStroke:!0}).draw()),u&&(y.setProps({isIndexed:!1}),y.setVertexCount(x).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!c&&d&&(y.setProps({isIndexed:!1}),y.setVertexCount(2*x/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var a=this.props,r=a.data,s=a.getPosition,l=e.value,u=n*e.size,d=Object(c.a)(r,n,i),g=d.iterable,p=d.objectInfo,f=!0,h=!1,v=void 0;try{for(var m,y=g[Symbol.iterator]();!(f=(m=y.next()).done);f=!0){var b=m.value;p.index++;var P=s(b,p);l[u++]=x(P[0]),l[u++]=x(P[1])}}catch(e){h=!0,v=e}finally{try{f||null==y.return||y.return()}finally{if(h)throw v}}}else e.value=new Float32Array(2)}}]),t}(u.a);w.layerName="ColumnLayer",w.defaultProps=C},3758:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var i=n(30),o=n(28),a=n(53),r=n(48),s=n(785),l=n(54),c=n(3746),u=n(3718),d=n(3943),g=n(3818),p=n(3778),f=d.a.fp64LowPart,h=[0,0,0,255],v={radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,fp64:!1,filled:!0,getPosition:{type:"accessor",value:function(e){return e.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:h},getLineColor:{type:"accessor",value:h},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},m=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(e){return{vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  float outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity) / 255.;\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  } \n  if (distToCenter > innerUnitRadius) {\n    gl_FragColor = vLineColor;\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:4,transition:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;if(Object(s.a)(Object(r.a)(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o}),n.fp64!==i.fp64){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.radiusScale,a=i.radiusMinPixels,r=i.radiusMaxPixels,s=i.stroked,l=i.filled,c=i.lineWidthUnits,u=i.lineWidthScale,d=i.lineWidthMinPixels,g=i.lineWidthMaxPixels,p="pixels"===c?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{stroked:s?1:0,filled:l,radiusScale:o,radiusMinPixels:a,radiusMaxPixels:r,lineWidthScale:u*p,lineWidthMinPixels:d,lineWidthMaxPixels:g})).draw()}},{key:"_getModel",value:function(e){return new g.a(e,Object.assign(this.getShaders(),{id:this.props.id,geometry:new p.a({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var a=this.props,r=a.data,s=a.getPosition,l=e.value,u=n*e.size,d=Object(c.a)(r,n,i),g=d.iterable,p=d.objectInfo,h=!0,v=!1,m=void 0;try{for(var y,x=g[Symbol.iterator]();!(h=(y=x.next()).done);h=!0){var b=y.value;p.index++;var P=s(b,p);l[u++]=f(P[0]),l[u++]=f(P[1])}}catch(e){v=!0,m=e}finally{try{h||null==x.return||x.return()}finally{if(v)throw m}}}else e.value=new Float32Array(2)}}]),t}(u.a);m.layerName="ScatterplotLayer",m.defaultProps=v},3762:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(30),o=n(53),a=n(48),r=n(15),s=n(54),l={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},c=function(e){function t(e){var n;return Object(i.a)(this,t),n=Object(o.a)(this,Object(a.a)(t).call(this,e)),e=Object.assign({},l,e),Object.assign(Object(r.a)(n),e),n}return Object(s.a)(t,e),t}((function e(){Object(i.a)(this,e)}))},3810:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return g}));var i=n(3723),o=n(1),a=n.n(o),r=n(3700),s=n(3694),l=n(3704),c=n(3701);function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function d(e){return e.object.extraProps&&a.a.createElement("div",{className:"deckgl-tooltip"},Object.keys(e.object.extraProps).map((t,n)=>a.a.createElement(c.a,{key:"prop-"+n,label:t+": ",value:""+e.object.extraProps[t]})))}function g(e,t,n,o){const a=e,l=a.color_picker,c=[l.r,l.g,l.b,255*l.a];let g=t.data.features.map(e=>u({},e,{path:e.path,width:a.line_width,color:c}));if(a.js_data_mutator){g=Object(s.a)(a.js_data_mutator)(g)}return new i.a(u({id:"path-layer-"+a.slice_id,getColor:e=>e.color,getPath:e=>e.path,getWidth:e=>e.width,data:g,rounded:!0,widthScale:1},Object(r.a)(a,o,d)))}t.default=Object(l.b)(g,(function(e){let t=[];return e.forEach(e=>{t=t.concat(e.path)}),t}))},3819:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return ge}));var i=n(30),o=n(28),a=n(53),r=n(48),s=n(54),l=n(3728),c=n(3717),u=n(785),d=n(3762),g=n(3691),p=n(3696),f=n(3942),h=n(3943),v=n(3687),m=n(3726),y=n(3746),x=v.a.count,b=h.a.fp64LowPart;function P(e){return Number.isFinite(e)?e:0}function C(e){var t=e.data,n=e.getPosition,i=e.cellSizeMeters,o=e.gpuGridAggregator,a=e.gpuAggregation,r=e.aggregationFlags,s=e.weightParams,l=e.fp64,c=void 0!==l&&l,u=e.coordinateSystem,d=void 0===u?m.a.LNGLAT:u,p=e.viewport,h=void 0===p?null:p,v=e.boundingBox,C=void 0===v?null:v,S={};r.dataChanged&&(C=(S=function(e,t,n){var i,o,a=x(e),r=new Float64Array(2*a),s=new Float32Array(2*a),l=1/0,c=-1/0,u=1/0,d=-1/0,g={};for(var p in n)g[p]=Object.assign({},n[p],{values:new Float32Array(3*a)});var f=Object(y.a)(e),h=f.iterable,v=f.objectInfo,m=!0,C=!1,w=void 0;try{for(var S,_=h[Symbol.iterator]();!(m=(S=_.next()).done);m=!0){var M=S.value;v.index++;var j=t(M,v),O=v.index;for(var A in o=j[0],i=j[1],r[2*O]=o,r[2*O+1]=i,s[2*O]=b(o),s[2*O+1]=b(i),n){var k=n[A].getWeight(M);Array.isArray(k)?(g[A].values[3*O]=k[0],g[A].values[3*O+1]=k[1],g[A].values[3*O+2]=k[2]):g[A].values[3*O]=k}Number.isFinite(i)&&Number.isFinite(o)&&(l=i<l?i:l,c=i>c?i:c,u=o<u?o:u,d=o>d?o:d)}}catch(e){C=!0,w=e}finally{try{m||null==_.return||_.return()}finally{if(C)throw w}}var L={xMin:P(u),xMax:P(d),yMin:P(l),yMax:P(c)};return{positions:r,positions64xyLow:s,weights:g,boundingBox:L}}(t,n,s)).boundingBox);var _=[i,i],M=[0,0];switch(g.a.assert(d===m.a.LNGLAT||d===m.a.IDENTITY),d){case m.a.LNGLAT:case m.a.LNGLAT_DEPRECATED:var j=function(e,t){var n=e.yMin,i=e.yMax;return function(e,t){var n=(r=e,r/6378e3*(180/Math.PI)),i=(o=t,a=e,a/6378e3*(180/Math.PI)/Math.cos(o*Math.PI/180));var o,a;var r;return{yOffset:n,xOffset:i}}(t,(n+i)/2)}(C,i);_=[j.xOffset,j.yOffset],M=[-180,-90];break;case m.a.IDENTITY:M=[-h.width/2,-h.height/2];break;default:g.a.assert(!1)}var O=function(e){var t=e.boundingBox,n=e.cellSize,i=e.worldOrigin,o=t.yMin,a=t.yMax,r=t.xMin,s=t.xMax,l=w(r-i[0],n[0])+i[0],c=w(o-i[1],n[1])+i[1],u=(new f.a).translate([-1*l,-1*c,0]),d=[l,c],g=s-r+n[0],p=a-o+n[1],h=[Math.ceil(g/n[0]),Math.ceil(p/n[1])];return{gridOrigin:d,gridSize:h,width:g,height:p,gridTransformMatrix:u}}({boundingBox:C,cellSize:_,worldOrigin:M});return{weights:o.run({positions:S.positions,positions64xyLow:S.positions64xyLow,weights:S.weights,cellSize:_,width:O.width,height:O.height,gridTransformMatrix:O.gridTransformMatrix,useGPU:a,changeFlags:r,fp64:c}),gridSize:O.gridSize,gridOrigin:O.gridOrigin,cellSize:_,boundingBox:C}}function w(e,t){var n=e<0?-1:1,i=n<0?Math.abs(e)+t:Math.abs(e);return(i=Math.floor(i/t)*t)*n}var S=n(3707),_=n(3718),M=n(3818),j=n(163),O=n(3778),A=n(3932),k=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),L=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),E=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),F=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),D={POSITION:{size:3,value:new Float32Array(L)},NORMAL:{size:3,value:new Float32Array(E)},TEXCOORD_0:{size:2,value:new Float32Array(F)}},R=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.id,o=void 0===n?Object(A.c)("cube-geometry"):n;return Object(a.a)(this,Object(r.a)(t).call(this,Object(j.a)({},e,{id:o,indices:{size:1,value:new Uint16Array(k)},attributes:Object(j.a)({},D,e.attributes)})))}return Object(s.a)(t,e),t}(O.a),z=h.a.fp64LowPart,T=new d.a,N={colorDomain:null,colorRange:S.b,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",min:0,value:[1,1]},gridOrigin:{type:"array",min:0,value:[0,0]},gridOffset:{type:"array",min:0,value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",min:0,value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,fp64:!1,material:T},I=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(){return{vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec2 centroidPosition64xyLow = vec2(instancePositionXFP64[1], instancePositionYFP64[1]);\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:["project32","gouraud-lighting","picking","fp64"]}}},{key:"initializeState",value:function(){var e=this.context.gl;this.getAttributeManager().addInstanced({colors:{size:4,update:this.calculateColors,noAlloc:!0},elevations:{size:4,update:this.calculateElevations,noAlloc:!0}});var t=this._getModel(e);this._setupUniformBuffer(t),this.setState({model:t})}},{key:"_getModel",value:function(e){return new M.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new R,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.data,o=n.cellSize,a=n.offset,r=n.extruded,s=n.elevationScale,l=n.coverage,c=n.gridSize,u=n.gridOrigin,d=n.gridOffset,g=n.colorRange,p=n.elevationRange,f=[z(u[0]),z(u[1])],h=[z(d[0]),z(d[1])],v=i.color.maxMinBuffer,m=i.elevation.maxMinBuffer;v.bind({target:35345,index:0}),m.bind({target:35345,index:1});var y=this.getDomainUniforms();this.state.model.setUniforms(Object.assign({},t,y,{cellSize:o,offset:a,extruded:r,elevationScale:s,coverage:l,gridSize:c,gridOrigin:u,gridOriginLow:f,gridOffset:d,gridOffsetLow:h,colorRange:g,elevationRange:p})).draw(),v.unbind({target:35345,index:0}),m.unbind({target:35345,index:1})}},{key:"calculateColors",value:function(e){var t=this.props.data;e.update({buffer:t.color.aggregationBuffer})}},{key:"calculateElevations",value:function(e){var t=this.props.data;e.update({buffer:t.elevation.aggregationBuffer})}},{key:"getDomainUniforms",value:function(){var e=this.props,t=e.colorDomain,n=e.elevationDomain,i={};return null!==t?(i.colorDomainValid=!0,i.colorDomain=t):i.colorDomainValid=!1,null!==n?(i.elevationDomainValid=!0,i.elevationDomain=n):i.elevationDomainValid=!1,i}},{key:"_setupUniformBuffer",value:function(e){var t=this.context.gl,n=e.program.handle,i=t.getUniformBlockIndex(n,"ColorData"),o=t.getUniformBlockIndex(n,"ElevationData");t.uniformBlockBinding(n,i,0),t.uniformBlockBinding(n,o,1)}}]),t}(_.a);I.layerName="GPUGridCellLayer",I.defaultProps=N;var V=n(62);function B(e,t,n){var i=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o=1/0,a=-1/0,r=Object(y.a)(t),s=r.iterable,l=r.objectInfo,c=!0,u=!1,d=void 0;try{for(var g,p=s[Symbol.iterator]();!(c=(g=p.next()).done);c=!0){var f=g.value;l.index++,e=i(f,l)[1],Number.isFinite(e)&&(o=e<o?e:o,a=e>a?e:a)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}var h=(o+a)/2,v=U(n,h);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var m={};l.index=-1;var x=!0,b=!1,P=void 0;try{for(var C,w=s[Symbol.iterator]();!(x=(C=w.next()).done);x=!0){var S=C.value;l.index++;var _=i(S,l),M=Object(V.a)(_,2),j=M[0],O=M[1];if(Number.isFinite(O)&&Number.isFinite(j)){var A=Math.floor((O+90)/v.yOffset),k=Math.floor((j+180)/v.xOffset),L="".concat(A,"-").concat(k);m[L]=m[L]||{count:0,points:[]},m[L].count+=1,m[L].points.push(S)}}}catch(e){b=!0,P=e}finally{try{x||null==w.return||w.return()}finally{if(b)throw P}}return{gridHash:m,gridOffset:v}}(e,t,n),o=i.gridHash,a=i.gridOffset;return{gridHash:o,gridOffset:a,layerData:function(e,t){return Object.keys(e).reduce((function(n,i,o){var a=i.split("-"),r=parseInt(a[0],10),s=parseInt(a[1],10);return n.push(Object.assign({index:o,position:[t.xOffset*s-180,t.yOffset*r-90]},e[i])),n}),[])}(o,a)}}function U(e,t){var n;return{yOffset:e/6378e3*(180/Math.PI),xOffset:(n=t,e/6378e3*(180/Math.PI)/Math.cos(n*Math.PI/180))}}var W=new d.a,G={colorDomain:null,colorRange:S.b,getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(e){return e.position}},extruded:!1,fp64:!1,material:W,gpuAggregation:!0},q=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"initializeState",value:function(){var e=this.context.gl,t=c.a.isSupported(e);t||g.a.error("GPUGridLayer is not supported on this browser, use GridLayer instead")();var n={id:"".concat(this.id,"-gpu-aggregator"),shaderCache:this.context.shaderCache};this.state={gpuGridAggregator:new c.a(e,n),isSupported:t}}},{key:"updateState",value:function(e){var t=this.getAggregationFlags(e);t&&(this.getLayerData(t),this.setState({gridHash:null}))}},{key:"finalizeState",value:function(){Object(u.a)(Object(r.a)(t.prototype),"finalizeState",this).call(this),this.state.gpuGridAggregator.delete()}},{key:"getAggregationFlags",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags,o=null;return!!this.state.isSupported&&(this.isDataChanged({oldProps:t,props:n,changeFlags:i})&&(o=Object.assign({},o,{dataChanged:!0})),t.cellSize!==n.cellSize&&(o=Object.assign({},o,{cellSizeChanged:!0})),o)}},{key:"isDataChanged",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags;return!!i.dataChanged||(t.gpuAggregation!==n.gpuAggregation||(t.colorAggregation!==n.colorAggregation||t.elevationAggregation!==n.elevationAggregation||!(!i.updateTriggersChanged||!(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition||i.updateTriggersChanged.getColorWeight||i.updateTriggersChanged.getElevationWeight))))}},{key:"getHashKeyForIndex",value:function(e){var t=this.state,n=t.gridSize,i=t.gridOrigin,o=t.cellSize,a=Math.floor(e/n[0]),r=e-a*n[0],s=Math.floor((a*o[1]+i[1]+90+o[1]/2)/o[1]),l=Math.floor((r*o[0]+i[0]+180+o[0]/2)/o[0]);return"".concat(s,"-").concat(l)}},{key:"getPositionForIndex",value:function(e){var t=this.state,n=t.gridSize,i=t.gridOrigin,o=t.cellSize,a=Math.floor(e/n[0]),r=e-a*n[0],s=a*o[1]+i[1];return[r*o[0]+i[0],s]}},{key:"getPickingInfo",value:function(e){var t=e.info,n=e.mode,i=t.index,o=null;if(i>=0){var a=this.state.gpuGridAggregator,r=this.getPositionForIndex(i),s=c.a.getAggregationData(Object.assign({pixelIndex:i},a.getData("color"))),l=c.a.getAggregationData(Object.assign({pixelIndex:i},a.getData("elevation")));if(o={colorValue:s.cellWeight,elevationValue:l.cellWeight,count:s.cellCount||l.cellCount,position:r,totalCount:s.totalCount||l.totalCount},"hover"!==n){var u=this.props,d=u.data,g=u.getPosition,p=this.state.gridHash;if(!p)p=B(d,this.props.cellSize,g).gridHash,this.setState({gridHash:p});var f=p[this.getHashKeyForIndex(i)];Object.assign(o,f)}}return Object.assign(t,{picked:Boolean(o),object:o})}},{key:"getLayerData",value:function(e){var t=this.props,n=t.data,i=t.cellSize,o=t.getPosition,a=t.gpuAggregation,r=t.getColorWeight,s=t.colorAggregation,l=t.getElevationWeight,c=t.elevationAggregation,u=t.fp64,d=C({data:n,cellSizeMeters:i,getPosition:o,weightParams:{color:{getWeight:r,operation:p.a[s]||p.a[G.colorAggregation],needMin:!0,needMax:!0,combineMaxMin:!0},elevation:{getWeight:l,operation:p.a[c]||p.a[G.elevationAggregation],needMin:!0,needMax:!0,combineMaxMin:!0}},gpuAggregation:a,gpuGridAggregator:this.state.gpuGridAggregator,boundingBox:this.state.boundingBox,aggregationFlags:e,fp64:u}),g=d.weights,f=d.gridSize,h=d.gridOrigin,v=d.cellSize,m=d.boundingBox;this.setState({weights:g,gridSize:f,gridOrigin:h,cellSize:v,boundingBox:m})}},{key:"renderLayers",value:function(){if(!this.state.isSupported)return null;var e=this.props,t=e.elevationScale,n=e.fp64,i=e.extruded,o=e.cellSize,a=e.coverage,r=e.material,s=e.elevationRange,l=e.colorDomain,c=e.elevationDomain,u=this.state,d=u.weights,g=u.gridSize,p=u.gridOrigin,f=u.cellSize,h=Object(S.a)(this.props.colorRange,Float32Array,255);return new(this.getSubLayerClass("gpu-grid-cell",I))({gridSize:g,gridOrigin:p,gridOffset:f,colorRange:h,elevationRange:s,colorDomain:l,elevationDomain:c,fp64:n,cellSize:o,coverage:a,material:r,elevationScale:t,extruded:i},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:d,numInstances:g[0]*g[1]})}}]),t}(l.a);q.layerName="GPUGridLayer",q.defaultProps=G;var H=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"getGeometry",value:function(e){return new R}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.elevationScale,o=n.extruded,a=n.offset,r=n.coverage,s=n.cellSize,l=n.angle;this.state.model.setUniforms(Object.assign({},t,{radius:s/2,angle:l,offset:a,extruded:o,coverage:r,elevationScale:i,edgeDistance:1,isWireframe:!1})).draw()}}]),t}(n(3757).a);H.layerName="GridCellLayer",H.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var X=n(3729),Z=n(3730);function J(){}var Y=new d.a,K={colorDomain:null,colorRange:S.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},onSetColorDomain:J,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:1,onSetElevationDomain:J,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(e){return e.position}},extruded:!1,fp64:!1,material:Y},Q=["getColorValue","colorAggregation","getColorWeight"],$=["getElevationValue","elevationAggregation","getElevationWeight"],ee=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"initializeState",value:function(){this.state={layerData:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:J,elevationScaleFunc:J,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(e){var t=this,n=e.oldProps,i=e.props,o=e.changeFlags;this.updateGetValueFuncs(n,i);var a=this.needsReProjectPoints(n,i,o);o.dataChanged||a?this.getLayerData():(this.getDimensionChanges(n,i)||[]).forEach((function(e){return"function"==typeof e&&e.apply(t)}))}},{key:"colorElevationPropsChanged",value:function(e,t){for(var n=!1,i=!1,o=0;o<Q.length;o++){var a=Q[o];e[a]!==t[a]&&(n=!0)}for(var r=0;r<$.length;r++){var s=$[r];e[s]!==t[s]&&(i=!0)}return{colorChanged:n,elevationChanged:i}}},{key:"updateGetValueFuncs",value:function(e,t){var n=t.getColorValue,i=t.getElevationValue,o=this.props,a=o.colorAggregation,r=o.getColorWeight,s=o.elevationAggregation,l=o.getElevationWeight,c=this.colorElevationPropsChanged(e,t),u=c.colorChanged,d=c.elevationChanged;u&&null===n&&(n=Object(p.b)(a,r)),d&&null===i&&(i=Object(p.b)(s,l)),n&&this.setState({getColorValue:n}),i&&this.setState({getElevationValue:i})}},{key:"needsReProjectPoints",value:function(e,t,n){return e.cellSize!==t.cellSize||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(e,t){var n=this.state.dimensionUpdaters,i=[];for(var o in n){var a=n[o].find((function(n){return n.triggers.some((function(n){return e[n]!==t[n]}))}));a&&i.push(a.updater)}return i.length?i:null}},{key:"getPickingInfo",value:function(e){var t=e.info,n=this.state,i=n.sortedColorBins,o=n.sortedElevationBins,a=null;if(t.picked&&t.index>-1){var r=this.state.layerData[t.index],s=i.binMap[r.index]&&i.binMap[r.index].value,l=o.binMap[r.index]&&o.binMap[r.index].value;a=Object.assign({colorValue:s,elevationValue:l},r)}return Object.assign(t,{picked:Boolean(a),object:a})}},{key:"getUpdateTriggers",value:function(){var e=this,t=this.state.dimensionUpdaters,n={},i=function(i){n[i]={};var o=!0,a=!1,r=void 0;try{for(var s,l=t[i][Symbol.iterator]();!(o=(s=l.next()).done);o=!0){s.value.triggers.forEach((function(t){n[i][t]=e.props[t]}))}}catch(e){a=!0,r=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw r}}};for(var o in t)i(o);return n}},{key:"getLayerData",value:function(){var e=this.props,t=B(e.data,e.cellSize,e.getPosition).layerData;this.setState({layerData:t}),this.getSortedBins()}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var e=this.state.getColorValue,t=new X.a(this.state.layerData||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var e=this.state.getElevationValue,t=new X.a(this.state.layerData||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var e=this.props,t=e.lowerPercentile,n=e.upperPercentile,i=e.onSetColorDomain;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var e=this.props,t=e.elevationLowerPercentile,n=e.elevationUpperPercentile,i=e.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var e=this.props.colorRange,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(Z.b)(t,e)}},{key:"getElevationScale",value:function(){var e=this.props.elevationRange,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(Z.a)(t,e)}},{key:"_onGetSublayerColor",value:function(e){var t=this.state,n=t.sortedColorBins,i=t.colorScaleFunc,o=t.colorValueDomain,a=n.binMap[e.index]&&n.binMap[e.index].value,r=this.props.colorDomain||o,s=a>=r[0]&&a<=r[r.length-1]?i(a):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(e){var t=this.state,n=t.sortedElevationBins,i=t.elevationScaleFunc,o=t.elevationValueDomain,a=n.binMap[e.index]&&n.binMap[e.index].value,r=this.props.elevationDomain||o;return a>=r[0]&&a<=r[r.length-1]?i(a):-1}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,n=e.fp64,i=e.extruded,o=e.cellSize,a=e.coverage,r=e.material,s=e.transitions;return new(this.getSubLayerClass("grid-cell",H))({fp64:n,cellSize:o,coverage:a,material:r,elevationScale:t,extruded:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.layerData})}}]),t}(l.a);ee.layerName="CPUGridLayer",ee.defaultProps=K;var te=Object.assign({},q.defaultProps,ee.defaultProps,{gpuAggregation:!1}),ne=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"initializeState",value:function(){this.state={useGPUAggregation:!0}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props,n=(e.changeFlags,{});n.useGPUAggregation=this.canUseGPUAggregation(t),this.setState(n)}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e.updateTriggers,i=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",q):this.getSubLayerClass("CPU",ee))(this.props,this.getSubLayerProps({id:i,updateTriggers:n}),{data:t})}},{key:"canUseGPUAggregation",value:function(e){var t=e.gpuAggregation,n=e.lowerPercentile,i=e.upperPercentile,o=e.getColorValue,a=e.getElevationValue;return!!t&&(!!c.a.isSupported(this.context.gl)&&(0===n&&100===i&&(null===o&&null===a)))}}]),t}(l.a);ne.layerName="GridLayer",ne.defaultProps=te;var ie=n(1),oe=n.n(ie),ae=n(3),re=n(3700),se=n(3694),le=n(3704),ce=n(3701);function ue(){return(ue=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function de(e){return oe.a.createElement("div",{className:"deckgl-tooltip"},oe.a.createElement(ce.a,{label:Object(ae.t)("Longitude and Latitude")+": ",value:e.coordinate[0]+", "+e.coordinate[1]}),oe.a.createElement(ce.a,{label:Object(ae.t)("Height")+": ",value:""+e.object.elevationValue}))}function ge(e,t,n,i){const o=e,a=o.color_picker;let r=t.data.features.map(e=>ue({},e,{color:[a.r,a.g,a.b,255*a.a]}));if(o.js_data_mutator){r=Object(se.a)(o.js_data_mutator)(r)}const s=Object(re.b)(o.js_agg_function,e=>e.weight);return new ne(ue({id:"grid-layer-"+o.slice_id,data:r,pickable:!0,cellSize:o.grid_size,minColor:[0,0,0,0],extruded:o.extruded,maxColor:[a.r,a.g,a.b,255*a.a],outline:!1,getElevationValue:s,getColorValue:s},Object(re.a)(o,i,de)))}t.default=Object(le.b)(ge,(function(e){return e.map(e=>e.position)}))},3821:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return B}));var i=n(1),o=n.n(i),a=n(0),r=n.n(a),s=n(30),l=n(28),c=n(53),u=n(48),d=n(785),g=n(54),p=n(3687),f=n(3746),h=n(3691),v=n(3770),m=n(3718),y=n(3707),x=n(3717),b=n(3696),P=n(3930),C=n(3818),w=n(3778),S=n(3719),_=p.a.count,M=[0,0,0,0],j=[0,255,0,255],O=["minColor","maxColor","colorRange","colorDomain"],A={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:y.b,getPosition:{type:"accessor",value:function(e){return e.position}},getWeight:{type:"accessor",value:function(e){return[1,0,0]}},gpuAggregation:!0,aggregation:"SUM"},k=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(l.a)(t,[{key:"getShaders",value:function(){var e=Object(P.d)(this.context.gl)?{vs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 instancePositions;\nin vec4 instanceCounts;\nin vec3 instancePickingColors;\n\nlayout(std140) uniform;\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform AggregationData\n{\n  vec4 maxCount;\n} aggregationData;\n\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\n\nout vec4 vColor;\nout float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r ;\n  float maxWeight = aggregationData.maxCount.r;\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\nin float vSampleCount;\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  fragColor = vColor;\n\n  fragColor = picking_filterColor(fragColor);\n}\n"}:{vs:"#define SHADER_NAME screen-grid-layer-vertex-shader-webgl1\n#define RANGE_COUNT 6\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform float maxWeight;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#define SHADER_NAME screen-grid-layer-fragment-shader-webgl1\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  gl_FragColor = picking_filterColor(gl_FragColor);\n}\n"};return e.modules=["picking"],e}},{key:"initializeState",value:function(){var e=this.getAttributeManager(),t=this.context.gl;e.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,transition:!0,accessor:["getPosition","getWeight"],update:this.calculateInstanceCounts,noAlloc:!0}});var n={id:"".concat(this.id,"-aggregator"),shaderCache:this.context.shaderCache},i=this._getMaxCountBuffer(t),o={color:{size:1,operation:b.a.SUM,needMax:!0,maxBuffer:i}};this.setState({model:this._getModel(t),gpuGridAggregator:new x.a(t,n),maxBuffer:i,weights:o}),this._setupUniformBuffer()}},{key:"shouldUpdateState",value:function(e){return e.changeFlags.somethingChanged}},{key:"updateState",value:function(e){Object(d.a)(Object(u.a)(t.prototype),"updateState",this).call(this,e),this._updateUniforms(e),e.changeFlags.dataChanged&&this._processData();var n=this._getAggregationChangeFlags(e);n&&this._updateAggregation(n)}},{key:"finalizeState",value:function(){Object(d.a)(Object(u.a)(t.prototype),"finalizeState",this).call(this);var e=this.state,n=e.aggregationBuffer,i=e.maxBuffer;e.gpuGridAggregator.delete(),n&&n.delete(),i&&i.delete()}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.gl,i=this.props.parameters,o=void 0===i?{}:i,a=this.props.minColor||M,r=this.props.maxColor||j,s=this.props.colorDomain||[1,0],l=this.state,c=l.model,u=l.maxBuffer,d=l.cellScale,g=l.shouldUseMinMax,p=l.colorRange,f=l.maxWeight,h={minColor:a,maxColor:r,cellScale:d,colorRange:p,colorDomain:s,shouldUseMinMax:g};Object(P.d)(n)?u.bind({target:35345}):h.maxWeight=f,t=Object.assign(h,t),c.draw({uniforms:t,parameters:Object.assign({depthTest:!1,depthMask:!1},o)}),Object(P.d)(n)&&u.unbind()}},{key:"calculateInstancePositions",value:function(e,t){for(var n=t.numInstances,i=this.context.viewport,o=i.width,a=i.height,r=this.props.cellSizePixels,s=this.state.numCol,l=e.value,c=e.size,u=0;u<n;u++){var d=u%s,g=Math.floor(u/s);l[u*c+0]=d*r/o*2-1,l[u*c+1]=1-g*r/a*2,l[u*c+2]=0}}},{key:"calculateInstanceCounts",value:function(e,t){t.numInstances;var n=this.state.aggregationBuffer;e.update({buffer:n})}},{key:"getPickingInfo",value:function(e){var t=e.info,n=(e.mode,t.index);if(n>=0){var i=this.state.gpuGridAggregator.getData("color");t.object=x.a.getAggregationData(Object.assign({pixelIndex:n},i))}return t}},{key:"_getAggregationChangeFlags",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags,o=n.cellSizePixels!==t.cellSizePixels||n.cellMarginPixels!==t.cellMarginPixels,a=i.dataChanged||n.aggregation!==t.aggregation,r=i.viewportChanged;return o||a||r?{cellSizeChanged:o,dataChanged:a,viewportChanged:r}:null}},{key:"_getModel",value:function(e){return new C.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new w.a({drawMode:6,attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_getMaxCountBuffer",value:function(e){return new S.a(e,{byteLength:16,index:0,accessor:{size:4}})}},{key:"_processData",value:function(){var e=this.props,t=e.data,n=e.getPosition,i=e.getWeight,o=_(t),a=new Float64Array(2*o),r=new Float32Array(3*o),s=this.state.weights,l=Object(f.a)(t),c=l.iterable,u=l.objectInfo,d=!0,g=!1,p=void 0;try{for(var h,v=c[Symbol.iterator]();!(d=(h=v.next()).done);d=!0){var m=h.value;u.index++;var y=n(m,u),x=i(m,u),b=u.index;a[2*b]=y[0],a[2*b+1]=y[1],Array.isArray(x)?(r[3*b]=x[0],r[3*b+1]=x[1],r[3*b+2]=x[2]):r[3*b]=x}}catch(e){g=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(g)throw p}}s.color.values=r,this.setState({positions:a})}},{key:"_setupUniformBuffer",value:function(){var e=this.context.gl;if(Object(P.d)(e)){var t=this.state.model.program.handle,n=e.getUniformBlockIndex(t,"AggregationData");e.uniformBlockBinding(t,n,0)}}},{key:"_shouldUseMinMax",value:function(){var e=this.props,t=e.minColor,n=e.maxColor,i=e.colorDomain,o=e.colorRange;return t||n?(h.a.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!i&&!o}},{key:"_updateAggregation",value:function(e){var t=this.getAttributeManager();(e.cellSizeChanged||e.viewportChanged)&&(this._updateGridParams(),t.invalidateAll());var n=this.props,i=n.cellSizePixels,o=n.gpuAggregation,a=this.state,r=a.positions,s=a.weights,l=this.context.viewport;s.color.operation=b.a[this.props.aggregation.toUpperCase()]||b.a.SUM;var c=!1,u=null;this.context.viewport instanceof v.a?c=!0:(c=!1,u=l.pixelProjectionMatrix);var d=this.state.gpuGridAggregator.run({positions:r,weights:s,cellSize:[i,i],viewport:l,changeFlags:e,useGPU:o,projectPoints:c,gridTransformMatrix:u}),g=d.color.maxData&&Number.isFinite(d.color.maxData[0])?d.color.maxData[0]:0;this.setState({maxWeight:g}),t.invalidate("instanceCounts")}},{key:"_updateUniforms",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags,o={};if(O.some((function(e){return t[e]!==n[e]}))&&(o.shouldUseMinMax=this._shouldUseMinMax()),t.colorRange!==n.colorRange&&(o.colorRange=Object(y.a)(n.colorRange,Float32Array,255)),t.cellMarginPixels!==n.cellMarginPixels||t.cellSizePixels!==n.cellSizePixels||i.viewportChanged){var a=this.context.viewport,r=a.width,s=a.height,l=this.props,c=l.cellSizePixels,u=l.cellMarginPixels,d=c>u?u:0;o.cellScale=new Float32Array([(c-d)/r*2,-(c-d)/s*2,1])}this.setState(o)}},{key:"_updateGridParams",value:function(){var e=this.context.viewport,t=e.width,n=e.height,i=this.props.cellSizePixels,o=this.context.gl,a=Math.ceil(t/i),r=Math.ceil(n/i),s=a*r,l=4*s*4,c=this.state.aggregationBuffer;c&&c.delete(),c=new S.a(o,{byteLength:l,accessor:{size:4,type:5126,divisor:1}}),this.state.weights.color.aggregationBuffer=c,this.setState({numCol:a,numRow:r,numInstances:s,aggregationBuffer:c})}}]),t}(m.a);k.layerName="ScreenGridLayer",k.defaultProps=A;var L=n(3),E=n(3698),F=n(3695),D=n(3694),R=n(3700),z=n(3701),T=n(3690);function N(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(){return(I=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function V(e){return o.a.createElement("div",{className:"deckgl-tooltip"},o.a.createElement(z.a,{label:Object(L.t)("Longitude and Latitude")+": ",value:e.coordinate[0]+", "+e.coordinate[1]}),o.a.createElement(z.a,{label:Object(L.t)("Weight")+": ",value:""+e.object.weight}))}function B(e,t,n,i,o,a,r){const s=e,l=s.color_picker;let c=t.data.features.map(e=>I({},e,{color:[l.r,l.g,l.b,255*l.a]}));if(s.js_data_mutator){const e=Object(D.a)(s.js_data_mutator);c=e(c)}return null!=r&&r.forEach(e=>{c=c.filter(t=>e(t))}),new k(I({id:"screengrid-layer-"+s.slice_id,data:c,pickable:!0,cellSizePixels:s.grid_size,minColor:[l.r,l.g,l.b,0],maxColor:[l.r,l.g,l.b,255*l.a],outline:!1,getWeight:e=>e.weight||0},Object(R.a)(s,i,V)))}const U={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired},W={onAddFilter(){}};class G extends o.a.PureComponent{constructor(e){super(e),N(this,"containerRef",o.a.createRef()),N(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=G.getDerivedStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(e,t){if(t&&e.payload.form_data===t.formData)return null;const n=e.payload.data.features||[],i=n.map(e=>e.__timestamp),o=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:a,end:r,getStep:s,values:l,disabled:c}=Object(F.a)(i,o),{width:u,height:d,formData:g}=e;let{viewport:p}=e;var f;return g.autozoom&&(p=Object(T.a)(p,{width:u,height:d,points:(f=n,f.map(e=>e.position))})),{start:a,end:r,getStep:s,values:l,disabled:c,viewport:p,selected:[],lastClick:0,formData:e.payload.form_data}}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getLayers(e){const t=[];return e[0]===e[1]||e[1]===this.end?t.push(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):t.push(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]),[B(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip)]}render(){const{formData:e,payload:t,setControlValue:n}=this.props;return o.a.createElement("div",null,o.a.createElement(E.a,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,width:this.props.width,height:this.props.height,mapboxApiAccessToken:t.data.mapboxApiKey,mapStyle:e.mapbox_style,setControlValue:n,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange}))}}G.propTypes=U,G.defaultProps=W;t.default=G},3822:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return M}));var i=n(30),o=n(28),a=n(53),r=n(48),s=n(785),l=n(54),c=n(3746),u=n(3718),d=n(3943),g=n(3818),p=n(3778),f="#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",h=d.a.fp64LowPart,v=[0,0,0,255],m={fp64:!1,getSourcePosition:{type:"accessor",value:function(e){return e.sourcePosition}},getTargetPosition:{type:"accessor",value:function(e){return e.targetPosition}},getSourceColor:{type:"accessor",value:v},getTargetColor:{type:"accessor",value:v},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0},getStrokeWidth:{deprecatedFor:"getWidth"}},y=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(){return this.use64bitProjection()?{vs:"#define SHADER_NAME arc-layer-vertex-shader-64\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\n\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\n\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\n\nvec2 paraboloid_fp64(vec2 source[2], vec2 target[2], float ratio) {\n\n  vec2 x[2];\n  vec2_mix_fp64(source, target, ratio, x);\n  vec2 center[2];\n  vec2_mix_fp64(source, target, 0.5, center);\n\n  vec2 dSourceCenter = vec2_distance_fp64(source, center);\n  vec2 dXCenter = vec2_distance_fp64(x, center);\n  return mul_fp64(sum_fp64(dSourceCenter, dXCenter), sub_fp64(dSourceCenter, dXCenter));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvoid get_pos_fp64(vec2 source[2], vec2 target[2], float segmentRatio, out vec2 position[4]) {\n\n  vec2 vertex_height = paraboloid_fp64(source, target, segmentRatio);\n\n  vec2 position_temp[2];\n\n  vec2_mix_fp64(source, target, segmentRatio, position_temp);\n\n  position[0] = position_temp[0];\n  position[1] = position_temp[1];\n\n  if (vertex_height.x < 0.0 || (vertex_height.x == 0.0 && vertex_height.y <= 0.0)) {\n    vertex_height = vec2(0.0, 0.0);\n  }\n\n  position[2] = sqrt_fp64(vertex_height);\n  position[3] = vec2(1.0, 0.0);\n}\n\nvoid main(void) {\n  vec2 projected_source_coord[2];\n  vec2 projected_target_coord[2];\n\n  project_position_fp64(instancePositions.xy, instancePositions64Low.xy, projected_source_coord);\n  project_position_fp64(instancePositions.zw, instancePositions64Low.zw, projected_target_coord);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 curr_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, segmentRatio,\n    curr_pos_modelspace);\n\n  vec2 next_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, nextSegmentRatio,\n    next_pos_modelspace);\n\n  vec4 curr_pos_clipspace = project_common_position_to_clipspace_fp64(curr_pos_modelspace);\n  vec4 next_pos_clipspace = project_common_position_to_clipspace_fp64(next_pos_modelspace);\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n\n  vec2 offset = getExtrusionOffset(next_pos_clipspace.xy - curr_pos_clipspace.xy, positions.y, widthPixels);\n\n  gl_Position = curr_pos_clipspace + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:f,modules:["project64","picking"]}:{vs:"#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertexHeight = sqrt(max(0.0, paraboloid(source, target, segmentRatio))) * instanceHeights;\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target - source);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * vertexHeight * sin(tiltAngle);\n\n  return vec3(\n    mix(source, target, segmentRatio) + tilt,\n    vertexHeight * cos(tiltAngle)\n  );\n}\n\nvoid main(void) {\n  vec2 source = project_position(vec3(instancePositions.xy, 0.0), instancePositions64Low.xy).xy;\n  vec2 target = project_position(vec3(instancePositions.zw, 0.0), instancePositions64Low.zw).xy;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec3 currPos = getPos(source, target, segmentRatio);\n  vec3 nextPos = getPos(source, target, nextSegmentRatio);\n  vec4 curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n  vec4 next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels);\n  gl_Position = curr + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:f,modules:["picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:4,transition:!0,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions},instancePositions64Low:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions64Low},instanceSourceColors:{size:4,type:5121,transition:!0,accessor:"getSourceColor",defaultValue:v},instanceTargetColors:{size:4,type:5121,transition:!0,accessor:"getTargetColor",defaultValue:v},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;if(Object(s.a)(Object(r.a)(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o}),n.fp64!==i.fp64){var a=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(a)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.widthUnits,a=i.widthScale,r=i.widthMinPixels,s=i.widthMaxPixels,l="pixels"===o?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{widthScale:a*l,widthMinPixels:r,widthMaxPixels:s})).draw()}},{key:"_getModel",value:function(e){for(var t=[],n=0;n<50;n++)t=t.concat([n,-1,0,n,1,0]);var i=new g.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new p.a({drawMode:5,attributes:{positions:new Float32Array(t)}}),isInstanced:!0,shaderCache:this.context.shaderCache}));return i.setUniforms({numSegments:50}),i}},{key:"calculateInstancePositions",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.props,a=o.data,r=o.getSourcePosition,s=o.getTargetPosition,l=e.value,u=n*e.size,d=Object(c.a)(a,n,i),g=d.iterable,p=d.objectInfo,f=!0,h=!1,v=void 0;try{for(var m,y=g[Symbol.iterator]();!(f=(m=y.next()).done);f=!0){var x=m.value;p.index++;var b=r(x,p);l[u++]=b[0],l[u++]=b[1];var P=s(x,p);l[u++]=P[0],l[u++]=P[1]}}catch(e){h=!0,v=e}finally{try{f||null==y.return||y.return()}finally{if(h)throw v}}}},{key:"calculateInstancePositions64Low",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var a=this.props,r=a.data,s=a.getSourcePosition,l=a.getTargetPosition,u=e.value,d=n*e.size,g=Object(c.a)(r,n,i),p=g.iterable,f=g.objectInfo,v=!0,m=!1,y=void 0;try{for(var x,b=p[Symbol.iterator]();!(v=(x=b.next()).done);v=!0){var P=x.value;f.index++;var C=s(P,f);u[d++]=h(C[0]),u[d++]=h(C[1]);var w=l(P,f);u[d++]=h(w[0]),u[d++]=h(w[1])}}catch(e){m=!0,y=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw y}}}else e.value=new Float32Array(4)}}]),t}(u.a);y.layerName="ArcLayer",y.defaultProps=m;var x=n(1),b=n.n(x),P=n(3),C=n(3700),w=n(3704),S=n(3701);function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function M(e,t,n,i){const o=t.data.features,a=e.color_picker,r=e.target_color_picker;return new y(_({data:o,getSourceColor:e=>e.sourceColor||e.color||[a.r,a.g,a.b,255*a.a],getTargetColor:e=>e.targetColor||e.color||[r.r,r.g,r.b,255*r.a],id:"path-layer-"+e.slice_id,strokeWidth:e.stroke_width?e.stroke_width:3},Object(C.a)(e,i,(s=e,e=>b.a.createElement("div",{className:"deckgl-tooltip"},b.a.createElement(S.a,{label:Object(P.t)("Start (Longitude, Latitude)")+": ",value:e.object.sourcePosition[0]+", "+e.object.sourcePosition[1]}),b.a.createElement(S.a,{label:Object(P.t)("End (Longitude, Latitude)")+": ",value:e.object.targetPosition[0]+", "+e.object.targetPosition[1]}),s.dimension&&b.a.createElement(S.a,{label:s.dimension+": ",value:""+e.object.cat_color}))))));var s}t.default=Object(w.a)(M,(function(e){const t=[];return e.forEach(e=>{t.push(e.sourcePosition),t.push(e.targetPosition)}),t}))},3823:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return z}));var i=n(30),o=n(28),a=n(53),r=n(48),s=n(54),l=n(3762),c=n(3691),u=n(3728),d=n(3757),g=n(3729),p=n(3707),f=n(3730),h=n(3696),v=Math.PI/3,m=[0,v,2*v,3*v,4*v,5*v];function y(e){return e[0]}function x(e){return e[1]}var b=n(3746);function P(){}var C=new l.a,w={colorDomain:null,colorRange:p.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},onSetColorDomain:P,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},onSetElevationDomain:P,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(e,t){var n=e.data,i=e.radius,o=e.getPosition,a=function(e,t){var n=t.getDistanceScales().pixelsPerMeter;return e*n[0]}(i,t),r=[],s=Object(b.a)(n),l=s.iterable,c=s.objectInfo,u=!0,d=!1,g=void 0;try{for(var p,f=l[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var h=p.value;c.index++,r.push(Object.assign({screenCoord:t.projectFlat(o(h,c))},h))}}catch(e){d=!0,g=e}finally{try{u||null==f.return||f.return()}finally{if(d)throw g}}return{hexagons:function(){var e,t,n,i=0,o=0,a=1,r=1,s=y,l=x;function c(e){var i,o={},a=[],r=e.length;for(i=0;i<r;++i)if(!isNaN(u=+s.call(null,c=e[i],i,e))&&!isNaN(d=+l.call(null,c,i,e))){var c,u,d,g=Math.round(d/=n),p=Math.round(u=u/t-(1&g)/2),f=d-g;if(3*Math.abs(f)>1){var h=u-p,v=p+(u<p?-1:1)/2,m=g+(d<g?-1:1),y=u-v,x=d-m;h*h+f*f>y*y+x*x&&(p=v+(1&g?1:-1)/2,g=m)}var b=p+"-"+g,P=o[b];P?P.push(c):(a.push(P=o[b]=[c]),P.x=(p+(1&g)/2)*t,P.y=g*n)}return a}function u(e){var t=0,n=0;return m.map((function(i){var o=Math.sin(i)*e,a=-Math.cos(i)*e,r=o-t,s=a-n;return t=o,n=a,[r,s]}))}return c.hexagon=function(t){return"m"+u(null==t?e:+t).join("l")+"z"},c.centers=function(){for(var s=[],l=Math.round(o/n),c=Math.round(i/t),u=l*n;u<r+e;u+=n,++l)for(var d=c*t+(1&l)*t/2;d<a+t/2;d+=t)s.push([d,u]);return s},c.mesh=function(){var t=u(e).slice(0,4).join("l");return c.centers().map((function(e){return"M"+e+"m"+t})).join("")},c.x=function(e){return arguments.length?(s=e,c):s},c.y=function(e){return arguments.length?(l=e,c):l},c.radius=function(i){return arguments.length?(t=2*(e=+i)*Math.sin(v),n=1.5*e,c):e},c.size=function(e){return arguments.length?(i=o=0,a=+e[0],r=+e[1],c):[a-i,r-o]},c.extent=function(e){return arguments.length?(i=+e[0][0],o=+e[0][1],a=+e[1][0],r=+e[1][1],c):[[i,o],[a,r]]},c.radius(1)}().radius(a).x((function(e){return e.screenCoord[0]})).y((function(e){return e.screenCoord[1]}))(r).map((function(e,n){return{position:t.unprojectFlat([e.x,e.y]),points:e,index:n}}))}},getPosition:{type:"accessor",value:function(e){return e.position}},fp64:!1,material:C},S=["getColorValue","colorAggregation","getColorWeight"],_=["getElevationValue","elevationAggregation","getElevationWeight"],M=function(e){function t(){return Object(i.a)(this,t),Object(a.a)(this,Object(r.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"initializeState",value:function(){this.state={hexagons:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:P,elevationScaleFunc:P,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(e){var t=this,n=e.oldProps,i=e.props,o=e.changeFlags;this.updateGetValueFuncs(n,i);var a=this.getDimensionChanges(n,i);o.dataChanged||this.needsReProjectPoints(n,i)?this.getHexagons():a&&a.forEach((function(e){return"function"==typeof e&&e.apply(t)}))}},{key:"colorElevationPropsChanged",value:function(e,t){for(var n=!1,i=!1,o=0;o<S.length;o++){var a=S[o];e[a]!==t[a]&&(n=!0)}for(var r=0;r<_.length;r++){var s=_[r];e[s]!==t[s]&&(i=!0)}return{colorChanged:n,elevationChanged:i}}},{key:"updateGetValueFuncs",value:function(e,t){var n=t.getColorValue,i=t.getElevationValue,o=this.props,a=o.colorAggregation,r=o.getColorWeight,s=o.elevationAggregation,l=o.getElevationWeight,c=this.colorElevationPropsChanged(e,t),u=c.colorChanged,d=c.elevationChanged;u&&null===n&&(n=Object(h.b)(a,r)),d&&null===i&&(i=Object(h.b)(s,l)),n&&this.setState({getColorValue:n}),i&&this.setState({getElevationValue:i})}},{key:"needsReProjectPoints",value:function(e,t){return e.radius!==t.radius||e.hexagonAggregator!==t.hexagonAggregator}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(e,t){var n=this.state.dimensionUpdaters,i=[];for(var o in n){var a=n[o].find((function(n){return n.triggers.some((function(n){return e[n]!==t[n]}))}));a&&i.push(a.updater)}return i.length?i:null}},{key:"getHexagons",value:function(){var e=this.props.hexagonAggregator,t=this.context.viewport,n=e(this.props,t),i=n.hexagons,o=n.hexagonVertices;this.updateRadiusAngle(o),this.setState({hexagons:i}),this.getSortedBins()}},{key:"getPickingInfo",value:function(e){var t=e.info,n=this.state,i=n.sortedColorBins,o=n.sortedElevationBins,a=null;if(t.picked&&t.index>-1){var r=this.state.hexagons[t.index],s=i.binMap[r.index]&&i.binMap[r.index].value,l=o.binMap[r.index]&&o.binMap[r.index].value;a=Object.assign({colorValue:s,elevationValue:l},r)}return Object.assign(t,{picked:Boolean(a),object:a})}},{key:"getUpdateTriggers",value:function(){var e=this,t=this.state.dimensionUpdaters,n={},i=function(i){n[i]={};var o=!0,a=!1,r=void 0;try{for(var s,l=t[i][Symbol.iterator]();!(o=(s=l.next()).done);o=!0){s.value.triggers.forEach((function(t){n[i][t]=e.props[t]}))}}catch(e){a=!0,r=e}finally{try{o||null==l.return||l.return()}finally{if(a)throw r}}};for(var o in t)i(o);return n}},{key:"updateRadiusAngle",value:function(e){var t=this.props.radius,n=90;if(Array.isArray(e)){e.length<6&&c.a.error("HexagonCellLayer: hexagonVertices needs to be an array of 6 points")();var i=e[0],o=e[3],a=this.context.viewport.getDistanceScales().pixelsPerMeter,r=this.projectFlat(i),s=this.projectFlat(o),l=r[0]-s[0],u=r[1]-s[1],d=Math.sqrt(l*l+u*u);n=Math.acos(l/d)*-Math.sign(u)/Math.PI*180+90,t=d/2/a[0]}this.setState({angle:n,radius:t})}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var e=this.state.getColorValue,t=new g.a(this.state.hexagons||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var e=this.state.getElevationValue,t=new g.a(this.state.hexagons||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var e=this.props,t=e.lowerPercentile,n=e.upperPercentile,i=e.onSetColorDomain;t>n&&c.a.warn("HexagonLayer: lowerPercentile is bigger than upperPercentile")(),this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var e=this.props,t=e.elevationLowerPercentile,n=e.elevationUpperPercentile,i=e.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var e=this.props.colorRange,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(f.b)(t,e)}},{key:"getElevationScale",value:function(){var e=this.props.elevationRange,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(f.a)(t,e)}},{key:"_onGetSublayerColor",value:function(e){var t=this.state,n=t.sortedColorBins,i=t.colorScaleFunc,o=t.colorValueDomain,a=n.binMap[e.index]&&n.binMap[e.index].value,r=this.props.colorDomain||o,s=a>=r[0]&&a<=r[r.length-1]?i(a):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(e){var t=this.state,n=t.sortedElevationBins,i=t.elevationScaleFunc,o=t.elevationValueDomain,a=n.binMap[e.index]&&n.binMap[e.index].value,r=this.props.elevationDomain||o;return a>=r[0]&&a<=r[r.length-1]?i(a):-1}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,n=e.extruded,i=e.coverage,o=e.material,a=e.fp64,r=e.transitions,s=this.state,l=s.angle,c=s.radius;return new(this.getSubLayerClass("hexagon-cell",d.a))({fp64:a,radius:c,diskResolution:6,elevationScale:t,angle:l,extruded:n,coverage:i,material:o,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:r&&{getFillColor:r.getColorValue||r.getColorWeight,getElevation:r.getElevationValue||r.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.hexagons})}}]),t}(u.a);M.layerName="HexagonLayer",M.defaultProps=w;var j=n(1),O=n.n(j),A=n(3),k=n(3700),L=n(3694),E=n(3704),F=n(3701);function D(){return(D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function R(e){return O.a.createElement("div",{className:"deckgl-tooltip"},O.a.createElement(F.a,{label:Object(A.t)("Centroid (Longitude and Latitude)")+": ",value:"("+e.coordinate[0]+", "+e.coordinate[1]+")"}),O.a.createElement(F.a,{label:Object(A.t)("Height")+": ",value:""+e.object.elevationValue}))}function z(e,t,n,i){const o=e,a=o.color_picker;let r=t.data.features.map(e=>D({},e,{color:[a.r,a.g,a.b,255*a.a]}));if(o.js_data_mutator){r=Object(L.a)(o.js_data_mutator)(r)}const s=Object(k.b)(o.js_agg_function,e=>e.weight);return new M(D({id:"hex-layer-"+o.slice_id,data:r,pickable:!0,radius:o.grid_size,minColor:[0,0,0,0],extruded:o.extruded,maxColor:[a.r,a.g,a.b,255*a.a],outline:!1,getElevationValue:s,getColorValue:s},Object(k.a)(o,i,R)))}t.default=Object(E.b)(z,(function(e){return e.map(e=>e.position)}))},3824:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return T}));var i=n(1),o=n.n(i),a=n(0),r=n.n(a),s=n(30),l=n(28),c=n(53),u=n(48),d=n(54),g=n(3762),p=n(3746),f=n(3728),h=n(3731),v=n(3723),m=n(3721),y=new g.a,x={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,lineDashJustified:!1,fp64:!1,getPolygon:{type:"accessor",value:function(e){return e.polygon}},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},material:y},b=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"initializeState",value:function(){this.state={paths:[]}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props,n=e.changeFlags;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon))&&(this.state.paths=this._getPaths(t))}},{key:"getPickingInfo",value:function(e){var t=e.info;return Object.assign(t,{object:t.object&&t.object.object||t.object})}},{key:"_getPaths",value:function(e){var t=e.data,n=e.getPolygon,i=[],o="XY"===e.positionFormat?2:3,a=Object(p.a)(t),r=a.iterable,s=a.objectInfo,l=!0,c=!1,u=void 0;try{for(var d,g=r[Symbol.iterator]();!(l=(d=g.next()).done);l=!0){var f=d.value;s.index++;var h=m.c(n(f,s),o),v=h.positions,y=h.holeIndices;if(y)for(var x=0;x<=y.length;x++){var b=v.subarray(y[x-1]||0,y[x]||v.length);i.push({path:b,object:f})}else i.push({path:v,object:f})}}catch(e){c=!0,u=e}finally{try{l||null==g.return||g.return()}finally{if(c)throw u}}return i}},{key:"_getAccessor",value:function(e){return"function"==typeof e?function(t){return e(t.object)}:e}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e.stroked,i=e.filled,o=e.extruded,a=e.wireframe,r=e.elevationScale,s=e.transitions,l=this.props,c=l.lineWidthUnits,u=l.lineWidthScale,d=l.lineWidthMinPixels,g=l.lineWidthMaxPixels,p=l.lineJointRounded,f=l.lineMiterLimit,m=l.lineDashJustified,y=l.fp64,x=this.props,b=x.getFillColor,P=x.getLineColor,C=x.getLineWidth,w=x.getLineDashArray,S=x.getElevation,_=x.getPolygon,M=x.updateTriggers,j=x.material,O=this.state.paths,A=this.getSubLayerClass("fill",h.a),k=this.getSubLayerClass("stroke",v.a),L=this.shouldRenderSubLayer("fill",O)&&new A({extruded:o,elevationScale:r,fp64:y,filled:i,wireframe:a,getElevation:S,getFillColor:b,getLineColor:P,material:j,transitions:s},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:M.getPolygon,getElevation:M.getElevation,getFillColor:M.getFillColor,getLineColor:M.getLineColor}}),{data:t,getPolygon:_});return[!o&&L,!o&&n&&this.shouldRenderSubLayer("stroke",O)&&new k({fp64:y,widthUnits:c,widthScale:u,widthMinPixels:d,widthMaxPixels:g,rounded:p,miterLimit:f,dashJustified:m,transitions:s&&{getWidth:s.getLineWidth,getColor:s.getLineColor,getPath:s.getPolygon},getColor:this._getAccessor(P),getWidth:this._getAccessor(C),getDashArray:this._getAccessor(w)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:M.getLineWidth,getColor:M.getLineColor,getDashArray:M.getLineDashArray}}),{data:O,getPath:function(e){return e.path}}),o&&L]}}]),t}(f.a);b.layerName="PolygonLayer",b.defaultProps=x;var P=n(3698),C=n(3705),w=n(3701),S=n(14),_=n(98),M=n(72),j=n(3709);function O(e,t,n){let{break_points:i,num_buckets:o}=e;if(!t)return[];if(void 0===i||0===i.length){const e=o?parseInt(o,10):10,[i,a]=Object(S.extent)(t,n);if(void 0===i)return[];const r=(a-i)/e,s=0===r?0:Math.max(0,Math.ceil(Math.log10(1/r))),l=a>a.toFixed(s)?1:0;return new Array(e+1+l).fill().map((e,t)=>(i+t*r).toFixed(s))}return i.sort((e,t)=>parseFloat(e)-parseFloat(t))}function A(e,t,n){let{break_points:i,num_buckets:o,linear_color_scheme:a,opacity:r}=e;const s=i||o?O({break_points:i,num_buckets:o},t,n):null,l=Array.isArray(a)?new M.SequentialScheme({colors:a,id:"custom"}):Object(M.getSequentialSchemeRegistry)().get(a);let c,u;if(null!==s){const e=s.length-1,t=e>1?l.getColors(e):[l.colors[l.colors.length-1]],n=t[0],i=t[t.length-1];t.unshift(n),t.push(i);const o=s.map(e=>parseFloat(e));c=Object(_.i)().domain(o).range(t),u=t=>t>s[e]||t<s[0]}else c=l.createLinearScale(Object(S.extent)(t,n)),u=()=>!1;return e=>{const t=n(e),i=Object(j.hexToRGB)(c(t));return u(t)?i[3]=0:i[3]=r/100*255,i}}var k=n(3700),L=n(3695),E=n(3694);function F(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}var D=n(3690);function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function z(){return(z=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function T(e,t,n,i,a,r,s){const l=e,c=l.fill_color_picker,u=l.stroke_color_picker;let d=[...t.data.features];if(null!=s&&s.forEach(e=>{d=d.filter(t=>e(t))}),l.js_data_mutator){const e=Object(E.a)(l.js_data_mutator);d=e(d)}const g=l.metric?l.metric.label||l.metric:null,p=null===l.metric?()=>[c.r,c.g,c.b,255*c.a]:A(l,d,e=>e[g]),f=e=>{const t=p(e);return a.length>0&&!a.includes(e[l.line_column])&&(t[3]/=2),t},h=l.line_column&&l.metric&&["json","geohash","zipcode"].includes(l.line_type)?function(e){return t=>{const n=e.metric.label||e.metric;return o.a.createElement("div",{className:"deckgl-tooltip"},t.object.name&&o.a.createElement(w.a,{label:"name: ",value:""+t.object.name}),t.object[e.line_column]&&o.a.createElement(w.a,{label:e.line_column+": ",value:""+t.object[e.line_column]}),e.metric&&o.a.createElement(w.a,{label:n+": ",value:""+t.object[n]}))}}(l):void 0;return new b(z({id:"path-layer-"+l.slice_id,data:d,pickable:!0,filled:l.filled,stroked:l.stroked,getPolygon:F,getFillColor:f,getLineColor:[u.r,u.g,u.b,255*u.a],getLineWidth:l.line_width,extruded:l.extruded,getElevation:e=>function(e,t){return 0===t(e)[3]?0:e.elevation}(e,f),elevationScale:l.multiplier,fp64:!0},Object(k.a)(l,i,h,r)))}const N={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func,width:r.a.number.isRequired,height:r.a.number.isRequired},I={onAddFilter(){}};class V extends o.a.Component{constructor(e){super(e),R(this,"containerRef",o.a.createRef()),R(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=V.getDerivedStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onSelect=this.onSelect.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(e,t){const{width:n,height:i,formData:o,payload:a}=e;if(t&&a.form_data===t.formData)return null;const r=a.data.features||[],s=r.map(e=>e.__timestamp),l=a.form_data.time_grain_sqla||a.form_data.granularity||"P1D",{start:c,end:u,getStep:d,values:g,disabled:p}=Object(L.a)(s,l);let{viewport:f}=e;return o.autozoom&&(f=Object(D.a)(f,{width:n,height:i,points:r.flatMap(F)})),{start:c,end:u,getStep:d,values:g,disabled:p,viewport:f,selected:[],lastClick:0,formData:a.form_data}}onSelect(e){const{formData:t,onAddFilter:n}=this.props,i=new Date,o=i-this.state.lastClick<=250,a=[...this.state.selected];if(o)a.splice(0,a.length,e);else if(t.toggle_polygons){const t=a.indexOf(e);-1===t?a.push(e):a.splice(t,1)}else a.splice(0,1,e);this.setState({selected:a,lastClick:i}),t.table_filter&&n(t.line_column,a,!1,!0)}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getLayers(e){if(void 0===this.props.payload.data.features)return[];const t=[];return e[0]===e[1]||e[1]===this.end?t.push(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):t.push(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]),[T(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip,this.state.selected,this.onSelect,t)]}render(){const{payload:e,formData:t,setControlValue:n}=this.props,{start:i,end:a,getStep:r,values:s,disabled:l,viewport:c}=this.state,u=t,d=u.metric?u.metric.label||u.metric:null,g=function(e,t,n){const i=O(e,t,n),o=A(e,t,n),a={};return i.slice(1).forEach((t,n)=>{const r=i[n]+" - "+i[n+1],s=.5*(parseFloat(i[n])+parseFloat(i[n+1])),l=e.metric?e.metric.label||e.metric:null;a[r]={color:o({[l||e.metric]:s}),enabled:!0}}),a}(t,e.data.features,e=>e[d]);return o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(P.a,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:i,end:a,getStep:r,values:s,disabled:l,viewport:c,width:this.props.width,height:this.props.height,mapboxApiAccessToken:e.data.mapboxApiKey,mapStyle:t.mapbox_style,setControlValue:n,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange},null!==t.metric&&o.a.createElement(C.a,{categories:g,position:t.legend_position,format:t.legend_format})))}}V.propTypes=N,V.defaultProps=I;t.default=V},3826:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return N}));var i=n(1),o=n.n(i),a=n(0),r=n.n(a),s=n(30),l=n(28),c=n(53),u=n(48),d=n(54),g=n(3728),p=n(3758),f=n(3723),h=n(3762),v=n(3731),m=n(3691);function y(e,t,n){var i=e.type,o=e.coordinates,a=t.pointFeatures,r=t.lineFeatures,s=t.polygonFeatures,l=t.polygonOutlineFeatures;if(function(e,t){var n=b[e];m.a.assert(n,"Unknown GeoJSON type ".concat(e));for(;t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(i,o))switch(i){case"Point":a.push({geometry:e,sourceFeature:n});break;case"MultiPoint":o.forEach((function(e){a.push({geometry:{type:"Point",coordinates:e},sourceFeature:n})}));break;case"LineString":r.push({geometry:e,sourceFeature:n});break;case"MultiLineString":o.forEach((function(e){r.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})}));break;case"Polygon":s.push({geometry:e,sourceFeature:n}),o.forEach((function(e){l.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})}));break;case"MultiPolygon":o.forEach((function(e){s.push({geometry:{type:"Polygon",coordinates:e},sourceFeature:n}),e.forEach((function(e){l.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})}))}))}else m.a.warn("".concat(i," coordinates are malformed"))()}function x(e){return e.sourceFeature.feature}var b={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};var P=new h.a,C={stroked:!0,filled:!0,extruded:!1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,elevationScale:1,pointRadiusScale:1,pointRadiusMinPixels:0,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,lineDashJustified:!1,fp64:!1,getLineColor:{type:"accessor",value:[0,0,0,255]},getFillColor:{type:"accessor",value:[0,0,0,255]},getRadius:{type:"accessor",value:1},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},material:P};function w(e){return e.geometry.coordinates}function S(e){return"function"!=typeof e?e:function(t){return e(x(t))}}var _=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"initializeState",value:function(){this.state={features:{}}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props;if(e.changeFlags.dataChanged){var n=function(e){if(Array.isArray(e))return e;switch(m.a.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return m.a.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(t.data);this.state.features=function(e){for(var t={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},n=0;n<e.length;n++){var i=e[n];m.a.assert(i&&i.geometry,"GeoJSON does not have geometry");var o=i.geometry,a={feature:i,index:n};if("GeometryCollection"===o.type){m.a.assert(Array.isArray(o.geometries),"GeoJSON does not have geometries array");for(var r=o.geometries,s=0;s<r.length;s++){y(r[s],t,a)}}else y(o,t,a)}return t}(n)}}},{key:"getPickingInfo",value:function(e){var t,n=e.info;e.sourceLayer;return Object.assign(n,{object:n.object?x(n.object):n.object,index:n.object?(t=n.object,t.sourceFeature.index):n.index})}},{key:"renderLayers",value:function(){var e=this.state.features,t=e.pointFeatures,n=e.lineFeatures,i=e.polygonFeatures,o=e.polygonOutlineFeatures,a=this.props,r=a.stroked,s=a.filled,l=a.extruded,c=a.wireframe,u=a.material,d=a.transitions,g=this.props,h=g.lineWidthUnits,m=g.lineWidthScale,y=g.lineWidthMinPixels,x=g.lineWidthMaxPixels,b=g.lineJointRounded,P=g.lineMiterLimit,C=g.pointRadiusScale,_=g.pointRadiusMinPixels,M=g.pointRadiusMaxPixels,j=g.elevationScale,O=g.lineDashJustified,A=g.fp64,k=this.props,L=k.getLineColor,E=k.getFillColor,F=k.getRadius,D=k.getLineWidth,R=k.getLineDashArray,z=k.getElevation,T=k.updateTriggers,N=this.getSubLayerClass("polygons-fill",v.a),I=this.getSubLayerClass("polygons-stroke",f.a),V=this.getSubLayerClass("line-strings",f.a),B=this.getSubLayerClass("points",p.a),U=this.shouldRenderSubLayer("polygons-fill",i)&&new N({fp64:A,extruded:l,elevationScale:j,filled:s,wireframe:c,material:u,getElevation:S(z),getFillColor:S(E),getLineColor:S(L),transitions:d&&{getPolygon:d.geometry,getElevation:d.getElevation,getFillColor:d.getFillColor,getLineColor:d.getLineColor}},this.getSubLayerProps({id:"polygons-fill",updateTriggers:{getElevation:T.getElevation,getFillColor:T.getFillColor,getLineColor:T.getLineColor}}),{data:i,getPolygon:w});return[!l&&U,!l&&r&&this.shouldRenderSubLayer("polygons-stroke",o)&&new I({fp64:A,widthUnits:h,widthScale:m,widthMinPixels:y,widthMaxPixels:x,rounded:b,miterLimit:P,dashJustified:O,getColor:S(L),getWidth:S(D),getDashArray:S(R),transitions:d&&{getPath:d.geometry,getColor:d.getLineColor,getWidth:d.getLineWidth}},this.getSubLayerProps({id:"polygons-stroke",updateTriggers:{getColor:T.getLineColor,getWidth:T.getLineWidth,getDashArray:T.getLineDashArray}}),{data:o,getPath:w}),this.shouldRenderSubLayer("linestrings",n)&&new V({fp64:A,widthUnits:h,widthScale:m,widthMinPixels:y,widthMaxPixels:x,rounded:b,miterLimit:P,dashJustified:O,getColor:S(L),getWidth:S(D),getDashArray:S(R),transitions:d&&{getPath:d.geometry,getColor:d.getLineColor,getWidth:d.getLineWidth}},this.getSubLayerProps({id:"line-strings",updateTriggers:{getColor:T.getLineColor,getWidth:T.getLineWidth,getDashArray:T.getLineDashArray}}),{data:n,getPath:w}),this.shouldRenderSubLayer("points",t)&&new B({fp64:A,stroked:r,filled:s,radiusScale:C,radiusMinPixels:_,radiusMaxPixels:M,lineWidthUnits:h,lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:x,getFillColor:S(E),getLineColor:S(L),getRadius:S(F),getLineWidth:S(D),transitions:d&&{getPosition:d.geometry,getFillColor:d.getFillColor,getLineColor:d.getLineColor,getRadius:d.getRadius,getLineWidth:d.getLineWidth}},this.getSubLayerProps({id:"points",updateTriggers:{getFillColor:T.getFillColor,getLineColor:T.getLineColor,getRadius:T.getRadius,getLineWidth:T.getLineWidth}}),{data:t,getPosition:w}),l&&U]}}]),t}(g.a);_.layerName="GeoJsonLayer",_.defaultProps=C;var M=n(3697),j=n(3709),O=n(3694),A=n(3700),k=n(3701);function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(){return(E=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}const F={fillColor:"fillColor",color:"fillColor",fill:"fillColor","fill-color":"fillColor",strokeColor:"strokeColor","stroke-color":"strokeColor","stroke-width":"strokeWidth"},D=(e,t)=>{const n={};return Object.keys(e).forEach(t=>{t in F?n[F[t]]=e[t]:n[t]=e[t]}),"string"==typeof e.fillColor&&(n.fillColor=Object(j.hexToRGB)(e.fillColor)),"string"==typeof e.strokeColor&&(n.strokeColor=Object(j.hexToRGB)(e.strokeColor)),E({},n,{},t)};let R;const z=(e,t,n)=>{if(e&&e.features&&e.features.forEach(i=>{z(i,t,e.extraProps||n)}),e&&e.geometry){const i=E({},e,{properties:D(e.properties,t)});i.extraProps||(i.extraProps=n),R.push(i)}};function T(e){return e.object.extraProps&&o.a.createElement("div",{className:"deckgl-tooltip"},Object.keys(e.object.extraProps).map((t,n)=>o.a.createElement(k.a,{key:"prop-"+n,label:t+": ",value:""+e.object.extraProps[t]})))}function N(e,t,n,i){const o=e,a=o.fill_color_picker,r=o.stroke_color_picker,s=[a.r,a.g,a.b,255*a.a],l=[r.r,r.g,r.b,255*r.a],c={};let u;return s[3]>0&&(c.fillColor=s),l[3]>0&&(c.strokeColor=l),R=[],z(t.data,c),o.js_data_mutator&&(u=Object(O.a)(o.js_data_mutator),R=u(R)),new _(E({id:"geojson-layer-"+o.slice_id,filled:o.filled,data:R,stroked:o.stroked,extruded:o.extruded,pointRadiusScale:o.point_radius_scale},Object(A.a)(o,i,T)))}const I={formData:r.a.object.isRequired,payload:r.a.object.isRequired,setControlValue:r.a.func.isRequired,viewport:r.a.object.isRequired,onAddFilter:r.a.func},V={onAddFilter(){}};class B extends o.a.Component{constructor(){super(...arguments),L(this,"containerRef",o.a.createRef()),L(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})}render(){const{formData:e,payload:t,setControlValue:n,onAddFilter:i,viewport:a}=this.props,r=N(e,t,0,this.setTooltip);return o.a.createElement(M.a,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:a,layers:[r],mapStyle:e.mapbox_style,setControlValue:n})}}B.propTypes=I,B.defaultProps=V;t.default=B},3827:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return d}));var i=n(3758),o=n(1),a=n.n(o),r=n(3),s=n(3700),l=n(3704),c=n(3701);function u(){return(u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function d(e,t,n,o){const l=e,d=t.data.features.map(e=>{let t=(n=l.point_unit,i=e.radius,("square_m"===n?Math.sqrt(i/Math.PI):"radius_m"===n?i:"radius_km"===n?1e3*i:"radius_miles"===n?1609.34*i:"square_km"===n?1e3*Math.sqrt(i/Math.PI):"square_miles"===n?1609.34*Math.sqrt(i/Math.PI):null)||10);var n,i;if(l.multiplier&&(t*=l.multiplier),e.color)return u({},e,{radius:t});const o=l.color_picker||{r:0,g:0,b:0,a:1};return u({},e,{radius:t,color:[o.r,o.g,o.b,255*o.a]})});return new i.a(u({id:"scatter-layer-"+l.slice_id,data:d,fp64:!0,getFillColor:e=>e.color,getRadius:e=>e.radius,radiusMinPixels:l.min_radius||null,radiusMaxPixels:l.max_radius||null,stroked:!1},Object(s.a)(l,o,function(e){return t=>a.a.createElement("div",{className:"deckgl-tooltip"},a.a.createElement(c.a,{label:Object(r.t)("Longitude and Latitude")+": ",value:t.object.position[0]+", "+t.object.position[1]}),t.object.cat_color&&a.a.createElement(c.a,{label:Object(r.t)("Category")+": ",value:""+t.object.cat_color}),t.object.metric&&a.a.createElement(c.a,{label:e.point_radius_fixed.value.label+": ",value:""+t.object.metric}))}(l))))}t.default=Object(l.a)(d,(function(e){return e.map(e=>e.position)}))},3941:function(e,t,n){"use strict";n.r(t);var i=n(1),o=n.n(i),a=n(261),r=n.n(a),s=n(0),l=n.n(s),c=n(31),u=n(3697),d=n(391),g=n.n(d);function p(e,t,n,i){if(void 0===n&&(n=!0),void 0===i&&(i={}),!e.datasource)return null;const o=new g.a("/"),a=function(e,t){void 0===t&&(t="base");let n="/superset/explore/";return["json","csv","query","results","samples"].includes(t)&&(n="/superset/explore_json/"),n}(0,t),r=o.search(!0);Object.keys(i).forEach(e=>{r[e]=i[e]}),r.form_data=function(e){const t=new Set;return JSON.stringify(e,(e,n)=>{if("object"==typeof n&&null!==n){if(t.has(n))try{return JSON.parse(JSON.stringify(n))}catch(e){return}t.add(n)}return n})}(e),"standalone"===t&&(r.standalone="true");const s=o.directory(a).search(r).toString();if(!n&&s.length>8e3){return p({datasource:e.datasource,viz_type:e.viz_type},t,!1,{URL_IS_TOO_LONG_TO_SHARE:null})}return s}var f=n(3819),h=n(3821),v=n(3810),m=n(3823),y=n(3827),x=n(3826),b=n(3822),P=n(3824);var C={deck_grid:f.getLayer,deck_screengrid:h.getLayer,deck_path:v.getLayer,deck_hex:m.getLayer,deck_scatter:y.getLayer,deck_geojson:x.getLayer,deck_arc:b.getLayer,deck_polygon:P.getLayer};function w(){return(w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function S(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const _={formData:l.a.object.isRequired,payload:l.a.object.isRequired,setControlValue:l.a.func.isRequired,viewport:l.a.object.isRequired,onAddFilter:l.a.func,onSelect:l.a.func},M={onAddFilter(){},onSelect(){}};class j extends o.a.PureComponent{constructor(e){super(e),S(this,"containerRef",o.a.createRef()),S(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state={subSlicesLayers:{}},this.onViewportChange=this.onViewportChange.bind(this)}componentDidMount(){const{formData:e,payload:t}=this.props;this.loadLayers(e,t)}UNSAFE_componentWillReceiveProps(e){const{formData:t,payload:n}=e;!r.a.isEqual(this.props.formData.deck_slices,e.formData.deck_slices)&&this.loadLayers(t,n)}onViewportChange(e){this.setState({viewport:e})}loadLayers(e,t,n){this.setState({subSlicesLayers:{},viewport:n}),t.data.slices.forEach(t=>{const n=[...t.form_data.filters||[],...e.filters||[],...e.extra_filters||[]],i=w({},t,{form_data:w({},t.form_data,{filters:n})});c.SupersetClient.get({endpoint:p(i.form_data,"json")}).then(e=>{let{json:t}=e;const n=C[i.form_data.viz_type](i.form_data,t,this.props.onAddFilter,this.setTooltip,[],this.props.onSelect);this.setState({subSlicesLayers:w({},this.state.subSlicesLayers,{[i.slice_id]:n})})}).catch(()=>{})})}render(){const{payload:e,formData:t,setControlValue:n}=this.props,{subSlicesLayers:i}=this.state,a=Object.values(i);return o.a.createElement(u.a,{ref:this.containerRef,mapboxApiAccessToken:e.data.mapboxApiKey,viewport:this.state.viewport||this.props.viewport,layers:a,mapStyle:t.mapbox_style,setControlValue:n,onViewportChange:this.onViewportChange})}}j.propTypes=_,j.defaultProps=M;t.default=j}}]);