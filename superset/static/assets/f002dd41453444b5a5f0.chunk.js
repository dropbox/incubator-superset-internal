"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[9313,6871,1261],{78918:(e,t,i)=>{i.d(t,{Z:()=>a});var r=i(95772),o=i(63803),s=i(61855);class a extends r.Z{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((e=>e.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id?(e.object=t.__source.object,e.index=t.__source.index,e):e}renderLayers(){return null}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){const{_subLayerProps:i}=this.props;return t&&t.length||i&&i[e]}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if("function"==typeof e){const t={data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,r)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:i,visible:r,parameters:o,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:n,highlightColor:l,coordinateSystem:g,coordinateOrigin:p,wrapLongitude:c,positionFormat:d,modelMatrix:h,extensions:u,fetch:f,_subLayerProps:y}=this.props,m={opacity:t,pickable:i,visible:r,parameters:o,getPolygonOffset:s,highlightedObjectIndex:a,autoHighlight:n,highlightColor:l,coordinateSystem:g,coordinateOrigin:p,wrapLongitude:c,positionFormat:d,modelMatrix:h,extensions:u,fetch:f},b=y&&y[e.id],_=b&&b.updateTriggers,L=e.id||"sublayer";if(b){const t=this.constructor._propTypes,i=e.type?e.type._propTypes:{};for(const e in b){const r=i[e]||t[e];r&&"accessor"===r.type&&(b[e]=this.getSubLayerAccessor(b[e]))}}Object.assign(m,e,b),m.id="".concat(this.props.id,"-").concat(L),m.updateTriggers={all:this.props.updateTriggers.all,...e.updateTriggers,..._};for(const e of u){const t=e.getSubLayerProps.call(this,e);t&&Object.assign(m,t,{updateTriggers:Object.assign(m.updateTriggers,t.updateTriggers)})}return m}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:e}=this.internalState;const t=!e||this.needsUpdate();t&&(e=this.renderLayers(),e=(0,s.x)(e,Boolean),this.internalState.subLayers=e),(0,o.Z)("compositeLayer.renderLayers",this,t,e);for(const t of e)t.parent=this}}a.layerName="CompositeLayer"},36665:(e,t,i)=>{i.d(t,{Z:()=>d});var r=i(67294),o=i(45697),s=i.n(o),a=i(51995),n=i(67190),l=i(11965);const g=a.iK.div`
  ${({theme:e})=>`\n    font-size: ${e.typography.sizes.s}px;\n    position: absolute;\n    background: ${e.colors.grayscale.light5};\n    box-shadow: 0 0 ${e.gridUnit}px ${e.colors.grayscale.light2};\n    margin: ${6*e.gridUnit}px;\n    padding: ${3*e.gridUnit}px ${5*e.gridUnit}px;\n    outline: none;\n    overflow-y: scroll;\n    max-height: 200px;\n\n    & ul {\n      list-style: none;\n      padding-left: 0;\n      margin: 0;\n\n      & li a {\n        color: ${e.colors.grayscale.base};\n        text-decoration: none;\n\n        & span {\n          margin-right: ${3*e.gridUnit}px;\n        }\n      }\n    }\n  `}
`,p=" - ",c={categories:s().object,forceCategorical:s().bool,format:s().string,position:s().oneOf([null,"tl","tr","bl","br"]),showSingleCategory:s().func,toggleCategory:s().func};class d extends r.PureComponent{format(e){if(!this.props.format||this.props.forceCategorical)return e;const t=parseFloat(e);return(0,n.uf)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(p)){const t=e.split(p);return this.format(t[0])+p+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map((([e,t])=>{const i={color:`rgba(${t.color.join(", ")})`},r=t.enabled?"◼":"◻";return(0,l.tZ)("li",{key:e},(0,l.tZ)("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},(0,l.tZ)("span",{style:i},r)," ",this.formatCategoryLabel(e)))})),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return(0,l.tZ)(g,{style:t},(0,l.tZ)("ul",null,e))}}d.propTypes=c,d.defaultProps={categories:{},forceCategorical:!1,format:null,position:"tr",showSingleCategory:()=>{},toggleCategory:()=>{}}},10357:(e,t,i)=>{i.r(t),i.d(t,{default:()=>W,getLayer:()=>T});var r=i(67294),o=i(45697),s=i.n(o),a=i(78918),n=i(80744),l=i(38550),g=i(71435),p=i(62112),c=i(99890),d=i(98452);const h=[0,0,0,255],u={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:h},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class f extends a.Z{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&n.Z.removed("getLineDashArray","PathStyleExtension")()}updateState({oldProps:e,props:t,changeFlags:i}){const r=i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon);if(r&&Array.isArray(i.dataChanged)){const e=this.state.paths.slice(),t=i.dataChanged.map((t=>(0,d.b)({data:e,getIndex:e=>e.__source.index,dataRange:t,replace:this._getPaths(t)})));this.setState({paths:e,pathsDiff:t})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:i,positionFormat:r,_normalize:o}=this.props,s=[],a="XY"===r?2:3,{startRow:n,endRow:g}=e,{iterable:p,objectInfo:d}=(0,l.jB)(t,n,g);for(const e of p){d.index++;let t=i(e,d);o&&(t=c.F(t,a));const{holeIndices:r}=t,n=t.positions||t;if(r)for(let t=0;t<=r.length;t++){const i=n.slice(r[t-1]||0,r[t]||n.length);s.push(this.getSubLayerRow({path:i},e,d.index))}else s.push(this.getSubLayerRow({path:n},e,d.index))}return s}renderLayers(){const{data:e,_dataDiff:t,stroked:i,filled:r,extruded:o,wireframe:s,_normalize:a,_windingOrder:n,elevationScale:l,transitions:c,positionFormat:d}=this.props,{lineWidthUnits:u,lineWidthScale:f,lineWidthMinPixels:y,lineWidthMaxPixels:m,lineJointRounded:b,lineMiterLimit:_,lineDashJustified:L}=this.props,{getFillColor:C,getLineColor:S,getLineWidth:x,getLineDashArray:v,getElevation:w,getPolygon:P,updateTriggers:k,material:A}=this.props,{paths:F,pathsDiff:Z}=this.state,j=this.getSubLayerClass("fill",g.Z),T=this.getSubLayerClass("stroke",p.Z),D=this.shouldRenderSubLayer("fill",F)&&new j({_dataDiff:t,extruded:o,elevationScale:l,filled:r,wireframe:s,_normalize:a,_windingOrder:n,getElevation:w,getFillColor:C,getLineColor:o&&s?S:h,material:A,transitions:c},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:k.getPolygon,getElevation:k.getElevation,getFillColor:k.getFillColor,lineColors:o&&s,getLineColor:k.getLineColor}}),{data:e,positionFormat:d,getPolygon:P});return[!o&&D,!o&&i&&this.shouldRenderSubLayer("stroke",F)&&new T({_dataDiff:Z&&(()=>Z),widthUnits:u,widthScale:f,widthMinPixels:y,widthMaxPixels:m,jointRounded:b,miterLimit:_,dashJustified:L,_pathType:"loop",transitions:c&&{getWidth:c.getLineWidth,getColor:c.getLineColor,getPath:c.getPolygon},getColor:this.getSubLayerAccessor(S),getWidth:this.getSubLayerAccessor(x),getDashArray:this.getSubLayerAccessor(v)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:k.getLineWidth,getColor:k.getLineColor,getDashArray:k.getLineDashArray}}),{data:F,positionFormat:d,getPath:e=>e.path}),o&&D]}}f.layerName="PolygonLayer",f.defaultProps=u;var y=i(85531),m=i(36665),b=i(1740),_=i(4065),L=i(39828),C=i(2995),S=i(45511),x=i(64106);function v({break_points:e,num_buckets:t},i,r){if(!i)return[];if(void 0===e||0===e.length){const e=t?parseInt(t,10):10,[o,s]=(0,_.extent)(i,r);if(void 0===o)return[];const a=(s-o)/e,n=0===a?0:Math.max(0,Math.ceil(Math.log10(1/a))),l=s>s.toFixed(n)?1:0,g=o<o.toFixed(n)?o-1:o;return new Array(e+1+l).fill().map(((e,t)=>(g+t*a).toFixed(n)))}return e.sort(((e,t)=>parseFloat(e)-parseFloat(t)))}function w({break_points:e,num_buckets:t,linear_color_scheme:i,opacity:r},o,s){const a=e||t?v({break_points:e,num_buckets:t},o,s):null,n=Array.isArray(i)?new C.Z({colors:i,id:"custom"}):(0,S.Z)().get(i);let l,g;if(null!==a){const e=a.length-1,t=e>1?n.getColors(e):[n.colors[n.colors.length-1]],i=t[0],r=t[t.length-1];t.unshift(i),t.push(r);const o=a.map((e=>parseFloat(e)));l=(0,L.Z)().domain(o).range(t),g=t=>t>a[e]||t<a[0]}else l=n.createLinearScale((0,_.extent)(o,s)),g=()=>!1;return e=>{const t=s(e),i=(0,x.hexToRGB)(l(t));return g(t)?i[3]=0:i[3]=r/100*255,i}}var P=i(52154),k=i(66911),A=i(21207);function F(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}var Z=i(40461),j=i(11965);function T(e,t,i,r,o,s,a){const n=e,l=n.fill_color_picker,g=n.stroke_color_picker;let p=[...t.data.features];if(null!=a&&a.forEach((e=>{p=p.filter((t=>e(t)))})),n.js_data_mutator){const e=(0,A.Z)(n.js_data_mutator);p=e(p)}const c=n.metric?n.metric.label||n.metric:null,d=null===n.metric?()=>[l.r,l.g,l.b,255*l.a]:w(n,p,(e=>e[c])),h=e=>{const t=d(e);return o.length>0&&!o.includes(e[n.line_column])&&(t[3]/=2),t},u=n.line_column&&n.metric&&["json","geohash","zipcode"].includes(n.line_type)?function(e){return t=>{const i=e.metric.label||e.metric;return(0,j.tZ)("div",{className:"deckgl-tooltip"},t.object.name&&(0,j.tZ)(b.Z,{label:"name: ",value:`${t.object.name}`}),t.object[e.line_column]&&(0,j.tZ)(b.Z,{label:`${e.line_column}: `,value:`${t.object[e.line_column]}`}),e.metric&&(0,j.tZ)(b.Z,{label:`${i}: `,value:`${t.object[i]}`}))}}(n):void 0;return new f({id:`path-layer-${n.slice_id}`,data:p,pickable:!0,filled:n.filled,stroked:n.stroked,getPolygon:F,getFillColor:h,getLineColor:[g.r,g.g,g.b,255*g.a],getLineWidth:n.line_width,extruded:n.extruded,getElevation:e=>function(e,t){return 0===t(e)[3]?0:e.elevation}(e,h),elevationScale:n.multiplier,fp64:!0,...(0,P.N)(n,r,u,s)})}const D={formData:s().object.isRequired,payload:s().object.isRequired,setControlValue:s().func.isRequired,viewport:s().object.isRequired,onAddFilter:s().func,width:s().number.isRequired,height:s().number.isRequired},R={onAddFilter(){}};class $ extends r.Component{constructor(e){super(e),this.containerRef=r.createRef(),this.setTooltip=e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)},this.state=$.getDerivedStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onSelect=this.onSelect.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(e,t){const{width:i,height:r,formData:o,payload:s}=e;if(t&&s.form_data===t.formData)return null;const a=s.data.features||[],n=a.map((e=>e.__timestamp)),l=s.form_data.time_grain_sqla||s.form_data.granularity||"P1D",{start:g,end:p,getStep:c,values:d,disabled:h}=(0,k.g)(n,l);let{viewport:u}=e;return o.autozoom&&(u=(0,Z.Z)(u,{width:i,height:r,points:a.flatMap(F)})),{start:g,end:p,getStep:c,values:d,disabled:h,viewport:u,selected:[],lastClick:0,formData:s.form_data}}onSelect(e){const{formData:t,onAddFilter:i}=this.props,r=new Date,o=r-this.state.lastClick<=250,s=[...this.state.selected];if(o)s.splice(0,s.length,e);else if(t.toggle_polygons){const t=s.indexOf(e);-1===t?s.push(e):s.splice(t,1)}else s.splice(0,1,e);this.setState({selected:s,lastClick:r}),t.table_filter&&i(t.line_column,s,!1,!0)}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getLayers(e){if(void 0===this.props.payload.data.features)return[];const t=[];return e[0]===e[1]||e[1]===this.end?t.push((t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1])):t.push((t=>t.__timestamp>=e[0]&&t.__timestamp<e[1])),[T(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip,this.state.selected,this.onSelect,t)]}render(){const{payload:e,formData:t,setControlValue:i}=this.props,{start:r,end:o,getStep:s,values:a,disabled:n,viewport:l}=this.state,g=t,p=g.metric?g.metric.label||g.metric:null,c=function(e,t,i){const r=v(e,t,i),o=w(e,t,i),s={};return r.slice(1).forEach(((t,i)=>{const a=`${r[i]} - ${r[i+1]}`,n=.5*(parseFloat(r[i])+parseFloat(r[i+1])),l=e.metric?e.metric.label||e.metric:null;s[a]={color:o({[l||e.metric]:n}),enabled:!0}})),s}(t,e.data.features,(e=>e[p]));return(0,j.tZ)("div",{style:{position:"relative"}},(0,j.tZ)(y.Z,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:r,end:o,getStep:s,values:a,disabled:n,viewport:l,width:this.props.width,height:this.props.height,mapboxApiAccessToken:e.data.mapboxApiKey,mapStyle:t.mapbox_style,setControlValue:i,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange},null!==t.metric&&(0,j.tZ)(m.Z,{categories:c,position:t.legend_position,format:t.legend_format})))}}$.propTypes=D,$.defaultProps=R;const W=$}}]);
//# sourceMappingURL=f002dd41453444b5a5f0.chunk.js.map