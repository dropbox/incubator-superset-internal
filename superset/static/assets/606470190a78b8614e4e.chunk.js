(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{1565:function(e,t,i){var n;!function(a,r,o){if(a){for(var s,l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},u={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},c={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},h={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},d=1;d<20;++d)l[111+d]="f"+d;for(d=0;d<=9;++d)l[d+96]=d.toString();b.prototype.bind=function(e,t,i){return e=e instanceof Array?e:[e],this._bindMultiple.call(this,e,t,i),this},b.prototype.unbind=function(e,t){return this.bind.call(this,e,(function(){}),t)},b.prototype.trigger=function(e,t){return this._directMap[e+":"+t]&&this._directMap[e+":"+t]({},e),this},b.prototype.reset=function(){return this._callbacks={},this._directMap={},this},b.prototype.stopCallback=function(e,t){return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&(!function e(t,i){return null!==t&&t!==r&&(t===i||e(t.parentNode,i))}(t,this.target)&&("INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable))},b.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},b.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);s=null},b.init=function(){var e=b(r);for(var t in e)"_"!==t.charAt(0)&&(b[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},b.init(),a.Mousetrap=b,e.exports&&(e.exports=b),void 0===(n=function(){return b}.call(t,i,t,e))||(e.exports=n)}function p(e,t,i){e.addEventListener?e.addEventListener(t,i,!1):e.attachEvent("on"+t,i)}function g(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return l[e.which]?l[e.which]:u[e.which]?u[e.which]:String.fromCharCode(e.which).toLowerCase()}function f(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function v(e,t,i){return i||(i=function(){if(!s)for(var e in s={},l)e>95&&e<112||l.hasOwnProperty(e)&&(s[l[e]]=e);return s}()[e]?"keydown":"keypress"),"keypress"==i&&t.length&&(i="keydown"),i}function m(e,t){var i,n,a,r=[];for(i=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),a=0;a<i.length;++a)n=i[a],h[n]&&(n=h[n]),t&&"keypress"!=t&&c[n]&&(n=c[n],r.push("shift")),f(n)&&r.push(n);return{key:n,modifiers:r,action:t=v(n,r,t)}}function b(e){var t=this;if(e=e||r,!(t instanceof b))return new b(e);t.target=e,t._callbacks={},t._directMap={};var i,n={},a=!1,o=!1,s=!1;function l(e){e=e||{};var t,i=!1;for(t in n)e[t]?i=!0:n[t]=0;i||(s=!1)}function u(e,i,a,r,o,s){var l,u,c,h,d=[],p=a.type;if(!t._callbacks[e])return[];for("keyup"==p&&f(e)&&(i=[e]),l=0;l<t._callbacks[e].length;++l)if(u=t._callbacks[e][l],(r||!u.seq||n[u.seq]==u.level)&&p==u.action&&("keypress"==p&&!a.metaKey&&!a.ctrlKey||(c=i,h=u.modifiers,c.sort().join(",")===h.sort().join(",")))){var g=!r&&u.combo==o,v=r&&u.seq==r&&u.level==s;(g||v)&&t._callbacks[e].splice(l,1),d.push(u)}return d}function c(e,i,n,a){t.stopCallback(i,i.target||i.srcElement,n,a)||!1===e(i,n)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(i),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(i))}function h(e){"number"!=typeof e.which&&(e.which=e.keyCode);var i=g(e);i&&("keyup"!=e.type||a!==i?t.handleKey(i,function(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(e),e):a=!1)}function d(e,t,r,o){function u(t){return function(){s=t,++n[e],clearTimeout(i),i=setTimeout(l,1e3)}}function h(t){c(r,t,e),"keyup"!==o&&(a=g(t)),setTimeout(l,10)}n[e]=0;for(var d=0;d<t.length;++d){var p=d+1===t.length?h:u(o||m(t[d+1]).action);v(t[d],p,o,e,d)}}function v(e,i,n,a,r){t._directMap[e+":"+n]=i;var o,s=(e=e.replace(/\s+/g," ")).split(" ");s.length>1?d(e,s,i,n):(o=m(e,n),t._callbacks[o.key]=t._callbacks[o.key]||[],u(o.key,o.modifiers,{type:o.action},a,e,r),t._callbacks[o.key][a?"unshift":"push"]({callback:i,modifiers:o.modifiers,action:o.action,seq:a,level:r,combo:e}))}t._handleKey=function(e,t,i){var n,a=u(e,t,i),r={},h=0,d=!1;for(n=0;n<a.length;++n)a[n].seq&&(h=Math.max(h,a[n].level));for(n=0;n<a.length;++n)if(a[n].seq){if(a[n].level!=h)continue;d=!0,r[a[n].seq]=1,c(a[n].callback,i,a[n].combo,a[n].seq)}else d||c(a[n].callback,i,a[n].combo);var p="keypress"==i.type&&o;i.type!=s||f(e)||p||l(r),o=d&&"keydown"==i.type},t._bindMultiple=function(e,t,i){for(var n=0;n<e.length;++n)v(e[n],t,i)},p(e,"keypress",h),p(e,"keydown",h),p(e,"keyup",h)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)},4475:function(e,t,i){"use strict";i.d(t,"a",(function(){return V}));var n=i(16),a=i(8),r=i(17),o=i(19),s=i(4495);function l(e,t){var i=s.c([],t,e);return s.b(i,i,1/i[3]),i}var u=i(4476),c=i(4470),h=i(4493);function d(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var p=Math.PI,g=p/4,f=p/180,v=180/p;function m(e){return Math.pow(2,e)}function b(e){var t=Object(a.a)(e,2),i=t[0],n=t[1];d(Number.isFinite(i)),d(Number.isFinite(n)&&n>=-90&&n<=90,"invalid latitude");var r=n*f;return[512*(i*f+p)/(2*p),512*(p+Math.log(Math.tan(g+.5*r)))/(2*p)]}function y(e){var t=Object(a.a)(e,2),i=t[0],n=t[1],r=i/512*(2*p)-p,o=2*(Math.atan(Math.exp(n/512*(2*p)-p))-g);return[r*v,o*v]}function x(e){var t=e.latitude,i=e.longitude,n=e.highPrecision,a=void 0!==n&&n;d(Number.isFinite(t)&&Number.isFinite(i));var r={},o=Math.cos(t*f),s=512/360/o,l=512/4003e4/o;if(r.unitsPerMeter=[l,l,l],r.metersPerUnit=[1/l,1/l,1/l],r.unitsPerDegree=[512/360,s,l],r.degreesPerUnit=[.703125,1/s,1/l],a){var u=f*Math.tan(t*f)/o,c=512/360*u/2,h=512/4003e4*u,p=h/s*l;r.unitsPerDegree2=[0,c,h],r.unitsPerMeter2=[p,0,p]}return r}function w(e){var t=e.height,i=e.pitch,n=e.bearing,a=e.altitude,r=e.scale,o=e.center,s=void 0===o?null:o,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return u.o(l,l,[0,0,-a]),u.k(l,l,-i*f),u.m(l,l,n*f),r/=t,u.n(l,l,[r,r,r]),s&&u.o(l,l,h.d([],s)),l}function C(e){var t=e.width,i=e.height,n=e.pitch,a=function(e){var t=e.width,i=e.height,n=e.altitude,a=void 0===n?1.5:n,r=e.pitch,o=void 0===r?0:r,s=e.nearZMultiplier,l=void 0===s?1:s,u=e.farZMultiplier,c=void 0===u?1:u,h=o*f,d=Math.atan(.5/a),p=Math.sin(d)*a/Math.sin(Math.min(Math.max(Math.PI/2-h-d,.01),Math.PI-.01));return{fov:2*d,aspect:t/i,focalDistance:a,near:l,far:(Math.sin(h)*p+a)*c}}({width:t,height:i,altitude:e.altitude,pitch:n,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),r=a.fov,o=a.aspect,s=a.near,l=a.far;return u.i([],r,o,s,l)}function j(e,t){var i=Object(a.a)(e,3),n=i[0],r=i[1],o=i[2],s=void 0===o?0:o;return d(Number.isFinite(n)&&Number.isFinite(r)&&Number.isFinite(s)),l(t,[n,r,s,1])}function M(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=Object(a.a)(e,3),r=n[0],o=n[1],s=n[2];if(d(Number.isFinite(r)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(s)){var u=l(t,[r,o,s,1]);return u}var h=l(t,[r,o,0,1]),p=l(t,[r,o,1,1]),g=h[2],f=p[2],v=g===f?0:((i||0)-g)/(f-g);return c.d([],h,p,v)}function P(e){var t=e.width,i=e.height,n=e.bounds,r=e.minExtent,o=void 0===r?0:r,s=e.maxZoom,l=void 0===s?24:s,u=e.padding,c=void 0===u?0:u,h=e.offset,p=void 0===h?[0,0]:h,g=Object(a.a)(n,2),f=Object(a.a)(g[0],2),v=f[0],m=f[1],b=Object(a.a)(g[1],2),y=b[0],x=b[1];if(Number.isFinite(c)){c={top:c,bottom:c,left:c,right:c}}else d(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var w=new _({width:t,height:i,longitude:0,latitude:0,zoom:0}),C=w.project([v,x]),j=w.project([y,m]),M=[Math.max(Math.abs(j[0]-C[0]),o),Math.max(Math.abs(j[1]-C[1]),o)],P=[t-c.left-c.right-2*Math.abs(p[0]),i-c.top-c.bottom-2*Math.abs(p[1])];d(P[0]>0&&P[1]>0);var k=P[0]/M[0],S=P[1]/M[1],O=(c.right-c.left)/2/k,E=(c.bottom-c.top)/2/S,F=[(j[0]+C[0])/2+O,(j[1]+C[1])/2+E],L=w.unproject(F),D=Math.min(l,w.zoom+Math.log2(Math.abs(Math.min(k,S))));return d(Number.isFinite(D)),{longitude:L[0],latitude:L[1],zoom:D}}var k=Math.PI/180;function S(e){var t,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=e.width,r=e.height,o=e.unproject,s={targetZ:n},l=o([0,r],s),u=o([a,r],s),c=Math.atan(.5/e.altitude),h=(90-e.pitch)*k;return c>h-.01?(t=O(e,0,n),i=O(e,a,n)):(t=o([0,0],s),i=o([a,0],s)),[l,u,i,t]}function O(e,t,i){var n=e.pixelUnprojectionMatrix,a=l(n,[t,0,1,1]),r=l(n,[t,e.height,1,1]),o=(i*e.distanceScales.unitsPerMeter[2]-a[2])/(r[2]-a[2]),s=y(c.d([],a,r,o));return s[2]=i,s}var _=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:1,height:1},i=t.width,n=t.height,a=t.latitude,o=void 0===a?0:a,s=t.longitude,l=void 0===s?0:s,u=t.zoom,c=void 0===u?0:u,h=t.pitch,d=void 0===h?0:h,p=t.bearing,g=void 0===p?0:p,f=t.altitude,v=void 0===f?1.5:f,y=t.nearZMultiplier,j=void 0===y?.02:y,M=t.farZMultiplier,P=void 0===M?1.01:M;Object(r.a)(this,e),i=i||1,n=n||1;var k=m(c);v=Math.max(.75,v);var S=b([l,o]);S[2]=0,this.projectionMatrix=C({width:i,height:n,pitch:d,altitude:v,nearZMultiplier:j,farZMultiplier:P}),this.viewMatrix=w({height:n,scale:k,center:S,pitch:d,bearing:g,altitude:v}),this.width=i,this.height=n,this.scale=k,this.latitude=o,this.longitude=l,this.zoom=c,this.pitch=d,this.bearing=g,this.altitude=v,this.center=S,this.distanceScales=x(this),this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}return Object(o.a)(e,[{key:"_initMatrices",value:function(){var e=this.width,t=this.height,i=this.projectionMatrix,n=this.viewMatrix,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u.g(a,a,i),u.g(a,a,n),this.viewProjectionMatrix=a;var r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];u.n(r,r,[e/2,-t/2,1]),u.o(r,r,[1,-1,0]),u.g(r,r,a);var o=u.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r);if(!o)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=r,this.pixelUnprojectionMatrix=o}},{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&u.b(t.projectionMatrix,this.projectionMatrix)&&u.b(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.topLeft,n=void 0===i||i,r=this.projectPosition(e),o=j(r,this.pixelProjectionMatrix),s=Object(a.a)(o,2),l=s[0],u=s[1],c=n?u:this.height-u;return 2===e.length?[l,c]:[l,c,o[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=t.topLeft,n=void 0===i||i,r=t.targetZ,o=void 0===r?void 0:r,s=Object(a.a)(e,3),l=s[0],u=s[1],c=s[2],h=n?u:this.height-u,d=o&&o*this.distanceScales.unitsPerMeter[2],p=M([l,h,c],this.pixelUnprojectionMatrix,d),g=this.unprojectPosition(p),f=Object(a.a)(g,3),v=f[0],m=f[1],b=f[2];return Number.isFinite(c)?[v,m,b]:Number.isFinite(o)?[v,m,o]:[v,m]}},{key:"projectPosition",value:function(e){var t=b(e),i=Object(a.a)(t,2);return[i[0],i[1],(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:"unprojectPosition",value:function(e){var t=y(e),i=Object(a.a)(t,2);return[i[0],i[1],(e[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(e){return b(e)}},{key:"unprojectFlat",value:function(e){return y(e)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t=e.lngLat,i=M(e.pos,this.pixelUnprojectionMatrix),n=b(t),a=c.a([],n,c.e([],i));return y(c.a([],this.center,a))}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,i=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:i})}},{key:"fitBounds",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.width,a=this.height,r=P(Object.assign({width:n,height:a,bounds:t},i)),o=r.longitude,s=r.latitude,l=r.zoom;return new e({width:n,height:a,longitude:o,latitude:s,zoom:l})}},{key:"getBounds",value:function(e){var t=this.getBoundingRegion(e),i=Math.min.apply(Math,Object(n.a)(t.map((function(e){return e[0]})))),a=Math.max.apply(Math,Object(n.a)(t.map((function(e){return e[0]}))));return[[i,Math.min.apply(Math,Object(n.a)(t.map((function(e){return e[1]}))))],[a,Math.max.apply(Math,Object(n.a)(t.map((function(e){return e[1]}))))]]}},{key:"getBoundingRegion",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return S(this,e.z||0)}}]),e}();var E=i(167);const F=[-90,90],L=[-180,180];function D(e,t,i){let[n,a]=e,[r,o]=t;return void 0===i&&(i=.25),n<a?[n,a]:[Math.max(r,n-i),Math.min(o,a+i)]}function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function V(e,t){let{points:i,width:n,height:a,minExtent:r,maxZoom:o,offset:s,padding:l=20}=t;const{bearing:u,pitch:c}=e,h=function(e){const t=D(Object(E.extent)(e,e=>e[1]),F),i=D(Object(E.extent)(e,e=>e[0]),L);return[[i[0],t[0]],[i[1],t[1]]]}(i);try{return R({},P({bounds:h,width:n,height:a,minExtent:r,maxZoom:o,offset:s,padding:l}),{bearing:u,pitch:c})}catch(e){console.error("Could not fit viewport",e)}return e}},4481:function(e,t,i){"use strict";i.d(t,"a",(function(){return s}));var n=i(38),a=i.n(n);const r=[1,0,1,0,0,0,0];function o(e,t){const i=parseInt(a()(t).format("x"),10);return parseInt(a()(t).add(e).format("x"),10)-i}function s(e,t){const i=a()(Math.min(...e)),n=a()(Math.max(...e));let s,l,u;if(t.includes("/")){const e=t.split("/",2);e[0].endsWith("Z")?(l=a()(e[0]),s=a.a.duration(e[1])):(l=a()(e[1]),s=a.a.duration(e[0]))}else s=a.a.duration(t),l=function(e,t){const i=a()(e).subtract(t),n=e.toArray(),o=i.toArray(),s=n.map((e,t)=>o[t]!==e).indexOf(!0),l=n.map((e,t)=>{if(t===s){const i=e-o[t];return e-(e-r[t])%i}return t<s||-1===s?e:r[t]});return a()(l)}(i,s);const c=i.valueOf();for(u=l.clone();u.valueOf()<c;)u.add(s);for(;u.valueOf()>c;)u.subtract(s);let h;const d=n.valueOf();for(h=l.clone();h.valueOf()>d;)h.subtract(s);for(;h.valueOf()<d;)h.add(s);const p=null!=t?[u,u.clone().add(s)]:[u,h],g=e.every(e=>null===e);return{start:parseInt(u.format("x"),10),end:parseInt(h.format("x"),10),getStep:o.bind(this,s),values:p.map(e=>parseInt(e.format("x"),10)),disabled:g}}},4482:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return s}));var n={SUM:1,MEAN:2,MIN:3,MAX:4};function a(e,t){return e+t}function r(e,t){return t>e?t:e}function o(e,t){return t<e?t:e}function s(e,t){switch(n[e.toUpperCase()]||n.SUM){case n.MIN:return function(e){return function(e,t){var i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(o,1/0):null}(e,t)};case n.SUM:return function(e){return function(e,t){var i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(a,0):null}(e,t)};case n.MEAN:return function(e){return function(e,t){var i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(a,0)/i.length:null}(e,t)};case n.MAX:return function(e){return function(e,t){var i=e.map(t).filter(Number.isFinite);return i.length?i.reduce(r,-1/0):null}(e,t)};default:return null}}},4484:function(e,t,i){"use strict";i.d(t,"a",(function(){return b}));var n=i(0),a=i.n(n),r=i(2),o=i.n(r),s=i(4483),l=i(1565),u=i.n(l),c=i(14),h=i(4445),d=i.n(h);i(4488),i(4489);function p(e){return a.a.createElement("span",{className:"BootstrapSliderWrapper"},a.a.createElement(d.a,e))}i(4490);const g={start:o.a.number.isRequired,step:o.a.number.isRequired,end:o.a.number.isRequired,values:o.a.array.isRequired,onChange:o.a.func,loopDuration:o.a.number,maxFrames:o.a.number,orientation:o.a.oneOf(["horizontal","vertical"]),reversed:o.a.bool,disabled:o.a.bool,range:o.a.bool};class f extends a.a.PureComponent{constructor(e){super(e),this.state={intervalId:null};const t=e.end-e.start,i=Math.min(e.maxFrames,t/e.step),n=t/i;this.intervalMilliseconds=e.loopDuration/i,this.increment=n<e.step?e.step:n-n%e.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){u.a.bind(["space"],this.play)}componentWillUnmount(){u.a.unbind(["space"])}onChange(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:e,end:t,step:i,values:n,disabled:a}=this.props;if(a)return;const r=(Array.isArray(n)?n:[n,n+i]).map(e=>e+this.increment),o=r[1]>t?r[0]-e:0;this.props.onChange(r.map(e=>e-o))}stepBackward(){const{start:e,end:t,step:i,values:n,disabled:a}=this.props;if(a)return;const r=(Array.isArray(n)?n:[n,n+i]).map(e=>e-this.increment),o=r[0]<e?t-r[1]:0;this.props.onChange(r.map(e=>e+o))}formatter(e){if(this.props.disabled)return Object(c.e)("Data has no time steps");let t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map(e=>new Date(e).toUTCString()).join(" : ")}render(){const{start:e,end:t,step:i,orientation:n,reversed:r,disabled:o,range:s,values:l}=this.props;return a.a.createElement("div",{className:"play-slider"},a.a.createElement("div",{className:"play-slider-controls padded"},a.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),a.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),a.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),a.a.createElement("div",{className:"play-slider-scrobbler padded"},a.a.createElement(p,{value:s?l:l[0],range:s,formatter:this.formatter,change:this.onChange,min:e,max:t,step:i,orientation:n,reversed:r,disabled:o?"disabled":"enabled"})))}}function v(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}f.propTypes=g,f.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0};const m={getLayers:o.a.func.isRequired,start:o.a.number.isRequired,end:o.a.number.isRequired,getStep:o.a.func,values:o.a.array.isRequired,aggregation:o.a.bool,disabled:o.a.bool,viewport:o.a.object.isRequired,children:o.a.node,mapStyle:o.a.string,mapboxApiAccessToken:o.a.string.isRequired,setControlValue:o.a.func,onValuesChange:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired};class b extends a.a.PureComponent{constructor(){super(...arguments),v(this,"containerRef",a.a.createRef()),v(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})}render(){const{start:e,end:t,getStep:i,disabled:n,aggregation:r,children:o,getLayers:l,values:u,onValuesChange:c,viewport:h,setControlValue:d,mapStyle:p,mapboxApiAccessToken:g,height:v,width:m}=this.props,b=l(u);return a.a.createElement("div",null,a.a.createElement(s.a,{ref:this.containerRef,viewport:h,layers:b,setControlValue:d,mapStyle:p,mapboxApiAccessToken:g,bottomMargin:n?0:20,width:m,height:v}),!n&&a.a.createElement(f,{start:e,end:t,step:i(e),values:u,range:!r,onChange:c}),o)}}b.propTypes=m,b.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:()=>{},onValuesChange:()=>{}}},4488:function(e,t,i){},4489:function(e,t,i){},4490:function(e,t,i){},4491:function(e,t,i){"use strict";i.d(t,"b",(function(){return P})),i.d(t,"a",(function(){return k}));var n=i(0),a=i.n(n),r=i(2),o=i.n(r),s=i(205),l=i(4483),u=i(892),c=i(4484),h=i(4494),d=i(4499),p=i(4481),g=i(4480),f=i(4475);function v(){return(v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function m(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const{getScale:b}=u.b;const y={formData:o.a.object.isRequired,mapboxApiKey:o.a.string.isRequired,setControlValue:o.a.func.isRequired,viewport:o.a.object.isRequired,getLayer:o.a.func.isRequired,getPoints:o.a.func.isRequired,payload:o.a.object.isRequired,onAddFilter:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired};class x extends a.a.PureComponent{constructor(e){super(e),m(this,"containerRef",a.a.createRef()),m(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState(v({},this.getStateFromProps(e)))}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const i=e.payload.data.features||[],n=i.map(e=>e.__timestamp),a=function(e,t){const i=e.color_picker||{r:0,g:0,b:0,a:1},n=[i.r,i.g,i.b,255*i.a],a=b(e.color_scheme),r={};return t.forEach(t=>{if(null!=t.cat_color&&!r.hasOwnProperty(t.cat_color)){let o;o=e.dimension?Object(d.hexToRGB)(a(t.cat_color),255*i.a):n,r[t.cat_color]={color:o,enabled:!0}}}),r}(e.formData,i);if(t&&e.payload.form_data===t.formData)return v({},t,{categories:a});const r=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:o,end:s,getStep:l,values:u,disabled:c}=Object(p.a)(n,r),{width:h,height:g,formData:m}=e;let{viewport:y}=e;return m.autozoom&&(y=Object(f.a)(y,{width:h,height:g,points:e.getPoints(i)})),{start:o,end:s,getStep:l,values:u,disabled:c,viewport:y,selected:[],lastClick:0,formData:e.payload.form_data,categories:a}}getLayers(e){const{getLayer:t,payload:i,formData:n,onAddFilter:a}=this.props;let r=i.data.features?[...i.data.features]:[];if(r=this.addColor(r,n),n.js_data_mutator){r=Object(g.a)(n.js_data_mutator)(r)}r=e[0]===e[1]||e[1]===this.end?r.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):r.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]);const o=this.state.categories;return n.dimension&&(r=r.filter(e=>o[e.cat_color]&&o[e.cat_color].enabled)),[t(n,v({},i,{data:v({},i.data,{features:r})}),a,this.setTooltip)]}addColor(e,t){const i=t.color_picker||{r:0,g:0,b:0,a:1},n=b(t.color_scheme);return e.map(e=>{let a;return t.dimension?(a=Object(d.hexToRGB)(n(e.cat_color),255*i.a),v({},e,{color:a})):e})}toggleCategory(e){const t=this.state.categories[e],i=v({},this.state.categories,{[e]:v({},t,{enabled:!t.enabled})});Object.values(i).every(e=>!e.enabled)&&Object.values(i).forEach(e=>{e.enabled=!0}),this.setState({categories:i})}showSingleCategory(e){const t=v({},this.state.categories);Object.values(t).forEach(e=>{e.enabled=!1}),t[e].enabled=!0,this.setState({categories:t})}render(){return a.a.createElement("div",{style:{position:"relative"}},a.a.createElement(c.a,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},a.a.createElement(h.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function w(){return(w=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function C(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}x.propTypes=y;const j={formData:o.a.object.isRequired,payload:o.a.object.isRequired,setControlValue:o.a.func.isRequired,viewport:o.a.object.isRequired,onAddFilter:o.a.func,width:o.a.number.isRequired,height:o.a.number.isRequired},M={onAddFilter(){}};function P(e,t){class i extends a.a.PureComponent{constructor(e){super(e),C(this,"containerRef",a.a.createRef()),C(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)});const{width:i,height:n,formData:r}=e;let{viewport:o}=e;r.autozoom&&(o=Object(f.a)(o,{width:i,height:n,points:t(e.payload.data.features)})),this.state={viewport:o,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=w({},e.formData,{viewport:null}),i=w({},this.props.formData,{viewport:null});Object(s.isEqual)(t,i)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(t){const{formData:i,payload:n,onAddFilter:a}=t;return e(i,n,a,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:i,height:n,width:r}=this.props,{layer:o,viewport:s}=this.state;return a.a.createElement(l.a,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:s,layers:[o],mapStyle:e.mapbox_style,setControlValue:i,width:r,height:n,onViewportChange:this.onViewportChange})}}return i.propTypes=j,i.defaultProps=M,i}function k(e,t){function i(i){const{formData:n,payload:r,setControlValue:o,viewport:s,width:l,height:u}=i;return a.a.createElement(x,{formData:n,mapboxApiKey:r.data.mapboxApiKey,setControlValue:o,viewport:s,getLayer:e,payload:r,getPoints:t,width:l,height:u})}return i.propTypes=j,i.defaultProps=M,i}},4494:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var n=i(0),a=i.n(n),r=i(2),o=i.n(r),s=i(237);i(4496);const l={categories:o.a.object,toggleCategory:o.a.func,showSingleCategory:o.a.func,format:o.a.string,position:o.a.oneOf([null,"tl","tr","bl","br"])};class u extends a.a.PureComponent{format(e){if(!this.props.format)return e;const t=parseFloat(e);return Object(s.b)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(" - ")){const t=e.split(" - ");return this.format(t[0])+" - "+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map(e=>{let[t,i]=e;const n={color:"rgba("+i.color.join(", ")+")"},r=i.enabled?"◼":"◻";return a.a.createElement("li",{key:t},a.a.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(t),onDoubleClick:()=>this.props.showSingleCategory(t)},a.a.createElement("span",{style:n},r)," ",this.formatCategoryLabel(t)))}),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return a.a.createElement("div",{className:"legend",style:t},a.a.createElement("ul",{className:"categories"},e))}}u.propTypes=l,u.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:"tr"}},4496:function(e,t,i){},4497:function(e,t,i){"use strict";i.d(t,"b",(function(){return n})),i.d(t,"a",(function(){return a}));var n=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function a(e,t,i){var n=new t(4*e.length);return e.forEach((function(e,t){var a=4*t;n[a]=e[0],n[a+1]=e[1],n[a+2]=e[2],n[a+3]=Number.isFinite(e[3])?e[3]:i})),n}},4524:function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var n=i(17),a=i(19),r=i(1304),o=i(177),s=i(249),l=i(21),u=i(4511),c=i(4477),h=i(4504),d=function(e){function t(){return Object(n.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(a.a)(t,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(e){Object(s.a)(Object(o.a)(t.prototype),"setState",this).call(this,e),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(e){return e.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(e,t){var i=this.props._subLayerProps;return t&&t.length||i&&i[e]}},{key:"getSubLayerClass",value:function(e,t){var i=this.props._subLayerProps;return i&&i[e]&&i[e].type||t}},{key:"getSubLayerProps",value:function(e){var t=this.props,i=t.opacity,n=t.pickable,a=t.visible,r=t.parameters,o=t.getPolygonOffset,s=t.highlightedObjectIndex,l=t.autoHighlight,u=t.highlightColor,c=t.coordinateSystem,h=t.coordinateOrigin,d=t.wrapLongitude,p=t.positionFormat,g=t.modelMatrix,f=t._subLayerProps,v={opacity:i,pickable:n,visible:a,parameters:r,getPolygonOffset:o,highlightedObjectIndex:s,autoHighlight:l,highlightColor:u,coordinateSystem:c,coordinateOrigin:h,wrapLongitude:d,positionFormat:p,modelMatrix:g};if(e){var m=f&&f[e.id],b=m&&m.updateTriggers;Object.assign(v,e,m,{id:"".concat(this.props.id,"-").concat(e.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers,b)})}return v}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var e=this.internalState.subLayers;e&&!this.needsUpdate()?c.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(e=this.renderLayers(),e=Object(h.b)(e,{filter:Boolean}),this.internalState.subLayers=e,c.a.log(2,"Composite layer rendered new subLayers ".concat(this),e)());var t=!0,i=!1,n=void 0;try{for(var a,r=e[Symbol.iterator]();!(t=(a=r.next()).done);t=!0){a.value.parent=this}}catch(e){i=!0,n=e}finally{try{t||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"isComposite",get:function(){return!0}}]),t}(u.a);d.layerName="CompositeLayer"},4525:function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i(4),a=i(8),r=i(17),o=i(19),s=function(e){return e.length},l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;Object(r.a)(this,e),this.sortedBins=this.getSortedBins(t,i),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}return Object(o.a)(e,[{key:"getSortedBins",value:function(e,t){return e.reduce((function(e,i,n){var a=t(i.points);return null!=a&&e.push({i:Number.isFinite(i.index)?i.index:n,value:a,counts:i.points.length}),e}),[]).sort((function(e,t){return e.value-t.value}))}},{key:"getValueRange",value:function(e){var t=Object(a.a)(e,2),i=t[0],n=t[1],r=this.sortedBins.length;if(!r)return[0,0];var o=Math.ceil(i/100*(r-1)),s=Math.floor(n/100*(r-1));return[this.sortedBins[o].value,this.sortedBins[s].value]}},{key:"getMaxCount",value:function(){var e=0;return this.sortedBins.forEach((function(t){return e=e>t.counts?e:t.counts})),e}},{key:"getBinMap",value:function(){return this.sortedBins.reduce((function(e,t){return Object.assign(e,Object(n.a)({},t.i,t))}),{})}}]),e}()},4526:function(e,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"a",(function(){return r}));var n=i(4477);function a(e,t){return function(i){return function(e,t,i){var a=e[1]-e[0];if(a<=0)return n.a.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];var r=a/t.length,o=Math.floor((i-e[0])/r);return t[Math.max(Math.min(o,t.length-1),0)]}(e,t,i)}}function r(e,t){return function(i){return(i-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}}},4560:function(e,t,i){"use strict";i.d(t,"a",(function(){return j}));var n=i(17),a=i(19),r=i(1304),o=i(177),s=i(249),l=i(21),u=i(4549),c=i(4511),h=i(4894),d=i(4565),p=i(4669),g=i(1472),f=i(4477),v=i(4849),m=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(n.a)(this,t);var i=e.id,a=void 0===i?Object(v.c)("column-geometry"):i,s=b(e),l=s.indices,u=s.attributes;return Object(r.a)(this,Object(o.a)(t).call(this,Object(g.a)({},e,{id:a,indices:l,attributes:u})))}return Object(l.a)(t,e),t}(i(4588).a);function b(e){var t=e.radius,i=e.height,n=void 0===i?1:i,a=e.nradial,r=void 0===a?10:a,o=e.vertices;f.a.assert(!o||o.length>=r);for(var s=r+1,l=3*s,u=2*Math.PI/r,c=new Uint16Array(3*r*2),h=new Float32Array(3*l),d=new Float32Array(3*l),p=0,g=0;g<s;g++)for(var v=g*u,m=o&&o[g%r],b=o&&o[(g+1)%r],y=Math.sin(v),x=Math.cos(v),w=0;w<2;w++)h[p+0]=m?m[0]:x*t,h[p+1]=m?m[1]:y*t,h[p+2]=(.5-w)*n,d[p+0]=m?b[0]-m[0]:x,d[p+1]=m?b[1]-m[1]:y,p+=3;for(var C=0;C<s;C++){var j=Math.floor(C/2)*Math.sign(C%2-.5),M=j*u,P=o&&o[(j+r)%r],k=Math.sin(M),S=Math.cos(M);h[p+0]=P?P[0]:S*t,h[p+1]=P?P[1]:k*t,h[p+2]=n/2,d[p+2]=1,p+=3}for(var O=0,_=0;_<r;_++)c[O++]=2*_+0,c[O++]=2*_+2,c[O++]=2*_+0,c[O++]=2*_+1,c[O++]=2*_+1,c[O++]=2*_+3;return{indices:c,attributes:{POSITION:{size:3,value:h},NORMAL:{size:3,value:d}}}}var y=h.a.fp64LowPart,x=new d.a,w=[0,0,0,255],C={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,fp64:!1,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:w},getLineColor:{type:"accessor",value:w},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:x,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},j=function(e){function t(){return Object(n.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(a.a)(t,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  \n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceFillColors:{size:4,type:5121,transition:!0,accessor:"getFillColor",defaultValue:w},instanceLineColors:{size:4,type:5121,transition:!0,accessor:"getLineColor",defaultValue:w},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){var i=e.props,n=e.oldProps,a=e.changeFlags;Object(s.a)(Object(o.a)(t.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:a});var r=i.fp64!==n.fp64;if(r){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),this.getAttributeManager().invalidateAll()}(r||i.diskResolution!==n.diskResolution||i.vertices!==n.vertices)&&this._updateGeometry(i)}},{key:"getGeometry",value:function(e,t){var i=new m({radius:1,height:2,vertices:t,nradial:e}),n=0;if(t)for(var a=0;a<e;a++){var r=t[a];n+=Math.sqrt(r[0]*r[0]+r[1]*r[1])/e}else n=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*n}),i}},{key:"_getModel",value:function(e){return new p.a(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_updateGeometry",value:function(e){var t=e.diskResolution,i=e.vertices,n=this.getGeometry(t,i);this.setState({fillVertexCount:n.attributes.POSITION.value.length/3,wireframeVertexCount:n.indices.value.length}),this.state.model.setProps({geometry:n})}},{key:"draw",value:function(e){var t=e.uniforms,i=this.context.viewport,n=this.props,a=n.lineWidthUnits,r=n.lineWidthScale,o=n.lineWidthMinPixels,s=n.lineWidthMaxPixels,l=n.elevationScale,u=n.extruded,c=n.filled,h=n.stroked,d=n.wireframe,p=n.offset,g=n.coverage,f=n.radius,v=n.angle,m=this.state,b=m.model,y=m.fillVertexCount,x=m.wireframeVertexCount,w=m.edgeDistance,C="pixels"===a?i.distanceScales.metersPerPixel[2]:1;b.setUniforms(Object.assign({},t,{radius:f,angle:v/180*Math.PI,offset:p,extruded:u,coverage:g,elevationScale:l,edgeDistance:w,widthScale:r*C,widthMinPixels:o,widthMaxPixels:s})),u&&d&&(b.setProps({isIndexed:!0}),b.setVertexCount(x).setDrawMode(1).setUniforms({isStroke:!0}).draw()),c&&(b.setProps({isIndexed:!1}),b.setVertexCount(y).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!u&&h&&(b.setProps({isIndexed:!1}),b.setVertexCount(2*y/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var i=t.startRow,n=t.endRow,a=this.use64bitPositions();if(e.constant=!a,a){var r=this.props,o=r.data,s=r.getPosition,l=e.value,c=i*e.size,h=Object(u.a)(o,i,n),d=h.iterable,p=h.objectInfo,g=!0,f=!1,v=void 0;try{for(var m,b=d[Symbol.iterator]();!(g=(m=b.next()).done);g=!0){var x=m.value;p.index++;var w=s(x,p);l[c++]=y(w[0]),l[c++]=y(w[1])}}catch(e){f=!0,v=e}finally{try{g||null==b.return||b.return()}finally{if(f)throw v}}}else e.value=new Float32Array(2)}}]),t}(c.a);j.layerName="ColumnLayer",j.defaultProps=C},4565:function(e,t,i){"use strict";i.d(t,"a",(function(){return u}));var n=i(17),a=i(1304),r=i(177),o=i(31),s=i(21),l={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},u=function(e){function t(e){var i;return Object(n.a)(this,t),i=Object(a.a)(this,Object(r.a)(t).call(this,e)),e=Object.assign({},l,e),Object.assign(Object(o.a)(i),e),i}return Object(s.a)(t,e),t}((function e(){Object(n.a)(this,e)}))},4676:function(e,t,i){"use strict";i.r(t),i.d(t,"getLayer",(function(){return A}));var n=i(17),a=i(19),r=i(1304),o=i(177),s=i(21),l=i(4565),u=i(4477),c=i(4524),h=i(4560),d=i(4525),p=i(4497),g=i(4526),f=i(4482),v=Math.PI/3,m=[0,v,2*v,3*v,4*v,5*v];function b(e){return e[0]}function y(e){return e[1]}var x=i(4549);function w(){}var C=new l.a,j={colorDomain:null,colorRange:p.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},onSetColorDomain:w,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},onSetElevationDomain:w,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(e,t){var i=e.data,n=e.radius,a=e.getPosition,r=function(e,t){var i=t.getDistanceScales().pixelsPerMeter;return e*i[0]}(n,t),o=[],s=Object(x.a)(i),l=s.iterable,u=s.objectInfo,c=!0,h=!1,d=void 0;try{for(var p,g=l[Symbol.iterator]();!(c=(p=g.next()).done);c=!0){var f=p.value;u.index++,o.push(Object.assign({screenCoord:t.projectFlat(a(f,u))},f))}}catch(e){h=!0,d=e}finally{try{c||null==g.return||g.return()}finally{if(h)throw d}}return{hexagons:function(){var e,t,i,n=0,a=0,r=1,o=1,s=b,l=y;function u(e){var n,a={},r=[],o=e.length;for(n=0;n<o;++n)if(!isNaN(c=+s.call(null,u=e[n],n,e))&&!isNaN(h=+l.call(null,u,n,e))){var u,c,h,d=Math.round(h/=i),p=Math.round(c=c/t-(1&d)/2),g=h-d;if(3*Math.abs(g)>1){var f=c-p,v=p+(c<p?-1:1)/2,m=d+(h<d?-1:1),b=c-v,y=h-m;f*f+g*g>b*b+y*y&&(p=v+(1&d?1:-1)/2,d=m)}var x=p+"-"+d,w=a[x];w?w.push(u):(r.push(w=a[x]=[u]),w.x=(p+(1&d)/2)*t,w.y=d*i)}return r}function c(e){var t=0,i=0;return m.map((function(n){var a=Math.sin(n)*e,r=-Math.cos(n)*e,o=a-t,s=r-i;return t=a,i=r,[o,s]}))}return u.hexagon=function(t){return"m"+c(null==t?e:+t).join("l")+"z"},u.centers=function(){for(var s=[],l=Math.round(a/i),u=Math.round(n/t),c=l*i;c<o+e;c+=i,++l)for(var h=u*t+(1&l)*t/2;h<r+t/2;h+=t)s.push([h,c]);return s},u.mesh=function(){var t=c(e).slice(0,4).join("l");return u.centers().map((function(e){return"M"+e+"m"+t})).join("")},u.x=function(e){return arguments.length?(s=e,u):s},u.y=function(e){return arguments.length?(l=e,u):l},u.radius=function(n){return arguments.length?(t=2*(e=+n)*Math.sin(v),i=1.5*e,u):e},u.size=function(e){return arguments.length?(n=a=0,r=+e[0],o=+e[1],u):[r-n,o-a]},u.extent=function(e){return arguments.length?(n=+e[0][0],a=+e[0][1],r=+e[1][0],o=+e[1][1],u):[[n,a],[r,o]]},u.radius(1)}().radius(r).x((function(e){return e.screenCoord[0]})).y((function(e){return e.screenCoord[1]}))(o).map((function(e,i){return{position:t.unprojectFlat([e.x,e.y]),points:e,index:i}}))}},getPosition:{type:"accessor",value:function(e){return e.position}},fp64:!1,material:C},M=["getColorValue","colorAggregation","getColorWeight"],P=["getElevationValue","elevationAggregation","getElevationWeight"],k=function(e){function t(){return Object(n.a)(this,t),Object(r.a)(this,Object(o.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(a.a)(t,[{key:"initializeState",value:function(){this.state={hexagons:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:w,elevationScaleFunc:w,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(e){var t=this,i=e.oldProps,n=e.props,a=e.changeFlags;this.updateGetValueFuncs(i,n);var r=this.getDimensionChanges(i,n);a.dataChanged||this.needsReProjectPoints(i,n)?this.getHexagons():r&&r.forEach((function(e){return"function"==typeof e&&e.apply(t)}))}},{key:"colorElevationPropsChanged",value:function(e,t){for(var i=!1,n=!1,a=0;a<M.length;a++){var r=M[a];e[r]!==t[r]&&(i=!0)}for(var o=0;o<P.length;o++){var s=P[o];e[s]!==t[s]&&(n=!0)}return{colorChanged:i,elevationChanged:n}}},{key:"updateGetValueFuncs",value:function(e,t){var i=t.getColorValue,n=t.getElevationValue,a=this.props,r=a.colorAggregation,o=a.getColorWeight,s=a.elevationAggregation,l=a.getElevationWeight,u=this.colorElevationPropsChanged(e,t),c=u.colorChanged,h=u.elevationChanged;c&&null===i&&(i=Object(f.b)(r,o)),h&&null===n&&(n=Object(f.b)(s,l)),i&&this.setState({getColorValue:i}),n&&this.setState({getElevationValue:n})}},{key:"needsReProjectPoints",value:function(e,t){return e.radius!==t.radius||e.hexagonAggregator!==t.hexagonAggregator}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(e,t){var i=this.state.dimensionUpdaters,n=[];for(var a in i){var r=i[a].find((function(i){return i.triggers.some((function(i){return e[i]!==t[i]}))}));r&&n.push(r.updater)}return n.length?n:null}},{key:"getHexagons",value:function(){var e=this.props.hexagonAggregator,t=this.context.viewport,i=e(this.props,t),n=i.hexagons,a=i.hexagonVertices;this.updateRadiusAngle(a),this.setState({hexagons:n}),this.getSortedBins()}},{key:"getPickingInfo",value:function(e){var t=e.info,i=this.state,n=i.sortedColorBins,a=i.sortedElevationBins,r=null;if(t.picked&&t.index>-1){var o=this.state.hexagons[t.index],s=n.binMap[o.index]&&n.binMap[o.index].value,l=a.binMap[o.index]&&a.binMap[o.index].value;r=Object.assign({colorValue:s,elevationValue:l},o)}return Object.assign(t,{picked:Boolean(r),object:r})}},{key:"getUpdateTriggers",value:function(){var e=this,t=this.state.dimensionUpdaters,i={},n=function(n){i[n]={};var a=!0,r=!1,o=void 0;try{for(var s,l=t[n][Symbol.iterator]();!(a=(s=l.next()).done);a=!0){s.value.triggers.forEach((function(t){i[n][t]=e.props[t]}))}}catch(e){r=!0,o=e}finally{try{a||null==l.return||l.return()}finally{if(r)throw o}}};for(var a in t)n(a);return i}},{key:"updateRadiusAngle",value:function(e){var t=this.props.radius,i=90;if(Array.isArray(e)){e.length<6&&u.a.error("HexagonCellLayer: hexagonVertices needs to be an array of 6 points")();var n=e[0],a=e[3],r=this.context.viewport.getDistanceScales().pixelsPerMeter,o=this.projectFlat(n),s=this.projectFlat(a),l=o[0]-s[0],c=o[1]-s[1],h=Math.sqrt(l*l+c*c);i=Math.acos(l/h)*-Math.sign(c)/Math.PI*180+90,t=h/2/r[0]}this.setState({angle:i,radius:t})}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var e=this.state.getColorValue,t=new d.a(this.state.hexagons||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var e=this.state.getElevationValue,t=new d.a(this.state.hexagons||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var e=this.props,t=e.lowerPercentile,i=e.upperPercentile,n=e.onSetColorDomain;t>i&&u.a.warn("HexagonLayer: lowerPercentile is bigger than upperPercentile")(),this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([t,i]),"function"==typeof n&&n(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var e=this.props,t=e.elevationLowerPercentile,i=e.elevationUpperPercentile,n=e.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([t,i]),"function"==typeof n&&n(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var e=this.props.colorRange,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(g.b)(t,e)}},{key:"getElevationScale",value:function(){var e=this.props.elevationRange,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(g.a)(t,e)}},{key:"_onGetSublayerColor",value:function(e){var t=this.state,i=t.sortedColorBins,n=t.colorScaleFunc,a=t.colorValueDomain,r=i.binMap[e.index]&&i.binMap[e.index].value,o=this.props.colorDomain||a,s=r>=o[0]&&r<=o[o.length-1]?n(r):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(e){var t=this.state,i=t.sortedElevationBins,n=t.elevationScaleFunc,a=t.elevationValueDomain,r=i.binMap[e.index]&&i.binMap[e.index].value,o=this.props.elevationDomain||a;return r>=o[0]&&r<=o[o.length-1]?n(r):-1}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,i=e.extruded,n=e.coverage,a=e.material,r=e.fp64,o=e.transitions,s=this.state,l=s.angle,u=s.radius;return new(this.getSubLayerClass("hexagon-cell",h.a))({fp64:r,radius:u,diskResolution:6,elevationScale:t,angle:l,extruded:i,coverage:n,material:a,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:o&&{getFillColor:o.getColorValue||o.getColorWeight,getElevation:o.getElevationValue||o.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.hexagons})}}]),t}(c.a);k.layerName="HexagonLayer",k.defaultProps=j;var S=i(0),O=i.n(S),_=i(14),E=i(4486),F=i(4480),L=i(4491),D=i(4487);function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function V(e){return O.a.createElement("div",{className:"deckgl-tooltip"},O.a.createElement(D.a,{label:Object(_.e)("Centroid (Longitude and Latitude)")+": ",value:"("+e.coordinate[0]+", "+e.coordinate[1]+")"}),O.a.createElement(D.a,{label:Object(_.e)("Height")+": ",value:""+e.object.elevationValue}))}function A(e,t,i,n){const a=e,r=a.color_picker;let o=t.data.features.map(e=>R({},e,{color:[r.r,r.g,r.b,255*r.a]}));if(a.js_data_mutator){o=Object(F.a)(a.js_data_mutator)(o)}const s=Object(E.b)(a.js_agg_function,e=>e.weight);return new k(R({id:"hex-layer-"+a.slice_id,data:o,pickable:!0,radius:a.grid_size,minColor:[0,0,0,0],extruded:a.extruded,maxColor:[r.r,r.g,r.b,255*r.a],outline:!1,getElevationValue:s,getColorValue:s},Object(E.a)(a,n,V)))}t.default=Object(L.b)(A,(function(e){return e.map(e=>e.position)}))}}]);