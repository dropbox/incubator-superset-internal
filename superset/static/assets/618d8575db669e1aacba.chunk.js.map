{"version":3,"file":"618d8575db669e1aacba.chunk.js","mappings":"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","sources":["webpack://superset/./src/explore/components/controls/AnnotationLayerControl/AnnotationLayer.jsx","webpack://superset/./packages/superset-ui-core/src/math-expression/index.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { CompactPicker } from 'react-color';\nimport Button from 'src/components/Button';\nimport {\n  t,\n  SupersetClient,\n  getCategoricalSchemeRegistry,\n  getChartMetadataRegistry,\n  validateNonEmpty,\n  isValidExpression,\n  styled,\n  withTheme,\n} from '@superset-ui/core';\n\nimport SelectControl from 'src/explore/components/controls/SelectControl';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport {\n  ANNOTATION_SOURCE_TYPES,\n  ANNOTATION_TYPES,\n  ANNOTATION_TYPES_METADATA,\n  DEFAULT_ANNOTATION_TYPE,\n  requiresQuery,\n  ANNOTATION_SOURCE_TYPES_METADATA,\n} from 'src/modules/AnnotationTypes';\nimport PopoverSection from 'src/components/PopoverSection';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { EmptyStateSmall } from 'src/components/EmptyState';\n\nconst AUTOMATIC_COLOR = '';\n\nconst propTypes = {\n  name: PropTypes.string,\n  annotationType: PropTypes.string,\n  sourceType: PropTypes.string,\n  color: PropTypes.string,\n  opacity: PropTypes.string,\n  style: PropTypes.string,\n  width: PropTypes.number,\n  showMarkers: PropTypes.bool,\n  hideLine: PropTypes.bool,\n  value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  overrides: PropTypes.object,\n  show: PropTypes.bool,\n  showLabel: PropTypes.bool,\n  titleColumn: PropTypes.string,\n  descriptionColumns: PropTypes.arrayOf(PropTypes.string),\n  timeColumn: PropTypes.string,\n  intervalEndColumn: PropTypes.string,\n  vizType: PropTypes.string,\n\n  error: PropTypes.string,\n  colorScheme: PropTypes.string,\n\n  addAnnotationLayer: PropTypes.func,\n  removeAnnotationLayer: PropTypes.func,\n  close: PropTypes.func,\n};\n\nconst defaultProps = {\n  name: '',\n  annotationType: DEFAULT_ANNOTATION_TYPE,\n  sourceType: '',\n  color: AUTOMATIC_COLOR,\n  opacity: '',\n  style: 'solid',\n  width: 1,\n  showMarkers: false,\n  hideLine: false,\n  overrides: {},\n  colorScheme: 'd3Category10',\n  show: true,\n  showLabel: false,\n  titleColumn: '',\n  descriptionColumns: [],\n  timeColumn: '',\n  intervalEndColumn: '',\n\n  addAnnotationLayer: () => {},\n  removeAnnotationLayer: () => {},\n  close: () => {},\n};\n\nconst NotFoundContentWrapper = styled.div`\n  && > div:first-child {\n    padding-left: 0;\n    padding-right: 0;\n  }\n`;\n\nconst NotFoundContent = () => (\n  <NotFoundContentWrapper>\n    <EmptyStateSmall\n      title={t('No annotation layers')}\n      description={\n        <span>\n          {t('Add an annotation layer')}{' '}\n          <a\n            href=\"/annotationlayermodelview/list\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n          >\n            {t('here')}\n          </a>\n          .\n        </span>\n      }\n      image=\"empty.svg\"\n    />\n  </NotFoundContentWrapper>\n);\n\nclass AnnotationLayer extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    const {\n      name,\n      annotationType,\n      sourceType,\n      color,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      value,\n      overrides,\n      show,\n      showLabel,\n      titleColumn,\n      descriptionColumns,\n      timeColumn,\n      intervalEndColumn,\n      vizType,\n    } = props;\n\n    // Only allow override whole time_range\n    if ('since' in overrides || 'until' in overrides) {\n      overrides.time_range = null;\n      delete overrides.since;\n      delete overrides.until;\n    }\n\n    // Check if annotationType is supported by this chart\n    const metadata = getChartMetadataRegistry().get(vizType);\n    const supportedAnnotationTypes = metadata?.supportedAnnotationTypes || [];\n    const validAnnotationType = supportedAnnotationTypes.includes(\n      annotationType,\n    )\n      ? annotationType\n      : supportedAnnotationTypes[0];\n\n    this.state = {\n      // base\n      name,\n      annotationType: validAnnotationType,\n      sourceType,\n      value,\n      overrides,\n      show,\n      showLabel,\n      // slice\n      titleColumn,\n      descriptionColumns,\n      timeColumn,\n      intervalEndColumn,\n      // display\n      color: color || AUTOMATIC_COLOR,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      // refData\n      isNew: !name,\n      isLoadingOptions: true,\n      valueOptions: [],\n    };\n    this.submitAnnotation = this.submitAnnotation.bind(this);\n    this.deleteAnnotation = this.deleteAnnotation.bind(this);\n    this.applyAnnotation = this.applyAnnotation.bind(this);\n    this.fetchOptions = this.fetchOptions.bind(this);\n    this.handleAnnotationType = this.handleAnnotationType.bind(this);\n    this.handleAnnotationSourceType =\n      this.handleAnnotationSourceType.bind(this);\n    this.handleValue = this.handleValue.bind(this);\n    this.isValidForm = this.isValidForm.bind(this);\n  }\n\n  componentDidMount() {\n    const { annotationType, sourceType, isLoadingOptions } = this.state;\n    this.fetchOptions(annotationType, sourceType, isLoadingOptions);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (prevState.sourceType !== this.state.sourceType) {\n      this.fetchOptions(this.state.annotationType, this.state.sourceType, true);\n    }\n  }\n\n  getSupportedSourceTypes(annotationType) {\n    // Get vis types that can be source.\n    const sources = getChartMetadataRegistry()\n      .entries()\n      .filter(({ value: chartMetadata }) =>\n        chartMetadata.canBeAnnotationType(annotationType),\n      )\n      .map(({ key, value: chartMetadata }) => ({\n        value: key,\n        label: chartMetadata.name,\n      }));\n    // Prepend native source if applicable\n    if (ANNOTATION_TYPES_METADATA[annotationType]?.supportNativeSource) {\n      sources.unshift(ANNOTATION_SOURCE_TYPES_METADATA.NATIVE);\n    }\n    return sources;\n  }\n\n  isValidFormulaAnnotation(expression, annotationType) {\n    if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      return isValidExpression(expression);\n    }\n    return true;\n  }\n\n  isValidForm() {\n    const {\n      name,\n      annotationType,\n      sourceType,\n      value,\n      timeColumn,\n      intervalEndColumn,\n    } = this.state;\n    const errors = [\n      validateNonEmpty(name),\n      validateNonEmpty(annotationType),\n      validateNonEmpty(value),\n    ];\n    if (sourceType !== ANNOTATION_SOURCE_TYPES.NATIVE) {\n      if (annotationType === ANNOTATION_TYPES.EVENT) {\n        errors.push(validateNonEmpty(timeColumn));\n      }\n      if (annotationType === ANNOTATION_TYPES.INTERVAL) {\n        errors.push(validateNonEmpty(timeColumn));\n        errors.push(validateNonEmpty(intervalEndColumn));\n      }\n    }\n    errors.push(!this.isValidFormulaAnnotation(value, annotationType));\n    return !errors.filter(x => x).length;\n  }\n\n  handleAnnotationType(annotationType) {\n    this.setState({\n      annotationType,\n      sourceType: null,\n      value: null,\n    });\n  }\n\n  handleAnnotationSourceType(sourceType) {\n    const { sourceType: prevSourceType } = this.state;\n\n    if (prevSourceType !== sourceType) {\n      this.setState({ sourceType, value: null, isLoadingOptions: true });\n    }\n  }\n\n  handleValue(value) {\n    this.setState({\n      value,\n      descriptionColumns: [],\n      intervalEndColumn: null,\n      timeColumn: null,\n      titleColumn: null,\n      overrides: { time_range: null },\n    });\n  }\n\n  fetchOptions(annotationType, sourceType, isLoadingOptions) {\n    if (isLoadingOptions) {\n      if (sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n        SupersetClient.get({\n          endpoint: '/annotationlayermodelview/api/read?',\n        }).then(({ json }) => {\n          const layers = json\n            ? json.result.map(layer => ({\n                value: layer.id,\n                label: layer.name,\n              }))\n            : [];\n          this.setState({\n            isLoadingOptions: false,\n            valueOptions: layers,\n          });\n        });\n      } else if (requiresQuery(sourceType)) {\n        SupersetClient.get({ endpoint: '/superset/user_slices' }).then(\n          ({ json }) => {\n            const registry = getChartMetadataRegistry();\n            this.setState({\n              isLoadingOptions: false,\n              valueOptions: json\n                .filter(x => {\n                  const metadata = registry.get(x.viz_type);\n                  return (\n                    metadata && metadata.canBeAnnotationType(annotationType)\n                  );\n                })\n                .map(x => ({ value: x.id, label: x.title, slice: x })),\n            });\n          },\n        );\n      } else {\n        this.setState({\n          isLoadingOptions: false,\n          valueOptions: [],\n        });\n      }\n    }\n  }\n\n  deleteAnnotation() {\n    this.props.removeAnnotationLayer();\n    this.props.close();\n  }\n\n  applyAnnotation() {\n    if (this.isValidForm()) {\n      const annotationFields = [\n        'name',\n        'annotationType',\n        'sourceType',\n        'color',\n        'opacity',\n        'style',\n        'width',\n        'showMarkers',\n        'hideLine',\n        'value',\n        'overrides',\n        'show',\n        'showLabel',\n        'titleColumn',\n        'descriptionColumns',\n        'timeColumn',\n        'intervalEndColumn',\n      ];\n      const newAnnotation = {};\n      annotationFields.forEach(field => {\n        if (this.state[field] !== null) {\n          newAnnotation[field] = this.state[field];\n        }\n      });\n\n      if (newAnnotation.color === AUTOMATIC_COLOR) {\n        newAnnotation.color = null;\n      }\n\n      this.props.addAnnotationLayer(newAnnotation);\n      this.setState({ isNew: false });\n    }\n  }\n\n  submitAnnotation() {\n    this.applyAnnotation();\n    this.props.close();\n  }\n\n  renderOption(option) {\n    return (\n      <span\n        css={{\n          overflow: 'hidden',\n          textOverflow: 'ellipsis',\n          whiteSpace: 'nowrap',\n        }}\n        title={option.label}\n      >\n        {option.label}\n      </span>\n    );\n  }\n\n  renderValueConfiguration() {\n    const {\n      annotationType,\n      sourceType,\n      value,\n      valueOptions,\n      isLoadingOptions,\n    } = this.state;\n    let label = '';\n    let description = '';\n    if (requiresQuery(sourceType)) {\n      if (sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n        label = 'Annotation layer';\n        description = 'Select the Annotation Layer you would like to use.';\n      } else {\n        label = t('Chart');\n        description = t(\n          `Use another existing chart as a source for annotations and overlays.\n          Your chart must be one of these visualization types: [%s]`,\n          this.getSupportedSourceTypes(annotationType)\n            .map(x => x.label)\n            .join(', '),\n        );\n      }\n    } else if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      label = 'Formula';\n      description = `Expects a formula with depending time parameter 'x'\n        in milliseconds since epoch. mathjs is used to evaluate the formulas.\n        Example: '2x+5'`;\n    }\n    if (requiresQuery(sourceType)) {\n      return (\n        <SelectControl\n          ariaLabel={t('Annotation layer value')}\n          name=\"annotation-layer-value\"\n          showHeader\n          hovered\n          description={description}\n          label={label}\n          placeholder=\"\"\n          options={valueOptions}\n          isLoading={isLoadingOptions}\n          value={value}\n          onChange={this.handleValue}\n          validationErrors={!value ? ['Mandatory'] : []}\n          optionRenderer={this.renderOption}\n          notFoundContent={<NotFoundContent />}\n        />\n      );\n    }\n    if (annotationType === ANNOTATION_TYPES.FORMULA) {\n      return (\n        <TextControl\n          name=\"annotation-layer-value\"\n          hovered\n          showHeader\n          description={description}\n          label={label}\n          placeholder=\"\"\n          value={value}\n          onChange={this.handleValue}\n          validationErrors={\n            !this.isValidFormulaAnnotation(value, annotationType)\n              ? ['Bad formula.']\n              : []\n          }\n        />\n      );\n    }\n    return '';\n  }\n\n  renderSliceConfiguration() {\n    const {\n      annotationType,\n      sourceType,\n      value,\n      valueOptions,\n      overrides,\n      titleColumn,\n      timeColumn,\n      intervalEndColumn,\n      descriptionColumns,\n    } = this.state;\n    const { slice } = valueOptions.find(x => x.value === value) || {};\n    if (sourceType !== ANNOTATION_SOURCE_TYPES.NATIVE && slice) {\n      const columns = (slice.data.groupby || [])\n        .concat(slice.data.all_columns || [])\n        .map(x => ({ value: x, label: x }));\n      const timeColumnOptions = slice.data.include_time\n        ? [{ value: '__timestamp', label: '__timestamp' }].concat(columns)\n        : columns;\n      return (\n        <div style={{ marginRight: '2rem' }}>\n          <PopoverSection\n            isSelected\n            title={t('Annotation Slice Configuration')}\n            info={t(`This section allows you to configure how to use the slice\n               to generate annotations.`)}\n          >\n            {(annotationType === ANNOTATION_TYPES.EVENT ||\n              annotationType === ANNOTATION_TYPES.INTERVAL) && (\n              <SelectControl\n                ariaLabel={t('Annotation layer time column')}\n                hovered\n                name=\"annotation-layer-time-column\"\n                label={\n                  annotationType === ANNOTATION_TYPES.INTERVAL\n                    ? t('Interval start column')\n                    : t('Event time column')\n                }\n                description={t(\n                  'This column must contain date/time information.',\n                )}\n                validationErrors={!timeColumn ? ['Mandatory'] : []}\n                clearable={false}\n                options={timeColumnOptions}\n                value={timeColumn}\n                onChange={v => this.setState({ timeColumn: v })}\n              />\n            )}\n            {annotationType === ANNOTATION_TYPES.INTERVAL && (\n              <SelectControl\n                ariaLabel={t('Annotation layer interval end')}\n                hovered\n                name=\"annotation-layer-intervalEnd\"\n                label={t('Interval End column')}\n                description={t(\n                  'This column must contain date/time information.',\n                )}\n                validationErrors={!intervalEndColumn ? ['Mandatory'] : []}\n                options={columns}\n                value={intervalEndColumn}\n                onChange={value => this.setState({ intervalEndColumn: value })}\n              />\n            )}\n            <SelectControl\n              ariaLabel={t('Annotation layer title column')}\n              hovered\n              name=\"annotation-layer-title\"\n              label={t('Title Column')}\n              description={t('Pick a title for you annotation.')}\n              options={[{ value: '', label: 'None' }].concat(columns)}\n              value={titleColumn}\n              onChange={value => this.setState({ titleColumn: value })}\n            />\n            {annotationType !== ANNOTATION_TYPES.TIME_SERIES && (\n              <SelectControl\n                ariaLabel={t('Annotation layer description columns')}\n                hovered\n                name=\"annotation-layer-title\"\n                label={t('Description Columns')}\n                description={t(\n                  \"Pick one or more columns that should be shown in the annotation. If you don't select a column all of them will be shown.\",\n                )}\n                multi\n                options={columns}\n                value={descriptionColumns}\n                onChange={value => this.setState({ descriptionColumns: value })}\n              />\n            )}\n            <div style={{ marginTop: '1rem' }}>\n              <CheckboxControl\n                hovered\n                name=\"annotation-override-time_range\"\n                label=\"Override time range\"\n                description={`This controls whether the \"time_range\" field from the current\n                  view should be passed down to the chart containing the annotation data.`}\n                value={'time_range' in overrides}\n                onChange={v => {\n                  delete overrides.time_range;\n                  if (v) {\n                    this.setState({\n                      overrides: { ...overrides, time_range: null },\n                    });\n                  } else {\n                    this.setState({ overrides: { ...overrides } });\n                  }\n                }}\n              />\n              <CheckboxControl\n                hovered\n                name=\"annotation-override-timegrain\"\n                label=\"Override time grain\"\n                description={`This controls whether the time grain field from the current\n                  view should be passed down to the chart containing the annotation data.`}\n                value={'time_grain_sqla' in overrides}\n                onChange={v => {\n                  delete overrides.time_grain_sqla;\n                  delete overrides.granularity;\n                  if (v) {\n                    this.setState({\n                      overrides: {\n                        ...overrides,\n                        time_grain_sqla: null,\n                        granularity: null,\n                      },\n                    });\n                  } else {\n                    this.setState({ overrides: { ...overrides } });\n                  }\n                }}\n              />\n              <TextControl\n                hovered\n                name=\"annotation-layer-timeshift\"\n                label=\"Time Shift\"\n                description={`Time delta in natural language\n                  (example:  24 hours, 7 days, 56 weeks, 365 days)`}\n                placeholder=\"\"\n                value={overrides.time_shift}\n                onChange={v =>\n                  this.setState({ overrides: { ...overrides, time_shift: v } })\n                }\n              />\n            </div>\n          </PopoverSection>\n        </div>\n      );\n    }\n    return '';\n  }\n\n  renderDisplayConfiguration() {\n    const {\n      color,\n      opacity,\n      style,\n      width,\n      showMarkers,\n      hideLine,\n      annotationType,\n    } = this.state;\n    const colorScheme = getCategoricalSchemeRegistry()\n      .get(this.props.colorScheme)\n      .colors.concat();\n    if (\n      color &&\n      color !== AUTOMATIC_COLOR &&\n      !colorScheme.find(x => x.toLowerCase() === color.toLowerCase())\n    ) {\n      colorScheme.push(color);\n    }\n    return (\n      <PopoverSection\n        isSelected\n        title={t('Display configuration')}\n        info={t('Configure your how you overlay is displayed here.')}\n      >\n        <SelectControl\n          ariaLabel={t('Annotation layer stroke')}\n          name=\"annotation-layer-stroke\"\n          label={t('Style')}\n          // see '../../../visualizations/nvd3_vis.css'\n          options={[\n            { value: 'solid', label: 'Solid' },\n            { value: 'dashed', label: 'Dashed' },\n            { value: 'longDashed', label: 'Long dashed' },\n            { value: 'dotted', label: 'Dotted' },\n          ]}\n          value={style}\n          clearable={false}\n          onChange={v => this.setState({ style: v })}\n        />\n        <SelectControl\n          ariaLabel={t('Annotation layer opacity')}\n          name=\"annotation-layer-opacity\"\n          label={t('Opacity')}\n          // see '../../../visualizations/nvd3_vis.css'\n          options={[\n            { value: '', label: 'Solid' },\n            { value: 'opacityLow', label: '0.2' },\n            { value: 'opacityMedium', label: '0.5' },\n            { value: 'opacityHigh', label: '0.8' },\n          ]}\n          value={opacity}\n          onChange={value => this.setState({ opacity: value })}\n        />\n        <div>\n          <ControlHeader label={t('Color')} />\n          <div style={{ display: 'flex', flexDirection: 'column' }}>\n            <CompactPicker\n              color={color}\n              colors={colorScheme}\n              onChangeComplete={v => this.setState({ color: v.hex })}\n            />\n            <Button\n              style={{ marginTop: '0.5rem', marginBottom: '0.5rem' }}\n              buttonStyle={color === AUTOMATIC_COLOR ? 'success' : 'default'}\n              buttonSize=\"xsmall\"\n              onClick={() => this.setState({ color: AUTOMATIC_COLOR })}\n            >\n              Automatic Color\n            </Button>\n          </div>\n        </div>\n        <TextControl\n          name=\"annotation-layer-stroke-width\"\n          label={t('Line width')}\n          isInt\n          value={width}\n          onChange={v => this.setState({ width: v })}\n        />\n        {annotationType === ANNOTATION_TYPES.TIME_SERIES && (\n          <CheckboxControl\n            hovered\n            name=\"annotation-layer-show-markers\"\n            label=\"Show Markers\"\n            description=\"Shows or hides markers for the time series\"\n            value={showMarkers}\n            onChange={v => this.setState({ showMarkers: v })}\n          />\n        )}\n        {annotationType === ANNOTATION_TYPES.TIME_SERIES && (\n          <CheckboxControl\n            hovered\n            name=\"annotation-layer-hide-line\"\n            label=\"Hide Line\"\n            description=\"Hides the Line for the time series\"\n            value={hideLine}\n            onChange={v => this.setState({ hideLine: v })}\n          />\n        )}\n      </PopoverSection>\n    );\n  }\n\n  render() {\n    const { isNew, name, annotationType, sourceType, show, showLabel } =\n      this.state;\n    const isValid = this.isValidForm();\n    const metadata = getChartMetadataRegistry().get(this.props.vizType);\n    const supportedAnnotationTypes = metadata\n      ? metadata.supportedAnnotationTypes.map(\n          type => ANNOTATION_TYPES_METADATA[type],\n        )\n      : [];\n    const supportedSourceTypes = this.getSupportedSourceTypes(annotationType);\n\n    return (\n      <>\n        {this.props.error && (\n          <span style={{ color: this.props.theme.colors.error.base }}>\n            ERROR: {this.props.error}\n          </span>\n        )}\n        <div style={{ display: 'flex', flexDirection: 'row' }}>\n          <div style={{ marginRight: '2rem' }}>\n            <PopoverSection\n              isSelected\n              title={t('Layer configuration')}\n              info={t('Configure the basics of your Annotation Layer.')}\n            >\n              <TextControl\n                name=\"annotation-layer-name\"\n                label={t('Name')}\n                placeholder=\"\"\n                value={name}\n                onChange={v => this.setState({ name: v })}\n                validationErrors={!name ? [t('Mandatory')] : []}\n              />\n              <CheckboxControl\n                name=\"annotation-layer-hide\"\n                label={t('Hide layer')}\n                value={!show}\n                onChange={v => this.setState({ show: !v })}\n              />\n              <CheckboxControl\n                name=\"annotation-label-show\"\n                label={t('Show label')}\n                value={showLabel}\n                hovered\n                description={t('Whether to always show the annotation label')}\n                onChange={v => this.setState({ showLabel: v })}\n              />\n              <SelectControl\n                ariaLabel={t('Annotation layer type')}\n                hovered\n                description={t('Choose the annotation layer type')}\n                label={t('Annotation layer type')}\n                name=\"annotation-layer-type\"\n                clearable={false}\n                options={supportedAnnotationTypes}\n                value={annotationType}\n                onChange={this.handleAnnotationType}\n              />\n              {supportedSourceTypes.length > 0 && (\n                <SelectControl\n                  ariaLabel={t('Annotation source type')}\n                  hovered\n                  description={t('Choose the source of your annotations')}\n                  label={t('Annotation source')}\n                  name=\"annotation-source-type\"\n                  options={supportedSourceTypes}\n                  notFoundContent={<NotFoundContent />}\n                  value={sourceType}\n                  onChange={this.handleAnnotationSourceType}\n                  validationErrors={!sourceType ? [t('Mandatory')] : []}\n                />\n              )}\n              {this.renderValueConfiguration()}\n            </PopoverSection>\n          </div>\n          {this.renderSliceConfiguration()}\n          {this.renderDisplayConfiguration()}\n        </div>\n        <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n          {isNew ? (\n            <Button buttonSize=\"small\" onClick={() => this.props.close()}>\n              {t('Cancel')}\n            </Button>\n          ) : (\n            <Button buttonSize=\"small\" onClick={this.deleteAnnotation}>\n              {t('Remove')}\n            </Button>\n          )}\n          <div>\n            <Button\n              buttonSize=\"small\"\n              disabled={!isValid}\n              onClick={this.applyAnnotation}\n            >\n              {t('Apply')}\n            </Button>\n\n            <Button\n              buttonSize=\"small\"\n              buttonStyle=\"primary\"\n              disabled={!isValid}\n              onClick={this.submitAnnotation}\n            >\n              {t('OK')}\n            </Button>\n          </div>\n        </div>\n      </>\n    );\n  }\n}\n\nAnnotationLayer.propTypes = propTypes;\nAnnotationLayer.defaultProps = defaultProps;\n\nexport default withTheme(AnnotationLayer);\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport mexp from 'math-expression-evaluator';\n\nconst REPLACE_OPERATORS: [RegExp, string][] = [\n  [new RegExp(/==/g), 'Eq'],\n  [new RegExp(/>=/g), 'Gte'],\n  [new RegExp(/<=/g), 'Lte'],\n  [new RegExp(/>/g), 'Gt'],\n  [new RegExp(/</g), 'Lt'],\n];\n\nconst TOKENS = [\n  {\n    type: 3,\n    token: 'x',\n    show: 'x',\n    value: 'x',\n  },\n  {\n    type: 2,\n    token: '&',\n    show: '&',\n    value: (a: number, b: number): number => a & b,\n  },\n  {\n    type: 2,\n    token: '|',\n    show: '|',\n    value: (a: number, b: number): number => a | b,\n  },\n  {\n    type: 2,\n    token: 'and',\n    show: 'and',\n    value: (a: number, b: number): number => a && b,\n  },\n  {\n    type: 2,\n    token: 'xor',\n    show: 'xor',\n    value: (a: number, b: number): number => a ^ b,\n  },\n  {\n    type: 2,\n    token: 'or',\n    show: 'or',\n    value: (a: number, b: number): number => Number(a || b),\n  },\n  {\n    type: 2,\n    token: 'Eq',\n    show: 'Eq',\n    value: (a: number, b: number): number => Number(a === b),\n  },\n  {\n    type: 2,\n    token: 'Lt',\n    show: 'Lt',\n    value: (a: number, b: number): number => Number(a < b),\n  },\n  {\n    type: 2,\n    token: 'Lte',\n    show: 'Lte',\n    value: (a: number, b: number): number => Number(a <= b),\n  },\n  {\n    type: 2,\n    token: 'Gt',\n    show: 'Gt',\n    value: (a: number, b: number): number => Number(a > b),\n  },\n  {\n    type: 2,\n    token: 'Gte',\n    show: 'Gte',\n    value: (a: number, b: number): number => Number(a >= b),\n  },\n];\n\nexport function evalExpression(expression: string, value: number): number {\n  let parsedExpression = expression;\n  // replace `<` with `Lt` (and others) to avoid clashes with builtin function operators\n  // that are not needed in Superset.\n  REPLACE_OPERATORS.forEach(([key, value]) => {\n    parsedExpression = parsedExpression.replace(key, value);\n  });\n  const subExpressions = String(parsedExpression).split('=');\n  parsedExpression = subExpressions[1] ?? subExpressions[0];\n  // we can ignore the type requirement on `TOKENS`, as value is always `number`\n  // and doesn't need to consider `number | underfined`.\n  // @ts-ignore\n  return Number(mexp.eval(parsedExpression, TOKENS, { x: value }));\n}\n\nexport function isValidExpression(expression: string): boolean {\n  try {\n    evalExpression(expression, 0);\n  } catch (err) {\n    return false;\n  }\n  return true;\n}\n"],"names":["AUTOMATIC_COLOR","propTypes","name","PropTypes","annotationType","sourceType","color","opacity","style","width","showMarkers","hideLine","value","overrides","show","showLabel","titleColumn","descriptionColumns","timeColumn","intervalEndColumn","vizType","error","colorScheme","addAnnotationLayer","removeAnnotationLayer","close","defaultProps","DEFAULT_ANNOTATION_TYPE","NotFoundContentWrapper","styled","NotFoundContent","title","t","description","href","target","rel","image","AnnotationLayer","React","constructor","props","super","time_range","since","until","metadata","getChartMetadataRegistry","get","supportedAnnotationTypes","validAnnotationType","includes","this","state","isNew","isLoadingOptions","valueOptions","submitAnnotation","bind","deleteAnnotation","applyAnnotation","fetchOptions","handleAnnotationType","handleAnnotationSourceType","handleValue","isValidForm","componentDidMount","componentDidUpdate","prevProps","prevState","getSupportedSourceTypes","sources","entries","filter","chartMetadata","canBeAnnotationType","map","key","label","ANNOTATION_TYPES_METADATA","supportNativeSource","unshift","ANNOTATION_SOURCE_TYPES_METADATA","isValidFormulaAnnotation","expression","ANNOTATION_TYPES","isValidExpression","errors","validateNonEmpty","ANNOTATION_SOURCE_TYPES","push","x","length","setState","prevSourceType","SupersetClient","endpoint","then","json","layers","result","layer","id","requiresQuery","registry","viz_type","slice","newAnnotation","forEach","field","renderOption","option","css","renderValueConfiguration","join","ariaLabel","showHeader","hovered","placeholder","options","isLoading","onChange","validationErrors","optionRenderer","notFoundContent","renderSliceConfiguration","find","columns","data","groupby","concat","all_columns","timeColumnOptions","include_time","marginRight","isSelected","info","clearable","v","multi","marginTop","time_grain_sqla","granularity","time_shift","renderDisplayConfiguration","getCategoricalSchemeRegistry","colors","toLowerCase","display","flexDirection","onChangeComplete","hex","marginBottom","buttonStyle","buttonSize","onClick","isInt","render","isValid","type","supportedSourceTypes","theme","base","justifyContent","disabled","withTheme","REPLACE_OPERATORS","RegExp","TOKENS","token","a","b","Number","evalExpression","parsedExpression","replace","subExpressions","String","split","err"],"sourceRoot":""}