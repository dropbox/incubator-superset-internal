{"version":3,"file":"3389.37e5f255419824b66667.entry.js","mappings":"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","sources":["webpack://superset/./src/components/Chart/chartAction.js","webpack://superset/./src/components/ErrorBoundary/index.jsx","webpack://superset/./src/dashboard/actions/dashboardFilters.js","webpack://superset/./src/dashboard/util/filterboxMigrationHelper.ts","webpack://superset/./src/dashboard/actions/hydrate.js","webpack://superset/./src/dashboard/util/getEmptyLayout.js","webpack://superset/./src/dashboard/util/findFirstParentContainer.js","webpack://superset/./src/dashboard/actions/sliceEntities.js","webpack://superset/./src/dashboard/reducers/dashboardFilters.js","webpack://superset/./src/dashboard/reducers/sliceEntities.js","webpack://superset/./src/dashboard/util/activeDashboardFilters.js","webpack://superset/./src/dashboard/util/getFilterConfigsFromFormdata.js","webpack://superset/./src/dashboard/util/newComponentFactory.js","webpack://superset/./src/dashboard/util/serializeActiveFilterValues.js","webpack://superset/./src/explore/components/controls/CheckboxControl.jsx","webpack://superset/./src/explore/components/controls/ColorSchemeControl/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilter/index.js","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterOption/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/adhocFilterType.js","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterControl/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/columnType.js","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetric.js","webpack://superset/./src/explore/components/controls/MetricControl/FilterDefinitionOption.jsx","webpack://superset/./src/explore/components/controls/MetricControl/adhocMetricType.js","webpack://superset/./src/explore/components/controls/MetricControl/columnType.js","webpack://superset/./src/explore/components/controls/MetricControl/savedMetricType.js","webpack://superset/./src/explore/components/controls/SelectControl.jsx","webpack://superset/./src/explore/components/controls/SpatialControl.jsx","webpack://superset/./src/explore/components/controls/TextAreaControl.jsx","webpack://superset/./src/explore/controls.jsx","webpack://superset/./src/explore/store.js","webpack://superset/./src/modules/AnnotationTypes.js","webpack://superset/./src/components/Select/WindowedSelect/WindowedMenuList.tsx","webpack://superset/./src/components/Select/WindowedSelect/windowed.tsx","webpack://superset/./src/components/Select/WindowedSelect/index.tsx","webpack://superset/./src/components/Select/styles.tsx","webpack://superset/./src/components/Select/DeprecatedSelect.tsx","webpack://superset/./src/components/Select/OnPasteSelect.jsx","webpack://superset/./src/components/Select/NativeSelect.tsx","webpack://superset/./src/visualizations/FilterBox/FilterBox.jsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/CertifiedIconWithTooltip.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnOption.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_derived.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_boolean.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_abc.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/type-icons/field_num.svg","webpack://superset/./packages/superset-ui-chart-controls/src/components/ColumnTypeLabel/ColumnTypeLabel.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/MetricOption.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/SQLPopover.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/labelUtils.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/constants.ts","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlHeader.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/RadioButtonControl.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlForm/index.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/Select.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlForm/controls.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/components/ControlForm/ControlFormItem.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/constants.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/ColumnConfigPopover.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/ColumnConfigItem.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/types.ts","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/index.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/components/ColumnConfigControl/ColumnConfigControl.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/dndControls.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/shared-controls/index.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/types.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/D3Formatting.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/defineSavedMetrics.ts","webpack://superset/./packages/superset-ui-chart-controls/src/utils/expandControlConfig.tsx","webpack://superset/./packages/superset-ui-chart-controls/src/utils/selectOptions.ts","webpack://superset/./packages/superset-ui-core/src/chart/registries/ChartControlPanelRegistrySingleton.ts","webpack://superset/./packages/superset-ui-core/src/chart/types/Base.ts","webpack://superset/./packages/superset-ui-core/src/color/CategoricalColorNamespace.ts","webpack://superset/./packages/superset-ui-core/src/color/CategoricalColorScale.ts","webpack://superset/./packages/superset-ui-core/src/color/SharedLabelColorSingleton.ts","webpack://superset/./packages/superset-ui-core/src/color/stringifyAndTrim.ts","webpack://superset/./packages/superset-ui-core/src/color/utils.ts","webpack://superset/./packages/superset-ui-core/src/components/constants.ts","webpack://superset/./packages/superset-ui-core/src/dynamic-plugins/shared-modules.ts","webpack://superset/./packages/superset-ui-core/src/query/types/AdvancedAnalytics.ts","webpack://superset/./packages/superset-ui-core/src/query/types/Dashboard.ts","webpack://superset/./packages/superset-ui-core/src/query/types/QueryResponse.ts","webpack://superset/./packages/superset-ui-core/src/utils/isEqualArray.ts","webpack://superset/./packages/superset-ui-core/src/validator/legacyValidateInteger.ts","webpack://superset/./packages/superset-ui-core/src/validator/legacyValidateNumber.ts","webpack://superset/./packages/superset-ui-core/src/validator/validateNonEmpty.ts","webpack://superset/./packages/superset-ui-core/src/validator/validateNumber.ts","webpack://superset/./src/components/Chart/chartReducer.ts","webpack://superset/./src/components/Checkbox/CheckboxIcons.tsx","webpack://superset/./src/components/Checkbox/Checkbox.tsx","webpack://superset/./src/components/Datasource/ChangeDatasourceModal.tsx","webpack://superset/./src/components/Datasource/DatasourceModal.tsx","webpack://superset/./src/components/DatePicker/index.tsx","webpack://superset/./src/components/DynamicPlugins/index.tsx","webpack://superset/./src/components/FacePile/index.tsx","webpack://superset/./src/components/FacePile/utils.tsx","webpack://superset/./src/components/Popover/index.tsx","webpack://superset/./src/components/PopoverSection/index.tsx","webpack://superset/./src/dashboard/actions/dashboardInfo.ts","webpack://superset/./src/dashboard/actions/datasources.ts","webpack://superset/./src/dashboard/actions/nativeFilters.ts","webpack://superset/./src/dashboard/components/nativeFilters/FiltersConfigModal/utils.ts","webpack://superset/./src/dashboard/components/nativeFilters/utils.ts","webpack://superset/./src/dashboard/reducers/nativeFilters.ts","webpack://superset/./src/dashboard/util/componentTypes.ts","webpack://superset/./src/dashboard/util/extractUrlParams.ts","webpack://superset/./src/dashboard/util/findPermission.ts","webpack://superset/./src/dashboard/util/getDashboardFilterKey.ts","webpack://superset/./src/dashboard/util/getLocationHash.ts","webpack://superset/./src/dataMask/actions.ts","webpack://superset/./src/dataMask/reducer.ts","webpack://superset/./src/explore/components/controls/CustomListItem/index.tsx","webpack://superset/./src/explore/components/controls/AnnotationLayerControl/index.jsx","webpack://superset/./src/explore/components/controls/BoundsControl.tsx","webpack://superset/./src/explore/components/controls/CollectionControl/index.jsx","webpack://superset/./src/explore/components/controls/ColorPickerControl.jsx","webpack://superset/./src/explore/components/controls/DatasourceControl/index.jsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricEditPopoverTitle.tsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricEditPopover/index.jsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricPopoverTrigger.tsx","webpack://superset/./src/explore/components/controls/MetricControl/AdhocMetricOption.jsx","webpack://superset/./src/explore/components/controls/MetricControl/MetricDefinitionValue.jsx","webpack://superset/./src/explore/components/controls/MetricControl/MetricsControl.jsx","webpack://superset/./src/explore/components/controls/FixedOrMetricControl/index.jsx","webpack://superset/./src/explore/components/controls/SelectAsyncControl/index.tsx","webpack://superset/./src/components/Slider/index.tsx","webpack://superset/./src/explore/components/controls/TimeSeriesColumnControl/index.jsx","webpack://superset/./src/explore/components/controls/ViewportControl.jsx","webpack://superset/./src/explore/components/controls/VizTypeControl/FastVizSwitcher.tsx","webpack://superset/./src/explore/components/controls/VizTypeControl/index.tsx","webpack://superset/./src/components/FormRow/index.jsx","webpack://superset/./src/explore/components/controls/FilterBoxItemControl/index.jsx","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/types.ts","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/FormattingPopoverContent.tsx","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/FormattingPopover.tsx","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/ConditionalFormattingControl.tsx","webpack://superset/./src/explore/components/controls/ConditionalFormattingControl/index.ts","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndSelectLabel.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/Option.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/OptionWrapper.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/utils/optionSelector.ts","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/ColumnSelectPopover.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndColumnSelectPopoverTitle.jsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/ColumnSelectPopoverTrigger.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndFilterSelect.tsx","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndMetricSelect.tsx","webpack://superset/./src/explore/components/controls/index.js","webpack://superset/./src/explore/components/controls/DndColumnSelectControl/DndColumnSelect.tsx","webpack://superset/./src/explore/components/DatasourcePanel/types.ts","webpack://superset/./src/explore/components/controls/HiddenControl.tsx","webpack://superset/./src/explore/components/controls/SliderControl.tsx","webpack://superset/./src/explore/components/Control.tsx","webpack://superset/./src/explore/components/ControlHeader.tsx","webpack://superset/./src/explore/components/ControlRow.tsx","webpack://superset/./src/explore/components/DndItemType.ts","webpack://superset/./src/explore/components/ExploreContentPopover.tsx","webpack://superset/./src/explore/components/controls/ControlPopover/ControlPopover.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/utils/dateFilterUtils.ts","webpack://superset/./src/explore/components/controls/DateFilterControl/types.ts","webpack://superset/./src/explore/components/controls/DateFilterControl/utils/constants.ts","webpack://superset/./src/explore/components/controls/DateFilterControl/utils/dateParser.ts","webpack://superset/./src/explore/components/controls/DateFilterControl/components/CommonFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/CalendarFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/CustomFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/DateFunctionTooltip.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/components/AdvancedFrame.tsx","webpack://superset/./src/explore/components/controls/DateFilterControl/DateFilterLabel.tsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/useAdvancedDataTypes.ts","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent/index.tsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterEditPopover/index.jsx","webpack://superset/./src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger/index.tsx","webpack://superset/./src/explore/components/controls/OptionControls/index.tsx","webpack://superset/./src/explore/components/controls/TextControl/index.tsx","webpack://superset/./src/explore/components/controls/VizTypeControl/VizTypeGallery.tsx","webpack://superset/./src/explore/components/optionRenderers.tsx","webpack://superset/./src/explore/controlPanels/sections.tsx","webpack://superset/./src/explore/controlUtils/getSectionsToRender.ts","webpack://superset/./src/explore/controlUtils/getControlConfig.ts","webpack://superset/./src/explore/controlUtils/getControlState.ts","webpack://superset/./src/explore/controlUtils/getFormDataFromControls.ts","webpack://superset/./src/explore/controlUtils/getControlValuesCompatibleWithDatasource.ts","webpack://superset/./src/explore/controlUtils/standardizedFormData.ts","webpack://superset/./src/hooks/apiResources/apiResources.ts","webpack://superset/./src/hooks/useComponentDidUpdate/useComponentDidUpdate.ts","webpack://superset/./src/hooks/usePrevious/usePrevious.ts","webpack://superset/./src/logger/LogUtils.ts","webpack://superset/./src/logger/actions/index.ts","webpack://superset/./src/middleware/asyncEvent.ts","webpack://superset/./src/types/bootstrapTypes.ts","webpack://superset/./src/utils/testUtils.ts","webpack://superset/./src/utils/textUtils.ts","webpack://superset/./src/utils/urlUtils.ts","webpack://superset/./src/views/CRUD/data/dataset/constants.ts","webpack://superset/./src/views/CRUD/hooks.ts","webpack://superset/./src/views/CRUD/utils.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint no-undef: 'error' */\n/* eslint no-param-reassign: [\"error\", { \"props\": false }] */\nimport moment from 'moment';\nimport { t, SupersetClient } from '@superset-ui/core';\nimport { getControlsState } from 'src/explore/store';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport {\n  getAnnotationJsonUrl,\n  getExploreUrl,\n  getLegacyEndpointType,\n  buildV1ChartDataPayload,\n  shouldUseLegacyApi,\n  getChartDataUri,\n} from 'src/explore/exploreUtils';\nimport {\n  requiresQuery,\n  ANNOTATION_SOURCE_TYPES,\n} from 'src/modules/AnnotationTypes';\n\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { logEvent } from 'src/logger/actions';\nimport { Logger, LOG_ACTIONS_LOAD_CHART } from 'src/logger/LogUtils';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { safeStringify } from 'src/utils/safeStringify';\nimport { allowCrossDomain as domainShardingEnabled } from 'src/utils/hostNamesConfig';\nimport { updateDataMask } from 'src/dataMask/actions';\nimport { waitForAsyncData } from 'src/middleware/asyncEvent';\n\nexport const CHART_UPDATE_STARTED = 'CHART_UPDATE_STARTED';\nexport function chartUpdateStarted(queryController, latestQueryFormData, key) {\n  return {\n    type: CHART_UPDATE_STARTED,\n    queryController,\n    latestQueryFormData,\n    key,\n  };\n}\n\nexport const CHART_UPDATE_SUCCEEDED = 'CHART_UPDATE_SUCCEEDED';\nexport function chartUpdateSucceeded(queriesResponse, key) {\n  return { type: CHART_UPDATE_SUCCEEDED, queriesResponse, key };\n}\n\nexport const CHART_UPDATE_STOPPED = 'CHART_UPDATE_STOPPED';\nexport function chartUpdateStopped(key) {\n  return { type: CHART_UPDATE_STOPPED, key };\n}\n\nexport const CHART_UPDATE_FAILED = 'CHART_UPDATE_FAILED';\nexport function chartUpdateFailed(queriesResponse, key) {\n  return { type: CHART_UPDATE_FAILED, queriesResponse, key };\n}\n\nexport const CHART_RENDERING_FAILED = 'CHART_RENDERING_FAILED';\nexport function chartRenderingFailed(error, key, stackTrace) {\n  return { type: CHART_RENDERING_FAILED, error, key, stackTrace };\n}\n\nexport const CHART_RENDERING_SUCCEEDED = 'CHART_RENDERING_SUCCEEDED';\nexport function chartRenderingSucceeded(key) {\n  return { type: CHART_RENDERING_SUCCEEDED, key };\n}\n\nexport const REMOVE_CHART = 'REMOVE_CHART';\nexport function removeChart(key) {\n  return { type: REMOVE_CHART, key };\n}\n\nexport const ANNOTATION_QUERY_SUCCESS = 'ANNOTATION_QUERY_SUCCESS';\nexport function annotationQuerySuccess(annotation, queryResponse, key) {\n  return { type: ANNOTATION_QUERY_SUCCESS, annotation, queryResponse, key };\n}\n\nexport const ANNOTATION_QUERY_STARTED = 'ANNOTATION_QUERY_STARTED';\nexport function annotationQueryStarted(annotation, queryController, key) {\n  return { type: ANNOTATION_QUERY_STARTED, annotation, queryController, key };\n}\n\nexport const ANNOTATION_QUERY_FAILED = 'ANNOTATION_QUERY_FAILED';\nexport function annotationQueryFailed(annotation, queryResponse, key) {\n  return { type: ANNOTATION_QUERY_FAILED, annotation, queryResponse, key };\n}\n\nexport const DYNAMIC_PLUGIN_CONTROLS_READY = 'DYNAMIC_PLUGIN_CONTROLS_READY';\nexport const dynamicPluginControlsReady = () => (dispatch, getState) => {\n  const state = getState();\n  const controlsState = getControlsState(\n    state.explore,\n    state.explore.form_data,\n  );\n  dispatch({\n    type: DYNAMIC_PLUGIN_CONTROLS_READY,\n    key: controlsState.slice_id.value,\n    controlsState,\n  });\n};\n\nconst legacyChartDataRequest = async (\n  formData,\n  resultFormat,\n  resultType,\n  force,\n  method = 'POST',\n  requestParams = {},\n) => {\n  const endpointType = getLegacyEndpointType({ resultFormat, resultType });\n  const allowDomainSharding =\n    // eslint-disable-next-line camelcase\n    domainShardingEnabled && requestParams?.dashboard_id;\n  const url = getExploreUrl({\n    formData,\n    endpointType,\n    force,\n    allowDomainSharding,\n    method,\n    requestParams: requestParams.dashboard_id\n      ? { dashboard_id: requestParams.dashboard_id }\n      : {},\n  });\n  const querySettings = {\n    ...requestParams,\n    url,\n    postPayload: { form_data: formData },\n  };\n\n  const clientMethod =\n    'GET' && isFeatureEnabled(FeatureFlag.CLIENT_CACHE)\n      ? SupersetClient.get\n      : SupersetClient.post;\n  return clientMethod(querySettings).then(({ json, response }) =>\n    // Make the legacy endpoint return a payload that corresponds to the\n    // V1 chart data endpoint response signature.\n    ({\n      response,\n      json: { result: [json] },\n    }),\n  );\n};\n\nconst v1ChartDataRequest = async (\n  formData,\n  resultFormat,\n  resultType,\n  force,\n  requestParams,\n  setDataMask,\n  ownState,\n) => {\n  const payload = buildV1ChartDataPayload({\n    formData,\n    resultType,\n    resultFormat,\n    force,\n    setDataMask,\n    ownState,\n  });\n\n  // The dashboard id is added to query params for tracking purposes\n  const { slice_id: sliceId } = formData;\n  const { dashboard_id: dashboardId } = requestParams;\n\n  const qs = {};\n  if (sliceId !== undefined) qs.form_data = `{\"slice_id\":${sliceId}}`;\n  if (dashboardId !== undefined) qs.dashboard_id = dashboardId;\n  if (force !== false) qs.force = force;\n\n  const allowDomainSharding =\n    // eslint-disable-next-line camelcase\n    domainShardingEnabled && requestParams?.dashboard_id;\n  const url = getChartDataUri({\n    path: '/api/v1/chart/data',\n    qs,\n    allowDomainSharding,\n  }).toString();\n\n  const querySettings = {\n    ...requestParams,\n    url,\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify(payload),\n  };\n\n  return SupersetClient.post(querySettings);\n};\n\nexport async function getChartDataRequest({\n  formData,\n  setDataMask = () => {},\n  resultFormat = 'json',\n  resultType = 'full',\n  force = false,\n  method = 'POST',\n  requestParams = {},\n  ownState = {},\n}) {\n  let querySettings = {\n    ...requestParams,\n  };\n\n  if (domainShardingEnabled) {\n    querySettings = {\n      ...querySettings,\n      mode: 'cors',\n      credentials: 'include',\n    };\n  }\n\n  if (shouldUseLegacyApi(formData)) {\n    return legacyChartDataRequest(\n      formData,\n      resultFormat,\n      resultType,\n      force,\n      method,\n      querySettings,\n    );\n  }\n  return v1ChartDataRequest(\n    formData,\n    resultFormat,\n    resultType,\n    force,\n    querySettings,\n    setDataMask,\n    ownState,\n  );\n}\n\nexport function runAnnotationQuery({\n  annotation,\n  timeout = 60,\n  formData = null,\n  key,\n  isDashboardRequest = false,\n  force = false,\n}) {\n  return function (dispatch, getState) {\n    const sliceKey = key || Object.keys(getState().charts)[0];\n    // make a copy of formData, not modifying original formData\n    const fd = {\n      ...(formData || getState().charts[sliceKey].latestQueryFormData),\n    };\n\n    if (!requiresQuery(annotation.sourceType)) {\n      return Promise.resolve();\n    }\n\n    const granularity = fd.time_grain_sqla || fd.granularity;\n    fd.time_grain_sqla = granularity;\n    fd.granularity = granularity;\n    const overridesKeys = Object.keys(annotation.overrides);\n    if (overridesKeys.includes('since') || overridesKeys.includes('until')) {\n      annotation.overrides = {\n        ...annotation.overrides,\n        time_range: null,\n      };\n    }\n    const sliceFormData = Object.keys(annotation.overrides).reduce(\n      (d, k) => ({\n        ...d,\n        [k]: annotation.overrides[k] || fd[k],\n      }),\n      {},\n    );\n\n    if (!isDashboardRequest && fd) {\n      const hasExtraFilters = fd.extra_filters && fd.extra_filters.length > 0;\n      sliceFormData.extra_filters = hasExtraFilters\n        ? fd.extra_filters\n        : undefined;\n    }\n\n    const isNative = annotation.sourceType === ANNOTATION_SOURCE_TYPES.NATIVE;\n    const url = getAnnotationJsonUrl(\n      annotation.value,\n      sliceFormData,\n      isNative,\n      force,\n    );\n    const controller = new AbortController();\n    const { signal } = controller;\n\n    dispatch(annotationQueryStarted(annotation, controller, sliceKey));\n\n    return SupersetClient.get({\n      url,\n      signal,\n      timeout: timeout * 1000,\n    })\n      .then(({ json }) =>\n        dispatch(annotationQuerySuccess(annotation, json, sliceKey)),\n      )\n      .catch(response =>\n        getClientErrorObject(response).then(err => {\n          if (err.statusText === 'timeout') {\n            dispatch(\n              annotationQueryFailed(\n                annotation,\n                { error: 'Query timeout' },\n                sliceKey,\n              ),\n            );\n          } else if ((err.error || '').toLowerCase().includes('no data')) {\n            dispatch(annotationQuerySuccess(annotation, err, sliceKey));\n          } else if (err.statusText !== 'abort') {\n            dispatch(annotationQueryFailed(annotation, err, sliceKey));\n          }\n        }),\n      );\n  };\n}\n\nexport const TRIGGER_QUERY = 'TRIGGER_QUERY';\nexport function triggerQuery(value = true, key) {\n  return { type: TRIGGER_QUERY, value, key };\n}\n\n// this action is used for forced re-render without fetch data\nexport const RENDER_TRIGGERED = 'RENDER_TRIGGERED';\nexport function renderTriggered(value, key) {\n  return { type: RENDER_TRIGGERED, value, key };\n}\n\nexport const UPDATE_QUERY_FORM_DATA = 'UPDATE_QUERY_FORM_DATA';\nexport function updateQueryFormData(value, key) {\n  return { type: UPDATE_QUERY_FORM_DATA, value, key };\n}\n\n// in the sql lab -> explore flow, user can inline edit chart title,\n// then the chart will be assigned a new slice_id\nexport const UPDATE_CHART_ID = 'UPDATE_CHART_ID';\nexport function updateChartId(newId, key = 0) {\n  return { type: UPDATE_CHART_ID, newId, key };\n}\n\nexport const ADD_CHART = 'ADD_CHART';\nexport function addChart(chart, key) {\n  return { type: ADD_CHART, chart, key };\n}\n\nexport function exploreJSON(\n  formData,\n  force = false,\n  timeout = 60,\n  key,\n  method,\n  dashboardId,\n  ownState,\n) {\n  return async dispatch => {\n    const logStart = Logger.getTimestamp();\n    const controller = new AbortController();\n\n    const requestParams = {\n      signal: controller.signal,\n      timeout: timeout * 1000,\n    };\n    if (dashboardId) requestParams.dashboard_id = dashboardId;\n\n    const setDataMask = dataMask => {\n      dispatch(updateDataMask(formData.slice_id, dataMask));\n    };\n    const chartDataRequest = getChartDataRequest({\n      setDataMask,\n      formData,\n      resultFormat: 'json',\n      resultType: 'full',\n      force,\n      method,\n      requestParams,\n      ownState,\n    });\n\n    dispatch(chartUpdateStarted(controller, formData, key));\n\n    const chartDataRequestCaught = chartDataRequest\n      .then(({ response, json }) => {\n        if (isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) {\n          // deal with getChartDataRequest transforming the response data\n          const result = 'result' in json ? json.result : json;\n          switch (response.status) {\n            case 200:\n              // Query results returned synchronously, meaning query was already cached.\n              return Promise.resolve(result);\n            case 202:\n              // Query is running asynchronously and we must await the results\n              if (shouldUseLegacyApi(formData)) {\n                return waitForAsyncData(result[0]);\n              }\n              return waitForAsyncData(result);\n            default:\n              throw new Error(\n                `Received unexpected response status (${response.status}) while fetching chart data`,\n              );\n          }\n        }\n\n        return json.result;\n      })\n      .then(queriesResponse => {\n        queriesResponse.forEach(resultItem =>\n          dispatch(\n            logEvent(LOG_ACTIONS_LOAD_CHART, {\n              slice_id: key,\n              applied_filters: resultItem.applied_filters,\n              is_cached: resultItem.is_cached,\n              force_refresh: force,\n              row_count: resultItem.rowcount,\n              datasource: formData.datasource,\n              start_offset: logStart,\n              ts: new Date().getTime(),\n              duration: Logger.getTimestamp() - logStart,\n              has_extra_filters:\n                formData.extra_filters && formData.extra_filters.length > 0,\n              viz_type: formData.viz_type,\n              data_age: resultItem.is_cached\n                ? moment(new Date()).diff(moment.utc(resultItem.cached_dttm))\n                : null,\n            }),\n          ),\n        );\n        return dispatch(chartUpdateSucceeded(queriesResponse, key));\n      })\n      .catch(response => {\n        if (isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) {\n          return dispatch(chartUpdateFailed([response], key));\n        }\n\n        const appendErrorLog = (errorDetails, isCached) => {\n          dispatch(\n            logEvent(LOG_ACTIONS_LOAD_CHART, {\n              slice_id: key,\n              has_err: true,\n              is_cached: isCached,\n              error_details: errorDetails,\n              datasource: formData.datasource,\n              start_offset: logStart,\n              ts: new Date().getTime(),\n              duration: Logger.getTimestamp() - logStart,\n            }),\n          );\n        };\n        if (response.name === 'AbortError') {\n          appendErrorLog('abort');\n          return dispatch(chartUpdateStopped(key));\n        }\n        return getClientErrorObject(response).then(parsedResponse => {\n          if (response.statusText === 'timeout') {\n            appendErrorLog('timeout');\n          } else {\n            appendErrorLog(parsedResponse.error, parsedResponse.is_cached);\n          }\n          return dispatch(chartUpdateFailed([parsedResponse], key));\n        });\n      });\n\n    // only retrieve annotations when calling the legacy API\n    const annotationLayers = shouldUseLegacyApi(formData)\n      ? formData.annotation_layers || []\n      : [];\n    const isDashboardRequest = dashboardId > 0;\n\n    return Promise.all([\n      chartDataRequestCaught,\n      dispatch(triggerQuery(false, key)),\n      dispatch(updateQueryFormData(formData, key)),\n      ...annotationLayers.map(annotation =>\n        dispatch(\n          runAnnotationQuery({\n            annotation,\n            timeout,\n            formData,\n            key,\n            isDashboardRequest,\n            force,\n          }),\n        ),\n      ),\n    ]);\n  };\n}\n\nexport const GET_SAVED_CHART = 'GET_SAVED_CHART';\nexport function getSavedChart(\n  formData,\n  force = false,\n  timeout = 60,\n  key,\n  dashboardId,\n  ownState,\n) {\n  /*\n   * Perform a GET request to `/explore_json`.\n   *\n   * This will return the payload of a saved chart, optionally filtered by\n   * ad-hoc or extra filters from dashboards. Eg:\n   *\n   *  GET  /explore_json?{\"chart_id\":1}\n   *  GET  /explore_json?{\"chart_id\":1,\"extra_filters\":\"...\"}\n   *\n   */\n  return exploreJSON(\n    formData,\n    force,\n    timeout,\n    key,\n    'GET',\n    dashboardId,\n    ownState,\n  );\n}\n\nexport const POST_CHART_FORM_DATA = 'POST_CHART_FORM_DATA';\nexport function postChartFormData(\n  formData,\n  force = false,\n  timeout = 60,\n  key,\n  dashboardId,\n  ownState,\n) {\n  /*\n   * Perform a POST request to `/explore_json`.\n   *\n   * This will post the form data to the endpoint, returning a new chart.\n   *\n   */\n  return exploreJSON(\n    formData,\n    force,\n    timeout,\n    key,\n    'POST',\n    dashboardId,\n    ownState,\n  );\n}\n\nexport function redirectSQLLab(formData) {\n  return dispatch => {\n    getChartDataRequest({ formData, resultFormat: 'json', resultType: 'query' })\n      .then(({ json }) => {\n        const redirectUrl = '/superset/sqllab/';\n        const payload = {\n          datasourceKey: formData.datasource,\n          sql: json.result[0].query,\n        };\n        SupersetClient.postForm(redirectUrl, {\n          form_data: safeStringify(payload),\n        });\n      })\n      .catch(() =>\n        dispatch(addDangerToast(t('An error occurred while loading the SQL'))),\n      );\n  };\n}\n\nexport function refreshChart(chartKey, force, dashboardId) {\n  return (dispatch, getState) => {\n    const chart = (getState().charts || {})[chartKey];\n    const timeout =\n      getState().dashboardInfo.common.conf.SUPERSET_WEBSERVER_TIMEOUT;\n\n    if (\n      !chart.latestQueryFormData ||\n      Object.keys(chart.latestQueryFormData).length === 0\n    ) {\n      return;\n    }\n    dispatch(\n      postChartFormData(\n        chart.latestQueryFormData,\n        force,\n        timeout,\n        chart.id,\n        dashboardId,\n        getState().dataMask[chart.id]?.ownState,\n      ),\n    );\n  };\n}\n\nexport const getDatasetSamples = async (datasetId, force) => {\n  const endpoint = `/api/v1/dataset/${datasetId}/samples?force=${force}`;\n  try {\n    const response = await SupersetClient.get({ endpoint });\n    return response.json.result;\n  } catch (err) {\n    const clientError = await getClientErrorObject(err);\n    throw new Error(\n      clientError.message || clientError.error || t('Sorry, an error occurred'),\n      { cause: err },\n    );\n  }\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\n\nconst propTypes = {\n  children: PropTypes.node.isRequired,\n  onError: PropTypes.func,\n  showMessage: PropTypes.bool,\n};\nconst defaultProps = {\n  onError: () => {},\n  showMessage: true,\n};\n\nexport default class ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = { error: null, info: null };\n  }\n\n  componentDidCatch(error, info) {\n    if (this.props.onError) this.props.onError(error, info);\n    this.setState({ error, info });\n  }\n\n  render() {\n    const { error, info } = this.state;\n    if (error) {\n      const firstLine = error.toString();\n      const message = (\n        <span>\n          <strong>{t('Unexpected error')}</strong>\n          {firstLine ? `: ${firstLine}` : ''}\n        </span>\n      );\n      if (this.props.showMessage) {\n        return (\n          <ErrorMessageWithStackTrace\n            subtitle={message}\n            copyText={message}\n            stackTrace={info ? info.componentStack : null}\n          />\n        );\n      }\n      return null;\n    }\n    return this.props.children;\n  }\n}\nErrorBoundary.propTypes = propTypes;\nErrorBoundary.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\n// util function to make sure filter is a valid slice in current dashboard\nfunction isValidFilter(getState, chartId) {\n  return getState().dashboardState.sliceIds.includes(chartId);\n}\n\nexport const ADD_FILTER = 'ADD_FILTER';\nexport function addFilter(chartId, component, form_data) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      return dispatch({ type: ADD_FILTER, chartId, component, form_data });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const REMOVE_FILTER = 'REMOVE_FILTER';\nexport function removeFilter(chartId) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      return dispatch({ type: REMOVE_FILTER, chartId });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const CHANGE_FILTER = 'CHANGE_FILTER';\nexport function changeFilter(chartId, newSelectedValues, merge) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      const components = getState().dashboardLayout.present;\n      return dispatch({\n        type: CHANGE_FILTER,\n        chartId,\n        newSelectedValues,\n        merge,\n        components,\n      });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const UPDATE_DIRECT_PATH_TO_FILTER = 'UPDATE_DIRECT_PATH_TO_FILTER';\nexport function updateDirectPathToFilter(chartId, path) {\n  return (dispatch, getState) => {\n    if (isValidFilter(getState, chartId)) {\n      return dispatch({ type: UPDATE_DIRECT_PATH_TO_FILTER, chartId, path });\n    }\n    return getState().dashboardFilters;\n  };\n}\n\nexport const UPDATE_LAYOUT_COMPONENTS = 'UPDATE_LAYOUT_COMPONENTS';\nexport function updateLayoutComponents(components) {\n  return dispatch => {\n    dispatch({ type: UPDATE_LAYOUT_COMPONENTS, components });\n  };\n}\n\nexport const UPDATE_DASHBOARD_FILTERS_SCOPE = 'UPDATE_DASHBOARD_FILTERS_SCOPE';\nexport function updateDashboardFiltersScope(scopes) {\n  return dispatch => {\n    dispatch({ type: UPDATE_DASHBOARD_FILTERS_SCOPE, scopes });\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport shortid from 'shortid';\nimport { find, isEmpty } from 'lodash';\n\nimport {\n  FILTER_CONFIG_ATTRIBUTES,\n  TIME_FILTER_LABELS,\n  TIME_FILTER_MAP,\n} from 'src/explore/constants';\nimport { DASHBOARD_FILTER_SCOPE_GLOBAL } from 'src/dashboard/reducers/dashboardFilters';\nimport { Filter, NativeFilterType, TimeGranularity } from '@superset-ui/core';\nimport { getChartIdsInFilterBoxScope } from './activeDashboardFilters';\nimport getFilterConfigsFromFormdata from './getFilterConfigsFromFormdata';\n\ninterface FilterConfig {\n  asc: boolean;\n  clearable: boolean;\n  column: string;\n  defaultValue?: any;\n  key: string;\n  label?: string;\n  metric: string;\n  multiple: boolean;\n}\n\ninterface SliceData {\n  slice_id: number;\n  form_data: {\n    adhoc_filters?: [];\n    datasource: string;\n    date_filter?: boolean;\n    filter_configs?: FilterConfig[];\n    granularity?: string;\n    granularity_sqla?: string;\n    time_grain_sqla?: string;\n    time_range?: string;\n    druid_time_origin?: string;\n    show_druid_time_granularity?: boolean;\n    show_druid_time_origin?: boolean;\n    show_sqla_time_column?: boolean;\n    show_sqla_time_granularity?: boolean;\n    viz_type: string;\n  };\n}\n\ninterface FilterScopeType {\n  scope: string[];\n  immune: number[];\n}\n\ninterface FilterScopesMetadata {\n  [key: string]: {\n    [key: string]: FilterScopeType;\n  };\n}\n\ninterface PreselectedFilterColumn {\n  [key: string]: boolean | string | number | string[] | number[];\n}\n\ninterface PreselectedFiltersMeatadata {\n  [key: string]: PreselectedFilterColumn;\n}\n\ninterface FilterBoxToFilterComponentMap {\n  [key: string]: {\n    [key: string]: string;\n  };\n}\n\ninterface FilterBoxDependencyMap {\n  [key: string]: {\n    [key: string]: number[];\n  };\n}\n\nenum FILTER_COMPONENT_FILTER_TYPES {\n  FILTER_TIME = 'filter_time',\n  FILTER_TIMEGRAIN = 'filter_timegrain',\n  FILTER_TIMECOLUMN = 'filter_timecolumn',\n  FILTER_SELECT = 'filter_select',\n  FILTER_RANGE = 'filter_range',\n}\n\nconst getPreselectedValuesFromDashboard =\n  (preselectedFilters: PreselectedFiltersMeatadata) =>\n  (filterKey: string, column: string) => {\n    if (\n      preselectedFilters[filterKey] &&\n      preselectedFilters[filterKey][column]\n    ) {\n      // overwrite default values by dashboard default_filters\n      return preselectedFilters[filterKey][column];\n    }\n    return null;\n  };\n\nconst getFilterBoxDefaultValues = (config: FilterConfig) => {\n  let defaultValues = config[FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE];\n\n  // treat empty string as null (no default value)\n  if (defaultValues === '') {\n    defaultValues = null;\n  }\n\n  // defaultValue could be ; separated values,\n  // could be null or ''\n  if (defaultValues && config[FILTER_CONFIG_ATTRIBUTES.MULTIPLE]) {\n    defaultValues = config.defaultValue.split(';');\n  }\n\n  return defaultValues;\n};\n\nconst setValuesInArray = (value1: any, value2: any) => {\n  if (!isEmpty(value1)) {\n    return [value1];\n  }\n  if (!isEmpty(value2)) {\n    return [value2];\n  }\n  return [];\n};\n\nconst getFilterboxDependencies = (filterScopes: FilterScopesMetadata) => {\n  const filterFieldsDependencies: FilterBoxDependencyMap = {};\n  const filterChartIds: number[] = Object.keys(filterScopes).map(key =>\n    parseInt(key, 10),\n  );\n  Object.entries(filterScopes).forEach(([key, filterFields]) => {\n    filterFieldsDependencies[key] = {};\n    Object.entries(filterFields).forEach(([filterField, filterScope]) => {\n      filterFieldsDependencies[key][filterField] = getChartIdsInFilterBoxScope({\n        filterScope,\n      }).filter(\n        chartId => filterChartIds.includes(chartId) && String(chartId) !== key,\n      );\n    });\n  });\n  return filterFieldsDependencies;\n};\n\nexport default function getNativeFilterConfig(\n  chartData: SliceData[] = [],\n  filterScopes: FilterScopesMetadata = {},\n  preselectFilters: PreselectedFiltersMeatadata = {},\n): Filter[] {\n  const filterConfig: Filter[] = [];\n  const filterBoxToFilterComponentMap: FilterBoxToFilterComponentMap = {};\n\n  chartData.forEach(slice => {\n    const key = String(slice.slice_id);\n\n    if (slice.form_data.viz_type === 'filter_box') {\n      filterBoxToFilterComponentMap[key] = {};\n      const configs = getFilterConfigsFromFormdata(slice.form_data);\n      let { columns } = configs;\n      if (preselectFilters[key]) {\n        Object.keys(columns).forEach(col => {\n          if (preselectFilters[key][col]) {\n            columns = {\n              ...columns,\n              [col]: preselectFilters[key][col],\n            };\n          }\n        });\n      }\n\n      const scopesByChartId = Object.keys(columns).reduce((map, column) => {\n        const scopeSettings = {\n          ...filterScopes[key],\n        };\n        const { scope, immune }: FilterScopeType = {\n          ...DASHBOARD_FILTER_SCOPE_GLOBAL,\n          ...scopeSettings[column],\n        };\n\n        return {\n          ...map,\n          [column]: {\n            scope,\n            immune,\n          },\n        };\n      }, {});\n\n      const {\n        adhoc_filters = [],\n        datasource = '',\n        date_filter = false,\n        druid_time_origin,\n        filter_configs = [],\n        granularity,\n        granularity_sqla,\n        show_druid_time_granularity = false,\n        show_druid_time_origin = false,\n        show_sqla_time_column = false,\n        show_sqla_time_granularity = false,\n        time_grain_sqla,\n        time_range,\n      } = slice.form_data;\n\n      const getDashboardDefaultValues =\n        getPreselectedValuesFromDashboard(preselectFilters);\n\n      if (date_filter) {\n        const { scope, immune }: FilterScopeType =\n          scopesByChartId[TIME_FILTER_MAP.time_range] ||\n          DASHBOARD_FILTER_SCOPE_GLOBAL;\n        const timeRangeFilter: Filter = {\n          id: `NATIVE_FILTER-${shortid.generate()}`,\n          description: 'time range filter',\n          controlValues: {},\n          name: TIME_FILTER_LABELS.time_range,\n          filterType: FILTER_COMPONENT_FILTER_TYPES.FILTER_TIME,\n          targets: [{}],\n          cascadeParentIds: [],\n          defaultDataMask: {},\n          type: NativeFilterType.NATIVE_FILTER,\n          scope: {\n            rootPath: scope,\n            excluded: immune,\n          },\n        };\n        filterBoxToFilterComponentMap[key][TIME_FILTER_MAP.time_range] =\n          timeRangeFilter.id;\n        const dashboardDefaultValues =\n          getDashboardDefaultValues(key, TIME_FILTER_MAP.time_range) ||\n          time_range;\n        if (!isEmpty(dashboardDefaultValues)) {\n          timeRangeFilter.defaultDataMask = {\n            extraFormData: { time_range: dashboardDefaultValues as string },\n            filterState: { value: dashboardDefaultValues },\n          };\n        }\n        filterConfig.push(timeRangeFilter);\n\n        if (show_sqla_time_granularity) {\n          const { scope, immune }: FilterScopeType =\n            scopesByChartId[TIME_FILTER_MAP.time_grain_sqla] ||\n            DASHBOARD_FILTER_SCOPE_GLOBAL;\n          const timeGrainFilter: Filter = {\n            id: `NATIVE_FILTER-${shortid.generate()}`,\n            controlValues: {},\n            description: 'time grain filter',\n            name: TIME_FILTER_LABELS.time_grain_sqla,\n            filterType: FILTER_COMPONENT_FILTER_TYPES.FILTER_TIMEGRAIN,\n            targets: [\n              {\n                datasetId: parseInt(datasource.split('__')[0], 10),\n              },\n            ],\n            cascadeParentIds: [],\n            defaultDataMask: {},\n            type: NativeFilterType.NATIVE_FILTER,\n            scope: {\n              rootPath: scope,\n              excluded: immune,\n            },\n          };\n          filterBoxToFilterComponentMap[key][TIME_FILTER_MAP.time_grain_sqla] =\n            timeGrainFilter.id;\n          const dashboardDefaultValues = getDashboardDefaultValues(\n            key,\n            TIME_FILTER_MAP.time_grain_sqla,\n          );\n          if (!isEmpty(dashboardDefaultValues)) {\n            timeGrainFilter.defaultDataMask = {\n              extraFormData: {\n                time_grain_sqla: (dashboardDefaultValues ||\n                  time_grain_sqla) as TimeGranularity,\n              },\n              filterState: {\n                value: setValuesInArray(\n                  dashboardDefaultValues,\n                  time_grain_sqla,\n                ),\n              },\n            };\n          }\n          filterConfig.push(timeGrainFilter);\n        }\n\n        if (show_sqla_time_column) {\n          const { scope, immune }: FilterScopeType =\n            scopesByChartId[TIME_FILTER_MAP.granularity_sqla] ||\n            DASHBOARD_FILTER_SCOPE_GLOBAL;\n          const timeColumnFilter: Filter = {\n            id: `NATIVE_FILTER-${shortid.generate()}`,\n            description: 'time column filter',\n            controlValues: {},\n            name: TIME_FILTER_LABELS.granularity_sqla,\n            filterType: FILTER_COMPONENT_FILTER_TYPES.FILTER_TIMECOLUMN,\n            targets: [\n              {\n                datasetId: parseInt(datasource.split('__')[0], 10),\n              },\n            ],\n            cascadeParentIds: [],\n            defaultDataMask: {},\n            type: NativeFilterType.NATIVE_FILTER,\n            scope: {\n              rootPath: scope,\n              excluded: immune,\n            },\n          };\n          filterBoxToFilterComponentMap[key][TIME_FILTER_MAP.granularity_sqla] =\n            timeColumnFilter.id;\n          const dashboardDefaultValues = getDashboardDefaultValues(\n            key,\n            TIME_FILTER_MAP.granularity_sqla,\n          );\n          if (!isEmpty(dashboardDefaultValues)) {\n            timeColumnFilter.defaultDataMask = {\n              extraFormData: {\n                granularity_sqla: (dashboardDefaultValues ||\n                  granularity_sqla) as string,\n              },\n              filterState: {\n                value: setValuesInArray(\n                  dashboardDefaultValues,\n                  granularity_sqla,\n                ),\n              },\n            };\n          }\n          filterConfig.push(timeColumnFilter);\n        }\n\n        if (show_druid_time_granularity) {\n          const { scope, immune }: FilterScopeType =\n            scopesByChartId[TIME_FILTER_MAP.granularity] ||\n            DASHBOARD_FILTER_SCOPE_GLOBAL;\n          const druidGranularityFilter: Filter = {\n            id: `NATIVE_FILTER-${shortid.generate()}`,\n            description: 'time grain filter',\n            controlValues: {},\n            name: TIME_FILTER_LABELS.granularity,\n            filterType: FILTER_COMPONENT_FILTER_TYPES.FILTER_TIMEGRAIN,\n            targets: [\n              {\n                datasetId: parseInt(datasource.split('__')[0], 10),\n              },\n            ],\n            cascadeParentIds: [],\n            defaultDataMask: {},\n            type: NativeFilterType.NATIVE_FILTER,\n            scope: {\n              rootPath: scope,\n              excluded: immune,\n            },\n          };\n          filterBoxToFilterComponentMap[key][TIME_FILTER_MAP.granularity] =\n            druidGranularityFilter.id;\n          const dashboardDefaultValues = getDashboardDefaultValues(\n            key,\n            TIME_FILTER_MAP.granularity,\n          );\n          if (!isEmpty(dashboardDefaultValues)) {\n            druidGranularityFilter.defaultDataMask = {\n              extraFormData: {\n                granularity_sqla: (dashboardDefaultValues ||\n                  granularity) as string,\n              },\n              filterState: {\n                value: setValuesInArray(dashboardDefaultValues, granularity),\n              },\n            };\n          }\n          filterConfig.push(druidGranularityFilter);\n        }\n\n        if (show_druid_time_origin) {\n          const { scope, immune }: FilterScopeType =\n            scopesByChartId[TIME_FILTER_MAP.druid_time_origin] ||\n            DASHBOARD_FILTER_SCOPE_GLOBAL;\n          const druidOriginFilter: Filter = {\n            id: `NATIVE_FILTER-${shortid.generate()}`,\n            description: 'time column filter',\n            controlValues: {},\n            name: TIME_FILTER_LABELS.druid_time_origin,\n            filterType: FILTER_COMPONENT_FILTER_TYPES.FILTER_TIMECOLUMN,\n            targets: [\n              {\n                datasetId: parseInt(datasource.split('__')[0], 10),\n              },\n            ],\n            cascadeParentIds: [],\n            defaultDataMask: {},\n            type: NativeFilterType.NATIVE_FILTER,\n            scope: {\n              rootPath: scope,\n              excluded: immune,\n            },\n          };\n          filterBoxToFilterComponentMap[key][\n            TIME_FILTER_MAP.druid_time_origin\n          ] = druidOriginFilter.id;\n          const dashboardDefaultValues = getDashboardDefaultValues(\n            key,\n            TIME_FILTER_MAP.druid_time_origin,\n          );\n          if (!isEmpty(dashboardDefaultValues)) {\n            druidOriginFilter.defaultDataMask = {\n              extraFormData: {\n                granularity_sqla: (dashboardDefaultValues ||\n                  druid_time_origin) as string,\n              },\n              filterState: {\n                value: setValuesInArray(\n                  dashboardDefaultValues,\n                  druid_time_origin,\n                ),\n              },\n            };\n          }\n          filterConfig.push(druidOriginFilter);\n        }\n      }\n\n      filter_configs.forEach(config => {\n        const { scope, immune }: FilterScopeType =\n          scopesByChartId[config.column] || DASHBOARD_FILTER_SCOPE_GLOBAL;\n        const entry: Filter = {\n          id: `NATIVE_FILTER-${shortid.generate()}`,\n          description: '',\n          controlValues: {\n            enableEmptyFilter: !config[FILTER_CONFIG_ATTRIBUTES.CLEARABLE],\n            defaultToFirstItem: false,\n            inverseSelection: false,\n            multiSelect: config[FILTER_CONFIG_ATTRIBUTES.MULTIPLE],\n            sortAscending: config[FILTER_CONFIG_ATTRIBUTES.SORT_ASCENDING],\n          },\n          name: config.label || config.column,\n          filterType: FILTER_COMPONENT_FILTER_TYPES.FILTER_SELECT,\n          targets: [\n            {\n              datasetId: parseInt(datasource.split('__')[0], 10),\n              column: {\n                name: config.column,\n              },\n            },\n          ],\n          cascadeParentIds: [],\n          defaultDataMask: {},\n          type: NativeFilterType.NATIVE_FILTER,\n          scope: {\n            rootPath: scope,\n            excluded: immune,\n          },\n          adhoc_filters,\n          sortMetric: config[FILTER_CONFIG_ATTRIBUTES.SORT_METRIC],\n          time_range,\n        };\n        filterBoxToFilterComponentMap[key][config.column] = entry.id;\n        const defaultValues =\n          getDashboardDefaultValues(key, config.column) ||\n          getFilterBoxDefaultValues(config);\n        if (!isEmpty(defaultValues)) {\n          entry.defaultDataMask = {\n            extraFormData: {\n              filters: [{ col: config.column, op: 'IN', val: defaultValues }],\n            },\n            filterState: { value: defaultValues },\n          };\n        }\n        filterConfig.push(entry);\n      });\n    }\n  });\n\n  const dependencies: FilterBoxDependencyMap =\n    getFilterboxDependencies(filterScopes);\n  Object.entries(dependencies).forEach(([key, filterFields]) => {\n    Object.entries(filterFields).forEach(([field, childrenChartIds]) => {\n      const parentComponentId = filterBoxToFilterComponentMap[key][field];\n      childrenChartIds.forEach(childrenChartId => {\n        const childComponentIds = Object.values(\n          filterBoxToFilterComponentMap[childrenChartId],\n        );\n        childComponentIds.forEach(childComponentId => {\n          const childComponent = find(\n            filterConfig,\n            ({ id }) => id === childComponentId,\n          );\n          if (\n            childComponent &&\n            // time related filter components don't have parent\n            [\n              FILTER_COMPONENT_FILTER_TYPES.FILTER_SELECT,\n              FILTER_COMPONENT_FILTER_TYPES.FILTER_RANGE,\n            ].includes(\n              childComponent.filterType as FILTER_COMPONENT_FILTER_TYPES,\n            )\n          ) {\n            childComponent.cascadeParentIds =\n              childComponent.cascadeParentIds || [];\n            childComponent.cascadeParentIds.push(parentComponentId);\n          }\n        });\n      });\n    });\n  });\n\n  return filterConfig;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport { Behavior, getChartMetadataRegistry } from '@superset-ui/core';\n\nimport { chart } from 'src/components/Chart/chartReducer';\nimport { initSliceEntities } from 'src/dashboard/reducers/sliceEntities';\nimport { getInitialState as getInitialNativeFilterState } from 'src/dashboard/reducers/nativeFilters';\nimport { applyDefaultFormData } from 'src/explore/store';\nimport { buildActiveFilters } from 'src/dashboard/util/activeDashboardFilters';\nimport findPermission, {\n  canUserEditDashboard,\n} from 'src/dashboard/util/findPermission';\nimport {\n  DASHBOARD_FILTER_SCOPE_GLOBAL,\n  dashboardFilter,\n} from 'src/dashboard/reducers/dashboardFilters';\nimport {\n  DASHBOARD_HEADER_ID,\n  GRID_DEFAULT_CHART_WIDTH,\n  GRID_COLUMN_COUNT,\n  DASHBOARD_ROOT_ID,\n} from 'src/dashboard/util/constants';\nimport {\n  DASHBOARD_HEADER_TYPE,\n  CHART_TYPE,\n  ROW_TYPE,\n} from 'src/dashboard/util/componentTypes';\nimport findFirstParentContainerId from 'src/dashboard/util/findFirstParentContainer';\nimport getEmptyLayout from 'src/dashboard/util/getEmptyLayout';\nimport getFilterConfigsFromFormdata from 'src/dashboard/util/getFilterConfigsFromFormdata';\nimport getLocationHash from 'src/dashboard/util/getLocationHash';\nimport newComponentFactory from 'src/dashboard/util/newComponentFactory';\nimport { TIME_RANGE } from 'src/visualizations/FilterBox/FilterBox';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { FILTER_BOX_MIGRATION_STATES } from 'src/explore/constants';\nimport { ResourceStatus } from 'src/hooks/apiResources/apiResources';\nimport { FeatureFlag, isFeatureEnabled } from '../../featureFlags';\nimport extractUrlParams from '../util/extractUrlParams';\nimport getNativeFilterConfig from '../util/filterboxMigrationHelper';\nimport { updateColorSchema } from './dashboardInfo';\n\nexport const HYDRATE_DASHBOARD = 'HYDRATE_DASHBOARD';\n\nexport const hydrateDashboard =\n  (\n    dashboardData,\n    chartData,\n    filterboxMigrationState = FILTER_BOX_MIGRATION_STATES.NOOP,\n    dataMaskApplied,\n  ) =>\n  (dispatch, getState) => {\n    const { user, common, dashboardState } = getState();\n\n    const { metadata } = dashboardData;\n    const regularUrlParams = extractUrlParams('regular');\n    const reservedUrlParams = extractUrlParams('reserved');\n    const editMode = reservedUrlParams.edit === 'true';\n\n    let preselectFilters = {};\n\n    chartData.forEach(chart => {\n      // eslint-disable-next-line no-param-reassign\n      chart.slice_id = chart.form_data.slice_id;\n    });\n    try {\n      // allow request parameter overwrite dashboard metadata\n      preselectFilters =\n        getUrlParam(URL_PARAMS.preselectFilters) ||\n        JSON.parse(metadata.default_filters);\n    } catch (e) {\n      //\n    }\n\n    if (metadata?.shared_label_colors) {\n      updateColorSchema(metadata, metadata?.shared_label_colors);\n    }\n\n    // Priming the color palette with user's label-color mapping provided in\n    // the dashboard's JSON metadata\n    if (metadata?.label_colors) {\n      updateColorSchema(metadata, metadata?.label_colors);\n    }\n\n    // dashboard layout\n    const { position_data } = dashboardData;\n    // new dash: position_json could be {} or null\n    const layout =\n      position_data && Object.keys(position_data).length > 0\n        ? position_data\n        : getEmptyLayout();\n\n    // create a lookup to sync layout names with slice names\n    const chartIdToLayoutId = {};\n    Object.values(layout).forEach(layoutComponent => {\n      if (layoutComponent.type === CHART_TYPE) {\n        chartIdToLayoutId[layoutComponent.meta.chartId] = layoutComponent.id;\n      }\n    });\n\n    // find root level chart container node for newly-added slices\n    const parentId = findFirstParentContainerId(layout);\n    const parent = layout[parentId];\n    let newSlicesContainer;\n    let newSlicesContainerWidth = 0;\n\n    const filterScopes = metadata?.filter_scopes || {};\n\n    const chartQueries = {};\n    const dashboardFilters = {};\n    const slices = {};\n    const sliceIds = new Set();\n    const slicesFromExploreCount = new Map();\n\n    chartData.forEach(slice => {\n      const key = slice.slice_id;\n      const form_data = {\n        ...slice.form_data,\n        url_params: {\n          ...slice.form_data.url_params,\n          ...regularUrlParams,\n        },\n      };\n      chartQueries[key] = {\n        ...chart,\n        id: key,\n        form_data,\n        formData: applyDefaultFormData(form_data),\n      };\n\n      slices[key] = {\n        slice_id: key,\n        slice_url: slice.slice_url,\n        slice_name: slice.slice_name,\n        form_data: slice.form_data,\n        viz_type: slice.form_data.viz_type,\n        datasource: slice.form_data.datasource,\n        description: slice.description,\n        description_markeddown: slice.description_markeddown,\n        owners: slice.owners,\n        modified: slice.modified,\n        changed_on: new Date(slice.changed_on).getTime(),\n      };\n\n      sliceIds.add(key);\n\n      // if there are newly added slices from explore view, fill slices into 1 or more rows\n      if (!chartIdToLayoutId[key] && layout[parentId]) {\n        if (\n          newSlicesContainerWidth === 0 ||\n          newSlicesContainerWidth + GRID_DEFAULT_CHART_WIDTH > GRID_COLUMN_COUNT\n        ) {\n          newSlicesContainer = newComponentFactory(\n            ROW_TYPE,\n            (parent.parents || []).slice(),\n          );\n          layout[newSlicesContainer.id] = newSlicesContainer;\n          parent.children.push(newSlicesContainer.id);\n          newSlicesContainerWidth = 0;\n        }\n\n        const chartHolder = newComponentFactory(\n          CHART_TYPE,\n          {\n            chartId: slice.slice_id,\n          },\n          (newSlicesContainer.parents || []).slice(),\n        );\n\n        const count = (slicesFromExploreCount.get(slice.slice_id) ?? 0) + 1;\n        chartHolder.id = `${CHART_TYPE}-explore-${slice.slice_id}-${count}`;\n        slicesFromExploreCount.set(slice.slice_id, count);\n\n        layout[chartHolder.id] = chartHolder;\n        newSlicesContainer.children.push(chartHolder.id);\n        chartIdToLayoutId[chartHolder.meta.chartId] = chartHolder.id;\n        newSlicesContainerWidth += GRID_DEFAULT_CHART_WIDTH;\n      }\n\n      // build DashboardFilters for interactive filter features\n      if (slice.form_data.viz_type === 'filter_box') {\n        const configs = getFilterConfigsFromFormdata(slice.form_data);\n        let { columns } = configs;\n        const { labels } = configs;\n        if (preselectFilters[key]) {\n          Object.keys(columns).forEach(col => {\n            if (preselectFilters[key][col]) {\n              columns = {\n                ...columns,\n                [col]: preselectFilters[key][col],\n              };\n            }\n          });\n        }\n\n        const scopesByChartId = Object.keys(columns).reduce((map, column) => {\n          const scopeSettings = {\n            ...filterScopes[key],\n          };\n          const { scope, immune } = {\n            ...DASHBOARD_FILTER_SCOPE_GLOBAL,\n            ...scopeSettings[column],\n          };\n\n          return {\n            ...map,\n            [column]: {\n              scope,\n              immune,\n            },\n          };\n        }, {});\n\n        const componentId = chartIdToLayoutId[key];\n        const directPathToFilter = (layout[componentId].parents || []).slice();\n        directPathToFilter.push(componentId);\n        if (\n          [\n            FILTER_BOX_MIGRATION_STATES.NOOP,\n            FILTER_BOX_MIGRATION_STATES.SNOOZED,\n          ].includes(filterboxMigrationState)\n        ) {\n          dashboardFilters[key] = {\n            ...dashboardFilter,\n            chartId: key,\n            componentId,\n            datasourceId: slice.form_data.datasource,\n            filterName: slice.slice_name,\n            directPathToFilter,\n            columns,\n            labels,\n            scopes: scopesByChartId,\n            isDateFilter: Object.keys(columns).includes(TIME_RANGE),\n          };\n        }\n      }\n\n      // sync layout names with current slice names in case a slice was edited\n      // in explore since the layout was updated. name updates go through layout for undo/redo\n      // functionality and python updates slice names based on layout upon dashboard save\n      const layoutId = chartIdToLayoutId[key];\n      if (layoutId && layout[layoutId]) {\n        layout[layoutId].meta.sliceName = slice.slice_name;\n      }\n    });\n    buildActiveFilters({\n      dashboardFilters,\n      components: layout,\n    });\n\n    // store the header as a layout component so we can undo/redo changes\n    layout[DASHBOARD_HEADER_ID] = {\n      id: DASHBOARD_HEADER_ID,\n      type: DASHBOARD_HEADER_TYPE,\n      meta: {\n        text: dashboardData.dashboard_title,\n      },\n    };\n\n    const dashboardLayout = {\n      past: [],\n      present: layout,\n      future: [],\n    };\n\n    // find direct link component and path from root\n    const directLinkComponentId = getLocationHash();\n    let directPathToChild = [];\n    if (layout[directLinkComponentId]) {\n      directPathToChild = (layout[directLinkComponentId].parents || []).slice();\n      directPathToChild.push(directLinkComponentId);\n    }\n\n    // should convert filter_box to filter component?\n    let filterConfig = metadata?.native_filter_configuration || [];\n    if (filterboxMigrationState === FILTER_BOX_MIGRATION_STATES.REVIEWING) {\n      filterConfig = getNativeFilterConfig(\n        chartData,\n        filterScopes,\n        preselectFilters,\n      );\n      metadata.native_filter_configuration = filterConfig;\n      metadata.show_native_filters = true;\n    }\n    const nativeFilters = getInitialNativeFilterState({\n      filterConfig,\n    });\n    metadata.show_native_filters =\n      dashboardData?.metadata?.show_native_filters ??\n      (isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS) &&\n        [\n          FILTER_BOX_MIGRATION_STATES.CONVERTED,\n          FILTER_BOX_MIGRATION_STATES.REVIEWING,\n          FILTER_BOX_MIGRATION_STATES.NOOP,\n        ].includes(filterboxMigrationState));\n\n    if (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n      // If user just added cross filter to dashboard it's not saving it scope on server,\n      // so we tweak it until user will update scope and will save it in server\n      Object.values(dashboardLayout.present).forEach(layoutItem => {\n        const chartId = layoutItem.meta?.chartId;\n        const behaviors =\n          (\n            getChartMetadataRegistry().get(\n              chartQueries[chartId]?.formData?.viz_type,\n            ) ?? {}\n          )?.behaviors ?? [];\n\n        if (!metadata.chart_configuration) {\n          metadata.chart_configuration = {};\n        }\n        if (\n          behaviors.includes(Behavior.INTERACTIVE_CHART) &&\n          !metadata.chart_configuration[chartId]\n        ) {\n          metadata.chart_configuration[chartId] = {\n            id: chartId,\n            crossFilters: {\n              scope: {\n                rootPath: [DASHBOARD_ROOT_ID],\n                excluded: [chartId], // By default it doesn't affects itself\n              },\n            },\n          };\n        }\n      });\n    }\n\n    const { roles } = user;\n    const canEdit = canUserEditDashboard(dashboardData, user);\n\n    return dispatch({\n      type: HYDRATE_DASHBOARD,\n      data: {\n        sliceEntities: { ...initSliceEntities, slices, isLoading: false },\n        charts: chartQueries,\n        // read-only data\n        dashboardInfo: {\n          ...dashboardData,\n          metadata,\n          userId: user.userId ? String(user.userId) : null, // legacy, please use state.user instead\n          dash_edit_perm: canEdit,\n          dash_save_perm: findPermission('can_save_dash', 'Superset', roles),\n          dash_share_perm: findPermission(\n            'can_share_dashboard',\n            'Superset',\n            roles,\n          ),\n          superset_can_explore: findPermission(\n            'can_explore',\n            'Superset',\n            roles,\n          ),\n          superset_can_share: findPermission(\n            'can_share_chart',\n            'Superset',\n            roles,\n          ),\n          superset_can_csv: findPermission('can_csv', 'Superset', roles),\n          slice_can_edit: findPermission('can_slice', 'Superset', roles),\n          common: {\n            // legacy, please use state.common instead\n            flash_messages: common?.flash_messages,\n            conf: common?.conf,\n          },\n        },\n        dataMask: dataMaskApplied,\n        dashboardFilters,\n        nativeFilters,\n        dashboardState: {\n          preselectNativeFilters: getUrlParam(URL_PARAMS.nativeFilters),\n          sliceIds: Array.from(sliceIds),\n          directPathToChild,\n          directPathLastUpdated: Date.now(),\n          focusedFilterField: null,\n          expandedSlices: metadata?.expanded_slices || {},\n          refreshFrequency: metadata?.refresh_frequency || 0,\n          // dashboard viewers can set refresh frequency for the current visit,\n          // only persistent refreshFrequency will be saved to backend\n          shouldPersistRefreshFrequency: false,\n          css: dashboardData.css || '',\n          colorNamespace: metadata?.color_namespace || null,\n          colorScheme: metadata?.color_scheme || null,\n          editMode: canEdit && editMode,\n          isPublished: dashboardData.published,\n          hasUnsavedChanges: false,\n          maxUndoHistoryExceeded: false,\n          lastModifiedTime: dashboardData.changed_on,\n          isRefreshing: false,\n          isFiltersRefreshing: false,\n          activeTabs: dashboardState?.activeTabs || [],\n          filterboxMigrationState,\n          datasetsStatus: ResourceStatus.LOADING,\n        },\n        dashboardLayout,\n      },\n    });\n  };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { DASHBOARD_ROOT_TYPE, DASHBOARD_GRID_TYPE } from './componentTypes';\n\nimport {\n  DASHBOARD_GRID_ID,\n  DASHBOARD_ROOT_ID,\n  DASHBOARD_VERSION_KEY,\n} from './constants';\n\nexport default function getEmptyLayout() {\n  return {\n    [DASHBOARD_VERSION_KEY]: 'v2',\n    [DASHBOARD_ROOT_ID]: {\n      type: DASHBOARD_ROOT_TYPE,\n      id: DASHBOARD_ROOT_ID,\n      children: [DASHBOARD_GRID_ID],\n    },\n    [DASHBOARD_GRID_ID]: {\n      type: DASHBOARD_GRID_TYPE,\n      id: DASHBOARD_GRID_ID,\n      children: [],\n      parents: [DASHBOARD_ROOT_ID],\n    },\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { TABS_TYPE } from './componentTypes';\nimport { DASHBOARD_ROOT_ID } from './constants';\n\nexport default function findFirstParentContainerId(layout = {}) {\n  // DASHBOARD_GRID_TYPE or TABS_TYPE?\n  let parent = layout[DASHBOARD_ROOT_ID];\n  if (\n    parent &&\n    parent.children.length &&\n    layout[parent.children[0]].type === TABS_TYPE\n  ) {\n    const tabs = layout[parent.children[0]];\n    parent = layout[tabs.children[0]];\n  } else {\n    parent = layout[parent.children[0]];\n  }\n\n  return parent.id;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t, SupersetClient } from '@superset-ui/core';\nimport rison from 'rison';\n\nimport { addDangerToast } from 'src/components/MessageToasts/actions';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\n\nexport const SET_ALL_SLICES = 'SET_ALL_SLICES';\nexport function setAllSlices(slices) {\n  return { type: SET_ALL_SLICES, payload: { slices } };\n}\n\nexport const FETCH_ALL_SLICES_STARTED = 'FETCH_ALL_SLICES_STARTED';\nexport function fetchAllSlicesStarted() {\n  return { type: FETCH_ALL_SLICES_STARTED };\n}\n\nexport const FETCH_ALL_SLICES_FAILED = 'FETCH_ALL_SLICES_FAILED';\nexport function fetchAllSlicesFailed(error) {\n  return { type: FETCH_ALL_SLICES_FAILED, payload: { error } };\n}\n\nexport function getDatasourceParameter(datasourceId, datasourceType) {\n  return `${datasourceId}__${datasourceType}`;\n}\n\nconst FETCH_SLICES_PAGE_SIZE = 200;\nexport function fetchAllSlices(userId, excludeFilterBox = false) {\n  return (dispatch, getState) => {\n    const { sliceEntities } = getState();\n    if (sliceEntities.lastUpdated === 0) {\n      dispatch(fetchAllSlicesStarted());\n\n      return SupersetClient.get({\n        endpoint: `/api/v1/chart/?q=${rison.encode({\n          columns: [\n            'changed_on_delta_humanized',\n            'changed_on_utc',\n            'datasource_id',\n            'datasource_type',\n            'datasource_url',\n            'datasource_name_text',\n            'description_markeddown',\n            'description',\n            'id',\n            'params',\n            'slice_name',\n            'url',\n            'viz_type',\n          ],\n          filters: [{ col: 'owners', opr: 'rel_m_m', value: userId }],\n          page_size: FETCH_SLICES_PAGE_SIZE,\n          order_column: 'changed_on_delta_humanized',\n          order_direction: 'desc',\n        })}`,\n      })\n        .then(({ json }) => {\n          const slices = {};\n          let { result } = json;\n          // disable add filter_box viz to dashboard\n          if (excludeFilterBox) {\n            result = result.filter(slice => slice.viz_type !== 'filter_box');\n          }\n          result.forEach(slice => {\n            let form_data = JSON.parse(slice.params);\n            form_data = {\n              ...form_data,\n              // force using datasource stored in relational table prop\n              datasource:\n                getDatasourceParameter(\n                  slice.datasource_id,\n                  slice.datasource_type,\n                ) || form_data.datasource,\n            };\n            slices[slice.id] = {\n              slice_id: slice.id,\n              slice_url: slice.url,\n              slice_name: slice.slice_name,\n              form_data,\n              datasource_name: slice.datasource_name_text,\n              datasource_url: slice.datasource_url,\n              datasource_id: slice.datasource_id,\n              datasource_type: slice.datasource_type,\n              changed_on: new Date(slice.changed_on_utc).getTime(),\n              description: slice.description,\n              description_markdown: slice.description_markeddown,\n              viz_type: slice.viz_type,\n              modified: slice.changed_on_delta_humanized,\n              changed_on_humanized: slice.changed_on_delta_humanized,\n            };\n          });\n\n          return dispatch(setAllSlices(slices));\n        })\n        .catch(\n          errorResponse =>\n            console.log(errorResponse) ||\n            getClientErrorObject(errorResponse).then(({ error }) => {\n              dispatch(\n                fetchAllSlicesFailed(\n                  error || t('Could not fetch all saved charts'),\n                ),\n              );\n              dispatch(\n                addDangerToast(\n                  t('Sorry there was an error fetching saved charts: ') + error,\n                ),\n              );\n            }),\n        );\n    }\n\n    return dispatch(setAllSlices(sliceEntities.slices));\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport {\n  ADD_FILTER,\n  REMOVE_FILTER,\n  CHANGE_FILTER,\n  UPDATE_DIRECT_PATH_TO_FILTER,\n  UPDATE_LAYOUT_COMPONENTS,\n  UPDATE_DASHBOARD_FILTERS_SCOPE,\n} from '../actions/dashboardFilters';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\nimport { TIME_RANGE } from '../../visualizations/FilterBox/FilterBox';\nimport { DASHBOARD_ROOT_ID } from '../util/constants';\nimport getFilterConfigsFromFormdata from '../util/getFilterConfigsFromFormdata';\nimport { buildActiveFilters } from '../util/activeDashboardFilters';\nimport { getChartIdAndColumnFromFilterKey } from '../util/getDashboardFilterKey';\n\nexport const DASHBOARD_FILTER_SCOPE_GLOBAL = {\n  scope: [DASHBOARD_ROOT_ID],\n  immune: [],\n};\n\nexport const dashboardFilter = {\n  chartId: null,\n  componentId: null,\n  filterName: null,\n  datasourceId: null,\n  directPathToFilter: [],\n  isDateFilter: false,\n  isInstantFilter: true,\n  columns: {},\n  labels: {},\n  scopes: {},\n};\n\nconst CHANGE_FILTER_VALUE_ACTIONS = [ADD_FILTER, REMOVE_FILTER, CHANGE_FILTER];\n\nexport default function dashboardFiltersReducer(dashboardFilters = {}, action) {\n  const actionHandlers = {\n    [ADD_FILTER]() {\n      const { chartId, component, form_data } = action;\n      const { columns, labels } = getFilterConfigsFromFormdata(form_data);\n      const scopes = Object.keys(columns).reduce(\n        (map, column) => ({\n          ...map,\n          [column]: DASHBOARD_FILTER_SCOPE_GLOBAL,\n        }),\n        {},\n      );\n      const directPathToFilter = component\n        ? (component.parents || []).slice().concat(component.id)\n        : [];\n\n      const newFilter = {\n        ...dashboardFilter,\n        chartId,\n        componentId: component.id,\n        datasourceId: form_data.datasource,\n        filterName: component.meta.sliceName,\n        directPathToFilter,\n        columns,\n        labels,\n        scopes,\n        isInstantFilter: !!form_data.instant_filtering,\n        isDateFilter: Object.keys(columns).includes(TIME_RANGE),\n      };\n\n      return newFilter;\n    },\n\n    [CHANGE_FILTER](state) {\n      const { newSelectedValues, merge } = action;\n      const updatedColumns = Object.keys(newSelectedValues).reduce(\n        (columns, name) => {\n          // override existed column value, or add new column name\n          if (!merge || !(name in columns)) {\n            return {\n              ...columns,\n              [name]: newSelectedValues[name],\n            };\n          }\n\n          return {\n            ...columns,\n            [name]: [...columns[name], ...newSelectedValues[name]],\n          };\n        },\n        { ...state.columns },\n      );\n\n      return {\n        ...state,\n        columns: updatedColumns,\n      };\n    },\n\n    [UPDATE_DIRECT_PATH_TO_FILTER](state) {\n      const { path } = action;\n      return {\n        ...state,\n        directPathToFilter: path,\n      };\n    },\n  };\n\n  if (action.type === UPDATE_LAYOUT_COMPONENTS) {\n    buildActiveFilters({\n      dashboardFilters,\n      components: action.components,\n    });\n    return dashboardFilters;\n  }\n  if (action.type === UPDATE_DASHBOARD_FILTERS_SCOPE) {\n    const allDashboardFiltersScope = action.scopes;\n    // update filter scope for each filter field\n    const updatedFilters = Object.entries(allDashboardFiltersScope).reduce(\n      (map, entry) => {\n        const [filterKey, { scope, immune }] = entry;\n        const { chartId, column } = getChartIdAndColumnFromFilterKey(filterKey);\n        const scopes = {\n          ...map[chartId].scopes,\n          [column]: {\n            scope,\n            immune,\n          },\n        };\n        return {\n          ...map,\n          [chartId]: {\n            ...map[chartId],\n            scopes,\n          },\n        };\n      },\n      dashboardFilters,\n    );\n\n    buildActiveFilters({ dashboardFilters: updatedFilters });\n    return updatedFilters;\n  }\n  if (action.type === REMOVE_FILTER) {\n    const { chartId } = action;\n    const { [chartId]: deletedFilter, ...updatedFilters } = dashboardFilters;\n    buildActiveFilters({ dashboardFilters: updatedFilters });\n\n    return updatedFilters;\n  }\n  if (action.type === HYDRATE_DASHBOARD) {\n    return action.data.dashboardFilters;\n  }\n\n  if (action.type in actionHandlers) {\n    const updatedFilters = {\n      ...dashboardFilters,\n      [action.chartId]: actionHandlers[action.type](\n        dashboardFilters[action.chartId],\n      ),\n    };\n    if (CHANGE_FILTER_VALUE_ACTIONS.includes(action.type)) {\n      buildActiveFilters({ dashboardFilters: updatedFilters });\n    }\n\n    return updatedFilters;\n  }\n\n  return dashboardFilters;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nimport {\n  FETCH_ALL_SLICES_FAILED,\n  FETCH_ALL_SLICES_STARTED,\n  SET_ALL_SLICES,\n} from '../actions/sliceEntities';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\n\nexport const initSliceEntities = {\n  slices: {},\n  isLoading: true,\n  errorMessage: null,\n  lastUpdated: 0,\n};\n\nexport default function sliceEntitiesReducer(\n  state = initSliceEntities,\n  action,\n) {\n  const actionHandlers = {\n    [HYDRATE_DASHBOARD]() {\n      return {\n        ...action.data.sliceEntities,\n      };\n    },\n    [FETCH_ALL_SLICES_STARTED]() {\n      return {\n        ...state,\n        isLoading: true,\n      };\n    },\n    [SET_ALL_SLICES]() {\n      return {\n        ...state,\n        isLoading: false,\n        slices: { ...state.slices, ...action.payload.slices },\n        lastUpdated: new Date().getTime(),\n      };\n    },\n    [FETCH_ALL_SLICES_FAILED]() {\n      return {\n        ...state,\n        isLoading: false,\n        lastUpdated: new Date().getTime(),\n        errorMessage:\n          action.payload.error || t('Could not fetch all saved charts'),\n      };\n    },\n  };\n\n  if (action.type in actionHandlers) {\n    return actionHandlers[action.type]();\n  }\n  return state;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { isEmpty } from 'lodash';\nimport { mapValues, flow, keyBy } from 'lodash/fp';\nimport {\n  getChartIdAndColumnFromFilterKey,\n  getDashboardFilterKey,\n} from './getDashboardFilterKey';\nimport { CHART_TYPE } from './componentTypes';\nimport { DASHBOARD_FILTER_SCOPE_GLOBAL } from '../reducers/dashboardFilters';\n\nlet allFilterBoxChartIds = [];\nlet activeFilters = {};\nlet appliedFilterValuesByChart = {};\nlet allComponents = {};\n\n// output: { [id_column]: { values, scope } }\nexport function getActiveFilters() {\n  return activeFilters;\n}\n\n// currently filter_box is a chart,\n// when selecting filter scopes, they have to be out pulled out in a few places.\n// after we make filter_box a dashboard build-in component, will not need this check anymore.\nexport function isFilterBox(chartId) {\n  return allFilterBoxChartIds.includes(chartId);\n}\n\n// this function is to find all filter values applied to a chart,\n// it goes through all active filters and their scopes.\n// return: { [column]: array of selected values }\nexport function getAppliedFilterValues(chartId) {\n  // use cached data if possible\n  if (!(chartId in appliedFilterValuesByChart)) {\n    const applicableFilters = Object.entries(activeFilters).filter(\n      ([, { scope: chartIds }]) => chartIds.includes(chartId),\n    );\n    appliedFilterValuesByChart[chartId] = flow(\n      keyBy(\n        ([filterKey]) => getChartIdAndColumnFromFilterKey(filterKey).column,\n      ),\n      mapValues(([, { values }]) => values),\n    )(applicableFilters);\n  }\n  return appliedFilterValuesByChart[chartId];\n}\n\n// Legacy - getChartIdsInFilterBoxScope is used only by\n// components and functions related to filter box\n// Please use src/dashboard/util/getChartIdsInFilterScope instead\nexport function getChartIdsInFilterBoxScope({ filterScope }) {\n  function traverse(chartIds = [], component = {}, immuneChartIds = []) {\n    if (!component) {\n      return;\n    }\n\n    if (\n      component.type === CHART_TYPE &&\n      component.meta &&\n      component.meta.chartId &&\n      !immuneChartIds.includes(component.meta.chartId)\n    ) {\n      chartIds.push(component.meta.chartId);\n    } else if (component.children) {\n      component.children.forEach(child =>\n        traverse(chartIds, allComponents[child], immuneChartIds),\n      );\n    }\n  }\n\n  const chartIds = [];\n  const { scope: scopeComponentIds, immune: immuneChartIds } =\n    filterScope || DASHBOARD_FILTER_SCOPE_GLOBAL;\n  scopeComponentIds.forEach(componentId =>\n    traverse(chartIds, allComponents[componentId], immuneChartIds),\n  );\n\n  return chartIds;\n}\n\n// non-empty filter fields in dashboardFilters,\n// activeFilters map contains selected values and filter scope.\n// values: array of selected values\n// scope: array of chartIds that applicable to the filter field.\nexport function buildActiveFilters({ dashboardFilters = {}, components = {} }) {\n  allFilterBoxChartIds = Object.values(dashboardFilters).map(\n    filter => filter.chartId,\n  );\n\n  // clear cache\n  if (!isEmpty(components)) {\n    allComponents = components;\n  }\n  appliedFilterValuesByChart = {};\n  activeFilters = Object.values(dashboardFilters).reduce((result, filter) => {\n    const { chartId, columns, scopes } = filter;\n    const nonEmptyFilters = {};\n\n    Object.keys(columns).forEach(column => {\n      if (\n        Array.isArray(columns[column])\n          ? columns[column].length\n          : columns[column] !== undefined\n      ) {\n        // remove filter itself\n        const scope = getChartIdsInFilterBoxScope({\n          filterScope: scopes[column],\n        }).filter(id => chartId !== id);\n\n        nonEmptyFilters[getDashboardFilterKey({ chartId, column })] = {\n          values: columns[column],\n          scope,\n        };\n      }\n    });\n\n    return {\n      ...result,\n      ...nonEmptyFilters,\n    };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport {\n  FILTER_CONFIG_ATTRIBUTES,\n  TIME_FILTER_LABELS,\n  TIME_FILTER_MAP,\n} from 'src/explore/constants';\n\nexport default function getFilterConfigsFromFormdata(form_data = {}) {\n  const {\n    date_filter,\n    filter_configs = [],\n    show_druid_time_granularity,\n    show_druid_time_origin,\n    show_sqla_time_column,\n    show_sqla_time_granularity,\n  } = form_data;\n  let configs = filter_configs.reduce(\n    ({ columns, labels }, config) => {\n      let defaultValues = config[FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE];\n\n      // treat empty string as null (no default value)\n      if (defaultValues === '') {\n        defaultValues = null;\n      }\n\n      // defaultValue could be ; separated values,\n      // could be null or ''\n      if (defaultValues && config[FILTER_CONFIG_ATTRIBUTES.MULTIPLE]) {\n        defaultValues = config.defaultValue.split(';');\n      }\n\n      const updatedColumns = {\n        ...columns,\n        [config.column]: config.vals || defaultValues,\n      };\n      const updatedLabels = {\n        ...labels,\n        [config.column]: config.label,\n      };\n\n      return {\n        columns: updatedColumns,\n        labels: updatedLabels,\n      };\n    },\n    { columns: {}, labels: {} },\n  );\n\n  if (date_filter) {\n    let updatedColumns = {\n      ...configs.columns,\n      [TIME_FILTER_MAP.time_range]: form_data.time_range,\n    };\n    const updatedLabels = {\n      ...configs.labels,\n      ...Object.entries(TIME_FILTER_MAP).reduce(\n        (map, [key, value]) => ({\n          ...map,\n          [value]: TIME_FILTER_LABELS[key],\n        }),\n        {},\n      ),\n    };\n\n    if (show_sqla_time_granularity) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.time_grain_sqla]: form_data.time_grain_sqla,\n      };\n    }\n\n    if (show_sqla_time_column) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.granularity_sqla]: form_data.granularity_sqla,\n      };\n    }\n\n    if (show_druid_time_granularity) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.granularity]: form_data.granularity,\n      };\n    }\n\n    if (show_druid_time_origin) {\n      updatedColumns = {\n        ...updatedColumns,\n        [TIME_FILTER_MAP.druid_time_origin]: form_data.druid_time_origin,\n      };\n    }\n\n    configs = {\n      ...configs,\n      columns: updatedColumns,\n      labels: updatedLabels,\n    };\n  }\n  return configs;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport shortid from 'shortid';\nimport { t } from '@superset-ui/core';\n\nimport {\n  CHART_TYPE,\n  COLUMN_TYPE,\n  DIVIDER_TYPE,\n  HEADER_TYPE,\n  MARKDOWN_TYPE,\n  ROW_TYPE,\n  TABS_TYPE,\n  TAB_TYPE,\n  DYNAMIC_TYPE,\n} from './componentTypes';\n\nimport {\n  MEDIUM_HEADER,\n  BACKGROUND_TRANSPARENT,\n  GRID_DEFAULT_CHART_WIDTH,\n  GRID_COLUMN_COUNT,\n} from './constants';\n\nconst typeToDefaultMetaData = {\n  [CHART_TYPE]: { width: GRID_DEFAULT_CHART_WIDTH, height: 50 },\n  [COLUMN_TYPE]: {\n    width: GRID_DEFAULT_CHART_WIDTH,\n    background: BACKGROUND_TRANSPARENT,\n  },\n  [DIVIDER_TYPE]: null,\n  [HEADER_TYPE]: {\n    text: 'New header',\n    headerSize: MEDIUM_HEADER,\n    background: BACKGROUND_TRANSPARENT,\n  },\n  [MARKDOWN_TYPE]: { width: GRID_DEFAULT_CHART_WIDTH, height: 50 },\n  [ROW_TYPE]: { background: BACKGROUND_TRANSPARENT },\n  [TABS_TYPE]: null,\n  [TAB_TYPE]: {\n    text: '',\n    defaultText: t('Tab title'),\n    placeholder: t('Tab title'),\n  },\n  [DYNAMIC_TYPE]: {\n    width: GRID_COLUMN_COUNT,\n    background: BACKGROUND_TRANSPARENT,\n  },\n};\n\nfunction uuid(type) {\n  return `${type}-${shortid.generate()}`;\n}\n\nexport default function entityFactory(type, meta, parents = []) {\n  return {\n    type,\n    id: uuid(type),\n    children: [],\n    parents,\n    meta: {\n      ...typeToDefaultMetaData[type],\n      ...meta,\n    },\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { getChartIdAndColumnFromFilterKey } from './getDashboardFilterKey';\n\n// input: { [id_column1]: values, [id_column2]: values }\n// output: { id: { column1: values, column2: values } }\nexport default function serializeActiveFilterValues(activeFilters) {\n  return Object.entries(activeFilters).reduce((map, entry) => {\n    const [filterKey, { values }] = entry;\n    const { chartId, column } = getChartIdAndColumnFromFilterKey(filterKey);\n    const entryByChartId = {\n      ...map[chartId],\n      [column]: values,\n    };\n    return {\n      ...map,\n      [chartId]: entryByChartId,\n    };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { styled, css } from '@superset-ui/core';\nimport ControlHeader from '../ControlHeader';\nimport Checkbox from '../../../components/Checkbox';\n\nconst propTypes = {\n  value: PropTypes.bool,\n  label: PropTypes.string,\n  onChange: PropTypes.func,\n};\n\nconst defaultProps = {\n  value: false,\n  onChange: () => {},\n};\n\nconst CheckBoxControlWrapper = styled.div`\n  ${({ theme }) => css`\n    .ControlHeader label {\n      color: ${theme.colors.grayscale.dark1};\n    }\n    span[role='checkbox'] {\n      padding-right: ${theme.gridUnit * 2}px;\n    }\n  `}\n`;\n\nexport default class CheckboxControl extends React.Component {\n  onChange() {\n    this.props.onChange(!this.props.value);\n  }\n\n  renderCheckbox() {\n    return (\n      <Checkbox\n        onChange={this.onChange.bind(this)}\n        checked={!!this.props.value}\n      />\n    );\n  }\n\n  render() {\n    if (this.props.label) {\n      return (\n        <CheckBoxControlWrapper>\n          <ControlHeader\n            {...this.props}\n            leftNode={this.renderCheckbox()}\n            onClick={this.onChange.bind(this)}\n          />\n        </CheckBoxControlWrapper>\n      );\n    }\n    return this.renderCheckbox();\n  }\n}\nCheckboxControl.propTypes = propTypes;\nCheckboxControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { isFunction } from 'lodash';\nimport { Select } from 'src/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { styled, t } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\nconst propTypes = {\n  hasCustomLabelColors: PropTypes.bool,\n  dashboardId: PropTypes.number,\n  description: PropTypes.string,\n  label: PropTypes.string,\n  labelMargin: PropTypes.number,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  clearable: PropTypes.bool,\n  default: PropTypes.string,\n  choices: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.array),\n    PropTypes.func,\n  ]),\n  schemes: PropTypes.oneOfType([PropTypes.object, PropTypes.func]),\n  isLinear: PropTypes.bool,\n};\n\nconst defaultProps = {\n  choices: [],\n  hasCustomLabelColors: false,\n  label: t('Color scheme'),\n  schemes: {},\n  clearable: false,\n  onChange: () => {},\n};\n\nconst StyledAlert = styled(Icons.AlertSolid)`\n  color: ${({ theme }) => theme.colors.alert.base};\n`;\n\nexport default class ColorSchemeControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n    this.renderOption = this.renderOption.bind(this);\n    this.renderLabel = this.renderLabel.bind(this);\n    this.dashboardColorSchemeAlert = t(\n      `The color scheme is determined by the related dashboard.\n              Edit the color scheme in the dashboard properties.`,\n    );\n  }\n\n  onChange(value) {\n    this.props.onChange(value);\n  }\n\n  renderOption(value) {\n    const { isLinear } = this.props;\n    const currentScheme = this.schemes[value];\n\n    // For categorical scheme, display all the colors\n    // For sequential scheme, show 10 or interpolate to 10.\n    // Sequential schemes usually have at most 10 colors.\n    let colors = [];\n    if (currentScheme) {\n      colors = isLinear ? currentScheme.getColors(10) : currentScheme.colors;\n    }\n\n    return (\n      <span key={currentScheme.id} title={currentScheme.label}>\n        <ul\n          css={{\n            listStyle: 'none',\n            margin: 0,\n            padding: 0,\n            display: 'flex',\n            alignItems: 'center',\n\n            '& li': {\n              flexBasis: 9,\n              height: 10,\n              margin: '9px 1px',\n            },\n          }}\n          data-test={currentScheme.id}\n        >\n          {colors.map((color, i) => (\n            <li\n              key={`${currentScheme.id}-${i}`}\n              css={{\n                backgroundColor: color,\n                border: `1px solid ${color === 'white' ? 'black' : color}`,\n              }}\n            >\n              &nbsp;\n            </li>\n          ))}\n        </ul>\n      </span>\n    );\n  }\n\n  renderLabel() {\n    const { dashboardId, hasCustomLabelColors, label } = this.props;\n\n    if (hasCustomLabelColors || dashboardId) {\n      const alertTitle = hasCustomLabelColors\n        ? t(\n            `This color scheme is being overriden by custom label colors.\n              Check the JSON metadata in the Advanced settings`,\n          )\n        : this.dashboardColorSchemeAlert;\n      return (\n        <>\n          {label}{' '}\n          <Tooltip title={alertTitle}>\n            <StyledAlert iconSize=\"s\" />\n          </Tooltip>\n        </>\n      );\n    }\n    return label;\n  }\n\n  render() {\n    const { choices, dashboardId, schemes } = this.props;\n    let options = dashboardId\n      ? [\n          {\n            value: 'dashboard',\n            label: 'dashboard',\n            customLabel: (\n              <Tooltip title={this.dashboardColorSchemeAlert}>\n                {t('Dashboard scheme')}\n              </Tooltip>\n            ),\n          },\n        ]\n      : [];\n    let currentScheme = dashboardId ? 'dashboard' : undefined;\n\n    // if related to a dashboard the scheme is dictated by the dashboard\n    if (!dashboardId) {\n      this.schemes = isFunction(schemes) ? schemes() : schemes;\n      const controlChoices = isFunction(choices) ? choices() : choices;\n      const allColorOptions = [];\n      const filteredColorOptions = controlChoices.filter(o => {\n        const option = o[0];\n        const isValidColorOption =\n          option !== 'SUPERSET_DEFAULT' && !allColorOptions.includes(option);\n        allColorOptions.push(option);\n        return isValidColorOption;\n      });\n\n      options = filteredColorOptions.map(([value]) => ({\n        customLabel: this.renderOption(value),\n        label: this.schemes?.[value]?.label || value,\n        value,\n      }));\n\n      currentScheme = this.props.value || this.props.default;\n\n      if (currentScheme === 'SUPERSET_DEFAULT') {\n        currentScheme = this.schemes?.SUPERSET_DEFAULT?.id;\n      }\n    }\n\n    const selectProps = {\n      ariaLabel: t('Select color scheme'),\n      allowClear: this.props.clearable,\n      disabled: !!dashboardId,\n      name: `select-${this.props.name}`,\n      onChange: this.onChange,\n      options,\n      placeholder: t('Select scheme'),\n      value: currentScheme,\n    };\n\n    return (\n      <Select\n        header={<ControlHeader {...this.props} label={this.renderLabel()} />}\n        {...selectProps}\n      />\n    );\n  }\n}\n\nColorSchemeControl.propTypes = propTypes;\nColorSchemeControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  CUSTOM_OPERATORS,\n  Operators,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport { getSimpleSQLExpression } from 'src/explore/exploreUtils';\n\nexport const EXPRESSION_TYPES = {\n  SIMPLE: 'SIMPLE',\n  SQL: 'SQL',\n};\n\nexport const CLAUSES = {\n  HAVING: 'HAVING',\n  WHERE: 'WHERE',\n};\n\nconst OPERATORS_TO_SQL = {\n  '==': '=',\n  '!=': '<>',\n  '>': '>',\n  '<': '<',\n  '>=': '>=',\n  '<=': '<=',\n  IN: 'IN',\n  'NOT IN': 'NOT IN',\n  LIKE: 'LIKE',\n  ILIKE: 'ILIKE',\n  REGEX: 'REGEX',\n  'IS NOT NULL': 'IS NOT NULL',\n  'IS NULL': 'IS NULL',\n  'IS TRUE': 'IS TRUE',\n  'IS FALSE': 'IS FALSE',\n  'LATEST PARTITION': ({ datasource }) =>\n    `= '{{ presto.latest_partition('${datasource.schema}.${datasource.datasource_name}') }}'`,\n};\n\nconst CUSTOM_OPERATIONS = [...CUSTOM_OPERATORS].map(\n  op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n);\n\nfunction translateToSql(adhocMetric, { useSimple } = {}) {\n  if (adhocMetric.expressionType === EXPRESSION_TYPES.SIMPLE || useSimple) {\n    const { subject, comparator } = adhocMetric;\n    const operator =\n      adhocMetric.operator &&\n      CUSTOM_OPERATIONS.indexOf(adhocMetric.operator) >= 0\n        ? OPERATORS_TO_SQL[adhocMetric.operator](adhocMetric)\n        : OPERATORS_TO_SQL[adhocMetric.operator];\n    return getSimpleSQLExpression(subject, operator, comparator);\n  }\n  if (adhocMetric.expressionType === EXPRESSION_TYPES.SQL) {\n    return adhocMetric.sqlExpression;\n  }\n  return '';\n}\n\nexport default class AdhocFilter {\n  constructor(adhocFilter) {\n    this.expressionType = adhocFilter.expressionType || EXPRESSION_TYPES.SIMPLE;\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      this.subject = adhocFilter.subject;\n      this.operator = adhocFilter.operator?.toUpperCase();\n      this.operatorId = adhocFilter.operatorId;\n      this.comparator = adhocFilter.comparator;\n      if (\n        [Operators.IS_TRUE, Operators.IS_FALSE].indexOf(\n          adhocFilter.operatorId,\n        ) >= 0\n      ) {\n        this.comparator = adhocFilter.operatorId === Operators.IS_TRUE;\n      }\n      if (\n        [Operators.IS_NULL, Operators.IS_NOT_NULL].indexOf(\n          adhocFilter.operatorId,\n        ) >= 0\n      ) {\n        this.comparator = null;\n      }\n      this.clause = adhocFilter.clause || CLAUSES.WHERE;\n      this.sqlExpression = null;\n    } else if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      this.sqlExpression =\n        typeof adhocFilter.sqlExpression === 'string'\n          ? adhocFilter.sqlExpression\n          : translateToSql(adhocFilter, { useSimple: true });\n      this.clause = adhocFilter.clause;\n      if (\n        adhocFilter.operator &&\n        CUSTOM_OPERATIONS.indexOf(adhocFilter.operator) >= 0\n      ) {\n        this.subject = adhocFilter.subject;\n        this.operator = adhocFilter.operator;\n        this.operatorId = adhocFilter.operatorId;\n      } else {\n        this.subject = null;\n        this.operator = null;\n      }\n      this.comparator = null;\n    }\n    this.isExtra = !!adhocFilter.isExtra;\n    this.isNew = !!adhocFilter.isNew;\n\n    this.filterOptionName =\n      adhocFilter.filterOptionName ||\n      `filter_${Math.random().toString(36).substring(2, 15)}_${Math.random()\n        .toString(36)\n        .substring(2, 15)}`;\n  }\n\n  duplicateWith(nextFields) {\n    return new AdhocFilter({\n      ...this,\n      // all duplicated fields are not new (i.e. will not open popup automatically)\n      isNew: false,\n      ...nextFields,\n    });\n  }\n\n  equals(adhocFilter) {\n    return (\n      adhocFilter.expressionType === this.expressionType &&\n      adhocFilter.sqlExpression === this.sqlExpression &&\n      adhocFilter.operator === this.operator &&\n      adhocFilter.operatorId === this.operatorId &&\n      adhocFilter.comparator === this.comparator &&\n      adhocFilter.subject === this.subject\n    );\n  }\n\n  isValid() {\n    const nullCheckOperators = [Operators.IS_NOT_NULL, Operators.IS_NULL].map(\n      op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n    );\n    const truthCheckOperators = [Operators.IS_TRUE, Operators.IS_FALSE].map(\n      op => OPERATOR_ENUM_TO_OPERATOR_TYPE[op].operation,\n    );\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      if (nullCheckOperators.indexOf(this.operator) >= 0) {\n        return !!(this.operator && this.subject);\n      }\n      if (truthCheckOperators.indexOf(this.operator) >= 0) {\n        return !!(this.subject && this.comparator !== null);\n      }\n      if (this.operator && this.subject && this.clause) {\n        if (Array.isArray(this.comparator)) {\n          if (this.comparator.length > 0) {\n            // A non-empty array of values ('IN' or 'NOT IN' clauses)\n            return true;\n          }\n        } else if (this.comparator !== null) {\n          // A value has been selected or typed\n          return true;\n        }\n      }\n    } else if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return !!(this.sqlExpression && this.clause);\n    }\n    return false;\n  }\n\n  getDefaultLabel() {\n    const label = this.translateToSql();\n    return label.length < 43 ? label : `${label.substring(0, 40)}...`;\n  }\n\n  getTooltipTitle() {\n    return this.translateToSql();\n  }\n\n  translateToSql() {\n    return translateToSql(this);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport { OptionControlLabel } from 'src/explore/components/controls/OptionControls';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onFilterEdit: PropTypes.func.isRequired,\n  onRemoveFilter: PropTypes.func,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string),\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string,\n  onMoveLabel: PropTypes.func,\n  onDropLabel: PropTypes.func,\n  index: PropTypes.number,\n};\n\nconst AdhocFilterOption = ({\n  adhocFilter,\n  options,\n  datasource,\n  onFilterEdit,\n  onRemoveFilter,\n  partitionColumn,\n  onMoveLabel,\n  onDropLabel,\n  index,\n  sections,\n  operators,\n}) => (\n  <AdhocFilterPopoverTrigger\n    sections={sections}\n    operators={operators}\n    adhocFilter={adhocFilter}\n    options={options}\n    datasource={datasource}\n    onFilterEdit={onFilterEdit}\n    partitionColumn={partitionColumn}\n  >\n    <OptionControlLabel\n      label={adhocFilter.getDefaultLabel()}\n      tooltipTitle={adhocFilter.getTooltipTitle()}\n      onRemove={onRemoveFilter}\n      onMoveLabel={onMoveLabel}\n      onDropLabel={onDropLabel}\n      index={index}\n      type={DndItemType.FilterOption}\n      withCaret\n      isExtra={adhocFilter.isExtra}\n    />\n  </AdhocFilterPopoverTrigger>\n);\n\nexport default AdhocFilterOption;\n\nAdhocFilterOption.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport { EXPRESSION_TYPES, CLAUSES } from './AdhocFilter';\n\nexport default PropTypes.oneOfType([\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SIMPLE]).isRequired,\n    clause: PropTypes.oneOf([CLAUSES.HAVING, CLAUSES.WHERE]).isRequired,\n    subject: PropTypes.string.isRequired,\n    comparator: PropTypes.oneOfType([\n      PropTypes.string,\n      PropTypes.arrayOf(PropTypes.string),\n    ]).isRequired,\n  }),\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SQL]).isRequired,\n    clause: PropTypes.oneOf([CLAUSES.WHERE, CLAUSES.HAVING]).isRequired,\n    sqlExpression: PropTypes.string.isRequired,\n  }),\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  t,\n  logging,\n  SupersetClient,\n  withTheme,\n  ensureIsArray,\n} from '@superset-ui/core';\n\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport savedMetricType from 'src/explore/components/controls/MetricControl/savedMetricType';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  Operators,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport FilterDefinitionOption from 'src/explore/components/controls/MetricControl/FilterDefinitionOption';\nimport {\n  AddControlLabel,\n  AddIconButton,\n  HeaderContainer,\n  LabelsContainer,\n} from 'src/explore/components/controls/OptionControls';\nimport Icons from 'src/components/Icons';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport AdhocFilterOption from 'src/explore/components/controls/FilterControl/AdhocFilterOption';\nimport AdhocFilter, {\n  CLAUSES,\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport adhocFilterType from 'src/explore/components/controls/FilterControl/adhocFilterType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\n\nconst selectedMetricType = PropTypes.oneOfType([\n  PropTypes.string,\n  adhocMetricType,\n]);\n\nconst propTypes = {\n  label: PropTypes.oneOfType([PropTypes.object, PropTypes.string]),\n  name: PropTypes.string,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string),\n  onChange: PropTypes.func,\n  value: PropTypes.arrayOf(adhocFilterType),\n  datasource: PropTypes.object,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetrics: PropTypes.arrayOf(savedMetricType),\n  selectedMetrics: PropTypes.oneOfType([\n    selectedMetricType,\n    PropTypes.arrayOf(selectedMetricType),\n  ]),\n  isLoading: PropTypes.bool,\n};\n\nconst defaultProps = {\n  name: '',\n  onChange: () => {},\n  columns: [],\n  savedMetrics: [],\n  selectedMetrics: [],\n};\n\nfunction isDictionaryForAdhocFilter(value) {\n  return value && !(value instanceof AdhocFilter) && value.expressionType;\n}\n\nclass AdhocFilterControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.optionsForSelect = this.optionsForSelect.bind(this);\n    this.onRemoveFilter = this.onRemoveFilter.bind(this);\n    this.onNewFilter = this.onNewFilter.bind(this);\n    this.onFilterEdit = this.onFilterEdit.bind(this);\n    this.moveLabel = this.moveLabel.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.mapOption = this.mapOption.bind(this);\n    this.getMetricExpression = this.getMetricExpression.bind(this);\n\n    const filters = (this.props.value || []).map(filter =>\n      isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n    );\n\n    this.optionRenderer = option => <FilterDefinitionOption option={option} />;\n    this.valueRenderer = (adhocFilter, index) => (\n      <AdhocFilterOption\n        key={index}\n        index={index}\n        adhocFilter={adhocFilter}\n        onFilterEdit={this.onFilterEdit}\n        options={this.state.options}\n        sections={this.props.sections}\n        operators={this.props.operators}\n        datasource={this.props.datasource}\n        onRemoveFilter={() => this.onRemoveFilter(index)}\n        onMoveLabel={this.moveLabel}\n        onDropLabel={() => this.props.onChange(this.state.values)}\n        partitionColumn={this.state.partitionColumn}\n      />\n    );\n    this.state = {\n      values: filters,\n      options: this.optionsForSelect(this.props),\n      partitionColumn: null,\n    };\n  }\n\n  componentDidMount() {\n    const { datasource } = this.props;\n    if (datasource && datasource.type === 'table') {\n      const dbId = datasource.database?.id;\n      const {\n        datasource_name: name,\n        schema,\n        is_sqllab_view: isSqllabView,\n      } = datasource;\n\n      if (!isSqllabView && dbId && name && schema) {\n        SupersetClient.get({\n          endpoint: `/api/v1/database/${dbId}/table_extra/${name}/${schema}/`,\n        })\n          .then(({ json }) => {\n            if (json && json.partitions) {\n              const { partitions } = json;\n              // for now only show latest_partition option\n              // when table datasource has only 1 partition key.\n              if (\n                partitions &&\n                partitions.cols &&\n                Object.keys(partitions.cols).length === 1\n              ) {\n                this.setState({ partitionColumn: partitions.cols[0] });\n              }\n            }\n          })\n          .catch(error => {\n            logging.error('fetch extra_table_metadata:', error.statusText);\n          });\n      }\n    }\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (this.props.columns !== nextProps.columns) {\n      this.setState({ options: this.optionsForSelect(nextProps) });\n    }\n    if (this.props.value !== nextProps.value) {\n      this.setState({\n        values: (nextProps.value || []).map(filter =>\n          isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n        ),\n      });\n    }\n  }\n\n  onRemoveFilter(index) {\n    const valuesCopy = [...this.state.values];\n    valuesCopy.splice(index, 1);\n    this.setState(prevState => ({\n      ...prevState,\n      values: valuesCopy,\n    }));\n    this.props.onChange(valuesCopy);\n  }\n\n  onNewFilter(newFilter) {\n    const mappedOption = this.mapOption(newFilter);\n    if (mappedOption) {\n      this.setState(\n        prevState => ({\n          ...prevState,\n          values: [...prevState.values, mappedOption],\n        }),\n        () => {\n          this.props.onChange(this.state.values);\n        },\n      );\n    }\n  }\n\n  onFilterEdit(changedFilter) {\n    this.props.onChange(\n      this.state.values.map(value => {\n        if (value.filterOptionName === changedFilter.filterOptionName) {\n          return changedFilter;\n        }\n        return value;\n      }),\n    );\n  }\n\n  onChange(opts) {\n    const options = (opts || [])\n      .map(option => this.mapOption(option))\n      .filter(option => option);\n    this.props.onChange(options);\n  }\n\n  getMetricExpression(savedMetricName) {\n    return this.props.savedMetrics.find(\n      savedMetric => savedMetric.metric_name === savedMetricName,\n    ).expression;\n  }\n\n  moveLabel(dragIndex, hoverIndex) {\n    const { values } = this.state;\n\n    const newValues = [...values];\n    [newValues[hoverIndex], newValues[dragIndex]] = [\n      newValues[dragIndex],\n      newValues[hoverIndex],\n    ];\n    this.setState({ values: newValues });\n  }\n\n  mapOption(option) {\n    // already a AdhocFilter, skip\n    if (option instanceof AdhocFilter) {\n      return option;\n    }\n    // via datasource saved metric\n    if (option.saved_metric_name) {\n      return new AdhocFilter({\n        expressionType:\n          this.props.datasource.type === 'druid'\n            ? EXPRESSION_TYPES.SIMPLE\n            : EXPRESSION_TYPES.SQL,\n        subject:\n          this.props.datasource.type === 'druid'\n            ? option.saved_metric_name\n            : this.getMetricExpression(option.saved_metric_name),\n        operator:\n          OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n        comparator: 0,\n        clause: CLAUSES.HAVING,\n      });\n    }\n    // has a custom label, meaning it's custom column\n    if (option.label) {\n      return new AdhocFilter({\n        expressionType:\n          this.props.datasource.type === 'druid'\n            ? EXPRESSION_TYPES.SIMPLE\n            : EXPRESSION_TYPES.SQL,\n        subject:\n          this.props.datasource.type === 'druid'\n            ? option.label\n            : new AdhocMetric(option).translateToSql(),\n        operator:\n          OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n        comparator: 0,\n        clause: CLAUSES.HAVING,\n      });\n    }\n    // add a new filter item\n    if (option.column_name) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n        subject: option.column_name,\n        operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.EQUALS].operation,\n        comparator: '',\n        clause: CLAUSES.WHERE,\n        isNew: true,\n      });\n    }\n    return null;\n  }\n\n  optionsForSelect(props) {\n    const options = [\n      ...props.columns,\n      ...ensureIsArray(props.selectedMetrics).map(\n        metric =>\n          metric &&\n          (typeof metric === 'string'\n            ? { saved_metric_name: metric }\n            : new AdhocMetric(metric)),\n      ),\n    ].filter(option => option);\n\n    return options\n      .reduce((results, option) => {\n        if (option.saved_metric_name) {\n          results.push({\n            ...option,\n            filterOptionName: option.saved_metric_name,\n          });\n        } else if (option.column_name) {\n          results.push({\n            ...option,\n            filterOptionName: `_col_${option.column_name}`,\n          });\n        } else if (option instanceof AdhocMetric) {\n          results.push({\n            ...option,\n            filterOptionName: `_adhocmetric_${option.label}`,\n          });\n        }\n        return results;\n      }, [])\n      .sort((a, b) =>\n        (a.saved_metric_name || a.column_name || a.label).localeCompare(\n          b.saved_metric_name || b.column_name || b.label,\n        ),\n      );\n  }\n\n  addNewFilterPopoverTrigger(trigger) {\n    return (\n      <AdhocFilterPopoverTrigger\n        operators={this.props.operators}\n        sections={this.props.sections}\n        adhocFilter={new AdhocFilter({})}\n        datasource={this.props.datasource}\n        options={this.state.options}\n        onFilterEdit={this.onNewFilter}\n        partitionColumn={this.state.partitionColumn}\n      >\n        {trigger}\n      </AdhocFilterPopoverTrigger>\n    );\n  }\n\n  render() {\n    const { theme } = this.props;\n    return (\n      <div className=\"metrics-select\" data-test=\"adhoc-filter-control\">\n        <HeaderContainer>\n          <ControlHeader {...this.props} />\n          {this.addNewFilterPopoverTrigger(\n            <AddIconButton data-test=\"add-filter-button\">\n              <Icons.PlusLarge\n                iconSize=\"s\"\n                iconColor={theme.colors.grayscale.light5}\n              />\n            </AddIconButton>,\n          )}\n        </HeaderContainer>\n        <LabelsContainer>\n          {this.state.values.length > 0\n            ? this.state.values.map((value, index) =>\n                this.valueRenderer(value, index),\n              )\n            : this.addNewFilterPopoverTrigger(\n                <AddControlLabel>\n                  <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n                  {t('Add filter')}\n                </AddControlLabel>,\n              )}\n        </LabelsContainer>\n      </div>\n    );\n  }\n}\n\nAdhocFilterControl.propTypes = propTypes;\nAdhocFilterControl.defaultProps = defaultProps;\n\nexport default withTheme(AdhocFilterControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  column_name: PropTypes.string.isRequired,\n  type: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  sqlaAutoGeneratedMetricRegex,\n  AGGREGATES,\n} from 'src/explore/constants';\n\nexport const EXPRESSION_TYPES = {\n  SIMPLE: 'SIMPLE',\n  SQL: 'SQL',\n};\n\nfunction inferSqlExpressionColumn(adhocMetric) {\n  if (\n    adhocMetric.sqlExpression &&\n    sqlaAutoGeneratedMetricRegex.test(adhocMetric.sqlExpression)\n  ) {\n    const indexFirstCloseParen = adhocMetric.sqlExpression.indexOf(')');\n    const indexPairedOpenParen = adhocMetric.sqlExpression\n      .substring(0, indexFirstCloseParen)\n      .lastIndexOf('(');\n    if (indexFirstCloseParen > 0 && indexPairedOpenParen > 0) {\n      return adhocMetric.sqlExpression.substring(\n        indexPairedOpenParen + 1,\n        indexFirstCloseParen,\n      );\n    }\n  }\n  return null;\n}\n\nfunction inferSqlExpressionAggregate(adhocMetric) {\n  if (\n    adhocMetric.sqlExpression &&\n    sqlaAutoGeneratedMetricRegex.test(adhocMetric.sqlExpression)\n  ) {\n    const indexFirstOpenParen = adhocMetric.sqlExpression.indexOf('(');\n    if (indexFirstOpenParen > 0) {\n      return adhocMetric.sqlExpression.substring(0, indexFirstOpenParen);\n    }\n  }\n  return null;\n}\n\nexport default class AdhocMetric {\n  constructor(adhocMetric) {\n    this.expressionType = adhocMetric.expressionType || EXPRESSION_TYPES.SIMPLE;\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      // try to be clever in the case of transitioning from Sql expression back to simple expression\n      const inferredColumn = inferSqlExpressionColumn(adhocMetric);\n      this.column =\n        adhocMetric.column ||\n        (inferredColumn && { column_name: inferredColumn });\n      this.aggregate =\n        adhocMetric.aggregate || inferSqlExpressionAggregate(adhocMetric);\n      this.sqlExpression = null;\n    } else if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      this.sqlExpression = adhocMetric.sqlExpression;\n      this.column = null;\n      this.aggregate = null;\n    }\n    this.isNew = !!adhocMetric.isNew;\n    this.hasCustomLabel = !!(adhocMetric.hasCustomLabel && adhocMetric.label);\n    this.label = this.hasCustomLabel\n      ? adhocMetric.label\n      : this.getDefaultLabel();\n\n    this.optionName =\n      adhocMetric.optionName ||\n      `metric_${Math.random().toString(36).substring(2, 15)}_${Math.random()\n        .toString(36)\n        .substring(2, 15)}`;\n  }\n\n  getDefaultLabel() {\n    const label = this.translateToSql({ useVerboseName: true });\n    return label.length < 43 ? label : `${label.substring(0, 40)}...`;\n  }\n\n  translateToSql(\n    params = { useVerboseName: false, transformCountDistinct: false },\n  ) {\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      const aggregate = this.aggregate || '';\n      // eslint-disable-next-line camelcase\n      const column =\n        params.useVerboseName && this.column?.verbose_name\n          ? `(${this.column.verbose_name})`\n          : this.column?.column_name\n          ? `(${this.column.column_name})`\n          : '';\n      // transform from `count_distinct(column)` to `count(distinct column)`\n      if (\n        params.transformCountDistinct &&\n        aggregate === AGGREGATES.COUNT_DISTINCT &&\n        /^\\(.*\\)$/.test(column)\n      ) {\n        return `COUNT(DISTINCT ${column.slice(1, -1)})`;\n      }\n      return aggregate + column;\n    }\n    if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return this.sqlExpression;\n    }\n    return '';\n  }\n\n  duplicateWith(nextFields) {\n    return new AdhocMetric({\n      ...this,\n      // all duplicate metrics are not considered new by default\n      isNew: false,\n      // but still overriddable by nextFields\n      ...nextFields,\n    });\n  }\n\n  equals(adhocMetric) {\n    return (\n      adhocMetric.label === this.label &&\n      adhocMetric.expressionType === this.expressionType &&\n      adhocMetric.sqlExpression === this.sqlExpression &&\n      adhocMetric.aggregate === this.aggregate &&\n      (adhocMetric.column && adhocMetric.column.column_name) ===\n        (this.column && this.column.column_name)\n    );\n  }\n\n  isValid() {\n    if (this.expressionType === EXPRESSION_TYPES.SIMPLE) {\n      return !!(this.column && this.aggregate);\n    }\n    if (this.expressionType === EXPRESSION_TYPES.SQL) {\n      return !!this.sqlExpression;\n    }\n    return false;\n  }\n\n  inferSqlExpressionAggregate() {\n    return inferSqlExpressionAggregate(this);\n  }\n\n  inferSqlExpressionColumn() {\n    return inferSqlExpressionColumn(this);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\n\nimport columnType from './columnType';\nimport adhocMetricType from './adhocMetricType';\nimport { StyledColumnOption } from '../../optionRenderers';\n\nconst propTypes = {\n  option: PropTypes.oneOfType([\n    columnType,\n    PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n    adhocMetricType,\n  ]).isRequired,\n};\n\nexport default function FilterDefinitionOption({ option }) {\n  if (option.saved_metric_name) {\n    return (\n      <StyledColumnOption\n        column={{ column_name: option.saved_metric_name, type: 'expression' }}\n        showType\n      />\n    );\n  }\n  if (option.column_name) {\n    return <StyledColumnOption column={option} showType />;\n  }\n  if (option.label) {\n    return (\n      <StyledColumnOption\n        column={{ column_name: option.label, type: 'expression' }}\n        showType\n      />\n    );\n  }\n  return null;\n}\nFilterDefinitionOption.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nimport { AGGREGATES } from 'src/explore/constants';\nimport columnType from './columnType';\nimport { EXPRESSION_TYPES } from './AdhocMetric';\n\nexport default PropTypes.oneOfType([\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SIMPLE]).isRequired,\n    column: columnType.isRequired,\n    aggregate: PropTypes.oneOf(Object.keys(AGGREGATES)).isRequired,\n    label: PropTypes.string.isRequired,\n  }),\n  PropTypes.shape({\n    expressionType: PropTypes.oneOf([EXPRESSION_TYPES.SQL]).isRequired,\n    sqlExpression: PropTypes.string.isRequired,\n    label: PropTypes.string.isRequired,\n  }),\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  column_name: PropTypes.string.isRequired,\n  type: PropTypes.string,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\n\nexport default PropTypes.shape({\n  metric_name: PropTypes.string.isRequired,\n  verbose_name: PropTypes.string,\n  expression: PropTypes.string.isRequired,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { css, isEqualArray, t } from '@superset-ui/core';\nimport Select from 'src/components/Select/Select';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\nconst propTypes = {\n  ariaLabel: PropTypes.string,\n  autoFocus: PropTypes.bool,\n  choices: PropTypes.array,\n  clearable: PropTypes.bool,\n  description: PropTypes.string,\n  disabled: PropTypes.bool,\n  freeForm: PropTypes.bool,\n  isLoading: PropTypes.bool,\n  multi: PropTypes.bool,\n  isMulti: PropTypes.bool,\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  onFocus: PropTypes.func,\n  value: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.array,\n  ]),\n  default: PropTypes.oneOfType([\n    PropTypes.string,\n    PropTypes.number,\n    PropTypes.array,\n  ]),\n  showHeader: PropTypes.bool,\n  optionRenderer: PropTypes.func,\n  valueKey: PropTypes.string,\n  options: PropTypes.array,\n  placeholder: PropTypes.string,\n  filterOption: PropTypes.func,\n  tokenSeparators: PropTypes.arrayOf(PropTypes.string),\n  notFoundContent: PropTypes.object,\n\n  // ControlHeader props\n  label: PropTypes.string,\n  renderTrigger: PropTypes.bool,\n  validationErrors: PropTypes.array,\n  rightNode: PropTypes.node,\n  leftNode: PropTypes.node,\n  onClick: PropTypes.func,\n  hovered: PropTypes.bool,\n  tooltipOnClick: PropTypes.func,\n  warning: PropTypes.string,\n  danger: PropTypes.string,\n};\n\nconst defaultProps = {\n  autoFocus: false,\n  choices: [],\n  clearable: true,\n  description: null,\n  disabled: false,\n  freeForm: false,\n  isLoading: false,\n  label: null,\n  multi: false,\n  onChange: () => {},\n  onFocus: () => {},\n  showHeader: true,\n  valueKey: 'value',\n};\n\nexport default class SelectControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      options: this.getOptions(props),\n    };\n    this.onChange = this.onChange.bind(this);\n    this.handleFilterOptions = this.handleFilterOptions.bind(this);\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    if (\n      !isEqualArray(nextProps.choices, this.props.choices) ||\n      !isEqualArray(nextProps.options, this.props.options)\n    ) {\n      const options = this.getOptions(nextProps);\n      this.setState({ options });\n    }\n  }\n\n  // Beware: This is acting like an on-click instead of an on-change\n  // (firing every time user chooses vs firing only if a new option is chosen).\n  onChange(val) {\n    // will eventually call `exploreReducer`: SET_FIELD_VALUE\n    const { valueKey } = this.props;\n    let onChangeVal = val;\n\n    if (Array.isArray(val)) {\n      const values = val.map(v =>\n        v?.[valueKey] !== undefined ? v[valueKey] : v,\n      );\n      onChangeVal = values;\n    }\n    if (typeof val === 'object' && val?.[valueKey] !== undefined) {\n      onChangeVal = val[valueKey];\n    }\n    this.props.onChange(onChangeVal, []);\n  }\n\n  getOptions(props) {\n    const { choices, optionRenderer, valueKey } = props;\n    let options = [];\n    if (props.options) {\n      options = props.options.map(o => ({\n        ...o,\n        value: o[valueKey],\n        label: o.label || o[valueKey],\n        customLabel: optionRenderer ? optionRenderer(o) : undefined,\n      }));\n    } else if (choices) {\n      // Accepts different formats of input\n      options = choices.map(c => {\n        if (Array.isArray(c)) {\n          const [value, label] = c.length > 1 ? c : [c[0], c[0]];\n          return {\n            value,\n            label,\n          };\n        }\n        if (Object.is(c)) {\n          return {\n            ...c,\n            value: c[valueKey],\n            label: c.label || c[valueKey],\n          };\n        }\n        return { value: c, label: c };\n      });\n    }\n    return options;\n  }\n\n  handleFilterOptions(text, option) {\n    const { filterOption } = this.props;\n    return filterOption({ data: option }, text);\n  }\n\n  render() {\n    const {\n      ariaLabel,\n      autoFocus,\n      clearable,\n      disabled,\n      filterOption,\n      freeForm,\n      isLoading,\n      isMulti,\n      label,\n      multi,\n      name,\n      placeholder,\n      onFocus,\n      optionRenderer,\n      showHeader,\n      value,\n      tokenSeparators,\n      notFoundContent,\n      // ControlHeader props\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger,\n    } = this.props;\n\n    const headerProps = {\n      name,\n      label,\n      description,\n      renderTrigger,\n      rightNode,\n      leftNode,\n      validationErrors,\n      onClick,\n      hovered,\n      tooltipOnClick,\n      warning,\n      danger,\n    };\n\n    const getValue = () => {\n      const currentValue =\n        value ||\n        (this.props.default !== undefined ? this.props.default : undefined);\n\n      // safety check - the value is intended to be undefined but null was used\n      if (\n        currentValue === null &&\n        !this.state.options.find(o => o.value === null)\n      ) {\n        return undefined;\n      }\n      return currentValue;\n    };\n\n    const selectProps = {\n      allowNewOptions: freeForm,\n      autoFocus,\n      ariaLabel:\n        ariaLabel || (typeof label === 'string' ? label : t('Select ...')),\n      allowClear: clearable,\n      disabled,\n      filterOption:\n        filterOption && typeof filterOption === 'function'\n          ? this.handleFilterOptions\n          : true,\n      header: showHeader && <ControlHeader {...headerProps} />,\n      loading: isLoading,\n      mode: isMulti || multi ? 'multiple' : 'single',\n      name: `select-${name}`,\n      onChange: this.onChange,\n      onFocus,\n      optionRenderer,\n      options: this.state.options,\n      placeholder,\n      sortComparator: this.props.sortComparator,\n      value: getValue(),\n      tokenSeparators,\n      notFoundContent,\n    };\n\n    return (\n      <div\n        css={theme => css`\n          .type-label {\n            margin-right: ${theme.gridUnit * 2}px;\n          }\n          .Select__multi-value__label > span,\n          .Select__option > span,\n          .Select__single-value > span {\n            display: flex;\n            align-items: center;\n          }\n        `}\n      >\n        <Select {...selectProps} />\n      </div>\n    );\n  }\n}\n\nSelectControl.propTypes = propTypes;\nSelectControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col } from 'src/components';\nimport { t } from '@superset-ui/core';\n\nimport Label from 'src/components/Label';\nimport Popover from 'src/components/Popover';\nimport PopoverSection from 'src/components/PopoverSection';\nimport Checkbox from 'src/components/Checkbox';\nimport ControlHeader from '../ControlHeader';\nimport SelectControl from './SelectControl';\n\nconst spatialTypes = {\n  latlong: 'latlong',\n  delimited: 'delimited',\n  geohash: 'geohash',\n};\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n  animation: PropTypes.bool,\n  choices: PropTypes.array,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  animation: true,\n  choices: [],\n};\n\nexport default class SpatialControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const v = props.value || {};\n    let defaultCol;\n    if (props.choices.length > 0) {\n      defaultCol = props.choices[0][0];\n    }\n    this.state = {\n      type: v.type || spatialTypes.latlong,\n      delimiter: v.delimiter || ',',\n      latCol: v.latCol || defaultCol,\n      lonCol: v.lonCol || defaultCol,\n      lonlatCol: v.lonlatCol || defaultCol,\n      reverseCheckbox: v.reverseCheckbox || false,\n      geohashCol: v.geohashCol || defaultCol,\n      value: null,\n      errors: [],\n    };\n    this.toggleCheckbox = this.toggleCheckbox.bind(this);\n    this.onChange = this.onChange.bind(this);\n    this.renderReverseCheckbox = this.renderReverseCheckbox.bind(this);\n  }\n\n  componentDidMount() {\n    this.onChange();\n  }\n\n  onChange() {\n    const { type } = this.state;\n    const value = { type };\n    const errors = [];\n    const errMsg = t('Invalid lat/long configuration.');\n    if (type === spatialTypes.latlong) {\n      value.latCol = this.state.latCol;\n      value.lonCol = this.state.lonCol;\n      if (!value.lonCol || !value.latCol) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.delimited) {\n      value.lonlatCol = this.state.lonlatCol;\n      value.delimiter = this.state.delimiter;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.lonlatCol || !value.delimiter) {\n        errors.push(errMsg);\n      }\n    } else if (type === spatialTypes.geohash) {\n      value.geohashCol = this.state.geohashCol;\n      value.reverseCheckbox = this.state.reverseCheckbox;\n      if (!value.geohashCol) {\n        errors.push(errMsg);\n      }\n    }\n    this.setState({ value, errors });\n    this.props.onChange(value, errors);\n  }\n\n  setType(type) {\n    this.setState({ type }, this.onChange);\n  }\n\n  toggleCheckbox() {\n    this.setState(\n      prevState => ({ reverseCheckbox: !prevState.reverseCheckbox }),\n      this.onChange,\n    );\n  }\n\n  renderLabelContent() {\n    if (this.state.errors.length > 0) {\n      return 'N/A';\n    }\n    if (this.state.type === spatialTypes.latlong) {\n      return `${this.state.lonCol} | ${this.state.latCol}`;\n    }\n    if (this.state.type === spatialTypes.delimited) {\n      return `${this.state.lonlatCol}`;\n    }\n    if (this.state.type === spatialTypes.geohash) {\n      return `${this.state.geohashCol}`;\n    }\n    return null;\n  }\n\n  renderSelect(name, type) {\n    return (\n      <SelectControl\n        ariaLabel={name}\n        name={name}\n        choices={this.props.choices}\n        value={this.state[name]}\n        clearable={false}\n        onFocus={() => {\n          this.setType(type);\n        }}\n        onChange={value => {\n          this.setState({ [name]: value }, this.onChange);\n        }}\n      />\n    );\n  }\n\n  renderReverseCheckbox() {\n    return (\n      <span>\n        {t('Reverse lat/long ')}\n        <Checkbox\n          checked={this.state.reverseCheckbox}\n          onChange={this.toggleCheckbox}\n        />\n      </span>\n    );\n  }\n\n  renderPopoverContent() {\n    return (\n      <div style={{ width: '300px' }}>\n        <PopoverSection\n          title={t('Longitude & Latitude columns')}\n          isSelected={this.state.type === spatialTypes.latlong}\n          onSelect={this.setType.bind(this, spatialTypes.latlong)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              Longitude\n              {this.renderSelect('lonCol', spatialTypes.latlong)}\n            </Col>\n            <Col xs={24} md={12}>\n              Latitude\n              {this.renderSelect('latCol', spatialTypes.latlong)}\n            </Col>\n          </Row>\n        </PopoverSection>\n        <PopoverSection\n          title={t('Delimited long & lat single column')}\n          info={t(\n            'Multiple formats accepted, look the geopy.points ' +\n              'Python library for more details',\n          )}\n          isSelected={this.state.type === spatialTypes.delimited}\n          onSelect={this.setType.bind(this, spatialTypes.delimited)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              {t('Column')}\n              {this.renderSelect('lonlatCol', spatialTypes.delimited)}\n            </Col>\n            <Col xs={24} md={12}>\n              {this.renderReverseCheckbox()}\n            </Col>\n          </Row>\n        </PopoverSection>\n        <PopoverSection\n          title={t('Geohash')}\n          isSelected={this.state.type === spatialTypes.geohash}\n          onSelect={this.setType.bind(this, spatialTypes.geohash)}\n        >\n          <Row gutter={16}>\n            <Col xs={24} md={12}>\n              Column\n              {this.renderSelect('geohashCol', spatialTypes.geohash)}\n            </Col>\n            <Col xs={24} md={12}>\n              {this.renderReverseCheckbox()}\n            </Col>\n          </Row>\n        </PopoverSection>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          content={this.renderPopoverContent()}\n          placement=\"topLeft\" // so that popover doesn't move when label changes\n          trigger=\"click\"\n        >\n          <Label className=\"pointer\">{this.renderLabelContent()}</Label>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nSpatialControl.propTypes = propTypes;\nSpatialControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { TextArea } from 'src/components/Input';\nimport { t, withTheme } from '@superset-ui/core';\n\nimport Button from 'src/components/Button';\nimport { TextAreaEditor } from 'src/components/AsyncAceEditor';\nimport ModalTrigger from 'src/components/ModalTrigger';\n\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\nconst propTypes = {\n  name: PropTypes.string,\n  onChange: PropTypes.func,\n  initialValue: PropTypes.string,\n  height: PropTypes.number,\n  minLines: PropTypes.number,\n  maxLines: PropTypes.number,\n  offerEditInModal: PropTypes.bool,\n  language: PropTypes.oneOf([\n    null,\n    'json',\n    'html',\n    'sql',\n    'markdown',\n    'javascript',\n  ]),\n  aboveEditorSection: PropTypes.node,\n  readOnly: PropTypes.bool,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  initialValue: '',\n  height: 250,\n  minLines: 3,\n  maxLines: 10,\n  offerEditInModal: true,\n  readOnly: false,\n};\n\nclass TextAreaControl extends React.Component {\n  onControlChange(event) {\n    const { value } = event.target;\n    this.props.onChange(value);\n  }\n\n  onAreaEditorChange(value) {\n    this.props.onChange(value);\n  }\n\n  renderEditor(inModal = false) {\n    const minLines = inModal ? 40 : this.props.minLines || 12;\n    if (this.props.language) {\n      const style = {\n        border: `1px solid ${this.props.theme.colors.grayscale.light1}`,\n      };\n      if (this.props.readOnly) {\n        style.backgroundColor = '#f2f2f2';\n      }\n      return (\n        <TextAreaEditor\n          mode={this.props.language}\n          style={style}\n          minLines={minLines}\n          maxLines={inModal ? 1000 : this.props.maxLines}\n          width=\"100%\"\n          height={`${minLines}em`}\n          editorProps={{ $blockScrolling: true }}\n          defaultValue={this.props.initialValue}\n          readOnly={this.props.readOnly}\n          key={this.props.name}\n          {...this.props}\n          onChange={this.onAreaEditorChange.bind(this)}\n        />\n      );\n    }\n    return (\n      <TextArea\n        placeholder={t('textarea')}\n        onChange={this.onControlChange.bind(this)}\n        defaultValue={this.props.initialValue}\n        disabled={this.props.readOnly}\n        style={{ height: this.props.height }}\n      />\n    );\n  }\n\n  renderModalBody() {\n    return (\n      <div>\n        <div>{this.props.aboveEditorSection}</div>\n        {this.renderEditor(true)}\n      </div>\n    );\n  }\n\n  render() {\n    const controlHeader = <ControlHeader {...this.props} />;\n    return (\n      <div>\n        {controlHeader}\n        {this.renderEditor()}\n        {this.props.offerEditInModal && (\n          <ModalTrigger\n            modalTitle={controlHeader}\n            triggerNode={\n              <Button buttonSize=\"small\" className=\"m-t-5\">\n                {t('Edit')} <strong>{this.props.language}</strong>{' '}\n                {t('in modal')}\n              </Button>\n            }\n            modalBody={this.renderModalBody(true)}\n            responsive\n          />\n        )}\n      </div>\n    );\n  }\n}\n\nTextAreaControl.propTypes = propTypes;\nTextAreaControl.defaultProps = defaultProps;\n\nexport default withTheme(TextAreaControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/**\n * This file exports all controls available for use in the different visualization types\n *\n * While the React components located in `controls/components` represent different\n * types of controls (CheckboxControl, SelectControl, TextControl, ...), the controls here\n * represent instances of control types, that can be reused across visualization types.\n *\n * When controls are reused across viz types, their values are carried over as a user\n * changes the chart types.\n *\n * While the keys defined in the control itself get passed to the controlType as props,\n * here's a list of the keys that are common to all controls, and as a result define the\n * control interface:\n *\n * - type: the control type, referencing a React component of the same name\n * - label: the label as shown in the control's header\n * - description: shown in the info tooltip of the control's header\n * - default: the default value when opening a new chart, or changing visualization type\n * - renderTrigger: a bool that defines whether the visualization should be re-rendered\n     when changed. This should `true` for controls that only affect the rendering (client side)\n     and don't affect the query or backend data processing as those require to re run a query\n     and fetch the data\n * - validators: an array of functions that will receive the value of the component and\n     should return error messages when the value is not valid. The error message gets\n     bubbled up to the control header, section header and query panel header.\n * - warning: text shown as a tooltip on a warning icon in the control's header\n * - error: text shown as a tooltip on a error icon in the control's header\n * - mapStateToProps: a function that receives the App's state and return an object of k/v\n     to overwrite configuration at runtime. This is useful to alter a component based on\n     anything external to it, like another control's value. For instance it's possible to\n     show a warning based on the value of another component. It's also possible to bind\n     arbitrary data from the redux store to the component this way.\n * - tabOverride: set to 'data' if you want to force a renderTrigger to show up on the `Data`\n     tab, otherwise `renderTrigger: true` components will show up on the `Style` tab.\n *\n * Note that the keys defined in controls in this file that are not listed above represent\n * props specific for the React component defined as `type`. Also note that this module work\n * in tandem with `controlPanels/index.js` that defines how controls are composed into sections for\n * each and every visualization type.\n */\nimport React from 'react';\nimport {\n  t,\n  getCategoricalSchemeRegistry,\n  getSequentialSchemeRegistry,\n  legacyValidateInteger,\n  validateNonEmpty,\n} from '@superset-ui/core';\nimport { formatSelectOptions } from 'src/explore/exploreUtils';\nimport { TIME_FILTER_LABELS } from './constants';\nimport { StyledColumnOption } from './components/optionRenderers';\n\nconst categoricalSchemeRegistry = getCategoricalSchemeRegistry();\nconst sequentialSchemeRegistry = getSequentialSchemeRegistry();\n\nexport const PRIMARY_COLOR = { r: 0, g: 122, b: 135, a: 1 };\n\n// input choices & options\nexport const D3_FORMAT_OPTIONS = [\n  ['SMART_NUMBER', 'Adaptive formatting'],\n  ['~g', 'Original value'],\n  [',d', ',d (12345.432 => 12,345)'],\n  ['.1s', '.1s (12345.432 => 10k)'],\n  ['.3s', '.3s (12345.432 => 12.3k)'],\n  [',.1%', ',.1% (12345.432 => 1,234,543.2%)'],\n  ['.3%', '.3% (12345.432 => 1234543.200%)'],\n  ['.4r', '.4r (12345.432 => 12350)'],\n  [',.3f', ',.3f (12345.432 => 12,345.432)'],\n  ['+,', '+, (12345.432 => +12,345.432)'],\n  ['$,.2f', '$,.2f (12345.432 => $12,345.43)'],\n  ['DURATION', 'Duration in ms (66000 => 1m 6s)'],\n  ['DURATION_SUB', 'Duration in ms (100.40008 => 100ms 400µs 80ns)'],\n];\n\nconst ROW_LIMIT_OPTIONS = [10, 50, 100, 250, 500, 1000, 5000, 10000, 50000];\n\nconst SERIES_LIMITS = [5, 10, 25, 50, 100, 500];\n\nexport const D3_FORMAT_DOCS =\n  'D3 format syntax: https://github.com/d3/d3-format';\n\nexport const D3_TIME_FORMAT_OPTIONS = [\n  ['smart_date', 'Adaptive formatting'],\n  ['%d/%m/%Y', '%d/%m/%Y | 14/01/2019'],\n  ['%m/%d/%Y', '%m/%d/%Y | 01/14/2019'],\n  ['%Y-%m-%d', '%Y-%m-%d | 2019-01-14'],\n  ['%Y-%m-%d %H:%M:%S', '%Y-%m-%d %H:%M:%S | 2019-01-14 01:32:10'],\n  ['%d-%m-%Y %H:%M:%S', '%Y-%m-%d %H:%M:%S | 14-01-2019 01:32:10'],\n  ['%H:%M:%S', '%H:%M:%S | 01:32:10'],\n];\n\nconst timeColumnOption = {\n  verbose_name: 'Time',\n  column_name: '__timestamp',\n  description: t(\n    'A reference to the [Time] configuration, taking granularity into ' +\n      'account',\n  ),\n};\n\nconst groupByControl = {\n  type: 'SelectControl',\n  multi: true,\n  freeForm: true,\n  label: t('Dimensions'),\n  default: [],\n  includeTime: false,\n  description: t(\n    'One or many columns to group by. High cardinality groupings should include a series limit ' +\n      'to limit the number of fetched and rendered series.',\n  ),\n  optionRenderer: c => <StyledColumnOption column={c} showType />,\n  valueKey: 'column_name',\n  filterOption: ({ data: opt }, text) =>\n    (opt.column_name &&\n      opt.column_name.toLowerCase().indexOf(text.toLowerCase()) >= 0) ||\n    (opt.verbose_name &&\n      opt.verbose_name.toLowerCase().indexOf(text.toLowerCase()) >= 0),\n  mapStateToProps: (state, control) => {\n    const newState = {};\n    if (state.datasource) {\n      newState.options = state.datasource.columns.filter(c => c.groupby);\n      if (control && control.includeTime) {\n        newState.options.push(timeColumnOption);\n      }\n    }\n    return newState;\n  },\n};\n\nconst metrics = {\n  type: 'MetricsControl',\n  multi: true,\n  label: t('Metrics'),\n  validators: [validateNonEmpty],\n  mapStateToProps: state => {\n    const { datasource } = state;\n    return {\n      columns: datasource ? datasource.columns : [],\n      savedMetrics: datasource ? datasource.metrics : [],\n      datasource,\n    };\n  },\n  description: t('One or many metrics to display'),\n};\nconst metric = {\n  ...metrics,\n  multi: false,\n  label: t('Metric'),\n  description: t('Metric'),\n};\n\nexport function columnChoices(datasource) {\n  if (datasource && datasource.columns) {\n    return datasource.columns\n      .map(col => [col.column_name, col.verbose_name || col.column_name])\n      .sort((opt1, opt2) =>\n        opt1[1].toLowerCase() > opt2[1].toLowerCase() ? 1 : -1,\n      );\n  }\n  return [];\n}\n\nexport const controls = {\n  metrics,\n\n  metric,\n\n  datasource: {\n    type: 'DatasourceControl',\n    label: t('Dataset'),\n    default: null,\n    description: null,\n    mapStateToProps: ({ datasource }) => ({\n      datasource,\n      isEditable: !!datasource,\n    }),\n  },\n\n  viz_type: {\n    type: 'VizTypeControl',\n    label: t('Visualization type'),\n    default: 'table',\n    description: t('The type of visualization to display'),\n  },\n\n  color_picker: {\n    label: t('Fixed color'),\n    description: t('Use this to define a static color for all circles'),\n    type: 'ColorPickerControl',\n    default: PRIMARY_COLOR,\n    renderTrigger: true,\n  },\n\n  metric_2: {\n    ...metric,\n    label: t('Right axis metric'),\n    clearable: true,\n    description: t('Choose a metric for right axis'),\n  },\n\n  linear_color_scheme: {\n    type: 'ColorSchemeControl',\n    label: t('Linear color scheme'),\n    choices: () =>\n      sequentialSchemeRegistry.values().map(value => [value.id, value.label]),\n    default: sequentialSchemeRegistry.getDefaultKey(),\n    clearable: false,\n    description: '',\n    renderTrigger: true,\n    schemes: () => sequentialSchemeRegistry.getMap(),\n    isLinear: true,\n  },\n\n  secondary_metric: {\n    ...metric,\n    label: t('Color metric'),\n    default: null,\n    validators: [],\n    description: t('A metric to use for color'),\n  },\n\n  groupby: groupByControl,\n\n  columns: {\n    ...groupByControl,\n    label: t('Columns'),\n    description: t('One or many controls to pivot as columns'),\n  },\n\n  druid_time_origin: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: TIME_FILTER_LABELS.druid_time_origin,\n    choices: [\n      ['', 'default'],\n      ['now', 'now'],\n    ],\n    default: null,\n    description: t(\n      'Defines the origin where time buckets start, ' +\n        'accepts natural dates as in `now`, `sunday` or `1970-01-01`',\n    ),\n  },\n\n  granularity: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: TIME_FILTER_LABELS.granularity,\n    default: 'P1D',\n    choices: [\n      [null, 'all'],\n      ['PT5S', '5 seconds'],\n      ['PT30S', '30 seconds'],\n      ['PT1M', '1 minute'],\n      ['PT5M', '5 minutes'],\n      ['PT30M', '30 minutes'],\n      ['PT1H', '1 hour'],\n      ['PT6H', '6 hour'],\n      ['P1D', '1 day'],\n      ['P7D', '7 days'],\n      ['P1W', 'week'],\n      ['week_starting_sunday', 'week starting Sunday'],\n      ['week_ending_saturday', 'week ending Saturday'],\n      ['P1M', 'month'],\n      ['P3M', 'quarter'],\n      ['P1Y', 'year'],\n    ],\n    description: t(\n      'The time granularity for the visualization. Note that you ' +\n        'can type and use simple natural language as in `10 seconds`, ' +\n        '`1 day` or `56 weeks`',\n    ),\n  },\n\n  granularity_sqla: {\n    type: 'SelectControl',\n    label: TIME_FILTER_LABELS.granularity_sqla,\n    description: t(\n      'The time column for the visualization. Note that you ' +\n        'can define arbitrary expression that return a DATETIME ' +\n        'column in the table. Also note that the ' +\n        'filter below is applied against this column or ' +\n        'expression',\n    ),\n    clearable: false,\n    optionRenderer: c => <StyledColumnOption column={c} showType />,\n    valueKey: 'column_name',\n    mapStateToProps: state => {\n      const props = {};\n      if (state.datasource) {\n        props.choices = state.datasource.granularity_sqla;\n        props.default = null;\n        if (state.datasource.main_dttm_col) {\n          props.default = state.datasource.main_dttm_col;\n        } else if (props.choices && props.choices.length > 0) {\n          props.default = props.choices[0].column_name;\n        }\n      }\n      return props;\n    },\n  },\n\n  time_grain_sqla: {\n    type: 'SelectControl',\n    label: TIME_FILTER_LABELS.time_grain_sqla,\n    default: 'P1D',\n    description: t(\n      'The time granularity for the visualization. This ' +\n        'applies a date transformation to alter ' +\n        'your time column and defines a new time granularity. ' +\n        'The options here are defined on a per database ' +\n        'engine basis in the Superset source code.',\n    ),\n    mapStateToProps: state => ({\n      choices: state.datasource ? state.datasource.time_grain_sqla : null,\n    }),\n  },\n\n  time_range: {\n    type: 'DateFilterControl',\n    freeForm: true,\n    label: TIME_FILTER_LABELS.time_range,\n    default: t('No filter'), // this value is translated, but the backend wouldn't understand a translated value?\n    description: t(\n      'The time range for the visualization. All relative times, e.g. \"Last month\", ' +\n        '\"Last 7 days\", \"now\", etc. are evaluated on the server using the server\\'s ' +\n        'local time (sans timezone). All tooltips and placeholder times are expressed ' +\n        'in UTC (sans timezone). The timestamps are then evaluated by the database ' +\n        \"using the engine's local timezone. Note one can explicitly set the timezone \" +\n        'per the ISO 8601 format if specifying either the start and/or end time.',\n    ),\n  },\n\n  row_limit: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Row limit'),\n    validators: [legacyValidateInteger],\n    default: 10000,\n    choices: formatSelectOptions(ROW_LIMIT_OPTIONS),\n    description: t('Limits the number of rows that get displayed.'),\n  },\n\n  limit: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Series limit'),\n    validators: [legacyValidateInteger],\n    choices: formatSelectOptions(SERIES_LIMITS),\n    clearable: true,\n    description: t(\n      'Limits the number of series that get displayed. A joined subquery (or an extra phase ' +\n        'where subqueries are not supported) is applied to limit the number of series that get ' +\n        'fetched and rendered. This feature is useful when grouping by high cardinality ' +\n        'column(s) though does increase the query complexity and cost.',\n    ),\n  },\n\n  timeseries_limit_metric: {\n    type: 'MetricsControl',\n    label: t('Sort by'),\n    default: null,\n    clearable: true,\n    description: t(\n      'Metric used to define how the top series are sorted if a series or row limit is present. ' +\n        'If undefined reverts to the first metric (where appropriate).',\n    ),\n    mapStateToProps: state => ({\n      columns: state.datasource ? state.datasource.columns : [],\n      savedMetrics: state.datasource ? state.datasource.metrics : [],\n      datasource: state.datasource,\n    }),\n  },\n\n  series: {\n    ...groupByControl,\n    label: t('Dimensions'),\n    multi: false,\n    default: null,\n    description: t(\n      'Defines the grouping of entities. ' +\n        'Each series is shown as a specific color on the chart and ' +\n        'has a legend toggle',\n    ),\n  },\n\n  entity: {\n    ...groupByControl,\n    label: t('Entity'),\n    default: null,\n    multi: false,\n    validators: [validateNonEmpty],\n    description: t('This defines the element to be plotted on the chart'),\n  },\n\n  x: {\n    ...metric,\n    label: t('X Axis'),\n    description: t('Metric assigned to the [X] axis'),\n    default: null,\n  },\n\n  y: {\n    ...metric,\n    label: t('Y Axis'),\n    default: null,\n    description: t('Metric assigned to the [Y] axis'),\n  },\n\n  size: {\n    ...metric,\n    label: t('Bubble size'),\n    default: null,\n  },\n\n  y_axis_format: {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Y Axis Format'),\n    renderTrigger: true,\n    default: 'SMART_NUMBER',\n    choices: D3_FORMAT_OPTIONS,\n    description: D3_FORMAT_DOCS,\n    mapStateToProps: state => {\n      const showWarning =\n        state.controls &&\n        state.controls.comparison_type &&\n        state.controls.comparison_type.value === 'percentage';\n      return {\n        warning: showWarning\n          ? t(\n              'When `Calculation type` is set to \"Percentage change\", the Y ' +\n                'Axis Format is forced to `.1%`',\n            )\n          : null,\n        disabled: showWarning,\n      };\n    },\n  },\n\n  adhoc_filters: {\n    type: 'AdhocFilterControl',\n    label: t('Filters'),\n    default: null,\n    description: '',\n    mapStateToProps: state => ({\n      columns: state.datasource\n        ? state.datasource.columns.filter(c => c.filterable)\n        : [],\n      savedMetrics: state.datasource ? state.datasource.metrics : [],\n      datasource: state.datasource,\n    }),\n  },\n\n  color_scheme: {\n    type: 'ColorSchemeControl',\n    label: t('Color scheme'),\n    default: categoricalSchemeRegistry.getDefaultKey(),\n    renderTrigger: true,\n    choices: () => categoricalSchemeRegistry.keys().map(s => [s, s]),\n    description: t('The color scheme for rendering chart'),\n    schemes: () => categoricalSchemeRegistry.getMap(),\n  },\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { getChartControlPanelRegistry } from '@superset-ui/core';\nimport { getAllControlsState, getFormDataFromControls } from './controlUtils';\nimport { controls } from './controls';\n\nfunction handleDeprecatedControls(formData) {\n  // Reacffectation / handling of deprecated controls\n  /* eslint-disable no-param-reassign */\n\n  // y_axis_zero was a boolean forcing 0 to be part of the Y Axis\n  if (formData.y_axis_zero) {\n    formData.y_axis_bounds = [0, null];\n  }\n}\n\nexport function getControlsState(state, inputFormData) {\n  /*\n   * Gets a new controls object to put in the state. The controls object\n   * is similar to the configuration control with only the controls\n   * related to the current viz_type, materializes mapStateToProps functions,\n   * adds value keys coming from inputFormData passed here. This can't be an action creator\n   * just yet because it's used in both the explore and dashboard views.\n   * */\n  // Getting a list of active control names for the current viz\n  const formData = { ...inputFormData };\n  const vizType =\n    formData.viz_type || state.common.conf.DEFAULT_VIZ_TYPE || 'table';\n\n  handleDeprecatedControls(formData);\n\n  const controlsState = getAllControlsState(\n    vizType,\n    state.datasource.type,\n    state,\n    formData,\n  );\n\n  const controlPanelConfig = getChartControlPanelRegistry().get(vizType) || {};\n  if (controlPanelConfig.onInit) {\n    return controlPanelConfig.onInit(controlsState);\n  }\n\n  return controlsState;\n}\n\nexport function applyDefaultFormData(inputFormData) {\n  const datasourceType = inputFormData.datasource.split('__')[1];\n  const vizType = inputFormData.viz_type;\n  const controlsState = getAllControlsState(\n    vizType,\n    datasourceType,\n    null,\n    inputFormData,\n  );\n  const controlFormData = getFormDataFromControls(controlsState);\n\n  const formData = {};\n  Object.keys(controlsState)\n    .concat(Object.keys(inputFormData))\n    .forEach(controlName => {\n      if (inputFormData[controlName] === undefined) {\n        formData[controlName] = controlFormData[controlName];\n      } else {\n        formData[controlName] = inputFormData[controlName];\n      }\n    });\n\n  return formData;\n}\n\nconst defaultControls = { ...controls };\nObject.keys(controls).forEach(f => {\n  defaultControls[f].value = controls[f].default;\n});\n\nconst defaultState = {\n  controls: defaultControls,\n  form_data: getFormDataFromControls(defaultControls),\n};\n\nexport { defaultControls, defaultState };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nfunction extractTypes(metadata) {\n  return Object.keys(metadata).reduce((prev, key) => {\n    const result = prev;\n    result[key] = key;\n    return result;\n  }, {});\n}\n\nexport const ANNOTATION_TYPES_METADATA = {\n  FORMULA: {\n    value: 'FORMULA',\n    label: 'Formula',\n  },\n  EVENT: {\n    value: 'EVENT',\n    label: 'Event',\n    supportNativeSource: true,\n  },\n  INTERVAL: {\n    value: 'INTERVAL',\n    label: 'Interval',\n    supportNativeSource: true,\n  },\n  TIME_SERIES: {\n    value: 'TIME_SERIES',\n    label: 'Time series',\n  },\n};\n\nexport const ANNOTATION_TYPES = extractTypes(ANNOTATION_TYPES_METADATA);\n\nexport const DEFAULT_ANNOTATION_TYPE = ANNOTATION_TYPES.FORMULA;\n\nexport const ANNOTATION_SOURCE_TYPES_METADATA = {\n  NATIVE: {\n    value: 'NATIVE',\n    label: 'Superset annotation',\n  },\n};\n\nexport const ANNOTATION_SOURCE_TYPES = extractTypes(\n  ANNOTATION_SOURCE_TYPES_METADATA,\n);\n\nexport function requiresQuery(annotationSourceType) {\n  return !!annotationSourceType;\n}\n\nconst NATIVE_COLUMN_NAMES = {\n  timeColumn: 'start_dttm',\n  intervalEndColumn: 'end_dttm',\n  titleColumn: 'short_descr',\n  descriptionColumns: ['long_descr'],\n};\n\nexport function applyNativeColumns(annotation) {\n  if (annotation.sourceType === ANNOTATION_SOURCE_TYPES.NATIVE) {\n    return { ...annotation, ...NATIVE_COLUMN_NAMES };\n  }\n  return annotation;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useRef,\n  useEffect,\n  Component,\n  FunctionComponent,\n  ReactElement,\n  RefObject,\n} from 'react';\nimport {\n  ListChildComponentProps,\n  FixedSizeList as WindowedList,\n} from 'react-window';\nimport {\n  OptionTypeBase,\n  OptionProps,\n  MenuListComponentProps,\n} from 'react-select';\nimport { ThemeConfig } from '../styles';\n\nexport type WindowedMenuListProps = {\n  selectProps: {\n    windowListRef?: RefObject<WindowedList>;\n    optionHeight?: number;\n  };\n};\n\n/**\n * MenuListComponentProps should always have `children` elements, as guaranteed\n * by https://github.com/JedWatson/react-select/blob/32ad5c040bdd96cd1ca71010c2558842d684629c/packages/react-select/src/Select.js#L1686-L1719\n *\n * `children` may also be `Component<NoticeProps<OptionType>>` if options are not\n * provided (e.g., when async list is still loading, or no results), but that's\n * not possible because this MenuList will only be rendered when\n * optionsLength > windowThreshold.\n *\n * If may also be `Component<GroupProps<OptionType>>[]` but we are not supporting\n * grouped options just yet.\n */\n\ntype MenuListPropsChildren<OptionType> =\n  | Component<OptionProps<OptionType>>[]\n  | ReactElement[];\n\nexport type MenuListProps<OptionType extends OptionTypeBase> =\n  MenuListComponentProps<OptionType> & {\n    children: MenuListPropsChildren<OptionType>;\n    // theme is not present with built-in @types/react-select, but is actually\n    // available via CommonProps.\n    theme?: ThemeConfig;\n    className?: string;\n  } & WindowedMenuListProps;\n\nconst DEFAULT_OPTION_HEIGHT = 30;\n\n/**\n * Get the index of the last selected option.\n */\nfunction getLastSelected(children: MenuListPropsChildren<any>) {\n  return Array.isArray(children)\n    ? children.findIndex(\n        ({ props: { isFocused = false } = {} }) => isFocused,\n      ) || 0\n    : -1;\n}\n\n/**\n * Calculate probable option height as set in theme configs\n */\nfunction detectHeight({ spacing: { baseUnit, lineHeight } }: ThemeConfig) {\n  // Option item expects 2 * baseUnit for each of top and bottom padding.\n  return baseUnit * 4 + lineHeight;\n}\n\nexport default function WindowedMenuList<OptionType extends OptionTypeBase>({\n  children,\n  ...props\n}: MenuListProps<OptionType>) {\n  const {\n    maxHeight,\n    selectProps,\n    theme,\n    getStyles,\n    cx,\n    innerRef,\n    isMulti,\n    className,\n  } = props;\n  const {\n    // Expose react-window VariableSizeList instance and HTML elements\n    windowListRef: windowListRef_,\n    windowListInnerRef,\n  } = selectProps;\n  const defaultWindowListRef = useRef<WindowedList>(null);\n  const windowListRef = windowListRef_ || defaultWindowListRef;\n\n  // try get default option height from theme configs\n  let { optionHeight } = selectProps;\n  if (!optionHeight) {\n    optionHeight = theme ? detectHeight(theme) : DEFAULT_OPTION_HEIGHT;\n  }\n\n  const itemCount = children.length;\n  const totalHeight = optionHeight * itemCount;\n\n  const Row: FunctionComponent<ListChildComponentProps> = ({\n    data,\n    index,\n    style,\n  }) => <div style={style}>{data[index]}</div>;\n\n  useEffect(() => {\n    const lastSelected = getLastSelected(children);\n    if (windowListRef.current && lastSelected) {\n      windowListRef.current.scrollToItem(lastSelected);\n    }\n  }, [children, windowListRef]);\n\n  return (\n    <WindowedList\n      css={getStyles('menuList', props)}\n      className={cx(\n        {\n          'menu-list': true,\n          'menu-list--is-multi': isMulti,\n        },\n        className,\n      )}\n      ref={windowListRef}\n      outerRef={innerRef}\n      innerRef={windowListInnerRef}\n      height={Math.min(totalHeight, maxHeight)}\n      width=\"100%\"\n      itemData={children}\n      itemCount={children.length}\n      itemSize={optionHeight}\n    >\n      {Row}\n    </WindowedList>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ComponentType,\n  FunctionComponent,\n  ReactElement,\n  forwardRef,\n} from 'react';\nimport Select, {\n  Props as SelectProps,\n  OptionTypeBase,\n  MenuListComponentProps,\n  components as defaultComponents,\n} from 'react-select';\nimport WindowedMenuList, { WindowedMenuListProps } from './WindowedMenuList';\n\nconst { MenuList: DefaultMenuList } = defaultComponents;\n\nexport const DEFAULT_WINDOW_THRESHOLD = 100;\n\nexport type WindowedSelectProps<OptionType extends OptionTypeBase> =\n  SelectProps<OptionType> & {\n    windowThreshold?: number;\n  } & WindowedMenuListProps['selectProps'];\n\nexport type WindowedSelectComponentType<OptionType extends OptionTypeBase> =\n  FunctionComponent<WindowedSelectProps<OptionType>>;\n\nexport function MenuList<OptionType extends OptionTypeBase>({\n  children,\n  ...props\n}: MenuListComponentProps<OptionType> & {\n  selectProps: WindowedSelectProps<OptionType>;\n}) {\n  const { windowThreshold = DEFAULT_WINDOW_THRESHOLD } = props.selectProps;\n  if (Array.isArray(children) && children.length > windowThreshold) {\n    return (\n      <WindowedMenuList {...props}>\n        {children as ReactElement[]}\n      </WindowedMenuList>\n    );\n  }\n  return <DefaultMenuList {...props}>{children}</DefaultMenuList>;\n}\n\n/**\n * Add \"windowThreshold\" option to a react-select component, turn the options\n * list into a virtualized list when appropriate.\n *\n * @param SelectComponent the React component to render Select\n */\nexport default function windowed<OptionType extends OptionTypeBase>(\n  SelectComponent: ComponentType<SelectProps<OptionType>>,\n): WindowedSelectComponentType<OptionType> {\n  function WindowedSelect(\n    props: WindowedSelectProps<OptionType>,\n    ref: React.RefObject<Select<OptionType>>,\n  ) {\n    const { components: components_ = {}, ...restProps } = props;\n    const components = { ...components_, MenuList };\n    return <SelectComponent components={components} ref={ref} {...restProps} />;\n  }\n  return forwardRef(WindowedSelect);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport Select from 'react-select';\nimport Creatable from 'react-select/creatable';\nimport AsyncCreatable from 'react-select/async-creatable';\nimport windowed from './windowed';\n\nexport * from './windowed';\n\nexport const WindowedSelect = windowed(Select);\nexport const WindowedCreatableSelect = windowed(Creatable);\nexport const WindowedAsyncCreatableSelect = windowed(AsyncCreatable);\nexport default WindowedSelect;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// Deprecated component\n/* eslint-disable theme-colors/no-literal-colors */\n\nimport React, { CSSProperties, ComponentType, ReactNode } from 'react';\nimport { SerializedStyles } from '@emotion/react';\nimport { SupersetTheme, css } from '@superset-ui/core';\nimport {\n  Styles,\n  Theme,\n  SelectComponentsConfig,\n  components as defaultComponents,\n  InputProps as ReactSelectInputProps,\n  Props as SelectProps,\n} from 'react-select';\nimport type { colors as reactSelectColors } from 'react-select/src/theme';\nimport type { DeepNonNullable } from 'react-select/src/components';\nimport { OptionType } from 'antd/lib/select';\nimport { SupersetStyledSelectProps } from './DeprecatedSelect';\n\nexport const DEFAULT_CLASS_NAME = 'Select';\nexport const DEFAULT_CLASS_NAME_PREFIX = 'Select';\n\ntype RecursivePartial<T> = {\n  [P in keyof T]?: RecursivePartial<T[P]>;\n};\n\nconst colors = (theme: SupersetTheme) => ({\n  primary: theme.colors.success.base,\n  danger: theme.colors.error.base,\n  warning: theme.colors.warning.base,\n  indicator: theme.colors.info.base,\n  almostBlack: theme.colors.grayscale.dark1,\n  grayDark: theme.colors.grayscale.dark1,\n  grayLight: theme.colors.grayscale.light2,\n  gray: theme.colors.grayscale.light1,\n  grayBg: theme.colors.grayscale.light4,\n  grayBgDarker: theme.colors.grayscale.light3,\n  grayBgDarkest: theme.colors.grayscale.light2,\n  grayHeading: theme.colors.grayscale.light1,\n  menuHover: theme.colors.grayscale.light3,\n  lightest: theme.colors.grayscale.light5,\n  darkest: theme.colors.grayscale.dark2,\n  grayBorder: theme.colors.grayscale.light2,\n  grayBorderLight: theme.colors.grayscale.light3,\n  grayBorderDark: theme.colors.grayscale.light1,\n  textDefault: theme.colors.grayscale.dark1,\n  textDarkest: theme.colors.grayscale.dark2,\n  dangerLight: theme.colors.error.light1,\n});\n\nexport type ThemeConfig = {\n  borderRadius: number;\n  // z-index for menu dropdown\n  // (the same as `@z-index-above-dashboard-charts + 1` in variables.less)\n  zIndex: number;\n  colors: {\n    // add known colors\n    [key in keyof typeof reactSelectColors]: string;\n  } & {\n    [key in keyof ReturnType<typeof colors>]: string;\n  } & {\n    [key: string]: string; // any other colors\n  };\n  spacing: Theme['spacing'] & {\n    // line height and font size must be pixels for easier computation\n    // of option item height in WindowedMenuList\n    lineHeight: number;\n    fontSize: number;\n    // other relative size must be string\n    minWidth: string;\n  };\n};\n\nexport type PartialThemeConfig = RecursivePartial<ThemeConfig>;\n\nexport const defaultTheme: (theme: SupersetTheme) => PartialThemeConfig =\n  theme => ({\n    borderRadius: theme.borderRadius,\n    zIndex: 11,\n    colors: colors(theme),\n    spacing: {\n      baseUnit: 3,\n      menuGutter: 0,\n      controlHeight: 34,\n      lineHeight: 19,\n      fontSize: 14,\n      minWidth: '6.5em',\n    },\n    weights: theme.typography.weights,\n  });\n\n// let styles accept serialized CSS, too\ntype CSSStyles = CSSProperties | SerializedStyles;\ntype styleFnWithSerializedStyles = (\n  base: CSSProperties,\n  state: any,\n) => CSSStyles | CSSStyles[];\n\nexport type StylesConfig = {\n  [key in keyof Styles]: styleFnWithSerializedStyles;\n};\nexport type PartialStylesConfig = Partial<StylesConfig>;\n\nexport const DEFAULT_STYLES: PartialStylesConfig = {\n  container: (\n    provider,\n    {\n      theme: {\n        spacing: { minWidth },\n      },\n    },\n  ) => [\n    provider,\n    css`\n      min-width: ${minWidth};\n    `,\n  ],\n  placeholder: provider => [\n    provider,\n    css`\n      white-space: nowrap;\n    `,\n  ],\n  indicatorSeparator: () => css`\n    display: none;\n  `,\n  indicatorsContainer: provider => [\n    provider,\n    css`\n      i {\n        width: 1em;\n        display: inline-block;\n      }\n    `,\n  ],\n  clearIndicator: provider => [\n    provider,\n    css`\n      padding: 4px 0 4px 6px;\n    `,\n  ],\n  control: (\n    provider,\n    { isFocused, menuIsOpen, theme: { borderRadius, colors } },\n  ) => {\n    const isPseudoFocused = isFocused && !menuIsOpen;\n    let borderColor = colors.grayBorder;\n    if (isPseudoFocused || menuIsOpen) {\n      borderColor = colors.grayBorderDark;\n    }\n    return [\n      provider,\n      css`\n        border-color: ${borderColor};\n        box-shadow: ${isPseudoFocused\n          ? 'inset 0 1px 1px rgba(0,0,0,.075), 0 0 0 3px rgba(0,0,0,.1)'\n          : 'none'};\n        border-radius: ${menuIsOpen\n          ? `${borderRadius}px ${borderRadius}px 0 0`\n          : `${borderRadius}px`};\n        &:hover {\n          border-color: ${borderColor};\n          box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);\n        }\n        flex-wrap: nowrap;\n        padding-left: 1px;\n      `,\n    ];\n  },\n  menu: (provider, { theme: { zIndex } }) => [\n    provider,\n    css`\n      padding-bottom: 2em;\n      z-index: ${zIndex}; /* override at least multi-page pagination */\n      width: auto;\n      min-width: 100%;\n      max-width: 80vw;\n      background: none;\n      box-shadow: none;\n      border: 0;\n    `,\n  ],\n  menuList: (provider, { theme: { borderRadius, colors } }) => [\n    provider,\n    css`\n      background: ${colors.lightest};\n      border-radius: 0 0 ${borderRadius}px ${borderRadius}px;\n      border: 1px solid ${colors.grayBorderDark};\n      box-shadow: 0 1px 0 rgba(0, 0, 0, 0.06);\n      margin-top: -1px;\n      border-top-color: ${colors.grayBorderLight};\n      min-width: 100%;\n      width: auto;\n      border-radius: 0 0 ${borderRadius}px ${borderRadius}px;\n      padding-top: 0;\n      padding-bottom: 0;\n    `,\n  ],\n  option: (\n    provider,\n    {\n      isDisabled,\n      isFocused,\n      isSelected,\n      theme: {\n        colors,\n        spacing: { lineHeight, fontSize },\n        weights,\n      },\n    },\n  ) => {\n    let color = colors.textDefault;\n    let backgroundColor = colors.lightest;\n    if (isFocused) {\n      backgroundColor = colors.grayBgDarker;\n    } else if (isDisabled) {\n      color = '#ccc';\n    }\n    return [\n      provider,\n      css`\n        cursor: pointer;\n        line-height: ${lineHeight}px;\n        font-size: ${fontSize}px;\n        background-color: ${backgroundColor};\n        color: ${color};\n        font-weight: ${isSelected ? weights.bold : weights.normal};\n        white-space: nowrap;\n        &:hover:active {\n          background-color: ${colors.grayBg};\n        }\n      `,\n    ];\n  },\n  valueContainer: (\n    provider,\n    {\n      isMulti,\n      hasValue,\n      theme: {\n        spacing: { baseUnit },\n      },\n    },\n  ) => [\n    provider,\n    css`\n      padding-left: ${isMulti && hasValue ? 1 : baseUnit * 3}px;\n    `,\n  ],\n  multiValueLabel: (\n    provider,\n    {\n      theme: {\n        spacing: { baseUnit },\n      },\n    },\n  ) => ({\n    ...provider,\n    paddingLeft: baseUnit * 1.2,\n    paddingRight: baseUnit * 1.2,\n  }),\n  input: (provider, { selectProps }) => [\n    provider,\n    css`\n      margin-left: 0;\n      vertical-align: middle;\n      ${selectProps?.isMulti && selectProps?.value?.length\n        ? 'padding: 0 6px; width: 100%'\n        : 'padding: 0; flex: 1 1 auto;'};\n    `,\n  ],\n  menuPortal: base => ({\n    ...base,\n    zIndex: 1030, // must be same or higher of antd popover\n  }),\n};\n\nconst INPUT_TAG_BASE_STYLES = {\n  background: 'none',\n  border: 'none',\n  outline: 'none',\n  padding: 0,\n};\n\nexport type SelectComponentsType = Omit<\n  SelectComponentsConfig<any>,\n  'Input'\n> & {\n  Input: ComponentType<InputProps>;\n};\n\n// react-select is missing selectProps from their props type\n// so overwriting it here to avoid errors\nexport type InputProps = ReactSelectInputProps & {\n  placeholder?: ReactNode;\n  selectProps: SelectProps;\n  autoComplete?: string;\n  onPaste?: SupersetStyledSelectProps<OptionType>['onPaste'];\n  inputStyle?: object;\n};\n\nconst { ClearIndicator, DropdownIndicator, Option, Input, SelectContainer } =\n  defaultComponents as Required<DeepNonNullable<SelectComponentsType>>;\n\nexport const DEFAULT_COMPONENTS: SelectComponentsType = {\n  SelectContainer: ({ children, ...props }) => {\n    const {\n      selectProps: { assistiveText },\n    } = props;\n    return (\n      <div>\n        <SelectContainer {...props}>{children}</SelectContainer>\n        {assistiveText && (\n          <span\n            css={(theme: SupersetTheme) => ({\n              marginLeft: 3,\n              fontSize: theme.typography.sizes.s,\n              color: theme.colors.grayscale.light1,\n            })}\n          >\n            {assistiveText}\n          </span>\n        )}\n      </div>\n    );\n  },\n  Option: ({ children, innerProps, data, ...props }) => (\n    <Option\n      {...props}\n      data={data}\n      css={data?.style ? data.style : null}\n      innerProps={innerProps}\n    >\n      {children}\n    </Option>\n  ),\n  ClearIndicator: props => (\n    <ClearIndicator {...props}>\n      <i className=\"fa\">×</i>\n    </ClearIndicator>\n  ),\n  DropdownIndicator: props => (\n    <DropdownIndicator {...props}>\n      <i\n        className={`fa fa-caret-${\n          props.selectProps.menuIsOpen ? 'up' : 'down'\n        }`}\n      />\n    </DropdownIndicator>\n  ),\n  Input: (props: InputProps) => {\n    const { getStyles } = props;\n    return (\n      <Input\n        {...props}\n        css={getStyles('input', props)}\n        autoComplete=\"chrome-off\"\n        inputStyle={INPUT_TAG_BASE_STYLES}\n      />\n    );\n  },\n};\n\nexport const VALUE_LABELED_STYLES: PartialStylesConfig = {\n  valueContainer: (\n    provider,\n    {\n      getValue,\n      theme: {\n        spacing: { baseUnit },\n      },\n      isMulti,\n    },\n  ) => ({\n    ...provider,\n    paddingLeft: getValue().length > 0 ? 1 : baseUnit * 3,\n    overflow: isMulti && getValue().length > 0 ? 'visible' : 'hidden',\n  }),\n  // render single value as is they are multi-value\n  singleValue: (provider, props) => {\n    const { getStyles } = props;\n    return {\n      ...getStyles('multiValue', props),\n      '.metric-option': getStyles('multiValueLabel', props),\n    };\n  },\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { SyntheticEvent, MutableRefObject, ComponentType } from 'react';\nimport { merge } from 'lodash';\nimport BasicSelect, {\n  OptionTypeBase,\n  MultiValueProps,\n  FormatOptionLabelMeta,\n  ValueType,\n  SelectComponentsConfig,\n  components as defaultComponents,\n  createFilter,\n  Props as SelectProps,\n} from 'react-select';\nimport Async from 'react-select/async';\nimport Creatable from 'react-select/creatable';\nimport AsyncCreatable from 'react-select/async-creatable';\n\nimport type { SelectComponents } from 'react-select/src/components';\nimport {\n  SortableContainer,\n  SortableElement,\n  SortableContainerProps,\n} from 'react-sortable-hoc';\nimport arrayMove from 'array-move';\nimport { useTheme } from '@superset-ui/core';\nimport {\n  WindowedSelectComponentType,\n  WindowedSelectProps,\n  WindowedSelect,\n  WindowedCreatableSelect,\n  WindowedAsyncCreatableSelect,\n} from './WindowedSelect';\nimport {\n  DEFAULT_CLASS_NAME,\n  DEFAULT_CLASS_NAME_PREFIX,\n  DEFAULT_STYLES,\n  DEFAULT_COMPONENTS,\n  VALUE_LABELED_STYLES,\n  PartialThemeConfig,\n  PartialStylesConfig,\n  SelectComponentsType,\n  InputProps,\n  defaultTheme,\n} from './styles';\nimport { findValue } from './utils';\n\ntype AnyReactSelect<OptionType extends OptionTypeBase> =\n  | BasicSelect<OptionType>\n  | Async<OptionType>\n  | Creatable<OptionType>\n  | AsyncCreatable<OptionType>;\n\nexport type SupersetStyledSelectProps<\n  OptionType extends OptionTypeBase,\n  T extends WindowedSelectProps<OptionType> = WindowedSelectProps<OptionType>,\n> = T & {\n  // additional props for easier usage or backward compatibility\n  labelKey?: string;\n  valueKey?: string;\n  assistiveText?: string;\n  multi?: boolean;\n  clearable?: boolean;\n  sortable?: boolean;\n  ignoreAccents?: boolean;\n  creatable?: boolean;\n  selectRef?:\n    | React.RefCallback<AnyReactSelect<OptionType>>\n    | MutableRefObject<AnyReactSelect<OptionType>>;\n  getInputValue?: (selectBalue: ValueType<OptionType>) => string | undefined;\n  optionRenderer?: (option: OptionType) => React.ReactNode;\n  valueRenderer?: (option: OptionType) => React.ReactNode;\n  valueRenderedAsLabel?: boolean;\n  // callback for paste event\n  onPaste?: (e: SyntheticEvent) => void;\n  forceOverflow?: boolean;\n  // for simplier theme overrides\n  themeConfig?: PartialThemeConfig;\n  stylesConfig?: PartialStylesConfig;\n};\n\nfunction styled<\n  OptionType extends OptionTypeBase,\n  SelectComponentType extends\n    | WindowedSelectComponentType<OptionType>\n    | ComponentType<\n        SelectProps<OptionType>\n      > = WindowedSelectComponentType<OptionType>,\n>(SelectComponent: SelectComponentType) {\n  type SelectProps = SupersetStyledSelectProps<OptionType>;\n  type Components = SelectComponents<OptionType>;\n\n  const SortableSelectComponent = SortableContainer(SelectComponent, {\n    withRef: true,\n  });\n\n  // default components for the given OptionType\n  const supersetDefaultComponents: SelectComponentsConfig<OptionType> =\n    DEFAULT_COMPONENTS;\n\n  const getSortableMultiValue = (MultiValue: Components['MultiValue']) =>\n    SortableElement((props: MultiValueProps<OptionType>) => {\n      const onMouseDown = (e: SyntheticEvent) => {\n        e.preventDefault();\n        e.stopPropagation();\n      };\n      const innerProps = { onMouseDown };\n      return <MultiValue {...props} innerProps={innerProps} />;\n    });\n\n  /**\n   * Superset styled `Select` component. Apply Superset themed stylesheets and\n   * consolidate props API for backward compatibility with react-select v1.\n   */\n  function StyledSelect(selectProps: SelectProps) {\n    let stateManager: AnyReactSelect<OptionType>; // reference to react-select StateManager\n    const {\n      // additional props for Superset Select\n      selectRef,\n      labelKey = 'label',\n      valueKey = 'value',\n      themeConfig,\n      stylesConfig = {},\n      optionRenderer,\n      valueRenderer,\n      // whether value is rendered as `option-label` in input,\n      // useful for AdhocMetric and AdhocFilter\n      valueRenderedAsLabel: valueRenderedAsLabel_,\n      onPaste,\n      multi = false, // same as `isMulti`, used for backward compatibility\n      clearable, // same as `isClearable`\n      sortable = true, // whether to enable drag & drop sorting\n      forceOverflow, // whether the dropdown should be forcefully overflowing\n\n      // react-select props\n      className = DEFAULT_CLASS_NAME,\n      classNamePrefix = DEFAULT_CLASS_NAME_PREFIX,\n      options,\n      value: value_,\n      components: components_,\n      isMulti: isMulti_,\n      isClearable: isClearable_,\n      minMenuHeight = 100, // apply different defaults\n      maxMenuHeight = 220,\n      filterOption,\n      ignoreAccents = false, // default is `true`, but it is slow\n\n      getOptionValue = option =>\n        typeof option === 'string' ? option : option[valueKey],\n\n      getOptionLabel = option =>\n        typeof option === 'string'\n          ? option\n          : option[labelKey] || option[valueKey],\n\n      formatOptionLabel = (\n        option: OptionType,\n        { context }: FormatOptionLabelMeta<OptionType>,\n      ) => {\n        if (context === 'value') {\n          return valueRenderer ? valueRenderer(option) : getOptionLabel(option);\n        }\n        return optionRenderer ? optionRenderer(option) : getOptionLabel(option);\n      },\n\n      ...restProps\n    } = selectProps;\n\n    // `value` may be rendered values (strings), we want option objects\n    const value: OptionType[] = findValue(value_, options || [], valueKey);\n\n    // Add backward compability to v1 API\n    const isMulti = isMulti_ === undefined ? multi : isMulti_;\n    const isClearable = isClearable_ === undefined ? clearable : isClearable_;\n\n    // Sort is only applied when there are multiple selected values\n    const shouldAllowSort =\n      isMulti && sortable && Array.isArray(value) && value.length > 1;\n\n    const MaybeSortableSelect = shouldAllowSort\n      ? SortableSelectComponent\n      : SelectComponent;\n    const components = { ...supersetDefaultComponents, ...components_ };\n\n    // Make multi-select sortable as per https://react-select.netlify.app/advanced\n    if (shouldAllowSort) {\n      components.MultiValue = getSortableMultiValue(\n        components.MultiValue || defaultComponents.MultiValue,\n      );\n\n      const sortableContainerProps: Partial<SortableContainerProps> = {\n        getHelperDimensions: ({ node }) => node.getBoundingClientRect(),\n        axis: 'xy',\n        onSortEnd: ({ oldIndex, newIndex }) => {\n          const newValue = arrayMove(value, oldIndex, newIndex);\n          if (restProps.onChange) {\n            restProps.onChange(newValue, { action: 'set-value' });\n          }\n        },\n        distance: 4,\n      };\n      Object.assign(restProps, sortableContainerProps);\n    }\n\n    // When values are rendered as labels, adjust valueContainer padding\n    const valueRenderedAsLabel =\n      valueRenderedAsLabel_ === undefined ? isMulti : valueRenderedAsLabel_;\n    if (valueRenderedAsLabel && !stylesConfig.valueContainer) {\n      Object.assign(stylesConfig, VALUE_LABELED_STYLES);\n    }\n\n    // Handle onPaste event\n    if (onPaste) {\n      const Input =\n        (components.Input as SelectComponentsType['Input']) ||\n        (defaultComponents.Input as SelectComponentsType['Input']);\n      components.Input = (props: InputProps) => (\n        <Input {...props} onPaste={onPaste} />\n      );\n    }\n    // for CreaTable\n    if (SelectComponent === WindowedCreatableSelect) {\n      restProps.getNewOptionData = (inputValue: string, label: string) => ({\n        label: label || inputValue,\n        [valueKey]: inputValue,\n        isNew: true,\n      });\n    }\n\n    // handle forcing dropdown overflow\n    // use only when setting overflow:visible isn't possible on the container element\n    if (forceOverflow) {\n      Object.assign(restProps, {\n        closeMenuOnScroll: (e: Event) => {\n          // ensure menu is open\n          const menuIsOpen = (stateManager as BasicSelect<OptionType>)?.state\n            ?.menuIsOpen;\n          const target = e.target as HTMLElement;\n          return (\n            menuIsOpen &&\n            target &&\n            !target.classList?.contains('Select__menu-list')\n          );\n        },\n        menuPosition: 'fixed',\n      });\n    }\n\n    // Make sure always return StateManager for the refs.\n    // To get the real `Select` component, keep tap into `obj.select`:\n    //   - for normal <Select /> component: StateManager -> Select,\n    //   - for <Creatable />: StateManager -> Creatable -> Select\n    const setRef = (instance: any) => {\n      stateManager =\n        shouldAllowSort && instance && 'refs' in instance\n          ? instance.refs.wrappedInstance // obtain StateManger from SortableContainer\n          : instance;\n      if (typeof selectRef === 'function') {\n        selectRef(stateManager);\n      } else if (selectRef && 'current' in selectRef) {\n        selectRef.current = stateManager;\n      }\n    };\n\n    const theme = useTheme();\n\n    return (\n      <MaybeSortableSelect\n        ref={setRef}\n        className={className}\n        classNamePrefix={classNamePrefix}\n        isMulti={isMulti}\n        isClearable={isClearable}\n        options={options}\n        value={value}\n        minMenuHeight={minMenuHeight}\n        maxMenuHeight={maxMenuHeight}\n        filterOption={\n          // filterOption may be NULL\n          filterOption !== undefined\n            ? filterOption\n            : createFilter({ ignoreAccents })\n        }\n        styles={{ ...DEFAULT_STYLES, ...stylesConfig } as SelectProps['styles']}\n        // merge default theme from `react-select`, default theme for Superset,\n        // and the theme from props.\n        theme={reactSelectTheme =>\n          merge(reactSelectTheme, defaultTheme(theme), themeConfig)\n        }\n        formatOptionLabel={formatOptionLabel}\n        getOptionLabel={getOptionLabel}\n        getOptionValue={getOptionValue}\n        components={components}\n        {...restProps}\n      />\n    );\n  }\n\n  // React.memo makes sure the component does no rerender given the same props\n  return React.memo(StyledSelect);\n}\n\nexport const Select = styled(WindowedSelect);\nexport const CreatableSelect = styled(WindowedCreatableSelect);\nexport const AsyncCreatableSelect = styled(WindowedAsyncCreatableSelect);\nexport default Select;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components/Select';\n\nexport default class OnPasteSelect extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onPaste = this.onPaste.bind(this);\n  }\n\n  onPaste(evt) {\n    if (!this.props.isMulti) {\n      return;\n    }\n    evt.preventDefault();\n    const clipboard = evt.clipboardData.getData('Text');\n    if (!clipboard) {\n      return;\n    }\n    const regex = `[${this.props.separator}]+`;\n    const values = clipboard.split(new RegExp(regex)).map(v => v.trim());\n    const validator = this.props.isValidNewOption;\n    const selected = this.props.value || [];\n    const existingOptions = {};\n    const existing = {};\n    this.props.options.forEach(v => {\n      existingOptions[v[this.props.valueKey]] = 1;\n    });\n    let options = [];\n    selected.forEach(v => {\n      options.push({ [this.props.labelKey]: v, [this.props.valueKey]: v });\n      existing[v] = 1;\n    });\n    options = options.concat(\n      values\n        .filter(v => {\n          const notExists = !existing[v];\n          existing[v] = 1;\n          return (\n            notExists &&\n            (validator ? validator({ [this.props.labelKey]: v }) : !!v)\n          );\n        })\n        .map(v => {\n          const opt = { [this.props.labelKey]: v, [this.props.valueKey]: v };\n          if (!existingOptions[v]) {\n            this.props.options.unshift(opt);\n          }\n          return opt;\n        }),\n    );\n    if (options.length) {\n      if (this.props.onChange) {\n        this.props.onChange(options);\n      }\n    }\n  }\n\n  render() {\n    const { selectWrap: SelectComponent, ...restProps } = this.props;\n    return <SelectComponent {...restProps} onPaste={this.onPaste} />;\n  }\n}\n\nOnPasteSelect.propTypes = {\n  separator: PropTypes.array,\n  selectWrap: PropTypes.elementType,\n  selectRef: PropTypes.func,\n  onChange: PropTypes.func.isRequired,\n  valueKey: PropTypes.string,\n  labelKey: PropTypes.string,\n  options: PropTypes.array,\n  isMulti: PropTypes.bool,\n  value: PropTypes.any,\n  isValidNewOption: PropTypes.func,\n  noResultsText: PropTypes.string,\n  forceOverflow: PropTypes.bool,\n};\nOnPasteSelect.defaultProps = {\n  separator: [',', '\\n', '\\t', ';'],\n  selectWrap: Select,\n  valueKey: 'value',\n  labelKey: 'label',\n  options: [],\n  isMulti: false,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport Select, { SelectProps } from 'antd/lib/select';\n\nexport type {\n  OptionType as NativeSelectOptionType,\n  SelectProps as NativeSelectProps,\n} from 'antd/lib/select';\n\nconst StyledNativeSelect = styled((props: SelectProps<any>) => (\n  <Select getPopupContainer={(trigger: any) => trigger.parentNode} {...props} />\n))`\n  display: block;\n`;\n\nconst StyledNativeGraySelect = styled(Select)`\n  &.ant-select-single {\n    .ant-select-selector {\n      height: 36px;\n      padding: 0 11px;\n      background-color: ${({ theme }) => theme.colors.grayscale.light3};\n      border: none;\n\n      .ant-select-selection-search-input {\n        height: 100%;\n      }\n\n      .ant-select-selection-item,\n      .ant-select-selection-placeholder {\n        line-height: 35px;\n        color: ${({ theme }) => theme.colors.grayscale.dark1};\n      }\n    }\n  }\n`;\n\nexport const NativeSelect = Object.assign(StyledNativeSelect, {\n  Option: Select.Option,\n});\n\nexport const NativeGraySelect = Object.assign(StyledNativeGraySelect, {\n  Option: Select.Option,\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { debounce } from 'lodash';\nimport { max as d3Max } from 'd3-array';\nimport { AsyncCreatableSelect, CreatableSelect } from 'src/components/Select';\nimport Button from 'src/components/Button';\nimport {\n  css,\n  styled,\n  t,\n  SupersetClient,\n  ensureIsArray,\n  withTheme,\n} from '@superset-ui/core';\nimport { Global } from '@emotion/react';\n\nimport {\n  BOOL_FALSE_DISPLAY,\n  BOOL_TRUE_DISPLAY,\n  SLOW_DEBOUNCE,\n} from 'src/constants';\nimport { FormLabel } from 'src/components/Form';\nimport DateFilterControl from 'src/explore/components/controls/DateFilterControl';\nimport ControlRow from 'src/explore/components/ControlRow';\nimport Control from 'src/explore/components/Control';\nimport { controls } from 'src/explore/controls';\nimport { getExploreUrl } from 'src/explore/exploreUtils';\nimport OnPasteSelect from 'src/components/Select/OnPasteSelect';\nimport {\n  FILTER_CONFIG_ATTRIBUTES,\n  FILTER_OPTIONS_LIMIT,\n  TIME_FILTER_LABELS,\n  TIME_FILTER_MAP,\n} from 'src/explore/constants';\n\n// a shortcut to a map key, used by many components\nexport const TIME_RANGE = TIME_FILTER_MAP.time_range;\n\nconst propTypes = {\n  chartId: PropTypes.number.isRequired,\n  origSelectedValues: PropTypes.object,\n  datasource: PropTypes.object.isRequired,\n  instantFiltering: PropTypes.bool,\n  filtersFields: PropTypes.arrayOf(\n    PropTypes.shape({\n      field: PropTypes.string,\n      label: PropTypes.string,\n    }),\n  ),\n  filtersChoices: PropTypes.objectOf(\n    PropTypes.arrayOf(\n      PropTypes.shape({\n        id: PropTypes.string,\n        text: PropTypes.string,\n        filter: PropTypes.string,\n        metric: PropTypes.number,\n      }),\n    ),\n  ),\n  onChange: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  showDateFilter: PropTypes.bool,\n  showSqlaTimeGrain: PropTypes.bool,\n  showSqlaTimeColumn: PropTypes.bool,\n  showDruidTimeGrain: PropTypes.bool,\n  showDruidTimeOrigin: PropTypes.bool,\n};\nconst defaultProps = {\n  origSelectedValues: {},\n  onChange: () => {},\n  onFilterMenuOpen: () => {},\n  onFilterMenuClose: () => {},\n  showDateFilter: false,\n  showSqlaTimeGrain: false,\n  showSqlaTimeColumn: false,\n  showDruidTimeGrain: false,\n  showDruidTimeOrigin: false,\n  instantFiltering: false,\n};\n\nconst StyledFilterContainer = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    flex-direction: column;\n    margin-bottom: ${theme.gridUnit * 2 + 2}px;\n\n    &:last-child {\n      margin-bottom: 0;\n    }\n\n    label {\n      display: flex;\n      font-weight: ${theme.typography.weights.bold};\n    }\n\n    .filter-badge-container {\n      width: 30px;\n      padding-right: ${theme.gridUnit * 2 + 2}px;\n    }\n\n    .filter-badge-container + div {\n      width: 100%;\n    }\n  `}\n`;\n\nclass FilterBox extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      selectedValues: props.origSelectedValues,\n      // this flag is used by non-instant filter, to make the apply button enabled/disabled\n      hasChanged: false,\n    };\n    this.debouncerCache = {};\n    this.maxValueCache = {};\n    this.changeFilter = this.changeFilter.bind(this);\n    this.onFilterMenuOpen = this.onFilterMenuOpen.bind(this);\n    this.onOpenDateFilterControl = this.onOpenDateFilterControl.bind(this);\n    this.onFilterMenuClose = this.onFilterMenuClose.bind(this);\n  }\n\n  onFilterMenuOpen(column) {\n    return this.props.onFilterMenuOpen(this.props.chartId, column);\n  }\n\n  onFilterMenuClose(column) {\n    return this.props.onFilterMenuClose(this.props.chartId, column);\n  }\n\n  onOpenDateFilterControl() {\n    return this.onFilterMenuOpen(TIME_RANGE);\n  }\n\n  onCloseDateFilterControl = () => this.onFilterMenuClose(TIME_RANGE);\n\n  getControlData(controlName) {\n    const { selectedValues } = this.state;\n    const control = {\n      ...controls[controlName], // TODO: make these controls ('druid_time_origin', 'granularity', 'granularity_sqla', 'time_grain_sqla') accessible from getControlsForVizType.\n      name: controlName,\n      key: `control-${controlName}`,\n      value: selectedValues[TIME_FILTER_MAP[controlName]],\n      actions: { setControlValue: this.changeFilter },\n    };\n    const mapFunc = control.mapStateToProps;\n    return mapFunc ? { ...control, ...mapFunc(this.props) } : control;\n  }\n\n  /**\n   * Get known max value of a column\n   */\n  getKnownMax(key, choices) {\n    this.maxValueCache[key] = Math.max(\n      this.maxValueCache[key] || 0,\n      d3Max(choices || this.props.filtersChoices[key] || [], x => x.metric),\n    );\n    return this.maxValueCache[key];\n  }\n\n  clickApply() {\n    const { selectedValues } = this.state;\n    this.setState({ hasChanged: false }, () => {\n      this.props.onChange(selectedValues, false);\n    });\n  }\n\n  changeFilter(filter, options) {\n    const fltr = TIME_FILTER_MAP[filter] || filter;\n    let vals = null;\n    if (options !== null) {\n      if (Array.isArray(options)) {\n        vals = options.map(opt => (typeof opt === 'string' ? opt : opt.value));\n      } else if (Object.values(TIME_FILTER_MAP).includes(fltr)) {\n        vals = options.value ?? options;\n      } else {\n        // must use array member for legacy extra_filters's value\n        vals = ensureIsArray(options.value ?? options);\n      }\n    }\n\n    this.setState(\n      prevState => ({\n        selectedValues: {\n          ...prevState.selectedValues,\n          [fltr]: vals,\n        },\n        hasChanged: true,\n      }),\n      () => {\n        if (this.props.instantFiltering) {\n          this.props.onChange({ [fltr]: vals }, false);\n        }\n      },\n    );\n  }\n\n  /**\n   * Generate a debounce function that loads options for a specific column\n   */\n  debounceLoadOptions(key) {\n    if (!(key in this.debouncerCache)) {\n      this.debouncerCache[key] = debounce((input, callback) => {\n        this.loadOptions(key, input).then(callback);\n      }, SLOW_DEBOUNCE);\n    }\n    return this.debouncerCache[key];\n  }\n\n  /**\n   * Transform select options, add bar background\n   */\n  transformOptions(options, max) {\n    const maxValue = max === undefined ? d3Max(options, x => x.metric) : max;\n    return options.map(opt => {\n      const perc = Math.round((opt.metric / maxValue) * 100);\n      const color = 'lightgrey';\n      const backgroundImage = `linear-gradient(to right, ${color}, ${color} ${perc}%, rgba(0,0,0,0) ${perc}%`;\n      const style = { backgroundImage };\n      let label = opt.id;\n      if (label === true) {\n        label = BOOL_TRUE_DISPLAY;\n      } else if (label === false) {\n        label = BOOL_FALSE_DISPLAY;\n      }\n      return { value: opt.id, label, style };\n    });\n  }\n\n  async loadOptions(key, inputValue = '') {\n    const input = inputValue.toLowerCase();\n    const sortAsc = this.props.filtersFields.find(x => x.key === key).asc;\n    const formData = {\n      ...this.props.rawFormData,\n      adhoc_filters: inputValue\n        ? [\n            {\n              clause: 'WHERE',\n              expressionType: 'SIMPLE',\n              subject: key,\n              operator: 'ILIKE',\n              comparator: `%${input}%`,\n            },\n          ]\n        : null,\n    };\n\n    const { json } = await SupersetClient.get({\n      url: getExploreUrl({\n        formData,\n        endpointType: 'json',\n        method: 'GET',\n      }),\n    });\n    const options = (json?.data?.[key] || []).filter(x => x.id);\n    if (!options || options.length === 0) {\n      return [];\n    }\n    if (input) {\n      // sort those starts with search query to front\n      options.sort((a, b) => {\n        const labelA = a.id.toLowerCase();\n        const labelB = b.id.toLowerCase();\n        const textOrder = labelB.startsWith(input) - labelA.startsWith(input);\n        return textOrder === 0\n          ? (a.metric - b.metric) * (sortAsc ? 1 : -1)\n          : textOrder;\n      });\n    }\n    return this.transformOptions(options, this.getKnownMax(key, options));\n  }\n\n  renderDateFilter() {\n    const { showDateFilter } = this.props;\n    const label = TIME_FILTER_LABELS.time_range;\n    if (showDateFilter) {\n      return (\n        <div className=\"row space-1\">\n          <div\n            className=\"col-lg-12 col-xs-12\"\n            data-test=\"date-filter-container\"\n          >\n            <DateFilterControl\n              name={TIME_RANGE}\n              label={label}\n              description={t('Select start and end date')}\n              onChange={newValue => {\n                this.changeFilter(TIME_RANGE, newValue);\n              }}\n              onOpenDateFilterControl={this.onOpenDateFilterControl}\n              onCloseDateFilterControl={this.onCloseDateFilterControl}\n              value={this.state.selectedValues[TIME_RANGE] || 'No filter'}\n              endpoints={['inclusive', 'exclusive']}\n            />\n          </div>\n        </div>\n      );\n    }\n    return null;\n  }\n\n  renderDatasourceFilters() {\n    const {\n      showSqlaTimeGrain,\n      showSqlaTimeColumn,\n      showDruidTimeGrain,\n      showDruidTimeOrigin,\n    } = this.props;\n    const datasourceFilters = [];\n    const sqlaFilters = [];\n    const druidFilters = [];\n    if (showSqlaTimeGrain) sqlaFilters.push('time_grain_sqla');\n    if (showSqlaTimeColumn) sqlaFilters.push('granularity_sqla');\n    if (showDruidTimeGrain) druidFilters.push('granularity');\n    if (showDruidTimeOrigin) druidFilters.push('druid_time_origin');\n    if (sqlaFilters.length) {\n      datasourceFilters.push(\n        <ControlRow\n          key=\"sqla-filters\"\n          controls={sqlaFilters.map(control => (\n            <Control {...this.getControlData(control)} />\n          ))}\n        />,\n      );\n    }\n    if (druidFilters.length) {\n      datasourceFilters.push(\n        <ControlRow\n          key=\"druid-filters\"\n          controls={druidFilters.map(control => (\n            <Control {...this.getControlData(control)} />\n          ))}\n        />,\n      );\n    }\n    return datasourceFilters;\n  }\n\n  renderSelect(filterConfig) {\n    const { filtersChoices } = this.props;\n    const { selectedValues } = this.state;\n    this.debouncerCache = {};\n    this.maxValueCache = {};\n\n    // Add created options to filtersChoices, even though it doesn't exist,\n    // or these options will exist in query sql but invisible to end user.\n    Object.keys(selectedValues)\n      .filter(key => key in filtersChoices)\n      .forEach(key => {\n        // empty values are ignored\n        if (!selectedValues[key]) {\n          return;\n        }\n        const choices = filtersChoices[key] || (filtersChoices[key] = []);\n        const choiceIds = new Set(choices.map(f => f.id));\n        const selectedValuesForKey = Array.isArray(selectedValues[key])\n          ? selectedValues[key]\n          : [selectedValues[key]];\n        selectedValuesForKey\n          .filter(value => value !== null && !choiceIds.has(value))\n          .forEach(value => {\n            choices.unshift({\n              filter: key,\n              id: value,\n              text: value,\n              metric: 0,\n            });\n          });\n      });\n    const {\n      key,\n      label,\n      [FILTER_CONFIG_ATTRIBUTES.MULTIPLE]: isMultiple,\n      [FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE]: defaultValue,\n      [FILTER_CONFIG_ATTRIBUTES.CLEARABLE]: isClearable,\n      [FILTER_CONFIG_ATTRIBUTES.SEARCH_ALL_OPTIONS]: searchAllOptions,\n    } = filterConfig;\n    const data = filtersChoices[key] || [];\n    let value = selectedValues[key] || null;\n\n    // Assign default value if required\n    if (value === undefined && defaultValue) {\n      // multiple values are separated by semicolons\n      value = isMultiple ? defaultValue.split(';') : defaultValue;\n    }\n\n    return (\n      <OnPasteSelect\n        cacheOptions\n        loadOptions={this.debounceLoadOptions(key)}\n        defaultOptions={this.transformOptions(data)}\n        key={key}\n        placeholder={t('Type or Select [%s]', label)}\n        isMulti={isMultiple}\n        isClearable={isClearable}\n        value={value}\n        options={this.transformOptions(data)}\n        onChange={newValue => {\n          // avoid excessive re-renders\n          if (newValue !== value) {\n            this.changeFilter(key, newValue);\n          }\n        }}\n        // TODO try putting this back once react-select is upgraded\n        // onFocus={() => this.onFilterMenuOpen(key)}\n        onMenuOpen={() => this.onFilterMenuOpen(key)}\n        onBlur={() => this.onFilterMenuClose(key)}\n        onMenuClose={() => this.onFilterMenuClose(key)}\n        selectWrap={\n          searchAllOptions && data.length >= FILTER_OPTIONS_LIMIT\n            ? AsyncCreatableSelect\n            : CreatableSelect\n        }\n        noResultsText={t('No results found')}\n        forceOverflow\n      />\n    );\n  }\n\n  renderFilters() {\n    const { filtersFields = [] } = this.props;\n    return filtersFields.map(filterConfig => {\n      const { label, key } = filterConfig;\n      return (\n        <StyledFilterContainer key={key} className=\"filter-container\">\n          <FormLabel htmlFor={`LABEL-${key}`}>{label}</FormLabel>\n          {this.renderSelect(filterConfig)}\n        </StyledFilterContainer>\n      );\n    });\n  }\n\n  render() {\n    const { instantFiltering, width, height } = this.props;\n    const { zIndex, gridUnit } = this.props.theme;\n    return (\n      <>\n        <Global\n          styles={css`\n            .dashboard .filter_box .slice_container > div:not(.alert) {\n              padding-top: 0;\n            }\n\n            .filter_box {\n              padding: ${gridUnit * 2 + 2}px 0;\n              overflow: visible !important;\n\n              &:hover {\n                z-index: ${zIndex.max};\n              }\n            }\n          `}\n        />\n        <div style={{ width, height, overflow: 'auto' }}>\n          {this.renderDateFilter()}\n          {this.renderDatasourceFilters()}\n          {this.renderFilters()}\n          {!instantFiltering && (\n            <Button\n              buttonSize=\"small\"\n              buttonStyle=\"primary\"\n              onClick={this.clickApply.bind(this)}\n              disabled={!this.state.hasChanged}\n            >\n              {t('Apply')}\n            </Button>\n          )}\n        </div>\n      </>\n    );\n  }\n}\n\nFilterBox.propTypes = propTypes;\nFilterBox.defaultProps = defaultProps;\n\nexport default withTheme(FilterBox);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { kebabCase } from 'lodash';\nimport { t, useTheme, styled } from '@superset-ui/core';\nimport Tooltip from './Tooltip';\n\ninterface CertifiedIconWithTooltipProps {\n  certifiedBy?: string | null;\n  details?: string | null;\n  metricName: string;\n}\n\nconst StyledDiv = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nfunction CertifiedIconWithTooltip({\n  certifiedBy,\n  details,\n  metricName,\n}: CertifiedIconWithTooltipProps) {\n  const theme = useTheme();\n  return (\n    <Tooltip\n      id={`${kebabCase(metricName)}-tooltip`}\n      title={\n        <div>\n          {certifiedBy && (\n            <StyledDiv>{t('Certified by %s', certifiedBy)}</StyledDiv>\n          )}\n          <div>{details}</div>\n        </div>\n      }\n    >\n      {/* TODO: move Icons to superset-ui to remove duplicated icon code here */}\n      <svg\n        xmlns=\"http://www.w3.org/2000/svg\"\n        enableBackground=\"new 0 0 24 24\"\n        height=\"14\"\n        viewBox=\"0 0 24 24\"\n        width=\"14\"\n      >\n        <g>\n          <path\n            fill={theme.colors.primary.base}\n            d=\"M23,12l-2.44-2.79l0.34-3.69l-3.61-0.82L15.4,1.5L12,2.96L8.6,1.5L6.71,4.69L3.1,5.5L3.44,9.2L1,12l2.44,2.79l-0.34,3.7 l3.61,0.82L8.6,22.5l3.4-1.47l3.4,1.46l1.89-3.19l3.61-0.82l-0.34-3.69L23,12z M9.38,16.01L7,13.61c-0.39-0.39-0.39-1.02,0-1.41 l0.07-0.07c0.39-0.39,1.03-0.39,1.42,0l1.61,1.62l5.15-5.16c0.39-0.39,1.03-0.39,1.42,0l0.07,0.07c0.39,0.39,0.39,1.02,0,1.41 l-5.92,5.94C10.41,16.4,9.78,16.4,9.38,16.01z\"\n          />\n        </g>\n      </svg>\n    </Tooltip>\n  );\n}\n\nexport default CertifiedIconWithTooltip;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, ReactNode, useLayoutEffect } from 'react';\nimport { css, styled, SupersetTheme } from '@superset-ui/core';\nimport { Tooltip } from './Tooltip';\nimport { ColumnTypeLabel } from './ColumnTypeLabel/ColumnTypeLabel';\nimport CertifiedIconWithTooltip from './CertifiedIconWithTooltip';\nimport { ColumnMeta } from '../types';\nimport { getColumnLabelText, getColumnTooltipNode } from './labelUtils';\nimport { SQLPopover } from './SQLPopover';\n\nexport type ColumnOptionProps = {\n  column: ColumnMeta;\n  showType?: boolean;\n  labelRef?: React.RefObject<any>;\n};\n\nconst StyleOverrides = styled.span`\n  display: flex;\n  align-items: center;\n  svg {\n    margin-right: ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nexport function ColumnOption({\n  column,\n  labelRef,\n  showType = false,\n}: ColumnOptionProps) {\n  const { expression, column_name, type_generic } = column;\n  const hasExpression = expression && expression !== column_name;\n  const type = hasExpression ? 'expression' : type_generic;\n  const [tooltipText, setTooltipText] = useState<ReactNode>(column.column_name);\n\n  useLayoutEffect(() => {\n    setTooltipText(getColumnTooltipNode(column, labelRef));\n  }, [labelRef, column]);\n\n  return (\n    <StyleOverrides>\n      {showType && type !== undefined && <ColumnTypeLabel type={type} />}\n      <Tooltip id=\"metric-name-tooltip\" title={tooltipText}>\n        <span\n          className=\"option-label column-option-label\"\n          css={(theme: SupersetTheme) =>\n            css`\n              margin-right: ${theme.gridUnit}px;\n            `\n          }\n          ref={labelRef}\n        >\n          {getColumnLabelText(column)}\n        </span>\n      </Tooltip>\n      {hasExpression && <SQLPopover sqlExpression={expression} />}\n      {column.is_certified && (\n        <CertifiedIconWithTooltip\n          metricName={column.metric_name}\n          certifiedBy={column.certified_by}\n          details={column.certification_details}\n        />\n      )}\n    </StyleOverrides>\n  );\n}\n\nexport default ColumnOption;\n","var _path;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldDerived(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M6.988 10.809l-1.031 4.84c-.184.867-.57 1.576-1.16 2.126-.59.551-1.197.827-1.822.827-.344 0-.597-.066-.76-.197a.61.61 0 01-.242-.495.7.7 0 01.152-.445c.102-.13.248-.194.44-.194.12 0 .227.028.319.082a.978.978 0 01.243.206c.055.066.116.156.185.27l.178.292c.301-.023.558-.226.77-.61.214-.382.398-.929.554-1.64l1.079-5.062H4.75l.123-.534h1.13l.083-.398c.094-.453.242-.861.445-1.225.203-.363.434-.672.692-.925.254-.25.542-.447.864-.59.322-.142.632-.213.929-.213.343 0 .596.065.758.196a.61.61 0 01.244.495.727.727 0 01-.144.446c-.096.128-.245.193-.448.193a.614.614 0 01-.317-.08.895.895 0 01-.24-.207 1.921 1.921 0 01-.187-.276 3.843 3.843 0 00-.176-.287c-.27.012-.508.19-.715.534-.207.343-.395.916-.562 1.716l-.13.621H8.57l-.123.534H6.988zm2.225 2.261c0-1.758.45-3.183 1.387-4.424h.713c-.694.89-1.236 2.774-1.236 4.424 0 1.66.537 3.54 1.236 4.429H10.6c-.938-1.24-1.387-2.666-1.387-4.429zm5.288.957h-.078l-1.25 1.988h-.952l1.802-2.632L12.2 10.75h1.001l1.25 1.958h.078l1.236-1.958h.952l-1.787 2.598 1.811 2.666h-.996l-1.245-1.988zm5.23-.952c0 1.758-.45 3.184-1.387 4.424h-.713c.693-.889 1.235-2.773 1.235-4.424 0-1.66-.537-3.54-1.235-4.429h.713c.937 1.24 1.386 2.666 1.386 4.43z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldDerived;","var _path;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldBoolean(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M12 4h-1v16h1V4zm3.248 8.475c0 2.343.913 3.691 2.5 3.691 1.582 0 2.49-1.338 2.49-3.677 0-2.334-.923-3.7-2.49-3.7-1.577 0-2.5 1.361-2.5 3.686zM5.579 9.93V16h.879V8.954h-.874l-1.875 1.348v.928l1.792-1.3h.078zm12.169 5.468c1.04 0 1.607-1.035 1.607-2.924 0-1.87-.577-2.915-1.607-2.915s-1.616 1.054-1.616 2.915c0 1.884.576 2.924 1.616 2.924z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldBoolean;","var _path;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldAbc(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M5.91 16.14c-1.14 0-2.047-.671-2.047-1.843 0-1.375 1.215-1.621 2.328-1.766 1.094-.14 1.547-.117 1.547-.562 0-.778-.41-1.235-1.265-1.235-.88 0-1.36.47-1.563.907l-.875-.313c.469-1.094 1.5-1.406 2.406-1.406.766 0 2.22.219 2.22 2.125V16h-.923v-.813h-.047c-.187.391-.734.954-1.78.954zm.14-.828c1.095 0 1.688-.734 1.688-1.484v-.844c-.156.188-1.203.297-1.593.344-.72.094-1.36.313-1.36 1.016 0 .64.531.969 1.266.969zM9.799 16V8h.921v2.953h.079c.203-.312.562-1.031 1.734-1.031 1.516 0 2.563 1.203 2.563 3.094 0 1.906-1.047 3.109-2.547 3.109-1.157 0-1.547-.719-1.75-1.047h-.11V16h-.89zm.906-3c0 1.36.61 2.297 1.719 2.297 1.156 0 1.75-1.016 1.75-2.297 0-1.266-.579-2.25-1.75-2.25-1.125 0-1.72.906-1.72 2.25zm7.684 3.125c-1.687 0-2.719-1.297-2.719-3.094 0-1.828 1.079-3.11 2.704-3.11 1.265 0 2.218.75 2.375 1.876h-.922c-.14-.547-.625-1.047-1.438-1.047-1.078 0-1.797.89-1.797 2.25 0 1.39.703 2.297 1.797 2.297.719 0 1.266-.39 1.438-1.047h.922c-.157 1.063-1.032 1.875-2.36 1.875z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldAbc;","var _path;\n\nfunction _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nimport * as React from \"react\";\n\nfunction SvgFieldNum(props) {\n  return /*#__PURE__*/React.createElement(\"svg\", _extends({\n    width: 24,\n    height: 24,\n    viewBox: \"0 0 24 24\",\n    fill: \"none\",\n    xmlns: \"http://www.w3.org/2000/svg\"\n  }, props), _path || (_path = /*#__PURE__*/React.createElement(\"path\", {\n    fillRule: \"evenodd\",\n    clipRule: \"evenodd\",\n    d: \"M10 8h1v2h2V8h1v2h2v1h-2v2h2v1h-2v2h-1v-2h-2v2h-1v-2H8v-1h2v-2H8v-1h2V8zm3 5v-2h-2v2h2z\",\n    fill: \"currentColor\"\n  })));\n}\n\nexport default SvgFieldNum;","/* eslint-disable no-nested-ternary */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { css, GenericDataType, styled, t } from '@superset-ui/core';\nimport { ClockCircleOutlined, QuestionOutlined } from '@ant-design/icons';\n// TODO: move all icons to superset-ui/core\nimport FunctionSvg from './type-icons/field_derived.svg';\nimport BooleanSvg from './type-icons/field_boolean.svg';\nimport StringSvg from './type-icons/field_abc.svg';\nimport NumSvg from './type-icons/field_num.svg';\n\nexport type ColumnLabelExtendedType = 'expression' | '';\n\nexport type ColumnTypeLabelProps = {\n  type?: ColumnLabelExtendedType | GenericDataType;\n};\n\nconst TypeIconWrapper = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: ${theme.gridUnit * 6}px;\n    height: ${theme.gridUnit * 6}px;\n    margin-right: ${theme.gridUnit}px;\n\n    && svg {\n      margin-right: 0;\n      margin-left: 0;\n    }\n  `};\n`;\n\nexport function ColumnTypeLabel({ type }: ColumnTypeLabelProps) {\n  let typeIcon: ReactNode = (\n    <QuestionOutlined aria-label={t('unknown type icon')} />\n  );\n\n  if (type === '' || type === 'expression') {\n    typeIcon = <FunctionSvg aria-label={t('function type icon')} />;\n  } else if (type === GenericDataType.STRING) {\n    typeIcon = <StringSvg aria-label={t('string type icon')} />;\n  } else if (type === GenericDataType.NUMERIC) {\n    typeIcon = <NumSvg aria-label={t('numeric type icon')} />;\n  } else if (type === GenericDataType.BOOLEAN) {\n    typeIcon = <BooleanSvg aria-label={t('boolean type icon')} />;\n  } else if (type === GenericDataType.TEMPORAL) {\n    typeIcon = <ClockCircleOutlined aria-label={t('temporal type icon')} />;\n  }\n\n  return <TypeIconWrapper>{typeIcon}</TypeIconWrapper>;\n}\n\nexport default ColumnTypeLabel;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, ReactNode, useLayoutEffect } from 'react';\nimport {\n  css,\n  styled,\n  Metric,\n  SafeMarkdown,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport InfoTooltipWithTrigger from './InfoTooltipWithTrigger';\nimport { ColumnTypeLabel } from './ColumnTypeLabel/ColumnTypeLabel';\nimport CertifiedIconWithTooltip from './CertifiedIconWithTooltip';\nimport Tooltip from './Tooltip';\nimport { getMetricTooltipNode } from './labelUtils';\nimport { SQLPopover } from './SQLPopover';\n\nconst FlexRowContainer = styled.div`\n  align-items: center;\n  display: flex;\n\n  > svg {\n    margin-right: ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nexport interface MetricOptionProps {\n  metric: Omit<Metric, 'id'> & { label?: string };\n  openInNewWindow?: boolean;\n  showFormula?: boolean;\n  showType?: boolean;\n  url?: string;\n  labelRef?: React.RefObject<any>;\n  shouldShowTooltip?: boolean;\n}\n\nexport function MetricOption({\n  metric,\n  labelRef,\n  openInNewWindow = false,\n  showFormula = true,\n  showType = false,\n  shouldShowTooltip = true,\n  url = '',\n}: MetricOptionProps) {\n  const verbose = metric.verbose_name || metric.metric_name || metric.label;\n  const link = url ? (\n    <a href={url} target={openInNewWindow ? '_blank' : ''} rel=\"noreferrer\">\n      {verbose}\n    </a>\n  ) : (\n    verbose\n  );\n\n  const label = (\n    <span\n      className=\"option-label metric-option-label\"\n      css={(theme: SupersetTheme) =>\n        css`\n          margin-right: ${theme.gridUnit}px;\n        `\n      }\n      ref={labelRef}\n    >\n      {link}\n    </span>\n  );\n\n  const warningMarkdown = metric.warning_markdown || metric.warning_text;\n\n  const [tooltipText, setTooltipText] = useState<ReactNode>(metric.metric_name);\n\n  useLayoutEffect(() => {\n    setTooltipText(getMetricTooltipNode(metric, labelRef));\n  }, [labelRef, metric]);\n\n  return (\n    <FlexRowContainer className=\"metric-option\">\n      {showType && <ColumnTypeLabel type=\"expression\" />}\n      {shouldShowTooltip ? (\n        <Tooltip id=\"metric-name-tooltip\" title={tooltipText}>\n          {label}\n        </Tooltip>\n      ) : (\n        label\n      )}\n      {showFormula && metric.expression && (\n        <SQLPopover sqlExpression={metric.expression} />\n      )}\n      {metric.is_certified && (\n        <CertifiedIconWithTooltip\n          metricName={metric.metric_name}\n          certifiedBy={metric.certified_by}\n          details={metric.certification_details}\n        />\n      )}\n      {warningMarkdown && (\n        <InfoTooltipWithTrigger\n          className=\"text-warning\"\n          icon=\"warning\"\n          tooltip={<SafeMarkdown source={warningMarkdown} />}\n          label={`warn-${metric.metric_name}`}\n          iconsStyle={{ marginLeft: 0 }}\n        />\n      )}\n    </FlexRowContainer>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { Popover } from 'antd';\nimport type { PopoverProps } from 'antd/lib/popover';\nimport AceEditor from 'react-ace';\nimport { CalculatorOutlined } from '@ant-design/icons';\nimport { css, styled, useTheme, t } from '@superset-ui/core';\nimport 'ace-builds/src-noconflict/mode-sql';\n\nconst StyledCalculatorIcon = styled(CalculatorOutlined)`\n  ${({ theme }) => css`\n    color: ${theme.colors.grayscale.base};\n    font-size: ${theme.typography.sizes.s}px;\n    & svg {\n      margin-left: ${theme.gridUnit}px;\n      margin-right: ${theme.gridUnit}px;\n    }\n  `}\n`;\n\nexport const SQLPopover = (props: PopoverProps & { sqlExpression: string }) => {\n  const theme = useTheme();\n  return (\n    <Popover\n      content={\n        <AceEditor\n          mode=\"sql\"\n          value={props.sqlExpression}\n          editorProps={{ $blockScrolling: true }}\n          setOptions={{\n            highlightActiveLine: false,\n            highlightGutterLine: false,\n          }}\n          minLines={2}\n          maxLines={6}\n          readOnly\n          wrapEnabled\n          style={{\n            border: `1px solid ${theme.colors.grayscale.light2}`,\n            background: theme.colors.secondary.light5,\n            maxWidth: theme.gridUnit * 100,\n          }}\n        />\n      }\n      placement=\"bottomLeft\"\n      arrowPointAtCenter\n      title={t('SQL expression')}\n      {...props}\n    >\n      <StyledCalculatorIcon />\n    </Popover>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\n\nimport { css, styled, t } from '@superset-ui/core';\nimport { ColumnMeta, Metric } from '@superset-ui/chart-controls';\n\nconst TooltipSectionWrapper = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    flex-direction: column;\n    font-size: ${theme.typography.sizes.s}px;\n    line-height: 1.2;\n\n    &:not(:last-of-type) {\n      margin-bottom: ${theme.gridUnit * 2}px;\n    }\n  `}\n`;\n\nconst TooltipSectionLabel = styled.span`\n  ${({ theme }) => css`\n    font-weight: ${theme.typography.weights.bold};\n  `}\n`;\n\nconst TooltipSection = ({\n  label,\n  text,\n}: {\n  label: ReactNode;\n  text: ReactNode;\n}) => (\n  <TooltipSectionWrapper>\n    <TooltipSectionLabel>{label}</TooltipSectionLabel>\n    <span>{text}</span>\n  </TooltipSectionWrapper>\n);\n\nexport const isLabelTruncated = (labelRef?: React.RefObject<any>): boolean =>\n  !!(\n    labelRef &&\n    labelRef.current &&\n    labelRef.current.scrollWidth > labelRef.current.clientWidth\n  );\n\nexport const getColumnLabelText = (column: ColumnMeta): string =>\n  column.verbose_name || column.column_name;\n\nexport const getColumnTooltipNode = (\n  column: ColumnMeta,\n  labelRef?: React.RefObject<any>,\n): ReactNode => {\n  if (\n    !column.verbose_name &&\n    !column.description &&\n    !isLabelTruncated(labelRef)\n  ) {\n    return null;\n  }\n\n  return (\n    <>\n      <TooltipSection label={t('Column name')} text={column.column_name} />\n      {column.verbose_name && (\n        <TooltipSection label={t('Label')} text={column.verbose_name} />\n      )}\n      {column.description && (\n        <TooltipSection label={t('Description')} text={column.description} />\n      )}\n    </>\n  );\n};\n\ntype MetricType = Omit<Metric, 'id'> & { label?: string };\n\nexport const getMetricTooltipNode = (\n  metric: MetricType,\n  labelRef?: React.RefObject<any>,\n): ReactNode => {\n  if (\n    !metric.verbose_name &&\n    !metric.description &&\n    !metric.label &&\n    !isLabelTruncated(labelRef)\n  ) {\n    return null;\n  }\n\n  return (\n    <>\n      <TooltipSection label={t('Metric name')} text={metric.metric_name} />\n      {(metric.label || metric.verbose_name) && (\n        <TooltipSection\n          label={t('Label')}\n          text={metric.label || metric.verbose_name}\n        />\n      )}\n      {metric.description && (\n        <TooltipSection label={t('Description')} text={metric.description} />\n      )}\n    </>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  t,\n  QueryMode,\n  DTTM_ALIAS,\n  GenericDataType,\n  QueryColumn,\n  DatasourceType,\n} from '@superset-ui/core';\nimport { ColumnMeta } from './types';\n\n// eslint-disable-next-line import/prefer-default-export\nexport const TIME_FILTER_LABELS = {\n  time_range: t('Time Range'),\n  granularity_sqla: t('Time Column'),\n  time_grain_sqla: t('Time Grain'),\n  druid_time_origin: t('Origin'),\n  granularity: t('Time Granularity'),\n};\n\nexport const COLUMN_NAME_ALIASES: Record<string, string> = {\n  [DTTM_ALIAS]: t('Time'),\n};\n\nexport const DATASET_TIME_COLUMN_OPTION: ColumnMeta = {\n  verbose_name: COLUMN_NAME_ALIASES[DTTM_ALIAS],\n  column_name: DTTM_ALIAS,\n  type_generic: GenericDataType.TEMPORAL,\n  description: t(\n    'A reference to the [Time] configuration, taking granularity into account',\n  ),\n};\n\nexport const QUERY_TIME_COLUMN_OPTION: QueryColumn = {\n  name: DTTM_ALIAS,\n  type: DatasourceType.Query,\n  is_dttm: false,\n};\n\nexport const QueryModeLabel = {\n  [QueryMode.aggregate]: t('Aggregate'),\n  [QueryMode.raw]: t('Raw records'),\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from './InfoTooltipWithTrigger';\nimport { Tooltip } from './Tooltip';\n\ntype ValidationError = string;\n\nexport type ControlHeaderProps = {\n  name?: string;\n  label?: ReactNode;\n  description?: ReactNode;\n  validationErrors?: ValidationError[];\n  renderTrigger?: boolean;\n  rightNode?: ReactNode;\n  leftNode?: ReactNode;\n  hovered?: boolean;\n  required?: boolean;\n  warning?: string;\n  danger?: string;\n  onClick?: () => void;\n  tooltipOnClick?: () => void;\n};\n\nexport default function ControlHeader({\n  name,\n  description,\n  label,\n  tooltipOnClick,\n  onClick,\n  warning,\n  danger,\n  leftNode,\n  rightNode,\n  validationErrors = [],\n  renderTrigger = false,\n  hovered = false,\n  required = false,\n}: ControlHeaderProps) {\n  const renderOptionalIcons = () => {\n    if (hovered) {\n      return (\n        <span>\n          {description && (\n            <span>\n              <InfoTooltipWithTrigger\n                label={t('description')}\n                tooltip={description}\n                placement=\"top\"\n                onClick={tooltipOnClick}\n              />{' '}\n            </span>\n          )}\n          {renderTrigger && (\n            <span>\n              <InfoTooltipWithTrigger\n                label={t('bolt')}\n                tooltip={t('Changing this control takes effect instantly')}\n                placement=\"top\"\n                icon=\"bolt\"\n              />{' '}\n            </span>\n          )}\n        </span>\n      );\n    }\n    return null;\n  };\n\n  if (!label) {\n    return null;\n  }\n  const labelClass = validationErrors.length > 0 ? 'text-danger' : '';\n  return (\n    <div className=\"ControlHeader\" data-test={`${name}-header`}>\n      <div className=\"pull-left\">\n        <label className=\"control-label\" htmlFor={name}>\n          {leftNode && <span>{leftNode}</span>}\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={onClick}\n            className={labelClass}\n            style={{ cursor: onClick ? 'pointer' : '' }}\n          >\n            {label}\n          </span>{' '}\n          {warning && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={warning}>\n                <i className=\"fa fa-exclamation-circle text-warning\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {danger && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={danger}>\n                <i className=\"fa fa-exclamation-circle text-danger\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {validationErrors.length > 0 && (\n            <span>\n              <Tooltip\n                id=\"error-tooltip\"\n                placement=\"top\"\n                title={validationErrors.join(' ')}\n              >\n                <i className=\"fa fa-exclamation-circle text-danger\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {renderOptionalIcons()}\n          {required && (\n            <span className=\"text-danger m-l-4\">\n              <strong>*</strong>\n            </span>\n          )}\n        </label>\n      </div>\n      {rightNode && <div className=\"pull-right\">{rightNode}</div>}\n      <div className=\"clearfix\" />\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { JsonValue, useTheme } from '@superset-ui/core';\nimport ControlHeader from '../../components/ControlHeader';\n\n// [value, label]\nexport type RadioButtonOption = [\n  JsonValue,\n  Exclude<ReactNode, null | undefined | boolean>,\n];\n\nexport interface RadioButtonControlProps {\n  label?: ReactNode;\n  description?: string;\n  options: RadioButtonOption[];\n  hovered?: boolean;\n  value?: JsonValue;\n  onChange: (opt: RadioButtonOption[0]) => void;\n}\n\nexport default function RadioButtonControl({\n  value: initialValue,\n  options,\n  onChange,\n  ...props\n}: RadioButtonControlProps) {\n  const currentValue = initialValue || options[0][0];\n  const theme = useTheme();\n  return (\n    <div\n      css={{\n        '.btn svg': {\n          position: 'relative',\n          top: '0.2em',\n        },\n        '.btn:focus': {\n          outline: 'none',\n        },\n        '.control-label': {\n          color: theme.colors.grayscale.base,\n          marginBottom: theme.gridUnit,\n        },\n        '.control-label + .btn-group': {\n          marginTop: '1px',\n        },\n        '.btn-group .btn-default': {\n          color: theme.colors.grayscale.dark1,\n        },\n        '.btn-group .btn.active': {\n          background: theme.colors.grayscale.light4,\n          fontWeight: theme.typography.weights.bold,\n          boxShadow: 'none',\n        },\n      }}\n    >\n      <ControlHeader {...props} />\n      <div className=\"btn-group btn-group-sm\">\n        {options.map(([val, label]) => (\n          <button\n            key={JSON.stringify(val)}\n            type=\"button\"\n            className={`btn btn-default ${\n              val === currentValue ? 'active' : ''\n            }`}\n            onClick={() => {\n              onChange(val);\n            }}\n          >\n            {label}\n          </button>\n        ))}\n      </div>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FunctionComponentElement, useMemo } from 'react';\nimport {\n  FAST_DEBOUNCE,\n  JsonObject,\n  JsonValue,\n  useTheme,\n} from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport { ControlFormItemNode } from './ControlFormItem';\n\nexport * from './ControlFormItem';\n\nexport type ControlFormRowProps = {\n  children: ControlFormItemNode | ControlFormItemNode[];\n};\n\nexport function ControlFormRow({ children }: ControlFormRowProps) {\n  const { gridUnit } = useTheme();\n  return (\n    <div\n      css={{\n        display: 'flex',\n        flexWrap: 'nowrap',\n        margin: -2 * gridUnit,\n        marginBottom: gridUnit,\n      }}\n    >\n      {children}\n    </div>\n  );\n}\n\ntype ControlFormRowNode = FunctionComponentElement<ControlFormRowProps>;\n\nexport type ControlFormProps = {\n  /**\n   * Form field values dict.\n   */\n  value?: JsonObject;\n  onChange: (value: JsonObject) => void;\n  children: ControlFormRowNode | ControlFormRowNode[];\n};\n\n/**\n * Light weight form for control panel.\n */\nexport default function ControlForm({\n  onChange,\n  value,\n  children,\n}: ControlFormProps) {\n  const theme = useTheme();\n  const debouncedOnChange = useMemo(\n    () =>\n      ({\n        0: onChange,\n        [FAST_DEBOUNCE]: debounce(onChange, FAST_DEBOUNCE),\n      } as Record<number, typeof onChange>),\n    [onChange],\n  );\n\n  const updatedChildren = React.Children.map(children, row => {\n    if ('children' in row.props) {\n      const defaultWidth = Array.isArray(row.props.children)\n        ? `${100 / row.props.children.length}%`\n        : undefined;\n      return React.cloneElement(row, {\n        children: React.Children.map(row.props.children, item => {\n          const {\n            name,\n            width,\n            debounceDelay = FAST_DEBOUNCE,\n            onChange: onItemValueChange,\n          } = item.props;\n          return React.cloneElement(item, {\n            width: width || defaultWidth,\n            value: value?.[name],\n            // remove `debounceDelay` from rendered control item props\n            // so React DevTools don't throw a `invalid prop` warning.\n            debounceDelay: undefined,\n            onChange(fieldValue: JsonValue) {\n              // call `onChange` on each FormItem\n              if (onItemValueChange) {\n                onItemValueChange(fieldValue);\n              }\n              // propagate to the form\n              if (!(debounceDelay in debouncedOnChange)) {\n                debouncedOnChange[debounceDelay] = debounce(\n                  onChange,\n                  debounceDelay,\n                );\n              }\n              debouncedOnChange[debounceDelay]({\n                ...value,\n                [name]: fieldValue,\n              });\n            },\n          });\n        }),\n      });\n    }\n    return row;\n  });\n  return (\n    <div\n      css={{\n        label: {\n          textTransform: 'uppercase',\n          color: theme.colors.text.label,\n          fontSize: theme.typography.sizes.s,\n        },\n      }}\n    >\n      {updatedChildren}\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, ReactNode } from 'react';\nimport AntdSelect, { SelectProps as AntdSelectProps } from 'antd/lib/select';\n\nexport const { Option }: any = AntdSelect;\n\nexport type SelectOption<VT = string> = [VT, ReactNode];\n\nexport type SelectProps<VT> = Omit<AntdSelectProps<VT>, 'options'> & {\n  creatable?: boolean;\n  minWidth?: string | number;\n  options?: SelectOption<VT>[];\n};\n\n/**\n * AntD select with creatable options.\n */\nexport default function Select<VT extends string | number>({\n  creatable,\n  onSearch,\n  dropdownMatchSelectWidth = false,\n  minWidth = '100%',\n  showSearch: showSearch_ = true,\n  onChange,\n  options,\n  children,\n  value,\n  ...props\n}: SelectProps<VT>) {\n  const [searchValue, setSearchValue] = useState<string>();\n  // force show search if creatable\n  const showSearch = showSearch_ || creatable;\n  const handleSearch = showSearch\n    ? (input: string) => {\n        if (creatable) {\n          setSearchValue(input);\n        }\n        if (onSearch) {\n          onSearch(input);\n        }\n      }\n    : undefined;\n\n  const optionsHasSearchValue = options?.some(([val]) => val === searchValue);\n  const optionsHasValue = options?.some(([val]) => val === value);\n\n  const handleChange: SelectProps<VT>['onChange'] = showSearch\n    ? (val, opt) => {\n        // reset input value once selected\n        setSearchValue('');\n        if (onChange) {\n          onChange(val, opt);\n        }\n      }\n    : onChange;\n\n  return (\n    <AntdSelect<VT>\n      dropdownMatchSelectWidth={dropdownMatchSelectWidth}\n      showSearch={showSearch}\n      onSearch={handleSearch}\n      onChange={handleChange}\n      value={value}\n      {...props}\n      css={{\n        minWidth,\n      }}\n    >\n      {options?.map(([val, label]) => (\n        <Option value={val}>{label}</Option>\n      ))}\n      {children}\n      {value && !optionsHasValue && (\n        <Option key={value} value={value}>\n          {value}\n        </Option>\n      )}\n      {searchValue && !optionsHasSearchValue && (\n        <Option key={searchValue} value={searchValue}>\n          {/* Unfortunately AntD select does not support displaying different\n          label for option vs select value, so we can't use\n          `t('Create \"%s\"', searchValue)` here */}\n          {searchValue}\n        </Option>\n      )}\n    </AntdSelect>\n  );\n}\n\nSelect.Option = Option;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { Slider, InputNumber, Input } from 'antd';\nimport Checkbox, { CheckboxProps } from 'antd/lib/checkbox';\nimport Select, { SelectOption } from '../Select';\nimport RadioButtonControl, {\n  RadioButtonOption,\n} from '../../shared-controls/components/RadioButtonControl';\n\nexport const ControlFormItemComponents = {\n  Slider,\n  InputNumber,\n  Input,\n  Select,\n  // Directly export Checkbox will result in \"using name from external module\" error\n  // ref: https://stackoverflow.com/questions/43900035/ts4023-exported-variable-x-has-or-is-using-name-y-from-external-module-but\n  Checkbox: Checkbox as React.ForwardRefExoticComponent<\n    CheckboxProps & React.RefAttributes<HTMLInputElement>\n  >,\n  RadioButtonControl,\n};\n\nexport type ControlType = keyof typeof ControlFormItemComponents;\n\nexport type ControlFormValueValidator<V> = (value: V) => string | false;\n\nexport type ControlFormItemSpec<T extends ControlType = ControlType> = {\n  controlType: T;\n  label: ReactNode;\n  description: ReactNode;\n  placeholder?: string;\n  required?: boolean;\n  validators?: ControlFormValueValidator<any>[];\n  width?: number | string;\n  /**\n   * Time to delay change propagation.\n   */\n  debounceDelay?: number;\n} & (T extends 'Select'\n  ? {\n      options: SelectOption<any>[];\n      value?: string;\n      defaultValue?: string;\n      creatable?: boolean;\n      minWidth?: number | string;\n      validators?: ControlFormValueValidator<string>[];\n    }\n  : T extends 'RadioButtonControl'\n  ? {\n      options: RadioButtonOption[];\n      value?: string;\n      defaultValue?: string;\n    }\n  : T extends 'Checkbox'\n  ? {\n      value?: boolean;\n      defaultValue?: boolean;\n    }\n  : T extends 'InputNumber' | 'Slider'\n  ? {\n      min?: number;\n      max?: number;\n      step?: number;\n      value?: number;\n      defaultValue?: number;\n      validators?: ControlFormValueValidator<number>[];\n    }\n  : T extends 'Input'\n  ? {\n      controlType: 'Input';\n      value?: string;\n      defaultValue?: string;\n      validators?: ControlFormValueValidator<string>[];\n    }\n  : {});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, FunctionComponentElement, ChangeEvent } from 'react';\nimport { JsonValue, useTheme } from '@superset-ui/core';\nimport ControlHeader, { ControlHeaderProps } from '../ControlHeader';\nimport InfoTooltipWithTrigger from '../InfoTooltipWithTrigger';\nimport { ControlFormItemComponents, ControlFormItemSpec } from './controls';\n\nexport * from './controls';\n\nexport type ControlFormItemProps = ControlFormItemSpec & {\n  name: string;\n  onChange?: (fieldValue: JsonValue) => void;\n};\n\nexport type ControlFormItemNode =\n  FunctionComponentElement<ControlFormItemProps>;\n\n/**\n * Accept `false` or `0`, but not empty string.\n */\nfunction isEmptyValue(value?: JsonValue) {\n  return value == null || value === '';\n}\n\nexport function ControlFormItem({\n  name,\n  label,\n  description,\n  width,\n  validators,\n  required,\n  onChange,\n  value: initialValue,\n  defaultValue,\n  controlType,\n  ...props\n}: ControlFormItemProps) {\n  const { gridUnit } = useTheme();\n  const [hovered, setHovered] = useState(false);\n  const [value, setValue] = useState(\n    initialValue === undefined ? defaultValue : initialValue,\n  );\n  const [validationErrors, setValidationErrors] =\n    useState<ControlHeaderProps['validationErrors']>();\n\n  const handleChange = (e: ChangeEvent<HTMLInputElement> | JsonValue) => {\n    const fieldValue =\n      e && typeof e === 'object' && 'target' in e\n        ? e.target.type === 'checkbox' || e.target.type === 'radio'\n          ? e.target.checked\n          : e.target.value\n        : e;\n    const errors =\n      (validators\n        ?.map(validator =>\n          !required && isEmptyValue(fieldValue) ? false : validator(fieldValue),\n        )\n        .filter(x => !!x) as string[]) || [];\n    setValidationErrors(errors);\n    setValue(fieldValue);\n    if (errors.length === 0 && onChange) {\n      onChange(fieldValue as JsonValue);\n    }\n  };\n\n  const Control = ControlFormItemComponents[controlType];\n\n  return (\n    <div\n      css={{\n        margin: 2 * gridUnit,\n        width,\n      }}\n      onMouseEnter={() => setHovered(true)}\n      onMouseLeave={() => setHovered(false)}\n    >\n      {controlType === 'Checkbox' ? (\n        <ControlFormItemComponents.Checkbox\n          checked={value as boolean}\n          onChange={handleChange}\n        >\n          {label}{' '}\n          {hovered && description && (\n            <InfoTooltipWithTrigger tooltip={description} />\n          )}\n        </ControlFormItemComponents.Checkbox>\n      ) : (\n        <>\n          {label && (\n            <ControlHeader\n              name={name}\n              label={label}\n              description={description}\n              validationErrors={validationErrors}\n              hovered={hovered}\n              required={required}\n            />\n          )}\n          {/* @ts-ignore */}\n          <Control {...props} value={value} onChange={handleChange} />\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default ControlFormItem;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { GenericDataType, t, validateNumber } from '@superset-ui/core';\nimport { FaAlignLeft } from '@react-icons/all-files/fa/FaAlignLeft';\nimport { FaAlignRight } from '@react-icons/all-files/fa/FaAlignRight';\nimport { FaAlignCenter } from '@react-icons/all-files/fa/FaAlignCenter';\nimport {\n  D3_FORMAT_DOCS,\n  D3_FORMAT_OPTIONS,\n  D3_TIME_FORMAT_DOCS,\n  D3_TIME_FORMAT_OPTIONS,\n} from '../../../utils';\nimport { ControlFormItemSpec } from '../../../components/ControlForm';\nimport { ColumnConfigFormLayout } from './types';\n\nexport type SharedColumnConfigProp =\n  | 'alignPositiveNegative'\n  | 'colorPositiveNegative'\n  | 'columnWidth'\n  | 'fractionDigits'\n  | 'emitTarget'\n  | 'd3NumberFormat'\n  | 'd3SmallNumberFormat'\n  | 'd3TimeFormat'\n  | 'horizontalAlign'\n  | 'showCellBars';\n\nconst emitTarget: ControlFormItemSpec<'Input'> = {\n  controlType: 'Input',\n  label: t('Emit Target'),\n  description: t(\n    'If you wish to specify a different target column than the original column, it can be entered here',\n  ),\n  defaultValue: '',\n  debounceDelay: 500,\n  validators: undefined,\n};\n\nconst d3NumberFormat: ControlFormItemSpec<'Select'> = {\n  controlType: 'Select',\n  label: t('D3 format'),\n  description: D3_FORMAT_DOCS,\n  options: D3_FORMAT_OPTIONS,\n  defaultValue: D3_FORMAT_OPTIONS[0][0],\n  creatable: true,\n  minWidth: '14em',\n  debounceDelay: 500,\n};\n\nconst d3TimeFormat: ControlFormItemSpec<'Select'> = {\n  controlType: 'Select',\n  label: t('D3 format'),\n  description: D3_TIME_FORMAT_DOCS,\n  options: D3_TIME_FORMAT_OPTIONS,\n  defaultValue: D3_TIME_FORMAT_OPTIONS[0][0],\n  creatable: true,\n  minWidth: '10em',\n  debounceDelay: 500,\n};\n\nconst fractionDigits: ControlFormItemSpec<'Slider'> = {\n  controlType: 'Slider',\n  label: t('Fraction digits'),\n  description: t('Number of decimal digits to round numbers to'),\n  min: 0,\n  step: 1,\n  max: 100,\n  defaultValue: 100,\n};\n\nconst columnWidth: ControlFormItemSpec<'InputNumber'> = {\n  controlType: 'InputNumber',\n  label: t('Min Width'),\n  description: t(\n    \"Default minimal column width in pixels, actual width may still be larger than this if other columns don't need much space\",\n  ),\n  width: 120,\n  placeholder: 'auto',\n  debounceDelay: 400,\n  validators: [validateNumber],\n};\n\nconst horizontalAlign: ControlFormItemSpec<'RadioButtonControl'> & {\n  value?: 'left' | 'right' | 'center';\n  defaultValue?: 'left' | 'right' | 'center';\n} = {\n  controlType: 'RadioButtonControl',\n  label: t('Text align'),\n  description: t('Horizontal alignment'),\n  width: 130,\n  debounceDelay: 50,\n  defaultValue: 'left',\n  options: [\n    ['left', <FaAlignLeft title={t('Left')} />],\n    ['center', <FaAlignCenter title={t('Center')} />],\n    ['right', <FaAlignRight title={t('Right')} />],\n  ],\n};\n\nconst showCellBars: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Show cell bars'),\n  description: t('Whether to display a bar chart background in table columns'),\n  defaultValue: true,\n  debounceDelay: 200,\n};\n\nconst alignPositiveNegative: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Align +/-'),\n  description: t(\n    'Whether to align positive and negative values in cell bar chart at 0',\n  ),\n  defaultValue: false,\n  debounceDelay: 200,\n};\n\nconst colorPositiveNegative: ControlFormItemSpec<'Checkbox'> = {\n  controlType: 'Checkbox',\n  label: t('Color +/-'),\n  description: t(\n    'Whether to colorize numeric values by if they are positive or negative',\n  ),\n  defaultValue: false,\n  debounceDelay: 200,\n};\n\n/**\n * All configurable column formatting properties.\n */\nexport const SHARED_COLUMN_CONFIG_PROPS = {\n  d3NumberFormat,\n  emitTarget,\n  d3SmallNumberFormat: {\n    ...d3NumberFormat,\n    label: t('Small number format'),\n    description: t(\n      'D3 number format for numbers between -1.0 and 1.0, ' +\n        'useful when you want to have different siginificant digits for small and large numbers',\n    ),\n  },\n  d3TimeFormat,\n  fractionDigits,\n  columnWidth,\n  horizontalAlign,\n  showCellBars,\n  alignPositiveNegative,\n  colorPositiveNegative,\n};\n\nexport type SharedColumnConfig = {\n  [key in SharedColumnConfigProp]?: typeof SHARED_COLUMN_CONFIG_PROPS[key]['value'];\n};\n\nexport const DEFAULT_CONFIG_FORM_LAYOUT: ColumnConfigFormLayout = {\n  [GenericDataType.STRING]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'left' } },\n    ],\n  ],\n  [GenericDataType.NUMERIC]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'right' } },\n    ],\n    ['d3NumberFormat'],\n    ['d3SmallNumberFormat'],\n    ['alignPositiveNegative', 'colorPositiveNegative'],\n    ['showCellBars'],\n  ],\n  [GenericDataType.TEMPORAL]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'left' } },\n    ],\n    ['d3TimeFormat'],\n  ],\n  [GenericDataType.BOOLEAN]: [\n    [\n      'columnWidth',\n      { name: 'horizontalAlign', override: { defaultValue: 'left' } },\n    ],\n  ],\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { GenericDataType } from '@superset-ui/core';\nimport ControlForm, {\n  ControlFormRow,\n  ControlFormItem,\n  ControlFormItemSpec,\n} from '../../../components/ControlForm';\nimport {\n  SHARED_COLUMN_CONFIG_PROPS,\n  SharedColumnConfigProp,\n} from './constants';\nimport {\n  ColumnConfig,\n  ColumnConfigFormLayout,\n  ColumnConfigInfo,\n} from './types';\n\nexport type ColumnConfigPopoverProps = {\n  column: ColumnConfigInfo;\n  configFormLayout: ColumnConfigFormLayout;\n  onChange: (value: ColumnConfig) => void;\n};\n\nexport default function ColumnConfigPopover({\n  column,\n  configFormLayout,\n  onChange,\n}: ColumnConfigPopoverProps) {\n  return (\n    <ControlForm onChange={onChange} value={column.config}>\n      {configFormLayout[\n        column.type === undefined ? GenericDataType.STRING : column.type\n      ].map((row, i) => (\n        <ControlFormRow key={i}>\n          {row.map(meta => {\n            const key = typeof meta === 'string' ? meta : meta.name;\n            const override =\n              typeof meta === 'string'\n                ? {}\n                : 'override' in meta\n                ? meta.override\n                : meta.config;\n            const props = {\n              ...(key in SHARED_COLUMN_CONFIG_PROPS\n                ? SHARED_COLUMN_CONFIG_PROPS[key as SharedColumnConfigProp]\n                : undefined),\n              ...override,\n            } as ControlFormItemSpec;\n            return <ControlFormItem key={key} name={key} {...props} />;\n          })}\n        </ControlFormRow>\n      ))}\n    </ControlForm>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme } from '@superset-ui/core';\nimport { Popover } from 'antd';\nimport ColumnTypeLabel from '../../../components/ColumnTypeLabel/ColumnTypeLabel';\nimport ColumnConfigPopover, {\n  ColumnConfigPopoverProps,\n} from './ColumnConfigPopover';\n\nexport type ColumnConfigItemProps = ColumnConfigPopoverProps;\n\nexport default React.memo(function ColumnConfigItem({\n  column,\n  onChange,\n  configFormLayout,\n}: ColumnConfigItemProps) {\n  const { colors, gridUnit } = useTheme();\n  const caretWidth = gridUnit * 6;\n  return (\n    <Popover\n      title={column.name}\n      content={() => (\n        <ColumnConfigPopover\n          column={column}\n          onChange={onChange}\n          configFormLayout={configFormLayout}\n        />\n      )}\n      trigger=\"click\"\n      placement=\"right\"\n    >\n      <div\n        css={{\n          display: 'flex',\n          alignItems: 'center',\n          cursor: 'pointer',\n          padding: `${gridUnit}px ${2 * gridUnit}px`,\n          borderBottom: `1px solid ${colors.grayscale.light2}`,\n          position: 'relative',\n          paddingRight: caretWidth,\n          '&:last-child': {\n            borderBottom: 'none',\n          },\n          '&:hover': {\n            background: colors.grayscale.light4,\n          },\n          '> .fa': {\n            color: colors.grayscale.light2,\n          },\n          '&:hover > .fa': {\n            color: colors.grayscale.light1,\n          },\n        }}\n      >\n        <ColumnTypeLabel type={column.type} />\n        {column.name}\n        <i\n          className=\"fa fa-caret-right\"\n          css={{\n            position: 'absolute',\n            right: 3 * gridUnit,\n            top: 3 * gridUnit,\n          }}\n        />\n      </div>\n    </Popover>\n  );\n});\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  GenericDataType,\n  JsonObject,\n  StrictJsonValue,\n} from '@superset-ui/core';\nimport { ControlFormItemSpec } from '../../../components/ControlForm';\nimport {\n  SHARED_COLUMN_CONFIG_PROPS,\n  SharedColumnConfigProp,\n} from './constants';\n\n/**\n * Column formatting configs.\n */\nexport type ColumnConfig = {\n  [key in SharedColumnConfigProp]?: typeof SHARED_COLUMN_CONFIG_PROPS[key]['value'];\n} & Record<string, StrictJsonValue>;\n\n/**\n * All required info about a column to render the\n * formatting.\n */\nexport interface ColumnConfigInfo {\n  name: string;\n  type?: GenericDataType;\n  config: JsonObject;\n}\n\nexport type ColumnConfigFormItem =\n  | SharedColumnConfigProp\n  | { name: SharedColumnConfigProp; override: Partial<ControlFormItemSpec> }\n  | { name: string; config: ControlFormItemSpec };\n\nexport type ColumnConfigFormLayout = Record<\n  GenericDataType,\n  ColumnConfigFormItem[][]\n>;\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport RadioButtonControl from './RadioButtonControl';\nimport ColumnConfigControl from './ColumnConfigControl';\n\nexport * from './RadioButtonControl';\nexport * from './ColumnConfigControl';\n\n/**\n * Shared chart controls. Can be referred via string shortcuts in chart control\n * configs.\n */\nexport default {\n  RadioButtonControl,\n  ColumnConfigControl,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState } from 'react';\nimport {\n  ChartDataResponseResult,\n  useTheme,\n  t,\n  GenericDataType,\n} from '@superset-ui/core';\nimport ControlHeader from '../../../components/ControlHeader';\nimport { ControlComponentProps } from '../types';\n\nimport ColumnConfigItem from './ColumnConfigItem';\nimport {\n  ColumnConfigInfo,\n  ColumnConfig,\n  ColumnConfigFormLayout,\n} from './types';\nimport { DEFAULT_CONFIG_FORM_LAYOUT } from './constants';\nimport { COLUMN_NAME_ALIASES } from '../../../constants';\n\nexport type ColumnConfigControlProps<T extends ColumnConfig> =\n  ControlComponentProps<Record<string, T>> & {\n    queryResponse?: ChartDataResponseResult;\n    configFormLayout?: ColumnConfigFormLayout;\n    appliedColumnNames?: string[];\n    emitFilter: boolean;\n  };\n\n/**\n * Max number of columns to show by default.\n */\nconst MAX_NUM_COLS = 10;\n\n/**\n * Add per-column config to queried results.\n */\nexport default function ColumnConfigControl<T extends ColumnConfig>({\n  queryResponse,\n  appliedColumnNames = [],\n  value,\n  onChange,\n  configFormLayout = DEFAULT_CONFIG_FORM_LAYOUT,\n  emitFilter,\n  ...props\n}: ColumnConfigControlProps<T>) {\n  if (emitFilter) {\n    Object.values(configFormLayout).forEach(array_of_array => {\n      if (!array_of_array.some(arr => arr.includes('emitTarget'))) {\n        array_of_array.push(['emitTarget']);\n      }\n    });\n  } else {\n    Object.values(configFormLayout).forEach(array_of_array => {\n      const index = array_of_array.findIndex(arr => arr.includes('emitTarget'));\n      if (index > -1) {\n        array_of_array.splice(index, 1);\n      }\n    });\n  }\n\n  const { colnames: _colnames, coltypes: _coltypes } = queryResponse || {};\n  let colnames: string[] = [];\n  let coltypes: GenericDataType[] = [];\n  if (appliedColumnNames.length === 0) {\n    colnames = _colnames || [];\n    coltypes = _coltypes || [];\n  } else {\n    const appliedCol = new Set(appliedColumnNames);\n    _colnames?.forEach((col, idx) => {\n      if (appliedCol.has(col)) {\n        colnames.push(col);\n        coltypes.push(_coltypes?.[idx] as GenericDataType);\n      }\n    });\n  }\n  const theme = useTheme();\n  const columnConfigs = useMemo(() => {\n    const configs: Record<string, ColumnConfigInfo> = {};\n    colnames?.forEach((col, idx) => {\n      configs[col] = {\n        name: COLUMN_NAME_ALIASES[col] || col,\n        type: coltypes?.[idx],\n        config: value?.[col] || {},\n      };\n    });\n    return configs;\n  }, [value, colnames, coltypes]);\n  const [showAllColumns, setShowAllColumns] = useState(false);\n\n  const getColumnInfo = (col: string) => columnConfigs[col] || {};\n  const setColumnConfig = (col: string, config: T) => {\n    if (onChange) {\n      // Only keep configs for known columns\n      const validConfigs: Record<string, T> =\n        colnames && value\n          ? Object.fromEntries(\n              Object.entries(value).filter(([key]) => colnames.includes(key)),\n            )\n          : { ...value };\n      onChange({\n        ...validConfigs,\n        [col]: config,\n      });\n    }\n  };\n\n  if (!colnames || colnames.length === 0) return null;\n\n  const needShowMoreButton = colnames.length > MAX_NUM_COLS + 2;\n  const cols =\n    needShowMoreButton && !showAllColumns\n      ? colnames.slice(0, MAX_NUM_COLS)\n      : colnames;\n\n  return (\n    <>\n      <ControlHeader {...props} />\n      <div\n        css={{\n          border: `1px solid ${theme.colors.grayscale.light2}`,\n          borderRadius: theme.gridUnit,\n        }}\n      >\n        {cols.map(col => (\n          <ColumnConfigItem\n            key={col}\n            column={getColumnInfo(col)}\n            onChange={config => setColumnConfig(col, config as T)}\n            configFormLayout={configFormLayout}\n          />\n        ))}\n        {needShowMoreButton && (\n          <div\n            role=\"button\"\n            tabIndex={-1}\n            css={{\n              padding: theme.gridUnit * 2,\n              textAlign: 'center',\n              cursor: 'pointer',\n              textTransform: 'uppercase',\n              fontSize: theme.typography.sizes.xs,\n              color: theme.colors.text.label,\n              ':hover': {\n                backgroundColor: theme.colors.grayscale.light4,\n              },\n            }}\n            onClick={() => setShowAllColumns(!showAllColumns)}\n          >\n            {showAllColumns ? (\n              <>\n                <i className=\"fa fa-angle-up\" /> &nbsp; {t('Show less columns')}\n              </>\n            ) : (\n              <>\n                <i className=\"fa fa-angle-down\" /> &nbsp;\n                {t('Show all columns')}\n              </>\n            )}\n          </div>\n        )}\n      </div>\n    </>\n  );\n}\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  FeatureFlag,\n  isFeatureEnabled,\n  QueryColumn,\n  QueryResponse,\n  t,\n  validateNonEmpty,\n} from '@superset-ui/core';\nimport { ExtraControlProps, SharedControlConfig, Dataset } from '../types';\nimport { DATASET_TIME_COLUMN_OPTION, TIME_FILTER_LABELS } from '../constants';\nimport { QUERY_TIME_COLUMN_OPTION, defineSavedMetrics } from '..';\n\nexport const dndGroupByControl: SharedControlConfig<'DndColumnSelect'> = {\n  type: 'DndColumnSelect',\n  label: t('Dimensions'),\n  default: [],\n  description: t(\n    'One or many columns to group by. High cardinality groupings should include a series limit ' +\n      'to limit the number of fetched and rendered series.',\n  ),\n  mapStateToProps(state, { includeTime }) {\n    const newState: ExtraControlProps = {};\n    const { datasource } = state;\n    if (datasource?.columns[0]?.hasOwnProperty('groupby')) {\n      const options = (datasource as Dataset).columns.filter(c => c.groupby);\n      if (includeTime) {\n        options.unshift(DATASET_TIME_COLUMN_OPTION);\n      }\n      newState.options = Object.fromEntries(\n        options.map(option => [option.column_name, option]),\n      );\n      newState.savedMetrics = (datasource as Dataset).metrics || [];\n    } else {\n      const options = datasource?.columns;\n      if (includeTime) {\n        (options as QueryColumn[])?.unshift(QUERY_TIME_COLUMN_OPTION);\n      }\n      newState.options = Object.fromEntries(\n        (options as QueryColumn[])?.map(option => [option.name, option]),\n      );\n      newState.options = datasource?.columns;\n    }\n    return newState;\n  },\n};\n\nexport const dndColumnsControl: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  label: t('Columns'),\n  description: t('One or many columns to pivot as columns'),\n};\n\nexport const dndSeries: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  label: t('Dimensions'),\n  multi: false,\n  default: null,\n  description: t(\n    'Defines the grouping of entities. ' +\n      'Each series is shown as a specific color on the chart and ' +\n      'has a legend toggle',\n  ),\n};\n\nexport const dndEntity: typeof dndGroupByControl = {\n  ...dndGroupByControl,\n  label: t('Entity'),\n  default: null,\n  multi: false,\n  validators: [validateNonEmpty],\n  description: t('This defines the element to be plotted on the chart'),\n};\n\nexport const dnd_adhoc_filters: SharedControlConfig<'DndFilterSelect'> = {\n  type: 'DndFilterSelect',\n  label: t('Filters'),\n  default: [],\n  description: '',\n  mapStateToProps: ({ datasource, form_data }) => ({\n    columns: datasource?.columns[0]?.hasOwnProperty('filterable')\n      ? (datasource as Dataset)?.columns.filter(c => c.filterable)\n      : datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    // current active adhoc metrics\n    selectedMetrics:\n      form_data.metrics || (form_data.metric ? [form_data.metric] : []),\n    datasource,\n  }),\n  provideFormDataToProps: true,\n};\n\nexport const dnd_adhoc_metrics: SharedControlConfig<'DndMetricSelect'> = {\n  type: 'DndMetricSelect',\n  multi: true,\n  label: t('Metrics'),\n  validators: [validateNonEmpty],\n  mapStateToProps: ({ datasource }) => ({\n    columns: datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    datasource,\n    datasourceType: datasource?.type,\n  }),\n  description: t('One or many metrics to display'),\n};\n\nexport const dnd_adhoc_metric: SharedControlConfig<'DndMetricSelect'> = {\n  ...dnd_adhoc_metrics,\n  multi: false,\n  label: t('Metric'),\n  description: t('Metric'),\n};\n\nexport const dnd_adhoc_metric_2: SharedControlConfig<'DndMetricSelect'> = {\n  ...dnd_adhoc_metric,\n  label: t('Right Axis Metric'),\n  description: t('Choose a metric for right axis'),\n};\n\nexport const dnd_sort_by: SharedControlConfig<'DndMetricSelect'> = {\n  type: 'DndMetricSelect',\n  label: t('Sort by'),\n  default: null,\n  description: t(\n    'Metric used to define how the top series are sorted if a series or row limit is present. ' +\n      'If undefined reverts to the first metric (where appropriate).',\n  ),\n  mapStateToProps: ({ datasource }) => ({\n    columns: datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    datasource,\n    datasourceType: datasource?.type,\n  }),\n};\n\nexport const dnd_size: SharedControlConfig<'DndMetricSelect'> = {\n  ...dnd_adhoc_metric,\n  label: t('Bubble Size'),\n  description: t('Metric used to calculate bubble size'),\n};\n\nexport const dnd_x: SharedControlConfig<'DndMetricSelect'> = {\n  ...dnd_adhoc_metric,\n  label: t('X Axis'),\n  description: t('Metric assigned to the [X] axis'),\n};\n\nexport const dnd_y: SharedControlConfig<'DndMetricSelect'> = {\n  ...dnd_adhoc_metric,\n  label: t('Y Axis'),\n  description: t('Metric assigned to the [Y] axis'),\n};\n\nexport const dnd_secondary_metric: SharedControlConfig<'DndMetricSelect'> = {\n  ...dnd_adhoc_metric,\n  label: t('Color Metric'),\n  validators: [],\n  description: t('A metric to use for color'),\n};\n\nexport const dnd_granularity_sqla: typeof dndGroupByControl = {\n  ...dndSeries,\n  label: TIME_FILTER_LABELS.granularity_sqla,\n  description: t(\n    'The time column for the visualization. Note that you ' +\n      'can define arbitrary expression that return a DATETIME ' +\n      'column in the table. Also note that the ' +\n      'filter below is applied against this column or ' +\n      'expression',\n  ),\n  canDelete: false,\n  ghostButtonText: t(\n    isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX)\n      ? 'Drop a temporal column here or click'\n      : 'Drop temporal column here',\n  ),\n  mapStateToProps: ({ datasource }) => {\n    if (datasource?.columns[0]?.hasOwnProperty('column_name')) {\n      const temporalColumns =\n        (datasource as Dataset)?.columns?.filter(c => c.is_dttm) ?? [];\n      const options = Object.fromEntries(\n        temporalColumns.map(option => [option.column_name, option]),\n      );\n      return {\n        options,\n        default:\n          (datasource as Dataset)?.main_dttm_col ||\n          temporalColumns[0]?.column_name ||\n          null,\n        isTemporal: true,\n      };\n    }\n\n    const sortedQueryColumns = (datasource as QueryResponse)?.columns?.sort(\n      query => (query?.is_dttm ? -1 : 1),\n    );\n    const options = Object.fromEntries(\n      sortedQueryColumns.map(option => [option.name, option]),\n    );\n    return {\n      options,\n      default: sortedQueryColumns[0]?.name || null,\n      isTemporal: true,\n    };\n  },\n};\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * This file exports all controls available for use in chart plugins internal to Superset.\n * It is not recommended to use the controls here for any third-party plugins.\n *\n * While the React components located in `controls/components` represent different\n * types of controls (CheckboxControl, SelectControl, TextControl, ...), the controls here\n * represent instances of control types, that can be reused across visualization types.\n *\n * When controls are reused across viz types, their values are carried over as a user\n * changes the chart types.\n *\n * While the keys defined in the control itself get passed to the controlType as props,\n * here's a list of the keys that are common to all controls, and as a result define the\n * control interface.\n */\nimport React from 'react';\nimport { isEmpty } from 'lodash';\nimport {\n  FeatureFlag,\n  t,\n  getCategoricalSchemeRegistry,\n  getSequentialSchemeRegistry,\n  isFeatureEnabled,\n  SequentialScheme,\n  legacyValidateInteger,\n  validateNonEmpty,\n  ComparisionType,\n  QueryResponse,\n  QueryColumn,\n} from '@superset-ui/core';\n\nimport {\n  formatSelectOptions,\n  D3_FORMAT_OPTIONS,\n  D3_FORMAT_DOCS,\n  D3_TIME_FORMAT_OPTIONS,\n  D3_TIME_FORMAT_DOCS,\n  DEFAULT_TIME_FORMAT,\n  DEFAULT_NUMBER_FORMAT,\n  defineSavedMetrics,\n} from '../utils';\nimport { TIME_FILTER_LABELS, DATASET_TIME_COLUMN_OPTION } from '../constants';\nimport {\n  Metric,\n  SharedControlConfig,\n  ColumnMeta,\n  ExtraControlProps,\n  SelectControlConfig,\n  Dataset,\n} from '../types';\nimport { ColumnOption } from '../components/ColumnOption';\n\nimport {\n  dnd_adhoc_filters,\n  dnd_adhoc_metric,\n  dnd_adhoc_metrics,\n  dnd_granularity_sqla,\n  dnd_sort_by,\n  dnd_secondary_metric,\n  dnd_size,\n  dnd_x,\n  dnd_y,\n  dndColumnsControl,\n  dndEntity,\n  dndGroupByControl,\n  dndSeries,\n  dnd_adhoc_metric_2,\n} from './dndControls';\nimport { QUERY_TIME_COLUMN_OPTION } from '..';\n\nconst categoricalSchemeRegistry = getCategoricalSchemeRegistry();\nconst sequentialSchemeRegistry = getSequentialSchemeRegistry();\n\nexport const PRIMARY_COLOR = { r: 0, g: 122, b: 135, a: 1 };\n\nconst ROW_LIMIT_OPTIONS = [10, 50, 100, 250, 500, 1000, 5000, 10000, 50000];\nconst SERIES_LIMITS = [5, 10, 25, 50, 100, 500];\n\nconst appContainer = document.getElementById('app');\nconst { user } = JSON.parse(\n  appContainer?.getAttribute('data-bootstrap') || '{}',\n);\n\ntype Control = {\n  savedMetrics?: Metric[] | null;\n  default?: unknown;\n};\n\ntype SelectDefaultOption = {\n  label: string;\n  value: string;\n};\n\nconst groupByControl: SharedControlConfig<'SelectControl', ColumnMeta> = {\n  type: 'SelectControl',\n  label: t('Dimensions'),\n  multi: true,\n  freeForm: true,\n  clearable: true,\n  default: [],\n  includeTime: false,\n  description: t(\n    'One or many columns to group by. High cardinality groupings should include a sort by metric ' +\n      'and series limit to limit the number of fetched and rendered series.',\n  ),\n  optionRenderer: c => <ColumnOption showType column={c} />,\n  valueRenderer: c => <ColumnOption column={c} />,\n  valueKey: 'column_name',\n  allowAll: true,\n  filterOption: ({ data: opt }, text: string) =>\n    (opt.column_name &&\n      opt.column_name.toLowerCase().includes(text.toLowerCase())) ||\n    (opt.verbose_name &&\n      opt.verbose_name.toLowerCase().includes(text.toLowerCase())) ||\n    false,\n  promptTextCreator: (label: unknown) => label,\n  mapStateToProps(state, { includeTime }) {\n    const newState: ExtraControlProps = {};\n    const { datasource } = state;\n    if (datasource?.columns[0]?.hasOwnProperty('groupby')) {\n      const options = (datasource as Dataset).columns.filter(c => c.groupby);\n      if (includeTime) options.unshift(DATASET_TIME_COLUMN_OPTION);\n      newState.options = options;\n    } else {\n      const options = (datasource as QueryResponse).columns;\n      if (includeTime) options.unshift(QUERY_TIME_COLUMN_OPTION);\n      newState.options = options;\n    }\n    return newState;\n  },\n  commaChoosesOption: false,\n};\n\nconst metrics: SharedControlConfig<'MetricsControl'> = {\n  type: 'MetricsControl',\n  multi: true,\n  label: t('Metrics'),\n  validators: [validateNonEmpty],\n  mapStateToProps: ({ datasource }) => ({\n    columns: datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    datasource,\n    datasourceType: datasource?.type,\n  }),\n  description: t('One or many metrics to display'),\n};\n\nconst metric: SharedControlConfig<'MetricsControl'> = {\n  ...metrics,\n  multi: false,\n  label: t('Metric'),\n  description: t('Metric'),\n};\n\nconst datasourceControl: SharedControlConfig<'DatasourceControl'> = {\n  type: 'DatasourceControl',\n  label: t('Datasource'),\n  default: null,\n  description: null,\n  mapStateToProps: ({ datasource, form_data }) => ({\n    datasource,\n    form_data,\n    user,\n  }),\n};\n\nconst viz_type: SharedControlConfig<'VizTypeControl'> = {\n  type: 'VizTypeControl',\n  label: t('Visualization Type'),\n  default: 'table',\n  description: t('The type of visualization to display'),\n};\n\nconst color_picker: SharedControlConfig<'ColorPickerControl'> = {\n  type: 'ColorPickerControl',\n  label: t('Fixed Color'),\n  description: t('Use this to define a static color for all circles'),\n  default: PRIMARY_COLOR,\n  renderTrigger: true,\n};\n\nconst metric_2: SharedControlConfig<'MetricsControl'> = {\n  ...metric,\n  label: t('Right Axis Metric'),\n  clearable: true,\n  description: t('Choose a metric for right axis'),\n};\n\nconst linear_color_scheme: SharedControlConfig<'ColorSchemeControl'> = {\n  type: 'ColorSchemeControl',\n  label: t('Linear Color Scheme'),\n  choices: () =>\n    (sequentialSchemeRegistry.values() as SequentialScheme[]).map(value => [\n      value.id,\n      value.label,\n    ]),\n  default: sequentialSchemeRegistry.getDefaultKey(),\n  clearable: false,\n  description: '',\n  renderTrigger: true,\n  schemes: () => sequentialSchemeRegistry.getMap(),\n  isLinear: true,\n  mapStateToProps: state => ({\n    dashboardId: state?.form_data?.dashboardId,\n  }),\n};\n\nconst secondary_metric: SharedControlConfig<'MetricsControl'> = {\n  ...metric,\n  label: t('Color Metric'),\n  default: null,\n  validators: [],\n  description: t('A metric to use for color'),\n};\n\nconst columnsControl: typeof groupByControl = {\n  ...groupByControl,\n  label: t('Columns'),\n  description: t('One or many columns to pivot as columns'),\n};\n\nconst druid_time_origin: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: TIME_FILTER_LABELS.druid_time_origin,\n  choices: [\n    ['', 'default'],\n    ['now', 'now'],\n  ],\n  default: null,\n  description: t(\n    'Defines the origin where time buckets start, ' +\n      'accepts natural dates as in `now`, `sunday` or `1970-01-01`',\n  ),\n};\n\nconst granularity: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: TIME_FILTER_LABELS.granularity,\n  default: 'one day',\n  choices: [\n    [null, 'all'],\n    ['PT5S', '5 seconds'],\n    ['PT30S', '30 seconds'],\n    ['PT1M', '1 minute'],\n    ['PT5M', '5 minutes'],\n    ['PT30M', '30 minutes'],\n    ['PT1H', '1 hour'],\n    ['PT6H', '6 hour'],\n    ['P1D', '1 day'],\n    ['P7D', '7 days'],\n    ['P1W', 'week'],\n    ['week_starting_sunday', 'week starting Sunday'],\n    ['week_ending_saturday', 'week ending Saturday'],\n    ['P1M', 'month'],\n    ['P3M', 'quarter'],\n    ['P1Y', 'year'],\n  ],\n  description: t(\n    'The time granularity for the visualization. Note that you ' +\n      'can type and use simple natural language as in `10 seconds`, ' +\n      '`1 day` or `56 weeks`',\n  ),\n};\n\nconst granularity_sqla: SharedControlConfig<'SelectControl', ColumnMeta> = {\n  type: 'SelectControl',\n  label: TIME_FILTER_LABELS.granularity_sqla,\n  description: t(\n    'The time column for the visualization. Note that you ' +\n      'can define arbitrary expression that return a DATETIME ' +\n      'column in the table. Also note that the ' +\n      'filter below is applied against this column or ' +\n      'expression',\n  ),\n  default: (c: Control) => c.default,\n  clearable: false,\n  optionRenderer: c => <ColumnOption showType column={c} />,\n  valueRenderer: c => <ColumnOption column={c} />,\n  valueKey: 'column_name',\n  mapStateToProps: state => {\n    const props: Partial<SelectControlConfig<ColumnMeta | QueryColumn>> = {};\n    const { datasource } = state;\n    if (datasource?.columns[0]?.hasOwnProperty('main_dttm_col')) {\n      const dataset = datasource as Dataset;\n      props.options = dataset.columns.filter((c: ColumnMeta) => c.is_dttm);\n      props.default = null;\n      if (dataset.main_dttm_col) {\n        props.default = dataset.main_dttm_col;\n      } else if (props?.options) {\n        props.default = (props.options[0] as ColumnMeta).column_name;\n      }\n    } else {\n      const sortedQueryColumns = (datasource as QueryResponse)?.columns?.sort(\n        query => (query?.is_dttm ? -1 : 1),\n      );\n      props.options = sortedQueryColumns;\n      if (props?.options) props.default = props.options[0]?.name;\n    }\n    return props;\n  },\n};\n\nconst time_grain_sqla: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  label: TIME_FILTER_LABELS.time_grain_sqla,\n  default: 'P1D',\n  description: t(\n    'The time granularity for the visualization. This ' +\n      'applies a date transformation to alter ' +\n      'your time column and defines a new time granularity. ' +\n      'The options here are defined on a per database ' +\n      'engine basis in the Superset source code.',\n  ),\n  mapStateToProps: ({ datasource }) => ({\n    choices: (datasource as Dataset)?.time_grain_sqla || null,\n  }),\n};\n\nconst time_range: SharedControlConfig<'DateFilterControl'> = {\n  type: 'DateFilterControl',\n  freeForm: true,\n  label: TIME_FILTER_LABELS.time_range,\n  default: t('No filter'), // this value is translated, but the backend wouldn't understand a translated value?\n  description: t(\n    'The time range for the visualization. All relative times, e.g. \"Last month\", ' +\n      '\"Last 7 days\", \"now\", etc. are evaluated on the server using the server\\'s ' +\n      'local time (sans timezone). All tooltips and placeholder times are expressed ' +\n      'in UTC (sans timezone). The timestamps are then evaluated by the database ' +\n      \"using the engine's local timezone. Note one can explicitly set the timezone \" +\n      'per the ISO 8601 format if specifying either the start and/or end time.',\n  ),\n  mapStateToProps: ({ datasource }) => ({\n    datasource,\n  }),\n};\n\nconst row_limit: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Row limit'),\n  validators: [legacyValidateInteger],\n  default: 10000,\n  choices: formatSelectOptions(ROW_LIMIT_OPTIONS),\n  description: t('Limits the number of rows that get displayed.'),\n};\n\nconst order_desc: SharedControlConfig<'CheckboxControl'> = {\n  type: 'CheckboxControl',\n  label: t('Sort Descending'),\n  default: true,\n  description: t('Whether to sort descending or ascending'),\n  visibility: ({ controls }) =>\n    Boolean(\n      controls?.timeseries_limit_metric.value &&\n        !isEmpty(controls?.timeseries_limit_metric.value),\n    ),\n};\n\nconst limit: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Series limit'),\n  validators: [legacyValidateInteger],\n  choices: formatSelectOptions(SERIES_LIMITS),\n  clearable: true,\n  description: t(\n    'Limits the number of series that get displayed. A joined subquery (or an extra phase ' +\n      'where subqueries are not supported) is applied to limit the number of series that get ' +\n      'fetched and rendered. This feature is useful when grouping by high cardinality ' +\n      'column(s) though does increase the query complexity and cost.',\n  ),\n};\n\nconst series_limit: SharedControlConfig<'SelectControl'> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Series limit'),\n  validators: [legacyValidateInteger],\n  choices: formatSelectOptions(SERIES_LIMITS),\n  description: t(\n    'Limits the number of series that get displayed. A joined subquery (or an extra phase ' +\n      'where subqueries are not supported) is applied to limit the number of series that get ' +\n      'fetched and rendered. This feature is useful when grouping by high cardinality ' +\n      'column(s) though does increase the query complexity and cost.',\n  ),\n};\n\nconst sort_by: SharedControlConfig<'MetricsControl'> = {\n  type: 'MetricsControl',\n  label: t('Sort by'),\n  default: null,\n  description: t(\n    'Metric used to define how the top series are sorted if a series or row limit is present. ' +\n      'If undefined reverts to the first metric (where appropriate).',\n  ),\n  mapStateToProps: ({ datasource }) => ({\n    columns: datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    datasource,\n    datasourceType: datasource?.type,\n  }),\n};\n\nconst series: typeof groupByControl = {\n  ...groupByControl,\n  label: t('Dimensions'),\n  multi: false,\n  default: null,\n  description: t(\n    'Defines the grouping of entities. ' +\n      'Each series is shown as a specific color on the chart and ' +\n      'has a legend toggle',\n  ),\n};\n\nconst entity: typeof groupByControl = {\n  ...groupByControl,\n  label: t('Entity'),\n  default: null,\n  multi: false,\n  validators: [validateNonEmpty],\n  description: t('This defines the element to be plotted on the chart'),\n};\n\nconst x: SharedControlConfig<'MetricsControl'> = {\n  ...metric,\n  label: t('X Axis'),\n  description: t('Metric assigned to the [X] axis'),\n  default: null,\n};\n\nconst y: SharedControlConfig<'MetricsControl'> = {\n  ...metric,\n  label: t('Y Axis'),\n  default: null,\n  description: t('Metric assigned to the [Y] axis'),\n};\n\nconst size: SharedControlConfig<'MetricsControl'> = {\n  ...metric,\n  label: t('Bubble Size'),\n  description: t('Metric used to calculate bubble size'),\n  default: null,\n};\n\nconst y_axis_format: SharedControlConfig<'SelectControl', SelectDefaultOption> =\n  {\n    type: 'SelectControl',\n    freeForm: true,\n    label: t('Y Axis Format'),\n    renderTrigger: true,\n    default: DEFAULT_NUMBER_FORMAT,\n    choices: D3_FORMAT_OPTIONS,\n    description: D3_FORMAT_DOCS,\n    tokenSeparators: ['\\n', '\\t', ';'],\n    filterOption: ({ data: option }, search) =>\n      option.label.includes(search) || option.value.includes(search),\n    mapStateToProps: state => {\n      const isPercentage =\n        state.controls?.comparison_type?.value === ComparisionType.Percentage;\n      return {\n        choices: isPercentage\n          ? D3_FORMAT_OPTIONS.filter(option => option[0].includes('%'))\n          : D3_FORMAT_OPTIONS,\n      };\n    },\n  };\n\nconst x_axis_time_format: SharedControlConfig<\n  'SelectControl',\n  SelectDefaultOption\n> = {\n  type: 'SelectControl',\n  freeForm: true,\n  label: t('Time format'),\n  renderTrigger: true,\n  default: DEFAULT_TIME_FORMAT,\n  choices: D3_TIME_FORMAT_OPTIONS,\n  description: D3_TIME_FORMAT_DOCS,\n  filterOption: ({ data: option }, search) =>\n    option.label.includes(search) || option.value.includes(search),\n};\n\nconst adhoc_filters: SharedControlConfig<'AdhocFilterControl'> = {\n  type: 'AdhocFilterControl',\n  label: t('Filters'),\n  default: [],\n  description: '',\n  mapStateToProps: ({ datasource, form_data }) => ({\n    columns: datasource?.columns[0]?.hasOwnProperty('filterable')\n      ? (datasource as Dataset)?.columns.filter(c => c.filterable)\n      : datasource?.columns || [],\n    savedMetrics: defineSavedMetrics(datasource),\n    // current active adhoc metrics\n    selectedMetrics:\n      form_data.metrics || (form_data.metric ? [form_data.metric] : []),\n    datasource,\n  }),\n};\n\nconst color_scheme: SharedControlConfig<'ColorSchemeControl'> = {\n  type: 'ColorSchemeControl',\n  label: t('Color Scheme'),\n  default: categoricalSchemeRegistry.getDefaultKey(),\n  renderTrigger: true,\n  choices: () => categoricalSchemeRegistry.keys().map(s => [s, s]),\n  description: t('The color scheme for rendering chart'),\n  schemes: () => categoricalSchemeRegistry.getMap(),\n  mapStateToProps: state => ({\n    dashboardId: state?.form_data?.dashboardId,\n  }),\n};\n\nconst truncate_metric: SharedControlConfig<'CheckboxControl'> = {\n  type: 'CheckboxControl',\n  label: t('Truncate Metric'),\n  default: true,\n  description: t('Whether to truncate metrics'),\n};\n\nconst enableExploreDnd = isFeatureEnabled(\n  FeatureFlag.ENABLE_EXPLORE_DRAG_AND_DROP,\n);\n\nconst sharedControls = {\n  metrics: enableExploreDnd ? dnd_adhoc_metrics : metrics,\n  metric: enableExploreDnd ? dnd_adhoc_metric : metric,\n  datasource: datasourceControl,\n  viz_type,\n  color_picker,\n  metric_2: enableExploreDnd ? dnd_adhoc_metric_2 : metric_2,\n  linear_color_scheme,\n  secondary_metric: enableExploreDnd ? dnd_secondary_metric : secondary_metric,\n  groupby: enableExploreDnd ? dndGroupByControl : groupByControl,\n  columns: enableExploreDnd ? dndColumnsControl : columnsControl,\n  druid_time_origin,\n  granularity,\n  granularity_sqla: enableExploreDnd ? dnd_granularity_sqla : granularity_sqla,\n  time_grain_sqla,\n  time_range,\n  row_limit,\n  limit,\n  timeseries_limit_metric: enableExploreDnd ? dnd_sort_by : sort_by,\n  orderby: enableExploreDnd ? dnd_sort_by : sort_by,\n  order_desc,\n  series: enableExploreDnd ? dndSeries : series,\n  entity: enableExploreDnd ? dndEntity : entity,\n  x: enableExploreDnd ? dnd_x : x,\n  y: enableExploreDnd ? dnd_y : y,\n  size: enableExploreDnd ? dnd_size : size,\n  y_axis_format,\n  x_axis_time_format,\n  adhoc_filters: enableExploreDnd ? dnd_adhoc_filters : adhoc_filters,\n  color_scheme,\n  series_columns: enableExploreDnd ? dndColumnsControl : columnsControl,\n  series_limit,\n  series_limit_metric: enableExploreDnd ? dnd_sort_by : sort_by,\n  legacy_order_by: enableExploreDnd ? dnd_sort_by : sort_by,\n  truncate_metric,\n};\n\nexport { sharedControls, dndEntity, dndColumnsControl };\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactElement, ReactNode, ReactText } from 'react';\nimport type {\n  AdhocColumn,\n  Column,\n  DatasourceType,\n  JsonValue,\n  Metric,\n  QueryFormColumn,\n  QueryFormData,\n  QueryFormMetric,\n  QueryResponse,\n} from '@superset-ui/core';\nimport { sharedControls } from './shared-controls';\nimport sharedControlComponents from './shared-controls/components';\n\nexport type { Metric } from '@superset-ui/core';\nexport type { ControlFormItemSpec } from './components/ControlForm';\nexport type { ControlComponentProps } from './shared-controls/components/types';\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\ntype AnyDict = Record<string, any>;\ninterface Action {\n  type: string;\n}\ninterface AnyAction extends Action, AnyDict {}\n\nexport type SharedControls = typeof sharedControls;\nexport type SharedControlAlias = keyof typeof sharedControls;\nexport type SharedControlComponents = typeof sharedControlComponents;\n\n/** ----------------------------------------------\n * Input data/props while rendering\n * ---------------------------------------------*/\nexport type ColumnMeta = Omit<Column, 'id'> & {\n  id?: number;\n} & AnyDict;\n\nexport interface Dataset {\n  id: number;\n  type: DatasourceType;\n  columns: ColumnMeta[];\n  metrics: Metric[];\n  column_format: Record<string, string>;\n  verbose_map: Record<string, string>;\n  main_dttm_col: string;\n  // eg. ['[\"ds\", true]', 'ds [asc]']\n  order_by_choices?: [string, string][] | null;\n  time_grain_sqla?: string;\n  granularity_sqla?: string;\n  datasource_name: string | null;\n  description: string | null;\n}\n\nexport interface ControlPanelState {\n  form_data: QueryFormData;\n  datasource: Dataset | QueryResponse | null;\n  controls: ControlStateMapping;\n}\n\n/**\n * The action dispather will call Redux `dispatch` internally and return what's\n * returned from `dispatch`, which by default is the original or another action.\n */\nexport interface ActionDispatcher<\n  ARGS extends unknown[],\n  A extends Action = AnyAction,\n> {\n  (...args: ARGS): A;\n}\n\n/**\n * Mapping of action dispatchers\n */\nexport interface ControlPanelActionDispatchers {\n  setDatasource: ActionDispatcher<[Dataset]>;\n}\n\n/**\n * Additional control props obtained from `mapStateToProps`.\n */\nexport type ExtraControlProps = {\n  value?: JsonValue;\n} & AnyDict;\n\n// Ref:superset-frontend/src/explore/store.js\nexport type ControlState<\n  T = ControlType,\n  O extends SelectOption = SelectOption,\n> = ControlConfig<T, O> & ExtraControlProps;\n\nexport interface ControlStateMapping {\n  [key: string]: ControlState;\n}\n\n// Ref: superset-frontend/src/explore/components/ControlPanelsContainer.jsx\nexport interface ControlPanelsContainerProps extends AnyDict {\n  actions: ControlPanelActionDispatchers;\n  controls: ControlStateMapping;\n  exportState: AnyDict;\n  form_data: QueryFormData;\n}\n\n/** ----------------------------------------------\n * Config for a chart Control\n * ---------------------------------------------*/\n\n// Ref: superset-frontend/src/explore/components/controls/index.js\nexport type InternalControlType =\n  | 'AnnotationLayerControl'\n  | 'BoundsControl'\n  | 'CheckboxControl'\n  | 'CollectionControl'\n  | 'ColorPickerControl'\n  | 'ColorSchemeControl'\n  | 'DatasourceControl'\n  | 'DateFilterControl'\n  | 'FixedOrMetricControl'\n  | 'HiddenControl'\n  | 'SelectAsyncControl'\n  | 'SelectControl'\n  | 'SliderControl'\n  | 'SpatialControl'\n  | 'TextAreaControl'\n  | 'TextControl'\n  | 'TimeSeriesColumnControl'\n  | 'ViewportControl'\n  | 'VizTypeControl'\n  | 'MetricsControl'\n  | 'AdhocFilterControl'\n  | 'FilterBoxItemControl'\n  | 'DndColumnSelect'\n  | 'DndFilterSelect'\n  | 'DndMetricSelect'\n  | keyof SharedControlComponents; // expanded in `expandControlConfig`\n\n// eslint-disable-next-line @typescript-eslint/no-explicit-any\nexport type ControlType = InternalControlType | React.ComponentType<any>;\n\nexport type TabOverride = 'data' | 'customize' | boolean;\n\n/**\n * Control config specifying how chart controls appear in the control panel, all\n * these configs will be passed to the UI component for control as props.\n *\n * - type: the control type, referencing a React component of the same name\n * - label: the label as shown in the control's header\n * - description: shown in the info tooltip of the control's header\n * - default: the default value when opening a new chart, or changing visualization type\n * - renderTrigger: a bool that defines whether the visualization should be re-rendered\n *    when changed. This should `true` for controls that only affect the rendering (client side)\n *    and don't affect the query or backend data processing as those require to re run a query\n *    and fetch the data\n * - validators: an array of functions that will receive the value of the component and\n *    should return error messages when the value is not valid. The error message gets\n *    bubbled up to the control header, section header and query panel header.\n * - warning: text shown as a tooltip on a warning icon in the control's header\n * - error: text shown as a tooltip on a error icon in the control's header\n * - shouldMapStateToProps: a function that receives the previous and current app state\n *   and determines if the control needs to recalculate it's props based on the new state.\n * - mapStateToProps: a function that receives the App's state and return an object of k/v\n *    to overwrite configuration at runtime. This is useful to alter a component based on\n *    anything external to it, like another control's value. For instance it's possible to\n *    show a warning based on the value of another component. It's also possible to bind\n *    arbitrary data from the redux store to the component this way.\n * - tabOverride: set to 'data' if you want to force a renderTrigger to show up on the `Data`\n     tab, or 'customize' if you want it to show up on that tam. Otherwise sections with ALL\n     `renderTrigger: true` components will show up on the `Customize` tab.\n * - visibility: a function that uses control panel props to check whether a control should\n *    be visibile.\n */\nexport interface BaseControlConfig<\n  T extends ControlType = ControlType,\n  O extends SelectOption = SelectOption,\n  V = JsonValue,\n> extends AnyDict {\n  type: T;\n  label?: ReactNode;\n  description?: ReactNode;\n  default?: V;\n  renderTrigger?: boolean;\n  validators?: ControlValueValidator<T, O, V>[];\n  warning?: ReactNode;\n  error?: ReactNode;\n  /**\n   * Add additional props to chart control.\n   */\n  shouldMapStateToProps?: (\n    prevState: ControlPanelState,\n    state: ControlPanelState,\n    controlState: ControlState,\n    // TODO: add strict `chartState` typing (see superset-frontend/src/explore/types)\n    chartState?: AnyDict,\n  ) => boolean;\n  mapStateToProps?: (\n    state: ControlPanelState,\n    controlState: ControlState,\n    // TODO: add strict `chartState` typing (see superset-frontend/src/explore/types)\n    chartState?: AnyDict,\n  ) => ExtraControlProps;\n  visibility?: (\n    props: ControlPanelsContainerProps,\n    controlData: AnyDict,\n  ) => boolean;\n}\n\nexport interface ControlValueValidator<\n  T = ControlType,\n  O extends SelectOption = SelectOption,\n  V = unknown,\n> {\n  (value: V, state?: ControlState<T, O>): boolean | string;\n}\n\n/** --------------------------------------------\n * Additional Config for specific control Types\n * --------------------------------------------- */\nexport type SelectOption = AnyDict | string | [ReactText, ReactNode];\n\nexport type SelectControlType =\n  | 'SelectControl'\n  | 'SelectAsyncControl'\n  | 'MetricsControl'\n  | 'FixedOrMetricControl'\n  | 'AdhocFilterControl'\n  | 'FilterBoxItemControl';\n\n// via react-select/src/filters\nexport interface FilterOption<T extends SelectOption> {\n  label: string;\n  value: string;\n  data: T;\n}\n\n// Ref: superset-frontend/src/components/Select/SupersetStyledSelect.tsx\nexport interface SelectControlConfig<\n  O extends SelectOption = SelectOption,\n  T extends SelectControlType = SelectControlType,\n> extends BaseControlConfig<T, O> {\n  clearable?: boolean;\n  freeForm?: boolean;\n  multi?: boolean;\n  valueKey?: string;\n  labelKey?: string;\n  options?: O[];\n  optionRenderer?: (option: O) => ReactNode;\n  valueRenderer?: (option: O) => ReactNode;\n  filterOption?:\n    | ((option: FilterOption<O>, rawInput: string) => Boolean)\n    | null;\n}\n\nexport type SharedControlConfig<\n  T extends InternalControlType = InternalControlType,\n  O extends SelectOption = SelectOption,\n> = T extends SelectControlType\n  ? SelectControlConfig<O, T>\n  : BaseControlConfig<T>;\n\n/** --------------------------------------------\n * Custom controls\n * --------------------------------------------- */\nexport type CustomControlConfig<P = {}> = BaseControlConfig<\n  React.ComponentType<P>\n> &\n  // two run-time properties from superset-frontend/src/explore/components/Control.jsx\n  Omit<P, 'onChange' | 'hovered'>;\n\n// Catch-all ControlConfig\n//  - if T is known control types, return SharedControlConfig,\n//  - if T is object, assume a CustomComponent\n//  - otherwise assume it's a custom component control\nexport type ControlConfig<\n  T = AnyDict,\n  O extends SelectOption = SelectOption,\n> = T extends InternalControlType\n  ? SharedControlConfig<T, O>\n  : T extends object\n  ? CustomControlConfig<T> // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  : CustomControlConfig<any>;\n\n/** ===========================================================\n * Chart plugin control panel config\n * ========================================================= */\nexport type SharedSectionAlias =\n  | 'annotations'\n  | 'colorScheme'\n  | 'datasourceAndVizType'\n  | 'druidTimeSeries'\n  | 'sqlaTimeSeries'\n  | 'NVD3TimeSeries';\n\nexport interface OverrideSharedControlItem<\n  A extends SharedControlAlias = SharedControlAlias,\n> {\n  name: A;\n  override: Partial<SharedControls[A]>;\n}\n\nexport type CustomControlItem = {\n  name: string;\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  config: BaseControlConfig<any, any, any>;\n};\n\n// use ReactElement instead of ReactNode because `string`, `number`, etc. may\n// interfere with other ControlSetItem types\nexport type ExpandedControlItem = CustomControlItem | ReactElement | null;\n\nexport type ControlSetItem =\n  | SharedControlAlias\n  | OverrideSharedControlItem\n  | ExpandedControlItem;\n\nexport type ControlSetRow = ControlSetItem[];\n\n// Ref:\n//  - superset-frontend/src/explore/components/ControlPanelsContainer.jsx\n//  - superset-frontend/src/explore/components/ControlPanelSection.jsx\nexport interface ControlPanelSectionConfig {\n  label: ReactNode;\n  description?: ReactNode;\n  expanded?: boolean;\n  tabOverride?: TabOverride;\n  controlSetRows: ControlSetRow[];\n}\n\nexport interface StandardizedState {\n  metrics: QueryFormMetric[];\n  columns: QueryFormColumn[];\n}\n\nexport interface StandardizedFormDataInterface {\n  standardizedState: StandardizedState;\n  memorizedFormData: Map<string, QueryFormData>;\n}\n\nexport interface ControlPanelConfig {\n  controlPanelSections: (ControlPanelSectionConfig | null)[];\n  controlOverrides?: ControlOverrides;\n  sectionOverrides?: SectionOverrides;\n  onInit?: (state: ControlStateMapping) => void;\n  denormalizeFormData?: (\n    formData: QueryFormData & {\n      standardizedFormData: StandardizedFormDataInterface;\n    },\n  ) => QueryFormData;\n  updateStandardizedState?: (\n    prevState: StandardizedState,\n    currState: StandardizedState,\n  ) => StandardizedState;\n}\n\nexport type ControlOverrides = {\n  [P in SharedControlAlias]?: Partial<SharedControls[P]>;\n};\n\nexport type SectionOverrides = {\n  [P in SharedSectionAlias]?: Partial<ControlPanelSectionConfig>;\n};\n\n// Ref:\n//  - superset-frontend/src/explore/components/ConditionalFormattingControl.tsx\nexport enum COMPARATOR {\n  NONE = 'None',\n  GREATER_THAN = '>',\n  LESS_THAN = '<',\n  GREATER_OR_EQUAL = '≥',\n  LESS_OR_EQUAL = '≤',\n  EQUAL = '=',\n  NOT_EQUAL = '≠',\n  BETWEEN = '< x <',\n  BETWEEN_OR_EQUAL = '≤ x ≤',\n  BETWEEN_OR_LEFT_EQUAL = '≤ x <',\n  BETWEEN_OR_RIGHT_EQUAL = '< x ≤',\n}\n\nexport const MULTIPLE_VALUE_COMPARATORS = [\n  COMPARATOR.BETWEEN,\n  COMPARATOR.BETWEEN_OR_EQUAL,\n  COMPARATOR.BETWEEN_OR_LEFT_EQUAL,\n  COMPARATOR.BETWEEN_OR_RIGHT_EQUAL,\n];\n\nexport type ConditionalFormattingConfig = {\n  operator?: COMPARATOR;\n  targetValue?: number;\n  targetValueLeft?: number;\n  targetValueRight?: number;\n  column?: string;\n  colorScheme?: string;\n};\n\nexport type ColorFormatters = {\n  column: string;\n  getColorFromValue: (value: number) => string | undefined;\n}[];\n\nexport default {};\n\nexport function isColumnMeta(\n  column: AdhocColumn | ColumnMeta,\n): column is ColumnMeta {\n  return 'column_name' in column;\n}\n\nexport function isSavedExpression(\n  column: AdhocColumn | ColumnMeta,\n): column is ColumnMeta {\n  return (\n    'column_name' in column && 'expression' in column && !!column.expression\n  );\n}\n\nexport function isAdhocColumn(\n  column: AdhocColumn | ColumnMeta,\n): column is AdhocColumn {\n  return 'label' in column && 'sqlExpression' in column;\n}\n\nexport function isControlPanelSectionConfig(\n  section: ControlPanelSectionConfig | null,\n): section is ControlPanelSectionConfig {\n  return section !== null;\n}\n\nexport function isDataset(\n  datasource: Dataset | QueryResponse | null | undefined,\n): datasource is Dataset {\n  return !!datasource && 'columns' in datasource;\n}\n\nexport function isQueryResponse(\n  datasource: Dataset | QueryResponse | null | undefined,\n): datasource is QueryResponse {\n  return (\n    !!datasource &&\n    ('results' in datasource ||\n      datasource?.type === ('query' as DatasourceType.Query))\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t, smartDateFormatter, NumberFormats } from '@superset-ui/core';\n\n// D3 specific formatting config\nexport const D3_FORMAT_DOCS = t(\n  'D3 format syntax: https://github.com/d3/d3-format',\n);\n\n// input choices & options\nexport const D3_FORMAT_OPTIONS: [string, string][] = [\n  [NumberFormats.SMART_NUMBER, t('Adaptive formatting')],\n  ['~g', t('Original value')],\n  [',d', ',d (12345.432 => 12,345)'],\n  ['.1s', '.1s (12345.432 => 10k)'],\n  ['.3s', '.3s (12345.432 => 12.3k)'],\n  [',.1%', ',.1% (12345.432 => 1,234,543.2%)'],\n  ['.2%', '.2% (12345.432 => 1234543.20%)'],\n  ['.3%', '.3% (12345.432 => 1234543.200%)'],\n  ['.4r', '.4r (12345.432 => 12350)'],\n  [',.1f', ',.1f (12345.432 => 12,345.4)'],\n  [',.2f', ',.2f (12345.432 => 12,345.43)'],\n  [',.3f', ',.3f (12345.432 => 12,345.432)'],\n  ['+,', '+, (12345.432 => +12,345.432)'],\n  ['$,.2f', '$,.2f (12345.432 => $12,345.43)'],\n  ['DURATION', t('Duration in ms (66000 => 1m 6s)')],\n  ['DURATION_SUB', t('Duration in ms (1.40008 => 1ms 400µs 80ns)')],\n];\n\nexport const D3_TIME_FORMAT_DOCS = t(\n  'D3 time format syntax: https://github.com/d3/d3-time-format',\n);\n\nexport const D3_TIME_FORMAT_OPTIONS: [string, string][] = [\n  [smartDateFormatter.id, t('Adaptive formatting')],\n  ['%d/%m/%Y', '%d/%m/%Y | 14/01/2019'],\n  ['%m/%d/%Y', '%m/%d/%Y | 01/14/2019'],\n  ['%Y-%m-%d', '%Y-%m-%d | 2019-01-14'],\n  ['%Y-%m-%d %H:%M:%S', '%Y-%m-%d %H:%M:%S | 2019-01-14 01:32:10'],\n  ['%d-%m-%Y %H:%M:%S', '%d-%m-%Y %H:%M:%S | 14-01-2019 01:32:10'],\n  ['%H:%M:%S', '%H:%M:%S | 01:32:10'],\n];\n\nexport const DEFAULT_NUMBER_FORMAT = D3_FORMAT_OPTIONS[0][0];\nexport const DEFAULT_TIME_FORMAT = D3_TIME_FORMAT_OPTIONS[0][0];\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { QueryResponse, DEFAULT_METRICS } from '@superset-ui/core';\nimport { Dataset } from '../types';\n\nexport const defineSavedMetrics = (\n  datasource: Dataset | QueryResponse | null,\n) =>\n  datasource?.hasOwnProperty('metrics')\n    ? (datasource as Dataset)?.metrics || []\n    : DEFAULT_METRICS;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactElement } from 'react';\nimport { sharedControls } from '../shared-controls';\nimport sharedControlComponents from '../shared-controls/components';\nimport {\n  ControlType,\n  ControlSetItem,\n  ExpandedControlItem,\n  ControlOverrides,\n} from '../types';\n\nexport function expandControlType(controlType: ControlType) {\n  if (\n    typeof controlType === 'string' &&\n    controlType in sharedControlComponents\n  ) {\n    return sharedControlComponents[\n      controlType as keyof typeof sharedControlComponents\n    ];\n  }\n  return controlType;\n}\n\n/**\n * Expand a shorthand control config item to full config in the format of\n *   {\n *     name: ...,\n *     config: {\n *        type: ...,\n *        ...\n *     }\n *   }\n */\nexport function expandControlConfig(\n  control: ControlSetItem,\n  controlOverrides: ControlOverrides = {},\n): ExpandedControlItem {\n  // one of the named shared controls\n  if (typeof control === 'string' && control in sharedControls) {\n    const name = control;\n    return {\n      name,\n      config: {\n        ...sharedControls[name],\n        ...controlOverrides[name],\n      },\n    };\n  }\n  // JSX/React element or NULL\n  if (\n    !control ||\n    typeof control === 'string' ||\n    React.isValidElement(control)\n  ) {\n    return control as ReactElement;\n  }\n  // already fully expanded control config, e.g.\n  // {\n  //   name: 'metric',\n  //   config: {\n  //     type: 'SelectControl' | SelectComonent\n  //   }\n  // }\n  if ('name' in control && 'config' in control) {\n    return {\n      ...control,\n      config: {\n        ...control.config,\n        type: expandControlType(control.config.type as ControlType),\n      },\n    };\n  }\n  // apply overrides with shared controls\n  if ('override' in control && control.name in sharedControls) {\n    const { name, override } = control;\n    return {\n      name,\n      config: {\n        ...sharedControls[name],\n        ...override,\n      },\n    };\n  }\n  return null;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// helper functions for select controls\n\nexport type Formattable = string | number;\n\nexport type Formatted = [Formattable, string];\n\n/** Turns an array of string/number options into options for a select input */\nexport function formatSelectOptions<T extends Formattable>(\n  options: (T | [T, string])[],\n): [T, string][] {\n  return options.map(opt => (Array.isArray(opt) ? opt : [opt, opt.toString()]));\n}\n\n/**\n * Outputs array of arrays\n *   >> formatSelectOptionsForRange(1, 5)\n *   >> [[1,'1'], [2,'2'], [3,'3'], [4,'4'], [5,'5']]\n */\nexport function formatSelectOptionsForRange(start: number, end: number) {\n  const options: Formatted[] = [];\n  for (let i = start; i <= end; i += 1) {\n    options.push([i, i.toString()]);\n  }\n  return options;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Registry, makeSingleton } from '../..';\nimport { ChartControlPanel } from '../models/ChartControlPanel';\n\nclass ChartControlPanelRegistry extends Registry<\n  ChartControlPanel,\n  ChartControlPanel\n> {\n  constructor() {\n    super({ name: 'ChartControlPanel' });\n  }\n}\n\nconst getInstance = makeSingleton(ChartControlPanelRegistry);\n\nexport default getInstance;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ExtraFormData } from '../../query';\nimport { JsonObject } from '../..';\n\nexport type HandlerFunction = (...args: unknown[]) => void;\n\nexport enum Behavior {\n  INTERACTIVE_CHART = 'INTERACTIVE_CHART',\n  NATIVE_FILTER = 'NATIVE_FILTER',\n}\n\nexport enum AppSection {\n  EXPLORE = 'EXPLORE',\n  DASHBOARD = 'DASHBOARD',\n  FILTER_BAR = 'FILTER_BAR',\n  FILTER_CONFIG_MODAL = 'FILTER_CONFIG_MODAL',\n  EMBEDDED = 'EMBEDDED',\n}\n\nexport type FilterState = { value?: any; [key: string]: any };\n\nexport type DataMask = {\n  extraFormData?: ExtraFormData;\n  filterState?: FilterState;\n  ownState?: JsonObject;\n};\n\nexport type SetDataMaskHook = {\n  ({ filterState, extraFormData, ownState }: DataMask): void;\n};\n\nexport interface PlainObject {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n}\n\nexport enum ChartLabel {\n  DEPRECATED = 'DEPRECATED',\n  FEATURED = 'FEATURED',\n}\n\nexport const chartLabelExplanations: Record<ChartLabel, string> = {\n  [ChartLabel.DEPRECATED]:\n    'This chart uses features or modules which are no longer actively maintained. It will eventually be replaced or removed.',\n  [ChartLabel.FEATURED]:\n    'This chart was tested and verified, so the overall experience should be stable.',\n};\n\nexport const chartLabelWeight: Record<ChartLabel, { weight: number }> = {\n  [ChartLabel.DEPRECATED]: {\n    weight: -0.1,\n  },\n  [ChartLabel.FEATURED]: {\n    weight: 0.1,\n  },\n};\n\nexport default {};\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport CategoricalColorScale from './CategoricalColorScale';\nimport { ColorsLookup } from './types';\nimport getCategoricalSchemeRegistry from './CategoricalSchemeRegistrySingleton';\nimport stringifyAndTrim from './stringifyAndTrim';\n\nexport default class CategoricalColorNamespace {\n  name: string;\n\n  forcedItems: ColorsLookup;\n\n  scales: {\n    [key: string]: CategoricalColorScale;\n  };\n\n  constructor(name: string) {\n    this.name = name;\n    this.scales = {};\n    this.forcedItems = {};\n  }\n\n  getScale(schemeId?: string) {\n    const id = schemeId ?? getCategoricalSchemeRegistry().getDefaultKey() ?? '';\n    const scheme = getCategoricalSchemeRegistry().get(id);\n    return new CategoricalColorScale(scheme?.colors ?? [], this.forcedItems);\n  }\n\n  /**\n   * Enforce specific color for given value\n   * This will apply across all color scales\n   * in this namespace.\n   * @param {*} value value\n   * @param {*} forcedColor color\n   */\n  setColor(value: string, forcedColor: string) {\n    this.forcedItems[stringifyAndTrim(value)] = forcedColor;\n\n    return this;\n  }\n\n  resetColors() {\n    this.forcedItems = {};\n  }\n}\n\nconst namespaces: {\n  [key: string]: CategoricalColorNamespace;\n} = {};\n\nexport const DEFAULT_NAMESPACE = 'GLOBAL';\n\nexport function getNamespace(name: string = DEFAULT_NAMESPACE) {\n  const instance = namespaces[name];\n  if (instance) {\n    return instance;\n  }\n  const newInstance = new CategoricalColorNamespace(name);\n  namespaces[name] = newInstance;\n\n  return newInstance;\n}\n\nexport function getColor(\n  value?: string,\n  schemeId?: string,\n  namespace?: string,\n) {\n  return getNamespace(namespace).getScale(schemeId).getColor(value);\n}\n\n/*\n  Returns a new scale instance within the same namespace.\n  Especially useful when a chart is booting for the first time\n*/\nexport function getScale(scheme?: string, namespace?: string) {\n  return getNamespace(namespace).getScale(scheme);\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable no-dupe-class-members */\nimport { scaleOrdinal, ScaleOrdinal } from 'd3-scale';\nimport { ExtensibleFunction } from '../models';\nimport { ColorsLookup } from './types';\nimport stringifyAndTrim from './stringifyAndTrim';\nimport getSharedLabelColor from './SharedLabelColorSingleton';\nimport { getAnalogousColors } from './utils';\nimport { FeatureFlag, isFeatureEnabled } from '../utils';\n\n// Use type augmentation to correct the fact that\n// an instance of CategoricalScale is also a function\ninterface CategoricalColorScale {\n  (x: { toString(): string }, y?: number): string;\n}\n\nclass CategoricalColorScale extends ExtensibleFunction {\n  originColors: string[];\n\n  colors: string[];\n\n  scale: ScaleOrdinal<{ toString(): string }, string>;\n\n  parentForcedColors?: ColorsLookup;\n\n  forcedColors: ColorsLookup;\n\n  multiple: number;\n\n  /**\n   * Constructor\n   * @param {*} colors an array of colors\n   * @param {*} parentForcedColors optional parameter that comes from parent\n   * (usually CategoricalColorNamespace) and supersede this.forcedColors\n   */\n  constructor(colors: string[], parentForcedColors?: ColorsLookup) {\n    super((value: string, sliceId?: number) => this.getColor(value, sliceId));\n\n    this.originColors = colors;\n    this.colors = colors;\n    this.scale = scaleOrdinal<{ toString(): string }, string>();\n    this.scale.range(colors);\n    this.parentForcedColors = parentForcedColors;\n    this.forcedColors = {};\n    this.multiple = 0;\n  }\n\n  getColor(value?: string, sliceId?: number) {\n    const cleanedValue = stringifyAndTrim(value);\n    const sharedLabelColor = getSharedLabelColor();\n\n    const parentColor =\n      this.parentForcedColors && this.parentForcedColors[cleanedValue];\n    if (parentColor) {\n      sharedLabelColor.addSlice(cleanedValue, parentColor, sliceId);\n      return parentColor;\n    }\n\n    const forcedColor = this.forcedColors[cleanedValue];\n    if (forcedColor) {\n      sharedLabelColor.addSlice(cleanedValue, forcedColor, sliceId);\n      return forcedColor;\n    }\n\n    if (isFeatureEnabled(FeatureFlag.USE_ANALAGOUS_COLORS)) {\n      const multiple = Math.floor(\n        this.domain().length / this.originColors.length,\n      );\n      if (multiple > this.multiple) {\n        this.multiple = multiple;\n        const newRange = getAnalogousColors(this.originColors, multiple);\n        this.range(this.originColors.concat(newRange));\n      }\n    }\n\n    const color = this.scale(cleanedValue);\n    sharedLabelColor.addSlice(cleanedValue, color, sliceId);\n\n    return color;\n  }\n\n  /**\n   * Enforce specific color for given value\n   * @param {*} value value\n   * @param {*} forcedColor forcedColor\n   */\n  setColor(value: string, forcedColor: string) {\n    this.forcedColors[stringifyAndTrim(value)] = forcedColor;\n    return this;\n  }\n\n  /**\n   * Get a mapping of data values to colors\n   * @returns an object where the key is the data value and the value is the hex color code\n   */\n  getColorMap() {\n    const colorMap: { [key: string]: string | undefined } = {};\n    this.scale.domain().forEach(value => {\n      colorMap[value.toString()] = this.scale(value);\n    });\n\n    return {\n      ...colorMap,\n      ...this.forcedColors,\n      ...this.parentForcedColors,\n    };\n  }\n\n  /**\n   * Returns an exact copy of this scale. Changes to this scale will not affect the returned scale, and vice versa.\n   */\n  copy() {\n    const copy = new CategoricalColorScale(\n      this.scale.range(),\n      this.parentForcedColors,\n    );\n    copy.forcedColors = { ...this.forcedColors };\n    copy.domain(this.domain());\n    copy.unknown(this.unknown());\n\n    return copy;\n  }\n\n  /**\n   * Returns the scale's current domain.\n   */\n  domain(): { toString(): string }[];\n\n  /**\n   * Expands the domain to include the specified array of values.\n   */\n  domain(newDomain: { toString(): string }[]): this;\n\n  domain(newDomain?: { toString(): string }[]): unknown {\n    if (typeof newDomain === 'undefined') {\n      return this.scale.domain();\n    }\n\n    this.scale.domain(newDomain);\n    return this;\n  }\n\n  /**\n   * Returns the scale's current range.\n   */\n  range(): string[];\n\n  /**\n   * Sets the range of the ordinal scale to the specified array of values.\n   *\n   * The first element in the domain will be mapped to the first element in range, the second domain value to the second range value, and so on.\n   *\n   * If there are fewer elements in the range than in the domain, the scale will reuse values from the start of the range.\n   *\n   * @param range Array of range values.\n   */\n  range(newRange: string[]): this;\n\n  range(newRange?: string[]): unknown {\n    if (typeof newRange === 'undefined') {\n      return this.scale.range();\n    }\n\n    this.colors = newRange;\n    this.scale.range(newRange);\n    return this;\n  }\n\n  /**\n   * Returns the current unknown value, which defaults to \"implicit\".\n   */\n  unknown(): string | { name: 'implicit' };\n\n  /**\n   * Sets the output value of the scale for unknown input values and returns this scale.\n   * The implicit value enables implicit domain construction. scaleImplicit can be used as a convenience to set the implicit value.\n   *\n   * @param value Unknown value to be used or scaleImplicit to set implicit scale generation.\n   */\n  unknown(value: string | { name: 'implicit' }): this;\n\n  unknown(value?: string | { name: 'implicit' }): unknown {\n    if (typeof value === 'undefined') {\n      return this.scale.unknown();\n    }\n\n    this.scale.unknown(value);\n    return this;\n  }\n}\n\nexport default CategoricalColorScale;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { CategoricalColorNamespace } from '.';\nimport { FeatureFlag, isFeatureEnabled, makeSingleton } from '../utils';\nimport { getAnalogousColors } from './utils';\n\nexport class SharedLabelColor {\n  sliceLabelColorMap: Record<number, Record<string, string | undefined>>;\n\n  constructor() {\n    // { sliceId1: { label1: color1 }, sliceId2: { label2: color2 } }\n    this.sliceLabelColorMap = {};\n  }\n\n  getColorMap(\n    colorNamespace?: string,\n    colorScheme?: string,\n    updateColorScheme?: boolean,\n  ) {\n    if (colorScheme) {\n      const categoricalNamespace =\n        CategoricalColorNamespace.getNamespace(colorNamespace);\n      const sharedLabels = this.getSharedLabels();\n      let generatedColors: string[] = [];\n      let sharedLabelMap;\n\n      if (sharedLabels.length) {\n        const colorScale = categoricalNamespace.getScale(colorScheme);\n        const colors = colorScale.range();\n        if (isFeatureEnabled(FeatureFlag.USE_ANALAGOUS_COLORS)) {\n          const multiple = Math.ceil(sharedLabels.length / colors.length);\n          generatedColors = getAnalogousColors(colors, multiple);\n          sharedLabelMap = sharedLabels.reduce(\n            (res, label, index) => ({\n              ...res,\n              [label.toString()]: generatedColors[index],\n            }),\n            {},\n          );\n        } else {\n          // reverse colors to reduce color conflicts\n          colorScale.range(colors.reverse());\n          sharedLabelMap = sharedLabels.reduce(\n            (res, label) => ({\n              ...res,\n              [label.toString()]: colorScale(label),\n            }),\n            {},\n          );\n        }\n      }\n\n      const labelMap = Object.keys(this.sliceLabelColorMap).reduce(\n        (res, sliceId) => {\n          // get new color scale instance\n          const colorScale = categoricalNamespace.getScale(colorScheme);\n          return {\n            ...res,\n            ...Object.keys(this.sliceLabelColorMap[sliceId]).reduce(\n              (res, label) => ({\n                ...res,\n                [label]: updateColorScheme\n                  ? colorScale(label)\n                  : this.sliceLabelColorMap[sliceId][label],\n              }),\n              {},\n            ),\n          };\n        },\n        {},\n      );\n\n      return {\n        ...labelMap,\n        ...sharedLabelMap,\n      };\n    }\n    return undefined;\n  }\n\n  addSlice(label: string, color: string, sliceId?: number) {\n    if (!sliceId) return;\n    this.sliceLabelColorMap[sliceId] = {\n      ...this.sliceLabelColorMap[sliceId],\n      [label]: color,\n    };\n  }\n\n  removeSlice(sliceId: number) {\n    delete this.sliceLabelColorMap[sliceId];\n  }\n\n  clear() {\n    this.sliceLabelColorMap = {};\n  }\n\n  getSharedLabels() {\n    const tempLabels = new Set<string>();\n    const result = new Set<string>();\n    Object.keys(this.sliceLabelColorMap).forEach(sliceId => {\n      const colorMap = this.sliceLabelColorMap[sliceId];\n      Object.keys(colorMap).forEach(label => {\n        if (tempLabels.has(label) && !result.has(label)) {\n          result.add(label);\n        } else {\n          tempLabels.add(label);\n        }\n      });\n    });\n    return [...result];\n  }\n}\n\nconst getInstance = makeSingleton(SharedLabelColor);\n\nexport default getInstance;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Ensure value is a string\n * @param {any} value\n */\nexport default function stringifyAndTrim(value?: number | string) {\n  return String(value).trim();\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport tinycolor from 'tinycolor2';\n\nconst rgbRegex = /^rgb\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/;\nexport function getContrastingColor(color: string, thresholds = 186) {\n  let r = 0;\n  let g = 0;\n  let b = 0;\n  if (color.length > 7) {\n    // rgb\n    const matchColor = rgbRegex.exec(color);\n    if (!matchColor) {\n      throw new Error(`Invalid color: ${color}`);\n    }\n    r = parseInt(matchColor[1], 10);\n    g = parseInt(matchColor[2], 10);\n    b = parseInt(matchColor[3], 10);\n  } else {\n    // hex\n    let hex = color;\n    if (hex.startsWith('#')) {\n      hex = hex.substring(1);\n    }\n    // #FFF\n    if (hex.length === 3) {\n      hex = [hex[0], hex[0], hex[1], hex[1], hex[2], hex[2]].join('');\n    }\n    if (hex.length !== 6) {\n      throw new Error(`Invalid color: ${color}`);\n    }\n    r = parseInt(hex.slice(0, 2), 16);\n    g = parseInt(hex.slice(2, 4), 16);\n    b = parseInt(hex.slice(4, 6), 16);\n  }\n\n  return r * 0.299 + g * 0.587 + b * 0.114 > thresholds ? '#000' : '#FFF';\n}\n\nexport function getAnalogousColors(colors: string[], results: number) {\n  const generatedColors: string[] = [];\n  // This is to solve the problem that the first three values generated by tinycolor.analogous\n  // may have the same or very close colors.\n  const ext = 3;\n  const analogousColors = colors.map(color => {\n    const result = tinycolor(color).analogous(results + ext);\n    return result.slice(ext);\n  });\n\n  // [[A, AA, AAA], [B, BB, BBB]] => [A, B, AA, BB, AAA, BBB]\n  while (analogousColors[analogousColors.length - 1]?.length) {\n    analogousColors.forEach(colors => {\n      const color = colors.shift() as tinycolor.Instance;\n      generatedColors.push(color.toHexString());\n    });\n  }\n\n  return generatedColors;\n}\n\nexport function addAlpha(color: string, opacity: number): string {\n  // opacity value should be between 0 and 1.\n  if (opacity > 1 || opacity < 0) {\n    throw new Error(`The opacity should between 0 and 1, but got: ${opacity}`);\n  }\n  // the alpha value is between 00 - FF\n  const alpha = `0${Math.round(opacity * 255)\n    .toString(16)\n    .toUpperCase()}`.slice(-2);\n\n  return `${color}${alpha}`;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Faster debounce delay for inputs without expensive operation.\n */\nexport const FAST_DEBOUNCE = 250;\n\n/**\n * Slower debounce delay for inputs with expensive API calls.\n */\nexport const SLOW_DEBOUNCE = 500;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/** The type of an imported module. Don't fully understand this, yet. */\nexport type Module = any;\n\n/**\n * This is where packages are stored. We use window, because it plays well with Webpack.\n * To avoid\n * Have to amend the type of window, because window's usual type doesn't describe these fields.\n */\ninterface ModuleReferencer {\n  [packageKey: string]: Promise<Module>;\n}\n\ndeclare const window: Window & typeof globalThis & ModuleReferencer;\n\nconst modulePromises: { [key: string]: Promise<Module> } = {};\n\nconst withNamespace = (name: string) => `__superset__/${name}`;\n\n/**\n * Dependency management using global variables, because for the life of me\n * I can't figure out how to hook into UMD from a dynamically imported package.\n *\n * This defines a dynamically imported js module that can be used to import from\n * multiple different plugins.\n *\n * When importing a common module (such as react or lodash or superset-ui)\n * from a plugin, the plugin's build config will be able to\n * reference these globals instead of rebuilding them.\n *\n * @param name the module's name (should match name in package.json)\n * @param promise the promise resulting from a call to `import(name)`\n */\nexport async function defineSharedModule(\n  name: string,\n  fetchModule: () => Promise<Module>,\n) {\n  // this field on window is used by dynamic plugins to reference the module\n  const moduleKey = withNamespace(name);\n\n  if (!window[moduleKey] && !modulePromises[name]) {\n    // if the module has not been loaded, load it\n    const modulePromise = fetchModule();\n    modulePromises[name] = modulePromise;\n    // wait for the module to load, and attach the result to window\n    // so that it can be referenced by plugins\n    window[moduleKey] = await modulePromise;\n  }\n\n  // we always return a reference to the promise.\n  // Multiple consumers can `.then()` or `await` the same promise,\n  // even long after it has completed,\n  // and it will always call back with the same reference.\n  return modulePromises[name];\n}\n\n/**\n * Define multiple shared modules at once, using a map of name -> `import(name)`\n *\n * @see defineSharedModule\n * @param moduleMap\n */\nexport async function defineSharedModules(moduleMap: {\n  [key: string]: () => Promise<Module>;\n}) {\n  return Promise.all(\n    Object.entries(moduleMap).map(([name, fetchModule]) =>\n      defineSharedModule(name, fetchModule),\n    ),\n  );\n}\n\n// only exposed for tests\nexport function reset() {\n  Object.keys(modulePromises).forEach(key => {\n    delete window[withNamespace(key)];\n    delete modulePromises[key];\n  });\n}\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport enum RollingType {\n  Mean = 'mean',\n  Sum = 'sum',\n  Std = 'std',\n  Cumsum = 'cumsum',\n}\nexport interface RollingWindow {\n  rolling_type?: RollingType;\n  rolling_periods?: number;\n  min_periods?: number;\n}\n\nexport enum ComparisionType {\n  Values = 'values',\n  Difference = 'difference',\n  Percentage = 'percentage',\n  Ratio = 'ratio',\n}\nexport interface TimeCompare {\n  time_compare?: string;\n  comparison_type?: ComparisionType;\n}\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { AdhocFilter, DataMask } from '@superset-ui/core';\n\nexport interface NativeFilterColumn {\n  name: string;\n  displayName?: string;\n}\n\nexport interface NativeFilterScope {\n  rootPath: string[];\n  excluded: number[];\n}\n\n/** The target of a filter is the datasource/column being filtered */\nexport interface NativeFilterTarget {\n  datasetId: number;\n  column: NativeFilterColumn;\n\n  // maybe someday support this?\n  // show values from these columns in the filter options selector\n  // clarityColumns?: Column[];\n}\n\nexport enum NativeFilterType {\n  NATIVE_FILTER = 'NATIVE_FILTER',\n  DIVIDER = 'DIVIDER',\n}\n\nexport enum DataMaskType {\n  NativeFilters = 'nativeFilters',\n  CrossFilters = 'crossFilters',\n}\n\nexport type DataMaskState = { [id: string]: DataMask };\n\nexport type DataMaskWithId = { id: string } & DataMask;\nexport type DataMaskStateWithId = { [filterId: string]: DataMaskWithId };\n\nexport type FilterSet = {\n  id: number;\n  name: string;\n  nativeFilters: Filters;\n  dataMask: DataMaskStateWithId;\n};\n\nexport type FilterSets = {\n  [filtersSetId: string]: FilterSet;\n};\n\nexport type Filter = {\n  cascadeParentIds: string[];\n  defaultDataMask: DataMask;\n  id: string; // randomly generated at filter creation\n  name: string;\n  scope: NativeFilterScope;\n  filterType: string;\n  // for now there will only ever be one target\n  // when multiple targets are supported, change this to Target[]\n  targets: [Partial<NativeFilterTarget>];\n  controlValues: {\n    [key: string]: any;\n  };\n  sortMetric?: string | null;\n  adhoc_filters?: AdhocFilter[];\n  granularity_sqla?: string;\n  granularity?: string;\n  druid_time_origin?: string;\n  time_grain_sqla?: string;\n  time_range?: string;\n  requiredFirst?: boolean;\n  tabsInScope?: string[];\n  chartsInScope?: number[];\n  type: typeof NativeFilterType.NATIVE_FILTER;\n  description: string;\n};\n\nexport type Divider = Partial<Omit<Filter, 'id' | 'type'>> & {\n  id: string;\n  title: string;\n  description: string;\n  type: typeof NativeFilterType.DIVIDER;\n};\n\nexport function isNativeFilter(\n  filterElement: Filter | Divider,\n): filterElement is Filter {\n  return filterElement.type === NativeFilterType.NATIVE_FILTER;\n}\n\nexport function isFilterDivider(\n  filterElement: Filter | Divider,\n): filterElement is Divider {\n  return filterElement.type === NativeFilterType.DIVIDER;\n}\n\nexport type FilterConfiguration = Array<Filter | Divider>;\n\nexport type Filters = {\n  [filterId: string]: Filter | Divider;\n};\n\nexport type NativeFiltersState = {\n  filters: Filters;\n  filterSets: FilterSets;\n  focusedFilterId?: string;\n};\n\nexport type DashboardComponentMetadata = {\n  nativeFilters: NativeFiltersState;\n  dataMask: DataMaskStateWithId;\n};\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { TimeseriesDataRecord } from '../../chart';\nimport { AnnotationData } from './AnnotationLayer';\n\n/**\n * Generic data types, see enum of the same name in superset/utils/core.py.\n */\nexport enum GenericDataType {\n  NUMERIC = 0,\n  STRING = 1,\n  TEMPORAL = 2,\n  BOOLEAN = 3,\n}\n\n/**\n * Primitive types for data field values.\n */\nexport type DataRecordValue = number | string | boolean | Date | null;\n\nexport interface DataRecord {\n  [key: string]: DataRecordValue;\n}\n\n/**\n * Queried data for charts. The `queries` field from `POST /chart/data`.\n * See superset/charts/schemas.py for the class of the same name.\n */\nexport interface ChartDataResponseResult {\n  /**\n   * Data for the annotation layer.\n   */\n  annotation_data: AnnotationData | null;\n  cache_key: string | null;\n  cache_timeout: number | null;\n  cached_dttm: string | null;\n  /**\n   * Array of data records as dictionary\n   */\n  data: DataRecord[];\n  /**\n   * Name of each column, for retaining the order of the output columns.\n   */\n  colnames: string[];\n  /**\n   * Generic data types, based on the final output pandas dataframe.\n   */\n  coltypes: GenericDataType[];\n  error: string | null;\n  is_cached: boolean;\n  query: string;\n  rowcount: number;\n  stacktrace: string | null;\n  status:\n    | 'stopped'\n    | 'failed'\n    | 'pending'\n    | 'running'\n    | 'scheduled'\n    | 'success'\n    | 'timed_out';\n  from_dttm: number | null;\n  to_dttm: number | null;\n}\n\nexport interface TimeseriesChartDataResponseResult\n  extends ChartDataResponseResult {\n  data: TimeseriesDataRecord[];\n}\n\n/**\n * Query response from /api/v1/chart/data\n */\nexport interface ChartDataResponse {\n  queries: ChartDataResponseResult[];\n}\n\nexport default {};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function isEqualArray<T extends unknown[] | undefined | null>(\n  arrA: T,\n  arrB: T,\n) {\n  return (\n    arrA === arrB ||\n    (!arrA && !arrB) ||\n    !!(\n      arrA &&\n      arrB &&\n      arrA.length === arrB.length &&\n      arrA.every((x, i) => x === arrB[i])\n    )\n  );\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\n/**\n * formerly called integer()\n * @param v\n */\nexport default function legacyValidateInteger(v: unknown) {\n  if (\n    v &&\n    (Number.isNaN(Number(v)) || parseInt(v as string, 10) !== Number(v))\n  ) {\n    return t('is expected to be an integer');\n  }\n  return false;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\n/**\n * formerly called numeric()\n * @param v\n */\nexport default function numeric(v: unknown) {\n  if (v && Number.isNaN(Number(v))) {\n    return t('is expected to be a number');\n  }\n  return false;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\nexport default function validateNonEmpty(v: unknown) {\n  if (\n    v === null ||\n    typeof v === 'undefined' ||\n    v === '' ||\n    (Array.isArray(v) && v.length === 0)\n  ) {\n    return t('cannot be empty');\n  }\n  return false;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\nexport default function validateInteger(v: unknown) {\n  if (\n    (typeof v === 'string' &&\n      v.trim().length > 0 &&\n      Number.isFinite(Number(v.trim()))) ||\n    (typeof v === 'number' && Number.isFinite(v))\n  ) {\n    return false;\n  }\n\n  return t('is expected to be a number');\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint camelcase: 0 */\nimport { t } from '@superset-ui/core';\nimport { HYDRATE_DASHBOARD } from 'src/dashboard/actions/hydrate';\nimport { DatasourcesAction } from 'src/dashboard/actions/datasources';\nimport { ChartState } from 'src/explore/types';\nimport { getFormDataFromControls } from 'src/explore/controlUtils';\nimport { now } from 'src/utils/dates';\nimport * as actions from './chartAction';\n\nexport const chart: ChartState = {\n  id: 0,\n  chartAlert: null,\n  chartStatus: 'loading',\n  chartStackTrace: null,\n  chartUpdateEndTime: null,\n  chartUpdateStartTime: 0,\n  latestQueryFormData: {},\n  sliceFormData: null,\n  queryController: null,\n  queriesResponse: null,\n  triggerQuery: true,\n  lastRendered: 0,\n};\n\ntype ChartActionHandler = (state: ChartState) => ChartState;\n\ntype AnyChartAction = Record<string, any>;\n\nexport default function chartReducer(\n  charts: Record<string, ChartState> = {},\n  action: AnyChartAction,\n) {\n  const actionHandlers: Record<string, ChartActionHandler> = {\n    [actions.ADD_CHART]() {\n      return {\n        ...chart,\n        ...action.chart,\n      };\n    },\n    [actions.CHART_UPDATE_SUCCEEDED](state) {\n      return {\n        ...state,\n        chartStatus: 'success',\n        chartAlert: null,\n        queriesResponse: action.queriesResponse,\n        chartUpdateEndTime: now(),\n      };\n    },\n    [actions.CHART_UPDATE_STARTED](state) {\n      return {\n        ...state,\n        chartStatus: 'loading',\n        chartStackTrace: null,\n        chartAlert: null,\n        chartUpdateEndTime: null,\n        chartUpdateStartTime: now(),\n        queryController: action.queryController,\n      };\n    },\n    [actions.CHART_UPDATE_STOPPED](state) {\n      return {\n        ...state,\n        chartStatus: 'stopped',\n        chartAlert: t('Updating chart was stopped'),\n        chartUpdateEndTime: now(),\n      };\n    },\n    [actions.CHART_RENDERING_SUCCEEDED](state) {\n      return { ...state, chartStatus: 'rendered', chartUpdateEndTime: now() };\n    },\n    [actions.CHART_RENDERING_FAILED](state) {\n      return {\n        ...state,\n        chartStatus: 'failed',\n        chartStackTrace: action.stackTrace,\n        chartAlert: t(\n          'An error occurred while rendering the visualization: %s',\n          action.error,\n        ),\n      };\n    },\n    [actions.CHART_UPDATE_FAILED](state) {\n      return {\n        ...state,\n        chartStatus: 'failed',\n        chartAlert: action.queriesResponse\n          ? action.queriesResponse?.[0]?.error\n          : t('Network error.'),\n        chartUpdateEndTime: now(),\n        queriesResponse: action.queriesResponse,\n        chartStackTrace: action.queriesResponse\n          ? action.queriesResponse?.[0]?.stacktrace\n          : null,\n      };\n    },\n    [actions.DYNAMIC_PLUGIN_CONTROLS_READY](state) {\n      const sliceFormData = getFormDataFromControls(action.controlsState);\n      return { ...state, sliceFormData };\n    },\n    [actions.TRIGGER_QUERY](state) {\n      return {\n        ...state,\n        triggerQuery: action.value,\n        chartStatus: 'loading',\n      };\n    },\n    [actions.RENDER_TRIGGERED](state) {\n      return { ...state, lastRendered: action.value };\n    },\n    [actions.UPDATE_QUERY_FORM_DATA](state) {\n      return { ...state, latestQueryFormData: action.value };\n    },\n    [actions.ANNOTATION_QUERY_STARTED](state) {\n      if (\n        state.annotationQuery &&\n        state.annotationQuery[action.annotation.name]\n      ) {\n        state.annotationQuery[action.annotation.name].abort();\n      }\n      const annotationQuery = {\n        ...state.annotationQuery,\n        [action.annotation.name]: action.queryController,\n      };\n      return {\n        ...state,\n        annotationQuery,\n      };\n    },\n    [actions.ANNOTATION_QUERY_SUCCESS](state) {\n      const annotationData = {\n        ...state.annotationData,\n        [action.annotation.name]: action.queryResponse.data,\n      };\n      const annotationError = { ...state.annotationError };\n      delete annotationError[action.annotation.name];\n      const annotationQuery = { ...state.annotationQuery };\n      delete annotationQuery[action.annotation.name];\n      return {\n        ...state,\n        annotationData,\n        annotationError,\n        annotationQuery,\n      };\n    },\n    [actions.ANNOTATION_QUERY_FAILED](state) {\n      const annotationData = { ...state.annotationData };\n      delete annotationData[action.annotation.name];\n      const annotationError = {\n        ...state.annotationError,\n        [action.annotation.name]: action.queryResponse\n          ? action.queryResponse.error\n          : t('Network error.'),\n      };\n      const annotationQuery = { ...state.annotationQuery };\n      delete annotationQuery[action.annotation.name];\n      return {\n        ...state,\n        annotationData,\n        annotationError,\n        annotationQuery,\n      };\n    },\n  };\n\n  /* eslint-disable no-param-reassign */\n  if (action.type === actions.REMOVE_CHART) {\n    delete charts[action.key];\n    return charts;\n  }\n  if (action.type === actions.UPDATE_CHART_ID) {\n    const { newId, key } = action;\n    charts[newId] = {\n      ...charts[key],\n      id: newId,\n    };\n    delete charts[key];\n    return charts;\n  }\n  if (action.type === HYDRATE_DASHBOARD) {\n    return { ...action.data.charts };\n  }\n  if (action.type === DatasourcesAction.SET_DATASOURCES) {\n    return Object.fromEntries(\n      Object.entries(charts).map(([chartId, chart]) => [\n        chartId,\n        // some charts may not have properly handled missing datasource,\n        // causing a JS error, so we reset error message and try to re-render\n        // the chart once the datasource is fully loaded\n        chart.chartStatus === 'failed' && chart.chartStackTrace\n          ? {\n              ...chart,\n              chartStatus: '',\n              chartStackTrace: null,\n              chartAlert: null,\n            }\n          : chart,\n      ]),\n    );\n  }\n\n  if (action.type in actionHandlers) {\n    return {\n      ...charts,\n      [action.key]: actionHandlers[action.type](charts[action.key]),\n    };\n  }\n\n  return charts;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme } from '@superset-ui/core';\n\nexport const CheckboxChecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.11 18 18 17.1 18 16V2C18 0.9 17.11 0 16 0Z\"\n        fill={theme.colors.primary.base}\n      />\n      <path\n        d=\"M7 14L2 9L3.41 7.59L7 11.17L14.59 3.58L16 5L7 14Z\"\n        fill=\"white\"\n      />\n    </svg>\n  );\n};\n\nexport const CheckboxHalfChecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z\"\n        fill={theme.colors.grayscale.light1}\n      />\n      <path d=\"M14 10H4V8H14V10Z\" fill=\"white\" />\n    </svg>\n  );\n};\n\nexport const CheckboxUnchecked = () => {\n  const theme = useTheme();\n  return (\n    <svg\n      width=\"18\"\n      height=\"18\"\n      viewBox=\"0 0 18 18\"\n      fill=\"none\"\n      xmlns=\"http://www.w3.org/2000/svg\"\n    >\n      <path\n        d=\"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z\"\n        fill={theme.colors.grayscale.light2}\n      />\n      <path d=\"M16 2V16H2V2H16V2Z\" fill=\"white\" />\n    </svg>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport { CheckboxChecked, CheckboxUnchecked } from 'src/components/Checkbox';\n\nexport interface CheckboxProps {\n  checked: boolean;\n  onChange: (val?: boolean) => void;\n  style?: React.CSSProperties;\n}\n\nconst Styles = styled.span`\n  &,\n  & svg {\n    vertical-align: top;\n  }\n`;\n\nexport default function Checkbox({ checked, onChange, style }: CheckboxProps) {\n  return (\n    <Styles\n      style={style}\n      onClick={() => {\n        onChange(!checked);\n      }}\n      role=\"checkbox\"\n      tabIndex={0}\n      aria-checked={checked}\n      aria-label=\"Checkbox\"\n    >\n      {checked ? <CheckboxChecked /> : <CheckboxUnchecked />}\n    </Styles>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  FunctionComponent,\n  useState,\n  useRef,\n  useEffect,\n  useCallback,\n} from 'react';\nimport Alert from 'src/components/Alert';\nimport { SupersetClient, t, styled } from '@superset-ui/core';\nimport TableView, { EmptyWrapperType } from 'src/components/TableView';\nimport { ServerPagination, SortByType } from 'src/components/TableView/types';\nimport StyledModal from 'src/components/Modal';\nimport Button from 'src/components/Button';\nimport { useListViewResource } from 'src/views/CRUD/hooks';\nimport Dataset from 'src/types/Dataset';\nimport { useDebouncedEffect } from 'src/explore/exploreUtils';\nimport { SLOW_DEBOUNCE } from 'src/constants';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport Loading from 'src/components/Loading';\nimport { AntdInput } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport {\n  PAGE_SIZE as DATASET_PAGE_SIZE,\n  SORT_BY as DATASET_SORT_BY,\n} from 'src/views/CRUD/data/dataset/constants';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport FacePile from '../FacePile';\n\nconst CONFIRM_WARNING_MESSAGE = t(\n  'Warning! Changing the dataset may break the chart if the metadata does not exist.',\n);\n\nconst CHANGE_WARNING_MSG = t(\n  'Changing the dataset may break the chart if the chart relies ' +\n    'on columns or metadata that does not exist in the target dataset',\n);\n\ninterface Datasource {\n  type: string;\n  id: number;\n  uid: string;\n}\n\ninterface ChangeDatasourceModalProps {\n  addDangerToast: (msg: string) => void;\n  addSuccessToast: (msg: string) => void;\n  onChange: (uid: string) => void;\n  onDatasourceSave: (datasource: object, errors?: Array<any>) => {};\n  onHide: () => void;\n  show: boolean;\n}\n\nconst Modal = styled(StyledModal)`\n  .ant-modal-body {\n    display: flex;\n    flex-direction: column;\n  }\n`;\n\nconst ConfirmModalStyled = styled.div`\n  .btn-container {\n    display: flex;\n    justify-content: flex-end;\n    padding: 0px 15px;\n    margin: 10px 0 0 0;\n  }\n\n  .confirm-modal-container {\n    margin: 9px;\n  }\n`;\n\nconst StyledSpan = styled.span`\n  cursor: pointer;\n  color: ${({ theme }) => theme.colors.primary.dark1};\n  &: hover {\n    color: ${({ theme }) => theme.colors.primary.dark2};\n  }\n`;\n\nconst ChangeDatasourceModal: FunctionComponent<ChangeDatasourceModalProps> = ({\n  addDangerToast,\n  addSuccessToast,\n  onChange,\n  onDatasourceSave,\n  onHide,\n  show,\n}) => {\n  const [filter, setFilter] = useState<any>(undefined);\n  const [pageIndex, setPageIndex] = useState<number>(0);\n  const [sortBy, setSortBy] = useState<SortByType>(DATASET_SORT_BY);\n  const [confirmChange, setConfirmChange] = useState(false);\n  const [confirmedDataset, setConfirmedDataset] = useState<Datasource>();\n  const searchRef = useRef<AntdInput>(null);\n\n  const {\n    state: { loading, resourceCollection, resourceCount },\n    fetchData,\n  } = useListViewResource<Dataset>('dataset', t('dataset'), addDangerToast);\n\n  const selectDatasource = useCallback((datasource: Datasource) => {\n    setConfirmChange(true);\n    setConfirmedDataset(datasource);\n  }, []);\n\n  const fetchDatasetPayload = {\n    pageIndex,\n    pageSize: DATASET_PAGE_SIZE,\n    filters: [],\n    sortBy,\n  };\n\n  useDebouncedEffect(\n    () => {\n      fetchData({\n        ...fetchDatasetPayload,\n        ...(filter && {\n          filters: [\n            {\n              id: 'table_name',\n              operator: 'ct',\n              value: filter,\n            },\n          ],\n        }),\n      });\n    },\n    SLOW_DEBOUNCE,\n    [filter, pageIndex, sortBy],\n  );\n\n  useEffect(() => {\n    const onEnterModal = async () => {\n      setTimeout(() => searchRef?.current?.focus(), 200);\n    };\n\n    if (show) {\n      onEnterModal();\n    }\n  }, [\n    addDangerToast,\n    fetchData,\n    onChange,\n    onDatasourceSave,\n    onHide,\n    selectDatasource,\n    show,\n  ]);\n\n  const changeSearch = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const searchValue = event.target.value ?? '';\n    setFilter(searchValue);\n    setPageIndex(0);\n  };\n\n  const handleChangeConfirm = () => {\n    SupersetClient.get({\n      endpoint: `/datasource/get/${confirmedDataset?.type}/${confirmedDataset?.id}/`,\n    })\n      .then(({ json }) => {\n        onDatasourceSave(json);\n        onChange(`${confirmedDataset?.id}__table`);\n      })\n      .catch(response => {\n        getClientErrorObject(response).then(\n          ({ error, message }: { error: any; message: string }) => {\n            const errorMessage = error\n              ? error.error || error.statusText || error\n              : message;\n            addDangerToast(errorMessage);\n          },\n        );\n      });\n    onHide();\n    addSuccessToast('Successfully changed dataset!');\n  };\n\n  const handlerCancelConfirm = () => {\n    setConfirmChange(false);\n  };\n\n  const columns = [\n    {\n      Cell: ({ row: { original } }: any) => (\n        <StyledSpan\n          role=\"button\"\n          tabIndex={0}\n          data-test=\"datasource-link\"\n          onClick={() => selectDatasource({ type: 'table', ...original })}\n        >\n          {original?.table_name}\n        </StyledSpan>\n      ),\n      Header: t('Name'),\n      accessor: 'table_name',\n    },\n    {\n      Header: t('Type'),\n      accessor: 'kind',\n      disableSortBy: true,\n    },\n    {\n      Header: t('Schema'),\n      accessor: 'schema',\n    },\n    {\n      Header: t('Connection'),\n      accessor: 'database.database_name',\n      disableSortBy: true,\n    },\n    {\n      Cell: ({\n        row: {\n          original: { owners = [] },\n        },\n      }: any) => <FacePile users={owners} />,\n      Header: t('Owners'),\n      id: 'owners',\n      disableSortBy: true,\n    },\n  ];\n\n  const onServerPagination = (args: ServerPagination) => {\n    setPageIndex(args.pageIndex);\n    if (args.sortBy) {\n      // ensure default sort by\n      setSortBy(args.sortBy.length > 0 ? args.sortBy : DATASET_SORT_BY);\n    }\n  };\n\n  return (\n    <Modal\n      show={show}\n      onHide={onHide}\n      responsive\n      title={t('Change dataset')}\n      width={confirmChange ? '432px' : ''}\n      height={confirmChange ? 'auto' : '540px'}\n      hideFooter={!confirmChange}\n      footer={\n        <>\n          {confirmChange && (\n            <ConfirmModalStyled>\n              <div className=\"btn-container\">\n                <Button onClick={handlerCancelConfirm}>Cancel</Button>\n                <Button\n                  className=\"proceed-btn\"\n                  buttonStyle=\"primary\"\n                  onClick={handleChangeConfirm}\n                >\n                  Proceed\n                </Button>\n              </div>\n            </ConfirmModalStyled>\n          )}\n        </>\n      }\n    >\n      <>\n        {!confirmChange && (\n          <>\n            <Alert\n              roomBelow\n              type=\"warning\"\n              css={theme => ({ marginBottom: theme.gridUnit * 4 })}\n              message={\n                <>\n                  <strong>{t('Warning!')}</strong> {CHANGE_WARNING_MSG}\n                </>\n              }\n            />\n            <Input\n              ref={searchRef}\n              type=\"text\"\n              value={filter}\n              placeholder={t('Search / Filter')}\n              onChange={changeSearch}\n            />\n            {loading && <Loading />}\n            {!loading && (\n              <TableView\n                columns={columns}\n                data={resourceCollection}\n                pageSize={DATASET_PAGE_SIZE}\n                initialPageIndex={pageIndex}\n                initialSortBy={sortBy}\n                totalCount={resourceCount}\n                onServerPagination={onServerPagination}\n                className=\"table-condensed\"\n                emptyWrapperType={EmptyWrapperType.Small}\n                serverPagination\n                isPaginationSticky\n                scrollTable\n              />\n            )}\n          </>\n        )}\n        {confirmChange && <>{CONFIRM_WARNING_MESSAGE}</>}\n      </>\n    </Modal>\n  );\n};\n\nexport default withToasts(ChangeDatasourceModal);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FunctionComponent, useState, useRef } from 'react';\nimport Alert from 'src/components/Alert';\nimport Button from 'src/components/Button';\nimport { styled, t, SupersetClient } from '@superset-ui/core';\n\nimport Modal from 'src/components/Modal';\nimport AsyncEsmComponent from 'src/components/AsyncEsmComponent';\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\n\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport withToasts from 'src/components/MessageToasts/withToasts';\n\nconst DatasourceEditor = AsyncEsmComponent(() => import('./DatasourceEditor'));\n\nconst StyledDatasourceModal = styled(Modal)`\n  .modal-content {\n    height: 900px;\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .modal-header {\n    flex: 0 1 auto;\n  }\n  .modal-body {\n    flex: 1 1 auto;\n    overflow: auto;\n  }\n\n  .modal-footer {\n    flex: 0 1 auto;\n  }\n`;\n\ninterface DatasourceModalProps {\n  addSuccessToast: (msg: string) => void;\n  datasource: any;\n  onChange: () => {};\n  onDatasourceSave: (datasource: object, errors?: Array<any>) => {};\n  onHide: () => {};\n  show: boolean;\n}\n\nfunction buildExtraJsonObject(item: Record<string, unknown>) {\n  const certification =\n    item?.certified_by || item?.certification_details\n      ? {\n          certified_by: item?.certified_by,\n          details: item?.certification_details,\n        }\n      : undefined;\n  return JSON.stringify({\n    certification,\n    warning_markdown: item?.warning_markdown,\n  });\n}\n\nconst DatasourceModal: FunctionComponent<DatasourceModalProps> = ({\n  addSuccessToast,\n  datasource,\n  onDatasourceSave,\n  onHide,\n  show,\n}) => {\n  const [currentDatasource, setCurrentDatasource] = useState(datasource);\n  const [errors, setErrors] = useState<any[]>([]);\n  const [isSaving, setIsSaving] = useState(false);\n  const [isEditing, setIsEditing] = useState<boolean>(false);\n  const dialog = useRef<any>(null);\n  const [modal, contextHolder] = Modal.useModal();\n\n  const onConfirmSave = () => {\n    // Pull out extra fields into the extra object\n    const schema =\n      currentDatasource.tableSelector?.schema ||\n      currentDatasource.databaseSelector?.schema ||\n      currentDatasource.schema;\n\n    setIsSaving(true);\n    SupersetClient.post({\n      endpoint: '/datasource/save/',\n      postPayload: {\n        data: {\n          ...currentDatasource,\n          schema,\n          metrics: currentDatasource?.metrics?.map(\n            (metric: Record<string, unknown>) => ({\n              ...metric,\n              extra: buildExtraJsonObject(metric),\n            }),\n          ),\n          columns: currentDatasource?.columns?.map(\n            (column: Record<string, unknown>) => ({\n              ...column,\n              extra: buildExtraJsonObject(column),\n            }),\n          ),\n          type: currentDatasource.type || currentDatasource.datasource_type,\n          owners: currentDatasource.owners.map(\n            (o: Record<string, number>) => o.value || o.id,\n          ),\n        },\n      },\n    })\n      .then(({ json }) => {\n        addSuccessToast(t('The dataset has been saved'));\n        onDatasourceSave({\n          ...json,\n          owners: currentDatasource.owners,\n        });\n        onHide();\n      })\n      .catch(response => {\n        setIsSaving(false);\n        getClientErrorObject(response).then(({ error }) => {\n          modal.error({\n            title: 'Error',\n            content: error || t('An error has occurred'),\n            okButtonProps: { danger: true, className: 'btn-danger' },\n          });\n        });\n      });\n  };\n\n  const onDatasourceChange = (data: Record<string, any>, err: Array<any>) => {\n    setCurrentDatasource({\n      ...data,\n      metrics: data?.metrics.map((metric: Record<string, unknown>) => ({\n        ...metric,\n        is_certified: metric?.certified_by || metric?.certification_details,\n      })),\n    });\n    setErrors(err);\n  };\n\n  const renderSaveDialog = () => (\n    <div>\n      <Alert\n        css={theme => ({\n          marginTop: theme.gridUnit * 4,\n          marginBottom: theme.gridUnit * 4,\n        })}\n        type=\"warning\"\n        showIcon\n        message={t(`The dataset configuration exposed here\n                affects all the charts using this dataset.\n                Be mindful that changing settings\n                here may affect other charts\n                in undesirable ways.`)}\n      />\n      {t('Are you sure you want to save and apply changes?')}\n    </div>\n  );\n\n  const onClickSave = () => {\n    dialog.current = modal.confirm({\n      title: t('Confirm save'),\n      content: renderSaveDialog(),\n      onOk: onConfirmSave,\n      icon: null,\n    });\n  };\n\n  const showLegacyDatasourceEditor = !isFeatureEnabled(\n    FeatureFlag.DISABLE_LEGACY_DATASOURCE_EDITOR,\n  );\n\n  return (\n    <StyledDatasourceModal\n      show={show}\n      onHide={onHide}\n      title={\n        <span>\n          {t('Edit Dataset ')}\n          <strong>{currentDatasource.table_name}</strong>\n        </span>\n      }\n      maskClosable={!isEditing}\n      footer={\n        <>\n          {showLegacyDatasourceEditor && (\n            <Button\n              buttonSize=\"small\"\n              buttonStyle=\"default\"\n              data-test=\"datasource-modal-legacy-edit\"\n              className=\"m-r-5\"\n              onClick={() => {\n                window.location.href =\n                  currentDatasource.edit_url || currentDatasource.url;\n              }}\n            >\n              {t('Use legacy datasource editor')}\n            </Button>\n          )}\n          <Button\n            data-test=\"datasource-modal-cancel\"\n            buttonSize=\"small\"\n            className=\"m-r-5\"\n            onClick={onHide}\n          >\n            {t('Cancel')}\n          </Button>\n          <Button\n            buttonSize=\"small\"\n            buttonStyle=\"primary\"\n            data-test=\"datasource-modal-save\"\n            onClick={onClickSave}\n            disabled={\n              isSaving ||\n              errors.length > 0 ||\n              currentDatasource.is_managed_externally\n            }\n            tooltip={\n              currentDatasource.is_managed_externally\n                ? t(\n                    \"This dataset is managed externally, and can't be edited in Superset\",\n                  )\n                : ''\n            }\n          >\n            {t('Save')}\n          </Button>\n        </>\n      }\n      responsive\n    >\n      <DatasourceEditor\n        showLoadingForImport\n        height={500}\n        datasource={currentDatasource}\n        onChange={onDatasourceChange}\n        setIsEditing={setIsEditing}\n      />\n      {contextHolder}\n    </StyledDatasourceModal>\n  );\n};\n\nexport default withToasts(DatasourceModal);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { DatePicker as AntdDatePicker } from 'antd';\nimport { styled } from '@superset-ui/core';\n\nconst AntdRangePicker = AntdDatePicker.RangePicker;\n\nexport const RangePicker = styled(AntdRangePicker)`\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const DatePicker = AntdDatePicker;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useContext, useEffect, useReducer } from 'react';\nimport {\n  ChartMetadata,\n  defineSharedModules,\n  getChartMetadataRegistry,\n  logging,\n  makeApi,\n} from '@superset-ui/core';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport { omitBy } from 'lodash';\n\nconst metadataRegistry = getChartMetadataRegistry();\n\nexport type PluginContextType = {\n  loading: boolean;\n  /** These are actually only the dynamic plugins */\n  dynamicPlugins: {\n    [key: string]: {\n      key: string;\n      mounting: boolean;\n      error: null | Error;\n    };\n  };\n  keys: string[];\n  /** Mounted means the plugin's js bundle has been imported */\n  mountedPluginMetadata: Record<string, ChartMetadata>;\n  fetchAll: () => void;\n};\n\nconst dummyPluginContext: PluginContextType = {\n  loading: true,\n  dynamicPlugins: {},\n  keys: [],\n  mountedPluginMetadata: {},\n  fetchAll: () => {},\n};\n\n/**\n * It is highly recommended to use the usePluginContext hook instead.\n * @see usePluginContext\n */\nexport const PluginContext = React.createContext(dummyPluginContext);\n\n/**\n * The plugin context provides info about what dynamic plugins are available.\n * It also provides loading info for the plugins' javascript bundles.\n *\n * Note: This does not include any information about static plugins.\n * Those are compiled into the Superset bundle at build time.\n * Dynamic plugins are added by the end user and can be any webhosted javascript.\n */\nexport const usePluginContext = () => useContext(PluginContext);\n\n// the plugin returned from the API\ntype Plugin = {\n  name: string;\n  key: string;\n  bundle_url: string;\n  id: number;\n};\n\n// when a plugin completes loading\ntype CompleteAction = {\n  type: 'complete';\n  key: string;\n  error: null | Error;\n};\n\n// when plugins start loading\ntype BeginAction = {\n  type: 'begin';\n  keys: string[];\n};\n\ntype ChangedKeysAction = {\n  type: 'changed keys';\n};\n\ntype PluginAction = BeginAction | CompleteAction | ChangedKeysAction;\n\nfunction getRegistryData() {\n  return {\n    keys: metadataRegistry.keys(),\n    mountedPluginMetadata: omitBy(\n      metadataRegistry.getMap(),\n      value => value === undefined,\n    ) as Record<string, ChartMetadata>, // cast required to get rid of undefined values\n  };\n}\n\nfunction pluginContextReducer(\n  state: PluginContextType,\n  action: PluginAction,\n): PluginContextType {\n  switch (action.type) {\n    case 'begin': {\n      const plugins = { ...state.dynamicPlugins };\n      action.keys.forEach(key => {\n        plugins[key] = { key, error: null, mounting: true };\n      });\n      return {\n        ...state,\n        loading: action.keys.length > 0,\n        dynamicPlugins: plugins,\n      };\n    }\n    case 'complete': {\n      return {\n        ...state,\n        loading: Object.values(state.dynamicPlugins).some(\n          plugin => plugin.mounting && plugin.key !== action.key,\n        ),\n        dynamicPlugins: {\n          ...state.dynamicPlugins,\n          [action.key]: {\n            key: action.key,\n            mounting: false,\n            error: action.error,\n          },\n        },\n      };\n    }\n    case 'changed keys': {\n      return {\n        ...state,\n        ...getRegistryData(),\n      };\n    }\n    default:\n      return state;\n  }\n}\n\nconst pluginApi = makeApi<{}, { result: Plugin[] }>({\n  method: 'GET',\n  endpoint: '/dynamic-plugins/api/read',\n});\n\nconst sharedModules = {\n  react: () => import('react'),\n  lodash: () => import('lodash'),\n  'react-dom': () => import('react-dom'),\n  '@superset-ui/chart-controls': () => import('@superset-ui/chart-controls'),\n  '@superset-ui/core': () => import('@superset-ui/core'),\n};\n\nexport const DynamicPluginProvider: React.FC = ({ children }) => {\n  const [pluginState, dispatch] = useReducer(\n    pluginContextReducer,\n    dummyPluginContext,\n    state => ({\n      ...state,\n      ...getRegistryData(),\n      // eslint-disable-next-line @typescript-eslint/no-use-before-define\n      fetchAll,\n      loading: isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS),\n      // TODO: Write fetchByKeys\n    }),\n  );\n\n  // For now, we fetch all the plugins at the same time.\n  // In the future it would be nice to fetch on an as-needed basis.\n  // That will most likely depend on having a json manifest for each plugin.\n  async function fetchAll() {\n    try {\n      await defineSharedModules(sharedModules);\n      const { result: plugins } = await pluginApi({});\n      dispatch({ type: 'begin', keys: plugins.map(plugin => plugin.key) });\n      await Promise.all(\n        plugins.map(async plugin => {\n          let error: Error | null = null;\n          try {\n            await import(/* webpackIgnore: true */ plugin.bundle_url);\n          } catch (err) {\n            logging.error(\n              `Failed to load plugin ${plugin.key} with the following error:`,\n              err.stack,\n            );\n            error = err;\n          }\n          dispatch({\n            type: 'complete',\n            key: plugin.key,\n            error,\n          });\n        }),\n      );\n    } catch (error) {\n      logging.error('Failed to load dynamic plugins', error.stack || error);\n    }\n  }\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.DYNAMIC_PLUGINS)) {\n      fetchAll();\n    }\n    const registryListener = () => {\n      dispatch({ type: 'changed keys' });\n    };\n    metadataRegistry.addListener(registryListener);\n    return () => {\n      metadataRegistry.removeListener(registryListener);\n    };\n  }, []);\n\n  return (\n    <PluginContext.Provider value={pluginState}>\n      {children}\n    </PluginContext.Provider>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport {\n  getCategoricalSchemeRegistry,\n  styled,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { Avatar } from 'src/components';\nimport { getRandomColor } from './utils';\n\ninterface FacePileProps {\n  users: { first_name: string; last_name: string; id: number }[];\n  maxCount?: number;\n}\n\nconst colorList = getCategoricalSchemeRegistry().get()?.colors ?? [];\n\nconst customAvatarStyler = (theme: SupersetTheme) => `\n  width: ${theme.gridUnit * 6}px;\n  height: ${theme.gridUnit * 6}px;\n  line-height: ${theme.gridUnit * 6}px;\n  font-size: ${theme.typography.sizes.m}px;\n`;\n\nconst StyledAvatar = styled(Avatar)`\n  ${({ theme }) => customAvatarStyler(theme)}\n`;\n\n// to apply styling to the maxCount avatar\nconst StyledGroup = styled(Avatar.Group)`\n  .ant-avatar {\n    ${({ theme }) => customAvatarStyler(theme)}\n  }\n`;\n\nexport default function FacePile({ users, maxCount = 4 }: FacePileProps) {\n  return (\n    <StyledGroup maxCount={maxCount}>\n      {users.map(({ first_name, last_name, id }) => {\n        const name = `${first_name} ${last_name}`;\n        const uniqueKey = `${id}-${first_name}-${last_name}`;\n        const color = getRandomColor(uniqueKey, colorList);\n        return (\n          <Tooltip key={name} title={name} placement=\"top\">\n            <StyledAvatar\n              key={name}\n              style={{\n                backgroundColor: color,\n                borderColor: color,\n              }}\n            >\n              {first_name && first_name[0]?.toLocaleUpperCase()}\n              {last_name && last_name[0]?.toLocaleUpperCase()}\n            </StyledAvatar>\n          </Tooltip>\n        );\n      })}\n    </StyledGroup>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n// https://en.wikipedia.org/wiki/Linear_congruential_generator\nfunction stringAsciiPRNG(value: string, m: number) {\n  // Xn+1 = (a * Xn + c) % m\n  // 0 < a < m\n  // 0 <= c < m\n  // 0 <= X0 < m\n\n  const charCodes = [...value].map(letter => letter.charCodeAt(0));\n  const len = charCodes.length;\n\n  const a = (len % (m - 1)) + 1;\n  const c = charCodes.reduce((current, next) => current + next) % m;\n\n  let random = charCodes[0] % m;\n\n  [...new Array(len)].forEach(() => {\n    random = (a * random + c) % m;\n  });\n\n  return random;\n}\n\nexport function getRandomColor(sampleValue: string, colorList: string[]) {\n  // if no value is passed, always return transparent color for consistency\n  if (!sampleValue) return 'transparent';\n\n  // value based random color index,\n  // ensuring the same sampleValue always resolves to the same color\n  return colorList[stringAsciiPRNG(sampleValue, colorList.length)];\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Popover } from 'antd';\n\nexport { PopoverProps } from 'antd/lib/popover';\nexport { TooltipPlacement } from 'antd/lib/tooltip';\n\n// Eventually Popover can be wrapped and customized in this file\n// for now we're just redirecting\nexport default Popover;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { MouseEventHandler, ReactNode } from 'react';\nimport { useTheme } from '@superset-ui/core';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\n\nexport interface PopoverSectionProps {\n  title: string;\n  isSelected?: boolean;\n  onSelect?: MouseEventHandler<HTMLDivElement>;\n  info?: string;\n  children?: ReactNode;\n}\n\nexport default function PopoverSection({\n  title,\n  isSelected,\n  children,\n  onSelect,\n  info,\n}: PopoverSectionProps) {\n  const theme = useTheme();\n  return (\n    <div\n      css={{\n        paddingBottom: theme.gridUnit * 2,\n        opacity: isSelected ? 1 : theme.opacity.mediumHeavy,\n      }}\n    >\n      <div\n        role=\"button\"\n        tabIndex={0}\n        onClick={onSelect}\n        css={{\n          display: 'flex',\n          alignItems: 'center',\n          cursor: onSelect ? 'pointer' : 'default',\n        }}\n      >\n        <strong data-test=\"popover-title\">{title}</strong>\n        {info && (\n          <Tooltip title={info} css={{ marginLeft: theme.gridUnit }}>\n            <Icons.InfoSolidSmall\n              role=\"img\"\n              width={14}\n              height={14}\n              iconColor={theme.colors.grayscale.light1}\n            />\n          </Tooltip>\n        )}\n        <Icons.Check\n          role=\"img\"\n          iconColor={\n            isSelected ? theme.colors.primary.base : theme.colors.grayscale.base\n          }\n        />\n      </div>\n      <div\n        css={{\n          marginLeft: theme.gridUnit,\n          marginTop: theme.gridUnit,\n        }}\n      >\n        {children}\n      </div>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dispatch } from 'redux';\nimport { makeApi, CategoricalColorNamespace } from '@superset-ui/core';\nimport { isString } from 'lodash';\nimport { ChartConfiguration, DashboardInfo } from '../reducers/types';\n\nexport const DASHBOARD_INFO_UPDATED = 'DASHBOARD_INFO_UPDATED';\n\nexport function updateColorSchema(\n  metadata: Record<string, any>,\n  labelColors: Record<string, string>,\n) {\n  const categoricalNamespace = CategoricalColorNamespace.getNamespace(\n    metadata?.color_namespace,\n  );\n  const colorMap = isString(labelColors)\n    ? JSON.parse(labelColors)\n    : labelColors;\n  Object.keys(colorMap).forEach(label => {\n    categoricalNamespace.setColor(label, colorMap[label]);\n  });\n}\n\n// updates partially changed dashboard info\nexport function dashboardInfoChanged(newInfo: { metadata: any }) {\n  const { metadata } = newInfo;\n\n  const categoricalNamespace = CategoricalColorNamespace.getNamespace(\n    metadata?.color_namespace,\n  );\n\n  categoricalNamespace.resetColors();\n\n  if (metadata?.shared_label_colors) {\n    updateColorSchema(metadata, metadata?.shared_label_colors);\n  }\n\n  if (metadata?.label_colors) {\n    updateColorSchema(metadata, metadata?.label_colors);\n  }\n\n  return { type: DASHBOARD_INFO_UPDATED, newInfo };\n}\nexport const SET_CHART_CONFIG_BEGIN = 'SET_CHART_CONFIG_BEGIN';\nexport interface SetChartConfigBegin {\n  type: typeof SET_CHART_CONFIG_BEGIN;\n  chartConfiguration: ChartConfiguration;\n}\nexport const SET_CHART_CONFIG_COMPLETE = 'SET_CHART_CONFIG_COMPLETE';\nexport interface SetChartConfigComplete {\n  type: typeof SET_CHART_CONFIG_COMPLETE;\n  chartConfiguration: ChartConfiguration;\n}\nexport const SET_CHART_CONFIG_FAIL = 'SET_CHART_CONFIG_FAIL';\nexport interface SetChartConfigFail {\n  type: typeof SET_CHART_CONFIG_FAIL;\n  chartConfiguration: ChartConfiguration;\n}\nexport const setChartConfiguration =\n  (chartConfiguration: ChartConfiguration) =>\n  async (dispatch: Dispatch, getState: () => any) => {\n    dispatch({\n      type: SET_CHART_CONFIG_BEGIN,\n      chartConfiguration,\n    });\n    const { id, metadata } = getState().dashboardInfo;\n\n    // TODO extract this out when makeApi supports url parameters\n    const updateDashboard = makeApi<\n      Partial<DashboardInfo>,\n      { result: DashboardInfo }\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n\n    try {\n      const response = await updateDashboard({\n        json_metadata: JSON.stringify({\n          ...metadata,\n          chart_configuration: chartConfiguration,\n        }),\n      });\n      dispatch(\n        dashboardInfoChanged({\n          metadata: JSON.parse(response.result.json_metadata),\n        }),\n      );\n      dispatch({\n        type: SET_CHART_CONFIG_COMPLETE,\n        chartConfiguration,\n      });\n    } catch (err) {\n      dispatch({ type: SET_CHART_CONFIG_FAIL, chartConfiguration });\n    }\n  };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dispatch } from 'redux';\nimport { SupersetClient } from '@superset-ui/core';\nimport { Datasource, RootState } from 'src/dashboard/types';\n\n// update datasources index for Dashboard\nexport enum DatasourcesAction {\n  SET_DATASOURCES = 'SET_DATASOURCES',\n  SET_DATASOURCE = 'SET_DATASOURCE',\n}\n\nexport type DatasourcesActionPayload =\n  | {\n      type: DatasourcesAction.SET_DATASOURCES;\n      datasources: Datasource[] | null;\n    }\n  | {\n      type: DatasourcesAction.SET_DATASOURCE;\n      key: Datasource['uid'];\n      datasource: Datasource;\n    };\n\nexport function setDatasources(datasources: Datasource[] | null) {\n  return {\n    type: DatasourcesAction.SET_DATASOURCES,\n    datasources,\n  };\n}\n\nexport function setDatasource(datasource: Datasource, key: string) {\n  return {\n    type: DatasourcesAction.SET_DATASOURCE,\n    key,\n    datasource,\n  };\n}\n\nexport function fetchDatasourceMetadata(key: string) {\n  return (dispatch: Dispatch, getState: () => RootState) => {\n    const { datasources } = getState();\n    const datasource = datasources[key];\n\n    if (datasource) {\n      return dispatch(setDatasource(datasource, key));\n    }\n\n    return SupersetClient.get({\n      endpoint: `/superset/fetch_datasource_metadata?datasourceKey=${key}`,\n    }).then(({ json }) => dispatch(setDatasource(json as Datasource, key)));\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  FilterConfiguration,\n  Filters,\n  FilterSet,\n  FilterSets,\n  makeApi,\n} from '@superset-ui/core';\nimport { Dispatch } from 'redux';\nimport {\n  SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL,\n  setDataMaskForFilterConfigComplete,\n} from 'src/dataMask/actions';\nimport { HYDRATE_DASHBOARD } from './hydrate';\nimport { dashboardInfoChanged } from './dashboardInfo';\nimport { FilterSetFullData } from '../reducers/types';\nimport { DashboardInfo, RootState } from '../types';\n\nexport const SET_FILTER_CONFIG_BEGIN = 'SET_FILTER_CONFIG_BEGIN';\nexport interface SetFilterConfigBegin {\n  type: typeof SET_FILTER_CONFIG_BEGIN;\n  filterConfig: FilterConfiguration;\n}\n\nexport const SET_FILTER_CONFIG_COMPLETE = 'SET_FILTER_CONFIG_COMPLETE';\nexport interface SetFilterConfigComplete {\n  type: typeof SET_FILTER_CONFIG_COMPLETE;\n  filterConfig: FilterConfiguration;\n}\nexport const SET_FILTER_CONFIG_FAIL = 'SET_FILTER_CONFIG_FAIL';\nexport interface SetFilterConfigFail {\n  type: typeof SET_FILTER_CONFIG_FAIL;\n  filterConfig: FilterConfiguration;\n}\nexport const SET_IN_SCOPE_STATUS_OF_FILTERS = 'SET_IN_SCOPE_STATUS_OF_FILTERS';\nexport interface SetInScopeStatusOfFilters {\n  type: typeof SET_IN_SCOPE_STATUS_OF_FILTERS;\n  filterConfig: FilterConfiguration;\n}\nexport const SET_FILTER_SETS_BEGIN = 'SET_FILTER_SETS_BEGIN';\nexport interface SetFilterSetsBegin {\n  type: typeof SET_FILTER_SETS_BEGIN;\n}\nexport const SET_FILTER_SETS_COMPLETE = 'SET_FILTER_SETS_COMPLETE';\nexport interface SetFilterSetsComplete {\n  type: typeof SET_FILTER_SETS_COMPLETE;\n  filterSets: FilterSet[];\n}\nexport const SET_FILTER_SETS_FAIL = 'SET_FILTER_SETS_FAIL';\nexport interface SetFilterSetsFail {\n  type: typeof SET_FILTER_SETS_FAIL;\n}\n\nexport const CREATE_FILTER_SET_BEGIN = 'CREATE_FILTER_SET_BEGIN';\nexport interface CreateFilterSetBegin {\n  type: typeof CREATE_FILTER_SET_BEGIN;\n}\nexport const CREATE_FILTER_SET_COMPLETE = 'CREATE_FILTER_SET_COMPLETE';\nexport interface CreateFilterSetComplete {\n  type: typeof CREATE_FILTER_SET_COMPLETE;\n  filterSet: FilterSet;\n}\nexport const CREATE_FILTER_SET_FAIL = 'CREATE_FILTER_SET_FAIL';\nexport interface CreateFilterSetFail {\n  type: typeof CREATE_FILTER_SET_FAIL;\n}\n\nexport const DELETE_FILTER_SET_BEGIN = 'DELETE_FILTER_SET_BEGIN';\nexport interface DeleteFilterSetBegin {\n  type: typeof DELETE_FILTER_SET_BEGIN;\n}\nexport const DELETE_FILTER_SET_COMPLETE = 'DELETE_FILTER_SET_COMPLETE';\nexport interface DeleteFilterSetComplete {\n  type: typeof DELETE_FILTER_SET_COMPLETE;\n  filterSet: FilterSet;\n}\nexport const DELETE_FILTER_SET_FAIL = 'DELETE_FILTER_SET_FAIL';\nexport interface DeleteFilterSetFail {\n  type: typeof DELETE_FILTER_SET_FAIL;\n}\n\nexport const UPDATE_FILTER_SET_BEGIN = 'UPDATE_FILTER_SET_BEGIN';\nexport interface UpdateFilterSetBegin {\n  type: typeof UPDATE_FILTER_SET_BEGIN;\n}\nexport const UPDATE_FILTER_SET_COMPLETE = 'UPDATE_FILTER_SET_COMPLETE';\nexport interface UpdateFilterSetComplete {\n  type: typeof UPDATE_FILTER_SET_COMPLETE;\n  filterSet: FilterSet;\n}\nexport const UPDATE_FILTER_SET_FAIL = 'UPDATE_FILTER_SET_FAIL';\nexport interface UpdateFilterSetFail {\n  type: typeof UPDATE_FILTER_SET_FAIL;\n}\n\nexport const setFilterConfiguration =\n  (filterConfig: FilterConfiguration) =>\n  async (dispatch: Dispatch, getState: () => any) => {\n    dispatch({\n      type: SET_FILTER_CONFIG_BEGIN,\n      filterConfig,\n    });\n    const { id, metadata } = getState().dashboardInfo;\n    const oldFilters = getState().nativeFilters?.filters;\n\n    // TODO extract this out when makeApi supports url parameters\n    const updateDashboard = makeApi<\n      Partial<DashboardInfo>,\n      { result: DashboardInfo }\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${id}`,\n    });\n\n    const mergedFilterConfig = filterConfig.map(filter => {\n      const oldFilter = oldFilters[filter.id];\n      if (!oldFilter) {\n        return filter;\n      }\n      return { ...oldFilter, ...filter };\n    });\n\n    try {\n      const response = await updateDashboard({\n        json_metadata: JSON.stringify({\n          ...metadata,\n          native_filter_configuration: mergedFilterConfig,\n        }),\n      });\n      dispatch(\n        dashboardInfoChanged({\n          metadata: JSON.parse(response.result.json_metadata),\n        }),\n      );\n      dispatch({\n        type: SET_FILTER_CONFIG_COMPLETE,\n        filterConfig: mergedFilterConfig,\n      });\n      dispatch(\n        setDataMaskForFilterConfigComplete(mergedFilterConfig, oldFilters),\n      );\n    } catch (err) {\n      dispatch({\n        type: SET_FILTER_CONFIG_FAIL,\n        filterConfig: mergedFilterConfig,\n      });\n      dispatch({\n        type: SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL,\n        filterConfig: mergedFilterConfig,\n      });\n    }\n  };\n\nexport const setInScopeStatusOfFilters =\n  (\n    filterScopes: {\n      filterId: string;\n      chartsInScope: number[];\n      tabsInScope: string[];\n    }[],\n  ) =>\n  async (dispatch: Dispatch, getState: () => any) => {\n    const filters = getState().nativeFilters?.filters;\n    const filtersWithScopes = filterScopes.map(scope => ({\n      ...filters[scope.filterId],\n      chartsInScope: scope.chartsInScope,\n      tabsInScope: scope.tabsInScope,\n    }));\n    dispatch({\n      type: SET_IN_SCOPE_STATUS_OF_FILTERS,\n      filterConfig: filtersWithScopes,\n    });\n    // need to update native_filter_configuration in the dashboard metadata\n    const { metadata } = getState().dashboardInfo;\n    const filterConfig: FilterConfiguration =\n      metadata.native_filter_configuration;\n    const mergedFilterConfig = filterConfig.map(filter => {\n      const filterWithScope = filtersWithScopes.find(\n        scope => scope.id === filter.id,\n      );\n      if (!filterWithScope) {\n        return filter;\n      }\n      return { ...filterWithScope, ...filter };\n    });\n    metadata.native_filter_configuration = mergedFilterConfig;\n    dispatch(\n      dashboardInfoChanged({\n        metadata,\n      }),\n    );\n  };\n\ntype BootstrapData = {\n  nativeFilters: {\n    filters: Filters;\n    filterSets: FilterSets;\n    filtersState: object;\n  };\n};\n\nexport interface SetBootstrapData {\n  type: typeof HYDRATE_DASHBOARD;\n  data: BootstrapData;\n}\n\nexport const getFilterSets =\n  (dashboardId: number) => async (dispatch: Dispatch) => {\n    const fetchFilterSets = makeApi<\n      null,\n      {\n        count: number;\n        ids: number[];\n        result: FilterSetFullData[];\n      }\n    >({\n      method: 'GET',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets`,\n    });\n\n    dispatch({\n      type: SET_FILTER_SETS_BEGIN,\n    });\n\n    const response = await fetchFilterSets(null);\n\n    dispatch({\n      type: SET_FILTER_SETS_COMPLETE,\n      filterSets: response.ids.map((id, i) => ({\n        ...response.result[i].params,\n        id,\n        name: response.result[i].name,\n      })),\n    });\n  };\n\nexport const createFilterSet =\n  (filterSet: Omit<FilterSet, 'id'>) =>\n  async (dispatch: Function, getState: () => RootState) => {\n    const dashboardId = getState().dashboardInfo.id;\n    const postFilterSets = makeApi<\n      Partial<FilterSetFullData & { json_metadata: any }>,\n      {\n        count: number;\n        ids: number[];\n        result: FilterSetFullData[];\n      }\n    >({\n      method: 'POST',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets`,\n    });\n\n    dispatch({\n      type: CREATE_FILTER_SET_BEGIN,\n    });\n\n    const serverFilterSet: Omit<FilterSet, 'id' | 'name'> & { name?: string } =\n      {\n        ...filterSet,\n      };\n\n    delete serverFilterSet.name;\n\n    await postFilterSets({\n      name: filterSet.name,\n      owner_type: 'Dashboard',\n      owner_id: dashboardId,\n      json_metadata: JSON.stringify(serverFilterSet),\n    });\n\n    dispatch({\n      type: CREATE_FILTER_SET_COMPLETE,\n    });\n    dispatch(getFilterSets(dashboardId));\n  };\n\nexport const updateFilterSet =\n  (filterSet: FilterSet) =>\n  async (dispatch: Function, getState: () => RootState) => {\n    const dashboardId = getState().dashboardInfo.id;\n    const postFilterSets = makeApi<\n      Partial<FilterSetFullData & { json_metadata: any }>,\n      {}\n    >({\n      method: 'PUT',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets/${filterSet.id}`,\n    });\n\n    dispatch({\n      type: UPDATE_FILTER_SET_BEGIN,\n    });\n\n    const serverFilterSet: Omit<FilterSet, 'id' | 'name'> & {\n      name?: string;\n      id?: number;\n    } = {\n      ...filterSet,\n    };\n\n    delete serverFilterSet.id;\n    delete serverFilterSet.name;\n\n    await postFilterSets({\n      name: filterSet.name,\n      json_metadata: JSON.stringify(serverFilterSet),\n    });\n\n    dispatch({\n      type: UPDATE_FILTER_SET_COMPLETE,\n    });\n    dispatch(getFilterSets(dashboardId));\n  };\n\nexport const deleteFilterSet =\n  (filterSetId: number) =>\n  async (dispatch: Function, getState: () => RootState) => {\n    const dashboardId = getState().dashboardInfo.id;\n    const deleteFilterSets = makeApi<{}, {}>({\n      method: 'DELETE',\n      endpoint: `/api/v1/dashboard/${dashboardId}/filtersets/${filterSetId}`,\n    });\n\n    dispatch({\n      type: DELETE_FILTER_SET_BEGIN,\n    });\n\n    await deleteFilterSets({});\n\n    dispatch({\n      type: DELETE_FILTER_SET_COMPLETE,\n    });\n    dispatch(getFilterSets(dashboardId));\n  };\n\nexport const SET_FOCUSED_NATIVE_FILTER = 'SET_FOCUSED_NATIVE_FILTER';\nexport interface SetFocusedNativeFilter {\n  type: typeof SET_FOCUSED_NATIVE_FILTER;\n  id: string;\n}\nexport const UNSET_FOCUSED_NATIVE_FILTER = 'UNSET_FOCUSED_NATIVE_FILTER';\nexport interface UnsetFocusedNativeFilter {\n  type: typeof UNSET_FOCUSED_NATIVE_FILTER;\n}\n\nexport function setFocusedNativeFilter(id: string): SetFocusedNativeFilter {\n  return {\n    type: SET_FOCUSED_NATIVE_FILTER,\n    id,\n  };\n}\nexport function unsetFocusedNativeFilter(): UnsetFocusedNativeFilter {\n  return {\n    type: UNSET_FOCUSED_NATIVE_FILTER,\n  };\n}\n\nexport type AnyFilterAction =\n  | SetFilterConfigBegin\n  | SetFilterConfigComplete\n  | SetFilterConfigFail\n  | SetFilterSetsBegin\n  | SetFilterSetsComplete\n  | SetFilterSetsFail\n  | SetInScopeStatusOfFilters\n  | SetBootstrapData\n  | SetFocusedNativeFilter\n  | UnsetFocusedNativeFilter\n  | CreateFilterSetBegin\n  | CreateFilterSetComplete\n  | CreateFilterSetFail\n  | DeleteFilterSetBegin\n  | DeleteFilterSetComplete\n  | DeleteFilterSetFail\n  | UpdateFilterSetBegin\n  | UpdateFilterSetComplete\n  | UpdateFilterSetFail;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { FormInstance } from 'src/components';\nimport shortid from 'shortid';\nimport { getInitialDataMask } from 'src/dataMask/reducer';\nimport {\n  Filter,\n  FilterConfiguration,\n  NativeFilterType,\n  Divider,\n  NativeFilterTarget,\n  logging,\n} from '@superset-ui/core';\nimport { DASHBOARD_ROOT_ID } from 'src/dashboard/util/constants';\nimport { FilterRemoval, NativeFiltersForm } from './types';\n\nexport const REMOVAL_DELAY_SECS = 5;\n\nexport const hasCircularDependency = (\n  dependencyMap: Map<string, string[]>,\n  filterId: string,\n  trace: string[] = [],\n): boolean => {\n  if (trace.includes(filterId)) {\n    return true;\n  }\n  const dependencies = dependencyMap.get(filterId);\n  if (dependencies) {\n    return dependencies.some(dependency =>\n      hasCircularDependency(dependencyMap, dependency, [...trace, filterId]),\n    );\n  }\n  return false;\n};\n\nexport const validateForm = async (\n  form: FormInstance<NativeFiltersForm>,\n  currentFilterId: string,\n  setCurrentFilterId: Function,\n) => {\n  try {\n    let formValues: NativeFiltersForm;\n    try {\n      formValues = (await form.validateFields()) as NativeFiltersForm;\n    } catch (error) {\n      // In Jest tests in chain of tests, Ant generate `outOfDate` error so need to catch it here\n      if (!error?.errorFields?.length && error?.outOfDate) {\n        formValues = error.values;\n      } else {\n        throw error;\n      }\n    }\n    return formValues;\n  } catch (error) {\n    logging.warn('Filter configuration failed:', error);\n\n    if (!error.errorFields || !error.errorFields.length) return null; // not a validation error\n\n    // the name is in array format since the fields are nested\n    type ErrorFields = { name: ['filters', string, string] }[];\n    const errorFields = error.errorFields as ErrorFields;\n    // filter id is the second item in the field name\n    if (!errorFields.some(field => field.name[1] === currentFilterId)) {\n      // switch to the first tab that had a validation error\n      const filterError = errorFields.find(\n        field => field.name[0] === 'filters',\n      );\n      if (filterError) {\n        const filterId = filterError.name[1];\n        setCurrentFilterId(filterId);\n      }\n    }\n    return null;\n  }\n};\n\nexport const createHandleSave =\n  (\n    filterConfigMap: Record<string, Filter | Divider>,\n    filterIds: string[],\n    removedFilters: Record<string, FilterRemoval>,\n    saveForm: Function,\n    values: NativeFiltersForm,\n  ) =>\n  async () => {\n    const newFilterConfig: FilterConfiguration = filterIds\n      .filter(id => !removedFilters[id])\n      .map(id => {\n        // create a filter config object from the form inputs\n        const formInputs = values.filters?.[id];\n        // if user didn't open a filter, return the original config\n        if (!formInputs) return filterConfigMap[id];\n        if (formInputs.type === NativeFilterType.DIVIDER) {\n          return {\n            id,\n            type: NativeFilterType.DIVIDER,\n            scope: {\n              rootPath: [DASHBOARD_ROOT_ID],\n              excluded: [],\n            },\n            title: formInputs.title,\n            description: formInputs.description,\n          };\n        }\n        const target: Partial<NativeFilterTarget> = {};\n        if (formInputs.dataset) {\n          target.datasetId = formInputs.dataset.value;\n        }\n        if (formInputs.dataset && formInputs.column) {\n          target.column = { name: formInputs.column };\n        }\n        return {\n          id,\n          adhoc_filters: formInputs.adhoc_filters,\n          time_range: formInputs.time_range,\n          controlValues: formInputs.controlValues ?? {},\n          granularity_sqla: formInputs.granularity_sqla,\n          requiredFirst: Object.values(formInputs.requiredFirst ?? {}).find(\n            rf => rf,\n          ),\n          name: formInputs.name,\n          filterType: formInputs.filterType,\n          // for now there will only ever be one target\n          targets: [target],\n          defaultDataMask: formInputs.defaultDataMask ?? getInitialDataMask(),\n          cascadeParentIds: formInputs.dependencies || [],\n          scope: formInputs.scope,\n          sortMetric: formInputs.sortMetric,\n          type: formInputs.type,\n          description: (formInputs.description || '').trim(),\n        };\n      });\n\n    await saveForm(newFilterConfig);\n  };\n\nexport const createHandleRemoveItem =\n  (\n    setRemovedFilters: (\n      value:\n        | ((\n            prevState: Record<string, FilterRemoval>,\n          ) => Record<string, FilterRemoval>)\n        | Record<string, FilterRemoval>,\n    ) => void,\n    setOrderedFilters: (\n      val: string[] | ((prevState: string[]) => string[]),\n    ) => void,\n    setSaveAlertVisible: Function,\n  ) =>\n  (filterId: string) => {\n    const completeFilterRemoval = (filterId: string) => {\n      // the filter state will actually stick around in the form,\n      // and the filterConfig/newFilterIds, but we use removedFilters\n      // to mark it as removed.\n      setRemovedFilters(removedFilters => ({\n        ...removedFilters,\n        [filterId]: { isPending: false },\n      }));\n      setOrderedFilters((orderedFilters: string[]) =>\n        orderedFilters.filter(filter => filter !== filterId),\n      );\n    };\n\n    // first set up the timer to completely remove it\n    const timerId = window.setTimeout(() => {\n      completeFilterRemoval(filterId);\n    }, REMOVAL_DELAY_SECS * 1000);\n    // mark the filter state as \"removal in progress\"\n    setRemovedFilters(removedFilters => ({\n      ...removedFilters,\n      [filterId]: { isPending: true, timerId },\n    }));\n    setSaveAlertVisible(false);\n  };\n\nexport const NATIVE_FILTER_PREFIX = 'NATIVE_FILTER-';\nexport const NATIVE_FILTER_DIVIDER_PREFIX = 'NATIVE_FILTER_DIVIDER-';\nexport const generateFilterId = (type: NativeFilterType) => {\n  const prefix =\n    type === NativeFilterType.NATIVE_FILTER\n      ? NATIVE_FILTER_PREFIX\n      : NATIVE_FILTER_DIVIDER_PREFIX;\n  return `${prefix}${shortid.generate()}`;\n};\n\nexport const getFilterIds = (config: FilterConfiguration) =>\n  config.map(filter => filter.id);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AdhocFilter,\n  Behavior,\n  DataMaskStateWithId,\n  EXTRA_FORM_DATA_APPEND_KEYS,\n  EXTRA_FORM_DATA_OVERRIDE_KEYS,\n  ExtraFormData,\n  FeatureFlag,\n  Filter,\n  getChartMetadataRegistry,\n  QueryFormData,\n} from '@superset-ui/core';\nimport { Charts, DashboardLayout } from 'src/dashboard/types';\nimport extractUrlParams from 'src/dashboard/util/extractUrlParams';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport { CHART_TYPE, TAB_TYPE } from '../../util/componentTypes';\nimport { DASHBOARD_GRID_ID, DASHBOARD_ROOT_ID } from '../../util/constants';\n\nexport const getFormData = ({\n  datasetId,\n  dependencies = {},\n  groupby,\n  defaultDataMask,\n  controlValues,\n  filterType,\n  sortMetric,\n  adhoc_filters,\n  time_range,\n  granularity_sqla,\n  type,\n}: Partial<Filter> & {\n  datasetId?: number;\n  dependencies?: object;\n  groupby?: string;\n  adhoc_filters?: AdhocFilter[];\n  time_range?: string;\n}): Partial<QueryFormData> => {\n  const otherProps: {\n    datasource?: string;\n    groupby?: string[];\n    sortMetric?: string;\n  } = {};\n  if (datasetId) {\n    otherProps.datasource = `${datasetId}__table`;\n  }\n  if (groupby) {\n    otherProps.groupby = [groupby];\n  }\n  if (sortMetric) {\n    otherProps.sortMetric = sortMetric;\n  }\n  return {\n    ...controlValues,\n    ...otherProps,\n    adhoc_filters: adhoc_filters ?? [],\n    extra_filters: [],\n    extra_form_data: dependencies,\n    granularity_sqla,\n    metrics: ['count'],\n    row_limit: 1000,\n    showSearch: true,\n    defaultValue: defaultDataMask?.filterState?.value,\n    time_range,\n    url_params: extractUrlParams('regular'),\n    inView: true,\n    viz_type: filterType,\n    type,\n  };\n};\n\nexport function mergeExtraFormData(\n  originalExtra: ExtraFormData = {},\n  newExtra: ExtraFormData = {},\n): ExtraFormData {\n  const mergedExtra: ExtraFormData = {};\n  EXTRA_FORM_DATA_APPEND_KEYS.forEach((key: string) => {\n    const mergedValues = [\n      ...(originalExtra[key] || []),\n      ...(newExtra[key] || []),\n    ];\n    if (mergedValues.length) {\n      mergedExtra[key] = mergedValues;\n    }\n  });\n  EXTRA_FORM_DATA_OVERRIDE_KEYS.forEach((key: string) => {\n    const originalValue = originalExtra[key];\n    if (originalValue !== undefined) {\n      mergedExtra[key] = originalValue;\n    }\n    const newValue = newExtra[key];\n    if (newValue !== undefined) {\n      mergedExtra[key] = newValue;\n    }\n  });\n  return mergedExtra;\n}\n\nexport function isCrossFilter(vizType: string) {\n  // @ts-ignore need export from superset-ui `ItemWithValue`\n  return getChartMetadataRegistry().items[vizType]?.value.behaviors?.includes(\n    Behavior.INTERACTIVE_CHART,\n  );\n}\n\nexport function getExtraFormData(\n  dataMask: DataMaskStateWithId,\n  charts: Charts,\n  filterIdsAppliedOnChart: string[],\n): ExtraFormData {\n  let extraFormData: ExtraFormData = {};\n  filterIdsAppliedOnChart.forEach(key => {\n    extraFormData = mergeExtraFormData(\n      extraFormData,\n      dataMask[key]?.extraFormData ?? {},\n    );\n  });\n  return extraFormData;\n}\n\nexport function nativeFilterGate(behaviors: Behavior[]): boolean {\n  return (\n    !behaviors.includes(Behavior.NATIVE_FILTER) ||\n    (isFeatureEnabled(FeatureFlag.DASHBOARD_FILTERS_EXPERIMENTAL) &&\n      isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS) &&\n      behaviors.includes(Behavior.INTERACTIVE_CHART))\n  );\n}\n\nconst isComponentATab = (\n  dashboardLayout: DashboardLayout,\n  componentId: string,\n) => dashboardLayout[componentId].type === TAB_TYPE;\n\nconst findTabsWithChartsInScopeHelper = (\n  dashboardLayout: DashboardLayout,\n  chartsInScope: number[],\n  componentId: string,\n  tabIds: string[],\n  tabsToHighlight: Set<string>,\n) => {\n  if (\n    dashboardLayout[componentId].type === CHART_TYPE &&\n    chartsInScope.includes(dashboardLayout[componentId].meta.chartId)\n  ) {\n    tabIds.forEach(tabsToHighlight.add, tabsToHighlight);\n  }\n  if (\n    dashboardLayout[componentId].children.length === 0 ||\n    (isComponentATab(dashboardLayout, componentId) &&\n      tabsToHighlight.has(componentId))\n  ) {\n    return;\n  }\n  dashboardLayout[componentId].children.forEach(childId =>\n    findTabsWithChartsInScopeHelper(\n      dashboardLayout,\n      chartsInScope,\n      childId,\n      isComponentATab(dashboardLayout, childId) ? [...tabIds, childId] : tabIds,\n      tabsToHighlight,\n    ),\n  );\n};\n\nexport const findTabsWithChartsInScope = (\n  dashboardLayout: DashboardLayout,\n  chartsInScope: number[],\n) => {\n  const dashboardRoot = dashboardLayout[DASHBOARD_ROOT_ID];\n  const rootChildId = dashboardRoot.children[0];\n  const hasTopLevelTabs = rootChildId !== DASHBOARD_GRID_ID;\n  const tabsInScope = new Set<string>();\n  if (hasTopLevelTabs) {\n    dashboardLayout[rootChildId].children?.forEach(tabId =>\n      findTabsWithChartsInScopeHelper(\n        dashboardLayout,\n        chartsInScope,\n        tabId,\n        [tabId],\n        tabsInScope,\n      ),\n    );\n  } else {\n    Object.values(dashboardLayout)\n      .filter(element => element.type === TAB_TYPE)\n      .forEach(element =>\n        findTabsWithChartsInScopeHelper(\n          dashboardLayout,\n          chartsInScope,\n          element.id,\n          [element.id],\n          tabsInScope,\n        ),\n      );\n  }\n  return tabsInScope;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  AnyFilterAction,\n  SET_FILTER_CONFIG_COMPLETE,\n  SET_IN_SCOPE_STATUS_OF_FILTERS,\n  SET_FILTER_SETS_COMPLETE,\n  SET_FOCUSED_NATIVE_FILTER,\n  UNSET_FOCUSED_NATIVE_FILTER,\n} from 'src/dashboard/actions/nativeFilters';\nimport {\n  FilterSet,\n  FilterConfiguration,\n  NativeFiltersState,\n} from '@superset-ui/core';\nimport { HYDRATE_DASHBOARD } from '../actions/hydrate';\n\nexport function getInitialState({\n  filterSetsConfig,\n  filterConfig,\n  state: prevState,\n}: {\n  filterSetsConfig?: FilterSet[];\n  filterConfig?: FilterConfiguration;\n  state?: NativeFiltersState;\n}): NativeFiltersState {\n  const state: Partial<NativeFiltersState> = {};\n\n  const filters = {};\n  if (filterConfig) {\n    filterConfig.forEach(filter => {\n      const { id } = filter;\n      filters[id] = filter;\n    });\n    state.filters = filters;\n  } else {\n    state.filters = prevState?.filters ?? {};\n  }\n\n  if (filterSetsConfig) {\n    const filterSets = {};\n    filterSetsConfig.forEach(filtersSet => {\n      const { id } = filtersSet;\n      filterSets[id] = filtersSet;\n    });\n    state.filterSets = filterSets;\n  } else {\n    state.filterSets = prevState?.filterSets ?? {};\n  }\n  state.focusedFilterId = undefined;\n  return state as NativeFiltersState;\n}\n\nexport default function nativeFilterReducer(\n  state: NativeFiltersState = {\n    filters: {},\n    filterSets: {},\n  },\n  action: AnyFilterAction,\n) {\n  switch (action.type) {\n    case HYDRATE_DASHBOARD:\n      return {\n        filters: action.data.nativeFilters.filters,\n        filterSets: action.data.nativeFilters.filterSets,\n      };\n\n    case SET_FILTER_CONFIG_COMPLETE:\n    case SET_IN_SCOPE_STATUS_OF_FILTERS:\n      return getInitialState({ filterConfig: action.filterConfig, state });\n\n    case SET_FILTER_SETS_COMPLETE:\n      return getInitialState({\n        filterSetsConfig: action.filterSets,\n        state,\n      });\n\n    case SET_FOCUSED_NATIVE_FILTER:\n      return {\n        ...state,\n        focusedFilterId: action.id,\n      };\n\n    case UNSET_FOCUSED_NATIVE_FILTER:\n      return {\n        ...state,\n        focusedFilterId: undefined,\n      };\n    // TODO handle SET_FILTER_CONFIG_FAIL action\n    default:\n      return state;\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const CHART_TYPE = 'CHART';\nexport const COLUMN_TYPE = 'COLUMN';\nexport const DASHBOARD_HEADER_TYPE = 'HEADER';\nexport const DASHBOARD_GRID_TYPE = 'GRID';\nexport const DASHBOARD_ROOT_TYPE = 'ROOT';\nexport const DIVIDER_TYPE = 'DIVIDER';\nexport const HEADER_TYPE = 'HEADER';\nexport const MARKDOWN_TYPE = 'MARKDOWN';\nexport const NEW_COMPONENT_SOURCE_TYPE = 'NEW_COMPONENT_SOURCE';\nexport const ROW_TYPE = 'ROW';\nexport const TABS_TYPE = 'TABS';\nexport const TAB_TYPE = 'TAB';\n// Dynamic type proposes lazy loading of custom dashboard components that can be added in separate repository\nexport const DYNAMIC_TYPE = 'DYNAMIC';\n\nexport default {\n  CHART_TYPE,\n  COLUMN_TYPE,\n  DASHBOARD_HEADER_TYPE,\n  DASHBOARD_GRID_TYPE,\n  DASHBOARD_ROOT_TYPE,\n  DIVIDER_TYPE,\n  HEADER_TYPE,\n  MARKDOWN_TYPE,\n  NEW_COMPONENT_SOURCE_TYPE,\n  ROW_TYPE,\n  TABS_TYPE,\n  TAB_TYPE,\n  DYNAMIC_TYPE,\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport querystring from 'query-string';\nimport { JsonObject } from '@superset-ui/core';\n\nconst reservedQueryParams = new Set(['standalone', 'edit']);\n\nexport type UrlParamType = 'reserved' | 'regular' | 'all';\n\n/**\n * Returns the url params that are used to customize queries\n */\nexport default function extractUrlParams(\n  urlParamType: UrlParamType,\n): JsonObject {\n  const queryParams = querystring.parse(window.location.search);\n  return Object.entries(queryParams).reduce((acc, [key, value]) => {\n    if (\n      (urlParamType === 'regular' && reservedQueryParams.has(key)) ||\n      (urlParamType === 'reserved' && !reservedQueryParams.has(key))\n    )\n      return acc;\n    // if multiple url params share the same key (?foo=bar&foo=baz), they will appear as an array.\n    // Only one value can be used for a given query param, so we just take the first one.\n    if (Array.isArray(value)) {\n      return {\n        ...acc,\n        [key]: value[0],\n      };\n    }\n    return { ...acc, [key]: value };\n  }, {});\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport memoizeOne from 'memoize-one';\nimport {\n  UserRoles,\n  isUserWithPermissionsAndRoles,\n  UndefinedUser,\n  UserWithPermissionsAndRoles,\n} from 'src/types/bootstrapTypes';\nimport Dashboard from 'src/types/Dashboard';\n\nconst findPermission = memoizeOne(\n  (perm: string, view: string, roles?: UserRoles | null) =>\n    !!roles &&\n    Object.values(roles).some(permissions =>\n      permissions.some(([perm_, view_]) => perm_ === perm && view_ === view),\n    ),\n);\n\nexport default findPermission;\n\n// this should really be a config value,\n// but is hardcoded in backend logic already, so...\nconst ADMIN_ROLE_NAME = 'admin';\n\nexport const isUserAdmin = (\n  user: UserWithPermissionsAndRoles | UndefinedUser,\n) =>\n  isUserWithPermissionsAndRoles(user) &&\n  Object.keys(user.roles || {}).some(\n    role => role.toLowerCase() === ADMIN_ROLE_NAME,\n  );\n\nconst isUserDashboardOwner = (\n  dashboard: Dashboard,\n  user: UserWithPermissionsAndRoles | UndefinedUser,\n) =>\n  isUserWithPermissionsAndRoles(user) &&\n  dashboard.owners.some(owner => owner.username === user.username);\n\nexport const canUserEditDashboard = (\n  dashboard: Dashboard,\n  user?: UserWithPermissionsAndRoles | UndefinedUser | null,\n) =>\n  isUserWithPermissionsAndRoles(user) &&\n  (isUserAdmin(user) || isUserDashboardOwner(dashboard, user)) &&\n  findPermission('can_write', 'Dashboard', user.roles);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\ninterface GetDashboardFilterKeyProps {\n  chartId: string;\n  column: string;\n}\n\nexport function getDashboardFilterKey({\n  chartId,\n  column,\n}: GetDashboardFilterKeyProps) {\n  return `${chartId}_${column}`;\n}\n\nconst filterKeySplitter = /^([0-9]+)_(.*)$/;\n\nexport function getChartIdAndColumnFromFilterKey(key: string) {\n  const match = filterKeySplitter.exec(key);\n  if (!match) throw new Error('Cannot parse invalid filter key');\n  return { chartId: parseInt(match[1], 10), column: match[2] };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport default function getLocationHash() {\n  return (window.location.hash || '#').substring(1);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { DataMask, FilterConfiguration, Filters } from '@superset-ui/core';\nimport { FeatureFlag, isFeatureEnabled } from '../featureFlags';\nimport { getInitialDataMask } from './reducer';\n\nexport const CLEAR_DATA_MASK_STATE = 'CLEAR_DATA_MASK_STATE';\nexport interface ClearDataMaskState {\n  type: typeof CLEAR_DATA_MASK_STATE;\n}\n\nexport const UPDATE_DATA_MASK = 'UPDATE_DATA_MASK';\nexport interface UpdateDataMask {\n  type: typeof UPDATE_DATA_MASK;\n  filterId: string | number;\n  dataMask: DataMask;\n}\n\nexport const INIT_DATAMASK = 'INIT_DATAMASK';\nexport interface INITDATAMASK {\n  type: typeof INIT_DATAMASK;\n  dataMask: DataMask;\n}\n\nexport const SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE =\n  'SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE';\n\nexport interface SetDataMaskForFilterConfigComplete {\n  type: typeof SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE;\n  filterConfig: FilterConfiguration;\n  filters?: Filters;\n}\n\nexport const SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL =\n  'SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL';\n\nexport interface SetDataMaskForFilterConfigFail {\n  type: typeof SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL;\n  filterConfig: FilterConfiguration;\n}\nexport function setDataMaskForFilterConfigComplete(\n  filterConfig: FilterConfiguration,\n  filters?: Filters,\n): SetDataMaskForFilterConfigComplete {\n  return {\n    type: SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE,\n    filterConfig,\n    filters,\n  };\n}\nexport function updateDataMask(\n  filterId: string | number,\n  dataMask: DataMask,\n): UpdateDataMask {\n  // Only apply data mask if one of the relevant features is enabled\n  const isFeatureFlagActive =\n    isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS) ||\n    isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS);\n  return {\n    type: UPDATE_DATA_MASK,\n    filterId,\n    dataMask: isFeatureFlagActive ? dataMask : {},\n  };\n}\n\nexport function clearDataMask(filterId: string | number) {\n  return updateDataMask(filterId, getInitialDataMask(filterId));\n}\n\nexport function clearDataMaskState(): ClearDataMaskState {\n  return {\n    type: CLEAR_DATA_MASK_STATE,\n  };\n}\n\nexport type AnyDataMaskAction =\n  | ClearDataMaskState\n  | UpdateDataMask\n  | SetDataMaskForFilterConfigFail\n  | SetDataMaskForFilterConfigComplete;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable no-param-reassign */\n// <- When we work with Immer, we need reassign, so disabling lint\nimport produce from 'immer';\nimport {\n  DataMask,\n  DataMaskStateWithId,\n  DataMaskWithId,\n  FeatureFlag,\n  Filter,\n  FilterConfiguration,\n  Filters,\n} from '@superset-ui/core';\nimport { NATIVE_FILTER_PREFIX } from 'src/dashboard/components/nativeFilters/FiltersConfigModal/utils';\nimport { HYDRATE_DASHBOARD } from 'src/dashboard/actions/hydrate';\nimport { isFeatureEnabled } from 'src/featureFlags';\nimport {\n  AnyDataMaskAction,\n  CLEAR_DATA_MASK_STATE,\n  SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE,\n  UPDATE_DATA_MASK,\n} from './actions';\nimport { areObjectsEqual } from '../reduxUtils';\n\nexport function getInitialDataMask(\n  id?: string | number,\n  moreProps?: DataMask,\n): DataMask;\nexport function getInitialDataMask(\n  id: string | number,\n  moreProps: DataMask = {},\n): DataMaskWithId {\n  let otherProps = {};\n  if (id) {\n    otherProps = {\n      id,\n    };\n  }\n  return {\n    ...otherProps,\n    extraFormData: {},\n    filterState: {},\n    ownState: {},\n    ...moreProps,\n  } as DataMaskWithId;\n}\n\nfunction fillNativeFilters(\n  filterConfig: FilterConfiguration,\n  mergedDataMask: DataMaskStateWithId,\n  draftDataMask: DataMaskStateWithId,\n  initialDataMask?: DataMaskStateWithId,\n  currentFilters?: Filters,\n) {\n  filterConfig.forEach((filter: Filter) => {\n    const dataMask = initialDataMask || {};\n    mergedDataMask[filter.id] = {\n      ...getInitialDataMask(filter.id), // take initial data\n      ...filter.defaultDataMask, // if something new came from BE - take it\n      ...dataMask[filter.id],\n    };\n    if (\n      currentFilters &&\n      !areObjectsEqual(\n        filter.defaultDataMask,\n        currentFilters[filter.id]?.defaultDataMask,\n        { ignoreUndefined: true },\n      )\n    ) {\n      mergedDataMask[filter.id] = {\n        ...mergedDataMask[filter.id],\n        ...filter.defaultDataMask,\n      };\n    }\n  });\n\n  // Get back all other non-native filters\n  Object.values(draftDataMask).forEach(filter => {\n    if (!String(filter?.id).startsWith(NATIVE_FILTER_PREFIX)) {\n      mergedDataMask[filter?.id] = filter;\n    }\n  });\n}\n\nconst dataMaskReducer = produce(\n  (draft: DataMaskStateWithId, action: AnyDataMaskAction) => {\n    const cleanState = {};\n    switch (action.type) {\n      case CLEAR_DATA_MASK_STATE:\n        return cleanState;\n      case UPDATE_DATA_MASK:\n        draft[action.filterId] = {\n          ...getInitialDataMask(action.filterId),\n          ...draft[action.filterId],\n          ...action.dataMask,\n        };\n        return draft;\n      // TODO: update hydrate to .ts\n      // @ts-ignore\n      case HYDRATE_DASHBOARD:\n        if (isFeatureEnabled(FeatureFlag.DASHBOARD_CROSS_FILTERS)) {\n          Object.keys(\n            // @ts-ignore\n            action.data.dashboardInfo?.metadata?.chart_configuration,\n          ).forEach(id => {\n            cleanState[id] = {\n              ...getInitialDataMask(id), // take initial data\n            };\n          });\n        }\n        fillNativeFilters(\n          // @ts-ignore\n          action.data.dashboardInfo?.metadata?.native_filter_configuration ??\n            [],\n          cleanState,\n          draft,\n          // @ts-ignore\n          action.data.dataMask,\n        );\n        return cleanState;\n      case SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE:\n        fillNativeFilters(\n          action.filterConfig ?? [],\n          cleanState,\n          draft,\n          action.filters,\n        );\n        return cleanState;\n\n      default:\n        return draft;\n    }\n  },\n  {},\n);\n\nexport default dataMaskReducer;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme } from '@superset-ui/core';\nimport { List, ListItemProps } from 'src/components';\n\nexport interface CustomListItemProps extends ListItemProps {\n  selectable: boolean;\n}\n\nexport default function CustomListItem(props: CustomListItemProps) {\n  const { selectable, children, ...rest } = props;\n  const theme = useTheme();\n  const css = {\n    '&.ant-list-item': {\n      padding: `${theme.gridUnit + 2}px ${theme.gridUnit * 3}px`,\n      ':first-of-type': {\n        borderTopLeftRadius: theme.gridUnit,\n        borderTopRightRadius: theme.gridUnit,\n      },\n      ':last-of-type': {\n        borderBottomLeftRadius: theme.gridUnit,\n        borderBottomRightRadius: theme.gridUnit,\n      },\n    },\n  };\n\n  if (selectable) {\n    css['&:hover'] = {\n      cursor: 'pointer',\n      backgroundColor: theme.colors.grayscale.light4,\n    };\n  }\n\n  return (\n    <List.Item {...rest} css={css}>\n      {children}\n    </List.Item>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { List } from 'src/components';\nimport { connect } from 'react-redux';\nimport { t, withTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport AsyncEsmComponent from 'src/components/AsyncEsmComponent';\nimport { getChartKey } from 'src/explore/exploreUtils';\nimport { runAnnotationQuery } from 'src/components/Chart/chartAction';\nimport CustomListItem from 'src/explore/components/controls/CustomListItem';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nconst AnnotationLayer = AsyncEsmComponent(\n  () => import('./AnnotationLayer'),\n  // size of overlay inner content\n  () => <div style={{ width: 450, height: 368 }} />,\n);\n\nconst propTypes = {\n  colorScheme: PropTypes.string.isRequired,\n  annotationError: PropTypes.object,\n  annotationQuery: PropTypes.object,\n  vizType: PropTypes.string,\n\n  validationErrors: PropTypes.array,\n  name: PropTypes.string.isRequired,\n  actions: PropTypes.object,\n  value: PropTypes.arrayOf(PropTypes.object),\n  onChange: PropTypes.func,\n  refreshAnnotationData: PropTypes.func,\n};\n\nconst defaultProps = {\n  vizType: '',\n  value: [],\n  annotationError: {},\n  annotationQuery: {},\n  onChange: () => {},\n};\n\nclass AnnotationLayerControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      popoverVisible: {},\n      addedAnnotationIndex: null,\n    };\n    this.addAnnotationLayer = this.addAnnotationLayer.bind(this);\n    this.removeAnnotationLayer = this.removeAnnotationLayer.bind(this);\n    this.handleVisibleChange = this.handleVisibleChange.bind(this);\n  }\n\n  componentDidMount() {\n    // preload the AnotationLayer component and dependent libraries i.e. mathjs\n    AnnotationLayer.preload();\n  }\n\n  UNSAFE_componentWillReceiveProps(nextProps) {\n    const { name, annotationError, validationErrors, value } = nextProps;\n    if (Object.keys(annotationError).length && !validationErrors.length) {\n      this.props.actions.setControlValue(\n        name,\n        value,\n        Object.keys(annotationError),\n      );\n    }\n    if (!Object.keys(annotationError).length && validationErrors.length) {\n      this.props.actions.setControlValue(name, value, []);\n    }\n  }\n\n  addAnnotationLayer(originalAnnotation, newAnnotation) {\n    let annotations = this.props.value;\n    if (annotations.includes(originalAnnotation)) {\n      annotations = annotations.map(anno =>\n        anno === originalAnnotation ? newAnnotation : anno,\n      );\n    } else {\n      annotations = [...annotations, newAnnotation];\n      this.setState({ addedAnnotationIndex: annotations.length - 1 });\n    }\n\n    this.props.refreshAnnotationData({\n      annotation: newAnnotation,\n      force: true,\n    });\n\n    this.props.onChange(annotations);\n  }\n\n  handleVisibleChange(visible, popoverKey) {\n    this.setState(prevState => ({\n      popoverVisible: { ...prevState.popoverVisible, [popoverKey]: visible },\n    }));\n  }\n\n  removeAnnotationLayer(annotation) {\n    const annotations = this.props.value.filter(anno => anno !== annotation);\n    this.props.onChange(annotations);\n  }\n\n  renderPopover(popoverKey, annotation, error) {\n    const id = annotation?.name || '_new';\n\n    return (\n      <div id={`annotation-pop-${id}`} data-test=\"popover-content\">\n        <AnnotationLayer\n          {...annotation}\n          error={error}\n          colorScheme={this.props.colorScheme}\n          vizType={this.props.vizType}\n          addAnnotationLayer={newAnnotation =>\n            this.addAnnotationLayer(annotation, newAnnotation)\n          }\n          removeAnnotationLayer={() => this.removeAnnotationLayer(annotation)}\n          close={() => {\n            this.handleVisibleChange(false, popoverKey);\n            this.setState({ addedAnnotationIndex: null });\n          }}\n        />\n      </div>\n    );\n  }\n\n  renderInfo(anno) {\n    const { annotationError, annotationQuery, theme } = this.props;\n    if (annotationQuery[anno.name]) {\n      return (\n        <i\n          className=\"fa fa-refresh\"\n          style={{ color: theme.colors.primary.base }}\n          aria-hidden\n        />\n      );\n    }\n    if (annotationError[anno.name]) {\n      return (\n        <InfoTooltipWithTrigger\n          label=\"validation-errors\"\n          bsStyle=\"danger\"\n          tooltip={annotationError[anno.name]}\n        />\n      );\n    }\n    if (!anno.show) {\n      return <span style={{ color: theme.colors.error.base }}> Hidden </span>;\n    }\n    return '';\n  }\n\n  render() {\n    const { addedAnnotationIndex } = this.state;\n    const addedAnnotation = this.props.value[addedAnnotationIndex];\n\n    const annotations = this.props.value.map((anno, i) => (\n      <ControlPopover\n        key={i}\n        trigger=\"click\"\n        title={t('Edit annotation layer')}\n        css={theme => ({\n          '&:hover': {\n            cursor: 'pointer',\n            backgroundColor: theme.colors.grayscale.light4,\n          },\n        })}\n        content={this.renderPopover(\n          i,\n          anno,\n          this.props.annotationError[anno.name],\n        )}\n        visible={this.state.popoverVisible[i]}\n        onVisibleChange={visible => this.handleVisibleChange(visible, i)}\n      >\n        <CustomListItem selectable>\n          <span>{anno.name}</span>\n          <span style={{ float: 'right' }}>{this.renderInfo(anno)}</span>\n        </CustomListItem>\n      </ControlPopover>\n    ));\n\n    const addLayerPopoverKey = 'add';\n    return (\n      <div>\n        <List bordered css={theme => ({ borderRadius: theme.gridUnit })}>\n          {annotations}\n          <ControlPopover\n            trigger=\"click\"\n            content={this.renderPopover(addLayerPopoverKey, addedAnnotation)}\n            title={t('Add annotation layer')}\n            visible={this.state.popoverVisible[addLayerPopoverKey]}\n            destroyTooltipOnHide\n            onVisibleChange={visible =>\n              this.handleVisibleChange(visible, addLayerPopoverKey)\n            }\n          >\n            <CustomListItem selectable>\n              <i\n                data-test=\"add-annotation-layer-button\"\n                className=\"fa fa-plus\"\n              />{' '}\n              &nbsp; {t('Add annotation layer')}\n            </CustomListItem>\n          </ControlPopover>\n        </List>\n      </div>\n    );\n  }\n}\n\nAnnotationLayerControl.propTypes = propTypes;\nAnnotationLayerControl.defaultProps = defaultProps;\n\n// Tried to hook this up through stores/control.jsx instead of using redux\n// directly, could not figure out how to get access to the color_scheme\nfunction mapStateToProps({ charts, explore }) {\n  const chartKey = getChartKey(explore);\n  const chart = charts[chartKey] || charts[0] || {};\n\n  return {\n    // eslint-disable-next-line camelcase\n    colorScheme: explore.controls?.color_scheme?.value,\n    annotationError: chart.annotationError,\n    annotationQuery: chart.annotationQuery,\n    vizType: explore.controls.viz_type.value,\n  };\n}\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    refreshAnnotationData: annotationObj =>\n      dispatch(runAnnotationQuery(annotationObj)),\n  };\n}\n\nconst themedAnnotationLayerControl = withTheme(AnnotationLayerControl);\n\nexport default connect(\n  mapStateToProps,\n  mapDispatchToProps,\n)(themedAnnotationLayerControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useRef, useState } from 'react';\nimport { InputNumber } from 'src/components/Input';\nimport { t, styled } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport ControlHeader from 'src/explore/components/ControlHeader';\n\ntype ValueType = (number | null)[];\n\nexport type BoundsControlProps = {\n  onChange?: (value: ValueType) => void;\n  value?: ValueType;\n};\n\nconst StyledDiv = styled.div`\n  display: flex;\n`;\n\nconst MinInput = styled(InputNumber)`\n  flex: 1;\n  margin-right: ${({ theme }) => theme.gridUnit}px;\n`;\n\nconst MaxInput = styled(InputNumber)`\n  flex: 1;\n  margin-left: ${({ theme }) => theme.gridUnit}px;\n`;\n\nconst parseNumber = (value: undefined | number | string | null) =>\n  value === null || Number.isNaN(Number(value)) ? null : Number(value);\n\nexport default function BoundsControl({\n  onChange = () => {},\n  value = [null, null],\n  ...props\n}: BoundsControlProps) {\n  const [minMax, setMinMax] = useState<ValueType>([\n    parseNumber(value[0]),\n    parseNumber(value[1]),\n  ]);\n  const min = value[0];\n  const max = value[1];\n  const debouncedOnChange = useRef(debounce(onChange, 300)).current;\n\n  const update = (mm: ValueType) => {\n    setMinMax(mm);\n    debouncedOnChange([\n      mm[0] === undefined ? null : mm[0],\n      mm[1] === undefined ? null : mm[1],\n    ]);\n  };\n\n  useEffect(() => {\n    setMinMax([parseNumber(min), parseNumber(max)]);\n  }, [min, max]);\n\n  const onMinChange = (value: number | string | undefined) => {\n    update([parseNumber(value), minMax[1]]);\n  };\n\n  const onMaxChange = (value: number | string | undefined) => {\n    update([minMax[0], parseNumber(value)]);\n  };\n\n  return (\n    <div>\n      <ControlHeader {...props} />\n      <StyledDiv>\n        <MinInput\n          data-test=\"min-bound\"\n          placeholder={t('Min')}\n          // emit (string | number | undefined)\n          onChange={onMinChange}\n          // accept (number | undefined)\n          value={minMax[0] === null ? undefined : minMax[0]}\n        />\n        <MaxInput\n          data-test=\"max-bound\"\n          placeholder={t('Max')}\n          // emit (number | string | undefined)\n          onChange={onMaxChange}\n          // accept (number | undefined)\n          value={minMax[1] === null ? undefined : minMax[1]}\n        />\n      </StyledDiv>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { List } from 'src/components';\nimport shortid from 'shortid';\nimport { t, withTheme } from '@superset-ui/core';\nimport {\n  SortableContainer,\n  SortableHandle,\n  SortableElement,\n  arrayMove,\n} from 'react-sortable-hoc';\nimport Icons from 'src/components/Icons';\nimport {\n  HeaderContainer,\n  AddIconButton,\n} from 'src/explore/components/controls/OptionControls';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport CustomListItem from 'src/explore/components/controls/CustomListItem';\nimport controlMap from '..';\n\nconst propTypes = {\n  name: PropTypes.string.isRequired,\n  label: PropTypes.string,\n  description: PropTypes.string,\n  placeholder: PropTypes.string,\n  addTooltip: PropTypes.string,\n  itemGenerator: PropTypes.func,\n  keyAccessor: PropTypes.func,\n  onChange: PropTypes.func,\n  value: PropTypes.oneOfType([PropTypes.array]),\n  isFloat: PropTypes.bool,\n  isInt: PropTypes.bool,\n  controlName: PropTypes.string.isRequired,\n};\n\nconst defaultProps = {\n  label: null,\n  description: null,\n  onChange: () => {},\n  placeholder: t('Empty collection'),\n  itemGenerator: () => ({ key: shortid.generate() }),\n  keyAccessor: o => o.key,\n  value: [],\n  addTooltip: t('Add an item'),\n};\nconst SortableListItem = SortableElement(CustomListItem);\nconst SortableList = SortableContainer(List);\nconst SortableDragger = SortableHandle(() => (\n  <i\n    role=\"img\"\n    aria-label=\"drag\"\n    className=\"fa fa-bars text-primary\"\n    style={{ cursor: 'ns-resize' }}\n  />\n));\n\nclass CollectionControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onAdd = this.onAdd.bind(this);\n  }\n\n  onChange(i, value) {\n    const newValue = [...this.props.value];\n    newValue[i] = { ...this.props.value[i], ...value };\n    this.props.onChange(newValue);\n  }\n\n  onAdd() {\n    this.props.onChange(this.props.value.concat([this.props.itemGenerator()]));\n  }\n\n  onSortEnd({ oldIndex, newIndex }) {\n    this.props.onChange(arrayMove(this.props.value, oldIndex, newIndex));\n  }\n\n  removeItem(i) {\n    this.props.onChange(this.props.value.filter((o, ix) => i !== ix));\n  }\n\n  renderList() {\n    if (this.props.value.length === 0) {\n      return <div className=\"text-muted\">{this.props.placeholder}</div>;\n    }\n    const Control = controlMap[this.props.controlName];\n    return (\n      <SortableList\n        useDragHandle\n        lockAxis=\"y\"\n        onSortEnd={this.onSortEnd.bind(this)}\n        bordered\n        css={theme => ({\n          borderRadius: theme.gridUnit,\n        })}\n      >\n        {this.props.value.map((o, i) => {\n          // label relevant only for header, not here\n          const { label, ...commonProps } = this.props;\n          return (\n            <SortableListItem\n              className=\"clearfix\"\n              css={{ justifyContent: 'flex-start' }}\n              key={this.props.keyAccessor(o)}\n              index={i}\n            >\n              <SortableDragger />\n              <div\n                css={theme => ({\n                  flex: 1,\n                  marginLeft: theme.gridUnit * 2,\n                  marginRight: theme.gridUnit * 2,\n                })}\n              >\n                <Control\n                  {...commonProps}\n                  {...o}\n                  onChange={this.onChange.bind(this, i)}\n                />\n              </div>\n              <InfoTooltipWithTrigger\n                icon=\"times\"\n                label=\"remove-item\"\n                tooltip={t('Remove item')}\n                bsStyle=\"primary\"\n                onClick={this.removeItem.bind(this, i)}\n              />\n            </SortableListItem>\n          );\n        })}\n      </SortableList>\n    );\n  }\n\n  render() {\n    const { theme } = this.props;\n    return (\n      <div data-test=\"CollectionControl\" className=\"CollectionControl\">\n        <HeaderContainer>\n          <ControlHeader {...this.props} />\n          <AddIconButton onClick={this.onAdd}>\n            <Icons.PlusLarge\n              iconSize=\"s\"\n              iconColor={theme.colors.grayscale.light5}\n            />\n          </AddIconButton>\n        </HeaderContainer>\n        {this.renderList()}\n      </div>\n    );\n  }\n}\n\nCollectionControl.propTypes = propTypes;\nCollectionControl.defaultProps = defaultProps;\n\nexport default withTheme(CollectionControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { SketchPicker } from 'react-color';\nimport { getCategoricalSchemeRegistry, styled } from '@superset-ui/core';\nimport Popover from 'src/components/Popover';\nimport ControlHeader from '../ControlHeader';\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n};\n\nconst swatchCommon = {\n  position: 'absolute',\n  width: '50px',\n  height: '20px',\n  top: '0px',\n  left: '0px',\n  right: '0px',\n  bottom: '0px',\n};\n\nconst StyledSwatch = styled.div`\n  ${({ theme }) => `\n      width: 50px;\n      height: 20px;\n      position: relative;\n      padding: ${theme.gridUnit}px;\n      borderRadius: ${theme.borderRadius}px;\n      display: inline-block;\n      cursor: pointer;\n    `}\n`;\n\nconst styles = {\n  color: {\n    ...swatchCommon,\n    borderRadius: '2px',\n  },\n  checkboard: {\n    ...swatchCommon,\n    background:\n      'url(\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==\") left center',\n  },\n};\nexport default class ColorPickerControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  onChange(col) {\n    this.props.onChange(col.rgb);\n  }\n\n  renderPopover() {\n    const presetColors = getCategoricalSchemeRegistry()\n      .get()\n      .colors.filter((s, i) => i < 7);\n    return (\n      <div id=\"filter-popover\" className=\"color-popover\">\n        <SketchPicker\n          color={this.props.value}\n          onChange={this.onChange}\n          presetColors={presetColors}\n        />\n      </div>\n    );\n  }\n\n  render() {\n    const c = this.props.value || { r: 0, g: 0, b: 0, a: 0 };\n    const colStyle = {\n      ...styles.color,\n      background: `rgba(${c.r}, ${c.g}, ${c.b}, ${c.a})`,\n    };\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          trigger=\"click\"\n          placement=\"right\"\n          content={this.renderPopover()}\n        >\n          <StyledSwatch>\n            <div style={styles.checkboard} />\n            <div style={colStyle} />\n          </StyledSwatch>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nColorPickerControl.propTypes = propTypes;\nColorPickerControl.defaultProps = defaultProps;\n","/* eslint-disable camelcase */\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport {\n  DatasourceType,\n  SupersetClient,\n  styled,\n  t,\n  withTheme,\n} from '@superset-ui/core';\nimport { getUrlParam } from 'src/utils/urlUtils';\n\nimport { AntdDropdown } from 'src/components';\nimport { Menu } from 'src/components/Menu';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport {\n  ChangeDatasourceModal,\n  DatasourceModal,\n} from 'src/components/Datasource';\nimport Button from 'src/components/Button';\nimport ErrorAlert from 'src/components/ErrorMessage/ErrorAlert';\nimport WarningIconWithTooltip from 'src/components/WarningIconWithTooltip';\nimport { URL_PARAMS } from 'src/constants';\nimport { isUserAdmin } from 'src/dashboard/util/findPermission';\nimport { SaveDatasetModal } from 'src/SqlLab/components/SaveDatasetModal';\nimport { safeStringify } from 'src/utils/safeStringify';\n\nconst propTypes = {\n  actions: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.string,\n  datasource: PropTypes.object.isRequired,\n  form_data: PropTypes.object.isRequired,\n  isEditable: PropTypes.bool,\n  onDatasourceSave: PropTypes.func,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  onDatasourceSave: null,\n  value: null,\n  isEditable: true,\n};\n\nconst Styles = styled.div`\n  .data-container {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    border-bottom: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n    padding: ${({ theme }) => 4 * theme.gridUnit}px;\n    padding-right: ${({ theme }) => 2 * theme.gridUnit}px;\n  }\n  .error-alert {\n    margin: ${({ theme }) => 2 * theme.gridUnit}px;\n  }\n  .ant-dropdown-trigger {\n    margin-left: ${({ theme }) => 2 * theme.gridUnit}px;\n    box-shadow: none;\n    &:active {\n      box-shadow: none;\n    }\n  }\n  .btn-group .open .dropdown-toggle {\n    box-shadow: none;\n    &.button-default {\n      background: none;\n    }\n  }\n  i.angle {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n  svg.datasource-modal-trigger {\n    color: ${({ theme }) => theme.colors.primary.base};\n    cursor: pointer;\n  }\n  .title-select {\n    flex: 1 1 100%;\n    display: inline-block;\n    background-color: ${({ theme }) => theme.colors.grayscale.light3};\n    padding: ${({ theme }) => theme.gridUnit * 2}px;\n    border-radius: ${({ theme }) => theme.borderRadius}px;\n    text-align: center;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    overflow: hidden;\n  }\n  .dataset-svg {\n    margin-right: ${({ theme }) => 2 * theme.gridUnit}px;\n    flex: none;\n  }\n  span[aria-label='dataset-physical'] {\n    color: ${({ theme }) => theme.colors.grayscale.base};\n  }\n  span[aria-label='more-vert'] {\n    color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nconst CHANGE_DATASET = 'change_dataset';\nconst VIEW_IN_SQL_LAB = 'view_in_sql_lab';\nconst EDIT_DATASET = 'edit_dataset';\nconst QUERY_PREVIEW = 'query_preview';\nconst SAVE_AS_DATASET = 'save_as_dataset';\n\nclass DatasourceControl extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.state = {\n      showEditDatasourceModal: false,\n      showChangeDatasourceModal: false,\n    };\n    this.onDatasourceSave = this.onDatasourceSave.bind(this);\n    this.toggleChangeDatasourceModal =\n      this.toggleChangeDatasourceModal.bind(this);\n    this.toggleEditDatasourceModal = this.toggleEditDatasourceModal.bind(this);\n    this.toggleShowDatasource = this.toggleShowDatasource.bind(this);\n    this.handleMenuItemClick = this.handleMenuItemClick.bind(this);\n    this.toggleSaveDatasetModal = this.toggleSaveDatasetModal.bind(this);\n  }\n\n  onDatasourceSave(datasource) {\n    this.props.actions.setDatasource(datasource);\n    const timeCol = this.props.form_data?.granularity_sqla;\n    const { columns } = this.props.datasource;\n    const firstDttmCol = columns.find(column => column.is_dttm);\n    if (\n      datasource.type === 'table' &&\n      !columns.find(({ column_name }) => column_name === timeCol)?.is_dttm\n    ) {\n      // set `granularity_sqla` to first datatime column name or null\n      this.props.actions.setControlValue(\n        'granularity_sqla',\n        firstDttmCol ? firstDttmCol.column_name : null,\n      );\n    }\n    if (this.props.onDatasourceSave) {\n      this.props.onDatasourceSave(datasource);\n    }\n  }\n\n  toggleShowDatasource() {\n    this.setState(({ showDatasource }) => ({\n      showDatasource: !showDatasource,\n    }));\n  }\n\n  toggleChangeDatasourceModal() {\n    this.setState(({ showChangeDatasourceModal }) => ({\n      showChangeDatasourceModal: !showChangeDatasourceModal,\n    }));\n  }\n\n  toggleEditDatasourceModal() {\n    this.setState(({ showEditDatasourceModal }) => ({\n      showEditDatasourceModal: !showEditDatasourceModal,\n    }));\n  }\n\n  toggleSaveDatasetModal() {\n    this.setState(({ showSaveDatasetModal }) => ({\n      showSaveDatasetModal: !showSaveDatasetModal,\n    }));\n  }\n\n  handleMenuItemClick({ key }) {\n    switch (key) {\n      case CHANGE_DATASET:\n        this.toggleChangeDatasourceModal();\n        break;\n\n      case EDIT_DATASET:\n        this.toggleEditDatasourceModal();\n        break;\n\n      case VIEW_IN_SQL_LAB:\n        {\n          const { datasource } = this.props;\n          const payload = {\n            datasourceKey: `${datasource.id}__${datasource.type}`,\n            sql: datasource.sql,\n          };\n          SupersetClient.postForm('/superset/sqllab/', {\n            form_data: safeStringify(payload),\n          });\n        }\n        break;\n\n      case QUERY_PREVIEW:\n        break;\n\n      case SAVE_AS_DATASET:\n        this.toggleSaveDatasetModal();\n        break;\n\n      default:\n        break;\n    }\n  }\n\n  render() {\n    const {\n      showChangeDatasourceModal,\n      showEditDatasourceModal,\n      showSaveDatasetModal,\n    } = this.state;\n    const { datasource, onChange, theme } = this.props;\n    const isMissingDatasource = datasource.id == null;\n    let isMissingParams = false;\n    if (isMissingDatasource) {\n      const datasourceId = getUrlParam(URL_PARAMS.datasourceId);\n      const sliceId = getUrlParam(URL_PARAMS.sliceId);\n      if (!datasourceId && !sliceId) {\n        isMissingParams = true;\n      }\n    }\n\n    const isSqlSupported = datasource.type === 'table';\n    const { user } = this.props;\n    const allowEdit = datasource.owners\n      .map(o => o.id || o.value)\n      .includes(user.userId);\n    isUserAdmin(user);\n\n    const editText = t('Edit dataset');\n\n    const defaultDatasourceMenu = (\n      <Menu onClick={this.handleMenuItemClick}>\n        {this.props.isEditable && (\n          <Menu.Item\n            key={EDIT_DATASET}\n            data-test=\"edit-dataset\"\n            disabled={!allowEdit}\n          >\n            {!allowEdit ? (\n              <Tooltip\n                title={t(\n                  'You must be a dataset owner in order to edit. Please reach out to a dataset owner to request modifications or edit access.',\n                )}\n              >\n                {editText}\n              </Tooltip>\n            ) : (\n              editText\n            )}\n          </Menu.Item>\n        )}\n        <Menu.Item key={CHANGE_DATASET}>{t('Change dataset')}</Menu.Item>\n        {isSqlSupported && (\n          <Menu.Item key={VIEW_IN_SQL_LAB}>{t('View in SQL Lab')}</Menu.Item>\n        )}\n      </Menu>\n    );\n\n    const queryDatasourceMenu = (\n      <Menu onClick={this.handleMenuItemClick}>\n        <Menu.Item key={QUERY_PREVIEW}>{t('Query preview')}</Menu.Item>\n        <Menu.Item key={VIEW_IN_SQL_LAB}>{t('View in SQL Lab')}</Menu.Item>\n        <Menu.Item key={SAVE_AS_DATASET}>{t('Save as dataset')}</Menu.Item>\n      </Menu>\n    );\n\n    const { health_check_message: healthCheckMessage } = datasource;\n\n    let extra = {};\n    if (datasource?.extra) {\n      try {\n        extra = JSON.parse(datasource?.extra);\n      } catch {} // eslint-disable-line no-empty\n    }\n\n    return (\n      <Styles data-test=\"datasource-control\" className=\"DatasourceControl\">\n        <div className=\"data-container\">\n          <Icons.DatasetPhysical className=\"dataset-svg\" />\n          {/* Add a tooltip only for long dataset names */}\n          {!isMissingDatasource && datasource.name.length > 25 ? (\n            <Tooltip title={datasource.name}>\n              <span className=\"title-select\">{datasource.name}</span>\n            </Tooltip>\n          ) : (\n            <span title={datasource.name} className=\"title-select\">\n              {datasource.name}\n            </span>\n          )}\n          {healthCheckMessage && (\n            <Tooltip title={healthCheckMessage}>\n              <Icons.AlertSolid iconColor={theme.colors.warning.base} />\n            </Tooltip>\n          )}\n          {extra?.warning_markdown && (\n            <WarningIconWithTooltip warningMarkdown={extra.warning_markdown} />\n          )}\n          <AntdDropdown\n            overlay={\n              datasource.type === DatasourceType.Query\n                ? queryDatasourceMenu\n                : defaultDatasourceMenu\n            }\n            trigger={['click']}\n            data-test=\"datasource-menu\"\n          >\n            <Tooltip title={t('More dataset related options')}>\n              <Icons.MoreVert\n                className=\"datasource-modal-trigger\"\n                data-test=\"datasource-menu-trigger\"\n              />\n            </Tooltip>\n          </AntdDropdown>\n        </div>\n        {/* missing dataset */}\n        {isMissingDatasource && isMissingParams && (\n          <div className=\"error-alert\">\n            <ErrorAlert\n              level=\"warning\"\n              title={t('Missing URL parameters')}\n              source=\"explore\"\n              subtitle={\n                <>\n                  <p>\n                    {t(\n                      'The URL is missing the dataset_id or slice_id parameters.',\n                    )}\n                  </p>\n                </>\n              }\n            />\n          </div>\n        )}\n        {isMissingDatasource && !isMissingParams && (\n          <div className=\"error-alert\">\n            <ErrorAlert\n              level=\"warning\"\n              title={t('Missing dataset')}\n              source=\"explore\"\n              subtitle={\n                <>\n                  <p>\n                    {t(\n                      'The dataset linked to this chart may have been deleted.',\n                    )}\n                  </p>\n                  <p>\n                    <Button\n                      buttonStyle=\"primary\"\n                      onClick={() =>\n                        this.handleMenuItemClick({ key: CHANGE_DATASET })\n                      }\n                    >\n                      {t('Change dataset')}\n                    </Button>\n                  </p>\n                </>\n              }\n            />\n          </div>\n        )}\n        {showEditDatasourceModal && (\n          <DatasourceModal\n            datasource={datasource}\n            show={showEditDatasourceModal}\n            onDatasourceSave={this.onDatasourceSave}\n            onHide={this.toggleEditDatasourceModal}\n          />\n        )}\n        {showChangeDatasourceModal && (\n          <ChangeDatasourceModal\n            onDatasourceSave={this.onDatasourceSave}\n            onHide={this.toggleChangeDatasourceModal}\n            show={showChangeDatasourceModal}\n            onChange={onChange}\n          />\n        )}\n        {showSaveDatasetModal && (\n          <SaveDatasetModal\n            visible={showSaveDatasetModal}\n            onHide={this.toggleSaveDatasetModal}\n            buttonTextOnSave={t('Save & Explore')}\n            buttonTextOnOverwrite={t('Overwrite & Explore')}\n            modalDescription={t(\n              'Save this query as a virtual dataset to continue exploring',\n            )}\n            datasource={datasource}\n          />\n        )}\n      </Styles>\n    );\n  }\n}\n\nDatasourceControl.propTypes = propTypes;\nDatasourceControl.defaultProps = defaultProps;\n\nexport default withTheme(DatasourceControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ChangeEventHandler,\n  FocusEvent,\n  KeyboardEvent,\n  useCallback,\n  useState,\n} from 'react';\nimport { t, styled } from '@superset-ui/core';\nimport { Input } from 'src/components/Input';\nimport { Tooltip } from 'src/components/Tooltip';\n\nconst TitleLabel = styled.span`\n  display: inline-block;\n  padding: 2px 0;\n`;\n\nconst StyledInput = styled(Input)`\n  border-radius: ${({ theme }) => theme.borderRadius};\n  height: 26px;\n  padding-left: ${({ theme }) => theme.gridUnit * 2.5}px;\n`;\n\nexport interface AdhocMetricEditPopoverTitleProps {\n  title?: {\n    label?: string;\n    hasCustomLabel?: boolean;\n  };\n  isEditDisabled?: boolean;\n  onChange: ChangeEventHandler<HTMLInputElement>;\n}\n\nconst AdhocMetricEditPopoverTitle: React.FC<AdhocMetricEditPopoverTitleProps> =\n  ({ title, isEditDisabled, onChange }) => {\n    const [isHovered, setIsHovered] = useState(false);\n    const [isEditMode, setIsEditMode] = useState(false);\n\n    const defaultLabel = t('My metric');\n\n    const handleMouseOver = useCallback(() => setIsHovered(true), []);\n    const handleMouseOut = useCallback(() => setIsHovered(false), []);\n    const handleClick = useCallback(() => setIsEditMode(true), []);\n    const handleBlur = useCallback(() => setIsEditMode(false), []);\n\n    const handleKeyPress = useCallback(\n      (ev: KeyboardEvent<HTMLInputElement>) => {\n        if (ev.key === 'Enter') {\n          ev.preventDefault();\n          handleBlur();\n        }\n      },\n      [handleBlur],\n    );\n\n    const handleInputBlur = useCallback(\n      (e: FocusEvent<HTMLInputElement>) => {\n        if (e.target.value === '') {\n          onChange(e);\n        }\n\n        handleBlur();\n      },\n      [onChange, handleBlur],\n    );\n\n    if (isEditDisabled) {\n      return (\n        <span data-test=\"AdhocMetricTitle\">{title?.label || defaultLabel}</span>\n      );\n    }\n\n    if (isEditMode) {\n      return (\n        <StyledInput\n          type=\"text\"\n          placeholder={title?.label}\n          value={title?.hasCustomLabel ? title.label : ''}\n          autoFocus\n          onChange={onChange}\n          onBlur={handleInputBlur}\n          onKeyPress={handleKeyPress}\n          data-test=\"AdhocMetricEditTitle#input\"\n        />\n      );\n    }\n\n    return (\n      <Tooltip placement=\"top\" title=\"Click to edit label\">\n        <span\n          className=\"AdhocMetricEditPopoverTitle inline-editable\"\n          data-test=\"AdhocMetricEditTitle#trigger\"\n          onMouseOver={handleMouseOver}\n          onMouseOut={handleMouseOut}\n          onClick={handleClick}\n          onBlur={handleBlur}\n          role=\"button\"\n          tabIndex={0}\n        >\n          <TitleLabel>{title?.label || defaultLabel}</TitleLabel>\n          &nbsp;\n          <i\n            className=\"fa fa-pencil\"\n            style={{ color: isHovered ? 'black' : 'grey' }}\n          />\n        </span>\n      </Tooltip>\n    );\n  };\n\nexport default AdhocMetricEditPopoverTitle;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t, styled, ensureIsArray } from '@superset-ui/core';\nimport Tabs from 'src/components/Tabs';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { EmptyStateSmall } from 'src/components/EmptyState';\nimport { Form, FormItem } from 'src/components/Form';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\nimport { noOp } from 'src/utils/common';\nimport {\n  AGGREGATES_OPTIONS,\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH,\n} from 'src/explore/constants';\nimport columnType from 'src/explore/components/controls/MetricControl/columnType';\nimport savedMetricType from 'src/explore/components/controls/MetricControl/savedMetricType';\nimport AdhocMetric, {\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  StyledMetricOption,\n  StyledColumnOption,\n} from 'src/explore/components/optionRenderers';\n\nconst propTypes = {\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  getCurrentTab: PropTypes.func,\n  getCurrentLabel: PropTypes.func,\n  adhocMetric: PropTypes.instanceOf(AdhocMetric).isRequired,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  savedMetric: savedMetricType,\n  datasource: PropTypes.object,\n};\n\nconst defaultProps = {\n  columns: [],\n  getCurrentTab: noOp,\n};\n\nconst StyledSelect = styled(Select)`\n  .metric-option {\n    & > svg {\n      min-width: ${({ theme }) => `${theme.gridUnit * 4}px`};\n    }\n    & > .option-label {\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n`;\n\nexport const SAVED_TAB_KEY = 'SAVED';\n\nexport default class AdhocMetricEditPopover extends React.PureComponent {\n  // \"Saved\" is a default tab unless there are no saved metrics for dataset\n  defaultActiveTabKey =\n    (this.props.savedMetric.metric_name || this.props.adhocMetric.isNew) &&\n    Array.isArray(this.props.savedMetricsOptions) &&\n    this.props.savedMetricsOptions.length > 0\n      ? SAVED_TAB_KEY\n      : this.props.adhocMetric.expressionType;\n\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onResetStateAndClose = this.onResetStateAndClose.bind(this);\n    this.onColumnChange = this.onColumnChange.bind(this);\n    this.onAggregateChange = this.onAggregateChange.bind(this);\n    this.onSavedMetricChange = this.onSavedMetricChange.bind(this);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n    this.refreshAceEditor = this.refreshAceEditor.bind(this);\n\n    this.state = {\n      adhocMetric: this.props.adhocMetric,\n      savedMetric: this.props.savedMetric,\n      width: POPOVER_INITIAL_WIDTH,\n      height: POPOVER_INITIAL_HEIGHT,\n    };\n\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentDidMount() {\n    this.props.getCurrentTab(this.defaultActiveTabKey);\n  }\n\n  componentDidUpdate(prevProps, prevState) {\n    if (\n      prevState.adhocMetric?.sqlExpression !==\n        this.state.adhocMetric?.sqlExpression ||\n      prevState.adhocMetric?.aggregate !== this.state.adhocMetric?.aggregate ||\n      prevState.adhocMetric?.column?.column_name !==\n        this.state.adhocMetric?.column?.column_name ||\n      prevState.savedMetric?.metric_name !== this.state.savedMetric?.metric_name\n    ) {\n      this.props.getCurrentLabel({\n        savedMetricLabel:\n          this.state.savedMetric?.verbose_name ||\n          this.state.savedMetric?.metric_name,\n        adhocMetricLabel: this.state.adhocMetric?.getDefaultLabel(),\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onSave() {\n    const { adhocMetric, savedMetric } = this.state;\n\n    const metric = savedMetric?.metric_name ? savedMetric : adhocMetric;\n    const oldMetric = this.props.savedMetric?.metric_name\n      ? this.props.savedMetric\n      : this.props.adhocMetric;\n    this.props.onChange(\n      {\n        ...metric,\n      },\n      oldMetric,\n    );\n    this.props.onClose();\n  }\n\n  onResetStateAndClose() {\n    this.setState(\n      {\n        adhocMetric: this.props.adhocMetric,\n        savedMetric: this.props.savedMetric,\n      },\n      this.props.onClose,\n    );\n  }\n\n  onColumnChange(columnName) {\n    const column = this.props.columns.find(\n      column => column.column_name === columnName,\n    );\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        column,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onAggregateChange(aggregate) {\n    // we construct this object explicitly to overwrite the value in the case aggregate is null\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        aggregate,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onSavedMetricChange(savedMetricName) {\n    const savedMetric = this.props.savedMetricsOptions.find(\n      metric => metric.metric_name === savedMetricName,\n    );\n    this.setState(prevState => ({\n      savedMetric,\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        column: undefined,\n        aggregate: undefined,\n        sqlExpression: undefined,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n    }));\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.setState(prevState => ({\n      adhocMetric: prevState.adhocMetric.duplicateWith({\n        sqlExpression,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n      savedMetric: undefined,\n    }));\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        POPOVER_INITIAL_WIDTH,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY) * 2,\n        POPOVER_INITIAL_HEIGHT,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(tab) {\n    this.refreshAceEditor();\n    this.props.getCurrentTab(tab);\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  refreshAceEditor() {\n    setTimeout(() => {\n      if (this.aceEditorRef) {\n        this.aceEditorRef.editor.resize();\n      }\n    }, 0);\n  }\n\n  renderColumnOption(option) {\n    const column = { ...option };\n    if (column.metric_name && !column.verbose_name) {\n      column.verbose_name = column.metric_name;\n    }\n    return <StyledColumnOption column={column} showType />;\n  }\n\n  renderMetricOption(savedMetric) {\n    return <StyledMetricOption metric={savedMetric} showType />;\n  }\n\n  render() {\n    const {\n      adhocMetric: propsAdhocMetric,\n      savedMetric: propsSavedMetric,\n      columns,\n      savedMetricsOptions,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      ...popoverProps\n    } = this.props;\n    const { adhocMetric, savedMetric } = this.state;\n    const keywords = sqlKeywords.concat(\n      columns.map(column => ({\n        name: column.column_name,\n        value: column.column_name,\n        score: 50,\n        meta: 'column',\n      })),\n    );\n\n    const columnValue =\n      (adhocMetric.column && adhocMetric.column.column_name) ||\n      adhocMetric.inferSqlExpressionColumn();\n\n    // autofocus on column if there's no value in column; otherwise autofocus on aggregate\n    const columnSelectProps = {\n      ariaLabel: t('Select column'),\n      placeholder: t('%s column(s)', columns.length),\n      value: columnValue,\n      onChange: this.onColumnChange,\n      allowClear: true,\n      autoFocus: !columnValue,\n    };\n\n    const aggregateSelectProps = {\n      ariaLabel: t('Select aggregate options'),\n      placeholder: t('%s aggregates(s)', AGGREGATES_OPTIONS.length),\n      value: adhocMetric.aggregate || adhocMetric.inferSqlExpressionAggregate(),\n      onChange: this.onAggregateChange,\n      allowClear: true,\n      autoFocus: !!columnValue,\n    };\n\n    const savedSelectProps = {\n      ariaLabel: t('Select saved metrics'),\n      placeholder: t('%s saved metric(s)', savedMetricsOptions?.length ?? 0),\n      value: savedMetric?.metric_name,\n      onChange: this.onSavedMetricChange,\n      allowClear: true,\n      autoFocus: true,\n    };\n\n    if (\n      this.props.datasource?.type === 'druid' &&\n      aggregateSelectProps.options\n    ) {\n      aggregateSelectProps.options = aggregateSelectProps.options.filter(\n        aggregate => aggregate !== 'AVG',\n      );\n    }\n\n    const stateIsValid = adhocMetric.isValid() || savedMetric?.metric_name;\n    const hasUnsavedChanges =\n      !adhocMetric.equals(propsAdhocMetric) ||\n      (!(\n        typeof savedMetric?.metric_name === 'undefined' &&\n        typeof propsSavedMetric?.metric_name === 'undefined'\n      ) &&\n        savedMetric?.metric_name !== propsSavedMetric?.metric_name);\n\n    let extra = {};\n    if (datasource?.extra) {\n      try {\n        extra = JSON.parse(datasource.extra);\n      } catch {} // eslint-disable-line no-empty\n    }\n\n    return (\n      <Form\n        layout=\"vertical\"\n        id=\"metrics-edit-popover\"\n        data-test=\"metrics-edit-popover\"\n        {...popoverProps}\n      >\n        <Tabs\n          id=\"adhoc-metric-edit-tabs\"\n          data-test=\"adhoc-metric-edit-tabs\"\n          defaultActiveKey={this.defaultActiveTabKey}\n          className=\"adhoc-metric-edit-tabs\"\n          style={{ height: this.state.height, width: this.state.width }}\n          onChange={this.onTabChange}\n          allowOverflow\n        >\n          <Tabs.TabPane key={SAVED_TAB_KEY} tab={t('Saved')}>\n            {ensureIsArray(savedMetricsOptions).length > 0 ? (\n              <FormItem label={t('Saved metric')}>\n                <StyledSelect\n                  options={ensureIsArray(savedMetricsOptions).map(\n                    savedMetric => ({\n                      value: savedMetric.metric_name,\n                      label: savedMetric.metric_name,\n                      customLabel: this.renderMetricOption(savedMetric),\n                      key: savedMetric.id,\n                    }),\n                  )}\n                  {...savedSelectProps}\n                />\n              </FormItem>\n            ) : (\n              <EmptyStateSmall\n                image=\"empty.svg\"\n                title={t('No saved metrics found')}\n                description={t(\n                  'Add metrics to dataset in \"Edit datasource\" modal',\n                )}\n              />\n            )}\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            key={EXPRESSION_TYPES.SIMPLE}\n            tab={\n              extra.disallow_adhoc_metrics ? (\n                <Tooltip\n                  title={t(\n                    'Simple ad-hoc metrics are not enabled for this dataset',\n                  )}\n                >\n                  {t('Simple')}\n                </Tooltip>\n              ) : (\n                t('Simple')\n              )\n            }\n            disabled={extra.disallow_adhoc_metrics}\n          >\n            <FormItem label={t('column')}>\n              <Select\n                options={columns.map(column => ({\n                  value: column.column_name,\n                  label: column.verbose_name || column.column_name,\n                  key: column.id,\n                  customLabel: this.renderColumnOption(column),\n                }))}\n                {...columnSelectProps}\n              />\n            </FormItem>\n            <FormItem label={t('aggregate')}>\n              <Select\n                options={AGGREGATES_OPTIONS.map(option => ({\n                  value: option,\n                  label: option,\n                  key: option,\n                }))}\n                {...aggregateSelectProps}\n              />\n            </FormItem>\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            key={EXPRESSION_TYPES.SQL}\n            tab={\n              extra.disallow_adhoc_metrics ||\n              this.props.datasource?.type === 'druid' ? (\n                <Tooltip\n                  title={\n                    this.props.datasource?.type === 'druid'\n                      ? t(\n                          'Custom SQL ad-hoc metrics are not available for the native Druid connector',\n                        )\n                      : t(\n                          'Custom SQL ad-hoc metrics are not enabled for this dataset',\n                        )\n                  }\n                >\n                  {t('Custom SQL')}\n                </Tooltip>\n              ) : (\n                t('Custom SQL')\n              )\n            }\n            data-test=\"adhoc-metric-edit-tab#custom\"\n            disabled={\n              extra.disallow_adhoc_metrics ||\n              this.props.datasource?.type === 'druid'\n            }\n          >\n            <SQLEditor\n              data-test=\"sql-editor\"\n              showLoadingForImport\n              ref={this.handleAceEditorRef}\n              keywords={keywords}\n              height={`${this.state.height - 80}px`}\n              onChange={this.onSqlExpressionChange}\n              width=\"100%\"\n              showGutter={false}\n              value={\n                adhocMetric.sqlExpression ||\n                adhocMetric.translateToSql({ transformCountDistinct: true })\n              }\n              editorProps={{ $blockScrolling: true }}\n              enableLiveAutocompletion\n              className=\"filter-sql-editor\"\n              wrapEnabled\n            />\n          </Tabs.TabPane>\n        </Tabs>\n        <div>\n          <Button\n            buttonSize=\"small\"\n            onClick={this.onResetStateAndClose}\n            data-test=\"AdhocMetricEdit#cancel\"\n            cta\n          >\n            {t('Close')}\n          </Button>\n          <Button\n            disabled={!stateIsValid}\n            buttonStyle={\n              hasUnsavedChanges && stateIsValid ? 'primary' : 'default'\n            }\n            buttonSize=\"small\"\n            data-test=\"AdhocMetricEdit#save\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n          <i\n            role=\"button\"\n            aria-label=\"Resize\"\n            tabIndex={0}\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </div>\n      </Form>\n    );\n  }\n}\nAdhocMetricEditPopover.propTypes = propTypes;\nAdhocMetricEditPopover.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode } from 'react';\nimport { Datasource, Metric } from '@superset-ui/core';\nimport AdhocMetricEditPopoverTitle from 'src/explore/components/controls/MetricControl/AdhocMetricEditPopoverTitle';\nimport { ExplorePopoverContent } from 'src/explore/components/ExploreContentPopover';\nimport AdhocMetricEditPopover, {\n  SAVED_TAB_KEY,\n} from './AdhocMetricEditPopover';\nimport AdhocMetric from './AdhocMetric';\nimport { savedMetricType } from './types';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nexport type AdhocMetricPopoverTriggerProps = {\n  adhocMetric: AdhocMetric;\n  onMetricEdit(newMetric: Metric, oldMetric: Metric): void;\n  columns: { column_name: string; type: string }[];\n  savedMetricsOptions: savedMetricType[];\n  savedMetric: savedMetricType;\n  datasource?: Datasource;\n  children: ReactNode;\n  isControlledComponent?: boolean;\n  visible?: boolean;\n  togglePopover?: (visible: boolean) => void;\n  closePopover?: () => void;\n};\n\nexport type AdhocMetricPopoverTriggerState = {\n  adhocMetric: AdhocMetric;\n  popoverVisible: boolean;\n  title: { label: string; hasCustomLabel: boolean };\n  currentLabel: string;\n  labelModified: boolean;\n  isTitleEditDisabled: boolean;\n};\n\nclass AdhocMetricPopoverTrigger extends React.PureComponent<\n  AdhocMetricPopoverTriggerProps,\n  AdhocMetricPopoverTriggerState\n> {\n  constructor(props: AdhocMetricPopoverTriggerProps) {\n    super(props);\n    this.onPopoverResize = this.onPopoverResize.bind(this);\n    this.onLabelChange = this.onLabelChange.bind(this);\n    this.closePopover = this.closePopover.bind(this);\n    this.togglePopover = this.togglePopover.bind(this);\n    this.getCurrentTab = this.getCurrentTab.bind(this);\n    this.getCurrentLabel = this.getCurrentLabel.bind(this);\n    this.onChange = this.onChange.bind(this);\n\n    this.state = {\n      adhocMetric: props.adhocMetric,\n      popoverVisible: false,\n      title: {\n        label: props.adhocMetric.label,\n        hasCustomLabel: props.adhocMetric.hasCustomLabel,\n      },\n      currentLabel: '',\n      labelModified: false,\n      isTitleEditDisabled: false,\n    };\n  }\n\n  static getDerivedStateFromProps(\n    nextProps: AdhocMetricPopoverTriggerProps,\n    prevState: AdhocMetricPopoverTriggerState,\n  ) {\n    if (prevState.adhocMetric.optionName !== nextProps.adhocMetric.optionName) {\n      return {\n        adhocMetric: nextProps.adhocMetric,\n        title: {\n          label: nextProps.adhocMetric.label,\n          hasCustomLabel: nextProps.adhocMetric.hasCustomLabel,\n        },\n        currentLabel: '',\n        labelModified: false,\n      };\n    }\n    return {\n      adhocMetric: nextProps.adhocMetric,\n    };\n  }\n\n  onLabelChange(e: any) {\n    const { verbose_name, metric_name } = this.props.savedMetric;\n    const defaultMetricLabel = this.props.adhocMetric?.getDefaultLabel();\n    const label = e.target.value;\n    this.setState(state => ({\n      title: {\n        label:\n          label ||\n          state.currentLabel ||\n          verbose_name ||\n          metric_name ||\n          defaultMetricLabel,\n        hasCustomLabel: !!label,\n      },\n      labelModified: true,\n    }));\n  }\n\n  onPopoverResize() {\n    this.forceUpdate();\n  }\n\n  closePopover() {\n    this.togglePopover(false);\n    this.setState({\n      labelModified: false,\n    });\n  }\n\n  togglePopover(visible: boolean) {\n    this.setState({\n      popoverVisible: visible,\n    });\n  }\n\n  getCurrentTab(tab: string) {\n    this.setState({\n      isTitleEditDisabled: tab === SAVED_TAB_KEY,\n    });\n  }\n\n  getCurrentLabel({\n    savedMetricLabel,\n    adhocMetricLabel,\n  }: {\n    savedMetricLabel: string;\n    adhocMetricLabel: string;\n  }) {\n    const currentLabel = savedMetricLabel || adhocMetricLabel;\n    this.setState({\n      currentLabel,\n      labelModified: true,\n    });\n    if (savedMetricLabel || !this.state.title.hasCustomLabel) {\n      this.setState({\n        title: {\n          label: currentLabel,\n          hasCustomLabel: false,\n        },\n      });\n    }\n  }\n\n  onChange(newMetric: Metric, oldMetric: Metric) {\n    this.props.onMetricEdit({ ...newMetric, ...this.state.title }, oldMetric);\n  }\n\n  render() {\n    const {\n      adhocMetric,\n      savedMetric,\n      columns,\n      savedMetricsOptions,\n      datasource,\n      isControlledComponent,\n    } = this.props;\n    const { verbose_name, metric_name } = savedMetric;\n    const { hasCustomLabel, label } = adhocMetric;\n    const adhocMetricLabel = hasCustomLabel\n      ? label\n      : adhocMetric.getDefaultLabel();\n    const title = this.state.labelModified\n      ? this.state.title\n      : {\n          label: verbose_name || metric_name || adhocMetricLabel,\n          hasCustomLabel,\n        };\n\n    const { visible, togglePopover, closePopover } = isControlledComponent\n      ? {\n          visible: this.props.visible,\n          togglePopover: this.props.togglePopover,\n          closePopover: this.props.closePopover,\n        }\n      : {\n          visible: this.state.popoverVisible,\n          togglePopover: this.togglePopover,\n          closePopover: this.closePopover,\n        };\n\n    const overlayContent = (\n      <ExplorePopoverContent>\n        <AdhocMetricEditPopover\n          adhocMetric={adhocMetric}\n          columns={columns}\n          savedMetricsOptions={savedMetricsOptions}\n          savedMetric={savedMetric}\n          datasource={datasource}\n          onResize={this.onPopoverResize}\n          onClose={closePopover}\n          onChange={this.onChange}\n          getCurrentTab={this.getCurrentTab}\n          getCurrentLabel={this.getCurrentLabel}\n        />\n      </ExplorePopoverContent>\n    );\n\n    const popoverTitle = (\n      <AdhocMetricEditPopoverTitle\n        title={title}\n        onChange={this.onLabelChange}\n        isEditDisabled={this.state.isTitleEditDisabled}\n      />\n    );\n\n    return (\n      <ControlPopover\n        placement=\"right\"\n        trigger=\"click\"\n        content={overlayContent}\n        defaultVisible={visible}\n        visible={visible}\n        onVisibleChange={togglePopover}\n        title={popoverTitle}\n        destroyTooltipOnHide\n      >\n        {this.props.children}\n      </ControlPopover>\n    );\n  }\n}\n\nexport default AdhocMetricPopoverTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { OptionControlLabel } from 'src/explore/components/controls/OptionControls';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport columnType from './columnType';\nimport AdhocMetric from './AdhocMetric';\nimport savedMetricType from './savedMetricType';\nimport AdhocMetricPopoverTrigger from './AdhocMetricPopoverTrigger';\n\nconst propTypes = {\n  adhocMetric: PropTypes.instanceOf(AdhocMetric),\n  onMetricEdit: PropTypes.func.isRequired,\n  onRemoveMetric: PropTypes.func,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  savedMetric: savedMetricType,\n  datasource: PropTypes.object,\n  onMoveLabel: PropTypes.func,\n  onDropLabel: PropTypes.func,\n  index: PropTypes.number,\n  type: PropTypes.string,\n  multi: PropTypes.bool,\n};\n\nclass AdhocMetricOption extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.onRemoveMetric = this.onRemoveMetric.bind(this);\n  }\n\n  onRemoveMetric(e) {\n    e.stopPropagation();\n    this.props.onRemoveMetric(this.props.index);\n  }\n\n  render() {\n    const {\n      adhocMetric,\n      onMetricEdit,\n      columns,\n      savedMetricsOptions,\n      savedMetric,\n      datasource,\n      onMoveLabel,\n      onDropLabel,\n      index,\n      type,\n      multi,\n    } = this.props;\n\n    return (\n      <AdhocMetricPopoverTrigger\n        adhocMetric={adhocMetric}\n        onMetricEdit={onMetricEdit}\n        columns={columns}\n        savedMetricsOptions={savedMetricsOptions}\n        savedMetric={savedMetric}\n        datasource={datasource}\n      >\n        <OptionControlLabel\n          savedMetric={savedMetric}\n          adhocMetric={adhocMetric}\n          label={adhocMetric.label}\n          onRemove={this.onRemoveMetric}\n          onMoveLabel={onMoveLabel}\n          onDropLabel={onDropLabel}\n          index={index}\n          type={type ?? DndItemType.AdhocMetricOption}\n          withCaret\n          isFunction\n          multi={multi}\n        />\n      </AdhocMetricPopoverTrigger>\n    );\n  }\n}\n\nexport default AdhocMetricOption;\n\nAdhocMetricOption.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport columnType from './columnType';\nimport AdhocMetricOption from './AdhocMetricOption';\nimport AdhocMetric from './AdhocMetric';\nimport savedMetricType from './savedMetricType';\n\nconst propTypes = {\n  option: PropTypes.oneOfType([PropTypes.object, PropTypes.string]).isRequired,\n  index: PropTypes.number.isRequired,\n  onMetricEdit: PropTypes.func,\n  onRemoveMetric: PropTypes.func,\n  onMoveLabel: PropTypes.func,\n  onDropLabel: PropTypes.func,\n  columns: PropTypes.arrayOf(columnType),\n  savedMetrics: PropTypes.arrayOf(savedMetricType),\n  savedMetricsOptions: PropTypes.arrayOf(savedMetricType),\n  multi: PropTypes.bool,\n  datasource: PropTypes.object,\n};\n\nexport default function MetricDefinitionValue({\n  option,\n  onMetricEdit,\n  onRemoveMetric,\n  columns,\n  savedMetrics,\n  savedMetricsOptions,\n  datasource,\n  onMoveLabel,\n  onDropLabel,\n  index,\n  type,\n  multi,\n}) {\n  const getSavedMetricByName = metricName =>\n    savedMetrics.find(metric => metric.metric_name === metricName);\n\n  let savedMetric;\n  if (typeof option === 'string') {\n    savedMetric = getSavedMetricByName(option);\n  } else if (option.metric_name) {\n    savedMetric = option;\n  }\n\n  if (option instanceof AdhocMetric || savedMetric) {\n    const adhocMetric =\n      option instanceof AdhocMetric ? option : new AdhocMetric({ isNew: true });\n\n    const metricOptionProps = {\n      onMetricEdit,\n      onRemoveMetric,\n      columns,\n      savedMetricsOptions,\n      datasource,\n      adhocMetric,\n      onMoveLabel,\n      onDropLabel,\n      index,\n      savedMetric: savedMetric ?? {},\n      type,\n      multi,\n    };\n\n    return <AdhocMetricOption {...metricOptionProps} />;\n  }\n  return null;\n}\nMetricDefinitionValue.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { ensureIsArray, t, useTheme } from '@superset-ui/core';\nimport { isEqual } from 'lodash';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport Icons from 'src/components/Icons';\nimport {\n  AddIconButton,\n  AddControlLabel,\n  HeaderContainer,\n  LabelsContainer,\n} from 'src/explore/components/controls/OptionControls';\nimport { usePrevious } from 'src/hooks/usePrevious';\nimport columnType from './columnType';\nimport MetricDefinitionValue from './MetricDefinitionValue';\nimport AdhocMetric from './AdhocMetric';\nimport savedMetricType from './savedMetricType';\nimport adhocMetricType from './adhocMetricType';\nimport AdhocMetricPopoverTrigger from './AdhocMetricPopoverTrigger';\n\nconst propTypes = {\n  name: PropTypes.string.isRequired,\n  onChange: PropTypes.func,\n  value: PropTypes.oneOfType([\n    PropTypes.arrayOf(PropTypes.oneOfType([PropTypes.string, adhocMetricType])),\n    PropTypes.oneOfType([PropTypes.string, adhocMetricType]),\n  ]),\n  columns: PropTypes.arrayOf(columnType),\n  savedMetrics: PropTypes.arrayOf(savedMetricType),\n  isLoading: PropTypes.bool,\n  multi: PropTypes.bool,\n  clearable: PropTypes.bool,\n  datasource: PropTypes.object,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  clearable: true,\n  savedMetrics: [],\n  columns: [],\n};\n\nfunction getOptionsForSavedMetrics(\n  savedMetrics,\n  currentMetricValues,\n  currentMetric,\n) {\n  return (\n    savedMetrics?.filter(savedMetric =>\n      Array.isArray(currentMetricValues)\n        ? !currentMetricValues.includes(savedMetric.metric_name) ||\n          savedMetric.metric_name === currentMetric\n        : savedMetric,\n    ) ?? []\n  );\n}\n\nfunction isDictionaryForAdhocMetric(value) {\n  return value && !(value instanceof AdhocMetric) && value.expressionType;\n}\n\n// adhoc metrics are stored as dictionaries in URL params. We convert them back into the\n// AdhocMetric class for typechecking, consistency and instance method access.\nfunction coerceAdhocMetrics(value) {\n  if (!value) {\n    return [];\n  }\n  if (!Array.isArray(value)) {\n    if (isDictionaryForAdhocMetric(value)) {\n      return [new AdhocMetric(value)];\n    }\n    return [value];\n  }\n  return value.map(val => {\n    if (isDictionaryForAdhocMetric(val)) {\n      return new AdhocMetric(val);\n    }\n    return val;\n  });\n}\n\nconst emptySavedMetric = { metric_name: '', expression: '' };\n\n// TODO: use typeguards to distinguish saved metrics from adhoc metrics\nconst getMetricsMatchingCurrentDataset = (value, columns, savedMetrics) =>\n  ensureIsArray(value).filter(metric => {\n    if (typeof metric === 'string' || metric.metric_name) {\n      return savedMetrics?.some(\n        savedMetric =>\n          savedMetric.metric_name === metric ||\n          savedMetric.metric_name === metric.metric_name,\n      );\n    }\n    return columns?.some(\n      column =>\n        !metric.column || metric.column.column_name === column.column_name,\n    );\n  });\n\nconst MetricsControl = ({\n  onChange,\n  multi,\n  value: propsValue,\n  columns,\n  savedMetrics,\n  datasource,\n  ...props\n}) => {\n  const [value, setValue] = useState(coerceAdhocMetrics(propsValue));\n  const theme = useTheme();\n  const prevColumns = usePrevious(columns);\n  const prevSavedMetrics = usePrevious(savedMetrics);\n\n  const handleChange = useCallback(\n    opts => {\n      // if clear out options\n      if (opts === null) {\n        onChange(null);\n        return;\n      }\n\n      const transformedOpts = ensureIsArray(opts);\n      const optionValues = transformedOpts\n        .map(option => {\n          // pre-defined metric\n          if (option.metric_name) {\n            return option.metric_name;\n          }\n          return option;\n        })\n        .filter(option => option);\n      onChange(multi ? optionValues : optionValues[0]);\n    },\n    [multi, onChange],\n  );\n\n  const onNewMetric = useCallback(\n    newMetric => {\n      const newValue = [...value, newMetric];\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, value],\n  );\n\n  const onMetricEdit = useCallback(\n    (changedMetric, oldMetric) => {\n      const newValue = value.map(val => {\n        if (\n          // compare saved metrics\n          val === oldMetric.metric_name ||\n          // compare adhoc metrics\n          typeof val.optionName !== 'undefined'\n            ? val.optionName === oldMetric.optionName\n            : false\n        ) {\n          return changedMetric;\n        }\n        return val;\n      });\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, value],\n  );\n\n  const onRemoveMetric = useCallback(\n    index => {\n      if (!Array.isArray(value)) {\n        return;\n      }\n      const valuesCopy = [...value];\n      valuesCopy.splice(index, 1);\n      setValue(valuesCopy);\n      handleChange(valuesCopy);\n    },\n    [handleChange, value],\n  );\n\n  const moveLabel = useCallback(\n    (dragIndex, hoverIndex) => {\n      const newValues = [...value];\n      [newValues[hoverIndex], newValues[dragIndex]] = [\n        newValues[dragIndex],\n        newValues[hoverIndex],\n      ];\n      setValue(newValues);\n    },\n    [value],\n  );\n\n  const isAddNewMetricDisabled = useCallback(\n    () => !multi && value.length > 0,\n    [multi, value.length],\n  );\n\n  const savedMetricOptions = useMemo(\n    () => getOptionsForSavedMetrics(savedMetrics, propsValue, null),\n    [propsValue, savedMetrics],\n  );\n\n  const newAdhocMetric = useMemo(\n    () => new AdhocMetric({ isNew: true }),\n    [value],\n  );\n  const addNewMetricPopoverTrigger = useCallback(\n    trigger => {\n      if (isAddNewMetricDisabled()) {\n        return trigger;\n      }\n      return (\n        <AdhocMetricPopoverTrigger\n          adhocMetric={newAdhocMetric}\n          onMetricEdit={onNewMetric}\n          columns={columns}\n          savedMetricsOptions={savedMetricOptions}\n          savedMetric={emptySavedMetric}\n          datasource={datasource}\n        >\n          {trigger}\n        </AdhocMetricPopoverTrigger>\n      );\n    },\n    [\n      columns,\n      datasource,\n      isAddNewMetricDisabled,\n      newAdhocMetric,\n      onNewMetric,\n      savedMetricOptions,\n    ],\n  );\n\n  useEffect(() => {\n    // Remove selected custom metrics that do not exist in the dataset anymore\n    // Remove selected adhoc metrics that use columns which do not exist in the dataset anymore\n    if (\n      propsValue &&\n      (!isEqual(prevColumns, columns) ||\n        !isEqual(prevSavedMetrics, savedMetrics))\n    ) {\n      const matchingMetrics = getMetricsMatchingCurrentDataset(\n        propsValue,\n        columns,\n        savedMetrics,\n      );\n      if (!isEqual(matchingMetrics, propsValue)) {\n        handleChange(matchingMetrics);\n      }\n    }\n  }, [columns, handleChange, savedMetrics]);\n\n  useEffect(() => {\n    setValue(coerceAdhocMetrics(propsValue));\n  }, [propsValue]);\n\n  const onDropLabel = useCallback(\n    () => handleChange(value),\n    [handleChange, value],\n  );\n\n  const valueRenderer = useCallback(\n    (option, index) => (\n      <MetricDefinitionValue\n        key={index}\n        index={index}\n        option={option}\n        onMetricEdit={onMetricEdit}\n        onRemoveMetric={onRemoveMetric}\n        columns={columns}\n        datasource={datasource}\n        savedMetrics={savedMetrics}\n        savedMetricsOptions={getOptionsForSavedMetrics(\n          savedMetrics,\n          value,\n          value?.[index],\n        )}\n        onMoveLabel={moveLabel}\n        onDropLabel={onDropLabel}\n        multi={multi}\n      />\n    ),\n    [\n      columns,\n      datasource,\n      moveLabel,\n      multi,\n      onDropLabel,\n      onMetricEdit,\n      onRemoveMetric,\n      savedMetrics,\n      value,\n    ],\n  );\n\n  return (\n    <div className=\"metrics-select\">\n      <HeaderContainer>\n        <ControlHeader {...props} />\n        {addNewMetricPopoverTrigger(\n          <AddIconButton\n            disabled={isAddNewMetricDisabled()}\n            data-test=\"add-metric-button\"\n          >\n            <Icons.PlusLarge\n              iconSize=\"s\"\n              iconColor={theme.colors.grayscale.light5}\n            />\n          </AddIconButton>,\n        )}\n      </HeaderContainer>\n      <LabelsContainer>\n        {value.length > 0\n          ? value.map((value, index) => valueRenderer(value, index))\n          : addNewMetricPopoverTrigger(\n              <AddControlLabel>\n                <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n                {t('Add metric')}\n              </AddControlLabel>,\n            )}\n      </LabelsContainer>\n    </div>\n  );\n};\n\nMetricsControl.propTypes = propTypes;\nMetricsControl.defaultProps = defaultProps;\n\nexport default MetricsControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { css } from '@emotion/react';\nimport { t } from '@superset-ui/core';\nimport Label from 'src/components/Label';\nimport Collapse from 'src/components/Collapse';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport MetricsControl from 'src/explore/components/controls/MetricControl/MetricsControl';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport PopoverSection from 'src/components/PopoverSection';\n\nconst controlTypes = {\n  fixed: 'fix',\n  metric: 'metric',\n};\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.object,\n  isFloat: PropTypes.bool,\n  datasource: PropTypes.object.isRequired,\n  default: PropTypes.shape({\n    type: PropTypes.oneOf(['fix', 'metric']),\n    value: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  }),\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  default: { type: controlTypes.fixed, value: 5 },\n};\n\nexport default class FixedOrMetricControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n    this.setType = this.setType.bind(this);\n    this.setFixedValue = this.setFixedValue.bind(this);\n    this.setMetric = this.setMetric.bind(this);\n    const type =\n      (props.value ? props.value.type : props.default.type) ||\n      controlTypes.fixed;\n    const value =\n      (props.value ? props.value.value : props.default.value) || '100';\n    this.state = {\n      type,\n      fixedValue: type === controlTypes.fixed ? value : '',\n      metricValue: type === controlTypes.metric ? value : null,\n    };\n  }\n\n  onChange() {\n    this.props.onChange({\n      type: this.state.type,\n      value:\n        this.state.type === controlTypes.fixed\n          ? this.state.fixedValue\n          : this.state.metricValue,\n    });\n  }\n\n  setType(type) {\n    this.setState({ type }, this.onChange);\n  }\n\n  setFixedValue(fixedValue) {\n    this.setState({ fixedValue }, this.onChange);\n  }\n\n  setMetric(metricValue) {\n    this.setState({ metricValue }, this.onChange);\n  }\n\n  render() {\n    const value = this.props.value || this.props.default;\n    const type = value.type || controlTypes.fixed;\n    const columns = this.props.datasource\n      ? this.props.datasource.columns\n      : null;\n    const metrics = this.props.datasource\n      ? this.props.datasource.metrics\n      : null;\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Collapse\n          ghost\n          css={theme => css`\n            &.ant-collapse\n              > .ant-collapse-item.ant-collapse-no-arrow\n              > .ant-collapse-header {\n              border: 0px;\n              padding: 0px 0px ${theme.gridUnit * 2}px 0px;\n              display: inline-block;\n            }\n            &.ant-collapse-ghost\n              > .ant-collapse-item\n              > .ant-collapse-content\n              > .ant-collapse-content-box {\n              padding: 0px;\n\n              & .well {\n                margin-bottom: 0px;\n                padding: ${theme.gridUnit * 2}px;\n              }\n            }\n          `}\n        >\n          <Collapse.Panel\n            showArrow={false}\n            header={\n              <Label onClick={() => undefined}>\n                {this.state.type === controlTypes.fixed && (\n                  <span>{this.state.fixedValue}</span>\n                )}\n                {this.state.type === controlTypes.metric && (\n                  <span>\n                    <span>metric: </span>\n                    <strong>\n                      {this.state.metricValue\n                        ? this.state.metricValue.label\n                        : null}\n                    </strong>\n                  </span>\n                )}\n              </Label>\n            }\n          >\n            <div className=\"well\">\n              <PopoverSection\n                title={t('Fixed')}\n                isSelected={type === controlTypes.fixed}\n                onSelect={() => {\n                  this.setType(controlTypes.fixed);\n                }}\n              >\n                <TextControl\n                  isFloat\n                  onChange={this.setFixedValue}\n                  onFocus={() => {\n                    this.setType(controlTypes.fixed);\n                  }}\n                  value={this.state.fixedValue}\n                />\n              </PopoverSection>\n              <PopoverSection\n                title={t('Based on a metric')}\n                isSelected={type === controlTypes.metric}\n                onSelect={() => {\n                  this.setType(controlTypes.metric);\n                }}\n              >\n                <MetricsControl\n                  name=\"metric\"\n                  columns={columns}\n                  savedMetrics={metrics}\n                  multi={false}\n                  onFocus={() => {\n                    this.setType(controlTypes.metric);\n                  }}\n                  onChange={this.setMetric}\n                  value={this.state.metricValue}\n                  datasource={this.props.datasource}\n                />\n              </PopoverSection>\n            </div>\n          </Collapse.Panel>\n        </Collapse>\n      </div>\n    );\n  }\n}\n\nFixedOrMetricControl.propTypes = propTypes;\nFixedOrMetricControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { t, SupersetClient } from '@superset-ui/core';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Select } from 'src/components';\nimport { SelectProps, OptionsType } from 'src/components/Select/Select';\nimport { SelectValue, LabeledValue } from 'antd/lib/select';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\n\ntype SelectAsyncProps = Omit<SelectProps, 'options' | 'ariaLabel' | 'onChange'>;\n\ninterface SelectAsyncControlProps extends SelectAsyncProps {\n  addDangerToast: (error: string) => void;\n  ariaLabel?: string;\n  dataEndpoint: string;\n  default?: SelectValue;\n  mutator?: (response: Record<string, any>) => OptionsType;\n  multi?: boolean;\n  onChange: (val: SelectValue) => void;\n  // ControlHeader related props\n  description?: string;\n  hovered?: boolean;\n  label?: string;\n}\n\nfunction isLabeledValue(arg: any): arg is LabeledValue {\n  return arg.value !== undefined;\n}\n\nconst SelectAsyncControl = ({\n  addDangerToast,\n  allowClear = true,\n  ariaLabel,\n  dataEndpoint,\n  multi = true,\n  mutator,\n  onChange,\n  placeholder,\n  value,\n  ...props\n}: SelectAsyncControlProps) => {\n  const [options, setOptions] = useState<OptionsType>([]);\n\n  const handleOnChange = (val: SelectValue) => {\n    let onChangeVal = val;\n    if (Array.isArray(val)) {\n      const values = val.map(v => (isLabeledValue(v) ? v.value : v));\n      onChangeVal = values;\n    }\n    if (isLabeledValue(val)) {\n      onChangeVal = val.value;\n    }\n    onChange(onChangeVal);\n  };\n\n  const getValue = () => {\n    const currentValue =\n      value || (props.default !== undefined ? props.default : undefined);\n\n    // safety check - the value is intended to be undefined but null was used\n    if (currentValue === null && !options.find(o => o.value === null)) {\n      return undefined;\n    }\n    return currentValue;\n  };\n\n  useEffect(() => {\n    const onError = (response: Response) =>\n      getClientErrorObject(response).then(e => {\n        const { error } = e;\n        addDangerToast(t('Error while fetching data: %s', error));\n      });\n    const loadOptions = () =>\n      SupersetClient.get({\n        endpoint: dataEndpoint,\n      })\n        .then(response => {\n          const data = mutator ? mutator(response.json) : response.json.result;\n          setOptions(data);\n        })\n        .catch(onError);\n    loadOptions();\n  }, [addDangerToast, dataEndpoint, mutator]);\n\n  return (\n    <Select\n      allowClear={allowClear}\n      ariaLabel={ariaLabel || t('Select ...')}\n      value={getValue()}\n      header={<ControlHeader {...props} />}\n      mode={multi ? 'multiple' : 'single'}\n      onChange={handleOnChange}\n      options={options}\n      placeholder={placeholder}\n    />\n  );\n};\n\nexport default withToasts(SelectAsyncControl);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport AntdSlider, {\n  SliderSingleProps,\n  SliderRangeProps,\n} from 'antd/lib/slider';\n\nexport type { SliderSingleProps, SliderRangeProps };\n\nexport default function Slider(props: SliderSingleProps | SliderRangeProps) {\n  return <AntdSlider {...props} css={{ marginLeft: 0, marginRight: 0 }} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Input } from 'src/components/Input';\nimport Button from 'src/components/Button';\nimport { Select, Row, Col } from 'src/components';\nimport { t, styled } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport BoundsControl from '../BoundsControl';\nimport CheckboxControl from '../CheckboxControl';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nconst propTypes = {\n  label: PropTypes.string,\n  tooltip: PropTypes.string,\n  colType: PropTypes.string,\n  width: PropTypes.string,\n  height: PropTypes.string,\n  timeLag: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n  timeRatio: PropTypes.string,\n  comparisonType: PropTypes.string,\n  showYAxis: PropTypes.bool,\n  yAxisBounds: PropTypes.array,\n  bounds: PropTypes.array,\n  d3format: PropTypes.string,\n  dateFormat: PropTypes.string,\n  onChange: PropTypes.func,\n};\n\nconst defaultProps = {\n  label: t('Time series columns'),\n  tooltip: '',\n  colType: '',\n  width: '',\n  height: '',\n  timeLag: '',\n  timeRatio: '',\n  comparisonType: '',\n  showYAxis: false,\n  yAxisBounds: [null, null],\n  bounds: [null, null],\n  d3format: '',\n  dateFormat: '',\n};\n\nconst comparisonTypeOptions = [\n  { value: 'value', label: 'Actual value', key: 'value' },\n  { value: 'diff', label: 'Difference', key: 'diff' },\n  { value: 'perc', label: 'Percentage', key: 'perc' },\n  { value: 'perc_change', label: 'Percentage change', key: 'perc_change' },\n];\n\nconst colTypeOptions = [\n  { value: 'time', label: 'Time comparison', key: 'time' },\n  { value: 'contrib', label: 'Contribution', key: 'contrib' },\n  { value: 'spark', label: 'Sparkline', key: 'spark' },\n  { value: 'avg', label: 'Period average', key: 'avg' },\n];\n\nconst StyledRow = styled(Row)`\n  margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n  display: flex;\n  align-items: center;\n`;\n\nconst StyledCol = styled(Col)`\n  display: flex;\n  align-items: center;\n`;\n\nconst StyledTooltip = styled(InfoTooltipWithTrigger)`\n  margin-left: ${({ theme }) => theme.gridUnit}px;\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n`;\n\nconst ButtonBar = styled.div`\n  margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  display: flex;\n  justify-content: center;\n`;\n\nexport default class TimeSeriesColumnControl extends React.Component {\n  constructor(props) {\n    super(props);\n\n    this.onSave = this.onSave.bind(this);\n    this.onClose = this.onClose.bind(this);\n    this.resetState = this.resetState.bind(this);\n    this.initialState = this.initialState.bind(this);\n    this.onPopoverVisibleChange = this.onPopoverVisibleChange.bind(this);\n\n    this.state = this.initialState();\n  }\n\n  initialState() {\n    return {\n      label: this.props.label,\n      tooltip: this.props.tooltip,\n      colType: this.props.colType,\n      width: this.props.width,\n      height: this.props.height,\n      timeLag: this.props.timeLag || 0,\n      timeRatio: this.props.timeRatio,\n      comparisonType: this.props.comparisonType,\n      showYAxis: this.props.showYAxis,\n      yAxisBounds: this.props.yAxisBounds,\n      bounds: this.props.bounds,\n      d3format: this.props.d3format,\n      dateFormat: this.props.dateFormat,\n      popoverVisible: false,\n    };\n  }\n\n  resetState() {\n    const initialState = this.initialState();\n    this.setState({ ...initialState });\n  }\n\n  onSave() {\n    this.props.onChange(this.state);\n    this.setState({ popoverVisible: false });\n  }\n\n  onClose() {\n    this.resetState();\n  }\n\n  onSelectChange(attr, opt) {\n    this.setState({ [attr]: opt });\n  }\n\n  onTextInputChange(attr, event) {\n    this.setState({ [attr]: event.target.value });\n  }\n\n  onCheckboxChange(attr, value) {\n    this.setState({ [attr]: value });\n  }\n\n  onBoundsChange(bounds) {\n    this.setState({ bounds });\n  }\n\n  onPopoverVisibleChange(popoverVisible) {\n    if (popoverVisible) {\n      this.setState({ popoverVisible });\n    } else {\n      this.resetState();\n    }\n  }\n\n  onYAxisBoundsChange(yAxisBounds) {\n    this.setState({ yAxisBounds });\n  }\n\n  textSummary() {\n    return `${this.props.label}`;\n  }\n\n  formRow(label, tooltip, ttLabel, control) {\n    return (\n      <StyledRow>\n        <StyledCol xs={24} md={11}>\n          {label}\n          <StyledTooltip placement=\"top\" tooltip={tooltip} label={ttLabel} />\n        </StyledCol>\n        <Col xs={24} md={13}>\n          {control}\n        </Col>\n      </StyledRow>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id=\"ts-col-popo\" style={{ width: 320 }}>\n        {this.formRow(\n          'Label',\n          'The column header label',\n          'time-lag',\n          <Input\n            value={this.state.label}\n            onChange={this.onTextInputChange.bind(this, 'label')}\n            placeholder=\"Label\"\n          />,\n        )}\n        {this.formRow(\n          'Tooltip',\n          'Column header tooltip',\n          'col-tooltip',\n          <Input\n            value={this.state.tooltip}\n            onChange={this.onTextInputChange.bind(this, 'tooltip')}\n            placeholder=\"Tooltip\"\n          />,\n        )}\n        {this.formRow(\n          'Type',\n          'Type of comparison, value difference or percentage',\n          'col-type',\n          <Select\n            ariaLabel={t('Type')}\n            value={this.state.colType || undefined}\n            onChange={this.onSelectChange.bind(this, 'colType')}\n            options={colTypeOptions}\n          />,\n        )}\n        <hr />\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            'Width',\n            'Width of the sparkline',\n            'spark-width',\n            <Input\n              value={this.state.width}\n              onChange={this.onTextInputChange.bind(this, 'width')}\n              placeholder=\"Width\"\n            />,\n          )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            'Height',\n            'Height of the sparkline',\n            'spark-width',\n            <Input\n              value={this.state.height}\n              onChange={this.onTextInputChange.bind(this, 'height')}\n              placeholder=\"Height\"\n            />,\n          )}\n        {['time', 'avg'].indexOf(this.state.colType) >= 0 &&\n          this.formRow(\n            'Time lag',\n            'Number of periods to compare against',\n            'time-lag',\n            <Input\n              value={this.state.timeLag}\n              onChange={this.onTextInputChange.bind(this, 'timeLag')}\n              placeholder=\"Time Lag\"\n            />,\n          )}\n        {['spark'].indexOf(this.state.colType) >= 0 &&\n          this.formRow(\n            'Time ratio',\n            'Number of periods to ratio against',\n            'time-ratio',\n            <Input\n              value={this.state.timeRatio}\n              onChange={this.onTextInputChange.bind(this, 'timeRatio')}\n              placeholder=\"Time Ratio\"\n            />,\n          )}\n        {this.state.colType === 'time' &&\n          this.formRow(\n            'Type',\n            'Type of comparison, value difference or percentage',\n            'comp-type',\n            <Select\n              ariaLabel={t('Type')}\n              value={this.state.comparisonType || undefined}\n              onChange={this.onSelectChange.bind(this, 'comparisonType')}\n              options={comparisonTypeOptions}\n            />,\n          )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            'Show Y-axis',\n            'Show Y-axis on the sparkline. Will display the manually set min/max if set or min/max values in the data otherwise.',\n            'show-y-axis-bounds',\n            <CheckboxControl\n              value={this.state.showYAxis}\n              onChange={this.onCheckboxChange.bind(this, 'showYAxis')}\n            />,\n          )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            'Y-axis bounds',\n            'Manually set min/max values for the y-axis.',\n            'y-axis-bounds',\n            <BoundsControl\n              value={this.state.yAxisBounds}\n              onChange={this.onYAxisBoundsChange.bind(this)}\n            />,\n          )}\n        {this.state.colType !== 'spark' &&\n          this.formRow(\n            'Color bounds',\n            `Number bounds used for color encoding from red to blue.\n              Reverse the numbers for blue to red. To get pure red or blue,\n              you can enter either only min or max.`,\n            'bounds',\n            <BoundsControl\n              value={this.state.bounds}\n              onChange={this.onBoundsChange.bind(this)}\n            />,\n          )}\n        {this.formRow(\n          'Number format',\n          'Optional d3 number format string',\n          'd3-format',\n          <Input\n            value={this.state.d3format}\n            onChange={this.onTextInputChange.bind(this, 'd3format')}\n            placeholder=\"Number format string\"\n          />,\n        )}\n        {this.state.colType === 'spark' &&\n          this.formRow(\n            'Date format',\n            'Optional d3 date format string',\n            'date-format',\n            <Input\n              value={this.state.dateFormat}\n              onChange={this.onTextInputChange.bind(this, 'dateFormat')}\n              placeholder=\"Date format string\"\n            />,\n          )}\n        <ButtonBar>\n          <Button buttonSize=\"small\" onClick={this.onClose} cta>\n            {t('Close')}\n          </Button>\n          <Button\n            buttonStyle=\"primary\"\n            buttonSize=\"small\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n        </ButtonBar>\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <span>\n        {this.textSummary()}{' '}\n        <ControlPopover\n          trigger=\"click\"\n          content={this.renderPopover()}\n          title=\"Column Configuration\"\n          visible={this.state.popoverVisible}\n          onVisibleChange={this.onPopoverVisibleChange}\n        >\n          <InfoTooltipWithTrigger\n            icon=\"edit\"\n            className=\"text-primary\"\n            label=\"edit-ts-column\"\n          />\n        </ControlPopover>\n      </span>\n    );\n  }\n}\n\nTimeSeriesColumnControl.propTypes = propTypes;\nTimeSeriesColumnControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Popover from 'src/components/Popover';\nimport { decimal2sexagesimal } from 'geolib';\n\nimport Label from 'src/components/Label';\nimport { FormLabel } from 'src/components/Form';\nimport TextControl from './TextControl';\nimport ControlHeader from '../ControlHeader';\n\nexport const DEFAULT_VIEWPORT = {\n  longitude: 6.85236157047845,\n  latitude: 31.222656842808707,\n  zoom: 1,\n  bearing: 0,\n  pitch: 0,\n};\n\nconst PARAMS = ['longitude', 'latitude', 'zoom', 'bearing', 'pitch'];\n\nconst propTypes = {\n  onChange: PropTypes.func,\n  value: PropTypes.shape({\n    longitude: PropTypes.number,\n    latitude: PropTypes.number,\n    zoom: PropTypes.number,\n    bearing: PropTypes.number,\n    pitch: PropTypes.number,\n  }),\n  default: PropTypes.object,\n  name: PropTypes.string.isRequired,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  default: { type: 'fix', value: 5 },\n  value: DEFAULT_VIEWPORT,\n};\n\nexport default class ViewportControl extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onChange = this.onChange.bind(this);\n  }\n\n  onChange(ctrl, value) {\n    this.props.onChange({\n      ...this.props.value,\n      [ctrl]: value,\n    });\n  }\n\n  renderTextControl(ctrl) {\n    return (\n      <div key={ctrl}>\n        <FormLabel>{ctrl}</FormLabel>\n        <TextControl\n          value={this.props.value[ctrl]}\n          onChange={this.onChange.bind(this, ctrl)}\n          isFloat\n        />\n      </div>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id={`filter-popover-${this.props.name}`}>\n        {PARAMS.map(ctrl => this.renderTextControl(ctrl))}\n      </div>\n    );\n  }\n\n  renderLabel() {\n    if (this.props.value.longitude && this.props.value.latitude) {\n      return `${decimal2sexagesimal(\n        this.props.value.longitude,\n      )} | ${decimal2sexagesimal(this.props.value.latitude)}`;\n    }\n    return 'N/A';\n  }\n\n  render() {\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Popover\n          container={document.body}\n          trigger=\"click\"\n          placement=\"right\"\n          content={this.renderPopover()}\n          title=\"Viewport\"\n        >\n          <Label className=\"pointer\">{this.renderLabel()}</Label>\n        </Popover>\n      </div>\n    );\n  }\n}\n\nViewportControl.propTypes = propTypes;\nViewportControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ReactElement,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { useSelector } from 'react-redux';\nimport { css, SupersetTheme, t, useTheme } from '@superset-ui/core';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { ExplorePageState } from 'src/explore/reducers/getInitialState';\n\nexport interface VizMeta {\n  icon: ReactElement;\n  name: string;\n}\n\nexport interface FastVizSwitcherProps {\n  onChange: (vizName: string) => void;\n  currentSelection: string | null;\n}\ninterface VizTileProps {\n  vizMeta: VizMeta;\n  isActive: boolean;\n  isRendered: boolean;\n  onTileClick: (vizType: string) => void;\n}\n\nconst FEATURED_CHARTS: VizMeta[] = [\n  {\n    name: 'echarts_timeseries_line',\n    icon: <Icons.LineChartTile />,\n  },\n  { name: 'table', icon: <Icons.TableChartTile /> },\n  {\n    name: 'big_number_total',\n    icon: <Icons.BigNumberChartTile />,\n  },\n  { name: 'pie', icon: <Icons.PieChartTile /> },\n  {\n    name: 'echarts_timeseries_bar',\n    icon: <Icons.BarChartTile />,\n  },\n  { name: 'echarts_area', icon: <Icons.AreaChartTile /> },\n];\n\nconst VizTile = ({\n  isActive,\n  isRendered,\n  vizMeta,\n  onTileClick,\n}: VizTileProps) => {\n  const { mountedPluginMetadata } = usePluginContext();\n  const chartNameRef = useRef<HTMLSpanElement>(null);\n  const theme = useTheme();\n  const TILE_TRANSITION_TIME = theme.transitionTiming * 2;\n  const [tooltipVisible, setTooltipVisible] = useState(false);\n  const [isTransitioning, setIsTransitioning] = useState(false);\n  const [showTooltip, setShowTooltip] = useState(false);\n  const chartName = vizMeta.name\n    ? mountedPluginMetadata[vizMeta.name]?.name || `${vizMeta.name}`\n    : t('Select Viz Type');\n\n  const handleTileClick = useCallback(() => {\n    onTileClick(vizMeta.name);\n    setIsTransitioning(true);\n    setTooltipVisible(false);\n    setTimeout(() => {\n      setIsTransitioning(false);\n    }, TILE_TRANSITION_TIME * 1000);\n  }, [onTileClick, TILE_TRANSITION_TIME, vizMeta.name]);\n\n  // Antd tooltip seems to be bugged - when elements move, the tooltip sometimes\n  // stays visible even when user doesn't hover over the element.\n  // Here we manually prevent it from displaying after user triggers transition\n  useEffect(() => {\n    setShowTooltip(\n      Boolean(\n        !isTransitioning &&\n          (!isActive ||\n            (chartNameRef.current &&\n              chartNameRef.current.scrollWidth >\n                chartNameRef.current.clientWidth)),\n      ),\n    );\n  }, [isActive, isTransitioning]);\n\n  const containerProps = useMemo(\n    () =>\n      !isActive\n        ? { role: 'button', tabIndex: 0, onClick: handleTileClick }\n        : {},\n    [handleTileClick, isActive],\n  );\n\n  let tooltipTitle: string | null = null;\n  if (showTooltip) {\n    tooltipTitle = isRendered\n      ? t('Currently rendered: %s', chartName)\n      : chartName;\n  }\n  return (\n    <Tooltip\n      title={tooltipTitle}\n      onVisibleChange={visible => setTooltipVisible(visible)}\n      visible={tooltipVisible && !isTransitioning}\n      placement=\"top\"\n      mouseEnterDelay={0.4}\n    >\n      <div\n        {...containerProps}\n        css={css`\n          display: flex;\n          align-items: center;\n          text-transform: uppercase;\n\n          color: ${theme.colors.grayscale.base};\n          font-weight: ${theme.typography.weights.bold};\n          border-radius: 6px;\n          white-space: nowrap;\n          overflow: hidden;\n          max-width: fit-content;\n\n          ${!isActive &&\n          css`\n            flex-shrink: 0;\n            width: ${theme.gridUnit * 6}px;\n            background-color: transparent;\n            transition: none;\n            &:hover svg path {\n              fill: ${theme.colors.primary.base};\n              transition: fill ${theme.transitionTiming}s ease-out;\n            }\n          `}\n\n          ${isActive &&\n          css`\n            width: 100%;\n            background-color: ${theme.colors.grayscale.light4};\n            transition: width ${TILE_TRANSITION_TIME}s ease-out,\n              background-color ${TILE_TRANSITION_TIME}s ease-out;\n            cursor: default;\n            svg path {\n              fill: ${theme.colors.primary.base};\n            }\n          `}\n        `}\n      >\n        {vizMeta.icon}{' '}\n        <span\n          css={css`\n            overflow: hidden;\n            text-overflow: ellipsis;\n            min-width: 0;\n            padding-right: ${theme.gridUnit}px;\n          `}\n          ref={chartNameRef}\n        >\n          {chartName}\n        </span>\n      </div>\n    </Tooltip>\n  );\n};\n\nexport const FastVizSwitcher = React.memo(\n  ({ currentSelection, onChange }: FastVizSwitcherProps) => {\n    const currentViz = useSelector<ExplorePageState, string | undefined>(\n      state =>\n        state.charts &&\n        Object.values(state.charts)[0]?.latestQueryFormData?.viz_type,\n    );\n    const vizTiles = useMemo(() => {\n      const vizTiles = [...FEATURED_CHARTS];\n      if (\n        currentSelection &&\n        FEATURED_CHARTS.every(\n          featuredVizMeta => featuredVizMeta.name !== currentSelection,\n        ) &&\n        currentSelection !== currentViz\n      ) {\n        vizTiles.unshift({\n          name: currentSelection,\n          icon: (\n            <Icons.MonitorOutlined\n              iconSize=\"l\"\n              css={(theme: SupersetTheme) => css`\n                padding: ${theme.gridUnit}px;\n                & > * {\n                  line-height: 0;\n                }\n              `}\n            />\n          ),\n        });\n      }\n      if (\n        currentViz &&\n        FEATURED_CHARTS.every(\n          featuredVizMeta => featuredVizMeta.name !== currentViz,\n        )\n      ) {\n        vizTiles.unshift({\n          name: currentViz,\n          icon: <Icons.CurrentRenderedTile />,\n        });\n      }\n      return vizTiles;\n    }, [currentSelection, currentViz]);\n\n    return (\n      <div\n        css={(theme: SupersetTheme) => css`\n          display: flex;\n          justify-content: space-between;\n          column-gap: ${theme.gridUnit}px;\n        `}\n        data-test=\"fast-viz-switcher\"\n      >\n        {vizTiles.map(vizMeta => (\n          <VizTile\n            vizMeta={vizMeta}\n            isActive={currentSelection === vizMeta.name}\n            isRendered={currentViz === vizMeta.name}\n            onTileClick={onChange}\n            key={vizMeta.name}\n          />\n        ))}\n      </div>\n    );\n  },\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useState } from 'react';\nimport {\n  css,\n  t,\n  getChartMetadataRegistry,\n  styled,\n  SupersetTheme,\n} from '@superset-ui/core';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport Modal from 'src/components/Modal';\nimport { noOp } from 'src/utils/common';\nimport VizTypeGallery, {\n  MAX_ADVISABLE_VIZ_GALLERY_WIDTH,\n} from './VizTypeGallery';\nimport { FastVizSwitcher } from './FastVizSwitcher';\n\ninterface VizTypeControlProps {\n  description?: string;\n  label?: string;\n  name: string;\n  onChange: (vizType: string | null) => void;\n  value: string | null;\n  isModalOpenInit?: boolean;\n}\n\nconst metadataRegistry = getChartMetadataRegistry();\n\nexport const VIZ_TYPE_CONTROL_TEST_ID = 'viz-type-control';\n\nfunction VizSupportValidation({ vizType }: { vizType: string }) {\n  const state = usePluginContext();\n  if (state.loading || metadataRegistry.has(vizType)) {\n    return null;\n  }\n  return (\n    <div\n      className=\"text-danger\"\n      css={(theme: SupersetTheme) =>\n        css`\n          margin-top: ${theme.gridUnit}px;\n        `\n      }\n    >\n      <i className=\"fa fa-exclamation-circle text-danger\" />{' '}\n      <small>{t('This visualization type is not supported.')}</small>\n    </div>\n  );\n}\n\nconst UnpaddedModal = styled(Modal)`\n  .ant-modal-body {\n    padding: 0;\n  }\n`;\n\n/** Manages the viz type and the viz picker modal */\nconst VizTypeControl = ({\n  value: initialValue,\n  onChange = noOp,\n  isModalOpenInit,\n}: VizTypeControlProps) => {\n  const [showModal, setShowModal] = useState(!!isModalOpenInit);\n  // a trick to force re-initialization of the gallery each time the modal opens,\n  // ensuring that the modal always opens to the correct category.\n  const [modalKey, setModalKey] = useState(0);\n  const [selectedViz, setSelectedViz] = useState<string | null>(initialValue);\n\n  const openModal = useCallback(() => {\n    setShowModal(true);\n  }, []);\n\n  const onSubmit = useCallback(() => {\n    onChange(selectedViz);\n    setShowModal(false);\n  }, [selectedViz, onChange]);\n\n  const onCancel = useCallback(() => {\n    setShowModal(false);\n    setModalKey(key => key + 1);\n    // make sure the modal re-opens to the last submitted viz\n    setSelectedViz(initialValue);\n  }, [initialValue]);\n\n  return (\n    <>\n      <div\n        css={(theme: SupersetTheme) => css`\n          min-width: ${theme.gridUnit * 72}px;\n          max-width: fit-content;\n        `}\n      >\n        <FastVizSwitcher onChange={onChange} currentSelection={initialValue} />\n        {initialValue && <VizSupportValidation vizType={initialValue} />}\n      </div>\n      <div\n        css={(theme: SupersetTheme) =>\n          css`\n            display: flex;\n            justify-content: flex-end;\n            margin-top: ${theme.gridUnit * 3}px;\n            color: ${theme.colors.grayscale.base};\n            text-decoration: underline;\n          `\n        }\n      >\n        <span role=\"button\" tabIndex={0} onClick={openModal}>\n          {t('View all charts')}\n        </span>\n      </div>\n      <UnpaddedModal\n        show={showModal}\n        onHide={onCancel}\n        title={t('Select a visualization type')}\n        primaryButtonName={t('Select')}\n        disablePrimaryButton={!selectedViz}\n        onHandledPrimaryAction={onSubmit}\n        maxWidth={`${MAX_ADVISABLE_VIZ_GALLERY_WIDTH}px`}\n        responsive\n      >\n        {/* When the key increments, it forces react to re-init the gallery component */}\n        <VizTypeGallery\n          key={modalKey}\n          selectedViz={selectedViz}\n          onChange={setSelectedViz}\n        />\n      </UnpaddedModal>\n    </>\n  );\n};\n\nexport default VizTypeControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Row, Col } from 'src/components';\n\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nconst STYLE_ROW = { marginTop: '5px', minHeight: '30px' };\nconst STYLE_RALIGN = { textAlign: 'right' };\n\nconst propTypes = {\n  label: PropTypes.string.isRequired,\n  tooltip: PropTypes.string,\n  control: PropTypes.node.isRequired,\n  isCheckbox: PropTypes.bool,\n};\n\nconst defaultProps = {\n  tooltip: null,\n  isCheckbox: false,\n};\n\nexport default function FormRow({ label, tooltip, control, isCheckbox }) {\n  const labelAndTooltip = (\n    <span>\n      {label}{' '}\n      {tooltip && (\n        <InfoTooltipWithTrigger\n          placement=\"top\"\n          label={label}\n          tooltip={tooltip}\n        />\n      )}\n    </span>\n  );\n  if (isCheckbox) {\n    return (\n      <Row style={STYLE_ROW} gutter={16}>\n        <Col xs={24} md={8} style={STYLE_RALIGN}>\n          {control}\n        </Col>\n        <Col xs={24} md={16}>\n          {labelAndTooltip}\n        </Col>\n      </Row>\n    );\n  }\n  return (\n    <Row style={STYLE_ROW} gutter={16}>\n      <Col xs={24} md={8} style={STYLE_RALIGN}>\n        {labelAndTooltip}\n      </Col>\n      <Col xs={24} md={16}>\n        {control}\n      </Col>\n    </Row>\n  );\n}\nFormRow.propTypes = propTypes;\nFormRow.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { t } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nimport FormRow from 'src/components/FormRow';\nimport { Select } from 'src/components';\nimport CheckboxControl from 'src/explore/components/controls/CheckboxControl';\nimport TextControl from 'src/explore/components/controls/TextControl';\nimport { FILTER_CONFIG_ATTRIBUTES } from 'src/explore/constants';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nconst INTEGRAL_TYPES = new Set([\n  'TINYINT',\n  'SMALLINT',\n  'INT',\n  'INTEGER',\n  'BIGINT',\n  'LONG',\n]);\nconst DECIMAL_TYPES = new Set([\n  'FLOAT',\n  'DOUBLE',\n  'REAL',\n  'NUMERIC',\n  'DECIMAL',\n  'MONEY',\n]);\n\nconst propTypes = {\n  datasource: PropTypes.object.isRequired,\n  onChange: PropTypes.func,\n  asc: PropTypes.bool,\n  clearable: PropTypes.bool,\n  multiple: PropTypes.bool,\n  column: PropTypes.string,\n  label: PropTypes.string,\n  metric: PropTypes.string,\n  searchAllOptions: PropTypes.bool,\n  defaultValue: PropTypes.string,\n};\n\nconst defaultProps = {\n  onChange: () => {},\n  asc: true,\n  clearable: true,\n  multiple: true,\n  searchAllOptions: false,\n};\n\nconst STYLE_WIDTH = { width: 350 };\n\nexport default class FilterBoxItemControl extends React.Component {\n  constructor(props) {\n    super(props);\n    const {\n      column,\n      metric,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      label,\n      defaultValue,\n    } = props;\n    this.state = {\n      column,\n      metric,\n      label,\n      asc,\n      clearable,\n      multiple,\n      searchAllOptions,\n      defaultValue,\n    };\n    this.onChange = this.onChange.bind(this);\n    this.onControlChange = this.onControlChange.bind(this);\n  }\n\n  onChange() {\n    this.props.onChange(this.state);\n  }\n\n  onControlChange(attr, value) {\n    let typedValue = value;\n    const { column: selectedColumnName, multiple } = this.state;\n    if (value && !multiple && attr === FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE) {\n      // if single value filter_box,\n      // convert input value string to the column's data type\n      const { datasource } = this.props;\n      const selectedColumn = datasource.columns.find(\n        col => col.column_name === selectedColumnName,\n      );\n\n      if (selectedColumn && selectedColumn.type) {\n        const type = selectedColumn.type.toUpperCase();\n        if (type === 'BOOLEAN') {\n          typedValue = value === 'true';\n        } else if (INTEGRAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseInt(value, 10);\n        } else if (DECIMAL_TYPES.has(type)) {\n          typedValue = Number.isNaN(Number(value)) ? null : parseFloat(value);\n        }\n      }\n    }\n    this.setState({ [attr]: typedValue }, this.onChange);\n  }\n\n  setType() {}\n\n  textSummary() {\n    return this.state.column || 'N/A';\n  }\n\n  renderForm() {\n    return (\n      <div>\n        <FormRow\n          label={t('Column')}\n          control={\n            <Select\n              ariaLabel={t('Column')}\n              value={this.state.column}\n              name=\"column\"\n              options={this.props.datasource.columns\n                .filter(col => col.column_name !== this.state.column)\n                .map(col => ({\n                  value: col.column_name,\n                  label: col.column_name,\n                }))\n                .concat([\n                  { value: this.state.column, label: this.state.column },\n                ])}\n              onChange={v => this.onControlChange('column', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Label')}\n          control={\n            <TextControl\n              value={this.state.label}\n              name=\"label\"\n              onChange={v => this.onControlChange('label', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Default')}\n          tooltip={t(\n            '(optional) default value for the filter, when using ' +\n              'the multiple option, you can use a semicolon-delimited list ' +\n              'of options.',\n          )}\n          control={\n            <TextControl\n              value={this.state.defaultValue}\n              name=\"defaultValue\"\n              onChange={v =>\n                this.onControlChange(FILTER_CONFIG_ATTRIBUTES.DEFAULT_VALUE, v)\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Sort metric')}\n          tooltip={t('Metric to sort the results by')}\n          control={\n            <Select\n              ariaLabel={t('Sort metric')}\n              value={this.state.metric}\n              name=\"column\"\n              options={this.props.datasource.metrics\n                .filter(m => m.metric_name !== this.state.metric)\n                .map(m => ({\n                  value: m.metric_name,\n                  label: m.metric_name,\n                }))\n                .concat([\n                  { value: this.state.metric, label: this.state.metric },\n                ])}\n              onChange={v => this.onControlChange('metric', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Sort ascending')}\n          tooltip={t('Check for sorting ascending')}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={this.state.asc}\n              onChange={v => this.onControlChange('asc', v)}\n            />\n          }\n        />\n        <FormRow\n          label={t('Allow multiple selections')}\n          isCheckbox\n          tooltip={t(\n            'Multiple selections allowed, otherwise filter ' +\n              'is limited to a single value',\n          )}\n          control={\n            <CheckboxControl\n              value={this.state.multiple}\n              onChange={v =>\n                this.onControlChange(FILTER_CONFIG_ATTRIBUTES.MULTIPLE, v)\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Search all filter options')}\n          tooltip={t(\n            'By default, each filter loads at most 1000 choices at the initial page load. ' +\n              'Check this box if you have more than 1000 filter values and want to enable dynamically ' +\n              'searching that loads filter values as users type (may add stress to your database).',\n          )}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={this.state.searchAllOptions}\n              onChange={v =>\n                this.onControlChange(\n                  FILTER_CONFIG_ATTRIBUTES.SEARCH_ALL_OPTIONS,\n                  v,\n                )\n              }\n            />\n          }\n        />\n        <FormRow\n          label={t('Required')}\n          tooltip={t('User must select a value for this filter')}\n          isCheckbox\n          control={\n            <CheckboxControl\n              value={!this.state.clearable}\n              onChange={v => this.onControlChange('clearable', !v)}\n            />\n          }\n        />\n      </div>\n    );\n  }\n\n  renderPopover() {\n    return (\n      <div id=\"ts-col-popo\" style={STYLE_WIDTH}>\n        {this.renderForm()}\n      </div>\n    );\n  }\n\n  render() {\n    return (\n      <span data-test=\"FilterBoxItemControl\">\n        {this.textSummary()}{' '}\n        <ControlPopover\n          trigger=\"click\"\n          content={this.renderPopover()}\n          title={t('Filter configuration')}\n        >\n          <InfoTooltipWithTrigger\n            icon=\"edit\"\n            className=\"text-primary\"\n            label=\"edit-ts-column\"\n          />\n        </ControlPopover>\n      </span>\n    );\n  }\n}\n\nFilterBoxItemControl.propTypes = propTypes;\nFilterBoxItemControl.defaultProps = defaultProps;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ReactNode } from 'react';\nimport { PopoverProps } from 'antd/lib/popover';\nimport { ControlComponentProps } from '@superset-ui/chart-controls';\n\nexport enum COMPARATOR {\n  NONE = 'None',\n  GREATER_THAN = '>',\n  LESS_THAN = '<',\n  GREATER_OR_EQUAL = '≥',\n  LESS_OR_EQUAL = '≤',\n  EQUAL = '=',\n  NOT_EQUAL = '≠',\n  BETWEEN = '< x <',\n  BETWEEN_OR_EQUAL = '≤ x ≤',\n  BETWEEN_OR_LEFT_EQUAL = '≤ x <',\n  BETWEEN_OR_RIGHT_EQUAL = '< x ≤',\n}\n\nexport const MULTIPLE_VALUE_COMPARATORS = [\n  COMPARATOR.BETWEEN,\n  COMPARATOR.BETWEEN_OR_EQUAL,\n  COMPARATOR.BETWEEN_OR_LEFT_EQUAL,\n  COMPARATOR.BETWEEN_OR_RIGHT_EQUAL,\n];\n\nexport type ConditionalFormattingConfig = {\n  operator?: COMPARATOR;\n  targetValue?: number;\n  targetValueLeft?: number;\n  targetValueRight?: number;\n  column?: string;\n  colorScheme?: string;\n};\n\nexport type ConditionalFormattingControlProps = ControlComponentProps<\n  ConditionalFormattingConfig[]\n> & {\n  columnOptions: { label: string; value: string }[];\n  verboseMap: Record<string, string>;\n  label: string;\n  description: string;\n};\n\nexport type FormattingPopoverProps = PopoverProps & {\n  columns: { label: string; value: string }[];\n  onChange: (value: ConditionalFormattingConfig) => void;\n  config?: ConditionalFormattingConfig;\n  title: string;\n  children: ReactNode;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled, SupersetTheme, t, useTheme } from '@superset-ui/core';\nimport { Form, FormItem, FormProps } from 'src/components/Form';\nimport Select from 'src/components/Select/Select';\nimport { Col, Row } from 'src/components';\nimport { InputNumber } from 'src/components/Input';\nimport Button from 'src/components/Button';\nimport {\n  COMPARATOR,\n  ConditionalFormattingConfig,\n  MULTIPLE_VALUE_COMPARATORS,\n} from './types';\n\nconst FullWidthInputNumber = styled(InputNumber)`\n  width: 100%;\n`;\n\nconst JustifyEnd = styled.div`\n  display: flex;\n  justify-content: flex-end;\n`;\n\nconst colorSchemeOptions = (theme: SupersetTheme) => [\n  { value: theme.colors.success.light1, label: t('green') },\n  { value: theme.colors.alert.light1, label: t('yellow') },\n  { value: theme.colors.error.light1, label: t('red') },\n];\n\nconst operatorOptions = [\n  { value: COMPARATOR.NONE, label: 'None' },\n  { value: COMPARATOR.GREATER_THAN, label: '>' },\n  { value: COMPARATOR.LESS_THAN, label: '<' },\n  { value: COMPARATOR.GREATER_OR_EQUAL, label: '≥' },\n  { value: COMPARATOR.LESS_OR_EQUAL, label: '≤' },\n  { value: COMPARATOR.EQUAL, label: '=' },\n  { value: COMPARATOR.NOT_EQUAL, label: '≠' },\n  { value: COMPARATOR.BETWEEN, label: '< x <' },\n  { value: COMPARATOR.BETWEEN_OR_EQUAL, label: '≤ x ≤' },\n  { value: COMPARATOR.BETWEEN_OR_LEFT_EQUAL, label: '≤ x <' },\n  { value: COMPARATOR.BETWEEN_OR_RIGHT_EQUAL, label: '< x ≤' },\n];\n\nconst targetValueValidator =\n  (\n    compare: (targetValue: number, compareValue: number) => boolean,\n    rejectMessage: string,\n  ) =>\n  (targetValue: number | string) =>\n  (_: any, compareValue: number | string) => {\n    if (\n      !targetValue ||\n      !compareValue ||\n      compare(Number(targetValue), Number(compareValue))\n    ) {\n      return Promise.resolve();\n    }\n    return Promise.reject(new Error(rejectMessage));\n  };\n\nconst targetValueLeftValidator = targetValueValidator(\n  (target: number, val: number) => target > val,\n  t('This value should be smaller than the right target value'),\n);\n\nconst targetValueRightValidator = targetValueValidator(\n  (target: number, val: number) => target < val,\n  t('This value should be greater than the left target value'),\n);\n\nconst isOperatorMultiValue = (operator?: COMPARATOR) =>\n  operator && MULTIPLE_VALUE_COMPARATORS.includes(operator);\n\nconst isOperatorNone = (operator?: COMPARATOR) =>\n  !operator || operator === COMPARATOR.NONE;\n\nconst rulesRequired = [{ required: true, message: t('Required') }];\n\ntype GetFieldValue = Pick<Required<FormProps>['form'], 'getFieldValue'>;\nconst rulesTargetValueLeft = [\n  { required: true, message: t('Required') },\n  ({ getFieldValue }: GetFieldValue) => ({\n    validator: targetValueLeftValidator(getFieldValue('targetValueRight')),\n  }),\n];\n\nconst rulesTargetValueRight = [\n  { required: true, message: t('Required') },\n  ({ getFieldValue }: GetFieldValue) => ({\n    validator: targetValueRightValidator(getFieldValue('targetValueLeft')),\n  }),\n];\n\nconst targetValueLeftDeps = ['targetValueRight'];\nconst targetValueRightDeps = ['targetValueLeft'];\n\nconst shouldFormItemUpdate = (\n  prevValues: ConditionalFormattingConfig,\n  currentValues: ConditionalFormattingConfig,\n) =>\n  isOperatorNone(prevValues.operator) !==\n    isOperatorNone(currentValues.operator) ||\n  isOperatorMultiValue(prevValues.operator) !==\n    isOperatorMultiValue(currentValues.operator);\n\nconst operatorField = (\n  <FormItem\n    name=\"operator\"\n    label={t('Operator')}\n    rules={rulesRequired}\n    initialValue={operatorOptions[0].value}\n  >\n    <Select ariaLabel={t('Operator')} options={operatorOptions} />\n  </FormItem>\n);\n\nconst renderOperatorFields = ({ getFieldValue }: GetFieldValue) =>\n  isOperatorNone(getFieldValue('operator')) ? (\n    <Row gutter={12}>\n      <Col span={6}>{operatorField}</Col>\n    </Row>\n  ) : isOperatorMultiValue(getFieldValue('operator')) ? (\n    <Row gutter={12}>\n      <Col span={9}>\n        <FormItem\n          name=\"targetValueLeft\"\n          label={t('Left value')}\n          rules={rulesTargetValueLeft}\n          dependencies={targetValueLeftDeps}\n          validateTrigger=\"onBlur\"\n          trigger=\"onBlur\"\n        >\n          <FullWidthInputNumber />\n        </FormItem>\n      </Col>\n      <Col span={6}>{operatorField}</Col>\n      <Col span={9}>\n        <FormItem\n          name=\"targetValueRight\"\n          label={t('Right value')}\n          rules={rulesTargetValueRight}\n          dependencies={targetValueRightDeps}\n          validateTrigger=\"onBlur\"\n          trigger=\"onBlur\"\n        >\n          <FullWidthInputNumber />\n        </FormItem>\n      </Col>\n    </Row>\n  ) : (\n    <Row gutter={12}>\n      <Col span={6}>{operatorField}</Col>\n      <Col span={18}>\n        <FormItem\n          name=\"targetValue\"\n          label={t('Target value')}\n          rules={rulesRequired}\n        >\n          <FullWidthInputNumber />\n        </FormItem>\n      </Col>\n    </Row>\n  );\n\nexport const FormattingPopoverContent = ({\n  config,\n  onChange,\n  columns = [],\n}: {\n  config?: ConditionalFormattingConfig;\n  onChange: (config: ConditionalFormattingConfig) => void;\n  columns: { label: string; value: string }[];\n}) => {\n  const theme = useTheme();\n  const colorScheme = colorSchemeOptions(theme);\n  return (\n    <Form\n      onFinish={onChange}\n      initialValues={config}\n      requiredMark=\"optional\"\n      layout=\"vertical\"\n    >\n      <Row gutter={12}>\n        <Col span={12}>\n          <FormItem\n            name=\"column\"\n            label={t('Column')}\n            rules={rulesRequired}\n            initialValue={columns[0]?.value}\n          >\n            <Select ariaLabel={t('Select column')} options={columns} />\n          </FormItem>\n        </Col>\n        <Col span={12}>\n          <FormItem\n            name=\"colorScheme\"\n            label={t('Color scheme')}\n            rules={rulesRequired}\n            initialValue={colorScheme[0].value}\n          >\n            <Select ariaLabel={t('Color scheme')} options={colorScheme} />\n          </FormItem>\n        </Col>\n      </Row>\n      <FormItem noStyle shouldUpdate={shouldFormItemUpdate}>\n        {renderOperatorFields}\n      </FormItem>\n      <FormItem>\n        <JustifyEnd>\n          <Button htmlType=\"submit\" buttonStyle=\"primary\">\n            {t('Apply')}\n          </Button>\n        </JustifyEnd>\n      </FormItem>\n    </Form>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useState } from 'react';\nimport Popover from 'src/components/Popover';\nimport { FormattingPopoverContent } from './FormattingPopoverContent';\nimport { ConditionalFormattingConfig, FormattingPopoverProps } from './types';\n\nexport const FormattingPopover = ({\n  title,\n  columns,\n  onChange,\n  config,\n  children,\n  ...props\n}: FormattingPopoverProps) => {\n  const [visible, setVisible] = useState(false);\n\n  const handleSave = useCallback(\n    (newConfig: ConditionalFormattingConfig) => {\n      setVisible(false);\n      onChange(newConfig);\n    },\n    [onChange],\n  );\n\n  return (\n    <Popover\n      title={title}\n      content={\n        <FormattingPopoverContent\n          onChange={handleSave}\n          config={config}\n          columns={columns}\n        />\n      }\n      visible={visible}\n      onVisibleChange={setVisible}\n      trigger={['click']}\n      overlayStyle={{ width: '450px' }}\n      {...props}\n    >\n      {children}\n    </Popover>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useState } from 'react';\nimport { styled, css, t, useTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { useComponentDidUpdate } from 'src/hooks/useComponentDidUpdate';\nimport { FormattingPopover } from './FormattingPopover';\nimport {\n  COMPARATOR,\n  ConditionalFormattingConfig,\n  ConditionalFormattingControlProps,\n} from './types';\nimport {\n  AddControlLabel,\n  CaretContainer,\n  Label,\n  OptionControlContainer,\n} from '../OptionControls';\n\nconst FormattersContainer = styled.div`\n  ${({ theme }) => css`\n    padding: ${theme.gridUnit}px;\n    border: solid 1px ${theme.colors.grayscale.light2};\n    border-radius: ${theme.gridUnit}px;\n  `}\n`;\n\nexport const FormatterContainer = styled(OptionControlContainer)`\n  &,\n  & > div {\n    margin-bottom: ${({ theme }) => theme.gridUnit}px;\n    :last-child {\n      margin-bottom: 0;\n    }\n  }\n`;\n\nexport const CloseButton = styled.button`\n  ${({ theme }) => css`\n    color: ${theme.colors.grayscale.light1};\n    height: 100%;\n    width: ${theme.gridUnit * 6}px;\n    border: none;\n    border-right: solid 1px ${theme.colors.grayscale.dark2}0C;\n    padding: 0;\n    outline: none;\n    border-bottom-left-radius: 3px;\n    border-top-left-radius: 3px;\n  `}\n`;\n\nconst ConditionalFormattingControl = ({\n  value,\n  onChange,\n  columnOptions,\n  verboseMap,\n  ...props\n}: ConditionalFormattingControlProps) => {\n  const theme = useTheme();\n  const [conditionalFormattingConfigs, setConditionalFormattingConfigs] =\n    useState<ConditionalFormattingConfig[]>(value ?? []);\n\n  useEffect(() => {\n    if (onChange) {\n      onChange(conditionalFormattingConfigs);\n    }\n  }, [conditionalFormattingConfigs, onChange]);\n\n  // remove formatter when corresponding column is removed from controls\n  const removeFormattersWhenColumnsChange = useCallback(() => {\n    const newFormattingConfigs = conditionalFormattingConfigs.filter(config =>\n      columnOptions.some(option => option?.value === config?.column),\n    );\n    if (\n      newFormattingConfigs.length !== conditionalFormattingConfigs.length &&\n      onChange\n    ) {\n      setConditionalFormattingConfigs(newFormattingConfigs);\n      onChange(newFormattingConfigs);\n    }\n  }, [JSON.stringify(columnOptions)]);\n  useComponentDidUpdate(removeFormattersWhenColumnsChange);\n\n  const onDelete = (index: number) => {\n    setConditionalFormattingConfigs(prevConfigs =>\n      prevConfigs.filter((_, i) => i !== index),\n    );\n  };\n\n  const onSave = (config: ConditionalFormattingConfig) => {\n    setConditionalFormattingConfigs(prevConfigs => [...prevConfigs, config]);\n  };\n\n  const onEdit = (newConfig: ConditionalFormattingConfig, index: number) => {\n    const newConfigs = [...conditionalFormattingConfigs];\n    newConfigs.splice(index, 1, newConfig);\n    setConditionalFormattingConfigs(newConfigs);\n  };\n\n  const createLabel = ({\n    column,\n    operator,\n    targetValue,\n    targetValueLeft,\n    targetValueRight,\n  }: ConditionalFormattingConfig) => {\n    const columnName = (column && verboseMap?.[column]) ?? column;\n    switch (operator) {\n      case COMPARATOR.NONE:\n        return `${columnName}`;\n      case COMPARATOR.BETWEEN:\n        return `${targetValueLeft} ${COMPARATOR.LESS_THAN} ${columnName} ${COMPARATOR.LESS_THAN} ${targetValueRight}`;\n      case COMPARATOR.BETWEEN_OR_EQUAL:\n        return `${targetValueLeft} ${COMPARATOR.LESS_OR_EQUAL} ${columnName} ${COMPARATOR.LESS_OR_EQUAL} ${targetValueRight}`;\n      case COMPARATOR.BETWEEN_OR_LEFT_EQUAL:\n        return `${targetValueLeft} ${COMPARATOR.LESS_OR_EQUAL} ${columnName} ${COMPARATOR.LESS_THAN} ${targetValueRight}`;\n      case COMPARATOR.BETWEEN_OR_RIGHT_EQUAL:\n        return `${targetValueLeft} ${COMPARATOR.LESS_THAN} ${columnName} ${COMPARATOR.LESS_OR_EQUAL} ${targetValueRight}`;\n      default:\n        return `${columnName} ${operator} ${targetValue}`;\n    }\n  };\n\n  return (\n    <div>\n      <ControlHeader {...props} />\n      <FormattersContainer>\n        {conditionalFormattingConfigs.map((config, index) => (\n          <FormatterContainer key={index}>\n            <CloseButton onClick={() => onDelete(index)}>\n              <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n            </CloseButton>\n            <FormattingPopover\n              title={t('Edit formatter')}\n              config={config}\n              columns={columnOptions}\n              onChange={(newConfig: ConditionalFormattingConfig) =>\n                onEdit(newConfig, index)\n              }\n              destroyTooltipOnHide\n            >\n              <OptionControlContainer withCaret>\n                <Label>{createLabel(config)}</Label>\n                <CaretContainer>\n                  <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n                </CaretContainer>\n              </OptionControlContainer>\n            </FormattingPopover>\n          </FormatterContainer>\n        ))}\n        <FormattingPopover\n          title={t('Add new formatter')}\n          columns={columnOptions}\n          onChange={onSave}\n          destroyTooltipOnHide\n        >\n          <AddControlLabel>\n            <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n            {t('Add new color formatter')}\n          </AddControlLabel>\n        </FormattingPopover>\n      </FormattersContainer>\n    </div>\n  );\n};\n\nexport default ConditionalFormattingControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport ConditionalFormattingControl from './ConditionalFormattingControl';\n\nexport * from './types';\nexport default ConditionalFormattingControl;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode, useMemo } from 'react';\nimport { useDrop } from 'react-dnd';\nimport { t, useTheme } from '@superset-ui/core';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport {\n  AddControlLabel,\n  DndLabelsContainer,\n  HeaderContainer,\n} from 'src/explore/components/controls/OptionControls';\nimport {\n  DatasourcePanelDndItem,\n  DndItemValue,\n} from 'src/explore/components/DatasourcePanel/types';\nimport Icons from 'src/components/Icons';\nimport { DndItemType } from '../../DndItemType';\n\nexport type DndSelectLabelProps = {\n  name: string;\n  accept: DndItemType | DndItemType[];\n  ghostButtonText?: string;\n  onDrop: (item: DatasourcePanelDndItem) => void;\n  canDrop: (item: DatasourcePanelDndItem) => boolean;\n  canDropValue?: (value: DndItemValue) => boolean;\n  onDropValue?: (value: DndItemValue) => void;\n  valuesRenderer: () => ReactNode;\n  displayGhostButton?: boolean;\n  onClickGhostButton?: () => void;\n};\n\nexport default function DndSelectLabel({\n  displayGhostButton = true,\n  accept,\n  valuesRenderer,\n  ...props\n}: DndSelectLabelProps) {\n  const theme = useTheme();\n\n  const [{ isOver, canDrop }, datasourcePanelDrop] = useDrop({\n    accept,\n\n    drop: (item: DatasourcePanelDndItem) => {\n      props.onDrop(item);\n      props.onDropValue?.(item.value);\n    },\n\n    canDrop: (item: DatasourcePanelDndItem) =>\n      props.canDrop(item) && (props.canDropValue?.(item.value) ?? true),\n\n    collect: monitor => ({\n      isOver: monitor.isOver(),\n      canDrop: monitor.canDrop(),\n      type: monitor.getItemType(),\n    }),\n  });\n\n  const values = useMemo(() => valuesRenderer(), [valuesRenderer]);\n\n  function renderGhostButton() {\n    return (\n      <AddControlLabel\n        cancelHover={!props.onClickGhostButton}\n        onClick={props.onClickGhostButton}\n      >\n        <Icons.PlusSmall iconColor={theme.colors.grayscale.light1} />\n        {t(props.ghostButtonText || 'Drop columns here')}\n      </AddControlLabel>\n    );\n  }\n\n  return (\n    <div ref={datasourcePanelDrop}>\n      <HeaderContainer>\n        <ControlHeader {...props} />\n      </HeaderContainer>\n      <DndLabelsContainer\n        data-test=\"dnd-labels-container\"\n        canDrop={canDrop}\n        isOver={isOver}\n      >\n        {values}\n        {displayGhostButton && renderGhostButton()}\n      </DndLabelsContainer>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\nimport { styled, t, useTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport {\n  CaretContainer,\n  CloseContainer,\n  OptionControlContainer,\n  Label,\n} from 'src/explore/components/controls/OptionControls';\nimport { OptionProps } from 'src/explore/components/controls/DndColumnSelectControl/types';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\n\nconst StyledInfoTooltipWithTrigger = styled(InfoTooltipWithTrigger)`\n  margin: 0 ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport default function Option({\n  children,\n  index,\n  clickClose,\n  withCaret,\n  isExtra,\n  canDelete = true,\n}: OptionProps) {\n  const theme = useTheme();\n  const onClickClose = useCallback(\n    e => {\n      e.stopPropagation();\n      clickClose(index);\n    },\n    [clickClose, index],\n  );\n  return (\n    <OptionControlContainer data-test=\"option-label\" withCaret={withCaret}>\n      {canDelete && (\n        <CloseContainer\n          role=\"button\"\n          data-test=\"remove-control-button\"\n          onClick={onClickClose}\n        >\n          <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n        </CloseContainer>\n      )}\n      <Label data-test=\"control-label\">{children}</Label>\n      {isExtra && (\n        <StyledInfoTooltipWithTrigger\n          icon=\"exclamation-triangle\"\n          placement=\"top\"\n          bsStyle=\"warning\"\n          tooltip={t(`\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              `)}\n        />\n      )}\n      {withCaret && (\n        <CaretContainer>\n          <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n        </CaretContainer>\n      )}\n    </OptionControlContainer>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useRef } from 'react';\nimport {\n  useDrag,\n  useDrop,\n  DropTargetMonitor,\n  DragSourceMonitor,\n} from 'react-dnd';\nimport { DragContainer } from 'src/explore/components/controls/OptionControls';\nimport {\n  OptionProps,\n  OptionItemInterface,\n} from 'src/explore/components/controls/DndColumnSelectControl/types';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { StyledColumnOption } from 'src/explore/components/optionRenderers';\nimport { styled } from '@superset-ui/core';\nimport { ColumnMeta, isAdhocColumn } from '@superset-ui/chart-controls';\nimport Option from './Option';\n\nexport const OptionLabel = styled.div`\n  width: 100%;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n`;\n\nexport default function OptionWrapper(\n  props: OptionProps & {\n    type: string;\n    onShiftOptions: (dragIndex: number, hoverIndex: number) => void;\n  },\n) {\n  const {\n    index,\n    label,\n    tooltipTitle,\n    column,\n    type,\n    onShiftOptions,\n    clickClose,\n    withCaret,\n    isExtra,\n    canDelete = true,\n    ...rest\n  } = props;\n  const ref = useRef<HTMLDivElement>(null);\n  const labelRef = useRef<HTMLDivElement>(null);\n\n  const [{ isDragging }, drag] = useDrag({\n    item: {\n      type,\n      dragIndex: index,\n    },\n    collect: (monitor: DragSourceMonitor) => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const [, drop] = useDrop({\n    accept: type,\n\n    hover: (item: OptionItemInterface, monitor: DropTargetMonitor) => {\n      if (!ref.current) {\n        return;\n      }\n      const { dragIndex } = item;\n      const hoverIndex = index;\n\n      // Don't replace items with themselves\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      // Determine rectangle on screen\n      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n      // Get vertical middle\n      const hoverMiddleY =\n        (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      // Determine mouse position\n      const clientOffset = monitor.getClientOffset();\n      // Get pixels to the top\n      const hoverClientY = clientOffset\n        ? clientOffset.y - hoverBoundingRect.top\n        : 0;\n      // Only perform the move when the mouse has crossed half of the items height\n      // When dragging downwards, only move when the cursor is below 50%\n      // When dragging upwards, only move when the cursor is above 50%\n      // Dragging downwards\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n      // Dragging upwards\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n\n      // Time to actually perform the action\n      onShiftOptions(dragIndex, hoverIndex);\n      // eslint-disable-next-line no-param-reassign\n      item.dragIndex = hoverIndex;\n    },\n  });\n\n  const shouldShowTooltip =\n    (!isDragging && tooltipTitle && label && tooltipTitle !== label) ||\n    (!isDragging &&\n      labelRef &&\n      labelRef.current &&\n      labelRef.current.scrollWidth > labelRef.current.clientWidth);\n\n  const LabelContent = () => {\n    if (!shouldShowTooltip) {\n      return <span>{label}</span>;\n    }\n    return (\n      <Tooltip title={tooltipTitle || label}>\n        <span>{label}</span>\n      </Tooltip>\n    );\n  };\n\n  const ColumnOption = () => {\n    const transformedCol =\n      column && isAdhocColumn(column)\n        ? { verbose_name: column.label, expression: column.sqlExpression }\n        : column;\n    return (\n      <StyledColumnOption\n        column={transformedCol as ColumnMeta}\n        labelRef={labelRef}\n        showType\n      />\n    );\n  };\n\n  const Label = () => {\n    if (label) {\n      return (\n        <OptionLabel ref={labelRef}>\n          <LabelContent />\n        </OptionLabel>\n      );\n    }\n    if (column) {\n      return (\n        <OptionLabel>\n          <ColumnOption />\n        </OptionLabel>\n      );\n    }\n    return null;\n  };\n\n  drag(drop(ref));\n\n  return (\n    <DragContainer ref={ref} {...rest}>\n      <Option\n        index={index}\n        clickClose={clickClose}\n        withCaret={withCaret}\n        isExtra={isExtra}\n        canDelete={canDelete}\n      >\n        <Label />\n      </Option>\n    </DragContainer>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ColumnMeta, isColumnMeta } from '@superset-ui/chart-controls';\nimport {\n  AdhocColumn,\n  ensureIsArray,\n  QueryFormColumn,\n  isPhysicalColumn,\n} from '@superset-ui/core';\n\nconst getColumnNameOrAdhocColumn = (\n  column: ColumnMeta | AdhocColumn,\n): QueryFormColumn => {\n  if (isColumnMeta(column)) {\n    return column.column_name;\n  }\n  return column as AdhocColumn;\n};\n\nexport class OptionSelector {\n  values: (ColumnMeta | AdhocColumn)[];\n\n  options: Record<string, ColumnMeta>;\n\n  multi: boolean;\n\n  constructor(\n    options: Record<string, ColumnMeta>,\n    multi: boolean,\n    initialValues?: QueryFormColumn[] | QueryFormColumn | null,\n  ) {\n    this.options = options;\n    this.multi = multi;\n    this.values = ensureIsArray(initialValues)\n      .map(value => {\n        if (value && isPhysicalColumn(value) && value in options) {\n          return options[value];\n        }\n        if (!isPhysicalColumn(value)) {\n          return value;\n        }\n        return null;\n      })\n      .filter(Boolean) as ColumnMeta[];\n  }\n\n  add(value: QueryFormColumn) {\n    if (isPhysicalColumn(value) && value in this.options) {\n      this.values.push(this.options[value]);\n    } else if (!isPhysicalColumn(value)) {\n      this.values.push(value as AdhocColumn);\n    }\n  }\n\n  del(idx: number) {\n    this.values.splice(idx, 1);\n  }\n\n  replace(idx: number, value: QueryFormColumn) {\n    if (this.values[idx]) {\n      this.values[idx] = isPhysicalColumn(value) ? this.options[value] : value;\n    }\n  }\n\n  swap(a: number, b: number) {\n    [this.values[a], this.values[b]] = [this.values[b], this.values[a]];\n  }\n\n  has(value: QueryFormColumn): boolean {\n    return this.values.some(col => {\n      if (isPhysicalColumn(value)) {\n        return (\n          (col as ColumnMeta).column_name === value ||\n          (col as AdhocColumn).label === value\n        );\n      }\n      return (\n        (col as ColumnMeta).column_name === value.label ||\n        (col as AdhocColumn).label === value.label\n      );\n    });\n  }\n\n  getValues(): QueryFormColumn[] | QueryFormColumn | undefined {\n    if (!this.multi) {\n      return this.values.length > 0\n        ? getColumnNameOrAdhocColumn(this.values[0])\n        : undefined;\n    }\n    return this.values.map(getColumnNameOrAdhocColumn);\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable camelcase */\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport { AdhocColumn, t, styled, css } from '@superset-ui/core';\nimport {\n  ColumnMeta,\n  isAdhocColumn,\n  isSavedExpression,\n} from '@superset-ui/chart-controls';\nimport Tabs from 'src/components/Tabs';\nimport Button from 'src/components/Button';\nimport { Select } from 'src/components';\n\nimport { Form, FormItem } from 'src/components/Form';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport { EmptyStateSmall } from 'src/components/EmptyState';\nimport { StyledColumnOption } from 'src/explore/components/optionRenderers';\nimport {\n  POPOVER_INITIAL_HEIGHT,\n  UNRESIZABLE_POPOVER_WIDTH,\n} from 'src/explore/constants';\n\nconst StyledSelect = styled(Select)`\n  .metric-option {\n    & > svg {\n      min-width: ${({ theme }) => `${theme.gridUnit * 4}px`};\n    }\n    & > .option-label {\n      overflow: hidden;\n      text-overflow: ellipsis;\n    }\n  }\n`;\n\ninterface ColumnSelectPopoverProps {\n  columns: ColumnMeta[];\n  editedColumn?: ColumnMeta | AdhocColumn;\n  onChange: (column: ColumnMeta | AdhocColumn) => void;\n  onClose: () => void;\n  setLabel: (title: string) => void;\n  getCurrentTab: (tab: string) => void;\n  label: string;\n  isTemporal?: boolean;\n}\n\nconst getInitialColumnValues = (\n  editedColumn?: ColumnMeta | AdhocColumn,\n): [AdhocColumn?, ColumnMeta?, ColumnMeta?] => {\n  if (!editedColumn) {\n    return [undefined, undefined, undefined];\n  }\n  if (isAdhocColumn(editedColumn)) {\n    return [editedColumn, undefined, undefined];\n  }\n  if (isSavedExpression(editedColumn)) {\n    return [undefined, editedColumn, undefined];\n  }\n  return [undefined, undefined, editedColumn];\n};\n\nconst ColumnSelectPopover = ({\n  columns,\n  editedColumn,\n  onChange,\n  onClose,\n  setLabel,\n  getCurrentTab,\n  label,\n  isTemporal,\n}: ColumnSelectPopoverProps) => {\n  const [initialLabel] = useState(label);\n  const [initialAdhocColumn, initialCalculatedColumn, initialSimpleColumn] =\n    getInitialColumnValues(editedColumn);\n\n  const [adhocColumn, setAdhocColumn] = useState<AdhocColumn | undefined>(\n    initialAdhocColumn,\n  );\n  const [selectedCalculatedColumn, setSelectedCalculatedColumn] = useState<\n    ColumnMeta | undefined\n  >(initialCalculatedColumn);\n  const [selectedSimpleColumn, setSelectedSimpleColumn] = useState<\n    ColumnMeta | undefined\n  >(initialSimpleColumn);\n\n  const sqlEditorRef = useRef(null);\n\n  const [calculatedColumns, simpleColumns] = useMemo(\n    () =>\n      columns?.reduce(\n        (acc: [ColumnMeta[], ColumnMeta[]], column: ColumnMeta) => {\n          if (column.expression) {\n            acc[0].push(column);\n          } else {\n            acc[1].push(column);\n          }\n          return acc;\n        },\n        [[], []],\n      ),\n    [columns],\n  );\n\n  const onSqlExpressionChange = useCallback(\n    sqlExpression => {\n      setAdhocColumn({ label, sqlExpression } as AdhocColumn);\n      setSelectedSimpleColumn(undefined);\n      setSelectedCalculatedColumn(undefined);\n    },\n    [label],\n  );\n\n  const onCalculatedColumnChange = useCallback(\n    selectedColumnName => {\n      const selectedColumn = calculatedColumns.find(\n        col => col.column_name === selectedColumnName,\n      );\n      setSelectedCalculatedColumn(selectedColumn);\n      setSelectedSimpleColumn(undefined);\n      setAdhocColumn(undefined);\n      setLabel(\n        selectedColumn?.verbose_name || selectedColumn?.column_name || '',\n      );\n    },\n    [calculatedColumns, setLabel],\n  );\n\n  const onSimpleColumnChange = useCallback(\n    selectedColumnName => {\n      const selectedColumn = simpleColumns.find(\n        col => col.column_name === selectedColumnName,\n      );\n      setSelectedCalculatedColumn(undefined);\n      setSelectedSimpleColumn(selectedColumn);\n      setAdhocColumn(undefined);\n      setLabel(\n        selectedColumn?.verbose_name || selectedColumn?.column_name || '',\n      );\n    },\n    [setLabel, simpleColumns],\n  );\n\n  const defaultActiveTabKey = initialAdhocColumn\n    ? 'sqlExpression'\n    : initialSimpleColumn || calculatedColumns.length === 0\n    ? 'simple'\n    : 'saved';\n\n  useEffect(() => {\n    getCurrentTab(defaultActiveTabKey);\n  }, [defaultActiveTabKey, getCurrentTab]);\n\n  const onSave = useCallback(() => {\n    if (adhocColumn && adhocColumn.label !== label) {\n      adhocColumn.label = label;\n    }\n    const selectedColumn =\n      adhocColumn || selectedCalculatedColumn || selectedSimpleColumn;\n    if (!selectedColumn) {\n      return;\n    }\n    onChange(selectedColumn);\n    onClose();\n  }, [\n    adhocColumn,\n    label,\n    onChange,\n    onClose,\n    selectedCalculatedColumn,\n    selectedSimpleColumn,\n  ]);\n\n  const onResetStateAndClose = useCallback(() => {\n    setSelectedCalculatedColumn(initialCalculatedColumn);\n    setSelectedSimpleColumn(initialSimpleColumn);\n    setAdhocColumn(initialAdhocColumn);\n    onClose();\n  }, [\n    initialAdhocColumn,\n    initialCalculatedColumn,\n    initialSimpleColumn,\n    onClose,\n  ]);\n\n  const onTabChange = useCallback(\n    tab => {\n      getCurrentTab(tab);\n      // @ts-ignore\n      sqlEditorRef.current?.editor.focus();\n    },\n    [getCurrentTab],\n  );\n\n  const onSqlEditorFocus = useCallback(() => {\n    // @ts-ignore\n    sqlEditorRef.current?.editor.resize();\n  }, []);\n\n  const stateIsValid =\n    adhocColumn || selectedCalculatedColumn || selectedSimpleColumn;\n  const hasUnsavedChanges =\n    initialLabel !== label ||\n    selectedCalculatedColumn?.column_name !==\n      initialCalculatedColumn?.column_name ||\n    selectedSimpleColumn?.column_name !== initialSimpleColumn?.column_name ||\n    adhocColumn?.sqlExpression !== initialAdhocColumn?.sqlExpression;\n\n  const savedExpressionsLabel = t('Saved expressions');\n  const simpleColumnsLabel = t('Column');\n\n  return (\n    <Form layout=\"vertical\" id=\"metrics-edit-popover\">\n      <Tabs\n        id=\"adhoc-metric-edit-tabs\"\n        defaultActiveKey={defaultActiveTabKey}\n        onChange={onTabChange}\n        className=\"adhoc-metric-edit-tabs\"\n        allowOverflow\n        css={css`\n          height: ${POPOVER_INITIAL_HEIGHT}px;\n          width: ${UNRESIZABLE_POPOVER_WIDTH}px;\n        `}\n      >\n        <Tabs.TabPane key=\"saved\" tab={t('Saved')}>\n          {calculatedColumns.length > 0 ? (\n            <FormItem label={savedExpressionsLabel}>\n              <StyledSelect\n                ariaLabel={savedExpressionsLabel}\n                value={selectedCalculatedColumn?.column_name}\n                onChange={onCalculatedColumnChange}\n                allowClear\n                autoFocus={!selectedCalculatedColumn}\n                placeholder={t('%s column(s)', calculatedColumns.length)}\n                options={calculatedColumns.map(calculatedColumn => ({\n                  value: calculatedColumn.column_name,\n                  label:\n                    calculatedColumn.verbose_name ||\n                    calculatedColumn.column_name,\n                  customLabel: (\n                    <StyledColumnOption column={calculatedColumn} showType />\n                  ),\n                  key: calculatedColumn.column_name,\n                }))}\n              />\n            </FormItem>\n          ) : (\n            <EmptyStateSmall\n              image=\"empty.svg\"\n              title={\n                isTemporal\n                  ? t('No temporal columns found')\n                  : t('No saved expressions found')\n              }\n              description={\n                isTemporal\n                  ? t(\n                      'Add calculated temporal columns to dataset in \"Edit datasource\" modal',\n                    )\n                  : t(\n                      'Add calculated columns to dataset in \"Edit datasource\" modal',\n                    )\n              }\n            />\n          )}\n        </Tabs.TabPane>\n        <Tabs.TabPane key=\"simple\" tab={t('Simple')}>\n          {isTemporal && simpleColumns.length === 0 ? (\n            <EmptyStateSmall\n              image=\"empty.svg\"\n              title={t('No temporal columns found')}\n              description={t(\n                'Mark a column as temporal in \"Edit datasource\" modal',\n              )}\n            />\n          ) : (\n            <FormItem label={simpleColumnsLabel}>\n              <Select\n                ariaLabel={simpleColumnsLabel}\n                value={selectedSimpleColumn?.column_name}\n                onChange={onSimpleColumnChange}\n                allowClear\n                autoFocus={!selectedSimpleColumn}\n                placeholder={t('%s column(s)', simpleColumns.length)}\n                options={simpleColumns.map(simpleColumn => ({\n                  value: simpleColumn.column_name,\n                  label: simpleColumn.verbose_name || simpleColumn.column_name,\n                  customLabel: (\n                    <StyledColumnOption column={simpleColumn} showType />\n                  ),\n                  key: simpleColumn.column_name,\n                }))}\n              />\n            </FormItem>\n          )}\n        </Tabs.TabPane>\n\n        <Tabs.TabPane key=\"sqlExpression\" tab={t('Custom SQL')}>\n          <SQLEditor\n            value={\n              adhocColumn?.sqlExpression ||\n              selectedSimpleColumn?.column_name ||\n              selectedCalculatedColumn?.expression\n            }\n            onFocus={onSqlEditorFocus}\n            showLoadingForImport\n            onChange={onSqlExpressionChange}\n            width=\"100%\"\n            height={`${POPOVER_INITIAL_HEIGHT - 80}px`}\n            showGutter={false}\n            editorProps={{ $blockScrolling: true }}\n            enableLiveAutocompletion\n            className=\"filter-sql-editor\"\n            wrapEnabled\n            ref={sqlEditorRef}\n          />\n        </Tabs.TabPane>\n      </Tabs>\n      <div>\n        <Button buttonSize=\"small\" onClick={onResetStateAndClose} cta>\n          {t('Close')}\n        </Button>\n        <Button\n          disabled={!stateIsValid}\n          buttonStyle={\n            hasUnsavedChanges && stateIsValid ? 'primary' : 'default'\n          }\n          buttonSize=\"small\"\n          onClick={onSave}\n          data-test=\"ColumnEdit#save\"\n          cta\n        >\n          {t('Save')}\n        </Button>\n      </div>\n    </Form>\n  );\n};\n\nexport default ColumnSelectPopover;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useState } from 'react';\nimport { t, styled } from '@superset-ui/core';\nimport { Input } from 'src/components/Input';\nimport { Tooltip } from 'src/components/Tooltip';\n\nconst StyledInput = styled(Input)`\n  border-radius: ${({ theme }) => theme.borderRadius};\n  height: 26px;\n  padding-left: ${({ theme }) => theme.gridUnit * 2.5}px;\n`;\n\nexport const DndColumnSelectPopoverTitle = ({\n  title,\n  onChange,\n  isEditDisabled,\n  hasCustomLabel,\n}) => {\n  const [isHovered, setIsHovered] = useState(false);\n  const [isEditMode, setIsEditMode] = useState(false);\n\n  const onMouseOver = useCallback(() => {\n    setIsHovered(true);\n  }, []);\n\n  const onMouseOut = useCallback(() => {\n    setIsHovered(false);\n  }, []);\n\n  const onClick = useCallback(() => {\n    setIsEditMode(true);\n  }, []);\n\n  const onBlur = useCallback(() => {\n    setIsEditMode(false);\n  }, []);\n\n  const onInputBlur = useCallback(\n    e => {\n      if (e.target.value === '') {\n        onChange(e);\n      }\n      onBlur();\n    },\n    [onBlur, onChange],\n  );\n\n  const defaultLabel = t('My column');\n\n  if (isEditDisabled) {\n    return <span>{title || defaultLabel}</span>;\n  }\n\n  return isEditMode ? (\n    <StyledInput\n      type=\"text\"\n      placeholder={title}\n      value={hasCustomLabel ? title : ''}\n      autoFocus\n      onChange={onChange}\n      onBlur={onInputBlur}\n    />\n  ) : (\n    <Tooltip placement=\"top\" title={t('Click to edit label')}>\n      <span\n        className=\"AdhocMetricEditPopoverTitle inline-editable\"\n        data-test=\"AdhocMetricEditTitle#trigger\"\n        onMouseOver={onMouseOver}\n        onMouseOut={onMouseOut}\n        onClick={onClick}\n        onBlur={onBlur}\n        role=\"button\"\n        tabIndex={0}\n      >\n        {title || defaultLabel}\n        &nbsp;\n        <i\n          className=\"fa fa-pencil\"\n          style={{ color: isHovered ? 'black' : 'grey' }}\n        />\n      </span>\n    </Tooltip>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { AdhocColumn, t } from '@superset-ui/core';\nimport {\n  ColumnMeta,\n  isAdhocColumn,\n  isColumnMeta,\n} from '@superset-ui/chart-controls';\nimport { ExplorePopoverContent } from 'src/explore/components/ExploreContentPopover';\nimport ColumnSelectPopover from './ColumnSelectPopover';\nimport { DndColumnSelectPopoverTitle } from './DndColumnSelectPopoverTitle';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\ninterface ColumnSelectPopoverTriggerProps {\n  columns: ColumnMeta[];\n  editedColumn?: ColumnMeta | AdhocColumn;\n  onColumnEdit: (editedColumn: ColumnMeta | AdhocColumn) => void;\n  isControlledComponent?: boolean;\n  visible?: boolean;\n  togglePopover?: (visible: boolean) => void;\n  closePopover?: () => void;\n  children: React.ReactNode;\n  isTemporal?: boolean;\n}\n\nconst defaultPopoverLabel = t('My column');\nconst editableTitleTab = 'sqlExpression';\n\nconst ColumnSelectPopoverTrigger = ({\n  columns,\n  editedColumn,\n  onColumnEdit,\n  isControlledComponent,\n  children,\n  isTemporal,\n  ...props\n}: ColumnSelectPopoverTriggerProps) => {\n  const [popoverLabel, setPopoverLabel] = useState(defaultPopoverLabel);\n  const [popoverVisible, setPopoverVisible] = useState(false);\n  const [isTitleEditDisabled, setIsTitleEditDisabled] = useState(true);\n  const [hasCustomLabel, setHasCustomLabel] = useState(false);\n\n  let initialPopoverLabel = defaultPopoverLabel;\n  if (editedColumn && isColumnMeta(editedColumn)) {\n    initialPopoverLabel = editedColumn.verbose_name || editedColumn.column_name;\n  } else if (editedColumn && isAdhocColumn(editedColumn)) {\n    initialPopoverLabel = editedColumn.label || defaultPopoverLabel;\n  }\n\n  useEffect(() => {\n    setPopoverLabel(initialPopoverLabel);\n  }, [initialPopoverLabel, popoverVisible]);\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    setPopoverVisible(false);\n  }, []);\n\n  const { visible, handleTogglePopover, handleClosePopover } =\n    isControlledComponent\n      ? {\n          visible: props.visible,\n          handleTogglePopover: props.togglePopover!,\n          handleClosePopover: props.closePopover!,\n        }\n      : {\n          visible: popoverVisible,\n          handleTogglePopover: togglePopover,\n          handleClosePopover: closePopover,\n        };\n\n  const getCurrentTab = useCallback((tab: string) => {\n    setIsTitleEditDisabled(tab !== editableTitleTab);\n  }, []);\n\n  const overlayContent = useMemo(\n    () => (\n      <ExplorePopoverContent>\n        <ColumnSelectPopover\n          editedColumn={editedColumn}\n          columns={columns}\n          onClose={handleClosePopover}\n          onChange={onColumnEdit}\n          label={popoverLabel}\n          setLabel={setPopoverLabel}\n          getCurrentTab={getCurrentTab}\n          isTemporal={isTemporal}\n        />\n      </ExplorePopoverContent>\n    ),\n    [\n      columns,\n      editedColumn,\n      getCurrentTab,\n      handleClosePopover,\n      isTemporal,\n      onColumnEdit,\n      popoverLabel,\n    ],\n  );\n\n  const onLabelChange = useCallback((e: any) => {\n    setPopoverLabel(e.target.value);\n    setHasCustomLabel(true);\n  }, []);\n\n  const popoverTitle = useMemo(\n    () => (\n      <DndColumnSelectPopoverTitle\n        title={popoverLabel}\n        onChange={onLabelChange}\n        isEditDisabled={isTitleEditDisabled}\n        hasCustomLabel={hasCustomLabel}\n      />\n    ),\n    [hasCustomLabel, isTitleEditDisabled, onLabelChange, popoverLabel],\n  );\n\n  return (\n    <ControlPopover\n      trigger=\"click\"\n      content={overlayContent}\n      defaultVisible={visible}\n      visible={visible}\n      onVisibleChange={handleTogglePopover}\n      title={popoverTitle}\n      destroyTooltipOnHide\n    >\n      {children}\n    </ControlPopover>\n  );\n};\n\nexport default ColumnSelectPopoverTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with work for additional information\n * regarding copyright ownership.  The ASF licenses file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport {\n  FeatureFlag,\n  isFeatureEnabled,\n  logging,\n  Metric,\n  QueryFormData,\n  QueryFormMetric,\n  SupersetClient,\n  t,\n} from '@superset-ui/core';\nimport { ColumnMeta } from '@superset-ui/chart-controls';\nimport {\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n  Operators,\n} from 'src/explore/constants';\nimport { Datasource, OptionSortType } from 'src/explore/types';\nimport { OptionValueType } from 'src/explore/components/controls/DndColumnSelectControl/types';\nimport AdhocFilterPopoverTrigger from 'src/explore/components/controls/FilterControl/AdhocFilterPopoverTrigger';\nimport OptionWrapper from 'src/explore/components/controls/DndColumnSelectControl/OptionWrapper';\nimport DndSelectLabel from 'src/explore/components/controls/DndColumnSelectControl/DndSelectLabel';\nimport AdhocFilter, {\n  CLAUSES,\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport {\n  DatasourcePanelDndItem,\n  DndItemValue,\n  isSavedMetric,\n} from 'src/explore/components/DatasourcePanel/types';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport { ControlComponentProps } from 'src/explore/components/Control';\n\nconst EMPTY_OBJECT = {};\nconst DND_ACCEPTED_TYPES = [\n  DndItemType.Column,\n  DndItemType.Metric,\n  DndItemType.MetricOption,\n  DndItemType.AdhocMetricOption,\n];\n\nconst isDictionaryForAdhocFilter = (value: OptionValueType) =>\n  !(value instanceof AdhocFilter) && value?.expressionType;\n\nexport interface DndFilterSelectProps\n  extends ControlComponentProps<OptionValueType[]> {\n  columns: ColumnMeta[];\n  savedMetrics: Metric[];\n  selectedMetrics: QueryFormMetric[];\n  datasource: Datasource;\n}\n\nexport const DndFilterSelect = (props: DndFilterSelectProps) => {\n  const { datasource, onChange = () => {}, name: controlName } = props;\n\n  const propsValues = Array.from(props.value ?? []);\n  const [values, setValues] = useState(\n    propsValues.map((filter: OptionValueType) =>\n      isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n    ),\n  );\n  const [partitionColumn, setPartitionColumn] = useState(undefined);\n  const [newFilterPopoverVisible, setNewFilterPopoverVisible] = useState(false);\n  const [droppedItem, setDroppedItem] = useState<\n    DndItemValue | typeof EMPTY_OBJECT\n  >({});\n\n  const optionsForSelect = (\n    columns: ColumnMeta[],\n    formData: QueryFormData | null | undefined,\n  ) => {\n    const options: OptionSortType[] = [\n      ...columns,\n      ...[...(formData?.metrics || []), formData?.metric].map(\n        metric =>\n          metric &&\n          (typeof metric === 'string'\n            ? { saved_metric_name: metric }\n            : new AdhocMetric(metric)),\n      ),\n    ].filter(option => option);\n\n    return options\n      .reduce(\n        (\n          results: (OptionSortType & { filterOptionName: string })[],\n          option,\n        ) => {\n          if ('saved_metric_name' in option && option.saved_metric_name) {\n            results.push({\n              ...option,\n              filterOptionName: option.saved_metric_name,\n            });\n          } else if ('column_name' in option && option.column_name) {\n            results.push({\n              ...option,\n              filterOptionName: `_col_${option.column_name}`,\n            });\n          } else if (option instanceof AdhocMetric) {\n            results.push({\n              ...option,\n              filterOptionName: `_adhocmetric_${option.label}`,\n            });\n          }\n          return results;\n        },\n        [],\n      )\n      .sort(\n        (a: OptionSortType, b: OptionSortType) =>\n          (a.saved_metric_name || a.column_name || a.label)?.localeCompare(\n            b.saved_metric_name || b.column_name || b.label || '',\n          ) ?? 0,\n      );\n  };\n  const [options, setOptions] = useState(\n    optionsForSelect(props.columns, props.formData),\n  );\n\n  useEffect(() => {\n    if (datasource && datasource.type === 'table') {\n      const dbId = datasource.database?.id;\n      const {\n        datasource_name: name,\n        schema,\n        is_sqllab_view: isSqllabView,\n      } = datasource;\n\n      if (!isSqllabView && dbId && name && schema) {\n        SupersetClient.get({\n          endpoint: `/api/v1/database/${dbId}/table_extra/${name}/${schema}/`,\n        })\n          .then(({ json }: { json: Record<string, any> }) => {\n            if (json && json.partitions) {\n              const { partitions } = json;\n              // for now only show latest_partition option\n              // when table datasource has only 1 partition key.\n              if (\n                partitions &&\n                partitions.cols &&\n                Object.keys(partitions.cols).length === 1\n              ) {\n                setPartitionColumn(partitions.cols[0]);\n              }\n            }\n          })\n          .catch((error: Record<string, any>) => {\n            logging.error('fetch extra_table_metadata:', error.statusText);\n          });\n      }\n    }\n  }, [datasource]);\n\n  useEffect(() => {\n    setOptions(optionsForSelect(props.columns, props.formData));\n  }, [props.columns, props.formData]);\n\n  useEffect(() => {\n    setValues(\n      (props.value || []).map((filter: OptionValueType) =>\n        isDictionaryForAdhocFilter(filter) ? new AdhocFilter(filter) : filter,\n      ),\n    );\n  }, [props.value]);\n\n  const onClickClose = useCallback(\n    (index: number) => {\n      const valuesCopy = [...values];\n      valuesCopy.splice(index, 1);\n      setValues(valuesCopy);\n      onChange(valuesCopy);\n    },\n    [onChange, values],\n  );\n\n  const onShiftOptions = useCallback(\n    (dragIndex: number, hoverIndex: number) => {\n      const newValues = [...values];\n      [newValues[hoverIndex], newValues[dragIndex]] = [\n        newValues[dragIndex],\n        newValues[hoverIndex],\n      ];\n      setValues(newValues);\n    },\n    [values],\n  );\n\n  const getMetricExpression = useCallback(\n    (savedMetricName: string) =>\n      props.savedMetrics.find(\n        (savedMetric: Metric) => savedMetric.metric_name === savedMetricName,\n      )?.expression,\n    [props.savedMetrics],\n  );\n\n  const mapOption = useCallback(\n    (option: OptionValueType) => {\n      // already a AdhocFilter, skip\n      if (option instanceof AdhocFilter) {\n        return option;\n      }\n      const filterOptions = option as Record<string, any>;\n      // via datasource saved metric\n      if (filterOptions.saved_metric_name) {\n        return new AdhocFilter({\n          expressionType:\n            datasource.type === 'druid'\n              ? EXPRESSION_TYPES.SIMPLE\n              : EXPRESSION_TYPES.SQL,\n          subject:\n            datasource.type === 'druid'\n              ? filterOptions.saved_metric_name\n              : getMetricExpression(filterOptions.saved_metric_name),\n          operator:\n            OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n          operatorId: Operators.GREATER_THAN,\n          comparator: 0,\n          clause: CLAUSES.HAVING,\n        });\n      }\n      // has a custom label, meaning it's custom column\n      if (filterOptions.label) {\n        return new AdhocFilter({\n          expressionType:\n            datasource.type === 'druid'\n              ? EXPRESSION_TYPES.SIMPLE\n              : EXPRESSION_TYPES.SQL,\n          subject:\n            datasource.type === 'druid'\n              ? filterOptions.label\n              : new AdhocMetric(option).translateToSql(),\n          operator:\n            OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.GREATER_THAN].operation,\n          operatorId: Operators.GREATER_THAN,\n          comparator: 0,\n          clause: CLAUSES.HAVING,\n        });\n      }\n      // add a new filter item\n      if (filterOptions.column_name) {\n        return new AdhocFilter({\n          expressionType: EXPRESSION_TYPES.SIMPLE,\n          subject: filterOptions.column_name,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.EQUALS].operation,\n          operatorId: Operators.EQUALS,\n          comparator: '',\n          clause: CLAUSES.WHERE,\n          isNew: true,\n        });\n      }\n      return null;\n    },\n    [datasource.type, getMetricExpression],\n  );\n\n  const onFilterEdit = useCallback(\n    (changedFilter: AdhocFilter) => {\n      onChange(\n        values.map((value: AdhocFilter) => {\n          if (value.filterOptionName === changedFilter.filterOptionName) {\n            return changedFilter;\n          }\n          return value;\n        }),\n      );\n    },\n    [onChange, values],\n  );\n\n  const onNewFilter = useCallback(\n    (newFilter: AdhocFilter) => {\n      const mappedOption = mapOption(newFilter);\n      if (mappedOption) {\n        const newValues = [...values, mappedOption];\n        setValues(newValues);\n        onChange(newValues);\n      }\n    },\n    [mapOption, onChange, values],\n  );\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setNewFilterPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    togglePopover(false);\n  }, [togglePopover]);\n\n  const valuesRenderer = useCallback(\n    () =>\n      values.map((adhocFilter: AdhocFilter, index: number) => {\n        const label = adhocFilter.getDefaultLabel();\n        const tooltipTitle = adhocFilter.getTooltipTitle();\n        return (\n          <AdhocFilterPopoverTrigger\n            key={index}\n            adhocFilter={adhocFilter}\n            options={options}\n            datasource={datasource}\n            onFilterEdit={onFilterEdit}\n            partitionColumn={partitionColumn}\n          >\n            <OptionWrapper\n              key={index}\n              index={index}\n              label={label}\n              tooltipTitle={tooltipTitle}\n              clickClose={onClickClose}\n              onShiftOptions={onShiftOptions}\n              type={DndItemType.FilterOption}\n              withCaret\n              isExtra={adhocFilter.isExtra}\n            />\n          </AdhocFilterPopoverTrigger>\n        );\n      }),\n    [\n      onClickClose,\n      onFilterEdit,\n      onShiftOptions,\n      options,\n      partitionColumn,\n      datasource,\n      values,\n    ],\n  );\n\n  const handleClickGhostButton = useCallback(() => {\n    setDroppedItem({});\n    togglePopover(true);\n  }, [togglePopover]);\n\n  const adhocFilter = useMemo(() => {\n    if (isSavedMetric(droppedItem)) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SQL,\n        clause: CLAUSES.HAVING,\n        sqlExpression: droppedItem?.expression,\n      });\n    }\n    if (droppedItem instanceof AdhocMetric) {\n      return new AdhocFilter({\n        expressionType: EXPRESSION_TYPES.SQL,\n        clause: CLAUSES.HAVING,\n        sqlExpression: (droppedItem as AdhocMetric)?.translateToSql(),\n      });\n    }\n    const config: Partial<AdhocFilter> = {\n      subject: (droppedItem as ColumnMeta)?.column_name,\n    };\n    if (config.subject && isFeatureEnabled(FeatureFlag.UX_BETA)) {\n      config.operator = OPERATOR_ENUM_TO_OPERATOR_TYPE[Operators.IN].operation;\n      config.operatorId = Operators.IN;\n    }\n    return new AdhocFilter(config);\n  }, [droppedItem]);\n\n  const canDrop = useCallback(() => true, []);\n  const handleDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      setDroppedItem(item.value);\n      togglePopover(true);\n    },\n    [controlName, togglePopover],\n  );\n\n  const ghostButtonText = isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX)\n    ? t('Drop columns/metrics here or click')\n    : t('Drop columns or metrics here');\n\n  return (\n    <>\n      <DndSelectLabel\n        onDrop={handleDrop}\n        canDrop={canDrop}\n        valuesRenderer={valuesRenderer}\n        accept={DND_ACCEPTED_TYPES}\n        ghostButtonText={ghostButtonText}\n        onClickGhostButton={\n          isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX)\n            ? handleClickGhostButton\n            : undefined\n        }\n        {...props}\n      />\n      <AdhocFilterPopoverTrigger\n        adhocFilter={adhocFilter}\n        options={options}\n        datasource={datasource}\n        onFilterEdit={onNewFilter}\n        partitionColumn={partitionColumn}\n        isControlledComponent\n        visible={newFilterPopoverVisible}\n        togglePopover={togglePopover}\n        closePopover={closePopover}\n      >\n        <div />\n      </AdhocFilterPopoverTrigger>\n    </>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with work for additional information\n * regarding copyright ownership.  The ASF licenses file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport {\n  ensureIsArray,\n  FeatureFlag,\n  GenericDataType,\n  isFeatureEnabled,\n  Metric,\n  QueryFormMetric,\n  tn,\n} from '@superset-ui/core';\nimport { ColumnMeta } from '@superset-ui/chart-controls';\nimport { isEqual } from 'lodash';\nimport { usePrevious } from 'src/hooks/usePrevious';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport AdhocMetricPopoverTrigger from 'src/explore/components/controls/MetricControl/AdhocMetricPopoverTrigger';\nimport MetricDefinitionValue from 'src/explore/components/controls/MetricControl/MetricDefinitionValue';\nimport {\n  DatasourcePanelDndItem,\n  isDatasourcePanelDndItem,\n} from 'src/explore/components/DatasourcePanel/types';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport DndSelectLabel from 'src/explore/components/controls/DndColumnSelectControl/DndSelectLabel';\nimport { savedMetricType } from 'src/explore/components/controls/MetricControl/types';\nimport { AGGREGATES } from 'src/explore/constants';\n\nconst EMPTY_OBJECT = {};\nconst DND_ACCEPTED_TYPES = [DndItemType.Column, DndItemType.Metric];\n\nconst isDictionaryForAdhocMetric = (value: any) =>\n  value && !(value instanceof AdhocMetric) && value.expressionType;\n\nconst coerceAdhocMetrics = (value: any) => {\n  if (!value) {\n    return [];\n  }\n  if (!Array.isArray(value)) {\n    if (isDictionaryForAdhocMetric(value)) {\n      return [new AdhocMetric(value)];\n    }\n    return [value];\n  }\n  return value.map(val => {\n    if (isDictionaryForAdhocMetric(val)) {\n      return new AdhocMetric(val);\n    }\n    return val;\n  });\n};\n\nconst getOptionsForSavedMetrics = (\n  savedMetrics: savedMetricType[],\n  currentMetricValues: (string | AdhocMetric)[],\n  currentMetric?: string,\n) =>\n  savedMetrics?.filter(savedMetric =>\n    Array.isArray(currentMetricValues)\n      ? !currentMetricValues.includes(savedMetric.metric_name ?? '') ||\n        savedMetric.metric_name === currentMetric\n      : savedMetric,\n  ) ?? [];\n\ntype ValueType = Metric | AdhocMetric | QueryFormMetric;\n\n// TODO: use typeguards to distinguish saved metrics from adhoc metrics\nconst getMetricsMatchingCurrentDataset = (\n  values: ValueType[],\n  columns: ColumnMeta[],\n  savedMetrics: (savedMetricType | Metric)[],\n  prevColumns: ColumnMeta[],\n  prevSavedMetrics: (savedMetricType | Metric)[],\n): ValueType[] => {\n  const areSavedMetricsEqual =\n    !prevSavedMetrics || isEqual(prevSavedMetrics, savedMetrics);\n  const areColsEqual = !prevColumns || isEqual(prevColumns, columns);\n\n  if (areColsEqual && areSavedMetricsEqual) {\n    return values;\n  }\n  return values.reduce((acc: ValueType[], metric) => {\n    if (typeof metric === 'string' || (metric as Metric).metric_name) {\n      if (\n        areSavedMetricsEqual ||\n        savedMetrics?.some(\n          savedMetric =>\n            savedMetric.metric_name === metric ||\n            savedMetric.metric_name === (metric as Metric).metric_name,\n        )\n      ) {\n        acc.push(metric);\n      }\n      return acc;\n    }\n\n    if (!areColsEqual) {\n      const newCol = columns?.find(\n        column =>\n          (metric as AdhocMetric).column?.column_name === column.column_name,\n      );\n      if (newCol) {\n        acc.push({ ...(metric as AdhocMetric), column: newCol });\n      }\n    } else {\n      acc.push(metric);\n    }\n    return acc;\n  }, []);\n};\n\nexport const DndMetricSelect = (props: any) => {\n  const { onChange, multi, columns, savedMetrics } = props;\n\n  const handleChange = useCallback(\n    opts => {\n      // if clear out options\n      if (opts === null) {\n        onChange(null);\n        return;\n      }\n\n      const transformedOpts = ensureIsArray(opts);\n      const optionValues = transformedOpts\n        .map(option => {\n          // pre-defined metric\n          if (option.metric_name) {\n            return option.metric_name;\n          }\n          return option;\n        })\n        .filter(option => option);\n      onChange(multi ? optionValues : optionValues[0]);\n    },\n    [multi, onChange],\n  );\n\n  const [value, setValue] = useState<ValueType[]>(\n    coerceAdhocMetrics(props.value),\n  );\n  const [droppedItem, setDroppedItem] = useState<\n    DatasourcePanelDndItem | typeof EMPTY_OBJECT\n  >({});\n  const [newMetricPopoverVisible, setNewMetricPopoverVisible] = useState(false);\n  const prevColumns = usePrevious(columns);\n  const prevSavedMetrics = usePrevious(savedMetrics);\n\n  useEffect(() => {\n    setValue(coerceAdhocMetrics(props.value));\n  }, [JSON.stringify(props.value)]);\n\n  useEffect(() => {\n    // Remove selected custom metrics that do not exist in the dataset anymore\n    // Remove selected adhoc metrics that use columns which do not exist in the dataset anymore\n    // Sync adhoc metrics with dataset columns when they are modified by the user\n    if (!props.value) {\n      return;\n    }\n    const propsValues = ensureIsArray(props.value);\n    const matchingMetrics = getMetricsMatchingCurrentDataset(\n      propsValues,\n      columns,\n      savedMetrics,\n      prevColumns,\n      prevSavedMetrics,\n    );\n\n    if (!isEqual(propsValues, matchingMetrics)) {\n      handleChange(matchingMetrics);\n    }\n  }, [columns, savedMetrics, handleChange]);\n\n  const canDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      const isMetricAlreadyInValues =\n        item.type === 'metric' ? value.includes(item.value.metric_name) : false;\n      return !isMetricAlreadyInValues;\n    },\n    [value],\n  );\n\n  const onNewMetric = useCallback(\n    (newMetric: Metric) => {\n      const newValue = props.multi ? [...value, newMetric] : [newMetric];\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, props.multi, value],\n  );\n\n  const onMetricEdit = useCallback(\n    (changedMetric: Metric | AdhocMetric, oldMetric: Metric | AdhocMetric) => {\n      if (oldMetric instanceof AdhocMetric && oldMetric.equals(changedMetric)) {\n        return;\n      }\n      const newValue = value.map(value => {\n        if (\n          // compare saved metrics\n          ('metric_name' in oldMetric && value === oldMetric.metric_name) ||\n          // compare adhoc metrics\n          typeof (value as AdhocMetric).optionName !== 'undefined'\n            ? (value as AdhocMetric).optionName ===\n              (oldMetric as AdhocMetric).optionName\n            : false\n        ) {\n          return changedMetric;\n        }\n        return value;\n      });\n      setValue(newValue);\n      handleChange(newValue);\n    },\n    [handleChange, value],\n  );\n\n  const onRemoveMetric = useCallback(\n    (index: number) => {\n      if (!Array.isArray(value)) {\n        return;\n      }\n      const valuesCopy = [...value];\n      valuesCopy.splice(index, 1);\n      setValue(valuesCopy);\n      handleChange(valuesCopy);\n    },\n    [handleChange, value],\n  );\n\n  const moveLabel = useCallback(\n    (dragIndex: number, hoverIndex: number) => {\n      const newValues = [...value];\n      [newValues[hoverIndex], newValues[dragIndex]] = [\n        newValues[dragIndex],\n        newValues[hoverIndex],\n      ];\n      setValue(newValues);\n    },\n    [value],\n  );\n\n  const newSavedMetricOptions = useMemo(\n    () => getOptionsForSavedMetrics(props.savedMetrics, props.value),\n    [props.savedMetrics, props.value],\n  );\n\n  const getSavedMetricOptionsForMetric = useCallback(\n    index =>\n      getOptionsForSavedMetrics(\n        props.savedMetrics,\n        props.value,\n        props.value?.[index],\n      ),\n    [props.savedMetrics, props.value],\n  );\n\n  const handleDropLabel = useCallback(\n    () => onChange(multi ? value : value[0]),\n    [multi, onChange, value],\n  );\n\n  const valueRenderer = useCallback(\n    (option: ValueType, index: number) => (\n      <MetricDefinitionValue\n        key={index}\n        index={index}\n        option={option}\n        onMetricEdit={onMetricEdit}\n        onRemoveMetric={onRemoveMetric}\n        columns={props.columns}\n        savedMetrics={props.savedMetrics}\n        savedMetricsOptions={getSavedMetricOptionsForMetric(index)}\n        datasource={props.datasource}\n        onMoveLabel={moveLabel}\n        onDropLabel={handleDropLabel}\n        type={`${DndItemType.AdhocMetricOption}_${props.name}_${props.label}`}\n        multi={multi}\n      />\n    ),\n    [\n      getSavedMetricOptionsForMetric,\n      handleDropLabel,\n      moveLabel,\n      multi,\n      onMetricEdit,\n      onRemoveMetric,\n      props.columns,\n      props.datasource,\n      props.label,\n      props.name,\n      props.savedMetrics,\n    ],\n  );\n\n  const valuesRenderer = useCallback(\n    () => value.map((value, index) => valueRenderer(value, index)),\n    [value, valueRenderer],\n  );\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setNewMetricPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    togglePopover(false);\n  }, [togglePopover]);\n\n  const handleDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      if (item.type === DndItemType.Metric) {\n        onNewMetric(item.value as Metric);\n      }\n      if (item.type === DndItemType.Column) {\n        setDroppedItem(item);\n        togglePopover(true);\n      }\n    },\n    [onNewMetric, togglePopover],\n  );\n\n  const handleClickGhostButton = useCallback(() => {\n    setDroppedItem({});\n    togglePopover(true);\n  }, [togglePopover]);\n\n  const adhocMetric = useMemo(() => {\n    if (\n      isDatasourcePanelDndItem(droppedItem) &&\n      droppedItem.type === DndItemType.Column\n    ) {\n      const itemValue = droppedItem.value as ColumnMeta;\n      const config: Partial<AdhocMetric> = {\n        column: itemValue,\n      };\n      if (isFeatureEnabled(FeatureFlag.UX_BETA)) {\n        if (itemValue.type_generic === GenericDataType.NUMERIC) {\n          config.aggregate = AGGREGATES.SUM;\n        } else if (\n          itemValue.type_generic === GenericDataType.STRING ||\n          itemValue.type_generic === GenericDataType.BOOLEAN ||\n          itemValue.type_generic === GenericDataType.TEMPORAL\n        ) {\n          config.aggregate = AGGREGATES.COUNT_DISTINCT;\n        }\n      }\n      return new AdhocMetric(config);\n    }\n    return new AdhocMetric({ isNew: true });\n  }, [droppedItem]);\n\n  const ghostButtonText = isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX)\n    ? tn(\n        'Drop a column/metric here or click',\n        'Drop columns/metrics here or click',\n        multi ? 2 : 1,\n      )\n    : tn(\n        'Drop column or metric here',\n        'Drop columns or metrics here',\n        multi ? 2 : 1,\n      );\n\n  return (\n    <div className=\"metrics-select\">\n      <DndSelectLabel\n        onDrop={handleDrop}\n        canDrop={canDrop}\n        valuesRenderer={valuesRenderer}\n        accept={DND_ACCEPTED_TYPES}\n        ghostButtonText={ghostButtonText}\n        displayGhostButton={multi || value.length === 0}\n        onClickGhostButton={\n          isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX)\n            ? handleClickGhostButton\n            : undefined\n        }\n        {...props}\n      />\n      <AdhocMetricPopoverTrigger\n        adhocMetric={adhocMetric}\n        onMetricEdit={onNewMetric}\n        columns={props.columns}\n        savedMetricsOptions={newSavedMetricOptions}\n        savedMetric={EMPTY_OBJECT as savedMetricType}\n        datasource={props.datasource}\n        isControlledComponent\n        visible={newMetricPopoverVisible}\n        togglePopover={togglePopover}\n        closePopover={closePopover}\n      >\n        <div />\n      </AdhocMetricPopoverTrigger>\n    </div>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { sharedControlComponents } from '@superset-ui/chart-controls';\nimport AnnotationLayerControl from './AnnotationLayerControl';\nimport BoundsControl from './BoundsControl';\nimport CheckboxControl from './CheckboxControl';\nimport CollectionControl from './CollectionControl';\nimport ColorPickerControl from './ColorPickerControl';\nimport ColorSchemeControl from './ColorSchemeControl';\nimport DatasourceControl from './DatasourceControl';\nimport DateFilterControl from './DateFilterControl';\nimport FixedOrMetricControl from './FixedOrMetricControl';\nimport HiddenControl from './HiddenControl';\nimport SelectAsyncControl from './SelectAsyncControl';\nimport SelectControl from './SelectControl';\nimport SliderControl from './SliderControl';\nimport SpatialControl from './SpatialControl';\nimport TextAreaControl from './TextAreaControl';\nimport TextControl from './TextControl';\nimport TimeSeriesColumnControl from './TimeSeriesColumnControl';\nimport ViewportControl from './ViewportControl';\nimport VizTypeControl from './VizTypeControl';\nimport MetricsControl from './MetricControl/MetricsControl';\nimport AdhocFilterControl from './FilterControl/AdhocFilterControl';\nimport FilterBoxItemControl from './FilterBoxItemControl';\nimport ConditionalFormattingControl from './ConditionalFormattingControl';\nimport DndColumnSelectControl, {\n  DndColumnSelect,\n  DndFilterSelect,\n  DndMetricSelect,\n} from './DndColumnSelectControl';\n\nconst controlMap = {\n  AnnotationLayerControl,\n  BoundsControl,\n  CheckboxControl,\n  CollectionControl,\n  ColorPickerControl,\n  ColorSchemeControl,\n  DatasourceControl,\n  DateFilterControl,\n  DndColumnSelectControl,\n  DndColumnSelect,\n  DndFilterSelect,\n  DndMetricSelect,\n  FixedOrMetricControl,\n  HiddenControl,\n  SelectAsyncControl,\n  SelectControl,\n  SliderControl,\n  SpatialControl,\n  TextAreaControl,\n  TextControl,\n  TimeSeriesColumnControl,\n  ViewportControl,\n  VizTypeControl,\n  MetricsControl,\n  AdhocFilterControl,\n  FilterBoxItemControl,\n  ConditionalFormattingControl,\n  ...sharedControlComponents,\n};\nexport default controlMap;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useMemo, useState } from 'react';\nimport {\n  AdhocColumn,\n  FeatureFlag,\n  isFeatureEnabled,\n  tn,\n  QueryFormColumn,\n} from '@superset-ui/core';\nimport { ColumnMeta, isColumnMeta } from '@superset-ui/chart-controls';\nimport { isEmpty } from 'lodash';\nimport DndSelectLabel from 'src/explore/components/controls/DndColumnSelectControl/DndSelectLabel';\nimport OptionWrapper from 'src/explore/components/controls/DndColumnSelectControl/OptionWrapper';\nimport { OptionSelector } from 'src/explore/components/controls/DndColumnSelectControl/utils';\nimport { DatasourcePanelDndItem } from 'src/explore/components/DatasourcePanel/types';\nimport { DndItemType } from 'src/explore/components/DndItemType';\nimport { useComponentDidUpdate } from 'src/hooks/useComponentDidUpdate';\nimport ColumnSelectPopoverTrigger from './ColumnSelectPopoverTrigger';\nimport { DndControlProps } from './types';\n\nexport type DndColumnSelectProps = DndControlProps<QueryFormColumn> & {\n  options: Record<string, ColumnMeta>;\n  isTemporal?: boolean;\n};\n\nexport function DndColumnSelect(props: DndColumnSelectProps) {\n  const {\n    value,\n    options,\n    multi = true,\n    onChange,\n    canDelete = true,\n    ghostButtonText,\n    name,\n    label,\n    isTemporal,\n  } = props;\n  const [newColumnPopoverVisible, setNewColumnPopoverVisible] = useState(false);\n\n  const optionSelector = useMemo(\n    () => new OptionSelector(options, multi, value),\n    [multi, options, value],\n  );\n\n  // synchronize values in case of dataset changes\n  const handleOptionsChange = useCallback(() => {\n    const optionSelectorValues = optionSelector.getValues();\n    if (typeof value !== typeof optionSelectorValues) {\n      onChange(optionSelectorValues);\n    }\n    if (\n      typeof value === 'string' &&\n      typeof optionSelectorValues === 'string' &&\n      value !== optionSelectorValues\n    ) {\n      onChange(optionSelectorValues);\n    }\n    if (\n      Array.isArray(optionSelectorValues) &&\n      Array.isArray(value) &&\n      (optionSelectorValues.length !== value.length ||\n        optionSelectorValues.every((val, index) => val === value[index]))\n    ) {\n      onChange(optionSelectorValues);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [JSON.stringify(value), JSON.stringify(optionSelector.getValues())]);\n\n  // useComponentDidUpdate to avoid running this for the first render, to avoid\n  // calling onChange when the initial value is not valid for the dataset\n  useComponentDidUpdate(handleOptionsChange);\n\n  const onDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      const column = item.value as ColumnMeta;\n      if (!optionSelector.multi && !isEmpty(optionSelector.values)) {\n        optionSelector.replace(0, column.column_name);\n      } else {\n        optionSelector.add(column.column_name);\n      }\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const canDrop = useCallback(\n    (item: DatasourcePanelDndItem) => {\n      const columnName = (item.value as ColumnMeta).column_name;\n      return (\n        columnName in optionSelector.options && !optionSelector.has(columnName)\n      );\n    },\n    [optionSelector],\n  );\n\n  const onClickClose = useCallback(\n    (index: number) => {\n      optionSelector.del(index);\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const onShiftOptions = useCallback(\n    (dragIndex: number, hoverIndex: number) => {\n      optionSelector.swap(dragIndex, hoverIndex);\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const popoverOptions = useMemo(() => Object.values(options), [options]);\n\n  const valuesRenderer = useCallback(\n    () =>\n      optionSelector.values.map((column, idx) =>\n        isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX) ? (\n          <ColumnSelectPopoverTrigger\n            key={idx}\n            columns={popoverOptions}\n            onColumnEdit={newColumn => {\n              if (isColumnMeta(newColumn)) {\n                optionSelector.replace(idx, newColumn.column_name);\n              } else {\n                optionSelector.replace(idx, newColumn as AdhocColumn);\n              }\n              onChange(optionSelector.getValues());\n            }}\n            editedColumn={column}\n            isTemporal={isTemporal}\n          >\n            <OptionWrapper\n              key={idx}\n              index={idx}\n              clickClose={onClickClose}\n              onShiftOptions={onShiftOptions}\n              type={`${DndItemType.ColumnOption}_${name}_${label}`}\n              canDelete={canDelete}\n              column={column}\n              withCaret\n            />\n          </ColumnSelectPopoverTrigger>\n        ) : (\n          <OptionWrapper\n            key={idx}\n            index={idx}\n            clickClose={onClickClose}\n            onShiftOptions={onShiftOptions}\n            type={`${DndItemType.ColumnOption}_${name}_${label}`}\n            canDelete={canDelete}\n            column={column}\n          />\n        ),\n      ),\n    [\n      canDelete,\n      label,\n      name,\n      onChange,\n      onClickClose,\n      onShiftOptions,\n      optionSelector,\n      popoverOptions,\n    ],\n  );\n\n  const addNewColumnWithPopover = useCallback(\n    (newColumn: ColumnMeta | AdhocColumn) => {\n      if (isColumnMeta(newColumn)) {\n        optionSelector.add(newColumn.column_name);\n      } else {\n        optionSelector.add(newColumn as AdhocColumn);\n      }\n      onChange(optionSelector.getValues());\n    },\n    [onChange, optionSelector],\n  );\n\n  const togglePopover = useCallback((visible: boolean) => {\n    setNewColumnPopoverVisible(visible);\n  }, []);\n\n  const closePopover = useCallback(() => {\n    togglePopover(false);\n  }, [togglePopover]);\n\n  const openPopover = useCallback(() => {\n    togglePopover(true);\n  }, [togglePopover]);\n\n  const defaultGhostButtonText = isFeatureEnabled(\n    FeatureFlag.ENABLE_DND_WITH_CLICK_UX,\n  )\n    ? tn(\n        'Drop a column here or click',\n        'Drop columns here or click',\n        multi ? 2 : 1,\n      )\n    : tn('Drop column here', 'Drop columns here', multi ? 2 : 1);\n\n  return (\n    <div>\n      <DndSelectLabel\n        onDrop={onDrop}\n        canDrop={canDrop}\n        valuesRenderer={valuesRenderer}\n        accept={DndItemType.Column}\n        displayGhostButton={multi || optionSelector.values.length === 0}\n        ghostButtonText={ghostButtonText || defaultGhostButtonText}\n        onClickGhostButton={\n          isFeatureEnabled(FeatureFlag.ENABLE_DND_WITH_CLICK_UX)\n            ? openPopover\n            : undefined\n        }\n        {...props}\n      />\n      <ColumnSelectPopoverTrigger\n        columns={popoverOptions}\n        onColumnEdit={addNewColumnWithPopover}\n        isControlledComponent\n        togglePopover={togglePopover}\n        closePopover={closePopover}\n        visible={newColumnPopoverVisible}\n        isTemporal={isTemporal}\n      >\n        <div />\n      </ColumnSelectPopoverTrigger>\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ColumnMeta, Metric } from '@superset-ui/chart-controls';\nimport { DndItemType } from '../DndItemType';\n\nexport type DndItemValue = ColumnMeta | Metric;\n\nexport interface DatasourcePanelDndItem {\n  value: DndItemValue;\n  type: DndItemType;\n}\n\nexport function isDatasourcePanelDndItem(\n  item: any,\n): item is DatasourcePanelDndItem {\n  return item?.value && item?.type;\n}\n\nexport function isSavedMetric(item: any): item is Metric {\n  return item?.metric_name;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { Input } from 'src/components/Input';\n\ninterface HiddenControlsProps {\n  onChange: () => void;\n  value: string | number | readonly string[] | undefined;\n}\n\nexport default function HiddenControl(props: HiddenControlsProps) {\n  // This wouldn't be necessary but might as well\n  return <Input type=\"hidden\" value={props.value} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport Slider from 'src/components/Slider';\nimport ControlHeader, {\n  ControlHeaderProps,\n} from 'src/explore/components/ControlHeader';\n\ntype SliderControlProps = ControlHeaderProps & {\n  onChange: (value: number) => void;\n  value: number;\n  default?: number;\n};\n\nexport default function SliderControl({\n  default: defaultValue,\n  name,\n  label,\n  description,\n  renderTrigger,\n  rightNode,\n  leftNode,\n  validationErrors,\n  hovered,\n  warning,\n  danger,\n  onClick,\n  tooltipOnClick,\n  onChange = () => {},\n  ...rest\n}: SliderControlProps) {\n  const headerProps = {\n    name,\n    label,\n    description,\n    renderTrigger,\n    rightNode,\n    leftNode,\n    validationErrors,\n    onClick,\n    hovered,\n    tooltipOnClick,\n    warning,\n    danger,\n  };\n  return (\n    <>\n      <ControlHeader {...headerProps} />\n      <Slider {...rest} onChange={onChange} defaultValue={defaultValue} />\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode, useCallback, useState, useEffect } from 'react';\nimport { isEqual } from 'lodash';\nimport {\n  ControlType,\n  ControlComponentProps as BaseControlComponentProps,\n} from '@superset-ui/chart-controls';\nimport { styled, JsonValue, QueryFormData } from '@superset-ui/core';\nimport { usePrevious } from 'src/hooks/usePrevious';\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport { ExploreActions } from 'src/explore/actions/exploreActions';\nimport controlMap from './controls';\n\nexport type ControlProps = {\n  // the actual action dispatcher (via bindActionCreators) has identical\n  // signature to the original action factory.\n  actions: Partial<ExploreActions> & Pick<ExploreActions, 'setControlValue'>;\n  type: ControlType;\n  label?: ReactNode;\n  name: string;\n  description?: ReactNode;\n  tooltipOnClick?: () => ReactNode;\n  places?: number;\n  rightNode?: ReactNode;\n  formData?: QueryFormData | null;\n  value?: JsonValue;\n  validationErrors?: any[];\n  hidden?: boolean;\n  renderTrigger?: boolean;\n  default?: JsonValue;\n  isVisible?: boolean;\n  resetOnHide?: boolean;\n};\n\n/**\n *\n */\nexport type ControlComponentProps<ValueType extends JsonValue = JsonValue> =\n  Omit<ControlProps, 'value'> & BaseControlComponentProps<ValueType>;\n\nconst StyledControl = styled.div`\n  padding-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nexport default function Control(props: ControlProps) {\n  const {\n    actions: { setControlValue },\n    name,\n    type,\n    hidden,\n    isVisible,\n    resetOnHide = true,\n  } = props;\n\n  const [hovered, setHovered] = useState(false);\n  const wasVisible = usePrevious(isVisible);\n  const onChange = useCallback(\n    (value: any, errors: any[]) => setControlValue(name, value, errors),\n    [name, setControlValue],\n  );\n\n  useEffect(() => {\n    if (\n      wasVisible === true &&\n      isVisible === false &&\n      props.default !== undefined &&\n      !isEqual(props.value, props.default) &&\n      resetOnHide\n    ) {\n      // reset control value if setting to invisible\n      setControlValue?.(name, props.default);\n    }\n  }, [\n    name,\n    wasVisible,\n    isVisible,\n    setControlValue,\n    props.value,\n    props.default,\n  ]);\n\n  if (!type || isVisible === false) return null;\n\n  const ControlComponent = typeof type === 'string' ? controlMap[type] : type;\n  if (!ControlComponent) {\n    // eslint-disable-next-line no-console\n    console.warn(`Unknown controlType: ${type}`);\n    return null;\n  }\n\n  return (\n    <StyledControl\n      className=\"Control\"\n      data-test={name}\n      style={hidden ? { display: 'none' } : undefined}\n      onMouseEnter={() => setHovered(true)}\n      onMouseLeave={() => setHovered(false)}\n    >\n      <ErrorBoundary>\n        <ControlComponent onChange={onChange} hovered={hovered} {...props} />\n      </ErrorBoundary>\n    </StyledControl>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FC, ReactNode } from 'react';\nimport { t, css, useTheme, SupersetTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { FormLabel } from 'src/components/Form';\nimport Icons from 'src/components/Icons';\n\ntype ValidationError = string;\n\nexport type ControlHeaderProps = {\n  name?: string;\n  label?: ReactNode;\n  description?: ReactNode;\n  validationErrors?: ValidationError[];\n  renderTrigger?: boolean;\n  rightNode?: ReactNode;\n  leftNode?: ReactNode;\n  onClick?: () => void;\n  hovered?: boolean;\n  tooltipOnClick?: () => void;\n  warning?: string;\n  danger?: string;\n};\n\nconst ControlHeader: FC<ControlHeaderProps> = ({\n  name,\n  label,\n  description,\n  validationErrors = [],\n  renderTrigger = false,\n  rightNode,\n  leftNode,\n  onClick,\n  hovered = false,\n  tooltipOnClick = () => {},\n  warning,\n  danger,\n}) => {\n  const { gridUnit, colors } = useTheme();\n\n  if (!label) {\n    return null;\n  }\n\n  const renderOptionalIcons = () => {\n    if (!hovered) {\n      return null;\n    }\n\n    return (\n      <span\n        css={() => css`\n          position: absolute;\n          top: 50%;\n          right: 0;\n          padding-left: ${gridUnit}px;\n          transform: translate(100%, -50%);\n          white-space: nowrap;\n        `}\n      >\n        {description && (\n          <span>\n            <InfoTooltipWithTrigger\n              label={t('description')}\n              tooltip={description}\n              placement=\"top\"\n              onClick={tooltipOnClick}\n            />{' '}\n          </span>\n        )}\n        {renderTrigger && (\n          <span>\n            <InfoTooltipWithTrigger\n              label={t('bolt')}\n              tooltip={t('Changing this control takes effect instantly')}\n              placement=\"top\"\n              icon=\"bolt\"\n            />{' '}\n          </span>\n        )}\n      </span>\n    );\n  };\n\n  const labelClass = validationErrors?.length > 0 ? 'text-danger' : '';\n\n  return (\n    <div className=\"ControlHeader\" data-test={`${name}-header`}>\n      <div className=\"pull-left\">\n        <FormLabel\n          css={(theme: SupersetTheme) =>\n            css`\n              margin-bottom: ${theme.gridUnit * 0.5}px;\n              position: relative;\n            `\n          }\n        >\n          {leftNode && <span>{leftNode}</span>}\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={onClick}\n            className={labelClass}\n            style={{ cursor: onClick ? 'pointer' : '' }}\n          >\n            {label}\n          </span>{' '}\n          {warning && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={warning}>\n                <Icons.AlertSolid iconColor={colors.alert.base} iconSize=\"s\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {danger && (\n            <span>\n              <Tooltip id=\"error-tooltip\" placement=\"top\" title={danger}>\n                <Icons.ErrorSolid iconColor={colors.error.base} iconSize=\"s\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {validationErrors?.length > 0 && (\n            <span>\n              <Tooltip\n                id=\"error-tooltip\"\n                placement=\"top\"\n                title={validationErrors?.join(' ')}\n              >\n                <Icons.ErrorSolid iconColor={colors.error.base} iconSize=\"s\" />\n              </Tooltip>{' '}\n            </span>\n          )}\n          {renderOptionalIcons()}\n        </FormLabel>\n      </div>\n      {rightNode && <div className=\"pull-right\">{rightNode}</div>}\n      <div className=\"clearfix\" />\n    </div>\n  );\n};\n\nexport default ControlHeader;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\n\nconst NUM_COLUMNS = 12;\n\ntype Control = React.ReactElement | null;\n\nexport default function ControlRow({ controls }: { controls: Control[] }) {\n  const isHiddenControl = useCallback(\n    (control: Control) =>\n      control?.props.type === 'HiddenControl' ||\n      control?.props.isVisible === false,\n    [],\n  );\n  // Invisible control should not be counted\n  // in the columns number\n  const countableControls = controls.filter(\n    control => !isHiddenControl(control),\n  );\n  const colSize = countableControls.length\n    ? NUM_COLUMNS / countableControls.length\n    : NUM_COLUMNS;\n  return (\n    <div className=\"row\">\n      {controls.map((control, i) => (\n        <div\n          className={`col-lg-${colSize} col-xs-12`}\n          style={{\n            display: isHiddenControl(control) ? 'none' : 'block',\n          }}\n          key={i}\n        >\n          {control}\n        </div>\n      ))}\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * All possible draggable items for the chart controls.\n */\nexport enum DndItemType {\n  // an existing column in table\n  Column = 'column',\n  // a selected column option in ColumnSelectControl\n  ColumnOption = 'columnOption',\n  // an adhoc column option in ColumnSelectControl\n  AdhocColumnOption = 'adhocColumn',\n\n  // a saved metric\n  Metric = 'metric',\n  // a selected saved metric in MetricsControl\n  MetricOption = 'metricOption',\n  // an adhoc metric option in MetricsControl\n  AdhocMetricOption = 'adhocMetric',\n\n  // an adhoc filter option\n  FilterOption = 'filterOption',\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { styled } from '@superset-ui/core';\n\nexport const ExplorePopoverContent = styled.div`\n  .edit-popover-resize {\n    transform: scaleX(-1);\n    float: right;\n    margin-top: ${({ theme }) => theme.gridUnit * 4}px;\n    margin-right: ${({ theme }) => theme.gridUnit * -2}px;\n    cursor: nwse-resize;\n  }\n  .filter-sql-editor {\n    border: ${({ theme }) => theme.colors.grayscale.light2} solid thin;\n  }\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useRef, useEffect, useState } from 'react';\n\nimport Popover, {\n  PopoverProps as BasePopoverProps,\n  TooltipPlacement,\n} from 'src/components/Popover';\n\nconst sectionContainerId = 'controlSections';\nconst getSectionContainerElement = () =>\n  document.getElementById(sectionContainerId)?.lastElementChild as HTMLElement;\n\nconst getElementYVisibilityRatioOnContainer = (node: HTMLElement) => {\n  const containerHeight = window?.innerHeight;\n  const nodePositionInViewport = node.getBoundingClientRect()?.top;\n  if (!containerHeight || !nodePositionInViewport) {\n    return 0;\n  }\n\n  return nodePositionInViewport / containerHeight;\n};\n\nexport type PopoverProps = BasePopoverProps & {\n  getVisibilityRatio?: typeof getElementYVisibilityRatioOnContainer;\n};\n\nconst ControlPopover: React.FC<PopoverProps> = ({\n  getPopupContainer,\n  getVisibilityRatio = getElementYVisibilityRatioOnContainer,\n  visible: visibleProp,\n  ...props\n}) => {\n  const triggerElementRef = useRef<HTMLElement>();\n\n  const [visible, setVisible] = useState(\n    visibleProp === undefined ? props.defaultVisible : visibleProp,\n  );\n  const [placement, setPlacement] = React.useState<TooltipPlacement>('right');\n\n  const calculatePlacement = useCallback(() => {\n    const visibilityRatio = getVisibilityRatio(triggerElementRef.current!);\n\n    if (visibilityRatio < 0.35) {\n      setPlacement('rightTop');\n    } else if (visibilityRatio > 0.65) {\n      setPlacement('rightBottom');\n    } else {\n      setPlacement('right');\n    }\n  }, [getVisibilityRatio]);\n\n  const changeContainerScrollStatus = useCallback(\n    visible => {\n      if (triggerElementRef.current && visible) {\n        calculatePlacement();\n      }\n\n      const element = getSectionContainerElement();\n      if (element) {\n        element.style.setProperty(\n          'overflow-y',\n          visible ? 'hidden' : 'auto',\n          'important',\n        );\n      }\n    },\n    [calculatePlacement],\n  );\n\n  const handleGetPopupContainer = useCallback(\n    (triggerNode: HTMLElement) => {\n      triggerElementRef.current = triggerNode;\n      setTimeout(() => {\n        calculatePlacement();\n      }, 0);\n\n      return getPopupContainer?.(triggerNode) || document.body;\n    },\n    [calculatePlacement, getPopupContainer],\n  );\n\n  const handleOnVisibleChange = useCallback(\n    (visible: boolean | undefined) => {\n      if (visible === undefined) {\n        changeContainerScrollStatus(visible);\n      }\n\n      setVisible(!!visible);\n      props.onVisibleChange?.(!!visible);\n    },\n    [props, changeContainerScrollStatus],\n  );\n\n  const handleDocumentKeyDownListener = useCallback(\n    (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        setVisible(false);\n        props.onVisibleChange?.(false);\n      }\n    },\n    [props],\n  );\n\n  useEffect(() => {\n    if (visibleProp !== undefined) {\n      setVisible(!!visibleProp);\n    }\n  }, [visibleProp]);\n\n  useEffect(() => {\n    if (visible !== undefined) {\n      changeContainerScrollStatus(visible);\n    }\n  }, [visible, changeContainerScrollStatus]);\n\n  useEffect(() => {\n    if (visible) {\n      document.addEventListener('keydown', handleDocumentKeyDownListener);\n    }\n\n    return () => {\n      document.removeEventListener('keydown', handleDocumentKeyDownListener);\n    };\n  }, [handleDocumentKeyDownListener, visible]);\n\n  return (\n    <Popover\n      {...props}\n      visible={visible}\n      arrowPointAtCenter\n      placement={placement}\n      onVisibleChange={handleOnVisibleChange}\n      getPopupContainer={handleGetPopupContainer}\n    />\n  );\n};\n\nexport default ControlPopover;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const SEPARATOR = ' : ';\n\nexport const buildTimeRangeString = (since: string, until: string): string =>\n  `${since}${SEPARATOR}${until}`;\n\nconst formatDateEndpoint = (dttm: string, isStart?: boolean): string =>\n  dttm.replace('T00:00:00', '') || (isStart ? '-∞' : '∞');\n\nexport const formatTimeRange = (timeRange: string) => {\n  const splitDateRange = timeRange.split(SEPARATOR);\n  if (splitDateRange.length === 1) return timeRange;\n  return `${formatDateEndpoint(\n    splitDateRange[0],\n    true,\n  )} ≤ col < ${formatDateEndpoint(splitDateRange[1])}`;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport type SelectOptionType = {\n  value: string;\n  label: string;\n};\n\nexport type FrameType =\n  | 'Common'\n  | 'Calendar'\n  | 'Custom'\n  | 'Advanced'\n  | 'No filter';\n\nexport type DateTimeGrainType =\n  | 'second'\n  | 'minite'\n  | 'hour'\n  | 'day'\n  | 'week'\n  | 'month'\n  | 'quarter'\n  | 'year';\n\nexport type CustomRangeKey =\n  | 'sinceMode'\n  | 'sinceDatetime'\n  | 'sinceGrain'\n  | 'sinceGrainValue'\n  | 'untilMode'\n  | 'untilDatetime'\n  | 'untilGrain'\n  | 'untilGrainValue'\n  | 'anchorMode'\n  | 'anchorValue';\n\nexport type DateTimeModeType = 'specific' | 'relative' | 'now' | 'today';\n\nexport type CustomRangeType = {\n  sinceMode: DateTimeModeType;\n  sinceDatetime: string;\n  sinceGrain: DateTimeGrainType;\n  sinceGrainValue: number;\n  untilMode: DateTimeModeType;\n  untilDatetime: string;\n  untilGrain: DateTimeGrainType;\n  untilGrainValue: number;\n  anchorMode: 'now' | 'specific';\n  anchorValue: string;\n};\n\nexport type CustomRangeDecodeType = {\n  customRange: CustomRangeType;\n  matchedFlag: boolean;\n};\n\nexport type CommonRangeType =\n  | 'Last day'\n  | 'Last week'\n  | 'Last month'\n  | 'Last quarter'\n  | 'Last year';\n\nexport const PreviousCalendarWeek = 'previous calendar week';\nexport const PreviousCalendarMonth = 'previous calendar month';\nexport const PreviousCalendarYear = 'previous calendar year';\nexport type CalendarRangeType =\n  | typeof PreviousCalendarWeek\n  | typeof PreviousCalendarMonth\n  | typeof PreviousCalendarYear;\n\nexport type FrameComponentProps = {\n  onChange: (timeRange: string) => void;\n  value: string;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment from 'moment';\nimport { t } from '@superset-ui/core';\nimport {\n  SelectOptionType,\n  PreviousCalendarWeek,\n  PreviousCalendarMonth,\n  PreviousCalendarYear,\n  CommonRangeType,\n  CalendarRangeType,\n} from 'src/explore/components/controls/DateFilterControl/types';\n\nexport const FRAME_OPTIONS: SelectOptionType[] = [\n  { value: 'Common', label: t('Last') },\n  { value: 'Calendar', label: t('Previous') },\n  { value: 'Custom', label: t('Custom') },\n  { value: 'Advanced', label: t('Advanced') },\n  { value: 'No filter', label: t('No filter') },\n];\n\nexport const COMMON_RANGE_OPTIONS: SelectOptionType[] = [\n  { value: 'Last day', label: t('last day') },\n  { value: 'Last week', label: t('last week') },\n  { value: 'Last month', label: t('last month') },\n  { value: 'Last quarter', label: t('last quarter') },\n  { value: 'Last year', label: t('last year') },\n];\nexport const COMMON_RANGE_VALUES_SET = new Set(\n  COMMON_RANGE_OPTIONS.map(({ value }) => value),\n);\n\nexport const CALENDAR_RANGE_OPTIONS: SelectOptionType[] = [\n  { value: PreviousCalendarWeek, label: t('previous calendar week') },\n  {\n    value: PreviousCalendarMonth,\n    label: t('previous calendar month'),\n  },\n  { value: PreviousCalendarYear, label: t('previous calendar year') },\n];\nexport const CALENDAR_RANGE_VALUES_SET = new Set(\n  CALENDAR_RANGE_OPTIONS.map(({ value }) => value),\n);\n\nconst GRAIN_OPTIONS = [\n  { value: 'second', label: (rel: string) => t('Seconds %s', rel) },\n  { value: 'minute', label: (rel: string) => t('Minutes %s', rel) },\n  { value: 'hour', label: (rel: string) => t('Hours %s', rel) },\n  { value: 'day', label: (rel: string) => t('Days %s', rel) },\n  { value: 'week', label: (rel: string) => t('Weeks %s', rel) },\n  { value: 'month', label: (rel: string) => t('Months %s', rel) },\n  { value: 'quarter', label: (rel: string) => t('Quarters %s', rel) },\n  { value: 'year', label: (rel: string) => t('Years %s', rel) },\n];\n\nexport const SINCE_GRAIN_OPTIONS: SelectOptionType[] = GRAIN_OPTIONS.map(\n  item => ({\n    value: item.value,\n    label: item.label(t('Before')),\n  }),\n);\n\nexport const UNTIL_GRAIN_OPTIONS: SelectOptionType[] = GRAIN_OPTIONS.map(\n  item => ({\n    value: item.value,\n    label: item.label(t('After')),\n  }),\n);\n\nexport const SINCE_MODE_OPTIONS: SelectOptionType[] = [\n  { value: 'specific', label: t('Specific Date/Time') },\n  { value: 'relative', label: t('Relative Date/Time') },\n  { value: 'now', label: t('Now') },\n  { value: 'today', label: t('Midnight') },\n];\n\nexport const UNTIL_MODE_OPTIONS: SelectOptionType[] =\n  SINCE_MODE_OPTIONS.slice();\n\nexport const COMMON_RANGE_SET: Set<CommonRangeType> = new Set([\n  'Last day',\n  'Last week',\n  'Last month',\n  'Last quarter',\n  'Last year',\n]);\n\nexport const CALENDAR_RANGE_SET: Set<CalendarRangeType> = new Set([\n  PreviousCalendarWeek,\n  PreviousCalendarMonth,\n  PreviousCalendarYear,\n]);\n\nexport const MOMENT_FORMAT = 'YYYY-MM-DD[T]HH:mm:ss';\nexport const SEVEN_DAYS_AGO = moment()\n  .utc()\n  .startOf('day')\n  .subtract(7, 'days')\n  .format(MOMENT_FORMAT);\nexport const MIDNIGHT = moment().utc().startOf('day').format(MOMENT_FORMAT);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport moment, { Moment } from 'moment';\nimport {\n  CustomRangeDecodeType,\n  CustomRangeType,\n  DateTimeGrainType,\n  DateTimeModeType,\n} from 'src/explore/components/controls/DateFilterControl/types';\nimport { SEPARATOR } from './dateFilterUtils';\nimport { SEVEN_DAYS_AGO, MIDNIGHT, MOMENT_FORMAT } from './constants';\n\n/**\n * RegExp to test a string for a full ISO 8601 Date\n * Does not do any sort of date validation, only checks if the string is according to the ISO 8601 spec.\n *  YYYY-MM-DDThh:mm:ss\n *  YYYY-MM-DDThh:mm:ssTZD\n *  YYYY-MM-DDThh:mm:ss.sTZD\n * @see: https://www.w3.org/TR/NOTE-datetime\n */\nconst iso8601 = String.raw`\\d{4}-\\d\\d-\\d\\dT\\d\\d:\\d\\d:\\d\\d(?:\\.\\d+)?(?:(?:[+-]\\d\\d:\\d\\d)|Z)?`;\nconst datetimeConstant = String.raw`(?:TODAY|NOW)`;\nconst grainValue = String.raw`[+-]?[1-9][0-9]*`;\nconst grain = String.raw`YEAR|QUARTER|MONTH|WEEK|DAY|HOUR|MINUTE|SECOND`;\nconst CUSTOM_RANGE_EXPRESSION = RegExp(\n  String.raw`^DATEADD\\(DATETIME\\(\"(${iso8601}|${datetimeConstant})\"\\),\\s(${grainValue}),\\s(${grain})\\)$`,\n  'i',\n);\nexport const ISO8601_AND_CONSTANT = RegExp(\n  String.raw`^${iso8601}$|^${datetimeConstant}$`,\n  'i',\n);\nconst DATETIME_CONSTANT = ['now', 'today'];\nconst defaultCustomRange: CustomRangeType = {\n  sinceDatetime: SEVEN_DAYS_AGO,\n  sinceMode: 'relative',\n  sinceGrain: 'day',\n  sinceGrainValue: -7,\n  untilDatetime: MIDNIGHT,\n  untilMode: 'specific',\n  untilGrain: 'day',\n  untilGrainValue: 7,\n  anchorMode: 'now',\n  anchorValue: 'now',\n};\nconst SPECIFIC_MODE = ['specific', 'today', 'now'];\n\nexport const dttmToMoment = (dttm: string): Moment => {\n  if (dttm === 'now') {\n    return moment().utc().startOf('second');\n  }\n  if (dttm === 'today') {\n    return moment().utc().startOf('day');\n  }\n  return moment(dttm);\n};\n\nexport const dttmToString = (dttm: string): string =>\n  dttmToMoment(dttm).format(MOMENT_FORMAT);\n\nexport const customTimeRangeDecode = (\n  timeRange: string,\n): CustomRangeDecodeType => {\n  const splitDateRange = timeRange.split(SEPARATOR);\n\n  if (splitDateRange.length === 2) {\n    const [since, until] = splitDateRange;\n\n    // specific : specific\n    if (ISO8601_AND_CONSTANT.test(since) && ISO8601_AND_CONSTANT.test(until)) {\n      const sinceMode = (\n        DATETIME_CONSTANT.includes(since) ? since : 'specific'\n      ) as DateTimeModeType;\n      const untilMode = (\n        DATETIME_CONSTANT.includes(until) ? until : 'specific'\n      ) as DateTimeModeType;\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          sinceDatetime: since,\n          untilDatetime: until,\n          sinceMode,\n          untilMode,\n        },\n        matchedFlag: true,\n      };\n    }\n\n    // relative : specific\n    const sinceCapturedGroup = since.match(CUSTOM_RANGE_EXPRESSION);\n    if (\n      sinceCapturedGroup &&\n      ISO8601_AND_CONSTANT.test(until) &&\n      since.includes(until)\n    ) {\n      const [dttm, grainValue, grain] = sinceCapturedGroup.slice(1);\n      const untilMode = (\n        DATETIME_CONSTANT.includes(until) ? until : 'specific'\n      ) as DateTimeModeType;\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          sinceGrain: grain as DateTimeGrainType,\n          sinceGrainValue: parseInt(grainValue, 10),\n          sinceDatetime: dttm,\n          untilDatetime: dttm,\n          sinceMode: 'relative',\n          untilMode,\n        },\n        matchedFlag: true,\n      };\n    }\n\n    // specific : relative\n    const untilCapturedGroup = until.match(CUSTOM_RANGE_EXPRESSION);\n    if (\n      ISO8601_AND_CONSTANT.test(since) &&\n      untilCapturedGroup &&\n      until.includes(since)\n    ) {\n      const [dttm, grainValue, grain] = [...untilCapturedGroup.slice(1)];\n      const sinceMode = (\n        DATETIME_CONSTANT.includes(since) ? since : 'specific'\n      ) as DateTimeModeType;\n      return {\n        customRange: {\n          ...defaultCustomRange,\n          untilGrain: grain as DateTimeGrainType,\n          untilGrainValue: parseInt(grainValue, 10),\n          sinceDatetime: dttm,\n          untilDatetime: dttm,\n          untilMode: 'relative',\n          sinceMode,\n        },\n        matchedFlag: true,\n      };\n    }\n\n    // relative : relative\n    if (sinceCapturedGroup && untilCapturedGroup) {\n      const [sinceDttm, sinceGrainValue, sinceGrain] = [\n        ...sinceCapturedGroup.slice(1),\n      ];\n      const [untileDttm, untilGrainValue, untilGrain] = [\n        ...untilCapturedGroup.slice(1),\n      ];\n      if (sinceDttm === untileDttm) {\n        return {\n          customRange: {\n            ...defaultCustomRange,\n            sinceGrain: sinceGrain as DateTimeGrainType,\n            sinceGrainValue: parseInt(sinceGrainValue, 10),\n            sinceDatetime: sinceDttm,\n            untilGrain: untilGrain as DateTimeGrainType,\n            untilGrainValue: parseInt(untilGrainValue, 10),\n            untilDatetime: untileDttm,\n            anchorValue: sinceDttm,\n            sinceMode: 'relative',\n            untilMode: 'relative',\n            anchorMode: sinceDttm === 'now' ? 'now' : 'specific',\n          },\n          matchedFlag: true,\n        };\n      }\n    }\n  }\n\n  return {\n    customRange: defaultCustomRange,\n    matchedFlag: false,\n  };\n};\n\nexport const customTimeRangeEncode = (customRange: CustomRangeType): string => {\n  const {\n    sinceDatetime,\n    sinceMode,\n    sinceGrain,\n    sinceGrainValue,\n    untilDatetime,\n    untilMode,\n    untilGrain,\n    untilGrainValue,\n    anchorValue,\n  } = { ...customRange };\n  // specific : specific\n  if (SPECIFIC_MODE.includes(sinceMode) && SPECIFIC_MODE.includes(untilMode)) {\n    const since =\n      sinceMode === 'specific' ? dttmToString(sinceDatetime) : sinceMode;\n    const until =\n      untilMode === 'specific' ? dttmToString(untilDatetime) : untilMode;\n    return `${since} : ${until}`;\n  }\n\n  // specific : relative\n  if (SPECIFIC_MODE.includes(sinceMode) && untilMode === 'relative') {\n    const since =\n      sinceMode === 'specific' ? dttmToString(sinceDatetime) : sinceMode;\n    const until = `DATEADD(DATETIME(\"${since}\"), ${untilGrainValue}, ${untilGrain})`;\n    return `${since} : ${until}`;\n  }\n\n  // relative : specific\n  if (sinceMode === 'relative' && SPECIFIC_MODE.includes(untilMode)) {\n    const until =\n      untilMode === 'specific' ? dttmToString(untilDatetime) : untilMode;\n    const since = `DATEADD(DATETIME(\"${until}\"), ${-Math.abs(\n      sinceGrainValue,\n    )}, ${sinceGrain})`;\n    return `${since} : ${until}`;\n  }\n\n  // relative : relative\n  const since = `DATEADD(DATETIME(\"${anchorValue}\"), ${-Math.abs(\n    sinceGrainValue,\n  )}, ${sinceGrain})`;\n  const until = `DATEADD(DATETIME(\"${anchorValue}\"), ${untilGrainValue}, ${untilGrain})`;\n  return `${since} : ${until}`;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { Radio } from 'src/components/Radio';\nimport {\n  COMMON_RANGE_OPTIONS,\n  COMMON_RANGE_SET,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport {\n  CommonRangeType,\n  FrameComponentProps,\n} from 'src/explore/components/controls/DateFilterControl/types';\n\nexport function CommonFrame(props: FrameComponentProps) {\n  let commonRange = 'Last week';\n  if (COMMON_RANGE_SET.has(props.value as CommonRangeType)) {\n    commonRange = props.value;\n  } else {\n    props.onChange(commonRange);\n  }\n\n  return (\n    <>\n      <div className=\"section-title\">{t('Configure Time Range: Last...')}</div>\n      <Radio.Group\n        value={commonRange}\n        onChange={(e: any) => props.onChange(e.target.value)}\n      >\n        {COMMON_RANGE_OPTIONS.map(({ value, label }) => (\n          <Radio key={value} value={value} className=\"vertical-radio\">\n            {label}\n          </Radio>\n        ))}\n      </Radio.Group>\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect } from 'react';\nimport { t } from '@superset-ui/core';\nimport { Radio } from 'src/components/Radio';\nimport {\n  CALENDAR_RANGE_OPTIONS,\n  CALENDAR_RANGE_SET,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport {\n  CalendarRangeType,\n  PreviousCalendarWeek,\n  FrameComponentProps,\n} from '../types';\n\nexport function CalendarFrame({ onChange, value }: FrameComponentProps) {\n  useEffect(() => {\n    if (!CALENDAR_RANGE_SET.has(value as CalendarRangeType)) {\n      onChange(PreviousCalendarWeek);\n    }\n  }, [onChange, value]);\n\n  if (!CALENDAR_RANGE_SET.has(value as CalendarRangeType)) {\n    return null;\n  }\n\n  return (\n    <>\n      <div className=\"section-title\">\n        {t('Configure Time Range: Previous...')}\n      </div>\n      <Radio.Group\n        value={value}\n        onChange={(e: any) => onChange(e.target.value)}\n      >\n        {CALENDAR_RANGE_OPTIONS.map(({ value, label }) => (\n          <Radio key={value} value={value} className=\"vertical-radio\">\n            {label}\n          </Radio>\n        ))}\n      </Radio.Group>\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { Moment } from 'moment';\nimport { isInteger } from 'lodash';\nimport { Col, Row } from 'src/components';\nimport { InputNumber } from 'src/components/Input';\nimport { DatePicker } from 'src/components/DatePicker';\nimport { Radio } from 'src/components/Radio';\nimport Select from 'src/components/Select/Select';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport {\n  SINCE_GRAIN_OPTIONS,\n  SINCE_MODE_OPTIONS,\n  UNTIL_GRAIN_OPTIONS,\n  UNTIL_MODE_OPTIONS,\n  MOMENT_FORMAT,\n  MIDNIGHT,\n  customTimeRangeDecode,\n  customTimeRangeEncode,\n  dttmToMoment,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport {\n  CustomRangeKey,\n  FrameComponentProps,\n} from 'src/explore/components/controls/DateFilterControl/types';\n\nexport function CustomFrame(props: FrameComponentProps) {\n  const { customRange, matchedFlag } = customTimeRangeDecode(props.value);\n  if (!matchedFlag) {\n    props.onChange(customTimeRangeEncode(customRange));\n  }\n  const {\n    sinceDatetime,\n    sinceMode,\n    sinceGrain,\n    sinceGrainValue,\n    untilDatetime,\n    untilMode,\n    untilGrain,\n    untilGrainValue,\n    anchorValue,\n    anchorMode,\n  } = { ...customRange };\n\n  function onChange(control: CustomRangeKey, value: string) {\n    props.onChange(\n      customTimeRangeEncode({\n        ...customRange,\n        [control]: value,\n      }),\n    );\n  }\n\n  function onGrainValue(\n    control: 'sinceGrainValue' | 'untilGrainValue',\n    value: string | number,\n  ) {\n    // only positive values in grainValue controls\n    if (isInteger(value) && value > 0) {\n      props.onChange(\n        customTimeRangeEncode({\n          ...customRange,\n          [control]: value,\n        }),\n      );\n    }\n  }\n\n  function onAnchorMode(option: any) {\n    const radioValue = option.target.value;\n    if (radioValue === 'now') {\n      props.onChange(\n        customTimeRangeEncode({\n          ...customRange,\n          anchorValue: 'now',\n          anchorMode: radioValue,\n        }),\n      );\n    } else {\n      props.onChange(\n        customTimeRangeEncode({\n          ...customRange,\n          anchorValue: MIDNIGHT,\n          anchorMode: radioValue,\n        }),\n      );\n    }\n  }\n\n  return (\n    <div data-test=\"custom-frame\">\n      <div className=\"section-title\">{t('Configure custom time range')}</div>\n      <Row gutter={24}>\n        <Col span={12}>\n          <div className=\"control-label\">\n            {t('START (INCLUSIVE)')}{' '}\n            <InfoTooltipWithTrigger\n              tooltip={t('Start date included in time range')}\n              placement=\"right\"\n            />\n          </div>\n          <Select\n            ariaLabel={t('START (INCLUSIVE)')}\n            options={SINCE_MODE_OPTIONS}\n            value={sinceMode}\n            onChange={(value: string) => onChange('sinceMode', value)}\n          />\n          {sinceMode === 'specific' && (\n            <Row>\n              <DatePicker\n                showTime\n                defaultValue={dttmToMoment(sinceDatetime)}\n                onChange={(datetime: Moment) =>\n                  onChange('sinceDatetime', datetime.format(MOMENT_FORMAT))\n                }\n                allowClear={false}\n              />\n            </Row>\n          )}\n          {sinceMode === 'relative' && (\n            <Row gutter={8}>\n              <Col span={11}>\n                {/* Make sure sinceGrainValue looks like a positive integer */}\n                <InputNumber\n                  placeholder={t('Relative quantity')}\n                  value={Math.abs(sinceGrainValue)}\n                  min={1}\n                  defaultValue={1}\n                  onChange={value =>\n                    onGrainValue('sinceGrainValue', value || 1)\n                  }\n                  onStep={value => onGrainValue('sinceGrainValue', value || 1)}\n                />\n              </Col>\n              <Col span={13}>\n                <Select\n                  ariaLabel={t('Relative period')}\n                  options={SINCE_GRAIN_OPTIONS}\n                  value={sinceGrain}\n                  onChange={(value: string) => onChange('sinceGrain', value)}\n                />\n              </Col>\n            </Row>\n          )}\n        </Col>\n        <Col span={12}>\n          <div className=\"control-label\">\n            {t('END (EXCLUSIVE)')}{' '}\n            <InfoTooltipWithTrigger\n              tooltip={t('End date excluded from time range')}\n              placement=\"right\"\n            />\n          </div>\n          <Select\n            ariaLabel={t('END (EXCLUSIVE)')}\n            options={UNTIL_MODE_OPTIONS}\n            value={untilMode}\n            onChange={(value: string) => onChange('untilMode', value)}\n          />\n          {untilMode === 'specific' && (\n            <Row>\n              <DatePicker\n                showTime\n                defaultValue={dttmToMoment(untilDatetime)}\n                onChange={(datetime: Moment) =>\n                  onChange('untilDatetime', datetime.format(MOMENT_FORMAT))\n                }\n                allowClear={false}\n              />\n            </Row>\n          )}\n          {untilMode === 'relative' && (\n            <Row gutter={8}>\n              <Col span={11}>\n                <InputNumber\n                  placeholder={t('Relative quantity')}\n                  value={untilGrainValue}\n                  min={1}\n                  defaultValue={1}\n                  onChange={value =>\n                    onGrainValue('untilGrainValue', value || 1)\n                  }\n                  onStep={value => onGrainValue('untilGrainValue', value || 1)}\n                />\n              </Col>\n              <Col span={13}>\n                <Select\n                  ariaLabel={t('Relative period')}\n                  options={UNTIL_GRAIN_OPTIONS}\n                  value={untilGrain}\n                  onChange={(value: string) => onChange('untilGrain', value)}\n                />\n              </Col>\n            </Row>\n          )}\n        </Col>\n      </Row>\n      {sinceMode === 'relative' && untilMode === 'relative' && (\n        <div className=\"control-anchor-to\">\n          <div className=\"control-label\">{t('Anchor to')}</div>\n          <Row align=\"middle\">\n            <Col>\n              <Radio.Group\n                onChange={onAnchorMode}\n                defaultValue=\"now\"\n                value={anchorMode}\n              >\n                <Radio key=\"now\" value=\"now\">\n                  {t('NOW')}\n                </Radio>\n                <Radio key=\"specific\" value=\"specific\">\n                  {t('Date/Time')}\n                </Radio>\n              </Radio.Group>\n            </Col>\n            {anchorMode !== 'now' && (\n              <Col>\n                <DatePicker\n                  showTime\n                  defaultValue={dttmToMoment(anchorValue)}\n                  onChange={(datetime: Moment) =>\n                    onChange('anchorValue', datetime.format(MOMENT_FORMAT))\n                  }\n                  allowClear={false}\n                  className=\"control-anchor-to-datetime\"\n                />\n              </Col>\n            )}\n          </Row>\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { useTheme, t } from '@superset-ui/core';\n\nimport { Tooltip } from 'src/components/Tooltip';\nimport { ClassNames } from '@emotion/react';\n\nconst TIME_PICKER_HELPER = (\n  <>\n    <div>\n      <h3>DATETIME</h3>\n      <p>{t('Return to specific datetime.')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>datetime([string])</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`datetime(\"2020-03-01 12:00:00\")\ndatetime(\"now\")\ndatetime(\"last year\")`}</code>\n      </pre>\n    </div>\n    <div>\n      <h3>DATEADD</h3>\n      <p>{t('Moves the given set of dates by a specified interval.')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`dateadd([datetime], [integer], [dateunit])\ndateunit = (year | quarter | month | week | day | hour | minute | second)`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`dateadd(datetime(\"today\"), -13, day)\ndateadd(datetime(\"2020-03-01\"), 2, day)`}</code>\n      </pre>\n    </div>\n    <div>\n      <h3>DATETRUNC</h3>\n      <p>\n        {t(\n          'Truncates the specified date to the accuracy specified by the date unit.',\n        )}\n      </p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`datetrunc([datetime], [dateunit])\ndateunit = (year | quarter | month | week)`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`datetrunc(datetime(\"2020-03-01\"), week)\ndatetrunc(datetime(\"2020-03-01\"), month)`}</code>\n      </pre>\n    </div>\n    <div>\n      <h3>LASTDAY</h3>\n      <p>{t('Get the last date by the date unit.')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`lastday([datetime], [dateunit])\ndateunit = (year | month | week)`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>lastday(datetime(\"today\"), month)</code>\n      </pre>\n    </div>\n    <div>\n      <h3>HOLIDAY</h3>\n      <p>{t('Get the specify date for the holiday')}</p>\n      <h4>{t('Syntax')}</h4>\n      <pre>\n        <code>{`holiday([string])\nholiday([holiday string], [datetime])\nholiday([holiday string], [datetime], [country name])`}</code>\n      </pre>\n      <h4>{t('Example')}</h4>\n      <pre>\n        <code>{`holiday(\"new year\")\nholiday(\"christmas\", datetime(\"2019\"))\nholiday(\"christmas\", dateadd(datetime(\"2019\"), 1, year))\nholiday(\"christmas\", datetime(\"2 years ago\"))\nholiday(\"Easter Monday\", datetime(\"2019\"), \"UK\")`}</code>\n      </pre>\n    </div>\n  </>\n);\n\nconst StyledTooltip = (props: any) => {\n  const theme = useTheme();\n  return (\n    <ClassNames>\n      {({ css }) => (\n        <Tooltip\n          overlayClassName={css`\n            .ant-tooltip-content {\n              min-width: ${theme.gridUnit * 125}px;\n              max-height: 410px;\n              overflow-y: scroll;\n\n              .ant-tooltip-inner {\n                max-width: ${theme.gridUnit * 125}px;\n                h3 {\n                  font-size: ${theme.typography.sizes.m}px;\n                  font-weight: ${theme.typography.weights.bold};\n                }\n                h4 {\n                  font-size: ${theme.typography.sizes.m}px;\n                  font-weight: ${theme.typography.weights.bold};\n                }\n                pre {\n                  border: none;\n                  text-align: left;\n                  word-break: break-word;\n                  font-size: ${theme.typography.sizes.s}px;\n                }\n              }\n            }\n          `}\n          {...props}\n        />\n      )}\n    </ClassNames>\n  );\n};\n\nexport default function DateFunctionTooltip(props: any) {\n  return <StyledTooltip title={TIME_PICKER_HELPER} {...props} />;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { SEPARATOR } from 'src/explore/components/controls/DateFilterControl/utils';\nimport { Input } from 'src/components/Input';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { FrameComponentProps } from 'src/explore/components/controls/DateFilterControl/types';\nimport DateFunctionTooltip from './DateFunctionTooltip';\n\nexport function AdvancedFrame(props: FrameComponentProps) {\n  function getAdvancedRange(value: string): string {\n    if (value.includes(SEPARATOR)) {\n      return value;\n    }\n    if (value.startsWith('Last')) {\n      return [value, ''].join(SEPARATOR);\n    }\n    if (value.startsWith('Next')) {\n      return ['', value].join(SEPARATOR);\n    }\n    return SEPARATOR;\n  }\n\n  const advancedRange = getAdvancedRange(props.value || '');\n  const [since, until] = advancedRange.split(SEPARATOR);\n  if (advancedRange !== props.value) {\n    props.onChange(getAdvancedRange(props.value || ''));\n  }\n\n  function onChange(control: 'since' | 'until', value: string) {\n    if (control === 'since') {\n      props.onChange(`${value}${SEPARATOR}${until}`);\n    } else {\n      props.onChange(`${since}${SEPARATOR}${value}`);\n    }\n  }\n\n  return (\n    <>\n      <div className=\"section-title\">\n        {t('Configure Advanced Time Range ')}\n        <DateFunctionTooltip placement=\"rightBottom\">\n          <i className=\"fa fa-info-circle text-muted\" />\n        </DateFunctionTooltip>\n      </div>\n      <div className=\"control-label\">\n        {t('START (INCLUSIVE)')}{' '}\n        <InfoTooltipWithTrigger\n          tooltip={t('Start date included in time range')}\n          placement=\"right\"\n        />\n      </div>\n      <Input\n        key=\"since\"\n        value={since}\n        onChange={e => onChange('since', e.target.value)}\n      />\n      <div className=\"control-label\">\n        {t('END (EXCLUSIVE)')}{' '}\n        <InfoTooltipWithTrigger\n          tooltip={t('End date excluded from time range')}\n          placement=\"right\"\n        />\n      </div>\n      <Input\n        key=\"until\"\n        value={until}\n        onChange={e => onChange('until', e.target.value)}\n      />\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useMemo } from 'react';\nimport rison from 'rison';\nimport { css, SupersetClient, styled, t, useTheme } from '@superset-ui/core';\nimport {\n  buildTimeRangeString,\n  formatTimeRange,\n  COMMON_RANGE_VALUES_SET,\n  CALENDAR_RANGE_VALUES_SET,\n  FRAME_OPTIONS,\n  customTimeRangeDecode,\n} from 'src/explore/components/controls/DateFilterControl/utils';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport Button from 'src/components/Button';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport Label, { Type } from 'src/components/Label';\nimport { Divider } from 'src/components';\nimport Icons from 'src/components/Icons';\nimport Select from 'src/components/Select/Select';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { DEFAULT_TIME_RANGE } from 'src/explore/constants';\nimport { useDebouncedEffect } from 'src/explore/exploreUtils';\nimport { SLOW_DEBOUNCE } from 'src/constants';\nimport { testWithId } from 'src/utils/testUtils';\nimport { noOp } from 'src/utils/common';\nimport { FrameType } from './types';\nimport ControlPopover from '../ControlPopover/ControlPopover';\n\nimport {\n  CommonFrame,\n  CalendarFrame,\n  CustomFrame,\n  AdvancedFrame,\n} from './components';\n\nconst guessFrame = (timeRange: string): FrameType => {\n  if (COMMON_RANGE_VALUES_SET.has(timeRange)) {\n    return 'Common';\n  }\n  if (CALENDAR_RANGE_VALUES_SET.has(timeRange)) {\n    return 'Calendar';\n  }\n  if (timeRange === 'No filter') {\n    return 'No filter';\n  }\n  if (customTimeRangeDecode(timeRange).matchedFlag) {\n    return 'Custom';\n  }\n  return 'Advanced';\n};\n\nconst fetchTimeRange = async (timeRange: string) => {\n  const query = rison.encode_uri(timeRange);\n  const endpoint = `/api/v1/time_range/?q=${query}`;\n  try {\n    const response = await SupersetClient.get({ endpoint });\n    const timeRangeString = buildTimeRangeString(\n      response?.json?.result?.since || '',\n      response?.json?.result?.until || '',\n    );\n    return {\n      value: formatTimeRange(timeRangeString),\n    };\n  } catch (response) {\n    const clientError = await getClientErrorObject(response);\n    return {\n      error: clientError.message || clientError.error,\n    };\n  }\n};\n\nconst StyledPopover = styled(ControlPopover)``;\nconst StyledRangeType = styled(Select)`\n  width: 272px;\n`;\n\nconst ContentStyleWrapper = styled.div`\n  ${({ theme }) => css`\n    .ant-row {\n      margin-top: 8px;\n    }\n\n    .ant-input-number {\n      width: 100%;\n    }\n\n    .ant-picker {\n      padding: 4px 17px 4px;\n      border-radius: 4px;\n      width: 100%;\n    }\n\n    .ant-divider-horizontal {\n      margin: 16px 0;\n    }\n\n    .control-label {\n      font-size: 11px;\n      font-weight: ${theme.typography.weights.medium};\n      color: ${theme.colors.grayscale.light2};\n      line-height: 16px;\n      text-transform: uppercase;\n      margin: 8px 0;\n    }\n\n    .vertical-radio {\n      display: block;\n      height: 40px;\n      line-height: 40px;\n    }\n\n    .section-title {\n      font-style: normal;\n      font-weight: ${theme.typography.weights.bold};\n      font-size: 15px;\n      line-height: 24px;\n      margin-bottom: 8px;\n    }\n\n    .control-anchor-to {\n      margin-top: 16px;\n    }\n\n    .control-anchor-to-datetime {\n      width: 217px;\n    }\n\n    .footer {\n      text-align: right;\n    }\n  `}\n`;\n\nconst IconWrapper = styled.span`\n  span {\n    margin-right: ${({ theme }) => 2 * theme.gridUnit}px;\n    vertical-align: middle;\n  }\n  .text {\n    vertical-align: middle;\n  }\n  .error {\n    color: ${({ theme }) => theme.colors.error.base};\n  }\n`;\n\ninterface DateFilterControlProps {\n  name: string;\n  onChange: (timeRange: string) => void;\n  value?: string;\n  type?: Type;\n  onOpenPopover?: () => void;\n  onClosePopover?: () => void;\n}\n\nexport const DATE_FILTER_CONTROL_TEST_ID = 'date-filter-control';\nexport const getDateFilterControlTestId = testWithId(\n  DATE_FILTER_CONTROL_TEST_ID,\n);\n\nexport default function DateFilterLabel(props: DateFilterControlProps) {\n  const {\n    value = DEFAULT_TIME_RANGE,\n    onChange,\n    type,\n    onOpenPopover = noOp,\n    onClosePopover = noOp,\n  } = props;\n  const [actualTimeRange, setActualTimeRange] = useState<string>(value);\n\n  const [show, setShow] = useState<boolean>(false);\n  const guessedFrame = useMemo(() => guessFrame(value), [value]);\n  const [frame, setFrame] = useState<FrameType>(guessedFrame);\n  const [lastFetchedTimeRange, setLastFetchedTimeRange] = useState(value);\n  const [timeRangeValue, setTimeRangeValue] = useState(value);\n  const [validTimeRange, setValidTimeRange] = useState<boolean>(false);\n  const [evalResponse, setEvalResponse] = useState<string>(value);\n  const [tooltipTitle, setTooltipTitle] = useState<string>(value);\n\n  useEffect(() => {\n    fetchTimeRange(value).then(({ value: actualRange, error }) => {\n      if (error) {\n        setEvalResponse(error || '');\n        setValidTimeRange(false);\n        setTooltipTitle(value || '');\n      } else {\n        /*\n          HRT == human readable text\n          ADR == actual datetime range\n          +--------------+------+----------+--------+----------+-----------+\n          |              | Last | Previous | Custom | Advanced | No Filter |\n          +--------------+------+----------+--------+----------+-----------+\n          | control pill | HRT  | HRT      | ADR    | ADR      |   HRT     |\n          +--------------+------+----------+--------+----------+-----------+\n          | tooltip      | ADR  | ADR      | HRT    | HRT      |   ADR     |\n          +--------------+------+----------+--------+----------+-----------+\n        */\n        if (\n          guessedFrame === 'Common' ||\n          guessedFrame === 'Calendar' ||\n          guessedFrame === 'No filter'\n        ) {\n          setActualTimeRange(value);\n          setTooltipTitle(\n            type === ('error' as Type)\n              ? t('Default value is required')\n              : actualRange || '',\n          );\n        } else {\n          setActualTimeRange(actualRange || '');\n          setTooltipTitle(value || '');\n        }\n        setValidTimeRange(true);\n      }\n      setLastFetchedTimeRange(value);\n    });\n  }, [value]);\n\n  useDebouncedEffect(\n    () => {\n      if (lastFetchedTimeRange !== timeRangeValue) {\n        fetchTimeRange(timeRangeValue).then(({ value: actualRange, error }) => {\n          if (error) {\n            setEvalResponse(error || '');\n            setValidTimeRange(false);\n          } else {\n            setEvalResponse(actualRange || '');\n            setValidTimeRange(true);\n          }\n          setLastFetchedTimeRange(timeRangeValue);\n        });\n      }\n    },\n    SLOW_DEBOUNCE,\n    [timeRangeValue],\n  );\n\n  function onSave() {\n    onChange(timeRangeValue);\n    setShow(false);\n  }\n\n  function onOpen() {\n    setTimeRangeValue(value);\n    setFrame(guessedFrame);\n    setShow(true);\n  }\n\n  function onHide() {\n    setTimeRangeValue(value);\n    setFrame(guessedFrame);\n    setShow(false);\n  }\n\n  const togglePopover = () => {\n    if (show) {\n      onHide();\n      onClosePopover();\n    } else {\n      onOpen();\n      onOpenPopover();\n    }\n  };\n\n  function onChangeFrame(value: string) {\n    if (value === 'No filter') {\n      setTimeRangeValue('No filter');\n    }\n    setFrame(value as FrameType);\n  }\n\n  const theme = useTheme();\n\n  const overlayContent = (\n    <ContentStyleWrapper>\n      <div className=\"control-label\">{t('RANGE TYPE')}</div>\n      <StyledRangeType\n        ariaLabel={t('RANGE TYPE')}\n        options={FRAME_OPTIONS}\n        value={frame}\n        onChange={onChangeFrame}\n      />\n      {frame !== 'No filter' && <Divider />}\n      {frame === 'Common' && (\n        <CommonFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Calendar' && (\n        <CalendarFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Advanced' && (\n        <AdvancedFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'Custom' && (\n        <CustomFrame value={timeRangeValue} onChange={setTimeRangeValue} />\n      )}\n      {frame === 'No filter' && <div data-test=\"no-filter\" />}\n      <Divider />\n      <div>\n        <div className=\"section-title\">{t('Actual time range')}</div>\n        {validTimeRange && <div>{evalResponse}</div>}\n        {!validTimeRange && (\n          <IconWrapper className=\"warning\">\n            <Icons.ErrorSolidSmall iconColor={theme.colors.error.base} />\n            <span className=\"text error\">{evalResponse}</span>\n          </IconWrapper>\n        )}\n      </div>\n      <Divider />\n      <div className=\"footer\">\n        <Button\n          buttonStyle=\"secondary\"\n          cta\n          key=\"cancel\"\n          onClick={onHide}\n          data-test=\"cancel-button\"\n        >\n          {t('CANCEL')}\n        </Button>\n        <Button\n          buttonStyle=\"primary\"\n          cta\n          disabled={!validTimeRange}\n          key=\"apply\"\n          onClick={onSave}\n          {...getDateFilterControlTestId('apply-button')}\n        >\n          {t('APPLY')}\n        </Button>\n      </div>\n    </ContentStyleWrapper>\n  );\n\n  const title = (\n    <IconWrapper>\n      <Icons.EditAlt iconColor={theme.colors.grayscale.base} />\n      <span className=\"text\">{t('Edit time range')}</span>\n    </IconWrapper>\n  );\n\n  const overlayStyle = {\n    width: '600px',\n  };\n\n  return (\n    <>\n      <ControlHeader {...props} />\n      <StyledPopover\n        placement=\"right\"\n        trigger=\"click\"\n        content={overlayContent}\n        title={title}\n        defaultVisible={show}\n        visible={show}\n        onVisibleChange={togglePopover}\n        overlayStyle={overlayStyle}\n      >\n        <Tooltip placement=\"top\" title={tooltipTitle}>\n          <Label className=\"pointer\" data-test=\"time-range-trigger\">\n            {actualTimeRange}\n          </Label>\n        </Tooltip>\n      </StyledPopover>\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useCallback, useState } from 'react';\nimport { ensureIsArray, SupersetClient, t } from '@superset-ui/core';\nimport { debounce } from 'lodash';\nimport rison from 'rison';\nimport { AdvancedDataTypesState, Props } from './index';\n\nconst INITIAL_ADVANCED_DATA_TYPES_STATE: AdvancedDataTypesState = {\n  parsedAdvancedDataType: '',\n  advancedDataTypeOperatorList: [],\n  errorMessage: '',\n};\n\nconst useAdvancedDataTypes = (validHandler: (isValid: boolean) => void) => {\n  const [advancedDataTypesState, setAdvancedDataTypesState] =\n    useState<AdvancedDataTypesState>(INITIAL_ADVANCED_DATA_TYPES_STATE);\n  const [subjectAdvancedDataType, setSubjectAdvancedDataType] = useState<\n    string | undefined\n  >();\n\n  const fetchAdvancedDataTypeValueCallback = useCallback(\n    (\n      comp: string | string[],\n      advancedDataTypesState: AdvancedDataTypesState,\n      subjectAdvancedDataType?: string,\n    ) => {\n      const values = ensureIsArray(comp);\n      if (!subjectAdvancedDataType) {\n        setAdvancedDataTypesState(INITIAL_ADVANCED_DATA_TYPES_STATE);\n        return;\n      }\n      debounce(() => {\n        const queryParams = rison.encode({\n          type: subjectAdvancedDataType,\n          values,\n        });\n        const endpoint = `/api/v1/advanced_data_type/convert?q=${queryParams}`;\n        SupersetClient.get({ endpoint })\n          .then(({ json }) => {\n            setAdvancedDataTypesState({\n              parsedAdvancedDataType: json.result.display_value,\n              advancedDataTypeOperatorList: json.result.valid_filter_operators,\n              errorMessage: json.result.error_message,\n            });\n            // Changed due to removal of status field\n            validHandler(!json.result.error_message);\n          })\n          .catch(() => {\n            setAdvancedDataTypesState({\n              parsedAdvancedDataType: '',\n              advancedDataTypeOperatorList:\n                advancedDataTypesState.advancedDataTypeOperatorList,\n              errorMessage: t('Failed to retrieve advanced type'),\n            });\n            validHandler(false);\n          });\n      }, 600)();\n    },\n    [validHandler],\n  );\n\n  const fetchSubjectAdvancedDataType = (props: Props) => {\n    const option = props.options.find(\n      option =>\n        ('column_name' in option &&\n          option.column_name === props.adhocFilter.subject) ||\n        ('optionName' in option &&\n          option.optionName === props.adhocFilter.subject),\n    );\n    if (option && 'advanced_data_type' in option) {\n      setSubjectAdvancedDataType(option.advanced_data_type);\n    } else {\n      props.validHandler(true);\n    }\n  };\n\n  return {\n    advancedDataTypesState,\n    subjectAdvancedDataType,\n    setAdvancedDataTypesState,\n    fetchAdvancedDataTypeValueCallback,\n    fetchSubjectAdvancedDataType,\n  };\n};\n\nexport default useAdvancedDataTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport FormItem from 'src/components/Form/FormItem';\nimport { Select } from 'src/components';\nimport { t, SupersetClient, SupersetTheme, styled } from '@superset-ui/core';\nimport {\n  Operators,\n  OPERATORS_OPTIONS,\n  TABLE_ONLY_OPERATORS,\n  DRUID_ONLY_OPERATORS,\n  HAVING_OPERATORS,\n  MULTI_OPERATORS,\n  CUSTOM_OPERATORS,\n  DISABLE_INPUT_OPERATORS,\n  AGGREGATES,\n  OPERATOR_ENUM_TO_OPERATOR_TYPE,\n} from 'src/explore/constants';\nimport FilterDefinitionOption from 'src/explore/components/controls/MetricControl/FilterDefinitionOption';\nimport AdhocFilter, {\n  EXPRESSION_TYPES,\n  CLAUSES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { Input } from 'src/components/Input';\nimport { optionLabel } from 'src/utils/common';\nimport { FeatureFlag, isFeatureEnabled } from 'src/featureFlags';\nimport useAdvancedDataTypes from './useAdvancedDataTypes';\n\nconst StyledInput = styled(Input)`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nexport const StyledFormItem = styled(FormItem)`\n  &.ant-row.ant-form-item {\n    margin: 0;\n  }\n`;\n\nconst SelectWithLabel = styled(Select)<{ labelText: string }>`\n  .ant-select-selector::after {\n    content: ${({ labelText }) => labelText || '\\\\A0'};\n    display: inline-block;\n    white-space: nowrap;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n    width: max-content;\n  }\n`;\n\nexport interface SimpleColumnType {\n  id: number;\n  column_name: string;\n  expression?: string;\n  type: string;\n  optionName?: string;\n  filterBy?: string;\n  value?: string;\n  advanced_data_type?: string;\n}\n\nexport interface SimpleExpressionType {\n  expressionType: keyof typeof EXPRESSION_TYPES;\n  column: SimpleColumnType;\n  aggregate: keyof typeof AGGREGATES;\n  label: string;\n}\nexport interface SQLExpressionType {\n  expressionType: keyof typeof EXPRESSION_TYPES;\n  sqlExpression: string;\n  label: string;\n}\n\nexport interface MetricColumnType {\n  saved_metric_name: string;\n}\n\nexport type ColumnType =\n  | SimpleColumnType\n  | SimpleExpressionType\n  | SQLExpressionType\n  | MetricColumnType;\n\nexport interface Props {\n  adhocFilter: AdhocFilter;\n  onChange: (filter: AdhocFilter) => void;\n  options: ColumnType[];\n  datasource: {\n    id: string;\n    columns: SimpleColumnType[];\n    type: string;\n    filter_select: boolean;\n  };\n  partitionColumn: string;\n  operators?: Operators[];\n  validHandler: (isValid: boolean) => void;\n}\n\nexport interface AdvancedDataTypesState {\n  parsedAdvancedDataType: string;\n  advancedDataTypeOperatorList: string[];\n  errorMessage: string;\n}\n\nexport const useSimpleTabFilterProps = (props: Props) => {\n  const isOperatorRelevant = (operator: Operators, subject: string) => {\n    const column = props.datasource.columns?.find(\n      col => col.column_name === subject,\n    );\n    const isColumnBoolean =\n      !!column && (column.type === 'BOOL' || column.type === 'BOOLEAN');\n    const isColumnNumber =\n      !!column && (column.type === 'INT' || column.type === 'INTEGER');\n    const isColumnFunction = !!column && !!column.expression;\n\n    if (operator && CUSTOM_OPERATORS.has(operator)) {\n      const { partitionColumn } = props;\n      return partitionColumn && subject && subject === partitionColumn;\n    }\n    if (operator === Operators.IS_TRUE || operator === Operators.IS_FALSE) {\n      return isColumnBoolean || isColumnNumber || isColumnFunction;\n    }\n    if (isColumnBoolean) {\n      return (\n        operator === Operators.IS_NULL || operator === Operators.IS_NOT_NULL\n      );\n    }\n    return !(\n      (props.datasource.type === 'druid' &&\n        TABLE_ONLY_OPERATORS.indexOf(operator) >= 0) ||\n      (props.datasource.type === 'table' &&\n        DRUID_ONLY_OPERATORS.indexOf(operator) >= 0) ||\n      (props.adhocFilter.clause === CLAUSES.HAVING &&\n        HAVING_OPERATORS.indexOf(operator) === -1)\n    );\n  };\n  const onSubjectChange = (id: string) => {\n    const option = props.options.find(\n      option =>\n        ('column_name' in option && option.column_name === id) ||\n        ('optionName' in option && option.optionName === id),\n    );\n    let subject = '';\n    let clause;\n    // infer the new clause based on what subject was selected.\n    if (option && 'column_name' in option) {\n      subject = option.column_name;\n      clause = CLAUSES.WHERE;\n    } else if (option && 'saved_metric_name' in option) {\n      subject = option.saved_metric_name;\n      clause = CLAUSES.HAVING;\n    } else if (option && option.label) {\n      subject = option.label;\n      clause = CLAUSES.HAVING;\n    }\n    const { operator, operatorId } = props.adhocFilter;\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        subject,\n        clause,\n        operator:\n          operator && operatorId && isOperatorRelevant(operatorId, subject)\n            ? OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation\n            : null,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n        operatorId,\n      }),\n    );\n  };\n  const onOperatorChange = (operatorId: Operators) => {\n    const currentComparator = props.adhocFilter.comparator;\n    let newComparator;\n    // convert between list of comparators and individual comparators\n    // (e.g. `in ('North America', 'Africa')` to `== 'North America'`)\n    if (MULTI_OPERATORS.has(operatorId)) {\n      newComparator = Array.isArray(currentComparator)\n        ? currentComparator\n        : [currentComparator].filter(element => element);\n    } else {\n      newComparator = Array.isArray(currentComparator)\n        ? currentComparator[0]\n        : currentComparator;\n    }\n    if (operatorId === Operators.IS_TRUE || operatorId === Operators.IS_FALSE) {\n      newComparator = Operators.IS_TRUE === operatorId;\n    }\n    if (operatorId && CUSTOM_OPERATORS.has(operatorId)) {\n      props.onChange(\n        props.adhocFilter.duplicateWith({\n          subject: props.adhocFilter.subject,\n          clause: CLAUSES.WHERE,\n          operatorId,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n          expressionType: EXPRESSION_TYPES.SQL,\n          datasource: props.datasource,\n        }),\n      );\n    } else {\n      props.onChange(\n        props.adhocFilter.duplicateWith({\n          operatorId,\n          operator: OPERATOR_ENUM_TO_OPERATOR_TYPE[operatorId].operation,\n          comparator: newComparator,\n          expressionType: EXPRESSION_TYPES.SIMPLE,\n        }),\n      );\n    }\n  };\n  const onComparatorChange = (comparator: string) => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        comparator,\n        expressionType: EXPRESSION_TYPES.SIMPLE,\n      }),\n    );\n  };\n  const clearOperator = (): void => {\n    props.onChange(\n      props.adhocFilter.duplicateWith({\n        operatorId: undefined,\n        operator: undefined,\n      }),\n    );\n  };\n  return {\n    onSubjectChange,\n    onOperatorChange,\n    onComparatorChange,\n    isOperatorRelevant,\n    clearOperator,\n  };\n};\n\nconst AdhocFilterEditPopoverSimpleTabContent: React.FC<Props> = props => {\n  const {\n    onSubjectChange,\n    onOperatorChange,\n    isOperatorRelevant,\n    onComparatorChange,\n  } = useSimpleTabFilterProps(props);\n  const [suggestions, setSuggestions] = useState<\n    Record<'label' | 'value', any>[]\n  >([]);\n  const [comparator, setComparator] = useState(props.adhocFilter.comparator);\n  const [loadingComparatorSuggestions, setLoadingComparatorSuggestions] =\n    useState(false);\n\n  const {\n    advancedDataTypesState,\n    subjectAdvancedDataType,\n    fetchAdvancedDataTypeValueCallback,\n    fetchSubjectAdvancedDataType,\n  } = useAdvancedDataTypes(props.validHandler);\n  // TODO: This does not need to exist, just use the advancedTypeOperatorList list\n  const isOperatorRelevantWrapper = (operator: Operators, subject: string) =>\n    subjectAdvancedDataType\n      ? isOperatorRelevant(operator, subject) &&\n        advancedDataTypesState.advancedDataTypeOperatorList.includes(operator)\n      : isOperatorRelevant(operator, subject);\n  const onInputComparatorChange = (\n    event: React.ChangeEvent<HTMLInputElement>,\n  ) => {\n    const { value } = event.target;\n    setComparator(value);\n    onComparatorChange(value);\n  };\n\n  const renderSubjectOptionLabel = (option: ColumnType) => (\n    <FilterDefinitionOption option={option} />\n  );\n\n  const getOptionsRemaining = () => {\n    // if select is multi/value is array, we show the options not selected\n    const valuesFromSuggestionsLength = Array.isArray(comparator)\n      ? comparator.filter(v => suggestions.includes(v)).length\n      : 0;\n    return suggestions?.length - valuesFromSuggestionsLength ?? 0;\n  };\n  const createSuggestionsPlaceholder = () => {\n    const optionsRemaining = getOptionsRemaining();\n    const placeholder = t('%s option(s)', optionsRemaining);\n    return optionsRemaining ? placeholder : '';\n  };\n\n  const handleSubjectChange = (subject: string) => {\n    setComparator(undefined);\n    onSubjectChange(subject);\n  };\n\n  let columns = props.options;\n  const { subject, operator, operatorId } = props.adhocFilter;\n\n  const subjectSelectProps = {\n    ariaLabel: t('Select subject'),\n    value: subject ?? undefined,\n    onChange: handleSubjectChange,\n    notFoundContent: t(\n      'No such column found. To filter on a metric, try the Custom SQL tab.',\n    ),\n    autoFocus: !subject,\n    placeholder: '',\n  };\n\n  if (props.datasource.type === 'druid') {\n    subjectSelectProps.placeholder = t(\n      '%s column(s) and metric(s)',\n      columns.length,\n    );\n  } else {\n    // we cannot support simple ad-hoc filters for metrics because we don't know what type\n    // the value should be cast to (without knowing the output type of the aggregate, which\n    // becomes a rather complicated problem)\n    subjectSelectProps.placeholder =\n      props.adhocFilter.clause === CLAUSES.WHERE\n        ? t('%s column(s)', columns.length)\n        : t('To filter on a metric, use Custom SQL tab.');\n    columns = props.options.filter(\n      option => 'column_name' in option && option.column_name,\n    );\n  }\n\n  const operatorSelectProps = {\n    placeholder: t(\n      '%s operator(s)',\n      (props.operators ?? OPERATORS_OPTIONS).filter(op =>\n        isOperatorRelevantWrapper(op, subject),\n      ).length,\n    ),\n    value: operatorId,\n    onChange: onOperatorChange,\n    autoFocus: !!subjectSelectProps.value && !operator,\n    ariaLabel: t('Select operator'),\n  };\n\n  const shouldFocusComparator =\n    !!subjectSelectProps.value && !!operatorSelectProps.value;\n\n  const comparatorSelectProps = {\n    allowClear: true,\n    allowNewOptions: true,\n    ariaLabel: t('Comparator option'),\n    mode: MULTI_OPERATORS.has(operatorId)\n      ? ('multiple' as const)\n      : ('single' as const),\n    loading: loadingComparatorSuggestions,\n    value: comparator,\n    onChange: onComparatorChange,\n    notFoundContent: t('Type a value here'),\n    disabled: DISABLE_INPUT_OPERATORS.includes(operatorId),\n    placeholder: createSuggestionsPlaceholder(),\n    autoFocus: shouldFocusComparator,\n  };\n\n  const labelText =\n    comparator && comparator.length > 0 && createSuggestionsPlaceholder();\n\n  useEffect(() => {\n    const refreshComparatorSuggestions = () => {\n      const { datasource } = props;\n      const col = props.adhocFilter.subject;\n      const having = props.adhocFilter.clause === CLAUSES.HAVING;\n\n      if (col && datasource && datasource.filter_select && !having) {\n        const controller = new AbortController();\n        const { signal } = controller;\n        if (loadingComparatorSuggestions) {\n          controller.abort();\n        }\n        setLoadingComparatorSuggestions(true);\n        SupersetClient.get({\n          signal,\n          endpoint: `/superset/filter/${datasource.type}/${datasource.id}/${col}/`,\n        })\n          .then(({ json }) => {\n            setSuggestions(\n              json.map((suggestion: null | number | boolean | string) => ({\n                value: suggestion,\n                label: optionLabel(suggestion),\n              })),\n            );\n            setLoadingComparatorSuggestions(false);\n          })\n          .catch(() => {\n            setSuggestions([]);\n            setLoadingComparatorSuggestions(false);\n          });\n      }\n    };\n    refreshComparatorSuggestions();\n  }, [props.adhocFilter.subject]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.ENABLE_ADVANCED_DATA_TYPES)) {\n      fetchSubjectAdvancedDataType(props);\n    }\n  }, [props.adhocFilter.subject]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.ENABLE_ADVANCED_DATA_TYPES)) {\n      fetchAdvancedDataTypeValueCallback(\n        comparator === undefined ? '' : comparator,\n        advancedDataTypesState,\n        subjectAdvancedDataType,\n      );\n    }\n  }, [comparator, subjectAdvancedDataType, fetchAdvancedDataTypeValueCallback]);\n\n  useEffect(() => {\n    if (isFeatureEnabled(FeatureFlag.ENABLE_ADVANCED_DATA_TYPES)) {\n      setComparator(props.adhocFilter.comparator);\n    }\n  }, [props.adhocFilter.comparator]);\n\n  return (\n    <>\n      <Select\n        css={(theme: SupersetTheme) => ({\n          marginTop: theme.gridUnit * 4,\n          marginBottom: theme.gridUnit * 4,\n        })}\n        data-test=\"select-element\"\n        options={columns.map(column => ({\n          value:\n            ('column_name' in column && column.column_name) ||\n            ('optionName' in column && column.optionName) ||\n            '',\n          label:\n            ('saved_metric_name' in column && column.saved_metric_name) ||\n            ('column_name' in column && column.column_name) ||\n            ('label' in column && column.label),\n          key:\n            ('id' in column && column.id) ||\n            ('optionName' in column && column.optionName) ||\n            undefined,\n          customLabel: renderSubjectOptionLabel(column),\n        }))}\n        {...subjectSelectProps}\n      />\n      <Select\n        css={(theme: SupersetTheme) => ({ marginBottom: theme.gridUnit * 4 })}\n        options={(props.operators ?? OPERATORS_OPTIONS)\n          .filter(op => isOperatorRelevantWrapper(op, subject))\n          .map((option, index) => ({\n            value: option,\n            label: OPERATOR_ENUM_TO_OPERATOR_TYPE[option].display,\n            key: option,\n            order: index,\n          }))}\n        {...operatorSelectProps}\n      />\n      {MULTI_OPERATORS.has(operatorId) || suggestions.length > 0 ? (\n        <Tooltip\n          title={\n            advancedDataTypesState.errorMessage ||\n            advancedDataTypesState.parsedAdvancedDataType\n          }\n        >\n          <SelectWithLabel\n            labelText={labelText}\n            options={suggestions}\n            {...comparatorSelectProps}\n          />\n        </Tooltip>\n      ) : (\n        <Tooltip\n          title={\n            advancedDataTypesState.errorMessage ||\n            advancedDataTypesState.parsedAdvancedDataType\n          }\n        >\n          <StyledInput\n            data-test=\"adhoc-filter-simple-value\"\n            name=\"filter-value\"\n            ref={ref => {\n              if (ref && shouldFocusComparator) {\n                ref.focus();\n              }\n            }}\n            onChange={onInputComparatorChange}\n            value={comparator}\n            placeholder={t('Filter value (case sensitive)')}\n            disabled={DISABLE_INPUT_OPERATORS.includes(operatorId)}\n          />\n        </Tooltip>\n      )}\n    </>\n  );\n};\n\nexport default AdhocFilterEditPopoverSimpleTabContent;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { Select } from 'src/components';\nimport { styled, t } from '@superset-ui/core';\nimport { SQLEditor } from 'src/components/AsyncAceEditor';\nimport sqlKeywords from 'src/SqlLab/utils/sqlKeywords';\n\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport AdhocFilter, {\n  EXPRESSION_TYPES,\n  CLAUSES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  height: PropTypes.number.isRequired,\n  activeKey: PropTypes.string.isRequired,\n};\n\nconst StyledSelect = styled(Select)`\n  ${({ theme }) => `\n    width: ${theme.gridUnit * 30}px;\n    marginRight: ${theme.gridUnit}px;\n  `}\n`;\n\nexport default class AdhocFilterEditPopoverSqlTabContent extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSqlExpressionChange = this.onSqlExpressionChange.bind(this);\n    this.onSqlExpressionClauseChange =\n      this.onSqlExpressionClauseChange.bind(this);\n    this.handleAceEditorRef = this.handleAceEditorRef.bind(this);\n\n    this.selectProps = {\n      ariaLabel: t('Select column'),\n    };\n  }\n\n  componentDidUpdate() {\n    if (this.aceEditorRef) {\n      this.aceEditorRef.editor.resize();\n    }\n  }\n\n  onSqlExpressionClauseChange(clause) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        clause,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n    );\n  }\n\n  onSqlExpressionChange(sqlExpression) {\n    this.props.onChange(\n      this.props.adhocFilter.duplicateWith({\n        sqlExpression,\n        expressionType: EXPRESSION_TYPES.SQL,\n      }),\n    );\n  }\n\n  handleAceEditorRef(ref) {\n    if (ref) {\n      this.aceEditorRef = ref;\n    }\n  }\n\n  render() {\n    const { adhocFilter, height, options } = this.props;\n\n    const clauseSelectProps = {\n      placeholder: t('choose WHERE or HAVING...'),\n      value: adhocFilter.clause,\n      onChange: this.onSqlExpressionClauseChange,\n    };\n    const keywords = sqlKeywords.concat(\n      options\n        .map(option => {\n          if (option.column_name) {\n            return {\n              name: option.column_name,\n              value: option.column_name,\n              score: 50,\n              meta: 'option',\n            };\n          }\n          return null;\n        })\n        .filter(Boolean),\n    );\n    const selectOptions = Object.keys(CLAUSES).map(clause => ({\n      label: clause,\n      value: clause,\n    }));\n\n    return (\n      <span>\n        <div className=\"filter-edit-clause-section\">\n          <StyledSelect\n            options={selectOptions}\n            {...this.selectProps}\n            {...clauseSelectProps}\n          />\n          <span className=\"filter-edit-clause-info\">\n            <strong>WHERE</strong> {t('Filters by columns')}\n            <br />\n            <strong>HAVING</strong> {t('Filters by metrics')}\n          </span>\n        </div>\n        <div css={theme => ({ marginTop: theme.gridUnit * 4 })}>\n          <SQLEditor\n            ref={this.handleAceEditorRef}\n            keywords={keywords}\n            height={`${height - 130}px`}\n            onChange={this.onSqlExpressionChange}\n            width=\"100%\"\n            showGutter={false}\n            value={adhocFilter.sqlExpression || adhocFilter.translateToSql()}\n            editorProps={{ $blockScrolling: true }}\n            enableLiveAutocompletion\n            className=\"filter-sql-editor\"\n            wrapEnabled\n          />\n        </div>\n      </span>\n    );\n  }\n}\nAdhocFilterEditPopoverSqlTabContent.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport Button from 'src/components/Button';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { styled, t } from '@superset-ui/core';\n\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport Tabs from 'src/components/Tabs';\nimport adhocMetricType from 'src/explore/components/controls/MetricControl/adhocMetricType';\nimport AdhocFilter, {\n  EXPRESSION_TYPES,\n} from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport AdhocFilterEditPopoverSimpleTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSimpleTabContent';\nimport AdhocFilterEditPopoverSqlTabContent from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopoverSqlTabContent';\nimport columnType from 'src/explore/components/controls/FilterControl/columnType';\nimport {\n  POPOVER_INITIAL_HEIGHT,\n  POPOVER_INITIAL_WIDTH,\n} from 'src/explore/constants';\n\nconst propTypes = {\n  adhocFilter: PropTypes.instanceOf(AdhocFilter).isRequired,\n  onChange: PropTypes.func.isRequired,\n  onClose: PropTypes.func.isRequired,\n  onResize: PropTypes.func.isRequired,\n  options: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      columnType,\n      PropTypes.shape({ saved_metric_name: PropTypes.string.isRequired }),\n      adhocMetricType,\n    ]),\n  ).isRequired,\n  datasource: PropTypes.object,\n  partitionColumn: PropTypes.string,\n  theme: PropTypes.object,\n  sections: PropTypes.arrayOf(PropTypes.string),\n  operators: PropTypes.arrayOf(PropTypes.string),\n};\n\nconst ResizeIcon = styled.i`\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst FilterPopoverContentContainer = styled.div`\n  .adhoc-filter-edit-tabs > .nav-tabs {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n\n    & > li > a {\n      padding: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n\n  #filter-edit-popover {\n    max-width: none;\n  }\n\n  .filter-edit-clause-info {\n    font-size: ${({ theme }) => theme.typography.sizes.xs}px;\n    padding-left: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  .filter-edit-clause-section {\n    display: inline-flex;\n  }\n\n  .adhoc-filter-simple-column-dropdown {\n    margin-top: ${({ theme }) => theme.gridUnit * 5}px;\n  }\n`;\n\nconst FilterActionsContainer = styled.div`\n  margin-top: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nexport default class AdhocFilterEditPopover extends React.Component {\n  constructor(props) {\n    super(props);\n    this.onSave = this.onSave.bind(this);\n    this.onDragDown = this.onDragDown.bind(this);\n    this.onMouseMove = this.onMouseMove.bind(this);\n    this.onMouseUp = this.onMouseUp.bind(this);\n    this.onAdhocFilterChange = this.onAdhocFilterChange.bind(this);\n    this.setSimpleTabIsValid = this.setSimpleTabIsValid.bind(this);\n    this.adjustHeight = this.adjustHeight.bind(this);\n    this.onTabChange = this.onTabChange.bind(this);\n\n    this.state = {\n      adhocFilter: this.props.adhocFilter,\n      width: POPOVER_INITIAL_WIDTH,\n      height: POPOVER_INITIAL_HEIGHT,\n      activeKey: this.props?.adhocFilter?.expressionType || 'SIMPLE',\n      isSimpleTabValid: true,\n    };\n\n    this.popoverContentRef = React.createRef();\n  }\n\n  componentDidMount() {\n    document.addEventListener('mouseup', this.onMouseUp);\n  }\n\n  componentWillUnmount() {\n    document.removeEventListener('mouseup', this.onMouseUp);\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onAdhocFilterChange(adhocFilter) {\n    this.setState({ adhocFilter });\n  }\n\n  setSimpleTabIsValid(isValid) {\n    this.setState({ isSimpleTabValid: isValid });\n  }\n\n  onSave() {\n    this.props.onChange(this.state.adhocFilter);\n    this.props.onClose();\n  }\n\n  onDragDown(e) {\n    this.dragStartX = e.clientX;\n    this.dragStartY = e.clientY;\n    this.dragStartWidth = this.state.width;\n    this.dragStartHeight = this.state.height;\n    document.addEventListener('mousemove', this.onMouseMove);\n  }\n\n  onMouseMove(e) {\n    this.props.onResize();\n    this.setState({\n      width: Math.max(\n        this.dragStartWidth + (e.clientX - this.dragStartX),\n        POPOVER_INITIAL_WIDTH,\n      ),\n      height: Math.max(\n        this.dragStartHeight + (e.clientY - this.dragStartY) * 2,\n        POPOVER_INITIAL_HEIGHT,\n      ),\n    });\n  }\n\n  onMouseUp() {\n    document.removeEventListener('mousemove', this.onMouseMove);\n  }\n\n  onTabChange(activeKey) {\n    this.setState({\n      activeKey,\n    });\n  }\n\n  adjustHeight(heightDifference) {\n    this.setState(state => ({ height: state.height + heightDifference }));\n  }\n\n  render() {\n    const {\n      adhocFilter: propsAdhocFilter,\n      options,\n      onChange,\n      onClose,\n      onResize,\n      datasource,\n      partitionColumn,\n      theme,\n      operators,\n      ...popoverProps\n    } = this.props;\n\n    const { adhocFilter } = this.state;\n    const stateIsValid = adhocFilter.isValid();\n    const hasUnsavedChanges = !adhocFilter.equals(propsAdhocFilter);\n\n    return (\n      <FilterPopoverContentContainer\n        id=\"filter-edit-popover\"\n        {...popoverProps}\n        data-test=\"filter-edit-popover\"\n        ref={this.popoverContentRef}\n      >\n        <Tabs\n          id=\"adhoc-filter-edit-tabs\"\n          defaultActiveKey={adhocFilter.expressionType}\n          className=\"adhoc-filter-edit-tabs\"\n          data-test=\"adhoc-filter-edit-tabs\"\n          style={{ minHeight: this.state.height, width: this.state.width }}\n          allowOverflow\n          onChange={this.onTabChange}\n        >\n          <Tabs.TabPane\n            className=\"adhoc-filter-edit-tab\"\n            key={EXPRESSION_TYPES.SIMPLE}\n            tab={t('Simple')}\n          >\n            <ErrorBoundary>\n              <AdhocFilterEditPopoverSimpleTabContent\n                operators={operators}\n                adhocFilter={this.state.adhocFilter}\n                onChange={this.onAdhocFilterChange}\n                options={options}\n                datasource={datasource}\n                onHeightChange={this.adjustHeight}\n                partitionColumn={partitionColumn}\n                popoverRef={this.popoverContentRef.current}\n                validHandler={this.setSimpleTabIsValid}\n              />\n            </ErrorBoundary>\n          </Tabs.TabPane>\n          <Tabs.TabPane\n            className=\"adhoc-filter-edit-tab\"\n            key={EXPRESSION_TYPES.SQL}\n            tab={\n              datasource?.type === 'druid' ? (\n                <Tooltip\n                  title={t(\n                    'Custom SQL ad-hoc filters are not available for the native Druid connector',\n                  )}\n                >\n                  {t('Custom SQL')}\n                </Tooltip>\n              ) : (\n                t('Custom SQL')\n              )\n            }\n            disabled={datasource?.type === 'druid'}\n          >\n            <ErrorBoundary>\n              <AdhocFilterEditPopoverSqlTabContent\n                adhocFilter={this.state.adhocFilter}\n                onChange={this.onAdhocFilterChange}\n                options={this.props.options}\n                height={this.state.height}\n                activeKey={this.state.activeKey}\n              />\n            </ErrorBoundary>\n          </Tabs.TabPane>\n        </Tabs>\n        <FilterActionsContainer>\n          <Button buttonSize=\"small\" onClick={this.props.onClose} cta>\n            {t('Close')}\n          </Button>\n          <Button\n            data-test=\"adhoc-filter-edit-popover-save-button\"\n            disabled={!stateIsValid || !this.state.isSimpleTabValid}\n            buttonStyle={\n              hasUnsavedChanges && stateIsValid ? 'primary' : 'default'\n            }\n            buttonSize=\"small\"\n            className=\"m-r-5\"\n            onClick={this.onSave}\n            cta\n          >\n            {t('Save')}\n          </Button>\n          <ResizeIcon\n            role=\"button\"\n            aria-label=\"Resize\"\n            tabIndex={0}\n            onMouseDown={this.onDragDown}\n            className=\"fa fa-expand edit-popover-resize text-muted\"\n          />\n        </FilterActionsContainer>\n      </FilterPopoverContentContainer>\n    );\n  }\n}\n\nAdhocFilterEditPopover.propTypes = propTypes;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { OptionSortType } from 'src/explore/types';\nimport AdhocFilterEditPopover from 'src/explore/components/controls/FilterControl/AdhocFilterEditPopover';\nimport AdhocFilter from 'src/explore/components/controls/FilterControl/AdhocFilter';\nimport { ExplorePopoverContent } from 'src/explore/components/ExploreContentPopover';\nimport { Operators } from 'src/explore/constants';\nimport ControlPopover from '../../ControlPopover/ControlPopover';\n\ninterface AdhocFilterPopoverTriggerProps {\n  sections?: string[];\n  operators?: Operators[];\n  adhocFilter: AdhocFilter;\n  options: OptionSortType[];\n  datasource: Record<string, any>;\n  onFilterEdit: (editedFilter: AdhocFilter) => void;\n  partitionColumn?: string;\n  isControlledComponent?: boolean;\n  visible?: boolean;\n  togglePopover?: (visible: boolean) => void;\n  closePopover?: () => void;\n}\n\ninterface AdhocFilterPopoverTriggerState {\n  popoverVisible: boolean;\n}\n\nclass AdhocFilterPopoverTrigger extends React.PureComponent<\n  AdhocFilterPopoverTriggerProps,\n  AdhocFilterPopoverTriggerState\n> {\n  constructor(props: AdhocFilterPopoverTriggerProps) {\n    super(props);\n    this.onPopoverResize = this.onPopoverResize.bind(this);\n    this.closePopover = this.closePopover.bind(this);\n    this.togglePopover = this.togglePopover.bind(this);\n    this.state = {\n      popoverVisible: false,\n    };\n  }\n\n  onPopoverResize() {\n    this.forceUpdate();\n  }\n\n  closePopover() {\n    this.togglePopover(false);\n  }\n\n  togglePopover(visible: boolean) {\n    this.setState({\n      popoverVisible: visible,\n    });\n  }\n\n  render() {\n    const { adhocFilter, isControlledComponent } = this.props;\n\n    const { visible, togglePopover, closePopover } = isControlledComponent\n      ? {\n          visible: this.props.visible,\n          togglePopover: this.props.togglePopover,\n          closePopover: this.props.closePopover,\n        }\n      : {\n          visible: this.state.popoverVisible,\n          togglePopover: this.togglePopover,\n          closePopover: this.closePopover,\n        };\n    const overlayContent = (\n      <ExplorePopoverContent>\n        <AdhocFilterEditPopover\n          adhocFilter={adhocFilter}\n          options={this.props.options}\n          datasource={this.props.datasource}\n          partitionColumn={this.props.partitionColumn}\n          onResize={this.onPopoverResize}\n          onClose={closePopover}\n          sections={this.props.sections}\n          operators={this.props.operators}\n          onChange={this.props.onFilterEdit}\n        />\n      </ExplorePopoverContent>\n    );\n\n    return (\n      <ControlPopover\n        trigger=\"click\"\n        content={overlayContent}\n        defaultVisible={visible}\n        visible={visible}\n        onVisibleChange={togglePopover}\n        destroyTooltipOnHide\n      >\n        {this.props.children}\n      </ControlPopover>\n    );\n  }\n}\n\nexport default AdhocFilterPopoverTrigger;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useRef } from 'react';\nimport { useDrag, useDrop, DropTargetMonitor } from 'react-dnd';\nimport { styled, t, useTheme } from '@superset-ui/core';\nimport { InfoTooltipWithTrigger } from '@superset-ui/chart-controls';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { savedMetricType } from 'src/explore/components/controls/MetricControl/types';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\nimport { StyledMetricOption } from '../../optionRenderers';\n\nexport const DragContainer = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit}px;\n  :last-child {\n    margin-bottom: 0;\n  }\n`;\n\nexport const OptionControlContainer = styled.div<{\n  withCaret?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  background-color: ${({ theme }) => theme.colors.grayscale.light3};\n  border-radius: 3px;\n  cursor: ${({ withCaret }) => (withCaret ? 'pointer' : 'default')};\n`;\nexport const Label = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${theme.gridUnit}px;\n    svg {\n      margin-right: ${theme.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${theme.gridUnit * 2}px;\n      margin-left: ${theme.gridUnit}px;\n      font-weight: ${theme.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}\n`;\n\nconst LabelText = styled.span`\n  overflow: hidden;\n  text-overflow: ellipsis;\n`;\n\nexport const CaretContainer = styled.div`\n  height: 100%;\n  border-left: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  margin-left: auto;\n`;\n\nexport const CloseContainer = styled.div`\n  height: 100%;\n  width: ${({ theme }) => theme.gridUnit * 6}px;\n  border-right: solid 1px ${({ theme }) => theme.colors.grayscale.dark2}0C;\n  cursor: pointer;\n`;\n\nconst StyledInfoTooltipWithTrigger = styled(InfoTooltipWithTrigger)`\n  margin: 0 ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const HeaderContainer = styled.div`\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n`;\n\nexport const LabelsContainer = styled.div`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: solid 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const DndLabelsContainer = styled.div<{\n  canDrop?: boolean;\n  isOver?: boolean;\n}>`\n  padding: ${({ theme }) => theme.gridUnit}px;\n  border: ${({ canDrop, isOver, theme }) => {\n    if (canDrop) {\n      return `dashed 1px ${theme.colors.info.dark1}`;\n    }\n    if (isOver && !canDrop) {\n      return `dashed 1px ${theme.colors.error.dark1}`;\n    }\n    return `solid 1px ${theme.colors.grayscale.light2}`;\n  }};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport const AddControlLabel = styled.div<{\n  cancelHover?: boolean;\n}>`\n  display: flex;\n  align-items: center;\n  width: 100%;\n  height: ${({ theme }) => theme.gridUnit * 6}px;\n  padding-left: ${({ theme }) => theme.gridUnit}px;\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n  border: dashed 1px ${({ theme }) => theme.colors.grayscale.light2};\n  border-radius: ${({ theme }) => theme.gridUnit}px;\n  cursor: ${({ cancelHover }) => (cancelHover ? 'inherit' : 'pointer')};\n\n  :hover {\n    background-color: ${({ cancelHover, theme }) =>\n      cancelHover ? 'inherit' : theme.colors.grayscale.light4};\n  }\n\n  :active {\n    background-color: ${({ cancelHover, theme }) =>\n      cancelHover ? 'inherit' : theme.colors.grayscale.light3};\n  }\n`;\n\nexport const AddIconButton = styled.button`\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  height: ${({ theme }) => theme.gridUnit * 4}px;\n  width: ${({ theme }) => theme.gridUnit * 4}px;\n  padding: 0;\n  background-color: ${({ theme }) => theme.colors.primary.dark1};\n  border: none;\n  border-radius: 2px;\n\n  :disabled {\n    cursor: not-allowed;\n    background-color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\n\ninterface DragItem {\n  index: number;\n  type: string;\n}\n\nexport const OptionControlLabel = ({\n  label,\n  savedMetric,\n  adhocMetric,\n  onRemove,\n  onMoveLabel,\n  onDropLabel,\n  withCaret,\n  isFunction,\n  type,\n  index,\n  isExtra,\n  tooltipTitle,\n  multi = true,\n  ...props\n}: {\n  label: string | React.ReactNode;\n  savedMetric?: savedMetricType;\n  adhocMetric?: AdhocMetric;\n  onRemove: () => void;\n  onMoveLabel: (dragIndex: number, hoverIndex: number) => void;\n  onDropLabel: () => void;\n  withCaret?: boolean;\n  isFunction?: boolean;\n  isDraggable?: boolean;\n  type: string;\n  index: number;\n  isExtra?: boolean;\n  tooltipTitle: string;\n  multi?: boolean;\n}) => {\n  const theme = useTheme();\n  const ref = useRef<HTMLDivElement>(null);\n  const labelRef = useRef<HTMLDivElement>(null);\n  const hasMetricName = savedMetric?.metric_name;\n  const [, drop] = useDrop({\n    accept: type,\n    drop() {\n      if (!multi) {\n        return;\n      }\n      onDropLabel?.();\n    },\n    hover(item: DragItem, monitor: DropTargetMonitor) {\n      if (!multi) {\n        return;\n      }\n      if (!ref.current) {\n        return;\n      }\n      const dragIndex = item.index;\n      const hoverIndex = index;\n      // Don't replace items with themselves\n      if (dragIndex === hoverIndex) {\n        return;\n      }\n      // Determine rectangle on screen\n      const hoverBoundingRect = ref.current?.getBoundingClientRect();\n      // Get vertical middle\n      const hoverMiddleY =\n        (hoverBoundingRect.bottom - hoverBoundingRect.top) / 2;\n      // Determine mouse position\n      const clientOffset = monitor.getClientOffset();\n      // Get pixels to the top\n      const hoverClientY = clientOffset?.y\n        ? clientOffset?.y - hoverBoundingRect.top\n        : 0;\n      // Only perform the move when the mouse has crossed half of the items height\n      // When dragging downwards, only move when the cursor is below 50%\n      // When dragging upwards, only move when the cursor is above 50%\n      // Dragging downwards\n      if (dragIndex < hoverIndex && hoverClientY < hoverMiddleY) {\n        return;\n      }\n      // Dragging upwards\n      if (dragIndex > hoverIndex && hoverClientY > hoverMiddleY) {\n        return;\n      }\n      // Time to actually perform the action\n      onMoveLabel?.(dragIndex, hoverIndex);\n      // Note: we're mutating the monitor item here!\n      // Generally it's better to avoid mutations,\n      // but it's good here for the sake of performance\n      // to avoid expensive index searches.\n      // eslint-disable-next-line no-param-reassign\n      item.index = hoverIndex;\n    },\n  });\n  const [{ isDragging }, drag] = useDrag({\n    item: {\n      type,\n      index,\n      value: savedMetric?.metric_name ? savedMetric : adhocMetric,\n    },\n    collect: monitor => ({\n      isDragging: monitor.isDragging(),\n    }),\n  });\n\n  const getLabelContent = () => {\n    const shouldShowTooltip =\n      (!isDragging &&\n        typeof label === 'string' &&\n        tooltipTitle &&\n        label &&\n        tooltipTitle !== label) ||\n      (!isDragging &&\n        labelRef &&\n        labelRef.current &&\n        labelRef.current.scrollWidth > labelRef.current.clientWidth);\n\n    if (savedMetric && hasMetricName) {\n      return (\n        <StyledMetricOption\n          metric={savedMetric}\n          labelRef={labelRef}\n          shouldShowTooltip={!isDragging}\n        />\n      );\n    }\n    if (!shouldShowTooltip) {\n      return <LabelText ref={labelRef}>{label}</LabelText>;\n    }\n    return (\n      <Tooltip title={tooltipTitle || label}>\n        <LabelText ref={labelRef}>{label}</LabelText>\n      </Tooltip>\n    );\n  };\n\n  const getOptionControlContent = () => (\n    <OptionControlContainer\n      withCaret={withCaret}\n      data-test=\"option-label\"\n      {...props}\n    >\n      <CloseContainer\n        role=\"button\"\n        data-test=\"remove-control-button\"\n        onClick={onRemove}\n      >\n        <Icons.XSmall iconColor={theme.colors.grayscale.light1} />\n      </CloseContainer>\n      <Label data-test=\"control-label\">\n        {isFunction && <Icons.FieldDerived />}\n        {getLabelContent()}\n      </Label>\n      {isExtra && (\n        <StyledInfoTooltipWithTrigger\n          icon=\"exclamation-triangle\"\n          placement=\"top\"\n          bsStyle=\"warning\"\n          tooltip={t(`\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              `)}\n        />\n      )}\n      {withCaret && (\n        <CaretContainer>\n          <Icons.CaretRight iconColor={theme.colors.grayscale.light1} />\n        </CaretContainer>\n      )}\n    </OptionControlContainer>\n  );\n\n  drag(drop(ref));\n  return <DragContainer ref={ref}>{getOptionControlContent()}</DragContainer>;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { legacyValidateNumber, legacyValidateInteger } from '@superset-ui/core';\nimport debounce from 'lodash/debounce';\nimport { FAST_DEBOUNCE } from 'src/constants';\nimport ControlHeader from 'src/explore/components/ControlHeader';\nimport { Input } from 'src/components/Input';\n\ntype InputValueType = string | number;\n\nexport interface TextControlProps<T extends InputValueType = InputValueType> {\n  label?: string;\n  disabled?: boolean;\n  isFloat?: boolean;\n  isInt?: boolean;\n  onChange?: (value: T, errors: any) => {};\n  onFocus?: () => {};\n  placeholder?: string;\n  value?: T | null;\n  controlId?: string;\n  renderTrigger?: boolean;\n}\n\nexport interface TextControlState {\n  value: string;\n}\n\nconst safeStringify = (value?: InputValueType | null) =>\n  value == null ? '' : String(value);\n\nexport default class TextControl<\n  T extends InputValueType = InputValueType,\n> extends React.Component<TextControlProps<T>, TextControlState> {\n  initialValue?: TextControlProps['value'];\n\n  constructor(props: TextControlProps<T>) {\n    super(props);\n    this.initialValue = props.value;\n    this.state = {\n      value: safeStringify(this.initialValue),\n    };\n  }\n\n  onChange = (inputValue: string) => {\n    let parsedValue: InputValueType = inputValue;\n    // Validation & casting\n    const errors = [];\n    if (inputValue !== '' && this.props.isFloat) {\n      const error = legacyValidateNumber(inputValue);\n      if (error) {\n        errors.push(error);\n      } else {\n        parsedValue = inputValue.match(/.*([.0])$/g)\n          ? inputValue\n          : parseFloat(inputValue);\n      }\n    }\n    if (inputValue !== '' && this.props.isInt) {\n      const error = legacyValidateInteger(inputValue);\n      if (error) {\n        errors.push(error);\n      } else {\n        parsedValue = parseInt(inputValue, 10);\n      }\n    }\n    this.props.onChange?.(parsedValue as T, errors);\n  };\n\n  debouncedOnChange = debounce((inputValue: string) => {\n    this.onChange(inputValue);\n  }, FAST_DEBOUNCE);\n\n  onChangeWrapper = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const { value } = event.target;\n    this.setState({ value }, () => {\n      this.debouncedOnChange(value);\n    });\n  };\n\n  render() {\n    let { value } = this.state;\n    if (this.initialValue !== this.props.value) {\n      this.initialValue = this.props.value;\n      value = safeStringify(this.props.value);\n    }\n    return (\n      <div>\n        <ControlHeader {...this.props} />\n        <Input\n          type=\"text\"\n          data-test=\"inline-name\"\n          placeholder={this.props.placeholder}\n          onChange={this.onChangeWrapper}\n          onFocus={this.props.onFocus}\n          value={value}\n          disabled={this.props.disabled}\n          aria-label={this.props.label}\n        />\n      </div>\n    );\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  ChangeEventHandler,\n  useCallback,\n  useEffect,\n  useMemo,\n  useRef,\n  useState,\n} from 'react';\nimport Fuse from 'fuse.js';\nimport cx from 'classnames';\nimport {\n  t,\n  styled,\n  css,\n  ChartMetadata,\n  SupersetTheme,\n  useTheme,\n  chartLabelWeight,\n  chartLabelExplanations,\n} from '@superset-ui/core';\nimport { AntdCollapse } from 'src/components';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { Input } from 'src/components/Input';\nimport Label from 'src/components/Label';\nimport { usePluginContext } from 'src/components/DynamicPlugins';\nimport Icons from 'src/components/Icons';\nimport { nativeFilterGate } from 'src/dashboard/components/nativeFilters/utils';\nimport scrollIntoView from 'scroll-into-view-if-needed';\n\ninterface VizTypeGalleryProps {\n  onChange: (vizType: string | null) => void;\n  selectedViz: string | null;\n  className?: string;\n}\n\ntype VizEntry = {\n  key: string;\n  value: ChartMetadata;\n};\n\nenum SECTIONS {\n  ALL_CHARTS = 'ALL_CHARTS',\n  CATEGORY = 'CATEGORY',\n  TAGS = 'TAGS',\n  RECOMMENDED_TAGS = 'RECOMMENDED_TAGS',\n}\n\nconst DEFAULT_ORDER = [\n  'line',\n  'big_number',\n  'big_number_total',\n  'table',\n  'pivot_table_v2',\n  'echarts_timeseries_line',\n  'echarts_area',\n  'echarts_timeseries_bar',\n  'echarts_timeseries_scatter',\n  'pie',\n  'mixed_timeseries',\n  'filter_box',\n  'dist_bar',\n  'area',\n  'bar',\n  'deck_polygon',\n  'time_table',\n  'histogram',\n  'deck_scatter',\n  'deck_hex',\n  'time_pivot',\n  'deck_arc',\n  'heatmap',\n  'deck_grid',\n  'dual_line',\n  'deck_screengrid',\n  'line_multi',\n  'treemap',\n  'box_plot',\n  'sunburst',\n  'sankey',\n  'word_cloud',\n  'mapbox',\n  'kepler',\n  'cal_heatmap',\n  'rose',\n  'bubble',\n  'deck_geojson',\n  'horizon',\n  'deck_multi',\n  'compare',\n  'partition',\n  'event_flow',\n  'deck_path',\n  'graph_chart',\n  'world_map',\n  'paired_ttest',\n  'para',\n  'country_map',\n];\n\nconst typesWithDefaultOrder = new Set(DEFAULT_ORDER);\n\nconst THUMBNAIL_GRID_UNITS = 24;\n\nexport const MAX_ADVISABLE_VIZ_GALLERY_WIDTH = 1090;\n\nconst OTHER_CATEGORY = t('Other');\n\nconst ALL_CHARTS = t('All charts');\n\nconst RECOMMENDED_TAGS = [t('Popular'), t('ECharts'), t('Advanced-Analytics')];\n\nexport const VIZ_TYPE_CONTROL_TEST_ID = 'viz-type-control';\n\nconst VizPickerLayout = styled.div<{ isSelectedVizMetadata: boolean }>`\n  ${({ isSelectedVizMetadata }) => `\n    display: grid;\n    grid-template-rows: ${\n      isSelectedVizMetadata\n        ? `auto minmax(100px, 1fr) minmax(200px, 35%)`\n        : 'auto minmax(100px, 1fr)'\n    };\n    // em is used here because the sidebar should be sized to fit the longest standard tag\n    grid-template-columns: minmax(14em, auto) 5fr;\n    grid-template-areas:\n      'sidebar search'\n      'sidebar main'\n      'details details';\n    height: 70vh;\n    overflow: auto;\n  `}\n`;\n\nconst SectionTitle = styled.h3`\n  margin-top: 0;\n  margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n  font-size: ${({ theme }) => theme.typography.sizes.l}px;\n  font-weight: ${({ theme }) => theme.typography.weights.bold};\n  line-height: ${({ theme }) => theme.gridUnit * 6}px;\n`;\n\nconst LeftPane = styled.div`\n  grid-area: sidebar;\n  display: flex;\n  flex-direction: column;\n  border-right: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  overflow: auto;\n\n  .ant-collapse .ant-collapse-item {\n    .ant-collapse-header {\n      font-size: ${({ theme }) => theme.typography.sizes.s}px;\n      color: ${({ theme }) => theme.colors.grayscale.base};\n      padding-left: ${({ theme }) => theme.gridUnit * 2}px;\n      padding-bottom: ${({ theme }) => theme.gridUnit}px;\n    }\n    .ant-collapse-content .ant-collapse-content-box {\n      display: flex;\n      flex-direction: column;\n      padding: 0 ${({ theme }) => theme.gridUnit * 2}px;\n    }\n  }\n`;\n\nconst RightPane = styled.div`\n  grid-area: main;\n  overflow-y: auto;\n`;\n\nconst SearchWrapper = styled.div`\n  ${({ theme }) => `\n    grid-area: search;\n    margin-top: ${theme.gridUnit * 3}px;\n    margin-bottom: ${theme.gridUnit}px;\n    margin-left: ${theme.gridUnit * 3}px;\n    margin-right: ${theme.gridUnit * 3}px;\n    .ant-input-affix-wrapper {\n      padding-left: ${theme.gridUnit * 2}px;\n    }\n  `}\n`;\n\n/** Styles to line up prefix/suffix icons in the search input */\nconst InputIconAlignment = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n`;\n\nconst SelectorLabel = styled.button`\n  ${({ theme }) => `\n    all: unset; // remove default button styles\n    display: flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    margin: ${theme.gridUnit}px 0;\n    padding: 0 ${theme.gridUnit}px;\n    border-radius: ${theme.borderRadius}px;\n    line-height: 2em;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    position: relative;\n\n    &:focus {\n      outline: initial;\n    }\n\n    &.selected {\n      background-color: ${theme.colors.primary.dark1};\n      color: ${theme.colors.primary.light5};\n\n      svg {\n        color: ${theme.colors.primary.light5};\n      }\n\n      &:hover {\n        .cancel {\n          visibility: visible;\n        }\n      }\n    }\n\n    & span:first-of-type svg {\n      margin-top: ${theme.gridUnit * 1.5}px;\n    }\n\n    .cancel {\n      visibility: hidden;\n    }\n  `}\n`;\n\nconst IconsPane = styled.div`\n  overflow: auto;\n  display: grid;\n  grid-template-columns: repeat(\n    auto-fill,\n    ${({ theme }) => theme.gridUnit * THUMBNAIL_GRID_UNITS}px\n  );\n  grid-auto-rows: max-content;\n  justify-content: space-evenly;\n  grid-gap: ${({ theme }) => theme.gridUnit * 2}px;\n  justify-items: center;\n  // for some reason this padding doesn't seem to apply at the bottom of the container. Why is a mystery.\n  padding: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst DetailsPane = (theme: SupersetTheme) => css`\n  grid-area: details;\n  border-top: 1px solid ${theme.colors.grayscale.light2};\n`;\n\nconst DetailsPopulated = (theme: SupersetTheme) => css`\n  padding: ${theme.gridUnit * 4}px;\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  grid-template-rows: auto auto 1fr;\n  grid-template-areas:\n    'viz-name examples-header'\n    'viz-tags examples'\n    'description examples';\n`;\n\n// overflow hidden on the details pane and overflow auto on the description\n// (plus grid layout) enables the description to scroll while the header stays in place.\nconst TagsWrapper = styled.div`\n  grid-area: viz-tags;\n  width: ${({ theme }) => theme.gridUnit * 120}px;\n  padding-right: ${({ theme }) => theme.gridUnit * 14}px;\n  padding-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nconst Description = styled.p`\n  grid-area: description;\n  overflow: auto;\n  padding-right: ${({ theme }) => theme.gridUnit * 14}px;\n  margin: 0;\n`;\n\nconst Examples = styled.div`\n  grid-area: examples;\n  display: flex;\n  flex-direction: row;\n  flex-wrap: nowrap;\n  overflow: auto;\n  gap: ${({ theme }) => theme.gridUnit * 4}px;\n\n  img {\n    height: 100%;\n    border-radius: ${({ theme }) => theme.gridUnit}px;\n    border: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  }\n`;\n\nconst thumbnailContainerCss = (theme: SupersetTheme) => css`\n  cursor: pointer;\n  width: ${theme.gridUnit * THUMBNAIL_GRID_UNITS}px;\n  position: relative;\n\n  img {\n    min-width: ${theme.gridUnit * THUMBNAIL_GRID_UNITS}px;\n    min-height: ${theme.gridUnit * THUMBNAIL_GRID_UNITS}px;\n    border: 1px solid ${theme.colors.grayscale.light2};\n    border-radius: ${theme.gridUnit}px;\n    transition: border-color ${theme.transitionTiming};\n  }\n\n  &.selected img {\n    border: 2px solid ${theme.colors.primary.light2};\n  }\n\n  &:hover:not(.selected) img {\n    border: 1px solid ${theme.colors.grayscale.light1};\n  }\n\n  .viztype-label {\n    margin-top: ${theme.gridUnit * 2}px;\n    text-align: center;\n  }\n`;\n\nconst HighlightLabel = styled.div`\n  ${({ theme }) => `\n    border: 1px solid ${theme.colors.primary.dark1};\n    box-sizing: border-box;\n    border-radius: ${theme.gridUnit}px;\n    background: ${theme.colors.grayscale.light5};\n    line-height: ${theme.gridUnit * 2.5}px;\n    color: ${theme.colors.primary.dark1};\n    font-size: ${theme.typography.sizes.s}px;\n    font-weight: ${theme.typography.weights.bold};\n    text-align: center;\n    padding: ${theme.gridUnit * 0.5}px ${theme.gridUnit}px;\n    text-transform: uppercase;\n    cursor: pointer;\n\n    div {\n      transform: scale(0.83,0.83);\n    }\n  `}\n`;\n\nconst ThumbnailLabelWrapper = styled.div`\n  position: absolute;\n  right: ${({ theme }) => theme.gridUnit}px;\n  top: ${({ theme }) => theme.gridUnit * 19}px;\n`;\n\nconst TitleLabelWrapper = styled.div`\n  display: inline-block !important;\n  margin-left: ${({ theme }) => theme.gridUnit * 2}px;\n`;\n\nfunction vizSortFactor(entry: VizEntry) {\n  if (typesWithDefaultOrder.has(entry.key)) {\n    return DEFAULT_ORDER.indexOf(entry.key);\n  }\n  return DEFAULT_ORDER.length;\n}\n\ninterface ThumbnailProps {\n  entry: VizEntry;\n  selectedViz: string | null;\n  setSelectedViz: (viz: string) => void;\n}\n\nconst Thumbnail: React.FC<ThumbnailProps> = ({\n  entry,\n  selectedViz,\n  setSelectedViz,\n}) => {\n  const theme = useTheme();\n  const { key, value: type } = entry;\n  const isSelected = selectedViz === entry.key;\n\n  return (\n    <div\n      role=\"button\"\n      // using css instead of a styled component to preserve\n      // the data-test attribute\n      css={thumbnailContainerCss(theme)}\n      tabIndex={0}\n      className={isSelected ? 'selected' : ''}\n      onClick={() => setSelectedViz(key)}\n      data-test=\"viztype-selector-container\"\n    >\n      <img\n        alt={type.name}\n        width=\"100%\"\n        className={`viztype-selector ${isSelected ? 'selected' : ''}`}\n        src={type.thumbnail}\n      />\n      <div\n        className=\"viztype-label\"\n        data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__viztype-label`}\n      >\n        {type.name}\n      </div>\n      {type.label && (\n        <ThumbnailLabelWrapper>\n          <HighlightLabel>\n            <div>{t(type.label)}</div>\n          </HighlightLabel>\n        </ThumbnailLabelWrapper>\n      )}\n    </div>\n  );\n};\n\ninterface ThumbnailGalleryProps {\n  vizEntries: VizEntry[];\n  selectedViz: string | null;\n  setSelectedViz: (viz: string) => void;\n}\n\n/** A list of viz thumbnails, used within the viz picker modal */\nconst ThumbnailGallery: React.FC<ThumbnailGalleryProps> = ({\n  vizEntries,\n  ...props\n}) => (\n  <IconsPane data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__viz-row`}>\n    {vizEntries.map(entry => (\n      <Thumbnail key={entry.key} {...props} entry={entry} />\n    ))}\n  </IconsPane>\n);\n\nconst Selector: React.FC<{\n  selector: string;\n  sectionId: string;\n  icon: JSX.Element;\n  isSelected: boolean;\n  onClick: (selector: string, sectionId: string) => void;\n  className?: string;\n}> = ({ selector, sectionId, icon, isSelected, onClick, className }) => {\n  const btnRef = useRef<HTMLButtonElement>(null);\n\n  // see Element.scrollIntoViewIfNeeded()\n  // see: https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollIntoViewIfNeeded\n  useEffect(() => {\n    if (isSelected) {\n      // We need to wait for the modal to open and then scroll, so we put it in the microtask queue\n      queueMicrotask(() =>\n        scrollIntoView(btnRef.current as HTMLButtonElement, {\n          behavior: 'smooth',\n          scrollMode: 'if-needed',\n        }),\n      );\n    }\n  }, []);\n\n  return (\n    <SelectorLabel\n      ref={btnRef}\n      key={selector}\n      name={selector}\n      className={cx(className, isSelected && 'selected')}\n      onClick={() => onClick(selector, sectionId)}\n    >\n      {icon}\n      {selector}\n    </SelectorLabel>\n  );\n};\n\nconst doesVizMatchSelector = (viz: ChartMetadata, selector: string) =>\n  selector === viz.category ||\n  (selector === OTHER_CATEGORY && viz.category == null) ||\n  (viz.tags || []).indexOf(selector) > -1;\n\nexport default function VizTypeGallery(props: VizTypeGalleryProps) {\n  const { selectedViz, onChange, className } = props;\n  const { mountedPluginMetadata } = usePluginContext();\n  const searchInputRef = useRef<HTMLInputElement>();\n  const [searchInputValue, setSearchInputValue] = useState('');\n  const [isSearchFocused, setIsSearchFocused] = useState(true);\n  const isActivelySearching = isSearchFocused && !!searchInputValue;\n\n  const selectedVizMetadata: ChartMetadata | null = selectedViz\n    ? mountedPluginMetadata[selectedViz]\n    : null;\n\n  const chartMetadata: VizEntry[] = useMemo(() => {\n    const result = Object.entries(mountedPluginMetadata)\n      .map(([key, value]) => ({ key, value }))\n      .filter(\n        ({ value }) =>\n          nativeFilterGate(value.behaviors || []) && !value.deprecated,\n      );\n    result.sort((a, b) => vizSortFactor(a) - vizSortFactor(b));\n    return result;\n  }, [mountedPluginMetadata]);\n\n  const chartsByCategory = useMemo(() => {\n    const result: Record<string, VizEntry[]> = {};\n    chartMetadata.forEach(entry => {\n      const category = entry.value.category || OTHER_CATEGORY;\n      if (!result[category]) {\n        result[category] = [];\n      }\n      result[category].push(entry);\n    });\n    return result;\n  }, [chartMetadata]);\n\n  const categories = useMemo(\n    () =>\n      Object.keys(chartsByCategory).sort((a, b) => {\n        // make sure Other goes at the end\n        if (a === OTHER_CATEGORY) return 1;\n        if (b === OTHER_CATEGORY) return -1;\n        // sort alphabetically\n        return a.localeCompare(b);\n      }),\n    [chartsByCategory],\n  );\n\n  const chartsByTags = useMemo(() => {\n    const result: Record<string, VizEntry[]> = {};\n    chartMetadata.forEach(entry => {\n      const tags = entry.value.tags || [];\n      tags.forEach(tag => {\n        if (!result[tag]) {\n          result[tag] = [];\n        }\n        result[tag].push(entry);\n      });\n    });\n    return result;\n  }, [chartMetadata]);\n\n  const tags = useMemo(\n    () =>\n      Object.keys(chartsByTags)\n        .sort((a, b) =>\n          // sort alphabetically\n          a.localeCompare(b),\n        )\n        .filter(tag => RECOMMENDED_TAGS.indexOf(tag) === -1),\n    [chartsByTags],\n  );\n\n  const sortedMetadata = useMemo(\n    () => chartMetadata.sort((a, b) => a.key.localeCompare(b.key)),\n    [chartMetadata],\n  );\n\n  const [activeSelector, setActiveSelector] = useState<string>(\n    () => selectedVizMetadata?.category || RECOMMENDED_TAGS[0],\n  );\n\n  const [activeSection, setActiveSection] = useState<string>(() =>\n    selectedVizMetadata?.category\n      ? SECTIONS.CATEGORY\n      : SECTIONS.RECOMMENDED_TAGS,\n  );\n\n  // get a fuse instance for fuzzy search\n  const fuse = useMemo(\n    () =>\n      new Fuse(chartMetadata, {\n        ignoreLocation: true,\n        threshold: 0.3,\n        keys: [\n          {\n            name: 'value.name',\n            weight: 4,\n          },\n          {\n            name: 'value.tags',\n            weight: 2,\n          },\n          'value.description',\n        ],\n      }),\n    [chartMetadata],\n  );\n\n  const searchResults = useMemo(() => {\n    if (searchInputValue.trim() === '') {\n      return [];\n    }\n    return fuse\n      .search(searchInputValue)\n      .map(result => result.item)\n      .sort((a, b) => {\n        const aLabel = a.value?.label;\n        const bLabel = b.value?.label;\n        const aOrder =\n          aLabel && chartLabelWeight[aLabel]\n            ? chartLabelWeight[aLabel].weight\n            : 0;\n        const bOrder =\n          bLabel && chartLabelWeight[bLabel]\n            ? chartLabelWeight[bLabel].weight\n            : 0;\n        return bOrder - aOrder;\n      });\n  }, [searchInputValue, fuse]);\n\n  const focusSearch = useCallback(() => {\n    // \"start searching\" is actually a two-stage process.\n    // When you first click on the search bar, the input is focused and nothing else happens.\n    // Once you begin typing, the selected category is cleared and the displayed viz entries change.\n    setIsSearchFocused(true);\n  }, []);\n\n  const changeSearch: ChangeEventHandler<HTMLInputElement> = useCallback(\n    event => setSearchInputValue(event.target.value),\n    [],\n  );\n\n  const stopSearching = useCallback(() => {\n    // stopping a search takes you back to the category you were looking at before.\n    // Unlike focusSearch, this is a simple one-step process.\n    setIsSearchFocused(false);\n    setSearchInputValue('');\n    searchInputRef.current!.blur();\n  }, []);\n\n  const clickSelector = useCallback(\n    (selector: string, sectionId: string) => {\n      if (isSearchFocused) {\n        stopSearching();\n      }\n      setActiveSelector(selector);\n      setActiveSection(sectionId);\n      // clear the selected viz if it is not present in the new category or tags\n      const isSelectedVizCompatible =\n        selectedVizMetadata &&\n        doesVizMatchSelector(selectedVizMetadata, selector);\n      if (selector !== activeSelector && !isSelectedVizCompatible) {\n        onChange(null);\n      }\n    },\n    [\n      stopSearching,\n      isSearchFocused,\n      activeSelector,\n      selectedVizMetadata,\n      onChange,\n    ],\n  );\n\n  const sectionMap = useMemo(\n    () => ({\n      [SECTIONS.RECOMMENDED_TAGS]: {\n        title: t('Recommended tags'),\n        icon: <Icons.Tags />,\n        selectors: RECOMMENDED_TAGS,\n      },\n      [SECTIONS.CATEGORY]: {\n        title: t('Category'),\n        icon: <Icons.Category />,\n        selectors: categories,\n      },\n      [SECTIONS.TAGS]: {\n        title: t('Tags'),\n        icon: <Icons.Tags />,\n        selectors: tags,\n      },\n    }),\n    [categories, tags],\n  );\n\n  const getVizEntriesToDisplay = () => {\n    if (isActivelySearching) {\n      return searchResults;\n    }\n    if (\n      activeSelector === ALL_CHARTS &&\n      activeSection === SECTIONS.ALL_CHARTS\n    ) {\n      return sortedMetadata;\n    }\n    if (\n      activeSection === SECTIONS.CATEGORY &&\n      chartsByCategory[activeSelector]\n    ) {\n      return chartsByCategory[activeSelector];\n    }\n    if (\n      (activeSection === SECTIONS.TAGS ||\n        activeSection === SECTIONS.RECOMMENDED_TAGS) &&\n      chartsByTags[activeSelector]\n    ) {\n      return chartsByTags[activeSelector];\n    }\n    return [];\n  };\n\n  return (\n    <VizPickerLayout\n      className={className}\n      isSelectedVizMetadata={Boolean(selectedVizMetadata)}\n    >\n      <LeftPane>\n        <Selector\n          css={({ gridUnit }) =>\n            // adjust style for not being inside a collapse\n            css`\n              margin: ${gridUnit * 2}px;\n              margin-bottom: 0;\n            `\n          }\n          sectionId={SECTIONS.ALL_CHARTS}\n          selector={ALL_CHARTS}\n          icon={<Icons.Ballot />}\n          isSelected={\n            !isActivelySearching &&\n            ALL_CHARTS === activeSelector &&\n            SECTIONS.ALL_CHARTS === activeSection\n          }\n          onClick={clickSelector}\n        />\n        <AntdCollapse\n          expandIconPosition=\"right\"\n          ghost\n          defaultActiveKey={Object.keys(sectionMap)}\n        >\n          {Object.keys(sectionMap).map(sectionId => {\n            const section = sectionMap[sectionId];\n\n            return (\n              <AntdCollapse.Panel\n                header={<span className=\"header\">{section.title}</span>}\n                key={sectionId}\n              >\n                {section.selectors.map((selector: string) => (\n                  <Selector\n                    key={selector}\n                    selector={selector}\n                    sectionId={sectionId}\n                    icon={section.icon}\n                    isSelected={\n                      !isActivelySearching &&\n                      selector === activeSelector &&\n                      sectionId === activeSection\n                    }\n                    onClick={clickSelector}\n                  />\n                ))}\n              </AntdCollapse.Panel>\n            );\n          })}\n        </AntdCollapse>\n      </LeftPane>\n\n      <SearchWrapper>\n        <Input\n          type=\"text\"\n          ref={searchInputRef as any /* cast required because emotion */}\n          value={searchInputValue}\n          placeholder={t('Search all charts')}\n          onChange={changeSearch}\n          onFocus={focusSearch}\n          data-test={`${VIZ_TYPE_CONTROL_TEST_ID}__search-input`}\n          prefix={\n            <InputIconAlignment>\n              <Icons.Search iconSize=\"m\" />\n            </InputIconAlignment>\n          }\n          suffix={\n            <InputIconAlignment>\n              {searchInputValue && (\n                <Icons.XLarge iconSize=\"m\" onClick={stopSearching} />\n              )}\n            </InputIconAlignment>\n          }\n        />\n      </SearchWrapper>\n\n      <RightPane>\n        <ThumbnailGallery\n          vizEntries={getVizEntriesToDisplay()}\n          selectedViz={selectedViz}\n          setSelectedViz={onChange}\n        />\n      </RightPane>\n\n      {selectedVizMetadata ? (\n        <div\n          css={(theme: SupersetTheme) => [\n            DetailsPane(theme),\n            DetailsPopulated(theme),\n          ]}\n        >\n          <>\n            <SectionTitle\n              css={css`\n                grid-area: viz-name;\n                position: relative;\n              `}\n            >\n              {selectedVizMetadata?.name}\n              {selectedVizMetadata?.label && (\n                <Tooltip\n                  id=\"viz-badge-tooltip\"\n                  placement=\"top\"\n                  title={\n                    selectedVizMetadata.labelExplanation ??\n                    chartLabelExplanations[selectedVizMetadata.label]\n                  }\n                >\n                  <TitleLabelWrapper>\n                    <HighlightLabel>\n                      <div>{t(selectedVizMetadata.label)}</div>\n                    </HighlightLabel>\n                  </TitleLabelWrapper>\n                </Tooltip>\n              )}\n            </SectionTitle>\n            <TagsWrapper>\n              {selectedVizMetadata?.tags.map(tag => (\n                <Label key={tag}>{tag}</Label>\n              ))}\n            </TagsWrapper>\n            <Description>\n              {selectedVizMetadata?.description ||\n                t('No description available.')}\n            </Description>\n            <SectionTitle\n              css={css`\n                grid-area: examples-header;\n              `}\n            >\n              {!!selectedVizMetadata?.exampleGallery?.length && t('Examples')}\n            </SectionTitle>\n            <Examples>\n              {(selectedVizMetadata?.exampleGallery || []).map(example => (\n                <img\n                  src={example.url}\n                  alt={example.caption}\n                  title={example.caption}\n                />\n              ))}\n            </Examples>\n          </>\n        </div>\n      ) : null}\n    </VizPickerLayout>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport {\n  MetricOption,\n  ColumnOption,\n  MetricOptionProps,\n  ColumnOptionProps,\n} from '@superset-ui/chart-controls';\n\nconst OptionContainer = styled.div`\n  width: 100%;\n  > span {\n    display: flex;\n    align-items: center;\n  }\n\n  .option-label {\n    display: inline-block;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n    & ~ i {\n      margin-left: ${({ theme }) => theme.gridUnit}px;\n    }\n  }\n  .type-label {\n    margin-right: ${({ theme }) => theme.gridUnit * 3}px;\n    width: ${({ theme }) => theme.gridUnit * 7}px;\n    display: inline-block;\n    text-align: center;\n    font-weight: ${({ theme }) => theme.typography.weights.bold};\n  }\n`;\n\nexport const StyledMetricOption = (props: MetricOptionProps) => (\n  <OptionContainer>\n    <MetricOption {...props} />\n  </OptionContainer>\n);\n\nexport const StyledColumnOption = (props: ColumnOptionProps) => (\n  <OptionContainer>\n    <ColumnOption {...props} />\n  </OptionContainer>\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport { ControlPanelSectionConfig } from '@superset-ui/chart-controls';\nimport { formatSelectOptions } from 'src/explore/exploreUtils';\n\nexport const druidTimeSeries: ControlPanelSectionConfig = {\n  label: t('Time'),\n  expanded: true,\n  description: t('Time related form attributes'),\n  controlSetRows: [['time_range']],\n};\n\nexport const datasourceAndVizType: ControlPanelSectionConfig = {\n  label: t('Visualization type'),\n  expanded: true,\n  controlSetRows: [\n    ['datasource'],\n    ['viz_type'],\n    [\n      {\n        name: 'slice_id',\n        config: {\n          type: 'HiddenControl',\n          label: t('Chart ID'),\n          hidden: true,\n          description: t('The id of the active chart'),\n        },\n      },\n      {\n        name: 'cache_timeout',\n        config: {\n          type: 'HiddenControl',\n          label: t('Cache Timeout (seconds)'),\n          hidden: true,\n          description: t('The number of seconds before expiring the cache'),\n        },\n      },\n      {\n        name: 'url_params',\n        config: {\n          type: 'HiddenControl',\n          label: t('URL parameters'),\n          hidden: true,\n          description: t('Extra parameters for use in jinja templated queries'),\n        },\n      },\n    ],\n  ],\n};\n\nexport const colorScheme: ControlPanelSectionConfig = {\n  label: t('Color scheme'),\n  controlSetRows: [['color_scheme']],\n};\n\nexport const sqlaTimeSeries: ControlPanelSectionConfig = {\n  label: t('Time'),\n  description: t('Time related form attributes'),\n  expanded: true,\n  controlSetRows: [['granularity_sqla'], ['time_range']],\n};\n\nexport const annotations: ControlPanelSectionConfig = {\n  label: t('Annotations and layers'),\n  tabOverride: 'data',\n  expanded: true,\n  controlSetRows: [\n    [\n      {\n        name: 'annotation_layers',\n        config: {\n          type: 'AnnotationLayerControl',\n          label: '',\n          default: [],\n          description: 'Annotation layers',\n          renderTrigger: true,\n          tabOverride: 'data',\n        },\n      },\n    ],\n  ],\n};\n\nexport const NVD3TimeSeries: ControlPanelSectionConfig[] = [\n  {\n    label: t('Query'),\n    expanded: true,\n    controlSetRows: [\n      ['metrics'],\n      ['adhoc_filters'],\n      ['groupby'],\n      ['limit', 'timeseries_limit_metric'],\n      ['order_desc'],\n      [\n        {\n          name: 'contribution',\n          config: {\n            type: 'CheckboxControl',\n            label: t('Contribution'),\n            default: false,\n            description: t('Compute the contribution to the total'),\n          },\n        },\n      ],\n      ['row_limit', null],\n    ],\n  },\n  {\n    label: t('Advanced analytics'),\n    tabOverride: 'data',\n    description: t(\n      'This section contains options ' +\n        'that allow for advanced analytical post processing ' +\n        'of query results',\n    ),\n    controlSetRows: [\n      [<div className=\"section-header\">{t('Rolling window')}</div>],\n      [\n        {\n          name: 'rolling_type',\n          config: {\n            type: 'SelectControl',\n            label: t('Rolling function'),\n            default: 'None',\n            choices: formatSelectOptions([\n              'None',\n              'mean',\n              'sum',\n              'std',\n              'cumsum',\n            ]),\n            description: t(\n              'Defines a rolling window function to apply, works along ' +\n                'with the [Periods] text box',\n            ),\n          },\n        },\n        {\n          name: 'rolling_periods',\n          config: {\n            type: 'TextControl',\n            label: t('Periods'),\n            isInt: true,\n            description: t(\n              'Defines the size of the rolling window function, ' +\n                'relative to the time granularity selected',\n            ),\n          },\n        },\n        {\n          name: 'min_periods',\n          config: {\n            type: 'TextControl',\n            label: t('Min periods'),\n            isInt: true,\n            description: t(\n              'The minimum number of rolling periods required to show ' +\n                'a value. For instance if you do a cumulative sum on 7 days ' +\n                'you may want your \"Min Period\" to be 7, so that all data points ' +\n                'shown are the total of 7 periods. This will hide the \"ramp up\" ' +\n                'taking place over the first 7 periods',\n            ),\n          },\n        },\n      ],\n      [<div className=\"section-header\">{t('Time comparison')}</div>],\n      [\n        {\n          name: 'time_compare',\n          config: {\n            type: 'SelectControl',\n            multi: true,\n            freeForm: true,\n            label: t('Time shift'),\n            choices: formatSelectOptions([\n              '1 day',\n              '1 week',\n              '28 days',\n              '30 days',\n              '52 weeks',\n              '1 year',\n              '104 weeks',\n              '2 years',\n              '156 weeks',\n              '3 years',\n            ]),\n            description: t(\n              'Overlay one or more timeseries from a ' +\n                'relative time period. Expects relative time deltas ' +\n                'in natural language (example:  24 hours, 7 days, ' +\n                '52 weeks, 365 days). Free text is supported.',\n            ),\n          },\n        },\n        {\n          name: 'comparison_type',\n          config: {\n            type: 'SelectControl',\n            label: t('Calculation type'),\n            default: 'values',\n            choices: [\n              ['values', 'Actual values'],\n              ['absolute', 'Difference'],\n              ['percentage', 'Percentage change'],\n              ['ratio', 'Ratio'],\n            ],\n            description: t(\n              'How to display time shifts: as individual lines; as the ' +\n                'difference between the main time series and each time shift; ' +\n                'as the percentage change; or as the ratio between series and time shifts.',\n            ),\n          },\n        },\n      ],\n      [<div className=\"section-header\">{t('Resample')}</div>],\n      [\n        {\n          name: 'resample_rule',\n          config: {\n            type: 'SelectControl',\n            freeForm: true,\n            label: t('Rule'),\n            default: null,\n            choices: formatSelectOptions(['1T', '1H', '1D', '7D', '1M', '1AS']),\n            description: t('Pandas resample rule'),\n          },\n        },\n        {\n          name: 'resample_method',\n          config: {\n            type: 'SelectControl',\n            freeForm: true,\n            label: t('Method'),\n            default: null,\n            choices: formatSelectOptions([\n              'asfreq',\n              'bfill',\n              'ffill',\n              'median',\n              'mean',\n              'sum',\n            ]),\n            description: t('Pandas resample method'),\n          },\n        },\n      ],\n    ],\n  },\n];\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport memoizeOne from 'memoize-one';\nimport {\n  DatasourceType,\n  getChartControlPanelRegistry,\n} from '@superset-ui/core';\nimport {\n  ControlPanelConfig,\n  expandControlConfig,\n  isControlPanelSectionConfig,\n} from '@superset-ui/chart-controls';\n\nimport * as SECTIONS from 'src/explore/controlPanels/sections';\n\nconst getMemoizedSectionsToRender = memoizeOne(\n  (datasourceType: DatasourceType, controlPanelConfig: ControlPanelConfig) => {\n    const {\n      sectionOverrides = {},\n      controlOverrides,\n      controlPanelSections = [],\n    } = controlPanelConfig;\n\n    // default control panel sections\n    const sections = { ...SECTIONS };\n\n    // apply section overrides\n    Object.entries(sectionOverrides).forEach(([section, overrides]) => {\n      if (typeof overrides === 'object' && overrides.constructor === Object) {\n        sections[section] = {\n          ...sections[section],\n          ...overrides,\n        };\n      } else {\n        sections[section] = overrides;\n      }\n    });\n\n    const { datasourceAndVizType } = sections;\n\n    // list of datasource-specific controls that should be removed\n    const invalidControls =\n      datasourceType === 'table'\n        ? ['granularity', 'druid_time_origin']\n        : ['granularity_sqla', 'time_grain_sqla'];\n\n    return [datasourceAndVizType]\n      .concat(controlPanelSections.filter(isControlPanelSectionConfig))\n      .map(section => {\n        const { controlSetRows } = section;\n        return {\n          ...section,\n          controlSetRows:\n            controlSetRows?.map(row =>\n              row\n                .filter(\n                  control =>\n                    typeof control !== 'string' ||\n                    !invalidControls.includes(control),\n                )\n                .map(item => expandControlConfig(item, controlOverrides)),\n            ) || [],\n        };\n      });\n  },\n);\n\n/**\n * Get the clean and processed control panel sections\n */\nexport function getSectionsToRender(\n  vizType: string,\n  datasourceType: DatasourceType,\n) {\n  const controlPanelConfig =\n    // TODO: update `chartControlPanelRegistry` type to use ControlPanelConfig\n    (getChartControlPanelRegistry().get(vizType) as ControlPanelConfig) || {};\n  return getMemoizedSectionsToRender(datasourceType, controlPanelConfig);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport memoizeOne from 'memoize-one';\nimport { getChartControlPanelRegistry } from '@superset-ui/core';\nimport {\n  ControlPanelConfig,\n  ControlPanelSectionConfig,\n  expandControlConfig,\n  isControlPanelSectionConfig,\n} from '@superset-ui/chart-controls';\n\n/**\n * Find control item from control panel config.\n */\nexport function findControlItem(\n  controlPanelSections: (ControlPanelSectionConfig | null)[],\n  controlKey: string,\n) {\n  return (\n    controlPanelSections\n      .filter(isControlPanelSectionConfig)\n      .map(section => section.controlSetRows)\n      .flat(2)\n      .find(\n        control =>\n          controlKey === control ||\n          (control !== null &&\n            typeof control === 'object' &&\n            'name' in control &&\n            control.name === controlKey),\n      ) ?? null\n  );\n}\n\nconst getMemoizedControlConfig = memoizeOne(\n  (controlKey, controlPanelConfig: ControlPanelConfig) => {\n    const { controlOverrides = {}, controlPanelSections = [] } =\n      controlPanelConfig;\n    const control = expandControlConfig(\n      findControlItem(controlPanelSections, controlKey),\n      controlOverrides,\n    );\n    return control && 'config' in control ? control.config : control;\n  },\n);\n\nexport const getControlConfig = function getControlConfig(\n  controlKey: string,\n  vizType: string,\n) {\n  const controlPanelConfig = getChartControlPanelRegistry().get(vizType) || {};\n  return getMemoizedControlConfig(\n    controlKey,\n    // TODO: the ChartControlPanelRegistry is incorrectly typed and needs to\n    // be fixed\n    controlPanelConfig as ControlPanelConfig,\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ReactNode } from 'react';\nimport {\n  DatasourceType,\n  ensureIsArray,\n  JsonValue,\n  QueryFormData,\n} from '@superset-ui/core';\nimport {\n  ControlConfig,\n  ControlPanelState,\n  ControlState,\n  ControlType,\n  ControlValueValidator,\n  CustomControlItem,\n} from '@superset-ui/chart-controls';\nimport { getSectionsToRender } from './getSectionsToRender';\nimport { getControlConfig } from './getControlConfig';\n\ntype ValidationError = JsonValue;\n\nfunction execControlValidator<T = ControlType>(\n  control: ControlState<T>,\n  processedState: ControlState<T>,\n) {\n  const validators = control.validators as ControlValueValidator[] | undefined;\n  const { externalValidationErrors = [] } = control;\n  const errors: ValidationError[] = [];\n  if (validators && validators.length > 0) {\n    validators.forEach(validator => {\n      const error = validator.call(control, control.value, processedState);\n      if (error) {\n        errors.push(error);\n      }\n    });\n  }\n  const validationErrors = [...errors, ...externalValidationErrors];\n  // always reset validation errors even when there is no validator\n  return { ...control, validationErrors };\n}\n\n/**\n * Clear control values that are no longer in the `choices` list.\n */\nfunction handleMissingChoice<T = ControlType>(control: ControlState<T>) {\n  // If the value is not valid anymore based on choices, clear it\n  if (\n    control.type === 'SelectControl' &&\n    !control.freeForm &&\n    control.choices &&\n    control.value\n  ) {\n    const alteredControl = { ...control };\n    const choices = control.choices as [JsonValue, ReactNode][];\n    const value = ensureIsArray(control.value);\n    const choiceValues = choices.map(c => c[0]);\n    if (control.multi && value.length > 0) {\n      alteredControl.value = value.filter(el => choiceValues.includes(el));\n      return alteredControl;\n    }\n    if (!control.multi && !choiceValues.includes(value[0])) {\n      alteredControl.value = null;\n      return alteredControl;\n    }\n  }\n  return control;\n}\n\nexport function applyMapStateToPropsToControl<T = ControlType>(\n  controlState: ControlState<T>,\n  controlPanelState: Partial<ControlPanelState> | null,\n) {\n  const { mapStateToProps } = controlState;\n  let state = { ...controlState };\n  let { value } = state; // value is current user-input value\n  if (mapStateToProps && controlPanelState) {\n    state = {\n      ...controlState,\n      ...mapStateToProps.call(controlState, controlPanelState, controlState),\n    };\n    // `mapStateToProps` may also provide a value\n    value = value || state.value;\n  }\n  // If default is a function, evaluate it\n  if (typeof state.default === 'function') {\n    state.default = state.default(state, controlPanelState);\n    // if default is still a function, discard\n    if (typeof state.default === 'function') {\n      delete state.default;\n    }\n  }\n  // If no current value, set it as default\n  if (state.default && value === undefined) {\n    value = state.default;\n  }\n  // If a choice control went from multi=false to true, wrap value in array\n  if (value && state.multi && !Array.isArray(value)) {\n    value = [value];\n  }\n  state.value = value;\n  return execControlValidator(handleMissingChoice(state), state);\n}\n\nexport function getControlStateFromControlConfig<T = ControlType>(\n  controlConfig: ControlConfig<T> | null,\n  controlPanelState: Partial<ControlPanelState> | null,\n  value?: JsonValue,\n) {\n  // skip invalid config values\n  if (!controlConfig) {\n    return null;\n  }\n  const controlState = { ...controlConfig, value } as ControlState<T>;\n  // only apply mapStateToProps when control states have been initialized\n  // or when explicitly didn't provide control panel state (mostly for testing)\n  if (controlPanelState?.controls || controlPanelState === null) {\n    return applyMapStateToPropsToControl(controlState, controlPanelState);\n  }\n  return controlState;\n}\n\nexport function getControlState(\n  controlKey: string,\n  vizType: string,\n  state: Partial<ControlPanelState>,\n  value?: JsonValue,\n) {\n  return getControlStateFromControlConfig(\n    getControlConfig(controlKey, vizType),\n    state,\n    value,\n  );\n}\n\nexport function getAllControlsState(\n  vizType: string,\n  datasourceType: DatasourceType,\n  state: ControlPanelState | null,\n  formData: QueryFormData,\n) {\n  const controlsState = {};\n  getSectionsToRender(vizType, datasourceType).forEach(section =>\n    section.controlSetRows.forEach(fieldsetRow =>\n      fieldsetRow.forEach((field: CustomControlItem) => {\n        if (field && field.config && field.name) {\n          const { config, name } = field;\n          controlsState[name] = getControlStateFromControlConfig(\n            config,\n            state,\n            formData[name],\n          );\n        }\n      }),\n    ),\n  );\n  return controlsState;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { QueryFormData } from '@superset-ui/core';\nimport { ControlStateMapping } from '@superset-ui/chart-controls';\n\nexport function getFormDataFromControls(\n  controlsState: ControlStateMapping,\n): QueryFormData {\n  const formData = {};\n  Object.keys(controlsState).forEach(controlName => {\n    const control = controlsState[controlName];\n    formData[controlName] = control.value;\n  });\n  return formData as QueryFormData;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ControlState, Dataset, Metric } from '@superset-ui/chart-controls';\nimport {\n  Column,\n  isAdhocMetricSimple,\n  isSavedMetric,\n  isSimpleAdhocFilter,\n  JsonValue,\n  SimpleAdhocFilter,\n} from '@superset-ui/core';\nimport AdhocMetric from 'src/explore/components/controls/MetricControl/AdhocMetric';\n\nconst isControlValueCompatibleWithDatasource = (\n  datasource: Dataset,\n  controlState: ControlState,\n  value: any,\n) => {\n  if (controlState.options && typeof value === 'string') {\n    if (\n      (Array.isArray(controlState.options) &&\n        controlState.options.some(\n          (option: [string | number, string]) => option[0] === value,\n        )) ||\n      value in controlState.options\n    ) {\n      return datasource.columns.some(column => column.column_name === value);\n    }\n  }\n  if (\n    controlState.savedMetrics &&\n    isSavedMetric(value) &&\n    controlState.savedMetrics.some(\n      (savedMetric: Metric) => savedMetric.metric_name === value,\n    )\n  ) {\n    return datasource.metrics.some(\n      (metric: Metric) => metric.metric_name === value,\n    );\n  }\n  if (\n    controlState.columns &&\n    (isAdhocMetricSimple(value) || isSimpleAdhocFilter(value)) &&\n    controlState.columns.some(\n      (column: Column) =>\n        column.column_name === (value as AdhocMetric).column?.column_name ||\n        column.column_name === (value as SimpleAdhocFilter).subject,\n    )\n  ) {\n    return datasource.columns.some(\n      (column: Column) =>\n        column.column_name === (value as AdhocMetric).column?.column_name ||\n        column.column_name === (value as SimpleAdhocFilter).subject,\n    );\n  }\n  return false;\n};\n\nexport const getControlValuesCompatibleWithDatasource = (\n  datasource: Dataset,\n  controlState: ControlState,\n  value: JsonValue,\n) => {\n  if (value === undefined || value === null) {\n    return undefined;\n  }\n  if (Array.isArray(value)) {\n    const compatibleValues = value.filter(val =>\n      isControlValueCompatibleWithDatasource(datasource, controlState, val),\n    );\n    return compatibleValues.length > 0\n      ? compatibleValues\n      : controlState.default;\n  }\n  return isControlValueCompatibleWithDatasource(datasource, controlState, value)\n    ? value\n    : controlState.default;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { isEmpty, intersection } from 'lodash';\nimport {\n  ensureIsArray,\n  getChartControlPanelRegistry,\n  QueryFormData,\n} from '@superset-ui/core';\nimport {\n  ControlStateMapping,\n  StandardizedState,\n  StandardizedFormDataInterface,\n} from '@superset-ui/chart-controls';\nimport { getControlsState } from 'src/explore/store';\nimport { getFormDataFromControls } from './getFormDataFromControls';\n\nexport const sharedControls: Record<string, keyof StandardizedState> = {\n  // metrics\n  metric: 'metrics', // via sharedControls, scalar\n  metrics: 'metrics', // via sharedControls, array\n  metric_2: 'metrics', // via sharedControls, scalar\n  // columns\n  groupby: 'columns', // via sharedControls, array\n  columns: 'columns', // via sharedControls, array\n  groupbyColumns: 'columns', // via pivot table v2, array\n  groupbyRows: 'columns', // via pivot table v2, array\n};\nconst sharedControlsMap: Record<keyof StandardizedState, string[]> = {\n  metrics: [],\n  columns: [],\n};\nObject.entries(sharedControls).forEach(([key, value]) =>\n  sharedControlsMap[value].push(key),\n);\nexport const publicControls = [\n  // time section\n  'granularity_sqla', // via sharedControls\n  'time_grain_sqla', // via sharedControls\n  'time_range', // via sharedControls\n  // filters\n  'adhoc_filters', // via sharedControls\n  // subquery limit(series limit)\n  'limit', // via sharedControls\n  // order by clause\n  'timeseries_limit_metric', // via sharedControls\n  'series_limit_metric', // via sharedControls\n  // desc or asc in order by clause\n  'order_desc', // via sharedControls\n  // outer query limit\n  'row_limit', // via sharedControls\n  // x asxs column\n  'x_axis', // via sharedControls\n  // advanced analytics - rolling window\n  'rolling_type', // via sections.advancedAnalytics\n  'rolling_periods', // via sections.advancedAnalytics\n  'min_periods', // via sections.advancedAnalytics\n  // advanced analytics - time comparison\n  'time_compare', // via sections.advancedAnalytics\n  'comparison_type', // via sections.advancedAnalytics\n  // advanced analytics - resample\n  'resample_rule', // via sections.advancedAnalytics\n  'resample_method', // via sections.advancedAnalytics\n];\n\nexport class StandardizedFormData {\n  private sfd: StandardizedFormDataInterface;\n\n  constructor(sourceFormData: QueryFormData) {\n    /*\n     * Support form_data for smooth switching between different viz\n     * */\n    const formData = Object.freeze(sourceFormData);\n\n    // generates an ordered map, the key is viz_type and the value is form_data. the last item is current viz\n    const memorizedFormData: Map<string, QueryFormData> = Array.isArray(\n      formData?.standardizedFormData?.memorizedFormData,\n    )\n      ? new Map(formData.standardizedFormData.memorizedFormData)\n      : new Map();\n    const vizType = formData.viz_type;\n    if (memorizedFormData.has(vizType)) {\n      memorizedFormData.delete(vizType);\n    }\n    memorizedFormData.set(vizType, formData);\n\n    // calculate sharedControls\n    const standardizedState =\n      StandardizedFormData.getStandardizedState(formData);\n\n    this.sfd = {\n      standardizedState,\n      memorizedFormData,\n    };\n  }\n\n  static getStandardizedState(formData: QueryFormData): StandardizedState {\n    // 1. collect current sharedControls\n    let currState: StandardizedState = {\n      metrics: [],\n      columns: [],\n    };\n    Object.entries(formData).forEach(([key, value]) => {\n      if (key in sharedControls) {\n        currState[sharedControls[key]].push(...ensureIsArray(value));\n      }\n    });\n\n    // 2. get previous StandardizedState\n    let prevState: StandardizedState = {\n      metrics: [],\n      columns: [],\n    };\n    if (\n      formData?.standardizedFormData?.standardizedState &&\n      Array.isArray(formData.standardizedFormData.standardizedState.metrics) &&\n      Array.isArray(formData.standardizedFormData.standardizedState.columns)\n    ) {\n      prevState = formData.standardizedFormData.standardizedState;\n    }\n    // the initial prevState should equal to currentState\n    if (isEmpty(prevState.metrics) && isEmpty(prevState.columns)) {\n      prevState = currState;\n    }\n\n    // 3. inherit SS from previous state if current viz hasn't columns-like controls or metrics-like controls\n    Object.keys(sharedControlsMap).forEach(key => {\n      if (\n        isEmpty(intersection(Object.keys(formData), sharedControlsMap[key]))\n      ) {\n        currState[key] = prevState[key];\n      }\n    });\n\n    // 4. update hook\n    const controlPanel = getChartControlPanelRegistry().get(formData.viz_type);\n    if (controlPanel?.updateStandardizedState) {\n      currState = controlPanel.updateStandardizedState(prevState, currState);\n    }\n\n    // 5. clear up\n    Object.entries(currState).forEach(([key, value]) => {\n      currState[key] = value.filter(Boolean);\n    });\n\n    return currState;\n  }\n\n  private getLatestFormData(vizType: string): QueryFormData {\n    if (this.has(vizType)) {\n      return this.get(vizType);\n    }\n\n    return this.memorizedFormData.slice(-1)[0][1];\n  }\n\n  private get standardizedState() {\n    return this.sfd.standardizedState;\n  }\n\n  private get memorizedFormData() {\n    return Array.from(this.sfd.memorizedFormData.entries());\n  }\n\n  serialize() {\n    return {\n      standardizedState: this.standardizedState,\n      memorizedFormData: this.memorizedFormData,\n    };\n  }\n\n  has(vizType: string): boolean {\n    return this.sfd.memorizedFormData.has(vizType);\n  }\n\n  get(vizType: string): QueryFormData {\n    return this.sfd.memorizedFormData.get(vizType) as QueryFormData;\n  }\n\n  transform(\n    targetVizType: string,\n    exploreState: Record<string, any>,\n  ): {\n    formData: QueryFormData;\n    controlsState: ControlStateMapping;\n  } {\n    /*\n     * Transfrom form_data between different viz. Return new form_data and controlsState.\n     * 1. get memorized form_data by viz type or get previous form_data\n     * 2. collect public control values\n     * 3. generate initial targetControlsState\n     * 4. attach `standardizedFormData` to the initial form_data\n     * 5. call denormalizeFormData to transform initial form_data if the plugin was defined\n     * 6. use final form_data to generate controlsState\n     * */\n    const latestFormData = this.getLatestFormData(targetVizType);\n    const publicFormData = {};\n    publicControls.forEach(key => {\n      if (key in exploreState.form_data) {\n        publicFormData[key] = exploreState.form_data[key];\n      }\n    });\n    const targetControlsState = getControlsState(exploreState, {\n      ...latestFormData,\n      ...publicFormData,\n      viz_type: targetVizType,\n    });\n    const targetFormData = {\n      ...getFormDataFromControls(targetControlsState),\n      standardizedFormData: this.serialize(),\n    };\n\n    const controlPanel = getChartControlPanelRegistry().get(targetVizType);\n    if (controlPanel?.denormalizeFormData) {\n      const transformed = controlPanel.denormalizeFormData(targetFormData);\n      return {\n        formData: transformed,\n        controlsState: getControlsState(exploreState, transformed),\n      };\n    }\n\n    return {\n      formData: targetFormData,\n      controlsState: targetControlsState,\n    };\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { makeApi } from '@superset-ui/core';\nimport { useEffect, useMemo, useRef, useState } from 'react';\n\nexport enum ResourceStatus {\n  LOADING = 'loading',\n  COMPLETE = 'complete',\n  ERROR = 'error',\n}\n\n/**\n * An object containing the data fetched from the API,\n * as well as loading and error info\n */\nexport type Resource<T> = LoadingState | CompleteState<T> | ErrorState;\n\n// Trying out something a little different: a separate type per status.\n// This should let Typescript know whether a Resource has a result or error.\n// It's possible that I'm expecting too much from Typescript here.\n// If this ends up causing problems, we can change the type to:\n//\n// export type Resource<T> = {\n//   status: ResourceStatus;\n//   result: null | T;\n//   error: null | Error;\n// }\n\ntype LoadingState = {\n  status: ResourceStatus.LOADING;\n  result: null;\n  error: null;\n};\n\ntype CompleteState<T> = {\n  status: ResourceStatus.COMPLETE;\n  result: T;\n  error: null;\n};\n\ntype ErrorState = {\n  status: ResourceStatus.ERROR;\n  result: null;\n  error: Error;\n};\n\nconst initialState: LoadingState = {\n  status: ResourceStatus.LOADING,\n  result: null,\n  error: null,\n};\n\n/**\n * A general-purpose hook to fetch the response from an endpoint.\n * Returns the full response body from the API, including metadata.\n *\n * Note: You likely want {useApiV1Resource} instead of this!\n *\n * TODO Store the state in redux or something, share state between hook instances.\n *\n * TODO Include a function in the returned resource object to refresh the data.\n *\n * A core design decision here is composition > configuration,\n * and every hook should only have one job.\n * Please address new needs with new hooks if possible,\n * rather than adding config options to this hook.\n *\n * @param endpoint The url where the resource is located.\n */\nexport function useApiResourceFullBody<RESULT>(\n  endpoint: string,\n): Resource<RESULT> {\n  const [resource, setResource] = useState<Resource<RESULT>>(initialState);\n  const cancelRef = useRef<() => void>(() => {});\n\n  useEffect(() => {\n    // If refresh is implemented, this will need to change.\n    // The previous values should stay during refresh.\n    setResource(initialState);\n\n    // when this effect runs, the endpoint has changed.\n    // cancel any current calls so that state doesn't get messed up.\n    cancelRef.current();\n    let cancelled = false;\n    cancelRef.current = () => {\n      cancelled = true;\n    };\n\n    const fetchResource = makeApi<{}, RESULT>({\n      method: 'GET',\n      endpoint,\n    });\n\n    fetchResource({})\n      .then(result => {\n        if (!cancelled) {\n          setResource({\n            status: ResourceStatus.COMPLETE,\n            result,\n            error: null,\n          });\n        }\n      })\n      .catch(error => {\n        if (!cancelled) {\n          setResource({\n            status: ResourceStatus.ERROR,\n            result: null,\n            error,\n          });\n        }\n      });\n\n    // Cancel the request when the component un-mounts\n    return () => {\n      cancelled = true;\n    };\n  }, [endpoint]);\n\n  return resource;\n}\n\n/**\n * For when you want to transform the result of an api resource hook before using it.\n *\n * @param resource the Resource object returned from useApiV1Resource\n * @param transformFn a callback that transforms the result object into the shape you want.\n * Make sure to use a persistent function for this so it doesn't constantly recalculate!\n */\nexport function useTransformedResource<IN, OUT>(\n  resource: Resource<IN>,\n  transformFn: (result: IN) => OUT,\n): Resource<OUT> {\n  return useMemo(() => {\n    if (resource.status !== ResourceStatus.COMPLETE) {\n      // While incomplete, there is no result - no need to transform.\n      return resource;\n    }\n    try {\n      return {\n        ...resource,\n        result: transformFn(resource.result),\n      };\n    } catch (e) {\n      return {\n        status: ResourceStatus.ERROR,\n        result: null,\n        error: e,\n      };\n    }\n  }, [resource, transformFn]);\n}\n\n// returns the \"result\" field from a fetched API v1 endpoint\nconst extractInnerResult = <T>(responseBody: { result: T }) =>\n  responseBody.result;\n\n/**\n * A general-purpose hook to fetch a Superset resource from a v1 API endpoint.\n * Handles request lifecycle and async logic so you don't have to.\n *\n * This returns the data under the \"result\" field in the API response body.\n * If you need the full response body, use {useFullApiResource} instead.\n *\n * @param endpoint The url where the resource is located.\n */\nexport function useApiV1Resource<RESULT>(endpoint: string): Resource<RESULT> {\n  return useTransformedResource(\n    useApiResourceFullBody<{ result: RESULT }>(endpoint),\n    extractInnerResult,\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { EffectCallback, useEffect, useRef } from 'react';\n\nexport const useComponentDidUpdate = (effect: EffectCallback) => {\n  const isMountedRef = useRef(false);\n  useEffect(() => {\n    if (isMountedRef.current) {\n      effect();\n    } else {\n      isMountedRef.current = true;\n    }\n  }, [effect]);\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useEffect, useRef } from 'react';\n\n/**\n * Pass in a piece of state.\n * This hook returns what the value of that state was in the previous render.\n * Returns undefined (or whatever value you specify) the first time.\n */\nexport function usePrevious<T>(value: T): T | undefined;\nexport function usePrevious<T, INIT>(value: T, initialValue: INIT): T | INIT;\nexport function usePrevious<T>(value: T, initialValue?: any): T {\n  const previous = useRef<T>(initialValue);\n  useEffect(() => {\n    // useEffect runs after the render completes\n    previous.current = value;\n  }, [value]);\n  return previous.current;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n// Log event names ------------------------------------------------------------\nexport const LOG_ACTIONS_LOAD_CHART = 'load_chart';\nexport const LOG_ACTIONS_RENDER_CHART = 'render_chart';\nexport const LOG_ACTIONS_HIDE_BROWSER_TAB = 'hide_browser_tab';\n\nexport const LOG_ACTIONS_MOUNT_DASHBOARD = 'mount_dashboard';\nexport const LOG_ACTIONS_MOUNT_EXPLORER = 'mount_explorer';\n\nexport const LOG_ACTIONS_SELECT_DASHBOARD_TAB = 'select_dashboard_tab';\nexport const LOG_ACTIONS_FORCE_REFRESH_CHART = 'force_refresh_chart';\nexport const LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS = 'change_explore_controls';\nexport const LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD = 'toggle_edit_dashboard';\nexport const LOG_ACTIONS_FORCE_REFRESH_DASHBOARD = 'force_refresh_dashboard';\nexport const LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD =\n  'periodic_render_dashboard';\nexport const LOG_ACTIONS_EXPLORE_DASHBOARD_CHART = 'explore_dashboard_chart';\nexport const LOG_ACTIONS_EXPORT_CSV_DASHBOARD_CHART =\n  'export_csv_dashboard_chart';\nexport const LOG_ACTIONS_CHANGE_DASHBOARD_FILTER = 'change_dashboard_filter';\n\n// Log event types --------------------------------------------------------------\nexport const LOG_EVENT_TYPE_TIMING = new Set([\n  LOG_ACTIONS_LOAD_CHART,\n  LOG_ACTIONS_RENDER_CHART,\n  LOG_ACTIONS_HIDE_BROWSER_TAB,\n]);\nexport const LOG_EVENT_TYPE_USER = new Set([\n  LOG_ACTIONS_MOUNT_DASHBOARD,\n  LOG_ACTIONS_SELECT_DASHBOARD_TAB,\n  LOG_ACTIONS_EXPLORE_DASHBOARD_CHART,\n  LOG_ACTIONS_FORCE_REFRESH_CHART,\n  LOG_ACTIONS_EXPORT_CSV_DASHBOARD_CHART,\n  LOG_ACTIONS_CHANGE_DASHBOARD_FILTER,\n  LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS,\n  LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD,\n  LOG_ACTIONS_FORCE_REFRESH_DASHBOARD,\n  LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD,\n  LOG_ACTIONS_MOUNT_EXPLORER,\n]);\n\nexport const Logger = {\n  timeOriginOffset: 0,\n\n  markTimeOrigin() {\n    this.timeOriginOffset = window.performance.now();\n  },\n\n  // note that this returns ms since last navigation, NOT ms since epoch\n  getTimestamp() {\n    return Math.round(window.performance.now() - this.timeOriginOffset);\n  },\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { Dispatch } from 'redux';\n\nexport const LOG_EVENT = 'LOG_EVENT';\n\nexport function logEvent(eventName: string, eventData: Record<string, any>) {\n  return (dispatch: Dispatch) =>\n    dispatch({\n      type: LOG_EVENT,\n      payload: {\n        eventName,\n        eventData,\n      },\n    });\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  ensureIsArray,\n  makeApi,\n  SupersetClient,\n  logging,\n} from '@superset-ui/core';\nimport { SupersetError } from 'src/components/ErrorMessage/types';\nimport { FeatureFlag, isFeatureEnabled } from '../featureFlags';\nimport {\n  getClientErrorObject,\n  parseErrorJson,\n} from '../utils/getClientErrorObject';\n\ntype AsyncEvent = {\n  id?: string | null;\n  channel_id: string;\n  job_id: string;\n  user_id?: string;\n  status: string;\n  errors?: SupersetError[];\n  result_url: string | null;\n};\n\ntype CachedDataResponse = {\n  status: string;\n  data: any;\n};\ntype AppConfig = Record<string, any>;\ntype ListenerFn = (asyncEvent: AsyncEvent) => Promise<any>;\n\nconst TRANSPORT_POLLING = 'polling';\nconst TRANSPORT_WS = 'ws';\nconst JOB_STATUS = {\n  PENDING: 'pending',\n  RUNNING: 'running',\n  ERROR: 'error',\n  DONE: 'done',\n};\nconst LOCALSTORAGE_KEY = 'last_async_event_id';\nconst POLLING_URL = '/api/v1/async_event/';\nconst MAX_RETRIES = 6;\nconst RETRY_DELAY = 100;\n\nlet config: AppConfig;\nlet transport: string;\nlet pollingDelayMs: number;\nlet pollingTimeoutId: number;\nlet listenersByJobId: Record<string, ListenerFn>;\nlet retriesByJobId: Record<string, number>;\nlet lastReceivedEventId: string | null | undefined;\n\nconst addListener = (id: string, fn: any) => {\n  listenersByJobId[id] = fn;\n};\n\nconst removeListener = (id: string) => {\n  if (!listenersByJobId[id]) return;\n  delete listenersByJobId[id];\n};\n\nconst fetchCachedData = async (\n  asyncEvent: AsyncEvent,\n): Promise<CachedDataResponse> => {\n  let status = 'success';\n  let data;\n  try {\n    const { json } = await SupersetClient.get({\n      endpoint: String(asyncEvent.result_url),\n    });\n    data = 'result' in json ? json.result : json;\n  } catch (response) {\n    status = 'error';\n    data = await getClientErrorObject(response);\n  }\n\n  return { status, data };\n};\n\nexport const waitForAsyncData = async (asyncResponse: AsyncEvent) =>\n  new Promise((resolve, reject) => {\n    const jobId = asyncResponse.job_id;\n    const listener = async (asyncEvent: AsyncEvent) => {\n      switch (asyncEvent.status) {\n        case JOB_STATUS.DONE: {\n          let { data, status } = await fetchCachedData(asyncEvent); // eslint-disable-line prefer-const\n          data = ensureIsArray(data);\n          if (status === 'success') {\n            resolve(data);\n          } else {\n            reject(data);\n          }\n          break;\n        }\n        case JOB_STATUS.ERROR: {\n          const err = parseErrorJson(asyncEvent);\n          reject(err);\n          break;\n        }\n        default: {\n          logging.warn('received event with status', asyncEvent.status);\n        }\n      }\n      removeListener(jobId);\n    };\n    addListener(jobId, listener);\n  });\n\nconst fetchEvents = makeApi<\n  { last_id?: string | null },\n  { result: AsyncEvent[] }\n>({\n  method: 'GET',\n  endpoint: POLLING_URL,\n});\n\nconst setLastId = (asyncEvent: AsyncEvent) => {\n  lastReceivedEventId = asyncEvent.id;\n  try {\n    localStorage.setItem(LOCALSTORAGE_KEY, lastReceivedEventId as string);\n  } catch (err) {\n    logging.warn('Error saving event Id to localStorage', err);\n  }\n};\n\nexport const processEvents = async (events: AsyncEvent[]) => {\n  events.forEach((asyncEvent: AsyncEvent) => {\n    const jobId = asyncEvent.job_id;\n    const listener = listenersByJobId[jobId];\n    if (listener) {\n      listener(asyncEvent);\n      delete retriesByJobId[jobId];\n    } else {\n      // handle race condition where event is received\n      // before listener is registered\n      if (!retriesByJobId[jobId]) retriesByJobId[jobId] = 0;\n      retriesByJobId[jobId] += 1;\n\n      if (retriesByJobId[jobId] <= MAX_RETRIES) {\n        setTimeout(() => {\n          processEvents([asyncEvent]);\n        }, RETRY_DELAY * retriesByJobId[jobId]);\n      } else {\n        delete retriesByJobId[jobId];\n        logging.warn('listener not found for job_id', asyncEvent.job_id);\n      }\n    }\n    setLastId(asyncEvent);\n  });\n};\n\nconst loadEventsFromApi = async () => {\n  const eventArgs = lastReceivedEventId ? { last_id: lastReceivedEventId } : {};\n  if (Object.keys(listenersByJobId).length) {\n    try {\n      const { result: events } = await fetchEvents(eventArgs);\n      if (events && events.length) await processEvents(events);\n    } catch (err) {\n      logging.warn(err);\n    }\n  }\n\n  if (transport === TRANSPORT_POLLING) {\n    pollingTimeoutId = window.setTimeout(loadEventsFromApi, pollingDelayMs);\n  }\n};\n\nconst wsConnectMaxRetries = 6;\nconst wsConnectErrorDelay = 2500;\nlet wsConnectRetries = 0;\nlet wsConnectTimeout: any;\nlet ws: WebSocket;\n\nconst wsConnect = (): void => {\n  let url = config.GLOBAL_ASYNC_QUERIES_WEBSOCKET_URL;\n  if (lastReceivedEventId) url += `?last_id=${lastReceivedEventId}`;\n  ws = new WebSocket(url);\n\n  ws.addEventListener('open', () => {\n    logging.log('WebSocket connected');\n    clearTimeout(wsConnectTimeout);\n    wsConnectRetries = 0;\n  });\n\n  ws.addEventListener('close', () => {\n    wsConnectTimeout = setTimeout(() => {\n      wsConnectRetries += 1;\n      if (wsConnectRetries <= wsConnectMaxRetries) {\n        wsConnect();\n      } else {\n        logging.warn('WebSocket not available, falling back to async polling');\n        loadEventsFromApi();\n      }\n    }, wsConnectErrorDelay);\n  });\n\n  ws.addEventListener('error', () => {\n    // https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/readyState\n    if (ws.readyState < 2) ws.close();\n  });\n\n  ws.addEventListener('message', async event => {\n    let events: AsyncEvent[] = [];\n    try {\n      events = [JSON.parse(event.data)];\n      await processEvents(events);\n    } catch (err) {\n      logging.warn(err);\n    }\n  });\n};\n\nexport const init = (appConfig?: AppConfig) => {\n  if (!isFeatureEnabled(FeatureFlag.GLOBAL_ASYNC_QUERIES)) return;\n  if (pollingTimeoutId) clearTimeout(pollingTimeoutId);\n\n  listenersByJobId = {};\n  retriesByJobId = {};\n  lastReceivedEventId = null;\n\n  if (appConfig) {\n    config = appConfig;\n  } else {\n    // load bootstrap data from DOM\n    const appContainer = document.getElementById('app');\n    if (appContainer) {\n      const bootstrapData = JSON.parse(\n        appContainer?.getAttribute('data-bootstrap') || '{}',\n      );\n      config = bootstrapData?.common?.conf;\n    } else {\n      config = {};\n      logging.warn('asyncEvent: app config data not found');\n    }\n  }\n  transport = config.GLOBAL_ASYNC_QUERIES_TRANSPORT || TRANSPORT_POLLING;\n  pollingDelayMs = config.GLOBAL_ASYNC_QUERIES_POLLING_DELAY || 500;\n\n  try {\n    lastReceivedEventId = localStorage.getItem(LOCALSTORAGE_KEY);\n  } catch (err) {\n    logging.warn('Failed to fetch last event Id from localStorage');\n  }\n\n  if (transport === TRANSPORT_POLLING) {\n    loadEventsFromApi();\n  }\n  if (transport === TRANSPORT_WS) {\n    wsConnect();\n  }\n};\n\ninit();\n","import { JsonObject, Locale } from '@superset-ui/core';\nimport { isPlainObject } from 'lodash';\n\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport type User = {\n  createdOn?: string;\n  email?: string;\n  firstName: string;\n  isActive: boolean;\n  isAnonymous: boolean;\n  lastName: string;\n  userId?: number; // optional because guest user doesn't have a user id\n  username: string;\n};\n\nexport type UserRoles = Record<string, [string, string][]>;\nexport interface PermissionsAndRoles {\n  permissions: {\n    database_access?: string[];\n    datasource_access?: string[];\n  };\n  roles: UserRoles;\n}\n\nexport type UserWithPermissionsAndRoles = User & PermissionsAndRoles;\n\nexport type UndefinedUser = {};\n\nexport type BootstrapUser = UserWithPermissionsAndRoles | undefined;\n\nexport type Dashboard = {\n  dttm: number;\n  id: number;\n  url: string;\n  title: string;\n  creator?: string;\n  creator_url?: string;\n};\n\nexport type DashboardData = {\n  dashboard_title?: string;\n  created_on_delta_humanized?: string;\n  url: string;\n};\n\nexport type DashboardResponse = {\n  result: DashboardData[];\n};\n\nexport interface CommonBootstrapData {\n  flash_messages: string[][];\n  conf: JsonObject;\n  locale: Locale;\n  feature_flags: Record<string, boolean>;\n}\n\nexport function isUser(user: any): user is User {\n  return isPlainObject(user) && 'username' in user;\n}\n\nexport function isUserWithPermissionsAndRoles(\n  user: any,\n): user is UserWithPermissionsAndRoles {\n  return isUser(user) && 'permissions' in user && 'roles' in user;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { JsonObject } from '@superset-ui/core';\n\ntype TestWithIdType<T> = T extends string ? string : { 'data-test': string };\n\n// Using bem standard\nexport const testWithId =\n  <T extends string | JsonObject = JsonObject>(\n    prefix?: string,\n    idOnly = false,\n  ) =>\n  (id?: string, localIdOnly = false): TestWithIdType<T> => {\n    const resultIdOnly = localIdOnly || idOnly;\n    if (!id && prefix) {\n      return (\n        resultIdOnly ? prefix : { 'data-test': prefix }\n      ) as TestWithIdType<T>;\n    }\n    if (id && !prefix) {\n      return (resultIdOnly ? id : { 'data-test': id }) as TestWithIdType<T>;\n    }\n    if (!id && !prefix) {\n      console.warn('testWithId function has missed \"prefix\" and \"id\" params');\n      return (resultIdOnly ? '' : { 'data-test': '' }) as TestWithIdType<T>;\n    }\n    const newId = `${prefix}__${id}`;\n    return (resultIdOnly ? newId : { 'data-test': newId }) as TestWithIdType<T>;\n  };\n","/* Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint-disable global-require */\nconst loadModule = () => {\n  let module;\n  try {\n    // @ts-ignore\n    module = require('../../../superset_text'); // eslint-disable-line import/no-unresolved\n  } catch (e) {\n    module = {};\n  }\n  return module;\n};\n\nconst supersetText = loadModule();\n\nexport default supersetText;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * 'License'); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * 'AS IS' BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { JsonObject, QueryFormData, SupersetClient } from '@superset-ui/core';\nimport rison from 'rison';\nimport { isEmpty } from 'lodash';\nimport { getClientErrorObject } from './getClientErrorObject';\nimport {\n  RESERVED_CHART_URL_PARAMS,\n  RESERVED_DASHBOARD_URL_PARAMS,\n  URL_PARAMS,\n} from '../constants';\nimport { getActiveFilters } from '../dashboard/util/activeDashboardFilters';\nimport serializeActiveFilterValues from '../dashboard/util/serializeActiveFilterValues';\n\nexport type UrlParamType = 'string' | 'number' | 'boolean' | 'object' | 'rison';\nexport type UrlParam = typeof URL_PARAMS[keyof typeof URL_PARAMS];\nexport function getUrlParam(\n  param: UrlParam & { type: 'string' },\n): string | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'number' },\n): number | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'boolean' },\n): boolean | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'object' },\n): object | null;\nexport function getUrlParam(param: UrlParam & { type: 'rison' }): object | null;\nexport function getUrlParam(\n  param: UrlParam & { type: 'rison | string' },\n): string | object | null;\nexport function getUrlParam({ name, type }: UrlParam): unknown {\n  const urlParam = new URLSearchParams(window.location.search).get(name);\n  switch (type) {\n    case 'number':\n      if (!urlParam) {\n        return null;\n      }\n      if (urlParam === 'true') {\n        return 1;\n      }\n      if (urlParam === 'false') {\n        return 0;\n      }\n      if (!Number.isNaN(Number(urlParam))) {\n        return Number(urlParam);\n      }\n      return null;\n    case 'object':\n      if (!urlParam) {\n        return null;\n      }\n      return JSON.parse(urlParam);\n    case 'boolean':\n      if (!urlParam) {\n        return null;\n      }\n      return urlParam !== 'false' && urlParam !== '0';\n    case 'rison':\n      if (!urlParam) {\n        return null;\n      }\n      try {\n        return rison.decode(urlParam);\n      } catch {\n        return urlParam;\n      }\n    default:\n      return urlParam;\n  }\n}\n\nfunction getUrlParams(excludedParams: string[]): URLSearchParams {\n  const urlParams = new URLSearchParams();\n  const currentParams = new URLSearchParams(window.location.search);\n  currentParams.forEach((value, key) => {\n    if (!excludedParams.includes(key)) urlParams.append(key, value);\n  });\n  return urlParams;\n}\n\ntype UrlParamEntries = [string, string][];\n\nfunction getUrlParamEntries(urlParams: URLSearchParams): UrlParamEntries {\n  const urlEntries: [string, string][] = [];\n  urlParams.forEach((value, key) => urlEntries.push([key, value]));\n  return urlEntries;\n}\n\nfunction getChartUrlParams(excludedUrlParams?: string[]): UrlParamEntries {\n  const excludedParams = excludedUrlParams || RESERVED_CHART_URL_PARAMS;\n  const urlParams = getUrlParams(excludedParams);\n  const filterBoxFilters = getActiveFilters();\n  if (\n    !isEmpty(filterBoxFilters) &&\n    !excludedParams.includes(URL_PARAMS.preselectFilters.name)\n  )\n    urlParams.append(\n      URL_PARAMS.preselectFilters.name,\n      JSON.stringify(serializeActiveFilterValues(getActiveFilters())),\n    );\n  return getUrlParamEntries(urlParams);\n}\n\nfunction getDashboardUrlParams(): UrlParamEntries {\n  const urlParams = getUrlParams(RESERVED_DASHBOARD_URL_PARAMS);\n  const filterBoxFilters = getActiveFilters();\n  if (!isEmpty(filterBoxFilters))\n    urlParams.append(\n      URL_PARAMS.preselectFilters.name,\n      JSON.stringify(serializeActiveFilterValues(getActiveFilters())),\n    );\n  return getUrlParamEntries(urlParams);\n}\n\nfunction getPermalink(endpoint: string, jsonPayload: JsonObject) {\n  return SupersetClient.post({\n    endpoint,\n    jsonPayload,\n  })\n    .then(result => result.json.url as string)\n    .catch(response =>\n      // @ts-ignore\n      getClientErrorObject(response).then(({ error, statusText }) =>\n        Promise.reject(error || statusText),\n      ),\n    );\n}\n\nexport function getChartPermalink(\n  formData: Pick<QueryFormData, 'datasource'>,\n  excludedUrlParams?: string[],\n) {\n  return getPermalink('/api/v1/explore/permalink', {\n    formData,\n    urlParams: getChartUrlParams(excludedUrlParams),\n  });\n}\n\nexport function getDashboardPermalink({\n  dashboardId,\n  filterState,\n  hash, // the anchor part of the link which corresponds to the tab/chart id\n}: {\n  dashboardId: string | number;\n  filterState: JsonObject;\n  hash?: string;\n}) {\n  // only encode filter box state if non-empty\n  return getPermalink(`/api/v1/dashboard/${dashboardId}/permalink`, {\n    filterState,\n    urlParams: getDashboardUrlParams(),\n    hash,\n  });\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\n\nexport const PAGE_SIZE = 25;\nexport const SORT_BY = [{ id: 'changed_on_delta_humanized', desc: true }];\nexport const PASSWORDS_NEEDED_MESSAGE = t(\n  'The passwords for the databases below are needed in order to ' +\n    'import them together with the datasets. Please note that the ' +\n    '\"Secure Extra\" and \"Certificate\" sections of ' +\n    'the database configuration are not present in export files, and ' +\n    'should be added manually after the import if they are needed.',\n);\nexport const CONFIRM_OVERWRITE_MESSAGE = t(\n  'You are importing one or more datasets that already exist. ' +\n    'Overwriting might cause you to lose some of your work. Are you ' +\n    'sure you want to overwrite?',\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport rison from 'rison';\nimport { useState, useEffect, useCallback } from 'react';\nimport { makeApi, SupersetClient, t, JsonObject } from '@superset-ui/core';\n\nimport {\n  createErrorHandler,\n  getAlreadyExists,\n  getPasswordsNeeded,\n  hasTerminalValidation,\n} from 'src/views/CRUD/utils';\nimport { FetchDataConfig } from 'src/components/ListView';\nimport { FilterValue } from 'src/components/ListView/types';\nimport Chart, { Slice } from 'src/types/Chart';\nimport copyTextToClipboard from 'src/utils/copy';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport SupersetText from 'src/utils/textUtils';\nimport { FavoriteStatus, ImportResourceName, DatabaseObject } from './types';\n\ninterface ListViewResourceState<D extends object = any> {\n  loading: boolean;\n  collection: D[];\n  count: number;\n  permissions: string[];\n  lastFetchDataConfig: FetchDataConfig | null;\n  bulkSelectEnabled: boolean;\n  lastFetched?: string;\n}\n\nconst parsedErrorMessage = (\n  errorMessage: Record<string, string[] | string> | string,\n) => {\n  if (typeof errorMessage === 'string') {\n    return errorMessage;\n  }\n  return Object.entries(errorMessage)\n    .map(([key, value]) => {\n      if (Array.isArray(value)) {\n        return `(${key}) ${value.join(', ')}`;\n      }\n      return `(${key}) ${value}`;\n    })\n    .join('\\n');\n};\n\nexport function useListViewResource<D extends object = any>(\n  resource: string,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n  infoEnable = true,\n  defaultCollectionValue: D[] = [],\n  baseFilters?: FilterValue[], // must be memoized\n  initialLoadingState = true,\n) {\n  const [state, setState] = useState<ListViewResourceState<D>>({\n    count: 0,\n    collection: defaultCollectionValue,\n    loading: initialLoadingState,\n    lastFetchDataConfig: null,\n    permissions: [],\n    bulkSelectEnabled: false,\n  });\n\n  function updateState(update: Partial<ListViewResourceState<D>>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  function toggleBulkSelect() {\n    updateState({ bulkSelectEnabled: !state.bulkSelectEnabled });\n  }\n\n  useEffect(() => {\n    if (!infoEnable) return;\n    SupersetClient.get({\n      endpoint: `/api/v1/${resource}/_info?q=${rison.encode({\n        keys: ['permissions'],\n      })}`,\n    }).then(\n      ({ json: infoJson = {} }) => {\n        updateState({\n          permissions: infoJson.permissions,\n        });\n      },\n      createErrorHandler(errMsg =>\n        handleErrorMsg(\n          t(\n            'An error occurred while fetching %s info: %s',\n            resourceLabel,\n            errMsg,\n          ),\n        ),\n      ),\n    );\n  }, []);\n\n  function hasPerm(perm: string) {\n    if (!state.permissions.length) {\n      return false;\n    }\n\n    return Boolean(state.permissions.find(p => p === perm));\n  }\n\n  const fetchData = useCallback(\n    ({\n      pageIndex,\n      pageSize,\n      sortBy,\n      filters: filterValues,\n    }: FetchDataConfig) => {\n      // set loading state, cache the last config for refreshing data.\n      updateState({\n        lastFetchDataConfig: {\n          filters: filterValues,\n          pageIndex,\n          pageSize,\n          sortBy,\n        },\n        loading: true,\n      });\n\n      const filterExps = (baseFilters || [])\n        .concat(filterValues)\n        .map(({ id, operator: opr, value }) => ({\n          col: id,\n          opr,\n          value:\n            value && typeof value === 'object' && 'value' in value\n              ? value.value\n              : value,\n        }));\n\n      const queryParams = rison.encode_uri({\n        order_column: sortBy[0].id,\n        order_direction: sortBy[0].desc ? 'desc' : 'asc',\n        page: pageIndex,\n        page_size: pageSize,\n        ...(filterExps.length ? { filters: filterExps } : {}),\n      });\n\n      return SupersetClient.get({\n        endpoint: `/api/v1/${resource}/?q=${queryParams}`,\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              collection: json.result,\n              count: json.count,\n              lastFetched: new Date().toISOString(),\n            });\n          },\n          createErrorHandler(errMsg =>\n            handleErrorMsg(\n              t(\n                'An error occurred while fetching %ss: %s',\n                resourceLabel,\n                errMsg,\n              ),\n            ),\n          ),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [baseFilters],\n  );\n\n  return {\n    state: {\n      loading: state.loading,\n      resourceCount: state.count,\n      resourceCollection: state.collection,\n      bulkSelectEnabled: state.bulkSelectEnabled,\n      lastFetched: state.lastFetched,\n    },\n    setResourceCollection: (update: D[]) =>\n      updateState({\n        collection: update,\n      }),\n    hasPerm,\n    fetchData,\n    toggleBulkSelect,\n    refreshData: (provideConfig?: FetchDataConfig) => {\n      if (state.lastFetchDataConfig) {\n        return fetchData(state.lastFetchDataConfig);\n      }\n      if (provideConfig) {\n        return fetchData(provideConfig);\n      }\n      return null;\n    },\n  };\n}\n\n// In the same vein as above, a hook for viewing a single instance of a resource (given id)\ninterface SingleViewResourceState<D extends object = any> {\n  loading: boolean;\n  resource: D | null;\n  error: any | null;\n}\n\nexport function useSingleViewResource<D extends object = any>(\n  resourceName: string,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n) {\n  const [state, setState] = useState<SingleViewResourceState<D>>({\n    loading: false,\n    resource: null,\n    error: null,\n  });\n\n  function updateState(update: Partial<SingleViewResourceState<D>>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  const fetchResource = useCallback(\n    (resourceID: number) => {\n      // Set loading state\n      updateState({\n        loading: true,\n      });\n\n      return SupersetClient.get({\n        endpoint: `/api/v1/${resourceName}/${resourceID}`,\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: json.result,\n              error: null,\n            });\n            return json.result;\n          },\n          createErrorHandler((errMsg: Record<string, string[] | string>) => {\n            handleErrorMsg(\n              t(\n                'An error occurred while fetching %ss: %s',\n                resourceLabel,\n                parsedErrorMessage(errMsg),\n              ),\n            );\n\n            updateState({\n              error: errMsg,\n            });\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const createResource = useCallback(\n    (resource: D, hideToast = false) => {\n      // Set loading state\n      updateState({\n        loading: true,\n      });\n\n      return SupersetClient.post({\n        endpoint: `/api/v1/${resourceName}/`,\n        body: JSON.stringify(resource),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: { id: json.id, ...json.result },\n              error: null,\n            });\n            return json.id;\n          },\n          createErrorHandler((errMsg: Record<string, string[] | string>) => {\n            // we did not want toasts for db-connection-ui but did not want to disable it everywhere\n            if (!hideToast) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while creating %ss: %s',\n                  resourceLabel,\n                  parsedErrorMessage(errMsg),\n                ),\n              );\n            }\n\n            updateState({\n              error: errMsg,\n            });\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const updateResource = useCallback(\n    (resourceID: number, resource: D, hideToast = false, setLoading = true) => {\n      // Set loading state\n      if (setLoading) {\n        updateState({\n          loading: true,\n        });\n      }\n\n      return SupersetClient.put({\n        endpoint: `/api/v1/${resourceName}/${resourceID}`,\n        body: JSON.stringify(resource),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(\n          ({ json = {} }) => {\n            updateState({\n              resource: { ...json.result, id: json.id },\n              error: null,\n            });\n            return json.result;\n          },\n          createErrorHandler(errMsg => {\n            if (!hideToast) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while fetching %ss: %s',\n                  resourceLabel,\n                  JSON.stringify(errMsg),\n                ),\n              );\n            }\n\n            updateState({\n              error: errMsg,\n            });\n\n            return errMsg;\n          }),\n        )\n        .finally(() => {\n          if (setLoading) {\n            updateState({ loading: false });\n          }\n        });\n    },\n    [handleErrorMsg, resourceName, resourceLabel],\n  );\n\n  const clearError = () =>\n    updateState({\n      error: null,\n    });\n\n  return {\n    state,\n    setResource: (update: D) =>\n      updateState({\n        resource: update,\n      }),\n    fetchResource,\n    createResource,\n    updateResource,\n    clearError,\n  };\n}\n\ninterface ImportResourceState {\n  loading: boolean;\n  passwordsNeeded: string[];\n  alreadyExists: string[];\n  failed: boolean;\n}\n\nexport function useImportResource(\n  resourceName: ImportResourceName,\n  resourceLabel: string, // resourceLabel for translations\n  handleErrorMsg: (errorMsg: string) => void,\n) {\n  const [state, setState] = useState<ImportResourceState>({\n    loading: false,\n    passwordsNeeded: [],\n    alreadyExists: [],\n    failed: false,\n  });\n\n  function updateState(update: Partial<ImportResourceState>) {\n    setState(currentState => ({ ...currentState, ...update }));\n  }\n\n  const importResource = useCallback(\n    (\n      bundle: File,\n      databasePasswords: Record<string, string> = {},\n      overwrite = false,\n    ) => {\n      // Set loading state\n      updateState({\n        loading: true,\n        failed: false,\n      });\n\n      const formData = new FormData();\n      formData.append('formData', bundle);\n\n      /* The import bundle never contains database passwords; if required\n       * they should be provided by the user during import.\n       */\n      if (databasePasswords) {\n        formData.append('passwords', JSON.stringify(databasePasswords));\n      }\n      /* If the imported model already exists the user needs to confirm\n       * that they want to overwrite it.\n       */\n      if (overwrite) {\n        formData.append('overwrite', 'true');\n      }\n\n      return SupersetClient.post({\n        endpoint: `/api/v1/${resourceName}/import/`,\n        body: formData,\n        headers: { Accept: 'application/json' },\n      })\n        .then(() => {\n          updateState({\n            passwordsNeeded: [],\n            alreadyExists: [],\n            failed: false,\n          });\n          return true;\n        })\n        .catch(response =>\n          getClientErrorObject(response).then(error => {\n            updateState({\n              failed: true,\n            });\n            if (!error.errors) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while importing %s: %s',\n                  resourceLabel,\n                  error.message || error.error,\n                ),\n              );\n              return false;\n            }\n            if (hasTerminalValidation(error.errors)) {\n              handleErrorMsg(\n                t(\n                  'An error occurred while importing %s: %s',\n                  resourceLabel,\n                  [\n                    ...error.errors.map(payload => payload.message),\n                    t('Please re-export your file and try importing again'),\n                  ].join('\\n'),\n                ),\n              );\n            } else {\n              updateState({\n                passwordsNeeded: getPasswordsNeeded(error.errors),\n                alreadyExists: getAlreadyExists(error.errors),\n              });\n            }\n            return false;\n          }),\n        )\n        .finally(() => {\n          updateState({ loading: false });\n        });\n    },\n    [],\n  );\n\n  return { state, importResource };\n}\n\nenum FavStarClassName {\n  CHART = 'slice',\n  DASHBOARD = 'Dashboard',\n}\n\ntype FavoriteStatusResponse = {\n  result: Array<{\n    id: string;\n    value: boolean;\n  }>;\n};\n\nconst favoriteApis = {\n  chart: makeApi<Array<string | number>, FavoriteStatusResponse>({\n    requestType: 'rison',\n    method: 'GET',\n    endpoint: '/api/v1/chart/favorite_status/',\n  }),\n  dashboard: makeApi<Array<string | number>, FavoriteStatusResponse>({\n    requestType: 'rison',\n    method: 'GET',\n    endpoint: '/api/v1/dashboard/favorite_status/',\n  }),\n};\n\nexport function useFavoriteStatus(\n  type: 'chart' | 'dashboard',\n  ids: Array<string | number>,\n  handleErrorMsg: (message: string) => void,\n) {\n  const [favoriteStatus, setFavoriteStatus] = useState<FavoriteStatus>({});\n\n  const updateFavoriteStatus = (update: FavoriteStatus) =>\n    setFavoriteStatus(currentState => ({ ...currentState, ...update }));\n\n  useEffect(() => {\n    if (!ids.length) {\n      return;\n    }\n    favoriteApis[type](ids).then(\n      ({ result }) => {\n        const update = result.reduce((acc, element) => {\n          acc[element.id] = element.value;\n          return acc;\n        }, {});\n        updateFavoriteStatus(update);\n      },\n      createErrorHandler(errMsg =>\n        handleErrorMsg(\n          t('There was an error fetching the favorite status: %s', errMsg),\n        ),\n      ),\n    );\n  }, [ids, type, handleErrorMsg]);\n\n  const saveFaveStar = useCallback(\n    (id: number, isStarred: boolean) => {\n      const urlSuffix = isStarred ? 'unselect' : 'select';\n      SupersetClient.get({\n        endpoint: `/superset/favstar/${\n          type === 'chart' ? FavStarClassName.CHART : FavStarClassName.DASHBOARD\n        }/${id}/${urlSuffix}/`,\n      }).then(\n        ({ json }) => {\n          updateFavoriteStatus({\n            [id]: (json as { count: number })?.count > 0,\n          });\n        },\n        createErrorHandler(errMsg =>\n          handleErrorMsg(\n            t('There was an error saving the favorite status: %s', errMsg),\n          ),\n        ),\n      );\n    },\n    [type],\n  );\n\n  return [saveFaveStar, favoriteStatus] as const;\n}\n\nexport const useChartEditModal = (\n  setCharts: (charts: Array<Chart>) => void,\n  charts: Array<Chart>,\n) => {\n  const [sliceCurrentlyEditing, setSliceCurrentlyEditing] =\n    useState<Slice | null>(null);\n\n  function openChartEditModal(chart: Chart) {\n    setSliceCurrentlyEditing({\n      slice_id: chart.id,\n      slice_name: chart.slice_name,\n      description: chart.description,\n      cache_timeout: chart.cache_timeout,\n      certified_by: chart.certified_by,\n      certification_details: chart.certification_details,\n      is_managed_externally: chart.is_managed_externally,\n    });\n  }\n\n  function closeChartEditModal() {\n    setSliceCurrentlyEditing(null);\n  }\n\n  function handleChartUpdated(edits: Chart) {\n    // update the chart in our state with the edited info\n    const newCharts = charts.map((chart: Chart) =>\n      chart.id === edits.id ? { ...chart, ...edits } : chart,\n    );\n    setCharts(newCharts);\n  }\n\n  return {\n    sliceCurrentlyEditing,\n    handleChartUpdated,\n    openChartEditModal,\n    closeChartEditModal,\n  };\n};\n\nexport const copyQueryLink = (\n  id: number,\n  addDangerToast: (arg0: string) => void,\n  addSuccessToast: (arg0: string) => void,\n) => {\n  copyTextToClipboard(() =>\n    Promise.resolve(\n      `${window.location.origin}/superset/sqllab?savedQueryId=${id}`,\n    ),\n  )\n    .then(() => {\n      addSuccessToast(t('Link Copied!'));\n    })\n    .catch(() => {\n      addDangerToast(t('Sorry, your browser does not support copying.'));\n    });\n};\n\nexport const getDatabaseImages = () => SupersetText.DB_IMAGES;\n\nexport const getConnectionAlert = () => SupersetText.DB_CONNECTION_ALERTS;\nexport const getDatabaseDocumentationLinks = () =>\n  SupersetText.DB_CONNECTION_DOC_LINKS;\n\nexport const testDatabaseConnection = (\n  connection: DatabaseObject,\n  handleErrorMsg: (errorMsg: string) => void,\n  addSuccessToast: (arg0: string) => void,\n) => {\n  SupersetClient.post({\n    endpoint: 'api/v1/database/test_connection',\n    body: JSON.stringify(connection),\n    headers: { 'Content-Type': 'application/json' },\n  }).then(\n    () => {\n      addSuccessToast(t('Connection looks good!'));\n    },\n    createErrorHandler((errMsg: Record<string, string[] | string> | string) => {\n      handleErrorMsg(t('ERROR: %s', parsedErrorMessage(errMsg)));\n    }),\n  );\n};\n\nexport function useAvailableDatabases() {\n  const [availableDbs, setAvailableDbs] = useState<JsonObject | null>(null);\n\n  const getAvailable = useCallback(() => {\n    SupersetClient.get({\n      endpoint: `/api/v1/database/available/`,\n    }).then(({ json }) => {\n      setAvailableDbs(json);\n    });\n  }, [setAvailableDbs]);\n\n  return [availableDbs, getAvailable] as const;\n}\n\nexport function useDatabaseValidation() {\n  const [validationErrors, setValidationErrors] = useState<JsonObject | null>(\n    null,\n  );\n  const getValidation = useCallback(\n    (database: Partial<DatabaseObject> | null, onCreate = false) =>\n      SupersetClient.post({\n        endpoint: '/api/v1/database/validate_parameters',\n        body: JSON.stringify(database),\n        headers: { 'Content-Type': 'application/json' },\n      })\n        .then(() => {\n          setValidationErrors(null);\n        })\n        // eslint-disable-next-line consistent-return\n        .catch(e => {\n          if (typeof e.json === 'function') {\n            return e.json().then(({ errors = [] }: JsonObject) => {\n              const parsedErrors = errors\n                .filter((error: { error_type: string }) => {\n                  const skipValidationError = ![\n                    'CONNECTION_MISSING_PARAMETERS_ERROR',\n                    'CONNECTION_ACCESS_DENIED_ERROR',\n                  ].includes(error.error_type);\n                  return skipValidationError || onCreate;\n                })\n                .reduce(\n                  (\n                    obj: {},\n                    {\n                      error_type,\n                      extra,\n                      message,\n                    }: {\n                      error_type: string;\n                      extra: {\n                        invalid?: string[];\n                        missing?: string[];\n                        name: string;\n                        catalog: {\n                          name: string;\n                          url: string;\n                          idx: number;\n                        };\n                        issue_codes?: {\n                          code?: number;\n                          message?: string;\n                        }[];\n                      };\n                      message: string;\n                    },\n                  ) => {\n                    if (extra.catalog) {\n                      if (extra.catalog.name) {\n                        return {\n                          ...obj,\n                          error_type,\n                          [extra.catalog.idx]: {\n                            name: message,\n                          },\n                        };\n                      }\n                      if (extra.catalog.url) {\n                        return {\n                          ...obj,\n                          error_type,\n                          [extra.catalog.idx]: {\n                            url: message,\n                          },\n                        };\n                      }\n\n                      return {\n                        ...obj,\n                        error_type,\n                        [extra.catalog.idx]: {\n                          name: message,\n                          url: message,\n                        },\n                      };\n                    }\n                    // if extra.invalid doesn't exist then the\n                    // error can't be mapped to a parameter\n                    // so leave it alone\n                    if (extra.invalid) {\n                      return {\n                        ...obj,\n                        [extra.invalid[0]]: message,\n                        error_type,\n                      };\n                    }\n                    if (extra.missing) {\n                      return {\n                        ...obj,\n                        error_type,\n                        ...Object.assign(\n                          {},\n                          ...extra.missing.map(field => ({\n                            [field]: 'This is a required field',\n                          })),\n                        ),\n                      };\n                    }\n                    if (extra.issue_codes?.length) {\n                      return {\n                        ...obj,\n                        error_type,\n                        description: message || extra.issue_codes[0]?.message,\n                      };\n                    }\n\n                    return obj;\n                  },\n                  {},\n                );\n              setValidationErrors(parsedErrors);\n              return parsedErrors;\n            });\n          }\n          // eslint-disable-next-line no-console\n          console.error(e);\n        }),\n    [setValidationErrors],\n  );\n\n  return [validationErrors, getValidation, setValidationErrors] as const;\n}\n\nexport const reportSelector = (\n  state: Record<string, any>,\n  resourceType: string,\n  resourceId?: number,\n) => {\n  if (resourceId) {\n    return state.reports[resourceType]?.[resourceId];\n  }\n  return {};\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport {\n  t,\n  SupersetClient,\n  SupersetClientResponse,\n  logging,\n  styled,\n  SupersetTheme,\n  css,\n} from '@superset-ui/core';\nimport Chart from 'src/types/Chart';\nimport { intersection } from 'lodash';\nimport rison from 'rison';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { FetchDataConfig } from 'src/components/ListView';\nimport SupersetText from 'src/utils/textUtils';\nimport findPermission from 'src/dashboard/util/findPermission';\nimport { Dashboard, Filters } from './types';\n\n// Modifies the rison encoding slightly to match the backend's rison encoding/decoding. Applies globally.\n// Code pulled from rison.js (https://github.com/Nanonid/rison), rison is licensed under the MIT license.\n(() => {\n  const risonRef: {\n    not_idchar: string;\n    not_idstart: string;\n    id_ok: RegExp;\n    next_id: RegExp;\n  } = rison as any;\n\n  const l = [];\n  for (let hi = 0; hi < 16; hi += 1) {\n    for (let lo = 0; lo < 16; lo += 1) {\n      if (hi + lo === 0) continue;\n      const c = String.fromCharCode(hi * 16 + lo);\n      if (!/\\w|[-_./~]/.test(c))\n        l.push(`\\\\u00${hi.toString(16)}${lo.toString(16)}`);\n    }\n  }\n\n  risonRef.not_idchar = l.join('');\n  risonRef.not_idstart = '-0123456789';\n\n  const idrx = `[^${risonRef.not_idstart}${risonRef.not_idchar}][^${risonRef.not_idchar}]*`;\n\n  risonRef.id_ok = new RegExp(`^${idrx}$`);\n  risonRef.next_id = new RegExp(idrx, 'g');\n})();\n\nconst createFetchResourceMethod =\n  (method: string) =>\n  (\n    resource: string,\n    relation: string,\n    handleError: (error: Response) => void,\n    user?: { userId: string | number; firstName: string; lastName: string },\n  ) =>\n  async (filterValue = '', page: number, pageSize: number) => {\n    const resourceEndpoint = `/api/v1/${resource}/${method}/${relation}`;\n    const queryParams = rison.encode_uri({\n      filter: filterValue,\n      page,\n      page_size: pageSize,\n    });\n    const { json = {} } = await SupersetClient.get({\n      endpoint: `${resourceEndpoint}?q=${queryParams}`,\n    });\n\n    let fetchedLoggedUser = false;\n    const loggedUser = user\n      ? {\n          label: `${user.firstName} ${user.lastName}`,\n          value: user.userId,\n        }\n      : undefined;\n\n    const data: { label: string; value: string | number }[] = [];\n    json?.result?.forEach(\n      ({ text, value }: { text: string; value: string | number }) => {\n        if (\n          loggedUser &&\n          value === loggedUser.value &&\n          text === loggedUser.label\n        ) {\n          fetchedLoggedUser = true;\n        } else {\n          data.push({\n            label: text,\n            value,\n          });\n        }\n      },\n    );\n\n    if (loggedUser && (!filterValue || fetchedLoggedUser)) {\n      data.unshift(loggedUser);\n    }\n\n    return {\n      data,\n      totalCount: json?.count,\n    };\n  };\n\nexport const PAGE_SIZE = 5;\nconst getParams = (filters?: Array<Filters>) => {\n  const params = {\n    order_column: 'changed_on_delta_humanized',\n    order_direction: 'desc',\n    page: 0,\n    page_size: PAGE_SIZE,\n    filters,\n  };\n  if (!filters) delete params.filters;\n  return rison.encode(params);\n};\n\nexport const getEditedObjects = (userId: string | number) => {\n  const filters = {\n    edited: [\n      {\n        col: 'changed_by',\n        opr: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  const batch = [\n    SupersetClient.get({\n      endpoint: `/api/v1/dashboard/?q=${getParams(filters.edited)}`,\n    }),\n    SupersetClient.get({\n      endpoint: `/api/v1/chart/?q=${getParams(filters.edited)}`,\n    }),\n  ];\n  return Promise.all(batch)\n    .then(([editedCharts, editedDashboards]) => {\n      const res = {\n        editedDash: editedDashboards.json?.result.slice(0, 3),\n        editedChart: editedCharts.json?.result.slice(0, 3),\n      };\n      return res;\n    })\n    .catch(err => err);\n};\n\nexport const getUserOwnedObjects = (\n  userId: string | number,\n  resource: string,\n  filters: Array<Filters> = [\n    {\n      col: 'owners',\n      opr: 'rel_m_m',\n      value: `${userId}`,\n    },\n  ],\n) =>\n  SupersetClient.get({\n    endpoint: `/api/v1/${resource}/?q=${getParams(filters)}`,\n  }).then(res => res.json?.result);\n\nexport const getRecentAcitivtyObjs = (\n  userId: string | number,\n  recent: string,\n  addDangerToast: (arg1: string, arg2: any) => any,\n) =>\n  SupersetClient.get({ endpoint: recent }).then(recentsRes => {\n    const res: any = {};\n    const filters = [\n      {\n        col: 'created_by',\n        opr: 'rel_o_m',\n        value: 0,\n      },\n    ];\n    const newBatch = [\n      SupersetClient.get({\n        endpoint: `/api/v1/chart/?q=${getParams(filters)}`,\n      }),\n      SupersetClient.get({\n        endpoint: `/api/v1/dashboard/?q=${getParams(filters)}`,\n      }),\n    ];\n    return Promise.all(newBatch)\n      .then(([chartRes, dashboardRes]) => {\n        res.examples = [...chartRes.json.result, ...dashboardRes.json.result];\n        res.viewed = recentsRes.json;\n        return res;\n      })\n      .catch(errMsg =>\n        addDangerToast(\n          t('There was an error fetching your recent activity:'),\n          errMsg,\n        ),\n      );\n  });\n\nexport const createFetchRelated = createFetchResourceMethod('related');\nexport const createFetchDistinct = createFetchResourceMethod('distinct');\n\nexport function createErrorHandler(\n  handleErrorFunc: (\n    errMsg?: string | Record<string, string[] | string>,\n  ) => void,\n) {\n  return async (e: SupersetClientResponse | string) => {\n    const parsedError = await getClientErrorObject(e);\n    // Taking the first error returned from the API\n    // @ts-ignore\n    const errorsArray = parsedError?.errors;\n    const config = await SupersetText;\n    if (\n      errorsArray &&\n      errorsArray.length &&\n      config &&\n      config.ERRORS &&\n      errorsArray[0].error_type in config.ERRORS\n    ) {\n      parsedError.message = config.ERRORS[errorsArray[0].error_type];\n    }\n    logging.error(e);\n    handleErrorFunc(parsedError.message || parsedError.error);\n  };\n}\n\nexport function handleChartDelete(\n  { id, slice_name: sliceName }: Chart,\n  addSuccessToast: (arg0: string) => void,\n  addDangerToast: (arg0: string) => void,\n  refreshData: (arg0?: FetchDataConfig | null) => void,\n  chartFilter?: string,\n  userId?: string | number,\n) {\n  const filters = {\n    pageIndex: 0,\n    pageSize: PAGE_SIZE,\n    sortBy: [\n      {\n        id: 'changed_on_delta_humanized',\n        desc: true,\n      },\n    ],\n    filters: [\n      {\n        id: 'created_by',\n        operator: 'rel_o_m',\n        value: `${userId}`,\n      },\n    ],\n  };\n  SupersetClient.delete({\n    endpoint: `/api/v1/chart/${id}`,\n  }).then(\n    () => {\n      if (chartFilter === 'Mine') refreshData(filters);\n      else refreshData();\n      addSuccessToast(t('Deleted: %s', sliceName));\n    },\n    () => {\n      addDangerToast(t('There was an issue deleting: %s', sliceName));\n    },\n  );\n}\n\nexport function handleDashboardDelete(\n  { id, dashboard_title: dashboardTitle }: Dashboard,\n  refreshData: (config?: FetchDataConfig | null) => void,\n  addSuccessToast: (arg0: string) => void,\n  addDangerToast: (arg0: string) => void,\n  dashboardFilter?: string,\n  userId?: string | number,\n) {\n  return SupersetClient.delete({\n    endpoint: `/api/v1/dashboard/${id}`,\n  }).then(\n    () => {\n      const filters = {\n        pageIndex: 0,\n        pageSize: PAGE_SIZE,\n        sortBy: [\n          {\n            id: 'changed_on_delta_humanized',\n            desc: true,\n          },\n        ],\n        filters: [\n          {\n            id: 'owners',\n            operator: 'rel_m_m',\n            value: `${userId}`,\n          },\n        ],\n      };\n      if (dashboardFilter === 'Mine') refreshData(filters);\n      else refreshData();\n      addSuccessToast(t('Deleted: %s', dashboardTitle));\n    },\n    createErrorHandler(errMsg =>\n      addDangerToast(\n        t('There was an issue deleting %s: %s', dashboardTitle, errMsg),\n      ),\n    ),\n  );\n}\n\nexport function shortenSQL(sql: string, maxLines: number) {\n  let lines: string[] = sql.split('\\n');\n  if (lines.length >= maxLines) {\n    lines = lines.slice(0, maxLines);\n    lines.push('...');\n  }\n  return lines.join('\\n');\n}\n\n// loading card count for homepage\nexport const loadingCardCount = 5;\n\nconst breakpoints = [576, 768, 992, 1200];\nexport const mq = breakpoints.map(bp => `@media (max-width: ${bp}px)`);\n\nexport const CardContainer = styled.div<{\n  showThumbnails?: boolean | undefined;\n}>`\n  ${({ showThumbnails, theme }) => `\n    overflow: hidden;\n    display: grid;\n    grid-gap: ${theme.gridUnit * 12}px ${theme.gridUnit * 4}px;\n    grid-template-columns: repeat(auto-fit, 300px);\n    max-height: ${showThumbnails ? '314' : '148'}px;\n    margin-top: ${theme.gridUnit * -6}px;\n    padding: ${\n      showThumbnails\n        ? `${theme.gridUnit * 8 + 3}px ${theme.gridUnit * 9}px`\n        : `${theme.gridUnit * 8 + 1}px ${theme.gridUnit * 9}px`\n    };\n  `}\n`;\n\nexport const CardStyles = styled.div`\n  cursor: pointer;\n  a {\n    text-decoration: none;\n  }\n  .ant-card-cover > div {\n    /* Height is calculated based on 300px width, to keep the same aspect ratio as the 800*450 thumbnails */\n    height: 168px;\n  }\n`;\n\nexport const StyledIcon = (theme: SupersetTheme) => css`\n  margin: auto ${theme.gridUnit * 2}px auto 0;\n  color: ${theme.colors.grayscale.base};\n`;\n\nexport /* eslint-disable no-underscore-dangle */\nconst isNeedsPassword = (payload: any) =>\n  typeof payload === 'object' &&\n  Array.isArray(payload._schema) &&\n  payload._schema.length === 1 &&\n  payload._schema[0] === 'Must provide a password for the database';\n\nexport const isAlreadyExists = (payload: any) =>\n  typeof payload === 'string' &&\n  payload.includes('already exists and `overwrite=true` was not passed');\n\nexport const getPasswordsNeeded = (errors: Record<string, any>[]) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isNeedsPassword(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const getAlreadyExists = (errors: Record<string, any>[]) =>\n  errors\n    .map(error =>\n      Object.entries(error.extra)\n        .filter(([, payload]) => isAlreadyExists(payload))\n        .map(([fileName]) => fileName),\n    )\n    .flat();\n\nexport const hasTerminalValidation = (errors: Record<string, any>[]) =>\n  errors.some(error => {\n    const noIssuesCodes = Object.entries(error.extra).filter(\n      ([key]) => key !== 'issue_codes',\n    );\n\n    if (noIssuesCodes.length === 0) return true;\n\n    return !noIssuesCodes.every(\n      ([, payload]) => isNeedsPassword(payload) || isAlreadyExists(payload),\n    );\n  });\n\nexport const checkUploadExtensions = (\n  perm: Array<string>,\n  cons: Array<string>,\n) => {\n  if (perm !== undefined) {\n    return intersection(perm, cons).length > 0;\n  }\n  return false;\n};\n\nexport const uploadUserPerms = (\n  roles: Record<string, [string, string][]>,\n  csvExt: Array<string>,\n  colExt: Array<string>,\n  excelExt: Array<string>,\n  allowedExt: Array<string>,\n) => {\n  const canUploadCSV =\n    findPermission('can_this_form_get', 'CsvToDatabaseView', roles) &&\n    checkUploadExtensions(csvExt, allowedExt);\n  const canUploadColumnar =\n    checkUploadExtensions(colExt, allowedExt) &&\n    findPermission('can_this_form_get', 'ColumnarToDatabaseView', roles);\n  const canUploadExcel =\n    checkUploadExtensions(excelExt, allowedExt) &&\n    findPermission('can_this_form_get', 'ExcelToDatabaseView', roles);\n  return {\n    canUploadCSV,\n    canUploadColumnar,\n    canUploadExcel,\n    canUploadData: canUploadCSV || canUploadColumnar || canUploadExcel,\n  };\n};\n"],"names":["CHART_UPDATE_STARTED","chartUpdateStarted","queryController","latestQueryFormData","key","type","CHART_UPDATE_SUCCEEDED","chartUpdateSucceeded","queriesResponse","CHART_UPDATE_STOPPED","chartUpdateStopped","CHART_UPDATE_FAILED","chartUpdateFailed","CHART_RENDERING_FAILED","chartRenderingFailed","error","stackTrace","CHART_RENDERING_SUCCEEDED","chartRenderingSucceeded","REMOVE_CHART","removeChart","ANNOTATION_QUERY_SUCCESS","annotationQuerySuccess","annotation","queryResponse","ANNOTATION_QUERY_STARTED","annotationQueryStarted","ANNOTATION_QUERY_FAILED","annotationQueryFailed","DYNAMIC_PLUGIN_CONTROLS_READY","dynamicPluginControlsReady","dispatch","getState","state","controlsState","getControlsState","explore","form_data","slice_id","value","async","getChartDataRequest","formData","setDataMask","resultFormat","resultType","force","method","requestParams","ownState","querySettings","domainShardingEnabled","mode","credentials","shouldUseLegacyApi","endpointType","getLegacyEndpointType","allowDomainSharding","dashboard_id","url","getExploreUrl","postPayload","isFeatureEnabled","FeatureFlag","SupersetClient","then","json","response","result","legacyChartDataRequest","payload","buildV1ChartDataPayload","sliceId","dashboardId","qs","undefined","getChartDataUri","path","toString","headers","body","JSON","stringify","v1ChartDataRequest","runAnnotationQuery","timeout","isDashboardRequest","sliceKey","Object","keys","charts","fd","requiresQuery","sourceType","Promise","resolve","granularity","time_grain_sqla","overridesKeys","overrides","includes","time_range","sliceFormData","reduce","d","k","hasExtraFilters","extra_filters","length","isNative","ANNOTATION_SOURCE_TYPES","getAnnotationJsonUrl","controller","AbortController","signal","catch","getClientErrorObject","err","statusText","toLowerCase","TRIGGER_QUERY","triggerQuery","RENDER_TRIGGERED","renderTriggered","UPDATE_QUERY_FORM_DATA","updateQueryFormData","UPDATE_CHART_ID","updateChartId","newId","ADD_CHART","addChart","chart","exploreJSON","logStart","Logger","chartDataRequest","dataMask","updateDataMask","chartDataRequestCaught","status","waitForAsyncData","Error","forEach","resultItem","logEvent","LOG_ACTIONS_LOAD_CHART","applied_filters","is_cached","force_refresh","row_count","rowcount","datasource","start_offset","ts","Date","getTime","duration","has_extra_filters","viz_type","data_age","moment","diff","cached_dttm","appendErrorLog","errorDetails","isCached","has_err","error_details","name","parsedResponse","annotationLayers","annotation_layers","all","map","GET_SAVED_CHART","getSavedChart","POST_CHART_FORM_DATA","postChartFormData","redirectSQLLab","datasourceKey","sql","query","safeStringify","addDangerToast","t","refreshChart","chartKey","dashboardInfo","common","conf","SUPERSET_WEBSERVER_TIMEOUT","id","getDatasetSamples","datasetId","endpoint","clientError","message","cause","propTypes","children","PropTypes","onError","showMessage","ErrorBoundary","React","constructor","props","super","this","info","componentDidCatch","setState","render","firstLine","subtitle","copyText","componentStack","defaultProps","isValidFilter","chartId","dashboardState","sliceIds","ADD_FILTER","addFilter","component","dashboardFilters","REMOVE_FILTER","removeFilter","CHANGE_FILTER","changeFilter","newSelectedValues","merge","components","dashboardLayout","present","UPDATE_DIRECT_PATH_TO_FILTER","updateDirectPathToFilter","UPDATE_LAYOUT_COMPONENTS","updateLayoutComponents","UPDATE_DASHBOARD_FILTERS_SCOPE","updateDashboardFiltersScope","scopes","FILTER_COMPONENT_FILTER_TYPES","setValuesInArray","value1","value2","HYDRATE_DASHBOARD","hydrateDashboard","dashboardData","chartData","filterboxMigrationState","FILTER_BOX_MIGRATION_STATES","dataMaskApplied","user","metadata","regularUrlParams","extractUrlParams","editMode","edit","preselectFilters","getUrlParam","URL_PARAMS","parse","default_filters","e","shared_label_colors","updateColorSchema","label_colors","position_data","layout","DASHBOARD_VERSION_KEY","DASHBOARD_ROOT_ID","DASHBOARD_ROOT_TYPE","DASHBOARD_GRID_ID","DASHBOARD_GRID_TYPE","parents","chartIdToLayoutId","values","layoutComponent","CHART_TYPE","meta","parentId","parent","TABS_TYPE","findFirstParentContainerId","newSlicesContainer","newSlicesContainerWidth","filterScopes","filter_scopes","chartQueries","slices","Set","slicesFromExploreCount","Map","slice","url_params","applyDefaultFormData","slice_url","slice_name","description","description_markeddown","owners","modified","changed_on","add","GRID_DEFAULT_CHART_WIDTH","GRID_COLUMN_COUNT","newComponentFactory","ROW_TYPE","push","chartHolder","count","get","set","configs","getFilterConfigsFromFormdata","columns","labels","col","scopesByChartId","column","scopeSettings","scope","immune","DASHBOARD_FILTER_SCOPE_GLOBAL","componentId","directPathToFilter","dashboardFilter","datasourceId","filterName","isDateFilter","TIME_RANGE","layoutId","sliceName","buildActiveFilters","DASHBOARD_HEADER_ID","DASHBOARD_HEADER_TYPE","text","dashboard_title","past","future","directLinkComponentId","getLocationHash","directPathToChild","filterConfig","native_filter_configuration","filterBoxToFilterComponentMap","String","adhoc_filters","date_filter","druid_time_origin","filter_configs","granularity_sqla","show_druid_time_granularity","show_druid_time_origin","show_sqla_time_column","show_sqla_time_granularity","getDashboardDefaultValues","preselectedFilters","filterKey","timeRangeFilter","controlValues","filterType","FILTER_TIME","targets","cascadeParentIds","defaultDataMask","rootPath","excluded","dashboardDefaultValues","extraFormData","filterState","timeGrainFilter","FILTER_TIMEGRAIN","parseInt","split","timeColumnFilter","FILTER_TIMECOLUMN","druidGranularityFilter","druidOriginFilter","config","entry","enableEmptyFilter","defaultToFirstItem","inverseSelection","multiSelect","sortAscending","label","FILTER_SELECT","sortMetric","defaultValues","defaultValue","getFilterBoxDefaultValues","filters","op","val","dependencies","filterFieldsDependencies","filterChartIds","entries","filterFields","filterField","filterScope","filter","getFilterboxDependencies","field","childrenChartIds","parentComponentId","childrenChartId","childComponentId","childComponent","FILTER_RANGE","getNativeFilterConfig","show_native_filters","nativeFilters","getInitialNativeFilterState","layoutItem","behaviors","getChartMetadataRegistry","chart_configuration","Behavior","crossFilters","roles","canEdit","canUserEditDashboard","data","sliceEntities","initSliceEntities","isLoading","userId","dash_edit_perm","dash_save_perm","findPermission","dash_share_perm","superset_can_explore","superset_can_share","superset_can_csv","slice_can_edit","flash_messages","preselectNativeFilters","Array","from","directPathLastUpdated","now","focusedFilterField","expandedSlices","expanded_slices","refreshFrequency","refresh_frequency","shouldPersistRefreshFrequency","css","colorNamespace","color_namespace","colorScheme","color_scheme","isPublished","published","hasUnsavedChanges","maxUndoHistoryExceeded","lastModifiedTime","isRefreshing","isFiltersRefreshing","activeTabs","datasetsStatus","ResourceStatus","SET_ALL_SLICES","setAllSlices","FETCH_ALL_SLICES_STARTED","FETCH_ALL_SLICES_FAILED","fetchAllSlices","excludeFilterBox","lastUpdated","rison","opr","page_size","order_column","order_direction","params","datasourceType","datasource_id","datasource_type","datasource_name","datasource_name_text","datasource_url","changed_on_utc","description_markdown","changed_on_delta_humanized","changed_on_humanized","errorResponse","console","log","fetchAllSlicesFailed","isInstantFilter","CHANGE_FILTER_VALUE_ACTIONS","dashboardFiltersReducer","action","actionHandlers","concat","instant_filtering","updatedColumns","allDashboardFiltersScope","updatedFilters","getChartIdAndColumnFromFilterKey","deletedFilter","errorMessage","sliceEntitiesReducer","allFilterBoxChartIds","activeFilters","appliedFilterValuesByChart","allComponents","getActiveFilters","isFilterBox","getAppliedFilterValues","applicableFilters","chartIds","getChartIdsInFilterBoxScope","traverse","immuneChartIds","child","scopeComponentIds","nonEmptyFilters","isArray","getDashboardFilterKey","FILTER_CONFIG_ATTRIBUTES","vals","TIME_FILTER_MAP","updatedLabels","TIME_FILTER_LABELS","typeToDefaultMetaData","width","height","COLUMN_TYPE","background","BACKGROUND_TRANSPARENT","DIVIDER_TYPE","HEADER_TYPE","headerSize","MEDIUM_HEADER","MARKDOWN_TYPE","TAB_TYPE","defaultText","placeholder","DYNAMIC_TYPE","uuid","shortid","entityFactory","serializeActiveFilterValues","entryByChartId","onChange","CheckBoxControlWrapper","styled","theme","colors","grayscale","dark1","gridUnit","CheckboxControl","renderCheckbox","bind","checked","leftNode","onClick","hasCustomLabelColors","labelMargin","clearable","default","choices","schemes","isLinear","StyledAlert","Icons","alert","base","ColorSchemeControl","renderOption","renderLabel","dashboardColorSchemeAlert","currentScheme","getColors","title","color","i","backgroundColor","border","alertTitle","iconSize","options","customLabel","controlChoices","allColorOptions","o","option","isValidColorOption","SUPERSET_DEFAULT","selectProps","ariaLabel","allowClear","disabled","header","EXPRESSION_TYPES","SIMPLE","SQL","CLAUSES","HAVING","WHERE","OPERATORS_TO_SQL","IN","LIKE","ILIKE","REGEX","schema","CUSTOM_OPERATIONS","CUSTOM_OPERATORS","OPERATOR_ENUM_TO_OPERATOR_TYPE","operation","translateToSql","adhocMetric","useSimple","expressionType","subject","comparator","operator","indexOf","getSimpleSQLExpression","sqlExpression","AdhocFilter","adhocFilter","toUpperCase","operatorId","Operators","clause","isExtra","isNew","filterOptionName","Math","random","substring","duplicateWith","nextFields","equals","isValid","nullCheckOperators","truthCheckOperators","getDefaultLabel","getTooltipTitle","isRequired","onFilterEdit","onRemoveFilter","columnType","saved_metric_name","adhocMetricType","sections","operators","partitionColumn","onMoveLabel","onDropLabel","index","AdhocFilterOption","AdhocFilterPopoverTrigger","tooltipTitle","onRemove","DndItemType","withCaret","selectedMetricType","adhocFilterType","savedMetrics","savedMetricType","selectedMetrics","isDictionaryForAdhocFilter","AdhocFilterControl","optionsForSelect","onNewFilter","moveLabel","mapOption","getMetricExpression","optionRenderer","FilterDefinitionOption","valueRenderer","componentDidMount","dbId","database","is_sqllab_view","isSqllabView","partitions","cols","logging","UNSAFE_componentWillReceiveProps","nextProps","valuesCopy","splice","prevState","newFilter","mappedOption","changedFilter","opts","savedMetricName","find","savedMetric","metric_name","expression","dragIndex","hoverIndex","newValues","AdhocMetric","column_name","ensureIsArray","metric","results","sort","a","b","localeCompare","addNewFilterPopoverTrigger","trigger","className","ControlHeader","iconColor","light5","light1","withTheme","inferSqlExpressionColumn","sqlaAutoGeneratedMetricRegex","indexFirstCloseParen","indexPairedOpenParen","lastIndexOf","inferSqlExpressionAggregate","indexFirstOpenParen","inferredColumn","aggregate","hasCustomLabel","optionName","useVerboseName","transformCountDistinct","verbose_name","AGGREGATES","test","showType","autoFocus","freeForm","multi","isMulti","onFocus","showHeader","valueKey","filterOption","tokenSeparators","notFoundContent","renderTrigger","validationErrors","rightNode","hovered","tooltipOnClick","warning","danger","SelectControl","getOptions","handleFilterOptions","isEqualArray","onChangeVal","v","c","is","headerProps","allowNewOptions","loading","sortComparator","currentValue","getValue","spatialTypes","animation","SpatialControl","defaultCol","delimiter","latCol","lonCol","lonlatCol","reverseCheckbox","geohashCol","errors","toggleCheckbox","renderReverseCheckbox","errMsg","setType","renderLabelContent","renderSelect","renderPopoverContent","style","isSelected","onSelect","gutter","xs","md","content","placement","initialValue","minLines","maxLines","offerEditInModal","language","aboveEditorSection","readOnly","TextAreaControl","onControlChange","event","target","onAreaEditorChange","renderEditor","inModal","editorProps","$blockScrolling","renderModalBody","controlHeader","modalTitle","triggerNode","buttonSize","modalBody","responsive","categoricalSchemeRegistry","getCategoricalSchemeRegistry","sequentialSchemeRegistry","getSequentialSchemeRegistry","timeColumnOption","groupByControl","includeTime","opt","mapStateToProps","control","newState","groupby","metrics","validators","validateNonEmpty","controls","isEditable","color_picker","r","g","metric_2","linear_color_scheme","getDefaultKey","getMap","secondary_metric","main_dttm_col","row_limit","legacyValidateInteger","formatSelectOptions","limit","timeseries_limit_metric","series","entity","x","y","size","y_axis_format","showWarning","comparison_type","filterable","s","inputFormData","vizType","DEFAULT_VIZ_TYPE","y_axis_zero","y_axis_bounds","handleDeprecatedControls","getAllControlsState","controlPanelConfig","getChartControlPanelRegistry","onInit","controlFormData","getFormDataFromControls","controlName","defaultControls","f","extractTypes","prev","ANNOTATION_TYPES_METADATA","FORMULA","EVENT","supportNativeSource","INTERVAL","TIME_SERIES","ANNOTATION_TYPES","DEFAULT_ANNOTATION_TYPE","ANNOTATION_SOURCE_TYPES_METADATA","NATIVE","annotationSourceType","WindowedMenuList","maxHeight","getStyles","cx","innerRef","windowListRef","windowListRef_","windowListInnerRef","defaultWindowListRef","useRef","optionHeight","spacing","baseUnit","lineHeight","detectHeight","totalHeight","useEffect","lastSelected","findIndex","isFocused","getLastSelected","current","scrollToItem","ref","outerRef","min","itemData","itemCount","itemSize","MenuList","DefaultMenuList","DEFAULT_WINDOW_THRESHOLD","windowThreshold","windowed","SelectComponent","WindowedSelect","components_","restProps","forwardRef","WindowedCreatableSelect","WindowedAsyncCreatableSelect","DEFAULT_CLASS_NAME","DEFAULT_CLASS_NAME_PREFIX","primary","success","indicator","almostBlack","grayDark","grayLight","light2","gray","grayBg","light4","grayBgDarker","light3","grayBgDarkest","grayHeading","menuHover","lightest","darkest","dark2","grayBorder","grayBorderLight","grayBorderDark","textDefault","textDarkest","dangerLight","DEFAULT_STYLES","container","provider","minWidth","indicatorSeparator","indicatorsContainer","clearIndicator","menuIsOpen","borderRadius","isPseudoFocused","borderColor","menu","zIndex","menuList","isDisabled","fontSize","weights","bold","normal","valueContainer","hasValue","multiValueLabel","paddingLeft","paddingRight","input","menuPortal","INPUT_TAG_BASE_STYLES","outline","padding","ClearIndicator","DropdownIndicator","Option","Input","SelectContainer","DEFAULT_COMPONENTS","assistiveText","marginLeft","typography","sizes","innerProps","autoComplete","inputStyle","VALUE_LABELED_STYLES","overflow","singleValue","SortableSelectComponent","withRef","supersetDefaultComponents","StyledSelect","stateManager","selectRef","labelKey","themeConfig","stylesConfig","valueRenderedAsLabel","valueRenderedAsLabel_","onPaste","sortable","forceOverflow","classNamePrefix","value_","isMulti_","isClearable","isClearable_","minMenuHeight","maxMenuHeight","ignoreAccents","getOptionValue","getOptionLabel","formatOptionLabel","context","shouldAllowSort","MaybeSortableSelect","MultiValue","onMouseDown","preventDefault","stopPropagation","sortableContainerProps","getHelperDimensions","node","getBoundingClientRect","axis","onSortEnd","oldIndex","newIndex","newValue","distance","assign","getNewOptionData","inputValue","closeMenuOnScroll","classList","contains","menuPosition","instance","refs","wrappedInstance","styles","reactSelectTheme","menuGutter","controlHeight","defaultTheme","Select","CreatableSelect","AsyncCreatableSelect","OnPasteSelect","evt","clipboard","clipboardData","getData","regex","separator","RegExp","trim","validator","isValidNewOption","selected","existingOptions","existing","notExists","unshift","selectWrap","noResultsText","StyledNativeSelect","getPopupContainer","parentNode","StyledNativeGraySelect","origSelectedValues","instantFiltering","filtersFields","filtersChoices","onFilterMenuOpen","onFilterMenuClose","showDateFilter","showSqlaTimeGrain","showSqlaTimeColumn","showDruidTimeGrain","showDruidTimeOrigin","StyledFilterContainer","FilterBox","onCloseDateFilterControl","selectedValues","hasChanged","debouncerCache","maxValueCache","onOpenDateFilterControl","getControlData","actions","setControlValue","mapFunc","getKnownMax","max","d3Max","clickApply","fltr","debounceLoadOptions","callback","loadOptions","SLOW_DEBOUNCE","transformOptions","maxValue","perc","round","backgroundImage","BOOL_TRUE_DISPLAY","BOOL_FALSE_DISPLAY","sortAsc","asc","rawFormData","labelA","textOrder","startsWith","renderDateFilter","DateFilterControl","endpoints","renderDatasourceFilters","datasourceFilters","sqlaFilters","druidFilters","ControlRow","Control","choiceIds","has","isMultiple","searchAllOptions","cacheOptions","defaultOptions","onMenuOpen","onBlur","onMenuClose","FILTER_OPTIONS_LIMIT","renderFilters","Form","htmlFor","Button","buttonStyle","StyledDiv","certifiedBy","details","metricName","xmlns","enableBackground","viewBox","fill","StyleOverrides","ColumnOption","labelRef","type_generic","hasExpression","tooltipText","setTooltipText","useState","useLayoutEffect","is_certified","certified_by","certification_details","_path","_extends","arguments","source","prototype","hasOwnProperty","call","apply","fillRule","clipRule","TypeIconWrapper","ColumnTypeLabel","typeIcon","QuestionOutlined","ClockCircleOutlined","FlexRowContainer","MetricOption","openInNewWindow","showFormula","shouldShowTooltip","verbose","link","href","rel","warningMarkdown","warning_markdown","warning_text","icon","tooltip","iconsStyle","StyledCalculatorIcon","SQLPopover","setOptions","highlightActiveLine","highlightGutterLine","wrapEnabled","secondary","maxWidth","arrowPointAtCenter","TooltipSectionWrapper","TooltipSectionLabel","TooltipSection","isLabelTruncated","scrollWidth","clientWidth","getColumnLabelText","getColumnTooltipNode","getMetricTooltipNode","COLUMN_NAME_ALIASES","DATASET_TIME_COLUMN_OPTION","QUERY_TIME_COLUMN_OPTION","is_dttm","QueryModeLabel","required","labelClass","role","tabIndex","cursor","Tooltip","join","InfoTooltipWithTrigger","RadioButtonControl","position","top","marginBottom","marginTop","fontWeight","boxShadow","ControlFormRow","display","flexWrap","margin","ControlForm","debouncedOnChange","useMemo","updatedChildren","row","defaultWidth","item","debounceDelay","onItemValueChange","fieldValue","textTransform","creatable","onSearch","dropdownMatchSelectWidth","showSearch","showSearch_","searchValue","setSearchValue","handleSearch","optionsHasSearchValue","some","optionsHasValue","handleChange","ControlFormItemComponents","Slider","InputNumber","Checkbox","ControlFormItem","controlType","setHovered","setValue","setValidationErrors","isEmptyValue","onMouseEnter","onMouseLeave","emitTarget","d3NumberFormat","d3TimeFormat","fractionDigits","step","columnWidth","validateNumber","horizontalAlign","FaAlignLeft","FaAlignCenter","FaAlignRight","showCellBars","alignPositiveNegative","colorPositiveNegative","SHARED_COLUMN_CONFIG_PROPS","d3SmallNumberFormat","DEFAULT_CONFIG_FORM_LAYOUT","override","ColumnConfigPopover","configFormLayout","caretWidth","alignItems","borderBottom","right","ColumnConfigControl","appliedColumnNames","emitFilter","array_of_array","arr","colnames","_colnames","coltypes","_coltypes","appliedCol","idx","columnConfigs","showAllColumns","setShowAllColumns","getColumnInfo","needShowMoreButton","MAX_NUM_COLS","ColumnConfigItem","validConfigs","fromEntries","setColumnConfig","textAlign","dndGroupByControl","dndColumnsControl","dndSeries","dndEntity","dnd_adhoc_filters","provideFormDataToProps","dnd_adhoc_metrics","dnd_adhoc_metric","dnd_adhoc_metric_2","dnd_sort_by","dnd_size","dnd_x","dnd_y","dnd_secondary_metric","dnd_granularity_sqla","canDelete","ghostButtonText","temporalColumns","isTemporal","sortedQueryColumns","SERIES_LIMITS","appContainer","document","getElementById","getAttribute","allowAll","promptTextCreator","commaChoosesOption","datasourceControl","columnsControl","dataset","order_desc","visibility","Boolean","series_limit","sort_by","search","x_axis_time_format","truncate_metric","enableExploreDnd","sharedControls","orderby","series_columns","series_limit_metric","legacy_order_by","COMPARATOR","MULTIPLE_VALUE_COMPARATORS","BETWEEN","BETWEEN_OR_EQUAL","BETWEEN_OR_LEFT_EQUAL","BETWEEN_OR_RIGHT_EQUAL","isColumnMeta","isSavedExpression","isAdhocColumn","isControlPanelSectionConfig","section","isDataset","isQueryResponse","D3_FORMAT_DOCS","D3_FORMAT_OPTIONS","D3_TIME_FORMAT_DOCS","D3_TIME_FORMAT_OPTIONS","DEFAULT_NUMBER_FORMAT","DEFAULT_TIME_FORMAT","defineSavedMetrics","expandControlType","expandControlConfig","controlOverrides","formatSelectOptionsForRange","start","end","ChartControlPanelRegistry","AppSection","ChartLabel","chartLabelExplanations","DEPRECATED","FEATURED","chartLabelWeight","weight","CategoricalColorNamespace","forcedItems","scales","getScale","schemeId","scheme","setColor","forcedColor","resetColors","namespaces","DEFAULT_NAMESPACE","getNamespace","newInstance","getColor","namespace","CategoricalColorScale","parentForcedColors","originColors","scale","forcedColors","multiple","range","cleanedValue","sharedLabelColor","parentColor","addSlice","floor","domain","newRange","getColorMap","colorMap","copy","unknown","newDomain","SharedLabelColor","sliceLabelColorMap","updateColorScheme","categoricalNamespace","sharedLabels","getSharedLabels","sharedLabelMap","generatedColors","colorScale","ceil","res","reverse","removeSlice","clear","tempLabels","stringifyAndTrim","rgbRegex","getContrastingColor","thresholds","matchColor","exec","hex","getAnalogousColors","analogousColors","analogous","shift","toHexString","addAlpha","opacity","FAST_DEBOUNCE","modulePromises","withNamespace","defineSharedModule","fetchModule","moduleKey","window","modulePromise","defineSharedModules","moduleMap","reset","RollingType","ComparisionType","NativeFilterType","DataMaskType","isNativeFilter","filterElement","NATIVE_FILTER","isFilterDivider","DIVIDER","GenericDataType","arrA","arrB","every","Number","isNaN","numeric","validateInteger","isFinite","chartAlert","chartStatus","chartStackTrace","chartUpdateEndTime","chartUpdateStartTime","lastRendered","chartReducer","stacktrace","annotationQuery","abort","annotationData","annotationError","CheckboxChecked","CheckboxHalfChecked","CheckboxUnchecked","Styles","CONFIRM_WARNING_MESSAGE","CHANGE_WARNING_MSG","ConfirmModalStyled","StyledSpan","withToasts","addSuccessToast","onDatasourceSave","onHide","show","setFilter","pageIndex","setPageIndex","sortBy","setSortBy","confirmChange","setConfirmChange","confirmedDataset","setConfirmedDataset","searchRef","resourceCollection","resourceCount","fetchData","selectDatasource","useCallback","fetchDatasetPayload","pageSize","setTimeout","focus","onEnterModal","Cell","original","table_name","Header","accessor","disableSortBy","FacePile","users","hideFooter","footer","Alert","roomBelow","Loading","TableView","initialPageIndex","initialSortBy","totalCount","onServerPagination","args","emptyWrapperType","serverPagination","isPaginationSticky","scrollTable","DatasourceEditor","AsyncEsmComponent","StyledDatasourceModal","Modal","buildExtraJsonObject","certification","currentDatasource","setCurrentDatasource","setErrors","isSaving","setIsSaving","isEditing","setIsEditing","dialog","modal","contextHolder","onConfirmSave","tableSelector","databaseSelector","extra","okButtonProps","showLegacyDatasourceEditor","maskClosable","location","edit_url","confirm","showIcon","onOk","is_managed_externally","showLoadingForImport","AntdRangePicker","RangePicker","DatePicker","metadataRegistry","dummyPluginContext","dynamicPlugins","mountedPluginMetadata","fetchAll","PluginContext","usePluginContext","useContext","getRegistryData","pluginContextReducer","plugins","mounting","plugin","pluginApi","sharedModules","react","lodash","DynamicPluginProvider","pluginState","useReducer","import","bundle_url","stack","registryListener","addListener","removeListener","Provider","colorList","customAvatarStyler","m","StyledAvatar","StyledGroup","maxCount","first_name","last_name","sampleValue","charCodes","letter","charCodeAt","len","next","stringAsciiPRNG","getRandomColor","toLocaleUpperCase","PopoverSection","paddingBottom","mediumHeavy","DASHBOARD_INFO_UPDATED","labelColors","dashboardInfoChanged","newInfo","SET_CHART_CONFIG_COMPLETE","setChartConfiguration","chartConfiguration","updateDashboard","json_metadata","DatasourcesAction","setDatasources","datasources","SET_DATASOURCES","setDatasource","SET_DATASOURCE","fetchDatasourceMetadata","SET_FILTER_CONFIG_COMPLETE","SET_IN_SCOPE_STATUS_OF_FILTERS","SET_FILTER_SETS_COMPLETE","setFilterConfiguration","oldFilters","mergedFilterConfig","oldFilter","setInScopeStatusOfFilters","filtersWithScopes","filterId","chartsInScope","tabsInScope","filterWithScope","getFilterSets","fetchFilterSets","filterSets","ids","createFilterSet","filterSet","postFilterSets","serverFilterSet","owner_type","owner_id","updateFilterSet","deleteFilterSet","filterSetId","deleteFilterSets","SET_FOCUSED_NATIVE_FILTER","UNSET_FOCUSED_NATIVE_FILTER","setFocusedNativeFilter","unsetFocusedNativeFilter","hasCircularDependency","dependencyMap","trace","dependency","validateForm","form","currentFilterId","setCurrentFilterId","formValues","validateFields","errorFields","outOfDate","filterError","createHandleSave","filterConfigMap","filterIds","removedFilters","saveForm","newFilterConfig","formInputs","requiredFirst","rf","createHandleRemoveItem","setRemovedFilters","setOrderedFilters","setSaveAlertVisible","timerId","isPending","orderedFilters","completeFilterRemoval","REMOVAL_DELAY_SECS","NATIVE_FILTER_PREFIX","NATIVE_FILTER_DIVIDER_PREFIX","generateFilterId","getFilterIds","getFormData","otherProps","extra_form_data","inView","mergeExtraFormData","originalExtra","newExtra","mergedExtra","mergedValues","originalValue","getExtraFormData","filterIdsAppliedOnChart","nativeFilterGate","isComponentATab","findTabsWithChartsInScopeHelper","tabIds","tabsToHighlight","childId","findTabsWithChartsInScope","rootChildId","hasTopLevelTabs","tabId","element","getInitialState","filterSetsConfig","filtersSet","focusedFilterId","nativeFilterReducer","NEW_COMPONENT_SOURCE_TYPE","reservedQueryParams","urlParamType","queryParams","acc","perm","view","permissions","perm_","view_","isUserAdmin","dashboard","owner","username","isUserDashboardOwner","filterKeySplitter","match","hash","CLEAR_DATA_MASK_STATE","UPDATE_DATA_MASK","SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE","SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL","setDataMaskForFilterConfigComplete","isFeatureFlagActive","clearDataMask","clearDataMaskState","getInitialDataMask","moreProps","fillNativeFilters","mergedDataMask","draftDataMask","initialDataMask","currentFilters","ignoreUndefined","draft","cleanState","CustomListItem","selectable","rest","borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius","AnnotationLayer","refreshAnnotationData","AnnotationLayerControl","popoverVisible","addedAnnotationIndex","addAnnotationLayer","removeAnnotationLayer","handleVisibleChange","preload","originalAnnotation","newAnnotation","annotations","anno","visible","popoverKey","renderPopover","close","renderInfo","bsStyle","addedAnnotation","ControlPopover","onVisibleChange","float","bordered","destroyTooltipOnHide","themedAnnotationLayerControl","connect","getChartKey","annotationObj","MinInput","MaxInput","parseNumber","BoundsControl","minMax","setMinMax","update","mm","addTooltip","itemGenerator","keyAccessor","isFloat","isInt","SortableListItem","SortableElement","SortableList","SortableContainer","List","SortableDragger","SortableHandle","CollectionControl","onAdd","arrayMove","removeItem","ix","renderList","controlMap","useDragHandle","lockAxis","commonProps","flex","marginRight","swatchCommon","left","bottom","StyledSwatch","checkboard","ColorPickerControl","rgb","presetColors","colStyle","Popover","CHANGE_DATASET","VIEW_IN_SQL_LAB","EDIT_DATASET","QUERY_PREVIEW","SAVE_AS_DATASET","DatasourceControl","showEditDatasourceModal","showChangeDatasourceModal","toggleChangeDatasourceModal","toggleEditDatasourceModal","toggleShowDatasource","handleMenuItemClick","toggleSaveDatasetModal","timeCol","firstDttmCol","showDatasource","showSaveDatasetModal","isMissingDatasource","isMissingParams","isSqlSupported","allowEdit","editText","defaultDatasourceMenu","Menu","queryDatasourceMenu","health_check_message","healthCheckMessage","WarningIconWithTooltip","overlay","DatasourceType","ErrorAlert","level","SaveDatasetModal","buttonTextOnSave","buttonTextOnOverwrite","modalDescription","TitleLabel","StyledInput","isEditDisabled","isHovered","setIsHovered","isEditMode","setIsEditMode","defaultLabel","handleMouseOver","handleMouseOut","handleClick","handleBlur","handleKeyPress","ev","handleInputBlur","onKeyPress","onMouseOver","onMouseOut","onClose","onResize","getCurrentTab","getCurrentLabel","savedMetricsOptions","noOp","SAVED_TAB_KEY","AdhocMetricEditPopover","defaultActiveTabKey","onSave","onResetStateAndClose","onColumnChange","onAggregateChange","onSavedMetricChange","onSqlExpressionChange","onDragDown","onMouseMove","onMouseUp","onTabChange","handleAceEditorRef","refreshAceEditor","POPOVER_INITIAL_WIDTH","POPOVER_INITIAL_HEIGHT","addEventListener","componentDidUpdate","prevProps","savedMetricLabel","adhocMetricLabel","componentWillUnmount","removeEventListener","oldMetric","columnName","dragStartX","clientX","dragStartY","clientY","dragStartWidth","dragStartHeight","tab","aceEditorRef","editor","resize","renderColumnOption","renderMetricOption","propsAdhocMetric","propsSavedMetric","popoverProps","keywords","sqlKeywords","score","columnValue","columnSelectProps","aggregateSelectProps","AGGREGATES_OPTIONS","savedSelectProps","stateIsValid","Tabs","defaultActiveKey","allowOverflow","EmptyState","image","disallow_adhoc_metrics","showGutter","enableLiveAutocompletion","cta","AdhocMetricPopoverTrigger","onPopoverResize","onLabelChange","closePopover","togglePopover","currentLabel","labelModified","isTitleEditDisabled","defaultMetricLabel","forceUpdate","newMetric","onMetricEdit","isControlledComponent","overlayContent","popoverTitle","defaultVisible","onRemoveMetric","AdhocMetricOption","isFunction","MetricDefinitionValue","metricOptionProps","getOptionsForSavedMetrics","currentMetricValues","currentMetric","isDictionaryForAdhocMetric","coerceAdhocMetrics","emptySavedMetric","MetricsControl","propsValue","useTheme","prevColumns","usePrevious","prevSavedMetrics","optionValues","onNewMetric","changedMetric","isAddNewMetricDisabled","savedMetricOptions","newAdhocMetric","addNewMetricPopoverTrigger","matchingMetrics","getMetricsMatchingCurrentDataset","controlTypes","FixedOrMetricControl","setFixedValue","setMetric","fixedValue","metricValue","Collapse","ghost","showArrow","Label","TextControl","isLabeledValue","arg","dataEndpoint","mutator","colType","timeLag","timeRatio","comparisonType","showYAxis","yAxisBounds","bounds","d3format","dateFormat","comparisonTypeOptions","colTypeOptions","StyledRow","Row","StyledCol","Col","StyledTooltip","ButtonBar","TimeSeriesColumnControl","resetState","initialState","onPopoverVisibleChange","onSelectChange","attr","onTextInputChange","onCheckboxChange","onBoundsChange","onYAxisBoundsChange","textSummary","formRow","ttLabel","PARAMS","longitude","latitude","zoom","bearing","pitch","ViewportControl","ctrl","renderTextControl","decimal2sexagesimal","FEATURED_CHARTS","VizTile","isActive","isRendered","vizMeta","onTileClick","chartNameRef","TILE_TRANSITION_TIME","transitionTiming","tooltipVisible","setTooltipVisible","isTransitioning","setIsTransitioning","showTooltip","setShowTooltip","chartName","handleTileClick","containerProps","mouseEnterDelay","FastVizSwitcher","currentSelection","currentViz","vizTiles","featuredVizMeta","VizSupportValidation","UnpaddedModal","STYLE_ROW","minHeight","STYLE_RALIGN","isCheckbox","FormRow","labelAndTooltip","INTEGRAL_TYPES","DECIMAL_TYPES","STYLE_WIDTH","FilterBoxItemControl","typedValue","selectedColumnName","selectedColumn","parseFloat","renderForm","FullWidthInputNumber","JustifyEnd","operatorOptions","NONE","GREATER_THAN","LESS_THAN","GREATER_OR_EQUAL","LESS_OR_EQUAL","EQUAL","NOT_EQUAL","targetValueValidator","compare","rejectMessage","targetValue","_","compareValue","reject","targetValueLeftValidator","targetValueRightValidator","isOperatorMultiValue","isOperatorNone","rulesRequired","rulesTargetValueLeft","getFieldValue","rulesTargetValueRight","targetValueLeftDeps","targetValueRightDeps","shouldFormItemUpdate","prevValues","currentValues","operatorField","rules","renderOperatorFields","span","validateTrigger","FormattingPopoverContent","onFinish","initialValues","requiredMark","noStyle","shouldUpdate","htmlType","FormattingPopover","setVisible","handleSave","newConfig","overlayStyle","FormattersContainer","FormatterContainer","CloseButton","columnOptions","verboseMap","conditionalFormattingConfigs","setConditionalFormattingConfigs","removeFormattersWhenColumnsChange","newFormattingConfigs","useComponentDidUpdate","prevConfigs","onDelete","newConfigs","onEdit","targetValueLeft","targetValueRight","createLabel","DndSelectLabel","displayGhostButton","accept","valuesRenderer","isOver","canDrop","datasourcePanelDrop","useDrop","drop","onDrop","onDropValue","canDropValue","collect","monitor","getItemType","cancelHover","onClickGhostButton","StyledInfoTooltipWithTrigger","clickClose","onClickClose","OptionLabel","OptionWrapper","onShiftOptions","isDragging","drag","useDrag","hover","hoverBoundingRect","hoverMiddleY","clientOffset","getClientOffset","hoverClientY","LabelContent","transformedCol","getColumnNameOrAdhocColumn","OptionSelector","del","replace","swap","getValues","editedColumn","setLabel","initialLabel","initialAdhocColumn","initialCalculatedColumn","initialSimpleColumn","getInitialColumnValues","adhocColumn","setAdhocColumn","selectedCalculatedColumn","setSelectedCalculatedColumn","selectedSimpleColumn","setSelectedSimpleColumn","sqlEditorRef","calculatedColumns","simpleColumns","onCalculatedColumnChange","onSimpleColumnChange","onSqlEditorFocus","savedExpressionsLabel","simpleColumnsLabel","calculatedColumn","simpleColumn","DndColumnSelectPopoverTitle","onInputBlur","defaultPopoverLabel","onColumnEdit","popoverLabel","setPopoverLabel","setPopoverVisible","setIsTitleEditDisabled","setHasCustomLabel","initialPopoverLabel","handleTogglePopover","handleClosePopover","DND_ACCEPTED_TYPES","DndColumnSelectControl","DndColumnSelect","newColumnPopoverVisible","setNewColumnPopoverVisible","optionSelector","handleOptionsChange","optionSelectorValues","popoverOptions","newColumn","addNewColumnWithPopover","openPopover","defaultGhostButtonText","tn","DndFilterSelect","propsValues","setValues","setPartitionColumn","newFilterPopoverVisible","setNewFilterPopoverVisible","droppedItem","setDroppedItem","filterOptions","handleClickGhostButton","handleDrop","DndMetricSelect","newMetricPopoverVisible","setNewMetricPopoverVisible","areSavedMetricsEqual","areColsEqual","newCol","newSavedMetricOptions","getSavedMetricOptionsForMetric","handleDropLabel","itemValue","HiddenControl","SelectAsyncControl","SliderControl","VizTypeControl","isModalOpenInit","showModal","setShowModal","modalKey","setModalKey","selectedViz","setSelectedViz","openModal","onSubmit","onCancel","primaryButtonName","disablePrimaryButton","onHandledPrimaryAction","VizTypeGallery","ConditionalFormattingControl","sharedControlComponents","StyledControl","hidden","isVisible","resetOnHide","wasVisible","ControlComponent","warn","isHiddenControl","countableControls","colSize","ExplorePopoverContent","getElementYVisibilityRatioOnContainer","containerHeight","innerHeight","nodePositionInViewport","getVisibilityRatio","visibleProp","triggerElementRef","setPlacement","calculatePlacement","visibilityRatio","changeContainerScrollStatus","lastElementChild","setProperty","handleGetPopupContainer","handleOnVisibleChange","handleDocumentKeyDownListener","SEPARATOR","formatDateEndpoint","dttm","isStart","formatTimeRange","timeRange","splitDateRange","PreviousCalendarWeek","PreviousCalendarMonth","PreviousCalendarYear","FRAME_OPTIONS","COMMON_RANGE_OPTIONS","COMMON_RANGE_VALUES_SET","CALENDAR_RANGE_OPTIONS","CALENDAR_RANGE_VALUES_SET","GRAIN_OPTIONS","SINCE_GRAIN_OPTIONS","UNTIL_GRAIN_OPTIONS","SINCE_MODE_OPTIONS","UNTIL_MODE_OPTIONS","COMMON_RANGE_SET","CALENDAR_RANGE_SET","MOMENT_FORMAT","SEVEN_DAYS_AGO","utc","startOf","subtract","format","MIDNIGHT","iso8601","raw","datetimeConstant","grainValue","grain","CUSTOM_RANGE_EXPRESSION","ISO8601_AND_CONSTANT","DATETIME_CONSTANT","defaultCustomRange","sinceDatetime","sinceMode","sinceGrain","sinceGrainValue","untilDatetime","untilMode","untilGrain","untilGrainValue","anchorMode","anchorValue","SPECIFIC_MODE","dttmToMoment","dttmToString","customTimeRangeDecode","since","until","customRange","matchedFlag","sinceCapturedGroup","untilCapturedGroup","sinceDttm","untileDttm","customTimeRangeEncode","abs","CommonFrame","commonRange","Radio","CalendarFrame","CustomFrame","onGrainValue","showTime","datetime","onStep","align","radioValue","TIME_PICKER_HELPER","overlayClassName","DateFunctionTooltip","AdvancedFrame","getAdvancedRange","advancedRange","fetchTimeRange","timeRangeString","StyledPopover","StyledRangeType","ContentStyleWrapper","medium","IconWrapper","getDateFilterControlTestId","DateFilterLabel","onOpenPopover","onClosePopover","actualTimeRange","setActualTimeRange","setShow","guessedFrame","guessFrame","frame","setFrame","lastFetchedTimeRange","setLastFetchedTimeRange","timeRangeValue","setTimeRangeValue","validTimeRange","setValidTimeRange","evalResponse","setEvalResponse","setTooltipTitle","actualRange","INITIAL_ADVANCED_DATA_TYPES_STATE","parsedAdvancedDataType","advancedDataTypeOperatorList","SelectWithLabel","labelText","onSubjectChange","onOperatorChange","isOperatorRelevant","onComparatorChange","isColumnBoolean","isColumnNumber","isColumnFunction","currentComparator","newComparator","clearOperator","useSimpleTabFilterProps","suggestions","setSuggestions","setComparator","loadingComparatorSuggestions","setLoadingComparatorSuggestions","advancedDataTypesState","subjectAdvancedDataType","fetchAdvancedDataTypeValueCallback","fetchSubjectAdvancedDataType","validHandler","setAdvancedDataTypesState","setSubjectAdvancedDataType","comp","display_value","valid_filter_operators","error_message","advanced_data_type","isOperatorRelevantWrapper","createSuggestionsPlaceholder","optionsRemaining","valuesFromSuggestionsLength","getOptionsRemaining","subjectSelectProps","operatorSelectProps","shouldFocusComparator","comparatorSelectProps","having","filter_select","suggestion","refreshComparatorSuggestions","order","activeKey","AdhocFilterEditPopoverSqlTabContent","onSqlExpressionClauseChange","clauseSelectProps","selectOptions","ResizeIcon","FilterPopoverContentContainer","FilterActionsContainer","AdhocFilterEditPopover","onAdhocFilterChange","setSimpleTabIsValid","adjustHeight","isSimpleTabValid","popoverContentRef","heightDifference","propsAdhocFilter","onHeightChange","popoverRef","DragContainer","OptionControlContainer","LabelText","CaretContainer","CloseContainer","HeaderContainer","LabelsContainer","DndLabelsContainer","AddControlLabel","AddIconButton","OptionControlLabel","hasMetricName","getLabelContent","parsedValue","onChangeWrapper","SECTIONS","DEFAULT_ORDER","typesWithDefaultOrder","MAX_ADVISABLE_VIZ_GALLERY_WIDTH","OTHER_CATEGORY","ALL_CHARTS","RECOMMENDED_TAGS","VizPickerLayout","isSelectedVizMetadata","SectionTitle","l","LeftPane","RightPane","SearchWrapper","InputIconAlignment","SelectorLabel","IconsPane","DetailsPane","DetailsPopulated","TagsWrapper","Description","Examples","thumbnailContainerCss","HighlightLabel","ThumbnailLabelWrapper","TitleLabelWrapper","vizSortFactor","Thumbnail","alt","src","thumbnail","ThumbnailGallery","vizEntries","Selector","selector","sectionId","btnRef","queueMicrotask","behavior","scrollMode","searchInputRef","searchInputValue","setSearchInputValue","isSearchFocused","setIsSearchFocused","isActivelySearching","selectedVizMetadata","chartMetadata","deprecated","chartsByCategory","category","categories","chartsByTags","tags","tag","sortedMetadata","activeSelector","setActiveSelector","activeSection","setActiveSection","CATEGORY","fuse","ignoreLocation","threshold","searchResults","aLabel","bLabel","aOrder","focusSearch","changeSearch","stopSearching","blur","clickSelector","isSelectedVizCompatible","viz","doesVizMatchSelector","sectionMap","selectors","TAGS","expandIconPosition","prefix","suffix","labelExplanation","exampleGallery","example","caption","OptionContainer","StyledMetricOption","StyledColumnOption","druidTimeSeries","expanded","controlSetRows","datasourceAndVizType","sqlaTimeSeries","tabOverride","NVD3TimeSeries","getMemoizedSectionsToRender","sectionOverrides","controlPanelSections","invalidControls","getSectionsToRender","getMemoizedControlConfig","controlKey","flat","findControlItem","applyMapStateToPropsToControl","controlState","controlPanelState","processedState","externalValidationErrors","execControlValidator","alteredControl","choiceValues","el","handleMissingChoice","getControlStateFromControlConfig","controlConfig","fieldsetRow","isControlValueCompatibleWithDatasource","getControlValuesCompatibleWithDatasource","compatibleValues","groupbyColumns","groupbyRows","sharedControlsMap","publicControls","StandardizedFormData","sourceFormData","sfd","freeze","memorizedFormData","standardizedFormData","delete","standardizedState","getStandardizedState","currState","controlPanel","updateStandardizedState","getLatestFormData","serialize","transform","targetVizType","exploreState","latestFormData","publicFormData","targetControlsState","targetFormData","denormalizeFormData","transformed","LOADING","useTransformedResource","resource","transformFn","COMPLETE","ERROR","extractInnerResult","responseBody","useApiV1Resource","setResource","cancelRef","cancelled","fetchResource","useApiResourceFullBody","effect","isMountedRef","previous","LOG_ACTIONS_RENDER_CHART","LOG_ACTIONS_HIDE_BROWSER_TAB","LOG_ACTIONS_MOUNT_DASHBOARD","LOG_ACTIONS_MOUNT_EXPLORER","LOG_ACTIONS_SELECT_DASHBOARD_TAB","LOG_ACTIONS_FORCE_REFRESH_CHART","LOG_ACTIONS_CHANGE_EXPLORE_CONTROLS","LOG_ACTIONS_TOGGLE_EDIT_DASHBOARD","LOG_ACTIONS_FORCE_REFRESH_DASHBOARD","LOG_ACTIONS_PERIODIC_RENDER_DASHBOARD","LOG_ACTIONS_EXPLORE_DASHBOARD_CHART","LOG_ACTIONS_EXPORT_CSV_DASHBOARD_CHART","LOG_ACTIONS_CHANGE_DASHBOARD_FILTER","LOG_EVENT_TYPE_TIMING","timeOriginOffset","markTimeOrigin","performance","getTimestamp","LOG_EVENT","eventName","eventData","TRANSPORT_POLLING","LOCALSTORAGE_KEY","transport","pollingDelayMs","pollingTimeoutId","listenersByJobId","retriesByJobId","lastReceivedEventId","asyncResponse","jobId","job_id","fn","asyncEvent","result_url","fetchCachedData","fetchEvents","processEvents","events","listener","localStorage","setItem","setLastId","loadEventsFromApi","eventArgs","last_id","wsConnectTimeout","ws","wsConnectRetries","wsConnect","GLOBAL_ASYNC_QUERIES_WEBSOCKET_URL","WebSocket","clearTimeout","readyState","appConfig","bootstrapData","GLOBAL_ASYNC_QUERIES_TRANSPORT","GLOBAL_ASYNC_QUERIES_POLLING_DELAY","getItem","init","isUserWithPermissionsAndRoles","isUser","testWithId","idOnly","localIdOnly","resultIdOnly","module","loadModule","urlParam","URLSearchParams","getUrlParams","excludedParams","urlParams","append","getUrlParamEntries","urlEntries","getChartUrlParams","excludedUrlParams","filterBoxFilters","getDashboardUrlParams","getPermalink","jsonPayload","getChartPermalink","getDashboardPermalink","PAGE_SIZE","SORT_BY","desc","PASSWORDS_NEEDED_MESSAGE","CONFIRM_OVERWRITE_MESSAGE","parsedErrorMessage","useListViewResource","resourceLabel","handleErrorMsg","infoEnable","defaultCollectionValue","baseFilters","initialLoadingState","collection","lastFetchDataConfig","bulkSelectEnabled","updateState","currentState","infoJson","filterValues","filterExps","page","lastFetched","toISOString","finally","setResourceCollection","hasPerm","p","toggleBulkSelect","refreshData","provideConfig","useSingleViewResource","resourceName","resourceID","createResource","hideToast","updateResource","setLoading","clearError","useImportResource","passwordsNeeded","alreadyExists","failed","importResource","bundle","databasePasswords","overwrite","FormData","Accept","FavStarClassName","favoriteApis","requestType","useFavoriteStatus","favoriteStatus","setFavoriteStatus","updateFavoriteStatus","isStarred","urlSuffix","CHART","DASHBOARD","useChartEditModal","setCharts","sliceCurrentlyEditing","setSliceCurrentlyEditing","handleChartUpdated","edits","newCharts","openChartEditModal","cache_timeout","closeChartEditModal","copyQueryLink","origin","getDatabaseImages","getConnectionAlert","getDatabaseDocumentationLinks","testDatabaseConnection","connection","useAvailableDatabases","availableDbs","setAvailableDbs","useDatabaseValidation","onCreate","parsedErrors","error_type","obj","catalog","invalid","missing","issue_codes","reportSelector","resourceType","resourceId","reports","risonRef","hi","lo","fromCharCode","not_idchar","not_idstart","idrx","id_ok","next_id","createFetchResourceMethod","relation","handleError","filterValue","resourceEndpoint","fetchedLoggedUser","loggedUser","firstName","lastName","getParams","getEditedObjects","edited","batch","editedCharts","editedDashboards","editedDash","editedChart","getUserOwnedObjects","getRecentAcitivtyObjs","recent","recentsRes","newBatch","chartRes","dashboardRes","examples","viewed","createFetchRelated","createFetchDistinct","createErrorHandler","handleErrorFunc","parsedError","errorsArray","ERRORS","handleChartDelete","chartFilter","handleDashboardDelete","dashboardTitle","shortenSQL","lines","loadingCardCount","mq","bp","CardContainer","showThumbnails","CardStyles","StyledIcon","isNeedsPassword","_schema","isAlreadyExists","getPasswordsNeeded","fileName","getAlreadyExists","hasTerminalValidation","noIssuesCodes","checkUploadExtensions","cons","uploadUserPerms","csvExt","colExt","excelExt","allowedExt","canUploadCSV","canUploadColumnar","canUploadExcel","canUploadData"],"sourceRoot":""}