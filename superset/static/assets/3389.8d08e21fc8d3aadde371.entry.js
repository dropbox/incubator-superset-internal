"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3389],{52256:(e,t,o)=>{o.r(t),o.d(t,{CHART_UPDATE_STARTED:()=>_,chartUpdateStarted:()=>y,CHART_UPDATE_SUCCEEDED:()=>C,chartUpdateSucceeded:()=>E,CHART_UPDATE_STOPPED:()=>T,chartUpdateStopped:()=>S,CHART_UPDATE_FAILED:()=>Z,chartUpdateFailed:()=>x,CHART_RENDERING_FAILED:()=>A,chartRenderingFailed:()=>R,CHART_RENDERING_SUCCEEDED:()=>w,chartRenderingSucceeded:()=>L,REMOVE_CHART:()=>I,removeChart:()=>O,ANNOTATION_QUERY_SUCCESS:()=>M,annotationQuerySuccess:()=>D,ANNOTATION_QUERY_STARTED:()=>N,annotationQueryStarted:()=>k,ANNOTATION_QUERY_FAILED:()=>F,annotationQueryFailed:()=>P,DYNAMIC_PLUGIN_CONTROLS_READY:()=>U,dynamicPluginControlsReady:()=>$,getChartDataRequest:()=>q,runAnnotationQuery:()=>V,TRIGGER_QUERY:()=>j,triggerQuery:()=>H,RENDER_TRIGGERED:()=>B,renderTriggered:()=>G,UPDATE_QUERY_FORM_DATA:()=>z,updateQueryFormData:()=>Q,UPDATE_CHART_ID:()=>K,updateChartId:()=>W,ADD_CHART:()=>Y,addChart:()=>J,exploreJSON:()=>X,GET_SAVED_CHART:()=>ee,getSavedChart:()=>te,POST_CHART_FORM_DATA:()=>oe,postChartFormData:()=>ae,redirectSQLLab:()=>ne,refreshChart:()=>re});var a=o(30381),n=o.n(a),r=o(31069),i=o(61988),s=o(35854),l=o(91877),c=o(93185),d=o(12515),u=o(10945),h=o(72570),p=o(97381),m=o(3741),g=o(98286),f=o(86374),v=o(74599),b=o(77997);const _="CHART_UPDATE_STARTED";function y(e,t,o){return{type:_,queryController:e,latestQueryFormData:t,key:o}}const C="CHART_UPDATE_SUCCEEDED";function E(e,t){return{type:C,queriesResponse:e,key:t}}const T="CHART_UPDATE_STOPPED";function S(e){return{type:T,key:e}}const Z="CHART_UPDATE_FAILED";function x(e,t){return{type:Z,queriesResponse:e,key:t}}const A="CHART_RENDERING_FAILED";function R(e,t,o){return{type:A,error:e,key:t,stackTrace:o}}const w="CHART_RENDERING_SUCCEEDED";function L(e){return{type:w,key:e}}const I="REMOVE_CHART";function O(e){return{type:I,key:e}}const M="ANNOTATION_QUERY_SUCCESS";function D(e,t,o){return{type:M,annotation:e,queryResponse:t,key:o}}const N="ANNOTATION_QUERY_STARTED";function k(e,t,o){return{type:N,annotation:e,queryController:t,key:o}}const F="ANNOTATION_QUERY_FAILED";function P(e,t,o){return{type:F,annotation:e,queryResponse:t,key:o}}const U="DYNAMIC_PLUGIN_CONTROLS_READY",$=()=>(e,t)=>{const o=t(),a=(0,s.R3)(o.explore,o.explore.form_data);e({type:U,key:a.slice_id.value,controlsState:a})};async function q({formData:e,setDataMask:t=(()=>{}),resultFormat:o="json",resultType:a="full",force:n=!1,method:i="POST",requestParams:s={},ownState:u={}}){let h={...s};return f._&&(h={...h,mode:"cors",credentials:"include"}),(0,d.kP)(e)?(async(e,t,o,a,n="POST",i={})=>{const s=(0,d.pd)({resultFormat:t,resultType:o}),u=f._&&(null==i?void 0:i.dashboard_id),h=(0,d.H6)({formData:e,endpointType:s,force:a,allowDomainSharding:u,method:n,requestParams:i.dashboard_id?{dashboard_id:i.dashboard_id}:{}}),p={...i,url:h,postPayload:{form_data:e}};return((0,l.cr)(c.T.CLIENT_CACHE)?r.Z.get:r.Z.post)(p).then((({json:e,response:t})=>({response:t,json:{result:[e]}})))})(e,o,a,n,i,h):(async(e,t,o,a,n,i,s)=>{const l=(0,d.u)({formData:e,resultType:o,resultFormat:t,force:a,setDataMask:i,ownState:s}),{slice_id:c}=e,{dashboard_id:u}=n,h={};void 0!==c&&(h.form_data=`{"slice_id":${c}}`),void 0!==u&&(h.dashboard_id=u),!1!==a&&(h.force=a);const p=f._&&(null==n?void 0:n.dashboard_id),m=(0,d.kN)({path:"/api/v1/chart/data",qs:h,allowDomainSharding:p}).toString(),g={...n,url:m,headers:{"Content-Type":"application/json"},body:JSON.stringify(l)};return r.Z.post(g)})(e,o,a,n,h,t,u)}function V({annotation:e,timeout:t=60,formData:o=null,key:a,isDashboardRequest:n=!1,force:i=!1}){return function(s,l){const c=a||Object.keys(l().charts)[0],h={...o||l().charts[c].latestQueryFormData};if(!(0,u.m7)(e.sourceType))return Promise.resolve();const p=h.time_grain_sqla||h.granularity;h.time_grain_sqla=p,h.granularity=p;const m=Object.keys(e.overrides);(m.includes("since")||m.includes("until"))&&(e.overrides={...e.overrides,time_range:null});const f=Object.keys(e.overrides).reduce(((t,o)=>({...t,[o]:e.overrides[o]||h[o]})),{});if(!n&&h){const e=h.extra_filters&&h.extra_filters.length>0;f.extra_filters=e?h.extra_filters:void 0}const v=e.sourceType===u.S4.NATIVE,b=(0,d.xW)(e.value,f,v,i),_=new AbortController,{signal:y}=_;return s(k(e,_,c)),r.Z.get({url:b,signal:y,timeout:1e3*t}).then((({json:t})=>s(D(e,t,c)))).catch((t=>(0,g.O)(t).then((t=>{"timeout"===t.statusText?s(P(e,{error:"Query timeout"},c)):(t.error||"").toLowerCase().includes("no data")?s(D(e,t,c)):"abort"!==t.statusText&&s(P(e,t,c))}))))}}const j="TRIGGER_QUERY";function H(e=!0,t){return{type:j,value:e,key:t}}const B="RENDER_TRIGGERED";function G(e,t){return{type:B,value:e,key:t}}const z="UPDATE_QUERY_FORM_DATA";function Q(e,t){return{type:z,value:e,key:t}}const K="UPDATE_CHART_ID";function W(e,t=0){return{type:K,newId:e,key:t}}const Y="ADD_CHART";function J(e,t){return{type:Y,chart:e,key:t}}function X(e,t=!1,o=60,a,r,i,s){return async u=>{const h=m.Yd.getTimestamp(),f=new AbortController,_={signal:f.signal,timeout:1e3*o};i&&(_.dashboard_id=i);const C=q({setDataMask:t=>{u((0,v.eG)(e.slice_id,t))},formData:e,resultFormat:"json",resultType:"full",force:t,method:r,requestParams:_,ownState:s});u(y(f,e,a));const T=C.then((({response:t,json:o})=>{if((0,l.cr)(c.T.GLOBAL_ASYNC_QUERIES)){const a="result"in o?o.result:o;switch(t.status){case 200:return Promise.resolve(a);case 202:return(0,d.kP)(e)?(0,b.YJ)(a[0]):(0,b.YJ)(a);default:throw new Error(`Received unexpected response status (${t.status}) while fetching chart data`)}}return o.result})).then((o=>(o.forEach((o=>u((0,p.logEvent)(m.W9,{slice_id:a,applied_filters:o.applied_filters,is_cached:o.is_cached,force_refresh:t,row_count:o.rowcount,datasource:e.datasource,start_offset:h,ts:(new Date).getTime(),duration:m.Yd.getTimestamp()-h,has_extra_filters:e.extra_filters&&e.extra_filters.length>0,viz_type:e.viz_type,data_age:o.is_cached?n()(new Date).diff(n().utc(o.cached_dttm)):null})))),u(E(o,a))))).catch((t=>{if((0,l.cr)(c.T.GLOBAL_ASYNC_QUERIES))return u(x([t],a));const o=(t,o)=>{u((0,p.logEvent)(m.W9,{slice_id:a,has_err:!0,is_cached:o,error_details:t,datasource:e.datasource,start_offset:h,ts:(new Date).getTime(),duration:m.Yd.getTimestamp()-h}))};return"AbortError"===t.name?(o("abort"),u(S(a))):(0,g.O)(t).then((e=>("timeout"===t.statusText?o("timeout"):o(e.error,e.is_cached),u(x([e],a)))))})),Z=(0,d.kP)(e)&&e.annotation_layers||[],A=i>0;return Promise.all([T,u(H(!1,a)),u(Q(e,a)),...Z.map((n=>u(V({annotation:n,timeout:o,formData:e,key:a,isDashboardRequest:A,force:t}))))])}}const ee="GET_SAVED_CHART";function te(e,t=!1,o=60,a,n,r){return X(e,t,o,a,"GET",n,r)}const oe="POST_CHART_FORM_DATA";function ae(e,t=!1,o=60,a,n,r){return X(e,t,o,a,"POST",n,r)}function ne(e){return t=>{q({formData:e,resultFormat:"json",resultType:"query"}).then((({json:t})=>{const o={datasourceKey:e.datasource,sql:t.result[0].query};(0,d.Md)("/superset/sqllab/",o)})).catch((()=>t((0,h.Gb)((0,i.t)("An error occurred while loading the SQL")))))}}function re(e,t,o){return(a,n)=>{var r;const i=(n().charts||{})[e],s=n().dashboardInfo.common.conf.SUPERSET_WEBSERVER_TIMEOUT;i.latestQueryFormData&&0!==Object.keys(i.latestQueryFormData).length&&a(ae(i.latestQueryFormData,t,s,i.id,o,null==(r=n().dataMask[i.id])?void 0:r.ownState))}}},57902:(e,t,o)=>{o.d(t,{Z:()=>d});var a=o(67294),n=o(45697),r=o.n(n),i=o(61988),s=o(72875),l=o(11965);const c={children:r().node.isRequired,onError:r().func,showMessage:r().bool};class d extends a.Component{constructor(e){super(e),this.state={error:null,info:null}}componentDidCatch(e,t){this.props.onError&&this.props.onError(e,t),this.setState({error:e,info:t})}render(){const{error:e,info:t}=this.state;if(e){const o=e.toString(),a=(0,l.tZ)("span",null,(0,l.tZ)("strong",null,(0,i.t)("Unexpected error")),o?`: ${o}`:"");return this.props.showMessage?(0,l.tZ)(s.Z,{subtitle:a,copyText:a,stackTrace:t?t.componentStack:null}):null}return this.props.children}}d.propTypes=c,d.defaultProps={onError:()=>{},showMessage:!0}},81395:(e,t,o)=>{function a(e,t){return e().dashboardState.sliceIds.includes(t)}o.d(t,{fK:()=>n,KJ:()=>r,l3:()=>i,ku:()=>s,oW:()=>l,M6:()=>c,oT:()=>d,yz:()=>u,ib:()=>h,P_:()=>p,cK:()=>m,l6:()=>g});const n="ADD_FILTER";function r(e,t,o){return(r,i)=>a(i,e)?r({type:n,chartId:e,component:t,form_data:o}):i().dashboardFilters}const i="REMOVE_FILTER";function s(e){return(t,o)=>a(o,e)?t({type:i,chartId:e}):o().dashboardFilters}const l="CHANGE_FILTER";function c(e,t,o){return(n,r)=>{if(a(r,e)){const a=r().dashboardLayout.present;return n({type:l,chartId:e,newSelectedValues:t,merge:o,components:a})}return r().dashboardFilters}}const d="UPDATE_DIRECT_PATH_TO_FILTER";function u(e,t){return(o,n)=>a(n,e)?o({type:d,chartId:e,path:t}):n().dashboardFilters}const h="UPDATE_LAYOUT_COMPONENTS";function p(e){return t=>{t({type:h,components:e})}}const m="UPDATE_DASHBOARD_FILTERS_SCOPE";function g(e){return t=>{t({type:m,scopes:e})}}},63389:(e,t,o)=>{o.d(t,{$:()=>N,Y:()=>k});var a,n=o(11064),r=o(16355),i=o(37863),s=o(37927),l=o(39759),c=o(35854),d=o(43399),u=o(70695),h=o(39023),p=o(80621),m=o(81255),g=o(53046),f=o(56967),v=o(28428),b=o(51777),_=o(27600),y=o(23525),C=o(69856),E=o(42190),T=o(91877),S=o(93185),Z=o(70400),x=o(41609),A=o.n(x),R=o(13311),w=o.n(R),L=o(14670),I=o.n(L),O=o(811);!function(e){e.FILTER_TIME="filter_time",e.FILTER_TIMEGRAIN="filter_timegrain",e.FILTER_TIMECOLUMN="filter_timecolumn",e.FILTER_SELECT="filter_select",e.FILTER_RANGE="filter_range"}(a||(a={}));const M=(e,t)=>A()(e)?A()(t)?[]:[t]:[e];var D=o(41295);const N="HYDRATE_DASHBOARD",k=(e,t,o=C.Qi.NOOP,x)=>(R,L)=>{var k,F;const{user:P,common:U,dashboardState:$}=L(),{metadata:q}=e,V=(0,Z.Z)("regular"),j="true"===(0,Z.Z)("reserved").edit;let H={};t.forEach((e=>{e.slice_id=e.form_data.slice_id}));try{H=(0,y.eY)(_.KD.preselectFilters)||JSON.parse(q.default_filters)}catch(e){}null!=q&&q.shared_label_colors&&(0,D.fO)(q,null==q?void 0:q.shared_label_colors),null!=q&&q.label_colors&&(0,D.fO)(q,null==q?void 0:q.label_colors);const{position_data:B}=e,G=B&&Object.keys(B).length>0?B:{[p.Zn]:"v2",[p._4]:{type:m.U0,id:p._4,children:[p.PV]},[p.PV]:{type:m.BG,id:p.PV,children:[],parents:[p._4]}},z={};Object.values(G).forEach((e=>{e.type===m.dW&&(z[e.meta.chartId]=e.id)}));const Q=function(e={}){let t=e[p._4];return t=t&&t.children.length&&e[t.children[0]].type===m.yR?e[e[t.children[0]].children[0]]:e[t.children[0]],t.id}(G),K=G[Q];let W,Y=0;const J=(null==q?void 0:q.filter_scopes)||{},X={},ee={},te={},oe=new Set;t.forEach((e=>{const t=e.slice_id,a={...e.form_data,url_params:{...e.form_data.url_params,...V}};if(X[t]={...i.u,id:t,form_data:a,formData:(0,c.oN)(a)},te[t]={slice_id:t,slice_url:e.slice_url,slice_name:e.slice_name,form_data:e.form_data,viz_type:e.form_data.viz_type,datasource:e.form_data.datasource,description:e.description,description_markeddown:e.description_markeddown,owners:e.owners,modified:e.modified,changed_on:new Date(e.changed_on).getTime()},oe.add(t),!z[t]&&G[Q]){(0===Y||Y+p.fw>p.cz)&&(W=(0,v.Z)(m.Os,(K.parents||[]).slice()),G[W.id]=W,K.children.push(W.id),Y=0);const t=(0,v.Z)(m.dW,{chartId:e.slice_id},(W.parents||[]).slice());G[t.id]=t,W.children.push(t.id),z[t.meta.chartId]=t.id,Y+=p.fw}if("filter_box"===e.form_data.viz_type){const a=(0,g.Z)(e.form_data);let{columns:n}=a;const{labels:r}=a;H[t]&&Object.keys(n).forEach((e=>{H[t][e]&&(n={...n,[e]:H[t][e]})}));const i=Object.keys(n).reduce(((e,o)=>{const a={...J[t]},{scope:n,immune:r}={...h.GI,...a[o]};return{...e,[o]:{scope:n,immune:r}}}),{}),s=z[t],l=(G[s].parents||[]).slice();l.push(s),[C.Qi.NOOP,C.Qi.SNOOZED].includes(o)&&(ee[t]={...h.Mj,chartId:t,componentId:s,datasourceId:e.form_data.datasource,filterName:e.slice_name,directPathToFilter:l,columns:n,labels:r,scopes:i,isDateFilter:Object.keys(n).includes(b.TIME_RANGE)})}const n=z[t];n&&G[n]&&(G[n].meta.sliceName=e.slice_name)})),(0,d.DU)({dashboardFilters:ee,components:G}),G[p.M2]={id:p.M2,type:m.Vl,meta:{text:e.dashboard_title}};const ae={past:[],present:G,future:[]},ne=(0,f.Z)();let re=[];G[ne]&&(re=(G[ne].parents||[]).slice(),re.push(ne));let ie=(null==q?void 0:q.native_filter_configuration)||[];o===C.Qi.REVIEWING&&(ie=function(e=[],t={},o={}){const n=[],r={};e.forEach((e=>{const i=String(e.slice_id);if("filter_box"===e.form_data.viz_type){r[i]={};const l=(0,g.Z)(e.form_data);let{columns:c}=l;o[i]&&Object.keys(c).forEach((e=>{o[i][e]&&(c={...c,[e]:o[i][e]})}));const d=Object.keys(c).reduce(((e,o)=>{const a={...t[i]},{scope:n,immune:r}={...h.GI,...a[o]};return{...e,[o]:{scope:n,immune:r}}}),{}),{adhoc_filters:u=[],datasource:p="",date_filter:m=!1,druid_time_origin:f,filter_configs:v=[],granularity:b,granularity_sqla:_,show_druid_time_granularity:y=!1,show_druid_time_origin:E=!1,show_sqla_time_column:T=!1,show_sqla_time_granularity:S=!1,time_grain_sqla:Z,time_range:x}=e.form_data,R=(s=o,(e,t)=>s[e]&&s[e][t]?s[e][t]:null);if(m){const{scope:e,immune:t}=d[C.i2.time_range]||h.GI,o={id:`NATIVE_FILTER-${I().generate()}`,description:"time range filter",controlValues:{},name:C.m_.time_range,filterType:a.FILTER_TIME,targets:[{}],cascadeParentIds:[],defaultDataMask:{},type:O.BE.NATIVE_FILTER,scope:{rootPath:e,excluded:t}};r[i][C.i2.time_range]=o.id;const s=R(i,C.i2.time_range)||x;if(A()(s)||(o.defaultDataMask={extraFormData:{time_range:s},filterState:{value:s}}),n.push(o),S){const{scope:e,immune:t}=d[C.i2.time_grain_sqla]||h.GI,o={id:`NATIVE_FILTER-${I().generate()}`,controlValues:{},description:"time grain filter",name:C.m_.time_grain_sqla,filterType:a.FILTER_TIMEGRAIN,targets:[{datasetId:parseInt(p.split("__")[0],10)}],cascadeParentIds:[],defaultDataMask:{},type:O.BE.NATIVE_FILTER,scope:{rootPath:e,excluded:t}};r[i][C.i2.time_grain_sqla]=o.id;const s=R(i,C.i2.time_grain_sqla);A()(s)||(o.defaultDataMask={extraFormData:{time_grain_sqla:s||Z},filterState:{value:M(s,Z)}}),n.push(o)}if(T){const{scope:e,immune:t}=d[C.i2.granularity_sqla]||h.GI,o={id:`NATIVE_FILTER-${I().generate()}`,description:"time column filter",controlValues:{},name:C.m_.granularity_sqla,filterType:a.FILTER_TIMECOLUMN,targets:[{datasetId:parseInt(p.split("__")[0],10)}],cascadeParentIds:[],defaultDataMask:{},type:O.BE.NATIVE_FILTER,scope:{rootPath:e,excluded:t}};r[i][C.i2.granularity_sqla]=o.id;const s=R(i,C.i2.granularity_sqla);A()(s)||(o.defaultDataMask={extraFormData:{granularity_sqla:s||_},filterState:{value:M(s,_)}}),n.push(o)}if(y){const{scope:e,immune:t}=d[C.i2.granularity]||h.GI,o={id:`NATIVE_FILTER-${I().generate()}`,description:"time grain filter",controlValues:{},name:C.m_.granularity,filterType:a.FILTER_TIMEGRAIN,targets:[{datasetId:parseInt(p.split("__")[0],10)}],cascadeParentIds:[],defaultDataMask:{},type:O.BE.NATIVE_FILTER,scope:{rootPath:e,excluded:t}};r[i][C.i2.granularity]=o.id;const s=R(i,C.i2.granularity);A()(s)||(o.defaultDataMask={extraFormData:{granularity_sqla:s||b},filterState:{value:M(s,b)}}),n.push(o)}if(E){const{scope:e,immune:t}=d[C.i2.druid_time_origin]||h.GI,o={id:`NATIVE_FILTER-${I().generate()}`,description:"time column filter",controlValues:{},name:C.m_.druid_time_origin,filterType:a.FILTER_TIMECOLUMN,targets:[{datasetId:parseInt(p.split("__")[0],10)}],cascadeParentIds:[],defaultDataMask:{},type:O.BE.NATIVE_FILTER,scope:{rootPath:e,excluded:t}};r[i][C.i2.druid_time_origin]=o.id;const s=R(i,C.i2.druid_time_origin);A()(s)||(o.defaultDataMask={extraFormData:{granularity_sqla:s||f},filterState:{value:M(s,f)}}),n.push(o)}}v.forEach((e=>{const{scope:t,immune:o}=d[e.column]||h.GI,s={id:`NATIVE_FILTER-${I().generate()}`,description:"",controlValues:{enableEmptyFilter:!e[C.ft.CLEARABLE],defaultToFirstItem:!1,inverseSelection:!1,multiSelect:e[C.ft.MULTIPLE],sortAscending:e[C.ft.SORT_ASCENDING]},name:e.label||e.column,filterType:a.FILTER_SELECT,targets:[{datasetId:parseInt(p.split("__")[0],10),column:{name:e.column}}],cascadeParentIds:[],defaultDataMask:{},type:O.BE.NATIVE_FILTER,scope:{rootPath:t,excluded:o},adhoc_filters:u,sortMetric:e[C.ft.SORT_METRIC],time_range:x};r[i][e.column]=s.id;const l=R(i,e.column)||(e=>{let t=e[C.ft.DEFAULT_VALUE];return""===t&&(t=null),t&&e[C.ft.MULTIPLE]&&(t=e.defaultValue.split(";")),t})(e);A()(l)||(s.defaultDataMask={extraFormData:{filters:[{col:e.column,op:"IN",val:l}]},filterState:{value:l}}),n.push(s)}))}var s}));const i=(e=>{const t={},o=Object.keys(e).map((e=>parseInt(e,10)));return Object.entries(e).forEach((([e,a])=>{t[e]={},Object.entries(a).forEach((([a,n])=>{t[e][a]=(0,d.up)({filterScope:n}).filter((t=>o.includes(t)&&String(t)!==e))}))})),t})(t);return Object.entries(i).forEach((([e,t])=>{Object.entries(t).forEach((([t,o])=>{const i=r[e][t];o.forEach((e=>{Object.values(r[e]).forEach((e=>{const t=w()(n,(({id:t})=>t===e));t&&[a.FILTER_SELECT,a.FILTER_RANGE].includes(t.filterType)&&(t.cascadeParentIds=t.cascadeParentIds||[],t.cascadeParentIds.push(i))}))}))}))})),n}(t,J,H),q.native_filter_configuration=ie,q.show_native_filters=!0);const se=(0,l.a)({filterConfig:ie});q.show_native_filters=null!=(k=null==e||null==(F=e.metadata)?void 0:F.show_native_filters)?k:(0,T.cr)(S.T.DASHBOARD_NATIVE_FILTERS)&&[C.Qi.CONVERTED,C.Qi.REVIEWING,C.Qi.NOOP].includes(o),(0,T.cr)(S.T.DASHBOARD_CROSS_FILTERS)&&Object.values(ae.present).forEach((e=>{var t,o,a,i,s,l;const c=null==(t=e.meta)?void 0:t.chartId,d=null!=(o=null==(a=null!=(i=(0,n.Z)().get(null==(s=X[c])||null==(l=s.formData)?void 0:l.viz_type))?i:{})?void 0:a.behaviors)?o:[];q.chart_configuration||(q.chart_configuration={}),d.includes(r.cg.INTERACTIVE_CHART)&&!q.chart_configuration[c]&&(q.chart_configuration[c]={id:c,crossFilters:{scope:{rootPath:[p._4],excluded:[c]}}})}));const{roles:le}=P,ce=(0,u.Ms)(e,P);return R({type:N,data:{sliceEntities:{...s.b,slices:te,isLoading:!1},charts:X,dashboardInfo:{...e,metadata:q,userId:P.userId?String(P.userId):null,dash_edit_perm:ce,dash_save_perm:(0,u.ZP)("can_save_dash","Superset",le),dash_share_perm:(0,u.ZP)("can_share_dashboard","Superset",le),superset_can_explore:(0,u.ZP)("can_explore","Superset",le),superset_can_share:(0,u.ZP)("can_share_chart","Superset",le),superset_can_csv:(0,u.ZP)("can_csv","Superset",le),slice_can_edit:(0,u.ZP)("can_slice","Superset",le),common:{flash_messages:null==U?void 0:U.flash_messages,conf:null==U?void 0:U.conf}},dataMask:x,dashboardFilters:ee,nativeFilters:se,dashboardState:{preselectNativeFilters:(0,y.eY)(_.KD.nativeFilters),sliceIds:Array.from(oe),directPathToChild:re,directPathLastUpdated:Date.now(),focusedFilterField:null,expandedSlices:(null==q?void 0:q.expanded_slices)||{},refreshFrequency:(null==q?void 0:q.refresh_frequency)||0,shouldPersistRefreshFrequency:!1,css:e.css||"",colorNamespace:(null==q?void 0:q.color_namespace)||null,colorScheme:(null==q?void 0:q.color_scheme)||null,editMode:ce&&j,isPublished:e.published,hasUnsavedChanges:!1,maxUndoHistoryExceeded:!1,lastModifiedTime:e.changed_on,isRefreshing:!1,isFiltersRefreshing:!1,activeTabs:(null==$?void 0:$.activeTabs)||[],filterboxMigrationState:o,datasetsStatus:E.ni.LOADING},dashboardLayout:ae}})}},68969:(e,t,o)=>{o.d(t,{lf:()=>d,D2:()=>h,cK:()=>p,To:()=>m});var a=o(31069),n=o(61988),r=o(15926),i=o.n(r),s=o(72570),l=o(16737),c=o(98286);const d="SET_ALL_SLICES";function u(e){return{type:d,payload:{slices:e}}}const h="FETCH_ALL_SLICES_STARTED",p="FETCH_ALL_SLICES_FAILED";function m(e,t=!1){return(o,r)=>{const{sliceEntities:d}=r();return 0===d.lastUpdated?(o({type:h}),a.Z.get({endpoint:`/api/v1/chart/?q=${i().encode({columns:["changed_on_delta_humanized","changed_on_utc","datasource_id","datasource_type","datasource_url","datasource_name_text","description_markeddown","description","id","params","slice_name","url","viz_type"],filters:[{col:"owners",opr:"rel_m_m",value:e}],page_size:200,order_column:"changed_on_delta_humanized",order_direction:"desc"})}`}).then((({json:e})=>{const a={};let{result:n}=e;return t&&(n=n.filter((e=>"filter_box"!==e.viz_type))),n.forEach((e=>{let t=JSON.parse(e.params);t={...t,datasource:(0,l.n_)(e.datasource_id,e.datasource_type)||t.datasource},a[e.id]={slice_id:e.id,slice_url:e.url,slice_name:e.slice_name,form_data:t,datasource_name:e.datasource_name_text,datasource_url:e.datasource_url,datasource_id:e.datasource_id,datasource_type:e.datasource_type,changed_on:new Date(e.changed_on_utc).getTime(),description:e.description,description_markdown:e.description_markeddown,viz_type:e.viz_type,modified:e.changed_on_delta_humanized,changed_on_humanized:e.changed_on_delta_humanized}})),o(u(a))})).catch((e=>console.log(e)||(0,c.O)(e).then((({error:e})=>{o(function(e){return{type:p,payload:{error:e}}}(e||(0,n.t)("Could not fetch all saved charts"))),o((0,s.Gb)((0,n.t)("Sorry there was an error fetching saved charts: ")+e))}))))):o(u(d.slices))}}},39023:(e,t,o)=>{o.d(t,{GI:()=>d,Mj:()=>u,ZP:()=>p});var a=o(81395),n=o(63389),r=o(51777),i=o(80621),s=o(53046),l=o(43399),c=o(20194);const d={scope:[i._4],immune:[]},u={chartId:null,componentId:null,filterName:null,datasourceId:null,directPathToFilter:[],isDateFilter:!1,isInstantFilter:!0,columns:{},labels:{},scopes:{}},h=[a.fK,a.l3,a.oW];function p(e={},t){const o={[a.fK](){const{chartId:e,component:o,form_data:a}=t,{columns:n,labels:i}=(0,s.Z)(a),l=Object.keys(n).reduce(((e,t)=>({...e,[t]:d})),{}),c=o?(o.parents||[]).slice().concat(o.id):[];return{...u,chartId:e,componentId:o.id,datasourceId:a.datasource,filterName:o.meta.sliceName,directPathToFilter:c,columns:n,labels:i,scopes:l,isInstantFilter:!!a.instant_filtering,isDateFilter:Object.keys(n).includes(r.TIME_RANGE)}},[a.oW](e){const{newSelectedValues:o,merge:a}=t,n=Object.keys(o).reduce(((e,t)=>a&&t in e?{...e,[t]:[...e[t],...o[t]]}:{...e,[t]:o[t]}),{...e.columns});return{...e,columns:n}},[a.oT](e){const{path:o}=t;return{...e,directPathToFilter:o}}};if(t.type===a.ib)return(0,l.DU)({dashboardFilters:e,components:t.components}),e;if(t.type===a.cK){const o=t.scopes,a=Object.entries(o).reduce(((e,t)=>{const[o,{scope:a,immune:n}]=t,{chartId:r,column:i}=(0,c._)(o),s={...e[r].scopes,[i]:{scope:a,immune:n}};return{...e,[r]:{...e[r],scopes:s}}}),e);return(0,l.DU)({dashboardFilters:a}),a}if(t.type===a.l3){const{chartId:o}=t,{[o]:a,...n}=e;return(0,l.DU)({dashboardFilters:n}),n}if(t.type===n.$)return t.data.dashboardFilters;if(t.type in o){const a={...e,[t.chartId]:o[t.type](e[t.chartId])};return h.includes(t.type)&&(0,l.DU)({dashboardFilters:a}),a}return e}},37927:(e,t,o)=>{o.d(t,{b:()=>i,Z:()=>s});var a=o(61988),n=o(68969),r=o(63389);const i={slices:{},isLoading:!0,errorMessage:null,lastUpdated:0};function s(e=i,t){const o={[r.$]:()=>({...t.data.sliceEntities}),[n.D2]:()=>({...e,isLoading:!0}),[n.lf]:()=>({...e,isLoading:!1,slices:{...e.slices,...t.payload.slices},lastUpdated:(new Date).getTime()}),[n.cK]:()=>({...e,isLoading:!1,lastUpdated:(new Date).getTime(),errorMessage:t.payload.error||(0,a.t)("Could not fetch all saved charts")})};return t.type in o?o[t.type]():e}},43399:(e,t,o)=>{o.d(t,{De:()=>b,Z3:()=>_,_f:()=>y,up:()=>C,DU:()=>E});var a=o(58809),n=o.n(a),r=o(8816),i=o.n(r),s=o(83927),l=o.n(s),c=o(41609),d=o.n(c),u=o(20194),h=o(81255),p=o(39023);let m=[],g={},f={},v={};function b(){return g}function _(e){return m.includes(e)}function y(e){if(!(e in f)){const t=Object.entries(g).filter((([,{scope:t}])=>t.includes(e)));f[e]=i()(n()((([e])=>(0,u._)(e).column)),l()((([,{values:e}])=>e)))(t)}return f[e]}function C({filterScope:e}){function t(e=[],o={},a=[]){o&&(o.type===h.dW&&o.meta&&o.meta.chartId&&!a.includes(o.meta.chartId)?e.push(o.meta.chartId):o.children&&o.children.forEach((o=>t(e,v[o],a))))}const o=[],{scope:a,immune:n}=e||p.GI;return a.forEach((e=>t(o,v[e],n))),o}function E({dashboardFilters:e={},components:t={}}){m=Object.values(e).map((e=>e.chartId)),d()(t)||(v=t),f={},g=Object.values(e).reduce(((e,t)=>{const{chartId:o,columns:a,scopes:n}=t,r={};return Object.keys(a).forEach((e=>{if(Array.isArray(a[e])?a[e].length:void 0!==a[e]){const t=C({filterScope:n[e]}).filter((e=>o!==e));r[(0,u.w)({chartId:o,column:e})]={values:a[e],scope:t}}})),{...e,...r}}),{})}},53046:(e,t,o)=>{o.d(t,{Z:()=>n});var a=o(69856);function n(e={}){const{date_filter:t,filter_configs:o=[],show_druid_time_granularity:n,show_druid_time_origin:r,show_sqla_time_column:i,show_sqla_time_granularity:s}=e;let l=o.reduce((({columns:e,labels:t},o)=>{let n=o[a.ft.DEFAULT_VALUE];return""===n&&(n=null),n&&o[a.ft.MULTIPLE]&&(n=o.defaultValue.split(";")),{columns:{...e,[o.column]:o.vals||n},labels:{...t,[o.column]:o.label}}}),{columns:{},labels:{}});if(t){let t={...l.columns,[a.i2.time_range]:e.time_range};const o={...l.labels,...Object.entries(a.i2).reduce(((e,[t,o])=>({...e,[o]:a.m_[t]})),{})};s&&(t={...t,[a.i2.time_grain_sqla]:e.time_grain_sqla}),i&&(t={...t,[a.i2.granularity_sqla]:e.granularity_sqla}),n&&(t={...t,[a.i2.granularity]:e.granularity}),r&&(t={...t,[a.i2.druid_time_origin]:e.druid_time_origin}),l={...l,columns:t,labels:o}}return l}},28428:(e,t,o)=>{o.d(t,{Z:()=>d});var a=o(14670),n=o.n(a),r=o(61988),i=o(81255),s=o(80621);const l={[i.dW]:{width:s.fw,height:50},[i.BA]:{width:s.fw,background:s.HE},[i.hE]:null,[i.Nc]:{text:"New header",headerSize:s.OE,background:s.HE},[i.xh]:{width:s.fw,height:50},[i.Os]:{background:s.HE},[i.yR]:null,[i.gn]:{text:"",defaultText:(0,r.t)("Tab title"),placeholder:(0,r.t)("Tab title")},[i.t]:{width:s.cz,background:s.HE}};function c(e){return`${e}-${n().generate()}`}function d(e,t,o=[]){return{type:e,id:c(e),children:[],parents:o,meta:{...l[e],...t}}}},11370:(e,t,o)=>{o.d(t,{Z:()=>n});var a=o(20194);function n(e){return Object.entries(e).reduce(((e,t)=>{const[o,{values:n}]=t,{chartId:r,column:i}=(0,a._)(o),s={...e[r],[i]:n};return{...e,[r]:s}}),{})}},79069:(e,t,o)=>{o.d(t,{Z:()=>p});var a=o(5872),n=o.n(a),r=o(67294),i=o(45697),s=o.n(i),l=o(82342),c=o(87253),d=o(11965);const u={value:s().bool,label:s().string,onChange:s().func},h={paddingRight:"5px"};class p extends r.Component{onChange(){this.props.onChange(!this.props.value)}renderCheckbox(){return(0,d.tZ)(c.ZP,{onChange:this.onChange.bind(this),style:h,checked:!!this.props.value})}render(){return this.props.label?(0,d.tZ)(l.Z,n()({},this.props,{leftNode:this.renderCheckbox(),onClick:this.onChange.bind(this)})):this.renderCheckbox()}}p.propTypes=u,p.defaultProps={value:!1,onChange:()=>{}}},95470:(e,t,o)=>{o.d(t,{Z:()=>C});var a=o(5872),n=o.n(a),r=o(11965),i=o(23560),s=o.n(i),l=o(67294),c=o(45697),d=o.n(c),u=o(4715),h=o(58593),p=o(61988),m=o(51995),g=o(70163),f=o(82342);const v={hasCustomLabelColors:d().bool,dashboardId:d().number,description:d().string,label:d().string,labelMargin:d().number,name:d().string.isRequired,onChange:d().func,value:d().string,clearable:d().bool,default:d().string,choices:d().oneOfType([d().arrayOf(d().array),d().func]),schemes:d().oneOfType([d().object,d().func]),isLinear:d().bool},b={choices:[],hasCustomLabelColors:!1,label:(0,p.t)("Color scheme"),schemes:{},clearable:!1,onChange:()=>{}},_=(0,m.iK)(g.Z.AlertSolid)`
  color: ${({theme:e})=>e.colors.alert.base};
`;var y={name:"kjime2",styles:"list-style:none;margin:0;padding:0;display:flex;align-items:center;& li{flex-basis:9px;height:10px;margin:9px 1px;}"};class C extends l.PureComponent{constructor(e){super(e),this.onChange=this.onChange.bind(this),this.renderOption=this.renderOption.bind(this),this.renderLabel=this.renderLabel.bind(this),this.dashboardColorSchemeAlert=(0,p.t)("The color scheme is determined by the related dashboard.\n              Edit the color scheme in the dashboard properties.")}onChange(e){this.props.onChange(e)}renderOption(e){const{isLinear:t}=this.props,o=this.schemes[e];let a=[];return o&&(a=t?o.getColors(10):o.colors),(0,r.tZ)("span",{key:o.id,title:o.label},(0,r.tZ)("ul",{css:y},a.map(((e,t)=>(0,r.tZ)("li",{key:`${o.id}-${t}`,css:(0,r.iv)({backgroundColor:e,border:`1px solid ${"white"===e?"black":e}`},"","")}," ")))))}renderLabel(){const{dashboardId:e,hasCustomLabelColors:t,label:o}=this.props;if(t||e){const e=t?(0,p.t)("This color scheme is being overriden by custom label colors.\n              Check the JSON metadata in the Advanced settings"):this.dashboardColorSchemeAlert;return(0,r.tZ)(l.Fragment,null,o," ",(0,r.tZ)(h.u,{title:e},(0,r.tZ)(_,{iconSize:"s"})))}return o}render(){const{choices:e,dashboardId:t,schemes:o}=this.props;let a=t?[{value:"dashboard",label:"dashboard",customLabel:(0,r.tZ)(h.u,{title:this.dashboardColorSchemeAlert},(0,p.t)("Dashboard scheme"))}]:[],i=t?"dashboard":void 0;if(!t){this.schemes=s()(o)?o():o;const t=s()(e)?e():e,n=[];var l,c;a=t.filter((e=>{const t=e[0],o="SUPERSET_DEFAULT"!==t&&!n.includes(t);return n.push(t),o})).map((([e])=>{var t,o;return{customLabel:this.renderOption(e),label:(null==(t=this.schemes)||null==(o=t[e])?void 0:o.label)||e,value:e}})),i=this.props.value||this.props.default,"SUPERSET_DEFAULT"===i&&(i=null==(l=this.schemes)||null==(c=l.SUPERSET_DEFAULT)?void 0:c.id)}const d={ariaLabel:(0,p.t)("Select color scheme"),allowClear:this.props.clearable,disabled:!!t,name:`select-${this.props.name}`,onChange:this.onChange,options:a,placeholder:(0,p.t)("Select scheme"),value:i};return(0,r.tZ)(u.Ph,n()({header:(0,r.tZ)(f.Z,n()({},this.props,{label:this.renderLabel()}))},d))}}C.propTypes=v,C.defaultProps=b},28543:(e,t,o)=>{o.d(t,{vq:()=>r,Pr:()=>i,ZP:()=>d});var a=o(69856),n=o(12515);const r={SIMPLE:"SIMPLE",SQL:"SQL"},i={HAVING:"HAVING",WHERE:"WHERE"},s={"==":"=","!=":"<>",">":">","<":"<",">=":">=","<=":"<=",IN:"IN","NOT IN":"NOT IN",LIKE:"LIKE",ILIKE:"ILIKE",REGEX:"REGEX","IS NOT NULL":"IS NOT NULL","IS NULL":"IS NULL","IS TRUE":"IS TRUE","IS FALSE":"IS FALSE","LATEST PARTITION":({datasource:e})=>`= '{{ presto.latest_partition('${e.schema}.${e.datasource_name}') }}'`},l=[...a.qB].map((e=>a.LT[e].operation));function c(e,{useSimple:t}={}){if(e.expressionType===r.SIMPLE||t){const{subject:t,comparator:o}=e,a=e.operator&&l.indexOf(e.operator)>=0?s[e.operator](e):s[e.operator];return(0,n.CB)(t,a,o)}return e.expressionType===r.SQL?e.sqlExpression:""}class d{constructor(e){var t;this.expressionType=e.expressionType||r.SIMPLE,this.expressionType===r.SIMPLE?(this.subject=e.subject,this.operator=null==(t=e.operator)?void 0:t.toUpperCase(),this.operatorId=e.operatorId,this.comparator=e.comparator,[a.d.IS_TRUE,a.d.IS_FALSE].indexOf(e.operatorId)>=0&&(this.comparator=e.operatorId===a.d.IS_TRUE),[a.d.IS_NULL,a.d.IS_NOT_NULL].indexOf(e.operatorId)>=0&&(this.comparator=null),this.clause=e.clause||i.WHERE,this.sqlExpression=null):this.expressionType===r.SQL&&(this.sqlExpression="string"==typeof e.sqlExpression?e.sqlExpression:c(e,{useSimple:!0}),this.clause=e.clause,e.operator&&l.indexOf(e.operator)>=0?(this.subject=e.subject,this.operator=e.operator,this.operatorId=e.operatorId):(this.subject=null,this.operator=null),this.comparator=null),this.isExtra=!!e.isExtra,this.isNew=!!e.isNew,this.filterOptionName=e.filterOptionName||`filter_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}duplicateWith(e){return new d({...this,isNew:!1,...e})}equals(e){return e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.operator===this.operator&&e.operatorId===this.operatorId&&e.comparator===this.comparator&&e.subject===this.subject}isValid(){const e=[a.d.IS_NOT_NULL,a.d.IS_NULL].map((e=>a.LT[e].operation)),t=[a.d.IS_TRUE,a.d.IS_FALSE].map((e=>a.LT[e].operation));if(this.expressionType===r.SIMPLE){if(e.indexOf(this.operator)>=0)return!(!this.operator||!this.subject);if(t.indexOf(this.operator)>=0)return!(!this.subject||null===this.comparator);if(this.operator&&this.subject&&this.clause)if(Array.isArray(this.comparator)){if(this.comparator.length>0)return!0}else if(null!==this.comparator)return!0}else if(this.expressionType===r.SQL)return!(!this.sqlExpression||!this.clause);return!1}getDefaultLabel(){const e=this.translateToSql();return e.length<43?e:`${e.substring(0,40)}...`}getTooltipTitle(){return this.translateToSql()}translateToSql(){return c(this)}}},46566:(e,t,o)=>{o.d(t,{Z:()=>O});var a=o(67294),n=o(45697),r=o.n(n),i=o(31069),s=o(68492),l=o(55786),c=o(61988),d=o(68135),u=o(82342),h=o(17536),p=o(27130),m=o(19113),g=o(69856),f=o(40266),v=o(33334),b=o(70163),_=o(94968),y=o(42753),C=o(72201),E=o(28543),T=o(11965);const S={adhocFilter:r().instanceOf(E.ZP).isRequired,onFilterEdit:r().func.isRequired,onRemoveFilter:r().func,options:r().arrayOf(r().oneOfType([C.Z,r().shape({saved_metric_name:r().string.isRequired}),h.Z])).isRequired,sections:r().arrayOf(r().string),operators:r().arrayOf(r().string),datasource:r().object,partitionColumn:r().string,onMoveLabel:r().func,onDropLabel:r().func,index:r().number},Z=({adhocFilter:e,options:t,datasource:o,onFilterEdit:a,onRemoveFilter:n,partitionColumn:r,onMoveLabel:i,onDropLabel:s,index:l,sections:c,operators:d})=>(0,T.tZ)(_.Z,{sections:c,operators:d,adhocFilter:e,options:t,datasource:o,onFilterEdit:a,partitionColumn:r},(0,T.tZ)(v.yz,{label:e.getDefaultLabel(),tooltipTitle:e.getTooltipTitle(),onRemove:n,onMoveLabel:i,onDropLabel:s,index:l,type:y.g.FilterOption,withCaret:!0,isExtra:e.isExtra})),x=Z;Z.propTypes=S;const A=r().oneOfType([r().shape({expressionType:r().oneOf([E.vq.SIMPLE]).isRequired,clause:r().oneOf([E.Pr.HAVING,E.Pr.WHERE]).isRequired,subject:r().string.isRequired,comparator:r().oneOfType([r().string,r().arrayOf(r().string)]).isRequired}),r().shape({expressionType:r().oneOf([E.vq.SQL]).isRequired,clause:r().oneOf([E.Pr.WHERE,E.Pr.HAVING]).isRequired,sqlExpression:r().string.isRequired})]),R=r().oneOfType([r().string,h.Z]),w={label:r().oneOfType([r().object,r().string]),name:r().string,sections:r().arrayOf(r().string),operators:r().arrayOf(r().string),onChange:r().func,value:r().arrayOf(A),datasource:r().object,columns:r().arrayOf(C.Z),savedMetrics:r().arrayOf(p.Z),selectedMetrics:r().oneOfType([R,r().arrayOf(R)]),isLoading:r().bool};function L(e){return e&&!(e instanceof E.ZP)&&e.expressionType}class I extends a.Component{constructor(e){super(e),this.optionsForSelect=this.optionsForSelect.bind(this),this.onRemoveFilter=this.onRemoveFilter.bind(this),this.onNewFilter=this.onNewFilter.bind(this),this.onFilterEdit=this.onFilterEdit.bind(this),this.moveLabel=this.moveLabel.bind(this),this.onChange=this.onChange.bind(this),this.mapOption=this.mapOption.bind(this),this.getMetricExpression=this.getMetricExpression.bind(this);const t=(this.props.value||[]).map((e=>L(e)?new E.ZP(e):e));this.optionRenderer=e=>(0,T.tZ)(f.Z,{option:e}),this.valueRenderer=(e,t)=>(0,T.tZ)(x,{key:t,index:t,adhocFilter:e,onFilterEdit:this.onFilterEdit,options:this.state.options,sections:this.props.sections,operators:this.props.operators,datasource:this.props.datasource,onRemoveFilter:()=>this.onRemoveFilter(t),onMoveLabel:this.moveLabel,onDropLabel:()=>this.props.onChange(this.state.values),partitionColumn:this.state.partitionColumn}),this.state={values:t,options:this.optionsForSelect(this.props),partitionColumn:null}}componentDidMount(){const{datasource:e}=this.props;if(e&&"table"===e.type){var t;const o=null==(t=e.database)?void 0:t.id,{datasource_name:a,schema:n,is_sqllab_view:r}=e;!r&&o&&a&&n&&i.Z.get({endpoint:`/superset/extra_table_metadata/${o}/${a}/${n}/`}).then((({json:e})=>{if(e&&e.partitions){const{partitions:t}=e;t&&t.cols&&1===Object.keys(t.cols).length&&this.setState({partitionColumn:t.cols[0]})}})).catch((e=>{s.Z.error("fetch extra_table_metadata:",e.statusText)}))}}UNSAFE_componentWillReceiveProps(e){this.props.columns!==e.columns&&this.setState({options:this.optionsForSelect(e)}),this.props.value!==e.value&&this.setState({values:(e.value||[]).map((e=>L(e)?new E.ZP(e):e))})}onRemoveFilter(e){const t=[...this.state.values];t.splice(e,1),this.setState((e=>({...e,values:t}))),this.props.onChange(t)}onNewFilter(e){const t=this.mapOption(e);t&&this.setState((e=>({...e,values:[...e.values,t]})),(()=>{this.props.onChange(this.state.values)}))}onFilterEdit(e){this.props.onChange(this.state.values.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}onChange(e){const t=(e||[]).map((e=>this.mapOption(e))).filter((e=>e));this.props.onChange(t)}getMetricExpression(e){return this.props.savedMetrics.find((t=>t.metric_name===e)).expression}moveLabel(e,t){const{values:o}=this.state,a=[...o];[a[t],a[e]]=[a[e],a[t]],this.setState({values:a})}mapOption(e){return e instanceof E.ZP?e:e.saved_metric_name?new E.ZP({expressionType:"druid"===this.props.datasource.type?E.vq.SIMPLE:E.vq.SQL,subject:"druid"===this.props.datasource.type?e.saved_metric_name:this.getMetricExpression(e.saved_metric_name),operator:g.LT[g.d.GREATER_THAN].operation,comparator:0,clause:E.Pr.HAVING}):e.label?new E.ZP({expressionType:"druid"===this.props.datasource.type?E.vq.SIMPLE:E.vq.SQL,subject:"druid"===this.props.datasource.type?e.label:new m.Z(e).translateToSql(),operator:g.LT[g.d.GREATER_THAN].operation,comparator:0,clause:E.Pr.HAVING}):e.column_name?new E.ZP({expressionType:E.vq.SIMPLE,subject:e.column_name,operator:g.LT[g.d.EQUALS].operation,comparator:"",clause:E.Pr.WHERE,isNew:!0}):null}optionsForSelect(e){return[...e.columns,...(0,l.Z)(e.selectedMetrics).map((e=>e&&("string"==typeof e?{saved_metric_name:e}:new m.Z(e))))].filter((e=>e)).reduce(((e,t)=>(t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof m.Z&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>(e.saved_metric_name||e.column_name||e.label).localeCompare(t.saved_metric_name||t.column_name||t.label)))}addNewFilterPopoverTrigger(e){return(0,T.tZ)(_.Z,{operators:this.props.operators,sections:this.props.sections,adhocFilter:new E.ZP({}),datasource:this.props.datasource,options:this.state.options,onFilterEdit:this.onNewFilter,partitionColumn:this.state.partitionColumn},e)}render(){const{theme:e}=this.props;return(0,T.tZ)("div",{className:"metrics-select"},(0,T.tZ)(v.gM,null,(0,T.tZ)(u.Z,this.props),this.addNewFilterPopoverTrigger((0,T.tZ)(v.IG,null,(0,T.tZ)(b.Z.PlusLarge,{iconSize:"s",iconColor:e.colors.grayscale.light5})))),(0,T.tZ)(v.yj,null,this.state.values.length>0?this.state.values.map(((e,t)=>this.valueRenderer(e,t))):this.addNewFilterPopoverTrigger((0,T.tZ)(v.SW,null,(0,T.tZ)(b.Z.PlusSmall,{iconColor:e.colors.grayscale.light1}),(0,c.t)("Add filter")))))}}I.propTypes=w,I.defaultProps={name:"",onChange:()=>{},columns:[],savedMetrics:[],selectedMetrics:[]};const O=(0,d.b)(I)},72201:(e,t,o)=>{o.d(t,{Z:()=>r});var a=o(45697),n=o.n(a);const r=n().shape({column_name:n().string.isRequired,type:n().string})},19113:(e,t,o)=>{o.d(t,{v:()=>n,Z:()=>s});var a=o(69856);const n={SIMPLE:"SIMPLE",SQL:"SQL"};function r(e){if(e.sqlExpression&&a.Q_.test(e.sqlExpression)){const t=e.sqlExpression.indexOf(")"),o=e.sqlExpression.substring(0,t).lastIndexOf("(");if(t>0&&o>0)return e.sqlExpression.substring(o+1,t)}return null}function i(e){if(e.sqlExpression&&a.Q_.test(e.sqlExpression)){const t=e.sqlExpression.indexOf("(");if(t>0)return e.sqlExpression.substring(0,t)}return null}class s{constructor(e){if(this.expressionType=e.expressionType||n.SIMPLE,this.expressionType===n.SIMPLE){const t=r(e);this.column=e.column||t&&{column_name:t},this.aggregate=e.aggregate||i(e),this.sqlExpression=null}else this.expressionType===n.SQL&&(this.sqlExpression=e.sqlExpression,this.column=null,this.aggregate=null);this.isNew=!!e.isNew,this.hasCustomLabel=!(!e.hasCustomLabel||!e.label),this.label=this.hasCustomLabel?e.label:this.getDefaultLabel(),this.optionName=e.optionName||`metric_${Math.random().toString(36).substring(2,15)}_${Math.random().toString(36).substring(2,15)}`}getDefaultLabel(){const e=this.translateToSql(!0);return e.length<43?e:`${e.substring(0,40)}...`}translateToSql(e=!1){var t,o;return this.expressionType===n.SIMPLE?(this.aggregate||"")+(e&&null!=(t=this.column)&&t.verbose_name?`(${this.column.verbose_name})`:null!=(o=this.column)&&o.column_name?`(${this.column.column_name})`:""):this.expressionType===n.SQL?this.sqlExpression:""}duplicateWith(e){return new s({...this,isNew:!1,...e})}equals(e){return e.label===this.label&&e.expressionType===this.expressionType&&e.sqlExpression===this.sqlExpression&&e.aggregate===this.aggregate&&(e.column&&e.column.column_name)===(this.column&&this.column.column_name)}isValid(){return this.expressionType===n.SIMPLE?!(!this.column||!this.aggregate):this.expressionType===n.SQL&&!!this.sqlExpression}inferSqlExpressionAggregate(){return i(this)}inferSqlExpressionColumn(){return r(this)}}},40266:(e,t,o)=>{o.d(t,{Z:()=>d}),o(67294);var a=o(45697),n=o.n(a),r=o(34087),i=o(17536),s=o(99963),l=o(11965);const c={option:n().oneOfType([r.Z,n().shape({saved_metric_name:n().string.isRequired}),i.Z]).isRequired};function d({option:e}){return e.saved_metric_name?(0,l.tZ)(s.l,{column:{column_name:e.saved_metric_name,type:"expression"},showType:!0}):e.column_name?(0,l.tZ)(s.l,{column:e,showType:!0}):e.label?(0,l.tZ)(s.l,{column:{column_name:e.label,type:"expression"},showType:!0}):null}d.propTypes=c},17536:(e,t,o)=>{o.d(t,{Z:()=>l});var a=o(45697),n=o.n(a),r=o(69856),i=o(34087),s=o(19113);const l=n().oneOfType([n().shape({expressionType:n().oneOf([s.v.SIMPLE]).isRequired,column:i.Z.isRequired,aggregate:n().oneOf(Object.keys(r.YY)).isRequired,label:n().string.isRequired}),n().shape({expressionType:n().oneOf([s.v.SQL]).isRequired,sqlExpression:n().string.isRequired,label:n().string.isRequired})])},34087:(e,t,o)=>{o.d(t,{Z:()=>r});var a=o(45697),n=o.n(a);const r=n().shape({column_name:n().string.isRequired,type:n().string})},27130:(e,t,o)=>{o.d(t,{Z:()=>r});var a=o(45697),n=o.n(a);const r=n().shape({metric_name:n().string.isRequired,verbose_name:n().string,expression:n().string.isRequired})},82199:(e,t,o)=>{o.d(t,{Z:()=>h});var a=o(67294),n=o(45697),r=o.n(n),i=o(1111),s=o(61988),l=o(11965),c=o(24554),d=o(82342);const u={ariaLabel:r().string,autoFocus:r().bool,choices:r().array,clearable:r().bool,description:r().string,disabled:r().bool,freeForm:r().bool,isLoading:r().bool,multi:r().bool,isMulti:r().bool,name:r().string.isRequired,onChange:r().func,onFocus:r().func,value:r().oneOfType([r().string,r().number,r().array]),default:r().oneOfType([r().string,r().number,r().array]),showHeader:r().bool,optionRenderer:r().func,valueKey:r().string,options:r().array,placeholder:r().string,filterOption:r().func,tokenSeparators:r().arrayOf(r().string),label:r().string,renderTrigger:r().bool,validationErrors:r().array,rightNode:r().node,leftNode:r().node,onClick:r().func,hovered:r().bool,tooltipOnClick:r().func,warning:r().string,danger:r().string};class h extends a.PureComponent{constructor(e){super(e),this.state={options:this.getOptions(e)},this.onChange=this.onChange.bind(this),this.handleFilterOptions=this.handleFilterOptions.bind(this)}UNSAFE_componentWillReceiveProps(e){if(!(0,i.Z)(e.choices,this.props.choices)||!(0,i.Z)(e.options,this.props.options)){const t=this.getOptions(e);this.setState({options:t})}}onChange(e){const{valueKey:t}=this.props;let o=e;Array.isArray(e)&&(o=e.map((e=>void 0!==(null==e?void 0:e[t])?e[t]:e))),"object"==typeof e&&void 0!==(null==e?void 0:e[t])&&(o=e[t]),this.props.onChange(o,[])}getOptions(e){const{choices:t,optionRenderer:o,valueKey:a}=e;let n=[];return e.options?n=e.options.map((e=>({...e,value:e[a],label:e.label||e[a],customLabel:o?o(e):void 0}))):t&&(n=t.map((e=>{if(Array.isArray(e)){const[t,o]=e.length>1?e:[e[0],e[0]];return{value:t,label:o}}return Object.is(e)?{...e,value:e[a],label:e.label||e[a]}:{value:e,label:e}}))),n}handleFilterOptions(e,t){const{filterOption:o}=this.props;return o({data:t},e)}render(){const{ariaLabel:e,autoFocus:t,clearable:o,disabled:a,filterOption:n,freeForm:r,isLoading:i,isMulti:u,label:h,multi:p,name:m,placeholder:g,onFocus:f,optionRenderer:v,showHeader:b,value:_,tokenSeparators:y,description:C,renderTrigger:E,rightNode:T,leftNode:S,validationErrors:Z,onClick:x,hovered:A,tooltipOnClick:R,warning:w,danger:L}=this.props,I={name:m,label:h,description:C,renderTrigger:E,rightNode:T,leftNode:S,validationErrors:Z,onClick:x,hovered:A,tooltipOnClick:R,warning:w,danger:L},O={allowNewOptions:r,autoFocus:t,ariaLabel:e||("string"==typeof h?h:(0,s.t)("Select ...")),allowClear:o,disabled:a,filterOption:!n||"function"!=typeof n||this.handleFilterOptions,header:b&&(0,l.tZ)(d.Z,I),loading:i,mode:u||p?"multiple":"single",name:`select-${m}`,onChange:this.onChange,onFocus:f,optionRenderer:v,options:this.state.options,placeholder:g,sortComparator:this.props.sortComparator,value:(()=>{const e=_||(void 0!==this.props.default?this.props.default:void 0);if(null!==e||this.state.options.find((e=>null===e.value)))return e})(),tokenSeparators:y};return(0,l.tZ)("div",{css:e=>l.iv`
          .type-label {
            margin-right: ${2*e.gridUnit}px;
          }
          .Select__multi-value__label > span,
          .Select__option > span,
          .Select__single-value > span {
            display: flex;
            align-items: center;
          }
        `},(0,l.tZ)(c.ZP,O))}}h.propTypes=u,h.defaultProps={autoFocus:!1,choices:[],clearable:!0,description:null,disabled:!1,freeForm:!1,isLoading:!1,label:null,multi:!1,onChange:()=>{},onFocus:()=>{},showHeader:!0,valueKey:"value"}},665:(e,t,o)=>{o.d(t,{Z:()=>_});var a=o(67294),n=o(45697),r=o.n(n),i=o(4715),s=o(61988),l=o(37921),c=o(76697),d=o(83734),u=o(87253),h=o(82342),p=o(82199),m=o(11965);const g="latlong",f="delimited",v="geohash",b={onChange:r().func,value:r().object,animation:r().bool,choices:r().array};class _ extends a.Component{constructor(e){super(e);const t=e.value||{};let o;e.choices.length>0&&(o=e.choices[0][0]),this.state={type:t.type||g,delimiter:t.delimiter||",",latCol:t.latCol||o,lonCol:t.lonCol||o,lonlatCol:t.lonlatCol||o,reverseCheckbox:t.reverseCheckbox||!1,geohashCol:t.geohashCol||o,value:null,errors:[]},this.toggleCheckbox=this.toggleCheckbox.bind(this),this.onChange=this.onChange.bind(this),this.renderReverseCheckbox=this.renderReverseCheckbox.bind(this)}componentDidMount(){this.onChange()}onChange(){const{type:e}=this.state,t={type:e},o=[],a=(0,s.t)("Invalid lat/long configuration.");e===g?(t.latCol=this.state.latCol,t.lonCol=this.state.lonCol,t.lonCol&&t.latCol||o.push(a)):e===f?(t.lonlatCol=this.state.lonlatCol,t.delimiter=this.state.delimiter,t.reverseCheckbox=this.state.reverseCheckbox,t.lonlatCol&&t.delimiter||o.push(a)):e===v&&(t.geohashCol=this.state.geohashCol,t.reverseCheckbox=this.state.reverseCheckbox,t.geohashCol||o.push(a)),this.setState({value:t,errors:o}),this.props.onChange(t,o)}setType(e){this.setState({type:e},this.onChange)}toggleCheckbox(){this.setState((e=>({reverseCheckbox:!e.reverseCheckbox})),this.onChange)}renderLabelContent(){return this.state.errors.length>0?"N/A":this.state.type===g?`${this.state.lonCol} | ${this.state.latCol}`:this.state.type===f?`${this.state.lonlatCol}`:this.state.type===v?`${this.state.geohashCol}`:null}renderSelect(e,t){return(0,m.tZ)(p.Z,{ariaLabel:e,name:e,choices:this.props.choices,value:this.state[e],clearable:!1,onFocus:()=>{this.setType(t)},onChange:t=>{this.setState({[e]:t},this.onChange)}})}renderReverseCheckbox(){return(0,m.tZ)("span",null,(0,s.t)("Reverse lat/long "),(0,m.tZ)(u.ZP,{checked:this.state.reverseCheckbox,onChange:this.toggleCheckbox}))}renderPopoverContent(){return(0,m.tZ)("div",{style:{width:"300px"}},(0,m.tZ)(d.Z,{title:(0,s.t)("Longitude & Latitude columns"),isSelected:this.state.type===g,onSelect:this.setType.bind(this,g)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},"Longitude",this.renderSelect("lonCol",g)),(0,m.tZ)(i.JX,{xs:24,md:12},"Latitude",this.renderSelect("latCol",g)))),(0,m.tZ)(d.Z,{title:(0,s.t)("Delimited long & lat single column"),info:(0,s.t)("Multiple formats accepted, look the geopy.points Python library for more details"),isSelected:this.state.type===f,onSelect:this.setType.bind(this,f)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},(0,s.t)("Column"),this.renderSelect("lonlatCol",f)),(0,m.tZ)(i.JX,{xs:24,md:12},this.renderReverseCheckbox()))),(0,m.tZ)(d.Z,{title:(0,s.t)("Geohash"),isSelected:this.state.type===v,onSelect:this.setType.bind(this,v)},(0,m.tZ)(i.X2,{gutter:16},(0,m.tZ)(i.JX,{xs:24,md:12},"Column",this.renderSelect("geohashCol",v)),(0,m.tZ)(i.JX,{xs:24,md:12},this.renderReverseCheckbox()))))}render(){return(0,m.tZ)("div",null,(0,m.tZ)(h.Z,this.props),(0,m.tZ)(c.ZP,{content:this.renderPopoverContent(),placement:"topLeft",trigger:"click"},(0,m.tZ)(l.Z,{className:"pointer"},this.renderLabelContent())))}}_.propTypes=b,_.defaultProps={onChange:()=>{},animation:!0,choices:[]}},42878:(e,t,o)=>{o.d(t,{Z:()=>f});var a=o(5872),n=o.n(a),r=o(67294),i=o(45697),s=o.n(i),l=o(9875),c=o(61988),d=o(35932),u=o(94670),h=o(68073),p=o(82342),m=o(11965);const g={name:s().string,onChange:s().func,initialValue:s().string,height:s().number,minLines:s().number,maxLines:s().number,offerEditInModal:s().bool,language:s().oneOf([null,"json","html","sql","markdown","javascript"]),aboveEditorSection:s().node,readOnly:s().bool};class f extends r.Component{onControlChange(e){const{value:t}=e.target;this.props.onChange(t)}onAreaEditorChange(e){this.props.onChange(e)}renderEditor(e=!1){const t=e?40:this.props.minLines||12;if(this.props.language){const o={border:"1px solid #CCC"};return this.props.readOnly&&(o.backgroundColor="#f2f2f2"),(0,m.tZ)(u.YH,n()({mode:this.props.language,style:o,minLines:t,maxLines:e?1e3:this.props.maxLines,width:"100%",height:`${t}em`,editorProps:{$blockScrolling:!0},defaultValue:this.props.initialValue,readOnly:this.props.readOnly,key:this.props.name},this.props,{onChange:this.onAreaEditorChange.bind(this)}))}return(0,m.tZ)(l.Kx,{placeholder:(0,c.t)("textarea"),onChange:this.onControlChange.bind(this),defaultValue:this.props.initialValue,disabled:this.props.readOnly,style:{height:this.props.height}})}renderModalBody(){return(0,m.tZ)("div",null,(0,m.tZ)("div",null,this.props.aboveEditorSection),this.renderEditor(!0))}render(){const e=(0,m.tZ)(p.Z,this.props);return(0,m.tZ)("div",null,e,this.renderEditor(),this.props.offerEditInModal&&(0,m.tZ)(h.Z,{modalTitle:e,triggerNode:(0,m.tZ)(d.Z,{buttonSize:"small",className:"m-t-5"},(0,c.t)("Edit")," ",(0,m.tZ)("strong",null,this.props.language)," ",(0,c.t)("in modal")),modalBody:this.renderModalBody(!0),responsive:!0}))}}f.propTypes=g,f.defaultProps={onChange:()=>{},initialValue:"",height:250,minLines:3,maxLines:10,offerEditInModal:!0,readOnly:!1}},92252:(e,t,o)=>{o.d(t,{ai:()=>b}),o(67294);var a=o(81545),n=o(45511),r=o(61988),i=o(95826),s=o(75294),l=o(16737),c=o(69856),d=o(99963),u=o(11965);const h=(0,a.Z)(),p=(0,n.Z)(),m={verbose_name:"Time",column_name:"__timestamp",description:(0,r.t)("A reference to the [Time] configuration, taking granularity into account")},g={type:"SelectControl",multi:!0,freeForm:!0,label:(0,r.t)("Group by"),default:[],includeTime:!1,description:(0,r.t)("One or many columns to group by. High cardinality groupings should include a series limit to limit the number of fetched and rendered series."),optionRenderer:e=>(0,u.tZ)(d.l,{column:e,showType:!0}),valueKey:"column_name",filterOption:({data:e},t)=>e.column_name&&e.column_name.toLowerCase().indexOf(t.toLowerCase())>=0||e.verbose_name&&e.verbose_name.toLowerCase().indexOf(t.toLowerCase())>=0,mapStateToProps:(e,t)=>{const o={};return e.datasource&&(o.options=e.datasource.columns.filter((e=>e.groupby)),t&&t.includeTime&&o.options.push(m)),o}},f={type:"MetricsControl",multi:!0,label:(0,r.t)("Metrics"),validators:[i.Z],mapStateToProps:e=>{const{datasource:t}=e;return{columns:t?t.columns:[],savedMetrics:t?t.metrics:[],datasource:t}},description:(0,r.t)("One or many metrics to display")},v={...f,multi:!1,label:(0,r.t)("Metric"),description:(0,r.t)("Metric")},b={metrics:f,metric:v,datasource:{type:"DatasourceControl",label:(0,r.t)("Dataset"),default:null,description:null,mapStateToProps:({datasource:e})=>({datasource:e,isEditable:!!e})},viz_type:{type:"VizTypeControl",label:(0,r.t)("Visualization type"),default:"table",description:(0,r.t)("The type of visualization to display")},color_picker:{label:(0,r.t)("Fixed color"),description:(0,r.t)("Use this to define a static color for all circles"),type:"ColorPickerControl",default:{r:0,g:122,b:135,a:1},renderTrigger:!0},metric_2:{...v,label:(0,r.t)("Right axis metric"),clearable:!0,description:(0,r.t)("Choose a metric for right axis")},linear_color_scheme:{type:"ColorSchemeControl",label:(0,r.t)("Linear color scheme"),choices:()=>p.values().map((e=>[e.id,e.label])),default:p.getDefaultKey(),clearable:!1,description:"",renderTrigger:!0,schemes:()=>p.getMap(),isLinear:!0},secondary_metric:{...v,label:(0,r.t)("Color metric"),default:null,validators:[],description:(0,r.t)("A metric to use for color")},groupby:g,columns:{...g,label:(0,r.t)("Columns"),description:(0,r.t)("One or many controls to pivot as columns")},druid_time_origin:{type:"SelectControl",freeForm:!0,label:c.m_.druid_time_origin,choices:[["","default"],["now","now"]],default:null,description:(0,r.t)("Defines the origin where time buckets start, accepts natural dates as in `now`, `sunday` or `1970-01-01`")},granularity:{type:"SelectControl",freeForm:!0,label:c.m_.granularity,default:"P1D",choices:[[null,"all"],["PT5S","5 seconds"],["PT30S","30 seconds"],["PT1M","1 minute"],["PT5M","5 minutes"],["PT30M","30 minutes"],["PT1H","1 hour"],["PT6H","6 hour"],["P1D","1 day"],["P7D","7 days"],["P1W","week"],["week_starting_sunday","week starting Sunday"],["week_ending_saturday","week ending Saturday"],["P1M","month"],["P3M","quarter"],["P1Y","year"]],description:(0,r.t)("The time granularity for the visualization. Note that you can type and use simple natural language as in `10 seconds`, `1 day` or `56 weeks`")},granularity_sqla:{type:"SelectControl",label:c.m_.granularity_sqla,description:(0,r.t)("The time column for the visualization. Note that you can define arbitrary expression that return a DATETIME column in the table. Also note that the filter below is applied against this column or expression"),clearable:!1,optionRenderer:e=>(0,u.tZ)(d.l,{column:e,showType:!0}),valueKey:"column_name",mapStateToProps:e=>{const t={};return e.datasource&&(t.choices=e.datasource.granularity_sqla,t.default=null,e.datasource.main_dttm_col?t.default=e.datasource.main_dttm_col:t.choices&&t.choices.length>0&&(t.default=t.choices[0].column_name)),t}},time_grain_sqla:{type:"SelectControl",label:c.m_.time_grain_sqla,default:"P1D",description:(0,r.t)("The time granularity for the visualization. This applies a date transformation to alter your time column and defines a new time granularity. The options here are defined on a per database engine basis in the Superset source code."),mapStateToProps:e=>({choices:e.datasource?e.datasource.time_grain_sqla:null})},time_range:{type:"DateFilterControl",freeForm:!0,label:c.m_.time_range,default:(0,r.t)("No filter"),description:(0,r.t)('The time range for the visualization. All relative times, e.g. "Last month", "Last 7 days", "now", etc. are evaluated on the server using the server\'s local time (sans timezone). All tooltips and placeholder times are expressed in UTC (sans timezone). The timestamps are then evaluated by the database using the engine\'s local timezone. Note one can explicitly set the timezone per the ISO 8601 format if specifying either the start and/or end time.'),mapStateToProps:({form_data:e})=>({endpoints:null==e?void 0:e.time_range_endpoints})},row_limit:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Row limit"),validators:[s.Z],default:1e4,choices:(0,l.mG)([10,50,100,250,500,1e3,5e3,1e4,5e4]),description:(0,r.t)("Limits the number of rows that get displayed.")},limit:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Series limit"),validators:[s.Z],choices:(0,l.mG)([5,10,25,50,100,500]),clearable:!0,description:(0,r.t)("Limits the number of series that get displayed. A joined subquery (or an extra phase where subqueries are not supported) is applied to limit the number of series that get fetched and rendered. This feature is useful when grouping by high cardinality column(s) though does increase the query complexity and cost.")},timeseries_limit_metric:{type:"MetricsControl",label:(0,r.t)("Sort by"),default:null,clearable:!0,description:(0,r.t)("Metric used to define how the top series are sorted if a series or row limit is present. If undefined reverts to the first metric (where appropriate)."),mapStateToProps:e=>({columns:e.datasource?e.datasource.columns:[],savedMetrics:e.datasource?e.datasource.metrics:[],datasource:e.datasource})},series:{...g,label:(0,r.t)("Series"),multi:!1,default:null,description:(0,r.t)("Defines the grouping of entities. Each series is shown as a specific color on the chart and has a legend toggle")},entity:{...g,label:(0,r.t)("Entity"),default:null,multi:!1,validators:[i.Z],description:(0,r.t)("This defines the element to be plotted on the chart")},x:{...v,label:(0,r.t)("X Axis"),description:(0,r.t)("Metric assigned to the [X] axis"),default:null},y:{...v,label:(0,r.t)("Y Axis"),default:null,description:(0,r.t)("Metric assigned to the [Y] axis")},size:{...v,label:(0,r.t)("Bubble size"),default:null},y_axis_format:{type:"SelectControl",freeForm:!0,label:(0,r.t)("Y Axis Format"),renderTrigger:!0,default:"SMART_NUMBER",choices:[["SMART_NUMBER","Adaptive formatting"],["~g","Original value"],[",d",",d (12345.432 => 12,345)"],[".1s",".1s (12345.432 => 10k)"],[".3s",".3s (12345.432 => 12.3k)"],[",.1%",",.1% (12345.432 => 1,234,543.2%)"],[".3%",".3% (12345.432 => 1234543.200%)"],[".4r",".4r (12345.432 => 12350)"],[",.3f",",.3f (12345.432 => 12,345.432)"],["+,","+, (12345.432 => +12,345.432)"],["$,.2f","$,.2f (12345.432 => $12,345.43)"],["DURATION","Duration in ms (66000 => 1m 6s)"],["DURATION_SUB","Duration in ms (100.40008 => 100ms 400µs 80ns)"]],description:"D3 format syntax: https://github.com/d3/d3-format",mapStateToProps:e=>{const t=e.controls&&e.controls.comparison_type&&"percentage"===e.controls.comparison_type.value;return{warning:t?(0,r.t)('When `Calculation type` is set to "Percentage change", the Y Axis Format is forced to `.1%`'):null,disabled:t}}},adhoc_filters:{type:"AdhocFilterControl",label:(0,r.t)("Filters"),default:null,description:"",mapStateToProps:e=>({columns:e.datasource?e.datasource.columns.filter((e=>e.filterable)):[],savedMetrics:e.datasource?e.datasource.metrics:[],datasource:e.datasource})},color_scheme:{type:"ColorSchemeControl",label:(0,r.t)("Color scheme"),default:h.getDefaultKey(),renderTrigger:!0,choices:()=>h.keys().map((e=>[e,e])),description:(0,r.t)("The color scheme for rendering chart"),schemes:()=>h.getMap()}}},35854:(e,t,o)=>{o.d(t,{R3:()=>i,oN:()=>s});var a=o(37687),n=o(36967),r=o(92252);function i(e,t){const o={...t},r=o.viz_type||e.common.conf.DEFAULT_VIZ_TYPE||"table";!function(e){e.y_axis_zero&&(e.y_axis_bounds=[0,null])}(o);const i=(0,n.mi)(r,e.datasource.type,e,o),s=(0,a.Z)().get(r)||{};return s.onInit?s.onInit(i):i}function s(e){const t=e.datasource.split("__")[1],o=e.viz_type,a=(0,n.mi)(o,t,null,{...e}),r=(0,n.Hu)(a),i={};return Object.keys(a).concat(Object.keys(e)).forEach((t=>{void 0===e[t]?i[t]=r[t]:i[t]=e[t]})),i}const l={...r.ai};Object.keys(r.ai).forEach((e=>{l[e].value=r.ai[e].default})),(0,n.Hu)(l)},10945:(e,t,o)=>{function a(e){return Object.keys(e).reduce(((e,t)=>{const o=e;return o[t]=t,o}),{})}o.d(t,{J_:()=>n,DT:()=>r,qy:()=>i,dS:()=>s,S4:()=>l,m7:()=>c});const n={FORMULA:{value:"FORMULA",label:"Formula"},EVENT:{value:"EVENT",label:"Event",supportNativeSource:!0},INTERVAL:{value:"INTERVAL",label:"Interval",supportNativeSource:!0},TIME_SERIES:{value:"TIME_SERIES",label:"Time series"}},r=a(n),i=r.FORMULA,s={NATIVE:{value:"NATIVE",label:"Superset annotation"}},l=a(s);function c(e){return!!e}},51777:(e,t,o)=>{o.r(t),o.d(t,{TIME_RANGE:()=>S,default:()=>A});var a=o(23279),n=o.n(a),r=o(67294),i=o(45697),s=o.n(i),l=o(4065),c=o(79676),d=o(35932),u=o(55786),h=o(31069),p=o(61988),m=o(27600),g=o(49238),f=o(73375),v=o(61357),b=o(11865),_=o(92252),y=o(12515),C=o(75017),E=o(69856),T=o(11965);const S=E.i2.time_range,Z={chartId:s().number.isRequired,origSelectedValues:s().object,datasource:s().object.isRequired,instantFiltering:s().bool,filtersFields:s().arrayOf(s().shape({field:s().string,label:s().string})),filtersChoices:s().objectOf(s().arrayOf(s().shape({id:s().string,text:s().string,filter:s().string,metric:s().number}))),onChange:s().func,onFilterMenuOpen:s().func,onFilterMenuClose:s().func,showDateFilter:s().bool,showSqlaTimeGrain:s().bool,showSqlaTimeColumn:s().bool,showDruidTimeGrain:s().bool,showDruidTimeOrigin:s().bool};class x extends r.PureComponent{constructor(e){super(e),this.onCloseDateFilterControl=()=>this.onFilterMenuClose(S),this.state={selectedValues:e.origSelectedValues,hasChanged:!1},this.debouncerCache={},this.maxValueCache={},this.changeFilter=this.changeFilter.bind(this),this.onFilterMenuOpen=this.onFilterMenuOpen.bind(this),this.onOpenDateFilterControl=this.onOpenDateFilterControl.bind(this),this.onFilterMenuClose=this.onFilterMenuClose.bind(this)}onFilterMenuOpen(e){return this.props.onFilterMenuOpen(this.props.chartId,e)}onFilterMenuClose(e){return this.props.onFilterMenuClose(this.props.chartId,e)}onOpenDateFilterControl(){return this.onFilterMenuOpen(S)}getControlData(e){const{selectedValues:t}=this.state,o={..._.ai[e],name:e,key:`control-${e}`,value:t[E.i2[e]],actions:{setControlValue:this.changeFilter}},a=o.mapStateToProps;return a?{...o,...a(this.props)}:o}getKnownMax(e,t){return this.maxValueCache[e]=Math.max(this.maxValueCache[e]||0,(0,l.max)(t||this.props.filtersChoices[e]||[],(e=>e.metric))),this.maxValueCache[e]}clickApply(){const{selectedValues:e}=this.state;this.setState({hasChanged:!1},(()=>{this.props.onChange(e,!1)}))}changeFilter(e,t){const o=E.i2[e]||e;let a=null;if(null!==t)if(Array.isArray(t))a=t.map((e=>"string"==typeof e?e:e.value));else if(Object.values(E.i2).includes(o)){var n;a=null!=(n=t.value)?n:t}else{var r;a=(0,u.Z)(null!=(r=t.value)?r:t)}this.setState((e=>({selectedValues:{...e.selectedValues,[o]:a},hasChanged:!0})),(()=>{this.props.instantFiltering&&this.props.onChange({[o]:a},!1)}))}debounceLoadOptions(e){return e in this.debouncerCache||(this.debouncerCache[e]=n()(((t,o)=>{this.loadOptions(e,t).then(o)}),m.M$)),this.debouncerCache[e]}transformOptions(e,t){const o=void 0===t?(0,l.max)(e,(e=>e.metric)):t;return e.map((e=>{const t=Math.round(e.metric/o*100),a="lightgrey",n={backgroundImage:`linear-gradient(to right, ${a}, ${a} ${t}%, rgba(0,0,0,0) ${t}%`};let r=e.id;return!0===r?r=m.Ly:!1===r&&(r=m.gz),{value:e.id,label:r,style:n}}))}async loadOptions(e,t=""){var o;const a=t.toLowerCase(),n=this.props.filtersFields.find((t=>t.key===e)).asc,r={...this.props.rawFormData,adhoc_filters:t?[{clause:"WHERE",expressionType:"SIMPLE",subject:e,operator:"ILIKE",comparator:`%${a}%`}]:null},{json:i}=await h.Z.get({url:(0,y.H6)({formData:r,endpointType:"json",method:"GET"})}),s=((null==i||null==(o=i.data)?void 0:o[e])||[]).filter((e=>e.id));return s&&0!==s.length?(a&&s.sort(((e,t)=>{const o=e.id.toLowerCase(),r=t.id.toLowerCase().startsWith(a)-o.startsWith(a);return 0===r?(e.metric-t.metric)*(n?1:-1):r})),this.transformOptions(s,this.getKnownMax(e,s))):[]}renderDateFilter(){const{showDateFilter:e}=this.props,t=E.m_.time_range;return e?(0,T.tZ)("div",{className:"row space-1"},(0,T.tZ)("div",{className:"col-lg-12 col-xs-12"},(0,T.tZ)(f.Z,{name:S,label:t,description:(0,p.t)("Select start and end date"),onChange:e=>{this.changeFilter(S,e)},onOpenDateFilterControl:this.onOpenDateFilterControl,onCloseDateFilterControl:this.onCloseDateFilterControl,value:this.state.selectedValues[S]||"No filter",endpoints:["inclusive","exclusive"]}))):null}renderDatasourceFilters(){const{showSqlaTimeGrain:e,showSqlaTimeColumn:t,showDruidTimeGrain:o,showDruidTimeOrigin:a}=this.props,n=[],r=[],i=[];return e&&r.push("time_grain_sqla"),t&&r.push("granularity_sqla"),o&&i.push("granularity"),a&&i.push("druid_time_origin"),r.length&&n.push((0,T.tZ)(v.Z,{key:"sqla-filters",controls:r.map((e=>(0,T.tZ)(b.Z,this.getControlData(e))))})),i.length&&n.push((0,T.tZ)(v.Z,{key:"druid-filters",controls:i.map((e=>(0,T.tZ)(b.Z,this.getControlData(e))))})),n}renderSelect(e){const{filtersChoices:t}=this.props,{selectedValues:o}=this.state;this.debouncerCache={},this.maxValueCache={},Object.keys(o).filter((e=>e in t)).forEach((e=>{if(!o[e])return;const a=t[e]||(t[e]=[]),n=new Set(a.map((e=>e.id)));(Array.isArray(o[e])?o[e]:[o[e]]).filter((e=>null!==e&&!n.has(e))).forEach((t=>{a.unshift({filter:e,id:t,text:t,metric:0})}))}));const{key:a,label:n,[E.ft.MULTIPLE]:r,[E.ft.DEFAULT_VALUE]:i,[E.ft.CLEARABLE]:s,[E.ft.SEARCH_ALL_OPTIONS]:l}=e,d=t[a]||[];let u=o[a]||null;return void 0===u&&i&&(u=r?i.split(";"):i),(0,T.tZ)(C.Z,{cacheOptions:!0,loadOptions:this.debounceLoadOptions(a),defaultOptions:this.transformOptions(d),key:a,placeholder:(0,p.t)("Type or Select [%s]",n),isMulti:r,isClearable:s,value:u,options:this.transformOptions(d),onChange:e=>{e!==u&&this.changeFilter(a,e)},onMenuOpen:()=>this.onFilterMenuOpen(a),onBlur:()=>this.onFilterMenuClose(a),onMenuClose:()=>this.onFilterMenuClose(a),selectWrap:l&&d.length>=E.cM?c.JY:c.a7,noResultsText:(0,p.t)("No results found"),forceOverflow:!0})}renderFilters(){const{filtersFields:e=[]}=this.props;return e.map((e=>{const{label:t,key:o}=e;return(0,T.tZ)("div",{key:o,className:"m-b-5 filter-container"},(0,T.tZ)(g.lX,{htmlFor:`LABEL-${o}`},t),this.renderSelect(e))}))}render(){const{instantFiltering:e,width:t,height:o}=this.props;return(0,T.tZ)("div",{style:{width:t,height:o,overflow:"auto"}},this.renderDateFilter(),this.renderDatasourceFilters(),this.renderFilters(),!e&&(0,T.tZ)(d.Z,{buttonSize:"small",buttonStyle:"primary",onClick:this.clickApply.bind(this),disabled:!this.state.hasChanged},(0,p.t)("Apply")))}}x.propTypes=Z,x.defaultProps={origSelectedValues:{},onChange:()=>{},onFilterMenuOpen:()=>{},onFilterMenuClose:()=>{},showDateFilter:!1,showSqlaTimeGrain:!1,showSqlaTimeColumn:!1,showDruidTimeGrain:!1,showDruidTimeOrigin:!1,instantFiltering:!1};const A=x},811:(e,t,o)=>{var a,n;function r(e){return e.type===a.NATIVE_FILTER}function i(e){return e.type===a.DIVIDER}o.d(t,{BE:()=>a,gT:()=>n,kI:()=>r,nY:()=>i}),function(e){e.NATIVE_FILTER="NATIVE_FILTER",e.DIVIDER="DIVIDER"}(a||(a={})),function(e){e.NativeFilters="nativeFilters",e.CrossFilters="crossFilters"}(n||(n={}))},37863:(e,t,o)=>{o.d(t,{u:()=>c,Z:()=>d});var a=o(61988),n=o(63389),r=o(50810),i=o(36967),s=o(1836),l=o(52256);const c={id:0,chartAlert:null,chartStatus:"loading",chartStackTrace:null,chartUpdateEndTime:null,chartUpdateStartTime:0,latestQueryFormData:{},sliceFormData:null,queryController:null,queriesResponse:null,triggerQuery:!0,lastRendered:0};function d(e={},t){const o={[l.ADD_CHART]:()=>({...c,...t.chart}),[l.CHART_UPDATE_SUCCEEDED]:e=>({...e,chartStatus:"success",chartAlert:null,queriesResponse:t.queriesResponse,chartUpdateEndTime:(0,s.zO)()}),[l.CHART_UPDATE_STARTED]:e=>({...e,chartStatus:"loading",chartStackTrace:null,chartAlert:null,chartUpdateEndTime:null,chartUpdateStartTime:(0,s.zO)(),queryController:t.queryController}),[l.CHART_UPDATE_STOPPED]:e=>({...e,chartStatus:"stopped",chartAlert:(0,a.t)("Updating chart was stopped"),chartUpdateEndTime:(0,s.zO)()}),[l.CHART_RENDERING_SUCCEEDED]:e=>({...e,chartStatus:"rendered",chartUpdateEndTime:(0,s.zO)()}),[l.CHART_RENDERING_FAILED]:e=>({...e,chartStatus:"failed",chartStackTrace:t.stackTrace,chartAlert:(0,a.t)("An error occurred while rendering the visualization: %s",t.error)}),[l.CHART_UPDATE_FAILED](e){var o,n,r,i;return{...e,chartStatus:"failed",chartAlert:t.queriesResponse?null==(o=t.queriesResponse)||null==(n=o[0])?void 0:n.error:(0,a.t)("Network error."),chartUpdateEndTime:(0,s.zO)(),queriesResponse:t.queriesResponse,chartStackTrace:t.queriesResponse?null==(r=t.queriesResponse)||null==(i=r[0])?void 0:i.stacktrace:null}},[l.DYNAMIC_PLUGIN_CONTROLS_READY]:e=>({...e,sliceFormData:(0,i.Hu)(t.controlsState)}),[l.TRIGGER_QUERY]:e=>({...e,triggerQuery:t.value,chartStatus:"loading"}),[l.RENDER_TRIGGERED]:e=>({...e,lastRendered:t.value}),[l.UPDATE_QUERY_FORM_DATA]:e=>({...e,latestQueryFormData:t.value}),[l.ANNOTATION_QUERY_STARTED](e){e.annotationQuery&&e.annotationQuery[t.annotation.name]&&e.annotationQuery[t.annotation.name].abort();const o={...e.annotationQuery,[t.annotation.name]:t.queryController};return{...e,annotationQuery:o}},[l.ANNOTATION_QUERY_SUCCESS](e){const o={...e.annotationData,[t.annotation.name]:t.queryResponse.data},a={...e.annotationError};delete a[t.annotation.name];const n={...e.annotationQuery};return delete n[t.annotation.name],{...e,annotationData:o,annotationError:a,annotationQuery:n}},[l.ANNOTATION_QUERY_FAILED](e){const o={...e.annotationData};delete o[t.annotation.name];const n={...e.annotationError,[t.annotation.name]:t.queryResponse?t.queryResponse.error:(0,a.t)("Network error.")},r={...e.annotationQuery};return delete r[t.annotation.name],{...e,annotationData:o,annotationError:n,annotationQuery:r}}};if(t.type===l.REMOVE_CHART)return delete e[t.key],e;if(t.type===l.UPDATE_CHART_ID){const{newId:o,key:a}=t;return e[o]={...e[a],id:o},delete e[a],e}return t.type===n.$?{...t.data.charts}:t.type===r.Rn.SET_DATASOURCES?Object.fromEntries(Object.entries(e).map((([e,t])=>[e,"failed"===t.chartStatus&&t.chartStackTrace?{...t,chartStatus:"",chartStackTrace:null,chartAlert:null}:t]))):t.type in o?{...e,[t.key]:o[t.type](e[t.key])}:e}},13842:(e,t,o)=>{o.d(t,{lU:()=>r,dc:()=>i,zq:()=>s}),o(67294);var a=o(51995),n=o(11965);const r=()=>{const e=(0,a.Fg)();return(0,n.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,n.tZ)("path",{d:"M16 0H2C0.89 0 0 0.9 0 2V16C0 17.1 0.89 18 2 18H16C17.11 18 18 17.1 18 16V2C18 0.9 17.11 0 16 0Z",fill:e.colors.primary.base}),(0,n.tZ)("path",{d:"M7 14L2 9L3.41 7.59L7 11.17L14.59 3.58L16 5L7 14Z",fill:"white"}))},i=()=>{const e=(0,a.Fg)();return(0,n.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,n.tZ)("path",{d:"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z",fill:e.colors.grayscale.light1}),(0,n.tZ)("path",{d:"M14 10H4V8H14V10Z",fill:"white"}))},s=()=>{const e=(0,a.Fg)();return(0,n.tZ)("svg",{width:"18",height:"18",viewBox:"0 0 18 18",fill:"none",xmlns:"http://www.w3.org/2000/svg"},(0,n.tZ)("path",{d:"M16 0H2C0.9 0 0 0.9 0 2V16C0 17.1 0.9 18 2 18H16C17.1 18 18 17.1 18 16V2C18 0.9 17.1 0 16 0Z",fill:e.colors.grayscale.light2}),(0,n.tZ)("path",{d:"M16 2V16H2V2H16V2Z",fill:"white"}))}},87253:(e,t,o)=>{o.d(t,{lU:()=>s.lU,zq:()=>s.zq,ZP:()=>i}),o(67294);var a=o(51995),n=o(11965);const r=a.iK.span`
  &,
  & svg {
    vertical-align: top;
  }
`;function i({checked:e,onChange:t,style:o}){return(0,n.tZ)(r,{style:o,onClick:()=>{t(!e)},role:"checkbox",tabIndex:0,"aria-checked":e,"aria-label":"Checkbox"},e?(0,n.tZ)(s.lU,null):(0,n.tZ)(s.zq,null))}var s=o(13842)},77775:(e,t,o)=>{o.d(t,{Q:()=>x,W:()=>M});var a=o(67294),n=o(29487),r=o(61988),i=o(51995),s=o(31069),l=o(76962),c=o(74069),d=o(35932),u=o(34858),h=o(12515),p=o(27600),m=o(98286),g=o(38703),f=o(9875),v=o(52389),b=o(14114),_=o(34581),y=o(11965);const C=(0,r.t)("Warning! Changing the dataset may break the chart if the metadata does not exist."),E=(0,r.t)("Changing the dataset may break the chart if the chart relies on columns or metadata that does not exist in the target dataset"),T=(0,i.iK)(c.Z)`
  .ant-modal-body {
    display: flex;
    flex-direction: column;
  }
`,S=i.iK.div`
  .btn-container {
    display: flex;
    justify-content: flex-end;
    padding: 0px 15px;
    margin: 10px 0 0 0;
  }

  .confirm-modal-container {
    margin: 9px;
  }
`,Z=i.iK.span`
  cursor: pointer;
  color: ${({theme:e})=>e.colors.primary.dark1};
  &: hover {
    color: ${({theme:e})=>e.colors.primary.dark2};
  }
`,x=(0,b.ZP)((({addDangerToast:e,addSuccessToast:t,onChange:o,onDatasourceSave:i,onHide:c,show:b})=>{const[x,A]=(0,a.useState)(void 0),[R,w]=(0,a.useState)(0),[L,I]=(0,a.useState)(v.dY),[O,M]=(0,a.useState)(!1),[D,N]=(0,a.useState)(),k=(0,a.useRef)(null),{state:{loading:F,resourceCollection:P,resourceCount:U},fetchData:$}=(0,u.Yi)("dataset",(0,r.t)("dataset"),e),q=(0,a.useCallback)((e=>{M(!0),N(e)}),[]),V={pageIndex:R,pageSize:v.IV,filters:[],sortBy:L};(0,h.bX)((()=>{$({...V,...x&&{filters:[{id:"table_name",operator:"ct",value:x}]}})}),p.M$,[x,R,L]),(0,a.useEffect)((()=>{b&&(async()=>{setTimeout((()=>{var e;return null==k||null==(e=k.current)?void 0:e.focus()}),200)})()}),[e,$,o,i,c,q,b]);const j=[{Cell:({row:{original:e}})=>(0,y.tZ)(Z,{role:"button",tabIndex:0,onClick:()=>q({type:"table",...e})},null==e?void 0:e.table_name),Header:(0,r.t)("Name"),accessor:"table_name"},{Header:(0,r.t)("Type"),accessor:"kind",disableSortBy:!0},{Header:(0,r.t)("Schema"),accessor:"schema"},{Header:(0,r.t)("Connection"),accessor:"database.database_name",disableSortBy:!0},{Cell:({row:{original:{owners:e=[]}}})=>(0,y.tZ)(_.Z,{users:e}),Header:(0,r.t)("Owners"),id:"owners",disableSortBy:!0}];return(0,y.tZ)(T,{show:b,onHide:c,responsive:!0,title:(0,r.t)("Change dataset"),width:O?"432px":"",height:O?"auto":"540px",hideFooter:!O,footer:(0,y.tZ)(a.Fragment,null,O&&(0,y.tZ)(S,null,(0,y.tZ)("div",{className:"btn-container"},(0,y.tZ)(d.Z,{onClick:()=>{M(!1)}},"Cancel"),(0,y.tZ)(d.Z,{className:"proceed-btn",buttonStyle:"primary",onClick:()=>{s.Z.get({endpoint:`/datasource/get/${null==D?void 0:D.type}/${null==D?void 0:D.id}/`}).then((({json:e})=>{i(e),o(`${null==D?void 0:D.id}__table`)})).catch((t=>{(0,m.O)(t).then((({error:t,message:o})=>{const a=t?t.error||t.statusText||t:o;e(a)}))})),c(),t("Successfully changed dataset!")}},"Proceed"))))},(0,y.tZ)(a.Fragment,null,!O&&(0,y.tZ)(a.Fragment,null,(0,y.tZ)(n.Z,{roomBelow:!0,type:"warning",css:e=>({marginBottom:4*e.gridUnit}),message:(0,y.tZ)(a.Fragment,null,(0,y.tZ)("strong",null,(0,r.t)("Warning!"))," ",E)}),(0,y.tZ)(f.II,{ref:k,type:"text",value:x,placeholder:(0,r.t)("Search / Filter"),onChange:e=>{var t;const o=null!=(t=e.target.value)?t:"";A(o),w(0)}}),F&&(0,y.tZ)(g.Z,null),!F&&(0,y.tZ)(l.Z,{columns:j,data:P,pageSize:v.IV,initialPageIndex:R,initialSortBy:L,totalCount:U,onServerPagination:e=>{w(e.pageIndex),e.sortBy&&I(e.sortBy.length>0?e.sortBy:v.dY)},className:"table-condensed",emptyWrapperType:l.u.Small,serverPagination:!0,isPaginationSticky:!0,scrollTable:!0})),O&&(0,y.tZ)(a.Fragment,null,C)))}));var A=o(67913),R=o(91877),w=o(93185);const L=(0,A.Z)((()=>Promise.all([o.e(1216),o.e(4593),o.e(1862)]).then(o.bind(o,1862)))),I=(0,i.iK)(c.Z)`
  .modal-content {
    height: 900px;
    display: flex;
    flex-direction: column;
    align-items: stretch;
  }

  .modal-header {
    flex: 0 1 auto;
  }
  .modal-body {
    flex: 1 1 auto;
    overflow: auto;
  }

  .modal-footer {
    flex: 0 1 auto;
  }

  .ant-modal-body {
    overflow: visible;
  }
`;function O(e){const t=null!=e&&e.certified_by||null!=e&&e.certification_details?{certified_by:null==e?void 0:e.certified_by,details:null==e?void 0:e.certification_details}:void 0;return JSON.stringify({certification:t,warning_markdown:null==e?void 0:e.warning_markdown})}const M=(0,b.ZP)((({addSuccessToast:e,datasource:t,onDatasourceSave:o,onHide:i,show:l})=>{const[u,h]=(0,a.useState)(t),[p,g]=(0,a.useState)([]),[f,v]=(0,a.useState)(!1),b=(0,a.useRef)(null),[_,C]=c.Z.useModal(),E=()=>{var t,a,n,l;const c=(null==(t=u.tableSelector)?void 0:t.schema)||(null==(a=u.databaseSelector)?void 0:a.schema)||u.schema;v(!0),s.Z.post({endpoint:"/datasource/save/",postPayload:{data:{...u,schema:c,metrics:null==u||null==(n=u.metrics)?void 0:n.map((e=>({...e,extra:O(e)}))),columns:null==u||null==(l=u.columns)?void 0:l.map((e=>({...e,extra:O(e)}))),type:u.type||u.datasource_type,owners:u.owners.map((e=>e.value||e.id))}}}).then((({json:t})=>{e((0,r.t)("The dataset has been saved")),o({...t,owners:u.owners}),i()})).catch((e=>{v(!1),(0,m.O)(e).then((({error:e})=>{_.error({title:"Error",content:e||(0,r.t)("An error has occurred"),okButtonProps:{danger:!0,className:"btn-danger"}})}))}))},T=(0,R.cr)(w.T.ENABLE_REACT_CRUD_VIEWS)&&!(0,R.cr)(w.T.DISABLE_LEGACY_DATASOURCE_EDITOR);return(0,y.tZ)(I,{show:l,onHide:i,title:(0,y.tZ)("span",null,(0,r.t)("Edit Dataset "),(0,y.tZ)("strong",null,u.table_name)),footer:(0,y.tZ)(a.Fragment,null,T&&(0,y.tZ)(d.Z,{buttonSize:"small",buttonStyle:"default",className:"m-r-5",onClick:()=>{window.location.href=u.edit_url||u.url}},(0,r.t)("Use legacy datasource editor")),(0,y.tZ)(d.Z,{buttonSize:"small",className:"m-r-5",onClick:i},(0,r.t)("Cancel")),(0,y.tZ)(d.Z,{buttonSize:"small",buttonStyle:"primary",onClick:()=>{b.current=_.confirm({title:(0,r.t)("Confirm save"),content:(0,y.tZ)("div",null,(0,y.tZ)(n.Z,{css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),type:"warning",showIcon:!0,message:(0,r.t)("The dataset configuration exposed here\n                affects all the charts using this dataset.\n                Be mindful that changing settings\n                here may affect other charts\n                in undesirable ways.")}),(0,r.t)("Are you sure you want to save and apply changes?")),onOk:E,icon:null})},disabled:f||p.length>0||u.is_managed_externally,tooltip:u.is_managed_externally?(0,r.t)("This dataset is managed externally, and can't be edited in Superset"):""},(0,r.t)("Save"))),responsive:!0},(0,y.tZ)(L,{showLoadingForImport:!0,height:500,datasource:u,onChange:(e,t)=>{h({...e,metrics:null==e?void 0:e.metrics.map((e=>({...e,is_certified:(null==e?void 0:e.certified_by)||(null==e?void 0:e.certification_details)})))}),g(t)}}),C)}))},34581:(e,t,o)=>{o.d(t,{Z:()=>m}),o(67294);var a=o(81545),n=o(51995),r=o(58593),i=o(4715);var s,l,c=o(11965);const d=null!=(s=null==(l=(0,a.Z)().get())?void 0:l.colors)?s:[],u=e=>`\n  width: ${6*e.gridUnit}px;\n  height: ${6*e.gridUnit}px;\n  line-height: ${6*e.gridUnit}px;\n  font-size: ${e.typography.sizes.m}px;\n`,h=(0,n.iK)(i.qE)`
  ${({theme:e})=>u(e)}
`,p=(0,n.iK)(i.qE.Group)`
  .ant-avatar {
    ${({theme:e})=>u(e)}
  }
`;function m({users:e,maxCount:t=4}){return(0,c.tZ)(p,{maxCount:t},e.map((({first_name:e,last_name:t,id:o})=>{var a,n;const i=`${e} ${t}`,s=function(e,t){return e?t[function(e,t){const o=[...e].map((e=>e.charCodeAt(0))),a=o.length,n=a%(t-1)+1,r=o.reduce(((e,t)=>e+t))%t;let i=o[0]%t;return[...new Array(a)].forEach((()=>{i=(n*i+r)%t})),i}(e,t.length)]:"transparent"}(`${o}-${e}-${t}`,d);return(0,c.tZ)(r.u,{key:i,title:i,placement:"top"},(0,c.tZ)(h,{key:i,style:{backgroundColor:s,borderColor:s}},e&&(null==(a=e[0])?void 0:a.toLocaleUpperCase()),t&&(null==(n=t[0])?void 0:n.toLocaleUpperCase())))})))}},83734:(e,t,o)=>{o.d(t,{Z:()=>s});var a=o(11965),n=(o(67294),o(51995)),r=o(58593),i=o(70163);function s({title:e,isSelected:t,children:o,onSelect:s,info:l}){const c=(0,n.Fg)();return(0,a.tZ)("div",{css:(0,a.iv)({paddingBottom:2*c.gridUnit,opacity:t?1:c.opacity.mediumHeavy},"","")},(0,a.tZ)("div",{role:"button",tabIndex:0,onClick:s,css:(0,a.iv)({display:"flex",alignItems:"center",cursor:s?"pointer":"default"},"","")},(0,a.tZ)("strong",null,e),l&&(0,a.tZ)(r.u,{title:l,css:(0,a.iv)({marginLeft:c.gridUnit},"","")},(0,a.tZ)(i.Z.InfoSolidSmall,{role:"img",width:14,height:14,iconColor:c.colors.grayscale.light1})),(0,a.tZ)(i.Z.Check,{role:"img",iconColor:t?c.colors.primary.base:c.colors.grayscale.base})),(0,a.tZ)("div",{css:(0,a.iv)({marginLeft:c.gridUnit,marginTop:c.gridUnit},"","")},o))}},41295:(e,t,o)=>{o.d(t,{$A:()=>s,fO:()=>l,a8:()=>c,t$:()=>d,Aw:()=>u});var a=o(47037),n=o.n(a),r=o(28062),i=o(22102);const s="DASHBOARD_INFO_UPDATED";function l(e,t){const o=r.getNamespace(null==e?void 0:e.color_namespace),a=n()(t)?JSON.parse(t):t;Object.keys(a).forEach((e=>{o.setColor(e,a[e])}))}function c(e){const{metadata:t}=e;return r.getNamespace(null==t?void 0:t.color_namespace).resetColors(),null!=t&&t.shared_label_colors&&l(t,null==t?void 0:t.shared_label_colors),null!=t&&t.label_colors&&l(t,null==t?void 0:t.label_colors),{type:s,newInfo:e}}const d="SET_CHART_CONFIG_COMPLETE",u=e=>async(t,o)=>{t({type:"SET_CHART_CONFIG_BEGIN",chartConfiguration:e});const{id:a,metadata:n}=o().dashboardInfo,r=(0,i.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${a}`});try{const o=await r({json_metadata:JSON.stringify({...n,chart_configuration:e})});t(c({metadata:JSON.parse(o.result.json_metadata)})),t({type:d,chartConfiguration:e})}catch(o){t({type:"SET_CHART_CONFIG_FAIL",chartConfiguration:e})}}},50810:(e,t,o)=>{o.d(t,{Rn:()=>a,Fy:()=>r,QR:()=>s});var a,n=o(31069);function r(e){return{type:a.SET_DATASOURCES,datasources:e}}function i(e,t){return{type:a.SET_DATASOURCE,key:t,datasource:e}}function s(e){return(t,o)=>{const{datasources:a}=o(),r=a[e];return r?t(i(r,e)):n.Z.get({endpoint:`/superset/fetch_datasource_metadata?datasourceKey=${e}`}).then((({json:o})=>t(i(o,e))))}}!function(e){e.SET_DATASOURCES="SET_DATASOURCES",e.SET_DATASOURCE="SET_DATASOURCE"}(a||(a={}))},52794:(e,t,o)=>{o.d(t,{qe:()=>i,kN:()=>s,Zp:()=>l,RY:()=>c,xk:()=>d,pi:()=>u,xQ:()=>h,ql:()=>p,$l:()=>m,X8:()=>g,T6:()=>f,$7:()=>v,Up:()=>b});var a=o(22102),n=o(74599),r=o(41295);const i="SET_FILTER_CONFIG_COMPLETE",s="SET_IN_SCOPE_STATUS_OF_FILTERS",l="SET_FILTER_SETS_COMPLETE",c=e=>async(t,o)=>{var s;t({type:"SET_FILTER_CONFIG_BEGIN",filterConfig:e});const{id:l,metadata:c}=o().dashboardInfo,d=null==(s=o().nativeFilters)?void 0:s.filters,u=(0,a.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${l}`}),h=e.map((e=>{const t=d[e.id];return t?{...t,...e}:e}));try{const e=await u({json_metadata:JSON.stringify({...c,native_filter_configuration:h})});t((0,r.a8)({metadata:JSON.parse(e.result.json_metadata)})),t({type:i,filterConfig:h}),t((0,n.Ft)(h,d))}catch(e){t({type:"SET_FILTER_CONFIG_FAIL",filterConfig:h}),t({type:n.u3,filterConfig:h})}},d=e=>async(t,o)=>{var a;const n=null==(a=o().nativeFilters)?void 0:a.filters,i=e.map((e=>({...n[e.filterId],chartsInScope:e.chartsInScope,tabsInScope:e.tabsInScope})));t({type:s,filterConfig:i});const{metadata:l}=o().dashboardInfo,c=l.native_filter_configuration.map((e=>{const t=i.find((t=>t.id===e.id));return t?{...t,...e}:e}));l.native_filter_configuration=c,t((0,r.a8)({metadata:l}))},u=e=>async t=>{const o=(0,a.Z)({method:"GET",endpoint:`/api/v1/dashboard/${e}/filtersets`});t({type:"SET_FILTER_SETS_BEGIN"});const n=await o(null);t({type:l,filterSets:n.ids.map(((e,t)=>({...n.result[t].params,id:e,name:n.result[t].name})))})},h=e=>async(t,o)=>{const n=o().dashboardInfo.id,r=(0,a.Z)({method:"POST",endpoint:`/api/v1/dashboard/${n}/filtersets`});t({type:"CREATE_FILTER_SET_BEGIN"});const i={...e};delete i.name,await r({name:e.name,owner_type:"Dashboard",owner_id:n,json_metadata:JSON.stringify(i)}),t({type:"CREATE_FILTER_SET_COMPLETE"}),t(u(n))},p=e=>async(t,o)=>{const n=o().dashboardInfo.id,r=(0,a.Z)({method:"PUT",endpoint:`/api/v1/dashboard/${n}/filtersets/${e.id}`});t({type:"UPDATE_FILTER_SET_BEGIN"});const i={...e};delete i.id,delete i.name,await r({name:e.name,json_metadata:JSON.stringify(i)}),t({type:"UPDATE_FILTER_SET_COMPLETE"}),t(u(n))},m=e=>async(t,o)=>{const n=o().dashboardInfo.id,r=(0,a.Z)({method:"DELETE",endpoint:`/api/v1/dashboard/${n}/filtersets/${e}`});t({type:"DELETE_FILTER_SET_BEGIN"}),await r({}),t({type:"DELETE_FILTER_SET_COMPLETE"}),t(u(n))},g="SET_FOCUSED_NATIVE_FILTER",f="UNSET_FOCUSED_NATIVE_FILTER";function v(e){return{type:g,id:e}}function b(){return{type:f}}},92242:(e,t,o)=>{o.d(t,{uh:()=>c,G$:()=>d,GA:()=>u,EJ:()=>h,rW:()=>p,Ky:()=>m,W6:()=>g,QN:()=>f});var a=o(14670),n=o.n(a),r=o(8868),i=o(68492),s=o(811),l=o(80621);const c=(e,t,o=[])=>{if(o.includes(t))return!0;const a=e.get(t);return!!a&&a.some((a=>c(e,a,[...o,t])))},d=async(e,t,o)=>{try{let t;try{t=await e.validateFields()}catch(e){var a;if(null!=e&&null!=(a=e.errorFields)&&a.length||null==e||!e.outOfDate)throw e;t=e.values}return t}catch(e){if(i.Z.warn("Filter configuration failed:",e),!e.errorFields||!e.errorFields.length)return null;const a=e.errorFields;if(!a.some((e=>e.name[1]===t))){const e=a.find((e=>"filters"===e.name[0]));e&&o(e.name[1])}return null}},u=(e,t,o,a,n)=>async()=>{const i=t.filter((e=>!o[e])).map((t=>{var o,a,i,c;const d=null==(o=n.filters)?void 0:o[t];if(!d)return e[t];if(d.type===s.BE.DIVIDER)return{id:t,type:s.BE.DIVIDER,scope:{rootPath:[l._4],excluded:[]},title:d.title,description:d.description};const u={};return d.dataset&&(u.datasetId=d.dataset.value),d.dataset&&d.column&&(u.column={name:d.column}),{id:t,adhoc_filters:d.adhoc_filters,time_range:d.time_range,controlValues:null!=(a=d.controlValues)?a:{},granularity_sqla:d.granularity_sqla,requiredFirst:Object.values(null!=(i=d.requiredFirst)?i:{}).find((e=>e)),name:d.name,filterType:d.filterType,targets:[u],defaultDataMask:null!=(c=d.defaultDataMask)?c:(0,r.H)(),cascadeParentIds:d.dependencies||[],scope:d.scope,sortMetric:d.sortMetric,type:d.type,description:(d.description||"").trim()}}));await a(i)},h=(e,t,o)=>a=>{const n=window.setTimeout((()=>{(o=>{e((e=>({...e,[o]:{isPending:!1}}))),t((e=>e.filter((e=>e!==o))))})(a)}),5e3);e((e=>({...e,[a]:{isPending:!0,timerId:n}}))),o(!1)},p="NATIVE_FILTER-",m="NATIVE_FILTER_DIVIDER-",g=e=>`${e===s.BE.NATIVE_FILTER?p:m}${n().generate()}`,f=e=>e.map((e=>e.id))},39759:(e,t,o)=>{o.d(t,{a:()=>r,Z:()=>i});var a=o(52794),n=o(63389);function r({filterSetsConfig:e,filterConfig:t,state:o}){const a={},n={};var r;if(t?(t.forEach((e=>{const{id:t}=e;n[t]=e})),a.filters=n):a.filters=null!=(r=null==o?void 0:o.filters)?r:{},e){const t={};e.forEach((e=>{const{id:o}=e;t[o]=e})),a.filterSets=t}else{var i;a.filterSets=null!=(i=null==o?void 0:o.filterSets)?i:{}}return a.focusedFilterId=void 0,a}function i(e={filters:{},filterSets:{}},t){switch(t.type){case n.$:return{filters:t.data.nativeFilters.filters,filterSets:t.data.nativeFilters.filterSets};case a.qe:case a.kN:return r({filterConfig:t.filterConfig,state:e});case a.Zp:return r({filterSetsConfig:t.filterSets,state:e});case a.X8:return{...e,focusedFilterId:t.id};case a.T6:return{...e,focusedFilterId:void 0};default:return e}}},70695:(e,t,o)=>{o.d(t,{ZP:()=>i,i5:()=>s,Ms:()=>l});var a=o(30845),n=o(5558);const r=(0,a.Z)(((e,t,o)=>!!o&&Object.values(o).some((o=>o.some((([o,a])=>o===e&&a===t)))))),i=r,s=e=>(0,n.A)(e)&&Object.keys(e.roles||{}).some((e=>"admin"===e.toLowerCase())),l=(e,t)=>(0,n.A)(t)&&(s(t)||((e,t)=>(0,n.A)(t)&&e.owners.some((e=>e.username===t.username)))(e,t))&&r("can_write","Dashboard",t.roles)},20194:(e,t,o)=>{function a({chartId:e,column:t}){return`${e}_${t}`}o.d(t,{w:()=>a,_:()=>r});const n=/^([0-9]+)_(.*)$/;function r(e){const t=n.exec(e);if(!t)throw new Error("Cannot parse invalid filter key");return{chartId:parseInt(t[1],10),column:t[2]}}},56967:(e,t,o)=>{function a(){return(window.location.hash||"#").substring(1)}o.d(t,{Z:()=>a})},74599:(e,t,o)=>{o.d(t,{Ch:()=>i,A:()=>s,mO:()=>l,u3:()=>c,Ft:()=>d,eG:()=>u,ze:()=>h,sh:()=>p});var a=o(91877),n=o(93185),r=o(8868);const i="CLEAR_DATA_MASK_STATE",s="UPDATE_DATA_MASK",l="SET_DATA_MASK_FOR_FILTER_CONFIG_COMPLETE",c="SET_DATA_MASK_FOR_FILTER_CONFIG_FAIL";function d(e,t){return{type:l,filterConfig:e,filters:t}}function u(e,t){const o=(0,a.cr)(n.T.DASHBOARD_NATIVE_FILTERS)||(0,a.cr)(n.T.DASHBOARD_CROSS_FILTERS);return{type:s,filterId:e,dataMask:o?t:{}}}function h(e){return u(e,(0,r.H)(e))}function p(){return{type:i}}},8868:(e,t,o)=>{o.d(t,{H:()=>d,Z:()=>h});var a=o(18172),n=o(93185),r=o(92242),i=o(63389),s=o(91877),l=o(74599),c=o(99543);function d(e,t={}){let o={};return e&&(o={id:e}),{...o,extraFormData:{},filterState:{},ownState:{},...t}}function u(e,t,o,a,n){e.forEach((e=>{var o;const r=a||{};t[e.id]={...d(e.id),...e.defaultDataMask,...r[e.id]},n&&!(0,c.JB)(e.defaultDataMask,null==(o=n[e.id])?void 0:o.defaultDataMask,{ignoreUndefined:!0})&&(t[e.id]={...t[e.id],...e.defaultDataMask})})),Object.values(o).forEach((e=>{String(null==e?void 0:e.id).startsWith(r.rW)||(t[null==e?void 0:e.id]=e)}))}const h=(0,a.ZP)(((e,t)=>{var o,a,r,c;const h={};switch(t.type){case l.Ch:return h;case l.A:return e[t.filterId]={...d(t.filterId),...e[t.filterId],...t.dataMask},e;case i.$:var p,m;return(0,s.cr)(n.T.DASHBOARD_CROSS_FILTERS)&&Object.keys(null==(p=t.data.dashboardInfo)||null==(m=p.metadata)?void 0:m.chart_configuration).forEach((e=>{h[e]={...d(e)}})),u(null!=(o=null==(a=t.data.dashboardInfo)||null==(r=a.metadata)?void 0:r.native_filter_configuration)?o:[],h,e,t.data.dataMask),h;case l.mO:return u(null!=(c=t.filterConfig)?c:[],h,e,t.filters),h;default:return e}}),{})},11865:(e,t,o)=>{o.d(t,{Z:()=>ua});var a=o(5872),n=o.n(a),r=o(67294),i=o(57902),s=o(356),l=o(45697),c=o.n(l),d=o(4715),u=o(37703),h=o(61988),p=o(68135),m=o(9882),g=o(67913),f=o(12515),v=o(52256),b=o(51995),_=o(11965);function y(e){const{selectable:t,children:o,...a}=e,r=(0,b.Fg)(),i={"&.ant-list-item":{padding:`${r.gridUnit+2}px ${3*r.gridUnit}px`,":first-of-type":{borderTopLeftRadius:r.gridUnit,borderTopRightRadius:r.gridUnit},":last-of-type":{borderBottomLeftRadius:r.gridUnit,borderBottomRightRadius:r.gridUnit}}};return t&&(i["&:hover"]={cursor:"pointer",backgroundColor:r.colors.grayscale.light4}),(0,_.tZ)(d.aV.Item,n()({},a,{css:i}),o)}var C=o(27845);const E=(0,g.Z)((()=>Promise.all([o.e(2087),o.e(5094)]).then(o.bind(o,25094))),(()=>(0,_.tZ)("div",{style:{width:450,height:368}}))),T={colorScheme:c().string.isRequired,annotationError:c().object,annotationQuery:c().object,vizType:c().string,validationErrors:c().array,name:c().string.isRequired,actions:c().object,value:c().arrayOf(c().object),onChange:c().func,refreshAnnotationData:c().func};class S extends r.PureComponent{constructor(e){super(e),this.state={popoverVisible:{},addedAnnotationIndex:null},this.addAnnotationLayer=this.addAnnotationLayer.bind(this),this.removeAnnotationLayer=this.removeAnnotationLayer.bind(this),this.handleVisibleChange=this.handleVisibleChange.bind(this)}componentDidMount(){E.preload()}UNSAFE_componentWillReceiveProps(e){const{name:t,annotationError:o,validationErrors:a,value:n}=e;Object.keys(o).length&&!a.length&&this.props.actions.setControlValue(t,n,Object.keys(o)),!Object.keys(o).length&&a.length&&this.props.actions.setControlValue(t,n,[])}addAnnotationLayer(e,t){let o=this.props.value;o.includes(e)?o=o.map((o=>o===e?t:o)):(o=[...o,t],this.setState({addedAnnotationIndex:o.length-1})),this.props.refreshAnnotationData({annotation:t,force:!0}),this.props.onChange(o)}handleVisibleChange(e,t){this.setState((o=>({popoverVisible:{...o.popoverVisible,[t]:e}})))}removeAnnotationLayer(e){const t=this.props.value.filter((t=>t!==e));this.props.onChange(t)}renderPopover(e,t,o){const a=(null==t?void 0:t.name)||"_new";return(0,_.tZ)("div",{id:`annotation-pop-${a}`},(0,_.tZ)(E,n()({},t,{error:o,colorScheme:this.props.colorScheme,vizType:this.props.vizType,addAnnotationLayer:e=>this.addAnnotationLayer(t,e),removeAnnotationLayer:()=>this.removeAnnotationLayer(t),close:()=>{this.handleVisibleChange(!1,e),this.setState({addedAnnotationIndex:null})}})))}renderInfo(e){const{annotationError:t,annotationQuery:o}=this.props;return o[e.name]?(0,_.tZ)("i",{className:"fa fa-refresh",style:{color:"orange"},"aria-hidden":!0}):t[e.name]?(0,_.tZ)(m.V,{label:"validation-errors",bsStyle:"danger",tooltip:t[e.name]}):e.show?"":(0,_.tZ)("span",{style:{color:"red"}}," Hidden ")}render(){const{addedAnnotationIndex:e}=this.state,t=this.props.value[e],o=this.props.value.map(((e,t)=>(0,_.tZ)(C.Z,{key:t,trigger:"click",title:(0,h.t)("Edit annotation layer"),css:e=>({"&:hover":{cursor:"pointer",backgroundColor:e.colors.grayscale.light4}}),content:this.renderPopover(t,e,this.props.annotationError[e.name]),visible:this.state.popoverVisible[t],onVisibleChange:e=>this.handleVisibleChange(e,t)},(0,_.tZ)(y,{selectable:!0},(0,_.tZ)("span",null,e.name),(0,_.tZ)("span",{style:{float:"right"}},this.renderInfo(e))))));return(0,_.tZ)("div",null,(0,_.tZ)(d.aV,{bordered:!0,css:e=>({borderRadius:e.gridUnit})},o,(0,_.tZ)(C.Z,{trigger:"click",content:this.renderPopover("add",t),title:(0,h.t)("Add annotation layer"),visible:this.state.popoverVisible.add,destroyTooltipOnHide:!0,onVisibleChange:e=>this.handleVisibleChange(e,"add")},(0,_.tZ)(y,{selectable:!0},(0,_.tZ)("i",{className:"fa fa-plus"})," ","  ",(0,h.t)("Add annotation layer")))))}}S.propTypes=T,S.defaultProps={vizType:"",value:[],annotationError:{},annotationQuery:{},onChange:()=>{}};const Z=(0,p.b)(S),x=(0,u.$j)((function({charts:e,explore:t}){var o,a;const n=e[(0,f.Jp)(t)]||e[0]||{};return{colorScheme:null==(o=t.controls)||null==(a=o.color_scheme)?void 0:a.value,annotationError:n.annotationError,annotationQuery:n.annotationQuery,vizType:t.controls.viz_type.value}}),(function(e){return{refreshAnnotationData:t=>e((0,v.runAnnotationQuery)(t))}}))(Z);var A=o(23279),R=o.n(A),w=o(9875),L=o(82342);const I=b.iK.div`
  display: flex;
`,O=(0,b.iK)(w.Rn)`
  flex: 1;
  margin-right: ${({theme:e})=>e.gridUnit}px;
`,M=(0,b.iK)(w.Rn)`
  flex: 1;
  margin-left: ${({theme:e})=>e.gridUnit}px;
`,D=e=>null===e||Number.isNaN(Number(e))?null:Number(e);function N({onChange:e=(()=>{}),value:t=[null,null],...o}){const[a,n]=(0,r.useState)([D(t[0]),D(t[1])]),i=t[0],s=t[1],l=(0,r.useRef)(R()(e,300)).current,c=e=>{n(e),l([void 0===e[0]?null:e[0],void 0===e[1]?null:e[1]])};return(0,r.useEffect)((()=>{n([D(i),D(s)])}),[i,s]),(0,_.tZ)("div",null,(0,_.tZ)(L.Z,o),(0,_.tZ)(I,null,(0,_.tZ)(O,{placeholder:(0,h.t)("Min"),onChange:e=>{c([D(e),a[1]])},value:null===a[0]?void 0:a[0]}),(0,_.tZ)(M,{placeholder:(0,h.t)("Max"),onChange:e=>{c([a[0],D(e)])},value:null===a[1]?void 0:a[1]})))}var k=o(79069),F=o(14670),P=o.n(F),U=o(95742),$=o(70163),q=o(33334);const V={name:c().string.isRequired,label:c().string,description:c().string,placeholder:c().string,addTooltip:c().string,itemGenerator:c().func,keyAccessor:c().func,onChange:c().func,value:c().oneOfType([c().array]),isFloat:c().bool,isInt:c().bool,controlName:c().string.isRequired},j={label:null,description:null,onChange:()=>{},placeholder:(0,h.t)("Empty collection"),itemGenerator:()=>({key:P().generate()}),keyAccessor:e=>e.key,value:[],addTooltip:(0,h.t)("Add an item")},H=(0,U.W8)(y),B=(0,U.JN)(d.aV),G=(0,U.W6)((()=>(0,_.tZ)("i",{role:"img","aria-label":"drag",className:"fa fa-bars text-primary",style:{cursor:"ns-resize"}})));var z={name:"11g6mpt",styles:"justify-content:flex-start"};class Q extends r.Component{constructor(e){super(e),this.onAdd=this.onAdd.bind(this)}onChange(e,t){const o=[...this.props.value];o[e]={...this.props.value[e],...t},this.props.onChange(o)}onAdd(){this.props.onChange(this.props.value.concat([this.props.itemGenerator()]))}onSortEnd({oldIndex:e,newIndex:t}){this.props.onChange((0,U.Rp)(this.props.value,e,t))}removeItem(e){this.props.onChange(this.props.value.filter(((t,o)=>e!==o)))}renderList(){if(0===this.props.value.length)return(0,_.tZ)("div",{className:"text-muted"},this.props.placeholder);const e=da[this.props.controlName];return(0,_.tZ)(B,{useDragHandle:!0,lockAxis:"y",onSortEnd:this.onSortEnd.bind(this),bordered:!0,css:e=>({borderRadius:e.gridUnit})},this.props.value.map(((t,o)=>{const{label:a,...r}=this.props;return(0,_.tZ)(H,{className:"clearfix",css:z,key:this.props.keyAccessor(t),index:o},(0,_.tZ)(G,null),(0,_.tZ)("div",{css:e=>({flex:1,marginLeft:2*e.gridUnit,marginRight:2*e.gridUnit})},(0,_.tZ)(e,n()({},r,t,{onChange:this.onChange.bind(this,o)}))),(0,_.tZ)(m.V,{icon:"times",label:"remove-item",tooltip:(0,h.t)("Remove item"),bsStyle:"primary",onClick:this.removeItem.bind(this,o)}))})))}render(){const{theme:e}=this.props;return(0,_.tZ)("div",{className:"CollectionControl"},(0,_.tZ)(q.gM,null,(0,_.tZ)(L.Z,this.props),(0,_.tZ)(q.IG,{onClick:this.onAdd},(0,_.tZ)($.Z.PlusLarge,{iconSize:"s",iconColor:e.colors.grayscale.light5}))),this.renderList())}}Q.propTypes=V,Q.defaultProps=j;const K=(0,p.b)(Q);var W=o(24198),Y=o(81545),J=o(76697);const X={onChange:c().func,value:c().object},ee={position:"absolute",width:"50px",height:"20px",top:"0px",left:"0px",right:"0px",bottom:"0px"},te={swatch:{width:"50px",height:"20px",position:"relative",padding:"5px",borderRadius:"1px",display:"inline-block",cursor:"pointer",boxShadow:"rgba(0, 0, 0, 0.15) 0px 0px 0px 1px inset, rgba(0, 0, 0, 0.25) 0px 0px 4px inset"},color:{...ee,borderRadius:"2px"},checkboard:{...ee,background:'url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==") left center'}};class oe extends r.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e){this.props.onChange(e.rgb)}renderPopover(){const e=(0,Y.Z)().get().colors.filter(((e,t)=>t<7));return(0,_.tZ)("div",{id:"filter-popover",className:"color-popover"},(0,_.tZ)(W.xS,{color:this.props.value,onChange:this.onChange,presetColors:e}))}render(){const e=this.props.value||{r:0,g:0,b:0,a:0},t={...te.color,background:`rgba(${e.r}, ${e.g}, ${e.b}, ${e.a})`};return(0,_.tZ)("div",null,(0,_.tZ)(L.Z,this.props),(0,_.tZ)(J.ZP,{trigger:"click",placement:"right",content:this.renderPopover()},(0,_.tZ)("div",{style:te.swatch},(0,_.tZ)("div",{style:te.checkboard}),(0,_.tZ)("div",{style:t}))))}}oe.propTypes=X,oe.defaultProps={onChange:()=>{}};var ae=o(95470),ne=o(23525),re=o(83862),ie=o(58593),se=o(77775),le=o(35932),ce=o(91178),de=o(86057),ue=o(27600),he=o(70695);const pe={actions:c().object.isRequired,onChange:c().func,value:c().string,datasource:c().object.isRequired,form_data:c().object.isRequired,isEditable:c().bool,onDatasourceSave:c().func},me=b.iK.div`
  .data-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    padding: ${({theme:e})=>2*e.gridUnit}px;
  }
  .error-alert {
    margin: ${({theme:e})=>2*e.gridUnit}px;
  }
  .ant-dropdown-trigger {
    margin-left: ${({theme:e})=>2*e.gridUnit}px;
    box-shadow: none;
    &:active {
      box-shadow: none;
    }
  }
  .btn-group .open .dropdown-toggle {
    box-shadow: none;
    &.button-default {
      background: none;
    }
  }
  i.angle {
    color: ${({theme:e})=>e.colors.primary.base};
  }
  svg.datasource-modal-trigger {
    color: ${({theme:e})=>e.colors.primary.base};
    cursor: pointer;
  }
  .title-select {
    flex: 1 1 100%;
    display: inline-block;
    background-color: ${({theme:e})=>e.colors.grayscale.light3};
    padding: ${({theme:e})=>2*e.gridUnit}px;
    border-radius: ${({theme:e})=>e.borderRadius}px;
    text-align: center;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
  }
  .dataset-svg {
    margin-right: ${({theme:e})=>2*e.gridUnit}px;
    flex: none;
  }
  span[aria-label='dataset-physical'] {
    color: ${({theme:e})=>e.colors.grayscale.base};
  }
  span[aria-label='more-vert'] {
    color: ${({theme:e})=>e.colors.primary.base};
  }
`,ge="change_dataset",fe="view_in_sql_lab",ve="edit_dataset";class be extends r.PureComponent{constructor(e){super(e),this.state={showEditDatasourceModal:!1,showChangeDatasourceModal:!1},this.onDatasourceSave=this.onDatasourceSave.bind(this),this.toggleChangeDatasourceModal=this.toggleChangeDatasourceModal.bind(this),this.toggleEditDatasourceModal=this.toggleEditDatasourceModal.bind(this),this.toggleShowDatasource=this.toggleShowDatasource.bind(this),this.handleMenuItemClick=this.handleMenuItemClick.bind(this)}onDatasourceSave(e){var t,o;this.props.actions.setDatasource(e);const a=null==(t=this.props.form_data)?void 0:t.granularity_sqla,{columns:n}=this.props.datasource,r=n.find((e=>e.is_dttm));"table"!==e.type||null!=(o=n.find((({column_name:e})=>e===a)))&&o.is_dttm||this.props.actions.setControlValue("granularity_sqla",r?r.column_name:null),this.props.onDatasourceSave&&this.props.onDatasourceSave(e)}toggleShowDatasource(){this.setState((({showDatasource:e})=>({showDatasource:!e})))}toggleChangeDatasourceModal(){this.setState((({showChangeDatasourceModal:e})=>({showChangeDatasourceModal:!e})))}toggleEditDatasourceModal(){this.setState((({showEditDatasourceModal:e})=>({showEditDatasourceModal:!e})))}handleMenuItemClick({key:e}){if(e===ge&&this.toggleChangeDatasourceModal(),e===ve&&this.toggleEditDatasourceModal(),e===fe){const{datasource:e}=this.props,t={datasourceKey:`${e.id}__${e.type}`,sql:e.sql};(0,f.Md)("/superset/sqllab/",t)}}render(){var e;const{showChangeDatasourceModal:t,showEditDatasourceModal:o}=this.state,{datasource:a,onChange:n,theme:i}=this.props,s=null==a.id;let l=!1;if(s){const e=(0,ne.eY)(ue.KD.datasetId),t=(0,ne.eY)(ue.KD.sliceId);e||t||(l=!0)}const c="table"===a.type,{user:u}=this.props,p=a.owners.map((e=>e.id)).includes(u.userId)||(0,he.i5)(u),m=(0,h.t)("Edit dataset"),g=(0,_.tZ)(re.v,{onClick:this.handleMenuItemClick},this.props.isEditable&&(0,_.tZ)(re.v.Item,{key:ve,disabled:!p},p?m:(0,_.tZ)(ie.u,{title:(0,h.t)("You must be a dataset owner in order to edit. Please reach out to a dataset owner to request modifications or edit access.")},m)),(0,_.tZ)(re.v.Item,{key:ge},(0,h.t)("Change dataset")),c&&(0,_.tZ)(re.v.Item,{key:fe},(0,h.t)("View in SQL Lab"))),{health_check_message:f}=a;let v={};if(null!=a&&a.extra)try{v=JSON.parse(null==a?void 0:a.extra)}catch{}return(0,_.tZ)(me,{className:"DatasourceControl"},(0,_.tZ)("div",{className:"data-container"},(0,_.tZ)($.Z.DatasetPhysical,{className:"dataset-svg"}),!s&&a.name.length>25?(0,_.tZ)(ie.u,{title:a.name},(0,_.tZ)("span",{className:"title-select"},a.name)):(0,_.tZ)("span",{title:a.name,className:"title-select"},a.name),f&&(0,_.tZ)(ie.u,{title:f},(0,_.tZ)($.Z.AlertSolid,{iconColor:i.colors.warning.base})),(null==(e=v)?void 0:e.warning_markdown)&&(0,_.tZ)(de.Z,{warningMarkdown:v.warning_markdown}),(0,_.tZ)(d.Gj,{overlay:g,trigger:["click"]},(0,_.tZ)(ie.u,{title:(0,h.t)("More dataset related options")},(0,_.tZ)($.Z.MoreVert,{className:"datasource-modal-trigger"})))),s&&l&&(0,_.tZ)("div",{className:"error-alert"},(0,_.tZ)(ce.Z,{level:"warning",title:(0,h.t)("Missing URL parameters"),source:"explore",subtitle:(0,_.tZ)(r.Fragment,null,(0,_.tZ)("p",null,(0,h.t)("The URL is missing the dataset_id or slice_id parameters.")))})),s&&!l&&(0,_.tZ)("div",{className:"error-alert"},(0,_.tZ)(ce.Z,{level:"warning",title:(0,h.t)("Missing dataset"),source:"explore",subtitle:(0,_.tZ)(r.Fragment,null,(0,_.tZ)("p",null,(0,h.t)("The dataset linked to this chart may have been deleted.")),(0,_.tZ)("p",null,(0,_.tZ)(le.Z,{buttonStyle:"primary",onClick:()=>this.handleMenuItemClick({key:ge})},(0,h.t)("Change dataset"))))})),o&&(0,_.tZ)(se.W,{datasource:a,show:o,onDatasourceSave:this.onDatasourceSave,onHide:this.toggleEditDatasourceModal}),t&&(0,_.tZ)(se.Q,{onDatasourceSave:this.onDatasourceSave,onHide:this.toggleChangeDatasourceModal,show:t,onChange:n}))}}be.propTypes=pe,be.defaultProps={onChange:()=>{},onDatasourceSave:null,value:null,isEditable:!0};const _e=(0,p.b)(be);var ye=o(73375),Ce=o(37921),Ee=o(43700),Te=o(79684),Se=o(18446),Ze=o.n(Se),xe=o(55786),Ae=o(60812),Re=o(34087),we=o(42753),Le=o(19113),Ie=o(27130);const Oe={title:c().shape({label:c().string,hasCustomLabel:c().bool}),onChange:c().func.isRequired,isEditDisabled:c().bool};class Me extends r.Component{constructor(e){super(e),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onClick=this.onClick.bind(this),this.onBlur=this.onBlur.bind(this),this.onInputBlur=this.onInputBlur.bind(this),this.state={isHovered:!1,isEditMode:!1}}onMouseOver(){this.setState({isHovered:!0})}onMouseOut(){this.setState({isHovered:!1})}onClick(){this.setState({isEditMode:!0})}onBlur(){this.setState({isEditMode:!1})}onInputBlur(e){""===e.target.value&&this.props.onChange(e),this.onBlur()}render(){const{title:e,onChange:t,isEditDisabled:o}=this.props,a=(0,h.t)("My metric");return o?(0,_.tZ)("span",null,e.label||a):this.state.isEditMode?(0,_.tZ)(w.II,{className:"metric-edit-popover-label-input",type:"text",placeholder:e.label,value:e.hasCustomLabel?e.label:"",autoFocus:!0,onChange:t,onBlur:this.onInputBlur}):(0,_.tZ)(ie.u,{placement:"top",title:"Click to edit label"},(0,_.tZ)("span",{className:"AdhocMetricEditPopoverTitle inline-editable",onMouseOver:this.onMouseOver,onMouseOut:this.onMouseOut,onClick:this.onClick,onBlur:this.onBlur,role:"button",tabIndex:0},e.label||a," ",(0,_.tZ)("i",{className:"fa fa-pencil",style:{color:this.state.isHovered?"black":"grey"}})))}}Me.propTypes=Oe;var De=o(63325),Ne=o(40637),ke=o(94301),Fe=o(49238),Pe=o(94670),Ue=o(33313),$e=o(54076),qe=o(69856),Ve=o(99963);const je={onChange:c().func.isRequired,onClose:c().func.isRequired,onResize:c().func.isRequired,getCurrentTab:c().func,getCurrentLabel:c().func,adhocMetric:c().instanceOf(Le.Z).isRequired,columns:c().arrayOf(Re.Z),savedMetricsOptions:c().arrayOf(Ie.Z),savedMetric:Ie.Z,datasource:c().object},He={columns:[],getCurrentTab:$e.EI},Be=(0,b.iK)(d.Ph)`
  .metric-option {
    & > svg {
      min-width: ${({theme:e})=>4*e.gridUnit+"px"};
    }
    & > .option-label {
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
`,Ge="SAVED";class ze extends r.PureComponent{constructor(e){super(e),this.defaultActiveTabKey=(this.props.savedMetric.metric_name||this.props.adhocMetric.isNew)&&Array.isArray(this.props.savedMetricsOptions)&&this.props.savedMetricsOptions.length>0?Ge:this.props.adhocMetric.expressionType,this.onSave=this.onSave.bind(this),this.onResetStateAndClose=this.onResetStateAndClose.bind(this),this.onColumnChange=this.onColumnChange.bind(this),this.onAggregateChange=this.onAggregateChange.bind(this),this.onSavedMetricChange=this.onSavedMetricChange.bind(this),this.onSqlExpressionChange=this.onSqlExpressionChange.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onTabChange=this.onTabChange.bind(this),this.handleAceEditorRef=this.handleAceEditorRef.bind(this),this.refreshAceEditor=this.refreshAceEditor.bind(this),this.state={adhocMetric:this.props.adhocMetric,savedMetric:this.props.savedMetric,width:qe.kc,height:qe.H7},document.addEventListener("mouseup",this.onMouseUp)}componentDidMount(){this.props.getCurrentTab(this.defaultActiveTabKey)}componentDidUpdate(e,t){var o,a,n,r,i,s,l,c,d,u,h,p,m;(null==(o=t.adhocMetric)?void 0:o.sqlExpression)===(null==(a=this.state.adhocMetric)?void 0:a.sqlExpression)&&(null==(n=t.adhocMetric)?void 0:n.aggregate)===(null==(r=this.state.adhocMetric)?void 0:r.aggregate)&&(null==(i=t.adhocMetric)||null==(s=i.column)?void 0:s.column_name)===(null==(l=this.state.adhocMetric)||null==(c=l.column)?void 0:c.column_name)&&(null==(d=t.savedMetric)?void 0:d.metric_name)===(null==(u=this.state.savedMetric)?void 0:u.metric_name)||this.props.getCurrentLabel({savedMetricLabel:(null==(h=this.state.savedMetric)?void 0:h.verbose_name)||(null==(p=this.state.savedMetric)?void 0:p.metric_name),adhocMetricLabel:null==(m=this.state.adhocMetric)?void 0:m.getDefaultLabel()})}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}onSave(){var e;const{adhocMetric:t,savedMetric:o}=this.state,a=null!=o&&o.metric_name?o:t,n=null!=(e=this.props.savedMetric)&&e.metric_name?this.props.savedMetric:this.props.adhocMetric;this.props.onChange({...a},n),this.props.onClose()}onResetStateAndClose(){this.setState({adhocMetric:this.props.adhocMetric,savedMetric:this.props.savedMetric},this.props.onClose)}onColumnChange(e){const t=this.props.columns.find((t=>t.column_name===e));this.setState((e=>({adhocMetric:e.adhocMetric.duplicateWith({column:t,expressionType:Le.v.SIMPLE}),savedMetric:void 0})))}onAggregateChange(e){this.setState((t=>({adhocMetric:t.adhocMetric.duplicateWith({aggregate:e,expressionType:Le.v.SIMPLE}),savedMetric:void 0})))}onSavedMetricChange(e){const t=this.props.savedMetricsOptions.find((t=>t.metric_name===e));this.setState((e=>({savedMetric:t,adhocMetric:e.adhocMetric.duplicateWith({column:void 0,aggregate:void 0,sqlExpression:void 0,expressionType:Le.v.SIMPLE})})))}onSqlExpressionChange(e){this.setState((t=>({adhocMetric:t.adhocMetric.duplicateWith({sqlExpression:e,expressionType:Le.v.SQL}),savedMetric:void 0})))}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),qe.kc),height:Math.max(this.dragStartHeight+2*(e.clientY-this.dragStartY),qe.H7)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.refreshAceEditor(),this.props.getCurrentTab(e)}handleAceEditorRef(e){e&&(this.aceEditorRef=e)}refreshAceEditor(){setTimeout((()=>{this.aceEditorRef&&this.aceEditorRef.editor.resize()}),0)}renderColumnOption(e){const t={...e};return t.metric_name&&!t.verbose_name&&(t.verbose_name=t.metric_name),(0,_.tZ)(Ve.l,{column:t,showType:!0})}renderMetricOption(e){return(0,_.tZ)(Ve.B,{metric:e,showType:!0})}render(){var e,t,o,a,r;const{adhocMetric:i,savedMetric:s,columns:l,savedMetricsOptions:c,onChange:u,onClose:p,onResize:m,datasource:g,...f}=this.props,{adhocMetric:v,savedMetric:b}=this.state,y=Ue.Z.concat(l.map((e=>({name:e.column_name,value:e.column_name,score:50,meta:"column"})))),C=v.column&&v.column.column_name||v.inferSqlExpressionColumn(),E={ariaLabel:(0,h.t)("Select column"),placeholder:(0,h.t)("%s column(s)",l.length),value:C,onChange:this.onColumnChange,allowClear:!0,autoFocus:!C},T={ariaLabel:(0,h.t)("Select aggregate options"),placeholder:(0,h.t)("%s aggregates(s)",qe.Ps.length),value:v.aggregate||v.inferSqlExpressionAggregate(),onChange:this.onAggregateChange,allowClear:!0,autoFocus:!!C},S={ariaLabel:(0,h.t)("Select saved metrics"),placeholder:(0,h.t)("%s saved metric(s)",null!=(e=null==c?void 0:c.length)?e:0),value:null==b?void 0:b.metric_name,onChange:this.onSavedMetricChange,allowClear:!0,autoFocus:!0};"druid"===(null==(t=this.props.datasource)?void 0:t.type)&&T.options&&(T.options=T.options.filter((e=>"AVG"!==e)));const Z=v.isValid()||(null==b?void 0:b.metric_name),x=!v.equals(i)||!(void 0===(null==b?void 0:b.metric_name)&&void 0===(null==s?void 0:s.metric_name))&&(null==b?void 0:b.metric_name)!==(null==s?void 0:s.metric_name);let A={};if(null!=g&&g.extra)try{A=JSON.parse(g.extra)}catch{}return(0,_.tZ)(Fe.l0,n()({layout:"vertical",id:"metrics-edit-popover"},f),(0,_.tZ)(Ne.ZP,{id:"adhoc-metric-edit-tabs",defaultActiveKey:this.defaultActiveTabKey,className:"adhoc-metric-edit-tabs",style:{height:this.state.height,width:this.state.width},onChange:this.onTabChange,allowOverflow:!0},(0,_.tZ)(Ne.ZP.TabPane,{key:Ge,tab:(0,h.t)("Saved")},(0,xe.Z)(c).length>0?(0,_.tZ)(Fe.xJ,{label:(0,h.t)("Saved metric")},(0,_.tZ)(Be,n()({options:(0,xe.Z)(c).map((e=>({value:e.metric_name,label:e.metric_name,customLabel:this.renderMetricOption(e),key:e.id})))},S))):(0,_.tZ)(ke.Tc,{image:"empty.svg",title:(0,h.t)("No saved metrics found"),description:(0,h.t)('Add metrics to dataset in "Edit datasource" modal')})),(0,_.tZ)(Ne.ZP.TabPane,{key:Le.v.SIMPLE,tab:A.disallow_adhoc_metrics?(0,_.tZ)(ie.u,{title:(0,h.t)("Simple ad-hoc metrics are not enabled for this dataset")},(0,h.t)("Simple")):(0,h.t)("Simple"),disabled:A.disallow_adhoc_metrics},(0,_.tZ)(Fe.xJ,{label:(0,h.t)("column")},(0,_.tZ)(d.Ph,n()({options:l.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,key:e.id,customLabel:this.renderColumnOption(e)})))},E))),(0,_.tZ)(Fe.xJ,{label:(0,h.t)("aggregate")},(0,_.tZ)(d.Ph,n()({options:qe.Ps.map((e=>({value:e,label:e,key:e})))},T)))),(0,_.tZ)(Ne.ZP.TabPane,{key:Le.v.SQL,tab:A.disallow_adhoc_metrics||"druid"===(null==(o=this.props.datasource)?void 0:o.type)?(0,_.tZ)(ie.u,{title:"druid"===(null==(a=this.props.datasource)?void 0:a.type)?(0,h.t)("Custom SQL ad-hoc metrics are not available for the native Druid connector"):(0,h.t)("Custom SQL ad-hoc metrics are not enabled for this dataset")},(0,h.t)("Custom SQL")):(0,h.t)("Custom SQL"),disabled:A.disallow_adhoc_metrics||"druid"===(null==(r=this.props.datasource)?void 0:r.type)},(0,_.tZ)(Pe.iO,{showLoadingForImport:!0,ref:this.handleAceEditorRef,keywords:y,height:this.state.height-80+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:v.sqlExpression||v.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0}))),(0,_.tZ)("div",null,(0,_.tZ)(le.Z,{buttonSize:"small",onClick:this.onResetStateAndClose,cta:!0},(0,h.t)("Close")),(0,_.tZ)(le.Z,{disabled:!Z,buttonStyle:x&&Z?"primary":"default",buttonSize:"small",onClick:this.onSave,cta:!0},(0,h.t)("Save")),(0,_.tZ)("i",{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"fa fa-expand edit-popover-resize text-muted"})))}}ze.propTypes=je,ze.defaultProps=He;class Qe extends r.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.onLabelChange=this.onLabelChange.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.getCurrentTab=this.getCurrentTab.bind(this),this.getCurrentLabel=this.getCurrentLabel.bind(this),this.onChange=this.onChange.bind(this),this.state={adhocMetric:e.adhocMetric,popoverVisible:!1,title:{label:e.adhocMetric.label,hasCustomLabel:e.adhocMetric.hasCustomLabel},currentLabel:"",labelModified:!1,isTitleEditDisabled:!1}}static getDerivedStateFromProps(e,t){return t.adhocMetric.optionName!==e.adhocMetric.optionName?{adhocMetric:e.adhocMetric,title:{label:e.adhocMetric.label,hasCustomLabel:e.adhocMetric.hasCustomLabel},currentLabel:"",labelModified:!1}:{adhocMetric:e.adhocMetric}}onLabelChange(e){var t;const{verbose_name:o,metric_name:a}=this.props.savedMetric,n=null==(t=this.props.adhocMetric)?void 0:t.getDefaultLabel(),r=e.target.value;this.setState((e=>({title:{label:r||e.currentLabel||o||a||n,hasCustomLabel:!!r},labelModified:!0})))}onPopoverResize(){this.forceUpdate()}closePopover(){this.togglePopover(!1),this.setState({labelModified:!1})}togglePopover(e){this.setState({popoverVisible:e})}getCurrentTab(e){this.setState({isTitleEditDisabled:e===Ge})}getCurrentLabel({savedMetricLabel:e,adhocMetricLabel:t}){const o=e||t;this.setState({currentLabel:o,labelModified:!0}),!e&&this.state.title.hasCustomLabel||this.setState({title:{label:o,hasCustomLabel:!1}})}onChange(e,t){this.props.onMetricEdit({...e,...this.state.title},t)}render(){const{adhocMetric:e,savedMetric:t,columns:o,savedMetricsOptions:a,datasource:n,isControlledComponent:r}=this.props,{verbose_name:i,metric_name:s}=t,{hasCustomLabel:l,label:c}=e,d=l?c:e.getDefaultLabel(),u=this.state.labelModified?this.state.title:{label:i||s||d,hasCustomLabel:l},{visible:h,togglePopover:p,closePopover:m}=r?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},g=(0,_.tZ)(De.b,null,(0,_.tZ)(ze,{adhocMetric:e,columns:o,savedMetricsOptions:a,savedMetric:t,datasource:n,onResize:this.onPopoverResize,onClose:m,onChange:this.onChange,getCurrentTab:this.getCurrentTab,getCurrentLabel:this.getCurrentLabel})),f=(0,_.tZ)(Me,{title:u,onChange:this.onLabelChange,isEditDisabled:this.state.isTitleEditDisabled});return(0,_.tZ)(C.Z,{placement:"right",trigger:"click",content:g,defaultVisible:h,visible:h,onVisibleChange:p,title:f,destroyTooltipOnHide:!0},this.props.children)}}const Ke=Qe,We={adhocMetric:c().instanceOf(Le.Z),onMetricEdit:c().func.isRequired,onRemoveMetric:c().func,columns:c().arrayOf(Re.Z),savedMetricsOptions:c().arrayOf(Ie.Z),savedMetric:Ie.Z,datasource:c().object,onMoveLabel:c().func,onDropLabel:c().func,index:c().number,type:c().string,multi:c().bool};class Ye extends r.PureComponent{constructor(e){super(e),this.onRemoveMetric=this.onRemoveMetric.bind(this)}onRemoveMetric(e){e.stopPropagation(),this.props.onRemoveMetric(this.props.index)}render(){const{adhocMetric:e,onMetricEdit:t,columns:o,savedMetricsOptions:a,savedMetric:n,datasource:r,onMoveLabel:i,onDropLabel:s,index:l,type:c,multi:d}=this.props;return(0,_.tZ)(Ke,{adhocMetric:e,onMetricEdit:t,columns:o,savedMetricsOptions:a,savedMetric:n,datasource:r},(0,_.tZ)(q.yz,{savedMetric:n,adhocMetric:e,label:e.label,onRemove:this.onRemoveMetric,onMoveLabel:i,onDropLabel:s,index:l,type:null!=c?c:we.g.AdhocMetricOption,withCaret:!0,isFunction:!0,multi:d}))}}const Je=Ye;Ye.propTypes=We;const Xe={option:c().oneOfType([c().object,c().string]).isRequired,index:c().number.isRequired,onMetricEdit:c().func,onRemoveMetric:c().func,onMoveLabel:c().func,onDropLabel:c().func,columns:c().arrayOf(Re.Z),savedMetrics:c().arrayOf(Ie.Z),savedMetricsOptions:c().arrayOf(Ie.Z),multi:c().bool,datasource:c().object};function et({option:e,onMetricEdit:t,onRemoveMetric:o,columns:a,savedMetrics:n,savedMetricsOptions:r,datasource:i,onMoveLabel:s,onDropLabel:l,index:c,type:d,multi:u}){let h;var p;if("string"==typeof e?(p=e,h=n.find((e=>e.metric_name===p))):e.metric_name&&(h=e),e instanceof Le.Z||h){var m;const n={onMetricEdit:t,onRemoveMetric:o,columns:a,savedMetricsOptions:r,datasource:i,adhocMetric:e instanceof Le.Z?e:new Le.Z({isNew:!0}),onMoveLabel:s,onDropLabel:l,index:c,savedMetric:null!=(m=h)?m:{},type:d,multi:u};return(0,_.tZ)(Je,n)}return null}et.propTypes=Xe;var tt=o(17536);const ot={name:c().string.isRequired,onChange:c().func,value:c().oneOfType([c().arrayOf(c().oneOfType([c().string,tt.Z])),c().oneOfType([c().string,tt.Z])]),columns:c().arrayOf(Re.Z),savedMetrics:c().arrayOf(Ie.Z),isLoading:c().bool,multi:c().bool,clearable:c().bool,datasource:c().object};function at(e,t,o){var a;return null!=(a=null==e?void 0:e.filter((e=>Array.isArray(t)?!t.includes(e.metric_name)||e.metric_name===o:e)))?a:[]}function nt(e){return e&&!(e instanceof Le.Z)&&e.expressionType}function rt(e){return e?Array.isArray(e)?e.map((e=>nt(e)?new Le.Z(e):e)):nt(e)?[new Le.Z(e)]:[e]:[]}const it={metric_name:"",expression:""},st=({onChange:e,multi:t,value:o,columns:a,savedMetrics:n,datasource:i,...s})=>{const[l,c]=(0,r.useState)(rt(o)),d=(0,b.Fg)(),u=(0,Ae.D)(a),p=(0,Ae.D)(n),m=(0,r.useCallback)((o=>{if(null===o)return void e(null);const a=(0,xe.Z)(o).map((e=>e.metric_name?e.metric_name:e)).filter((e=>e));e(t?a:a[0])}),[t,e]),g=(0,r.useCallback)((e=>{const t=[...l,e];c(t),m(t)}),[m,l]),f=(0,r.useCallback)(((e,t)=>{const o=l.map((o=>o!==t.metric_name&&void 0===o.optionName||o.optionName!==t.optionName?o:e));c(o),m(o)}),[m,l]),v=(0,r.useCallback)((e=>{if(!Array.isArray(l))return;const t=[...l];t.splice(e,1),c(t),m(t)}),[m,l]),y=(0,r.useCallback)(((e,t)=>{const o=[...l];[o[t],o[e]]=[o[e],o[t]],c(o)}),[l]),C=(0,r.useCallback)((()=>!t&&l.length>0),[t,l.length]),E=(0,r.useMemo)((()=>at(n,o,null)),[o,n]),T=(0,r.useMemo)((()=>new Le.Z({isNew:!0})),[l]),S=(0,r.useCallback)((e=>C()?e:(0,_.tZ)(Ke,{adhocMetric:T,onMetricEdit:g,columns:a,savedMetricsOptions:E,savedMetric:it,datasource:i},e)),[a,i,C,T,g,E]);(0,r.useEffect)((()=>{if(o&&(!Ze()(u,a)||!Ze()(p,n))){const e=((e,t,o)=>(0,xe.Z)(e).filter((e=>"string"==typeof e||e.metric_name?null==o?void 0:o.some((t=>t.metric_name===e||t.metric_name===e.metric_name)):null==t?void 0:t.some((t=>!e.column||e.column.column_name===t.column_name)))))(o,a,n);Ze()(e,o)||m(e)}}),[a,m,n]),(0,r.useEffect)((()=>{c(rt(o))}),[o]);const Z=(0,r.useCallback)((()=>m(l)),[m,l]),x=(0,r.useCallback)(((e,o)=>(0,_.tZ)(et,{key:o,index:o,option:e,onMetricEdit:f,onRemoveMetric:v,columns:a,datasource:i,savedMetrics:n,savedMetricsOptions:at(n,l,null==l?void 0:l[o]),onMoveLabel:y,onDropLabel:Z,multi:t})),[a,i,y,t,Z,f,v,n,l]);return(0,_.tZ)("div",{className:"metrics-select"},(0,_.tZ)(q.gM,null,(0,_.tZ)(L.Z,s),S((0,_.tZ)(q.IG,{disabled:C()},(0,_.tZ)($.Z.PlusLarge,{iconSize:"s",iconColor:d.colors.grayscale.light5})))),(0,_.tZ)(q.yj,null,l.length>0?l.map(((e,t)=>x(e,t))):S((0,_.tZ)(q.SW,null,(0,_.tZ)($.Z.PlusSmall,{iconColor:d.colors.grayscale.light1}),(0,h.t)("Add metric")))))};st.propTypes=ot,st.defaultProps={onChange:()=>{},clearable:!0,savedMetrics:[],columns:[]};const lt=st;var ct=o(83734);const dt="fix",ut="metric",ht={onChange:c().func,value:c().object,isFloat:c().bool,datasource:c().object.isRequired,default:c().shape({type:c().oneOf(["fix","metric"]),value:c().oneOfType([c().string,c().number])})},pt={onChange:()=>{},default:{type:dt,value:5}};class mt extends r.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this),this.setType=this.setType.bind(this),this.setFixedValue=this.setFixedValue.bind(this),this.setMetric=this.setMetric.bind(this);const t=(e.value?e.value.type:e.default.type)||dt,o=(e.value?e.value.value:e.default.value)||"100";this.state={type:t,fixedValue:t===dt?o:"",metricValue:t===ut?o:null}}onChange(){this.props.onChange({type:this.state.type,value:this.state.type===dt?this.state.fixedValue:this.state.metricValue})}setType(e){this.setState({type:e},this.onChange)}setFixedValue(e){this.setState({fixedValue:e},this.onChange)}setMetric(e){this.setState({metricValue:e},this.onChange)}render(){const e=(this.props.value||this.props.default).type||dt,t=this.props.datasource?this.props.datasource.columns:null,o=this.props.datasource?this.props.datasource.metrics:null;return(0,_.tZ)("div",null,(0,_.tZ)(L.Z,this.props),(0,_.tZ)(Ee.Z,{ghost:!0,css:e=>(0,_.iv)("&.ant-collapse>.ant-collapse-item.ant-collapse-no-arrow>.ant-collapse-header{border:0px;padding:0px 0px ",2*e.gridUnit,"px 0px;display:inline-block;}&.ant-collapse-ghost>.ant-collapse-item>.ant-collapse-content>.ant-collapse-content-box{padding:0px;& .well{margin-bottom:0px;padding:",2*e.gridUnit,"px;}}","")},(0,_.tZ)(Ee.Z.Panel,{showArrow:!1,header:(0,_.tZ)(Ce.Z,{onClick:()=>{}},this.state.type===dt&&(0,_.tZ)("span",null,this.state.fixedValue),this.state.type===ut&&(0,_.tZ)("span",null,(0,_.tZ)("span",null,"metric: "),(0,_.tZ)("strong",null,this.state.metricValue?this.state.metricValue.label:null)))},(0,_.tZ)("div",{className:"well"},(0,_.tZ)(ct.Z,{title:(0,h.t)("Fixed"),isSelected:e===dt,onSelect:()=>{this.setType(dt)}},(0,_.tZ)(Te.Z,{isFloat:!0,onChange:this.setFixedValue,onFocus:()=>{this.setType(dt)},value:this.state.fixedValue})),(0,_.tZ)(ct.Z,{title:(0,h.t)("Based on a metric"),isSelected:e===ut,onSelect:()=>{this.setType(ut)}},(0,_.tZ)(lt,{name:"metric",columns:t,savedMetrics:o,multi:!1,onFocus:()=>{this.setType(ut)},onChange:this.setMetric,value:this.state.metricValue,datasource:this.props.datasource}))))))}}mt.propTypes=ht,mt.defaultProps=pt;var gt=o(31069),ft=o(14114),vt=o(98286);function bt(e){return void 0!==e.value}const _t=(0,ft.ZP)((({addDangerToast:e,allowClear:t=!0,ariaLabel:o,dataEndpoint:a,multi:n=!0,mutator:i,onChange:s,placeholder:l,value:c,...u})=>{const[p,m]=(0,r.useState)([]);return(0,r.useEffect)((()=>{gt.Z.get({endpoint:a}).then((e=>{const t=i?i(e.json):e.json.result;m(t)})).catch((t=>(0,vt.O)(t).then((t=>{const{error:o}=t;e((0,h.t)("Error while fetching data: %s",o))}))))}),[e,a,i]),(0,_.tZ)(d.Ph,{allowClear:t,ariaLabel:o||(0,h.t)("Select ..."),value:(()=>{const e=c||(void 0!==u.default?u.default:void 0);if(null!==e||p.find((e=>null===e.value)))return e})(),header:(0,_.tZ)(L.Z,u),mode:n?"multiple":"single",onChange:e=>{let t=e;Array.isArray(e)&&(t=e.map((e=>bt(e)?e.value:e))),bt(e)&&(t=e.value),s(t)},options:p,placeholder:l})}));var yt=o(82199),Ct=o(36155),Et={name:"mlsake",styles:"margin-left:0;margin-right:0"};function Tt(e){return(0,_.tZ)(Ct.Z,n()({},e,{css:Et}))}var St=o(665),Zt=o(42878);const xt={label:c().string,tooltip:c().string,colType:c().string,width:c().string,height:c().string,timeLag:c().oneOfType([c().string,c().number]),timeRatio:c().string,comparisonType:c().string,showYAxis:c().bool,yAxisBounds:c().array,bounds:c().array,d3format:c().string,dateFormat:c().string,onChange:c().func},At={label:(0,h.t)("Time series columns"),tooltip:"",colType:"",width:"",height:"",timeLag:"",timeRatio:"",comparisonType:"",showYAxis:!1,yAxisBounds:[null,null],bounds:[null,null],d3format:"",dateFormat:""},Rt=[{value:"value",label:"Actual value",key:"value"},{value:"diff",label:"Difference",key:"diff"},{value:"perc",label:"Percentage",key:"perc"},{value:"perc_change",label:"Percentage change",key:"perc_change"}],wt=[{value:"time",label:"Time comparison",key:"time"},{value:"contrib",label:"Contribution",key:"contrib"},{value:"spark",label:"Sparkline",key:"spark"},{value:"avg",label:"Period average",key:"avg"}],Lt=(0,b.iK)(d.X2)`
  margin-top: ${({theme:e})=>2*e.gridUnit}px;
  display: flex;
  align-items: center;
`,It=(0,b.iK)(d.JX)`
  display: flex;
  align-items: center;
`,Ot=(0,b.iK)(m.V)`
  margin-left: ${({theme:e})=>e.gridUnit}px;
  color: ${({theme:e})=>e.colors.grayscale.light1};
`,Mt=b.iK.div`
  margin-top: ${({theme:e})=>5*e.gridUnit}px;
  display: flex;
  justify-content: center;
`;class Dt extends r.Component{constructor(e){super(e),this.onSave=this.onSave.bind(this),this.onClose=this.onClose.bind(this),this.resetState=this.resetState.bind(this),this.initialState=this.initialState.bind(this),this.onPopoverVisibleChange=this.onPopoverVisibleChange.bind(this),this.state=this.initialState()}initialState(){return{label:this.props.label,tooltip:this.props.tooltip,colType:this.props.colType,width:this.props.width,height:this.props.height,timeLag:this.props.timeLag||0,timeRatio:this.props.timeRatio,comparisonType:this.props.comparisonType,showYAxis:this.props.showYAxis,yAxisBounds:this.props.yAxisBounds,bounds:this.props.bounds,d3format:this.props.d3format,dateFormat:this.props.dateFormat,popoverVisible:!1}}resetState(){const e=this.initialState();this.setState({...e})}onSave(){this.props.onChange(this.state),this.setState({popoverVisible:!1})}onClose(){this.resetState()}onSelectChange(e,t){this.setState({[e]:t})}onTextInputChange(e,t){this.setState({[e]:t.target.value})}onCheckboxChange(e,t){this.setState({[e]:t})}onBoundsChange(e){this.setState({bounds:e})}onPopoverVisibleChange(e){e?this.setState({popoverVisible:e}):this.resetState()}onYAxisBoundsChange(e){this.setState({yAxisBounds:e})}textSummary(){return`${this.props.label}`}formRow(e,t,o,a){return(0,_.tZ)(Lt,null,(0,_.tZ)(It,{xs:24,md:11},e,(0,_.tZ)(Ot,{placement:"top",tooltip:t,label:o})),(0,_.tZ)(d.JX,{xs:24,md:13},a))}renderPopover(){return(0,_.tZ)("div",{id:"ts-col-popo",style:{width:320}},this.formRow("Label","The column header label","time-lag",(0,_.tZ)(w.II,{value:this.state.label,onChange:this.onTextInputChange.bind(this,"label"),placeholder:"Label"})),this.formRow("Tooltip","Column header tooltip","col-tooltip",(0,_.tZ)(w.II,{value:this.state.tooltip,onChange:this.onTextInputChange.bind(this,"tooltip"),placeholder:"Tooltip"})),this.formRow("Type","Type of comparison, value difference or percentage","col-type",(0,_.tZ)(d.Ph,{ariaLabel:(0,h.t)("Type"),value:this.state.colType||void 0,onChange:this.onSelectChange.bind(this,"colType"),options:wt})),(0,_.tZ)("hr",null),"spark"===this.state.colType&&this.formRow("Width","Width of the sparkline","spark-width",(0,_.tZ)(w.II,{value:this.state.width,onChange:this.onTextInputChange.bind(this,"width"),placeholder:"Width"})),"spark"===this.state.colType&&this.formRow("Height","Height of the sparkline","spark-width",(0,_.tZ)(w.II,{value:this.state.height,onChange:this.onTextInputChange.bind(this,"height"),placeholder:"Height"})),["time","avg"].indexOf(this.state.colType)>=0&&this.formRow("Time lag","Number of periods to compare against","time-lag",(0,_.tZ)(w.II,{value:this.state.timeLag,onChange:this.onTextInputChange.bind(this,"timeLag"),placeholder:"Time Lag"})),["spark"].indexOf(this.state.colType)>=0&&this.formRow("Time ratio","Number of periods to ratio against","time-ratio",(0,_.tZ)(w.II,{value:this.state.timeRatio,onChange:this.onTextInputChange.bind(this,"timeRatio"),placeholder:"Time Ratio"})),"time"===this.state.colType&&this.formRow("Type","Type of comparison, value difference or percentage","comp-type",(0,_.tZ)(d.Ph,{ariaLabel:(0,h.t)("Type"),value:this.state.comparisonType||void 0,onChange:this.onSelectChange.bind(this,"comparisonType"),options:Rt})),"spark"===this.state.colType&&this.formRow("Show Y-axis","Show Y-axis on the sparkline. Will display the manually set min/max if set or min/max values in the data otherwise.","show-y-axis-bounds",(0,_.tZ)(k.Z,{value:this.state.showYAxis,onChange:this.onCheckboxChange.bind(this,"showYAxis")})),"spark"===this.state.colType&&this.formRow("Y-axis bounds","Manually set min/max values for the y-axis.","y-axis-bounds",(0,_.tZ)(N,{value:this.state.yAxisBounds,onChange:this.onYAxisBoundsChange.bind(this)})),"spark"!==this.state.colType&&this.formRow("Color bounds","Number bounds used for color encoding from red to blue.\n              Reverse the numbers for blue to red. To get pure red or blue,\n              you can enter either only min or max.","bounds",(0,_.tZ)(N,{value:this.state.bounds,onChange:this.onBoundsChange.bind(this)})),this.formRow("Number format","Optional d3 number format string","d3-format",(0,_.tZ)(w.II,{value:this.state.d3format,onChange:this.onTextInputChange.bind(this,"d3format"),placeholder:"Number format string"})),"spark"===this.state.colType&&this.formRow("Date format","Optional d3 date format string","date-format",(0,_.tZ)(w.II,{value:this.state.dateFormat,onChange:this.onTextInputChange.bind(this,"dateFormat"),placeholder:"Date format string"})),(0,_.tZ)(Mt,null,(0,_.tZ)(le.Z,{buttonSize:"small",onClick:this.onClose,cta:!0},(0,h.t)("Close")),(0,_.tZ)(le.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave,cta:!0},(0,h.t)("Save"))))}render(){return(0,_.tZ)("span",null,this.textSummary()," ",(0,_.tZ)(C.Z,{trigger:"click",content:this.renderPopover(),title:"Column Configuration",visible:this.state.popoverVisible,onVisibleChange:this.onPopoverVisibleChange},(0,_.tZ)(m.V,{icon:"edit",className:"text-primary",label:"edit-ts-column"})))}}Dt.propTypes=xt,Dt.defaultProps=At;var Nt=o(79512);const kt=["longitude","latitude","zoom","bearing","pitch"],Ft={onChange:c().func,value:c().shape({longitude:c().number,latitude:c().number,zoom:c().number,bearing:c().number,pitch:c().number}),default:c().object,name:c().string.isRequired};class Pt extends r.Component{constructor(e){super(e),this.onChange=this.onChange.bind(this)}onChange(e,t){this.props.onChange({...this.props.value,[e]:t})}renderTextControl(e){return(0,_.tZ)("div",{key:e},(0,_.tZ)(Fe.lX,null,e),(0,_.tZ)(Te.Z,{value:this.props.value[e],onChange:this.onChange.bind(this,e),isFloat:!0}))}renderPopover(){return(0,_.tZ)("div",{id:`filter-popover-${this.props.name}`},kt.map((e=>this.renderTextControl(e))))}renderLabel(){return this.props.value.longitude&&this.props.value.latitude?`${(0,Nt.decimal2sexagesimal)(this.props.value.longitude)} | ${(0,Nt.decimal2sexagesimal)(this.props.value.latitude)}`:"N/A"}render(){return(0,_.tZ)("div",null,(0,_.tZ)(L.Z,this.props),(0,_.tZ)(J.ZP,{container:document.body,trigger:"click",placement:"right",content:this.renderPopover(),title:"Viewport"},(0,_.tZ)(Ce.Z,{className:"pointer"},this.renderLabel())))}}Pt.propTypes=Ft,Pt.defaultProps={onChange:()=>{},default:{type:"fix",value:5},value:{longitude:6.85236157047845,latitude:31.222656842808707,zoom:1,bearing:0,pitch:0}};var Ut=o(11064),$t=o(14278),qt=o(74069),Vt=o(13284);const jt={description:c().string,label:c().string,name:c().string.isRequired,onChange:c().func,value:c().string.isRequired,labelType:c().string},Ht=(0,Ut.Z)();function Bt({vizType:e}){return(0,$t.gp)().loading||Ht.has(e)?null:(0,_.tZ)("div",{className:"text-danger"},(0,_.tZ)("i",{className:"fa fa-exclamation-circle text-danger"})," ",(0,_.tZ)("small",null,(0,h.t)("This visualization type is not supported.")))}const Gt=(0,b.iK)(qt.Z)`
  .ant-modal-body {
    padding: 0;
  }
`,zt=e=>{var t;const{value:o,onChange:a,isModalOpenInit:n,labelType:i}=e,{mountedPluginMetadata:s}=(0,$t.gp)(),[l,c]=(0,r.useState)(!!n),[d,u]=(0,r.useState)(0),[p,m]=(0,r.useState)(o),g=(0,r.useCallback)((()=>{c(!0)}),[]),f=(0,r.useCallback)((()=>{a(p),c(!1)}),[p,a]),v=(0,r.useCallback)((()=>{c(!1),u((e=>e+1)),m(o)}),[o]),b=o?(null==(t=s[o])?void 0:t.name)||`${o}`:(0,h.t)("Select Viz Type");return(0,_.tZ)("div",null,(0,_.tZ)(L.Z,e),(0,_.tZ)(ie.u,{id:"error-tooltip",placement:"right",title:(0,h.t)("Click to change visualization type")},(0,_.tZ)(r.Fragment,null,(0,_.tZ)(Ce.Z,{onClick:g,type:i},b),o&&(0,_.tZ)(Bt,{vizType:o}))),(0,_.tZ)(Gt,{show:l,onHide:v,title:(0,h.t)("Select a visualization type"),primaryButtonName:(0,h.t)("Select"),disablePrimaryButton:!p,onHandledPrimaryAction:f,maxWidth:`${Vt.UB}px`,responsive:!0},(0,_.tZ)(Vt.ZP,{key:d,selectedViz:p,onChange:m})))};zt.propTypes=jt,zt.defaultProps={onChange:()=>{},labelType:"default"};const Qt=zt;var Kt=o(46566);const Wt={marginTop:"5px",minHeight:"30px"},Yt={textAlign:"right"},Jt={label:c().string.isRequired,tooltip:c().string,control:c().node.isRequired,isCheckbox:c().bool};function Xt({label:e,tooltip:t,control:o,isCheckbox:a}){const n=(0,_.tZ)("span",null,e," ",t&&(0,_.tZ)(m.V,{placement:"top",label:e,tooltip:t}));return a?(0,_.tZ)(d.X2,{style:Wt,gutter:16},(0,_.tZ)(d.JX,{xs:24,md:8,style:Yt},o),(0,_.tZ)(d.JX,{xs:24,md:16},n)):(0,_.tZ)(d.X2,{style:Wt,gutter:16},(0,_.tZ)(d.JX,{xs:24,md:8,style:Yt},n),(0,_.tZ)(d.JX,{xs:24,md:16},o))}Xt.propTypes=Jt,Xt.defaultProps={tooltip:null,isCheckbox:!1};const eo=new Set(["TINYINT","SMALLINT","INT","INTEGER","BIGINT","LONG"]),to=new Set(["FLOAT","DOUBLE","REAL","NUMERIC","DECIMAL","MONEY"]),oo={datasource:c().object.isRequired,onChange:c().func,asc:c().bool,clearable:c().bool,multiple:c().bool,column:c().string,label:c().string,metric:c().string,searchAllOptions:c().bool,defaultValue:c().string},ao={width:350};class no extends r.Component{constructor(e){super(e);const{column:t,metric:o,asc:a,clearable:n,multiple:r,searchAllOptions:i,label:s,defaultValue:l}=e;this.state={column:t,metric:o,label:s,asc:a,clearable:n,multiple:r,searchAllOptions:i,defaultValue:l},this.onChange=this.onChange.bind(this),this.onControlChange=this.onControlChange.bind(this)}onChange(){this.props.onChange(this.state)}onControlChange(e,t){let o=t;const{column:a,multiple:n}=this.state;if(t&&!n&&e===qe.ft.DEFAULT_VALUE){const{datasource:e}=this.props,n=e.columns.find((e=>e.column_name===a));if(n&&n.type){const e=n.type.toUpperCase();"BOOLEAN"===e?o="true"===t:eo.has(e)?o=Number.isNaN(Number(t))?null:parseInt(t,10):to.has(e)&&(o=Number.isNaN(Number(t))?null:parseFloat(t))}}this.setState({[e]:o},this.onChange)}setType(){}textSummary(){return this.state.column||"N/A"}renderForm(){return(0,_.tZ)("div",null,(0,_.tZ)(Xt,{label:(0,h.t)("Column"),control:(0,_.tZ)(d.Ph,{ariaLabel:(0,h.t)("Column"),value:this.state.column,name:"column",options:this.props.datasource.columns.filter((e=>e.column_name!==this.state.column)).map((e=>({value:e.column_name,label:e.column_name}))).concat([{value:this.state.column,label:this.state.column}]),onChange:e=>this.onControlChange("column",e)})}),(0,_.tZ)(Xt,{label:(0,h.t)("Label"),control:(0,_.tZ)(Te.Z,{value:this.state.label,name:"label",onChange:e=>this.onControlChange("label",e)})}),(0,_.tZ)(Xt,{label:(0,h.t)("Default"),tooltip:(0,h.t)("(optional) default value for the filter, when using the multiple option, you can use a semicolon-delimited list of options."),control:(0,_.tZ)(Te.Z,{value:this.state.defaultValue,name:"defaultValue",onChange:e=>this.onControlChange(qe.ft.DEFAULT_VALUE,e)})}),(0,_.tZ)(Xt,{label:(0,h.t)("Sort metric"),tooltip:(0,h.t)("Metric to sort the results by"),control:(0,_.tZ)(d.Ph,{ariaLabel:(0,h.t)("Sort metric"),value:this.state.metric,name:"column",options:this.props.datasource.metrics.filter((e=>e.metric_name!==this.state.metric)).map((e=>({value:e.metric_name,label:e.metric_name}))).concat([{value:this.state.metric,label:this.state.metric}]),onChange:e=>this.onControlChange("metric",e)})}),(0,_.tZ)(Xt,{label:(0,h.t)("Sort ascending"),tooltip:(0,h.t)("Check for sorting ascending"),isCheckbox:!0,control:(0,_.tZ)(k.Z,{value:this.state.asc,onChange:e=>this.onControlChange("asc",e)})}),(0,_.tZ)(Xt,{label:(0,h.t)("Allow multiple selections"),isCheckbox:!0,tooltip:(0,h.t)("Multiple selections allowed, otherwise filter is limited to a single value"),control:(0,_.tZ)(k.Z,{value:this.state.multiple,onChange:e=>this.onControlChange(qe.ft.MULTIPLE,e)})}),(0,_.tZ)(Xt,{label:(0,h.t)("Search all filter options"),tooltip:(0,h.t)("By default, each filter loads at most 1000 choices at the initial page load. Check this box if you have more than 1000 filter values and want to enable dynamically searching that loads filter values as users type (may add stress to your database)."),isCheckbox:!0,control:(0,_.tZ)(k.Z,{value:this.state.searchAllOptions,onChange:e=>this.onControlChange(qe.ft.SEARCH_ALL_OPTIONS,e)})}),(0,_.tZ)(Xt,{label:(0,h.t)("Required"),tooltip:(0,h.t)("User must select a value for this filter"),isCheckbox:!0,control:(0,_.tZ)(k.Z,{value:!this.state.clearable,onChange:e=>this.onControlChange("clearable",!e)})}))}renderPopover(){return(0,_.tZ)("div",{id:"ts-col-popo",style:ao},this.renderForm())}render(){return(0,_.tZ)("span",null,this.textSummary()," ",(0,_.tZ)(C.Z,{trigger:"click",content:this.renderPopover(),title:(0,h.t)("Filter configuration")},(0,_.tZ)(m.V,{icon:"edit",className:"text-primary",label:"edit-ts-column"})))}}no.propTypes=oo,no.defaultProps={onChange:()=>{},asc:!0,clearable:!0,multiple:!0,searchAllOptions:!1};var ro,io=o(65013),so=o(24554);!function(e){e.NONE="None",e.GREATER_THAN=">",e.LESS_THAN="<",e.GREATER_OR_EQUAL="≥",e.LESS_OR_EQUAL="≤",e.EQUAL="=",e.NOT_EQUAL="≠",e.BETWEEN="< x <",e.BETWEEN_OR_EQUAL="≤ x ≤",e.BETWEEN_OR_LEFT_EQUAL="≤ x <",e.BETWEEN_OR_RIGHT_EQUAL="< x ≤"}(ro||(ro={}));const lo=[ro.BETWEEN,ro.BETWEEN_OR_EQUAL,ro.BETWEEN_OR_LEFT_EQUAL,ro.BETWEEN_OR_RIGHT_EQUAL],co=(0,b.iK)(w.Rn)`
  width: 100%;
`,uo=b.iK.div`
  display: flex;
  justify-content: flex-end;
`,ho=[{value:"rgb(0,255,0)",label:(0,h.t)("green")},{value:"rgb(255,255,0)",label:(0,h.t)("yellow")},{value:"rgb(255,0,0)",label:(0,h.t)("red")}],po=[{value:ro.NONE,label:"None"},{value:ro.GREATER_THAN,label:">"},{value:ro.LESS_THAN,label:"<"},{value:ro.GREATER_OR_EQUAL,label:"≥"},{value:ro.LESS_OR_EQUAL,label:"≤"},{value:ro.EQUAL,label:"="},{value:ro.NOT_EQUAL,label:"≠"},{value:ro.BETWEEN,label:"< x <"},{value:ro.BETWEEN_OR_EQUAL,label:"≤ x ≤"},{value:ro.BETWEEN_OR_LEFT_EQUAL,label:"≤ x <"},{value:ro.BETWEEN_OR_RIGHT_EQUAL,label:"< x ≤"}],mo=(e,t)=>o=>(a,n)=>o&&n&&!e(Number(o),Number(n))?Promise.reject(new Error(t)):Promise.resolve(),go=mo(((e,t)=>e>t),(0,h.t)("This value should be smaller than the right target value")),fo=mo(((e,t)=>e<t),(0,h.t)("This value should be greater than the left target value")),vo=e=>e&&lo.includes(e),bo=e=>!e||e===ro.NONE,_o=[{required:!0,message:(0,h.t)("Required")}],yo=[{required:!0,message:(0,h.t)("Required")},({getFieldValue:e})=>({validator:go(e("targetValueRight"))})],Co=[{required:!0,message:(0,h.t)("Required")},({getFieldValue:e})=>({validator:fo(e("targetValueLeft"))})],Eo=["targetValueRight"],To=["targetValueLeft"],So=(e,t)=>bo(e.operator)!==bo(t.operator)||vo(e.operator)!==vo(t.operator),Zo=(0,_.tZ)(Fe.xJ,{name:"operator",label:(0,h.t)("Operator"),rules:_o,initialValue:po[0].value},(0,_.tZ)(so.ZP,{ariaLabel:(0,h.t)("Operator"),options:po})),xo=({getFieldValue:e})=>bo(e("operator"))?(0,_.tZ)(d.X2,{gutter:12},(0,_.tZ)(d.JX,{span:6},Zo)):vo(e("operator"))?(0,_.tZ)(d.X2,{gutter:12},(0,_.tZ)(d.JX,{span:9},(0,_.tZ)(Fe.xJ,{name:"targetValueLeft",label:(0,h.t)("Left value"),rules:yo,dependencies:Eo,validateTrigger:"onBlur",trigger:"onBlur"},(0,_.tZ)(co,null))),(0,_.tZ)(d.JX,{span:6},Zo),(0,_.tZ)(d.JX,{span:9},(0,_.tZ)(Fe.xJ,{name:"targetValueRight",label:(0,h.t)("Right value"),rules:Co,dependencies:To,validateTrigger:"onBlur",trigger:"onBlur"},(0,_.tZ)(co,null)))):(0,_.tZ)(d.X2,{gutter:12},(0,_.tZ)(d.JX,{span:6},Zo),(0,_.tZ)(d.JX,{span:18},(0,_.tZ)(Fe.xJ,{name:"targetValue",label:(0,h.t)("Target value"),rules:_o},(0,_.tZ)(co,null)))),Ao=({config:e,onChange:t,columns:o=[]})=>{var a;return(0,_.tZ)(Fe.l0,{onFinish:t,initialValues:e,requiredMark:"optional",layout:"vertical"},(0,_.tZ)(d.X2,{gutter:12},(0,_.tZ)(d.JX,{span:12},(0,_.tZ)(Fe.xJ,{name:"column",label:(0,h.t)("Column"),rules:_o,initialValue:null==(a=o[0])?void 0:a.value},(0,_.tZ)(so.ZP,{ariaLabel:(0,h.t)("Select column"),options:o}))),(0,_.tZ)(d.JX,{span:12},(0,_.tZ)(Fe.xJ,{name:"colorScheme",label:(0,h.t)("Color scheme"),rules:_o,initialValue:ho[0].value},(0,_.tZ)(so.ZP,{ariaLabel:(0,h.t)("Color scheme"),options:ho})))),(0,_.tZ)(Fe.xJ,{noStyle:!0,shouldUpdate:So},xo),(0,_.tZ)(Fe.xJ,null,(0,_.tZ)(uo,null,(0,_.tZ)(le.Z,{htmlType:"submit",buttonStyle:"primary"},(0,h.t)("Apply")))))},Ro=({title:e,columns:t,onChange:o,config:a,children:i,...s})=>{const[l,c]=(0,r.useState)(!1),d=(0,r.useCallback)((e=>{c(!1),o(e)}),[o]);return(0,_.tZ)(J.ZP,n()({title:e,content:(0,_.tZ)(Ao,{onChange:d,config:a,columns:t}),visible:l,onVisibleChange:c,trigger:["click"],overlayStyle:{width:"450px"}},s),i)},wo=b.iK.div`
  ${({theme:e})=>_.iv`
    padding: ${e.gridUnit}px;
    border: solid 1px ${e.colors.grayscale.light2};
    border-radius: ${e.gridUnit}px;
  `}
`,Lo=(0,b.iK)(q.EQ)`
  &,
  & > div {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
    :last-child {
      margin-bottom: 0;
    }
  }
`,Io=b.iK.button`
  ${({theme:e})=>_.iv`
    color: ${e.colors.grayscale.light1};
    height: 100%;
    width: ${6*e.gridUnit}px;
    border: none;
    border-right: solid 1px ${e.colors.grayscale.dark2}0C;
    padding: 0;
    outline: none;
    border-bottom-left-radius: 3px;
    border-top-left-radius: 3px;
  `}
`,Oo=({value:e,onChange:t,columnOptions:o,verboseMap:a,...n})=>{const i=(0,b.Fg)(),[s,l]=(0,r.useState)(null!=e?e:[]);(0,r.useEffect)((()=>{t&&t(s)}),[s,t]);const c=(0,r.useCallback)((()=>{const e=s.filter((e=>o.some((t=>(null==t?void 0:t.value)===(null==e?void 0:e.column)))));e.length!==s.length&&t&&(l(e),t(e))}),[JSON.stringify(o)]);return(0,io.d)(c),(0,_.tZ)("div",null,(0,_.tZ)(L.Z,n),(0,_.tZ)(wo,null,s.map(((e,t)=>(0,_.tZ)(Lo,{key:t},(0,_.tZ)(Io,{onClick:()=>(e=>{l((t=>t.filter(((t,o)=>o!==e))))})(t)},(0,_.tZ)($.Z.XSmall,{iconColor:i.colors.grayscale.light1})),(0,_.tZ)(Ro,{title:(0,h.t)("Edit formatter"),config:e,columns:o,onChange:e=>((e,t)=>{const o=[...s];o.splice(t,1,e),l(o)})(e,t),destroyTooltipOnHide:!0},(0,_.tZ)(q.EQ,{withCaret:!0},(0,_.tZ)(q.__,null,(({column:e,operator:t,targetValue:o,targetValueLeft:n,targetValueRight:r})=>{var i;const s=null!=(i=e&&(null==a?void 0:a[e]))?i:e;switch(t){case ro.NONE:return`${s}`;case ro.BETWEEN:return`${n} ${ro.LESS_THAN} ${s} ${ro.LESS_THAN} ${r}`;case ro.BETWEEN_OR_EQUAL:return`${n} ${ro.LESS_OR_EQUAL} ${s} ${ro.LESS_OR_EQUAL} ${r}`;case ro.BETWEEN_OR_LEFT_EQUAL:return`${n} ${ro.LESS_OR_EQUAL} ${s} ${ro.LESS_THAN} ${r}`;case ro.BETWEEN_OR_RIGHT_EQUAL:return`${n} ${ro.LESS_THAN} ${s} ${ro.LESS_OR_EQUAL} ${r}`;default:return`${s} ${t} ${o}`}})(e)),(0,_.tZ)(q.Ne,null,(0,_.tZ)($.Z.CaretRight,{iconColor:i.colors.grayscale.light1}))))))),(0,_.tZ)(Ro,{title:(0,h.t)("Add new formatter"),columns:o,onChange:e=>{l((t=>[...t,e]))},destroyTooltipOnHide:!0},(0,_.tZ)(q.SW,null,(0,_.tZ)($.Z.PlusSmall,{iconColor:i.colors.grayscale.light1}),(0,h.t)("Add new color formatter")))))};var Mo=o(22068);function Do({displayGhostButton:e=!0,accept:t,...o}){const a=(0,b.Fg)(),[{isOver:n,canDrop:r},i]=(0,Mo.L)({accept:t,drop:e=>{o.onDrop(e),null==o.onDropValue||o.onDropValue(e.value)},canDrop:e=>{var t;return o.canDrop(e)&&(null==(t=null==o.canDropValue?void 0:o.canDropValue(e.value))||t)},collect:e=>({isOver:e.isOver(),canDrop:e.canDrop(),type:e.getItemType()})});return(0,_.tZ)("div",{ref:i},(0,_.tZ)(q.gM,null,(0,_.tZ)(L.Z,o)),(0,_.tZ)(q.H$,{canDrop:r,isOver:n},o.valuesRenderer(),e&&(0,_.tZ)(q.SW,{cancelHover:!o.onClickGhostButton,onClick:o.onClickGhostButton},(0,_.tZ)($.Z.PlusSmall,{iconColor:a.colors.grayscale.light1}),(0,h.t)(o.ghostButtonText||"Drop columns here"))))}var No=o(41609),ko=o.n(No),Fo=o(93185),Po=o(38575),Uo=o(27034);const $o=(0,b.iK)(m.V)`
  margin: 0 ${({theme:e})=>e.gridUnit}px;
`;function qo({children:e,index:t,clickClose:o,withCaret:a,isExtra:n,canDelete:i=!0}){const s=(0,b.Fg)(),l=(0,r.useCallback)((e=>{e.stopPropagation(),o(t)}),[o,t]);return(0,_.tZ)(q.EQ,{withCaret:a},i&&(0,_.tZ)(q.gu,{role:"button",onClick:l},(0,_.tZ)($.Z.XSmall,{iconColor:s.colors.grayscale.light1})),(0,_.tZ)(q.__,null,e),n&&(0,_.tZ)($o,{icon:"exclamation-triangle",placement:"top",bsStyle:"warning",tooltip:(0,h.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),a&&(0,_.tZ)(q.Ne,null,(0,_.tZ)($.Z.CaretRight,{iconColor:s.colors.grayscale.light1})))}const Vo=b.iK.div`
  width: 100%;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`;function jo(e){const{index:t,label:o,tooltipTitle:a,column:i,type:s,onShiftOptions:l,clickClose:c,withCaret:d,isExtra:u,canDelete:h=!0,...p}=e,m=(0,r.useRef)(null),g=(0,r.useRef)(null),[{isDragging:f},v]=(0,Uo.c)({item:{type:s,dragIndex:t},collect:e=>({isDragging:e.isDragging()})}),[,b]=(0,Mo.L)({accept:s,hover:(e,o)=>{var a;if(!m.current)return;const{dragIndex:n}=e,r=t;if(n===r)return;const i=null==(a=m.current)?void 0:a.getBoundingClientRect(),s=(i.bottom-i.top)/2,c=o.getClientOffset(),d=c?c.y-i.top:0;n<r&&d<s||n>r&&d>s||(l(n,r),e.dragIndex=r)}}),y=!f&&a&&o&&a!==o||!f&&g&&g.current&&g.current.scrollWidth>g.current.clientWidth,C=()=>y?(0,_.tZ)(ie.u,{title:a||o},(0,_.tZ)("span",null,o)):(0,_.tZ)("span",null,o),E=()=>{const e=i&&(0,Po.GA)(i)?{verbose_name:i.label,expression:i.sqlExpression}:i;return(0,_.tZ)(Ve.l,{column:e,labelRef:g,showType:!0})};return v(b(m)),(0,_.tZ)(q.a7,n()({ref:m},p),(0,_.tZ)(qo,{index:t,clickClose:c,withCaret:d,isExtra:u,canDelete:h},(0,_.tZ)((()=>o?(0,_.tZ)(Vo,{ref:g},(0,_.tZ)(C,null)):i?(0,_.tZ)(Vo,null,(0,_.tZ)(E,null)):null),null)))}var Ho=o(72813);const Bo=e=>(0,Po.xN)(e)?e.column_name:e;class Go{constructor(e,t,o){this.values=void 0,this.options=void 0,this.multi=void 0,this.options=e,this.multi=t,this.values=(0,xe.Z)(o).map((t=>t&&(0,Ho.s9)(t)&&t in e?e[t]:(0,Ho.s9)(t)?null:t)).filter(Boolean)}add(e){(0,Ho.s9)(e)&&e in this.options?this.values.push(this.options[e]):(0,Ho.s9)(e)||this.values.push(e)}del(e){this.values.splice(e,1)}replace(e,t){this.values[e]&&(this.values[e]=(0,Ho.s9)(t)?this.options[t]:t)}swap(e,t){[this.values[e],this.values[t]]=[this.values[t],this.values[e]]}has(e){return this.values.some((t=>(0,Ho.s9)(e)?t.column_name===e||t.label===e:t.column_name===e.label||t.label===e.label))}getValues(){return this.multi?this.values.map(Bo):this.values.length>0?Bo(this.values[0]):void 0}}const zo=(0,b.iK)(d.Ph)`
  .metric-option {
    & > svg {
      min-width: ${({theme:e})=>4*e.gridUnit+"px"};
    }
    & > .option-label {
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
`,Qo=({columns:e,editedColumn:t,onChange:o,onClose:a,setLabel:n,getCurrentTab:i,label:s,isTemporal:l})=>{const[c]=(0,r.useState)(s),[u,p,m]=(e=>e?(0,Po.GA)(e)?[e,void 0,void 0]:(0,Po.zy)(e)?[void 0,e,void 0]:[void 0,void 0,e]:[void 0,void 0,void 0])(t),[g,f]=(0,r.useState)(u),[v,b]=(0,r.useState)(p),[y,C]=(0,r.useState)(m),E=(0,r.useRef)(null),[T,S]=(0,r.useMemo)((()=>null==e?void 0:e.reduce(((e,t)=>(t.expression?e[0].push(t):e[1].push(t),e)),[[],[]])),[e]),Z=(0,r.useCallback)((e=>{f({label:s,sqlExpression:e}),C(void 0),b(void 0)}),[s]),x=(0,r.useCallback)((e=>{const t=T.find((t=>t.column_name===e));b(t),C(void 0),f(void 0),n((null==t?void 0:t.verbose_name)||(null==t?void 0:t.column_name)||"")}),[T,n]),A=(0,r.useCallback)((e=>{const t=S.find((t=>t.column_name===e));b(void 0),C(t),f(void 0),n((null==t?void 0:t.verbose_name)||(null==t?void 0:t.column_name)||"")}),[n,S]),R=u?"sqlExpression":m||0===T.length?"simple":"saved";(0,r.useEffect)((()=>{i(R)}),[R,i]);const w=(0,r.useCallback)((()=>{g&&g.label!==s&&(g.label=s);const e=g||v||y;e&&(o(e),a())}),[g,s,o,a,v,y]),L=(0,r.useCallback)((()=>{b(p),C(m),f(u),a()}),[u,p,m,a]),I=(0,r.useCallback)((e=>{var t;i(e),null==(t=E.current)||t.editor.focus()}),[i]),O=(0,r.useCallback)((()=>{var e;null==(e=E.current)||e.editor.resize()}),[]),M=g||v||y,D=c!==s||(null==v?void 0:v.column_name)!==(null==p?void 0:p.column_name)||(null==y?void 0:y.column_name)!==(null==m?void 0:m.column_name)||(null==g?void 0:g.sqlExpression)!==(null==u?void 0:u.sqlExpression),N=(0,h.t)("Saved expressions"),k=(0,h.t)("Column");return(0,_.tZ)(Fe.l0,{layout:"vertical",id:"metrics-edit-popover"},(0,_.tZ)(Ne.ZP,{id:"adhoc-metric-edit-tabs",defaultActiveKey:R,onChange:I,className:"adhoc-metric-edit-tabs",allowOverflow:!0,css:_.iv`
          height: ${qe.H7}px;
          width: ${qe.vK}px;
        `},(0,_.tZ)(Ne.ZP.TabPane,{key:"saved",tab:(0,h.t)("Saved")},T.length>0?(0,_.tZ)(Fe.xJ,{label:N},(0,_.tZ)(zo,{ariaLabel:N,value:null==v?void 0:v.column_name,onChange:x,allowClear:!0,autoFocus:!v,placeholder:(0,h.t)("%s column(s)",T.length),options:T.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,customLabel:(0,_.tZ)(Ve.l,{column:e,showType:!0}),key:e.column_name})))})):(0,_.tZ)(ke.Tc,{image:"empty.svg",title:l?(0,h.t)("No temporal columns found"):(0,h.t)("No saved expressions found"),description:l?(0,h.t)('Add calculated temporal columns to dataset in "Edit datasource" modal'):(0,h.t)('Add calculated columns to dataset in "Edit datasource" modal')})),(0,_.tZ)(Ne.ZP.TabPane,{key:"simple",tab:(0,h.t)("Simple")},l&&0===S.length?(0,_.tZ)(ke.Tc,{image:"empty.svg",title:(0,h.t)("No temporal columns found"),description:(0,h.t)('Mark a column as temporal in "Edit datasource" modal')}):(0,_.tZ)(Fe.xJ,{label:k},(0,_.tZ)(d.Ph,{ariaLabel:k,value:null==y?void 0:y.column_name,onChange:A,allowClear:!0,autoFocus:!y,placeholder:(0,h.t)("%s column(s)",S.length),options:S.map((e=>({value:e.column_name,label:e.verbose_name||e.column_name,customLabel:(0,_.tZ)(Ve.l,{column:e,showType:!0}),key:e.column_name})))}))),(0,_.tZ)(Ne.ZP.TabPane,{key:"sqlExpression",tab:(0,h.t)("Custom SQL")},(0,_.tZ)(Pe.iO,{value:(null==g?void 0:g.sqlExpression)||(null==y?void 0:y.column_name)||(null==v?void 0:v.expression),onFocus:O,showLoadingForImport:!0,onChange:Z,width:"100%",height:qe.H7-80+"px",showGutter:!1,editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0,ref:E}))),(0,_.tZ)("div",null,(0,_.tZ)(le.Z,{buttonSize:"small",onClick:L,cta:!0},(0,h.t)("Close")),(0,_.tZ)(le.Z,{disabled:!M,buttonStyle:D&&M?"primary":"default",buttonSize:"small",onClick:w,cta:!0},(0,h.t)("Save"))))},Ko=({title:e,onChange:t,isEditDisabled:o,hasCustomLabel:a})=>{const[n,i]=(0,r.useState)(!1),[s,l]=(0,r.useState)(!1),c=(0,r.useCallback)((()=>{i(!0)}),[]),d=(0,r.useCallback)((()=>{i(!1)}),[]),u=(0,r.useCallback)((()=>{l(!0)}),[]),p=(0,r.useCallback)((()=>{l(!1)}),[]),m=(0,r.useCallback)((e=>{""===e.target.value&&t(e),p()}),[p,t]),g=(0,h.t)("My column");return o?(0,_.tZ)("span",null,e||g):s?(0,_.tZ)(w.II,{className:"metric-edit-popover-label-input",type:"text",placeholder:e,value:a?e:"",autoFocus:!0,onChange:t,onBlur:m}):(0,_.tZ)(ie.u,{placement:"top",title:(0,h.t)("Click to edit label")},(0,_.tZ)("span",{className:"AdhocMetricEditPopoverTitle inline-editable",onMouseOver:c,onMouseOut:d,onClick:u,onBlur:p,role:"button",tabIndex:0},e||g," ",(0,_.tZ)("i",{className:"fa fa-pencil",style:{color:n?"black":"grey"}})))},Wo=(0,h.t)("My column"),Yo=({columns:e,editedColumn:t,onColumnEdit:o,isControlledComponent:a,children:n,isTemporal:i,...s})=>{const[l,c]=(0,r.useState)(Wo),[d,u]=(0,r.useState)(!1),[h,p]=(0,r.useState)(!0),[m,g]=(0,r.useState)(!1);let f=Wo;t&&(0,Po.xN)(t)?f=t.verbose_name||t.column_name:t&&(0,Po.GA)(t)&&(f=t.label||Wo),(0,r.useEffect)((()=>{c(f)}),[f,d]);const v=(0,r.useCallback)((e=>{u(e)}),[]),b=(0,r.useCallback)((()=>{u(!1)}),[]),{visible:y,handleTogglePopover:E,handleClosePopover:T}=a?{visible:s.visible,handleTogglePopover:s.togglePopover,handleClosePopover:s.closePopover}:{visible:d,handleTogglePopover:v,handleClosePopover:b},S=(0,r.useCallback)((e=>{p("sqlExpression"!==e)}),[]),Z=(0,r.useMemo)((()=>(0,_.tZ)(De.b,null,(0,_.tZ)(Qo,{editedColumn:t,columns:e,onClose:T,onChange:o,label:l,setLabel:c,getCurrentTab:S,isTemporal:i}))),[e,t,S,T,i,o,l]),x=(0,r.useCallback)((e=>{c(e.target.value),g(!0)}),[]),A=(0,r.useMemo)((()=>(0,_.tZ)(Ko,{title:l,onChange:x,isEditDisabled:h,hasCustomLabel:m})),[m,h,x,l]);return(0,_.tZ)(C.Z,{trigger:"click",content:Z,defaultVisible:y,visible:y,onVisibleChange:E,title:A,destroyTooltipOnHide:!0},n)};var Jo=o(68492),Xo=o(94968),ea=o(28543);const ta=[we.g.Column,we.g.Metric,we.g.MetricOption,we.g.AdhocMetricOption],oa=e=>!(e instanceof ea.ZP)&&(null==e?void 0:e.expressionType);var aa=o(88889);const na={},ra=[we.g.Column,we.g.Metric],ia=e=>e&&!(e instanceof Le.Z)&&e.expressionType,sa=e=>e?Array.isArray(e)?e.map((e=>ia(e)?new Le.Z(e):e)):ia(e)?[new Le.Z(e)]:[e]:[],la=(e,t,o)=>{var a;return null!=(a=null==e?void 0:e.filter((e=>{var a;return Array.isArray(t)?!t.includes(null!=(a=e.metric_name)?a:"")||e.metric_name===o:e})))?a:[]},ca={AnnotationLayerControl:x,BoundsControl:N,CheckboxControl:k.Z,CollectionControl:K,ColorPickerControl:oe,ColorSchemeControl:ae.Z,DatasourceControl:_e,DateFilterControl:ye.Z,DndColumnSelectControl:Do,DndColumnSelect:function(e){const{value:t,options:o,multi:a=!0,onChange:i,canDelete:s=!0,ghostButtonText:l,name:c,label:d,isTemporal:u}=e,[p,m]=(0,r.useState)(!1),g=(0,r.useMemo)((()=>new Go(o,a,t)),[a,o,t]),f=(0,r.useCallback)((()=>{const e=g.getValues();typeof t!=typeof e&&i(e),"string"==typeof t&&"string"==typeof e&&t!==e&&i(e),Array.isArray(e)&&Array.isArray(t)&&(e.length!==t.length||e.every(((e,o)=>e===t[o])))&&i(e)}),[JSON.stringify(t),JSON.stringify(g.getValues())]);(0,io.d)(f);const v=(0,r.useCallback)((e=>{const t=e.value;g.multi||ko()(g.values)?g.add(t.column_name):g.replace(0,t.column_name),i(g.getValues())}),[i,g]),b=(0,r.useCallback)((e=>{const t=e.value.column_name;return t in g.options&&!g.has(t)}),[g]),y=(0,r.useCallback)((e=>{g.del(e),i(g.getValues())}),[i,g]),C=(0,r.useCallback)(((e,t)=>{g.swap(e,t),i(g.getValues())}),[i,g]),E=(0,r.useMemo)((()=>Object.values(o)),[o]),T=(0,r.useCallback)((()=>g.values.map(((e,t)=>(0,Fo.c)(Fo.T.ENABLE_DND_WITH_CLICK_UX)?(0,_.tZ)(Yo,{key:t,columns:E,onColumnEdit:e=>{(0,Po.xN)(e)?g.replace(t,e.column_name):g.replace(t,e),i(g.getValues())},editedColumn:e,isTemporal:u},(0,_.tZ)(jo,{key:t,index:t,clickClose:y,onShiftOptions:C,type:`${we.g.ColumnOption}_${c}_${d}`,canDelete:s,column:e,withCaret:!0})):(0,_.tZ)(jo,{key:t,index:t,clickClose:y,onShiftOptions:C,type:`${we.g.ColumnOption}_${c}_${d}`,canDelete:s,column:e})))),[s,d,c,i,y,C,g,E]),S=(0,r.useCallback)((e=>{(0,Po.xN)(e)?g.add(e.column_name):g.add(e),i(g.getValues())}),[i,g]),Z=(0,r.useCallback)((e=>{m(e)}),[]),x=(0,r.useCallback)((()=>{Z(!1)}),[Z]),A=(0,r.useCallback)((()=>{Z(!0)}),[Z]),R=(0,Fo.c)(Fo.T.ENABLE_DND_WITH_CLICK_UX)?(0,h.tn)("Drop a column here or click","Drop columns here or click",a?2:1):(0,h.tn)("Drop column here","Drop columns here",a?2:1);return(0,_.tZ)("div",null,(0,_.tZ)(Do,n()({onDrop:v,canDrop:b,valuesRenderer:T,accept:we.g.Column,displayGhostButton:a||0===g.values.length,ghostButtonText:l||R,onClickGhostButton:(0,Fo.c)(Fo.T.ENABLE_DND_WITH_CLICK_UX)?A:void 0},e)),(0,_.tZ)(Yo,{columns:E,onColumnEdit:S,isControlledComponent:!0,togglePopover:Z,closePopover:x,visible:p,isTemporal:u},(0,_.tZ)("div",null)))},DndFilterSelect:e=>{var t;const{datasource:o,onChange:a=(()=>{}),name:i}=e,s=Array.from(null!=(t=e.value)?t:[]),[l,c]=(0,r.useState)(s.map((e=>oa(e)?new ea.ZP(e):e))),[d,u]=(0,r.useState)(void 0),[p,m]=(0,r.useState)(!1),[g,f]=(0,r.useState)({}),v=(e,t)=>[...e,...[...(null==t?void 0:t.metrics)||[],null==t?void 0:t.metric].map((e=>e&&("string"==typeof e?{saved_metric_name:e}:new Le.Z(e))))].filter((e=>e)).reduce(((e,t)=>("saved_metric_name"in t&&t.saved_metric_name?e.push({...t,filterOptionName:t.saved_metric_name}):"column_name"in t&&t.column_name?e.push({...t,filterOptionName:`_col_${t.column_name}`}):t instanceof Le.Z&&e.push({...t,filterOptionName:`_adhocmetric_${t.label}`}),e)),[]).sort(((e,t)=>{var o,a;return null!=(o=null==(a=e.saved_metric_name||e.column_name||e.label)?void 0:a.localeCompare(t.saved_metric_name||t.column_name||t.label||""))?o:0})),[b,y]=(0,r.useState)(v(e.columns,e.formData));(0,r.useEffect)((()=>{if(o&&"table"===o.type){var e;const t=null==(e=o.database)?void 0:e.id,{datasource_name:a,schema:n,is_sqllab_view:r}=o;!r&&t&&a&&n&&gt.Z.get({endpoint:`/superset/extra_table_metadata/${t}/${a}/${n}/`}).then((({json:e})=>{if(e&&e.partitions){const{partitions:t}=e;t&&t.cols&&1===Object.keys(t.cols).length&&u(t.cols[0])}})).catch((e=>{Jo.Z.error("fetch extra_table_metadata:",e.statusText)}))}}),[o]),(0,r.useEffect)((()=>{y(v(e.columns,e.formData))}),[e.columns,e.formData]),(0,r.useEffect)((()=>{c((e.value||[]).map((e=>oa(e)?new ea.ZP(e):e)))}),[e.value]);const C=(0,r.useCallback)((e=>{const t=[...l];t.splice(e,1),c(t),a(t)}),[a,l]),E=(0,r.useCallback)(((e,t)=>{const o=[...l];[o[t],o[e]]=[o[e],o[t]],c(o)}),[l]),T=(0,r.useCallback)((t=>{var o;return null==(o=e.savedMetrics.find((e=>e.metric_name===t)))?void 0:o.expression}),[e.savedMetrics]),S=(0,r.useCallback)((e=>{if(e instanceof ea.ZP)return e;const t=e;return t.saved_metric_name?new ea.ZP({expressionType:"druid"===o.type?ea.vq.SIMPLE:ea.vq.SQL,subject:"druid"===o.type?t.saved_metric_name:T(t.saved_metric_name),operator:qe.LT[qe.d.GREATER_THAN].operation,operatorId:qe.d.GREATER_THAN,comparator:0,clause:ea.Pr.HAVING}):t.label?new ea.ZP({expressionType:"druid"===o.type?ea.vq.SIMPLE:ea.vq.SQL,subject:"druid"===o.type?t.label:new Le.Z(e).translateToSql(),operator:qe.LT[qe.d.GREATER_THAN].operation,operatorId:qe.d.GREATER_THAN,comparator:0,clause:ea.Pr.HAVING}):t.column_name?new ea.ZP({expressionType:ea.vq.SIMPLE,subject:t.column_name,operator:qe.LT[qe.d.EQUALS].operation,operatorId:qe.d.EQUALS,comparator:"",clause:ea.Pr.WHERE,isNew:!0}):null}),[o.type,T]),Z=(0,r.useCallback)((e=>{a(l.map((t=>t.filterOptionName===e.filterOptionName?e:t)))}),[a,l]),x=(0,r.useCallback)((e=>{const t=S(e);if(t){const e=[...l,t];c(e),a(e)}}),[S,a,l]),A=(0,r.useCallback)((e=>{m(e)}),[]),R=(0,r.useCallback)((()=>{A(!1)}),[A]),w=(0,r.useCallback)((()=>l.map(((e,t)=>{const a=e.getDefaultLabel(),n=e.getTooltipTitle();return(0,_.tZ)(Xo.Z,{key:t,adhocFilter:e,options:b,datasource:o,onFilterEdit:Z,partitionColumn:d},(0,_.tZ)(jo,{key:t,index:t,label:a,tooltipTitle:n,clickClose:C,onShiftOptions:E,type:we.g.FilterOption,withCaret:!0,isExtra:e.isExtra}))}))),[C,Z,E,b,d,o,l]),L=(0,r.useCallback)((()=>{f({}),A(!0)}),[A]),I=(0,r.useMemo)((()=>{if(null==(e=g)?void 0:e.metric_name)return new ea.ZP({expressionType:ea.vq.SQL,clause:ea.Pr.HAVING,sqlExpression:null==g?void 0:g.expression});var e;if(g instanceof Le.Z)return new ea.ZP({expressionType:ea.vq.SQL,clause:ea.Pr.HAVING,sqlExpression:null==g?void 0:g.translateToSql()});const t={subject:null==g?void 0:g.column_name};return t.subject&&(0,Fo.c)(Fo.T.UX_BETA)&&(t.operator=qe.LT[qe.d.IN].operation,t.operatorId=qe.d.IN),new ea.ZP(t)}),[g]),O=(0,r.useCallback)((()=>!0),[]),M=(0,r.useCallback)((e=>{f(e.value),A(!0)}),[i,A]),D=(0,Fo.c)(Fo.T.ENABLE_DND_WITH_CLICK_UX)?(0,h.t)("Drop columns/metrics here or click"):(0,h.t)("Drop columns or metrics here");return(0,_.tZ)(r.Fragment,null,(0,_.tZ)(Do,n()({onDrop:M,canDrop:O,valuesRenderer:w,accept:ta,ghostButtonText:D,onClickGhostButton:(0,Fo.c)(Fo.T.ENABLE_DND_WITH_CLICK_UX)?L:void 0},e)),(0,_.tZ)(Xo.Z,{adhocFilter:I,options:b,datasource:o,onFilterEdit:x,partitionColumn:d,isControlledComponent:!0,visible:p,togglePopover:A,closePopover:R},(0,_.tZ)("div",null)))},DndMetricSelect:e=>{const{onChange:t,multi:o,columns:a,savedMetrics:i}=e,s=(0,r.useCallback)((e=>{if(null===e)return void t(null);const a=(0,xe.Z)(e).map((e=>e.metric_name?e.metric_name:e)).filter((e=>e));t(o?a:a[0])}),[o,t]),[l,c]=(0,r.useState)(sa(e.value)),[d,u]=(0,r.useState)({}),[p,m]=(0,r.useState)(!1),g=(0,Ae.D)(a),f=(0,Ae.D)(i);(0,r.useEffect)((()=>{c(sa(e.value))}),[JSON.stringify(e.value)]),(0,r.useEffect)((()=>{if(!e.value)return;const t=(0,xe.Z)(e.value),o=((e,t,o,a,n)=>{const r=!n||Ze()(n,o),i=!a||Ze()(a,t);return i&&r?e:e.reduce(((e,a)=>{if("string"==typeof a||a.metric_name)return(r||null!=o&&o.some((e=>e.metric_name===a||e.metric_name===a.metric_name)))&&e.push(a),e;if(i)e.push(a);else{const o=null==t?void 0:t.find((e=>{var t;return(null==(t=a.column)?void 0:t.column_name)===e.column_name}));o&&e.push({...a,column:o})}return e}),[])})(t,a,i,g,f);Ze()(t,o)||s(o)}),[a,i,s]);const v=(0,r.useCallback)((e=>!("metric"===e.type&&l.includes(e.value.metric_name))),[l]),b=(0,r.useCallback)((t=>{const o=e.multi?[...l,t]:[t];c(o),s(o)}),[s,e.multi,l]),y=(0,r.useCallback)(((e,t)=>{if(t instanceof Le.Z&&t.equals(e))return;const o=l.map((o=>("metric_name"in t&&o===t.metric_name||void 0!==o.optionName)&&o.optionName===t.optionName?e:o));c(o),s(o)}),[s,l]),C=(0,r.useCallback)((e=>{if(!Array.isArray(l))return;const o=[...l];o.splice(e,1),c(o),t(o)}),[t,l]),E=(0,r.useCallback)(((e,t)=>{const o=[...l];[o[t],o[e]]=[o[e],o[t]],c(o)}),[l]),T=(0,r.useMemo)((()=>la(e.savedMetrics,e.value)),[e.savedMetrics,e.value]),S=(0,r.useCallback)((t=>{var o;return la(e.savedMetrics,e.value,null==(o=e.value)?void 0:o[t])}),[e.savedMetrics,e.value]),Z=(0,r.useCallback)((()=>t(o?l:l[0])),[o,t,l]),x=(0,r.useCallback)(((t,a)=>(0,_.tZ)(et,{key:a,index:a,option:t,onMetricEdit:y,onRemoveMetric:C,columns:e.columns,savedMetrics:e.savedMetrics,savedMetricsOptions:S(a),datasource:e.datasource,onMoveLabel:E,onDropLabel:Z,type:`${we.g.AdhocMetricOption}_${e.name}_${e.label}`,multi:o})),[S,Z,E,o,y,C,e.columns,e.datasource,e.label,e.name,e.savedMetrics]),A=(0,r.useCallback)((()=>l.map(((e,t)=>x(e,t)))),[l,x]),R=(0,r.useCallback)((e=>{m(e)}),[]),w=(0,r.useCallback)((()=>{R(!1)}),[R]),L=(0,r.useCallback)((e=>{e.type===we.g.Metric&&b(e.value),e.type===we.g.Column&&(u(e),R(!0))}),[b,R]),I=(0,r.useCallback)((()=>{u({}),R(!0)}),[R]),O=(0,r.useMemo)((()=>{if((null==(e=d)?void 0:e.value)&&(null==e?void 0:e.type)&&d.type===we.g.Column){const e=d.value,t={column:e};return(0,Fo.c)(Fo.T.UX_BETA)&&(e.type_generic===aa.Z.NUMERIC?t.aggregate=qe.YY.SUM:e.type_generic!==aa.Z.STRING&&e.type_generic!==aa.Z.BOOLEAN&&e.type_generic!==aa.Z.TEMPORAL||(t.aggregate=qe.YY.COUNT_DISTINCT)),new Le.Z(t)}var e;return new Le.Z({isNew:!0})}),[d]),M=(0,Fo.c)(Fo.T.ENABLE_DND_WITH_CLICK_UX)?(0,h.tn)("Drop a column/metric here or click","Drop columns/metrics here or click",o?2:1):(0,h.tn)("Drop column or metric here","Drop columns or metrics here",o?2:1);return(0,_.tZ)("div",{className:"metrics-select"},(0,_.tZ)(Do,n()({onDrop:L,canDrop:v,valuesRenderer:A,accept:ra,ghostButtonText:M,displayGhostButton:o||0===l.length,onClickGhostButton:(0,Fo.c)(Fo.T.ENABLE_DND_WITH_CLICK_UX)?I:void 0},e)),(0,_.tZ)(Ke,{adhocMetric:O,onMetricEdit:b,columns:e.columns,savedMetricsOptions:T,savedMetric:na,datasource:e.datasource,isControlledComponent:!0,visible:p,togglePopover:R,closePopover:w},(0,_.tZ)("div",null)))},FixedOrMetricControl:mt,HiddenControl:function(e){return(0,_.tZ)(w.II,{type:"hidden",value:e.value})},SelectAsyncControl:_t,SelectControl:yt.Z,SliderControl:function({default:e,name:t,label:o,description:a,renderTrigger:i,rightNode:s,leftNode:l,validationErrors:c,hovered:d,warning:u,danger:h,onClick:p,tooltipOnClick:m,onChange:g=(()=>{}),...f}){const v={name:t,label:o,description:a,renderTrigger:i,rightNode:s,leftNode:l,validationErrors:c,onClick:p,hovered:d,tooltipOnClick:m,warning:u,danger:h};return(0,_.tZ)(r.Fragment,null,(0,_.tZ)(L.Z,v),(0,_.tZ)(Tt,n()({},f,{onChange:g,defaultValue:e})))},SpatialControl:St.Z,TextAreaControl:Zt.Z,TextControl:Te.Z,TimeSeriesColumnControl:Dt,ViewportControl:Pt,VizTypeControl:Qt,MetricsControl:lt,AdhocFilterControl:Kt.Z,FilterBoxItemControl:no,ConditionalFormattingControl:Oo,...s.Z},da=ca;function ua(e){const{actions:{setControlValue:t},name:o,type:a,hidden:s}=e,[l,c]=(0,r.useState)(!1),d=(0,r.useCallback)(((e,a)=>t(o,e,a)),[o,t]);if(!a)return null;const u="string"==typeof a?da[a]:a;return u?(0,_.tZ)("div",{className:"Control",style:s?{display:"none"}:void 0,onMouseEnter:()=>c(!0),onMouseLeave:()=>c(!1)},(0,_.tZ)(i.Z,null,(0,_.tZ)(u,n()({onChange:d,hovered:l},e)))):(console.warn(`Unknown controlType: ${a}`),null)}},61357:(e,t,o)=>{o.d(t,{Z:()=>n}),o(67294);var a=o(11965);function n({controls:e}){const t=12/e.filter((e=>!["ColorMapControl"].includes(null==e?void 0:e.props.type))).length;return(0,a.tZ)("div",{className:"row"},e.map(((e,o)=>(0,a.tZ)("div",{className:`col-lg-${t} col-xs-12`,style:{display:"HiddenControl"===(null==e?void 0:e.props.type)?"none":"block"},key:o},e))))}},42753:(e,t,o)=>{var a;o.d(t,{g:()=>a}),function(e){e.Column="column",e.ColumnOption="columnOption",e.AdhocColumnOption="adhocColumn",e.Metric="metric",e.MetricOption="metricOption",e.AdhocMetricOption="adhocMetric",e.FilterOption="filterOption"}(a||(a={}))},63325:(e,t,o)=>{o.d(t,{b:()=>a});const a=o(51995).iK.div`
  .edit-popover-resize {
    transform: scaleX(-1);
    float: right;
    margin-top: ${({theme:e})=>4*e.gridUnit}px;
    margin-right: ${({theme:e})=>-2*e.gridUnit}px;
    cursor: nwse-resize;
  }
  .filter-sql-editor {
    border: ${({theme:e})=>e.colors.grayscale.light2} solid thin;
  }
`},94968:(e,t,o)=>{o.d(t,{Z:()=>U});var a=o(67294),n=o(5872),r=o.n(n),i=o(45697),s=o.n(i),l=o(35932),c=o(58593),d=o(51995),u=o(61988),h=o(57902),p=o(40637),m=o(17536),g=o(28543),f=o(4715),v=o(31069),b=o(69856),_=o(40266),y=o(9875),C=o(54076),E=o(11965);const T=(0,d.iK)(y.II)`
  margin-bottom: ${({theme:e})=>4*e.gridUnit}px;
`,S=(0,d.iK)(f.Ph)`
  .ant-select-selector::after {
    content: ${({labelText:e})=>e||"\\A0"};
    display: inline-block;
    white-space: nowrap;
    color: ${({theme:e})=>e.colors.grayscale.light1};
    width: max-content;
  }
`,Z=e=>{var t,o;const{onSubjectChange:n,onOperatorChange:i,isOperatorRelevant:s,onComparatorChange:l}=(e=>{const t=(t,o)=>{var a;const n=null==(a=e.datasource.columns)?void 0:a.find((e=>e.column_name===o)),r=!!n&&("BOOL"===n.type||"BOOLEAN"===n.type),i=!!n&&("INT"===n.type||"INTEGER"===n.type),s=!!n&&!!n.expression;if(t&&b.qB.has(t)){const{partitionColumn:t}=e;return t&&o&&o===t}return t===b.d.IS_TRUE||t===b.d.IS_FALSE?r||i||s:r?t===b.d.IS_NULL||t===b.d.IS_NOT_NULL:!("druid"===e.datasource.type&&b.QB.indexOf(t)>=0||"table"===e.datasource.type&&b.fV.indexOf(t)>=0||e.adhocFilter.clause===g.Pr.HAVING&&-1===b.Ak.indexOf(t))};return{onSubjectChange:o=>{const a=e.options.find((e=>"column_name"in e&&e.column_name===o||"optionName"in e&&e.optionName===o));let n,r="";a&&"column_name"in a?(r=a.column_name,n=g.Pr.WHERE):a&&"saved_metric_name"in a?(r=a.saved_metric_name,n=g.Pr.HAVING):a&&a.label&&(r=a.label,n=g.Pr.HAVING);const{operator:i,operatorId:s}=e.adhocFilter;e.onChange(e.adhocFilter.duplicateWith({subject:r,clause:n,operator:i&&s&&t(s,r)?b.LT[s].operation:null,expressionType:g.vq.SIMPLE,operatorId:s}))},onOperatorChange:t=>{const o=e.adhocFilter.comparator;let a;a=b.qK.has(t)?Array.isArray(o)?o:[o].filter((e=>e)):Array.isArray(o)?o[0]:o,t!==b.d.IS_TRUE&&t!==b.d.IS_FALSE||(a=b.d.IS_TRUE===t),t&&b.qB.has(t)?e.onChange(e.adhocFilter.duplicateWith({subject:e.adhocFilter.subject,clause:g.Pr.WHERE,operatorId:t,operator:b.LT[t].operation,expressionType:g.vq.SQL,datasource:e.datasource})):e.onChange(e.adhocFilter.duplicateWith({operatorId:t,operator:b.LT[t].operation,comparator:a,expressionType:g.vq.SIMPLE}))},onComparatorChange:t=>{e.onChange(e.adhocFilter.duplicateWith({comparator:t,expressionType:g.vq.SIMPLE}))},isOperatorRelevant:t}})(e),[c,d]=(0,a.useState)([]),[h,p]=(0,a.useState)(e.adhocFilter.comparator),[m,y]=(0,a.useState)(!1),Z=()=>{const e=(()=>{var e;const t=Array.isArray(h)?h.filter((e=>c.includes(e))).length:0;return null!=(e=(null==c?void 0:c.length)-t)?e:0})(),t=(0,u.t)("%s option(s)",e);return e?t:""};let x=e.options;const{subject:A,operator:R,operatorId:w}=e.adhocFilter,L={ariaLabel:(0,u.t)("Select subject"),value:null!=A?A:void 0,onChange:e=>{p(void 0),n(e)},notFoundContent:(0,u.t)("No such column found. To filter on a metric, try the Custom SQL tab."),autoFocus:!A,placeholder:""};"druid"===e.datasource.type?L.placeholder=(0,u.t)("%s column(s) and metric(s)",x.length):(L.placeholder=e.adhocFilter.clause===g.Pr.WHERE?(0,u.t)("%s column(s)",x.length):(0,u.t)("To filter on a metric, use Custom SQL tab."),x=e.options.filter((e=>"column_name"in e&&e.column_name)));const I={placeholder:(0,u.t)("%s operator(s)",(null!=(t=e.operators)?t:b.GS).filter((e=>s(e,A))).length),value:w,onChange:i,autoFocus:!!L.value&&!R,ariaLabel:(0,u.t)("Select operator")},O=!!L.value&&!!I.value,M={allowClear:!0,allowNewOptions:!0,ariaLabel:(0,u.t)("Comparator option"),mode:b.qK.has(w)?"multiple":"single",loading:m,value:h,onChange:l,notFoundContent:(0,u.t)("Type a value here"),disabled:b.yi.includes(w),placeholder:Z(),autoFocus:O},D=h&&h.length>0&&Z();return(0,a.useEffect)((()=>{(()=>{const{datasource:t}=e,o=e.adhocFilter.subject,a=e.adhocFilter.clause===g.Pr.HAVING;if(o&&t&&t.filter_select&&!a){const e=new AbortController,{signal:a}=e;m&&e.abort(),y(!0),v.Z.get({signal:a,endpoint:`/superset/filter/${t.type}/${t.id}/${o}/`}).then((({json:e})=>{d(e.map((e=>({value:e,label:(0,C.lo)(e)})))),y(!1)})).catch((()=>{d([]),y(!1)}))}})()}),[e.adhocFilter.subject]),(0,a.useEffect)((()=>{p(e.adhocFilter.comparator)}),[e.adhocFilter.comparator]),(0,E.tZ)(a.Fragment,null,(0,E.tZ)(f.Ph,r()({css:e=>({marginTop:4*e.gridUnit,marginBottom:4*e.gridUnit}),options:x.map((e=>{return{value:"column_name"in e&&e.column_name||"optionName"in e&&e.optionName||"",label:"saved_metric_name"in e&&e.saved_metric_name||"column_name"in e&&e.column_name||"label"in e&&e.label,key:"id"in e&&e.id||"optionName"in e&&e.optionName||void 0,customLabel:(t=e,(0,E.tZ)(_.Z,{option:t}))};var t}))},L)),(0,E.tZ)(f.Ph,r()({css:e=>({marginBottom:4*e.gridUnit}),options:(null!=(o=e.operators)?o:b.GS).filter((e=>s(e,A))).map(((e,t)=>({value:e,label:b.LT[e].display,key:e,order:t})))},I)),b.qK.has(w)||c.length>0?(0,E.tZ)(S,r()({labelText:D,options:c},M)):(0,E.tZ)(T,{name:"filter-value",ref:e=>{e&&O&&e.focus()},onChange:e=>{const{value:t}=e.target;p(t),l(t)},value:h,placeholder:(0,u.t)("Filter value (case sensitive)"),disabled:b.yi.includes(w)}))};var x=o(94670),A=o(33313),R=o(72201);const w={adhocFilter:s().instanceOf(g.ZP).isRequired,onChange:s().func.isRequired,options:s().arrayOf(s().oneOfType([R.Z,s().shape({saved_metric_name:s().string.isRequired}),m.Z])).isRequired,height:s().number.isRequired,activeKey:s().string.isRequired},L=(0,d.iK)(f.Ph)`
  ${({theme:e})=>`\n    width: ${30*e.gridUnit}px;\n    marginRight: ${e.gridUnit}px;\n  `}
`;class I extends a.Component{constructor(e){super(e),this.onSqlExpressionChange=this.onSqlExpressionChange.bind(this),this.onSqlExpressionClauseChange=this.onSqlExpressionClauseChange.bind(this),this.handleAceEditorRef=this.handleAceEditorRef.bind(this),this.selectProps={ariaLabel:(0,u.t)("Select column")}}componentDidUpdate(){this.aceEditorRef&&this.aceEditorRef.editor.resize()}onSqlExpressionClauseChange(e){this.props.onChange(this.props.adhocFilter.duplicateWith({clause:e,expressionType:g.vq.SQL}))}onSqlExpressionChange(e){this.props.onChange(this.props.adhocFilter.duplicateWith({sqlExpression:e,expressionType:g.vq.SQL}))}handleAceEditorRef(e){e&&(this.aceEditorRef=e)}render(){const{adhocFilter:e,height:t,options:o}=this.props,a={placeholder:(0,u.t)("choose WHERE or HAVING..."),value:e.clause,onChange:this.onSqlExpressionClauseChange},n=A.Z.concat(o.map((e=>e.column_name?{name:e.column_name,value:e.column_name,score:50,meta:"option"}:null)).filter(Boolean)),i=Object.keys(g.Pr).map((e=>({label:e,value:e})));return(0,E.tZ)("span",null,(0,E.tZ)("div",{className:"filter-edit-clause-section"},(0,E.tZ)(L,r()({options:i},this.selectProps,a)),(0,E.tZ)("span",{className:"filter-edit-clause-info"},(0,E.tZ)("strong",null,"WHERE")," ",(0,u.t)("Filters by columns"),(0,E.tZ)("br",null),(0,E.tZ)("strong",null,"HAVING")," ",(0,u.t)("Filters by metrics"))),(0,E.tZ)("div",{css:e=>({marginTop:4*e.gridUnit})},(0,E.tZ)(x.iO,{ref:this.handleAceEditorRef,keywords:n,height:t-130+"px",onChange:this.onSqlExpressionChange,width:"100%",showGutter:!1,value:e.sqlExpression||e.translateToSql(),editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,className:"filter-sql-editor",wrapEnabled:!0})))}}I.propTypes=w;const O={adhocFilter:s().instanceOf(g.ZP).isRequired,onChange:s().func.isRequired,onClose:s().func.isRequired,onResize:s().func.isRequired,options:s().arrayOf(s().oneOfType([R.Z,s().shape({saved_metric_name:s().string.isRequired}),m.Z])).isRequired,datasource:s().object,partitionColumn:s().string,theme:s().object,sections:s().arrayOf(s().string),operators:s().arrayOf(s().string)},M=d.iK.i`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,D=d.iK.div`
  .adhoc-filter-edit-tabs > .nav-tabs {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;

    & > li > a {
      padding: ${({theme:e})=>e.gridUnit}px;
    }
  }

  #filter-edit-popover {
    max-width: none;
  }

  .filter-edit-clause-info {
    font-size: ${({theme:e})=>e.typography.sizes.xs}px;
    padding-left: ${({theme:e})=>e.gridUnit}px;
  }

  .filter-edit-clause-section {
    display: inline-flex;
  }

  .adhoc-filter-simple-column-dropdown {
    margin-top: ${({theme:e})=>5*e.gridUnit}px;
  }
`;class N extends a.Component{constructor(e){var t,o;super(e),this.onSave=this.onSave.bind(this),this.onDragDown=this.onDragDown.bind(this),this.onMouseMove=this.onMouseMove.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.onAdhocFilterChange=this.onAdhocFilterChange.bind(this),this.adjustHeight=this.adjustHeight.bind(this),this.onTabChange=this.onTabChange.bind(this),this.state={adhocFilter:this.props.adhocFilter,width:b.kc,height:b.H7,activeKey:(null==(t=this.props)||null==(o=t.adhocFilter)?void 0:o.expressionType)||"SIMPLE"},this.popoverContentRef=a.createRef()}componentDidMount(){document.addEventListener("mouseup",this.onMouseUp)}componentWillUnmount(){document.removeEventListener("mouseup",this.onMouseUp),document.removeEventListener("mousemove",this.onMouseMove)}onAdhocFilterChange(e){this.setState({adhocFilter:e})}onSave(){this.props.onChange(this.state.adhocFilter),this.props.onClose()}onDragDown(e){this.dragStartX=e.clientX,this.dragStartY=e.clientY,this.dragStartWidth=this.state.width,this.dragStartHeight=this.state.height,document.addEventListener("mousemove",this.onMouseMove)}onMouseMove(e){this.props.onResize(),this.setState({width:Math.max(this.dragStartWidth+(e.clientX-this.dragStartX),b.kc),height:Math.max(this.dragStartHeight+2*(e.clientY-this.dragStartY),b.H7)})}onMouseUp(){document.removeEventListener("mousemove",this.onMouseMove)}onTabChange(e){this.setState({activeKey:e})}adjustHeight(e){this.setState((t=>({height:t.height+e})))}render(){const{adhocFilter:e,options:t,onChange:o,onClose:a,onResize:n,datasource:i,partitionColumn:s,theme:d,operators:m,...f}=this.props,{adhocFilter:v}=this.state,b=v.isValid(),_=!v.equals(e);return(0,E.tZ)(D,r()({id:"filter-edit-popover"},f,{ref:this.popoverContentRef}),(0,E.tZ)(p.ZP,{id:"adhoc-filter-edit-tabs",defaultActiveKey:v.expressionType,className:"adhoc-filter-edit-tabs",style:{minHeight:this.state.height,width:this.state.width},allowOverflow:!0,onChange:this.onTabChange},(0,E.tZ)(p.ZP.TabPane,{className:"adhoc-filter-edit-tab",key:g.vq.SIMPLE,tab:(0,u.t)("Simple")},(0,E.tZ)(h.Z,null,(0,E.tZ)(Z,{operators:m,adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:t,datasource:i,onHeightChange:this.adjustHeight,partitionColumn:s,popoverRef:this.popoverContentRef.current}))),(0,E.tZ)(p.ZP.TabPane,{className:"adhoc-filter-edit-tab",key:g.vq.SQL,tab:"druid"===(null==i?void 0:i.type)?(0,E.tZ)(c.u,{title:(0,u.t)("Custom SQL ad-hoc filters are not available for the native Druid connector")},(0,u.t)("Custom SQL")):(0,u.t)("Custom SQL"),disabled:"druid"===(null==i?void 0:i.type)},(0,E.tZ)(h.Z,null,(0,E.tZ)(I,{adhocFilter:this.state.adhocFilter,onChange:this.onAdhocFilterChange,options:this.props.options,height:this.state.height,activeKey:this.state.activeKey})))),(0,E.tZ)("div",null,(0,E.tZ)(l.Z,{buttonSize:"small",onClick:this.props.onClose,cta:!0},(0,u.t)("Close")),(0,E.tZ)(l.Z,{disabled:!b,buttonStyle:_&&b?"primary":"default",buttonSize:"small",className:"m-r-5",onClick:this.onSave,cta:!0},(0,u.t)("Save")),(0,E.tZ)(M,{role:"button","aria-label":"Resize",tabIndex:0,onMouseDown:this.onDragDown,className:"fa fa-expand edit-popover-resize text-muted"})))}}N.propTypes=O;var k=o(63325),F=o(27845);class P extends a.PureComponent{constructor(e){super(e),this.onPopoverResize=this.onPopoverResize.bind(this),this.closePopover=this.closePopover.bind(this),this.togglePopover=this.togglePopover.bind(this),this.state={popoverVisible:!1}}onPopoverResize(){this.forceUpdate()}closePopover(){this.togglePopover(!1)}togglePopover(e){this.setState({popoverVisible:e})}render(){const{adhocFilter:e,isControlledComponent:t}=this.props,{visible:o,togglePopover:a,closePopover:n}=t?{visible:this.props.visible,togglePopover:this.props.togglePopover,closePopover:this.props.closePopover}:{visible:this.state.popoverVisible,togglePopover:this.togglePopover,closePopover:this.closePopover},r=(0,E.tZ)(k.b,null,(0,E.tZ)(N,{adhocFilter:e,options:this.props.options,datasource:this.props.datasource,partitionColumn:this.props.partitionColumn,onResize:this.onPopoverResize,onClose:n,sections:this.props.sections,operators:this.props.operators,onChange:this.props.onFilterEdit}));return(0,E.tZ)(F.Z,{trigger:"click",content:r,defaultVisible:o,visible:o,onVisibleChange:a,destroyTooltipOnHide:!0},this.props.children)}}const U=P},33334:(e,t,o)=>{o.d(t,{a7:()=>g,EQ:()=>f,__:()=>v,Ne:()=>_,gu:()=>y,gM:()=>E,yj:()=>T,H$:()=>S,SW:()=>Z,IG:()=>x,yz:()=>A});var a=o(5872),n=o.n(a),r=o(67294),i=o(22068),s=o(27034),l=o(51995),c=o(61988),d=o(9882),u=o(58593),h=o(70163),p=o(99963),m=o(11965);const g=l.iK.div`
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
  :last-child {
    margin-bottom: 0;
  }
`,f=l.iK.div`
  display: flex;
  align-items: center;
  width: 100%;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  height: ${({theme:e})=>6*e.gridUnit}px;
  background-color: ${({theme:e})=>e.colors.grayscale.light3};
  border-radius: 3px;
  cursor: ${({withCaret:e})=>e?"pointer":"default"};
`,v=l.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    align-items: center;\n    white-space: nowrap;\n    padding-left: ${e.gridUnit}px;\n    svg {\n      margin-right: ${e.gridUnit}px;\n      margin-left: ${e.gridUnit}px;\n    }\n    .type-label {\n      margin-right: ${2*e.gridUnit}px;\n      margin-left: ${e.gridUnit}px;\n      font-weight: ${e.typography.weights.normal};\n      width: auto;\n    }\n    .option-label {\n      display: inline;\n    }\n  `}
`,b=l.iK.span`
  overflow: hidden;
  text-overflow: ellipsis;
`,_=l.iK.div`
  height: 100%;
  border-left: solid 1px ${({theme:e})=>e.colors.grayscale.dark2}0C;
  margin-left: auto;
`,y=l.iK.div`
  height: 100%;
  width: ${({theme:e})=>6*e.gridUnit}px;
  border-right: solid 1px ${({theme:e})=>e.colors.grayscale.dark2}0C;
  cursor: pointer;
`,C=(0,l.iK)(d.V)`
  margin: 0 ${({theme:e})=>e.gridUnit}px;
`,E=l.iK.div`
  display: flex;
  align-items: center;
  justify-content: space-between;
`,T=l.iK.div`
  padding: ${({theme:e})=>e.gridUnit}px;
  border: solid 1px ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: ${({theme:e})=>e.gridUnit}px;
`,S=l.iK.div`
  padding: ${({theme:e})=>e.gridUnit}px;
  border: ${({canDrop:e,isOver:t,theme:o})=>e?`dashed 1px ${o.colors.info.dark1}`:t&&!e?`dashed 1px ${o.colors.error.dark1}`:`solid 1px ${o.colors.grayscale.light2}`};
  border-radius: ${({theme:e})=>e.gridUnit}px;
`,Z=l.iK.div`
  display: flex;
  align-items: center;
  width: 100%;
  height: ${({theme:e})=>6*e.gridUnit}px;
  padding-left: ${({theme:e})=>e.gridUnit}px;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.light1};
  border: dashed 1px ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: ${({theme:e})=>e.gridUnit}px;
  cursor: ${({cancelHover:e})=>e?"inherit":"pointer"};

  :hover {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colors.grayscale.light4};
  }

  :active {
    background-color: ${({cancelHover:e,theme:t})=>e?"inherit":t.colors.grayscale.light3};
  }
`,x=l.iK.button`
  display: flex;
  align-items: center;
  justify-content: center;
  height: ${({theme:e})=>4*e.gridUnit}px;
  width: ${({theme:e})=>4*e.gridUnit}px;
  padding: 0;
  background-color: ${({theme:e})=>e.colors.primary.dark1};
  border: none;
  border-radius: 2px;

  :disabled {
    cursor: not-allowed;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,A=({label:e,savedMetric:t,adhocMetric:o,onRemove:a,onMoveLabel:d,onDropLabel:E,withCaret:T,isFunction:S,type:Z,index:x,isExtra:A,tooltipTitle:R,multi:w=!0,...L})=>{const I=(0,l.Fg)(),O=(0,r.useRef)(null),M=(0,r.useRef)(null),D=null==t?void 0:t.metric_name,[,N]=(0,i.L)({accept:Z,drop(){w&&(null==E||E())},hover(e,t){var o;if(!w)return;if(!O.current)return;const a=e.index,n=x;if(a===n)return;const r=null==(o=O.current)?void 0:o.getBoundingClientRect(),i=(r.bottom-r.top)/2,s=t.getClientOffset(),l=null!=s&&s.y?(null==s?void 0:s.y)-r.top:0;a<n&&l<i||a>n&&l>i||(null==d||d(a,n),e.index=n)}}),[{isDragging:k},F]=(0,s.c)({item:{type:Z,index:x,value:null!=t&&t.metric_name?t:o},collect:e=>({isDragging:e.isDragging()})});return F(N(O)),(0,m.tZ)(g,{ref:O},(0,m.tZ)(f,n()({withCaret:T},L),(0,m.tZ)(y,{role:"button",onClick:a},(0,m.tZ)(h.Z.XSmall,{iconColor:I.colors.grayscale.light1})),(0,m.tZ)(v,null,S&&(0,m.tZ)(h.Z.FunctionX,{viewBox:"0 0 16 11",iconSize:"l"}),(()=>{const o=!k&&"string"==typeof e&&R&&e&&R!==e||!k&&M&&M.current&&M.current.scrollWidth>M.current.clientWidth;return t&&D?(0,m.tZ)(p.B,{metric:t,labelRef:M}):o?(0,m.tZ)(u.u,{title:R||e},(0,m.tZ)(b,{ref:M},e)):(0,m.tZ)(b,{ref:M},e)})()),A&&(0,m.tZ)(C,{icon:"exclamation-triangle",placement:"top",bsStyle:"warning",tooltip:(0,c.t)("\n                This filter was inherited from the dashboard's context.\n                It won't be saved when saving the chart.\n              ")}),T&&(0,m.tZ)(_,null,(0,m.tZ)(h.Z.CaretRight,{iconColor:I.colors.grayscale.light1}))))}},79684:(e,t,o)=>{o.d(t,{Z:()=>p});var a=o(67294),n=o(99298),r=o(75294),i=o(23279),s=o.n(i),l=o(27600),c=o(82342),d=o(9875),u=o(11965);const h=e=>null==e?"":String(e);class p extends a.Component{constructor(e){super(e),this.initialValue=void 0,this.onChange=e=>{var t,o;let a=e;const i=[];if(""!==e&&this.props.isFloat){const t=(0,n.Z)(e);t?i.push(t):a=e.match(/.*([.0])$/g)?e:parseFloat(e)}if(""!==e&&this.props.isInt){const t=(0,r.Z)(e);t?i.push(t):a=parseInt(e,10)}null==(t=(o=this.props).onChange)||t.call(o,a,i)},this.debouncedOnChange=s()((e=>{this.onChange(e)}),l.oP),this.onChangeWrapper=e=>{const{value:t}=e.target;this.setState({value:t},(()=>{this.debouncedOnChange(t)}))},this.initialValue=e.value,this.state={value:h(this.initialValue)}}render(){let{value:e}=this.state;return this.initialValue!==this.props.value&&(this.initialValue=this.props.value,e=h(this.props.value)),(0,u.tZ)("div",null,(0,u.tZ)(c.Z,this.props),(0,u.tZ)(d.II,{type:"text",placeholder:this.props.placeholder,onChange:this.onChangeWrapper,onFocus:this.props.onFocus,value:e,disabled:this.props.disabled,"aria-label":this.props.label}))}}},99963:(e,t,o)=>{o.d(t,{B:()=>l,l:()=>c}),o(67294);var a=o(51995),n=o(51384),r=o(65634),i=o(11965);const s=a.iK.div`
  width: 100%;
  > span {
    display: flex;
    align-items: center;
  }

  .option-label {
    display: inline-block;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    & ~ i {
      margin-left: ${({theme:e})=>e.gridUnit}px;
    }
  }
  .type-label {
    margin-right: ${({theme:e})=>3*e.gridUnit}px;
    width: ${({theme:e})=>7*e.gridUnit}px;
    display: inline-block;
    text-align: center;
    font-weight: ${({theme:e})=>e.typography.weights.bold};
  }
`,l=e=>(0,i.tZ)(s,null,(0,i.tZ)(n.m,e)),c=e=>(0,i.tZ)(s,null,(0,i.tZ)(r.E,e))},36967:(e,t,o)=>{o.d(t,{RO:()=>C,mi:()=>T,Bx:()=>_,vP:()=>E,YY:()=>w,Hu:()=>S,Bq:()=>v});var a={};o.r(a),o.d(a,{NVD3TimeSeries:()=>g,annotations:()=>m,colorScheme:()=>h,datasourceAndVizType:()=>u,druidTimeSeries:()=>d,sqlaTimeSeries:()=>p});var n=o(30845),r=o(37687),i=o(89368),s=(o(67294),o(61988)),l=o(16737),c=o(11965);const d={label:(0,s.t)("Time"),expanded:!0,description:(0,s.t)("Time related form attributes"),controlSetRows:[["time_range"]]},u={label:(0,s.t)("Chart type"),expanded:!0,controlSetRows:[["datasource"],["viz_type"],[{name:"slice_id",config:{type:"HiddenControl",label:(0,s.t)("Chart ID"),hidden:!0,description:(0,s.t)("The id of the active chart")}},{name:"cache_timeout",config:{type:"HiddenControl",label:(0,s.t)("Cache Timeout (seconds)"),hidden:!0,description:(0,s.t)("The number of seconds before expiring the cache")}},{name:"url_params",config:{type:"HiddenControl",label:(0,s.t)("URL parameters"),hidden:!0,description:(0,s.t)("Extra parameters for use in jinja templated queries")}},{name:"time_range_endpoints",config:{type:"HiddenControl",label:(0,s.t)("Time range endpoints"),hidden:!0,description:(0,s.t)("Time range endpoints (SIP-15)")}}]]},h={label:(0,s.t)("Color scheme"),controlSetRows:[["color_scheme"]]},p={label:(0,s.t)("Time"),description:(0,s.t)("Time related form attributes"),expanded:!0,controlSetRows:[["granularity_sqla"],["time_range"]]},m={label:(0,s.t)("Annotations and layers"),tabOverride:"data",expanded:!0,controlSetRows:[[{name:"annotation_layers",config:{type:"AnnotationLayerControl",label:"",default:[],description:"Annotation layers",renderTrigger:!0,tabOverride:"data"}}]]},g=[{label:(0,s.t)("Query"),expanded:!0,controlSetRows:[["metrics"],["adhoc_filters"],["groupby"],["limit","timeseries_limit_metric"],["order_desc"],[{name:"contribution",config:{type:"CheckboxControl",label:(0,s.t)("Contribution"),default:!1,description:(0,s.t)("Compute the contribution to the total")}}],["row_limit",null]]},{label:(0,s.t)("Advanced analytics"),tabOverride:"data",description:(0,s.t)("This section contains options that allow for advanced analytical post processing of query results"),controlSetRows:[[(0,c.tZ)("h1",{className:"section-header"},(0,s.t)("Rolling window"))],[{name:"rolling_type",config:{type:"SelectControl",label:(0,s.t)("Rolling function"),default:"None",choices:(0,l.mG)(["None","mean","sum","std","cumsum"]),description:(0,s.t)("Defines a rolling window function to apply, works along with the [Periods] text box")}},{name:"rolling_periods",config:{type:"TextControl",label:(0,s.t)("Periods"),isInt:!0,description:(0,s.t)("Defines the size of the rolling window function, relative to the time granularity selected")}},{name:"min_periods",config:{type:"TextControl",label:(0,s.t)("Min periods"),isInt:!0,description:(0,s.t)('The minimum number of rolling periods required to show a value. For instance if you do a cumulative sum on 7 days you may want your "Min Period" to be 7, so that all data points shown are the total of 7 periods. This will hide the "ramp up" taking place over the first 7 periods')}}],[(0,c.tZ)("h1",{className:"section-header"},(0,s.t)("Time comparison"))],[{name:"time_compare",config:{type:"SelectControl",multi:!0,freeForm:!0,label:(0,s.t)("Time shift"),choices:(0,l.mG)(["1 day","1 week","28 days","30 days","52 weeks","1 year","104 weeks","2 years","156 weeks","3 years"]),description:(0,s.t)("Overlay one or more timeseries from a relative time period. Expects relative time deltas in natural language (example:  24 hours, 7 days, 52 weeks, 365 days). Free text is supported.")}},{name:"comparison_type",config:{type:"SelectControl",label:(0,s.t)("Calculation type"),default:"values",choices:[["values","Actual values"],["absolute","Difference"],["percentage","Percentage change"],["ratio","Ratio"]],description:(0,s.t)("How to display time shifts: as individual lines; as the difference between the main time series and each time shift; as the percentage change; or as the ratio between series and time shifts.")}}],[(0,c.tZ)("h1",{className:"section-header"},(0,s.t)("Python functions"))],[(0,c.tZ)("h2",{className:"section-header"},"pandas.resample")],[{name:"resample_rule",config:{type:"SelectControl",freeForm:!0,label:(0,s.t)("Rule"),default:null,choices:(0,l.mG)(["1T","1H","1D","7D","1M","1AS"]),description:(0,s.t)("Pandas resample rule")}},{name:"resample_method",config:{type:"SelectControl",freeForm:!0,label:(0,s.t)("Method"),default:null,choices:(0,l.mG)(["asfreq","bfill","ffill","median","mean","sum"]),description:(0,s.t)("Pandas resample method")}}]]}],f=(0,n.Z)(((e,t)=>{const{sectionOverrides:o={},controlOverrides:n,controlPanelSections:r=[]}=t,s={...a};Object.entries(o).forEach((([e,t])=>{"object"==typeof t&&t.constructor===Object?s[e]={...s[e],...t}:s[e]=t}));const{datasourceAndVizType:l}=s,c="table"===e?["granularity","druid_time_origin"]:["granularity_sqla","time_grain_sqla"];return[l].concat(r).filter((e=>!!e)).map((e=>{const{controlSetRows:t}=e;return{...e,controlSetRows:(null==t?void 0:t.map((e=>e.filter((e=>"string"!=typeof e||!c.includes(e))).map((e=>(0,i.q)(e,n))))))||[]}}))}));function v(e,t){const o=(0,r.Z)().get(e)||{};return f(t,o)}const b=(0,n.Z)(((e,t)=>{const{controlOverrides:o={},controlPanelSections:a=[]}=t,n=(0,i.q)(function(e,t){var o;return null!=(o=e.map((e=>e.controlSetRows)).flat(2).find((e=>t===e||null!==e&&"object"==typeof e&&"name"in e&&e.name===t)))?o:null}(a,e),o);return n&&"config"in n?n.config:n})),_=function(e,t){const o=(0,r.Z)().get(t)||{};return b(e,o)};var y=o(55786);function C(e,t){const{mapStateToProps:o}=e;let a={...e},{value:n}=a;return o&&t&&(a={...e,...o.call(e,t,e)},n=n||a.value),"function"==typeof a.default&&(a.default=a.default(a,t),"function"==typeof a.default&&delete a.default),a.default&&void 0===n&&(n=a.default),n&&a.multi&&!Array.isArray(n)&&(n=[n]),a.value=n,function(e,t){const o=e.validators,{externalValidationErrors:a=[]}=e,n=[];o&&o.length>0&&o.forEach((o=>{const a=o.call(e,e.value,t);a&&n.push(a)}));const r=[...n,...a];return{...e,validationErrors:r}}(function(e){if("SelectControl"===e.type&&!e.freeForm&&e.choices&&e.value){const t={...e},o=e.choices,a=(0,y.Z)(e.value),n=o.map((e=>e[0]));if(e.multi&&a.length>0)return t.value=a.filter((e=>n.includes(e))),t;if(!e.multi&&!n.includes(a[0]))return t.value=null,t}return e}(a),a)}function E(e,t,o){if(!e)return null;const a={...e,value:o};return t&&t.controls||null===t?C(a,t):a}function T(e,t,o,a){const n={};return v(e,t).forEach((e=>e.controlSetRows.forEach((e=>e.forEach((e=>{if(e&&e.config&&e.name){const{config:t,name:r}=e;n[r]=E(t,o,a[r])}})))))),n}function S(e){const t={viz_type:"table",datasource:""};return Object.keys(e).forEach((o=>{const a=e[o];t[o]=a.value})),t}var Z=o(20620),x=o(62446),A=o(46306);const R=(e,t,o)=>t.options&&"string"==typeof o&&(Array.isArray(t.options)&&t.options.some((e=>e[0]===o))||o in t.options)?e.columns.some((e=>e.column_name===o)):t.savedMetrics&&(0,Z.AG)(o)&&t.savedMetrics.some((e=>e.metric_name===o))?e.metrics.some((e=>e.metric_name===o)):!(!t.columns||!(0,x.n)(o)&&!(0,A.Ki)(o)||!t.columns.some((e=>{var t;return e.column_name===(null==(t=o.column)?void 0:t.column_name)||e.column_name===o.subject})))&&e.columns.some((e=>{var t;return e.column_name===(null==(t=o.column)?void 0:t.column_name)||e.column_name===o.subject})),w=(e,t,o)=>{if(null!=o){if(Array.isArray(o)){const a=o.filter((o=>R(e,t,o)));return a.length>0?a:t.default}return R(e,t,o)?o:t.default}}},42190:(e,t,o)=>{o.d(t,{ni:()=>a,l6:()=>s,s_:()=>c});var a,n=o(22102),r=o(67294);!function(e){e.LOADING="loading",e.COMPLETE="complete",e.ERROR="error"}(a||(a={}));const i={status:a.LOADING,result:null,error:null};function s(e,t){return(0,r.useMemo)((()=>{if(e.status!==a.COMPLETE)return e;try{return{...e,result:t(e.result)}}catch(e){return{status:a.ERROR,result:null,error:e}}}),[e,t])}const l=e=>e.result;function c(e){return s(function(e){const[t,o]=(0,r.useState)(i),s=(0,r.useRef)((()=>{}));return(0,r.useEffect)((()=>{o(i),s.current();let t=!1;return s.current=()=>{t=!0},(0,n.Z)({method:"GET",endpoint:e})({}).then((e=>{t||o({status:a.COMPLETE,result:e,error:null})})).catch((e=>{t||o({status:a.ERROR,result:null,error:e})})),()=>{t=!0}}),[e]),t}(e),l)}},65013:(e,t,o)=>{o.d(t,{d:()=>n});var a=o(67294);const n=e=>{const t=(0,a.useRef)(!1);(0,a.useEffect)((()=>{t.current?e():t.current=!0}),[e])}},60812:(e,t,o)=>{o.d(t,{D:()=>n});var a=o(67294);function n(e,t){const o=(0,a.useRef)(t);return(0,a.useEffect)((()=>{o.current=e}),[e]),o.current}},3741:(e,t,o)=>{o.d(t,{W9:()=>a,aD:()=>n,Ev:()=>r,Wl:()=>i,$b:()=>s,Iq:()=>l,TD:()=>c,Ep:()=>d,vH:()=>u,H3:()=>h,S:()=>p,oK:()=>m,PC:()=>g,Qg:()=>f,tB:()=>v,TY:()=>b,Yd:()=>_});const a="load_chart",n="render_chart",r="hide_browser_tab",i="mount_dashboard",s="mount_explorer",l="select_dashboard_tab",c="force_refresh_chart",d="change_explore_controls",u="toggle_edit_dashboard",h="force_refresh_dashboard",p="periodic_render_dashboard",m="explore_dashboard_chart",g="export_csv_dashboard_chart",f="change_dashboard_filter",v="omnibar_triggered",b=new Set([a,n,r]),_=(new Set([i,l,m,c,g,f,d,u,h,p,v,s]),{timeOriginOffset:0,markTimeOrigin(){this.timeOriginOffset=window.performance.now()},getTimestamp(){return Math.round(window.performance.now()-this.timeOriginOffset)}})},97381:(e,t,o)=>{o.r(t),o.d(t,{LOG_EVENT:()=>a,logEvent:()=>n});const a="LOG_EVENT";function n(e,t){return o=>o({type:a,payload:{eventName:e,eventData:t}})}},77997:(e,t,o)=>{o.d(t,{YJ:()=>_});var a=o(68492),n=o(55786),r=o(22102),i=o(31069),s=o(91877),l=o(93185),c=o(98286);const d="polling",u="last_async_event_id";let h,p,m,g,f,v,b;const _=async e=>new Promise(((t,o)=>{const r=e.job_id;var i;i=async e=>{switch(e.status){case"done":{let{data:a,status:r}=await C(e);a=(0,n.Z)(a),"success"===r?t(a):o(a);break}case"error":{const t=(0,c.M)(e);o(t);break}default:a.Z.warn("received event with status",e.status)}var i;f[i=r]&&delete f[i]},f[r]=i})),y=(0,r.Z)({method:"GET",endpoint:"/api/v1/async_event/"}),C=async e=>{let t,o="success";try{const{json:o}=await i.Z.get({endpoint:String(e.result_url)});t="result"in o?o.result:o}catch(e){o="error",t=await(0,c.O)(e)}return{status:o,data:t}},E=async()=>{const e=b?{last_id:b}:{};if(Object.keys(f).length)try{const{result:t}=await y(e);t&&t.length&&await T(t)}catch(e){a.Z.warn(e)}p===d&&(g=window.setTimeout(E,m))},T=async e=>{e.forEach((e=>{const t=e.job_id,o=f[t];o?(o(e),delete v[t]):(v[t]||(v[t]=0),v[t]+=1,v[t]<=6?setTimeout((()=>{T([e])}),100*v[t]):(delete v[t],a.Z.warn("listener not found for job_id",e.job_id))),(e=>{b=e.id;try{localStorage.setItem(u,b)}catch(e){a.Z.warn("Error saving event Id to localStorage",e)}})(e)}))};let S,Z,x=0;const A=()=>{let e=h.GLOBAL_ASYNC_QUERIES_WEBSOCKET_URL;b&&(e+=`?last_id=${b}`),Z=new WebSocket(e),Z.addEventListener("open",(e=>{a.Z.log("WebSocket connected"),clearTimeout(S),x=0})),Z.addEventListener("close",(e=>{S=setTimeout((()=>{x+=1,x<=6?A():(a.Z.warn("WebSocket not available, falling back to async polling"),E())}),2500)})),Z.addEventListener("error",(e=>{Z.readyState<2&&Z.close()})),Z.addEventListener("message",(async e=>{let t=[];try{t=[JSON.parse(e.data)],await T(t)}catch(e){a.Z.warn(e)}}))};(e=>{if((0,s.cr)(l.T.GLOBAL_ASYNC_QUERIES)){g&&clearTimeout(g),f={},v={},b=null;{const e=document.getElementById("app");if(e){var t;const o=JSON.parse((null==e?void 0:e.getAttribute("data-bootstrap"))||"{}");h=null==o||null==(t=o.common)?void 0:t.conf}else h={},a.Z.warn("asyncEvent: app config data not found")}p=h.GLOBAL_ASYNC_QUERIES_TRANSPORT||d,m=h.GLOBAL_ASYNC_QUERIES_POLLING_DELAY||500;try{b=localStorage.getItem(u)}catch(e){a.Z.warn("Failed to fetch last event Id from localStorage")}p===d&&E(),"ws"===p&&A()}})()},5558:(e,t,o)=>{o.d(t,{A:()=>r});var a=o(68630),n=o.n(a);function r(e){return function(e){return n()(e)&&"username"in e}(e)&&"permissions"in e&&"roles"in e}},8911:(e,t,o)=>{o.d(t,{Z:()=>a});const a=(()=>{let e;try{e=o(Object(function(){var e=new Error("Cannot find module '../../../superset_text'");throw e.code="MODULE_NOT_FOUND",e}()))}catch(t){e={}}return e})()},23525:(e,t,o)=>{o.d(t,{eY:()=>h,YE:()=>b,Nm:()=>_});var a=o(41609),n=o.n(a),r=o(31069),i=o(15926),s=o.n(i),l=o(98286),c=o(27600),d=o(43399),u=o(11370);function h({name:e,type:t}){const o=new URLSearchParams(window.location.search).get(e);switch(t){case"number":return o?"true"===o?1:"false"===o?0:Number.isNaN(Number(o))?null:Number(o):null;case"object":return o?JSON.parse(o):null;case"boolean":return o?"false"!==o&&"0"!==o:null;case"rison":if(!o)return null;try{return s().decode(o)}catch{return o}default:return o}}function p(e){const t=new URLSearchParams;return new URLSearchParams(window.location.search).forEach(((o,a)=>{e.includes(a)||t.append(a,o)})),t}function m(e){const t=[];return e.forEach(((e,o)=>t.push([o,e]))),t}function g(e){const t=e||c.$O,o=p(t),a=(0,d.De)();return n()(a)||t.includes(c.KD.preselectFilters.name)||o.append(c.KD.preselectFilters.name,JSON.stringify((0,u.Z)((0,d.De)()))),m(o)}function f(){const e=p(c.Rv),t=(0,d.De)();return n()(t)||e.append(c.KD.preselectFilters.name,JSON.stringify((0,u.Z)((0,d.De)()))),m(e)}function v(e,t){return r.Z.post({endpoint:e,jsonPayload:t}).then((e=>e.json.url)).catch((e=>(0,l.O)(e).then((({error:e,statusText:t})=>Promise.reject(e||t)))))}function b(e,t){return v("/api/v1/explore/permalink",{formData:e,urlParams:g(t)})}function _({dashboardId:e,filterState:t,hash:o}){return v(`/api/v1/dashboard/${e}/permalink`,{filterState:t,urlParams:f(),hash:o})}},52389:(e,t,o)=>{o.d(t,{IV:()=>n,dY:()=>r,iX:()=>i,mI:()=>s});var a=o(61988);const n=25,r=[{id:"changed_on_delta_humanized",desc:!0}],i=(0,a.t)('The passwords for the databases below are needed in order to import them together with the datasets. Please note that the "Secure Extra" and "Certificate" sections of the database configuration are not present in export files, and should be added manually after the import if they are needed.'),s=(0,a.t)("You are importing one or more datasets that already exist. Overwriting might cause you to lose some of your work. Are you sure you want to overwrite?")},34858:(e,t,o)=>{o.d(t,{Yi:()=>m,LE:()=>g,PW:()=>f,NE:()=>_,fF:()=>y,bR:()=>C,rM:()=>E,jb:()=>T,z:()=>S,xx:()=>Z,cb:()=>x,h1:()=>A});var a=o(15926),n=o.n(a),r=o(67294),i=o(31069),s=o(61988),l=o(22102),c=o(40768),d=o(10222),u=o(98286),h=o(8911);const p=e=>"string"==typeof e?e:Object.entries(e).map((([e,t])=>Array.isArray(t)?`(${e}) ${t.join(", ")}`:`(${e}) ${t}`)).join("\n");function m(e,t,o,a=!0,l=[],d,u=!0){const[h,p]=(0,r.useState)({count:0,collection:l,loading:u,lastFetchDataConfig:null,permissions:[],bulkSelectEnabled:!1});function m(e){p((t=>({...t,...e})))}(0,r.useEffect)((()=>{a&&i.Z.get({endpoint:`/api/v1/${e}/_info?q=${n().encode({keys:["permissions"]})}`}).then((({json:e={}})=>{m({permissions:e.permissions})}),(0,c.v$)((e=>o((0,s.t)("An error occurred while fetching %s info: %s",t,e)))))}),[]);const g=(0,r.useCallback)((({pageIndex:a,pageSize:r,sortBy:l,filters:u})=>{m({lastFetchDataConfig:{filters:u,pageIndex:a,pageSize:r,sortBy:l},loading:!0});const h=(d||[]).concat(u).map((({id:e,operator:t,value:o})=>({col:e,opr:t,value:o&&"object"==typeof o&&"value"in o?o.value:o}))),p=n().encode_uri({order_column:l[0].id,order_direction:l[0].desc?"desc":"asc",page:a,page_size:r,...h.length?{filters:h}:{}});return i.Z.get({endpoint:`/api/v1/${e}/?q=${p}`}).then((({json:e={}})=>{m({collection:e.result,count:e.count,lastFetched:(new Date).toISOString()})}),(0,c.v$)((e=>o((0,s.t)("An error occurred while fetching %ss: %s",t,e))))).finally((()=>{m({loading:!1})}))}),[d]);return{state:{loading:h.loading,resourceCount:h.count,resourceCollection:h.collection,bulkSelectEnabled:h.bulkSelectEnabled,lastFetched:h.lastFetched},setResourceCollection:e=>m({collection:e}),hasPerm:function(e){return!!h.permissions.length&&Boolean(h.permissions.find((t=>t===e)))},fetchData:g,toggleBulkSelect:function(){m({bulkSelectEnabled:!h.bulkSelectEnabled})},refreshData:e=>h.lastFetchDataConfig?g(h.lastFetchDataConfig):e?g(e):null}}function g(e,t,o){const[a,n]=(0,r.useState)({loading:!1,resource:null,error:null});function l(e){n((t=>({...t,...e})))}return{state:a,setResource:e=>l({resource:e}),fetchResource:(0,r.useCallback)((a=>(l({loading:!0}),i.Z.get({endpoint:`/api/v1/${e}/${a}`}).then((({json:e={}})=>(l({resource:e.result,error:null}),e.result)),(0,c.v$)((e=>{o((0,s.t)("An error occurred while fetching %ss: %s",t,p(e))),l({error:e})}))).finally((()=>{l({loading:!1})})))),[o,e,t]),createResource:(0,r.useCallback)(((a,n=!1)=>(l({loading:!0}),i.Z.post({endpoint:`/api/v1/${e}/`,body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then((({json:e={}})=>(l({resource:{id:e.id,...e.result},error:null}),e.id)),(0,c.v$)((e=>{n||o((0,s.t)("An error occurred while creating %ss: %s",t,p(e))),l({error:e})}))).finally((()=>{l({loading:!1})})))),[o,e,t]),updateResource:(0,r.useCallback)(((a,n,r=!1)=>(l({loading:!0}),i.Z.put({endpoint:`/api/v1/${e}/${a}`,body:JSON.stringify(n),headers:{"Content-Type":"application/json"}}).then((({json:e={}})=>(l({resource:{...e.result,id:e.id},error:null}),e.result)),(0,c.v$)((e=>(r||o((0,s.t)("An error occurred while fetching %ss: %s",t,JSON.stringify(e))),l({error:e}),e)))).finally((()=>{l({loading:!1})})))),[o,e,t]),clearError:()=>l({error:null})}}function f(e,t,o){const[a,n]=(0,r.useState)({loading:!1,passwordsNeeded:[],alreadyExists:[]});function l(e){n((t=>({...t,...e})))}return{state:a,importResource:(0,r.useCallback)(((a,n={},r=!1)=>{l({loading:!0});const d=new FormData;return d.append("formData",a),n&&d.append("passwords",JSON.stringify(n)),r&&d.append("overwrite","true"),i.Z.post({endpoint:`/api/v1/${e}/import/`,body:d,headers:{Accept:"application/json"}}).then((()=>!0)).catch((e=>(0,u.O)(e).then((e=>e.errors?((0,c.Er)(e.errors)?o((0,s.t)("An error occurred while importing %s: %s",t,e.errors.map((e=>e.message)).join("\n"))):l({passwordsNeeded:(0,c.$u)(e.errors),alreadyExists:(0,c.cE)(e.errors)}),!1):(o((0,s.t)("An error occurred while importing %s: %s",t,e.message||e.error)),!1))))).finally((()=>{l({loading:!1})}))}),[])}}var v;!function(e){e.CHART="slice",e.DASHBOARD="Dashboard"}(v||(v={}));const b={chart:(0,l.Z)({requestType:"rison",method:"GET",endpoint:"/api/v1/chart/favorite_status/"}),dashboard:(0,l.Z)({requestType:"rison",method:"GET",endpoint:"/api/v1/dashboard/favorite_status/"})};function _(e,t,o){const[a,n]=(0,r.useState)({}),l=e=>n((t=>({...t,...e})));return(0,r.useEffect)((()=>{t.length&&b[e](t).then((({result:e})=>{const t=e.reduce(((e,t)=>(e[t.id]=t.value,e)),{});l(t)}),(0,c.v$)((e=>o((0,s.t)("There was an error fetching the favorite status: %s",e)))))}),[t,e,o]),[(0,r.useCallback)(((t,a)=>{const n=a?"unselect":"select";i.Z.get({endpoint:`/superset/favstar/${"chart"===e?v.CHART:v.DASHBOARD}/${t}/${n}/`}).then((({json:e})=>{l({[t]:(null==e?void 0:e.count)>0})}),(0,c.v$)((e=>o((0,s.t)("There was an error saving the favorite status: %s",e)))))}),[e]),a]}const y=(e,t)=>{const[o,a]=(0,r.useState)(null);return{sliceCurrentlyEditing:o,handleChartUpdated:function(o){const a=t.map((e=>e.id===o.id?{...e,...o}:e));e(a)},openChartEditModal:function(e){a({slice_id:e.id,slice_name:e.slice_name,description:e.description,cache_timeout:e.cache_timeout,certified_by:e.certified_by,certification_details:e.certification_details,is_managed_externally:e.is_managed_externally})},closeChartEditModal:function(){a(null)}}},C=(e,t,o)=>{(0,d.Z)(`${window.location.origin}/superset/sqllab?savedQueryId=${e}`).then((()=>{o((0,s.t)("Link Copied!"))})).catch((()=>{t((0,s.t)("Sorry, your browser does not support copying."))}))},E=()=>h.Z.DB_IMAGES,T=()=>h.Z.DB_CONNECTION_ALERTS,S=()=>h.Z.DB_CONNECTION_DOC_LINKS,Z=(e,t,o)=>{i.Z.post({endpoint:"api/v1/database/test_connection",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((()=>{o((0,s.t)("Connection looks good!"))}),(0,c.v$)((e=>{t((0,s.t)("ERROR: %s",p(e)))})))};function x(){const[e,t]=(0,r.useState)(null);return[e,(0,r.useCallback)((()=>{i.Z.get({endpoint:"/api/v1/database/available/"}).then((({json:e})=>{t(e)}))}),[t])]}function A(){const[e,t]=(0,r.useState)(null);return[e,(0,r.useCallback)(((e,o=!1)=>i.Z.post({endpoint:"/api/v1/database/validate_parameters",body:JSON.stringify(e),headers:{"Content-Type":"application/json"}}).then((()=>{t(null)})).catch((e=>{if("function"==typeof e.json)return e.json().then((({errors:e=[]})=>{const a=e.filter((e=>!["CONNECTION_MISSING_PARAMETERS_ERROR","CONNECTION_ACCESS_DENIED_ERROR"].includes(e.error_type)||o)).reduce(((e,{error_type:t,extra:o,message:a})=>o.catalog?o.catalog.name?{...e,error_type:t,[o.catalog.idx]:{name:a}}:o.catalog.url?{...e,error_type:t,[o.catalog.idx]:{url:a}}:{...e,error_type:t,[o.catalog.idx]:{name:a,url:a}}:o.invalid?{...e,[o.invalid[0]]:a,error_type:t}:o.missing?{...e,error_type:t,...Object.assign({},...o.missing.map((e=>({[e]:"This is a required field"}))))}:e),{});t(a)}));console.error(e)}))),[t]),t]}},40768:(e,t,o)=>{o.d(t,{IV:()=>f,Ld:()=>b,B1:()=>_,Hn:()=>y,tm:()=>C,wk:()=>E,v$:()=>T,Gm:()=>S,Iu:()=>Z,IB:()=>x,iv:()=>A,mq:()=>R,_L:()=>w,ZB:()=>L,xL:()=>I,$u:()=>D,cE:()=>N,Er:()=>k,Mc:()=>P});var a=o(25325),n=o.n(a),r=o(31069),i=o(61988),s=o(68492),l=o(51995),c=o(11965),d=o(15926),u=o.n(d),h=o(98286),p=o(8911),m=o(70695);(()=>{const e=u(),t=[];for(let e=0;e<16;e+=1)for(let o=0;o<16;o+=1){if(e+o===0)continue;const a=String.fromCharCode(16*e+o);/\w|[-_./~]/.test(a)||t.push(`\\u00${e.toString(16)}${o.toString(16)}`)}e.not_idchar=t.join(""),e.not_idstart="-0123456789";const o=`[^${e.not_idstart}${e.not_idchar}][^${e.not_idchar}]*`;e.id_ok=new RegExp(`^${o}$`),e.next_id=new RegExp(o,"g")})();const g=e=>(t,o,a,n)=>async(a="",i,s)=>{var l;const c=`/api/v1/${t}/${e}/${o}`,d=u().encode_uri({filter:a,page:i,page_size:s}),{json:h={}}=await r.Z.get({endpoint:`${c}?q=${d}`});let p=!1;const m=n?{label:`${n.firstName} ${n.lastName}`,value:n.userId}:void 0,g=[];return null==h||null==(l=h.result)||l.forEach((({text:e,value:t})=>{m&&t===m.value&&e===m.label?p=!0:g.push({label:e,value:t})})),!m||a&&!p||g.unshift(m),{data:g,totalCount:null==h?void 0:h.count}},f=5,v=e=>{const t={order_column:"changed_on_delta_humanized",order_direction:"desc",page:0,page_size:f,filters:e};return e||delete t.filters,u().encode(t)},b=e=>{const t={edited:[{col:"changed_by",opr:"rel_o_m",value:`${e}`}]},o=[r.Z.get({endpoint:`/api/v1/dashboard/?q=${v(t.edited)}`}),r.Z.get({endpoint:`/api/v1/chart/?q=${v(t.edited)}`})];return Promise.all(o).then((([e,t])=>{var o,a;return{editedDash:null==(o=t.json)?void 0:o.result.slice(0,3),editedChart:null==(a=e.json)?void 0:a.result.slice(0,3)}})).catch((e=>e))},_=(e,t,o=[{col:"owners",opr:"rel_m_m",value:`${e}`}])=>r.Z.get({endpoint:`/api/v1/${t}/?q=${v(o)}`}).then((e=>{var t;return null==(t=e.json)?void 0:t.result})),y=(e,t,o)=>r.Z.get({endpoint:t}).then((e=>{const t={},a=[{col:"created_by",opr:"rel_o_m",value:0}],n=[r.Z.get({endpoint:`/api/v1/chart/?q=${v(a)}`}),r.Z.get({endpoint:`/api/v1/dashboard/?q=${v(a)}`})];return Promise.all(n).then((([o,a])=>(t.examples=[...o.json.result,...a.json.result],t.viewed=e.json,t))).catch((e=>o((0,i.t)("There was an error fetching your recent activity:"),e)))})),C=g("related"),E=g("distinct");function T(e){return async t=>{const o=await(0,h.O)(t),a=null==o?void 0:o.errors,n=await p.Z;a&&a.length&&n&&n.ERRORS&&a[0].error_type in n.ERRORS&&(o.message=n.ERRORS[a[0].error_type]),s.Z.error(t),e(o.message||o.error)}}function S({id:e,slice_name:t},o,a,n,s,l){const c={pageIndex:0,pageSize:f,sortBy:[{id:"changed_on_delta_humanized",desc:!0}],filters:[{id:"created_by",operator:"rel_o_m",value:`${l}`}]};r.Z.delete({endpoint:`/api/v1/chart/${e}`}).then((()=>{"Mine"===s?n(c):n(),o((0,i.t)("Deleted: %s",t))}),(()=>{a((0,i.t)("There was an issue deleting: %s",t))}))}function Z({id:e,dashboard_title:t},o,a,n,s,l){return r.Z.delete({endpoint:`/api/v1/dashboard/${e}`}).then((()=>{"Mine"===s?o({pageIndex:0,pageSize:f,sortBy:[{id:"changed_on_delta_humanized",desc:!0}],filters:[{id:"owners",operator:"rel_m_m",value:`${l}`}]}):o(),a((0,i.t)("Deleted: %s",t))}),T((e=>n((0,i.t)("There was an issue deleting %s: %s",t,e)))))}function x(e,t){let o=e.split("\n");return o.length>=t&&(o=o.slice(0,t),o.push("...")),o.join("\n")}const A=5,R=[576,768,992,1200].map((e=>`@media (max-width: ${e}px)`)),w=l.iK.div`
  ${({showThumbnails:e,theme:t})=>`\n    overflow: hidden;\n    display: grid;\n    grid-gap: ${12*t.gridUnit}px ${4*t.gridUnit}px;\n    grid-template-columns: repeat(auto-fit, 300px);\n    max-height: ${e?"314":"148"}px;\n    margin-top: ${-6*t.gridUnit}px;\n    padding: ${e?`${8*t.gridUnit+3}px ${9*t.gridUnit}px`:`${8*t.gridUnit+1}px ${9*t.gridUnit}px`};\n  `}
`,L=l.iK.div`
  cursor: pointer;
  a {
    text-decoration: none;
  }
  .ant-card-cover > div {
    /* Height is calculated based on 300px width, to keep the same aspect ratio as the 800*450 thumbnails */
    height: 168px;
  }
`,I=e=>c.iv`
  margin: auto ${2*e.gridUnit}px auto 0;
  color: ${e.colors.grayscale.base};
`,O=e=>"object"==typeof e&&Array.isArray(e._schema)&&1===e._schema.length&&"Must provide a password for the database"===e._schema[0],M=e=>"string"==typeof e&&e.includes("already exists and `overwrite=true` was not passed"),D=e=>e.map((e=>Object.entries(e.extra).filter((([,e])=>O(e))).map((([e])=>e)))).flat(),N=e=>e.map((e=>Object.entries(e.extra).filter((([,e])=>M(e))).map((([e])=>e)))).flat(),k=e=>e.some((e=>!Object.entries(e.extra).filter((([e,t])=>"issue_codes"!==e)).every((([e,t])=>O(t)||M(t))))),F=(e,t)=>void 0!==e&&n()(e,t).length>0,P=(e,t,o,a,n)=>({canUploadCSV:(0,m.ZP)("can_this_form_get","CsvToDatabaseView",e)&&F(t,n),canUploadColumnar:F(o,n)&&(0,m.ZP)("can_this_form_get","ColumnarToDatabaseView",e),canUploadExcel:F(a,n)&&(0,m.ZP)("can_this_form_get","ExcelToDatabaseView",e)})}}]);