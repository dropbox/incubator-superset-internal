{"version":3,"file":"e3d58ea261a3cf40f59b.chunk.js","mappings":"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","sources":["webpack://superset/./src/dashboard/components/nativeFilters/FilterBar/keyValue.tsx","webpack://superset/./src/dashboard/components/FilterBoxMigrationModal.tsx","webpack://superset/./src/dashboard/styles.ts","webpack://superset/./src/dashboard/containers/DashboardPage.tsx","webpack://superset/./src/dashboard/util/injectCustomCss.ts","webpack://superset/./src/hooks/apiResources/charts.ts","webpack://superset/./src/hooks/apiResources/dashboards.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { SupersetClient, logging } from '@superset-ui/core';\nimport { DashboardPermalinkValue } from 'src/dashboard/types';\n\nconst assembleEndpoint = (\n  dashId: string | number,\n  key?: string | null,\n  tabId?: string,\n) => {\n  let endpoint = `api/v1/dashboard/${dashId}/filter_state`;\n  if (key) {\n    endpoint = endpoint.concat(`/${key}`);\n  }\n  if (tabId) {\n    endpoint = endpoint.concat(`?tab_id=${tabId}`);\n  }\n  return endpoint;\n};\n\nexport const updateFilterKey = (\n  dashId: string,\n  value: string,\n  key: string,\n  tabId?: string,\n) =>\n  SupersetClient.put({\n    endpoint: assembleEndpoint(dashId, key, tabId),\n    jsonPayload: { value },\n  })\n    .then(r => r.json.message)\n    .catch(err => {\n      logging.error(err);\n      return null;\n    });\n\nexport const createFilterKey = (\n  dashId: string | number,\n  value: string,\n  tabId?: string,\n) =>\n  SupersetClient.post({\n    endpoint: assembleEndpoint(dashId, undefined, tabId),\n    jsonPayload: { value },\n  })\n    .then(r => r.json.key as string)\n    .catch(err => {\n      logging.error(err);\n      return null;\n    });\n\nexport const getFilterValue = (dashId: string | number, key?: string | null) =>\n  SupersetClient.get({\n    endpoint: assembleEndpoint(dashId, key),\n  })\n    .then(({ json }) => JSON.parse(json.value))\n    .catch(err => {\n      logging.error(err);\n      return null;\n    });\n\nexport const getPermalinkValue = (key: string) =>\n  SupersetClient.get({\n    endpoint: `/api/v1/dashboard/permalink/${key}`,\n  })\n    .then(({ json }) => json as DashboardPermalinkValue)\n    .catch(err => {\n      logging.error(err);\n      return null;\n    });\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FunctionComponent } from 'react';\nimport { styled, t } from '@superset-ui/core';\n\nimport Modal from 'src/components/Modal';\nimport Button from 'src/components/Button';\n\nconst StyledFilterBoxMigrationModal = styled(Modal)`\n  .modal-content {\n    height: 900px;\n    display: flex;\n    flex-direction: column;\n    align-items: stretch;\n  }\n\n  .modal-header {\n    flex: 0 1 auto;\n  }\n\n  .modal-body {\n    flex: 1 1 auto;\n    overflow: auto;\n  }\n\n  .modal-footer {\n    flex: 0 1 auto;\n  }\n\n  .ant-modal-body {\n    overflow: auto;\n  }\n`;\n\ninterface FilterBoxMigrationModalProps {\n  onHide: () => void;\n  onClickReview: () => void;\n  onClickSnooze: () => void;\n  show: boolean;\n  hideFooter: boolean;\n}\n\nconst FilterBoxMigrationModal: FunctionComponent<FilterBoxMigrationModalProps> =\n  ({ onClickReview, onClickSnooze, onHide, show, hideFooter = false }) => (\n    <StyledFilterBoxMigrationModal\n      show={show}\n      onHide={onHide}\n      title={t('Ready to review filters in this dashboard?')}\n      hideFooter={hideFooter}\n      footer={\n        <>\n          <Button buttonSize=\"small\" onClick={onClickSnooze}>\n            {t('Remind me in 24 hours')}\n          </Button>\n          <Button buttonSize=\"small\" onClick={onHide}>\n            {t('Cancel')}\n          </Button>\n          <Button\n            buttonSize=\"small\"\n            buttonStyle=\"primary\"\n            onClick={onClickReview}\n          >\n            {t('Start Review')}\n          </Button>\n        </>\n      }\n      responsive\n    >\n      <div>\n        {t(\n          'filter_box will be deprecated ' +\n            'in a future version of Superset. ' +\n            'Please replace filter_box by dashboard filter components.',\n        )}\n      </div>\n    </StyledFilterBoxMigrationModal>\n  );\n\nexport default FilterBoxMigrationModal;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { css, SupersetTheme } from '@superset-ui/core';\n\nexport const filterCardPopoverStyle = (theme: SupersetTheme) => css`\n  .filter-card-popover {\n    width: 240px;\n    padding: 0;\n    border-radius: 4px;\n\n    .ant-popover-inner {\n      box-shadow: 0 0 8px rgb(0 0 0 / 10%);\n    }\n    .ant-popover-inner-content {\n      padding: ${theme.gridUnit * 4}px;\n    }\n\n    .ant-popover-arrow {\n      display: none;\n    }\n  }\n\n  .filter-card-tooltip {\n    &.ant-tooltip-placement-bottom {\n      padding-top: 0;\n      & .ant-tooltip-arrow {\n        top: -13px;\n      }\n    }\n  }\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { FC, useRef, useEffect, useState } from 'react';\nimport {\n  CategoricalColorNamespace,\n  FeatureFlag,\n  getSharedLabelColor,\n  isFeatureEnabled,\n  t,\n  useTheme,\n} from '@superset-ui/core';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { Global } from '@emotion/react';\nimport { useToasts } from 'src/components/MessageToasts/withToasts';\nimport Loading from 'src/components/Loading';\nimport FilterBoxMigrationModal from 'src/dashboard/components/FilterBoxMigrationModal';\nimport {\n  useDashboard,\n  useDashboardCharts,\n  useDashboardDatasets,\n} from 'src/hooks/apiResources';\nimport { hydrateDashboard } from 'src/dashboard/actions/hydrate';\nimport { setDatasources } from 'src/dashboard/actions/datasources';\nimport injectCustomCss from 'src/dashboard/util/injectCustomCss';\nimport setupPlugins from 'src/setup/setupPlugins';\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport { addWarningToast } from 'src/components/MessageToasts/actions';\n\nimport {\n  getItem,\n  setItem,\n  LocalStorageKeys,\n} from 'src/utils/localStorageHelpers';\nimport {\n  FILTER_BOX_MIGRATION_STATES,\n  FILTER_BOX_TRANSITION_SNOOZE_DURATION,\n} from 'src/explore/constants';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { canUserEditDashboard } from 'src/dashboard/util/findPermission';\nimport { getFilterSets } from '../actions/nativeFilters';\nimport { setDatasetsStatus } from '../actions/dashboardState';\nimport {\n  getFilterValue,\n  getPermalinkValue,\n} from '../components/nativeFilters/FilterBar/keyValue';\nimport { filterCardPopoverStyle } from '../styles';\n\nexport const MigrationContext = React.createContext(\n  FILTER_BOX_MIGRATION_STATES.NOOP,\n);\n\nsetupPlugins();\nconst DashboardContainer = React.lazy(\n  () =>\n    import(\n      /* webpackChunkName: \"DashboardContainer\" */\n      /* webpackPreload: true */\n      'src/dashboard/containers/Dashboard'\n    ),\n);\n\nconst originalDocumentTitle = document.title;\n\ntype PageProps = {\n  idOrSlug: string;\n};\n\nexport const DashboardPage: FC<PageProps> = ({ idOrSlug }: PageProps) => {\n  const dispatch = useDispatch();\n  const theme = useTheme();\n  const user = useSelector<any, UserWithPermissionsAndRoles>(\n    state => state.user,\n  );\n  const { addDangerToast } = useToasts();\n  const { result: dashboard, error: dashboardApiError } =\n    useDashboard(idOrSlug);\n  const { result: charts, error: chartsApiError } =\n    useDashboardCharts(idOrSlug);\n  const {\n    result: datasets,\n    error: datasetsApiError,\n    status,\n  } = useDashboardDatasets(idOrSlug);\n  const isDashboardHydrated = useRef(false);\n\n  const error = dashboardApiError || chartsApiError;\n  const readyToRender = Boolean(dashboard && charts);\n  const migrationStateParam = getUrlParam(\n    URL_PARAMS.migrationState,\n  ) as FILTER_BOX_MIGRATION_STATES;\n  const isMigrationEnabled = isFeatureEnabled(\n    FeatureFlag.ENABLE_FILTER_BOX_MIGRATION,\n  );\n  const { dashboard_title, css, metadata, id = 0 } = dashboard || {};\n  const [filterboxMigrationState, setFilterboxMigrationState] = useState(\n    migrationStateParam || FILTER_BOX_MIGRATION_STATES.NOOP,\n  );\n\n  useEffect(() => {\n    dispatch(setDatasetsStatus(status));\n  }, [dispatch, status]);\n\n  useEffect(() => {\n    // should convert filter_box to filter component?\n    const hasFilterBox =\n      charts &&\n      charts.some(chart => chart.form_data?.viz_type === 'filter_box');\n    const canEdit = dashboard && canUserEditDashboard(dashboard, user);\n\n    if (canEdit) {\n      // can user edit dashboard?\n      if (metadata?.native_filter_configuration) {\n        setFilterboxMigrationState(\n          isMigrationEnabled\n            ? FILTER_BOX_MIGRATION_STATES.CONVERTED\n            : FILTER_BOX_MIGRATION_STATES.NOOP,\n        );\n        return;\n      }\n\n      // set filterbox migration state if has filter_box in the dash:\n      if (hasFilterBox) {\n        if (isMigrationEnabled) {\n          // has url param?\n          if (\n            migrationStateParam &&\n            Object.values(FILTER_BOX_MIGRATION_STATES).includes(\n              migrationStateParam,\n            )\n          ) {\n            setFilterboxMigrationState(migrationStateParam);\n            return;\n          }\n\n          // has cookie?\n          const snoozeDash = getItem(\n            LocalStorageKeys.filter_box_transition_snoozed_at,\n            {},\n          );\n          if (\n            Date.now() - (snoozeDash[id] || 0) <\n            FILTER_BOX_TRANSITION_SNOOZE_DURATION\n          ) {\n            setFilterboxMigrationState(FILTER_BOX_MIGRATION_STATES.SNOOZED);\n            return;\n          }\n\n          setFilterboxMigrationState(FILTER_BOX_MIGRATION_STATES.UNDECIDED);\n        } else if (isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS)) {\n          dispatch(\n            addWarningToast(\n              t(\n                'filter_box will be deprecated ' +\n                  'in a future version of Superset. ' +\n                  'Please replace filter_box by dashboard filter components.',\n              ),\n            ),\n          );\n        }\n      }\n    }\n  }, [readyToRender]);\n\n  useEffect(() => {\n    // eslint-disable-next-line consistent-return\n    async function getDataMaskApplied() {\n      const permalinkKey = getUrlParam(URL_PARAMS.permalinkKey);\n      const nativeFilterKeyValue = getUrlParam(URL_PARAMS.nativeFiltersKey);\n      let dataMaskFromUrl = nativeFilterKeyValue || {};\n\n      const isOldRison = getUrlParam(URL_PARAMS.nativeFilters);\n      if (permalinkKey) {\n        const permalinkValue = await getPermalinkValue(permalinkKey);\n        if (permalinkValue) {\n          dataMaskFromUrl = permalinkValue.state.filterState;\n        }\n      } else if (nativeFilterKeyValue) {\n        dataMaskFromUrl = await getFilterValue(id, nativeFilterKeyValue);\n      }\n      if (isOldRison) {\n        dataMaskFromUrl = isOldRison;\n      }\n\n      if (readyToRender) {\n        if (!isDashboardHydrated.current) {\n          isDashboardHydrated.current = true;\n          if (isFeatureEnabled(FeatureFlag.DASHBOARD_NATIVE_FILTERS_SET)) {\n            // only initialize filterset once\n            dispatch(getFilterSets(id));\n          }\n        }\n        dispatch(\n          hydrateDashboard(\n            dashboard,\n            charts,\n            filterboxMigrationState,\n            dataMaskFromUrl,\n          ),\n        );\n      }\n      return null;\n    }\n    if (id) getDataMaskApplied();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [readyToRender, filterboxMigrationState]);\n\n  useEffect(() => {\n    if (dashboard_title) {\n      document.title = dashboard_title;\n    }\n    return () => {\n      document.title = originalDocumentTitle;\n    };\n  }, [dashboard_title]);\n\n  useEffect(() => {\n    if (typeof css === 'string') {\n      // returning will clean up custom css\n      // when dashboard unmounts or changes\n      return injectCustomCss(css);\n    }\n    return () => {};\n  }, [css]);\n\n  useEffect(\n    () => () => {\n      // clean up label color\n      const categoricalNamespace = CategoricalColorNamespace.getNamespace(\n        metadata?.color_namespace,\n      );\n      categoricalNamespace.resetColors();\n      getSharedLabelColor().clear();\n    },\n    [metadata?.color_namespace],\n  );\n\n  useEffect(() => {\n    if (datasetsApiError) {\n      addDangerToast(\n        t('Error loading chart datasources. Filters may not work correctly.'),\n      );\n    } else {\n      dispatch(setDatasources(datasets));\n    }\n  }, [addDangerToast, datasets, datasetsApiError, dispatch]);\n\n  if (error) throw error; // caught in error boundary\n  if (!readyToRender) return <Loading />;\n\n  return (\n    <>\n      <Global styles={filterCardPopoverStyle(theme)} />\n      <FilterBoxMigrationModal\n        show={filterboxMigrationState === FILTER_BOX_MIGRATION_STATES.UNDECIDED}\n        hideFooter={!isMigrationEnabled}\n        onHide={() => {\n          // cancel button: only snooze this visit\n          setFilterboxMigrationState(FILTER_BOX_MIGRATION_STATES.SNOOZED);\n        }}\n        onClickReview={() => {\n          setFilterboxMigrationState(FILTER_BOX_MIGRATION_STATES.REVIEWING);\n        }}\n        onClickSnooze={() => {\n          const snoozedDash = getItem(\n            LocalStorageKeys.filter_box_transition_snoozed_at,\n            {},\n          );\n          setItem(LocalStorageKeys.filter_box_transition_snoozed_at, {\n            ...snoozedDash,\n            [id]: Date.now(),\n          });\n          setFilterboxMigrationState(FILTER_BOX_MIGRATION_STATES.SNOOZED);\n        }}\n      />\n\n      <MigrationContext.Provider value={filterboxMigrationState}>\n        <DashboardContainer />\n      </MigrationContext.Provider>\n    </>\n  );\n};\n\nexport default DashboardPage;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nfunction createStyleElement(className: string) {\n  const style = document.createElement('style');\n  style.className = className;\n  style.type = 'text/css';\n  return style;\n}\n\n// The original, non-typescript code referenced `style.styleSheet`.\n// I can't find what sort of element would have a styleSheet property,\n// so have created this type to satisfy TS without changing behavior.\ntype MysteryStyleElement = {\n  styleSheet: {\n    cssText: string;\n  };\n};\n\nexport default function injectCustomCss(css: string) {\n  const className = 'CssEditor-css';\n  const head = document.head || document.getElementsByTagName('head')[0];\n  const style: HTMLStyleElement =\n    document.querySelector(`.${className}`) || createStyleElement(className);\n\n  if ('styleSheet' in style) {\n    (style as HTMLStyleElement & MysteryStyleElement).styleSheet.cssText = css;\n  } else {\n    style.innerHTML = css;\n  }\n\n  /**\n   * Ensures that the style applied is always the last.\n   *\n   * from: https://developer.mozilla.org/en-US/docs/Web/API/Node/appendChild\n   * The Node.appendChild() method adds a node to the end of the list of children\n   * of a specified parent node. If the given child is a reference to an existing\n   * node in the document, appendChild() moves it from its current position to the\n   * new position (there is no requirement to remove the node from its parent node\n   * before appending it to some other node).\n   */\n\n  head.appendChild(style);\n\n  return function removeCustomCSS() {\n    style.remove();\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport rison from 'rison';\nimport Chart from 'src/types/Chart';\nimport { useApiV1Resource, useTransformedResource } from './apiResources';\n\nfunction extractOwnerNames({ owners }: Chart) {\n  if (!owners) return null;\n  return owners.map(owner => `${owner.first_name} ${owner.last_name}`);\n}\n\nconst ownerNamesQuery = rison.encode({\n  columns: ['owners.first_name', 'owners.last_name'],\n  keys: ['none'],\n});\n\nexport function useChartOwnerNames(chartId: string) {\n  return useTransformedResource(\n    useApiV1Resource<Chart>(`/api/v1/chart/${chartId}?q=${ownerNamesQuery}`),\n    extractOwnerNames,\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Dashboard, Datasource, EmbeddedDashboard } from 'src/dashboard/types';\nimport { Chart } from 'src/types/Chart';\nimport { useApiV1Resource, useTransformedResource } from './apiResources';\n\nexport const useDashboard = (idOrSlug: string | number) =>\n  useTransformedResource(\n    useApiV1Resource<Dashboard>(`/api/v1/dashboard/${idOrSlug}`),\n    dashboard => ({\n      ...dashboard,\n      metadata:\n        (dashboard.json_metadata && JSON.parse(dashboard.json_metadata)) || {},\n      position_data:\n        dashboard.position_json && JSON.parse(dashboard.position_json),\n    }),\n  );\n\n// gets the chart definitions for a dashboard\nexport const useDashboardCharts = (idOrSlug: string | number) =>\n  useApiV1Resource<Chart[]>(`/api/v1/dashboard/${idOrSlug}/charts`);\n\n// gets the datasets for a dashboard\n// important: this endpoint only returns the fields in the dataset\n// that are necessary for rendering the given dashboard\nexport const useDashboardDatasets = (idOrSlug: string | number) =>\n  useApiV1Resource<Datasource[]>(`/api/v1/dashboard/${idOrSlug}/datasets`);\n\nexport const useEmbeddedDashboard = (idOrSlug: string | number) =>\n  useApiV1Resource<EmbeddedDashboard>(`/api/v1/dashboard/${idOrSlug}/embedded`);\n"],"names":["assembleEndpoint","dashId","key","tabId","endpoint","concat","updateFilterKey","value","jsonPayload","then","r","json","message","catch","err","createFilterKey","undefined","getFilterValue","JSON","parse","getPermalinkValue","StyledFilterBoxMigrationModal","style","Modal","onClickReview","onClickSnooze","onHide","show","hideFooter","title","t","footer","Button","buttonSize","onClick","buttonStyle","responsive","filterCardPopoverStyle","theme","gridUnit","MigrationContext","setupPlugins","DashboardContainer","originalDocumentTitle","document","DashboardPage","idOrSlug","dispatch","user","state","addDangerToast","result","dashboard","error","dashboardApiError","charts","chartsApiError","datasets","datasetsApiError","status","isDashboardHydrated","useRef","readyToRender","Boolean","migrationStateParam","isMigrationEnabled","dashboard_title","css","metadata","id","filterboxMigrationState","setFilterboxMigrationState","useState","useEffect","hasFilterBox","some","chart","form_data","viz_type","native_filter_configuration","Object","values","includes","snoozeDash","Date","now","async","permalinkKey","nativeFilterKeyValue","dataMaskFromUrl","isOldRison","permalinkValue","filterState","current","hydrate","getDataMaskApplied","injectCustomCss","CategoricalColorNamespace","getNamespace","color_namespace","resetColors","clear","styles","snoozedDash","Provider","Loading","className","head","getElementsByTagName","querySelector","createElement","type","createStyleElement","styleSheet","cssText","innerHTML","appendChild","remove","extractOwnerNames","owners","map","owner","first_name","last_name","ownerNamesQuery","columns","keys","useChartOwnerNames","chartId","useDashboard","json_metadata","position_data","position_json","useDashboardCharts","useDashboardDatasets"],"sourceRoot":""}