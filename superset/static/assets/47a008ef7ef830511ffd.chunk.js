/*! For license information please see 47a008ef7ef830511ffd.chunk.js.LICENSE */
(window.webpackJsonp=window.webpackJsonp||[]).push([[34,17,36,37,38,41,42,43,44,47],{1160:function(e,t,n){},239:function(e,t,n){var i,o,r;!function(a,s){"use strict";e.exports?e.exports=s(n(693),n(694),n(695)):(o=[n(693),n(694),n(695)],void 0===(r="function"==typeof(i=s)?i.apply(t,o):i)||(e.exports=r))}(0,(function(e,t,n,i){"use strict";var o=i&&i.URI;function r(e,t){var n=arguments.length>=1,i=arguments.length>=2;if(!(this instanceof r))return n?i?new r(e,t):new r(e):new r;if(void 0===e){if(n)throw new TypeError("undefined is not a valid argument for URI");e="undefined"!=typeof location?location.href+"":""}if(null===e&&n)throw new TypeError("null is not a valid argument for URI");return this.href(e),void 0!==t?this.absoluteTo(t):this}r.version="1.19.1";var a=r.prototype,s=Object.prototype.hasOwnProperty;function l(e){return e.replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function c(e){return void 0===e?"Undefined":String(Object.prototype.toString.call(e)).slice(8,-1)}function u(e){return"Array"===c(e)}function d(e,t){var n,i,o={};if("RegExp"===c(t))o=null;else if(u(t))for(n=0,i=t.length;n<i;n++)o[t[n]]=!0;else o[t]=!0;for(n=0,i=e.length;n<i;n++){(o&&void 0!==o[e[n]]||!o&&t.test(e[n]))&&(e.splice(n,1),i--,n--)}return e}function g(e,t){var n,i;if(u(t)){for(n=0,i=t.length;n<i;n++)if(!g(e,t[n]))return!1;return!0}var o=c(t);for(n=0,i=e.length;n<i;n++)if("RegExp"===o){if("string"==typeof e[n]&&e[n].match(t))return!0}else if(e[n]===t)return!0;return!1}function p(e,t){if(!u(e)||!u(t))return!1;if(e.length!==t.length)return!1;e.sort(),t.sort();for(var n=0,i=e.length;n<i;n++)if(e[n]!==t[n])return!1;return!0}function h(e){return e.replace(/^\/+|\/+$/g,"")}function f(e){return escape(e)}function v(e){return encodeURIComponent(e).replace(/[!'()*]/g,f).replace(/\*/g,"%2A")}r._parts=function(){return{protocol:null,username:null,password:null,hostname:null,urn:null,port:null,path:null,query:null,fragment:null,preventInvalidHostname:r.preventInvalidHostname,duplicateQueryParameters:r.duplicateQueryParameters,escapeQuerySpace:r.escapeQuerySpace}},r.preventInvalidHostname=!1,r.duplicateQueryParameters=!1,r.escapeQuerySpace=!0,r.protocol_expression=/^[a-z][a-z0-9.+-]*$/i,r.idn_expression=/[^a-z0-9\._-]/i,r.punycode_expression=/(xn--)/i,r.ip4_expression=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,r.ip6_expression=/^\s*((([0-9A-Fa-f]{1,4}:){7}([0-9A-Fa-f]{1,4}|:))|(([0-9A-Fa-f]{1,4}:){6}(:[0-9A-Fa-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){5}(((:[0-9A-Fa-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9A-Fa-f]{1,4}:){4}(((:[0-9A-Fa-f]{1,4}){1,3})|((:[0-9A-Fa-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){3}(((:[0-9A-Fa-f]{1,4}){1,4})|((:[0-9A-Fa-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){2}(((:[0-9A-Fa-f]{1,4}){1,5})|((:[0-9A-Fa-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9A-Fa-f]{1,4}:){1}(((:[0-9A-Fa-f]{1,4}){1,6})|((:[0-9A-Fa-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9A-Fa-f]{1,4}){1,7})|((:[0-9A-Fa-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))(%.+)?\s*$/,r.find_uri_expression=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi,r.findUri={start:/\b(?:([a-z][a-z0-9.+-]*:\/\/)|www\.)/gi,end:/[\s\r\n]|$/,trim:/[`!()\[\]{};:'".,<>?«»“”„‘’]+$/,parens:/(\([^\)]*\)|\[[^\]]*\]|\{[^}]*\}|<[^>]*>)/g},r.defaultPorts={http:"80",https:"443",ftp:"21",gopher:"70",ws:"80",wss:"443"},r.hostProtocols=["http","https"],r.invalid_hostname_characters=/[^a-zA-Z0-9\.\-:_]/,r.domAttributes={a:"href",blockquote:"cite",link:"href",base:"href",script:"src",form:"action",img:"src",area:"href",iframe:"src",embed:"src",source:"src",track:"src",input:"src",audio:"src",video:"src"},r.getDomAttribute=function(e){if(e&&e.nodeName){var t=e.nodeName.toLowerCase();if("input"!==t||"image"===e.type)return r.domAttributes[t]}},r.encode=v,r.decode=decodeURIComponent,r.iso8859=function(){r.encode=escape,r.decode=unescape},r.unicode=function(){r.encode=v,r.decode=decodeURIComponent},r.characters={pathname:{encode:{expression:/%(24|26|2B|2C|3B|3D|3A|40)/gi,map:{"%24":"$","%26":"&","%2B":"+","%2C":",","%3B":";","%3D":"=","%3A":":","%40":"@"}},decode:{expression:/[\/\?#]/g,map:{"/":"%2F","?":"%3F","#":"%23"}}},reserved:{encode:{expression:/%(21|23|24|26|27|28|29|2A|2B|2C|2F|3A|3B|3D|3F|40|5B|5D)/gi,map:{"%3A":":","%2F":"/","%3F":"?","%23":"#","%5B":"[","%5D":"]","%40":"@","%21":"!","%24":"$","%26":"&","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"="}}},urnpath:{encode:{expression:/%(21|24|27|28|29|2A|2B|2C|3B|3D|40)/gi,map:{"%21":"!","%24":"$","%27":"'","%28":"(","%29":")","%2A":"*","%2B":"+","%2C":",","%3B":";","%3D":"=","%40":"@"}},decode:{expression:/[\/\?#:]/g,map:{"/":"%2F","?":"%3F","#":"%23",":":"%3A"}}}},r.encodeQuery=function(e,t){var n=r.encode(e+"");return void 0===t&&(t=r.escapeQuerySpace),t?n.replace(/%20/g,"+"):n},r.decodeQuery=function(e,t){e+="",void 0===t&&(t=r.escapeQuerySpace);try{return r.decode(t?e.replace(/\+/g,"%20"):e)}catch(t){return e}};var m,y={encode:"encode",decode:"decode"},x=function(e,t){return function(n){try{return r[t](n+"").replace(r.characters[e][t].expression,(function(n){return r.characters[e][t].map[n]}))}catch(e){return n}}};for(m in y)r[m+"PathSegment"]=x("pathname",y[m]),r[m+"UrnPathSegment"]=x("urnpath",y[m]);var b=function(e,t,n){return function(i){var o;o=n?function(e){return r[t](r[n](e))}:r[t];for(var a=(i+"").split(e),s=0,l=a.length;s<l;s++)a[s]=o(a[s]);return a.join(e)}};function P(e){return function(t,n){return void 0===t?this._parts[e]||"":(this._parts[e]=t||null,this.build(!n),this)}}function _(e,t){return function(n,i){return void 0===n?this._parts[e]||"":(null!==n&&(n+="").charAt(0)===t&&(n=n.substring(1)),this._parts[e]=n,this.build(!i),this)}}r.decodePath=b("/","decodePathSegment"),r.decodeUrnPath=b(":","decodeUrnPathSegment"),r.recodePath=b("/","encodePathSegment","decode"),r.recodeUrnPath=b(":","encodeUrnPathSegment","decode"),r.encodeReserved=x("reserved","encode"),r.parse=function(e,t){var n;return t||(t={preventInvalidHostname:r.preventInvalidHostname}),(n=e.indexOf("#"))>-1&&(t.fragment=e.substring(n+1)||null,e=e.substring(0,n)),(n=e.indexOf("?"))>-1&&(t.query=e.substring(n+1)||null,e=e.substring(0,n)),"//"===e.substring(0,2)?(t.protocol=null,e=e.substring(2),e=r.parseAuthority(e,t)):(n=e.indexOf(":"))>-1&&(t.protocol=e.substring(0,n)||null,t.protocol&&!t.protocol.match(r.protocol_expression)?t.protocol=void 0:"//"===e.substring(n+1,n+3)?(e=e.substring(n+3),e=r.parseAuthority(e,t)):(e=e.substring(n+1),t.urn=!0)),t.path=e,t},r.parseHost=function(e,t){e||(e="");var n,i,o=(e=e.replace(/\\/g,"/")).indexOf("/");if(-1===o&&(o=e.length),"["===e.charAt(0))n=e.indexOf("]"),t.hostname=e.substring(1,n)||null,t.port=e.substring(n+2,o)||null,"/"===t.port&&(t.port=null);else{var a=e.indexOf(":"),s=e.indexOf("/"),l=e.indexOf(":",a+1);-1!==l&&(-1===s||l<s)?(t.hostname=e.substring(0,o)||null,t.port=null):(i=e.substring(0,o).split(":"),t.hostname=i[0]||null,t.port=i[1]||null)}return t.hostname&&"/"!==e.substring(o).charAt(0)&&(o++,e="/"+e),t.preventInvalidHostname&&r.ensureValidHostname(t.hostname,t.protocol),t.port&&r.ensureValidPort(t.port),e.substring(o)||"/"},r.parseAuthority=function(e,t){return e=r.parseUserinfo(e,t),r.parseHost(e,t)},r.parseUserinfo=function(e,t){var n,i=e.indexOf("/"),o=e.lastIndexOf("@",i>-1?i:e.length-1);return o>-1&&(-1===i||o<i)?(n=e.substring(0,o).split(":"),t.username=n[0]?r.decode(n[0]):null,n.shift(),t.password=n[0]?r.decode(n.join(":")):null,e=e.substring(o+1)):(t.username=null,t.password=null),e},r.parseQuery=function(e,t){if(!e)return{};if(!(e=e.replace(/&+/g,"&").replace(/^\?*&*|&+$/g,"")))return{};for(var n,i,o,a={},l=e.split("&"),c=l.length,u=0;u<c;u++)n=l[u].split("="),i=r.decodeQuery(n.shift(),t),o=n.length?r.decodeQuery(n.join("="),t):null,s.call(a,i)?("string"!=typeof a[i]&&null!==a[i]||(a[i]=[a[i]]),a[i].push(o)):a[i]=o;return a},r.build=function(e){var t="";return e.protocol&&(t+=e.protocol+":"),e.urn||!t&&!e.hostname||(t+="//"),t+=r.buildAuthority(e)||"","string"==typeof e.path&&("/"!==e.path.charAt(0)&&"string"==typeof e.hostname&&(t+="/"),t+=e.path),"string"==typeof e.query&&e.query&&(t+="?"+e.query),"string"==typeof e.fragment&&e.fragment&&(t+="#"+e.fragment),t},r.buildHost=function(e){var t="";return e.hostname?(r.ip6_expression.test(e.hostname)?t+="["+e.hostname+"]":t+=e.hostname,e.port&&(t+=":"+e.port),t):""},r.buildAuthority=function(e){return r.buildUserinfo(e)+r.buildHost(e)},r.buildUserinfo=function(e){var t="";return e.username&&(t+=r.encode(e.username)),e.password&&(t+=":"+r.encode(e.password)),t&&(t+="@"),t},r.buildQuery=function(e,t,n){var i,o,a,l,c="";for(o in e)if(s.call(e,o)&&o)if(u(e[o]))for(i={},a=0,l=e[o].length;a<l;a++)void 0!==e[o][a]&&void 0===i[e[o][a]+""]&&(c+="&"+r.buildQueryParameter(o,e[o][a],n),!0!==t&&(i[e[o][a]+""]=!0));else void 0!==e[o]&&(c+="&"+r.buildQueryParameter(o,e[o],n));return c.substring(1)},r.buildQueryParameter=function(e,t,n){return r.encodeQuery(e,n)+(null!==t?"="+r.encodeQuery(t,n):"")},r.addQuery=function(e,t,n){if("object"==typeof t)for(var i in t)s.call(t,i)&&r.addQuery(e,i,t[i]);else{if("string"!=typeof t)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");if(void 0===e[t])return void(e[t]=n);"string"==typeof e[t]&&(e[t]=[e[t]]),u(n)||(n=[n]),e[t]=(e[t]||[]).concat(n)}},r.setQuery=function(e,t,n){if("object"==typeof t)for(var i in t)s.call(t,i)&&r.setQuery(e,i,t[i]);else{if("string"!=typeof t)throw new TypeError("URI.setQuery() accepts an object, string as the name parameter");e[t]=void 0===n?null:n}},r.removeQuery=function(e,t,n){var i,o,a;if(u(t))for(i=0,o=t.length;i<o;i++)e[t[i]]=void 0;else if("RegExp"===c(t))for(a in e)t.test(a)&&(e[a]=void 0);else if("object"==typeof t)for(a in t)s.call(t,a)&&r.removeQuery(e,a,t[a]);else{if("string"!=typeof t)throw new TypeError("URI.removeQuery() accepts an object, string, RegExp as the first parameter");void 0!==n?"RegExp"===c(n)?!u(e[t])&&n.test(e[t])?e[t]=void 0:e[t]=d(e[t],n):e[t]!==String(n)||u(n)&&1!==n.length?u(e[t])&&(e[t]=d(e[t],n)):e[t]=void 0:e[t]=void 0}},r.hasQuery=function(e,t,n,i){switch(c(t)){case"String":break;case"RegExp":for(var o in e)if(s.call(e,o)&&t.test(o)&&(void 0===n||r.hasQuery(e,o,n)))return!0;return!1;case"Object":for(var a in t)if(s.call(t,a)&&!r.hasQuery(e,a,t[a]))return!1;return!0;default:throw new TypeError("URI.hasQuery() accepts a string, regular expression or object as the name parameter")}switch(c(n)){case"Undefined":return t in e;case"Boolean":return n===Boolean(u(e[t])?e[t].length:e[t]);case"Function":return!!n(e[t],t,e);case"Array":return!!u(e[t])&&(i?g:p)(e[t],n);case"RegExp":return u(e[t])?!!i&&g(e[t],n):Boolean(e[t]&&e[t].match(n));case"Number":n=String(n);case"String":return u(e[t])?!!i&&g(e[t],n):e[t]===n;default:throw new TypeError("URI.hasQuery() accepts undefined, boolean, string, number, RegExp, Function as the value parameter")}},r.joinPaths=function(){for(var e=[],t=[],n=0,i=0;i<arguments.length;i++){var o=new r(arguments[i]);e.push(o);for(var a=o.segment(),s=0;s<a.length;s++)"string"==typeof a[s]&&t.push(a[s]),a[s]&&n++}if(!t.length||!n)return new r("");var l=new r("").segment(t);return""!==e[0].path()&&"/"!==e[0].path().slice(0,1)||l.path("/"+l.path()),l.normalize()},r.commonPath=function(e,t){var n,i=Math.min(e.length,t.length);for(n=0;n<i;n++)if(e.charAt(n)!==t.charAt(n)){n--;break}return n<1?e.charAt(0)===t.charAt(0)&&"/"===e.charAt(0)?"/":"":("/"===e.charAt(n)&&"/"===t.charAt(n)||(n=e.substring(0,n).lastIndexOf("/")),e.substring(0,n+1))},r.withinString=function(e,t,n){n||(n={});var i=n.start||r.findUri.start,o=n.end||r.findUri.end,a=n.trim||r.findUri.trim,s=n.parens||r.findUri.parens,l=/[a-z0-9-]=["']?$/i;for(i.lastIndex=0;;){var c=i.exec(e);if(!c)break;var u=c.index;if(n.ignoreHtml){var d=e.slice(Math.max(u-3,0),u);if(d&&l.test(d))continue}for(var g=u+e.slice(u).search(o),p=e.slice(u,g),h=-1;;){var f=s.exec(p);if(!f)break;var v=f.index+f[0].length;h=Math.max(h,v)}if(!((p=h>-1?p.slice(0,h)+p.slice(h).replace(a,""):p.replace(a,"")).length<=c[0].length||n.ignore&&n.ignore.test(p))){var m=t(p,u,g=u+p.length,e);void 0!==m?(m=String(m),e=e.slice(0,u)+m+e.slice(g),i.lastIndex=u+m.length):i.lastIndex=g}}return i.lastIndex=0,e},r.ensureValidHostname=function(t,n){var i=!!t,o=!1;if(!!n&&(o=g(r.hostProtocols,n)),o&&!i)throw new TypeError("Hostname cannot be empty, if protocol is "+n);if(t&&t.match(r.invalid_hostname_characters)){if(!e)throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_] and Punycode.js is not available');if(e.toASCII(t).match(r.invalid_hostname_characters))throw new TypeError('Hostname "'+t+'" contains characters other than [A-Z0-9.-:_]')}},r.ensureValidPort=function(e){if(e){var t=Number(e);if(!(/^[0-9]+$/.test(t)&&t>0&&t<65536))throw new TypeError('Port "'+e+'" is not a valid port')}},r.noConflict=function(e){if(e){var t={URI:this.noConflict()};return i.URITemplate&&"function"==typeof i.URITemplate.noConflict&&(t.URITemplate=i.URITemplate.noConflict()),i.IPv6&&"function"==typeof i.IPv6.noConflict&&(t.IPv6=i.IPv6.noConflict()),i.SecondLevelDomains&&"function"==typeof i.SecondLevelDomains.noConflict&&(t.SecondLevelDomains=i.SecondLevelDomains.noConflict()),t}return i.URI===this&&(i.URI=o),this},a.build=function(e){return!0===e?this._deferred_build=!0:(void 0===e||this._deferred_build)&&(this._string=r.build(this._parts),this._deferred_build=!1),this},a.clone=function(){return new r(this)},a.valueOf=a.toString=function(){return this.build(!1)._string},a.protocol=P("protocol"),a.username=P("username"),a.password=P("password"),a.hostname=P("hostname"),a.port=P("port"),a.query=_("query","?"),a.fragment=_("fragment","#"),a.search=function(e,t){var n=this.query(e,t);return"string"==typeof n&&n.length?"?"+n:n},a.hash=function(e,t){var n=this.fragment(e,t);return"string"==typeof n&&n.length?"#"+n:n},a.pathname=function(e,t){if(void 0===e||!0===e){var n=this._parts.path||(this._parts.hostname?"/":"");return e?(this._parts.urn?r.decodeUrnPath:r.decodePath)(n):n}return this._parts.urn?this._parts.path=e?r.recodeUrnPath(e):"":this._parts.path=e?r.recodePath(e):"/",this.build(!t),this},a.path=a.pathname,a.href=function(e,t){var n;if(void 0===e)return this.toString();this._string="",this._parts=r._parts();var i=e instanceof r,o="object"==typeof e&&(e.hostname||e.path||e.pathname);e.nodeName&&(e=e[r.getDomAttribute(e)]||"",o=!1);if(!i&&o&&void 0!==e.pathname&&(e=e.toString()),"string"==typeof e||e instanceof String)this._parts=r.parse(String(e),this._parts);else{if(!i&&!o)throw new TypeError("invalid input");var a=i?e._parts:e;for(n in a)"query"!==n&&s.call(this._parts,n)&&(this._parts[n]=a[n]);a.query&&this.query(a.query,!1)}return this.build(!t),this},a.is=function(e){var t=!1,i=!1,o=!1,a=!1,s=!1,l=!1,c=!1,u=!this._parts.urn;switch(this._parts.hostname&&(u=!1,i=r.ip4_expression.test(this._parts.hostname),o=r.ip6_expression.test(this._parts.hostname),s=(a=!(t=i||o))&&n&&n.has(this._parts.hostname),l=a&&r.idn_expression.test(this._parts.hostname),c=a&&r.punycode_expression.test(this._parts.hostname)),e.toLowerCase()){case"relative":return u;case"absolute":return!u;case"domain":case"name":return a;case"sld":return s;case"ip":return t;case"ip4":case"ipv4":case"inet4":return i;case"ip6":case"ipv6":case"inet6":return o;case"idn":return l;case"url":return!this._parts.urn;case"urn":return!!this._parts.urn;case"punycode":return c}return null};var w=a.protocol,C=a.port,S=a.hostname;a.protocol=function(e,t){if(e&&!(e=e.replace(/:(\/\/)?$/,"")).match(r.protocol_expression))throw new TypeError('Protocol "'+e+"\" contains characters other than [A-Z0-9.+-] or doesn't start with [A-Z]");return w.call(this,e,t)},a.scheme=a.protocol,a.port=function(e,t){return this._parts.urn?void 0===e?"":this:(void 0!==e&&(0===e&&(e=null),e&&(":"===(e+="").charAt(0)&&(e=e.substring(1)),r.ensureValidPort(e))),C.call(this,e,t))},a.hostname=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0!==e){var n={preventInvalidHostname:this._parts.preventInvalidHostname};if("/"!==r.parseHost(e,n))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');e=n.hostname,this._parts.preventInvalidHostname&&r.ensureValidHostname(e,this._parts.protocol)}return S.call(this,e,t)},a.origin=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=this.protocol();return this.authority()?(n?n+"://":"")+this.authority():""}var i=r(e);return this.protocol(i.protocol()).authority(i.authority()).build(!t),this},a.host=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?r.buildHost(this._parts):"";if("/"!==r.parseHost(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},a.authority=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e)return this._parts.hostname?r.buildAuthority(this._parts):"";if("/"!==r.parseAuthority(e,this._parts))throw new TypeError('Hostname "'+e+'" contains characters other than [A-Z0-9.-]');return this.build(!t),this},a.userinfo=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){var n=r.buildUserinfo(this._parts);return n?n.substring(0,n.length-1):n}return"@"!==e[e.length-1]&&(e+="@"),r.parseUserinfo(e,this._parts),this.build(!t),this},a.resource=function(e,t){var n;return void 0===e?this.path()+this.search()+this.hash():(n=r.parse(e),this._parts.path=n.path,this._parts.query=n.query,this._parts.fragment=n.fragment,this.build(!t),this)},a.subdomain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.length-this.domain().length-1;return this._parts.hostname.substring(0,n)||""}var i=this._parts.hostname.length-this.domain().length,o=this._parts.hostname.substring(0,i),a=new RegExp("^"+l(o));if(e&&"."!==e.charAt(e.length-1)&&(e+="."),-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");return e&&r.ensureValidHostname(e,this._parts.protocol),this._parts.hostname=this._parts.hostname.replace(a,e),this.build(!t),this},a.domain=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var n=this._parts.hostname.match(/\./g);if(n&&n.length<2)return this._parts.hostname;var i=this._parts.hostname.length-this.tld(t).length-1;return i=this._parts.hostname.lastIndexOf(".",i-1)+1,this._parts.hostname.substring(i)||""}if(!e)throw new TypeError("cannot set domain empty");if(-1!==e.indexOf(":"))throw new TypeError("Domains cannot contain colons");if(r.ensureValidHostname(e,this._parts.protocol),!this._parts.hostname||this.is("IP"))this._parts.hostname=e;else{var o=new RegExp(l(this.domain())+"$");this._parts.hostname=this._parts.hostname.replace(o,e)}return this.build(!t),this},a.tld=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("boolean"==typeof e&&(t=e,e=void 0),void 0===e){if(!this._parts.hostname||this.is("IP"))return"";var i=this._parts.hostname.lastIndexOf("."),o=this._parts.hostname.substring(i+1);return!0!==t&&n&&n.list[o.toLowerCase()]&&n.get(this._parts.hostname)||o}var r;if(!e)throw new TypeError("cannot set TLD empty");if(e.match(/[^a-zA-Z0-9-]/)){if(!n||!n.is(e))throw new TypeError('TLD "'+e+'" contains characters other than [A-Z0-9]');r=new RegExp(l(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,e)}else{if(!this._parts.hostname||this.is("IP"))throw new ReferenceError("cannot set TLD on non-domain host");r=new RegExp(l(this.tld())+"$"),this._parts.hostname=this._parts.hostname.replace(r,e)}return this.build(!t),this},a.directory=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path&&!this._parts.hostname)return"";if("/"===this._parts.path)return"/";var n=this._parts.path.length-this.filename().length-1,i=this._parts.path.substring(0,n)||(this._parts.hostname?"/":"");return e?r.decodePath(i):i}var o=this._parts.path.length-this.filename().length,a=this._parts.path.substring(0,o),s=new RegExp("^"+l(a));return this.is("relative")||(e||(e="/"),"/"!==e.charAt(0)&&(e="/"+e)),e&&"/"!==e.charAt(e.length-1)&&(e+="/"),e=r.recodePath(e),this._parts.path=this._parts.path.replace(s,e),this.build(!t),this},a.filename=function(e,t){if(this._parts.urn)return void 0===e?"":this;if("string"!=typeof e){if(!this._parts.path||"/"===this._parts.path)return"";var n=this._parts.path.lastIndexOf("/"),i=this._parts.path.substring(n+1);return e?r.decodePathSegment(i):i}var o=!1;"/"===e.charAt(0)&&(e=e.substring(1)),e.match(/\.?\//)&&(o=!0);var a=new RegExp(l(this.filename())+"$");return e=r.recodePath(e),this._parts.path=this._parts.path.replace(a,e),o?this.normalizePath(t):this.build(!t),this},a.suffix=function(e,t){if(this._parts.urn)return void 0===e?"":this;if(void 0===e||!0===e){if(!this._parts.path||"/"===this._parts.path)return"";var n,i,o=this.filename(),a=o.lastIndexOf(".");return-1===a?"":(n=o.substring(a+1),i=/^[a-z0-9%]+$/i.test(n)?n:"",e?r.decodePathSegment(i):i)}"."===e.charAt(0)&&(e=e.substring(1));var s,c=this.suffix();if(c)s=e?new RegExp(l(c)+"$"):new RegExp(l("."+c)+"$");else{if(!e)return this;this._parts.path+="."+r.recodePath(e)}return s&&(e=r.recodePath(e),this._parts.path=this._parts.path.replace(s,e)),this.build(!t),this},a.segment=function(e,t,n){var i=this._parts.urn?":":"/",o=this.path(),r="/"===o.substring(0,1),a=o.split(i);if(void 0!==e&&"number"!=typeof e&&(n=t,t=e,e=void 0),void 0!==e&&"number"!=typeof e)throw new Error('Bad segment "'+e+'", must be 0-based integer');if(r&&a.shift(),e<0&&(e=Math.max(a.length+e,0)),void 0===t)return void 0===e?a:a[e];if(null===e||void 0===a[e])if(u(t)){a=[];for(var s=0,l=t.length;s<l;s++)(t[s].length||a.length&&a[a.length-1].length)&&(a.length&&!a[a.length-1].length&&a.pop(),a.push(h(t[s])))}else(t||"string"==typeof t)&&(t=h(t),""===a[a.length-1]?a[a.length-1]=t:a.push(t));else t?a[e]=h(t):a.splice(e,1);return r&&a.unshift(""),this.path(a.join(i),n)},a.segmentCoded=function(e,t,n){var i,o,a;if("number"!=typeof e&&(n=t,t=e,e=void 0),void 0===t){if(u(i=this.segment(e,t,n)))for(o=0,a=i.length;o<a;o++)i[o]=r.decode(i[o]);else i=void 0!==i?r.decode(i):void 0;return i}if(u(t))for(o=0,a=t.length;o<a;o++)t[o]=r.encode(t[o]);else t="string"==typeof t||t instanceof String?r.encode(t):t;return this.segment(e,t,n)};var j=a.query;return a.query=function(e,t){if(!0===e)return r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("function"==typeof e){var n=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace),i=e.call(this,n);return this._parts.query=r.buildQuery(i||n,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this}return void 0!==e&&"string"!=typeof e?(this._parts.query=r.buildQuery(e,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),this.build(!t),this):j.call(this,e,t)},a.setQuery=function(e,t,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);if("string"==typeof e||e instanceof String)i[e]=void 0!==t?t:null;else{if("object"!=typeof e)throw new TypeError("URI.addQuery() accepts an object, string as the name parameter");for(var o in e)s.call(e,o)&&(i[o]=e[o])}return this._parts.query=r.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},a.addQuery=function(e,t,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.addQuery(i,e,void 0===t?null:t),this._parts.query=r.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},a.removeQuery=function(e,t,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.removeQuery(i,e,t),this._parts.query=r.buildQuery(i,this._parts.duplicateQueryParameters,this._parts.escapeQuerySpace),"string"!=typeof e&&(n=t),this.build(!n),this},a.hasQuery=function(e,t,n){var i=r.parseQuery(this._parts.query,this._parts.escapeQuerySpace);return r.hasQuery(i,e,t,n)},a.setSearch=a.setQuery,a.addSearch=a.addQuery,a.removeSearch=a.removeQuery,a.hasSearch=a.hasQuery,a.normalize=function(){return this._parts.urn?this.normalizeProtocol(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build():this.normalizeProtocol(!1).normalizeHostname(!1).normalizePort(!1).normalizePath(!1).normalizeQuery(!1).normalizeFragment(!1).build()},a.normalizeProtocol=function(e){return"string"==typeof this._parts.protocol&&(this._parts.protocol=this._parts.protocol.toLowerCase(),this.build(!e)),this},a.normalizeHostname=function(n){return this._parts.hostname&&(this.is("IDN")&&e?this._parts.hostname=e.toASCII(this._parts.hostname):this.is("IPv6")&&t&&(this._parts.hostname=t.best(this._parts.hostname)),this._parts.hostname=this._parts.hostname.toLowerCase(),this.build(!n)),this},a.normalizePort=function(e){return"string"==typeof this._parts.protocol&&this._parts.port===r.defaultPorts[this._parts.protocol]&&(this._parts.port=null,this.build(!e)),this},a.normalizePath=function(e){var t,n=this._parts.path;if(!n)return this;if(this._parts.urn)return this._parts.path=r.recodeUrnPath(this._parts.path),this.build(!e),this;if("/"===this._parts.path)return this;var i,o,a="";for("/"!==(n=r.recodePath(n)).charAt(0)&&(t=!0,n="/"+n),"/.."!==n.slice(-3)&&"/."!==n.slice(-2)||(n+="/"),n=n.replace(/(\/(\.\/)+)|(\/\.$)/g,"/").replace(/\/{2,}/g,"/"),t&&(a=n.substring(1).match(/^(\.\.\/)+/)||"")&&(a=a[0]);-1!==(i=n.search(/\/\.\.(\/|$)/));)0!==i?(-1===(o=n.substring(0,i).lastIndexOf("/"))&&(o=i),n=n.substring(0,o)+n.substring(i+3)):n=n.substring(3);return t&&this.is("relative")&&(n=a+n.substring(1)),this._parts.path=n,this.build(!e),this},a.normalizePathname=a.normalizePath,a.normalizeQuery=function(e){return"string"==typeof this._parts.query&&(this._parts.query.length?this.query(r.parseQuery(this._parts.query,this._parts.escapeQuerySpace)):this._parts.query=null,this.build(!e)),this},a.normalizeFragment=function(e){return this._parts.fragment||(this._parts.fragment=null,this.build(!e)),this},a.normalizeSearch=a.normalizeQuery,a.normalizeHash=a.normalizeFragment,a.iso8859=function(){var e=r.encode,t=r.decode;r.encode=escape,r.decode=decodeURIComponent;try{this.normalize()}finally{r.encode=e,r.decode=t}return this},a.unicode=function(){var e=r.encode,t=r.decode;r.encode=v,r.decode=unescape;try{this.normalize()}finally{r.encode=e,r.decode=t}return this},a.readable=function(){var t=this.clone();t.username("").password("").normalize();var n="";if(t._parts.protocol&&(n+=t._parts.protocol+"://"),t._parts.hostname&&(t.is("punycode")&&e?(n+=e.toUnicode(t._parts.hostname),t._parts.port&&(n+=":"+t._parts.port)):n+=t.host()),t._parts.hostname&&t._parts.path&&"/"!==t._parts.path.charAt(0)&&(n+="/"),n+=t.path(!0),t._parts.query){for(var i="",o=0,a=t._parts.query.split("&"),s=a.length;o<s;o++){var l=(a[o]||"").split("=");i+="&"+r.decodeQuery(l[0],this._parts.escapeQuerySpace).replace(/&/g,"%26"),void 0!==l[1]&&(i+="="+r.decodeQuery(l[1],this._parts.escapeQuerySpace).replace(/&/g,"%26"))}n+="?"+i.substring(1)}return n+=r.decodeQuery(t.hash(),!0)},a.absoluteTo=function(e){var t,n,i,o=this.clone(),a=["protocol","username","password","hostname","port"];if(this._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e instanceof r||(e=new r(e)),o._parts.protocol)return o;if(o._parts.protocol=e._parts.protocol,this._parts.hostname)return o;for(n=0;i=a[n];n++)o._parts[i]=e._parts[i];return o._parts.path?(".."===o._parts.path.substring(-2)&&(o._parts.path+="/"),"/"!==o.path().charAt(0)&&(t=(t=e.directory())||(0===e.path().indexOf("/")?"/":""),o._parts.path=(t?t+"/":"")+o._parts.path,o.normalizePath())):(o._parts.path=e._parts.path,o._parts.query||(o._parts.query=e._parts.query)),o.build(),o},a.relativeTo=function(e){var t,n,i,o,a,s=this.clone().normalize();if(s._parts.urn)throw new Error("URNs do not have any generally defined hierarchical components");if(e=new r(e).normalize(),t=s._parts,n=e._parts,o=s.path(),a=e.path(),"/"!==o.charAt(0))throw new Error("URI is already relative");if("/"!==a.charAt(0))throw new Error("Cannot calculate a URI relative to another relative URI");if(t.protocol===n.protocol&&(t.protocol=null),t.username!==n.username||t.password!==n.password)return s.build();if(null!==t.protocol||null!==t.username||null!==t.password)return s.build();if(t.hostname!==n.hostname||t.port!==n.port)return s.build();if(t.hostname=null,t.port=null,o===a)return t.path="",s.build();if(!(i=r.commonPath(o,a)))return s.build();var l=n.path.substring(i.length).replace(/[^\/]*$/,"").replace(/.*?\//g,"../");return t.path=l+t.path.substring(i.length)||"./",s.build()},a.equals=function(e){var t,n,i,o,a,l=this.clone(),c=new r(e),d={};if(l.normalize(),c.normalize(),l.toString()===c.toString())return!0;if(i=l.query(),o=c.query(),l.query(""),c.query(""),l.toString()!==c.toString())return!1;if(i.length!==o.length)return!1;for(a in t=r.parseQuery(i,this._parts.escapeQuerySpace),n=r.parseQuery(o,this._parts.escapeQuerySpace),t)if(s.call(t,a)){if(u(t[a])){if(!p(t[a],n[a]))return!1}else if(t[a]!==n[a])return!1;d[a]=!0}for(a in n)if(s.call(n,a)&&!d[a])return!1;return!0},a.preventInvalidHostname=function(e){return this._parts.preventInvalidHostname=!!e,this},a.duplicateQueryParameters=function(e){return this._parts.duplicateQueryParameters=!!e,this},a.escapeQuerySpace=function(e){return this._parts.escapeQuerySpace=!!e,this},r}))},2901:function(e,t,n){"use strict";n.d(t,"a",(function(){return F}));var i=n(1547),o=n(1159),r=n(849),a=n(850),s=n(2940);function l(e,t){var n=s.c([],t,e);return s.b(n,n,1/n[3]),n}var c=n(2903),u=n(2885),d=n(2934);function g(e,t){if(!e)throw new Error(t||"@math.gl/web-mercator: assertion failed.")}var p=Math.PI,h=p/4,f=p/180,v=180/p;function m(e){return Math.pow(2,e)}function y(e){var t=Object(o.a)(e,2),n=t[0],i=t[1];g(Number.isFinite(n)),g(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude");var r=i*f;return[512*(n*f+p)/(2*p),512*(p+Math.log(Math.tan(h+.5*r)))/(2*p)]}function x(e){var t=Object(o.a)(e,2),n=t[0],i=t[1],r=n/512*(2*p)-p,a=2*(Math.atan(Math.exp(i/512*(2*p)-p))-h);return[r*v,a*v]}function b(e){var t=e.latitude,n=e.longitude,i=e.highPrecision,o=void 0!==i&&i;g(Number.isFinite(t)&&Number.isFinite(n));var r={},a=Math.cos(t*f),s=512/360/a,l=512/4003e4/a;if(r.unitsPerMeter=[l,l,l],r.metersPerUnit=[1/l,1/l,1/l],r.unitsPerDegree=[512/360,s,l],r.degreesPerUnit=[.703125,1/s,1/l],o){var c=f*Math.tan(t*f)/a,u=512/360*c/2,d=512/4003e4*c,p=d/s*l;r.unitsPerDegree2=[0,u,d],r.unitsPerMeter2=[p,0,p]}return r}function P(e){var t=e.height,n=e.pitch,i=e.bearing,o=e.altitude,r=e.scale,a=e.center,s=void 0===a?null:a,l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];return c.o(l,l,[0,0,-o]),c.k(l,l,-n*f),c.m(l,l,i*f),r/=t,c.n(l,l,[r,r,r]),s&&c.o(l,l,d.d([],s)),l}function _(e){var t=e.width,n=e.height,i=e.pitch,o=function(e){var t=e.width,n=e.height,i=e.altitude,o=void 0===i?1.5:i,r=e.pitch,a=void 0===r?0:r,s=e.nearZMultiplier,l=void 0===s?1:s,c=e.farZMultiplier,u=void 0===c?1:c,d=a*f,g=Math.atan(.5/o),p=Math.sin(g)*o/Math.sin(Math.min(Math.max(Math.PI/2-d-g,.01),Math.PI-.01));return{fov:2*g,aspect:t/n,focalDistance:o,near:l,far:(Math.sin(d)*p+o)*u}}({width:t,height:n,altitude:e.altitude,pitch:i,nearZMultiplier:e.nearZMultiplier,farZMultiplier:e.farZMultiplier}),r=o.fov,a=o.aspect,s=o.near,l=o.far;return c.i([],r,a,s,l)}function w(e,t){var n=Object(o.a)(e,3),i=n[0],r=n[1],a=n[2],s=void 0===a?0:a;return g(Number.isFinite(i)&&Number.isFinite(r)&&Number.isFinite(s)),l(t,[i,r,s,1])}function C(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=Object(o.a)(e,3),r=i[0],a=i[1],s=i[2];if(g(Number.isFinite(r)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(s)){var c=l(t,[r,a,s,1]);return c}var d=l(t,[r,a,0,1]),p=l(t,[r,a,1,1]),h=d[2],f=p[2],v=h===f?0:((n||0)-h)/(f-h);return u.d([],d,p,v)}function S(e){var t=e.width,n=e.height,i=e.bounds,r=e.minExtent,a=void 0===r?0:r,s=e.maxZoom,l=void 0===s?24:s,c=e.padding,u=void 0===c?0:c,d=e.offset,p=void 0===d?[0,0]:d,h=Object(o.a)(i,2),f=Object(o.a)(h[0],2),v=f[0],m=f[1],y=Object(o.a)(h[1],2),x=y[0],b=y[1];if(Number.isFinite(u)){u={top:u,bottom:u,left:u,right:u}}else g(Number.isFinite(u.top)&&Number.isFinite(u.bottom)&&Number.isFinite(u.left)&&Number.isFinite(u.right));var P=new A({width:t,height:n,longitude:0,latitude:0,zoom:0}),_=P.project([v,b]),w=P.project([x,m]),C=[Math.max(Math.abs(w[0]-_[0]),a),Math.max(Math.abs(w[1]-_[1]),a)],S=[t-u.left-u.right-2*Math.abs(p[0]),n-u.top-u.bottom-2*Math.abs(p[1])];g(S[0]>0&&S[1]>0);var j=S[0]/C[0],k=S[1]/C[1],M=(u.right-u.left)/2/j,O=(u.bottom-u.top)/2/k,L=[(w[0]+_[0])/2+M,(w[1]+_[1])/2+O],E=P.unproject(L),z=Math.min(l,P.zoom+Math.log2(Math.abs(Math.min(j,k))));return g(Number.isFinite(z)),{longitude:E[0],latitude:E[1],zoom:z}}var j=Math.PI/180;function k(e){var t,n,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=e.width,r=e.height,a=e.unproject,s={targetZ:i},l=a([0,r],s),c=a([o,r],s),u=Math.atan(.5/e.altitude),d=(90-e.pitch)*j;return u>d-.01?(t=M(e,0,i),n=M(e,o,i)):(t=a([0,0],s),n=a([o,0],s)),[l,c,n,t]}function M(e,t,n){var i=e.pixelUnprojectionMatrix,o=l(i,[t,0,1,1]),r=l(i,[t,e.height,1,1]),a=(n*e.distanceScales.unitsPerMeter[2]-o[2])/(r[2]-o[2]),s=x(u.d([],o,r,a));return s[2]=n,s}var A=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{width:1,height:1},n=t.width,i=t.height,o=t.latitude,a=void 0===o?0:o,s=t.longitude,l=void 0===s?0:s,c=t.zoom,u=void 0===c?0:c,d=t.pitch,g=void 0===d?0:d,p=t.bearing,h=void 0===p?0:p,f=t.altitude,v=void 0===f?1.5:f,x=t.nearZMultiplier,w=void 0===x?.02:x,C=t.farZMultiplier,S=void 0===C?1.01:C;Object(r.a)(this,e),n=n||1,i=i||1;var j=m(u);v=Math.max(.75,v);var k=y([l,a]);k[2]=0,this.projectionMatrix=_({width:n,height:i,pitch:g,altitude:v,nearZMultiplier:w,farZMultiplier:S}),this.viewMatrix=P({height:i,scale:j,center:k,pitch:g,bearing:h,altitude:v}),this.width=n,this.height=i,this.scale=j,this.latitude=a,this.longitude=l,this.zoom=u,this.pitch=g,this.bearing=h,this.altitude=v,this.center=k,this.distanceScales=b(this),this._initMatrices(),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),Object.freeze(this)}return Object(a.a)(e,[{key:"_initMatrices",value:function(){var e=this.width,t=this.height,n=this.projectionMatrix,i=this.viewMatrix,o=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.g(o,o,n),c.g(o,o,i),this.viewProjectionMatrix=o;var r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];c.n(r,r,[e/2,-t/2,1]),c.o(r,r,[1,-1,0]),c.g(r,r,o);var a=c.e([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],r);if(!a)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=r,this.pixelUnprojectionMatrix=a}},{key:"equals",value:function(t){return t instanceof e&&(t.width===this.width&&t.height===this.height&&c.b(t.projectionMatrix,this.projectionMatrix)&&c.b(t.viewMatrix,this.viewMatrix))}},{key:"project",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,i=void 0===n||n,r=this.projectPosition(e),a=w(r,this.pixelProjectionMatrix),s=Object(o.a)(a,2),l=s[0],c=s[1],u=i?c:this.height-c;return 2===e.length?[l,u]:[l,u,a[2]]}},{key:"unproject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.topLeft,i=void 0===n||n,r=t.targetZ,a=void 0===r?void 0:r,s=Object(o.a)(e,3),l=s[0],c=s[1],u=s[2],d=i?c:this.height-c,g=a&&a*this.distanceScales.unitsPerMeter[2],p=C([l,d,u],this.pixelUnprojectionMatrix,g),h=this.unprojectPosition(p),f=Object(o.a)(h,3),v=f[0],m=f[1],y=f[2];return Number.isFinite(u)?[v,m,y]:Number.isFinite(a)?[v,m,a]:[v,m]}},{key:"projectPosition",value:function(e){var t=y(e),n=Object(o.a)(t,2);return[n[0],n[1],(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}},{key:"unprojectPosition",value:function(e){var t=x(e),n=Object(o.a)(t,2);return[n[0],n[1],(e[2]||0)*this.distanceScales.metersPerUnit[2]]}},{key:"projectFlat",value:function(e){return y(e)}},{key:"unprojectFlat",value:function(e){return x(e)}},{key:"getMapCenterByLngLatPosition",value:function(e){var t=e.lngLat,n=C(e.pos,this.pixelUnprojectionMatrix),i=y(t),o=u.a([],i,u.e([],n));return x(u.a([],this.center,o))}},{key:"getLocationAtPoint",value:function(e){var t=e.lngLat,n=e.pos;return this.getMapCenterByLngLatPosition({lngLat:t,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=this.width,o=this.height,r=S(Object.assign({width:i,height:o,bounds:t},n)),a=r.longitude,s=r.latitude,l=r.zoom;return new e({width:i,height:o,longitude:a,latitude:s,zoom:l})}},{key:"getBounds",value:function(e){var t=this.getBoundingRegion(e),n=Math.min.apply(Math,Object(i.a)(t.map((function(e){return e[0]})))),o=Math.max.apply(Math,Object(i.a)(t.map((function(e){return e[0]}))));return[[n,Math.min.apply(Math,Object(i.a)(t.map((function(e){return e[1]}))))],[o,Math.max.apply(Math,Object(i.a)(t.map((function(e){return e[1]}))))]]}},{key:"getBoundingRegion",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return k(this,e.z||0)}}]),e}();var O=n(172);const L=[-90,90],E=[-180,180];function z([e,t],[n,i],o=.25){return e<t?[e,t]:[Math.max(n,e-o),Math.min(i,t+o)]}function F(e,{points:t,width:n,height:i,minExtent:o,maxZoom:r,offset:a,padding:s=20}){const{bearing:l,pitch:c}=e,u=function(e){const t=z(Object(O.extent)(e,e=>e[1]),L),n=z(Object(O.extent)(e,e=>e[0]),E);return[[n[0],t[0]],[n[1],t[1]]]}(t);try{return{...S({bounds:u,width:n,height:i,minExtent:o,maxZoom:r,offset:a,padding:s}),bearing:l,pitch:c}}catch(e){console.error("Could not fit viewport",e)}return e}},2915:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var i=n(15),o=n.n(i);const r=[1,0,1,0,0,0,0];function a(e,t){const n=parseInt(o()(t).format("x"),10);return parseInt(o()(t).add(e).format("x"),10)-n}function s(e,t){const n=o()(Math.min(...e)),i=o()(Math.max(...e));let s,l,c;if(t.includes("/")){const e=t.split("/",2);e[0].endsWith("Z")?(l=o()(e[0]),s=o.a.duration(e[1])):(l=o()(e[1]),s=o.a.duration(e[0]))}else s=o.a.duration(t),l=function(e,t){const n=o()(e).subtract(t),i=e.toArray(),a=n.toArray(),s=i.map((e,t)=>a[t]!==e).indexOf(!0),l=i.map((e,t)=>{if(t===s){const n=e-a[t];return e-(e-r[t])%n}return t<s||-1===s?e:r[t]});return o()(l)}(n,s);const u=n.valueOf();for(c=l.clone();c.valueOf()<u;)c.add(s);for(;c.valueOf()>u;)c.subtract(s);let d;const g=i.valueOf();for(d=l.clone();d.valueOf()>g;)d.subtract(s);for(;d.valueOf()<g;)d.add(s);const p=null!=t?[c,c.clone().add(s)]:[c,d],h=e.every(e=>null===e);return{start:parseInt(c.format("x"),10),end:parseInt(d.format("x"),10),getStep:a.bind(this,s),values:p.map(e=>parseInt(e.format("x"),10)),disabled:h}}},2916:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return s}));var i={SUM:1,MEAN:2,MIN:3,MAX:4};function o(e,t){return e+t}function r(e,t){return t>e?t:e}function a(e,t){return t<e?t:e}function s(e,t){switch(i[e.toUpperCase()]||i.SUM){case i.MIN:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(a,1/0):null}(e,t)};case i.SUM:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(o,0):null}(e,t)};case i.MEAN:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(o,0)/n.length:null}(e,t)};case i.MAX:return function(e){return function(e,t){var n=e.map(t).filter(Number.isFinite);return n.length?n.reduce(r,-1/0):null}(e,t)};default:return null}}},2918:function(e,t,n){"use strict";n.d(t,"a",(function(){return y}));var i=n(0),o=n.n(i),r=n(2),a=n.n(r),s=n(2917),l=n(780),c=n.n(l),u=n(7),d=n(1038),g=n.n(d);n(1160),n(2925);function p(e){return o.a.createElement("span",{className:"BootstrapSliderWrapper"},o.a.createElement(g.a,e))}n(2926);const h={start:a.a.number.isRequired,step:a.a.number.isRequired,end:a.a.number.isRequired,values:a.a.array.isRequired,onChange:a.a.func,loopDuration:a.a.number,maxFrames:a.a.number,orientation:a.a.oneOf(["horizontal","vertical"]),reversed:a.a.bool,disabled:a.a.bool,range:a.a.bool};class f extends o.a.PureComponent{constructor(e){super(e),this.state={intervalId:null};const t=e.end-e.start,n=Math.min(e.maxFrames,t/e.step),i=t/n;this.intervalMilliseconds=e.loopDuration/n,this.increment=i<e.step?e.step:i-i%e.step,this.onChange=this.onChange.bind(this),this.play=this.play.bind(this),this.pause=this.pause.bind(this),this.stepBackward=this.stepBackward.bind(this),this.stepForward=this.stepForward.bind(this),this.getPlayClass=this.getPlayClass.bind(this),this.formatter=this.formatter.bind(this)}componentDidMount(){c.a.bind(["space"],this.play)}componentWillUnmount(){c.a.unbind(["space"])}onChange(e){this.props.onChange(e.target.value),null!=this.state.intervalId&&this.pause()}getPlayClass(){return null==this.state.intervalId?"fa fa-play fa-lg slider-button":"fa fa-pause fa-lg slider-button"}play(){if(!this.props.disabled)if(null!=this.state.intervalId)this.pause();else{const e=setInterval(this.stepForward,this.intervalMilliseconds);this.setState({intervalId:e})}}pause(){clearInterval(this.state.intervalId),this.setState({intervalId:null})}stepForward(){const{start:e,end:t,step:n,values:i,disabled:o}=this.props;if(o)return;const r=(Array.isArray(i)?i:[i,i+n]).map(e=>e+this.increment),a=r[1]>t?r[0]-e:0;this.props.onChange(r.map(e=>e-a))}stepBackward(){const{start:e,end:t,step:n,values:i,disabled:o}=this.props;if(o)return;const r=(Array.isArray(i)?i:[i,i+n]).map(e=>e-this.increment),a=r[0]<e?t-r[1]:0;this.props.onChange(r.map(e=>e+a))}formatter(e){if(this.props.disabled)return Object(u.c)("Data has no time steps");let t=e;return Array.isArray(e)?e[0]===e[1]&&(t=[e[0]]):t=[e],t.map(e=>new Date(e).toUTCString()).join(" : ")}render(){const{start:e,end:t,step:n,orientation:i,reversed:r,disabled:a,range:s,values:l}=this.props;return(o.a.createElement("div",{className:"play-slider"},o.a.createElement("div",{className:"play-slider-controls padded"},o.a.createElement("i",{className:"fa fa-step-backward fa-lg slider-button ",onClick:this.stepBackward}),o.a.createElement("i",{className:this.getPlayClass(),onClick:this.play}),o.a.createElement("i",{className:"fa fa-step-forward fa-lg slider-button ",onClick:this.stepForward})),o.a.createElement("div",{className:"play-slider-scrobbler padded"},o.a.createElement(p,{value:s?l:l[0],range:s,formatter:this.formatter,change:this.onChange,min:e,max:t,step:n,orientation:i,reversed:r,disabled:a?"disabled":"enabled"}))))}}function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}f.propTypes=h,f.defaultProps={onChange:()=>{},loopDuration:15e3,maxFrames:100,orientation:"horizontal",reversed:!1,disabled:!1,range:!0};const m={getLayers:a.a.func.isRequired,start:a.a.number.isRequired,end:a.a.number.isRequired,getStep:a.a.func,values:a.a.array.isRequired,aggregation:a.a.bool,disabled:a.a.bool,viewport:a.a.object.isRequired,children:a.a.node,mapStyle:a.a.string,mapboxApiAccessToken:a.a.string.isRequired,setControlValue:a.a.func,onValuesChange:a.a.func,width:a.a.number.isRequired,height:a.a.number.isRequired};class y extends o.a.PureComponent{constructor(...e){super(...e),v(this,"containerRef",o.a.createRef()),v(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})}render(){const{start:e,end:t,getStep:n,disabled:i,aggregation:r,children:a,getLayers:l,values:c,onValuesChange:u,viewport:d,setControlValue:g,mapStyle:p,mapboxApiAccessToken:h,height:v,width:m}=this.props,y=l(c);return o.a.createElement("div",null,o.a.createElement(s.a,{ref:this.containerRef,viewport:d,layers:y,setControlValue:g,mapStyle:p,mapboxApiAccessToken:h,bottomMargin:i?0:20,width:m,height:v}),!i&&o.a.createElement(f,{start:e,end:t,step:n(e),values:c,range:!r,onChange:u}),a)}}y.propTypes=m,y.defaultProps={aggregation:!1,disabled:!1,mapStyle:"light",setControlValue:()=>{},onValuesChange:()=>{}}},2925:function(e,t,n){},2926:function(e,t,n){},2932:function(e,t,n){"use strict";n.d(t,"b",(function(){return w})),n.d(t,"a",(function(){return C}));var i=n(0),o=n.n(i),r=n(2),a=n.n(r),s=n(340),l=n(2917),c=n(462),u=n(2918),d=n(2935),g=n(2949),p=n(2915),h=n(2913),f=n(2901);function v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const{getScale:m}=c.b;const y={formData:a.a.object.isRequired,mapboxApiKey:a.a.string.isRequired,setControlValue:a.a.func.isRequired,viewport:a.a.object.isRequired,getLayer:a.a.func.isRequired,getPoints:a.a.func.isRequired,payload:a.a.object.isRequired,onAddFilter:a.a.func,width:a.a.number.isRequired,height:a.a.number.isRequired};class x extends o.a.PureComponent{constructor(e){super(e),v(this,"containerRef",o.a.createRef()),v(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState({...this.getStateFromProps(e)})}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const n=e.payload.data.features||[],i=n.map(e=>e.__timestamp),o=function(e,t){const n=e.color_picker||{r:0,g:0,b:0,a:1},i=[n.r,n.g,n.b,255*n.a],o=m(e.color_scheme),r={};return t.forEach(t=>{if(null!=t.cat_color&&!r.hasOwnProperty(t.cat_color)){let a;a=e.dimension?Object(g.hexToRGB)(o(t.cat_color),255*n.a):i,r[t.cat_color]={color:a,enabled:!0}}}),r}(e.formData,n);if(t&&e.payload.form_data===t.formData)return{...t,categories:o};const r=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:a,end:s,getStep:l,values:c,disabled:u}=Object(p.a)(i,r),{width:d,height:h,formData:v}=e;let{viewport:y}=e;return v.autozoom&&(y=Object(f.a)(y,{width:d,height:h,points:e.getPoints(n)})),{start:a,end:s,getStep:l,values:c,disabled:u,viewport:y,selected:[],lastClick:0,formData:e.payload.form_data,categories:o}}getLayers(e){const{getLayer:t,payload:n,formData:i,onAddFilter:o}=this.props;let r=n.data.features?[...n.data.features]:[];if(r=this.addColor(r,i),i.js_data_mutator){r=Object(h.a)(i.js_data_mutator)(r)}r=e[0]===e[1]||e[1]===this.end?r.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):r.filter(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]);const a=this.state.categories;return i.dimension&&(r=r.filter(e=>a[e.cat_color]&&a[e.cat_color].enabled)),[t(i,{...n,data:{...n.data,features:r}},o,this.setTooltip)]}addColor(e,t){const n=t.color_picker||{r:0,g:0,b:0,a:1},i=m(t.color_scheme);return e.map(e=>{let o;return t.dimension?(o=Object(g.hexToRGB)(i(e.cat_color),255*n.a),{...e,color:o}):e})}toggleCategory(e){const t=this.state.categories[e],n={...this.state.categories,[e]:{...t,enabled:!t.enabled}};Object.values(n).every(e=>!e.enabled)&&Object.values(n).forEach(e=>{e.enabled=!0}),this.setState({categories:n})}showSingleCategory(e){const t={...this.state.categories};Object.values(t).forEach(e=>{e.enabled=!1}),t[e].enabled=!0,this.setState({categories:t})}render(){return o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(u.a,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},o.a.createElement(d.a,{categories:this.state.categories,toggleCategory:this.toggleCategory,showSingleCategory:this.showSingleCategory,position:this.props.formData.legend_position,format:this.props.formData.legend_format})))}}function b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}x.propTypes=y;const P={formData:a.a.object.isRequired,payload:a.a.object.isRequired,setControlValue:a.a.func.isRequired,viewport:a.a.object.isRequired,onAddFilter:a.a.func,width:a.a.number.isRequired,height:a.a.number.isRequired},_={onAddFilter(){}};function w(e,t){class n extends o.a.PureComponent{constructor(e){super(e),b(this,"containerRef",o.a.createRef()),b(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)});const{width:n,height:i,formData:r}=e;let{viewport:a}=e;r.autozoom&&(a=Object(f.a)(a,{width:n,height:i,points:t(e.payload.data.features)})),this.state={viewport:a,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t={...e.formData,viewport:null},n={...this.props.formData,viewport:null};Object(s.isEqual)(t,n)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(t){const{formData:n,payload:i,onAddFilter:o}=t;return e(n,i,o,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:n,height:i,width:r}=this.props,{layer:a,viewport:s}=this.state;return o.a.createElement(l.a,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:s,layers:[a],mapStyle:e.mapbox_style,setControlValue:n,width:r,height:i,onViewportChange:this.onViewportChange})}}return n.propTypes=P,n.defaultProps=_,n}function C(e,t){function n(n){const{formData:i,payload:r,setControlValue:a,viewport:s,width:l,height:c}=n;return(o.a.createElement(x,{formData:i,mapboxApiKey:r.data.mapboxApiKey,setControlValue:a,viewport:s,getLayer:e,payload:r,getPoints:t,width:l,height:c}))}return n.propTypes=P,n.defaultProps=_,n}},2935:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(0),o=n.n(i),r=n(2),a=n.n(r),s=n(427);n(2941);const l={categories:a.a.object,toggleCategory:a.a.func,showSingleCategory:a.a.func,format:a.a.string,position:a.a.oneOf([null,"tl","tr","bl","br"])};class c extends o.a.PureComponent{format(e){if(!this.props.format)return e;const t=parseFloat(e);return Object(s.b)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(" - ")){const t=e.split(" - ");return this.format(t[0])+" - "+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map(([e,t])=>{const n={color:"rgba("+t.color.join(", ")+")"},i=t.enabled?"◼":"◻";return o.a.createElement("li",{key:e},o.a.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},o.a.createElement("span",{style:n},i)," ",this.formatCategoryLabel(e)))}),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return o.a.createElement("div",{className:"legend",style:t},o.a.createElement("ul",{className:"categories"},e))}}c.propTypes=l,c.defaultProps={categories:{},toggleCategory:()=>{},showSingleCategory:()=>{},format:null,position:"tr"}},2941:function(e,t,n){},2942:function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var i=[[255,255,178],[254,217,118],[254,178,76],[253,141,60],[240,59,32],[189,0,38]];function o(e,t,n){var i=new t(4*e.length);return e.forEach((function(e,t){var o=4*t;i[o]=e[0],i[o+1]=e[1],i[o+2]=e[2],i[o+3]=Number.isFinite(e[3])?e[3]:n})),i}},2985:function(e,t,n){"use strict";n.d(t,"a",(function(){return N}));var i,o=n(158),r=n(1159),a=n(849),s=n(850),l=n(4316),c=n(4282),u=n(4283),d=n(3481),g=n(2988),p=n(4262),h=n(3426),f=n(4309),v=n(4285),m=n(2904),y=n(3129),x=n(2916),b={dataChanged:!0,viewportChanged:!0,cellSizeChanged:!0},P={changeFlags:b,projectPoints:!1,useGPU:!0,fp64:!1,viewport:null,gridTransformMatrix:null,createBufferObjects:!0},_=[32775,32774],w=[32776,32774],C=[32776,32775],S=(i={},Object(o.a)(i,x.a.SUM,32774),Object(o.a)(i,x.a.MEAN,32774),Object(o.a)(i,x.a.MIN,_),Object(o.a)(i,x.a.MAX,w),i),j={size:1,operation:x.a.SUM,needMin:!1,needMax:!1,combineMaxMin:!1},k=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],M="#define SHADER_NAME gpu-aggregation-to-grid-vs\n\nattribute vec2 positions;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform mat4 uProjectionMatrix;\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvec2 project_to_pixel(vec4 pos) {\n  vec4 result =  uProjectionMatrix * pos;\n  return result.xy/result.w;\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec4 windowPos = vec4(positions, 0, 1.);\n  if (projectPoints) {\n    windowPos = project_position_to_clipspace(vec3(positions, 0), vec2(0, 0), vec3(0, 0, 0));\n  }\n\n  vec2 pos = project_to_pixel(windowPos);\n  pos = floor(pos / cellSize);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",A="#define SHADER_NAME gpu-aggregation-to-grid-vs-64\n\nattribute vec2 positions;\nattribute vec2 positions64xyLow;\nattribute vec3 weights;\nuniform vec2 windowSize;\nuniform vec2 cellSize;\nuniform vec2 gridSize;\nuniform vec2 uProjectionMatrixFP64[16];\nuniform bool projectPoints;\n\nvarying vec3 vWeights;\n\nvoid project_to_pixel(vec2 pos, vec2 pos64xyLow, out vec2 pixelXY64[2]) {\n\n  vec2 result64[4];\n  vec2 position64[4];\n  position64[0] = vec2(pos.x, pos64xyLow.x);\n  position64[1] = vec2(pos.y, pos64xyLow.y);\n  position64[2] = vec2(0., 0.);\n  position64[3] = vec2(1., 0.);\n  mat4_vec4_mul_fp64(uProjectionMatrixFP64, position64,\n  result64);\n\n  pixelXY64[0] = div_fp64(result64[0], result64[3]);\n  pixelXY64[1] = div_fp64(result64[1], result64[3]);\n}\n\nvoid main(void) {\n\n  vWeights = weights;\n\n  vec2 windowPos = positions;\n  vec2 windowPos64xyLow = positions64xyLow;\n  if (projectPoints) {\n    vec2 projectedXY[2];\n    project_position_fp64(windowPos, windowPos64xyLow, projectedXY);\n    windowPos.x = projectedXY[0].x;\n    windowPos.y = projectedXY[1].x;\n    windowPos64xyLow.x = projectedXY[0].y;\n    windowPos64xyLow.y = projectedXY[1].y;\n  }\n\n  vec2 pixelXY64[2];\n  project_to_pixel(windowPos, windowPos64xyLow, pixelXY64);\n  vec2 gridXY64[2];\n  gridXY64[0] = div_fp64(pixelXY64[0], vec2(cellSize.x, 0));\n  gridXY64[1] = div_fp64(pixelXY64[1], vec2(cellSize.y, 0));\n  float x = floor(gridXY64[0].x);\n  float y = floor(gridXY64[1].x);\n  vec2 pos = vec2(x, y);\n  pos = (pos * (2., 2.) / (gridSize)) - (1., 1.);\n  vec2 offset = 1.0 / gridSize;\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n}\n",O="#define SHADER_NAME gpu-aggregation-to-grid-fs\n\nprecision highp float;\n\nvarying vec3 vWeights;\n\nvoid main(void) {\n  gl_FragColor = vec4(vWeights, 1.0);\n}\n",L=n(3224),E=n(3046);function z(e,t){var n,i=t.width,r=void 0===i?1:i,a=t.height,s=void 0===a?1:a;return new L.a(e,{data:null,format:34836,type:5126,border:0,mipmaps:!1,parameters:(n={},Object(o.a)(n,10240,9728),Object(o.a)(n,10241,9728),n),dataFormat:6408,width:r,height:s})}function F(e,t){var n=t.id,i=t.width,r=void 0===i?1:i,a=t.height,s=void 0===a?1:a,l=t.texture;return new E.a(e,{id:n,width:r,height:s,attachments:Object(o.a)({},36064,l)})}function D(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return!e||e.length<t?new Float32Array(t).fill(n):e}var R=l.a.fp64ifyMatrix4,T=["aggregationBuffer","maxMinBuffer","minBuffer","maxBuffer"],I={maxData:"maxBuffer",minData:"minBuffer",maxMinData:"maxMinBuffer"},N=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Object(a.a)(this,e),this.id=n.id||"gpu-grid-aggregator",this.shaderCache=n.shaderCache||null,this.gl=t,this.state={weights:null,gridPositions:null,positionsBuffer:null,positions64xyLowBuffer:null,vertexCount:0,fp64:null,useGPU:null,numCol:0,numRow:0,windowSize:null,cellSize:null,weightAttributes:{},textures:{},meanTextures:{},buffers:{},framebuffers:{},maxMinFramebuffers:{},minFramebuffers:{},maxFramebuffers:{},equations:{},resources:{},results:{}},this._hasGPUSupport=Object(c.d)(t)&&Object(u.c)(this.gl,d.a.BLEND_EQUATION_MINMAX,d.a.COLOR_ATTACHMENT_RGBA32F,d.a.TEXTURE_FLOAT)}return Object(s.a)(e,null,[{key:"getAggregationData",value:function(e){var t=e.aggregationData,n=e.maxData,i=e.minData,o=e.maxMinData,r=4*e.pixelIndex,a={};return t&&(a.cellCount=t[r+3],a.cellWeight=t[r]),o?(a.maxCellWieght=o[0],a.minCellWeight=o[3]):(n&&(a.maxCellWieght=n[0],a.totalCount=n[3]),i&&(a.minCellWeight=i[0],a.totalCount=n[3])),a}},{key:"getCellData",value:function(e){for(var t=e.countsData,n=e.size,i=void 0===n?1:n,o=t.length/4,r=new Float32Array(o*i),a=new Uint32Array(o),s=0;s<o;s++){for(var l=0;l<i;l++)r[s*i+l]=t[4*s+l];a[s]=t[4*s+3]}return{cellCounts:a,cellWeights:r}}},{key:"isSupported",value:function(e){return Object(c.d)(e)&&Object(u.c)(e,d.a.BLEND_EQUATION_MINMAX,d.a.COLOR_ATTACHMENT_RGBA32F,d.a.TEXTURE_FLOAT)}}]),Object(s.a)(e,[{key:"delete",value:function(){var e=this.gridAggregationModel,t=this.allAggregationModel,n=this.meanTransform,i=this.state,o=i.positionsBuffer,r=i.positions64xyLowBuffer,a=i.textures,s=i.framebuffers,l=i.maxMinFramebuffers,c=i.minFramebuffers,u=i.maxFramebuffers,d=i.meanTextures,g=i.resources;e&&e.delete(),t&&t.delete(),n&&n.delete(),o&&o.delete(),r&&r.delete(),this.deleteResources([s,a,l,c,u,d,g])}},{key:"run",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setState({results:{}});var t=this.getAggregationParams(e);this.updateGridSize(t);var n=t.useGPU;return this._hasGPUSupport&&n?this.runAggregationOnGPU(t):(n&&m.a.info("GPUGridAggregator: GPU Aggregation not supported, falling back to CPU")(),this.runAggregationOnCPU(t))}},{key:"getData",value:function(e){var t={},n=this.state.results;for(var i in n[e].aggregationData||(n[e].aggregationData=n[e].aggregationBuffer.getData()),t.aggregationData=n[e].aggregationData,I){var o=I[i];(n[e][i]||n[e][o])&&(n[e][i]=n[e][i]||n[e][o].getData(),t[i]=n[e][i])}return t}},{key:"deleteResources",value:function(e){(e=Array.isArray(e)?e:[e]).forEach((function(e){for(var t in e)e[t].delete()}))}},{key:"getAggregationParams",value:function(e){var t=Object.assign({},P,e),n=t.useGPU,i=t.gridTransformMatrix,o=t.viewport,r=t.weights,a=t.projectPoints,s=t.cellSize;return this.state.useGPU!==n&&(t.changeFlags=Object.assign({},t.changeFlags,b)),!s||this.state.cellSize&&this.state.cellSize[0]===s[0]&&this.state.cellSize[1]===s[1]||(t.changeFlags.cellSizeChanged=!0,this.setState({cellSize:s})),this.validateProps(t,e),this.setState({useGPU:n}),t.gridTransformMatrix=(a?o.viewportMatrix:i)||k,r&&(t.weights=this.normalizeWeightParams(r),this.setState({weights:t.weights})),t}},{key:"normalizeWeightParams",value:function(e){var t={};for(var n in e)t[n]=Object.assign({},j,e[n]);return t}},{key:"setState",value:function(e){Object.assign(this.state,e)}},{key:"shouldTransformToGrid",value:function(e){var t=e.projectPoints,n=e.changeFlags;return!!(!this.state.gridPositions||n.dataChanged||t&&n.viewportChanged)}},{key:"updateGridSize",value:function(e){var t=e.viewport,n=e.cellSize,i=e.width||t.width,o=e.height||t.height,r=Math.ceil(i/n[0]),a=Math.ceil(o/n[1]);this.setState({numCol:r,numRow:a,windowSize:[i,o]})}},{key:"validateProps",value:function(e,t){var n=e.changeFlags,i=e.projectPoints,o=e.gridTransformMatrix;m.a.assert(n.dataChanged||n.viewportChanged||n.cellSizeChanged),m.a.assert(!n.dataChanged||t.positions&&t.weights&&(!t.projectPositions||t.viewport)&&t.cellSize),m.a.assert(!n.cellSizeChanged||t.cellSize),m.a.assert(!(n.viewportChanged&&i)||t.viewport),i&&o&&m.a.warn("projectPoints is true, gridTransformMatrix is ignored")()}},{key:"calculateAggregationData",value:function(e){var t=e.weights,n=e.results,i=e.cellIndex,o=e.posIndex;for(var r in t){for(var a=t[r],s=a.values,l=a.size,c=a.operation,u=n[r].aggregationData,d=0;d<l;d++){var g=i+d,p=s[3*o+d];if(0===u[i+3])u[g]=p;else switch(c){case x.a.SUM:case x.a.MEAN:u[g]+=p;break;case x.a.MIN:u[g]=Math.min(u[g],p);break;case x.a.MAX:u[g]=Math.max(u[g],p);break;default:m.a.assert(!1)}}u[i+3]++}}},{key:"calculateMeanMaxMinData",value:function(e){var t=e.validCellIndices,n=e.results,i=e.weights;t.forEach((function(e){for(var t in n){for(var o=i[t],r=o.size,a=o.needMin,s=o.needMax,l=o.operation,c=n[t],u=c.aggregationData,d=c.minData,g=c.maxData,p=c.maxMinData,h=a||s,f=l===x.a.MEAN,v=a&&s&&i[t].combineMaxMin,m=u[e+4-1],y=0;y<r&&(h||f);y++){var b=e+y,P=u[b];f&&(u[b]/=m,P=u[b]),v?p[y]=Math.max(p[y],P):(a&&(d[y]=Math.min(d[y],P)),s&&(g[y]=Math.max(g[y],P)))}v?p[3]=Math.min(p[3],u[e+0]):(a&&(d[3]+=m),s&&(g[3]+=m))}}))}},{key:"initCPUResults",value:function(e){var t=e.weights||this.state.weights,n=this.state,i=n.numCol,o=n.numRow,r={};for(var a in t){var s=t[a],l=s.aggregationData,c=s.minData,u=s.maxData,d=s.maxMinData,g=t[a],p=g.needMin,h=g.needMax,f=p&&h&&t[a].combineMaxMin;l=D(l,i*o*4),f?((d=D(d,4)).fill(-1/0,0,3),d[3]=1/0):(p&&((c=D(c,4,1/0))[3]=0),h&&((u=D(u,4,-1/0))[3]=0)),r[a]=Object.assign({},t[a],{aggregationData:l,minData:c,maxData:u,maxMinData:d})}return r}},{key:"runAggregationOnCPU",value:function(e){var t,n,i=e.positions,o=e.cellSize,a=e.gridTransformMatrix,s=e.viewport,l=e.projectPoints,c=e.weights,u=this.state,d=u.numCol,g=u.numRow,p=this.initCPUResults(e),h=this.shouldTransformToGrid(e),f=[0,0,0];m.a.assert(h||e.changeFlags.cellSizeChanged),h?(n=i.length/2,t=new Float64Array(i.length),this.setState({gridPositions:t})):(t=this.state.gridPositions,c=this.state.weights,n=t.length/2);for(var v=new Set,x=0;x<n;x++){var b=void 0,P=void 0;if(h){if(f[0]=i[2*x],f[1]=i[2*x+1],l){var _=s.project(f),w=Object(r.a)(_,2);b=w[0],P=w[1]}else{var C=Object(y.k)(f,a),S=Object(r.a)(C,2);b=S[0],P=S[1]}t[2*x]=b,t[2*x+1]=P}else b=t[2*x],P=t[2*x+1];var j=Math.floor(b/o[0]),k=Math.floor(P/o[1]);if(j>=0&&j<d&&k>=0&&k<g){var M=4*(j+k*d);v.add(M),this.calculateAggregationData({weights:c,results:p,cellIndex:M,posIndex:x})}}return this.calculateMeanMaxMinData({validCellIndices:v,results:p,weights:c}),this.updateAggregationBuffers(e,p),this.setState({results:p}),p}},{key:"updateCPUResultBuffer",value:function(e){var t=e.gl,n=e.bufferName,i=e.id,o=e.data,r=e.result,a=this.state.resources,s="cpu-result-".concat(i,"-").concat(n);r[n]=r[n]||a[s],r[n]?r[n].setData({data:o}):(a[s]=new g.a(t,o),r[n]=a[s])}},{key:"updateAggregationBuffers",value:function(e,t){if(e.createBufferObjects){var n=e.weights||this.state.weights;for(var i in t){var o=t[i],r=o.aggregationData,a=o.minData,s=o.maxData,l=o.maxMinData,c=n[i],u=c.needMin,d=c.needMax,g=u&&d&&n[i].combineMaxMin;this.updateCPUResultBuffer({gl:this.gl,bufferName:"aggregationBuffer",id:i,data:r,result:t[i]}),g?this.updateCPUResultBuffer({gl:this.gl,bufferName:"maxMinBuffer",id:i,data:l,result:t[i]}):(u&&this.updateCPUResultBuffer({gl:this.gl,bufferName:"minBuffer",id:i,data:a,result:t[i]}),d&&this.updateCPUResultBuffer({gl:this.gl,bufferName:"maxBuffer",id:i,data:s,result:t[i]}))}}}},{key:"getAggregateData",value:function(e){var t={},n=this.state,i=n.textures,o=n.framebuffers,r=n.maxMinFramebuffers,a=n.minFramebuffers,s=n.maxFramebuffers,l=n.weights;for(var c in l){t[c]={};var u=l[c],d=u.needMin,g=u.needMax,h=u.combineMaxMin;t[c].aggregationTexture=i[c],t[c].aggregationBuffer=Object(p.c)(o[c],{target:l[c].aggregationBuffer,sourceType:5126}),d&&g&&h?t[c].maxMinBuffer=Object(p.c)(r[c],{target:l[c].maxMinBuffer,sourceType:5126}):(d&&(t[c].minBuffer=Object(p.c)(a[c],{target:l[c].minBuffer,sourceType:5126})),g&&(t[c].maxBuffer=Object(p.c)(s[c],{target:l[c].maxBuffer,sourceType:5126})))}return this.trackGPUResultBuffers(t,l),t}},{key:"getAggregationModel",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.gl,n=this.shaderCache;return new h.a(t,{id:"Gird-Aggregation-Model",vs:e?A:M,fs:O,modules:e?["fp64","project64"]:["project32"],shaderCache:n,vertexCount:0,drawMode:0})}},{key:"getAllAggregationModel",value:function(){var e=this.gl,t=this.shaderCache,n=this.state,i=n.numCol,o=n.numRow;return new h.a(e,{id:"All-Aggregation-Model",vs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-vs-64\n\nin vec2 position;\nuniform ivec2 gridSize;\nout vec2 vTextureCoord;\n\nvoid main(void) {\n  vec2 pos = vec2(-1.0, -1.0);\n  vec2 offset = 1.0 / vec2(gridSize);\n  pos = pos + offset;\n\n  gl_Position = vec4(pos, 0.0, 1.0);\n\n  int yIndex = gl_InstanceID / gridSize[0];\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 yIndexFP64 = vec2(float(yIndex), 0.);\n  vec2 xIndexFP64 = vec2(float(xIndex), 0.);\n  vec2 gridSizeYFP64 = vec2(gridSize[1], 0.);\n  vec2 gridSizeXFP64 = vec2(gridSize[0], 0.);\n\n  vec2 texCoordXFP64 = div_fp64(yIndexFP64, gridSizeYFP64);\n  vec2 texCoordYFP64 = div_fp64(xIndexFP64, gridSizeXFP64);\n\n  vTextureCoord = vec2(texCoordYFP64.x, texCoordXFP64.x);\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-aggregation-all-fs\n\nprecision highp float;\n\nin vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform bool combineMaxMin;\nout vec4 fragColor;\nvoid main(void) {\n  vec4 textureColor = texture(uSampler, vec2(vTextureCoord.s, vTextureCoord.t));\n  if (textureColor.a == 0.) {\n    discard;\n  }\n  fragColor.rgb = textureColor.rgb;\n  fragColor.a = combineMaxMin ? textureColor.r : textureColor.a;\n}\n",modules:["fp64"],shaderCache:t,vertexCount:1,drawMode:0,isInstanced:!0,instanceCount:i*o,attributes:{position:[0,0]}})}},{key:"getMeanTransform",value:function(e){return this.meanTransform?this.meanTransform.update(e):this.meanTransform=new f.a(this.gl,Object.assign({},{vs:"#define SHADER_NAME gpu-aggregation-transform-mean-vs\nattribute vec4 aggregationValues;\nvarying vec4 meanValues;\n\nvoid main()\n{\n  bool isCellValid = bool(aggregationValues.w > 0.);\n  meanValues.xyz = isCellValid ? aggregationValues.xyz/aggregationValues.w : vec3(0, 0, 0);\n  meanValues.w = aggregationValues.w;\n}\n",_targetTextureVarying:"meanValues"},e)),this.meanTransform}},{key:"renderAggregateData",value:function(e){var t=e.cellSize,n=e.viewport,i=e.gridTransformMatrix,o=e.projectPoints,r=this.state,a=r.numCol,s=r.numRow,l=r.windowSize,c=r.maxMinFramebuffers,u=r.minFramebuffers,d=r.maxFramebuffers,g=r.weights,p=[a,s],h={blend:!0,depthTest:!1,blendFunc:[1,1]},f={viewport:n},v={windowSize:l,cellSize:t,gridSize:p,uProjectionMatrix:i,uProjectionMatrixFP64:R(i),projectPoints:o};for(var m in g){var y=g[m],x=y.needMin,b=y.needMax,P=x&&b&&g[m].combineMaxMin;this.renderToWeightsTexture({id:m,parameters:h,moduleSettings:f,uniforms:v,gridSize:p}),P?this.renderToMaxMinTexture({id:m,parameters:Object.assign({},h,{blendEquation:C}),gridSize:p,minOrMaxFb:c[m],clearParams:{clearColor:[0,0,0,3402823466e29]},combineMaxMin:P}):(x&&this.renderToMaxMinTexture({id:m,parameters:Object.assign({},h,{blendEquation:_}),gridSize:p,minOrMaxFb:u[m],clearParams:{clearColor:[3402823466e29,3402823466e29,3402823466e29,0]},combineMaxMin:P}),b&&this.renderToMaxMinTexture({id:m,parameters:Object.assign({},h,{blendEquation:w}),gridSize:p,minOrMaxFb:d[m],combineMaxMin:P}))}}},{key:"renderToMaxMinTexture",value:function(e){var t=e.id,n=e.parameters,i=e.gridSize,o=e.minOrMaxFb,r=e.combineMaxMin,a=e.clearParams,s=void 0===a?{}:a,l=this.state.framebuffers,c=this.gl,u=this.allAggregationModel;o.bind(),c.viewport(0,0,i[0],i[1]),Object(v.a)(c,s,(function(){c.clear(16384)})),u.draw({parameters:n,uniforms:{uSampler:l[t].texture,gridSize:i,combineMaxMin:r}}),o.unbind()}},{key:"renderToWeightsTexture",value:function(e){var t=e.id,n=e.parameters,i=e.moduleSettings,r=e.uniforms,a=e.gridSize,s=this.state,l=s.framebuffers,c=s.equations,u=s.weightAttributes,d=s.weights,g=this.gl,p=this.gridAggregationModel,h=d[t].operation;l[t].bind(),g.viewport(0,0,a[0],a[1]);var f=h===x.a.MIN?[3402823466e29,3402823466e29,3402823466e29,0]:[0,0,0,0];Object(v.a)(g,{clearColor:f},(function(){g.clear(16384)}));var m={weights:u[t]};if(p.draw({parameters:Object.assign({},n,{blendEquation:c[t]}),moduleSettings:i,uniforms:r,attributes:m}),l[t].unbind(),h===x.a.MEAN){var y=this.state,b=y.meanTextures,P=y.textures,_={_sourceTextures:{aggregationValues:b[t]},_targetTexture:P[t],elementCount:P[t].width*P[t].height};this.getMeanTransform(_).run({parameters:{blend:!1,depthTest:!1}}),l[t].attach(Object(o.a)({},36064,P[t]))}}},{key:"runAggregationOnGPU",value:function(e){this.updateModels(e),this.setupFramebuffers(e),this.renderAggregateData(e);var t=this.getAggregateData(e);return this.setState({results:t}),t}},{key:"setupFramebuffers",value:function(e){var t=this.state,n=t.numCol,i=t.numRow,r=t.textures,a=t.framebuffers,s=t.maxMinFramebuffers,l=t.minFramebuffers,c=t.maxFramebuffers,u=t.resources,d=t.meanTextures,g=t.equations,p=t.weights,h={width:n,height:i};for(var f in p){var v=p[f],m=v.needMin,y=v.needMax,b=v.combineMaxMin,P=v.operation;r[f]=p[f].aggregationTexture||r[f]||z(this.gl,{id:"".concat(f,"-texture"),width:n,height:i}),r[f].resize(h);var _=r[f];P===x.a.MEAN&&(d[f]=d[f]||z(this.gl,{id:"".concat(f,"-mean-texture"),width:n,height:i}),d[f].resize(h),_=d[f]),a[f]?a[f].attach(Object(o.a)({},36064,_)):a[f]=F(this.gl,{id:"".concat(f,"-fb"),width:n,height:i,texture:_}),a[f].resize(h),g[f]=S[P],(m||y)&&(m&&y&&b?s[f]||(u["".concat(f,"-maxMin")]=z(this.gl,{id:"".concat(f,"-maxMinTex")}),s[f]=F(this.gl,{id:"".concat(f,"-maxMinFb"),texture:u["".concat(f,"-maxMin")]})):(m&&(l[f]||(u["".concat(f,"-min")]=z(this.gl,{id:"".concat(f,"-minTex")}),l[f]=F(this.gl,{id:"".concat(f,"-minFb"),texture:u["".concat(f,"-min")]}))),y&&(c[f]||(u["".concat(f,"-max")]=z(this.gl,{id:"".concat(f,"-maxTex")}),c[f]=F(this.gl,{id:"".concat(f,"-maxFb"),texture:u["".concat(f,"-max")]})))))}}},{key:"setupModels",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.gridAggregationModel&&this.gridAggregationModel.delete(),this.gridAggregationModel=this.getAggregationModel(e),this.allAggregationModel||(this.allAggregationModel=this.getAllAggregationModel())}},{key:"setupWeightAttributes",value:function(e){var t=this.state,n=t.weightAttributes,i=t.vertexCount,o=t.weights,r=t.resources;for(var a in o){var s=o[a].values;if(Array.isArray(s)||s.constructor===Float32Array){m.a.assert(s.length/3===i);var l=Array.isArray(s)?new Float32Array(s):s;n[a]instanceof g.a?n[a].setData(l):(r["".concat(a,"-buffer")]=new g.a(this.gl,l),n[a]=r["".concat(a,"-buffer")])}else m.a.assert(s instanceof g.a),n[a]=s}}},{key:"trackGPUResultBuffers",value:function(e,t){var n=this.state.resources;for(var i in e)if(e[i])for(var o=0;o<T.length;o++){var r=T[o];if(e[i][r]&&t[i][r]!==e[i][r]){var a="gpu-result-".concat(i,"-").concat(r);n[a]&&n[a].delete(),n[a]=e[i][r]}}}},{key:"updateModels",value:function(e){var t=this.gl,n=e.positions,i=e.positions64xyLow,o=e.changeFlags,r=this.state,a=r.numCol,s=r.numRow,l={},c=!1;if(e.fp64!==this.state.fp64&&(this.setupModels(e.fp64),this.setState({fp64:e.fp64}),c=!0),o.dataChanged||!this.state.positionsBuffer){var u=this.state,d=u.positionsBuffer,p=u.positions64xyLowBuffer;d&&d.delete(),p&&p.delete();var h=n.length/2;d=new g.a(t,new Float32Array(n)),p=new g.a(t,{data:new Float32Array(i),accessor:{size:2}}),this.setState({positionsBuffer:d,positions64xyLowBuffer:p,vertexCount:h}),this.setupWeightAttributes(e),c=!0}if(c){var f=this.state,v=f.vertexCount,m=f.positionsBuffer,y=f.positions64xyLowBuffer;l.positions=m,e.fp64&&(l.positions64xyLow=y),this.gridAggregationModel.setVertexCount(v),this.gridAggregationModel.setAttributes(l)}(o.cellSizeChanged||o.viewportChanged)&&this.allAggregationModel.setInstanceCount(a*s)}}]),e}()},2990:function(e,t,n){"use strict";n.d(t,"b",(function(){return p})),n.d(t,"c",(function(){return h})),n.d(t,"a",(function(){return f}));var i=n(3048),o=n.n(i);function r(e){if(e=e&&e.positions||e,!Array.isArray(e)&&!ArrayBuffer.isView(e))throw new Error("invalid polygon")}function a(e){return e.length>=1&&e[0].length>=2&&Number.isFinite(e[0][0])}function s(e){var t=e[0],n=e[e.length-1];return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]}function l(e,t,n,i){for(var o=0;o<t;o++)if(e[n+o]!==e[i-t+o])return!1;return!0}function c(e,t,n,i){for(var o=t,r=n.length,a=0;a<r;a++)for(var l=0;l<i;l++)e[o++]=n[a][l]||0;if(!s(n))for(var c=0;c<i;c++)e[o++]=n[0][c]||0;return o}function u(e,t,n,i){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,r=arguments.length>5?arguments[5]:void 0,a=(r=r||n.length)-o;if(a<=0)return t;for(var s=t,c=0;c<a;c++)e[s++]=n[o+c];if(!l(n,i,o,r))for(var u=0;u<i;u++)e[s++]=n[o+u];return s}function d(e){return(s(e)?0:1)+e.length}function g(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3?arguments[3]:void 0;return n>=(i=i||e.length)?0:(l(e,t,n,i)?0:1)+(i-n)/t}function p(e,t){if(r(e),e.positions){var n=e,i=n.positions,o=n.holeIndices;if(o){for(var s=0,l=0;l<=o.length;l++)s+=g(e.positions,t,o[l-1],o[l]);return s}e=i}if(Number.isFinite(e[0]))return g(e,t);if(!a(e)){var c=0,u=!0,p=!1,h=void 0;try{for(var f,v=e[Symbol.iterator]();!(u=(f=v.next()).done);u=!0){c+=d(f.value)}}catch(e){p=!0,h=e}finally{try{u||null==v.return||v.return()}finally{if(p)throw h}}return c}return d(e)}function h(e,t,n){r(e),n=n||p(e,t);var i=new Float64Array(n*t),o=[];if(e.positions){var s=e,l=s.positions,d=s.holeIndices;if(d){for(var g=0,h=0;h<=d.length;h++)g=u(i,g,l,t,d[h-1],d[h]),o.push(g);return o.pop(),{positions:i,holeIndices:o}}e=l}if(Number.isFinite(e[0]))return u(i,0,e,t),{positions:i,holeIndices:null};if(!a(e)){var f=0,v=!0,m=!1,y=void 0;try{for(var x,b=e[Symbol.iterator]();!(v=(x=b.next()).done);v=!0){f=c(i,f,x.value,t),o.push(f)}}catch(e){m=!0,y=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw y}}return o.pop(),{positions:i,holeIndices:o}}return c(i,0,e,t),{positions:i,holeIndices:null}}function f(e,t){var n=null;return e.holeIndices&&(n=e.holeIndices.map((function(e){return e/t}))),o()(e.positions,n,t)}},3010:function(e,t,n){"use strict";n.d(t,"a",(function(){return P}));var i=n(849),o=n(850),r=n(1035),a=n(647),s=n(2837),l=n(1036),c=n(2986),u=n(3426),d=n(3145),g=n(2881),p=n(4316),h=g.a.Tesselator,f=p.a.fp64LowPart,v=function(e){function t(e){var n=e.data,o=e.getGeometry,s=e.positionFormat,l=e.fp64;return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).call(this,{data:n,getGeometry:o,fp64:l,positionFormat:s,attributes:{startPositions:{size:3},endPositions:{size:3},leftPositions:{size:3},rightPositions:{size:3},startEndPositions64XyLow:{size:4,fp64Only:!0},neighborPositions64XyLow:{size:4,fp64Only:!0}}}))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"get",value:function(e){return this.attributes[e]}},{key:"getGeometrySize",value:function(e){return Math.max(0,this.getPathLength(e)-1)}},{key:"updateGeometryAttributes",value:function(e,t){var n=this.attributes,i=n.startPositions,o=n.endPositions,r=n.leftPositions,a=n.rightPositions,s=n.startEndPositions64XyLow,l=n.neighborPositions64XyLow,c=this.fp64,u=t.geometrySize+1;if(!(u<2))for(var d,g=this.isClosed(e),p=this.getPointOnPath(e,0),h=this.getPointOnPath(e,1),v=g?this.getPointOnPath(e,u-2):p,m=t.vertexStart,y=1;y<u;m++,y++)d=y+1<u?this.getPointOnPath(e,y+1):g?this.getPointOnPath(e,1):h,i[3*m]=p[0],i[3*m+1]=p[1],i[3*m+2]=p[2]||0,o[3*m]=h[0],o[3*m+1]=h[1],o[3*m+2]=h[2]||0,r[3*m]=v[0],r[3*m+1]=v[1],r[3*m+2]=v[2]||0,a[3*m]=d[0],a[3*m+1]=d[1],a[3*m+2]=d[2]||0,c&&(s[4*m]=f(p[0]),s[4*m+1]=f(p[1]),s[4*m+2]=f(h[0]),s[4*m+3]=f(h[1]),l[4*m]=f(v[0]),l[4*m+1]=f(v[1]),l[4*m+2]=f(d[0]),l[4*m+3]=f(d[1])),v=p,p=h,h=d}},{key:"getPathLength",value:function(e){return Number.isFinite(e[0])?e.length/this.positionSize:e.length}},{key:"getPointOnPath",value:function(e,t){if(Number.isFinite(e[0])){var n=this.positionSize;return[e[t*n],e[t*n+1],3===n?e[t*n+2]:0]}return e[t]}},{key:"isClosed",value:function(e){var t=this.getPathLength(e),n=this.getPointOnPath(e,0),i=this.getPointOnPath(e,t-1);return n[0]===i[0]&&n[1]===i[1]&&n[2]===i[2]}}]),t}(h),m="#define SHADER_NAME path-layer-fragment-shader\n\nprecision highp float;\n\nuniform float jointType;\nuniform float miterLimit;\nuniform float alignMode;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\nfloat mod2(float a, float b) {\n  return a - floor(a / b) * b;\n}\n\nfloat round(float x) {\n  return floor(x + 0.5);\n}\nbool dash_isFragInGap() {\n  float solidLength = vDashArray.x;\n  float gapLength = vDashArray.y;\n\n  float unitLength = solidLength + gapLength;\n\n  if (unitLength == 0.0) {\n    return false;\n  }\n\n  unitLength = mix(\n    unitLength,\n    vPathLength / round(vPathLength / unitLength),\n    alignMode\n  );\n\n  float offset = alignMode * solidLength / 2.0;\n\n  return gapLength > 0.0 &&\n    vPathPosition.y >= 0.0 &&\n    vPathPosition.y <= vPathLength &&\n    mod2(vPathPosition.y + offset, unitLength) > solidLength;\n}\n\nvoid main(void) {\n  if (jointType > 0.0 && vMiterLength > 0.0 && length(vCornerOffset) > 1.0) {\n    discard;\n  }\n  if (jointType == 0.0 && vMiterLength > miterLimit) {\n    discard;\n  }\n  if (vColor.a == 0.0 || dash_isFragInGap()) {\n    discard;\n  }\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",y=[0,0,0,255],x={widthUnits:"meters",widthScale:{type:"number",min:0,value:1},widthMinPixels:{type:"number",min:0,value:0},widthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},rounded:!1,miterLimit:{type:"number",min:0,value:4},fp64:!1,dashJustified:!1,billboard:!1,getPath:{type:"accessor",value:function(e){return e.path}},getColor:{type:"accessor",value:y},getWidth:{type:"accessor",value:1},getDashArray:{type:"accessor",value:[0,0]}},b={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},P=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(){return this.use64bitProjection()?{vs:"\n#define SHADER_NAME path-layer-vertex-shader-64\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec4 instanceNeighborPositions64xyLow;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\n\nvec3 lineJoin(vec2 prevPoint64[2], vec2 currPoint64[2], vec2 nextPoint64[2]) {\n\n  float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0;\n  float width = project_pixel_size(widthPixels);\n\n  vec2 deltaA64[2];\n  vec2 deltaB64[2];\n\n  vec2_sub_fp64(currPoint64, prevPoint64, deltaA64);\n  vec2_sub_fp64(nextPoint64, currPoint64, deltaB64);\n\n  vec2 lengthA64 = vec2_length_fp64(deltaA64);\n  vec2 lengthB64 = vec2_length_fp64(deltaB64);\n\n  vec2 deltaA = vec2(deltaA64[0].x, deltaA64[1].x);\n  vec2 deltaB = vec2(deltaB64[0].x, deltaB64[1].x);\n\n  float lenA = lengthA64.x;\n  float lenB = lengthB64.x;\n\n  vec2 offsetVec;\n  float offsetScale;\n  float offsetDirection;\n  lenA = lenA / width > EPSILON ? lenA : 0.0;\n  lenB = lenB / width > EPSILON ? lenB : 0.0;\n  vec2 dirA = lenA > 0. ? deltaA / lenA : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? deltaB / lenB : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = mix(perpB, perpA, positions.x);\n  float L = mix(lenB, lenA, positions.x);\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n  float cornerPosition = mix(\n    flipIfTrue(turnsRight == (positions.y > 0.0)),\n    0.0,\n    positions.z\n  );\n\n  offsetScale = 1.0 / max(sinHalfA, EPSILON);\n  cornerPosition *= float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) / width * cosHalfA);\n  offsetScale = mix(\n    offsetScale,\n    min(offsetScale, L / width / max(cosHalfA, EPSILON)),\n    float(cornerPosition < 0.0)\n  );\n\n  vMiterLength = mix(\n    offsetScale * cornerPosition,\n    mix(offsetScale, 0.0, cornerPosition),\n    step(0.0, cornerPosition)\n  ) - sinHalfA * jointType;\n  offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n  offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  float isStartCap = step(lenA, 1.0e-5);\n  float isEndCap = step(lenB, 1.0e-5);\n  float isCap = max(isStartCap, isEndCap);\n  cornerPosition = isCap * (1.0 - positions.z);\n  offsetVec = mix(offsetVec, mix(dirB, perpB, cornerPosition), isStartCap);\n  offsetVec = mix(offsetVec, mix(dirA, perpA, cornerPosition), isEndCap);\n  offsetScale = mix(\n    offsetScale,\n    mix(4.0 * jointType, 1.0, cornerPosition),\n    isCap\n  );\n  vMiterLength = mix(vMiterLength, 1.0 - cornerPosition, isCap);\n\n  offsetDirection = mix(\n    offsetDirection,\n    mix(flipIfTrue(isStartCap > 0.), positions.y, cornerPosition),\n    isCap\n  );\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vDashArray = instanceDashArrays;\n  vPathLength = L / width;\n  float isEnd = positions.x;\n  vec2 offsetFromStartOfPath = mix(vCornerOffset, vCornerOffset + deltaA / width, isEnd);\n  vec2 dir = mix(dirB, dirA, isEnd);\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return vec3(vCornerOffset * width, 0.0);\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n  vec2 projected_curr_position[2];\n  project_position_fp64(currPosition.xy, currPosition64xyLow, projected_curr_position);\n  float projected_curr_position_z = project_size(currPosition.z);\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec2 prevPosition64xyLow = mix(instanceNeighborPositions64xyLow.xy, instanceStartEndPositions64xyLow.xy, isEnd);\n\n  vec2 projected_prev_position[2];\n  project_position_fp64(prevPosition.xy, prevPosition64xyLow, projected_prev_position);\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec2 nextPosition64xyLow = mix(instanceStartEndPositions64xyLow.zw, instanceNeighborPositions64xyLow.zw, isEnd);\n\n  vec2 projected_next_position[2];\n  project_position_fp64(nextPosition.xy, nextPosition64xyLow, projected_next_position);\n\n  vec3 pos = lineJoin(projected_prev_position, projected_curr_position, projected_next_position);\n  vec2 vertex_pos_modelspace[4];\n\n  vertex_pos_modelspace[0] = sum_fp64(vec2(pos.x, 0.0), projected_curr_position[0]);\n  vertex_pos_modelspace[1] = sum_fp64(vec2(pos.y, 0.0), projected_curr_position[1]);\n  vertex_pos_modelspace[2] = vec2(pos.z + projected_curr_position_z, 0.0);\n  vertex_pos_modelspace[3] = vec2(1.0, 0.0);\n\n  gl_Position = project_common_position_to_clipspace_fp64(vertex_pos_modelspace);\n}\n",fs:m,modules:["project64","picking"]}:{vs:"#define SHADER_NAME path-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instanceStartPositions;\nattribute vec3 instanceEndPositions;\nattribute vec4 instanceStartEndPositions64xyLow;\nattribute vec3 instanceLeftPositions;\nattribute vec3 instanceRightPositions;\nattribute vec4 instanceNeighborPositions64xyLow;\nattribute float instanceStrokeWidths;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec2 instanceDashArrays;\n\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nuniform float jointType;\nuniform float miterLimit;\nuniform bool billboard;\n\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying vec2 vCornerOffset;\nvarying float vMiterLength;\nvarying vec2 vDashArray;\nvarying vec2 vPathPosition;\nvarying float vPathLength;\n\nconst float EPSILON = 0.001;\nconst vec3 ZERO_OFFSET = vec3(0.0);\n\nfloat flipIfTrue(bool flag) {\n  return -(float(flag) * 2. - 1.);\n}\nvec3 lineJoin(\n  vec3 prevPoint, vec3 currPoint, vec3 nextPoint,\n  float relativePosition, bool isEnd, bool isJoint,\n  vec2 width\n) {\n  vec2 deltaA = (currPoint.xy - prevPoint.xy) / width;\n  vec2 deltaB = (nextPoint.xy - currPoint.xy) / width;\n\n  float lenA = length(deltaA);\n  float lenB = length(deltaB);\n  lenA = lenA > EPSILON ? lenA : 0.0;\n  lenB = lenB > EPSILON ? lenB : 0.0;\n\n  vec2 dirA = lenA > 0. ? normalize(deltaA) : vec2(0.0, 0.0);\n  vec2 dirB = lenB > 0. ? normalize(deltaB) : vec2(0.0, 0.0);\n\n  vec2 perpA = vec2(-dirA.y, dirA.x);\n  vec2 perpB = vec2(-dirB.y, dirB.x);\n  vec2 tangent = vec2(dirA + dirB);\n  tangent = length(tangent) > 0. ? normalize(tangent) : perpA;\n  vec2 miterVec = vec2(-tangent.y, tangent.x);\n  vec2 perp = isEnd ? perpA : perpB;\n  float L = isEnd ? lenA : lenB;\n  float sinHalfA = abs(dot(miterVec, perp));\n  float cosHalfA = abs(dot(dirA, miterVec));\n\n  bool turnsRight = dirA.x * dirB.y > dirA.y * dirB.x;\n\n  float offsetScale = 1.0 / max(sinHalfA, EPSILON);\n\n  float cornerPosition = isJoint ?\n    0.0 :\n    flipIfTrue(turnsRight == (relativePosition > 0.0));\n  cornerPosition *=\n    float(cornerPosition <= 0.0 || sinHalfA < min(lenA, lenB) * cosHalfA);\n  if (cornerPosition < 0.0) {\n    offsetScale = min(offsetScale, L / max(cosHalfA, EPSILON));\n  }\n\n  vMiterLength = cornerPosition >= 0.0 ?\n    mix(offsetScale, 0.0, cornerPosition) :\n    offsetScale * cornerPosition;\n  vMiterLength -= sinHalfA * jointType;\n\n  float offsetDirection = mix(\n    positions.y,\n    mix(\n      flipIfTrue(turnsRight),\n      positions.y * flipIfTrue(turnsRight == (positions.x == 1.)),\n      cornerPosition\n    ),\n    step(0.0, cornerPosition)\n  );\n\n  vec2 offsetVec = mix(miterVec, -tangent, step(0.5, cornerPosition));\n  offsetScale = mix(offsetScale, 1.0 / max(cosHalfA, 0.001), step(0.5, cornerPosition));\n  bool isStartCap = step(0.0, -lenA) > 0.5;\n  bool isEndCap = step(0.0, -lenB) > 0.5;\n  bool isCap = isStartCap || isEndCap;\n  cornerPosition = isCap ? (1.0 - positions.z) : 0.;\n  if (isStartCap) {\n    offsetVec = mix(dirB, perpB, cornerPosition);\n  }\n  if (isEndCap) {\n    offsetVec = mix(dirA, perpA, cornerPosition);\n  }\n  if (isCap) {\n    offsetScale = mix(4.0 * jointType, 1.0, cornerPosition);\n    vMiterLength = 1.0 - cornerPosition;\n    offsetDirection = mix(flipIfTrue(isStartCap), positions.y, cornerPosition);\n  }\n\n  vCornerOffset = offsetVec * offsetDirection * offsetScale;\n  vDashArray = instanceDashArrays;\n  vPathLength = L;\n  vec2 offsetFromStartOfPath = vCornerOffset;\n  if (isEnd) {\n    offsetFromStartOfPath += deltaA;\n  }\n  vec2 dir = isEnd ? dirA : dirB;\n  vPathPosition = vec2(\n    positions.y + positions.z * offsetDirection,\n    dot(offsetFromStartOfPath, dir)\n  );\n\n  return currPoint + vec3(vCornerOffset * width, 0.0);\n}\nvec3 lineJoin(vec3 prevPoint, vec3 currPoint, vec3 nextPoint) {\n\n  float relativePosition = positions.y;\n  bool isEnd = positions.x > EPSILON;\n  bool isJoint = positions.z > EPSILON;\n\n  vec2 widthPixels = vec2(clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n    widthMinPixels, widthMaxPixels) / 2.0);\n\n  return lineJoin(\n    prevPoint, currPoint, nextPoint,\n    relativePosition, isEnd, isJoint,\n    billboard ? project_pixel_size_to_clipspace(widthPixels) : project_pixel_size(widthPixels)\n  );\n}\nvoid clipLine(inout vec4 position, vec4 refPosition) {\n  if (position.w < EPSILON) {\n    float r = (EPSILON - refPosition.w) / (position.w - refPosition.w);\n    position = refPosition + (position - refPosition) * r;\n  }\n}\n\nvoid main() {\n  vColor = vec4(instanceColors.rgb, instanceColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n\n  float isEnd = positions.x;\n\n  vec3 prevPosition = mix(instanceLeftPositions, instanceStartPositions, isEnd);\n  vec2 prevPosition64xyLow = mix(instanceNeighborPositions64xyLow.xy, instanceStartEndPositions64xyLow.xy, isEnd);\n\n  vec3 currPosition = mix(instanceStartPositions, instanceEndPositions, isEnd);\n  vec2 currPosition64xyLow = mix(instanceStartEndPositions64xyLow.xy, instanceStartEndPositions64xyLow.zw, isEnd);\n\n  vec3 nextPosition = mix(instanceEndPositions, instanceRightPositions, isEnd);\n  vec2 nextPosition64xyLow = mix(instanceStartEndPositions64xyLow.zw, instanceNeighborPositions64xyLow.zw, isEnd);\n\n  if (billboard) {\n    vec4 prevPositionScreen = project_position_to_clipspace(prevPosition, prevPosition64xyLow, ZERO_OFFSET);\n    vec4 currPositionScreen = project_position_to_clipspace(currPosition, currPosition64xyLow, ZERO_OFFSET);\n    vec4 nextPositionScreen = project_position_to_clipspace(nextPosition, nextPosition64xyLow, ZERO_OFFSET);\n\n    clipLine(prevPositionScreen, currPositionScreen);\n    clipLine(nextPositionScreen, currPositionScreen);\n    clipLine(currPositionScreen, mix(nextPositionScreen, prevPositionScreen, isEnd));\n\n    vec3 pos = lineJoin(\n      prevPositionScreen.xyz / prevPositionScreen.w,\n      currPositionScreen.xyz / currPositionScreen.w,\n      nextPositionScreen.xyz / nextPositionScreen.w\n    );\n\n    gl_Position = vec4(pos * currPositionScreen.w, currPositionScreen.w);\n  } else {\n    prevPosition = project_position(prevPosition, prevPosition64xyLow);\n    currPosition = project_position(currPosition, currPosition64xyLow);\n    nextPosition = project_position(nextPosition, nextPosition64xyLow);\n\n    vec3 pos = lineJoin(prevPosition, currPosition, nextPosition);\n    gl_Position = project_common_position_to_clipspace(vec4(pos, 1.0));\n  }\n}\n",fs:m,modules:["project32","picking"]}}},{key:"initializeState",value:function(){var e=this;this.getAttributeManager().addInstanced({instanceStartPositions:{size:3,transition:b,accessor:"getPath",update:this.calculateStartPositions,noAlloc:!0},instanceEndPositions:{size:3,transition:b,accessor:"getPath",update:this.calculateEndPositions,noAlloc:!0},instanceStartEndPositions64xyLow:{size:4,update:this.calculateInstanceStartEndPositions64xyLow,noAlloc:!0},instanceLeftPositions:{size:3,accessor:"getPath",update:this.calculateLeftPositions,noAlloc:!0},instanceRightPositions:{size:3,accessor:"getPath",update:this.calculateRightPositions,noAlloc:!0},instanceNeighborPositions64xyLow:{size:4,update:this.calculateInstanceNeighborPositions64xyLow,noAlloc:!0},instanceStrokeWidths:{size:1,accessor:"getWidth",transition:b,defaultValue:1},instanceDashArrays:{size:2,accessor:"getDashArray"},instanceColors:{size:4,type:5121,accessor:"getColor",transition:b,defaultValue:y},instancePickingColors:{size:3,type:5121,accessor:function(t,n){var i=n.index,o=n.target;return e.encodePickingColor(i,o)}}}),this.setState({pathTesselator:new v({})})}},{key:"updateState",value:function(e){var n=e.oldProps,i=e.props,o=e.changeFlags;Object(s.a)(Object(a.a)(t.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:o});var r=this.getAttributeManager();if(o.dataChanged||i.fp64!==n.fp64||o.updateTriggersChanged&&(o.updateTriggersChanged.all||o.updateTriggersChanged.getPath)){var l=this.state.pathTesselator;l.updateGeometry({data:i.data,getGeometry:i.getPath,positionFormat:i.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:l.instanceCount,bufferLayout:l.bufferLayout}),r.invalidateAll()}if(i.fp64!==n.fp64){var c=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(c)}),r.invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.rounded,r=i.billboard,a=i.miterLimit,s=i.widthUnits,l=i.widthScale,c=i.widthMinPixels,u=i.widthMaxPixels,d=i.dashJustified,g="pixels"===s?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{jointType:Number(o),billboard:r,alignMode:Number(d),widthScale:l*g,miterLimit:a,widthMinPixels:c,widthMaxPixels:u})).draw()}},{key:"_getModel",value:function(e){return new u.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new d.a({drawMode:4,attributes:{indices:new Uint16Array([0,2,1,1,2,4,1,4,3,3,4,5]),positions:new Float32Array([0,0,1,0,-1,0,0,1,0,1,-1,0,1,1,0,1,0,1])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateStartPositions",value:function(e){var t=this.state.pathTesselator;e.bufferLayout=t.bufferLayout,e.value=t.get("startPositions")}},{key:"calculateEndPositions",value:function(e){var t=this.state.pathTesselator;e.bufferLayout=t.bufferLayout,e.value=t.get("endPositions")}},{key:"calculateInstanceStartEndPositions64xyLow",value:function(e){var t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.pathTesselator.get("startEndPositions64XyLow"):new Float32Array(4)}},{key:"calculateLeftPositions",value:function(e){var t=this.state.pathTesselator;e.value=t.get("leftPositions")}},{key:"calculateRightPositions",value:function(e){var t=this.state.pathTesselator;e.value=t.get("rightPositions")}},{key:"calculateInstanceNeighborPositions64xyLow",value:function(e){var t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.pathTesselator.get("neighborPositions64XyLow"):new Float32Array(4)}},{key:"clearPickingColor",value:function(e){for(var t=this.decodePickingColor(e),n=this.state.pathTesselator.bufferLayout,i=n[t],o=0,r=0;r<t;r++)o+=n[r];var a=this.getAttributeManager().attributes.instancePickingColors,s=a.value,l=o+i;s.fill(0,3*o,3*l),a.update({value:s})}}]),t}(c.a);P.layerName="PathLayer",P.defaultProps=x},3015:function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var i=n(849),o=n(850),r=n(1035),a=n(647),s=n(2837),l=n(1036),c=n(2986),u=n(2904),d=n(2964),g=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getSubLayers",value:function(){return this.internalState&&this.internalState.subLayers||[]}},{key:"initializeState",value:function(){}},{key:"setState",value:function(e){Object(s.a)(Object(a.a)(t.prototype),"setState",this).call(this,e),this.setLayerNeedsUpdate()}},{key:"getPickingInfo",value:function(e){return e.info}},{key:"renderLayers",value:function(){return null}},{key:"shouldRenderSubLayer",value:function(e,t){var n=this.props._subLayerProps;return t&&t.length||n&&n[e]}},{key:"getSubLayerClass",value:function(e,t){var n=this.props._subLayerProps;return n&&n[e]&&n[e].type||t}},{key:"getSubLayerProps",value:function(e){var t=this.props,n=t.opacity,i=t.pickable,o=t.visible,r=t.parameters,a=t.getPolygonOffset,s=t.highlightedObjectIndex,l=t.autoHighlight,c=t.highlightColor,u=t.coordinateSystem,d=t.coordinateOrigin,g=t.wrapLongitude,p=t.positionFormat,h=t.modelMatrix,f=t._subLayerProps,v={opacity:n,pickable:i,visible:o,parameters:r,getPolygonOffset:a,highlightedObjectIndex:s,autoHighlight:l,highlightColor:c,coordinateSystem:u,coordinateOrigin:d,wrapLongitude:g,positionFormat:p,modelMatrix:h};if(e){var m=f&&f[e.id],y=m&&m.updateTriggers;Object.assign(v,e,m,{id:"".concat(this.props.id,"-").concat(e.id),updateTriggers:Object.assign({all:this.props.updateTriggers.all},e.updateTriggers,y)})}return v}},{key:"_getAttributeManager",value:function(){return null}},{key:"_renderLayers",value:function(){var e=this.internalState.subLayers;e&&!this.needsUpdate()?u.a.log(3,"Composite layer reused subLayers ".concat(this),this.internalState.subLayers)():(e=this.renderLayers(),e=Object(d.b)(e,{filter:Boolean}),this.internalState.subLayers=e,u.a.log(2,"Composite layer rendered new subLayers ".concat(this),e)());var t=!0,n=!1,i=void 0;try{for(var o,r=e[Symbol.iterator]();!(t=(o=r.next()).done);t=!0){o.value.parent=this}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}},{key:"isComposite",get:function(){return!0}}]),t}(c.a);g.layerName="CompositeLayer"},3016:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var i=n(158),o=n(1159),r=n(849),a=n(850),s=function(e){return e.length},l=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;Object(r.a)(this,e),this.sortedBins=this.getSortedBins(t,n),this.maxCount=this.getMaxCount(),this.binMap=this.getBinMap()}return Object(a.a)(e,[{key:"getSortedBins",value:function(e,t){return e.reduce((function(e,n,i){var o=t(n.points);return null!=o&&e.push({i:Number.isFinite(n.index)?n.index:i,value:o,counts:n.points.length}),e}),[]).sort((function(e,t){return e.value-t.value}))}},{key:"getValueRange",value:function(e){var t=Object(o.a)(e,2),n=t[0],i=t[1],r=this.sortedBins.length;if(!r)return[0,0];var a=Math.ceil(n/100*(r-1)),s=Math.floor(i/100*(r-1));return[this.sortedBins[a].value,this.sortedBins[s].value]}},{key:"getMaxCount",value:function(){var e=0;return this.sortedBins.forEach((function(t){return e=e>t.counts?e:t.counts})),e}},{key:"getBinMap",value:function(){return this.sortedBins.reduce((function(e,t){return Object.assign(e,Object(i.a)({},t.i,t))}),{})}}]),e}()},3017:function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return r}));var i=n(2904);function o(e,t){return function(n){return function(e,t,n){var o=e[1]-e[0];if(o<=0)return i.a.warn("quantizeScale: invalid domain, returning range[0]")(),t[0];var r=o/t.length,a=Math.floor((n-e[0])/r);return t[Math.max(Math.min(a,t.length-1),0)]}(e,t,n)}}function r(e,t){return function(n){return(n-e[0])/(e[1]-e[0])*(t[1]-t[0])+t[0]}}},3040:function(e,t,n){"use strict";n.d(t,"a",(function(){return M}));var i=n(849),o=n(850),r=n(1035),a=n(647),s=n(2837),l=n(1036),c=n(2986),u=n(3124),d=n(4283),g=n(3481),p=n(3426),h=n(3145),f=n(2990),v=n(2881),m=n(4316),y=v.a.Tesselator,x=m.a.fp64LowPart,b=function(e){function t(e){var n=e.data,o=e.getGeometry,s=e.fp64,l=e.positionFormat,c=e.IndexType,u=void 0===c?Uint32Array:c;return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).call(this,{data:n,getGeometry:o,fp64:s,positionFormat:l,attributes:{positions:{size:3},positions64xyLow:{size:2,fp64Only:!0},vertexValid:{type:Uint8ClampedArray,size:1},indices:{type:u,size:1}}}))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"get",value:function(e){return"indices"===e?this.attributes.indices.subarray(0,this.vertexCount):this.attributes[e]}},{key:"getGeometrySize",value:function(e){return f.b(e,this.positionSize)}},{key:"updateGeometryAttributes",value:function(e,t){e=f.c(e,this.positionSize,t.geometrySize),this._updateIndices(e,t),this._updatePositions(e,t)}},{key:"_updateIndices",value:function(e,t){var n=t.geometryIndex,i=t.vertexStart,o=t.indexStart,r=this.attributes,a=this.indexLayout,s=this.typedArrayManager,l=r.indices,c=l.length,u=o,d=f.a(e,this.positionSize);c<u+d.length&&(c=2*(u+d.length),l=s.allocate(l,c,{type:l.constructor,size:1,copy:!0}));for(var g=0;g<d.length;g++)l[u++]=d[g]+i;a[n]=d.length,r.indices=l}},{key:"_updatePositions",value:function(e,t){for(var n=t.vertexStart,i=t.geometrySize,o=this.attributes,r=o.positions,a=o.positions64xyLow,s=o.vertexValid,l=this.fp64,c=this.positionSize,u=n,d=e.positions,g=e.holeIndices,p=0;p<i;p++){var h=d[p*c],f=d[p*c+1],v=c>2?d[p*c+2]:0;r[3*u]=h,r[3*u+1]=f,r[3*u+2]=v,l&&(a[2*u]=x(h),a[2*u+1]=x(f)),s[u]=1,u++}if(g)for(var m=0;m<g.length;m++)s[n+g[m]/c-1]=0;s[n+i-1]=0}}]),t}(y),P="\nattribute vec2 vertexPositions;\nattribute float vertexValid;\n\nuniform bool extruded;\nuniform bool isWireframe;\nuniform float elevationScale;\nuniform float opacity;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nstruct PolygonProps {\n  vec4 fillColors;\n  vec4 lineColors;\n  vec3 positions;\n  vec3 nextPositions;\n  vec3 pickingColors;\n  vec2 positions64xyLow;\n  vec2 nextPositions64xyLow;\n  float elevations;\n};\n\nvec3 project_offset_normal(vec3 vector) {\n  if (project_uCoordinateSystem == COORDINATE_SYSTEM_LNG_LAT ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSETS ||\n    project_uCoordinateSystem == COORDINATE_SYSTEM_LNGLAT_AUTO_OFFSET) {\n    return normalize(vector * project_uCommonUnitsPerWorldUnit);\n  }\n  return project_normal(vector);\n}\n\nvoid calculatePosition(PolygonProps props) {\n  vec3 pos;\n  vec2 pos64xyLow;\n  vec3 normal;\n  vec4 colors = isWireframe ? props.lineColors : props.fillColors;\n\n#ifdef IS_SIDE_VERTEX\n  pos = mix(props.positions, props.nextPositions, vertexPositions.x);\n  pos64xyLow = mix(props.positions64xyLow, props.nextPositions64xyLow, vertexPositions.x);\n  isValid = vertexValid;\n#else\n  pos = props.positions;\n  pos64xyLow = props.positions64xyLow;\n  isValid = 1.0;\n#endif\n\n  if (extruded) {\n    pos.z += props.elevations * vertexPositions.y * elevationScale;\n  }\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(pos, pos64xyLow, vec3(0.), position_commonspace);\n\n  if (extruded) {\n#ifdef IS_SIDE_VERTEX\n    normal = vec3(props.positions.y - props.nextPositions.y, props.nextPositions.x - props.positions.x, 0.0);\n    normal = project_offset_normal(normal);\n#else\n    normal = vec3(0.0, 0.0, 1.0);\n#endif\n\n    vec3 lightColor = lighting_getLightColor(colors.rgb, project_uCameraPosition, position_commonspace.xyz, normal);\n    vColor = vec4(lightColor, colors.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(colors.rgb, colors.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(props.pickingColors);\n}\n",_="#define SHADER_NAME solid-polygon-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec2 positions64xyLow;\nattribute float elevations;\nattribute vec4 fillColors;\nattribute vec4 lineColors;\nattribute vec3 pickingColors;\n\n".concat(P,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = positions;\n  props.positions64xyLow = positions64xyLow;\n  props.elevations = elevations;\n  props.fillColors = fillColors;\n  props.lineColors = lineColors;\n  props.pickingColors = pickingColors;\n\n  calculatePosition(props);\n}\n"),w="#define SHADER_NAME solid-polygon-layer-vertex-shader-side\n#define IS_SIDE_VERTEX\n\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute vec3 nextPositions;\nattribute vec2 nextPositions64xyLow;\nattribute float instanceElevations;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\n".concat(P,"\n\nvoid main(void) {\n  PolygonProps props;\n\n  props.positions = instancePositions;\n  props.positions64xyLow = instancePositions64xyLow;\n  props.elevations = instanceElevations;\n  props.fillColors = instanceFillColors;\n  props.lineColors = instanceLineColors;\n  props.pickingColors = instancePickingColors;\n  props.nextPositions = nextPositions;\n  props.nextPositions64xyLow = nextPositions64xyLow;\n\n  calculatePosition(props);\n}\n"),C=[0,0,0,255],S=new u.a,j={filled:!0,extruded:!1,wireframe:!1,fp64:!1,elevationScale:{type:"number",min:0,value:1},getPolygon:{type:"accessor",value:function(e){return e.polygon}},getElevation:{type:"accessor",value:1e3},getFillColor:{type:"accessor",value:C},getLineColor:{type:"accessor",value:C},material:S},k={enter:function(e,t){return t.length?t.subarray(t.length-e.length):e}},M=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(e){return{vs:e,fs:"#define SHADER_NAME solid-polygon-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float isValid;\n\nvoid main(void) {\n  if (isValid < 0.5) {\n    discard;\n  }\n\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",defines:{},modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){var e=this,t=this.context.gl;this.setState({numInstances:0,polygonTesselator:new b({IndexType:!t||Object(d.b)(t,g.a.ELEMENT_INDEX_UINT32)?Uint32Array:Uint16Array})});var n=this.getAttributeManager();n.remove(["instancePickingColors"]),n.add({indices:{size:1,isIndexed:!0,update:this.calculateIndices,noAlloc:!0},positions:{size:3,transition:k,accessor:"getPolygon",update:this.calculatePositions,noAlloc:!0,shaderAttributes:{positions:{offset:0,divisor:0},instancePositions:{offset:0,divisor:1},nextPositions:{offset:12,divisor:1}}},positions64xyLow:{size:2,update:this.calculatePositionsLow,noAlloc:!0,shaderAttributes:{positions64xyLow:{offset:0,divisor:0},instancePositions64xyLow:{offset:0,divisor:1},nextPositions64xyLow:{offset:8,divisor:1}}},vertexValid:{size:1,divisor:1,type:5121,update:this.calculateVertexValid,noAlloc:!0},elevations:{size:1,transition:k,accessor:"getElevation",shaderAttributes:{elevations:{divisor:0},instanceElevations:{divisor:1}}},fillColors:{alias:"colors",size:4,type:5121,transition:k,accessor:"getFillColor",defaultValue:C,shaderAttributes:{fillColors:{divisor:0},instanceFillColors:{divisor:1}}},lineColors:{alias:"colors",size:4,type:5121,transition:k,accessor:"getLineColor",defaultValue:C,shaderAttributes:{lineColors:{divisor:0},instanceLineColors:{divisor:1}}},pickingColors:{size:3,type:5121,accessor:function(t,n){var i=n.index,o=n.target;return e.encodePickingColor(i,o)},shaderAttributes:{pickingColors:{divisor:0},instancePickingColors:{divisor:1}}}})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.extruded,o=n.filled,r=n.wireframe,a=n.elevationScale,s=this.state,l=s.topModel,c=s.sideModel,u=s.polygonTesselator,d=Object.assign({},t,{extruded:Boolean(i),elevationScale:a});c&&(c.setInstanceCount(u.instanceCount-1),c.setUniforms(d),r&&(c.setDrawMode(3),c.setUniforms({isWireframe:!0}).draw()),o&&(c.setDrawMode(6),c.setUniforms({isWireframe:!1}).draw())),l&&(l.setVertexCount(u.get("indices").length),l.setUniforms(d).draw())}},{key:"updateState",value:function(e){Object(s.a)(Object(a.a)(t.prototype),"updateState",this).call(this,e),this.updateGeometry(e);var n=e.props,i=e.oldProps,o=this.getAttributeManager();(n.fp64!==i.fp64||n.filled!==i.filled||n.extruded!==i.extruded)&&(this.state.models&&this.state.models.forEach((function(e){return e.delete()})),this.setState(this._getModels(this.context.gl)),o.invalidateAll())}},{key:"updateGeometry",value:function(e){var t=e.props,n=e.oldProps,i=e.changeFlags;if(i.dataChanged||t.fp64!==n.fp64||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon)){var o=this.state.polygonTesselator;o.updateGeometry({data:t.data,getGeometry:t.getPolygon,positionFormat:t.positionFormat,fp64:this.use64bitPositions()}),this.setState({numInstances:o.instanceCount,bufferLayout:o.bufferLayout}),this.getAttributeManager().invalidateAll()}}},{key:"_getModels",value:function(e){var t,n,i=this.props,o=i.id,r=i.filled,a=i.extruded;if(r){var s=this.getShaders(_);s.defines.NON_INSTANCED_MODEL=1,t=new p.a(e,Object.assign({},s,{id:"".concat(o,"-top"),drawMode:4,attributes:{vertexPositions:new Float32Array([0,1])},uniforms:{isWireframe:!1,isSideVertex:!1},vertexCount:0,isIndexed:!0,shaderCache:this.context.shaderCache}))}return a&&((n=new p.a(e,Object.assign({},this.getShaders(w),{id:"".concat(o,"-side"),geometry:new h.a({drawMode:1,vertexCount:4,attributes:{vertexPositions:{size:2,value:new Float32Array([1,1,0,1,0,0,1,0])}}}),instanceCount:0,isInstanced:1,shaderCache:this.context.shaderCache}))).userData.excludeAttributes={indices:!0}),{models:[n,t].filter(Boolean),topModel:t,sideModel:n}}},{key:"calculateIndices",value:function(e){var t=this.state.polygonTesselator;e.bufferLayout=t.indexLayout,e.value=t.get("indices")}},{key:"calculatePositions",value:function(e){var t=this.state.polygonTesselator;e.bufferLayout=t.bufferLayout,e.value=t.get("positions")}},{key:"calculatePositionsLow",value:function(e){var t=this.use64bitPositions();e.constant=!t,e.value=t?this.state.polygonTesselator.get("positions64xyLow"):new Float32Array(2)}},{key:"calculateVertexValid",value:function(e){e.value=this.state.polygonTesselator.get("vertexValid")}},{key:"clearPickingColor",value:function(e){for(var t=this.decodePickingColor(e),n=this.state.polygonTesselator.bufferLayout,i=n[t],o=0,r=0;r<t;r++)o+=n[r];var a=this.getAttributeManager().attributes.pickingColors,s=a.value,l=o+i;s.fill(0,3*o,3*l),a.update({value:s})}}]),t}(c.a);M.layerName="SolidPolygonLayer",M.defaultProps=j},3048:function(e,t,n){"use strict";function i(e,t,n){n=n||2;var i,s,l,c,u,p,h,v=t&&t.length,m=v?t[0]*n:e.length,y=o(e,0,m,n,!0),x=[];if(!y||y.next===y.prev)return x;if(v&&(y=function(e,t,n,i){var a,s,l,c,u,p=[];for(a=0,s=t.length;a<s;a++)l=t[a]*i,c=a<s-1?t[a+1]*i:e.length,(u=o(e,l,c,i,!1))===u.next&&(u.steiner=!0),p.push(f(u));for(p.sort(d),a=0;a<p.length;a++)g(p[a],n),n=r(n,n.next);return n}(e,t,y,n)),e.length>80*n){i=l=e[0],s=c=e[1];for(var b=n;b<m;b+=n)(u=e[b])<i&&(i=u),(p=e[b+1])<s&&(s=p),u>l&&(l=u),p>c&&(c=p);h=0!==(h=Math.max(l-i,c-s))?1/h:0}return a(y,x,n,i,s,h),x}function o(e,t,n,i,o){var r,a;if(o===M(e,t,n,i)>0)for(r=t;r<n;r+=i)a=S(r,e[r],e[r+1],a);else for(r=n-i;r>=t;r-=i)a=S(r,e[r],e[r+1],a);return a&&x(a,a.next)&&(j(a),a=a.next),a}function r(e,t){if(!e)return e;t||(t=e);var n,i=e;do{if(n=!1,i.steiner||!x(i,i.next)&&0!==y(i.prev,i,i.next))i=i.next;else{if(j(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function a(e,t,n,i,o,d,g){if(e){!g&&d&&function(e,t,n,i){var o=e;do{null===o.z&&(o.z=h(o.x,o.y,t,n,i)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var t,n,i,o,r,a,s,l,c=1;do{for(n=e,e=null,r=null,a=0;n;){for(a++,i=n,s=0,t=0;t<c&&(s++,i=i.nextZ);t++);for(l=c;s>0||l>0&&i;)0!==s&&(0===l||!i||n.z<=i.z)?(o=n,n=n.nextZ,s--):(o=i,i=i.nextZ,l--),r?r.nextZ=o:e=o,o.prevZ=r,r=o;n=i}r.nextZ=null,c*=2}while(a>1)}(o)}(e,i,o,d);for(var p,f,v=e;e.prev!==e.next;)if(p=e.prev,f=e.next,d?l(e,i,o,d):s(e))t.push(p.i/n),t.push(e.i/n),t.push(f.i/n),j(e),e=f.next,v=f.next;else if((e=f)===v){g?1===g?a(e=c(r(e),t,n),t,n,i,o,d,2):2===g&&u(e,t,n,i,o,d):a(r(e),t,n,i,o,d,1);break}}}function s(e){var t=e.prev,n=e,i=e.next;if(y(t,n,i)>=0)return!1;for(var o=e.next.next;o!==e.prev;){if(v(t.x,t.y,n.x,n.y,i.x,i.y,o.x,o.y)&&y(o.prev,o,o.next)>=0)return!1;o=o.next}return!0}function l(e,t,n,i){var o=e.prev,r=e,a=e.next;if(y(o,r,a)>=0)return!1;for(var s=o.x<r.x?o.x<a.x?o.x:a.x:r.x<a.x?r.x:a.x,l=o.y<r.y?o.y<a.y?o.y:a.y:r.y<a.y?r.y:a.y,c=o.x>r.x?o.x>a.x?o.x:a.x:r.x>a.x?r.x:a.x,u=o.y>r.y?o.y>a.y?o.y:a.y:r.y>a.y?r.y:a.y,d=h(s,l,t,n,i),g=h(c,u,t,n,i),p=e.prevZ,f=e.nextZ;p&&p.z>=d&&f&&f.z<=g;){if(p!==e.prev&&p!==e.next&&v(o.x,o.y,r.x,r.y,a.x,a.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,f!==e.prev&&f!==e.next&&v(o.x,o.y,r.x,r.y,a.x,a.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;p&&p.z>=d;){if(p!==e.prev&&p!==e.next&&v(o.x,o.y,r.x,r.y,a.x,a.y,p.x,p.y)&&y(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;f&&f.z<=g;){if(f!==e.prev&&f!==e.next&&v(o.x,o.y,r.x,r.y,a.x,a.y,f.x,f.y)&&y(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function c(e,t,n){var i=e;do{var o=i.prev,a=i.next.next;!x(o,a)&&b(o,i,i.next,a)&&w(o,a)&&w(a,o)&&(t.push(o.i/n),t.push(i.i/n),t.push(a.i/n),j(i),j(i.next),i=e=a),i=i.next}while(i!==e);return r(i)}function u(e,t,n,i,o,s){var l=e;do{for(var c=l.next.next;c!==l.prev;){if(l.i!==c.i&&m(l,c)){var u=C(l,c);return l=r(l,l.next),u=r(u,u.next),a(l,t,n,i,o,s),void a(u,t,n,i,o,s)}c=c.next}l=l.next}while(l!==e)}function d(e,t){return e.x-t.x}function g(e,t){if(t=function(e,t){var n,i=t,o=e.x,r=e.y,a=-1/0;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var s=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=o&&s>a){if(a=s,s===o){if(r===i.y)return i;if(r===i.next.y)return i.next}n=i.x<i.next.x?i:i.next}}i=i.next}while(i!==t);if(!n)return null;if(o===a)return n;var l,c=n,u=n.x,d=n.y,g=1/0;i=n;do{o>=i.x&&i.x>=u&&o!==i.x&&v(r<d?o:a,r,u,d,r<d?a:o,r,i.x,i.y)&&(l=Math.abs(r-i.y)/(o-i.x),w(i,e)&&(l<g||l===g&&(i.x>n.x||i.x===n.x&&p(n,i)))&&(n=i,g=l)),i=i.next}while(i!==c);return n}(e,t)){var n=C(t,e);r(t,t.next),r(n,n.next)}}function p(e,t){return y(e.prev,e,t.prev)<0&&y(t.next,e,e.next)<0}function h(e,t,n,i,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*o)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*o)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function f(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function v(e,t,n,i,o,r,a,s){return(o-a)*(t-s)-(e-a)*(r-s)>=0&&(e-a)*(i-s)-(n-a)*(t-s)>=0&&(n-a)*(r-s)-(o-a)*(i-s)>=0}function m(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&b(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(w(e,t)&&w(t,e)&&function(e,t){var n=e,i=!1,o=(e.x+t.x)/2,r=(e.y+t.y)/2;do{n.y>r!=n.next.y>r&&n.next.y!==n.y&&o<(n.next.x-n.x)*(r-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==e);return i}(e,t)&&(y(e.prev,e,t.prev)||y(e,t.prev,t))||x(e,t)&&y(e.prev,e,e.next)>0&&y(t.prev,t,t.next)>0)}function y(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function x(e,t){return e.x===t.x&&e.y===t.y}function b(e,t,n,i){var o=_(y(e,t,n)),r=_(y(e,t,i)),a=_(y(n,i,e)),s=_(y(n,i,t));return o!==r&&a!==s||(!(0!==o||!P(e,n,t))||(!(0!==r||!P(e,i,t))||(!(0!==a||!P(n,e,i))||!(0!==s||!P(n,t,i)))))}function P(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function _(e){return e>0?1:e<0?-1:0}function w(e,t){return y(e.prev,e,e.next)<0?y(e,t,e.next)>=0&&y(e,e.prev,t)>=0:y(e,t,e.prev)<0||y(e,e.next,t)<0}function C(e,t){var n=new k(e.i,e.x,e.y),i=new k(t.i,t.x,t.y),o=e.next,r=t.prev;return e.next=t,t.prev=e,n.next=o,o.prev=n,i.next=n,n.prev=i,r.next=i,i.prev=r,i}function S(e,t,n,i){var o=new k(e,t,n);return i?(o.next=i.next,o.prev=i,i.next.prev=o,i.next=o):(o.prev=o,o.next=o),o}function j(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function k(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function M(e,t,n,i){for(var o=0,r=t,a=n-i;r<n;r+=i)o+=(e[a]-e[r])*(e[r+1]+e[a+1]),a=r;return o}e.exports=i,e.exports.default=i,i.deviation=function(e,t,n,i){var o=t&&t.length,r=o?t[0]*n:e.length,a=Math.abs(M(e,0,r,n));if(o)for(var s=0,l=t.length;s<l;s++){var c=t[s]*n,u=s<l-1?t[s+1]*n:e.length;a-=Math.abs(M(e,c,u,n))}var d=0;for(s=0;s<i.length;s+=3){var g=i[s]*n,p=i[s+1]*n,h=i[s+2]*n;d+=Math.abs((e[g]-e[h])*(e[p+1]-e[g+1])-(e[g]-e[p])*(e[h+1]-e[g+1]))}return 0===a&&0===d?0:Math.abs((d-a)/a)},i.flatten=function(e){for(var t=e[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,o=0;o<e.length;o++){for(var r=0;r<e[o].length;r++)for(var a=0;a<t;a++)n.vertices.push(e[o][r][a]);o>0&&(i+=e[o-1].length,n.holes.push(i))}return n}},3119:function(e,t,n){"use strict";n.d(t,"a",(function(){return w}));var i=n(849),o=n(850),r=n(1035),a=n(647),s=n(2837),l=n(1036),c=n(3078),u=n(2986),d=n(4316),g=n(3124),p=n(3426),h=n(1037),f=n(2904),v=n(4284),m=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.id,o=void 0===n?Object(v.c)("column-geometry"):n,s=y(e),l=s.indices,c=s.attributes;return Object(r.a)(this,Object(a.a)(t).call(this,Object(h.a)({},e,{id:o,indices:l,attributes:c})))}return Object(l.a)(t,e),t}(n(3145).a);function y(e){var t=e.radius,n=e.height,i=void 0===n?1:n,o=e.nradial,r=void 0===o?10:o,a=e.vertices;f.a.assert(!a||a.length>=r);for(var s=r+1,l=3*s,c=2*Math.PI/r,u=new Uint16Array(3*r*2),d=new Float32Array(3*l),g=new Float32Array(3*l),p=0,h=0;h<s;h++)for(var v=h*c,m=a&&a[h%r],y=a&&a[(h+1)%r],x=Math.sin(v),b=Math.cos(v),P=0;P<2;P++)d[p+0]=m?m[0]:b*t,d[p+1]=m?m[1]:x*t,d[p+2]=(.5-P)*i,g[p+0]=m?y[0]-m[0]:b,g[p+1]=m?y[1]-m[1]:x,p+=3;for(var _=0;_<s;_++){var w=Math.floor(_/2)*Math.sign(_%2-.5),C=w*c,S=a&&a[(w+r)%r],j=Math.sin(C),k=Math.cos(C);d[p+0]=S?S[0]:k*t,d[p+1]=S?S[1]:j*t,d[p+2]=i/2,g[p+2]=1,p+=3}for(var M=0,A=0;A<r;A++)u[M++]=2*A+0,u[M++]=2*A+2,u[M++]=2*A+0,u[M++]=2*A+1,u[M++]=2*A+1,u[M++]=2*A+3;return{indices:u,attributes:{POSITION:{size:3,value:d},NORMAL:{size:3,value:g}}}}var x=d.a.fp64LowPart,b=new g.a,P=[0,0,0,255],_={diskResolution:{type:"number",min:4,value:20},vertices:null,radius:{type:"number",min:0,value:1e3},angle:{type:"number",value:0},offset:{type:"array",value:[0,0]},coverage:{type:"number",min:0,max:1,value:1},elevationScale:{type:"number",min:0,value:1},lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,extruded:!0,fp64:!1,wireframe:!1,filled:!0,stroked:!1,getPosition:{type:"accessor",value:function(e){return e.position}},getFillColor:{type:"accessor",value:P},getLineColor:{type:"accessor",value:P},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:b,getColor:{deprecatedFor:["getFillColor","getLineColor"]}},w=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(){return{vs:"\n#define SHADER_NAME column-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec3 normals;\n\nattribute vec3 instancePositions;\nattribute float instanceElevations;\nattribute vec2 instancePositions64xyLow;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute float instanceStrokeWidths;\n\nattribute vec3 instancePickingColors;\nuniform float opacity;\nuniform float radius;\nuniform float angle;\nuniform vec2 offset;\nuniform bool extruded;\nuniform bool isStroke;\nuniform float coverage;\nuniform float elevationScale;\nuniform float edgeDistance;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\nvarying vec4 vColor;\n\nvoid main(void) {\n  \n  vec4 color = isStroke ? instanceLineColors : instanceFillColors;\n  mat2 rotationMatrix = mat2(cos(angle), sin(angle), -sin(angle), cos(angle));\n  float elevation = 0.0;\n  float strokeOffsetRatio = 1.0;\n\n  if (extruded) {\n    elevation = instanceElevations * (positions.z + 1.0) / 2.0 * elevationScale;\n  } else if (isStroke) {\n    float widthPixels = clamp(project_size_to_pixel(instanceStrokeWidths * widthScale),\n      widthMinPixels, widthMaxPixels) / 2.0;\n    strokeOffsetRatio += sign(positions.z) * project_pixel_size(widthPixels) / project_size(edgeDistance * coverage * radius);\n  }\n  float shouldRender = float(color.a > 0.0 && instanceElevations >= 0.0);\n  float dotRadius = radius * coverage * shouldRender;\n  vec3 centroidPosition = vec3(instancePositions.xy, instancePositions.z + elevation);\n  vec2 centroidPosition64xyLow = instancePositions64xyLow;\n  vec3 pos = vec3(project_size(rotationMatrix * positions.xy * strokeOffsetRatio + offset) * dotRadius, 0.);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(vec3(rotationMatrix * normals.xy, normals.z));\n\n  if (extruded && !isStroke) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.0;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.0;\n  }\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME column-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","gouraud-lighting","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instanceElevations:{size:1,transition:!0,accessor:"getElevation"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceFillColors:{size:4,type:5121,transition:!0,accessor:"getFillColor",defaultValue:P},instanceLineColors:{size:4,type:5121,transition:!0,accessor:"getLineColor",defaultValue:P},instanceStrokeWidths:{size:1,accessor:"getLineWidth",transition:!0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;Object(s.a)(Object(a.a)(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o});var r=n.fp64!==i.fp64;if(r){var l=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(l)}),this.getAttributeManager().invalidateAll()}(r||n.diskResolution!==i.diskResolution||n.vertices!==i.vertices)&&this._updateGeometry(n)}},{key:"getGeometry",value:function(e,t){var n=new m({radius:1,height:2,vertices:t,nradial:e}),i=0;if(t)for(var o=0;o<e;o++){var r=t[o];i+=Math.sqrt(r[0]*r[0]+r[1]*r[1])/e}else i=1;return this.setState({edgeDistance:Math.cos(Math.PI/e)*i}),n}},{key:"_getModel",value:function(e){return new p.a(e,Object.assign({},this.getShaders(),{id:this.props.id,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_updateGeometry",value:function(e){var t=e.diskResolution,n=e.vertices,i=this.getGeometry(t,n);this.setState({fillVertexCount:i.attributes.POSITION.value.length/3,wireframeVertexCount:i.indices.value.length}),this.state.model.setProps({geometry:i})}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.lineWidthUnits,r=i.lineWidthScale,a=i.lineWidthMinPixels,s=i.lineWidthMaxPixels,l=i.elevationScale,c=i.extruded,u=i.filled,d=i.stroked,g=i.wireframe,p=i.offset,h=i.coverage,f=i.radius,v=i.angle,m=this.state,y=m.model,x=m.fillVertexCount,b=m.wireframeVertexCount,P=m.edgeDistance,_="pixels"===o?n.distanceScales.metersPerPixel[2]:1;y.setUniforms(Object.assign({},t,{radius:f,angle:v/180*Math.PI,offset:p,extruded:c,coverage:h,elevationScale:l,edgeDistance:P,widthScale:r*_,widthMinPixels:a,widthMaxPixels:s})),c&&g&&(y.setProps({isIndexed:!0}),y.setVertexCount(b).setDrawMode(1).setUniforms({isStroke:!0}).draw()),u&&(y.setProps({isIndexed:!1}),y.setVertexCount(x).setDrawMode(5).setUniforms({isStroke:!1}).draw()),!c&&d&&(y.setProps({isIndexed:!1}),y.setVertexCount(2*x/3).setDrawMode(5).setUniforms({isStroke:!0}).draw())}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var r=this.props,a=r.data,s=r.getPosition,l=e.value,u=n*e.size,d=Object(c.a)(a,n,i),g=d.iterable,p=d.objectInfo,h=!0,f=!1,v=void 0;try{for(var m,y=g[Symbol.iterator]();!(h=(m=y.next()).done);h=!0){var b=m.value;p.index++;var P=s(b,p);l[u++]=x(P[0]),l[u++]=x(P[1])}}catch(e){f=!0,v=e}finally{try{h||null==y.return||y.return()}finally{if(f)throw v}}}else e.value=new Float32Array(2)}}]),t}(u.a);w.layerName="ColumnLayer",w.defaultProps=_},3120:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var i=n(849),o=n(850),r=n(1035),a=n(647),s=n(2837),l=n(1036),c=n(3078),u=n(2986),d=n(4316),g=n(3426),p=n(3145),h=d.a.fp64LowPart,f=[0,0,0,255],v={radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,fp64:!1,filled:!0,getPosition:{type:"accessor",value:function(e){return e.position}},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:f},getLineColor:{type:"accessor",value:f},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}},m=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(e){return{vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec2 instancePositions64xyLow;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n  float outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n  gl_Position = project_position_to_clipspace(instancePositions, instancePositions64xyLow, offset);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity) / 255.;\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity) / 255.;\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\n\nvoid main(void) {\n\n  float distToCenter = length(unitPosition);\n\n  if (distToCenter > 1.0) {\n    discard;\n  } \n  if (distToCenter > innerUnitRadius) {\n    gl_FragColor = vLineColor;\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",modules:[this.use64bitProjection()?"project64":"project32","picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:3,transition:!0,accessor:"getPosition"},instancePositions64xyLow:{size:2,accessor:"getPosition",update:this.calculateInstancePositions64xyLow},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:4,transition:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:4,transition:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;if(Object(s.a)(Object(a.a)(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o}),n.fp64!==i.fp64){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.radiusScale,r=i.radiusMinPixels,a=i.radiusMaxPixels,s=i.stroked,l=i.filled,c=i.lineWidthUnits,u=i.lineWidthScale,d=i.lineWidthMinPixels,g=i.lineWidthMaxPixels,p="pixels"===c?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{stroked:s?1:0,filled:l,radiusScale:o,radiusMinPixels:r,radiusMaxPixels:a,lineWidthScale:u*p,lineWidthMinPixels:d,lineWidthMaxPixels:g})).draw()}},{key:"_getModel",value:function(e){return new g.a(e,Object.assign(this.getShaders(),{id:this.props.id,geometry:new p.a({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,-1,1,0,1,1,0,1,-1,0])}}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"calculateInstancePositions64xyLow",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var r=this.props,a=r.data,s=r.getPosition,l=e.value,u=n*e.size,d=Object(c.a)(a,n,i),g=d.iterable,p=d.objectInfo,f=!0,v=!1,m=void 0;try{for(var y,x=g[Symbol.iterator]();!(f=(y=x.next()).done);f=!0){var b=y.value;p.index++;var P=s(b,p);l[u++]=h(P[0]),l[u++]=h(P[1])}}catch(e){v=!0,m=e}finally{try{f||null==x.return||x.return()}finally{if(v)throw m}}}else e.value=new Float32Array(2)}}]),t}(u.a);m.layerName="ScatterplotLayer",m.defaultProps=v},3124:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var i=n(849),o=n(1035),r=n(647),a=n(54),s=n(1036),l={ambient:.35,diffuse:.6,shininess:32,specularColor:[30,30,30]},c=function(e){function t(e){var n;return Object(i.a)(this,t),n=Object(o.a)(this,Object(r.a)(t).call(this,e)),e=Object.assign({},l,e),Object.assign(Object(a.a)(n),e),n}return Object(s.a)(t,e),t}((function e(){Object(i.a)(this,e)}))},3256:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return d}));var i=n(3010),o=n(0),r=n.n(o),a=n(2920),s=n(2913),l=n(2932),c=n(2921);function u(e){return e.object.extraProps&&r.a.createElement("div",{className:"deckgl-tooltip"},Object.keys(e.object.extraProps).map((t,n)=>r.a.createElement(c.a,{key:"prop-"+n,label:t+": ",value:""+e.object.extraProps[t]})))}function d(e,t,n,o){const r=e,l=r.color_picker,c=[l.r,l.g,l.b,255*l.a];let d=t.data.features.map(e=>({...e,path:e.path,width:r.line_width,color:c}));if(r.js_data_mutator){d=Object(s.a)(r.js_data_mutator)(d)}return new i.a({id:"path-layer-"+r.slice_id,getColor:e=>e.color,getPath:e=>e.path,getWidth:e=>e.width,data:d,rounded:!0,widthScale:1,...Object(a.a)(r,o,u)})}t.default=Object(l.b)(d,(function(e){let t=[];return e.forEach(e=>{t=t.concat(e.path)}),t}))},3427:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return de}));var i=n(849),o=n(850),r=n(1035),a=n(647),s=n(1036),l=n(3015),c=n(2985),u=n(2837),d=n(3124),g=n(2904),p=n(2916),h=n(4315),f=n(4316),v=n(2881),m=n(3013),y=n(3078),x=v.a.count,b=f.a.fp64LowPart;function P(e){return Number.isFinite(e)?e:0}function _(e){var t=e.data,n=e.getPosition,i=e.cellSizeMeters,o=e.gpuGridAggregator,r=e.gpuAggregation,a=e.aggregationFlags,s=e.weightParams,l=e.fp64,c=void 0!==l&&l,u=e.coordinateSystem,d=void 0===u?m.a.LNGLAT:u,p=e.viewport,f=void 0===p?null:p,v=e.boundingBox,_=void 0===v?null:v,C={};a.dataChanged&&(_=(C=function(e,t,n){var i,o,r=x(e),a=new Float64Array(2*r),s=new Float32Array(2*r),l=1/0,c=-1/0,u=1/0,d=-1/0,g={};for(var p in n)g[p]=Object.assign({},n[p],{values:new Float32Array(3*r)});var h=Object(y.a)(e),f=h.iterable,v=h.objectInfo,m=!0,_=!1,w=void 0;try{for(var C,S=f[Symbol.iterator]();!(m=(C=S.next()).done);m=!0){var j=C.value;v.index++;var k=t(j,v),M=v.index;for(var A in o=k[0],i=k[1],a[2*M]=o,a[2*M+1]=i,s[2*M]=b(o),s[2*M+1]=b(i),n){var O=n[A].getWeight(j);Array.isArray(O)?(g[A].values[3*M]=O[0],g[A].values[3*M+1]=O[1],g[A].values[3*M+2]=O[2]):g[A].values[3*M]=O}Number.isFinite(i)&&Number.isFinite(o)&&(l=i<l?i:l,c=i>c?i:c,u=o<u?o:u,d=o>d?o:d)}}catch(e){_=!0,w=e}finally{try{m||null==S.return||S.return()}finally{if(_)throw w}}var L={xMin:P(u),xMax:P(d),yMin:P(l),yMax:P(c)};return{positions:a,positions64xyLow:s,weights:g,boundingBox:L}}(t,n,s)).boundingBox);var S=[i,i],j=[0,0];switch(g.a.assert(d===m.a.LNGLAT||d===m.a.IDENTITY),d){case m.a.LNGLAT:case m.a.LNGLAT_DEPRECATED:var k=function(e,t){var n=e.yMin,i=e.yMax;return function(e,t){var n=(a=e,a/6378e3*(180/Math.PI)),i=(o=t,r=e,r/6378e3*(180/Math.PI)/Math.cos(o*Math.PI/180));var o,r;var a;return{yOffset:n,xOffset:i}}(t,(n+i)/2)}(_,i);S=[k.xOffset,k.yOffset],j=[-180,-90];break;case m.a.IDENTITY:j=[-f.width/2,-f.height/2];break;default:g.a.assert(!1)}var M=function(e){var t=e.boundingBox,n=e.cellSize,i=e.worldOrigin,o=t.yMin,r=t.yMax,a=t.xMin,s=t.xMax,l=w(a-i[0],n[0])+i[0],c=w(o-i[1],n[1])+i[1],u=(new h.a).translate([-1*l,-1*c,0]),d=[l,c],g=s-a+n[0],p=r-o+n[1],f=[Math.ceil(g/n[0]),Math.ceil(p/n[1])];return{gridOrigin:d,gridSize:f,width:g,height:p,gridTransformMatrix:u}}({boundingBox:_,cellSize:S,worldOrigin:j});return{weights:o.run({positions:C.positions,positions64xyLow:C.positions64xyLow,weights:C.weights,cellSize:S,width:M.width,height:M.height,gridTransformMatrix:M.gridTransformMatrix,useGPU:r,changeFlags:a,fp64:c}),gridSize:M.gridSize,gridOrigin:M.gridOrigin,cellSize:S,boundingBox:_}}function w(e,t){var n=e<0?-1:1,i=n<0?Math.abs(e)+t:Math.abs(e);return(i=Math.floor(i/t)*t)*n}var C=n(2942),S=n(2986),j=n(3426),k=n(1037),M=n(3145),A=n(4284),O=new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),L=new Float32Array([-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1,-1,-1,1,-1,-1,1,1,1,1,1,1,1,-1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,1,-1,1,1,-1,1,-1]),E=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0]),z=new Float32Array([0,0,1,0,1,1,0,1,1,0,1,1,0,1,0,0,0,1,0,0,1,0,1,1,1,1,0,1,0,0,1,0,1,0,1,1,0,1,0,0,0,0,1,0,1,1,0,1]),F={POSITION:{size:3,value:new Float32Array(L)},NORMAL:{size:3,value:new Float32Array(E)},TEXCOORD_0:{size:2,value:new Float32Array(z)}},D=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(i.a)(this,t);var n=e.id,o=void 0===n?Object(A.c)("cube-geometry"):n;return Object(r.a)(this,Object(a.a)(t).call(this,Object(k.a)({},e,{id:o,indices:{size:1,value:new Uint16Array(O)},attributes:Object(k.a)({},F,e.attributes)})))}return Object(s.a)(t,e),t}(M.a),R=f.a.fp64LowPart,T=new d.a,I={colorDomain:null,colorRange:C.b,elevationDomain:null,elevationRange:[0,1e3],elevationScale:{type:"number",min:0,value:1},gridSize:{type:"array",min:0,value:[1,1]},gridOrigin:{type:"array",min:0,value:[0,0]},gridOffset:{type:"array",min:0,value:[0,0]},cellSize:{type:"number",min:0,max:1e3,value:1e3},offset:{type:"array",min:0,value:[1,1]},coverage:{type:"number",min:0,max:1,value:1},extruded:!0,fp64:!1,material:T},N=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(){return{vs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 normals;\n\nin vec4 colors;\nin vec4 elevations;\nin vec3 instancePickingColors;\nuniform vec2 offset;\nuniform bool extruded;\nuniform float cellSize;\nuniform float coverage;\nuniform float opacity;\nuniform float elevationScale;\n\nuniform ivec2 gridSize;\nuniform vec2 gridOrigin;\nuniform vec2 gridOriginLow;\nuniform vec2 gridOffset;\nuniform vec2 gridOffsetLow;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 elevationRange;\nuniform vec2 colorDomain;\nuniform bool colorDomainValid;\nuniform vec2 elevationDomain;\nuniform bool elevationDomainValid;\n\nlayout(std140) uniform;\nuniform ColorData\n{\n  vec4 maxMinCount;\n} colorData;\nuniform ElevationData\n{\n  vec4 maxMinCount;\n} elevationData;\n\n#define EPSILON 0.00001\nout vec4 vColor;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  return outColor;\n}\n\nfloat linearScale(vec2 domain, vec2 range, float value) {\n  if (value >= (domain.x - EPSILON) && value <= (domain.y + EPSILON)) {\n    return ((value - domain.x) / (domain.y - domain.x)) * (range.y - range.x) + range.x;\n  }\n  return -1.;\n}\n\nvoid main(void) {\n\n  vec2 clrDomain = colorDomainValid ? colorDomain : vec2(colorData.maxMinCount.a, colorData.maxMinCount.r);\n  vec4 color = quantizeScale(clrDomain, colorRange, colors.r);\n\n  float elevation = 0.0;\n\n  if (extruded) {\n    vec2 elvDomain = elevationDomainValid ? elevationDomain : vec2(elevationData.maxMinCount.a, elevationData.maxMinCount.r);\n    elevation = linearScale(elvDomain, elevationRange, elevations.r);\n    elevation = elevation  * (positions.z + 1.0) / 2.0 * elevationScale;\n  }\n  float shouldRender = float(color.r > 0.0 && elevations.r >= 0.0);\n  float dotRadius = cellSize / 2. * coverage * shouldRender;\n\n  int yIndex = (gl_InstanceID / gridSize[0]);\n  int xIndex = gl_InstanceID - (yIndex * gridSize[0]);\n\n  vec2 instancePositionXFP64 = mul_fp64(vec2(gridOffset[0], gridOffsetLow[0]), vec2(float(xIndex), 0.));\n  instancePositionXFP64 = sum_fp64(instancePositionXFP64, vec2(gridOrigin[0], gridOriginLow[0]));\n  vec2 instancePositionYFP64 = mul_fp64(vec2(gridOffset[1], gridOffsetLow[1]), vec2(float(yIndex), 0.));\n  instancePositionYFP64 = sum_fp64(instancePositionYFP64, vec2(gridOrigin[1], gridOriginLow[1]));\n\n  vec3 centroidPosition = vec3(instancePositionXFP64[0], instancePositionYFP64[0], elevation);\n  vec2 centroidPosition64xyLow = vec2(instancePositionXFP64[1], instancePositionYFP64[1]);\n  vec3 pos = vec3(project_size(positions.xy + offset) * dotRadius, 0.);\n  picking_setPickingColor(instancePickingColors);\n\n  vec4 position_commonspace;\n  gl_Position = project_position_to_clipspace(centroidPosition, centroidPosition64xyLow, pos, position_commonspace);\n\n  vec3 normals_commonspace = project_normal(normals);\n\n   if (extruded) {\n    vec3 lightColor = lighting_getLightColor(color.rgb, project_uCameraPosition, position_commonspace.xyz, normals_commonspace);\n    vColor = vec4(lightColor, color.a * opacity) / 255.;\n  } else {\n    vColor = vec4(color.rgb, color.a * opacity) / 255.;\n  }\n}\n",fs:"#version 300 es\n#define SHADER_NAME gpu-grid-cell-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\n\nout vec4 fragColor;\n\nvoid main(void) {\n  fragColor = vColor;\n  fragColor = picking_filterColor(fragColor);\n}\n",modules:["project32","gouraud-lighting","picking","fp64"]}}},{key:"initializeState",value:function(){var e=this.context.gl;this.getAttributeManager().addInstanced({colors:{size:4,update:this.calculateColors,noAlloc:!0},elevations:{size:4,update:this.calculateElevations,noAlloc:!0}});var t=this._getModel(e);this._setupUniformBuffer(t),this.setState({model:t})}},{key:"_getModel",value:function(e){return new j.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new D,isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.data,o=n.cellSize,r=n.offset,a=n.extruded,s=n.elevationScale,l=n.coverage,c=n.gridSize,u=n.gridOrigin,d=n.gridOffset,g=n.colorRange,p=n.elevationRange,h=[R(u[0]),R(u[1])],f=[R(d[0]),R(d[1])],v=i.color.maxMinBuffer,m=i.elevation.maxMinBuffer;v.bind({target:35345,index:0}),m.bind({target:35345,index:1});var y=this.getDomainUniforms();this.state.model.setUniforms(Object.assign({},t,y,{cellSize:o,offset:r,extruded:a,elevationScale:s,coverage:l,gridSize:c,gridOrigin:u,gridOriginLow:h,gridOffset:d,gridOffsetLow:f,colorRange:g,elevationRange:p})).draw(),v.unbind({target:35345,index:0}),m.unbind({target:35345,index:1})}},{key:"calculateColors",value:function(e){var t=this.props.data;e.update({buffer:t.color.aggregationBuffer})}},{key:"calculateElevations",value:function(e){var t=this.props.data;e.update({buffer:t.elevation.aggregationBuffer})}},{key:"getDomainUniforms",value:function(){var e=this.props,t=e.colorDomain,n=e.elevationDomain,i={};return null!==t?(i.colorDomainValid=!0,i.colorDomain=t):i.colorDomainValid=!1,null!==n?(i.elevationDomainValid=!0,i.elevationDomain=n):i.elevationDomainValid=!1,i}},{key:"_setupUniformBuffer",value:function(e){var t=this.context.gl,n=e.program.handle,i=t.getUniformBlockIndex(n,"ColorData"),o=t.getUniformBlockIndex(n,"ElevationData");t.uniformBlockBinding(n,i,0),t.uniformBlockBinding(n,o,1)}}]),t}(S.a);N.layerName="GPUGridCellLayer",N.defaultProps=I;var V=n(1159);function U(e,t,n){var i=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,o=1/0,r=-1/0,a=Object(y.a)(t),s=a.iterable,l=a.objectInfo,c=!0,u=!1,d=void 0;try{for(var g,p=s[Symbol.iterator]();!(c=(g=p.next()).done);c=!0){var h=g.value;l.index++,e=i(h,l)[1],Number.isFinite(e)&&(o=e<o?e:o,r=e>r?e:r)}}catch(e){u=!0,d=e}finally{try{c||null==p.return||p.return()}finally{if(u)throw d}}var f=(o+r)/2,v=B(n,f);if(v.xOffset<=0||v.yOffset<=0)return{gridHash:{},gridOffset:v};var m={};l.index=-1;var x=!0,b=!1,P=void 0;try{for(var _,w=s[Symbol.iterator]();!(x=(_=w.next()).done);x=!0){var C=_.value;l.index++;var S=i(C,l),j=Object(V.a)(S,2),k=j[0],M=j[1];if(Number.isFinite(M)&&Number.isFinite(k)){var A=Math.floor((M+90)/v.yOffset),O=Math.floor((k+180)/v.xOffset),L="".concat(A,"-").concat(O);m[L]=m[L]||{count:0,points:[]},m[L].count+=1,m[L].points.push(C)}}}catch(e){b=!0,P=e}finally{try{x||null==w.return||w.return()}finally{if(b)throw P}}return{gridHash:m,gridOffset:v}}(e,t,n),o=i.gridHash,r=i.gridOffset;return{gridHash:o,gridOffset:r,layerData:function(e,t){return Object.keys(e).reduce((function(n,i,o){var r=i.split("-"),a=parseInt(r[0],10),s=parseInt(r[1],10);return n.push(Object.assign({index:o,position:[t.xOffset*s-180,t.yOffset*a-90]},e[i])),n}),[])}(o,r)}}function B(e,t){var n;return{yOffset:e/6378e3*(180/Math.PI),xOffset:(n=t,e/6378e3*(180/Math.PI)/Math.cos(n*Math.PI/180))}}var W=new d.a,q={colorDomain:null,colorRange:C.b,getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",elevationDomain:null,elevationRange:[0,1e3],getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationScale:{type:"number",min:0,value:1},cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(e){return e.position}},extruded:!1,fp64:!1,material:W,gpuAggregation:!0},G=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"initializeState",value:function(){var e=this.context.gl,t=c.a.isSupported(e);t||g.a.error("GPUGridLayer is not supported on this browser, use GridLayer instead")();var n={id:"".concat(this.id,"-gpu-aggregator"),shaderCache:this.context.shaderCache};this.state={gpuGridAggregator:new c.a(e,n),isSupported:t}}},{key:"updateState",value:function(e){var t=this.getAggregationFlags(e);t&&(this.getLayerData(t),this.setState({gridHash:null}))}},{key:"finalizeState",value:function(){Object(u.a)(Object(a.a)(t.prototype),"finalizeState",this).call(this),this.state.gpuGridAggregator.delete()}},{key:"getAggregationFlags",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags,o=null;return!!this.state.isSupported&&(this.isDataChanged({oldProps:t,props:n,changeFlags:i})&&(o=Object.assign({},o,{dataChanged:!0})),t.cellSize!==n.cellSize&&(o=Object.assign({},o,{cellSizeChanged:!0})),o)}},{key:"isDataChanged",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags;return!!i.dataChanged||(t.gpuAggregation!==n.gpuAggregation||(t.colorAggregation!==n.colorAggregation||t.elevationAggregation!==n.elevationAggregation||!(!i.updateTriggersChanged||!(i.updateTriggersChanged.all||i.updateTriggersChanged.getPosition||i.updateTriggersChanged.getColorWeight||i.updateTriggersChanged.getElevationWeight))))}},{key:"getHashKeyForIndex",value:function(e){var t=this.state,n=t.gridSize,i=t.gridOrigin,o=t.cellSize,r=Math.floor(e/n[0]),a=e-r*n[0],s=Math.floor((r*o[1]+i[1]+90+o[1]/2)/o[1]),l=Math.floor((a*o[0]+i[0]+180+o[0]/2)/o[0]);return"".concat(s,"-").concat(l)}},{key:"getPositionForIndex",value:function(e){var t=this.state,n=t.gridSize,i=t.gridOrigin,o=t.cellSize,r=Math.floor(e/n[0]),a=e-r*n[0],s=r*o[1]+i[1];return[a*o[0]+i[0],s]}},{key:"getPickingInfo",value:function(e){var t=e.info,n=e.mode,i=t.index,o=null;if(i>=0){var r=this.state.gpuGridAggregator,a=this.getPositionForIndex(i),s=c.a.getAggregationData(Object.assign({pixelIndex:i},r.getData("color"))),l=c.a.getAggregationData(Object.assign({pixelIndex:i},r.getData("elevation")));if(o={colorValue:s.cellWeight,elevationValue:l.cellWeight,count:s.cellCount||l.cellCount,position:a,totalCount:s.totalCount||l.totalCount},"hover"!==n){var u=this.props,d=u.data,g=u.getPosition,p=this.state.gridHash;if(!p)p=U(d,this.props.cellSize,g).gridHash,this.setState({gridHash:p});var h=p[this.getHashKeyForIndex(i)];Object.assign(o,h)}}return Object.assign(t,{picked:Boolean(o),object:o})}},{key:"getLayerData",value:function(e){var t=this.props,n=t.data,i=t.cellSize,o=t.getPosition,r=t.gpuAggregation,a=t.getColorWeight,s=t.colorAggregation,l=t.getElevationWeight,c=t.elevationAggregation,u=t.fp64,d=_({data:n,cellSizeMeters:i,getPosition:o,weightParams:{color:{getWeight:a,operation:p.a[s]||p.a[q.colorAggregation],needMin:!0,needMax:!0,combineMaxMin:!0},elevation:{getWeight:l,operation:p.a[c]||p.a[q.elevationAggregation],needMin:!0,needMax:!0,combineMaxMin:!0}},gpuAggregation:r,gpuGridAggregator:this.state.gpuGridAggregator,boundingBox:this.state.boundingBox,aggregationFlags:e,fp64:u}),g=d.weights,h=d.gridSize,f=d.gridOrigin,v=d.cellSize,m=d.boundingBox;this.setState({weights:g,gridSize:h,gridOrigin:f,cellSize:v,boundingBox:m})}},{key:"renderLayers",value:function(){if(!this.state.isSupported)return null;var e=this.props,t=e.elevationScale,n=e.fp64,i=e.extruded,o=e.cellSize,r=e.coverage,a=e.material,s=e.elevationRange,l=e.colorDomain,c=e.elevationDomain,u=this.state,d=u.weights,g=u.gridSize,p=u.gridOrigin,h=u.cellSize,f=Object(C.a)(this.props.colorRange,Float32Array,255);return new(this.getSubLayerClass("gpu-grid-cell",N))({gridSize:g,gridOrigin:p,gridOffset:h,colorRange:f,elevationRange:s,colorDomain:l,elevationDomain:c,fp64:n,cellSize:o,coverage:r,material:a,elevationScale:t,extruded:i},this.getSubLayerProps({id:"gpu-grid-cell"}),{data:d,numInstances:g[0]*g[1]})}}]),t}(l.a);G.layerName="GPUGridLayer",G.defaultProps=q;var H=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"getGeometry",value:function(e){return new D}},{key:"draw",value:function(e){var t=e.uniforms,n=this.props,i=n.elevationScale,o=n.extruded,r=n.offset,a=n.coverage,s=n.cellSize,l=n.angle;this.state.model.setUniforms(Object.assign({},t,{radius:s/2,angle:l,offset:r,extruded:o,coverage:a,elevationScale:i,edgeDistance:1,isWireframe:!1})).draw()}}]),t}(n(3119).a);H.layerName="GridCellLayer",H.defaultProps={cellSize:{type:"number",min:0,value:1e3},offset:{type:"array",min:0,value:[1,1]}};var Q=n(3016),X=n(3017);function Z(){}var J=new d.a,Y={colorDomain:null,colorRange:C.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",min:0,max:100,value:0},upperPercentile:{type:"number",min:0,max:100,value:100},onSetColorDomain:Z,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",min:0,max:100,value:0},elevationUpperPercentile:{type:"number",min:0,max:100,value:100},elevationScale:1,onSetElevationDomain:Z,cellSize:{type:"number",min:0,max:1e3,value:1e3},coverage:{type:"number",min:0,max:1,value:1},getPosition:{type:"accessor",value:function(e){return e.position}},extruded:!1,fp64:!1,material:J},$=["getColorValue","colorAggregation","getColorWeight"],K=["getElevationValue","elevationAggregation","getElevationWeight"],ee=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"initializeState",value:function(){this.state={layerData:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:Z,elevationScaleFunc:Z,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(e){var t=this,n=e.oldProps,i=e.props,o=e.changeFlags;this.updateGetValueFuncs(n,i);var r=this.needsReProjectPoints(n,i,o);o.dataChanged||r?this.getLayerData():(this.getDimensionChanges(n,i)||[]).forEach((function(e){return"function"==typeof e&&e.apply(t)}))}},{key:"colorElevationPropsChanged",value:function(e,t){for(var n=!1,i=!1,o=0;o<$.length;o++){var r=$[o];e[r]!==t[r]&&(n=!0)}for(var a=0;a<K.length;a++){var s=K[a];e[s]!==t[s]&&(i=!0)}return{colorChanged:n,elevationChanged:i}}},{key:"updateGetValueFuncs",value:function(e,t){var n=t.getColorValue,i=t.getElevationValue,o=this.props,r=o.colorAggregation,a=o.getColorWeight,s=o.elevationAggregation,l=o.getElevationWeight,c=this.colorElevationPropsChanged(e,t),u=c.colorChanged,d=c.elevationChanged;u&&null===n&&(n=Object(p.b)(r,a)),d&&null===i&&(i=Object(p.b)(s,l)),n&&this.setState({getColorValue:n}),i&&this.setState({getElevationValue:i})}},{key:"needsReProjectPoints",value:function(e,t,n){return e.cellSize!==t.cellSize||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPosition)}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(e,t){var n=this.state.dimensionUpdaters,i=[];for(var o in n){var r=n[o].find((function(n){return n.triggers.some((function(n){return e[n]!==t[n]}))}));r&&i.push(r.updater)}return i.length?i:null}},{key:"getPickingInfo",value:function(e){var t=e.info,n=this.state,i=n.sortedColorBins,o=n.sortedElevationBins,r=null;if(t.picked&&t.index>-1){var a=this.state.layerData[t.index],s=i.binMap[a.index]&&i.binMap[a.index].value,l=o.binMap[a.index]&&o.binMap[a.index].value;r=Object.assign({colorValue:s,elevationValue:l},a)}return Object.assign(t,{picked:Boolean(r),object:r})}},{key:"getUpdateTriggers",value:function(){var e=this,t=this.state.dimensionUpdaters,n={},i=function(i){n[i]={};var o=!0,r=!1,a=void 0;try{for(var s,l=t[i][Symbol.iterator]();!(o=(s=l.next()).done);o=!0){s.value.triggers.forEach((function(t){n[i][t]=e.props[t]}))}}catch(e){r=!0,a=e}finally{try{o||null==l.return||l.return()}finally{if(r)throw a}}};for(var o in t)i(o);return n}},{key:"getLayerData",value:function(){var e=this.props,t=U(e.data,e.cellSize,e.getPosition).layerData;this.setState({layerData:t}),this.getSortedBins()}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var e=this.state.getColorValue,t=new Q.a(this.state.layerData||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var e=this.state.getElevationValue,t=new Q.a(this.state.layerData||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var e=this.props,t=e.lowerPercentile,n=e.upperPercentile,i=e.onSetColorDomain;this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var e=this.props,t=e.elevationLowerPercentile,n=e.elevationUpperPercentile,i=e.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var e=this.props.colorRange,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(X.b)(t,e)}},{key:"getElevationScale",value:function(){var e=this.props.elevationRange,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(X.a)(t,e)}},{key:"_onGetSublayerColor",value:function(e){var t=this.state,n=t.sortedColorBins,i=t.colorScaleFunc,o=t.colorValueDomain,r=n.binMap[e.index]&&n.binMap[e.index].value,a=this.props.colorDomain||o,s=r>=a[0]&&r<=a[a.length-1]?i(r):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(e){var t=this.state,n=t.sortedElevationBins,i=t.elevationScaleFunc,o=t.elevationValueDomain,r=n.binMap[e.index]&&n.binMap[e.index].value,a=this.props.elevationDomain||o;return r>=a[0]&&r<=a[a.length-1]?i(r):-1}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,n=e.fp64,i=e.extruded,o=e.cellSize,r=e.coverage,a=e.material,s=e.transitions;return new(this.getSubLayerClass("grid-cell",H))({fp64:n,cellSize:o,coverage:r,material:a,elevationScale:t,extruded:i,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:s&&{getFillColor:s.getColorValue||s.getColorWeight,getElevation:s.getElevationValue||s.getElevationWeight}},this.getSubLayerProps({id:"grid-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.layerData})}}]),t}(l.a);ee.layerName="CPUGridLayer",ee.defaultProps=Y;var te=Object.assign({},G.defaultProps,ee.defaultProps,{gpuAggregation:!1}),ne=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"initializeState",value:function(){this.state={useGPUAggregation:!0}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props,n=(e.changeFlags,{});n.useGPUAggregation=this.canUseGPUAggregation(t),this.setState(n)}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e.updateTriggers,i=this.state.useGPUAggregation?"GPU":"CPU";return new(this.state.useGPUAggregation?this.getSubLayerClass("GPU",G):this.getSubLayerClass("CPU",ee))(this.props,this.getSubLayerProps({id:i,updateTriggers:n}),{data:t})}},{key:"canUseGPUAggregation",value:function(e){var t=e.gpuAggregation,n=e.lowerPercentile,i=e.upperPercentile,o=e.getColorValue,r=e.getElevationValue;return!!t&&(!!c.a.isSupported(this.context.gl)&&(0===n&&100===i&&(null===o&&null===r)))}}]),t}(l.a);ne.layerName="GridLayer",ne.defaultProps=te;var ie=n(0),oe=n.n(ie),re=n(7),ae=n(2920),se=n(2913),le=n(2932),ce=n(2921);function ue(e){return oe.a.createElement("div",{className:"deckgl-tooltip"},oe.a.createElement(ce.a,{label:Object(re.c)("Longitude and Latitude")+": ",value:e.coordinate[0]+", "+e.coordinate[1]}),oe.a.createElement(ce.a,{label:Object(re.c)("Height")+": ",value:""+e.object.elevationValue}))}function de(e,t,n,i){const o=e,r=o.color_picker;let a=t.data.features.map(e=>({...e,color:[r.r,r.g,r.b,255*r.a]}));if(o.js_data_mutator){a=Object(se.a)(o.js_data_mutator)(a)}const s=Object(ae.b)(o.js_agg_function,e=>e.weight);return new ne({id:"grid-layer-"+o.slice_id,data:a,pickable:!0,cellSize:o.grid_size,minColor:[0,0,0,0],extruded:o.extruded,maxColor:[r.r,r.g,r.b,255*r.a],outline:!1,getElevationValue:s,getColorValue:s,...Object(ae.a)(o,i,ue)})}t.default=Object(le.b)(de,(function(e){return e.map(e=>e.position)}))},3430:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return V}));var i=n(0),o=n.n(i),r=n(2),a=n.n(r),s=n(849),l=n(850),c=n(1035),u=n(647),d=n(2837),g=n(1036),p=n(2881),h=n(3078),f=n(2904),v=n(3137),m=n(2986),y=n(2942),x=n(2985),b=n(2916),P=n(4282),_=n(3426),w=n(3145),C=n(2988),S=p.a.count,j=[0,0,0,0],k=[0,255,0,255],M=["minColor","maxColor","colorRange","colorDomain"],A={cellSizePixels:{value:100,min:1},cellMarginPixels:{value:2,min:0,max:5},colorDomain:null,colorRange:y.b,getPosition:{type:"accessor",value:function(e){return e.position}},getWeight:{type:"accessor",value:function(e){return[1,0,0]}},gpuAggregation:!0,aggregation:"SUM"},O=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(g.a)(t,e),Object(l.a)(t,[{key:"getShaders",value:function(){var e=Object(P.d)(this.context.gl)?{vs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-vertex-shader\n#define RANGE_COUNT 6\n\nin vec3 positions;\nin vec3 instancePositions;\nin vec4 instanceCounts;\nin vec3 instancePickingColors;\n\nlayout(std140) uniform;\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform AggregationData\n{\n  vec4 maxCount;\n} aggregationData;\n\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\n\nout vec4 vColor;\nout float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r ;\n  float maxWeight = aggregationData.maxCount.r;\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#version 300 es\n#define SHADER_NAME screen-grid-layer-fragment-shader\n\nprecision highp float;\n\nin vec4 vColor;\nin float vSampleCount;\nout vec4 fragColor;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  fragColor = vColor;\n\n  fragColor = picking_filterColor(fragColor);\n}\n"}:{vs:"#define SHADER_NAME screen-grid-layer-vertex-shader-webgl1\n#define RANGE_COUNT 6\n\nattribute vec3 positions;\nattribute vec3 instancePositions;\nattribute vec4 instanceCounts;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform vec3 cellScale;\nuniform vec4 minColor;\nuniform vec4 maxColor;\nuniform float maxWeight;\nuniform vec4 colorRange[RANGE_COUNT];\nuniform vec2 colorDomain;\nuniform bool shouldUseMinMax;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvec4 quantizeScale(vec2 domain, vec4 range[RANGE_COUNT], float value) {\n  vec4 outColor = vec4(0., 0., 0., 0.);\n  if (value >= domain.x && value <= domain.y) {\n    float domainRange = domain.y - domain.x;\n    if (domainRange <= 0.) {\n      outColor = colorRange[0];\n    } else {\n      float rangeCount = float(RANGE_COUNT);\n      float rangeStep = domainRange / rangeCount;\n      float idx = floor((value - domain.x) / rangeStep);\n      idx = clamp(idx, 0., rangeCount - 1.);\n      int intIdx = int(idx);\n      outColor = colorRange[intIdx];\n    }\n  }\n  outColor = outColor / 255.;\n  return outColor;\n}\n\nvoid main(void) {\n  vSampleCount = instanceCounts.a;\n\n  float weight = instanceCounts.r;\n  float step = weight / maxWeight;\n  vec4 minMaxColor = mix(minColor, maxColor, step) / 255.;\n\n  vec2 domain = colorDomain;\n  float domainMaxValid = float(colorDomain.y != 0.);\n  domain.y = mix(maxWeight, colorDomain.y, domainMaxValid);\n  vec4 rangeColor = quantizeScale(domain, colorRange, weight);\n\n  float rangeMinMax = float(shouldUseMinMax);\n  vec4 color = mix(rangeColor, minMaxColor, rangeMinMax);\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n\n  gl_Position = vec4(instancePositions + positions * cellScale, 1.);\n}\n",fs:"#define SHADER_NAME screen-grid-layer-fragment-shader-webgl1\n\nprecision highp float;\n\nvarying vec4 vColor;\nvarying float vSampleCount;\n\nvoid main(void) {\n  if (vSampleCount <= 0.0) {\n    discard;\n  }\n  gl_FragColor = vColor;\n\n  gl_FragColor = picking_filterColor(gl_FragColor);\n}\n"};return e.modules=["picking"],e}},{key:"initializeState",value:function(){var e=this.getAttributeManager(),t=this.context.gl;e.addInstanced({instancePositions:{size:3,update:this.calculateInstancePositions},instanceCounts:{size:4,transition:!0,accessor:["getPosition","getWeight"],update:this.calculateInstanceCounts,noAlloc:!0}});var n={id:"".concat(this.id,"-aggregator"),shaderCache:this.context.shaderCache},i=this._getMaxCountBuffer(t),o={color:{size:1,operation:b.a.SUM,needMax:!0,maxBuffer:i}};this.setState({model:this._getModel(t),gpuGridAggregator:new x.a(t,n),maxBuffer:i,weights:o}),this._setupUniformBuffer()}},{key:"shouldUpdateState",value:function(e){return e.changeFlags.somethingChanged}},{key:"updateState",value:function(e){Object(d.a)(Object(u.a)(t.prototype),"updateState",this).call(this,e),this._updateUniforms(e),e.changeFlags.dataChanged&&this._processData();var n=this._getAggregationChangeFlags(e);n&&this._updateAggregation(n)}},{key:"finalizeState",value:function(){Object(d.a)(Object(u.a)(t.prototype),"finalizeState",this).call(this);var e=this.state,n=e.aggregationBuffer,i=e.maxBuffer;e.gpuGridAggregator.delete(),n&&n.delete(),i&&i.delete()}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.gl,i=this.props.parameters,o=void 0===i?{}:i,r=this.props.minColor||j,a=this.props.maxColor||k,s=this.props.colorDomain||[1,0],l=this.state,c=l.model,u=l.maxBuffer,d=l.cellScale,g=l.shouldUseMinMax,p=l.colorRange,h=l.maxWeight,f={minColor:r,maxColor:a,cellScale:d,colorRange:p,colorDomain:s,shouldUseMinMax:g};Object(P.d)(n)?u.bind({target:35345}):f.maxWeight=h,t=Object.assign(f,t),c.draw({uniforms:t,parameters:Object.assign({depthTest:!1,depthMask:!1},o)}),Object(P.d)(n)&&u.unbind()}},{key:"calculateInstancePositions",value:function(e,t){for(var n=t.numInstances,i=this.context.viewport,o=i.width,r=i.height,a=this.props.cellSizePixels,s=this.state.numCol,l=e.value,c=e.size,u=0;u<n;u++){var d=u%s,g=Math.floor(u/s);l[u*c+0]=d*a/o*2-1,l[u*c+1]=1-g*a/r*2,l[u*c+2]=0}}},{key:"calculateInstanceCounts",value:function(e,t){t.numInstances;var n=this.state.aggregationBuffer;e.update({buffer:n})}},{key:"getPickingInfo",value:function(e){var t=e.info,n=(e.mode,t.index);if(n>=0){var i=this.state.gpuGridAggregator.getData("color");t.object=x.a.getAggregationData(Object.assign({pixelIndex:n},i))}return t}},{key:"_getAggregationChangeFlags",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags,o=n.cellSizePixels!==t.cellSizePixels||n.cellMarginPixels!==t.cellMarginPixels,r=i.dataChanged||n.aggregation!==t.aggregation,a=i.viewportChanged;return o||r||a?{cellSizeChanged:o,dataChanged:r,viewportChanged:a}:null}},{key:"_getModel",value:function(e){return new _.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new w.a({drawMode:6,attributes:{positions:new Float32Array([0,0,0,1,0,0,1,1,0,0,1,0])}}),isInstanced:!0,shaderCache:this.context.shaderCache}))}},{key:"_getMaxCountBuffer",value:function(e){return new C.a(e,{byteLength:16,index:0,accessor:{size:4}})}},{key:"_processData",value:function(){var e=this.props,t=e.data,n=e.getPosition,i=e.getWeight,o=S(t),r=new Float64Array(2*o),a=new Float32Array(3*o),s=this.state.weights,l=Object(h.a)(t),c=l.iterable,u=l.objectInfo,d=!0,g=!1,p=void 0;try{for(var f,v=c[Symbol.iterator]();!(d=(f=v.next()).done);d=!0){var m=f.value;u.index++;var y=n(m,u),x=i(m,u),b=u.index;r[2*b]=y[0],r[2*b+1]=y[1],Array.isArray(x)?(a[3*b]=x[0],a[3*b+1]=x[1],a[3*b+2]=x[2]):a[3*b]=x}}catch(e){g=!0,p=e}finally{try{d||null==v.return||v.return()}finally{if(g)throw p}}s.color.values=a,this.setState({positions:r})}},{key:"_setupUniformBuffer",value:function(){var e=this.context.gl;if(Object(P.d)(e)){var t=this.state.model.program.handle,n=e.getUniformBlockIndex(t,"AggregationData");e.uniformBlockBinding(t,n,0)}}},{key:"_shouldUseMinMax",value:function(){var e=this.props,t=e.minColor,n=e.maxColor,i=e.colorDomain,o=e.colorRange;return t||n?(f.a.deprecated("ScreenGridLayer props: minColor and maxColor","colorRange, colorDomain")(),!0):!i&&!o}},{key:"_updateAggregation",value:function(e){var t=this.getAttributeManager();(e.cellSizeChanged||e.viewportChanged)&&(this._updateGridParams(),t.invalidateAll());var n=this.props,i=n.cellSizePixels,o=n.gpuAggregation,r=this.state,a=r.positions,s=r.weights,l=this.context.viewport;s.color.operation=b.a[this.props.aggregation.toUpperCase()]||b.a.SUM;var c=!1,u=null;this.context.viewport instanceof v.a?c=!0:(c=!1,u=l.pixelProjectionMatrix);var d=this.state.gpuGridAggregator.run({positions:a,weights:s,cellSize:[i,i],viewport:l,changeFlags:e,useGPU:o,projectPoints:c,gridTransformMatrix:u}),g=d.color.maxData&&Number.isFinite(d.color.maxData[0])?d.color.maxData[0]:0;this.setState({maxWeight:g}),t.invalidate("instanceCounts")}},{key:"_updateUniforms",value:function(e){var t=e.oldProps,n=e.props,i=e.changeFlags,o={};if(M.some((function(e){return t[e]!==n[e]}))&&(o.shouldUseMinMax=this._shouldUseMinMax()),t.colorRange!==n.colorRange&&(o.colorRange=Object(y.a)(n.colorRange,Float32Array,255)),t.cellMarginPixels!==n.cellMarginPixels||t.cellSizePixels!==n.cellSizePixels||i.viewportChanged){var r=this.context.viewport,a=r.width,s=r.height,l=this.props,c=l.cellSizePixels,u=l.cellMarginPixels,d=c>u?u:0;o.cellScale=new Float32Array([(c-d)/a*2,-(c-d)/s*2,1])}this.setState(o)}},{key:"_updateGridParams",value:function(){var e=this.context.viewport,t=e.width,n=e.height,i=this.props.cellSizePixels,o=this.context.gl,r=Math.ceil(t/i),a=Math.ceil(n/i),s=r*a,l=4*s*4,c=this.state.aggregationBuffer;c&&c.delete(),c=new C.a(o,{byteLength:l,accessor:{size:4,type:5126,divisor:1}}),this.state.weights.color.aggregationBuffer=c,this.setState({numCol:r,numRow:a,numInstances:s,aggregationBuffer:c})}}]),t}(m.a);O.layerName="ScreenGridLayer",O.defaultProps=A;var L=n(7),E=n(2918),z=n(2915),F=n(2913),D=n(2920),R=n(2921),T=n(2901);function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function N(e){return o.a.createElement("div",{className:"deckgl-tooltip"},o.a.createElement(R.a,{label:Object(L.c)("Longitude and Latitude")+": ",value:e.coordinate[0]+", "+e.coordinate[1]}),o.a.createElement(R.a,{label:Object(L.c)("Weight")+": ",value:""+e.object.weight}))}function V(e,t,n,i,o,r,a){const s=e,l=s.color_picker;let c=t.data.features.map(e=>({...e,color:[l.r,l.g,l.b,255*l.a]}));if(s.js_data_mutator){const e=Object(F.a)(s.js_data_mutator);c=e(c)}return null!=a&&a.forEach(e=>{c=c.filter(t=>e(t))}),new O({id:"screengrid-layer-"+s.slice_id,data:c,pickable:!0,cellSizePixels:s.grid_size,minColor:[l.r,l.g,l.b,0],maxColor:[l.r,l.g,l.b,255*l.a],outline:!1,getWeight:e=>e.weight||0,...Object(D.a)(s,i,N)})}const U={formData:a.a.object.isRequired,payload:a.a.object.isRequired,setControlValue:a.a.func.isRequired,viewport:a.a.object.isRequired,onAddFilter:a.a.func,width:a.a.number.isRequired,height:a.a.number.isRequired},B={onAddFilter(){}};class W extends o.a.PureComponent{constructor(e){super(e),I(this,"containerRef",o.a.createRef()),I(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=W.getDerivedStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(e,t){if(t&&e.payload.form_data===t.formData)return null;const n=e.payload.data.features||[],i=n.map(e=>e.__timestamp),o=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:r,end:a,getStep:s,values:l,disabled:c}=Object(z.a)(i,o),{width:u,height:d,formData:g}=e;let{viewport:p}=e;var h;return g.autozoom&&(p=Object(T.a)(p,{width:u,height:d,points:(h=n,h.map(e=>e.position))})),{start:r,end:a,getStep:s,values:l,disabled:c,viewport:p,selected:[],lastClick:0,formData:e.payload.form_data}}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getLayers(e){const t=[];return e[0]===e[1]||e[1]===this.end?t.push(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):t.push(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]),[V(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip)]}render(){const{formData:e,payload:t,setControlValue:n}=this.props;return(o.a.createElement("div",null,o.a.createElement(E.a,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,width:this.props.width,height:this.props.height,mapboxApiAccessToken:t.data.mapboxApiKey,mapStyle:e.mapbox_style,setControlValue:n,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange})))}}W.propTypes=U,W.defaultProps=B;t.default=W},3431:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return S}));var i=n(849),o=n(850),r=n(1035),a=n(647),s=n(2837),l=n(1036),c=n(3078),u=n(2986),d=n(4316),g=n(3426),p=n(3145),h="#define SHADER_NAME arc-layer-fragment-shader\n\nprecision highp float;\n\nvarying vec4 vColor;\n\nvoid main(void) {\n  gl_FragColor = vColor;\n  gl_FragColor = picking_filterHighlightColor(gl_FragColor);\n  gl_FragColor = picking_filterPickingColor(gl_FragColor);\n}\n",f=d.a.fp64LowPart,v=[0,0,0,255],m={fp64:!1,getSourcePosition:{type:"accessor",value:function(e){return e.sourcePosition}},getTargetPosition:{type:"accessor",value:function(e){return e.targetPosition}},getSourceColor:{type:"accessor",value:v},getTargetColor:{type:"accessor",value:v},getWidth:{type:"accessor",value:1},getHeight:{type:"accessor",value:1},getTilt:{type:"accessor",value:0},widthUnits:"pixels",widthScale:{type:"number",value:1,min:0},widthMinPixels:{type:"number",value:0,min:0},widthMaxPixels:{type:"number",value:Number.MAX_SAFE_INTEGER,min:0},getStrokeWidth:{deprecatedFor:"getWidth"}},y=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(l.a)(t,e),Object(o.a)(t,[{key:"getShaders",value:function(){return this.use64bitProjection()?{vs:"#define SHADER_NAME arc-layer-vertex-shader-64\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\n\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\n\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\n\nvec2 paraboloid_fp64(vec2 source[2], vec2 target[2], float ratio) {\n\n  vec2 x[2];\n  vec2_mix_fp64(source, target, ratio, x);\n  vec2 center[2];\n  vec2_mix_fp64(source, target, 0.5, center);\n\n  vec2 dSourceCenter = vec2_distance_fp64(source, center);\n  vec2 dXCenter = vec2_distance_fp64(x, center);\n  return mul_fp64(sum_fp64(dSourceCenter, dXCenter), sub_fp64(dSourceCenter, dXCenter));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvoid get_pos_fp64(vec2 source[2], vec2 target[2], float segmentRatio, out vec2 position[4]) {\n\n  vec2 vertex_height = paraboloid_fp64(source, target, segmentRatio);\n\n  vec2 position_temp[2];\n\n  vec2_mix_fp64(source, target, segmentRatio, position_temp);\n\n  position[0] = position_temp[0];\n  position[1] = position_temp[1];\n\n  if (vertex_height.x < 0.0 || (vertex_height.x == 0.0 && vertex_height.y <= 0.0)) {\n    vertex_height = vec2(0.0, 0.0);\n  }\n\n  position[2] = sqrt_fp64(vertex_height);\n  position[3] = vec2(1.0, 0.0);\n}\n\nvoid main(void) {\n  vec2 projected_source_coord[2];\n  vec2 projected_target_coord[2];\n\n  project_position_fp64(instancePositions.xy, instancePositions64Low.xy, projected_source_coord);\n  project_position_fp64(instancePositions.zw, instancePositions64Low.zw, projected_target_coord);\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 curr_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, segmentRatio,\n    curr_pos_modelspace);\n\n  vec2 next_pos_modelspace[4];\n\n  get_pos_fp64(projected_source_coord, projected_target_coord, nextSegmentRatio,\n    next_pos_modelspace);\n\n  vec4 curr_pos_clipspace = project_common_position_to_clipspace_fp64(curr_pos_modelspace);\n  vec4 next_pos_clipspace = project_common_position_to_clipspace_fp64(next_pos_modelspace);\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n\n  vec2 offset = getExtrusionOffset(next_pos_clipspace.xy - curr_pos_clipspace.xy, positions.y, widthPixels);\n\n  gl_Position = curr_pos_clipspace + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:h,modules:["project64","picking"]}:{vs:"#define SHADER_NAME arc-layer-vertex-shader\n\nattribute vec3 positions;\nattribute vec4 instanceSourceColors;\nattribute vec4 instanceTargetColors;\nattribute vec4 instancePositions;\nattribute vec4 instancePositions64Low;\nattribute vec3 instancePickingColors;\nattribute float instanceWidths;\nattribute float instanceHeights;\nattribute float instanceTilts;\n\nuniform float numSegments;\nuniform float opacity;\nuniform float widthScale;\nuniform float widthMinPixels;\nuniform float widthMaxPixels;\n\nvarying vec4 vColor;\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction, float width) {\n  vec2 dir_screenspace = normalize(line_clipspace * project_uViewportSize);\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset_screenspace = dir_screenspace * offset_direction * width / 2.0;\n  vec2 offset_clipspace = project_pixel_size_to_clipspace(offset_screenspace);\n\n  return offset_clipspace;\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (numSegments - 1.0));\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertexHeight = sqrt(max(0.0, paraboloid(source, target, segmentRatio))) * instanceHeights;\n\n  float tiltAngle = radians(instanceTilts);\n  vec2 tiltDirection = normalize(target - source);\n  vec2 tilt = vec2(-tiltDirection.y, tiltDirection.x) * vertexHeight * sin(tiltAngle);\n\n  return vec3(\n    mix(source, target, segmentRatio) + tilt,\n    vertexHeight * cos(tiltAngle)\n  );\n}\n\nvoid main(void) {\n  vec2 source = project_position(vec3(instancePositions.xy, 0.0), instancePositions64Low.xy).xy;\n  vec2 target = project_position(vec3(instancePositions.zw, 0.0), instancePositions64Low.zw).xy;\n\n  float segmentIndex = positions.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec3 currPos = getPos(source, target, segmentRatio);\n  vec3 nextPos = getPos(source, target, nextSegmentRatio);\n  vec4 curr = project_common_position_to_clipspace(vec4(currPos, 1.0));\n  vec4 next = project_common_position_to_clipspace(vec4(nextPos, 1.0));\n  float widthPixels = clamp(\n    project_size_to_pixel(instanceWidths * widthScale),\n    widthMinPixels, widthMaxPixels\n  );\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, positions.y, widthPixels);\n  gl_Position = curr + vec4(offset, 0.0, 0.0);\n\n  vec4 color = mix(instanceSourceColors, instanceTargetColors, segmentRatio) / 255.;\n  vColor = vec4(color.rgb, color.a * opacity);\n  picking_setPickingColor(instancePickingColors);\n}\n",fs:h,modules:["picking"]}}},{key:"initializeState",value:function(){this.getAttributeManager().addInstanced({instancePositions:{size:4,transition:!0,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions},instancePositions64Low:{size:4,accessor:["getSourcePosition","getTargetPosition"],update:this.calculateInstancePositions64Low},instanceSourceColors:{size:4,type:5121,transition:!0,accessor:"getSourceColor",defaultValue:v},instanceTargetColors:{size:4,type:5121,transition:!0,accessor:"getTargetColor",defaultValue:v},instanceWidths:{size:1,transition:!0,accessor:"getWidth",defaultValue:1},instanceHeights:{size:1,transition:!0,accessor:"getHeight",defaultValue:1},instanceTilts:{size:1,transition:!0,accessor:"getTilt",defaultValue:0}})}},{key:"updateState",value:function(e){var n=e.props,i=e.oldProps,o=e.changeFlags;if(Object(s.a)(Object(a.a)(t.prototype),"updateState",this).call(this,{props:n,oldProps:i,changeFlags:o}),n.fp64!==i.fp64){var r=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(r)}),this.getAttributeManager().invalidateAll()}}},{key:"draw",value:function(e){var t=e.uniforms,n=this.context.viewport,i=this.props,o=i.widthUnits,r=i.widthScale,a=i.widthMinPixels,s=i.widthMaxPixels,l="pixels"===o?n.distanceScales.metersPerPixel[2]:1;this.state.model.setUniforms(Object.assign({},t,{widthScale:r*l,widthMinPixels:a,widthMaxPixels:s})).draw()}},{key:"_getModel",value:function(e){for(var t=[],n=0;n<50;n++)t=t.concat([n,-1,0,n,1,0]);var i=new g.a(e,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new p.a({drawMode:5,attributes:{positions:new Float32Array(t)}}),isInstanced:!0,shaderCache:this.context.shaderCache}));return i.setUniforms({numSegments:50}),i}},{key:"calculateInstancePositions",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.props,r=o.data,a=o.getSourcePosition,s=o.getTargetPosition,l=e.value,u=n*e.size,d=Object(c.a)(r,n,i),g=d.iterable,p=d.objectInfo,h=!0,f=!1,v=void 0;try{for(var m,y=g[Symbol.iterator]();!(h=(m=y.next()).done);h=!0){var x=m.value;p.index++;var b=a(x,p);l[u++]=b[0],l[u++]=b[1];var P=s(x,p);l[u++]=P[0],l[u++]=P[1]}}catch(e){f=!0,v=e}finally{try{h||null==y.return||y.return()}finally{if(f)throw v}}}},{key:"calculateInstancePositions64Low",value:function(e,t){var n=t.startRow,i=t.endRow,o=this.use64bitPositions();if(e.constant=!o,o){var r=this.props,a=r.data,s=r.getSourcePosition,l=r.getTargetPosition,u=e.value,d=n*e.size,g=Object(c.a)(a,n,i),p=g.iterable,h=g.objectInfo,v=!0,m=!1,y=void 0;try{for(var x,b=p[Symbol.iterator]();!(v=(x=b.next()).done);v=!0){var P=x.value;h.index++;var _=s(P,h);u[d++]=f(_[0]),u[d++]=f(_[1]);var w=l(P,h);u[d++]=f(w[0]),u[d++]=f(w[1])}}catch(e){m=!0,y=e}finally{try{v||null==b.return||b.return()}finally{if(m)throw y}}}else e.value=new Float32Array(4)}}]),t}(u.a);y.layerName="ArcLayer",y.defaultProps=m;var x=n(0),b=n.n(x),P=n(7),_=n(2920),w=n(2932),C=n(2921);function S(e,t,n,i){const o=t.data.features,r=e.color_picker,a=e.target_color_picker;return new y({data:o,getSourceColor:e=>e.sourceColor||e.color||[r.r,r.g,r.b,255*r.a],getTargetColor:e=>e.targetColor||e.color||[a.r,a.g,a.b,255*a.a],id:"path-layer-"+e.slice_id,strokeWidth:e.stroke_width?e.stroke_width:3,...Object(_.a)(e,i,(s=e,e=>b.a.createElement("div",{className:"deckgl-tooltip"},b.a.createElement(C.a,{label:Object(P.c)("Start (Longitude, Latitude)")+": ",value:e.object.sourcePosition[0]+", "+e.object.sourcePosition[1]}),b.a.createElement(C.a,{label:Object(P.c)("End (Longitude, Latitude)")+": ",value:e.object.targetPosition[0]+", "+e.object.targetPosition[1]}),s.dimension&&b.a.createElement(C.a,{label:s.dimension+": ",value:""+e.object.cat_color}))))});var s}t.default=Object(w.a)(S,(function(e){const t=[];return e.forEach(e=>{t.push(e.sourcePosition),t.push(e.targetPosition)}),t}))},3432:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return D}));var i=n(849),o=n(850),r=n(1035),a=n(647),s=n(1036),l=n(3124),c=n(2904),u=n(3015),d=n(3119),g=n(3016),p=n(2942),h=n(3017),f=n(2916),v=Math.PI/3,m=[0,v,2*v,3*v,4*v,5*v];function y(e){return e[0]}function x(e){return e[1]}var b=n(3078);function P(){}var _=new l.a,w={colorDomain:null,colorRange:p.b,getColorValue:{type:"accessor",value:null},getColorWeight:{type:"accessor",value:function(e){return 1}},colorAggregation:"SUM",lowerPercentile:{type:"number",value:0,min:0,max:100},upperPercentile:{type:"number",value:100,min:0,max:100},onSetColorDomain:P,elevationDomain:null,elevationRange:[0,1e3],getElevationValue:{type:"accessor",value:null},getElevationWeight:{type:"accessor",value:function(e){return 1}},elevationAggregation:"SUM",elevationLowerPercentile:{type:"number",value:0,min:0,max:100},elevationUpperPercentile:{type:"number",value:100,min:0,max:100},elevationScale:{type:"number",min:0,value:1},onSetElevationDomain:P,radius:{type:"number",value:1e3,min:1},coverage:{type:"number",min:0,max:1,value:1},extruded:!1,hexagonAggregator:function(e,t){var n=e.data,i=e.radius,o=e.getPosition,r=function(e,t){var n=t.getDistanceScales().pixelsPerMeter;return e*n[0]}(i,t),a=[],s=Object(b.a)(n),l=s.iterable,c=s.objectInfo,u=!0,d=!1,g=void 0;try{for(var p,h=l[Symbol.iterator]();!(u=(p=h.next()).done);u=!0){var f=p.value;c.index++,a.push(Object.assign({screenCoord:t.projectFlat(o(f,c))},f))}}catch(e){d=!0,g=e}finally{try{u||null==h.return||h.return()}finally{if(d)throw g}}return{hexagons:function(){var e,t,n,i=0,o=0,r=1,a=1,s=y,l=x;function c(e){var i,o={},r=[],a=e.length;for(i=0;i<a;++i)if(!isNaN(u=+s.call(null,c=e[i],i,e))&&!isNaN(d=+l.call(null,c,i,e))){var c,u,d,g=Math.round(d/=n),p=Math.round(u=u/t-(1&g)/2),h=d-g;if(3*Math.abs(h)>1){var f=u-p,v=p+(u<p?-1:1)/2,m=g+(d<g?-1:1),y=u-v,x=d-m;f*f+h*h>y*y+x*x&&(p=v+(1&g?1:-1)/2,g=m)}var b=p+"-"+g,P=o[b];P?P.push(c):(r.push(P=o[b]=[c]),P.x=(p+(1&g)/2)*t,P.y=g*n)}return r}function u(e){var t=0,n=0;return m.map((function(i){var o=Math.sin(i)*e,r=-Math.cos(i)*e,a=o-t,s=r-n;return t=o,n=r,[a,s]}))}return c.hexagon=function(t){return"m"+u(null==t?e:+t).join("l")+"z"},c.centers=function(){for(var s=[],l=Math.round(o/n),c=Math.round(i/t),u=l*n;u<a+e;u+=n,++l)for(var d=c*t+(1&l)*t/2;d<r+t/2;d+=t)s.push([d,u]);return s},c.mesh=function(){var t=u(e).slice(0,4).join("l");return c.centers().map((function(e){return"M"+e+"m"+t})).join("")},c.x=function(e){return arguments.length?(s=e,c):s},c.y=function(e){return arguments.length?(l=e,c):l},c.radius=function(i){return arguments.length?(t=2*(e=+i)*Math.sin(v),n=1.5*e,c):e},c.size=function(e){return arguments.length?(i=o=0,r=+e[0],a=+e[1],c):[r-i,a-o]},c.extent=function(e){return arguments.length?(i=+e[0][0],o=+e[0][1],r=+e[1][0],a=+e[1][1],c):[[i,o],[r,a]]},c.radius(1)}().radius(r).x((function(e){return e.screenCoord[0]})).y((function(e){return e.screenCoord[1]}))(a).map((function(e,n){return{position:t.unprojectFlat([e.x,e.y]),points:e,index:n}}))}},getPosition:{type:"accessor",value:function(e){return e.position}},fp64:!1,material:_},C=["getColorValue","colorAggregation","getColorWeight"],S=["getElevationValue","elevationAggregation","getElevationWeight"],j=function(e){function t(){return Object(i.a)(this,t),Object(r.a)(this,Object(a.a)(t).apply(this,arguments))}return Object(s.a)(t,e),Object(o.a)(t,[{key:"initializeState",value:function(){this.state={hexagons:[],sortedColorBins:null,sortedElevationBins:null,colorValueDomain:null,elevationValueDomain:null,colorScaleFunc:P,elevationScaleFunc:P,dimensionUpdaters:this.getDimensionUpdaters()}}},{key:"updateState",value:function(e){var t=this,n=e.oldProps,i=e.props,o=e.changeFlags;this.updateGetValueFuncs(n,i);var r=this.getDimensionChanges(n,i);o.dataChanged||this.needsReProjectPoints(n,i)?this.getHexagons():r&&r.forEach((function(e){return"function"==typeof e&&e.apply(t)}))}},{key:"colorElevationPropsChanged",value:function(e,t){for(var n=!1,i=!1,o=0;o<C.length;o++){var r=C[o];e[r]!==t[r]&&(n=!0)}for(var a=0;a<S.length;a++){var s=S[a];e[s]!==t[s]&&(i=!0)}return{colorChanged:n,elevationChanged:i}}},{key:"updateGetValueFuncs",value:function(e,t){var n=t.getColorValue,i=t.getElevationValue,o=this.props,r=o.colorAggregation,a=o.getColorWeight,s=o.elevationAggregation,l=o.getElevationWeight,c=this.colorElevationPropsChanged(e,t),u=c.colorChanged,d=c.elevationChanged;u&&null===n&&(n=Object(f.b)(r,a)),d&&null===i&&(i=Object(f.b)(s,l)),n&&this.setState({getColorValue:n}),i&&this.setState({getElevationValue:i})}},{key:"needsReProjectPoints",value:function(e,t){return e.radius!==t.radius||e.hexagonAggregator!==t.hexagonAggregator}},{key:"getDimensionUpdaters",value:function(){return{getFillColor:[{id:"value",triggers:["getColorValue","getColorWeight","colorAggregation"],updater:this.getSortedColorBins},{id:"domain",triggers:["lowerPercentile","upperPercentile"],updater:this.getColorValueDomain},{id:"scaleFunc",triggers:["colorDomain","colorRange"],updater:this.getColorScale}],getElevation:[{id:"value",triggers:["getElevationValue","getElevationWeight","elevationAggregation"],updater:this.getSortedElevationBins},{id:"domain",triggers:["elevationLowerPercentile","elevationUpperPercentile"],updater:this.getElevationValueDomain},{id:"scaleFunc",triggers:["elevationDomain","elevationRange"],updater:this.getElevationScale}]}}},{key:"getDimensionChanges",value:function(e,t){var n=this.state.dimensionUpdaters,i=[];for(var o in n){var r=n[o].find((function(n){return n.triggers.some((function(n){return e[n]!==t[n]}))}));r&&i.push(r.updater)}return i.length?i:null}},{key:"getHexagons",value:function(){var e=this.props.hexagonAggregator,t=this.context.viewport,n=e(this.props,t),i=n.hexagons,o=n.hexagonVertices;this.updateRadiusAngle(o),this.setState({hexagons:i}),this.getSortedBins()}},{key:"getPickingInfo",value:function(e){var t=e.info,n=this.state,i=n.sortedColorBins,o=n.sortedElevationBins,r=null;if(t.picked&&t.index>-1){var a=this.state.hexagons[t.index],s=i.binMap[a.index]&&i.binMap[a.index].value,l=o.binMap[a.index]&&o.binMap[a.index].value;r=Object.assign({colorValue:s,elevationValue:l},a)}return Object.assign(t,{picked:Boolean(r),object:r})}},{key:"getUpdateTriggers",value:function(){var e=this,t=this.state.dimensionUpdaters,n={},i=function(i){n[i]={};var o=!0,r=!1,a=void 0;try{for(var s,l=t[i][Symbol.iterator]();!(o=(s=l.next()).done);o=!0){s.value.triggers.forEach((function(t){n[i][t]=e.props[t]}))}}catch(e){r=!0,a=e}finally{try{o||null==l.return||l.return()}finally{if(r)throw a}}};for(var o in t)i(o);return n}},{key:"updateRadiusAngle",value:function(e){var t=this.props.radius,n=90;if(Array.isArray(e)){e.length<6&&c.a.error("HexagonCellLayer: hexagonVertices needs to be an array of 6 points")();var i=e[0],o=e[3],r=this.context.viewport.getDistanceScales().pixelsPerMeter,a=this.projectFlat(i),s=this.projectFlat(o),l=a[0]-s[0],u=a[1]-s[1],d=Math.sqrt(l*l+u*u);n=Math.acos(l/d)*-Math.sign(u)/Math.PI*180+90,t=d/2/r[0]}this.setState({angle:n,radius:t})}},{key:"getValueDomain",value:function(){this.getColorValueDomain(),this.getElevationValueDomain()}},{key:"getSortedBins",value:function(){this.getSortedColorBins(),this.getSortedElevationBins()}},{key:"getSortedColorBins",value:function(){var e=this.state.getColorValue,t=new g.a(this.state.hexagons||[],e);this.setState({sortedColorBins:t}),this.getColorValueDomain()}},{key:"getSortedElevationBins",value:function(){var e=this.state.getElevationValue,t=new g.a(this.state.hexagons||[],e);this.setState({sortedElevationBins:t}),this.getElevationValueDomain()}},{key:"getColorValueDomain",value:function(){var e=this.props,t=e.lowerPercentile,n=e.upperPercentile,i=e.onSetColorDomain;t>n&&c.a.warn("HexagonLayer: lowerPercentile is bigger than upperPercentile")(),this.state.colorValueDomain=this.state.sortedColorBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.colorValueDomain),this.getColorScale()}},{key:"getElevationValueDomain",value:function(){var e=this.props,t=e.elevationLowerPercentile,n=e.elevationUpperPercentile,i=e.onSetElevationDomain;this.state.elevationValueDomain=this.state.sortedElevationBins.getValueRange([t,n]),"function"==typeof i&&i(this.state.elevationValueDomain),this.getElevationScale()}},{key:"getColorScale",value:function(){var e=this.props.colorRange,t=this.props.colorDomain||this.state.colorValueDomain;this.state.colorScaleFunc=Object(h.b)(t,e)}},{key:"getElevationScale",value:function(){var e=this.props.elevationRange,t=this.props.elevationDomain||this.state.elevationValueDomain;this.state.elevationScaleFunc=Object(h.a)(t,e)}},{key:"_onGetSublayerColor",value:function(e){var t=this.state,n=t.sortedColorBins,i=t.colorScaleFunc,o=t.colorValueDomain,r=n.binMap[e.index]&&n.binMap[e.index].value,a=this.props.colorDomain||o,s=r>=a[0]&&r<=a[a.length-1]?i(r):[0,0,0,0];return s[3]=Number.isFinite(s[3])?s[3]:255,s}},{key:"_onGetSublayerElevation",value:function(e){var t=this.state,n=t.sortedElevationBins,i=t.elevationScaleFunc,o=t.elevationValueDomain,r=n.binMap[e.index]&&n.binMap[e.index].value,a=this.props.elevationDomain||o;return r>=a[0]&&r<=a[a.length-1]?i(r):-1}},{key:"renderLayers",value:function(){var e=this.props,t=e.elevationScale,n=e.extruded,i=e.coverage,o=e.material,r=e.fp64,a=e.transitions,s=this.state,l=s.angle,c=s.radius;return new(this.getSubLayerClass("hexagon-cell",d.a))({fp64:r,radius:c,diskResolution:6,elevationScale:t,angle:l,extruded:n,coverage:i,material:o,getFillColor:this._onGetSublayerColor.bind(this),getElevation:this._onGetSublayerElevation.bind(this),transitions:a&&{getFillColor:a.getColorValue||a.getColorWeight,getElevation:a.getElevationValue||a.getElevationWeight}},this.getSubLayerProps({id:"hexagon-cell",updateTriggers:this.getUpdateTriggers()}),{data:this.state.hexagons})}}]),t}(u.a);j.layerName="HexagonLayer",j.defaultProps=w;var k=n(0),M=n.n(k),A=n(7),O=n(2920),L=n(2913),E=n(2932),z=n(2921);function F(e){return M.a.createElement("div",{className:"deckgl-tooltip"},M.a.createElement(z.a,{label:Object(A.c)("Centroid (Longitude and Latitude)")+": ",value:"("+e.coordinate[0]+", "+e.coordinate[1]+")"}),M.a.createElement(z.a,{label:Object(A.c)("Height")+": ",value:""+e.object.elevationValue}))}function D(e,t,n,i){const o=e,r=o.color_picker;let a=t.data.features.map(e=>({...e,color:[r.r,r.g,r.b,255*r.a]}));if(o.js_data_mutator){a=Object(L.a)(o.js_data_mutator)(a)}const s=Object(O.b)(o.js_agg_function,e=>e.weight);return new j({id:"hex-layer-"+o.slice_id,data:a,pickable:!0,radius:o.grid_size,minColor:[0,0,0,0],extruded:o.extruded,maxColor:[r.r,r.g,r.b,255*r.a],outline:!1,getElevationValue:s,getColorValue:s,...Object(O.a)(o,i,F)})}t.default=Object(E.b)(D,(function(e){return e.map(e=>e.position)}))},3433:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return T}));var i=n(0),o=n.n(i),r=n(2),a=n.n(r),s=n(849),l=n(850),c=n(1035),u=n(647),d=n(1036),g=n(3124),p=n(3078),h=n(3015),f=n(3040),v=n(3010),m=n(2990),y=new g.a,x={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,lineDashJustified:!1,fp64:!1,getPolygon:{type:"accessor",value:function(e){return e.polygon}},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:[0,0,0,255]},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},material:y},b=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"initializeState",value:function(){this.state={paths:[]}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props,n=e.changeFlags;(n.dataChanged||n.updateTriggersChanged&&(n.updateTriggersChanged.all||n.updateTriggersChanged.getPolygon))&&(this.state.paths=this._getPaths(t))}},{key:"getPickingInfo",value:function(e){var t=e.info;return Object.assign(t,{object:t.object&&t.object.object||t.object})}},{key:"_getPaths",value:function(e){var t=e.data,n=e.getPolygon,i=[],o="XY"===e.positionFormat?2:3,r=Object(p.a)(t),a=r.iterable,s=r.objectInfo,l=!0,c=!1,u=void 0;try{for(var d,g=a[Symbol.iterator]();!(l=(d=g.next()).done);l=!0){var h=d.value;s.index++;var f=m.c(n(h,s),o),v=f.positions,y=f.holeIndices;if(y)for(var x=0;x<=y.length;x++){var b=v.subarray(y[x-1]||0,y[x]||v.length);i.push({path:b,object:h})}else i.push({path:v,object:h})}}catch(e){c=!0,u=e}finally{try{l||null==g.return||g.return()}finally{if(c)throw u}}return i}},{key:"_getAccessor",value:function(e){return"function"==typeof e?function(t){return e(t.object)}:e}},{key:"renderLayers",value:function(){var e=this.props,t=e.data,n=e.stroked,i=e.filled,o=e.extruded,r=e.wireframe,a=e.elevationScale,s=e.transitions,l=this.props,c=l.lineWidthUnits,u=l.lineWidthScale,d=l.lineWidthMinPixels,g=l.lineWidthMaxPixels,p=l.lineJointRounded,h=l.lineMiterLimit,m=l.lineDashJustified,y=l.fp64,x=this.props,b=x.getFillColor,P=x.getLineColor,_=x.getLineWidth,w=x.getLineDashArray,C=x.getElevation,S=x.getPolygon,j=x.updateTriggers,k=x.material,M=this.state.paths,A=this.getSubLayerClass("fill",f.a),O=this.getSubLayerClass("stroke",v.a),L=this.shouldRenderSubLayer("fill",M)&&new A({extruded:o,elevationScale:a,fp64:y,filled:i,wireframe:r,getElevation:C,getFillColor:b,getLineColor:P,material:k,transitions:s},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:j.getPolygon,getElevation:j.getElevation,getFillColor:j.getFillColor,getLineColor:j.getLineColor}}),{data:t,getPolygon:S});return[!o&&L,!o&&n&&this.shouldRenderSubLayer("stroke",M)&&new O({fp64:y,widthUnits:c,widthScale:u,widthMinPixels:d,widthMaxPixels:g,rounded:p,miterLimit:h,dashJustified:m,transitions:s&&{getWidth:s.getLineWidth,getColor:s.getLineColor,getPath:s.getPolygon},getColor:this._getAccessor(P),getWidth:this._getAccessor(_),getDashArray:this._getAccessor(w)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:j.getLineWidth,getColor:j.getLineColor,getDashArray:j.getLineDashArray}}),{data:M,getPath:function(e){return e.path}}),o&&L]}}]),t}(h.a);b.layerName="PolygonLayer",b.defaultProps=x;var P=n(2918),_=n(2935),w=n(2921),C=n(172),S=n(2838),j=n(148),k=n(309),M=n(2949);function A({break_points:e,num_buckets:t},n,i){if(!n)return[];if(void 0===e||0===e.length){const e=t?parseInt(t,10):10,[o,r]=Object(C.extent)(n,i);if(void 0===o)return[];const a=(r-o)/e,s=0===a?0:Math.max(0,Math.ceil(Math.log10(1/a))),l=r>r.toFixed(s)?1:0;return new Array(e+1+l).fill().map((e,t)=>(o+t*a).toFixed(s))}return e.sort((e,t)=>parseFloat(e)-parseFloat(t))}function O({break_points:e,num_buckets:t,linear_color_scheme:n,opacity:i},o,r){const a=e||t?A({break_points:e,num_buckets:t},o,r):null,s=Array.isArray(n)?new j.a({colors:n,id:"custom"}):Object(k.a)().get(n);let l,c;if(null!==a){const e=a.length-1,t=e>1?s.getColors(e):[s.colors[s.colors.length-1]],n=t[0],i=t[t.length-1];t.unshift(n),t.push(i);const o=a.map(e=>parseFloat(e));l=Object(S.scaleThreshold)().domain(o).range(t),c=t=>t>a[e]||t<a[0]}else l=s.createLinearScale(Object(C.extent)(o,r)),c=()=>!1;return e=>{const t=r(e),n=Object(M.hexToRGB)(l(t));return c(t)?n[3]=0:n[3]=i/100*255,n}}var L=n(2920),E=n(2915),z=n(2913);function F(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}var D=n(2901);function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function T(e,t,n,i,r,a,s){const l=e,c=l.fill_color_picker,u=l.stroke_color_picker;let d=[...t.data.features];if(null!=s&&s.forEach(e=>{d=d.filter(t=>e(t))}),l.js_data_mutator){const e=Object(z.a)(l.js_data_mutator);d=e(d)}const g=l.metric?l.metric.label||l.metric:null,p=null===l.metric?()=>[c.r,c.g,c.b,255*c.a]:O(l,d,e=>e[g]),h=e=>{const t=p(e);return r.length>0&&!r.includes(e[l.line_column])&&(t[3]/=2),t},f=l.line_column&&l.metric&&["json","geohash","zipcode"].includes(l.line_type)?function(e){return t=>{const n=e.metric.label||e.metric;return(o.a.createElement("div",{className:"deckgl-tooltip"},t.object.name&&o.a.createElement(w.a,{label:"name: ",value:""+t.object.name}),t.object[e.line_column]&&o.a.createElement(w.a,{label:e.line_column+": ",value:""+t.object[e.line_column]}),e.metric&&o.a.createElement(w.a,{label:n+": ",value:""+t.object[n]})))}}(l):void 0;return new b({id:"path-layer-"+l.slice_id,data:d,pickable:!0,filled:l.filled,stroked:l.stroked,getPolygon:F,getFillColor:h,getLineColor:[u.r,u.g,u.b,255*u.a],getLineWidth:l.line_width,extruded:l.extruded,getElevation:e=>function(e,t){return 0===t(e)[3]?0:e.elevation}(e,h),elevationScale:l.multiplier,fp64:!0,...Object(L.a)(l,i,f,a)})}const I={formData:a.a.object.isRequired,payload:a.a.object.isRequired,setControlValue:a.a.func.isRequired,viewport:a.a.object.isRequired,onAddFilter:a.a.func,width:a.a.number.isRequired,height:a.a.number.isRequired},N={onAddFilter(){}};class V extends o.a.Component{constructor(e){super(e),R(this,"containerRef",o.a.createRef()),R(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state=V.getDerivedStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onSelect=this.onSelect.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(e,t){const{width:n,height:i,formData:o,payload:r}=e;if(t&&r.form_data===t.formData)return null;const a=r.data.features||[],s=a.map(e=>e.__timestamp),l=r.form_data.time_grain_sqla||r.form_data.granularity||"P1D",{start:c,end:u,getStep:d,values:g,disabled:p}=Object(E.a)(s,l);let{viewport:h}=e;return o.autozoom&&(h=Object(D.a)(h,{width:n,height:i,points:a.flatMap(F)})),{start:c,end:u,getStep:d,values:g,disabled:p,viewport:h,selected:[],lastClick:0,formData:r.form_data}}onSelect(e){const{formData:t,onAddFilter:n}=this.props,i=new Date,o=i-this.state.lastClick<=250,r=[...this.state.selected];if(o)r.splice(0,r.length,e);else if(t.toggle_polygons){const t=r.indexOf(e);-1===t?r.push(e):r.splice(t,1)}else r.splice(0,1,e);this.setState({selected:r,lastClick:i}),t.table_filter&&n(t.line_column,r,!1,!0)}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getLayers(e){if(void 0===this.props.payload.data.features)return[];const t=[];return e[0]===e[1]||e[1]===this.end?t.push(t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1]):t.push(t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]),[T(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip,this.state.selected,this.onSelect,t)]}render(){const{payload:e,formData:t,setControlValue:n}=this.props,{start:i,end:r,getStep:a,values:s,disabled:l,viewport:c}=this.state,u=t,d=u.metric?u.metric.label||u.metric:null,g=function(e,t,n){const i=A(e,t,n),o=O(e,t,n),r={};return i.slice(1).forEach((t,n)=>{const a=i[n]+" - "+i[n+1],s=.5*(parseFloat(i[n])+parseFloat(i[n+1])),l=e.metric?e.metric.label||e.metric:null;r[a]={color:o({[l||e.metric]:s}),enabled:!0}}),r}(t,e.data.features,e=>e[d]);return o.a.createElement("div",{style:{position:"relative"}},o.a.createElement(P.a,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:i,end:r,getStep:a,values:s,disabled:l,viewport:c,width:this.props.width,height:this.props.height,mapboxApiAccessToken:e.data.mapboxApiKey,mapStyle:t.mapbox_style,setControlValue:n,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange},null!==t.metric&&o.a.createElement(_.a,{categories:g,position:t.legend_position,format:t.legend_format})))}}V.propTypes=I,V.defaultProps=N;t.default=V},3435:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return T}));var i=n(0),o=n.n(i),r=n(2),a=n.n(r),s=n(849),l=n(850),c=n(1035),u=n(647),d=n(1036),g=n(3015),p=n(3120),h=n(3010),f=n(3124),v=n(3040),m=n(2904);function y(e,t,n){var i=e.type,o=e.coordinates,r=t.pointFeatures,a=t.lineFeatures,s=t.polygonFeatures,l=t.polygonOutlineFeatures;if(function(e,t){var n=b[e];m.a.assert(n,"Unknown GeoJSON type ".concat(e));for(;t&&--n>0;)t=t[0];return t&&Number.isFinite(t[0])}(i,o))switch(i){case"Point":r.push({geometry:e,sourceFeature:n});break;case"MultiPoint":o.forEach((function(e){r.push({geometry:{type:"Point",coordinates:e},sourceFeature:n})}));break;case"LineString":a.push({geometry:e,sourceFeature:n});break;case"MultiLineString":o.forEach((function(e){a.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})}));break;case"Polygon":s.push({geometry:e,sourceFeature:n}),o.forEach((function(e){l.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})}));break;case"MultiPolygon":o.forEach((function(e){s.push({geometry:{type:"Polygon",coordinates:e},sourceFeature:n}),e.forEach((function(e){l.push({geometry:{type:"LineString",coordinates:e},sourceFeature:n})}))}))}else m.a.warn("".concat(i," coordinates are malformed"))()}function x(e){return e.sourceFeature.feature}var b={Point:1,MultiPoint:2,LineString:2,MultiLineString:3,Polygon:3,MultiPolygon:4};var P=new f.a,_={stroked:!0,filled:!0,extruded:!1,wireframe:!1,lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,elevationScale:1,pointRadiusScale:1,pointRadiusMinPixels:0,pointRadiusMaxPixels:Number.MAX_SAFE_INTEGER,lineDashJustified:!1,fp64:!1,getLineColor:{type:"accessor",value:[0,0,0,255]},getFillColor:{type:"accessor",value:[0,0,0,255]},getRadius:{type:"accessor",value:1},getLineWidth:{type:"accessor",value:1},getLineDashArray:{type:"accessor",value:[0,0]},getElevation:{type:"accessor",value:1e3},material:P};function w(e){return e.geometry.coordinates}function C(e){return"function"!=typeof e?e:function(t){return e(x(t))}}var S=function(e){function t(){return Object(s.a)(this,t),Object(c.a)(this,Object(u.a)(t).apply(this,arguments))}return Object(d.a)(t,e),Object(l.a)(t,[{key:"initializeState",value:function(){this.state={features:{}}}},{key:"updateState",value:function(e){e.oldProps;var t=e.props;if(e.changeFlags.dataChanged){var n=function(e){if(Array.isArray(e))return e;switch(m.a.assert(e.type,"GeoJSON does not have type"),e.type){case"Feature":return[e];case"FeatureCollection":return m.a.assert(Array.isArray(e.features),"GeoJSON does not have features array"),e.features;default:return[{geometry:e}]}}(t.data);this.state.features=function(e){for(var t={pointFeatures:[],lineFeatures:[],polygonFeatures:[],polygonOutlineFeatures:[]},n=0;n<e.length;n++){var i=e[n];m.a.assert(i&&i.geometry,"GeoJSON does not have geometry");var o=i.geometry,r={feature:i,index:n};if("GeometryCollection"===o.type){m.a.assert(Array.isArray(o.geometries),"GeoJSON does not have geometries array");for(var a=o.geometries,s=0;s<a.length;s++){y(a[s],t,r)}}else y(o,t,r)}return t}(n)}}},{key:"getPickingInfo",value:function(e){var t,n=e.info;e.sourceLayer;return Object.assign(n,{object:n.object?x(n.object):n.object,index:n.object?(t=n.object,t.sourceFeature.index):n.index})}},{key:"renderLayers",value:function(){var e=this.state.features,t=e.pointFeatures,n=e.lineFeatures,i=e.polygonFeatures,o=e.polygonOutlineFeatures,r=this.props,a=r.stroked,s=r.filled,l=r.extruded,c=r.wireframe,u=r.material,d=r.transitions,g=this.props,f=g.lineWidthUnits,m=g.lineWidthScale,y=g.lineWidthMinPixels,x=g.lineWidthMaxPixels,b=g.lineJointRounded,P=g.lineMiterLimit,_=g.pointRadiusScale,S=g.pointRadiusMinPixels,j=g.pointRadiusMaxPixels,k=g.elevationScale,M=g.lineDashJustified,A=g.fp64,O=this.props,L=O.getLineColor,E=O.getFillColor,z=O.getRadius,F=O.getLineWidth,D=O.getLineDashArray,R=O.getElevation,T=O.updateTriggers,I=this.getSubLayerClass("polygons-fill",v.a),N=this.getSubLayerClass("polygons-stroke",h.a),V=this.getSubLayerClass("line-strings",h.a),U=this.getSubLayerClass("points",p.a),B=this.shouldRenderSubLayer("polygons-fill",i)&&new I({fp64:A,extruded:l,elevationScale:k,filled:s,wireframe:c,material:u,getElevation:C(R),getFillColor:C(E),getLineColor:C(L),transitions:d&&{getPolygon:d.geometry,getElevation:d.getElevation,getFillColor:d.getFillColor,getLineColor:d.getLineColor}},this.getSubLayerProps({id:"polygons-fill",updateTriggers:{getElevation:T.getElevation,getFillColor:T.getFillColor,getLineColor:T.getLineColor}}),{data:i,getPolygon:w});return[!l&&B,!l&&a&&this.shouldRenderSubLayer("polygons-stroke",o)&&new N({fp64:A,widthUnits:f,widthScale:m,widthMinPixels:y,widthMaxPixels:x,rounded:b,miterLimit:P,dashJustified:M,getColor:C(L),getWidth:C(F),getDashArray:C(D),transitions:d&&{getPath:d.geometry,getColor:d.getLineColor,getWidth:d.getLineWidth}},this.getSubLayerProps({id:"polygons-stroke",updateTriggers:{getColor:T.getLineColor,getWidth:T.getLineWidth,getDashArray:T.getLineDashArray}}),{data:o,getPath:w}),this.shouldRenderSubLayer("linestrings",n)&&new V({fp64:A,widthUnits:f,widthScale:m,widthMinPixels:y,widthMaxPixels:x,rounded:b,miterLimit:P,dashJustified:M,getColor:C(L),getWidth:C(F),getDashArray:C(D),transitions:d&&{getPath:d.geometry,getColor:d.getLineColor,getWidth:d.getLineWidth}},this.getSubLayerProps({id:"line-strings",updateTriggers:{getColor:T.getLineColor,getWidth:T.getLineWidth,getDashArray:T.getLineDashArray}}),{data:n,getPath:w}),this.shouldRenderSubLayer("points",t)&&new U({fp64:A,stroked:a,filled:s,radiusScale:_,radiusMinPixels:S,radiusMaxPixels:j,lineWidthUnits:f,lineWidthScale:m,lineWidthMinPixels:y,lineWidthMaxPixels:x,getFillColor:C(E),getLineColor:C(L),getRadius:C(z),getLineWidth:C(F),transitions:d&&{getPosition:d.geometry,getFillColor:d.getFillColor,getLineColor:d.getLineColor,getRadius:d.getRadius,getLineWidth:d.getLineWidth}},this.getSubLayerProps({id:"points",updateTriggers:{getFillColor:T.getFillColor,getLineColor:T.getLineColor,getRadius:T.getRadius,getLineWidth:T.getLineWidth}}),{data:t,getPosition:w}),l&&B]}}]),t}(g.a);S.layerName="GeoJsonLayer",S.defaultProps=_;var j=n(2917),k=n(2949),M=n(2913),A=n(2920),O=n(2921);function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const E={fillColor:"fillColor",color:"fillColor",fill:"fillColor","fill-color":"fillColor",strokeColor:"strokeColor","stroke-color":"strokeColor","stroke-width":"strokeWidth"},z=(e,t)=>{const n={};return Object.keys(e).forEach(t=>{t in E?n[E[t]]=e[t]:n[t]=e[t]}),"string"==typeof e.fillColor&&(n.fillColor=Object(k.hexToRGB)(e.fillColor)),"string"==typeof e.strokeColor&&(n.strokeColor=Object(k.hexToRGB)(e.strokeColor)),{...n,...t}};let F;const D=(e,t,n)=>{if(e&&e.features&&e.features.forEach(i=>{D(i,t,e.extraProps||n)}),e&&e.geometry){const i={...e,properties:z(e.properties,t)};i.extraProps||(i.extraProps=n),F.push(i)}};function R(e){return e.object.extraProps&&o.a.createElement("div",{className:"deckgl-tooltip"},Object.keys(e.object.extraProps).map((t,n)=>o.a.createElement(O.a,{key:"prop-"+n,label:t+": ",value:""+e.object.extraProps[t]})))}function T(e,t,n,i){const o=e,r=o.fill_color_picker,a=o.stroke_color_picker,s=[r.r,r.g,r.b,255*r.a],l=[a.r,a.g,a.b,255*a.a],c={};let u;return s[3]>0&&(c.fillColor=s),l[3]>0&&(c.strokeColor=l),F=[],D(t.data,c),o.js_data_mutator&&(u=Object(M.a)(o.js_data_mutator),F=u(F)),new S({id:"geojson-layer-"+o.slice_id,filled:o.filled,data:F,stroked:o.stroked,extruded:o.extruded,pointRadiusScale:o.point_radius_scale,...Object(A.a)(o,i,R)})}const I={formData:a.a.object.isRequired,payload:a.a.object.isRequired,setControlValue:a.a.func.isRequired,viewport:a.a.object.isRequired,onAddFilter:a.a.func},N={onAddFilter(){}};class V extends o.a.Component{constructor(...e){super(...e),L(this,"containerRef",o.a.createRef()),L(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})}render(){const{formData:e,payload:t,setControlValue:n,onAddFilter:i,viewport:r}=this.props,a=T(e,t,0,this.setTooltip);return o.a.createElement(j.a,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:r,layers:[a],mapStyle:e.mapbox_style,setControlValue:n})}}V.propTypes=I,V.defaultProps=N;t.default=V},3436:function(e,t,n){"use strict";n.r(t),n.d(t,"getLayer",(function(){return d}));var i=n(3120),o=n(0),r=n.n(o),a=n(7),s=n(2920),l=n(2932),c=n(2921);function u(e){return t=>r.a.createElement("div",{className:"deckgl-tooltip"},r.a.createElement(c.a,{label:Object(a.c)("Longitude and Latitude")+": ",value:t.object.position[0]+", "+t.object.position[1]}),t.object.cat_color&&r.a.createElement(c.a,{label:Object(a.c)("Category")+": ",value:""+t.object.cat_color}),t.object.metric&&r.a.createElement(c.a,{label:e.point_radius_fixed.value.label+": ",value:""+t.object.metric}))}function d(e,t,n,o){const r=e,a=t.data.features.map(e=>{let t=(n=r.point_unit,i=e.radius,("square_m"===n?Math.sqrt(i/Math.PI):"radius_m"===n?i:"radius_km"===n?1e3*i:"radius_miles"===n?1609.34*i:"square_km"===n?1e3*Math.sqrt(i/Math.PI):"square_miles"===n?1609.34*Math.sqrt(i/Math.PI):null)||10);var n,i;if(r.multiplier&&(t*=r.multiplier),e.color)return{...e,radius:t};const o=r.color_picker||{r:0,g:0,b:0,a:1},a=[o.r,o.g,o.b,255*o.a];return{...e,radius:t,color:a}});return new i.a({id:"scatter-layer-"+r.slice_id,data:a,fp64:!0,getFillColor:e=>e.color,getRadius:e=>e.radius,radiusMinPixels:r.min_radius||null,radiusMaxPixels:r.max_radius||null,stroked:!1,...Object(s.a)(r,o,u(r))})}t.default=Object(l.a)(d,(function(e){return e.map(e=>e.position)}))},4314:function(e,t,n){"use strict";n.r(t);var i=n(0),o=n.n(i),r=n(340),a=n.n(r),s=n(2),l=n.n(s),c=n(89),u=n(2917),d=n(239),g=n.n(d);function p(e,t,n=!0,i={}){if(!e.datasource)return null;const o=new g.a("/"),r=function(e,t="base"){let n="/superset/explore/";return["json","csv","query","results","samples"].includes(t)&&(n="/superset/explore_json/"),n}(0,t),a=o.search(!0);Object.keys(i).forEach(e=>{a[e]=i[e]}),a.form_data=function(e){const t=new Set;return JSON.stringify(e,(e,n)=>{if("object"==typeof n&&null!==n){if(t.has(n))try{return JSON.parse(JSON.stringify(n))}catch(e){return}t.add(n)}return n})}(e),"standalone"===t&&(a.standalone="true");const s=o.directory(r).search(a).toString();if(!n&&s.length>8e3){return p({datasource:e.datasource,viz_type:e.viz_type},t,!1,{URL_IS_TOO_LONG_TO_SHARE:null})}return s}var h=n(3427),f=n(3430),v=n(3256),m=n(3432),y=n(3436),x=n(3435),b=n(3431),P=n(3433);var _={deck_grid:h.getLayer,deck_screengrid:f.getLayer,deck_path:v.getLayer,deck_hex:m.getLayer,deck_scatter:y.getLayer,deck_geojson:x.getLayer,deck_arc:b.getLayer,deck_polygon:P.getLayer};function w(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const C={formData:l.a.object.isRequired,payload:l.a.object.isRequired,setControlValue:l.a.func.isRequired,viewport:l.a.object.isRequired,onAddFilter:l.a.func,onSelect:l.a.func},S={onAddFilter(){},onSelect(){}};class j extends o.a.PureComponent{constructor(e){super(e),w(this,"containerRef",o.a.createRef()),w(this,"setTooltip",e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}),this.state={subSlicesLayers:{}},this.onViewportChange=this.onViewportChange.bind(this)}componentDidMount(){const{formData:e,payload:t}=this.props;this.loadLayers(e,t)}UNSAFE_componentWillReceiveProps(e){const{formData:t,payload:n}=e;!a.a.isEqual(this.props.formData.deck_slices,e.formData.deck_slices)&&this.loadLayers(t,n)}onViewportChange(e){this.setState({viewport:e})}loadLayers(e,t,n){this.setState({subSlicesLayers:{},viewport:n}),t.data.slices.forEach(t=>{const n=[...t.form_data.filters||[],...e.filters||[],...e.extra_filters||[]],i={...t,form_data:{...t.form_data,filters:n}};c.a.get({endpoint:p(i.form_data,"json")}).then(({json:e})=>{const t=_[i.form_data.viz_type](i.form_data,e,this.props.onAddFilter,this.setTooltip,[],this.props.onSelect);this.setState({subSlicesLayers:{...this.state.subSlicesLayers,[i.slice_id]:t}})}).catch(()=>{})})}render(){const{payload:e,formData:t,setControlValue:n}=this.props,{subSlicesLayers:i}=this.state,r=Object.values(i);return o.a.createElement(u.a,{ref:this.containerRef,mapboxApiAccessToken:e.data.mapboxApiKey,viewport:this.state.viewport||this.props.viewport,layers:r,mapStyle:t.mapbox_style,setControlValue:n,onViewportChange:this.onViewportChange})}}j.propTypes=C,j.defaultProps=S;t.default=j},693:function(e,t,n){(function(e,i){var o;!function(r){t&&t.nodeType,e&&e.nodeType;var a="object"==typeof i&&i;a.global!==a&&a.window!==a&&a.self;var s,l=2147483647,c=/^xn--/,u=/[^\x20-\x7E]/,d=/[\x2E\u3002\uFF0E\uFF61]/g,g={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=Math.floor,h=String.fromCharCode;function f(e){throw new RangeError(g[e])}function v(e,t){for(var n=e.length,i=[];n--;)i[n]=t(e[n]);return i}function m(e,t){var n=e.split("@"),i="";return n.length>1&&(i=n[0]+"@",e=n[1]),i+v((e=e.replace(d,".")).split("."),t).join(".")}function y(e){for(var t,n,i=[],o=0,r=e.length;o<r;)(t=e.charCodeAt(o++))>=55296&&t<=56319&&o<r?56320==(64512&(n=e.charCodeAt(o++)))?i.push(((1023&t)<<10)+(1023&n)+65536):(i.push(t),o--):i.push(t);return i}function x(e){return v(e,(function(e){var t="";return e>65535&&(t+=h((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=h(e)})).join("")}function b(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function P(e,t,n){var i=0;for(e=n?p(e/700):e>>1,e+=p(e/t);e>455;i+=36)e=p(e/35);return p(i+36*e/(e+38))}function _(e){var t,n,i,o,r,a,s,c,u,d,g,h=[],v=e.length,m=0,y=128,b=72;for((n=e.lastIndexOf("-"))<0&&(n=0),i=0;i<n;++i)e.charCodeAt(i)>=128&&f("not-basic"),h.push(e.charCodeAt(i));for(o=n>0?n+1:0;o<v;){for(r=m,a=1,s=36;o>=v&&f("invalid-input"),((c=(g=e.charCodeAt(o++))-48<10?g-22:g-65<26?g-65:g-97<26?g-97:36)>=36||c>p((l-m)/a))&&f("overflow"),m+=c*a,!(c<(u=s<=b?1:s>=b+26?26:s-b));s+=36)a>p(l/(d=36-u))&&f("overflow"),a*=d;b=P(m-r,t=h.length+1,0==r),p(m/t)>l-y&&f("overflow"),y+=p(m/t),m%=t,h.splice(m++,0,y)}return x(h)}function w(e){var t,n,i,o,r,a,s,c,u,d,g,v,m,x,_,w=[];for(v=(e=y(e)).length,t=128,n=0,r=72,a=0;a<v;++a)(g=e[a])<128&&w.push(h(g));for(i=o=w.length,o&&w.push("-");i<v;){for(s=l,a=0;a<v;++a)(g=e[a])>=t&&g<s&&(s=g);for(s-t>p((l-n)/(m=i+1))&&f("overflow"),n+=(s-t)*m,t=s,a=0;a<v;++a)if((g=e[a])<t&&++n>l&&f("overflow"),g==t){for(c=n,u=36;!(c<(d=u<=r?1:u>=r+26?26:u-r));u+=36)_=c-d,x=36-d,w.push(h(b(d+_%x,0))),c=p(_/x);w.push(h(b(c,0))),r=P(n,m,i==o),n=0,++i}++n,++t}return w.join("")}s={version:"1.3.2",ucs2:{decode:y,encode:x},decode:_,encode:w,toASCII:function(e){return m(e,(function(e){return u.test(e)?"xn--"+w(e):e}))},toUnicode:function(e){return m(e,(function(e){return c.test(e)?_(e.slice(4).toLowerCase()):e}))}},void 0===(o=function(){return s}.call(t,n,t,e))||(e.exports=o)}()}).call(this,n(315)(e),n(140))},694:function(e,t,n){var i,o;!function(r,a){"use strict";e.exports?e.exports=a():void 0===(o="function"==typeof(i=a)?i.call(t,n,t,e):i)||(e.exports=o)}(0,(function(e){"use strict";var t=e&&e.IPv6;return{best:function(e){var t,n,i=e.toLowerCase().split(":"),o=i.length,r=8;for(""===i[0]&&""===i[1]&&""===i[2]?(i.shift(),i.shift()):""===i[0]&&""===i[1]?i.shift():""===i[o-1]&&""===i[o-2]&&i.pop(),-1!==i[(o=i.length)-1].indexOf(".")&&(r=7),t=0;t<o&&""!==i[t];t++);if(t<r)for(i.splice(t,1,"0000");i.length<r;)i.splice(t,0,"0000");for(var a=0;a<r;a++){n=i[a].split("");for(var s=0;s<3&&("0"===n[0]&&n.length>1);s++)n.splice(0,1);i[a]=n.join("")}var l=-1,c=0,u=0,d=-1,g=!1;for(a=0;a<r;a++)g?"0"===i[a]?u+=1:(g=!1,u>c&&(l=d,c=u)):"0"===i[a]&&(g=!0,d=a,u=1);u>c&&(l=d,c=u),c>1&&i.splice(l,c,""),o=i.length;var p="";for(""===i[0]&&(p=":"),a=0;a<o&&(p+=i[a],a!==o-1);a++)p+=":";return""===i[o-1]&&(p+=":"),p},noConflict:function(){return e.IPv6===this&&(e.IPv6=t),this}}}))},695:function(e,t,n){var i,o;!function(r,a){"use strict";e.exports?e.exports=a():void 0===(o="function"==typeof(i=a)?i.call(t,n,t,e):i)||(e.exports=o)}(0,(function(e){"use strict";var t=e&&e.SecondLevelDomains,n={list:{ac:" com gov mil net org ",ae:" ac co gov mil name net org pro sch ",af:" com edu gov net org ",al:" com edu gov mil net org ",ao:" co ed gv it og pb ",ar:" com edu gob gov int mil net org tur ",at:" ac co gv or ",au:" asn com csiro edu gov id net org ",ba:" co com edu gov mil net org rs unbi unmo unsa untz unze ",bb:" biz co com edu gov info net org store tv ",bh:" biz cc com edu gov info net org ",bn:" com edu gov net org ",bo:" com edu gob gov int mil net org tv ",br:" adm adv agr am arq art ato b bio blog bmd cim cng cnt com coop ecn edu eng esp etc eti far flog fm fnd fot fst g12 ggf gov imb ind inf jor jus lel mat med mil mus net nom not ntr odo org ppg pro psc psi qsl rec slg srv tmp trd tur tv vet vlog wiki zlg ",bs:" com edu gov net org ",bz:" du et om ov rg ",ca:" ab bc mb nb nf nl ns nt nu on pe qc sk yk ",ck:" biz co edu gen gov info net org ",cn:" ac ah bj com cq edu fj gd gov gs gx gz ha hb he hi hl hn jl js jx ln mil net nm nx org qh sc sd sh sn sx tj tw xj xz yn zj ",co:" com edu gov mil net nom org ",cr:" ac c co ed fi go or sa ",cy:" ac biz com ekloges gov ltd name net org parliament press pro tm ",do:" art com edu gob gov mil net org sld web ",dz:" art asso com edu gov net org pol ",ec:" com edu fin gov info med mil net org pro ",eg:" com edu eun gov mil name net org sci ",er:" com edu gov ind mil net org rochest w ",es:" com edu gob nom org ",et:" biz com edu gov info name net org ",fj:" ac biz com info mil name net org pro ",fk:" ac co gov net nom org ",fr:" asso com f gouv nom prd presse tm ",gg:" co net org ",gh:" com edu gov mil org ",gn:" ac com gov net org ",gr:" com edu gov mil net org ",gt:" com edu gob ind mil net org ",gu:" com edu gov net org ",hk:" com edu gov idv net org ",hu:" 2000 agrar bolt casino city co erotica erotika film forum games hotel info ingatlan jogasz konyvelo lakas media news org priv reklam sex shop sport suli szex tm tozsde utazas video ",id:" ac co go mil net or sch web ",il:" ac co gov idf k12 muni net org ",in:" ac co edu ernet firm gen gov i ind mil net nic org res ",iq:" com edu gov i mil net org ",ir:" ac co dnssec gov i id net org sch ",it:" edu gov ",je:" co net org ",jo:" com edu gov mil name net org sch ",jp:" ac ad co ed go gr lg ne or ",ke:" ac co go info me mobi ne or sc ",kh:" com edu gov mil net org per ",ki:" biz com de edu gov info mob net org tel ",km:" asso com coop edu gouv k medecin mil nom notaires pharmaciens presse tm veterinaire ",kn:" edu gov net org ",kr:" ac busan chungbuk chungnam co daegu daejeon es gangwon go gwangju gyeongbuk gyeonggi gyeongnam hs incheon jeju jeonbuk jeonnam k kg mil ms ne or pe re sc seoul ulsan ",kw:" com edu gov net org ",ky:" com edu gov net org ",kz:" com edu gov mil net org ",lb:" com edu gov net org ",lk:" assn com edu gov grp hotel int ltd net ngo org sch soc web ",lr:" com edu gov net org ",lv:" asn com conf edu gov id mil net org ",ly:" com edu gov id med net org plc sch ",ma:" ac co gov m net org press ",mc:" asso tm ",me:" ac co edu gov its net org priv ",mg:" com edu gov mil nom org prd tm ",mk:" com edu gov inf name net org pro ",ml:" com edu gov net org presse ",mn:" edu gov org ",mo:" com edu gov net org ",mt:" com edu gov net org ",mv:" aero biz com coop edu gov info int mil museum name net org pro ",mw:" ac co com coop edu gov int museum net org ",mx:" com edu gob net org ",my:" com edu gov mil name net org sch ",nf:" arts com firm info net other per rec store web ",ng:" biz com edu gov mil mobi name net org sch ",ni:" ac co com edu gob mil net nom org ",np:" com edu gov mil net org ",nr:" biz com edu gov info net org ",om:" ac biz co com edu gov med mil museum net org pro sch ",pe:" com edu gob mil net nom org sld ",ph:" com edu gov i mil net ngo org ",pk:" biz com edu fam gob gok gon gop gos gov net org web ",pl:" art bialystok biz com edu gda gdansk gorzow gov info katowice krakow lodz lublin mil net ngo olsztyn org poznan pwr radom slupsk szczecin torun warszawa waw wroc wroclaw zgora ",pr:" ac biz com edu est gov info isla name net org pro prof ",ps:" com edu gov net org plo sec ",pw:" belau co ed go ne or ",ro:" arts com firm info nom nt org rec store tm www ",rs:" ac co edu gov in org ",sb:" com edu gov net org ",sc:" com edu gov net org ",sh:" co com edu gov net nom org ",sl:" com edu gov net org ",st:" co com consulado edu embaixada gov mil net org principe saotome store ",sv:" com edu gob org red ",sz:" ac co org ",tr:" av bbs bel biz com dr edu gen gov info k12 name net org pol tel tsk tv web ",tt:" aero biz cat co com coop edu gov info int jobs mil mobi museum name net org pro tel travel ",tw:" club com ebiz edu game gov idv mil net org ",mu:" ac co com gov net or org ",mz:" ac co edu gov org ",na:" co com ",nz:" ac co cri geek gen govt health iwi maori mil net org parliament school ",pa:" abo ac com edu gob ing med net nom org sld ",pt:" com edu gov int net nome org publ ",py:" com edu gov mil net org ",qa:" com edu gov mil net org ",re:" asso com nom ",ru:" ac adygeya altai amur arkhangelsk astrakhan bashkiria belgorod bir bryansk buryatia cbg chel chelyabinsk chita chukotka chuvashia com dagestan e-burg edu gov grozny int irkutsk ivanovo izhevsk jar joshkar-ola kalmykia kaluga kamchatka karelia kazan kchr kemerovo khabarovsk khakassia khv kirov koenig komi kostroma kranoyarsk kuban kurgan kursk lipetsk magadan mari mari-el marine mil mordovia mosreg msk murmansk nalchik net nnov nov novosibirsk nsk omsk orenburg org oryol penza perm pp pskov ptz rnd ryazan sakhalin samara saratov simbirsk smolensk spb stavropol stv surgut tambov tatarstan tom tomsk tsaritsyn tsk tula tuva tver tyumen udm udmurtia ulan-ude vladikavkaz vladimir vladivostok volgograd vologda voronezh vrn vyatka yakutia yamal yekaterinburg yuzhno-sakhalinsk ",rw:" ac co com edu gouv gov int mil net ",sa:" com edu gov med net org pub sch ",sd:" com edu gov info med net org tv ",se:" a ac b bd c d e f g h i k l m n o org p parti pp press r s t tm u w x y z ",sg:" com edu gov idn net org per ",sn:" art com edu gouv org perso univ ",sy:" com edu gov mil net news org ",th:" ac co go in mi net or ",tj:" ac biz co com edu go gov info int mil name net nic org test web ",tn:" agrinet com defense edunet ens fin gov ind info intl mincom nat net org perso rnrt rns rnu tourism ",tz:" ac co go ne or ",ua:" biz cherkassy chernigov chernovtsy ck cn co com crimea cv dn dnepropetrovsk donetsk dp edu gov if in ivano-frankivsk kh kharkov kherson khmelnitskiy kiev kirovograd km kr ks kv lg lugansk lutsk lviv me mk net nikolaev od odessa org pl poltava pp rovno rv sebastopol sumy te ternopil uzhgorod vinnica vn zaporizhzhe zhitomir zp zt ",ug:" ac co go ne or org sc ",uk:" ac bl british-library co cym gov govt icnet jet lea ltd me mil mod national-library-scotland nel net nhs nic nls org orgn parliament plc police sch scot soc ",us:" dni fed isa kids nsn ",uy:" com edu gub mil net org ",ve:" co com edu gob info mil net org web ",vi:" co com k12 net org ",vn:" ac biz com edu gov health info int name net org pro ",ye:" co com gov ltd me net org plc ",yu:" ac co edu gov org ",za:" ac agric alt bourse city co cybernet db edu gov grondar iaccess imt inca landesign law mil net ngo nis nom olivetti org pix school tm web ",zm:" ac co com edu gov net org sch ",com:"ar br cn de eu gb gr hu jpn kr no qc ru sa se uk us uy za ",net:"gb jp se uk ",org:"ae",de:"com "},has:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;var i=e.lastIndexOf(".",t-1);if(i<=0||i>=t-1)return!1;var o=n.list[e.slice(t+1)];return!!o&&o.indexOf(" "+e.slice(i+1,t)+" ")>=0},is:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return!1;if(e.lastIndexOf(".",t-1)>=0)return!1;var i=n.list[e.slice(t+1)];return!!i&&i.indexOf(" "+e.slice(0,t)+" ")>=0},get:function(e){var t=e.lastIndexOf(".");if(t<=0||t>=e.length-1)return null;var i=e.lastIndexOf(".",t-1);if(i<=0||i>=t-1)return null;var o=n.list[e.slice(t+1)];return o?o.indexOf(" "+e.slice(i+1,t)+" ")<0?null:e.slice(i+1):null},noConflict:function(){return e.SecondLevelDomains===this&&(e.SecondLevelDomains=t),this}};return n}))},780:function(e,t,n){var i;!function(o,r,a){if(o){for(var s,l={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},c={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},u={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},d={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},g=1;g<20;++g)l[111+g]="f"+g;for(g=0;g<=9;++g)l[g+96]=g.toString();y.prototype.bind=function(e,t,n){return e=e instanceof Array?e:[e],this._bindMultiple.call(this,e,t,n),this},y.prototype.unbind=function(e,t){return this.bind.call(this,e,(function(){}),t)},y.prototype.trigger=function(e,t){return this._directMap[e+":"+t]&&this._directMap[e+":"+t]({},e),this},y.prototype.reset=function(){return this._callbacks={},this._directMap={},this},y.prototype.stopCallback=function(e,t){return!((" "+t.className+" ").indexOf(" mousetrap ")>-1)&&(!function e(t,n){return null!==t&&t!==r&&(t===n||e(t.parentNode,n))}(t,this.target)&&("INPUT"==t.tagName||"SELECT"==t.tagName||"TEXTAREA"==t.tagName||t.isContentEditable))},y.prototype.handleKey=function(){var e=this;return e._handleKey.apply(e,arguments)},y.addKeycodes=function(e){for(var t in e)e.hasOwnProperty(t)&&(l[t]=e[t]);s=null},y.init=function(){var e=y(r);for(var t in e)"_"!==t.charAt(0)&&(y[t]=function(t){return function(){return e[t].apply(e,arguments)}}(t))},y.init(),o.Mousetrap=y,e.exports&&(e.exports=y),void 0===(i=function(){return y}.call(t,n,t,e))||(e.exports=i)}function p(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent("on"+t,n)}function h(e){if("keypress"==e.type){var t=String.fromCharCode(e.which);return e.shiftKey||(t=t.toLowerCase()),t}return l[e.which]?l[e.which]:c[e.which]?c[e.which]:String.fromCharCode(e.which).toLowerCase()}function f(e){return"shift"==e||"ctrl"==e||"alt"==e||"meta"==e}function v(e,t,n){return n||(n=function(){if(!s)for(var e in s={},l)e>95&&e<112||l.hasOwnProperty(e)&&(s[l[e]]=e);return s}()[e]?"keydown":"keypress"),"keypress"==n&&t.length&&(n="keydown"),n}function m(e,t){var n,i,o,r=[];for(n=function(e){return"+"===e?["+"]:(e=e.replace(/\+{2}/g,"+plus")).split("+")}(e),o=0;o<n.length;++o)i=n[o],d[i]&&(i=d[i]),t&&"keypress"!=t&&u[i]&&(i=u[i],r.push("shift")),f(i)&&r.push(i);return{key:i,modifiers:r,action:t=v(i,r,t)}}function y(e){var t=this;if(e=e||r,!(t instanceof y))return new y(e);t.target=e,t._callbacks={},t._directMap={};var n,i={},o=!1,a=!1,s=!1;function l(e){e=e||{};var t,n=!1;for(t in i)e[t]?n=!0:i[t]=0;n||(s=!1)}function c(e,n,o,r,a,s){var l,c,u,d,g=[],p=o.type;if(!t._callbacks[e])return[];for("keyup"==p&&f(e)&&(n=[e]),l=0;l<t._callbacks[e].length;++l)if(c=t._callbacks[e][l],(r||!c.seq||i[c.seq]==c.level)&&p==c.action&&("keypress"==p&&!o.metaKey&&!o.ctrlKey||(u=n,d=c.modifiers,u.sort().join(",")===d.sort().join(",")))){var h=!r&&c.combo==a,v=r&&c.seq==r&&c.level==s;(h||v)&&t._callbacks[e].splice(l,1),g.push(c)}return g}function u(e,n,i,o){t.stopCallback(n,n.target||n.srcElement,i,o)||!1===e(n,i)&&(function(e){e.preventDefault?e.preventDefault():e.returnValue=!1}(n),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}(n))}function d(e){"number"!=typeof e.which&&(e.which=e.keyCode);var n=h(e);n&&("keyup"!=e.type||o!==n?t.handleKey(n,function(e){var t=[];return e.shiftKey&&t.push("shift"),e.altKey&&t.push("alt"),e.ctrlKey&&t.push("ctrl"),e.metaKey&&t.push("meta"),t}(e),e):o=!1)}function g(e,t,r,a){function c(t){return function(){s=t,++i[e],clearTimeout(n),n=setTimeout(l,1e3)}}function d(t){u(r,t,e),"keyup"!==a&&(o=h(t)),setTimeout(l,10)}i[e]=0;for(var g=0;g<t.length;++g){var p=g+1===t.length?d:c(a||m(t[g+1]).action);v(t[g],p,a,e,g)}}function v(e,n,i,o,r){t._directMap[e+":"+i]=n;var a,s=(e=e.replace(/\s+/g," ")).split(" ");s.length>1?g(e,s,n,i):(a=m(e,i),t._callbacks[a.key]=t._callbacks[a.key]||[],c(a.key,a.modifiers,{type:a.action},o,e,r),t._callbacks[a.key][o?"unshift":"push"]({callback:n,modifiers:a.modifiers,action:a.action,seq:o,level:r,combo:e}))}t._handleKey=function(e,t,n){var i,o=c(e,t,n),r={},d=0,g=!1;for(i=0;i<o.length;++i)o[i].seq&&(d=Math.max(d,o[i].level));for(i=0;i<o.length;++i)if(o[i].seq){if(o[i].level!=d)continue;g=!0,r[o[i].seq]=1,u(o[i].callback,n,o[i].combo,o[i].seq)}else g||u(o[i].callback,n,o[i].combo);var p="keypress"==n.type&&a;n.type!=s||f(e)||p||l(r),a=g&&"keydown"==n.type},t._bindMultiple=function(e,t,n){for(var i=0;i<e.length;++i)v(e[i],t,n)},p(e,"keypress",d),p(e,"keydown",d),p(e,"keyup",d)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)}}]);