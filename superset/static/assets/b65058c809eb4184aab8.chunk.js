"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[3986,7275,8146],{78918:(e,t,i)=>{i.d(t,{Z:()=>a});var r=i(95772),s=i(63803),o=i(61855);class a extends r.Z{get isComposite(){return!0}get isLoaded(){return super.isLoaded&&this.getSubLayers().every((e=>e.isLoaded))}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){const{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id?(e.object=t.__source.object,e.index=t.__source.index,e):e}renderLayers(){return null}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){const{_subLayerProps:i}=this.props;return t&&t.length||i&&i[e]}getSubLayerClass(e,t){const{_subLayerProps:i}=this.props;return i&&i[e]&&i[e].type||t}getSubLayerRow(e,t,i){return e.__source={parent:this,object:t,index:i},e}getSubLayerAccessor(e){if("function"==typeof e){const t={data:this.props.data,target:[]};return(i,r)=>i&&i.__source?(t.index=i.__source.index,e(i.__source.object,t)):e(i,r)}return e}getSubLayerProps(e={}){const{opacity:t,pickable:i,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:n,highlightColor:l,coordinateSystem:c,coordinateOrigin:p,wrapLongitude:g,positionFormat:d,modelMatrix:h,extensions:u,fetch:f,_subLayerProps:m}=this.props,y={opacity:t,pickable:i,visible:r,parameters:s,getPolygonOffset:o,highlightedObjectIndex:a,autoHighlight:n,highlightColor:l,coordinateSystem:c,coordinateOrigin:p,wrapLongitude:g,positionFormat:d,modelMatrix:h,extensions:u,fetch:f},b=m&&m[e.id],_=b&&b.updateTriggers,L=e.id||"sublayer";if(b){const t=this.constructor._propTypes,i=e.type?e.type._propTypes:{};for(const e in b){const r=i[e]||t[e];r&&"accessor"===r.type&&(b[e]=this.getSubLayerAccessor(b[e]))}}Object.assign(y,e,b),y.id="".concat(this.props.id,"-").concat(L),y.updateTriggers={all:this.props.updateTriggers.all,...e.updateTriggers,..._};for(const e of u){const t=e.getSubLayerProps.call(this,e);t&&Object.assign(y,t,{updateTriggers:Object.assign(y.updateTriggers,t.updateTriggers)})}return y}_updateAutoHighlight(e){for(const t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_renderLayers(){let{subLayers:e}=this.internalState;const t=!e||this.needsUpdate();t&&(e=this.renderLayers(),e=(0,o.x)(e,Boolean),this.internalState.subLayers=e),(0,s.Z)("compositeLayer.renderLayers",this,t,e);for(const t of e)t.parent=this}}a.layerName="CompositeLayer"},35215:(e,t,i)=>{i.d(t,{Z:()=>p});var r=i(67294),s=i(45697),o=i.n(s),a=i(67190),n=i(11965);const l=" - ",c={categories:o().object,forceCategorical:o().bool,format:o().string,position:o().oneOf([null,"tl","tr","bl","br"]),showSingleCategory:o().func,toggleCategory:o().func};class p extends r.PureComponent{format(e){if(!this.props.format||this.props.forceCategorical)return e;const t=parseFloat(e);return(0,a.uf)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(l)){const t=e.split(l);return this.format(t[0])+l+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map((([e,t])=>{const i={color:`rgba(${t.color.join(", ")})`},r=t.enabled?"◼":"◻";return(0,n.tZ)("li",{key:e},(0,n.tZ)("a",{href:"#",onClick:()=>this.props.toggleCategory(e),onDoubleClick:()=>this.props.showSingleCategory(e)},(0,n.tZ)("span",{style:i},r)," ",this.formatCategoryLabel(e)))})),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return(0,n.tZ)("div",{className:"legend",style:t},(0,n.tZ)("ul",{className:"categories"},e))}}p.propTypes=c,p.defaultProps={categories:{},forceCategorical:!1,format:null,position:"tr",showSingleCategory:()=>{},toggleCategory:()=>{}}},10357:(e,t,i)=>{i.r(t),i.d(t,{default:()=>M,getLayer:()=>T});var r=i(67294),s=i(45697),o=i.n(s),a=i(78918),n=i(80744),l=i(38550),c=i(71435),p=i(62112),g=i(99890),d=i(98452);const h=[0,0,0,255],u={stroked:!0,filled:!0,extruded:!1,elevationScale:1,wireframe:!1,_normalize:!0,_windingOrder:"CW",lineWidthUnits:"meters",lineWidthScale:1,lineWidthMinPixels:0,lineWidthMaxPixels:Number.MAX_SAFE_INTEGER,lineJointRounded:!1,lineMiterLimit:4,getPolygon:{type:"accessor",value:e=>e.polygon},getFillColor:{type:"accessor",value:[0,0,0,255]},getLineColor:{type:"accessor",value:h},getLineWidth:{type:"accessor",value:1},getElevation:{type:"accessor",value:1e3},material:!0};class f extends a.Z{initializeState(){this.state={paths:[]},this.props.getLineDashArray&&n.Z.removed("getLineDashArray","PathStyleExtension")()}updateState({oldProps:e,props:t,changeFlags:i}){const r=i.dataChanged||i.updateTriggersChanged&&(i.updateTriggersChanged.all||i.updateTriggersChanged.getPolygon);if(r&&Array.isArray(i.dataChanged)){const e=this.state.paths.slice(),t=i.dataChanged.map((t=>(0,d.b)({data:e,getIndex:e=>e.__source.index,dataRange:t,replace:this._getPaths(t)})));this.setState({paths:e,pathsDiff:t})}else r&&this.setState({paths:this._getPaths(),pathsDiff:null})}_getPaths(e={}){const{data:t,getPolygon:i,positionFormat:r,_normalize:s}=this.props,o=[],a="XY"===r?2:3,{startRow:n,endRow:c}=e,{iterable:p,objectInfo:d}=(0,l.jB)(t,n,c);for(const e of p){d.index++;let t=i(e,d);s&&(t=g.F(t,a));const{holeIndices:r}=t,n=t.positions||t;if(r)for(let t=0;t<=r.length;t++){const i=n.slice(r[t-1]||0,r[t]||n.length);o.push(this.getSubLayerRow({path:i},e,d.index))}else o.push(this.getSubLayerRow({path:n},e,d.index))}return o}renderLayers(){const{data:e,_dataDiff:t,stroked:i,filled:r,extruded:s,wireframe:o,_normalize:a,_windingOrder:n,elevationScale:l,transitions:g,positionFormat:d}=this.props,{lineWidthUnits:u,lineWidthScale:f,lineWidthMinPixels:m,lineWidthMaxPixels:y,lineJointRounded:b,lineMiterLimit:_,lineDashJustified:L}=this.props,{getFillColor:C,getLineColor:S,getLineWidth:v,getLineDashArray:x,getElevation:w,getPolygon:P,updateTriggers:k,material:A}=this.props,{paths:Z,pathsDiff:F}=this.state,j=this.getSubLayerClass("fill",c.Z),T=this.getSubLayerClass("stroke",p.Z),D=this.shouldRenderSubLayer("fill",Z)&&new j({_dataDiff:t,extruded:s,elevationScale:l,filled:r,wireframe:o,_normalize:a,_windingOrder:n,getElevation:w,getFillColor:C,getLineColor:s&&o?S:h,material:A,transitions:g},this.getSubLayerProps({id:"fill",updateTriggers:{getPolygon:k.getPolygon,getElevation:k.getElevation,getFillColor:k.getFillColor,lineColors:s&&o,getLineColor:k.getLineColor}}),{data:e,positionFormat:d,getPolygon:P});return[!s&&D,!s&&i&&this.shouldRenderSubLayer("stroke",Z)&&new T({_dataDiff:F&&(()=>F),widthUnits:u,widthScale:f,widthMinPixels:m,widthMaxPixels:y,jointRounded:b,miterLimit:_,dashJustified:L,_pathType:"loop",transitions:g&&{getWidth:g.getLineWidth,getColor:g.getLineColor,getPath:g.getPolygon},getColor:this.getSubLayerAccessor(S),getWidth:this.getSubLayerAccessor(v),getDashArray:this.getSubLayerAccessor(x)},this.getSubLayerProps({id:"stroke",updateTriggers:{getWidth:k.getLineWidth,getColor:k.getLineColor,getDashArray:k.getLineDashArray}}),{data:Z,positionFormat:d,getPath:e=>e.path}),s&&D]}}f.layerName="PolygonLayer",f.defaultProps=u;var m=i(44272),y=i(35215),b=i(1740),_=i(4065),L=i(39828),C=i(2995),S=i(45511),v=i(64106);function x({break_points:e,num_buckets:t},i,r){if(!i)return[];if(void 0===e||0===e.length){const e=t?parseInt(t,10):10,[s,o]=(0,_.extent)(i,r);if(void 0===s)return[];const a=(o-s)/e,n=0===a?0:Math.max(0,Math.ceil(Math.log10(1/a))),l=o>o.toFixed(n)?1:0;return new Array(e+1+l).fill().map(((e,t)=>(s+t*a).toFixed(n)))}return e.sort(((e,t)=>parseFloat(e)-parseFloat(t)))}function w({break_points:e,num_buckets:t,linear_color_scheme:i,opacity:r},s,o){const a=e||t?x({break_points:e,num_buckets:t},s,o):null,n=Array.isArray(i)?new C.Z({colors:i,id:"custom"}):(0,S.Z)().get(i);let l,c;if(null!==a){const e=a.length-1,t=e>1?n.getColors(e):[n.colors[n.colors.length-1]],i=t[0],r=t[t.length-1];t.unshift(i),t.push(r);const s=a.map((e=>parseFloat(e)));l=(0,L.Z)().domain(s).range(t),c=t=>t>a[e]||t<a[0]}else l=n.createLinearScale((0,_.extent)(s,o)),c=()=>!1;return e=>{const t=o(e),i=(0,v.hexToRGB)(l(t));return c(t)?i[3]=0:i[3]=r/100*255,i}}var P=i(52154),k=i(66911),A=i(21207);function Z(e){return"geometry"in e.polygon?e.polygon.geometry.coordinates[0]:e.polygon}var F=i(40461),j=i(11965);function T(e,t,i,r,s,o,a){const n=e,l=n.fill_color_picker,c=n.stroke_color_picker;let p=[...t.data.features];if(null!=a&&a.forEach((e=>{p=p.filter((t=>e(t)))})),n.js_data_mutator){const e=(0,A.Z)(n.js_data_mutator);p=e(p)}const g=n.metric?n.metric.label||n.metric:null,d=null===n.metric?()=>[l.r,l.g,l.b,255*l.a]:w(n,p,(e=>e[g])),h=e=>{const t=d(e);return s.length>0&&!s.includes(e[n.line_column])&&(t[3]/=2),t},u=n.line_column&&n.metric&&["json","geohash","zipcode"].includes(n.line_type)?function(e){return t=>{const i=e.metric.label||e.metric;return(0,j.tZ)("div",{className:"deckgl-tooltip"},t.object.name&&(0,j.tZ)(b.Z,{label:"name: ",value:`${t.object.name}`}),t.object[e.line_column]&&(0,j.tZ)(b.Z,{label:`${e.line_column}: `,value:`${t.object[e.line_column]}`}),e.metric&&(0,j.tZ)(b.Z,{label:`${i}: `,value:`${t.object[i]}`}))}}(n):void 0;return new f({id:`path-layer-${n.slice_id}`,data:p,pickable:!0,filled:n.filled,stroked:n.stroked,getPolygon:Z,getFillColor:h,getLineColor:[c.r,c.g,c.b,255*c.a],getLineWidth:n.line_width,extruded:n.extruded,getElevation:e=>function(e,t){return 0===t(e)[3]?0:e.elevation}(e,h),elevationScale:n.multiplier,fp64:!0,...(0,P.N)(n,r,u,o)})}const D={formData:o().object.isRequired,payload:o().object.isRequired,setControlValue:o().func.isRequired,viewport:o().object.isRequired,onAddFilter:o().func,width:o().number.isRequired,height:o().number.isRequired},R={onAddFilter(){}};class W extends r.Component{constructor(e){super(e),this.containerRef=r.createRef(),this.setTooltip=e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)},this.state=W.getDerivedStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onSelect=this.onSelect.bind(this),this.onValuesChange=this.onValuesChange.bind(this)}static getDerivedStateFromProps(e,t){const{width:i,height:r,formData:s,payload:o}=e;if(t&&o.form_data===t.formData)return null;const a=o.data.features||[],n=a.map((e=>e.__timestamp)),l=o.form_data.time_grain_sqla||o.form_data.granularity||"P1D",{start:c,end:p,getStep:g,values:d,disabled:h}=(0,k.g)(n,l);let{viewport:u}=e;return s.autozoom&&(u=(0,F.Z)(u,{width:i,height:r,points:a.flatMap(Z)})),{start:c,end:p,getStep:g,values:d,disabled:h,viewport:u,selected:[],lastClick:0,formData:o.form_data}}onSelect(e){const{formData:t,onAddFilter:i}=this.props,r=new Date,s=r-this.state.lastClick<=250,o=[...this.state.selected];if(s)o.splice(0,o.length,e);else if(t.toggle_polygons){const t=o.indexOf(e);-1===t?o.push(e):o.splice(t,1)}else o.splice(0,1,e);this.setState({selected:o,lastClick:r}),t.table_filter&&i(t.line_column,o,!1,!0)}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getLayers(e){if(void 0===this.props.payload.data.features)return[];const t=[];return e[0]===e[1]||e[1]===this.end?t.push((t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1])):t.push((t=>t.__timestamp>=e[0]&&t.__timestamp<e[1])),[T(this.props.formData,this.props.payload,this.props.onAddFilter,this.setTooltip,this.state.selected,this.onSelect,t)]}render(){const{payload:e,formData:t,setControlValue:i}=this.props,{start:r,end:s,getStep:o,values:a,disabled:n,viewport:l}=this.state,c=t,p=c.metric?c.metric.label||c.metric:null,g=function(e,t,i){const r=x(e,t,i),s=w(e,t,i),o={};return r.slice(1).forEach(((t,i)=>{const a=`${r[i]} - ${r[i+1]}`,n=.5*(parseFloat(r[i])+parseFloat(r[i+1])),l=e.metric?e.metric.label||e.metric:null;o[a]={color:s({[l||e.metric]:n}),enabled:!0}})),o}(t,e.data.features,(e=>e[p]));return(0,j.tZ)("div",{style:{position:"relative"}},(0,j.tZ)(m.Z,{ref:this.containerRef,aggregation:!0,getLayers:this.getLayers,start:r,end:s,getStep:o,values:a,disabled:n,viewport:l,width:this.props.width,height:this.props.height,mapboxApiAccessToken:e.data.mapboxApiKey,mapStyle:t.mapbox_style,setControlValue:i,onValuesChange:this.onValuesChange,onViewportChange:this.onViewportChange},null!==t.metric&&(0,j.tZ)(y.Z,{categories:g,position:t.legend_position,format:t.legend_format})))}}W.propTypes=D,W.defaultProps=R;const M=W}}]);