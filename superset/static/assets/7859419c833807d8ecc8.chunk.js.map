{"version":3,"file":"7859419c833807d8ecc8.chunk.js","mappings":"oLAuBc,SAAUA,GAAc,OACpCC,EADoC,MAEpCC,EAFoC,cAGpCC,EAHoC,YAIpCC,EAJoC,SAKpCC,EALoC,QAMpCC,EANoC,eAOpCC,EAPoC,SAQpCC,IAEA,MAAMC,GAAe,IAAAC,cAClBC,IACC,IAAKH,EAASI,WACZ,OAGF,MAAMC,EAAgBF,EAAOG,KAAIC,GAASV,EAASU,KAEnDX,EAAY,CACVY,cAAe,CACbC,QACoB,IAAlBN,EAAOO,OACH,GACAZ,EAAQQ,KAAI,CAACK,EAAKC,KAChB,MAAMC,EAAMR,EAAcC,KAAIQ,GAAKA,EAAEF,KACrC,OAAIC,MAAAA,EACK,CACLF,IAAAA,EACAI,GAAI,WAED,CACLJ,IAAAA,EACAI,GAAI,KACJF,IAAKA,OAIjBG,YAAa,CACXT,MAAOF,EAAcK,OAASL,EAAgB,KAC9CN,eAAgBI,EAAOO,OAASP,EAAS,UAI/C,CAACL,EAASD,EAAUD,EAAaG,IAG7BkB,EAA+B,CACnCC,MAAOC,IACL,MAAM,KAAEC,GAASD,EACXhB,EAASkB,OAAOlB,OAAOJ,GACzBI,EAAOmB,SAASF,GAClBnB,EAAaE,EAAOoB,QAAOT,GAAKA,IAAMM,KAEtCnB,EAAa,CAACmB,MAKpB,OACE,QAAC,IAAD,CACE3B,OAAQA,EACRC,MAAOA,EACPC,cAAeA,EACfsB,cAAeA,EACflB,eAAgBA,M,iFC1DtB,MAAMyB,EAAS,QAA8B;YACjC,EAAG/B,OAAAA,KAAaA;WACjB,EAAGC,MAAAA,KAAYA;EAG1B,SAAS+B,GACP,MACE/B,EADF,OAEED,EAFF,cAGEE,EAHF,cAIEsB,EAJF,gBAKES,EALF,eAME3B,EAAiB,IAEnB4B,GAEA,MAAMC,GAAS,IAAAC,QAAuB,MAChCC,GAAW,IAAAD,UACXE,GAAmB,IAAAC,UACvB,IAAMX,OAAOY,KAAKlC,IAAmB,IACrC,CAACA,IAEGmC,GAAoB,IAAAL,QAAiB,IAiD3C,OA/CA,IAAAM,qBAAoBR,GAAK,KAAM,CAC7BS,kBAAmB,IAAMN,EAASO,aAGpC,IAAAC,YAAU,KACHV,EAAOS,UACPP,EAASO,UACZP,EAASO,SAAU,QAAKT,EAAOS,UAGjChB,OAAOkB,QAAQtB,GAAiB,IAAIuB,SAAQ,EAAEpB,EAAMqB,MAAY,QAC9D,SAAAX,EAASO,UAAT,EAAkBK,IAAItB,GACtB,SAAAU,EAASO,UAAT,EAAkBM,GAAGvB,EAAMqB,MAG7BpB,OAAOkB,QAAQb,GAAmB,IAAIc,SAAQ,EAAEpB,EAAMqB,MAAY,QAChE,SAAAX,EAASO,UAAT,EAAkBO,QAAQF,IAAItB,GAC9B,SAAAU,EAASO,UAAT,EAAkBO,QAAQD,GAAGvB,EAAMqB,MAGrCX,EAASO,QAAQQ,UAAUlD,GAAe,MACzC,CAACA,EAAesB,EAAeS,KAGlC,IAAAY,YAAU,KACHR,EAASO,UACdP,EAASO,QAAQS,eAAe,CAC9BC,KAAM,WACNC,UAAWd,EAAkBG,QAAQd,QACnChB,IAAUwB,EAAiBT,SAASf,OAGpCwB,EAAiBrB,QACnBoB,EAASO,QAAQS,eAAe,CAC9BC,KAAM,YACNC,UAAWjB,IAGfG,EAAkBG,QAAUN,KAC3B,CAACA,KAEJ,IAAAO,YAAU,KACJR,EAASO,SACXP,EAASO,QAAQY,OAAO,CAAEvD,MAAAA,EAAOD,OAAAA,MAElC,CAACC,EAAOD,KAEJ,QAAC+B,EAAD,CAAQG,IAAKC,EAAQnC,OAAQA,EAAQC,MAAOA,IAGrD,SAAe,IAAAwD,YAAWzB","sources":["webpack://superset/./plugins/plugin-chart-echarts/src/Funnel/EchartsFunnel.tsx","webpack://superset/./plugins/plugin-chart-echarts/src/components/Echart.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback } from 'react';\nimport { FunnelChartTransformedProps } from './types';\nimport Echart from '../components/Echart';\nimport { EventHandlers } from '../types';\n\nexport default function EchartsFunnel({\n  height,\n  width,\n  echartOptions,\n  setDataMask,\n  labelMap,\n  groupby,\n  selectedValues,\n  formData,\n}: FunnelChartTransformedProps) {\n  const handleChange = useCallback(\n    (values: string[]) => {\n      if (!formData.emitFilter) {\n        return;\n      }\n\n      const groupbyValues = values.map(value => labelMap[value]);\n\n      setDataMask({\n        extraFormData: {\n          filters:\n            values.length === 0\n              ? []\n              : groupby.map((col, idx) => {\n                  const val = groupbyValues.map(v => v[idx]);\n                  if (val === null || val === undefined)\n                    return {\n                      col,\n                      op: 'IS NULL',\n                    };\n                  return {\n                    col,\n                    op: 'IN',\n                    val: val as (string | number | boolean)[],\n                  };\n                }),\n        },\n        filterState: {\n          value: groupbyValues.length ? groupbyValues : null,\n          selectedValues: values.length ? values : null,\n        },\n      });\n    },\n    [groupby, labelMap, setDataMask, selectedValues],\n  );\n\n  const eventHandlers: EventHandlers = {\n    click: props => {\n      const { name } = props;\n      const values = Object.values(selectedValues);\n      if (values.includes(name)) {\n        handleChange(values.filter(v => v !== name));\n      } else {\n        handleChange([name]);\n      }\n    },\n  };\n\n  return (\n    <Echart\n      height={height}\n      width={width}\n      echartOptions={echartOptions}\n      eventHandlers={eventHandlers}\n      selectedValues={selectedValues}\n    />\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useRef,\n  useEffect,\n  useMemo,\n  forwardRef,\n  useImperativeHandle,\n} from 'react';\nimport { styled } from '@superset-ui/core';\nimport { ECharts, init } from 'echarts';\nimport { EchartsHandler, EchartsProps, EchartsStylesProps } from '../types';\n\nconst Styles = styled.div<EchartsStylesProps>`\n  height: ${({ height }) => height};\n  width: ${({ width }) => width};\n`;\n\nfunction Echart(\n  {\n    width,\n    height,\n    echartOptions,\n    eventHandlers,\n    zrEventHandlers,\n    selectedValues = {},\n  }: EchartsProps,\n  ref: React.Ref<EchartsHandler>,\n) {\n  const divRef = useRef<HTMLDivElement>(null);\n  const chartRef = useRef<ECharts>();\n  const currentSelection = useMemo(\n    () => Object.keys(selectedValues) || [],\n    [selectedValues],\n  );\n  const previousSelection = useRef<string[]>([]);\n\n  useImperativeHandle(ref, () => ({\n    getEchartInstance: () => chartRef.current,\n  }));\n\n  useEffect(() => {\n    if (!divRef.current) return;\n    if (!chartRef.current) {\n      chartRef.current = init(divRef.current);\n    }\n\n    Object.entries(eventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.off(name);\n      chartRef.current?.on(name, handler);\n    });\n\n    Object.entries(zrEventHandlers || {}).forEach(([name, handler]) => {\n      chartRef.current?.getZr().off(name);\n      chartRef.current?.getZr().on(name, handler);\n    });\n\n    chartRef.current.setOption(echartOptions, true);\n  }, [echartOptions, eventHandlers, zrEventHandlers]);\n\n  // highlighting\n  useEffect(() => {\n    if (!chartRef.current) return;\n    chartRef.current.dispatchAction({\n      type: 'downplay',\n      dataIndex: previousSelection.current.filter(\n        value => !currentSelection.includes(value),\n      ),\n    });\n    if (currentSelection.length) {\n      chartRef.current.dispatchAction({\n        type: 'highlight',\n        dataIndex: currentSelection,\n      });\n    }\n    previousSelection.current = currentSelection;\n  }, [currentSelection]);\n\n  useEffect(() => {\n    if (chartRef.current) {\n      chartRef.current.resize({ width, height });\n    }\n  }, [width, height]);\n\n  return <Styles ref={divRef} height={height} width={width} />;\n}\n\nexport default forwardRef(Echart);\n"],"names":["EchartsFunnel","height","width","echartOptions","setDataMask","labelMap","groupby","selectedValues","formData","handleChange","useCallback","values","emitFilter","groupbyValues","map","value","extraFormData","filters","length","col","idx","val","v","op","filterState","eventHandlers","click","props","name","Object","includes","filter","Styles","Echart","zrEventHandlers","ref","divRef","useRef","chartRef","currentSelection","useMemo","keys","previousSelection","useImperativeHandle","getEchartInstance","current","useEffect","entries","forEach","handler","off","on","getZr","setOption","dispatchAction","type","dataIndex","resize","forwardRef"],"sourceRoot":""}