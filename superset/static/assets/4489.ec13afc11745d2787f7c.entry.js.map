{"version":3,"file":"4489.ec13afc11745d2787f7c.entry.js","mappings":"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","sources":["webpack://superset/./src/components/Chart/ChartRenderer.jsx","webpack://superset/./src/components/Chart/ChartErrorMessage.tsx","webpack://superset/./src/components/Chart/Chart.jsx","webpack://superset/./src/components/Chart/ChartContainer.jsx","webpack://superset/./src/dashboard/util/propShapes.jsx","webpack://superset/./src/explore/components/EmbedCodeContent.jsx","webpack://superset/./src/explore/components/useExploreAdditionalActionsMenu/index.jsx","webpack://superset/./src/components/CertifiedBadge/index.tsx","webpack://superset/./src/components/CronPicker/CronPicker.tsx","webpack://superset/./src/components/DeleteModal/index.tsx","webpack://superset/./src/components/Dropdown/index.tsx","webpack://superset/./src/components/FaveStar/index.tsx","webpack://superset/./src/components/DynamicEditableTitle/index.tsx","webpack://superset/./src/components/PageHeaderWithActions/index.tsx","webpack://superset/./src/reports/types.ts","webpack://superset/./src/components/ReportModal/styles.tsx","webpack://superset/./src/components/ReportModal/index.tsx","webpack://superset/./src/components/ReportModal/HeaderReportDropdown/index.tsx","webpack://superset/./src/components/Switch/index.tsx","webpack://superset/./src/components/TimezoneSelector/index.tsx","webpack://superset/./src/dashboard/constants.ts","webpack://superset/./src/dashboard/util/backgroundStyleOptions.ts","webpack://superset/./src/dashboard/util/headerStyleOptions.ts","webpack://superset/./src/explore/components/DataTableControl/index.tsx","webpack://superset/./src/explore/components/DataTableControl/utils.ts","webpack://superset/./src/explore/components/DataTablesPane/types.ts","webpack://superset/./src/explore/components/DataTablesPane/utils.ts","webpack://superset/./src/explore/components/DataTablesPane/components/DataTableControls.tsx","webpack://superset/./src/explore/components/DataTablesPane/components/SingleQueryResultPane.tsx","webpack://superset/./src/explore/components/DataTablesPane/components/useResultsPane.tsx","webpack://superset/./src/explore/components/DataTablesPane/components/ResultsPaneOnDashboard.tsx","webpack://superset/./src/explore/components/DataTablesPane/components/SamplesPane.tsx","webpack://superset/./src/explore/components/DataTablesPane/DataTablesPane.tsx","webpack://superset/./src/explore/components/RowCountLabel/index.tsx","webpack://superset/./src/explore/components/controls/ViewQueryModal.tsx","webpack://superset/./src/explore/exploreUtils/formData.ts","webpack://superset/./src/hooks/useChangeEffect/useChangeEffect.ts","webpack://superset/./src/hooks/useTabId.ts","webpack://superset/./src/utils/downloadAsImage.ts","webpack://superset/./src/utils/getChartRequiredFieldsMissingMessage.ts"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { snakeCase, isEqual } from 'lodash';\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { SuperChart, logging, Behavior, t } from '@superset-ui/core';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from 'src/logger/LogUtils';\nimport { EmptyStateBig, EmptyStateSmall } from 'src/components/EmptyState';\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object,\n  initialValues: PropTypes.object,\n  formData: PropTypes.object.isRequired,\n  latestQueryFormData: PropTypes.object,\n  labelColors: PropTypes.object,\n  sharedLabelColors: PropTypes.object,\n  height: PropTypes.number,\n  width: PropTypes.number,\n  setControlValue: PropTypes.func,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  queriesResponse: PropTypes.arrayOf(PropTypes.object),\n  triggerQuery: PropTypes.bool,\n  chartIsStale: PropTypes.bool,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  setDataMask: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  ownState: PropTypes.object,\n  postTransformProps: PropTypes.func,\n  source: PropTypes.oneOf(['dashboard', 'explore']),\n};\n\nconst BLANK = {};\n\nconst BIG_NO_RESULT_MIN_WIDTH = 300;\nconst BIG_NO_RESULT_MIN_HEIGHT = 220;\n\nconst behaviors = [Behavior.INTERACTIVE_CHART];\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false,\n};\n\nclass ChartRenderer extends React.Component {\n  constructor(props) {\n    super(props);\n    this.hasQueryResponseChange = false;\n\n    this.handleAddFilter = this.handleAddFilter.bind(this);\n    this.handleRenderSuccess = this.handleRenderSuccess.bind(this);\n    this.handleRenderFailure = this.handleRenderFailure.bind(this);\n    this.handleSetControlValue = this.handleSetControlValue.bind(this);\n\n    this.hooks = {\n      onAddFilter: this.handleAddFilter,\n      onError: this.handleRenderFailure,\n      setControlValue: this.handleSetControlValue,\n      onFilterMenuOpen: this.props.onFilterMenuOpen,\n      onFilterMenuClose: this.props.onFilterMenuClose,\n      setDataMask: dataMask => {\n        this.props.actions?.updateDataMask(this.props.chartId, dataMask);\n      },\n    };\n  }\n\n  shouldComponentUpdate(nextProps) {\n    const resultsReady =\n      nextProps.queriesResponse &&\n      ['success', 'rendered'].indexOf(nextProps.chartStatus) > -1 &&\n      !nextProps.queriesResponse?.[0]?.error;\n\n    if (resultsReady) {\n      this.hasQueryResponseChange =\n        nextProps.queriesResponse !== this.props.queriesResponse;\n      return (\n        this.hasQueryResponseChange ||\n        !isEqual(nextProps.datasource, this.props.datasource) ||\n        nextProps.annotationData !== this.props.annotationData ||\n        nextProps.ownState !== this.props.ownState ||\n        nextProps.filterState !== this.props.filterState ||\n        nextProps.height !== this.props.height ||\n        nextProps.width !== this.props.width ||\n        nextProps.triggerRender ||\n        nextProps.labelColors !== this.props.labelColors ||\n        nextProps.sharedLabelColors !== this.props.sharedLabelColors ||\n        nextProps.formData.color_scheme !== this.props.formData.color_scheme ||\n        nextProps.formData.stack !== this.props.formData.stack ||\n        nextProps.cacheBusterProp !== this.props.cacheBusterProp\n      );\n    }\n    return false;\n  }\n\n  handleAddFilter(col, vals, merge = true, refresh = true) {\n    this.props.addFilter(col, vals, merge, refresh);\n  }\n\n  handleRenderSuccess() {\n    const { actions, chartStatus, chartId, vizType } = this.props;\n    if (['loading', 'rendered'].indexOf(chartStatus) < 0) {\n      actions.chartRenderingSucceeded(chartId);\n    }\n\n    // only log chart render time which is triggered by query results change\n    // currently we don't log chart re-render time, like window resize etc\n    if (this.hasQueryResponseChange) {\n      actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n        slice_id: chartId,\n        viz_type: vizType,\n        start_offset: this.renderStartTime,\n        ts: new Date().getTime(),\n        duration: Logger.getTimestamp() - this.renderStartTime,\n      });\n    }\n  }\n\n  handleRenderFailure(error, info) {\n    const { actions, chartId } = this.props;\n    logging.warn(error);\n    actions.chartRenderingFailed(\n      error.toString(),\n      chartId,\n      info ? info.componentStack : null,\n    );\n\n    // only trigger render log when query is changed\n    if (this.hasQueryResponseChange) {\n      actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n        slice_id: chartId,\n        has_err: true,\n        error_details: error.toString(),\n        start_offset: this.renderStartTime,\n        ts: new Date().getTime(),\n        duration: Logger.getTimestamp() - this.renderStartTime,\n      });\n    }\n  }\n\n  handleSetControlValue(...args) {\n    const { setControlValue } = this.props;\n    if (setControlValue) {\n      setControlValue(...args);\n    }\n  }\n\n  render() {\n    const { chartAlert, chartStatus, chartId } = this.props;\n\n    // Skip chart rendering\n    if (chartStatus === 'loading' || !!chartAlert || chartStatus === null) {\n      return null;\n    }\n\n    this.renderStartTime = Logger.getTimestamp();\n\n    const {\n      width,\n      height,\n      datasource,\n      annotationData,\n      initialValues,\n      ownState,\n      filterState,\n      chartIsStale,\n      formData,\n      latestQueryFormData,\n      queriesResponse,\n      postTransformProps,\n    } = this.props;\n\n    const currentFormData =\n      chartIsStale && latestQueryFormData ? latestQueryFormData : formData;\n    const vizType = currentFormData.viz_type || this.props.vizType;\n\n    // It's bad practice to use unprefixed `vizType` as classnames for chart\n    // container. It may cause css conflicts as in the case of legacy table chart.\n    // When migrating charts, we should gradually add a `superset-chart-` prefix\n    // to each one of them.\n    const snakeCaseVizType = snakeCase(vizType);\n    const chartClassName =\n      vizType === 'table'\n        ? `superset-chart-${snakeCaseVizType}`\n        : snakeCaseVizType;\n\n    const webpackHash =\n      process.env.WEBPACK_MODE === 'development'\n        ? `-${\n            // eslint-disable-next-line camelcase\n            typeof __webpack_require__ !== 'undefined' &&\n            // eslint-disable-next-line camelcase, no-undef\n            typeof __webpack_require__.h === 'function' &&\n            // eslint-disable-next-line no-undef\n            __webpack_require__.h()\n          }`\n        : '';\n\n    let noResultsComponent;\n    const noResultTitle = t('No results were returned for this query');\n    const noResultDescription =\n      this.props.source === 'explore'\n        ? t(\n            'Make sure that the controls are configured properly and the datasource contains data for the selected time range',\n          )\n        : undefined;\n    const noResultImage = 'chart.svg';\n    if (width > BIG_NO_RESULT_MIN_WIDTH && height > BIG_NO_RESULT_MIN_HEIGHT) {\n      noResultsComponent = (\n        <EmptyStateBig\n          title={noResultTitle}\n          description={noResultDescription}\n          image={noResultImage}\n        />\n      );\n    } else {\n      noResultsComponent = (\n        <EmptyStateSmall title={noResultTitle} image={noResultImage} />\n      );\n    }\n\n    return (\n      <SuperChart\n        disableErrorBoundary\n        key={`${chartId}${webpackHash}`}\n        id={`chart-id-${chartId}`}\n        className={chartClassName}\n        chartType={vizType}\n        width={width}\n        height={height}\n        annotationData={annotationData}\n        datasource={datasource}\n        initialValues={initialValues}\n        formData={currentFormData}\n        ownState={ownState}\n        filterState={filterState}\n        hooks={this.hooks}\n        behaviors={behaviors}\n        queriesData={queriesResponse}\n        onRenderSuccess={this.handleRenderSuccess}\n        onRenderFailure={this.handleRenderFailure}\n        noResults={noResultsComponent}\n        postTransformProps={postTransformProps}\n      />\n    );\n  }\n}\n\nChartRenderer.propTypes = propTypes;\nChartRenderer.defaultProps = defaultProps;\n\nexport default ChartRenderer;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React from 'react';\nimport { useChartOwnerNames } from 'src/hooks/apiResources';\nimport ErrorMessageWithStackTrace from 'src/components/ErrorMessage/ErrorMessageWithStackTrace';\nimport { SupersetError } from 'src/components/ErrorMessage/types';\n\ninterface Props {\n  chartId: string;\n  error?: SupersetError;\n}\n\n/**\n * fetches the chart owners and adds them to the extra data of the error message\n */\nexport const ChartErrorMessage: React.FC<Props> = ({\n  chartId,\n  error,\n  ...props\n}) => {\n  const { result: owners } = useChartOwnerNames(chartId);\n\n  // don't mutate props\n  const ownedError = error && {\n    ...error,\n    extra: { ...error.extra, owners },\n  };\n\n  return <ErrorMessageWithStackTrace {...props} error={ownedError} />;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport React from 'react';\nimport { styled, logging, t, ensureIsArray } from '@superset-ui/core';\n\nimport { isFeatureEnabled, FeatureFlag } from 'src/featureFlags';\nimport { PLACEHOLDER_DATASOURCE } from 'src/dashboard/constants';\nimport Loading from 'src/components/Loading';\nimport { EmptyStateBig } from 'src/components/EmptyState';\nimport ErrorBoundary from 'src/components/ErrorBoundary';\nimport { Logger, LOG_ACTIONS_RENDER_CHART } from 'src/logger/LogUtils';\nimport { URL_PARAMS } from 'src/constants';\nimport { getUrlParam } from 'src/utils/urlUtils';\nimport { ResourceStatus } from 'src/hooks/apiResources/apiResources';\nimport ChartRenderer from './ChartRenderer';\nimport { ChartErrorMessage } from './ChartErrorMessage';\nimport { getChartRequiredFieldsMissingMessage } from '../../utils/getChartRequiredFieldsMissingMessage';\n\nconst propTypes = {\n  annotationData: PropTypes.object,\n  actions: PropTypes.object,\n  chartId: PropTypes.number.isRequired,\n  datasource: PropTypes.object,\n  // current chart is included by dashboard\n  dashboardId: PropTypes.number,\n  // original selected values for FilterBox viz\n  // so that FilterBox can pre-populate selected values\n  // only affect UI control\n  initialValues: PropTypes.object,\n  // formData contains chart's own filter parameter\n  // and merged with extra filter that current dashboard applying\n  formData: PropTypes.object.isRequired,\n  labelColors: PropTypes.object,\n  sharedLabelColors: PropTypes.object,\n  width: PropTypes.number,\n  height: PropTypes.number,\n  setControlValue: PropTypes.func,\n  timeout: PropTypes.number,\n  vizType: PropTypes.string.isRequired,\n  triggerRender: PropTypes.bool,\n  force: PropTypes.bool,\n  isFiltersInitialized: PropTypes.bool,\n  isDeactivatedViz: PropTypes.bool,\n  // state\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  chartStackTrace: PropTypes.string,\n  queriesResponse: PropTypes.arrayOf(PropTypes.object),\n  triggerQuery: PropTypes.bool,\n  chartIsStale: PropTypes.bool,\n  errorMessage: PropTypes.node,\n  // dashboard callbacks\n  addFilter: PropTypes.func,\n  onQuery: PropTypes.func,\n  onFilterMenuOpen: PropTypes.func,\n  onFilterMenuClose: PropTypes.func,\n  ownState: PropTypes.object,\n  postTransformProps: PropTypes.func,\n  datasetsStatus: PropTypes.oneOf(['loading', 'error', 'complete']),\n};\n\nconst BLANK = {};\nconst NONEXISTENT_DATASET = t(\n  'The dataset associated with this chart no longer exists',\n);\n\nconst defaultProps = {\n  addFilter: () => BLANK,\n  onFilterMenuOpen: () => BLANK,\n  onFilterMenuClose: () => BLANK,\n  initialValues: BLANK,\n  setControlValue() {},\n  triggerRender: false,\n  dashboardId: null,\n  chartStackTrace: null,\n  isDeactivatedViz: false,\n  force: false,\n};\n\nconst Styles = styled.div`\n  min-height: ${p => p.height}px;\n  position: relative;\n\n  .chart-tooltip {\n    opacity: 0.75;\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  }\n\n  .slice_container {\n    height: ${p => p.height}px;\n\n    .pivot_table tbody tr {\n      font-feature-settings: 'tnum' 1;\n    }\n  }\n`;\n\nconst MonospaceDiv = styled.div`\n  font-family: ${({ theme }) => theme.typography.families.monospace};\n  word-break: break-word;\n  overflow-x: auto;\n  white-space: pre-wrap;\n`;\n\nclass Chart extends React.PureComponent {\n  constructor(props) {\n    super(props);\n    this.handleRenderContainerFailure =\n      this.handleRenderContainerFailure.bind(this);\n  }\n\n  componentDidMount() {\n    // during migration, hold chart queries before user choose review or cancel\n    if (\n      this.props.triggerQuery &&\n      this.props.filterboxMigrationState !== 'UNDECIDED'\n    ) {\n      this.runQuery();\n    }\n  }\n\n  componentDidUpdate() {\n    // during migration, hold chart queries before user choose review or cancel\n    if (\n      this.props.triggerQuery &&\n      this.props.filterboxMigrationState !== 'UNDECIDED'\n    ) {\n      // if the chart is deactivated (filter_box), only load once\n      if (this.props.isDeactivatedViz && this.props.queriesResponse) {\n        return;\n      }\n      this.runQuery();\n    }\n  }\n\n  runQuery() {\n    if (this.props.chartId > 0 && isFeatureEnabled(FeatureFlag.CLIENT_CACHE)) {\n      // Load saved chart with a GET request\n      this.props.actions.getSavedChart(\n        this.props.formData,\n        this.props.force || getUrlParam(URL_PARAMS.force), // allow override via url params force=true\n        this.props.timeout,\n        this.props.chartId,\n        this.props.dashboardId,\n        this.props.ownState,\n      );\n    } else {\n      // Create chart with POST request\n      this.props.actions.postChartFormData(\n        this.props.formData,\n        this.props.force || getUrlParam(URL_PARAMS.force), // allow override via url params force=true\n        this.props.timeout,\n        this.props.chartId,\n        this.props.dashboardId,\n        this.props.ownState,\n      );\n    }\n  }\n\n  handleRenderContainerFailure(error, info) {\n    const { actions, chartId } = this.props;\n    logging.warn(error);\n    actions.chartRenderingFailed(\n      error.toString(),\n      chartId,\n      info ? info.componentStack : null,\n    );\n\n    actions.logEvent(LOG_ACTIONS_RENDER_CHART, {\n      slice_id: chartId,\n      has_err: true,\n      error_details: error.toString(),\n      start_offset: this.renderStartTime,\n      ts: new Date().getTime(),\n      duration: Logger.getTimestamp() - this.renderStartTime,\n    });\n  }\n\n  renderErrorMessage(queryResponse) {\n    const {\n      chartId,\n      chartAlert,\n      chartStackTrace,\n      datasource,\n      dashboardId,\n      height,\n      datasetsStatus,\n    } = this.props;\n\n    const error = queryResponse?.errors?.[0];\n    const message = chartAlert || queryResponse?.message;\n\n    // if datasource is still loading, don't render JS errors\n    if (\n      chartAlert !== undefined &&\n      chartAlert !== NONEXISTENT_DATASET &&\n      datasource === PLACEHOLDER_DATASOURCE &&\n      datasetsStatus !== ResourceStatus.ERROR\n    ) {\n      return (\n        <Styles\n          key={chartId}\n          data-ui-anchor=\"chart\"\n          className=\"chart-container\"\n          data-test=\"chart-container\"\n          height={height}\n        >\n          <Loading />\n        </Styles>\n      );\n    }\n\n    return (\n      <ChartErrorMessage\n        key={chartId}\n        chartId={chartId}\n        error={error}\n        subtitle={<MonospaceDiv>{message}</MonospaceDiv>}\n        copyText={message}\n        link={queryResponse ? queryResponse.link : null}\n        source={dashboardId ? 'dashboard' : 'explore'}\n        stackTrace={chartStackTrace}\n      />\n    );\n  }\n\n  render() {\n    const {\n      height,\n      chartAlert,\n      chartStatus,\n      errorMessage,\n      chartIsStale,\n      queriesResponse = [],\n      isDeactivatedViz = false,\n      width,\n    } = this.props;\n\n    const isLoading = chartStatus === 'loading';\n    this.renderContainerStartTime = Logger.getTimestamp();\n    if (chartStatus === 'failed') {\n      return queriesResponse.map(item => this.renderErrorMessage(item));\n    }\n\n    if (errorMessage && ensureIsArray(queriesResponse).length === 0) {\n      return (\n        <EmptyStateBig\n          title={t('Add required control values to preview chart')}\n          description={getChartRequiredFieldsMissingMessage(true)}\n          image=\"chart.svg\"\n        />\n      );\n    }\n\n    if (\n      !isLoading &&\n      !chartAlert &&\n      !errorMessage &&\n      chartIsStale &&\n      ensureIsArray(queriesResponse).length === 0\n    ) {\n      return (\n        <EmptyStateBig\n          title={t('Your chart is ready to go!')}\n          description={\n            <span>\n              {t(\n                'Click on \"Create chart\" button in the control panel on the left to preview a visualization or',\n              )}{' '}\n              <span role=\"button\" tabIndex={0} onClick={this.props.onQuery}>\n                {t('click here')}\n              </span>\n              .\n            </span>\n          }\n          image=\"chart.svg\"\n        />\n      );\n    }\n\n    return (\n      <ErrorBoundary\n        onError={this.handleRenderContainerFailure}\n        showMessage={false}\n      >\n        <Styles\n          data-ui-anchor=\"chart\"\n          className=\"chart-container\"\n          data-test=\"chart-container\"\n          height={height}\n          width={width}\n        >\n          <div className=\"slice_container\" data-test=\"slice-container\">\n            <ChartRenderer\n              {...this.props}\n              source={this.props.dashboardId ? 'dashboard' : 'explore'}\n              data-test={this.props.vizType}\n            />\n          </div>\n          {isLoading && !isDeactivatedViz && <Loading />}\n        </Styles>\n      </ErrorBoundary>\n    );\n  }\n}\n\nChart.propTypes = propTypes;\nChart.defaultProps = defaultProps;\n\nexport default Chart;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { connect } from 'react-redux';\nimport { bindActionCreators } from 'redux';\n\nimport * as actions from './chartAction';\nimport { logEvent } from '../../logger/actions';\nimport Chart from './Chart';\nimport { updateDataMask } from '../../dataMask/actions';\n\nfunction mapDispatchToProps(dispatch) {\n  return {\n    actions: bindActionCreators(\n      {\n        ...actions,\n        updateDataMask,\n        logEvent,\n      },\n      dispatch,\n    ),\n  };\n}\n\nexport default connect(null, mapDispatchToProps)(Chart);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport PropTypes from 'prop-types';\nimport componentTypes from './componentTypes';\nimport backgroundStyleOptions from './backgroundStyleOptions';\nimport headerStyleOptions from './headerStyleOptions';\n\nexport const componentShape = PropTypes.shape({\n  id: PropTypes.string.isRequired,\n  type: PropTypes.oneOf(Object.values(componentTypes)).isRequired,\n  parents: PropTypes.arrayOf(PropTypes.string),\n  children: PropTypes.arrayOf(PropTypes.string),\n  meta: PropTypes.shape({\n    // Dimensions\n    width: PropTypes.number,\n    height: PropTypes.number,\n\n    // Header\n    headerSize: PropTypes.oneOf(headerStyleOptions.map(opt => opt.value)),\n\n    // Row\n    background: PropTypes.oneOf(backgroundStyleOptions.map(opt => opt.value)),\n\n    // Chart\n    chartId: PropTypes.number,\n  }),\n});\n\nexport const chartPropShape = PropTypes.shape({\n  id: PropTypes.number.isRequired,\n  chartAlert: PropTypes.string,\n  chartStatus: PropTypes.string,\n  chartUpdateEndTime: PropTypes.number,\n  chartUpdateStartTime: PropTypes.number,\n  latestQueryFormData: PropTypes.object,\n  queryController: PropTypes.shape({ abort: PropTypes.func }),\n  queriesResponse: PropTypes.arrayOf(PropTypes.object),\n  triggerQuery: PropTypes.bool,\n  lastRendered: PropTypes.number,\n});\n\nexport const slicePropShape = PropTypes.shape({\n  slice_id: PropTypes.number.isRequired,\n  slice_url: PropTypes.string.isRequired,\n  slice_name: PropTypes.string.isRequired,\n  datasource: PropTypes.string,\n  datasource_name: PropTypes.string,\n  datasource_link: PropTypes.string,\n  changed_on: PropTypes.number.isRequired,\n  modified: PropTypes.string.isRequired,\n  viz_type: PropTypes.string.isRequired,\n  description: PropTypes.string,\n  description_markeddown: PropTypes.string,\n  owners: PropTypes.arrayOf(PropTypes.string),\n});\n\nexport const dashboardFilterPropShape = PropTypes.shape({\n  chartId: PropTypes.number.isRequired,\n  componentId: PropTypes.string.isRequired,\n  filterName: PropTypes.string.isRequired,\n  datasourceId: PropTypes.string.isRequired,\n  directPathToFilter: PropTypes.arrayOf(PropTypes.string).isRequired,\n  isDateFilter: PropTypes.bool.isRequired,\n  isInstantFilter: PropTypes.bool.isRequired,\n  columns: PropTypes.object,\n  labels: PropTypes.object,\n  scopes: PropTypes.object,\n});\n\nexport const dashboardStatePropShape = PropTypes.shape({\n  sliceIds: PropTypes.arrayOf(PropTypes.number).isRequired,\n  expandedSlices: PropTypes.object,\n  editMode: PropTypes.bool,\n  isPublished: PropTypes.bool.isRequired,\n  colorNamespace: PropTypes.string,\n  colorScheme: PropTypes.string,\n  updatedColorScheme: PropTypes.bool,\n  hasUnsavedChanges: PropTypes.bool,\n});\n\nexport const dashboardInfoPropShape = PropTypes.shape({\n  id: PropTypes.number.isRequired,\n  metadata: PropTypes.object,\n  slug: PropTypes.string,\n  dash_edit_perm: PropTypes.bool.isRequired,\n  dash_save_perm: PropTypes.bool.isRequired,\n  common: PropTypes.object,\n  userId: PropTypes.string.isRequired,\n});\n\n/* eslint-disable-next-line  no-undef */\nconst lazyFunction = f => () => f().apply(this, arguments);\n\nconst leafType = PropTypes.shape({\n  value: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\n  label: PropTypes.string.isRequired,\n});\n\nconst parentShape = {\n  value: PropTypes.oneOfType([PropTypes.number, PropTypes.string]).isRequired,\n  label: PropTypes.string.isRequired,\n  children: PropTypes.arrayOf(\n    PropTypes.oneOfType([\n      PropTypes.shape(lazyFunction(() => parentShape)),\n      leafType,\n    ]),\n  ),\n};\n\nexport const filterScopeSelectorTreeNodePropShape = PropTypes.oneOfType([\n  PropTypes.shape(parentShape),\n  leafType,\n]);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useEffect, useMemo, useState } from 'react';\nimport { css, styled, t } from '@superset-ui/core';\nimport { Input, TextArea } from 'src/components/Input';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport { URL_PARAMS } from 'src/constants';\nimport { getChartPermalink } from 'src/utils/urlUtils';\nimport { CopyButton } from './DataTableControl';\n\nconst CopyButtonEmbedCode = styled(CopyButton)`\n  && {\n    margin: 0 0 ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nconst EmbedCodeContent = ({ formData, addDangerToast }) => {\n  const [height, setHeight] = useState('400');\n  const [width, setWidth] = useState('600');\n  const [url, setUrl] = useState('');\n  const [errorMessage, setErrorMessage] = useState('');\n\n  const handleInputChange = useCallback(e => {\n    const { value, name } = e.currentTarget;\n    if (name === 'width') {\n      setWidth(value);\n    }\n    if (name === 'height') {\n      setHeight(value);\n    }\n  }, []);\n\n  const updateUrl = useCallback(() => {\n    setUrl('');\n    getChartPermalink(formData)\n      .then(url => {\n        setUrl(url);\n        setErrorMessage('');\n      })\n      .catch(() => {\n        setErrorMessage(t('Error'));\n        addDangerToast(t('Sorry, something went wrong. Try again later.'));\n      });\n  }, [addDangerToast, formData]);\n\n  useEffect(() => {\n    updateUrl();\n  }, []);\n\n  const html = useMemo(() => {\n    if (!url) return '';\n    const srcLink = `${url}?${URL_PARAMS.standalone.name}=1&height=${height}`;\n    return (\n      '<iframe\\n' +\n      `  width=\"${width}\"\\n` +\n      `  height=\"${height}\"\\n` +\n      '  seamless\\n' +\n      '  frameBorder=\"0\"\\n' +\n      '  scrolling=\"no\"\\n' +\n      `  src=\"${srcLink}\"\\n` +\n      '>\\n' +\n      '</iframe>'\n    );\n  }, [height, url, width]);\n\n  const text = errorMessage || html || t('Generating link, please wait..');\n  return (\n    <div id=\"embed-code-popover\" data-test=\"embed-code-popover\">\n      <div\n        css={css`\n          display: flex;\n          flex-direction: column;\n        `}\n      >\n        <CopyToClipboard\n          shouldShowText={false}\n          text={html}\n          copyNode={\n            <CopyButtonEmbedCode buttonSize=\"xsmall\">\n              <i className=\"fa fa-clipboard\" />\n            </CopyButtonEmbedCode>\n          }\n        />\n        <TextArea\n          data-test=\"embed-code-textarea\"\n          name=\"embedCode\"\n          disabled={!html}\n          value={text}\n          rows=\"4\"\n          readOnly\n          css={theme => css`\n            resize: vertical;\n            padding: ${theme.gridUnit * 2}px;\n            font-size: ${theme.typography.sizes.s}px;\n            border-radius: 4px;\n            background-color: ${theme.colors.secondary.light5};\n          `}\n        />\n      </div>\n      <div\n        css={theme => css`\n          display: flex;\n          margin-top: ${theme.gridUnit * 4}px;\n          & > div {\n            margin-right: ${theme.gridUnit * 2}px;\n          }\n          & > div:last-of-type {\n            margin-right: 0;\n            margin-left: ${theme.gridUnit * 2}px;\n          }\n        `}\n      >\n        <div>\n          <label htmlFor=\"embed-height\">{t('Chart height')}</label>\n          <Input\n            type=\"text\"\n            defaultValue={height}\n            name=\"height\"\n            onChange={handleInputChange}\n          />\n        </div>\n        <div>\n          <label htmlFor=\"embed-width\">{t('Chart width')}</label>\n          <Input\n            type=\"text\"\n            defaultValue={width}\n            name=\"width\"\n            onChange={handleInputChange}\n            id=\"embed-width\"\n          />\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default EmbedCodeContent;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useCallback, useMemo, useState } from 'react';\nimport { useSelector } from 'react-redux';\nimport { FileOutlined, FileImageOutlined } from '@ant-design/icons';\nimport { css, styled, t, useTheme } from '@superset-ui/core';\nimport { Menu } from 'src/components/Menu';\nimport ModalTrigger from 'src/components/ModalTrigger';\nimport Button from 'src/components/Button';\nimport { useToasts } from 'src/components/MessageToasts/withToasts';\nimport { exportChart } from 'src/explore/exploreUtils';\nimport downloadAsImage from 'src/utils/downloadAsImage';\nimport { getChartPermalink } from 'src/utils/urlUtils';\nimport copyTextToClipboard from 'src/utils/copy';\nimport HeaderReportDropDown from 'src/components/ReportModal/HeaderReportDropdown';\nimport ViewQueryModal from '../controls/ViewQueryModal';\nimport EmbedCodeContent from '../EmbedCodeContent';\n\nconst MENU_KEYS = {\n  EDIT_PROPERTIES: 'edit_properties',\n  DOWNLOAD_SUBMENU: 'download_submenu',\n  EXPORT_TO_CSV: 'export_to_csv',\n  EXPORT_TO_CSV_PIVOTED: 'export_to_csv_pivoted',\n  EXPORT_TO_JSON: 'export_to_json',\n  DOWNLOAD_AS_IMAGE: 'download_as_image',\n  SHARE_SUBMENU: 'share_submenu',\n  COPY_PERMALINK: 'copy_permalink',\n  EMBED_CODE: 'embed_code',\n  SHARE_BY_EMAIL: 'share_by_email',\n  REPORT_SUBMENU: 'report_submenu',\n  SET_UP_REPORT: 'set_up_report',\n  SET_REPORT_ACTIVE: 'set_report_active',\n  EDIT_REPORT: 'edit_report',\n  DELETE_REPORT: 'delete_report',\n  VIEW_QUERY: 'view_query',\n  RUN_IN_SQL_LAB: 'run_in_sql_lab',\n};\n\nconst VIZ_TYPES_PIVOTABLE = ['pivot_table', 'pivot_table_v2'];\n\nexport const MenuItemWithCheckboxContainer = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    align-items: center;\n\n    & svg {\n      width: ${theme.gridUnit * 3}px;\n      height: ${theme.gridUnit * 3}px;\n    }\n\n    & span[role='checkbox'] {\n      display: inline-flex;\n      margin-right: ${theme.gridUnit}px;\n    }\n  `}\n`;\n\nexport const MenuTrigger = styled(Button)`\n  ${({ theme }) => css`\n    width: ${theme.gridUnit * 8}px;\n    height: ${theme.gridUnit * 8}px;\n    padding: 0;\n    border: 1px solid ${theme.colors.primary.dark2};\n\n    &.ant-btn > span.anticon {\n      line-height: 0;\n      transition: inherit;\n    }\n\n    &:hover:not(:focus) > span.anticon {\n      color: ${theme.colors.primary.light1};\n    }\n  `}\n`;\n\nexport const useExploreAdditionalActionsMenu = (\n  latestQueryFormData,\n  canDownloadCSV,\n  slice,\n  onOpenInEditor,\n  onOpenPropertiesModal,\n  ownState,\n) => {\n  const theme = useTheme();\n  const { addDangerToast, addSuccessToast } = useToasts();\n  const [showReportSubMenu, setShowReportSubMenu] = useState(null);\n  const [isDropdownVisible, setIsDropdownVisible] = useState(false);\n  const [openSubmenus, setOpenSubmenus] = useState([]);\n  const charts = useSelector(state => state.charts);\n  const chart = useMemo(() => {\n    if (!charts) {\n      return undefined;\n    }\n    const chartsValues = Object.values(charts);\n    if (chartsValues.length > 0) {\n      return chartsValues[0];\n    }\n    return undefined;\n  }, [charts]);\n\n  const { datasource } = latestQueryFormData;\n  const sqlSupported = datasource && datasource.split('__')[1] === 'table';\n\n  const shareByEmail = useCallback(async () => {\n    try {\n      const subject = t('Superset Chart');\n      const url = await getChartPermalink(latestQueryFormData);\n      const body = encodeURIComponent(t('%s%s', 'Check out this chart: ', url));\n      window.location.href = `mailto:?Subject=${subject}%20&Body=${body}`;\n    } catch (error) {\n      addDangerToast(t('Sorry, something went wrong. Try again later.'));\n    }\n  }, [addDangerToast, latestQueryFormData]);\n\n  const exportCSV = useCallback(\n    () =>\n      canDownloadCSV\n        ? exportChart({\n            formData: latestQueryFormData,\n            ownState,\n            resultType: 'full',\n            resultFormat: 'csv',\n          })\n        : null,\n    [canDownloadCSV, latestQueryFormData],\n  );\n\n  const exportCSVPivoted = useCallback(\n    () =>\n      canDownloadCSV\n        ? exportChart({\n            formData: latestQueryFormData,\n            resultType: 'post_processed',\n            resultFormat: 'csv',\n          })\n        : null,\n    [canDownloadCSV, latestQueryFormData],\n  );\n\n  const exportJson = useCallback(\n    () =>\n      exportChart({\n        formData: latestQueryFormData,\n        resultType: 'results',\n        resultFormat: 'json',\n      }),\n    [latestQueryFormData],\n  );\n\n  const copyLink = useCallback(async () => {\n    try {\n      if (!latestQueryFormData) {\n        throw new Error();\n      }\n      await copyTextToClipboard(() => getChartPermalink(latestQueryFormData));\n      addSuccessToast(t('Copied to clipboard!'));\n    } catch (error) {\n      addDangerToast(t('Sorry, something went wrong. Try again later.'));\n    }\n  }, [addDangerToast, addSuccessToast, latestQueryFormData]);\n\n  const handleMenuClick = useCallback(\n    ({ key, domEvent }) => {\n      switch (key) {\n        case MENU_KEYS.EDIT_PROPERTIES:\n          onOpenPropertiesModal();\n          setIsDropdownVisible(false);\n          break;\n        case MENU_KEYS.EXPORT_TO_CSV:\n          exportCSV();\n          setIsDropdownVisible(false);\n          setOpenSubmenus([]);\n          break;\n        case MENU_KEYS.EXPORT_TO_CSV_PIVOTED:\n          exportCSVPivoted();\n          setIsDropdownVisible(false);\n          setOpenSubmenus([]);\n          break;\n        case MENU_KEYS.EXPORT_TO_JSON:\n          exportJson();\n          setIsDropdownVisible(false);\n          setOpenSubmenus([]);\n\n          break;\n        case MENU_KEYS.DOWNLOAD_AS_IMAGE:\n          downloadAsImage(\n            '.panel-body .chart-container',\n            // eslint-disable-next-line camelcase\n            slice?.slice_name ?? t('New chart'),\n            true,\n          )(domEvent);\n          setIsDropdownVisible(false);\n          setOpenSubmenus([]);\n          break;\n        case MENU_KEYS.COPY_PERMALINK:\n          copyLink();\n          setIsDropdownVisible(false);\n          setOpenSubmenus([]);\n          break;\n        case MENU_KEYS.EMBED_CODE:\n          setIsDropdownVisible(false);\n          setOpenSubmenus([]);\n          break;\n        case MENU_KEYS.SHARE_BY_EMAIL:\n          shareByEmail();\n          setIsDropdownVisible(false);\n          setOpenSubmenus([]);\n          break;\n        case MENU_KEYS.VIEW_QUERY:\n          setIsDropdownVisible(false);\n          break;\n        case MENU_KEYS.RUN_IN_SQL_LAB:\n          onOpenInEditor(latestQueryFormData);\n          setIsDropdownVisible(false);\n          break;\n        default:\n          break;\n      }\n    },\n    [\n      copyLink,\n      exportCSV,\n      exportCSVPivoted,\n      exportJson,\n      latestQueryFormData,\n      onOpenInEditor,\n      onOpenPropertiesModal,\n      shareByEmail,\n      slice?.slice_name,\n    ],\n  );\n\n  const menu = useMemo(\n    () => (\n      <Menu\n        onClick={handleMenuClick}\n        selectable={false}\n        openKeys={openSubmenus}\n        onOpenChange={setOpenSubmenus}\n      >\n        {slice && (\n          <>\n            <Menu.Item key={MENU_KEYS.EDIT_PROPERTIES}>\n              {t('Edit chart properties')}\n            </Menu.Item>\n            <Menu.Divider />\n          </>\n        )}\n        <Menu.SubMenu title={t('Download')} key={MENU_KEYS.DOWNLOAD_SUBMENU}>\n          {VIZ_TYPES_PIVOTABLE.includes(latestQueryFormData.viz_type) ? (\n            <>\n              <Menu.Item\n                key={MENU_KEYS.EXPORT_TO_CSV}\n                icon={<FileOutlined />}\n                disabled={!canDownloadCSV}\n              >\n                {t('Export to original .CSV')}\n              </Menu.Item>\n              <Menu.Item\n                key={MENU_KEYS.EXPORT_TO_CSV_PIVOTED}\n                icon={<FileOutlined />}\n                disabled={!canDownloadCSV}\n              >\n                {t('Export to pivoted .CSV')}\n              </Menu.Item>\n            </>\n          ) : (\n            <Menu.Item\n              key={MENU_KEYS.EXPORT_TO_CSV}\n              icon={<FileOutlined />}\n              disabled={!canDownloadCSV}\n            >\n              {t('Export to .CSV')}\n            </Menu.Item>\n          )}\n          <Menu.Item key={MENU_KEYS.EXPORT_TO_JSON} icon={<FileOutlined />}>\n            {t('Export to .JSON')}\n          </Menu.Item>\n          <Menu.Item\n            key={MENU_KEYS.DOWNLOAD_AS_IMAGE}\n            icon={<FileImageOutlined />}\n          >\n            {t('Download as image')}\n          </Menu.Item>\n        </Menu.SubMenu>\n        <Menu.SubMenu title={t('Share')} key={MENU_KEYS.SHARE_SUBMENU}>\n          <Menu.Item key={MENU_KEYS.COPY_PERMALINK}>\n            {t('Copy permalink to clipboard')}\n          </Menu.Item>\n          <Menu.Item key={MENU_KEYS.SHARE_BY_EMAIL}>\n            {t('Share chart by email')}\n          </Menu.Item>\n          <Menu.Item key={MENU_KEYS.EMBED_CODE}>\n            <ModalTrigger\n              triggerNode={\n                <span data-test=\"embed-code-button\">{t('Embed code')}</span>\n              }\n              modalTitle={t('Embed code')}\n              modalBody={\n                <EmbedCodeContent\n                  formData={latestQueryFormData}\n                  addDangerToast={addDangerToast}\n                />\n              }\n              maxWidth={`${theme.gridUnit * 100}px`}\n              destroyOnClose\n              responsive\n            />\n          </Menu.Item>\n        </Menu.SubMenu>\n        <Menu.Divider />\n        {showReportSubMenu ? (\n          <>\n            <Menu.SubMenu title={t('Manage email report')}>\n              <HeaderReportDropDown\n                chart={chart}\n                setShowReportSubMenu={setShowReportSubMenu}\n                showReportSubMenu={showReportSubMenu}\n                setIsDropdownVisible={setIsDropdownVisible}\n                isDropdownVisible={isDropdownVisible}\n                useTextMenu\n              />\n            </Menu.SubMenu>\n            <Menu.Divider />\n          </>\n        ) : (\n          <Menu>\n            <HeaderReportDropDown\n              chart={chart}\n              setShowReportSubMenu={setShowReportSubMenu}\n              setIsDropdownVisible={setIsDropdownVisible}\n              isDropdownVisible={isDropdownVisible}\n              useTextMenu\n            />\n          </Menu>\n        )}\n        <Menu.Item key={MENU_KEYS.VIEW_QUERY}>\n          <ModalTrigger\n            triggerNode={\n              <span data-test=\"view-query-menu-item\">{t('View query')}</span>\n            }\n            modalTitle={t('View query')}\n            modalBody={\n              <ViewQueryModal latestQueryFormData={latestQueryFormData} />\n            }\n            draggable\n            resizable\n            responsive\n          />\n        </Menu.Item>\n        {sqlSupported && (\n          <Menu.Item key={MENU_KEYS.RUN_IN_SQL_LAB}>\n            {t('Run in SQL Lab')}\n          </Menu.Item>\n        )}\n      </Menu>\n    ),\n    [\n      addDangerToast,\n      canDownloadCSV,\n      chart,\n      handleMenuClick,\n      isDropdownVisible,\n      latestQueryFormData,\n      openSubmenus,\n      showReportSubMenu,\n      slice,\n      sqlSupported,\n      theme.gridUnit,\n    ],\n  );\n  return [menu, isDropdownVisible, setIsDropdownVisible];\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t, useTheme } from '@superset-ui/core';\nimport Icons, { IconType } from 'src/components/Icons';\nimport { Tooltip } from 'src/components/Tooltip';\n\nexport interface CertifiedBadgeProps {\n  certifiedBy?: string;\n  details?: string;\n  size?: IconType['iconSize'];\n}\n\nfunction CertifiedBadge({\n  certifiedBy,\n  details,\n  size = 'l',\n}: CertifiedBadgeProps) {\n  const theme = useTheme();\n\n  return (\n    <Tooltip\n      id=\"certified-details-tooltip\"\n      title={\n        <>\n          {certifiedBy && (\n            <div>\n              <strong>{t('Certified by %s', certifiedBy)}</strong>\n            </div>\n          )}\n          <div>{details}</div>\n        </>\n      }\n    >\n      <Icons.Certified iconColor={theme.colors.primary.base} iconSize={size} />\n    </Tooltip>\n  );\n}\n\nexport default CertifiedBadge;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { ConfigProvider } from 'antd';\nimport { styled, t } from '@superset-ui/core';\nimport ReactCronPicker, { Locale, CronProps } from 'react-js-cron';\n\nexport * from 'react-js-cron';\n\nexport const LOCALE: Locale = {\n  everyText: t('every'),\n  emptyMonths: t('every month'),\n  emptyMonthDays: t('every day of the month'),\n  emptyMonthDaysShort: t('day of the month'),\n  emptyWeekDays: t('every day of the week'),\n  emptyWeekDaysShort: t('day of the week'),\n  emptyHours: t('every hour'),\n  emptyMinutes: t('every minute'),\n  emptyMinutesForHourPeriod: t('every'),\n  yearOption: t('year'),\n  monthOption: t('month'),\n  weekOption: t('week'),\n  dayOption: t('day'),\n  hourOption: t('hour'),\n  minuteOption: t('minute'),\n  rebootOption: t('reboot'),\n  prefixPeriod: t('Every'),\n  prefixMonths: t('in'),\n  prefixMonthDays: t('on'),\n  prefixWeekDays: t('on'),\n  prefixWeekDaysForMonthAndYearPeriod: t('and'),\n  prefixHours: t('at'),\n  prefixMinutes: t(':'),\n  prefixMinutesForHourPeriod: t('at'),\n  suffixMinutesForHourPeriod: t('minute(s)'),\n  errorInvalidCron: t('Invalid cron expression'),\n  clearButtonText: t('Clear'),\n  weekDays: [\n    // Order is important, the index will be used as value\n    t('Sunday'), // Sunday must always be first, it's \"0\"\n    t('Monday'),\n    t('Tuesday'),\n    t('Wednesday'),\n    t('Thursday'),\n    t('Friday'),\n    t('Saturday'),\n  ],\n  months: [\n    // Order is important, the index will be used as value\n    t('January'),\n    t('February'),\n    t('March'),\n    t('April'),\n    t('May'),\n    t('June'),\n    t('July'),\n    t('August'),\n    t('September'),\n    t('October'),\n    t('November'),\n    t('December'),\n  ],\n  // Order is important, the index will be used as value\n  altWeekDays: [\n    t('SUN'), // Sunday must always be first, it's \"0\"\n    t('MON'),\n    t('TUE'),\n    t('WED'),\n    t('THU'),\n    t('FRI'),\n    t('SAT'),\n  ],\n  // Order is important, the index will be used as value\n  altMonths: [\n    t('JAN'),\n    t('FEB'),\n    t('MAR'),\n    t('APR'),\n    t('MAY'),\n    t('JUN'),\n    t('JUL'),\n    t('AUG'),\n    t('SEP'),\n    t('OCT'),\n    t('NOV'),\n    t('DEC'),\n  ],\n};\n\nexport const CronPicker = styled((props: CronProps) => (\n  <ConfigProvider\n    getPopupContainer={trigger => trigger.parentElement as HTMLElement}\n  >\n    <ReactCronPicker locale={LOCALE} {...props} />\n  </ConfigProvider>\n))`\n  .react-js-cron-select:not(.react-js-cron-custom-select) > div:first-of-type,\n  .react-js-cron-custom-select {\n    border-radius: ${({ theme }) => theme.gridUnit}px;\n    background-color: ${({ theme }) =>\n      theme.colors.grayscale.light4} !important;\n  }\n  .react-js-cron-custom-select > div:first-of-type {\n    border-radius: ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t, styled } from '@superset-ui/core';\nimport React, { useState } from 'react';\nimport { Input } from 'src/components/Input';\nimport Modal from 'src/components/Modal';\nimport { FormLabel } from 'src/components/Form';\n\nconst StyledDiv = styled.div`\n  padding-top: 8px;\n  width: 50%;\n  label {\n    color: ${({ theme }) => theme.colors.grayscale.base};\n    text-transform: uppercase;\n  }\n`;\n\nconst DescriptionContainer = styled.div`\n  line-height: 40px;\n  padding-top: 16px;\n`;\n\ninterface DeleteModalProps {\n  description: React.ReactNode;\n  onConfirm: () => void;\n  onHide: () => void;\n  open: boolean;\n  title: React.ReactNode;\n}\n\nexport default function DeleteModal({\n  description,\n  onConfirm,\n  onHide,\n  open,\n  title,\n}: DeleteModalProps) {\n  const [disableChange, setDisableChange] = useState(true);\n  const [confirmation, setConfirmation] = useState<string>('');\n\n  const hide = () => {\n    setConfirmation('');\n    onHide();\n  };\n\n  const confirm = () => {\n    setConfirmation('');\n    onConfirm();\n  };\n\n  const onChange = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const targetValue = event.target.value ?? '';\n    setDisableChange(targetValue.toUpperCase() !== t('DELETE'));\n    setConfirmation(targetValue);\n  };\n\n  const onPressEnter = () => {\n    if (!disableChange) {\n      confirm();\n    }\n  };\n\n  return (\n    <Modal\n      disablePrimaryButton={disableChange}\n      onHide={hide}\n      onHandledPrimaryAction={confirm}\n      primaryButtonName={t('delete')}\n      primaryButtonType=\"danger\"\n      show={open}\n      title={title}\n    >\n      <DescriptionContainer>{description}</DescriptionContainer>\n      <StyledDiv>\n        <FormLabel htmlFor=\"delete\">\n          {t('Type \"%s\" to confirm', t('DELETE'))}\n        </FormLabel>\n        <Input\n          data-test=\"delete-modal-input\"\n          type=\"text\"\n          id=\"delete\"\n          autoComplete=\"off\"\n          value={confirmation}\n          onChange={onChange}\n          onPressEnter={onPressEnter}\n        />\n      </StyledDiv>\n    </Modal>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { RefObject } from 'react';\nimport { AntdDropdown } from 'src/components';\nimport { DropDownProps } from 'antd/lib/dropdown';\nimport { styled } from '@superset-ui/core';\n\nconst MenuDots = styled.div`\n  width: ${({ theme }) => theme.gridUnit * 0.75}px;\n  height: ${({ theme }) => theme.gridUnit * 0.75}px;\n  border-radius: 50%;\n  background-color: ${({ theme }) => theme.colors.grayscale.light1};\n\n  font-weight: ${({ theme }) => theme.typography.weights.normal};\n  display: inline-flex;\n  position: relative;\n\n  &:hover {\n    background-color: ${({ theme }) => theme.colors.primary.base};\n\n    &::before,\n    &::after {\n      background-color: ${({ theme }) => theme.colors.primary.base};\n    }\n  }\n\n  &::before,\n  &::after {\n    position: absolute;\n    content: ' ';\n    width: ${({ theme }) => theme.gridUnit * 0.75}px;\n    height: ${({ theme }) => theme.gridUnit * 0.75}px;\n    border-radius: 50%;\n    background-color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n\n  &::before {\n    top: ${({ theme }) => theme.gridUnit}px;\n  }\n\n  &::after {\n    bottom: ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nconst MenuDotsWrapper = styled.div`\n  display: flex;\n  align-items: center;\n  padding: ${({ theme }) => theme.gridUnit * 2}px;\n  padding-left: ${({ theme }) => theme.gridUnit}px;\n`;\n\nexport interface DropdownProps {\n  overlay: React.ReactElement;\n}\n\nexport const Dropdown = ({ overlay, ...rest }: DropdownProps) => (\n  <AntdDropdown overlay={overlay} {...rest}>\n    <MenuDotsWrapper data-test=\"dropdown-trigger\">\n      <MenuDots />\n    </MenuDotsWrapper>\n  </AntdDropdown>\n);\n\ninterface ExtendedDropDownProps extends DropDownProps {\n  ref?: RefObject<HTMLDivElement>;\n}\n\n// @z-index-below-dashboard-header (100) - 1 = 99\nexport const NoAnimationDropdown = (\n  props: ExtendedDropDownProps & { children?: React.ReactNode },\n) => (\n  <AntdDropdown\n    overlayStyle={{ zIndex: 99, animationDuration: '0s' }}\n    {...props}\n  />\n);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { useCallback } from 'react';\nimport { css, t, styled } from '@superset-ui/core';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { useComponentDidMount } from 'src/hooks/useComponentDidMount';\nimport Icons from 'src/components/Icons';\n\nexport interface FaveStarProps {\n  itemId: number;\n  isStarred?: boolean;\n  showTooltip?: boolean;\n  saveFaveStar(id: number, isStarred: boolean): any;\n  fetchFaveStar?: (id: number) => void;\n}\n\nconst StyledLink = styled.a`\n  ${({ theme }) => css`\n    font-size: ${theme.typography.sizes.xl}px;\n    display: flex;\n    padding: 0 0 0 ${theme.gridUnit * 2}px;\n  `};\n`;\n\nconst FaveStar = ({\n  itemId,\n  isStarred,\n  showTooltip,\n  saveFaveStar,\n  fetchFaveStar,\n}: FaveStarProps) => {\n  useComponentDidMount(() => {\n    if (fetchFaveStar) {\n      fetchFaveStar(itemId);\n    }\n  });\n\n  const onClick = useCallback(\n    (e: React.MouseEvent) => {\n      e.preventDefault();\n      saveFaveStar(itemId, !!isStarred);\n    },\n    [isStarred, itemId, saveFaveStar],\n  );\n\n  const content = (\n    <StyledLink\n      href=\"#\"\n      onClick={onClick}\n      className=\"fave-unfave-icon\"\n      data-test=\"fave-unfave-icon\"\n      role=\"button\"\n    >\n      {isStarred ? <Icons.FavoriteSelected /> : <Icons.FavoriteUnselected />}\n    </StyledLink>\n  );\n\n  if (showTooltip) {\n    return (\n      <Tooltip\n        id=\"fave-unfave-tooltip\"\n        title={t('Click to favorite/unfavorite')}\n      >\n        {content}\n      </Tooltip>\n    );\n  }\n\n  return content;\n};\nexport default FaveStar;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, {\n  ChangeEvent,\n  KeyboardEvent,\n  useCallback,\n  useEffect,\n  useLayoutEffect,\n  useRef,\n  useState,\n} from 'react';\nimport { css, SupersetTheme, t } from '@superset-ui/core';\nimport { Tooltip } from 'src/components/Tooltip';\nimport { useResizeDetector } from 'react-resize-detector';\n\nexport type DynamicEditableTitleProps = {\n  title: string;\n  placeholder: string;\n  onSave: (title: string) => void;\n  canEdit: boolean;\n  label: string | undefined;\n};\n\nconst titleStyles = (theme: SupersetTheme) => css`\n  display: flex;\n  font-size: ${theme.typography.sizes.xl}px;\n  font-weight: ${theme.typography.weights.bold};\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n\n  & .dynamic-title,\n  & .dynamic-title-input {\n    display: inline-block;\n    max-width: 100%;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n  }\n\n  & .dynamic-title {\n    cursor: default;\n  }\n  & .dynamic-title-input {\n    border: none;\n    padding: 0;\n    outline: none;\n\n    &::placeholder {\n      color: ${theme.colors.grayscale.light1};\n    }\n  }\n\n  & .input-sizer {\n    position: absolute;\n    left: -9999px;\n    display: inline-block;\n  }\n`;\n\nexport const DynamicEditableTitle = ({\n  title,\n  placeholder,\n  onSave,\n  canEdit,\n  label,\n}: DynamicEditableTitleProps) => {\n  const [isEditing, setIsEditing] = useState(false);\n  const [currentTitle, setCurrentTitle] = useState(title || '');\n  const contentRef = useRef<HTMLInputElement>(null);\n  const [showTooltip, setShowTooltip] = useState(false);\n\n  const { width: inputWidth, ref: sizerRef } = useResizeDetector();\n  const { width: containerWidth, ref: containerRef } = useResizeDetector({\n    refreshMode: 'debounce',\n  });\n\n  useEffect(() => {\n    setCurrentTitle(title);\n  }, [title]);\n\n  useEffect(() => {\n    if (isEditing && contentRef?.current) {\n      contentRef.current.focus();\n      // move cursor and scroll to the end\n      if (contentRef.current.setSelectionRange) {\n        const { length } = contentRef.current.value;\n        contentRef.current.setSelectionRange(length, length);\n        contentRef.current.scrollLeft = contentRef.current.scrollWidth;\n      }\n    }\n  }, [isEditing]);\n\n  // a trick to make the input grow when user types text\n  // we make additional span component, place it somewhere out of view and copy input\n  // then we can measure the width of that span to resize the input element\n  useLayoutEffect(() => {\n    if (sizerRef?.current) {\n      sizerRef.current.innerHTML = (currentTitle || placeholder).replace(\n        /\\s/g,\n        '&nbsp;',\n      );\n    }\n  }, [currentTitle, placeholder, sizerRef]);\n\n  useEffect(() => {\n    if (\n      contentRef.current &&\n      contentRef.current.scrollWidth > contentRef.current.clientWidth\n    ) {\n      setShowTooltip(true);\n    } else {\n      setShowTooltip(false);\n    }\n  }, [inputWidth, containerWidth]);\n\n  const handleClick = useCallback(() => {\n    if (!canEdit || isEditing) {\n      return;\n    }\n    setIsEditing(true);\n  }, [canEdit, isEditing]);\n\n  const handleBlur = useCallback(() => {\n    if (!canEdit) {\n      return;\n    }\n    const formattedTitle = currentTitle.trim();\n    setCurrentTitle(formattedTitle);\n    if (title !== formattedTitle) {\n      onSave(formattedTitle);\n    }\n    setIsEditing(false);\n  }, [canEdit, currentTitle, onSave, title]);\n\n  const handleChange = useCallback(\n    (ev: ChangeEvent<HTMLInputElement>) => {\n      if (!canEdit || !isEditing) {\n        return;\n      }\n      setCurrentTitle(ev.target.value);\n    },\n    [canEdit, isEditing],\n  );\n\n  const handleKeyPress = useCallback(\n    (ev: KeyboardEvent<HTMLInputElement>) => {\n      if (!canEdit) {\n        return;\n      }\n      if (ev.key === 'Enter') {\n        ev.preventDefault();\n        contentRef.current?.blur();\n      }\n    },\n    [canEdit],\n  );\n\n  return (\n    <div css={titleStyles} ref={containerRef}>\n      <Tooltip\n        id=\"title-tooltip\"\n        title={showTooltip && currentTitle && !isEditing ? currentTitle : null}\n      >\n        {canEdit ? (\n          <input\n            data-test=\"editable-title-input\"\n            className=\"dynamic-title-input\"\n            aria-label={label ?? t('Title')}\n            ref={contentRef}\n            onChange={handleChange}\n            onBlur={handleBlur}\n            onClick={handleClick}\n            onKeyPress={handleKeyPress}\n            placeholder={placeholder}\n            value={currentTitle}\n            css={css`\n              cursor: ${isEditing ? 'text' : 'pointer'};\n\n              ${inputWidth &&\n              inputWidth > 0 &&\n              css`\n                width: ${inputWidth}px;\n              `}\n            `}\n          />\n        ) : (\n          <span\n            className=\"dynamic-title\"\n            aria-label={label ?? t('Title')}\n            ref={contentRef}\n            data-test=\"editable-title\"\n          >\n            {currentTitle}\n          </span>\n        )}\n      </Tooltip>\n      <span ref={sizerRef} className=\"input-sizer\" aria-hidden tabIndex={-1} />\n    </div>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { ReactNode, ReactElement } from 'react';\nimport { css, SupersetTheme, t, useTheme } from '@superset-ui/core';\nimport { AntdDropdown, AntdDropdownProps } from 'src/components';\nimport {\n  DynamicEditableTitle,\n  DynamicEditableTitleProps,\n} from '../DynamicEditableTitle';\nimport CertifiedBadge, { CertifiedBadgeProps } from '../CertifiedBadge';\nimport FaveStar, { FaveStarProps } from '../FaveStar';\nimport Icons from '../Icons';\nimport Button from '../Button';\n\nexport const menuTriggerStyles = (theme: SupersetTheme) => css`\n  width: ${theme.gridUnit * 8}px;\n  height: ${theme.gridUnit * 8}px;\n  padding: 0;\n  border: 1px solid ${theme.colors.primary.dark2};\n\n  &.ant-btn > span.anticon {\n    line-height: 0;\n    transition: inherit;\n  }\n\n  &:hover:not(:focus) > span.anticon {\n    color: ${theme.colors.primary.light1};\n  }\n`;\n\nconst headerStyles = (theme: SupersetTheme) => css`\n  display: flex;\n  flex-direction: row;\n  align-items: center;\n  flex-wrap: nowrap;\n  justify-content: space-between;\n  background-color: ${theme.colors.grayscale.light5};\n  height: ${theme.gridUnit * 16}px;\n  padding: 0 ${theme.gridUnit * 4}px;\n\n  .editable-title {\n    overflow: hidden;\n\n    & > input[type='button'],\n    & > span {\n      overflow: hidden;\n      text-overflow: ellipsis;\n      max-width: 100%;\n      white-space: nowrap;\n    }\n  }\n\n  span[role='button'] {\n    display: flex;\n    height: 100%;\n  }\n\n  .title-panel {\n    display: flex;\n    align-items: center;\n    min-width: 0;\n    margin-right: ${theme.gridUnit * 12}px;\n  }\n\n  .right-button-panel {\n    display: flex;\n    align-items: center;\n  }\n`;\n\nconst buttonsStyles = (theme: SupersetTheme) => css`\n  display: flex;\n  align-items: center;\n  padding-left: ${theme.gridUnit * 2}px;\n\n  & .fave-unfave-icon {\n    padding: 0 ${theme.gridUnit}px;\n\n    &:first-child {\n      padding-left: 0;\n    }\n  }\n`;\n\nconst additionalActionsContainerStyles = (theme: SupersetTheme) => css`\n  margin-left: ${theme.gridUnit * 2}px;\n`;\n\nexport type PageHeaderWithActionsProps = {\n  editableTitleProps: DynamicEditableTitleProps;\n  showTitlePanelItems: boolean;\n  certificatiedBadgeProps?: CertifiedBadgeProps;\n  showFaveStar: boolean;\n  faveStarProps: FaveStarProps;\n  titlePanelAdditionalItems: ReactNode;\n  rightPanelAdditionalItems: ReactNode;\n  additionalActionsMenu: ReactElement;\n  menuDropdownProps: Omit<AntdDropdownProps, 'overlay'>;\n};\n\nexport const PageHeaderWithActions = ({\n  editableTitleProps,\n  showTitlePanelItems,\n  certificatiedBadgeProps,\n  showFaveStar,\n  faveStarProps,\n  titlePanelAdditionalItems,\n  rightPanelAdditionalItems,\n  additionalActionsMenu,\n  menuDropdownProps,\n}: PageHeaderWithActionsProps) => {\n  const theme = useTheme();\n  return (\n    <div css={headerStyles} className=\"header-with-actions\">\n      <div className=\"title-panel\">\n        <DynamicEditableTitle {...editableTitleProps} />\n        {showTitlePanelItems && (\n          <div css={buttonsStyles}>\n            {certificatiedBadgeProps?.certifiedBy && (\n              <CertifiedBadge {...certificatiedBadgeProps} />\n            )}\n            {showFaveStar && <FaveStar {...faveStarProps} />}\n            {titlePanelAdditionalItems}\n          </div>\n        )}\n      </div>\n      <div className=\"right-button-panel\">\n        {rightPanelAdditionalItems}\n        <div css={additionalActionsContainerStyles}>\n          <AntdDropdown\n            trigger={['click']}\n            overlay={additionalActionsMenu}\n            {...menuDropdownProps}\n          >\n            <Button\n              css={menuTriggerStyles}\n              buttonStyle=\"tertiary\"\n              aria-label={t('Menu actions trigger')}\n            >\n              <Icons.MoreHoriz\n                iconColor={theme.colors.primary.dark2}\n                iconSize=\"l\"\n              />\n            </Button>\n          </AntdDropdown>\n        </div>\n      </div>\n    </div>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/**\n * Types mirroring enums in `superset/reports/models.py`:\n */\nexport type ReportScheduleType = 'Alert' | 'Report';\nexport type ReportCreationMethod = 'charts' | 'dashboards' | 'alerts_reports';\n\nexport type ReportRecipientType = 'Email' | 'Slack';\n\nexport enum ReportType {\n  DASHBOARDS = 'dashboards',\n  CHARTS = 'charts',\n}\n\nexport enum NOTIFICATION_FORMATS {\n  TEXT = 'TEXT',\n  PNG = 'PNG',\n  CSV = 'CSV',\n}\nexport interface ReportObject {\n  id?: number;\n  active: boolean;\n  crontab: string;\n  dashboard?: number;\n  chart?: number;\n  description?: string;\n  log_retention: number;\n  name: string;\n  owners: number[];\n  recipients: [\n    { recipient_config_json: { target: string }; type: ReportRecipientType },\n  ];\n  report_format: string;\n  timezone: string;\n  type: ReportScheduleType;\n  validator_config_json: {} | null;\n  validator_type: string;\n  working_timeout: number;\n  creation_method: string;\n  force_screenshot: boolean;\n  error?: string;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { styled, css, SupersetTheme } from '@superset-ui/core';\nimport Modal from 'src/components/Modal';\nimport Button from 'src/components/Button';\nimport { Radio } from 'src/components/Radio';\nimport { CronPicker } from 'src/components/CronPicker';\n\nexport const StyledModal = styled(Modal)`\n  .ant-modal-body {\n    padding: 0;\n  }\n`;\n\nexport const StyledTopSection = styled.div`\n  padding: ${({ theme }) =>\n    `${theme.gridUnit * 3}px ${theme.gridUnit * 4}px ${theme.gridUnit * 2}px`};\n  label {\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\n\nexport const StyledBottomSection = styled.div`\n  border-top: 1px solid ${({ theme }) => theme.colors.grayscale.light2};\n  padding: ${({ theme }) =>\n    `${theme.gridUnit * 4}px ${theme.gridUnit * 4}px ${theme.gridUnit * 6}px`};\n  .ant-select {\n    width: 100%;\n  }\n  .control-label {\n    font-size: ${({ theme }) => theme.typography.sizes.s}px;\n    color: ${({ theme }) => theme.colors.grayscale.light1};\n  }\n`;\n\nexport const StyledIconWrapper = styled.span`\n  span {\n    margin-right: ${({ theme }) => theme.gridUnit * 2}px;\n    vertical-align: middle;\n  }\n  .text {\n    vertical-align: middle;\n  }\n`;\n\nexport const StyledScheduleTitle = styled.div`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 7}px;\n\n  h4 {\n    margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n  }\n`;\n\nexport const StyledCronPicker = styled(CronPicker)`\n  margin-bottom: ${({ theme }) => theme.gridUnit * 3}px;\n  width: ${({ theme }) => theme.gridUnit * 120}px;\n`;\n\nexport const StyledCronError = styled.p`\n  color: ${({ theme }) => theme.colors.error.base};\n`;\n\nexport const noBottomMargin = css`\n  margin-bottom: 0;\n`;\n\nexport const StyledFooterButton = styled(Button)`\n  width: ${({ theme }) => theme.gridUnit * 40}px;\n`;\n\nexport const TimezoneHeaderStyle = (theme: SupersetTheme) => css`\n  margin: ${theme.gridUnit * 3}px 0 ${theme.gridUnit * 2}px;\n`;\n\nexport const SectionHeaderStyle = (theme: SupersetTheme) => css`\n  margin: ${theme.gridUnit * 3}px 0;\n`;\n\nexport const StyledMessageContentTitle = styled.div`\n  margin: ${({ theme }) => theme.gridUnit * 8}px 0\n    ${({ theme }) => theme.gridUnit * 4}px;\n`;\n\nexport const StyledRadio = styled(Radio)`\n  display: block;\n  line-height: ${({ theme }) => theme.gridUnit * 8}px;\n`;\n\nexport const StyledRadioGroup = styled(Radio.Group)`\n  margin-left: ${({ theme }) => theme.gridUnit * 0.5}px;\n`;\n\nexport const antDErrorAlertStyles = (theme: SupersetTheme) => css`\n  border: ${theme.colors.error.base} 1px solid;\n  padding: ${theme.gridUnit * 4}px;\n  margin: ${theme.gridUnit * 4}px;\n  margin-top: 0;\n  color: ${theme.colors.error.dark2};\n  .ant-alert-message {\n    font-size: ${theme.typography.sizes.m}px;\n    font-weight: bold;\n  }\n  .ant-alert-description {\n    font-size: ${theme.typography.sizes.m}px;\n    line-height: ${theme.gridUnit * 4}px;\n    .ant-alert-icon {\n      margin-right: ${theme.gridUnit * 2.5}px;\n      font-size: ${theme.typography.sizes.l}px;\n      position: relative;\n      top: ${theme.gridUnit / 4}px;\n    }\n  }\n`;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useState,\n  useEffect,\n  useReducer,\n  useCallback,\n  useMemo,\n} from 'react';\nimport { t, SupersetTheme } from '@superset-ui/core';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { addReport, editReport } from 'src/reports/actions/reports';\nimport Alert from 'src/components/Alert';\nimport TimezoneSelector from 'src/components/TimezoneSelector';\nimport LabeledErrorBoundInput from 'src/components/Form/LabeledErrorBoundInput';\nimport Icons from 'src/components/Icons';\nimport { CronError } from 'src/components/CronPicker';\nimport { RadioChangeEvent } from 'src/components';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { ChartState } from 'src/explore/types';\nimport {\n  ReportCreationMethod,\n  ReportObject,\n  NOTIFICATION_FORMATS,\n} from 'src/reports/types';\nimport { reportSelector } from 'src/views/CRUD/hooks';\nimport { CreationMethod } from './HeaderReportDropdown';\nimport {\n  antDErrorAlertStyles,\n  StyledModal,\n  StyledTopSection,\n  StyledBottomSection,\n  StyledIconWrapper,\n  StyledScheduleTitle,\n  StyledCronPicker,\n  StyledCronError,\n  noBottomMargin,\n  StyledFooterButton,\n  TimezoneHeaderStyle,\n  SectionHeaderStyle,\n  StyledMessageContentTitle,\n  StyledRadio,\n  StyledRadioGroup,\n} from './styles';\n\ninterface ReportProps {\n  onHide: () => {};\n  addDangerToast: (msg: string) => void;\n  show: boolean;\n  userId: number;\n  userEmail: string;\n  chart?: ChartState;\n  chartName?: string;\n  dashboardId?: number;\n  dashboardName?: string;\n  creationMethod: ReportCreationMethod;\n  props: any;\n}\n\nconst TEXT_BASED_VISUALIZATION_TYPES = [\n  'pivot_table',\n  'pivot_table_v2',\n  'table',\n  'paired_ttest',\n];\n\nconst INITIAL_STATE = {\n  crontab: '0 12 * * 1',\n};\n\ntype ReportObjectState = Partial<ReportObject> & {\n  error?: string;\n  /**\n   * Is submitting changes to the backend.\n   */\n  isSubmitting?: boolean;\n};\n\nfunction ReportModal({\n  onHide,\n  show = false,\n  dashboardId,\n  chart,\n  userId,\n  userEmail,\n  creationMethod,\n  dashboardName,\n  chartName,\n}: ReportProps) {\n  const vizType = chart?.sliceFormData?.viz_type;\n  const isChart = !!chart;\n  const isTextBasedChart =\n    isChart && vizType && TEXT_BASED_VISUALIZATION_TYPES.includes(vizType);\n  const defaultNotificationFormat = isTextBasedChart\n    ? NOTIFICATION_FORMATS.TEXT\n    : NOTIFICATION_FORMATS.PNG;\n  const entityName = dashboardName || chartName;\n  const initialState: ReportObjectState = useMemo(\n    () => ({\n      ...INITIAL_STATE,\n      name: entityName\n        ? t('Weekly Report for %s', entityName)\n        : t('Weekly Report'),\n    }),\n    [entityName],\n  );\n\n  const reportReducer = useCallback(\n    (state: ReportObjectState | null, action: 'reset' | ReportObjectState) => {\n      if (action === 'reset') {\n        return initialState;\n      }\n      return {\n        ...state,\n        ...action,\n      };\n    },\n    [initialState],\n  );\n\n  const [currentReport, setCurrentReport] = useReducer(\n    reportReducer,\n    initialState,\n  );\n  const [cronError, setCronError] = useState<CronError>();\n\n  const dispatch = useDispatch();\n  // Report fetch logic\n  const report = useSelector<any, ReportObject>(state => {\n    const resourceType = dashboardId\n      ? CreationMethod.DASHBOARDS\n      : CreationMethod.CHARTS;\n    return reportSelector(state, resourceType, dashboardId || chart?.id);\n  });\n  const isEditMode = report && Object.keys(report).length;\n\n  useEffect(() => {\n    if (isEditMode) {\n      setCurrentReport(report);\n    } else {\n      setCurrentReport('reset');\n    }\n  }, [isEditMode, report]);\n\n  const onSave = async () => {\n    // Create new Report\n    const newReportValues: Partial<ReportObject> = {\n      type: 'Report',\n      active: true,\n      force_screenshot: false,\n      creation_method: creationMethod,\n      dashboard: dashboardId,\n      chart: chart?.id,\n      owners: [userId],\n      recipients: [\n        {\n          recipient_config_json: { target: userEmail },\n          type: 'Email',\n        },\n      ],\n      name: currentReport.name,\n      description: currentReport.description,\n      crontab: currentReport.crontab,\n      report_format: currentReport.report_format || defaultNotificationFormat,\n      timezone: currentReport.timezone,\n    };\n\n    setCurrentReport({ isSubmitting: true, error: undefined });\n    try {\n      if (isEditMode) {\n        await dispatch(\n          editReport(currentReport.id, newReportValues as ReportObject),\n        );\n      } else {\n        await dispatch(addReport(newReportValues as ReportObject));\n      }\n      onHide();\n    } catch (e) {\n      const { error } = await getClientErrorObject(e);\n      setCurrentReport({ error });\n    }\n    setCurrentReport({ isSubmitting: false });\n  };\n\n  const wrappedTitle = (\n    <StyledIconWrapper>\n      <Icons.Calendar />\n      <span className=\"text\">\n        {isEditMode ? t('Edit email report') : t('Schedule a new email report')}\n      </span>\n    </StyledIconWrapper>\n  );\n\n  const renderModalFooter = (\n    <>\n      <StyledFooterButton key=\"back\" onClick={onHide}>\n        {t('Cancel')}\n      </StyledFooterButton>\n      <StyledFooterButton\n        key=\"submit\"\n        buttonStyle=\"primary\"\n        onClick={onSave}\n        disabled={!currentReport.name}\n        loading={currentReport.isSubmitting}\n      >\n        {isEditMode ? t('Save') : t('Add')}\n      </StyledFooterButton>\n    </>\n  );\n\n  const renderMessageContentSection = (\n    <>\n      <StyledMessageContentTitle>\n        <h4>{t('Message content')}</h4>\n      </StyledMessageContentTitle>\n      <div className=\"inline-container\">\n        <StyledRadioGroup\n          onChange={(event: RadioChangeEvent) => {\n            setCurrentReport({ report_format: event.target.value });\n          }}\n          value={currentReport.report_format || defaultNotificationFormat}\n        >\n          {isTextBasedChart && (\n            <StyledRadio value={NOTIFICATION_FORMATS.TEXT}>\n              {t('Text embedded in email')}\n            </StyledRadio>\n          )}\n          <StyledRadio value={NOTIFICATION_FORMATS.PNG}>\n            {t('Image (PNG) embedded in email')}\n          </StyledRadio>\n          <StyledRadio value={NOTIFICATION_FORMATS.CSV}>\n            {t('Formatted CSV attached in email')}\n          </StyledRadio>\n        </StyledRadioGroup>\n      </div>\n    </>\n  );\n\n  return (\n    <StyledModal\n      show={show}\n      onHide={onHide}\n      title={wrappedTitle}\n      footer={renderModalFooter}\n      width=\"432\"\n      centered\n    >\n      <StyledTopSection>\n        <LabeledErrorBoundInput\n          id=\"name\"\n          name=\"name\"\n          value={currentReport.name || ''}\n          placeholder={initialState.name}\n          required\n          validationMethods={{\n            onChange: ({ target }: { target: HTMLInputElement }) =>\n              setCurrentReport({ name: target.value }),\n          }}\n          label=\"Report Name\"\n          data-test=\"report-name-test\"\n        />\n        <LabeledErrorBoundInput\n          id=\"description\"\n          name=\"description\"\n          value={currentReport?.description || ''}\n          validationMethods={{\n            onChange: ({ target }: { target: HTMLInputElement }) => {\n              setCurrentReport({ description: target.value });\n            },\n          }}\n          label={t('Description')}\n          placeholder={t(\n            'Include a description that will be sent with your report',\n          )}\n          css={noBottomMargin}\n          data-test=\"report-description-test\"\n        />\n      </StyledTopSection>\n\n      <StyledBottomSection>\n        <StyledScheduleTitle>\n          <h4 css={(theme: SupersetTheme) => SectionHeaderStyle(theme)}>\n            {t('Schedule')}\n          </h4>\n          <p>\n            {t('A screenshot of the dashboard will be sent to your email at')}\n          </p>\n        </StyledScheduleTitle>\n\n        <StyledCronPicker\n          clearButton={false}\n          value={currentReport.crontab || '0 12 * * 1'}\n          setValue={(newValue: string) => {\n            setCurrentReport({ crontab: newValue });\n          }}\n          onError={setCronError}\n        />\n        <StyledCronError>{cronError}</StyledCronError>\n        <div\n          className=\"control-label\"\n          css={(theme: SupersetTheme) => TimezoneHeaderStyle(theme)}\n        >\n          {t('Timezone')}\n        </div>\n        <TimezoneSelector\n          timezone={currentReport.timezone}\n          onTimezoneChange={value => {\n            setCurrentReport({ timezone: value });\n          }}\n        />\n        {isChart && renderMessageContentSection}\n      </StyledBottomSection>\n      {currentReport.error && (\n        <Alert\n          type=\"error\"\n          css={(theme: SupersetTheme) => antDErrorAlertStyles(theme)}\n          message={\n            isEditMode\n              ? t('Failed to update report')\n              : t('Failed to create report')\n          }\n          description={currentReport.error}\n        />\n      )}\n    </StyledModal>\n  );\n}\n\nexport default withToasts(ReportModal);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect } from 'react';\nimport { usePrevious } from 'src/hooks/usePrevious';\nimport { useSelector, useDispatch } from 'react-redux';\nimport {\n  t,\n  SupersetTheme,\n  css,\n  useTheme,\n  FeatureFlag,\n  isFeatureEnabled,\n} from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport { Switch } from 'src/components/Switch';\nimport { AlertObject } from 'src/views/CRUD/alert/types';\nimport { Menu } from 'src/components/Menu';\nimport Checkbox from 'src/components/Checkbox';\nimport { noOp } from 'src/utils/common';\nimport { NoAnimationDropdown } from 'src/components/Dropdown';\nimport DeleteModal from 'src/components/DeleteModal';\nimport ReportModal from 'src/components/ReportModal';\nimport { ChartState } from 'src/explore/types';\nimport { UserWithPermissionsAndRoles } from 'src/types/bootstrapTypes';\nimport {\n  fetchUISpecificReport,\n  toggleActive,\n  deleteActiveReport,\n} from 'src/reports/actions/reports';\nimport { reportSelector } from 'src/views/CRUD/hooks';\nimport { MenuItemWithCheckboxContainer } from 'src/explore/components/useExploreAdditionalActionsMenu/index';\n\nconst deleteColor = (theme: SupersetTheme) => css`\n  color: ${theme.colors.error.base};\n`;\n\nconst onMenuHover = (theme: SupersetTheme) => css`\n  & .ant-menu-item {\n    padding: 5px 12px;\n    margin-top: 0px;\n    margin-bottom: 4px;\n    :hover {\n      color: ${theme.colors.grayscale.dark1};\n    }\n  }\n  :hover {\n    background-color: ${theme.colors.secondary.light5};\n  }\n`;\n\nconst onMenuItemHover = (theme: SupersetTheme) => css`\n  &:hover {\n    color: ${theme.colors.grayscale.dark1};\n    background-color: ${theme.colors.secondary.light5};\n  }\n`;\nexport enum CreationMethod {\n  CHARTS = 'charts',\n  DASHBOARDS = 'dashboards',\n}\nexport interface HeaderReportProps {\n  dashboardId?: number;\n  chart?: ChartState;\n  useTextMenu?: boolean;\n  setShowReportSubMenu?: (show: boolean) => void;\n  setIsDropdownVisible?: (visible: boolean) => void;\n  isDropdownVisible?: boolean;\n  showReportSubMenu?: boolean;\n}\n\nexport default function HeaderReportDropDown({\n  dashboardId,\n  chart,\n  useTextMenu = false,\n  setShowReportSubMenu,\n  setIsDropdownVisible,\n  isDropdownVisible,\n}: HeaderReportProps) {\n  const dispatch = useDispatch();\n  const report = useSelector<any, AlertObject>(state => {\n    const resourceType = dashboardId\n      ? CreationMethod.DASHBOARDS\n      : CreationMethod.CHARTS;\n    return reportSelector(state, resourceType, dashboardId || chart?.id);\n  });\n\n  const isReportActive: boolean = report?.active || false;\n  const user: UserWithPermissionsAndRoles = useSelector<\n    any,\n    UserWithPermissionsAndRoles\n  >(state => state.user || state.explore?.user);\n  const canAddReports = () => {\n    if (!isFeatureEnabled(FeatureFlag.ALERT_REPORTS)) {\n      return false;\n    }\n\n    if (!user?.userId) {\n      // this is in the case that there is an anonymous user.\n      return false;\n    }\n    const roles = Object.keys(user.roles || []);\n    const permissions = roles.map(key =>\n      user.roles[key].filter(\n        perms => perms[0] === 'menu_access' && perms[1] === 'Manage',\n      ),\n    );\n    return permissions[0].length > 0;\n  };\n\n  const [currentReportDeleting, setCurrentReportDeleting] =\n    useState<AlertObject | null>(null);\n  const theme = useTheme();\n  const prevDashboard = usePrevious(dashboardId);\n  const [showModal, setShowModal] = useState<boolean>(false);\n  const toggleActiveKey = async (data: AlertObject, checked: boolean) => {\n    if (data?.id) {\n      dispatch(toggleActive(data, checked));\n    }\n  };\n\n  const handleReportDelete = async (report: AlertObject) => {\n    await dispatch(deleteActiveReport(report));\n    setCurrentReportDeleting(null);\n  };\n\n  const shouldFetch =\n    canAddReports() &&\n    !!((dashboardId && prevDashboard !== dashboardId) || chart?.id);\n\n  useEffect(() => {\n    if (shouldFetch) {\n      dispatch(\n        fetchUISpecificReport({\n          userId: user.userId,\n          filterField: dashboardId ? 'dashboard_id' : 'chart_id',\n          creationMethod: dashboardId ? 'dashboards' : 'charts',\n          resourceId: dashboardId || chart?.id,\n        }),\n      );\n    }\n  }, []);\n\n  const showReportSubMenu = report && setShowReportSubMenu && canAddReports();\n\n  useEffect(() => {\n    if (showReportSubMenu) {\n      setShowReportSubMenu(true);\n    } else if (!report && setShowReportSubMenu) {\n      setShowReportSubMenu(false);\n    }\n  }, [report]);\n\n  const handleShowMenu = () => {\n    if (setIsDropdownVisible) {\n      setIsDropdownVisible(false);\n      setShowModal(true);\n    }\n  };\n\n  const handleDeleteMenuClick = () => {\n    if (setIsDropdownVisible) {\n      setIsDropdownVisible(false);\n      setCurrentReportDeleting(report);\n    }\n  };\n\n  const textMenu = () =>\n    report ? (\n      isDropdownVisible && (\n        <Menu selectable={false} css={{ border: 'none' }}>\n          <Menu.Item\n            css={onMenuItemHover}\n            onClick={() => toggleActiveKey(report, !isReportActive)}\n          >\n            <MenuItemWithCheckboxContainer>\n              <Checkbox checked={isReportActive} onChange={noOp} />\n              {t('Email reports active')}\n            </MenuItemWithCheckboxContainer>\n          </Menu.Item>\n          <Menu.Item css={onMenuItemHover} onClick={handleShowMenu}>\n            {t('Edit email report')}\n          </Menu.Item>\n          <Menu.Item css={onMenuItemHover} onClick={handleDeleteMenuClick}>\n            {t('Delete email report')}\n          </Menu.Item>\n        </Menu>\n      )\n    ) : (\n      <Menu selectable={false} css={onMenuHover}>\n        <Menu.Item onClick={handleShowMenu}>\n          {t('Set up an email report')}\n        </Menu.Item>\n        <Menu.Divider />\n      </Menu>\n    );\n  const menu = () => (\n    <Menu selectable={false} css={{ width: '200px' }}>\n      <Menu.Item>\n        {t('Email reports active')}\n        <Switch\n          data-test=\"toggle-active\"\n          checked={isReportActive}\n          onClick={(checked: boolean) => toggleActiveKey(report, checked)}\n          size=\"small\"\n          css={{ marginLeft: theme.gridUnit * 2 }}\n        />\n      </Menu.Item>\n      <Menu.Item onClick={() => setShowModal(true)}>\n        {t('Edit email report')}\n      </Menu.Item>\n      <Menu.Item\n        onClick={() => setCurrentReportDeleting(report)}\n        css={deleteColor}\n      >\n        {t('Delete email report')}\n      </Menu.Item>\n    </Menu>\n  );\n\n  const iconMenu = () =>\n    report ? (\n      <>\n        <NoAnimationDropdown\n          overlay={menu()}\n          trigger={['click']}\n          getPopupContainer={(triggerNode: any) =>\n            triggerNode.closest('.action-button')\n          }\n        >\n          <span\n            role=\"button\"\n            className=\"action-button action-schedule-report\"\n            tabIndex={0}\n          >\n            <Icons.Calendar />\n          </span>\n        </NoAnimationDropdown>\n      </>\n    ) : (\n      <span\n        role=\"button\"\n        title={t('Schedule email report')}\n        tabIndex={0}\n        className=\"action-button action-schedule-report\"\n        onClick={() => setShowModal(true)}\n      >\n        <Icons.Calendar />\n      </span>\n    );\n\n  return (\n    <>\n      {canAddReports() && (\n        <>\n          <ReportModal\n            userId={user.userId}\n            show={showModal}\n            onHide={() => setShowModal(false)}\n            userEmail={user.email}\n            dashboardId={dashboardId}\n            chart={chart}\n            creationMethod={\n              dashboardId ? CreationMethod.DASHBOARDS : CreationMethod.CHARTS\n            }\n          />\n          {useTextMenu ? textMenu() : iconMenu()}\n          {currentReportDeleting && (\n            <DeleteModal\n              description={t(\n                'This action will permanently delete %s.',\n                currentReportDeleting?.name,\n              )}\n              onConfirm={() => {\n                if (currentReportDeleting) {\n                  handleReportDelete(currentReportDeleting);\n                }\n              }}\n              onHide={() => setCurrentReportDeleting(null)}\n              open\n              title={t('Delete Report?')}\n            />\n          )}\n        </>\n      )}\n    </>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { styled } from '@superset-ui/core';\nimport BaseSwitch, { SwitchProps } from 'antd/lib/switch';\n\nconst StyledSwitch = styled(BaseSwitch)`\n  .ant-switch-checked {\n    background-color: ${({ theme }) => theme.colors.primary.base};\n  }\n`;\n\nexport const Switch = (props: SwitchProps) => <StyledSwitch {...props} />;\nexport type { SwitchProps };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport React, { useEffect, useMemo } from 'react';\nimport moment from 'moment-timezone';\nimport { t } from '@superset-ui/core';\nimport { Select } from 'src/components';\n\nconst DEFAULT_TIMEZONE = {\n  name: 'GMT Standard Time',\n  value: 'Africa/Abidjan', // timezones are deduped by the first alphabetical value\n};\n\nconst MIN_SELECT_WIDTH = '400px';\n\nconst offsetsToName = {\n  '-300-240': ['Eastern Standard Time', 'Eastern Daylight Time'],\n  '-360-300': ['Central Standard Time', 'Central Daylight Time'],\n  '-420-360': ['Mountain Standard Time', 'Mountain Daylight Time'],\n  '-420-420': [\n    'Mountain Standard Time - Phoenix',\n    'Mountain Standard Time - Phoenix',\n  ],\n  '-480-420': ['Pacific Standard Time', 'Pacific Daylight Time'],\n  '-540-480': ['Alaska Standard Time', 'Alaska Daylight Time'],\n  '-600-600': ['Hawaii Standard Time', 'Hawaii Daylight Time'],\n  '60120': ['Central European Time', 'Central European Daylight Time'],\n  '00': [DEFAULT_TIMEZONE.name, DEFAULT_TIMEZONE.name],\n  '060': ['GMT Standard Time - London', 'British Summer Time'],\n};\n\nconst currentDate = moment();\nconst JANUARY = moment([2021, 1]);\nconst JULY = moment([2021, 7]);\n\nconst getOffsetKey = (name: string) =>\n  JANUARY.tz(name).utcOffset().toString() +\n  JULY.tz(name).utcOffset().toString();\n\nconst getTimezoneName = (name: string) => {\n  const offsets = getOffsetKey(name);\n  return (\n    (currentDate.tz(name).isDST()\n      ? offsetsToName[offsets]?.[1]\n      : offsetsToName[offsets]?.[0]) || name\n  );\n};\n\nconst ALL_ZONES = moment.tz\n  .countries()\n  .map(country => moment.tz.zonesForCountry(country, true))\n  .flat();\n\nconst TIMEZONES: moment.MomentZoneOffset[] = [];\nALL_ZONES.forEach(zone => {\n  if (\n    !TIMEZONES.find(\n      option => getOffsetKey(option.name) === getOffsetKey(zone.name),\n    )\n  ) {\n    TIMEZONES.push(zone); // dedupe zones by offsets\n  }\n});\n\nconst TIMEZONE_OPTIONS = TIMEZONES.map(zone => ({\n  label: `GMT ${moment\n    .tz(currentDate, zone.name)\n    .format('Z')} (${getTimezoneName(zone.name)})`,\n  value: zone.name,\n  offsets: getOffsetKey(zone.name),\n  timezoneName: zone.name,\n}));\n\nconst TIMEZONE_OPTIONS_SORT_COMPARATOR = (\n  a: typeof TIMEZONE_OPTIONS[number],\n  b: typeof TIMEZONE_OPTIONS[number],\n) =>\n  moment.tz(currentDate, a.timezoneName).utcOffset() -\n  moment.tz(currentDate, b.timezoneName).utcOffset();\n\n// pre-sort timezone options by time offset\nTIMEZONE_OPTIONS.sort(TIMEZONE_OPTIONS_SORT_COMPARATOR);\n\nconst matchTimezoneToOptions = (timezone: string) =>\n  TIMEZONE_OPTIONS.find(option => option.offsets === getOffsetKey(timezone))\n    ?.value || DEFAULT_TIMEZONE.value;\n\nexport type TimezoneSelectorProps = {\n  onTimezoneChange: (value: string) => void;\n  timezone?: string | null;\n  minWidth?: string;\n};\n\nexport default function TimezoneSelector({\n  onTimezoneChange,\n  timezone,\n  minWidth = MIN_SELECT_WIDTH, // smallest size for current values\n}: TimezoneSelectorProps) {\n  const validTimezone = useMemo(\n    () => matchTimezoneToOptions(timezone || moment.tz.guess()),\n    [timezone],\n  );\n\n  // force trigger a timezone update if provided `timezone` is not invalid\n  useEffect(() => {\n    if (timezone !== validTimezone) {\n      onTimezoneChange(validTimezone);\n    }\n  }, [validTimezone, onTimezoneChange, timezone]);\n\n  return (\n    <Select\n      ariaLabel={t('Timezone selector')}\n      css={{ minWidth }}\n      onChange={tz => onTimezoneChange(tz as string)}\n      value={validTimezone}\n      options={TIMEZONE_OPTIONS}\n      sortComparator={TIMEZONE_OPTIONS_SORT_COMPARATOR}\n    />\n  );\n}\n","/* eslint-disable import/prefer-default-export */\nimport { DatasourceType } from '@superset-ui/core';\nimport { Datasource } from 'src/dashboard/types';\n/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nexport const PLACEHOLDER_DATASOURCE: Datasource = {\n  id: 0,\n  type: DatasourceType.Table,\n  uid: '_placeholder_',\n  datasource_name: '',\n  table_name: '',\n  columns: [],\n  column_types: [],\n  metrics: [],\n  column_format: {},\n  verbose_map: {},\n  main_dttm_col: '',\n  description: '',\n};\n\nexport const MAIN_HEADER_HEIGHT = 53;\nexport const CLOSED_FILTER_BAR_WIDTH = 32;\nexport const OPEN_FILTER_BAR_WIDTH = 260;\nexport const FILTER_BAR_HEADER_HEIGHT = 80;\nexport const FILTER_BAR_TABS_HEIGHT = 46;\nexport const BUILDER_SIDEPANEL_WIDTH = 374;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\nimport { BACKGROUND_TRANSPARENT, BACKGROUND_WHITE } from './constants';\n\nexport default [\n  {\n    value: BACKGROUND_TRANSPARENT,\n    label: t('Transparent'),\n    className: 'background--transparent',\n  },\n  {\n    value: BACKGROUND_WHITE,\n    label: t('White'),\n    className: 'background--white',\n  },\n];\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t } from '@superset-ui/core';\nimport { SMALL_HEADER, MEDIUM_HEADER, LARGE_HEADER } from './constants';\n\nexport default [\n  {\n    value: SMALL_HEADER,\n    label: t('Small'),\n    className: 'header-style-option header-small',\n  },\n  {\n    value: MEDIUM_HEADER,\n    label: t('Medium'),\n    className: 'header-style-option header-medium',\n  },\n  {\n    value: LARGE_HEADER,\n    label: t('Large'),\n    className: 'header-style-option header-large',\n  },\n];\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo, useState, useEffect } from 'react';\nimport {\n  css,\n  GenericDataType,\n  getTimeFormatter,\n  styled,\n  t,\n  TimeFormats,\n  useTheme,\n} from '@superset-ui/core';\nimport { Global } from '@emotion/react';\nimport { Column } from 'react-table';\nimport debounce from 'lodash/debounce';\nimport { Space } from 'src/components';\nimport { Input } from 'src/components/Input';\nimport {\n  BOOL_FALSE_DISPLAY,\n  BOOL_TRUE_DISPLAY,\n  NULL_DISPLAY,\n  SLOW_DEBOUNCE,\n} from 'src/constants';\nimport { Radio } from 'src/components/Radio';\nimport Icons from 'src/components/Icons';\nimport Button from 'src/components/Button';\nimport Popover from 'src/components/Popover';\nimport { prepareCopyToClipboardTabularData } from 'src/utils/common';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport RowCountLabel from 'src/explore/components/RowCountLabel';\nimport { getTimeColumns, setTimeColumns } from './utils';\n\nexport const CellNull = styled('span')`\n  color: ${({ theme }) => theme.colors.grayscale.light1};\n`;\n\nexport const CopyButton = styled(Button)`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n\n  // needed to override button's first-of-type margin: 0\n  && {\n    margin: 0 ${({ theme }) => theme.gridUnit * 2}px;\n  }\n\n  i {\n    padding: 0 ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nexport const CopyToClipboardButton = ({\n  data,\n  columns,\n}: {\n  data?: Record<string, any>;\n  columns?: string[];\n}) => {\n  const theme = useTheme();\n  return (\n    <CopyToClipboard\n      text={\n        data && columns ? prepareCopyToClipboardTabularData(data, columns) : ''\n      }\n      wrapped={false}\n      copyNode={\n        <Icons.CopyOutlined\n          iconColor={theme.colors.grayscale.base}\n          iconSize=\"l\"\n          aria-label={t('Copy')}\n          role=\"button\"\n          css={css`\n            &.anticon > * {\n              line-height: 0;\n            }\n          `}\n        />\n      }\n    />\n  );\n};\n\nexport const FilterInput = ({\n  onChangeHandler,\n}: {\n  onChangeHandler(filterText: string): void;\n}) => {\n  const theme = useTheme();\n  const debouncedChangeHandler = debounce(onChangeHandler, SLOW_DEBOUNCE);\n  return (\n    <Input\n      prefix={<Icons.Search iconColor={theme.colors.grayscale.base} />}\n      placeholder={t('Search')}\n      onChange={(event: any) => {\n        const filterText = event.target.value;\n        debouncedChangeHandler(filterText);\n      }}\n      css={css`\n        width: 200px;\n        margin-right: ${theme.gridUnit * 2}px;\n      `}\n    />\n  );\n};\n\nexport const RowCount = ({\n  data,\n  loading,\n}: {\n  data?: Record<string, any>[];\n  loading: boolean;\n}) => <RowCountLabel rowcount={data?.length ?? 0} loading={loading} />;\n\nenum FormatPickerValue {\n  Formatted = 'formatted',\n  Original = 'original',\n}\n\nconst FormatPicker = ({\n  onChange,\n  value,\n}: {\n  onChange: any;\n  value: FormatPickerValue;\n}) => (\n  <Radio.Group value={value} onChange={onChange}>\n    <Space direction=\"vertical\">\n      <Radio value={FormatPickerValue.Formatted}>{t('Formatted date')}</Radio>\n      <Radio value={FormatPickerValue.Original}>{t('Original value')}</Radio>\n    </Space>\n  </Radio.Group>\n);\n\nconst FormatPickerContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n\n  padding: ${({ theme }) => `${theme.gridUnit * 4}px`};\n`;\n\nconst FormatPickerLabel = styled.span`\n  font-size: ${({ theme }) => theme.typography.sizes.s}px;\n  color: ${({ theme }) => theme.colors.grayscale.base};\n  margin-bottom: ${({ theme }) => theme.gridUnit * 2}px;\n  text-transform: uppercase;\n`;\n\nconst DataTableTemporalHeaderCell = ({\n  columnName,\n  onTimeColumnChange,\n  datasourceId,\n  isOriginalTimeColumn,\n}: {\n  columnName: string;\n  onTimeColumnChange: (\n    columnName: string,\n    columnType: FormatPickerValue,\n  ) => void;\n  datasourceId?: string;\n  isOriginalTimeColumn: boolean;\n}) => {\n  const theme = useTheme();\n\n  const onChange = (e: any) => {\n    onTimeColumnChange(columnName, e.target.value);\n  };\n\n  const overlayContent = useMemo(\n    () =>\n      datasourceId ? ( // eslint-disable-next-line jsx-a11y/no-static-element-interactions\n        <FormatPickerContainer onClick={e => e.stopPropagation()}>\n          {/* hack to disable click propagation from popover content to table header, which triggers sorting column */}\n          <Global\n            styles={css`\n              .column-formatting-popover .ant-popover-inner-content {\n                padding: 0;\n              }\n            `}\n          />\n          <FormatPickerLabel>{t('Column Formatting')}</FormatPickerLabel>\n          <FormatPicker\n            onChange={onChange}\n            value={\n              isOriginalTimeColumn\n                ? FormatPickerValue.Original\n                : FormatPickerValue.Formatted\n            }\n          />\n        </FormatPickerContainer>\n      ) : null,\n    [datasourceId, isOriginalTimeColumn],\n  );\n\n  return datasourceId ? (\n    <span>\n      <Popover\n        overlayClassName=\"column-formatting-popover\"\n        trigger=\"click\"\n        content={overlayContent}\n        placement=\"bottomLeft\"\n        arrowPointAtCenter\n      >\n        <Icons.SettingOutlined\n          iconSize=\"m\"\n          iconColor={theme.colors.grayscale.light1}\n          css={{ marginRight: `${theme.gridUnit}px` }}\n          onClick={e => e.stopPropagation()}\n        />\n      </Popover>\n      {columnName}\n    </span>\n  ) : (\n    <span>{columnName}</span>\n  );\n};\n\nexport const useFilteredTableData = (\n  filterText: string,\n  data?: Record<string, any>[],\n) => {\n  const rowsAsStrings = useMemo(\n    () =>\n      data?.map((row: Record<string, any>) =>\n        Object.values(row).map(value =>\n          value ? value.toString().toLowerCase() : t('N/A'),\n        ),\n      ) ?? [],\n    [data],\n  );\n\n  return useMemo(() => {\n    if (!data?.length) {\n      return [];\n    }\n    return data.filter((_, index: number) =>\n      rowsAsStrings[index].some(value =>\n        value?.includes(filterText.toLowerCase()),\n      ),\n    );\n  }, [data, filterText, rowsAsStrings]);\n};\n\nconst timeFormatter = getTimeFormatter(TimeFormats.DATABASE_DATETIME);\n\nexport const useTableColumns = (\n  colnames?: string[],\n  coltypes?: GenericDataType[],\n  data?: Record<string, any>[],\n  datasourceId?: string,\n  isVisible?: boolean,\n  moreConfigs?: { [key: string]: Partial<Column> },\n) => {\n  const [originalFormattedTimeColumns, setOriginalFormattedTimeColumns] =\n    useState<string[]>(getTimeColumns(datasourceId));\n\n  const onTimeColumnChange = (\n    columnName: string,\n    columnType: FormatPickerValue,\n  ) => {\n    if (!datasourceId) {\n      return;\n    }\n    if (\n      columnType === FormatPickerValue.Original &&\n      !originalFormattedTimeColumns.includes(columnName)\n    ) {\n      const cols = getTimeColumns(datasourceId);\n      cols.push(columnName);\n      setTimeColumns(datasourceId, cols);\n      setOriginalFormattedTimeColumns(cols);\n    } else if (\n      columnType === FormatPickerValue.Formatted &&\n      originalFormattedTimeColumns.includes(columnName)\n    ) {\n      const cols = getTimeColumns(datasourceId);\n      cols.splice(cols.indexOf(columnName), 1);\n      setTimeColumns(datasourceId, cols);\n      setOriginalFormattedTimeColumns(cols);\n    }\n  };\n\n  useEffect(() => {\n    if (isVisible) {\n      setOriginalFormattedTimeColumns(getTimeColumns(datasourceId));\n    }\n  }, [datasourceId, isVisible]);\n\n  return useMemo(\n    () =>\n      colnames && data?.length\n        ? colnames\n            .filter((column: string) => Object.keys(data[0]).includes(column))\n            .map((key, index) => {\n              const colType = coltypes?.[index];\n              const firstValue = data[0][key];\n              const originalFormattedTimeColumnIndex =\n                colType === GenericDataType.TEMPORAL\n                  ? originalFormattedTimeColumns.indexOf(key)\n                  : -1;\n              const isOriginalTimeColumn =\n                originalFormattedTimeColumns.includes(key);\n              return {\n                id: key,\n                accessor: row => row[key],\n                // When the key is empty, have to give a string of length greater than 0\n                Header:\n                  colType === GenericDataType.TEMPORAL &&\n                  typeof firstValue !== 'string' ? (\n                    <DataTableTemporalHeaderCell\n                      columnName={key}\n                      datasourceId={datasourceId}\n                      onTimeColumnChange={onTimeColumnChange}\n                      isOriginalTimeColumn={isOriginalTimeColumn}\n                    />\n                  ) : (\n                    key\n                  ),\n                Cell: ({ value }) => {\n                  if (value === true) {\n                    return BOOL_TRUE_DISPLAY;\n                  }\n                  if (value === false) {\n                    return BOOL_FALSE_DISPLAY;\n                  }\n                  if (value === null) {\n                    return <CellNull>{NULL_DISPLAY}</CellNull>;\n                  }\n                  if (\n                    colType === GenericDataType.TEMPORAL &&\n                    originalFormattedTimeColumnIndex === -1 &&\n                    typeof value === 'number'\n                  ) {\n                    return timeFormatter(value);\n                  }\n                  return String(value);\n                },\n                ...moreConfigs?.[key],\n              } as Column;\n            })\n        : [],\n    [\n      colnames,\n      data,\n      coltypes,\n      datasourceId,\n      moreConfigs,\n      originalFormattedTimeColumns,\n    ],\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { ensureIsArray } from '@superset-ui/core';\nimport {\n  LocalStorageKeys,\n  setItem,\n  getItem,\n} from 'src/utils/localStorageHelpers';\n\nexport const getTimeColumns = (datasourceId?: string): string[] => {\n  const colsMap = getItem(\n    LocalStorageKeys.explore__data_table_original_formatted_time_columns,\n    {},\n  );\n  if (datasourceId === undefined) {\n    return [];\n  }\n  return ensureIsArray(colsMap[datasourceId]);\n};\n\nexport const setTimeColumns = (datasourceId: string, columns: string[]) => {\n  const colsMap = getItem(\n    LocalStorageKeys.explore__data_table_original_formatted_time_columns,\n    {},\n  );\n  setItem(\n    LocalStorageKeys.explore__data_table_original_formatted_time_columns,\n    {\n      ...colsMap,\n      [datasourceId]: columns,\n    },\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport {\n  Datasource,\n  GenericDataType,\n  JsonObject,\n  QueryFormData,\n} from '@superset-ui/core';\nimport { ExploreActions } from 'src/explore/actions/exploreActions';\nimport { ChartStatus } from 'src/explore/types';\n\nexport enum ResultTypes {\n  Results = 'results',\n  Samples = 'samples',\n}\n\nexport interface DataTablesPaneProps {\n  queryFormData: QueryFormData;\n  datasource: Datasource;\n  queryForce: boolean;\n  ownState?: JsonObject;\n  chartStatus: ChartStatus;\n  onCollapseChange: (isOpen: boolean) => void;\n  errorMessage?: JSX.Element;\n  actions: ExploreActions;\n}\n\nexport interface ResultsPaneProps {\n  isRequest: boolean;\n  queryFormData: QueryFormData;\n  queryForce: boolean;\n  ownState?: JsonObject;\n  errorMessage?: React.ReactElement;\n  actions?: ExploreActions;\n  dataSize?: number;\n  // reload OriginalFormattedTimeColumns from localStorage when isVisible is true\n  isVisible: boolean;\n}\n\nexport interface SamplesPaneProps {\n  isRequest: boolean;\n  datasource: Datasource;\n  queryForce: boolean;\n  actions?: ExploreActions;\n  dataSize?: number;\n  // reload OriginalFormattedTimeColumns from localStorage when isVisible is true\n  isVisible: boolean;\n}\n\nexport interface TableControlsProps {\n  data: Record<string, any>[];\n  // {datasource.id}__{datasource.type}, eg: 1__table\n  datasourceId: string;\n  onInputChange: (input: string) => void;\n  columnNames: string[];\n  columnTypes: GenericDataType[];\n  isLoading: boolean;\n}\n\nexport interface QueryResultInterface {\n  colnames: string[];\n  coltypes: GenericDataType[];\n  data: Record<string, any>[][];\n}\n\nexport interface SingleQueryResultPaneProp extends QueryResultInterface {\n  // {datasource.id}__{datasource.type}, eg: 1__table\n  datasourceId: string;\n  dataSize?: number;\n  // reload OriginalFormattedTimeColumns from localStorage when isVisible is true\n  isVisible: boolean;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nconst queryObjectCount = {\n  mixed_timeseries: 2,\n};\n\nexport const getQueryCount = (vizType: string): number =>\n  queryObjectCount?.[vizType] || 1;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useMemo } from 'react';\nimport { zip } from 'lodash';\nimport { css, GenericDataType, styled } from '@superset-ui/core';\nimport {\n  CopyToClipboardButton,\n  FilterInput,\n  RowCount,\n} from 'src/explore/components/DataTableControl';\nimport { applyFormattingToTabularData } from 'src/utils/common';\nimport { getTimeColumns } from 'src/explore/components/DataTableControl/utils';\nimport { TableControlsProps } from '../types';\n\nexport const TableControlsWrapper = styled.div`\n  ${({ theme }) => `\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    margin-bottom: ${theme.gridUnit * 2}px;\n\n    span {\n      flex-shrink: 0;\n    }\n  `}\n`;\n\nexport const TableControls = ({\n  data,\n  datasourceId,\n  onInputChange,\n  columnNames,\n  columnTypes,\n  isLoading,\n}: TableControlsProps) => {\n  const originalTimeColumns = getTimeColumns(datasourceId);\n  const formattedTimeColumns = zip<string, GenericDataType>(\n    columnNames,\n    columnTypes,\n  )\n    .filter(\n      ([name, type]) =>\n        type === GenericDataType.TEMPORAL &&\n        name &&\n        !originalTimeColumns.includes(name),\n    )\n    .map(([colname]) => colname);\n  const formattedData = useMemo(\n    () => applyFormattingToTabularData(data, formattedTimeColumns),\n    [data, formattedTimeColumns],\n  );\n  return (\n    <TableControlsWrapper>\n      <FilterInput onChangeHandler={onInputChange} />\n      <div\n        css={css`\n          display: flex;\n          align-items: center;\n        `}\n      >\n        <RowCount data={data} loading={isLoading} />\n        <CopyToClipboardButton data={formattedData} columns={columnNames} />\n      </div>\n    </TableControlsWrapper>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState } from 'react';\nimport { t } from '@superset-ui/core';\nimport TableView, { EmptyWrapperType } from 'src/components/TableView';\nimport {\n  useFilteredTableData,\n  useTableColumns,\n} from 'src/explore/components/DataTableControl';\nimport { TableControls } from './DataTableControls';\nimport { SingleQueryResultPaneProp } from '../types';\n\nexport const SingleQueryResultPane = ({\n  data,\n  colnames,\n  coltypes,\n  datasourceId,\n  dataSize = 50,\n  isVisible,\n}: SingleQueryResultPaneProp) => {\n  const [filterText, setFilterText] = useState('');\n\n  // this is to preserve the order of the columns, even if there are integer values,\n  // while also only grabbing the first column's keys\n  const columns = useTableColumns(\n    colnames,\n    coltypes,\n    data,\n    datasourceId,\n    isVisible,\n  );\n  const filteredData = useFilteredTableData(filterText, data);\n\n  return (\n    <>\n      <TableControls\n        data={filteredData}\n        columnNames={colnames}\n        columnTypes={coltypes}\n        datasourceId={datasourceId}\n        onInputChange={input => setFilterText(input)}\n        isLoading={false}\n      />\n      <TableView\n        columns={columns}\n        data={filteredData}\n        pageSize={dataSize}\n        noDataText={t('No results')}\n        emptyWrapperType={EmptyWrapperType.Small}\n        className=\"table-condensed\"\n        isPaginationSticky\n        showRowCount={false}\n        small\n      />\n    </>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect } from 'react';\nimport { ensureIsArray, styled, t } from '@superset-ui/core';\nimport Loading from 'src/components/Loading';\nimport { EmptyStateMedium } from 'src/components/EmptyState';\nimport { getChartDataRequest } from 'src/components/Chart/chartAction';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { ResultsPaneProps, QueryResultInterface } from '../types';\nimport { getQueryCount } from '../utils';\nimport { SingleQueryResultPane } from './SingleQueryResultPane';\nimport { TableControls } from './DataTableControls';\n\nconst Error = styled.pre`\n  margin-top: ${({ theme }) => `${theme.gridUnit * 4}px`};\n`;\n\nconst cache = new WeakSet();\n\nexport const useResultsPane = ({\n  isRequest,\n  queryFormData,\n  queryForce,\n  ownState,\n  errorMessage,\n  actions,\n  isVisible,\n  dataSize = 50,\n}: ResultsPaneProps): React.ReactElement[] => {\n  const [resultResp, setResultResp] = useState<QueryResultInterface[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(true);\n  const [responseError, setResponseError] = useState<string>('');\n  const queryCount = getQueryCount(\n    queryFormData?.viz_type || queryFormData?.vizType,\n  );\n\n  useEffect(() => {\n    // it's an invalid formData when gets a errorMessage\n    if (errorMessage) return;\n    if (isRequest && !cache.has(queryFormData)) {\n      setIsLoading(true);\n      getChartDataRequest({\n        formData: queryFormData,\n        force: queryForce,\n        resultFormat: 'json',\n        resultType: 'results',\n        ownState,\n      })\n        .then(({ json }) => {\n          setResultResp(ensureIsArray(json.result));\n          setResponseError('');\n          cache.add(queryFormData);\n          if (queryForce && actions) {\n            actions.setForceQuery(false);\n          }\n        })\n        .catch(response => {\n          getClientErrorObject(response).then(({ error, message }) => {\n            setResponseError(error || message || t('Sorry, an error occurred'));\n          });\n        })\n        .finally(() => {\n          setIsLoading(false);\n        });\n    }\n  }, [queryFormData, isRequest]);\n\n  useEffect(() => {\n    if (errorMessage) {\n      setIsLoading(false);\n    }\n  }, [errorMessage]);\n\n  if (isLoading) {\n    return Array(queryCount).fill(<Loading />);\n  }\n\n  if (errorMessage) {\n    const title = t('Run a query to display results');\n    return Array(queryCount).fill(\n      <EmptyStateMedium image=\"document.svg\" title={title} />,\n    );\n  }\n\n  if (responseError) {\n    const err = (\n      <>\n        <TableControls\n          data={[]}\n          columnNames={[]}\n          columnTypes={[]}\n          datasourceId={queryFormData.datasource}\n          onInputChange={() => {}}\n          isLoading={false}\n        />\n        <Error>{responseError}</Error>\n      </>\n    );\n    return Array(queryCount).fill(err);\n  }\n\n  if (resultResp.length === 0) {\n    const title = t('No results were returned for this query');\n    return Array(queryCount).fill(\n      <EmptyStateMedium image=\"document.svg\" title={title} />,\n    );\n  }\n\n  return resultResp.map((result, idx) => (\n    <SingleQueryResultPane\n      data={result.data}\n      colnames={result.colnames}\n      coltypes={result.coltypes}\n      dataSize={dataSize}\n      datasourceId={queryFormData.datasource}\n      key={idx}\n      isVisible={isVisible}\n    />\n  ));\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { t } from '@superset-ui/core';\nimport Tabs from 'src/components/Tabs';\nimport { ResultTypes, ResultsPaneProps } from '../types';\nimport { useResultsPane } from './useResultsPane';\n\nexport const ResultsPaneOnDashboard = ({\n  isRequest,\n  queryFormData,\n  queryForce,\n  ownState,\n  errorMessage,\n  actions,\n  isVisible,\n  dataSize = 50,\n}: ResultsPaneProps) => {\n  const resultsPanes = useResultsPane({\n    errorMessage,\n    queryFormData,\n    queryForce,\n    ownState,\n    isRequest,\n    actions,\n    dataSize,\n    isVisible,\n  });\n  if (resultsPanes.length === 1) {\n    return resultsPanes[0];\n  }\n\n  const panes = resultsPanes.map((pane, idx) => {\n    if (idx === 0) {\n      return (\n        <Tabs.TabPane tab={t('Results')} key={ResultTypes.Results}>\n          {pane}\n        </Tabs.TabPane>\n      );\n    }\n\n    return (\n      <Tabs.TabPane\n        tab={t('Results %s', idx + 1)}\n        key={`${ResultTypes.Results} ${idx + 1}`}\n      >\n        {pane}\n      </Tabs.TabPane>\n    );\n  });\n\n  return <Tabs fullWidth={false}> {panes} </Tabs>;\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useState, useEffect, useMemo } from 'react';\nimport { ensureIsArray, GenericDataType, styled, t } from '@superset-ui/core';\nimport Loading from 'src/components/Loading';\nimport { EmptyStateMedium } from 'src/components/EmptyState';\nimport TableView, { EmptyWrapperType } from 'src/components/TableView';\nimport {\n  useFilteredTableData,\n  useTableColumns,\n} from 'src/explore/components/DataTableControl';\nimport { getDatasetSamples } from 'src/components/Chart/chartAction';\nimport { TableControls } from './DataTableControls';\nimport { SamplesPaneProps } from '../types';\n\nconst Error = styled.pre`\n  margin-top: ${({ theme }) => `${theme.gridUnit * 4}px`};\n`;\n\nconst cache = new WeakSet();\n\nexport const SamplesPane = ({\n  isRequest,\n  datasource,\n  queryForce,\n  actions,\n  dataSize = 50,\n  isVisible,\n}: SamplesPaneProps) => {\n  const [filterText, setFilterText] = useState('');\n  const [data, setData] = useState<Record<string, any>[][]>([]);\n  const [colnames, setColnames] = useState<string[]>([]);\n  const [coltypes, setColtypes] = useState<GenericDataType[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [responseError, setResponseError] = useState<string>('');\n  const datasourceId = useMemo(\n    () => `${datasource.id}__${datasource.type}`,\n    [datasource],\n  );\n\n  useEffect(() => {\n    if (isRequest && queryForce) {\n      cache.delete(datasource);\n    }\n\n    if (isRequest && !cache.has(datasource)) {\n      setIsLoading(true);\n      getDatasetSamples(datasource.id, queryForce)\n        .then(response => {\n          setData(ensureIsArray(response.data));\n          setColnames(ensureIsArray(response.colnames));\n          setColtypes(ensureIsArray(response.coltypes));\n          setResponseError('');\n          cache.add(datasource);\n          if (queryForce && actions) {\n            actions.setForceQuery(false);\n          }\n        })\n        .catch(error => {\n          setData([]);\n          setColnames([]);\n          setColtypes([]);\n          setResponseError(`${error.name}: ${error.message}`);\n        })\n        .finally(() => {\n          setIsLoading(false);\n        });\n    }\n  }, [datasource, isRequest, queryForce]);\n\n  // this is to preserve the order of the columns, even if there are integer values,\n  // while also only grabbing the first column's keys\n  const columns = useTableColumns(\n    colnames,\n    coltypes,\n    data,\n    datasourceId,\n    isVisible,\n  );\n  const filteredData = useFilteredTableData(filterText, data);\n\n  if (isLoading) {\n    return <Loading />;\n  }\n\n  if (responseError) {\n    return (\n      <>\n        <TableControls\n          data={filteredData}\n          columnNames={colnames}\n          columnTypes={coltypes}\n          datasourceId={datasourceId}\n          onInputChange={input => setFilterText(input)}\n          isLoading={isLoading}\n        />\n        <Error>{responseError}</Error>\n      </>\n    );\n  }\n\n  if (data.length === 0) {\n    const title = t('No samples were returned for this dataset');\n    return <EmptyStateMedium image=\"document.svg\" title={title} />;\n  }\n\n  return (\n    <>\n      <TableControls\n        data={filteredData}\n        columnNames={colnames}\n        columnTypes={coltypes}\n        datasourceId={datasourceId}\n        onInputChange={input => setFilterText(input)}\n        isLoading={isLoading}\n      />\n      <TableView\n        columns={columns}\n        data={filteredData}\n        pageSize={dataSize}\n        noDataText={t('No results')}\n        emptyWrapperType={EmptyWrapperType.Small}\n        className=\"table-condensed\"\n        isPaginationSticky\n        showRowCount={false}\n        small\n      />\n    </>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, {\n  useCallback,\n  useEffect,\n  useMemo,\n  useState,\n  MouseEvent,\n} from 'react';\nimport { styled, t, useTheme } from '@superset-ui/core';\nimport Icons from 'src/components/Icons';\nimport Tabs from 'src/components/Tabs';\nimport {\n  getItem,\n  setItem,\n  LocalStorageKeys,\n} from 'src/utils/localStorageHelpers';\nimport {\n  SamplesPane,\n  TableControlsWrapper,\n  useResultsPane,\n} from './components';\nimport { DataTablesPaneProps, ResultTypes } from './types';\n\nconst SouthPane = styled.div`\n  ${({ theme }) => `\n    position: relative;\n    background-color: ${theme.colors.grayscale.light5};\n    z-index: 5;\n    overflow: hidden;\n\n    .ant-tabs {\n      height: 100%;\n    }\n\n    .ant-tabs-content-holder {\n      height: 100%;\n    }\n\n    .ant-tabs-content {\n      height: 100%;\n    }\n\n    .ant-tabs-tabpane {\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n\n      .table-condensed {\n        height: 100%;\n        overflow: auto;\n        margin-bottom: ${theme.gridUnit * 4}px;\n\n        .table {\n          margin-bottom: ${theme.gridUnit * 2}px;\n        }\n      }\n\n      .pagination-container > ul[role='navigation'] {\n        margin-top: 0;\n      }\n    }\n  `}\n`;\n\nexport const DataTablesPane = ({\n  queryFormData,\n  datasource,\n  queryForce,\n  onCollapseChange,\n  chartStatus,\n  ownState,\n  errorMessage,\n  actions,\n}: DataTablesPaneProps) => {\n  const theme = useTheme();\n  const [activeTabKey, setActiveTabKey] = useState<string>(ResultTypes.Results);\n  const [isRequest, setIsRequest] = useState<Record<ResultTypes, boolean>>({\n    results: false,\n    samples: false,\n  });\n  const [panelOpen, setPanelOpen] = useState(\n    getItem(LocalStorageKeys.is_datapanel_open, false),\n  );\n\n  useEffect(() => {\n    setItem(LocalStorageKeys.is_datapanel_open, panelOpen);\n  }, [panelOpen]);\n\n  useEffect(() => {\n    if (!panelOpen) {\n      setIsRequest({\n        results: false,\n        samples: false,\n      });\n    }\n\n    if (\n      panelOpen &&\n      activeTabKey.startsWith(ResultTypes.Results) &&\n      chartStatus === 'rendered'\n    ) {\n      setIsRequest({\n        results: true,\n        samples: false,\n      });\n    }\n\n    if (panelOpen && activeTabKey === ResultTypes.Samples) {\n      setIsRequest({\n        results: false,\n        samples: true,\n      });\n    }\n  }, [panelOpen, activeTabKey, chartStatus]);\n\n  const handleCollapseChange = useCallback(\n    (isOpen: boolean) => {\n      onCollapseChange(isOpen);\n      setPanelOpen(isOpen);\n    },\n    [onCollapseChange],\n  );\n\n  const handleTabClick = useCallback(\n    (tabKey: string, e: MouseEvent) => {\n      if (!panelOpen) {\n        handleCollapseChange(true);\n      } else if (tabKey === activeTabKey) {\n        e.preventDefault();\n        handleCollapseChange(false);\n      }\n      setActiveTabKey(tabKey);\n    },\n    [activeTabKey, handleCollapseChange, panelOpen],\n  );\n\n  const CollapseButton = useMemo(() => {\n    const caretIcon = panelOpen ? (\n      <Icons.CaretUp\n        iconColor={theme.colors.grayscale.base}\n        aria-label={t('Collapse data panel')}\n      />\n    ) : (\n      <Icons.CaretDown\n        iconColor={theme.colors.grayscale.base}\n        aria-label={t('Expand data panel')}\n      />\n    );\n    return (\n      <TableControlsWrapper>\n        {panelOpen ? (\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={() => handleCollapseChange(false)}\n          >\n            {caretIcon}\n          </span>\n        ) : (\n          <span\n            role=\"button\"\n            tabIndex={0}\n            onClick={() => handleCollapseChange(true)}\n          >\n            {caretIcon}\n          </span>\n        )}\n      </TableControlsWrapper>\n    );\n  }, [handleCollapseChange, panelOpen, theme.colors.grayscale.base]);\n\n  const queryResultsPanes = useResultsPane({\n    errorMessage,\n    queryFormData,\n    queryForce,\n    ownState,\n    isRequest: isRequest.results,\n    actions,\n    isVisible: ResultTypes.Results === activeTabKey,\n  }).map((pane, idx) => {\n    if (idx === 0) {\n      return (\n        <Tabs.TabPane tab={t('Results')} key={ResultTypes.Results}>\n          {pane}\n        </Tabs.TabPane>\n      );\n    }\n    if (idx > 0) {\n      return (\n        <Tabs.TabPane\n          tab={t('Results %s', idx + 1)}\n          key={`${ResultTypes.Results} ${idx + 1}`}\n        >\n          {pane}\n        </Tabs.TabPane>\n      );\n    }\n    return null;\n  });\n\n  return (\n    <SouthPane data-test=\"some-purposeful-instance\">\n      <Tabs\n        fullWidth={false}\n        tabBarExtraContent={CollapseButton}\n        activeKey={panelOpen ? activeTabKey : ''}\n        onTabClick={handleTabClick}\n      >\n        {queryResultsPanes}\n        <Tabs.TabPane tab={t('Samples')} key={ResultTypes.Samples}>\n          <SamplesPane\n            datasource={datasource}\n            queryForce={queryForce}\n            isRequest={isRequest.samples}\n            actions={actions}\n            isVisible={ResultTypes.Samples === activeTabKey}\n          />\n        </Tabs.TabPane>\n      </Tabs>\n    </SouthPane>\n  );\n};\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React from 'react';\nimport { getNumberFormatter, t, tn } from '@superset-ui/core';\n\nimport Label from 'src/components/Label';\nimport { Tooltip } from 'src/components/Tooltip';\n\ntype RowCountLabelProps = {\n  rowcount?: number;\n  limit?: number;\n  loading?: boolean;\n};\n\nexport default function RowCountLabel(props: RowCountLabelProps) {\n  const { rowcount = 0, limit, loading } = props;\n  const limitReached = rowcount === limit;\n  const type =\n    limitReached || (rowcount === 0 && !loading) ? 'danger' : 'default';\n  const formattedRowCount = getNumberFormatter()(rowcount);\n  const label = (\n    <Label type={type} data-test=\"row-count-label\">\n      {loading\n        ? t('Loading...')\n        : tn('%s row', '%s rows', rowcount, formattedRowCount)}\n    </Label>\n  );\n  return limitReached ? (\n    <Tooltip id=\"tt-rowcount-tooltip\" title={<span>{t('Limit reached')}</span>}>\n      {label}\n    </Tooltip>\n  ) : (\n    label\n  );\n}\n\nexport type { RowCountLabelProps };\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport React, { useEffect, useState } from 'react';\nimport { ensureIsArray, styled, t } from '@superset-ui/core';\nimport SyntaxHighlighter from 'react-syntax-highlighter/dist/cjs/light';\nimport github from 'react-syntax-highlighter/dist/cjs/styles/hljs/github';\nimport CopyToClipboard from 'src/components/CopyToClipboard';\nimport Loading from 'src/components/Loading';\nimport { CopyButton } from 'src/explore/components/DataTableControl';\nimport { getClientErrorObject } from 'src/utils/getClientErrorObject';\nimport { getChartDataRequest } from 'src/components/Chart/chartAction';\nimport markdownSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/markdown';\nimport htmlSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/htmlbars';\nimport sqlSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/sql';\nimport jsonSyntax from 'react-syntax-highlighter/dist/cjs/languages/hljs/json';\n\nconst CopyButtonViewQuery = styled(CopyButton)`\n  && {\n    margin: 0 0 ${({ theme }) => theme.gridUnit}px;\n  }\n`;\n\nSyntaxHighlighter.registerLanguage('markdown', markdownSyntax);\nSyntaxHighlighter.registerLanguage('html', htmlSyntax);\nSyntaxHighlighter.registerLanguage('sql', sqlSyntax);\nSyntaxHighlighter.registerLanguage('json', jsonSyntax);\n\ninterface Props {\n  latestQueryFormData: object;\n}\n\ntype Result = {\n  query: string;\n  language: string;\n};\n\nconst StyledSyntaxContainer = styled.div`\n  height: 100%;\n`;\n\nconst StyledSyntaxHighlighter = styled(SyntaxHighlighter)`\n  height: calc(100% - 26px); // 100% - clipboard height\n`;\n\nconst ViewQueryModal: React.FC<Props> = props => {\n  const [result, setResult] = useState<Result[]>([]);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n\n  const loadChartData = (resultType: string) => {\n    setIsLoading(true);\n    getChartDataRequest({\n      formData: props.latestQueryFormData,\n      resultFormat: 'json',\n      resultType,\n    })\n      .then(({ json }) => {\n        setResult(ensureIsArray(json.result));\n        setIsLoading(false);\n        setError(null);\n      })\n      .catch(response => {\n        getClientErrorObject(response).then(({ error, message }) => {\n          setError(\n            error ||\n              message ||\n              response.statusText ||\n              t('Sorry, An error occurred'),\n          );\n          setIsLoading(false);\n        });\n      });\n  };\n  useEffect(() => {\n    loadChartData('query');\n  }, [JSON.stringify(props.latestQueryFormData)]);\n\n  if (isLoading) {\n    return <Loading />;\n  }\n  if (error) {\n    return <pre>{error}</pre>;\n  }\n  return (\n    <>\n      {result.map(item =>\n        item.query ? (\n          <StyledSyntaxContainer key={item.query}>\n            <CopyToClipboard\n              text={item.query}\n              shouldShowText={false}\n              copyNode={\n                <CopyButtonViewQuery buttonSize=\"xsmall\">\n                  <i className=\"fa fa-clipboard\" />\n                </CopyButtonViewQuery>\n              }\n            />\n            <StyledSyntaxHighlighter\n              language={item.language || undefined}\n              style={github}\n            >\n              {item.query}\n            </StyledSyntaxHighlighter>\n          </StyledSyntaxContainer>\n        ) : null,\n      )}\n    </>\n  );\n};\n\nexport default ViewQueryModal;\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { omit } from 'lodash';\nimport { SupersetClient, JsonObject } from '@superset-ui/core';\n\ntype Payload = {\n  datasource_id: number;\n  datasource_type: string;\n  form_data: string;\n  chart_id?: number;\n};\n\nconst TEMPORARY_CONTROLS = ['url_params'];\n\nexport const sanitizeFormData = (formData: JsonObject): JsonObject =>\n  omit(formData, TEMPORARY_CONTROLS);\n\nconst assembleEndpoint = (key?: string, tabId?: string) => {\n  let endpoint = 'api/v1/explore/form_data';\n  if (key) {\n    endpoint = endpoint.concat(`/${key}`);\n  }\n  if (tabId) {\n    endpoint = endpoint.concat(`?tab_id=${tabId}`);\n  }\n  return endpoint;\n};\n\nconst assemblePayload = (\n  datasourceId: number,\n  datasourceType: string,\n  formData: JsonObject,\n  chartId?: number,\n) => {\n  const payload: Payload = {\n    datasource_id: datasourceId,\n    datasource_type: datasourceType,\n    form_data: JSON.stringify(sanitizeFormData(formData)),\n  };\n  if (chartId) {\n    payload.chart_id = chartId;\n  }\n  return payload;\n};\n\nexport const postFormData = (\n  datasourceId: number,\n  datasourceType: string,\n  formData: JsonObject,\n  chartId?: number,\n  tabId?: string,\n): Promise<string> =>\n  SupersetClient.post({\n    endpoint: assembleEndpoint(undefined, tabId),\n    jsonPayload: assemblePayload(\n      datasourceId,\n      datasourceType,\n      formData,\n      chartId,\n    ),\n  }).then(r => r.json.key);\n\nexport const putFormData = (\n  datasourceId: number,\n  datasourceType: string,\n  key: string,\n  formData: JsonObject,\n  chartId?: number,\n  tabId?: string,\n): Promise<string> =>\n  SupersetClient.put({\n    endpoint: assembleEndpoint(key, tabId),\n    jsonPayload: assemblePayload(\n      datasourceId,\n      datasourceType,\n      formData,\n      chartId,\n    ),\n  }).then(r => r.json.message);\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { useEffect } from 'react';\nimport { usePrevious } from '../usePrevious';\n\n/**\n * Calls the callback when the value changes.\n *\n * Passes the previous and current values to the callback\n */\nexport function useChangeEffect<T>(\n  value: T,\n  callback: (previous: T | undefined, current: T) => void,\n) {\n  const previous = usePrevious(value);\n  useEffect(() => {\n    if (value !== previous) {\n      callback(previous, value);\n    }\n  }, [value, previous, callback]);\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { useEffect, useState } from 'react';\nimport { BroadcastChannel } from 'broadcast-channel';\n\ninterface TabIdChannelMessage {\n  type: 'REQUESTING_TAB_ID' | 'TAB_ID_DENIED';\n  tabId: string;\n}\n\n// TODO: We are using broadcast-channel to support Safari.\n// The native BroadcastChannel API will be supported in Safari version 15.4.\n// After that, we should remove this dependency and use the native API.\nconst channel = new BroadcastChannel<TabIdChannelMessage>('tab_id_channel');\n\nexport function useTabId() {\n  const [tabId, setTabId] = useState<string>();\n\n  useEffect(() => {\n    const updateTabId = () => {\n      const lastTabId = window.localStorage.getItem('last_tab_id');\n      const newTabId = String(\n        lastTabId ? Number.parseInt(lastTabId, 10) + 1 : 1,\n      );\n      window.sessionStorage.setItem('tab_id', newTabId);\n      window.localStorage.setItem('last_tab_id', newTabId);\n      setTabId(newTabId);\n    };\n\n    const storedTabId = window.sessionStorage.getItem('tab_id');\n    if (storedTabId) {\n      channel.postMessage({\n        type: 'REQUESTING_TAB_ID',\n        tabId: storedTabId,\n      });\n      setTabId(storedTabId);\n    } else {\n      updateTabId();\n    }\n\n    channel.onmessage = messageEvent => {\n      if (messageEvent.tabId === tabId) {\n        if (messageEvent.type === 'REQUESTING_TAB_ID') {\n          const message: TabIdChannelMessage = {\n            type: 'TAB_ID_DENIED',\n            tabId: messageEvent.tabId,\n          };\n          channel.postMessage(message);\n        } else if (messageEvent.type === 'TAB_ID_DENIED') {\n          updateTabId();\n        }\n      }\n    };\n  }, [tabId]);\n\n  return tabId;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { SyntheticEvent } from 'react';\nimport domToImage from 'dom-to-image-more';\nimport kebabCase from 'lodash/kebabCase';\nimport { t } from '@superset-ui/core';\nimport { addWarningToast } from 'src/components/MessageToasts/actions';\n\n/**\n * @remark\n * same as https://github.com/apache/superset/blob/c53bc4ddf9808a8bb6916bbe3cb31935d33a2420/superset-frontend/src/assets/stylesheets/less/variables.less#L34\n */\nconst GRAY_BACKGROUND_COLOR = '#F5F5F5';\n\n/**\n * generate a consistent file stem from a description and date\n *\n * @param description title or description of content of file\n * @param date date when file was generated\n */\nconst generateFileStem = (description: string, date = new Date()) =>\n  `${kebabCase(description)}-${date.toISOString().replace(/[: ]/g, '-')}`;\n\n/**\n * Create an event handler for turning an element into an image\n *\n * @param selector css selector of the parent element which should be turned into image\n * @param description name or a short description of what is being printed.\n *   Value will be normalized, and a date as well as a file extension will be added.\n * @param isExactSelector if false, searches for the closest ancestor that matches selector.\n * @returns event handler\n */\nexport default function downloadAsImage(\n  selector: string,\n  description: string,\n  isExactSelector = false,\n) {\n  return (event: SyntheticEvent) => {\n    const elementToPrint = isExactSelector\n      ? document.querySelector(selector)\n      : event.currentTarget.closest(selector);\n\n    if (!elementToPrint) {\n      return addWarningToast(\n        t('Image download failed, please refresh and try again.'),\n      );\n    }\n\n    // Mapbox controls are loaded from different origin, causing CORS error\n    // See https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/toDataURL#exceptions\n    const filter = (node: Element) => {\n      if (typeof node.className === 'string') {\n        return (\n          node.className !== 'mapboxgl-control-container' &&\n          !node.className.includes('ant-dropdown')\n        );\n      }\n      return true;\n    };\n\n    return domToImage\n      .toJpeg(elementToPrint, {\n        quality: 0.95,\n        bgcolor: GRAY_BACKGROUND_COLOR,\n        filter,\n      })\n      .then(dataUrl => {\n        const link = document.createElement('a');\n        link.download = `${generateFileStem(description)}.jpg`;\n        link.href = dataUrl;\n        link.click();\n      })\n      .catch(e => {\n        console.error('Creating image failed', e);\n      });\n  };\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '@superset-ui/core';\n\nexport const getChartRequiredFieldsMissingMessage = (isCreating: boolean) =>\n  t(\n    'Select values in highlighted field(s) in the control panel. Then run the query by clicking on the %s button.',\n    isCreating ? '\"Create chart\"' : '\"Update chart\"',\n  );\n"],"names":["propTypes","annotationData","PropTypes","actions","chartId","datasource","initialValues","formData","latestQueryFormData","labelColors","sharedLabelColors","height","width","setControlValue","vizType","triggerRender","chartAlert","chartStatus","queriesResponse","triggerQuery","chartIsStale","addFilter","setDataMask","onFilterMenuOpen","onFilterMenuClose","ownState","postTransformProps","source","BLANK","behaviors","Behavior","defaultProps","ChartRenderer","React","constructor","props","super","this","hasQueryResponseChange","handleAddFilter","bind","handleRenderSuccess","handleRenderFailure","handleSetControlValue","hooks","onAddFilter","onError","dataMask","updateDataMask","shouldComponentUpdate","nextProps","indexOf","error","filterState","color_scheme","stack","cacheBusterProp","col","vals","merge","refresh","chartRenderingSucceeded","logEvent","LOG_ACTIONS_RENDER_CHART","slice_id","viz_type","start_offset","renderStartTime","ts","Date","getTime","duration","Logger","info","logging","chartRenderingFailed","toString","componentStack","has_err","error_details","args","render","currentFormData","snakeCaseVizType","chartClassName","noResultsComponent","noResultTitle","t","noResultDescription","undefined","noResultImage","EmptyState","title","description","image","SuperChart","disableErrorBoundary","key","id","className","chartType","queriesData","onRenderSuccess","onRenderFailure","noResults","ChartErrorMessage","result","owners","ownedError","extra","ErrorMessageWithStackTrace","dashboardId","timeout","force","isFiltersInitialized","isDeactivatedViz","chartStackTrace","errorMessage","onQuery","datasetsStatus","NONEXISTENT_DATASET","Styles","styled","p","theme","typography","sizes","s","MonospaceDiv","families","monospace","Chart","handleRenderContainerFailure","componentDidMount","filterboxMigrationState","runQuery","componentDidUpdate","isFeatureEnabled","FeatureFlag","getSavedChart","getUrlParam","URL_PARAMS","postChartFormData","renderErrorMessage","queryResponse","errors","message","PLACEHOLDER_DATASOURCE","ResourceStatus","Loading","subtitle","copyText","link","stackTrace","isLoading","renderContainerStartTime","map","item","ensureIsArray","length","getChartRequiredFieldsMissingMessage","ErrorBoundary","showMessage","role","tabIndex","onClick","connect","dispatch","bindActionCreators","componentShape","type","Object","values","componentTypes","isRequired","parents","children","meta","headerSize","headerStyleOptions","opt","value","background","backgroundStyleOptions","chartPropShape","chartUpdateEndTime","chartUpdateStartTime","queryController","abort","lastRendered","slicePropShape","slice_url","slice_name","datasource_name","datasource_link","changed_on","modified","description_markeddown","dashboardFilterPropShape","componentId","filterName","datasourceId","directPathToFilter","isDateFilter","isInstantFilter","columns","labels","scopes","dashboardStatePropShape","sliceIds","expandedSlices","editMode","isPublished","colorNamespace","colorScheme","updatedColorScheme","hasUnsavedChanges","dashboardInfoPropShape","metadata","slug","dash_edit_perm","dash_save_perm","common","userId","leafType","label","parentShape","f","apply","arguments","filterScopeSelectorTreeNodePropShape","CopyButtonEmbedCode","CopyButton","gridUnit","addDangerToast","setHeight","useState","setWidth","url","setUrl","setErrorMessage","handleInputChange","useCallback","e","name","currentTarget","updateUrl","getChartPermalink","then","catch","useEffect","html","useMemo","srcLink","text","css","CopyToClipboard","shouldShowText","copyNode","buttonSize","disabled","rows","readOnly","colors","secondary","light5","htmlFor","Input","defaultValue","onChange","MENU_KEYS","VIZ_TYPES_PIVOTABLE","MenuItemWithCheckboxContainer","useExploreAdditionalActionsMenu","Button","primary","dark2","light1","canDownloadCSV","slice","onOpenInEditor","onOpenPropertiesModal","useTheme","addSuccessToast","useToasts","showReportSubMenu","setShowReportSubMenu","isDropdownVisible","setIsDropdownVisible","openSubmenus","setOpenSubmenus","charts","useSelector","state","chart","chartsValues","sqlSupported","split","shareByEmail","async","subject","body","encodeURIComponent","window","location","href","exportCSV","exportChart","resultType","resultFormat","exportCSVPivoted","exportJson","copyLink","Error","copyTextToClipboard","handleMenuClick","domEvent","downloadAsImage","Menu","selectable","openKeys","onOpenChange","includes","icon","FileOutlined","FileImageOutlined","ModalTrigger","triggerNode","modalTitle","modalBody","maxWidth","destroyOnClose","responsive","useTextMenu","ViewQueryModal","draggable","resizable","certifiedBy","details","size","iconColor","base","iconSize","LOCALE","everyText","emptyMonths","emptyMonthDays","emptyMonthDaysShort","emptyWeekDays","emptyWeekDaysShort","emptyHours","emptyMinutes","emptyMinutesForHourPeriod","yearOption","monthOption","weekOption","dayOption","hourOption","minuteOption","rebootOption","prefixPeriod","prefixMonths","prefixMonthDays","prefixWeekDays","prefixWeekDaysForMonthAndYearPeriod","prefixHours","prefixMinutes","prefixMinutesForHourPeriod","suffixMinutesForHourPeriod","errorInvalidCron","clearButtonText","weekDays","months","altWeekDays","altMonths","CronPicker","style","getPopupContainer","trigger","parentElement","locale","grayscale","light4","StyledDiv","DescriptionContainer","DeleteModal","onConfirm","onHide","open","disableChange","setDisableChange","confirmation","setConfirmation","confirm","disablePrimaryButton","onHandledPrimaryAction","primaryButtonName","primaryButtonType","show","autoComplete","event","targetValue","target","toUpperCase","onPressEnter","MenuDots","weights","normal","MenuDotsWrapper","Dropdown","overlay","rest","NoAnimationDropdown","overlayStyle","zIndex","animationDuration","StyledLink","xl","itemId","isStarred","showTooltip","saveFaveStar","fetchFaveStar","preventDefault","content","titleStyles","bold","DynamicEditableTitle","placeholder","onSave","canEdit","isEditing","setIsEditing","currentTitle","setCurrentTitle","contentRef","useRef","setShowTooltip","inputWidth","ref","sizerRef","containerWidth","containerRef","refreshMode","current","focus","setSelectionRange","scrollLeft","scrollWidth","useLayoutEffect","innerHTML","replace","clientWidth","handleClick","handleBlur","formattedTitle","trim","handleChange","ev","handleKeyPress","blur","Tooltip","onBlur","onKeyPress","menuTriggerStyles","headerStyles","buttonsStyles","additionalActionsContainerStyles","PageHeaderWithActions","editableTitleProps","showTitlePanelItems","certificatiedBadgeProps","showFaveStar","faveStarProps","titlePanelAdditionalItems","rightPanelAdditionalItems","additionalActionsMenu","menuDropdownProps","CertifiedBadge","FaveStar","buttonStyle","Icons","ReportType","NOTIFICATION_FORMATS","StyledModal","Modal","StyledTopSection","StyledBottomSection","light2","StyledIconWrapper","StyledScheduleTitle","StyledCronPicker","StyledCronError","noBottomMargin","StyledFooterButton","StyledMessageContentTitle","StyledRadio","Radio","StyledRadioGroup","TEXT_BASED_VISUALIZATION_TYPES","INITIAL_STATE","crontab","withToasts","userEmail","creationMethod","dashboardName","chartName","sliceFormData","isChart","isTextBasedChart","defaultNotificationFormat","entityName","initialState","reportReducer","action","currentReport","setCurrentReport","useReducer","cronError","setCronError","report","resourceType","CreationMethod","isEditMode","keys","wrappedTitle","renderModalFooter","newReportValues","active","force_screenshot","creation_method","dashboard","recipients","recipient_config_json","report_format","timezone","isSubmitting","getClientErrorObject","loading","renderMessageContentSection","TEXT","PNG","CSV","footer","centered","LabeledErrorBoundInput","required","validationMethods","SectionHeaderStyle","clearButton","setValue","newValue","TimezoneHeaderStyle","TimezoneSelector","onTimezoneChange","Alert","m","l","antDErrorAlertStyles","deleteColor","onMenuHover","dark1","onMenuItemHover","HeaderReportDropDown","DASHBOARDS","CHARTS","isReportActive","user","explore","canAddReports","roles","filter","perms","currentReportDeleting","setCurrentReportDeleting","prevDashboard","usePrevious","showModal","setShowModal","toggleActiveKey","data","checked","shouldFetch","filterField","resourceId","handleShowMenu","email","Checkbox","Switch","marginLeft","closest","handleReportDelete","StyledSwitch","DEFAULT_TIMEZONE","offsetsToName","currentDate","JANUARY","JULY","getOffsetKey","tz","utcOffset","getTimezoneName","offsets","isDST","ALL_ZONES","country","flat","TIMEZONES","forEach","zone","find","option","push","TIMEZONE_OPTIONS","format","timezoneName","TIMEZONE_OPTIONS_SORT_COMPARATOR","a","b","minWidth","validTimezone","matchTimezoneToOptions","ariaLabel","options","sortComparator","sort","uid","table_name","column_types","metrics","column_format","verbose_map","main_dttm_col","MAIN_HEADER_HEIGHT","CLOSED_FILTER_BAR_WIDTH","OPEN_FILTER_BAR_WIDTH","FILTER_BAR_HEADER_HEIGHT","FILTER_BAR_TABS_HEIGHT","BUILDER_SIDEPANEL_WIDTH","CellNull","CopyToClipboardButton","wrapped","FilterInput","onChangeHandler","debouncedChangeHandler","prefix","filterText","RowCount","rowcount","FormatPickerValue","FormatPicker","direction","Formatted","Original","FormatPickerContainer","FormatPickerLabel","DataTableTemporalHeaderCell","columnName","onTimeColumnChange","isOriginalTimeColumn","overlayContent","stopPropagation","styles","overlayClassName","placement","arrowPointAtCenter","marginRight","useFilteredTableData","rowsAsStrings","row","toLowerCase","_","index","some","timeFormatter","useTableColumns","colnames","coltypes","isVisible","moreConfigs","originalFormattedTimeColumns","setOriginalFormattedTimeColumns","columnType","cols","splice","column","colType","firstValue","originalFormattedTimeColumnIndex","accessor","Header","Cell","String","getTimeColumns","colsMap","setTimeColumns","ResultTypes","queryObjectCount","mixed_timeseries","TableControlsWrapper","TableControls","onInputChange","columnNames","columnTypes","originalTimeColumns","formattedTimeColumns","colname","formattedData","SingleQueryResultPane","dataSize","setFilterText","filteredData","input","TableView","pageSize","noDataText","emptyWrapperType","isPaginationSticky","showRowCount","small","cache","WeakSet","useResultsPane","isRequest","queryFormData","queryForce","resultResp","setResultResp","setIsLoading","responseError","setResponseError","queryCount","has","getChartDataRequest","json","add","setForceQuery","response","finally","Array","fill","err","idx","ResultsPaneOnDashboard","resultsPanes","panes","pane","Tabs","tab","Results","fullWidth","SamplesPane","setData","setColnames","setColtypes","delete","getDatasetSamples","SouthPane","DataTablesPane","onCollapseChange","activeTabKey","setActiveTabKey","setIsRequest","results","samples","panelOpen","setPanelOpen","startsWith","Samples","handleCollapseChange","isOpen","handleTabClick","tabKey","CollapseButton","caretIcon","queryResultsPanes","tabBarExtraContent","activeKey","onTabClick","RowCountLabel","limit","limitReached","formattedRowCount","tn","CopyButtonViewQuery","StyledSyntaxContainer","StyledSyntaxHighlighter","setResult","setError","statusText","JSON","stringify","query","language","TEMPORARY_CONTROLS","sanitizeFormData","assembleEndpoint","tabId","endpoint","concat","assemblePayload","datasourceType","payload","datasource_id","datasource_type","form_data","chart_id","postFormData","jsonPayload","r","putFormData","useChangeEffect","callback","previous","channel","useTabId","setTabId","updateTabId","lastTabId","localStorage","getItem","newTabId","Number","parseInt","sessionStorage","setItem","storedTabId","postMessage","onmessage","messageEvent","selector","isExactSelector","elementToPrint","document","querySelector","quality","bgcolor","node","dataUrl","createElement","download","date","toISOString","generateFileStem","click","console","isCreating"],"sourceRoot":""}