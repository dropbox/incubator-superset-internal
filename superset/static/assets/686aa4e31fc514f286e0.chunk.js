"use strict";(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[8551],{88551:(e,t,n)=>{n.r(t),n.d(t,{default:()=>y});var r=n(78580),l=n.n(r),a=n(67294),o=n(16355),s=n(5364),u=n(51115),c=n(67190),i=n(10581),d=n(63475),f=n(6915),h=n(51995),g=n(356),p=n(49239),m=n(11965);const{RadioButtonControl:v}=g.Z,b=h.iK.div`
  text-align: center;
`;function C(e){let{formData:t,setControlValue:n}=e;const{extraControlsOptions:r,extraControlsHandler:l,extraValue:o}=function(e){let{formData:t,setControlValue:n}=e;const{stack:r,area:l}=t,[o,s]=(0,a.useState)(null!=r?r:void 0);return(0,a.useEffect)((()=>{s(r)}),[r]),{extraControlsOptions:(0,a.useMemo)((()=>l?p.Df:[]),[l]),extraControlsHandler:(0,a.useCallback)((e=>{l&&n&&(n("stack",e),s(e))}),[l,n]),extraValue:o}}({formData:t,setControlValue:n});return t.showExtraControls?(0,m.tZ)(b,null,(0,m.tZ)(v,{options:r,onChange:l,value:o})):null}function y(e){let{formData:t,height:n,width:r,echartOptions:h,groupby:g,labelMap:p,selectedValues:v,setDataMask:b,setControlValue:y,legendData:w=[],onContextMenu:k,xValueFormatter:x,xAxis:E,refs:V,emitCrossFilters:I,coltypeMapping:S}=e;const{stack:Z}=t,D=(0,a.useRef)(null);V.echartRef=D;const R=(0,a.useRef)(Date.now()),O=(0,a.useRef)(""),F=(0,a.useRef)(),M=(0,a.useRef)(null),[H,A]=(0,a.useState)(0);(0,a.useEffect)((()=>{var e;const t=(null==(e=M.current)?void 0:e.offsetHeight)||0;A(t)}),[t.showExtraControls]);const T=(0,a.useCallback)((e=>{var t;const n=null==(t=D.current)?void 0:t.getEchartInstance();e?w.forEach((t=>{t===e?(f.aI.legend=t,null==n||n.dispatchAction({type:"legendSelect",name:t})):null==n||n.dispatchAction({type:"legendUnSelect",name:t})})):(f.aI.legend="",null==n||n.dispatchAction({type:"legendAllSelect"}))}),[w]),j=(0,a.useCallback)((e=>{const t=Object.values(v);let n;n=l()(t).call(t,e)?t.filter((t=>t!==e)):[e];const r=n.map((e=>p[e]));return{dataMask:{extraFormData:{filters:0===n.length?[]:g.map(((e,t)=>{const n=r.map((e=>e[t]));return null==n?{col:e,op:"IS NULL"}:{col:e,op:"IN",val:n}}))},filterState:{label:r.length?r:void 0,value:r.length?r:null,selectedValues:n.length?n:null}},isCurrentValueSelected:l()(t).call(t,e)}}),[g,p,v]),N=(0,a.useCallback)((e=>{I&&b(j(e).dataMask)}),[I,b,j]),z={click:e=>{F.current&&clearTimeout(F.current),F.current=setTimeout((()=>{const{seriesName:t}=e;N(t)}),300)},mouseout:()=>{f.aI.name=""},mouseover:e=>{f.aI.name=e.seriesName},legendselectchanged:e=>{const t=Date.now();t-R.current<300&&O.current===e.name?T(e.name):(R.current=t,O.current=e.name),Object.values(e.selected).every((e=>!e))&&T()},contextmenu:async e=>{if(k){var n;e.event.stop();const{data:r,seriesName:l}=e,a=[],d=[],h=e.event.event,g=[...e.name?[e.name]:[],...null!=(n=p[l])?n:[]];r&&E.type===o.we.time&&a.push({col:E.label===s.W3?t.granularitySqla:E.label,grain:t.timeGrainSqla,op:"==",val:r[0],formattedVal:x(r[0])}),[...E.type===o.we.category&&r?[E.label]:[],...t.groupby].forEach(((e,t)=>a.push({col:e,op:"==",val:g[t],formattedVal:String(g[t])}))),t.groupby.forEach(((e,n)=>{const r=p[l][n];d.push({col:e,op:"==",val:r,formattedVal:(0,f.mj)(g[n],{timeFormatter:(0,u.bt)(t.dateFormat),numberFormatter:(0,c.JB)(t.numberFormat),coltype:null==S?void 0:S[(0,i.Z)(e)]})})})),k(h.clientX,h.clientY,{drillToDetail:a,crossFilter:j(l),drillBy:{filters:d,groupbyFieldName:"groupby"}})}}},B={dblclick:e=>{var t;F.current&&clearTimeout(F.current);const n=[e.offsetX,e.offsetY],r=null==(t=D.current)?void 0:t.getEchartInstance();if(null!=r&&r.containPixel("grid",n)){var l;if(!Z&&"ec-polygon"===(null==(l=e.target)?void 0:l.type))return;const t=r.getModel(),n=((e,t)=>{let n=e,r=null;for(;n;){const e=n.__ecComponentInfo;if(null!=e){r=t.getComponent(e.mainType,e.index);break}n=n.parent}return r})(e.target,t),a=t.getSeriesCount(),o=t.getCurrentSeriesIndices();if(n){const{name:e}=n;a!==o.length?T():T(e)}}}};return(0,m.tZ)(a.Fragment,null,(0,m.tZ)("div",{ref:M},(0,m.tZ)(C,{formData:t,setControlValue:y})),(0,m.tZ)(d.Z,{refs:V,height:n-H,width:r,echartOptions:h,eventHandlers:z,zrEventHandlers:B,selectedValues:v}))}},63475:(e,t,n)=>{n.d(t,{Z:()=>d});var r=n(78580),l=n.n(r),a=n(67294),o=n(51995),s=n(31431),u=n(11965);const c=o.iK.div`
  height: ${e=>{let{height:t}=e;return t}};
  width: ${e=>{let{width:t}=e;return t}};
`;function i(e,t){let{width:n,height:r,echartOptions:o,eventHandlers:i,zrEventHandlers:d,selectedValues:f={},refs:h}=e;const g=(0,a.useRef)(null);h&&(h.divRef=g);const p=(0,a.useRef)(),m=(0,a.useMemo)((()=>Object.keys(f)||[]),[f]),v=(0,a.useRef)([]);(0,a.useImperativeHandle)(t,(()=>({getEchartInstance:()=>p.current}))),(0,a.useEffect)((()=>{g.current&&(p.current||(p.current=(0,s.S1)(g.current)),Object.entries(i||{}).forEach((e=>{var t,n;let[r,l]=e;null==(t=p.current)||t.off(r),null==(n=p.current)||n.on(r,l)})),Object.entries(d||{}).forEach((e=>{var t,n;let[r,l]=e;null==(t=p.current)||t.getZr().off(r),null==(n=p.current)||n.getZr().on(r,l)})),p.current.setOption(o,!0))}),[o,i,d]),(0,a.useEffect)((()=>{p.current&&(p.current.dispatchAction({type:"downplay",dataIndex:v.current.filter((e=>!l()(m).call(m,e)))}),m.length&&p.current.dispatchAction({type:"highlight",dataIndex:m}),v.current=m)}),[m]);const b=(0,a.useCallback)((e=>{let{width:t,height:n}=e;p.current&&p.current.resize({width:t,height:n})}),[]);return(0,a.useEffect)((()=>(b({width:n,height:r}),()=>{var e;return null==(e=p.current)?void 0:e.dispose()})),[]),(0,a.useLayoutEffect)((()=>{b({width:n,height:r})}),[n,r,b]),(0,u.tZ)(c,{ref:g,height:r,width:n})}const d=(0,a.forwardRef)(i)}}]);
//# sourceMappingURL=686aa4e31fc514f286e0.chunk.js.map