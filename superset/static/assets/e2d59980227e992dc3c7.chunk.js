(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[4192,7893],{28569:(e,t,i)=>{"use strict";i.d(t,{Z:()=>u});var o=i(95772),r=i(93844),s=i(51331),a=i(281),n=i(53982);const l=[0,0,0,255],c={radiusUnits:"meters",radiusScale:{type:"number",min:0,value:1},radiusMinPixels:{type:"number",min:0,value:0},radiusMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},lineWidthUnits:"meters",lineWidthScale:{type:"number",min:0,value:1},lineWidthMinPixels:{type:"number",min:0,value:0},lineWidthMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},stroked:!1,filled:!0,billboard:!1,getPosition:{type:"accessor",value:e=>e.position},getRadius:{type:"accessor",value:1},getFillColor:{type:"accessor",value:l},getLineColor:{type:"accessor",value:l},getLineWidth:{type:"accessor",value:1},strokeWidth:{deprecatedFor:"getLineWidth"},outline:{deprecatedFor:"stroked"},getColor:{deprecatedFor:["getFillColor","getLineColor"]}};class u extends o.Z{getShaders(){return super.getShaders({vs:"#define SHADER_NAME scatterplot-layer-vertex-shader\n\nattribute vec3 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceRadius;\nattribute float instanceLineWidths;\nattribute vec4 instanceFillColors;\nattribute vec4 instanceLineColors;\nattribute vec3 instancePickingColors;\n\nuniform float opacity;\nuniform float radiusScale;\nuniform float radiusMinPixels;\nuniform float radiusMaxPixels;\nuniform float lineWidthScale;\nuniform float lineWidthMinPixels;\nuniform float lineWidthMaxPixels;\nuniform float stroked;\nuniform bool filled;\nuniform bool billboard;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  outerRadiusPixels = clamp(\n    project_size_to_pixel(radiusScale * instanceRadius),\n    radiusMinPixels, radiusMaxPixels\n  );\n  float lineWidthPixels = clamp(\n    project_size_to_pixel(lineWidthScale * instanceLineWidths),\n    lineWidthMinPixels, lineWidthMaxPixels\n  );\n  outerRadiusPixels += stroked * lineWidthPixels / 2.0;\n  unitPosition = positions.xy;\n  geometry.uv = unitPosition;\n  geometry.pickingColor = instancePickingColors;\n\n  innerUnitRadius = 1.0 - stroked * lineWidthPixels / outerRadiusPixels;\n  \n  if (billboard) {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = positions * outerRadiusPixels;\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n  } else {\n    vec3 offset = positions * project_pixel_size(outerRadiusPixels);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset, geometry.position);\n  }\n\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n  vFillColor = vec4(instanceFillColors.rgb, instanceFillColors.a * opacity);\n  DECKGL_FILTER_COLOR(vFillColor, geometry);\n  vLineColor = vec4(instanceLineColors.rgb, instanceLineColors.a * opacity);\n  DECKGL_FILTER_COLOR(vLineColor, geometry);\n}\n",fs:"#define SHADER_NAME scatterplot-layer-fragment-shader\n\nprecision highp float;\n\nuniform bool filled;\nuniform float stroked;\n\nvarying vec4 vFillColor;\nvarying vec4 vLineColor;\nvarying vec2 unitPosition;\nvarying float innerUnitRadius;\nvarying float outerRadiusPixels;\n\nvoid main(void) {\n  geometry.uv = unitPosition;\n\n  float distToCenter = length(unitPosition) * outerRadiusPixels;\n  float inCircle = smoothedge(distToCenter, outerRadiusPixels);\n\n  if (inCircle == 0.0) {\n    discard;\n  }\n\n  if (stroked > 0.5) {\n    float isLine = smoothedge(innerUnitRadius * outerRadiusPixels, distToCenter);\n    if (filled) {\n      gl_FragColor = mix(vFillColor, vLineColor, isLine);\n    } else {\n      if (isLine == 0.0) {\n        discard;\n      }\n      gl_FragColor = vec4(vLineColor.rgb, vLineColor.a * isLine);\n    }\n  } else if (filled) {\n    gl_FragColor = vFillColor;\n  } else {\n    discard;\n  }\n\n  gl_FragColor.a *= inCircle;\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[r.Z,s.Z]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceRadius:{size:1,transition:!0,accessor:"getRadius",defaultValue:1},instanceFillColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getFillColor",defaultValue:[0,0,0,255]},instanceLineColors:{size:this.props.colorFormat.length,transition:!0,normalized:!0,type:5121,accessor:"getLineColor",defaultValue:[0,0,0,255]},instanceLineWidths:{size:1,transition:!0,accessor:"getLineWidth",defaultValue:1}})}updateState({props:e,oldProps:t,changeFlags:i}){if(super.updateState({props:e,oldProps:t,changeFlags:i}),i.extensionsChanged){var o;const{gl:e}=this.context;null===(o=this.state.model)||void 0===o||o.delete(),this.state.model=this._getModel(e),this.getAttributeManager().invalidateAll()}}draw({uniforms:e}){const{viewport:t}=this.context,{radiusUnits:i,radiusScale:o,radiusMinPixels:r,radiusMaxPixels:s,stroked:a,filled:n,billboard:l,lineWidthUnits:c,lineWidthScale:u,lineWidthMinPixels:d,lineWidthMaxPixels:p}=this.props,h="pixels"===i?t.metersPerPixel:1,g="pixels"===c?t.metersPerPixel:1;this.state.model.setUniforms(e).setUniforms({stroked:a?1:0,filled:n,billboard:l,radiusScale:o*h,radiusMinPixels:r,radiusMaxPixels:s,lineWidthScale:u*g,lineWidthMinPixels:d,lineWidthMaxPixels:p}).draw()}_getModel(e){return new a.Z(e,{...this.getShaders(),id:this.props.id,geometry:new n.Z({drawMode:6,vertexCount:4,attributes:{positions:{size:3,value:new Float32Array([-1,-1,0,1,-1,0,1,1,0,-1,1,0])}}}),isInstanced:!0})}}u.layerName="ScatterplotLayer",u.defaultProps=c},50600:(e,t,i)=>{"use strict";i.d(t,{Z:()=>c});var o=i(67294),r=i(45697),s=i.n(r),a=i(50855);const n=" - ",l={categories:s().object,forceCategorical:s().bool,format:s().string,position:s().oneOf([null,"tl","tr","bl","br"]),showSingleCategory:s().func,toggleCategory:s().func};class c extends o.PureComponent{format(e){if(!this.props.format||this.props.forceCategorical)return e;const t=parseFloat(e);return(0,a.uf)(this.props.format,t)}formatCategoryLabel(e){if(!this.props.format)return e;if(e.includes(n)){const t=e.split(n);return this.format(t[0])+n+this.format(t[1])}return this.format(e)}render(){if(0===Object.keys(this.props.categories).length||null===this.props.position)return null;const e=Object.entries(this.props.categories).map((e=>{let[t,i]=e;const r={color:"rgba("+i.color.join(", ")+")"},s=i.enabled?"◼":"◻";return o.createElement("li",{key:t},o.createElement("a",{href:"#",onClick:()=>this.props.toggleCategory(t),onDoubleClick:()=>this.props.showSingleCategory(t)},o.createElement("span",{style:r},s)," ",this.formatCategoryLabel(t)))})),t={position:"absolute",["t"===this.props.position.charAt(0)?"top":"bottom"]:"0px",["r"===this.props.position.charAt(1)?"right":"left"]:"10px"};return o.createElement("div",{className:"legend",style:t},o.createElement("ul",{className:"categories"},e))}}c.propTypes=l,c.defaultProps={categories:{},forceCategorical:!1,format:null,position:"tr",showSingleCategory:()=>{},toggleCategory:()=>{}}},52598:(e,t,i)=>{"use strict";i.d(t,{B:()=>w,G:()=>R});var o=i(67294),r=i(45697),s=i.n(r),a=i(96486),n=i(85011),l=i(83527),c=i(89759),u=i(50600),d=i(15191),p=i(57485),h=i(88574),g=i(50980);function f(){return f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},f.apply(this,arguments)}function m(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}const{getScale:y}=l,b={datasource:s().object.isRequired,formData:s().object.isRequired,getLayer:s().func.isRequired,getPoints:s().func.isRequired,height:s().number.isRequired,mapboxApiKey:s().string.isRequired,onAddFilter:s().func,payload:s().object.isRequired,setControlValue:s().func.isRequired,viewport:s().object.isRequired,width:s().number.isRequired};class v extends o.PureComponent{constructor(e){super(e),m(this,"containerRef",o.createRef()),m(this,"setTooltip",(e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)})),this.state=this.getStateFromProps(e),this.getLayers=this.getLayers.bind(this),this.onValuesChange=this.onValuesChange.bind(this),this.toggleCategory=this.toggleCategory.bind(this),this.showSingleCategory=this.showSingleCategory.bind(this)}UNSAFE_componentWillReceiveProps(e){e.payload.form_data!==this.state.formData&&this.setState(f({},this.getStateFromProps(e)))}onValuesChange(e){this.setState({values:Array.isArray(e)?e:[e,e+this.state.getStep(e)]})}getStateFromProps(e,t){const i=e.payload.data.features||[],o=i.map((e=>e.__timestamp)),r=function(e,t){const i=e.color_picker||{r:0,g:0,b:0,a:1},o=[i.r,i.g,i.b,255*i.a],r=y(e.color_scheme),s={};return t.forEach((t=>{if(null!=t.cat_color&&!s.hasOwnProperty(t.cat_color)){let a;a=e.dimension?(0,d.hexToRGB)(r(t.cat_color),255*i.a):o,s[t.cat_color]={color:a,enabled:!0}}})),s}(e.formData,i);if(t&&e.payload.form_data===t.formData)return f({},t,{categories:r});const s=e.payload.form_data.time_grain_sqla||e.payload.form_data.granularity||"P1D",{start:a,end:n,getStep:l,values:c,disabled:u}=(0,p.g)(o,s),{width:h,height:m,formData:b}=e;let{viewport:v}=e;return b.autozoom&&(v=(0,g.Z)(v,{width:h,height:m,points:e.getPoints(i)})),v.zoom<0&&(v.zoom=0),{start:a,end:n,getStep:l,values:c,disabled:u,viewport:v,selected:[],lastClick:0,formData:e.payload.form_data,categories:r}}getLayers(e){const{getLayer:t,payload:i,formData:o,onAddFilter:r}=this.props;let s=i.data.features?[...i.data.features]:[];s=this.addColor(s,o),o.js_data_mutator&&(s=(0,h.Z)(o.js_data_mutator)(s)),s=e[0]===e[1]||e[1]===this.end?s.filter((t=>t.__timestamp>=e[0]&&t.__timestamp<=e[1])):s.filter((t=>t.__timestamp>=e[0]&&t.__timestamp<e[1]));const a=this.state.categories;return o.dimension&&(s=s.filter((e=>a[e.cat_color]&&a[e.cat_color].enabled))),[t(o,f({},i,{data:f({},i.data,{features:s})}),r,this.setTooltip,this.props.datasource)]}addColor(e,t){const i=t.color_picker||{r:0,g:0,b:0,a:1},o=y(t.color_scheme);return e.map((e=>{let r;return t.dimension?(r=(0,d.hexToRGB)(o(e.cat_color),255*i.a),f({},e,{color:r})):e}))}toggleCategory(e){const t=this.state.categories[e],i=f({},this.state.categories,{[e]:f({},t,{enabled:!t.enabled})});Object.values(i).every((e=>!e.enabled))&&Object.values(i).forEach((e=>{e.enabled=!0})),this.setState({categories:i})}showSingleCategory(e){const t=f({},this.state.categories);Object.values(t).forEach((e=>{e.enabled=!1})),t[e].enabled=!0,this.setState({categories:t})}render(){return o.createElement("div",{style:{position:"relative"}},o.createElement(c.Z,{ref:this.containerRef,getLayers:this.getLayers,start:this.state.start,end:this.state.end,getStep:this.state.getStep,values:this.state.values,disabled:this.state.disabled,viewport:this.state.viewport,mapboxApiAccessToken:this.props.mapboxApiKey,mapStyle:this.props.formData.mapbox_style,setControlValue:this.props.setControlValue,width:this.props.width,height:this.props.height},o.createElement(u.Z,{forceCategorical:!0,categories:this.state.categories,format:this.props.formData.legend_format,position:this.props.formData.legend_position,showSingleCategory:this.showSingleCategory,toggleCategory:this.toggleCategory})))}}function C(){return C=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},C.apply(this,arguments)}function _(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}v.propTypes=b;const P={datasource:s().object.isRequired,formData:s().object.isRequired,height:s().number.isRequired,onAddFilter:s().func,payload:s().object.isRequired,setControlValue:s().func.isRequired,viewport:s().object.isRequired,width:s().number.isRequired},x={onAddFilter(){}};function R(e,t){class i extends o.PureComponent{constructor(e){super(e),_(this,"containerRef",o.createRef()),_(this,"setTooltip",(e=>{const{current:t}=this.containerRef;t&&t.setTooltip(e)}));const{width:i,height:r,formData:s}=e;let{viewport:a}=e;s.autozoom&&(a=(0,g.Z)(a,{width:i,height:r,points:t(e.payload.data.features)})),this.state={viewport:a,layer:this.computeLayer(e)},this.onViewportChange=this.onViewportChange.bind(this)}UNSAFE_componentWillReceiveProps(e){const t=C({},e.formData,{viewport:null}),i=C({},this.props.formData,{viewport:null});(0,a.isEqual)(t,i)&&e.payload===this.props.payload||this.setState({layer:this.computeLayer(e)})}onViewportChange(e){this.setState({viewport:e})}computeLayer(t){const{formData:i,payload:o,onAddFilter:r}=t;return e(i,o,r,this.setTooltip)}render(){const{formData:e,payload:t,setControlValue:i,height:r,width:s}=this.props,{layer:a,viewport:l}=this.state;return o.createElement(n.Z,{ref:this.containerRef,mapboxApiAccessToken:t.data.mapboxApiKey,viewport:l,layers:[a],mapStyle:e.mapbox_style,setControlValue:i,width:s,height:r,onViewportChange:this.onViewportChange})}}return i.propTypes=P,i.defaultProps=x,i}function w(e,t){function i(i){const{datasource:r,formData:s,height:a,payload:n,setControlValue:l,viewport:c,width:u}=i;return o.createElement(v,{datasource:r,formData:s,mapboxApiKey:n.data.mapboxApiKey,setControlValue:l,viewport:c,getLayer:e,payload:n,getPoints:t,width:u,height:a})}return i.propTypes=P,i.defaultProps=x,i}},4598:(e,t,i)=>{"use strict";i.r(t),i.d(t,{default:()=>h,getLayer:()=>p});var o=i(28569),r=i(67294),s=i(95669),a=i(60650),n=i(37032),l=i(52598),c=i(57981);const u=1609.34;function d(){return d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e},d.apply(this,arguments)}function p(e,t,i,l,p){const h=e,g=t.data.features.map((e=>{let t=(i=h.point_unit,o=e.radius,("square_m"===i?Math.sqrt(o/Math.PI):"radius_m"===i?o:"radius_km"===i?1e3*o:"radius_miles"===i?o*u:"square_km"===i?1e3*Math.sqrt(o/Math.PI):"square_miles"===i?Math.sqrt(o/Math.PI)*u:null)||10);var i,o;if(h.multiplier&&(t*=h.multiplier),e.color)return d({},e,{radius:t});const r=h.color_picker||{r:0,g:0,b:0,a:1};return d({},e,{radius:t,color:[r.r,r.g,r.b,255*r.a]})}));return new o.Z(d({id:"scatter-layer-"+h.slice_id,data:g,fp64:!0,getFillColor:e=>e.color,getRadius:e=>e.radius,radiusMinPixels:h.min_radius||null,radiusMaxPixels:h.max_radius||null,stroked:!1},(0,n.N)(h,l,function(e,t){return i=>{var o;const n=(null==t?void 0:t[e.point_radius_fixed.value])||(0,s.Z)(null==(o=e.point_radius_fixed)?void 0:o.value);return r.createElement("div",{className:"deckgl-tooltip"},r.createElement(c.Z,{label:(0,a.t)("Longitude and Latitude")+": ",value:i.object.position[0]+", "+i.object.position[1]}),i.object.cat_color&&r.createElement(c.Z,{label:(0,a.t)("Category")+": ",value:""+i.object.cat_color}),i.object.metric&&r.createElement(c.Z,{label:n+": ",value:""+i.object.metric}))}}(h,null==p?void 0:p.verboseMap))))}const h=(0,l.B)(p,(function(e){return e.map((e=>e.position))}))},92540:()=>{},95751:()=>{},75307:()=>{}}]);