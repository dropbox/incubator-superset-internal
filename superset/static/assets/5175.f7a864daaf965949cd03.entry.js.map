{"version":3,"file":"5175.f7a864daaf965949cd03.entry.js","mappings":"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","sources":["webpack://superset/./packages/superset-ui-core/src/chart/models/ChartMetadata.ts","webpack://superset/./packages/superset-ui-core/src/chart/models/ChartPlugin.ts","webpack://superset/./packages/superset-ui-core/src/chart/registries/ChartComponentRegistrySingleton.ts","webpack://superset/./packages/superset-ui-core/src/chart/registries/ChartTransformPropsRegistrySingleton.ts","webpack://superset/./packages/superset-ui-core/src/math-expression/index.ts","webpack://superset/./packages/superset-ui-core/src/models/Plugin.ts","webpack://superset/./packages/superset-ui-core/src/models/Preset.ts","webpack://superset/./packages/superset-ui-core/src/query/extractTimegrain.ts","webpack://superset/./packages/superset-ui-core/src/query/normalizeOrderBy.ts","webpack://superset/./packages/superset-ui-core/src/query/types/AnnotationLayer.ts","webpack://superset/./packages/superset-ui-core/src/time-format/formatters/smartDateDetailed.ts","webpack://superset/./packages/superset-ui-core/src/validator/validateInteger.ts"],"sourcesContent":["/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Behavior, ChartLabel } from '../types/Base';\n\ninterface LookupTable {\n  [key: string]: boolean;\n}\n\nexport interface ExampleImage {\n  url: string;\n  caption?: string;\n}\n\nexport interface ChartMetadataConfig {\n  name: string;\n  canBeAnnotationTypes?: string[];\n  credits?: string[];\n  description?: string;\n  datasourceCount?: number;\n  enableNoResults?: boolean;\n  show?: boolean;\n  supportedAnnotationTypes?: string[];\n  thumbnail: string;\n  useLegacyApi?: boolean;\n  behaviors?: Behavior[];\n  exampleGallery?: ExampleImage[];\n  tags?: string[];\n  category?: string | null;\n  // deprecated: true hides a chart from all viz picker interactions.\n  deprecated?: boolean;\n  // label: ChartLabel.DEPRECATED which will display a \"deprecated\" label on the chart.\n  label?: ChartLabel | null;\n  labelExplanation?: string | null;\n}\n\nexport default class ChartMetadata {\n  name: string;\n\n  canBeAnnotationTypes?: string[];\n\n  canBeAnnotationTypesLookup: LookupTable;\n\n  credits: string[];\n\n  description: string;\n\n  show: boolean;\n\n  supportedAnnotationTypes: string[];\n\n  thumbnail: string;\n\n  useLegacyApi: boolean;\n\n  behaviors: Behavior[];\n\n  datasourceCount: number;\n\n  enableNoResults: boolean;\n\n  exampleGallery: ExampleImage[];\n\n  tags: string[];\n\n  category: string | null;\n\n  deprecated?: boolean;\n\n  label?: ChartLabel | null;\n\n  labelExplanation?: string | null;\n\n  constructor(config: ChartMetadataConfig) {\n    const {\n      name,\n      canBeAnnotationTypes = [],\n      credits = [],\n      description = '',\n      show = true,\n      supportedAnnotationTypes = [],\n      thumbnail,\n      useLegacyApi = false,\n      behaviors = [],\n      datasourceCount = 1,\n      enableNoResults = true,\n      exampleGallery = [],\n      tags = [],\n      category = null,\n      deprecated = false,\n      label = null,\n      labelExplanation = null,\n    } = config;\n\n    this.name = name;\n    this.credits = credits;\n    this.description = description;\n    this.show = show;\n    this.canBeAnnotationTypes = canBeAnnotationTypes;\n    this.canBeAnnotationTypesLookup = canBeAnnotationTypes.reduce(\n      (prev: LookupTable, type: string) => {\n        const lookup = prev;\n        lookup[type] = true;\n\n        return lookup;\n      },\n      {},\n    );\n    this.supportedAnnotationTypes = supportedAnnotationTypes;\n    this.thumbnail = thumbnail;\n    this.useLegacyApi = useLegacyApi;\n    this.behaviors = behaviors;\n    this.datasourceCount = datasourceCount;\n    this.enableNoResults = enableNoResults;\n    this.exampleGallery = exampleGallery;\n    this.tags = tags;\n    this.category = category;\n    this.deprecated = deprecated;\n    this.label = label;\n    this.labelExplanation = labelExplanation;\n  }\n\n  canBeAnnotationType(type: string): boolean {\n    return this.canBeAnnotationTypesLookup[type] || false;\n  }\n\n  clone() {\n    return new ChartMetadata(this);\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { ComponentType } from 'react';\nimport { isRequired, Plugin, QueryFormData } from '../..';\nimport ChartMetadata from './ChartMetadata';\nimport getChartMetadataRegistry from '../registries/ChartMetadataRegistrySingleton';\nimport getChartBuildQueryRegistry from '../registries/ChartBuildQueryRegistrySingleton';\nimport getChartComponentRegistry from '../registries/ChartComponentRegistrySingleton';\nimport getChartControlPanelRegistry from '../registries/ChartControlPanelRegistrySingleton';\nimport getChartTransformPropsRegistry from '../registries/ChartTransformPropsRegistrySingleton';\nimport { BuildQueryFunction, TransformProps } from '../types/TransformFunction';\nimport { ChartControlPanel } from './ChartControlPanel';\nimport { ChartProps } from '..';\n\nfunction IDENTITY<T>(x: T) {\n  return x;\n}\n\nconst EMPTY = {};\n\nexport type PromiseOrValue<T> = Promise<T> | T;\nexport type PromiseOrValueLoader<T> = () => PromiseOrValue<T>;\nexport type ChartType = ComponentType<any>;\ntype ValueOrModuleWithValue<T> = T | { default: T };\n\ninterface ChartPluginConfig<\n  FormData extends QueryFormData = QueryFormData,\n  Props extends ChartProps = ChartProps,\n> {\n  metadata: ChartMetadata;\n  /** Use buildQuery for immediate value. For lazy-loading, use loadBuildQuery. */\n  buildQuery?: BuildQueryFunction<FormData>;\n  /** Use loadBuildQuery for dynamic import (lazy-loading) */\n  loadBuildQuery?: PromiseOrValueLoader<\n    ValueOrModuleWithValue<BuildQueryFunction<FormData>>\n  >;\n  /** Use transformProps for immediate value. For lazy-loading, use loadTransformProps.  */\n  transformProps?: TransformProps<Props>;\n  /** Use loadTransformProps for dynamic import (lazy-loading) */\n  loadTransformProps?: PromiseOrValueLoader<\n    ValueOrModuleWithValue<TransformProps<Props>>\n  >;\n  /** Use Chart for immediate value. For lazy-loading, use loadChart. */\n  Chart?: ChartType;\n  /** Use loadChart for dynamic import (lazy-loading) */\n  loadChart?: PromiseOrValueLoader<ValueOrModuleWithValue<ChartType>>;\n  /** Control panel configuration object */\n  controlPanel?: ChartControlPanel;\n}\n\n/**\n * Loaders of the form `() => import('foo')` may return esmodules\n * which require the value to be extracted as `module.default`\n * */\nfunction sanitizeLoader<T>(\n  loader: PromiseOrValueLoader<ValueOrModuleWithValue<T>>,\n): PromiseOrValueLoader<T> {\n  return () => {\n    const loaded = loader();\n\n    return loaded instanceof Promise\n      ? (loaded.then(\n          module => ('default' in module && module.default) || module,\n        ) as Promise<T>)\n      : (loaded as T);\n  };\n}\n\nexport default class ChartPlugin<\n  FormData extends QueryFormData = QueryFormData,\n  Props extends ChartProps = ChartProps,\n> extends Plugin {\n  controlPanel: ChartControlPanel;\n\n  metadata: ChartMetadata;\n\n  loadBuildQuery?: PromiseOrValueLoader<BuildQueryFunction<FormData>>;\n\n  loadTransformProps: PromiseOrValueLoader<TransformProps<Props>>;\n\n  loadChart: PromiseOrValueLoader<ChartType>;\n\n  constructor(config: ChartPluginConfig<FormData, Props>) {\n    super();\n    const {\n      metadata,\n      buildQuery,\n      loadBuildQuery,\n      transformProps = IDENTITY,\n      loadTransformProps,\n      Chart,\n      loadChart,\n      controlPanel = EMPTY,\n    } = config;\n    this.controlPanel = controlPanel;\n    this.metadata = metadata;\n    this.loadBuildQuery =\n      (loadBuildQuery && sanitizeLoader(loadBuildQuery)) ||\n      (buildQuery && sanitizeLoader(() => buildQuery)) ||\n      undefined;\n    this.loadTransformProps = sanitizeLoader(\n      loadTransformProps ?? (() => transformProps),\n    );\n\n    if (loadChart) {\n      this.loadChart = sanitizeLoader<ChartType>(loadChart);\n    } else if (Chart) {\n      this.loadChart = () => Chart;\n    } else {\n      throw new Error('Chart or loadChart is required');\n    }\n  }\n\n  register() {\n    const key: string = this.config.key || isRequired('config.key');\n    getChartMetadataRegistry().registerValue(key, this.metadata);\n    getChartComponentRegistry().registerLoader(key, this.loadChart);\n    getChartControlPanelRegistry().registerValue(key, this.controlPanel);\n    getChartTransformPropsRegistry().registerLoader(\n      key,\n      this.loadTransformProps,\n    );\n    if (this.loadBuildQuery) {\n      getChartBuildQueryRegistry().registerLoader(key, this.loadBuildQuery);\n    }\n    return this;\n  }\n\n  unregister() {\n    const key: string = this.config.key || isRequired('config.key');\n    getChartMetadataRegistry().remove(key);\n    getChartComponentRegistry().remove(key);\n    getChartControlPanelRegistry().remove(key);\n    getChartTransformPropsRegistry().remove(key);\n    getChartBuildQueryRegistry().remove(key);\n    return this;\n  }\n\n  configure(config: { [key: string]: unknown }, replace?: boolean) {\n    super.configure(config, replace);\n\n    return this;\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Registry, makeSingleton, OverwritePolicy } from '../..';\nimport { ChartType } from '../models/ChartPlugin';\n\nclass ChartComponentRegistry extends Registry<ChartType> {\n  constructor() {\n    super({ name: 'ChartComponent', overwritePolicy: OverwritePolicy.WARN });\n  }\n}\n\nconst getInstance = makeSingleton(ChartComponentRegistry);\n\nexport default getInstance;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { Registry, makeSingleton, OverwritePolicy } from '../..';\nimport { TransformProps } from '../types/TransformFunction';\n\nclass ChartTransformPropsRegistry extends Registry<TransformProps<any>> {\n  constructor() {\n    super({\n      name: 'ChartTransformProps',\n      overwritePolicy: OverwritePolicy.WARN,\n    });\n  }\n}\n\nconst getInstance = makeSingleton(ChartTransformPropsRegistry);\n\nexport default getInstance;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport mexp from 'math-expression-evaluator';\n\nconst REPLACE_OPERATORS: [RegExp, string][] = [\n  [new RegExp(/==/g), 'Eq'],\n  [new RegExp(/>=/g), 'Gte'],\n  [new RegExp(/<=/g), 'Lte'],\n  [new RegExp(/>/g), 'Gt'],\n  [new RegExp(/</g), 'Lt'],\n];\n\nconst TOKENS = [\n  {\n    type: 3,\n    token: 'x',\n    show: 'x',\n    value: 'x',\n  },\n  {\n    type: 2,\n    token: '&',\n    show: '&',\n    value: (a: number, b: number): number => a & b,\n  },\n  {\n    type: 2,\n    token: '|',\n    show: '|',\n    value: (a: number, b: number): number => a | b,\n  },\n  {\n    type: 2,\n    token: 'and',\n    show: 'and',\n    value: (a: number, b: number): number => a && b,\n  },\n  {\n    type: 2,\n    token: 'xor',\n    show: 'xor',\n    value: (a: number, b: number): number => a ^ b,\n  },\n  {\n    type: 2,\n    token: 'or',\n    show: 'or',\n    value: (a: number, b: number): number => Number(a || b),\n  },\n  {\n    type: 2,\n    token: 'Eq',\n    show: 'Eq',\n    value: (a: number, b: number): number => Number(a === b),\n  },\n  {\n    type: 2,\n    token: 'Lt',\n    show: 'Lt',\n    value: (a: number, b: number): number => Number(a < b),\n  },\n  {\n    type: 2,\n    token: 'Lte',\n    show: 'Lte',\n    value: (a: number, b: number): number => Number(a <= b),\n  },\n  {\n    type: 2,\n    token: 'Gt',\n    show: 'Gt',\n    value: (a: number, b: number): number => Number(a > b),\n  },\n  {\n    type: 2,\n    token: 'Gte',\n    show: 'Gte',\n    value: (a: number, b: number): number => Number(a >= b),\n  },\n];\n\nexport function evalExpression(expression: string, value: number): number {\n  let parsedExpression = expression;\n  // replace `<` with `Lt` (and others) to avoid clashes with builtin function operators\n  // that are not needed in Superset.\n  REPLACE_OPERATORS.forEach(([key, value]) => {\n    parsedExpression = parsedExpression.replace(key, value);\n  });\n  const subExpressions = String(parsedExpression).split('=');\n  parsedExpression = subExpressions[1] ?? subExpressions[0];\n  // we can ignore the type requirement on `TOKENS`, as value is always `number`\n  // and doesn't need to consider `number | underfined`.\n  // @ts-ignore\n  return Number(mexp.eval(parsedExpression, TOKENS, { x: value }));\n}\n\nexport function isValidExpression(expression: string): boolean {\n  try {\n    evalExpression(expression, 0);\n  } catch (err) {\n    return false;\n  }\n  return true;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\ninterface PlainObject {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  [key: string]: any;\n}\n\nexport default class Plugin {\n  config: PlainObject;\n\n  constructor() {\n    this.config = {};\n  }\n\n  resetConfig() {\n    // The child class can set default config\n    // by overriding this function.\n    this.config = {};\n\n    return this;\n  }\n\n  configure(config: PlainObject, replace = false) {\n    this.config = replace ? config : { ...this.config, ...config };\n\n    return this;\n  }\n\n  register() {\n    return this;\n  }\n\n  unregister() {\n    return this;\n  }\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Plugin from './Plugin';\n\nexport default class Preset {\n  name: string;\n\n  description: string;\n\n  presets: Preset[];\n\n  plugins: Plugin[];\n\n  constructor(\n    config: {\n      name?: string;\n      description?: string;\n      presets?: Preset[];\n      plugins?: Plugin[];\n    } = {},\n  ) {\n    const { name = '', description = '', presets = [], plugins = [] } = config;\n    this.name = name;\n    this.description = description;\n    this.presets = presets;\n    this.plugins = plugins;\n  }\n\n  register() {\n    this.presets.forEach(preset => {\n      preset.register();\n    });\n    this.plugins.forEach(plugin => {\n      plugin.register();\n    });\n\n    return this;\n  }\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n/* eslint-disable no-underscore-dangle */\n\nimport { QueryFormData } from './types';\nimport { TimeGranularity } from '../time-format';\n\nexport default function extractTimegrain(\n  formData: QueryFormData,\n): TimeGranularity | undefined {\n  const { time_grain_sqla, extra_filters, extra_form_data } = formData;\n  if (extra_form_data?.time_grain_sqla) {\n    return extra_form_data.time_grain_sqla;\n  }\n  const extra_grain = (extra_filters || []).filter(\n    filter => filter.col === '__time_grain',\n  );\n  if (extra_grain.length) {\n    return extra_grain[0].val as TimeGranularity;\n  }\n  return time_grain_sqla;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport isEmpty from 'lodash/isEmpty';\nimport isBoolean from 'lodash/isBoolean';\n\nimport { QueryObject } from './types';\n\nexport default function normalizeOrderBy(\n  queryObject: QueryObject,\n): QueryObject {\n  if (Array.isArray(queryObject.orderby) && queryObject.orderby.length > 0) {\n    // ensure a valid orderby clause\n    const orderbyClause = queryObject.orderby[0];\n    if (\n      Array.isArray(orderbyClause) &&\n      orderbyClause.length === 2 &&\n      !isEmpty(orderbyClause[0]) &&\n      isBoolean(orderbyClause[1])\n    ) {\n      return queryObject;\n    }\n  }\n\n  // ensure that remove invalid orderby clause\n  const cloneQueryObject = { ...queryObject };\n  delete cloneQueryObject.timeseries_limit_metric;\n  delete cloneQueryObject.legacy_order_by;\n  delete cloneQueryObject.order_desc;\n  delete cloneQueryObject.orderby;\n\n  const isAsc = !queryObject.order_desc;\n  if (\n    queryObject.timeseries_limit_metric !== undefined &&\n    queryObject.timeseries_limit_metric !== null &&\n    !isEmpty(queryObject.timeseries_limit_metric)\n  ) {\n    return {\n      ...cloneQueryObject,\n      orderby: [[queryObject.timeseries_limit_metric, isAsc]],\n    };\n  }\n\n  // todo: Removed `legacy_ordery_by` after refactoring\n  if (\n    queryObject.legacy_order_by !== undefined &&\n    queryObject.legacy_order_by !== null &&\n    !isEmpty(queryObject.legacy_order_by)\n  ) {\n    return {\n      ...cloneQueryObject,\n      // @ts-ignore\n      orderby: [[queryObject.legacy_order_by, isAsc]],\n    };\n  }\n\n  if (Array.isArray(queryObject.metrics) && queryObject.metrics.length > 0) {\n    return {\n      ...cloneQueryObject,\n      orderby: [[queryObject.metrics[0], isAsc]],\n    };\n  }\n\n  return cloneQueryObject;\n}\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\n/* eslint camelcase: 0 */\nimport { DataRecord } from './QueryResponse';\nimport { TimeGranularity } from '../../time-format';\n\nexport enum AnnotationType {\n  Event = 'EVENT',\n  Formula = 'FORMULA',\n  Interval = 'INTERVAL',\n  Timeseries = 'TIME_SERIES',\n}\n\nexport enum AnnotationSourceType {\n  Line = 'line',\n  Native = 'NATIVE',\n  Table = 'table',\n  Undefined = '',\n}\n\nexport enum AnnotationOpacity {\n  High = 'opacityHigh',\n  Low = 'opacityLow',\n  Medium = 'opacityMedium',\n  Undefined = '',\n}\n\nexport enum AnnotationStyle {\n  Dashed = 'dashed',\n  Dotted = 'dotted',\n  Solid = 'solid',\n  LongDashed = 'longDashed',\n}\n\ntype BaseAnnotationLayer = {\n  color?: string | null;\n  name: string;\n  opacity?: AnnotationOpacity;\n  show: boolean;\n  showLabel: boolean;\n  style: AnnotationStyle;\n  width?: number;\n};\n\ntype AnnotationOverrides = {\n  granularity?: string | null;\n  time_grain_sqla?: TimeGranularity | null;\n  time_range?: string | null;\n  time_shift?: string | null;\n};\n\ntype LineSourceAnnotationLayer = {\n  hideLine?: boolean;\n  overrides?: AnnotationOverrides;\n  sourceType: AnnotationSourceType.Line;\n  titleColumn?: string;\n  // viz id\n  value: number;\n};\n\ntype NativeSourceAnnotationLayer = {\n  sourceType: AnnotationSourceType.Native;\n  // annotation id\n  value: number;\n};\n\ntype TableSourceAnnotationLayer = {\n  descriptionColumns?: string[];\n  timeColumn?: string;\n  intervalEndColumn?: string;\n  overrides?: AnnotationOverrides;\n  sourceType: AnnotationSourceType.Table;\n  titleColumn?: string;\n  // viz id\n  value: number;\n};\n\nexport type EventAnnotationLayer = BaseAnnotationLayer &\n  (TableSourceAnnotationLayer | NativeSourceAnnotationLayer) & {\n    annotationType: AnnotationType.Event;\n  };\n\nexport type IntervalAnnotationLayer = BaseAnnotationLayer &\n  (TableSourceAnnotationLayer | NativeSourceAnnotationLayer) & {\n    annotationType: AnnotationType.Interval;\n  };\n\nexport type TableAnnotationLayer = BaseAnnotationLayer &\n  TableSourceAnnotationLayer & {\n    annotationType: AnnotationType.Event | AnnotationType.Interval;\n  };\n\nexport type FormulaAnnotationLayer = BaseAnnotationLayer & {\n  annotationType: AnnotationType.Formula;\n  // the mathjs parseable formula\n  sourceType?: AnnotationSourceType.Undefined;\n  value: string;\n};\n\nexport type TimeseriesAnnotationLayer = BaseAnnotationLayer &\n  LineSourceAnnotationLayer & {\n    annotationType: AnnotationType.Timeseries;\n    showMarkers?: boolean;\n    value: number;\n  };\n\nexport type AnnotationLayer =\n  | EventAnnotationLayer\n  | IntervalAnnotationLayer\n  | FormulaAnnotationLayer\n  | TimeseriesAnnotationLayer;\n\nexport function isFormulaAnnotationLayer(\n  layer: AnnotationLayer,\n): layer is FormulaAnnotationLayer {\n  return layer.annotationType === AnnotationType.Formula;\n}\n\nexport function isEventAnnotationLayer(\n  layer: AnnotationLayer,\n): layer is EventAnnotationLayer {\n  return layer.annotationType === AnnotationType.Event;\n}\n\nexport function isIntervalAnnotationLayer(\n  layer: AnnotationLayer,\n): layer is IntervalAnnotationLayer {\n  return layer.annotationType === AnnotationType.Interval;\n}\n\nexport function isTimeseriesAnnotationLayer(\n  layer: AnnotationLayer,\n): layer is TimeseriesAnnotationLayer {\n  return layer.annotationType === AnnotationType.Timeseries;\n}\n\nexport function isTableAnnotationLayer(\n  layer: AnnotationLayer,\n): layer is TableAnnotationLayer {\n  return layer.sourceType === AnnotationSourceType.Table;\n}\n\nexport type RecordAnnotationResult = {\n  columns: string[];\n  records: DataRecord[];\n};\n\nexport type TimeseriesAnnotationResult = {\n  key: string;\n  values: { x: string | number; y?: number }[];\n}[];\n\nexport type AnnotationResult =\n  | RecordAnnotationResult\n  | TimeseriesAnnotationResult;\n\nexport function isTimeseriesAnnotationResult(\n  result: AnnotationResult,\n): result is TimeseriesAnnotationResult {\n  return Array.isArray(result);\n}\n\nexport function isRecordAnnotationResult(\n  result: AnnotationResult,\n): result is RecordAnnotationResult {\n  return 'columns' in result && 'records' in result;\n}\n\nexport type AnnotationData = { [key: string]: AnnotationResult };\n\nexport type Annotation = {\n  descriptions?: string[];\n  intervalEnd?: string;\n  time?: string;\n  title?: string;\n};\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport createMultiFormatter from '../factories/createMultiFormatter';\n\nconst smartDateDetailedFormatter = createMultiFormatter({\n  id: 'smart_date_detailed',\n  label: 'Detailed adaptive formatter',\n  formats: {\n    millisecond: '%Y-%m-%d %H:%M:%S.%L',\n    second: '%Y-%m-%d %H:%M:%S',\n    minute: '%Y-%m-%d %H:%M',\n    hour: '%Y-%m-%d %H:%M',\n    day: '%Y-%m-%d',\n    week: '%Y-%m-%d',\n    month: '%Y-%m-%d',\n    year: '%Y',\n  },\n});\n\nexport default smartDateDetailedFormatter;\n","/*\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { t } from '../translation';\n\nexport default function validateInteger(v: unknown) {\n  if (\n    (typeof v === 'string' &&\n      v.trim().length > 0 &&\n      Number.isInteger(Number(v.trim()))) ||\n    (typeof v === 'number' && Number.isInteger(v))\n  ) {\n    return false;\n  }\n\n  return t('is expected to be an integer');\n}\n"],"names":["ChartMetadata","constructor","config","name","canBeAnnotationTypes","canBeAnnotationTypesLookup","credits","description","show","supportedAnnotationTypes","thumbnail","useLegacyApi","behaviors","datasourceCount","enableNoResults","exampleGallery","tags","category","deprecated","label","labelExplanation","this","reduce","prev","type","lookup","canBeAnnotationType","clone","IDENTITY","x","EMPTY","sanitizeLoader","loader","loaded","Promise","then","module","default","ChartPlugin","super","controlPanel","metadata","loadBuildQuery","loadTransformProps","loadChart","buildQuery","transformProps","Chart","undefined","Error","register","key","registerValue","registerLoader","unregister","remove","configure","replace","ChartComponentRegistry","overwritePolicy","ChartTransformPropsRegistry","REPLACE_OPERATORS","RegExp","TOKENS","token","value","a","b","Number","evalExpression","expression","parsedExpression","forEach","subExpressions","String","split","isValidExpression","err","Plugin","resetConfig","Preset","presets","plugins","preset","plugin","extractTimegrain","formData","time_grain_sqla","extra_filters","extra_form_data","extra_grain","filter","col","length","val","normalizeOrderBy","queryObject","Array","isArray","orderby","orderbyClause","cloneQueryObject","timeseries_limit_metric","legacy_order_by","order_desc","isAsc","metrics","AnnotationType","AnnotationSourceType","AnnotationOpacity","AnnotationStyle","isFormulaAnnotationLayer","layer","annotationType","Formula","isEventAnnotationLayer","Event","isIntervalAnnotationLayer","Interval","isTimeseriesAnnotationLayer","Timeseries","isTableAnnotationLayer","sourceType","Table","isTimeseriesAnnotationResult","result","isRecordAnnotationResult","id","formats","millisecond","second","minute","hour","day","week","month","year","validateInteger","v","trim","isInteger","t"],"sourceRoot":""}