{"version":3,"file":"de4ae23774f8ad67b971.chunk.js","mappings":"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","sources":["webpack://superset/./src/features/alerts/components/AlertStatusIcon.tsx","webpack://superset/./src/features/alerts/types.ts","webpack://superset/./src/pages/ExecutionLogList/index.tsx"],"sourcesContent":["/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\nimport { t, SupersetTheme, useTheme } from '@superset-ui/core';\nimport React from 'react';\nimport { Tooltip } from 'src/components/Tooltip';\nimport Icons from 'src/components/Icons';\nimport { AlertState } from '../types';\n\nfunction getStatusColor(\n  status: string,\n  isReportEnabled: boolean,\n  theme: SupersetTheme,\n) {\n  switch (status) {\n    case AlertState.Working:\n      return theme.colors.primary.base;\n    case AlertState.Error:\n      return theme.colors.error.base;\n    case AlertState.Success:\n      return isReportEnabled\n        ? theme.colors.success.base\n        : theme.colors.alert.base;\n    case AlertState.Noop:\n      return theme.colors.success.base;\n    case AlertState.Grace:\n      return theme.colors.alert.base;\n    default:\n      return theme.colors.grayscale.base;\n  }\n}\n\nexport default function AlertStatusIcon({\n  state,\n  isReportEnabled = false,\n}: {\n  state: string;\n  isReportEnabled: boolean;\n}) {\n  const theme = useTheme();\n  const lastStateConfig = {\n    icon: Icons.Check,\n    label: '',\n    status: '',\n  };\n  switch (state) {\n    case AlertState.Success:\n      lastStateConfig.icon = isReportEnabled\n        ? Icons.Check\n        : Icons.AlertSolidSmall;\n      lastStateConfig.label = isReportEnabled\n        ? t('Report sent')\n        : t('Alert triggered, notification sent');\n      lastStateConfig.status = AlertState.Success;\n      break;\n    case AlertState.Working:\n      lastStateConfig.icon = Icons.Running;\n      lastStateConfig.label = isReportEnabled\n        ? t('Report sending')\n        : t('Alert running');\n      lastStateConfig.status = AlertState.Working;\n      break;\n    case AlertState.Error:\n      lastStateConfig.icon = Icons.XSmall;\n      lastStateConfig.label = isReportEnabled\n        ? t('Report failed')\n        : t('Alert failed');\n      lastStateConfig.status = AlertState.Error;\n      break;\n    case AlertState.Noop:\n      lastStateConfig.icon = Icons.Check;\n      lastStateConfig.label = t('Nothing triggered');\n      lastStateConfig.status = AlertState.Noop;\n      break;\n    case AlertState.Grace:\n      lastStateConfig.icon = Icons.AlertSolidSmall;\n      lastStateConfig.label = t('Alert Triggered, In Grace Period');\n      lastStateConfig.status = AlertState.Grace;\n      break;\n    default:\n      lastStateConfig.icon = Icons.Check;\n      lastStateConfig.label = t('Nothing triggered');\n      lastStateConfig.status = AlertState.Noop;\n  }\n  const Icon = lastStateConfig.icon;\n  return (\n    <Tooltip title={lastStateConfig.label} placement=\"bottomLeft\">\n      <Icon\n        iconColor={getStatusColor(\n          lastStateConfig.status,\n          isReportEnabled,\n          theme,\n        )}\n      />\n    </Tooltip>\n  );\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport Owner from 'src/types/Owner';\nimport { NOTIFICATION_FORMATS } from 'src/reports/types';\n\ntype user = {\n  id: number;\n  first_name: string;\n  last_name: string;\n};\nexport type ChartObject = {\n  id: number;\n  slice_name: string;\n  viz_type: string;\n};\n\nexport type DashboardObject = {\n  dashboard_title: string;\n  id: number;\n};\n\nexport type DatabaseObject = {\n  database_name: string;\n  id: number;\n};\n\nexport type NotificationMethodOption = 'Email' | 'Slack';\n\nexport type Recipient = {\n  recipient_config_json: {\n    target: string;\n  };\n  type: NotificationMethodOption;\n};\n\nexport type MetaObject = {\n  id?: number;\n  label?: string;\n  value?: number | string;\n};\n\nexport type Operator = '<' | '>' | '<=' | '>=' | '==' | '!=' | 'not null';\n\nexport type AlertObject = {\n  active?: boolean;\n  creation_method?: string;\n  chart?: MetaObject;\n  changed_by?: user;\n  changed_on_delta_humanized?: string;\n  chart_id: number;\n  created_by?: user;\n  created_on?: string;\n  crontab?: string;\n  custom_width?: number | null;\n  dashboard?: MetaObject;\n  dashboard_id?: number;\n  database?: MetaObject;\n  description?: string;\n  error?: string;\n  force_screenshot: boolean;\n  grace_period?: number;\n  id: number;\n  last_eval_dttm?: number;\n  last_state?: 'Success' | 'Working' | 'Error' | 'Not triggered' | 'On Grace';\n  log_retention?: number;\n  name?: string;\n  owners?: Array<Owner | MetaObject>;\n  sql?: string;\n  timezone?: string;\n  recipients?: Array<Recipient>;\n  report_format?: NOTIFICATION_FORMATS;\n  type?: string;\n  validator_config_json?: {\n    op?: Operator;\n    threshold?: number;\n  };\n  validator_type?: string;\n  working_timeout?: number;\n};\n\nexport type LogObject = {\n  end_dttm: string;\n  error_message: string;\n  id: number;\n  scheduled_dttm: string;\n  start_dttm: string;\n  state: string;\n  value: string;\n  uuid: string;\n};\n\nexport enum AlertState {\n  Success = 'Success',\n  Working = 'Working',\n  Error = 'Error',\n  Noop = 'Not triggered',\n  Grace = 'On Grace',\n}\n\nexport enum RecipientIconName {\n  Email = 'Email',\n  Slack = 'Slack',\n}\nexport interface AlertsReportsConfig {\n  ALERT_REPORTS_DEFAULT_WORKING_TIMEOUT: number;\n  ALERT_REPORTS_DEFAULT_RETENTION: number;\n  ALERT_REPORTS_DEFAULT_CRON_VALUE: string;\n}\n","/**\n * Licensed to the Apache Software Foundation (ASF) under one\n * or more contributor license agreements.  See the NOTICE file\n * distributed with this work for additional information\n * regarding copyright ownership.  The ASF licenses this file\n * to you under the Apache License, Version 2.0 (the\n * \"License\"); you may not use this file except in compliance\n * with the License.  You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing,\n * software distributed under the License is distributed on an\n * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n * KIND, either express or implied.  See the License for the\n * specific language governing permissions and limitations\n * under the License.\n */\n\nimport { css, styled, t } from '@superset-ui/core';\nimport moment from 'moment';\nimport React, { useEffect, useMemo } from 'react';\nimport { Link, useParams } from 'react-router-dom';\nimport ListView from 'src/components/ListView';\nimport { Tooltip } from 'src/components/Tooltip';\nimport SubMenu from 'src/features/home/SubMenu';\nimport withToasts from 'src/components/MessageToasts/withToasts';\nimport { fDuration } from 'src/utils/dates';\nimport AlertStatusIcon from 'src/features/alerts/components/AlertStatusIcon';\nimport {\n  useListViewResource,\n  useSingleViewResource,\n} from 'src/views/CRUD/hooks';\nimport { AlertObject, LogObject } from 'src/features/alerts/types';\n\nconst PAGE_SIZE = 25;\n\nconst StyledHeader = styled.div`\n  ${({ theme }) => css`\n    display: flex;\n    flex-direction: row;\n\n    a,\n    Link {\n      margin-left: ${theme.gridUnit * 4}px;\n      font-size: ${theme.typography.sizes.s};\n      font-weight: ${theme.typography.weights.normal};\n      text-decoration: underline;\n    }\n  `}\n`;\n\ninterface ExecutionLogProps {\n  addDangerToast: (msg: string) => void;\n  addSuccessToast: (msg: string) => void;\n  isReportEnabled: boolean;\n}\n\nfunction ExecutionLog({ addDangerToast, isReportEnabled }: ExecutionLogProps) {\n  const { alertId }: any = useParams();\n  const {\n    state: { loading, resourceCount: logCount, resourceCollection: logs },\n    fetchData,\n  } = useListViewResource<LogObject>(\n    `report/${alertId}/log`,\n    t('log'),\n    addDangerToast,\n    false,\n  );\n  const {\n    state: { loading: alertLoading, resource: alertResource },\n    fetchResource,\n  } = useSingleViewResource<AlertObject>(\n    'report',\n    t('reports'),\n    addDangerToast,\n  );\n\n  useEffect(() => {\n    if (alertId !== null && !alertLoading) {\n      fetchResource(alertId);\n    }\n  }, [alertId]);\n\n  const initialSort = [{ id: 'start_dttm', desc: true }];\n  const columns = useMemo(\n    () => [\n      {\n        Cell: ({\n          row: {\n            original: { state },\n          },\n        }: any) => (\n          <AlertStatusIcon state={state} isReportEnabled={isReportEnabled} />\n        ),\n        accessor: 'state',\n        Header: t('State'),\n        size: 'xs',\n        disableSortBy: true,\n      },\n      {\n        Cell: ({\n          row: {\n            original: { uuid: executionId },\n          },\n        }: any) => (executionId ? executionId.slice(0, 6) : 'none'),\n        accessor: 'uuid',\n        Header: t('Execution ID'),\n        size: 'xs',\n        disableSortBy: true,\n      },\n      {\n        Cell: ({\n          row: {\n            original: { scheduled_dttm: scheduledDttm },\n          },\n        }: any) =>\n          moment(new Date(scheduledDttm)).format('YYYY-MM-DD hh:mm:ss a'),\n        accessor: 'scheduled_dttm',\n        Header: t('Scheduled at (UTC)'),\n      },\n      {\n        Cell: ({\n          row: {\n            original: { start_dttm: startDttm },\n          },\n        }: any) => moment(new Date(startDttm)).format('YYYY-MM-DD hh:mm:ss a'),\n        Header: t('Start at (UTC)'),\n        accessor: 'start_dttm',\n      },\n      {\n        Cell: ({\n          row: {\n            original: { start_dttm: startDttm, end_dttm: endDttm },\n          },\n        }: any) =>\n          fDuration(new Date(startDttm).getTime(), new Date(endDttm).getTime()),\n        Header: t('Duration'),\n        disableSortBy: true,\n      },\n      {\n        accessor: 'value',\n        Header: t('Value'),\n      },\n      {\n        accessor: 'error_message',\n        Header: t('Error message'),\n        Cell: ({\n          row: {\n            original: { error_message = '' },\n          },\n        }: any) => (\n          <Tooltip title={error_message} placement=\"topLeft\">\n            <span>{error_message}</span>\n          </Tooltip>\n        ),\n      },\n    ],\n    [isReportEnabled],\n  );\n  const path = `/${isReportEnabled ? 'report' : 'alert'}/list/`;\n  const ALERT_TEXT = t('Alert');\n  const REPORT_TEXT = t('Report');\n\n  return (\n    <>\n      <SubMenu\n        name={\n          <StyledHeader>\n            <span>\n              {alertResource\n                ? alertResource.type === 'Alert'\n                  ? `${ALERT_TEXT}:`\n                  : alertResource.type === 'Report'\n                  ? `${REPORT_TEXT}:`\n                  : null\n                : null}{' '}\n              {alertResource?.name}\n            </span>\n            <span>\n              <Link to={path}>{t('Back to all')}</Link>\n            </span>\n          </StyledHeader>\n        }\n      />\n      <ListView<LogObject>\n        className=\"execution-log-list-view\"\n        columns={columns}\n        count={logCount}\n        data={logs}\n        fetchData={fetchData}\n        initialSort={initialSort}\n        loading={loading}\n        pageSize={PAGE_SIZE}\n      />\n    </>\n  );\n}\n\nexport default withToasts(ExecutionLog);\n"],"names":["getStatusColor","status","isReportEnabled","theme","AlertState","colors","primary","base","error","success","alert","grayscale","AlertStatusIcon","state","useTheme","lastStateConfig","icon","Icons","label","t","Icon","title","placement","iconColor","RecipientIconName","StyledHeader","styled","css","gridUnit","typography","sizes","s","weights","normal","withToasts","addDangerToast","alertId","useParams","loading","resourceCount","logCount","resourceCollection","logs","fetchData","useListViewResource","alertLoading","resource","alertResource","fetchResource","useSingleViewResource","useEffect","columns","useMemo","Cell","row","original","accessor","Header","size","disableSortBy","uuid","executionId","slice","scheduled_dttm","scheduledDttm","moment","Date","format","start_dttm","startDttm","end_dttm","endDttm","fDuration","getTime","error_message","path","ALERT_TEXT","REPORT_TEXT","name","type","to","className","count","data","initialSort","id","desc","pageSize"],"sourceRoot":""}