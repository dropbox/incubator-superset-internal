/*! For license information please see 621efcc56d307b3117f8.chunk.js.LICENSE.txt */
(globalThis.webpackChunksuperset=globalThis.webpackChunksuperset||[]).push([[452],{8177:(e,t,n)=>{e.exports={default:n(77084),__esModule:!0}},77084:(e,t,n)=>{n(75789);var i=n(94731).Object;e.exports=function(e,t){return i.getOwnPropertyDescriptor(e,t)}},75789:(e,t,n)=>{var i=n(64874),r=n(18437).f;n(44903)("getOwnPropertyDescriptor",(function(){return function(e,t){return r(i(e),t)}}))},50139:(e,t)=>{"use strict";t.__esModule=!0,t.default=void 0;var n=!("undefined"==typeof window||!window.document||!window.document.createElement);t.default=n,e.exports=t.default},44825:(e,t,n)=>{"use strict";var i=n(95318);t.__esModule=!0,t.default=function(e){if((!r&&0!==r||e)&&o.default){var t=document.createElement("div");t.style.position="absolute",t.style.top="-9999px",t.style.width="50px",t.style.height="50px",t.style.overflow="scroll",document.body.appendChild(t),r=t.offsetWidth-t.clientWidth,document.body.removeChild(t)}return r};var r,o=i(n(50139));e.exports=t.default},82689:(e,t,n)=>{var i=n(29932),r=n(97786),o=n(67206),a=n(69199),s=n(71131),l=n(7518),d=n(85022),c=n(6557),u=n(1469);e.exports=function(e,t,n){t=t.length?i(t,(function(e){return u(e)?function(t){return r(t,1===e.length?e[0]:e)}:e})):[c];var h=-1;t=i(t,l(o));var p=a(e,(function(e,n,r){return{criteria:i(t,(function(t){return t(e)})),index:++h,value:e}}));return s(p,(function(e,t){return d(e,t,n)}))}},25970:(e,t,n)=>{var i=n(63012),r=n(79095);e.exports=function(e,t){return i(e,t,(function(t,n){return r(e,n)}))}},71131:e=>{e.exports=function(e,t){var n=e.length;for(e.sort(t);n--;)e[n]=e[n].value;return e}},26393:(e,t,n)=>{var i=n(33448);e.exports=function(e,t){if(e!==t){var n=void 0!==e,r=null===e,o=e==e,a=i(e),s=void 0!==t,l=null===t,d=t==t,c=i(t);if(!l&&!c&&!a&&e>t||a&&s&&d&&!l&&!c||r&&s&&d||!n&&d||!o)return 1;if(!r&&!a&&!c&&e<t||c&&n&&o&&!r&&!a||l&&n&&o||!s&&o||!d)return-1}return 0}},85022:(e,t,n)=>{var i=n(26393);e.exports=function(e,t,n){for(var r=-1,o=e.criteria,a=t.criteria,s=o.length,l=n.length;++r<s;){var d=i(o[r],a[r]);if(d)return r>=l?d:d*("desc"==n[r]?-1:1)}return e.index-t.index}},94654:(e,t,n)=>{var i=n(21078),r=n(35161);e.exports=function(e,t){return i(r(e,t),1)}},10752:(e,t,n)=>{var i=n(21078),r=n(35161);e.exports=function(e,t){return i(r(e,t),1/0)}},28368:(e,t,n)=>{var i=n(90939);e.exports=function(e,t,n){var r=(n="function"==typeof n?n:void 0)?n(e,t):void 0;return void 0===r?i(e,t,void 0,n):!!r}},78718:(e,t,n)=>{var i=n(25970),r=n(99021)((function(e,t){return null==e?{}:i(e,t)}));e.exports=r},89734:(e,t,n)=>{var i=n(21078),r=n(82689),o=n(5976),a=n(16612),s=o((function(e,t){if(null==e)return[];var n=t.length;return n>1&&a(e,t[0],t[1])?t=[]:n>2&&a(t[0],t[1],t[2])&&(t=[t[0]]),r(e,i(t,1),[])}));e.exports=s},44908:(e,t,n)=>{var i=n(45652);e.exports=function(e){return e&&e.length?i(e):[]}},87185:(e,t,n)=>{var i=n(45652);e.exports=function(e,t){return t="function"==typeof t?t:void 0,e&&e.length?i(e,void 0,t):[]}},75:function(e,t,n){var i=n(34155);(function(){var t,n,r,o,a,s;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:null!=i&&i.hrtime?(e.exports=function(){return(t()-a)/1e6},n=i.hrtime,o=(t=function(){var e;return 1e9*(e=n())[0]+e[1]})(),s=1e9*i.uptime(),a=o-s):Date.now?(e.exports=function(){return Date.now()-r},r=Date.now()):(e.exports=function(){return(new Date).getTime()-r},r=(new Date).getTime())}).call(this)},54087:(e,t,n)=>{for(var i=n(75),r="undefined"==typeof window?n.g:window,o=["moz","webkit"],a="AnimationFrame",s=r["request"+a],l=r["cancel"+a]||r["cancelRequest"+a],d=0;!s&&d<o.length;d++)s=r[o[d]+"Request"+a],l=r[o[d]+"Cancel"+a]||r[o[d]+"CancelRequest"+a];if(!s||!l){var c=0,u=0,h=[];s=function(e){if(0===h.length){var t=i(),n=Math.max(0,16.666666666666668-(t-c));c=n+t,setTimeout((function(){var e=h.slice(0);h.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(c)}catch(e){setTimeout((function(){throw e}),0)}}),Math.round(n))}return h.push({handle:++u,callback:e,cancelled:!1}),u},l=function(e){for(var t=0;t<h.length;t++)h[t].handle===e&&(h[t].cancelled=!0)}}e.exports=function(e){return s.call(r,e)},e.exports.cancel=function(){l.apply(r,arguments)},e.exports.polyfill=function(e){e||(e=r),e.requestAnimationFrame=s,e.cancelAnimationFrame=l}},28388:(e,t,n)=>{var i;window,e.exports=(i=n(67294),function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=27)}([function(e,t,n){e.exports=n(96)()},function(e,t){e.exports=i},function(e,t,n){var i=n(16),r="object"==typeof self&&self&&self.Object===Object&&self,o=i||r||Function("return this")();e.exports=o},function(e,t,n){var i=n(41),r=n(47);e.exports=function(e,t){var n=r(e,t);return i(n)?n:void 0}},function(e,t,n){var i=n(31),r=n(32),o=n(33),a=n(34),s=n(35);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var i=n(14);e.exports=function(e,t){for(var n=e.length;n--;)if(i(e[n][0],t))return n;return-1}},function(e,t,n){var i=n(12),r=n(43),o=n(44),a=i?i.toStringTag:void 0;e.exports=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":a&&a in Object(e)?r(e):o(e)}},function(e,t,n){var i=n(3)(Object,"create");e.exports=i},function(e,t,n){var i=n(56);e.exports=function(e,t){var n=e.__data__;return i(t)?n["string"==typeof t?"string":"hash"]:n.map}},function(e,t){e.exports=function(e){return null!=e&&"object"==typeof e}},function(e,t,n){var i;!function(){"use strict";var n={}.hasOwnProperty;function r(){for(var e=[],t=0;t<arguments.length;t++){var i=arguments[t];if(i){var o=typeof i;if("string"===o||"number"===o)e.push(i);else if(Array.isArray(i)&&i.length){var a=r.apply(null,i);a&&e.push(a)}else if("object"===o)for(var s in i)n.call(i,s)&&i[s]&&e.push(s)}}return e.join(" ")}e.exports?(r.default=r,e.exports=r):void 0===(i=function(){return r}.apply(t,[]))||(e.exports=i)}()},function(e,t,n){var i=n(3)(n(2),"Map");e.exports=i},function(e,t,n){var i=n(2).Symbol;e.exports=i},function(e,t){var n=Array.isArray;e.exports=n},function(e,t){e.exports=function(e,t){return e===t||e!=e&&t!=t}},function(e,t,n){var i=n(6),r=n(17);e.exports=function(e){if(!r(e))return!1;var t=i(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}},function(e,t,n){(function(t){var n="object"==typeof t&&t&&t.Object===Object&&t;e.exports=n}).call(this,n(42))},function(e,t){e.exports=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}},function(e,t){var n=Function.prototype.toString;e.exports=function(e){if(null!=e){try{return n.call(e)}catch(e){}try{return e+""}catch(e){}}return""}},function(e,t,n){var i=n(48),r=n(55),o=n(57),a=n(58),s=n(59);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var i=n(60),r=n(63),o=n(64);e.exports=function(e,t,n,a,s,l){var d=1&n,c=e.length,u=t.length;if(c!=u&&!(d&&u>c))return!1;var h=l.get(e);if(h&&l.get(t))return h==t;var p=-1,f=!0,m=2&n?new i:void 0;for(l.set(e,t),l.set(t,e);++p<c;){var g=e[p],v=t[p];if(a)var b=d?a(v,g,p,t,e,l):a(g,v,p,e,t,l);if(void 0!==b){if(b)continue;f=!1;break}if(m){if(!r(t,(function(e,t){if(!o(m,t)&&(g===e||s(g,e,n,a,l)))return m.push(t)}))){f=!1;break}}else if(g!==v&&!s(g,v,n,a,l)){f=!1;break}}return l.delete(e),l.delete(t),f}},function(e,t,n){(function(e){var i=n(2),r=n(81),o=t&&!t.nodeType&&t,a=o&&"object"==typeof e&&e&&!e.nodeType&&e,s=a&&a.exports===o?i.Buffer:void 0,l=(s?s.isBuffer:void 0)||r;e.exports=l}).call(this,n(22)(e))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){var i=n(83),r=n(84),o=n(85),a=o&&o.isTypedArray,s=a?r(a):i;e.exports=s},function(e,t){e.exports=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}},function(e,t,n){var i=n(28);e.exports=function(e,t){return i(e,t)}},function(e,t,n){var i=self.crypto||self.msCrypto;e.exports=function(e){e=e||21;for(var t="",n=i.getRandomValues(new Uint8Array(e));0<e--;)t+="Uint8ArdomValuesObj012345679BCDEFGHIJKLMNPQRSTWXYZ_cfghkpqvwxyz-"[63&n[e]];return t}},function(e,t,n){e.exports=n(98).default},function(e,t,n){var i=n(29),r=n(9);e.exports=function e(t,n,o,a,s){return t===n||(null==t||null==n||!r(t)&&!r(n)?t!=t&&n!=n:i(t,n,o,a,e,s))}},function(e,t,n){var i=n(30),r=n(20),o=n(65),a=n(69),s=n(91),l=n(13),d=n(21),c=n(23),u="[object Arguments]",h="[object Array]",p="[object Object]",f=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,m,g,v){var b=l(e),y=l(t),C=b?h:s(e),S=y?h:s(t),x=(C=C==u?p:C)==p,w=(S=S==u?p:S)==p,k=C==S;if(k&&d(e)){if(!d(t))return!1;b=!0,x=!1}if(k&&!x)return v||(v=new i),b||c(e)?r(e,t,n,m,g,v):o(e,t,C,n,m,g,v);if(!(1&n)){var Z=x&&f.call(e,"__wrapped__"),R=w&&f.call(t,"__wrapped__");if(Z||R){var T=Z?e.value():e,F=R?t.value():t;return v||(v=new i),g(T,F,n,m,v)}}return!!k&&(v||(v=new i),a(e,t,n,m,g,v))}},function(e,t,n){var i=n(4),r=n(36),o=n(37),a=n(38),s=n(39),l=n(40);function d(e){var t=this.__data__=new i(e);this.size=t.size}d.prototype.clear=r,d.prototype.delete=o,d.prototype.get=a,d.prototype.has=s,d.prototype.set=l,e.exports=d},function(e,t){e.exports=function(){this.__data__=[],this.size=0}},function(e,t,n){var i=n(5),r=Array.prototype.splice;e.exports=function(e){var t=this.__data__,n=i(t,e);return!(n<0||(n==t.length-1?t.pop():r.call(t,n,1),--this.size,0))}},function(e,t,n){var i=n(5);e.exports=function(e){var t=this.__data__,n=i(t,e);return n<0?void 0:t[n][1]}},function(e,t,n){var i=n(5);e.exports=function(e){return i(this.__data__,e)>-1}},function(e,t,n){var i=n(5);e.exports=function(e,t){var n=this.__data__,r=i(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}},function(e,t,n){var i=n(4);e.exports=function(){this.__data__=new i,this.size=0}},function(e,t){e.exports=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}},function(e,t){e.exports=function(e){return this.__data__.get(e)}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t,n){var i=n(4),r=n(11),o=n(19);e.exports=function(e,t){var n=this.__data__;if(n instanceof i){var a=n.__data__;if(!r||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new o(a)}return n.set(e,t),this.size=n.size,this}},function(e,t,n){var i=n(15),r=n(45),o=n(17),a=n(18),s=/^\[object .+?Constructor\]$/,l=Function.prototype,d=Object.prototype,c=l.toString,u=d.hasOwnProperty,h=RegExp("^"+c.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=function(e){return!(!o(e)||r(e))&&(i(e)?h:s).test(a(e))}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){var i=n(12),r=Object.prototype,o=r.hasOwnProperty,a=r.toString,s=i?i.toStringTag:void 0;e.exports=function(e){var t=o.call(e,s),n=e[s];try{e[s]=void 0;var i=!0}catch(e){}var r=a.call(e);return i&&(t?e[s]=n:delete e[s]),r}},function(e,t){var n=Object.prototype.toString;e.exports=function(e){return n.call(e)}},function(e,t,n){var i,r=n(46),o=(i=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||""))?"Symbol(src)_1."+i:"";e.exports=function(e){return!!o&&o in e}},function(e,t,n){var i=n(2)["__core-js_shared__"];e.exports=i},function(e,t){e.exports=function(e,t){return null==e?void 0:e[t]}},function(e,t,n){var i=n(49),r=n(4),o=n(11);e.exports=function(){this.size=0,this.__data__={hash:new i,map:new(o||r),string:new i}}},function(e,t,n){var i=n(50),r=n(51),o=n(52),a=n(53),s=n(54);function l(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var i=e[t];this.set(i[0],i[1])}}l.prototype.clear=i,l.prototype.delete=r,l.prototype.get=o,l.prototype.has=a,l.prototype.set=s,e.exports=l},function(e,t,n){var i=n(7);e.exports=function(){this.__data__=i?i(null):{},this.size=0}},function(e,t){e.exports=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}},function(e,t,n){var i=n(7),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;if(i){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return r.call(t,e)?t[e]:void 0}},function(e,t,n){var i=n(7),r=Object.prototype.hasOwnProperty;e.exports=function(e){var t=this.__data__;return i?void 0!==t[e]:r.call(t,e)}},function(e,t,n){var i=n(7);e.exports=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=i&&void 0===t?"__lodash_hash_undefined__":t,this}},function(e,t,n){var i=n(8);e.exports=function(e){var t=i(this,e).delete(e);return this.size-=t?1:0,t}},function(e,t){e.exports=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}},function(e,t,n){var i=n(8);e.exports=function(e){return i(this,e).get(e)}},function(e,t,n){var i=n(8);e.exports=function(e){return i(this,e).has(e)}},function(e,t,n){var i=n(8);e.exports=function(e,t){var n=i(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}},function(e,t,n){var i=n(19),r=n(61),o=n(62);function a(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new i;++t<n;)this.add(e[t])}a.prototype.add=a.prototype.push=r,a.prototype.has=o,e.exports=a},function(e,t){e.exports=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this}},function(e,t){e.exports=function(e){return this.__data__.has(e)}},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length;++n<i;)if(t(e[n],n,e))return!0;return!1}},function(e,t){e.exports=function(e,t){return e.has(t)}},function(e,t,n){var i=n(12),r=n(66),o=n(14),a=n(20),s=n(67),l=n(68),d=i?i.prototype:void 0,c=d?d.valueOf:void 0;e.exports=function(e,t,n,i,d,u,h){switch(n){case"[object DataView]":if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case"[object ArrayBuffer]":return!(e.byteLength!=t.byteLength||!u(new r(e),new r(t)));case"[object Boolean]":case"[object Date]":case"[object Number]":return o(+e,+t);case"[object Error]":return e.name==t.name&&e.message==t.message;case"[object RegExp]":case"[object String]":return e==t+"";case"[object Map]":var p=s;case"[object Set]":var f=1&i;if(p||(p=l),e.size!=t.size&&!f)return!1;var m=h.get(e);if(m)return m==t;i|=2,h.set(e,t);var g=a(p(e),p(t),i,d,u,h);return h.delete(e),g;case"[object Symbol]":if(c)return c.call(e)==c.call(t)}return!1}},function(e,t,n){var i=n(2).Uint8Array;e.exports=i},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e,i){n[++t]=[i,e]})),n}},function(e,t){e.exports=function(e){var t=-1,n=Array(e.size);return e.forEach((function(e){n[++t]=e})),n}},function(e,t,n){var i=n(70),r=Object.prototype.hasOwnProperty;e.exports=function(e,t,n,o,a,s){var l=1&n,d=i(e),c=d.length;if(c!=i(t).length&&!l)return!1;for(var u=c;u--;){var h=d[u];if(!(l?h in t:r.call(t,h)))return!1}var p=s.get(e);if(p&&s.get(t))return p==t;var f=!0;s.set(e,t),s.set(t,e);for(var m=l;++u<c;){var g=e[h=d[u]],v=t[h];if(o)var b=l?o(v,g,h,t,e,s):o(g,v,h,e,t,s);if(!(void 0===b?g===v||a(g,v,n,o,s):b)){f=!1;break}m||(m="constructor"==h)}if(f&&!m){var y=e.constructor,C=t.constructor;y!=C&&"constructor"in e&&"constructor"in t&&!("function"==typeof y&&y instanceof y&&"function"==typeof C&&C instanceof C)&&(f=!1)}return s.delete(e),s.delete(t),f}},function(e,t,n){var i=n(71),r=n(73),o=n(76);e.exports=function(e){return i(e,o,r)}},function(e,t,n){var i=n(72),r=n(13);e.exports=function(e,t,n){var o=t(e);return r(e)?o:i(o,n(e))}},function(e,t){e.exports=function(e,t){for(var n=-1,i=t.length,r=e.length;++n<i;)e[r+n]=t[n];return e}},function(e,t,n){var i=n(74),r=n(75),o=Object.prototype.propertyIsEnumerable,a=Object.getOwnPropertySymbols,s=a?function(e){return null==e?[]:(e=Object(e),i(a(e),(function(t){return o.call(e,t)})))}:r;e.exports=s},function(e,t){e.exports=function(e,t){for(var n=-1,i=null==e?0:e.length,r=0,o=[];++n<i;){var a=e[n];t(a,n,e)&&(o[r++]=a)}return o}},function(e,t){e.exports=function(){return[]}},function(e,t,n){var i=n(77),r=n(86),o=n(90);e.exports=function(e){return o(e)?i(e):r(e)}},function(e,t,n){var i=n(78),r=n(79),o=n(13),a=n(21),s=n(82),l=n(23),d=Object.prototype.hasOwnProperty;e.exports=function(e,t){var n=o(e),c=!n&&r(e),u=!n&&!c&&a(e),h=!n&&!c&&!u&&l(e),p=n||c||u||h,f=p?i(e.length,String):[],m=f.length;for(var g in e)!t&&!d.call(e,g)||p&&("length"==g||u&&("offset"==g||"parent"==g)||h&&("buffer"==g||"byteLength"==g||"byteOffset"==g)||s(g,m))||f.push(g);return f}},function(e,t){e.exports=function(e,t){for(var n=-1,i=Array(e);++n<e;)i[n]=t(n);return i}},function(e,t,n){var i=n(80),r=n(9),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,l=i(function(){return arguments}())?i:function(e){return r(e)&&a.call(e,"callee")&&!s.call(e,"callee")};e.exports=l},function(e,t,n){var i=n(6),r=n(9);e.exports=function(e){return r(e)&&"[object Arguments]"==i(e)}},function(e,t){e.exports=function(){return!1}},function(e,t){var n=/^(?:0|[1-9]\d*)$/;e.exports=function(e,t){var i=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==i||"symbol"!=i&&n.test(e))&&e>-1&&e%1==0&&e<t}},function(e,t,n){var i=n(6),r=n(24),o=n(9),a={};a["[object Float32Array]"]=a["[object Float64Array]"]=a["[object Int8Array]"]=a["[object Int16Array]"]=a["[object Int32Array]"]=a["[object Uint8Array]"]=a["[object Uint8ClampedArray]"]=a["[object Uint16Array]"]=a["[object Uint32Array]"]=!0,a["[object Arguments]"]=a["[object Array]"]=a["[object ArrayBuffer]"]=a["[object Boolean]"]=a["[object DataView]"]=a["[object Date]"]=a["[object Error]"]=a["[object Function]"]=a["[object Map]"]=a["[object Number]"]=a["[object Object]"]=a["[object RegExp]"]=a["[object Set]"]=a["[object String]"]=a["[object WeakMap]"]=!1,e.exports=function(e){return o(e)&&r(e.length)&&!!a[i(e)]}},function(e,t){e.exports=function(e){return function(t){return e(t)}}},function(e,t,n){(function(e){var i=n(16),r=t&&!t.nodeType&&t,o=r&&"object"==typeof e&&e&&!e.nodeType&&e,a=o&&o.exports===r&&i.process,s=function(){try{return o&&o.require&&o.require("util").types||a&&a.binding&&a.binding("util")}catch(e){}}();e.exports=s}).call(this,n(22)(e))},function(e,t,n){var i=n(87),r=n(88),o=Object.prototype.hasOwnProperty;e.exports=function(e){if(!i(e))return r(e);var t=[];for(var n in Object(e))o.call(e,n)&&"constructor"!=n&&t.push(n);return t}},function(e,t){var n=Object.prototype;e.exports=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||n)}},function(e,t,n){var i=n(89)(Object.keys,Object);e.exports=i},function(e,t){e.exports=function(e,t){return function(n){return e(t(n))}}},function(e,t,n){var i=n(15),r=n(24);e.exports=function(e){return null!=e&&r(e.length)&&!i(e)}},function(e,t,n){var i=n(92),r=n(11),o=n(93),a=n(94),s=n(95),l=n(6),d=n(18),c=d(i),u=d(r),h=d(o),p=d(a),f=d(s),m=l;(i&&"[object DataView]"!=m(new i(new ArrayBuffer(1)))||r&&"[object Map]"!=m(new r)||o&&"[object Promise]"!=m(o.resolve())||a&&"[object Set]"!=m(new a)||s&&"[object WeakMap]"!=m(new s))&&(m=function(e){var t=l(e),n="[object Object]"==t?e.constructor:void 0,i=n?d(n):"";if(i)switch(i){case c:return"[object DataView]";case u:return"[object Map]";case h:return"[object Promise]";case p:return"[object Set]";case f:return"[object WeakMap]"}return t}),e.exports=m},function(e,t,n){var i=n(3)(n(2),"DataView");e.exports=i},function(e,t,n){var i=n(3)(n(2),"Promise");e.exports=i},function(e,t,n){var i=n(3)(n(2),"Set");e.exports=i},function(e,t,n){var i=n(3)(n(2),"WeakMap");e.exports=i},function(e,t,n){"use strict";var i=n(97);function r(){}e.exports=function(){function e(e,t,n,r,o,a){if(a!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return n.checkPropTypes=r,n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";n.r(t);var i=n(10),r=n.n(i),o=n(25),a=n.n(o),s=n(26),l=n.n(s),d=n(0),c=n.n(d),u=n(1),h=n.n(u);function p(e){return(p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function f(){return(f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function m(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function g(e,t){return!t||"object"!==p(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function v(e){return(v=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var C=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),g(this,v(t).apply(this,arguments))}var n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(t,h.a.PureComponent),n=t,(i=[{key:"render",value:function(){var e=this.props,t=e.children,n=e.title,i=function(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}(e,["children","title"]);return h.a.createElement("button",f({"aria-label":n,title:n,type:"button"},i),t)}}])&&m(n.prototype,i),t}();y(C,"propTypes",{children:c.a.node.isRequired,title:c.a.string}),y(C,"defaultProps",{title:null});var S=C;function x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var k=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=t,this.flatNodes=n}var t,n;return t=e,(n=[{key:"setProps",value:function(e){this.props=e}},{key:"clone",value:function(){var t=this,n={};return Object.keys(this.flatNodes).forEach((function(e){var i=t.flatNodes[e];n[e]=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){x(e,t,n[t])}))}return e}({},i)})),new e(this.props,n)}},{key:"getNode",value:function(e){return this.flatNodes[e]}},{key:"flattenNodes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(Array.isArray(e)&&0!==e.length){var r=this.props,o=r.disabled,a=r.noCascade;e.forEach((function(e,r){var s=t.nodeHasChildren(e);t.flatNodes[e.value]={label:e.label,value:e.value,children:e.children,parent:n,isParent:s,isLeaf:!s,showCheckbox:void 0===e.showCheckbox||e.showCheckbox,disabled:t.getDisabledState(e,n,o,a),treeDepth:i,index:r},t.flattenNodes(e.children,e,i+1)}))}}},{key:"nodeHasChildren",value:function(e){return Array.isArray(e.children)&&e.children.length>0}},{key:"getDisabledState",value:function(e,t,n,i){return!!n||!(i||!t.disabled)||Boolean(e.disabled)}},{key:"deserializeLists",value:function(e){var t=this,n=["checked","expanded"];Object.keys(this.flatNodes).forEach((function(e){n.forEach((function(n){t.flatNodes[e][n]=!1}))})),n.forEach((function(n){e[n].forEach((function(e){void 0!==t.flatNodes[e]&&(t.flatNodes[e][n]=!0)}))}))}},{key:"serializeList",value:function(e){var t=this,n=[];return Object.keys(this.flatNodes).forEach((function(i){t.flatNodes[i][e]&&n.push(i)})),n}},{key:"expandAllNodes",value:function(e){var t=this;return Object.keys(this.flatNodes).forEach((function(n){t.flatNodes[n].isParent&&(t.flatNodes[n].expanded=e)})),this}},{key:"toggleChecked",value:function(e,t,n){var i=this,r=this.flatNodes[e.value];if(r.isLeaf||n){if(e.disabled)return this;this.toggleNode(e.value,"checked",t)}else r.children.forEach((function(e){i.toggleChecked(e,t,n)}));return this}},{key:"toggleNode",value:function(e,t,n){return this.flatNodes[e][t]=n,this}}])&&w(t.prototype,n),e}();function Z(e){return(Z="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function R(){return(R=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e}).apply(this,arguments)}function T(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function F(e,t){return!t||"object"!==Z(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function D(e){return(D=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _(e,t){return(_=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var I=function(e){function t(){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),F(this,D(t).apply(this,arguments))}var n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_(e,t)}(t,h.a.PureComponent),n=t,(i=[{key:"componentDidMount",value:function(){this.updateDeterminateProperty()}},{key:"componentDidUpdate",value:function(){this.updateDeterminateProperty()}},{key:"updateDeterminateProperty",value:function(){var e=this.props.indeterminate;this.checkbox.indeterminate=e}},{key:"render",value:function(){var e=this,t=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){E(e,t,n[t])}))}return e}({},this.props);return delete t.indeterminate,h.a.createElement("input",R({},t,{ref:function(t){e.checkbox=t},type:"checkbox"}))}}])&&T(n.prototype,i),t}();E(I,"propTypes",{indeterminate:c.a.bool}),E(I,"defaultProps",{indeterminate:!1});var M=I,O=c.a.shape({check:c.a.node,uncheck:c.a.node,halfCheck:c.a.node,expandClose:c.a.node,expandOpen:c.a.node,expandAll:c.a.node,collapseAll:c.a.node,parentClose:c.a.node,parentOpen:c.a.node,leaf:c.a.node}),P=c.a.shape({collapseAll:c.a.string.isRequired,expandAll:c.a.string.isRequired,toggle:c.a.string.isRequired});function N(e){return(N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function q(e){return(q=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function z(e,t){return(z=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function A(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var U=function(e){function t(e){var n,i;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this,(n=!(i=q(t).call(this,e))||"object"!==N(i)&&"function"!=typeof i?A(this):i).onCheck=n.onCheck.bind(A(A(n))),n.onClick=n.onClick.bind(A(A(n))),n.onExpand=n.onExpand.bind(A(A(n))),n}var n,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&z(e,t)}(t,h.a.Component),n=t,(i=[{key:"onCheck",value:function(){var e=this.props,t=e.value;(0,e.onCheck)({value:t,checked:this.getCheckState({toggle:!0})})}},{key:"onClick",value:function(){var e=this.props,t=e.expandOnClick,n=e.isParent,i=e.value,r=e.onClick;n&&t&&this.onExpand(),r({value:i,checked:this.getCheckState({toggle:!1})})}},{key:"onExpand",value:function(){var e=this.props,t=e.expanded,n=e.value;(0,e.onExpand)({value:n,expanded:!t})}},{key:"getCheckState",value:function(e){var t=e.toggle,n=this.props,i=n.checked,r=n.optimisticToggle;return!(0!==i||!t)||1===i&&!t||2===i&&r}},{key:"renderCollapseButton",value:function(){var e=this.props,t=e.expandDisabled,n=e.isLeaf,i=e.lang;return n?h.a.createElement("span",{className:"rct-collapse"},h.a.createElement("span",{className:"rct-icon"})):h.a.createElement(S,{className:"rct-collapse rct-collapse-btn",disabled:t,title:i.toggle,onClick:this.onExpand},this.renderCollapseIcon())}},{key:"renderCollapseIcon",value:function(){var e=this.props,t=e.expanded,n=e.icons,i=n.expandClose,r=n.expandOpen;return t?r:i}},{key:"renderCheckboxIcon",value:function(){var e=this.props,t=e.checked,n=e.icons,i=n.uncheck,r=n.check,o=n.halfCheck;return 0===t?i:1===t?r:o}},{key:"renderNodeIcon",value:function(){var e=this.props,t=e.expanded,n=e.icon,i=e.icons,r=i.leaf,o=i.parentClose,a=i.parentOpen,s=e.isLeaf;return null!==n?n:s?r:t?a:o}},{key:"renderBareLabel",value:function(e){var t=this.props,n=t.onClick,i=t.title,r=null!==n;return h.a.createElement("span",{className:"rct-bare-label",title:i},r?h.a.createElement("span",{className:"rct-node-clickable",onClick:this.onClick,onKeyPress:this.onClick,role:"button",tabIndex:0},e):e)}},{key:"renderCheckboxLabel",value:function(e){var t=this.props,n=t.checked,i=t.disabled,r=t.title,o=t.treeId,a=t.value,s=null!==t.onClick,l="".concat(o,"-").concat(String(a).split(" ").join("_")),d=[h.a.createElement("label",{key:0,htmlFor:l,title:r},h.a.createElement(M,{checked:1===n,disabled:i,id:l,indeterminate:2===n,onClick:this.onCheck,onChange:function(){}}),h.a.createElement("span",{className:"rct-checkbox"},this.renderCheckboxIcon()),s?null:e)];return s&&d.push(h.a.createElement("span",{key:1,className:"rct-node-clickable",onClick:this.onClick,onKeyPress:this.onClick,role:"link",tabIndex:0},e)),d}},{key:"renderLabel",value:function(){var e=this.props,t=e.label,n=e.showCheckbox,i=[e.showNodeIcon?h.a.createElement("span",{key:0,className:"rct-node-icon"},this.renderNodeIcon()):null,h.a.createElement("span",{key:1,className:"rct-title"},t)];return n?this.renderCheckboxLabel(i):this.renderBareLabel(i)}},{key:"renderChildren",value:function(){return this.props.expanded?this.props.children:null}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.disabled,i=e.expanded,o=e.isLeaf,a=r()({"rct-node":!0,"rct-node-leaf":o,"rct-node-parent":!o,"rct-node-expanded":!o&&i,"rct-node-collapsed":!o&&!i,"rct-disabled":n},t);return h.a.createElement("li",{className:a},h.a.createElement("span",{className:"rct-text"},this.renderCollapseButton(),this.renderLabel()),this.renderChildren())}}])&&j(n.prototype,i),t}();$(U,"propTypes",{checked:c.a.number.isRequired,disabled:c.a.bool.isRequired,expandDisabled:c.a.bool.isRequired,expanded:c.a.bool.isRequired,icons:O.isRequired,isLeaf:c.a.bool.isRequired,isParent:c.a.bool.isRequired,label:c.a.node.isRequired,lang:P.isRequired,optimisticToggle:c.a.bool.isRequired,showNodeIcon:c.a.bool.isRequired,treeId:c.a.string.isRequired,value:c.a.oneOfType([c.a.string,c.a.number]).isRequired,onCheck:c.a.func.isRequired,onExpand:c.a.func.isRequired,children:c.a.node,className:c.a.string,expandOnClick:c.a.bool,icon:c.a.node,showCheckbox:c.a.bool,title:c.a.string,onClick:c.a.func}),$(U,"defaultProps",{children:null,className:null,expandOnClick:!1,icon:null,showCheckbox:!0,title:null,onClick:function(){}});var L=U,V=c.a.oneOfType([c.a.arrayOf(c.a.string),c.a.arrayOf(c.a.number)]);function K(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var B={label:c.a.node.isRequired,value:c.a.oneOfType([c.a.string,c.a.number]).isRequired,disabled:c.a.bool,icon:c.a.node,showCheckbox:c.a.bool,title:c.a.string},W=c.a.oneOfType([c.a.shape(B),c.a.shape(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){K(e,t,n[t])}))}return e}({},B,{children:c.a.arrayOf(B).isRequired}))]);function H(e){return(H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function G(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},i=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(i=i.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),i.forEach((function(t){ee(e,t,n[t])}))}return e}function Y(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function J(e){return(J=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Q(e,t){return(Q=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function X(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ee(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var te=function(e){function t(e){var n,i;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),n=!(i=J(t).call(this,e))||"object"!==H(i)&&"function"!=typeof i?X(this):i;var r=new k(e);return r.flattenNodes(e.nodes),r.deserializeLists({checked:e.checked,expanded:e.expanded}),n.state={id:e.id||"rct-".concat(l()(7)),model:r,prevProps:e},n.onCheck=n.onCheck.bind(X(X(n))),n.onExpand=n.onExpand.bind(X(X(n))),n.onNodeClick=n.onNodeClick.bind(X(X(n))),n.onExpandAll=n.onExpandAll.bind(X(X(n))),n.onCollapseAll=n.onCollapseAll.bind(X(X(n))),n}var n,i,o;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&Q(e,t)}(t,h.a.Component),n=t,o=[{key:"getDerivedStateFromProps",value:function(e,t){var n=t.model,i=t.prevProps,r=e.disabled,o=e.id,s=e.nodes,l=G({},t,{prevProps:e});return n.setProps(e),a()(i.nodes,s)&&i.disabled===r||n.flattenNodes(s),null!==o&&(l=G({},l,{id:o})),n.deserializeLists({checked:e.checked,expanded:e.expanded}),l}}],(i=[{key:"onCheck",value:function(e){var t=this.props,n=t.noCascade,i=t.onCheck,r=this.state.model.clone(),o=r.getNode(e.value);r.toggleChecked(e,e.checked,n),i(r.serializeList("checked"),G({},o,e))}},{key:"onExpand",value:function(e){var t=this.props.onExpand,n=this.state.model.clone(),i=n.getNode(e.value);n.toggleNode(e.value,"expanded",e.expanded),t(n.serializeList("expanded"),G({},i,e))}},{key:"onNodeClick",value:function(e){(0,this.props.onClick)(G({},this.state.model.getNode(e.value),e))}},{key:"onExpandAll",value:function(){this.expandAllNodes()}},{key:"onCollapseAll",value:function(){this.expandAllNodes(!1)}},{key:"expandAllNodes",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];(0,this.props.onExpand)(this.state.model.clone().expandAllNodes(e).serializeList("expanded"))}},{key:"determineShallowCheckState",value:function(e,t){var n=this.state.model.getNode(e.value);return n.isLeaf||t?n.checked?1:0:this.isEveryChildChecked(e)?1:this.isSomeChildChecked(e)?2:0}},{key:"isEveryChildChecked",value:function(e){var t=this;return e.children.every((function(e){return 1===t.state.model.getNode(e.value).checkState}))}},{key:"isSomeChildChecked",value:function(e){var t=this;return e.children.some((function(e){return t.state.model.getNode(e.value).checkState>0}))}},{key:"renderTreeNodes",value:function(e){var n=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.props,o=r.expandDisabled,a=r.expandOnClick,s=r.icons,l=r.lang,d=r.noCascade,c=r.onClick,u=r.onlyLeafCheckboxes,p=r.optimisticToggle,f=r.showNodeTitle,m=r.showNodeIcon,g=this.state,v=g.id,b=g.model,y=t.defaultProps.icons,C=e.map((function(e){var t=e.value,r=b.getNode(e.value),g=r.isParent?n.renderTreeNodes(e.children,e):null;r.checkState=n.determineShallowCheckState(e,d);var C=u?r.isLeaf:r.showCheckbox;return!i.value||b.getNode(i.value).expanded?h.a.createElement(L,{key:t,checked:r.checkState,className:e.className,disabled:r.disabled,expandDisabled:o,expandOnClick:a,expanded:r.expanded,icon:e.icon,icons:G({},y,s),label:e.label,lang:l,optimisticToggle:p,isLeaf:r.isLeaf,isParent:r.isParent,showCheckbox:C,showNodeIcon:m,title:f?e.title||e.label:e.title,treeId:v,value:e.value,onCheck:n.onCheck,onClick:c&&n.onNodeClick,onExpand:n.onExpand},g):null}));return h.a.createElement("ol",null,C)}},{key:"renderExpandAll",value:function(){var e=this.props,t=e.icons,n=t.expandAll,i=t.collapseAll,r=e.lang;return e.showExpandAll?h.a.createElement("div",{className:"rct-options"},h.a.createElement(S,{className:"rct-option rct-option-expand-all",title:r.expandAll,onClick:this.onExpandAll},n),h.a.createElement(S,{className:"rct-option rct-option-collapse-all",title:r.collapseAll,onClick:this.onCollapseAll},i)):null}},{key:"renderHiddenInput",value:function(){var e=this.props,t=e.name,n=e.nameAsArray;return void 0===t?null:n?this.renderArrayHiddenInput():this.renderJoinedHiddenInput()}},{key:"renderArrayHiddenInput",value:function(){var e=this.props,t=e.checked,n=e.name;return t.map((function(e){var t="".concat(n,"[]");return h.a.createElement("input",{key:e,name:t,type:"hidden",value:e})}))}},{key:"renderJoinedHiddenInput",value:function(){var e=this.props,t=e.checked,n=e.name,i=t.join(",");return h.a.createElement("input",{name:n,type:"hidden",value:i})}},{key:"render",value:function(){var e=this.props,t=e.disabled,n=e.nodes,i=e.nativeCheckboxes,o=this.renderTreeNodes(n),a=r()({"react-checkbox-tree":!0,"rct-disabled":t,"rct-native-display":i});return h.a.createElement("div",{className:a},this.renderExpandAll(),this.renderHiddenInput(),o)}}])&&Y(n.prototype,i),o&&Y(n,o),t}();ee(te,"propTypes",{nodes:c.a.arrayOf(W).isRequired,checked:V,disabled:c.a.bool,expandDisabled:c.a.bool,expandOnClick:c.a.bool,expanded:V,icons:O,id:c.a.string,lang:P,name:c.a.string,nameAsArray:c.a.bool,nativeCheckboxes:c.a.bool,noCascade:c.a.bool,onlyLeafCheckboxes:c.a.bool,optimisticToggle:c.a.bool,showExpandAll:c.a.bool,showNodeIcon:c.a.bool,showNodeTitle:c.a.bool,onCheck:c.a.func,onClick:c.a.func,onExpand:c.a.func}),ee(te,"defaultProps",{checked:[],disabled:!1,expandDisabled:!1,expandOnClick:!1,expanded:[],icons:{check:h.a.createElement("span",{className:"rct-icon rct-icon-check"}),uncheck:h.a.createElement("span",{className:"rct-icon rct-icon-uncheck"}),halfCheck:h.a.createElement("span",{className:"rct-icon rct-icon-half-check"}),expandClose:h.a.createElement("span",{className:"rct-icon rct-icon-expand-close"}),expandOpen:h.a.createElement("span",{className:"rct-icon rct-icon-expand-open"}),expandAll:h.a.createElement("span",{className:"rct-icon rct-icon-expand-all"}),collapseAll:h.a.createElement("span",{className:"rct-icon rct-icon-collapse-all"}),parentClose:h.a.createElement("span",{className:"rct-icon rct-icon-parent-close"}),parentOpen:h.a.createElement("span",{className:"rct-icon rct-icon-parent-open"}),leaf:h.a.createElement("span",{className:"rct-icon rct-icon-leaf"})},id:null,lang:{collapseAll:"Collapse all",expandAll:"Expand all",toggle:"Toggle"},name:void 0,nameAsArray:!1,nativeCheckboxes:!1,noCascade:!1,onlyLeafCheckboxes:!1,optimisticToggle:!0,showExpandAll:!1,showNodeIcon:!0,showNodeTitle:!1,onCheck:function(){},onClick:null,onExpand:function(){}}),t.default=te}]))},9238:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>te,DragSource:()=>q,DropTarget:()=>K});var i=n(28195);function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function o(e){return"function"==typeof e}function a(){}function s(e){if(!function(e){return"object"===r(e)&&null!==e}(e))return!1;if(null===Object.getPrototypeOf(e))return!0;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function l(e){var t=e.current;return null==t?null:t.decoratedRef?t.decoratedRef.current:t}function d(e){return(t=e)&&t.prototype&&"function"==typeof t.prototype.render||function(e){var t;return"Symbol(react.forward_ref)"===(null==e||null===(t=e.$$typeof)||void 0===t?void 0:t.toString())}(e);var t}var c=n(67294),u=n(15047),h=n(8679),p=n.n(h),f=n(82514);function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function v(e,t,n){return t&&g(e.prototype,t),n&&g(e,n),e}var b=function(){var e=function(){function e(t){m(this,e),this.isDisposed=!1,this.action=o(t)?t:a}return v(e,[{key:"dispose",value:function(){this.isDisposed||(this.action(),this.isDisposed=!0)}}],[{key:"isDisposable",value:function(e){return Boolean(e&&o(e.dispose))}},{key:"_fixup",value:function(t){return e.isDisposable(t)?t:e.empty}},{key:"create",value:function(t){return new e(t)}}]),e}();return e.empty={dispose:a},e}(),y=function(){function e(){m(this,e),this.isDisposed=!1;for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];this.disposables=n}return v(e,[{key:"add",value:function(e){this.isDisposed?e.dispose():this.disposables.push(e)}},{key:"remove",value:function(e){var t=!1;if(!this.isDisposed){var n=this.disposables.indexOf(e);-1!==n&&(t=!0,this.disposables.splice(n,1),e.dispose())}return t}},{key:"clear",value:function(){if(!this.isDisposed){for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var i=0;i<e;i++)t[i].dispose()}}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;for(var e=this.disposables.length,t=new Array(e),n=0;n<e;n++)t[n]=this.disposables[n];this.disposables=[];for(var i=0;i<e;i++)t[i].dispose()}}}]),e}(),C=function(){function e(){m(this,e),this.isDisposed=!1}return v(e,[{key:"getDisposable",value:function(){return this.current}},{key:"setDisposable",value:function(e){var t=this.isDisposed;if(!t){var n=this.current;this.current=e,n&&n.dispose()}t&&e&&e.dispose()}},{key:"dispose",value:function(){if(!this.isDisposed){this.isDisposed=!0;var e=this.current;this.current=void 0,e&&e.dispose()}}}]),e}();function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function w(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function k(e,t){return k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},k(e,t)}function Z(e,t){return!t||"object"!==S(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function R(e){return R=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},R(e)}function T(e){var t=e.DecoratedComponent,n=e.createHandler,r=e.createMonitor,o=e.createConnector,a=e.registerHandler,s=e.containerDisplayName,l=e.getType,h=e.collect,m=e.options.arePropsEqual,g=void 0===m?u.w:m,v=t,S=t.displayName||t.name||"Component",T=function(){var e=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&k(e,t)}(F,e);var t,s,p,m,T=(p=F,m=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=R(p);if(m){var n=R(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return Z(this,e)});function F(e){var t;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,F),(t=T.call(this,e)).decoratedRef=c.createRef(),t.handleChange=function(){var e=t.getCurrentState();(0,u.w)(e,t.state)||t.setState(e)},t.disposable=new C,t.receiveProps(e),t.dispose(),t}return t=F,(s=[{key:"getHandlerId",value:function(){return this.handlerId}},{key:"getDecoratedComponentInstance",value:function(){return(0,i.k)(this.decoratedRef.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.decoratedRef.current}},{key:"shouldComponentUpdate",value:function(e,t){return!g(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.disposable=new C,this.currentType=void 0,this.receiveProps(this.props),this.handleChange()}},{key:"componentDidUpdate",value:function(e){g(this.props,e)||(this.receiveProps(this.props),this.handleChange())}},{key:"componentWillUnmount",value:function(){this.dispose()}},{key:"receiveProps",value:function(e){this.handler&&(this.handler.receiveProps(e),this.receiveType(l(e)))}},{key:"receiveType",value:function(e){if(this.handlerMonitor&&this.manager&&this.handlerConnector&&e!==this.currentType){this.currentType=e;var t=(o=a(e,this.handler,this.manager),s=2,function(e){if(Array.isArray(e))return e}(o)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done)&&(n.push(a.value),!t||n.length!==t);i=!0);}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}}(o,s)||function(e,t){if(e){if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?x(e,t):void 0}}(o,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),n=t[0],i=t[1];this.handlerId=n,this.handlerMonitor.receiveHandlerId(n),this.handlerConnector.receiveHandlerId(n);var r=this.manager.getMonitor().subscribeToStateChange(this.handleChange,{handlerIds:[n]});this.disposable.setDisposable(new y(new b(r),new b(i)))}var o,s}},{key:"dispose",value:function(){this.disposable.dispose(),this.handlerConnector&&this.handlerConnector.receiveHandlerId(null)}},{key:"getCurrentState",value:function(){return this.handlerConnector?h(this.handlerConnector.hooks,this.handlerMonitor,this.props):{}}},{key:"render",value:function(){var e=this;return c.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return e.receiveDragDropManager(n),"undefined"!=typeof requestAnimationFrame&&requestAnimationFrame((function(){var t;return null===(t=e.handlerConnector)||void 0===t?void 0:t.reconnect()})),c.createElement(v,Object.assign({},e.props,e.getCurrentState(),{ref:d(v)?e.decoratedRef:null}))}))}},{key:"receiveDragDropManager",value:function(e){void 0===this.manager&&((0,i.k)(void 0!==e,"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",S,S),void 0!==e&&(this.manager=e,this.handlerMonitor=r(e),this.handlerConnector=o(e.getBackend()),this.handler=n(this.handlerMonitor,this.decoratedRef)))}}])&&w(t.prototype,s),F}(c.Component);return e.DecoratedComponent=t,e.displayName="".concat(s,"(").concat(S,")"),e}();return p()(T,t)}var F=n(33273),D=n(60938),_=n(8556);function E(e){return E="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},E(e)}function I(e,t){return"string"==typeof e||"symbol"===E(e)||!!t&&Array.isArray(e)&&e.every((function(e){return I(e,!1)}))}function M(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var O=["canDrag","beginDrag","isDragging","endDrag"],P=["beginDrag"],N=function(){function e(t,n,i){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.beginDrag=function(){if(r.props)return r.spec.beginDrag(r.props,r.monitor,r.ref.current)},this.spec=t,this.monitor=n,this.ref=i}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"canDrag",value:function(){return!!this.props&&(!this.spec.canDrag||this.spec.canDrag(this.props,this.monitor))}},{key:"isDragging",value:function(e,t){return!!this.props&&(this.spec.isDragging?this.spec.isDragging(this.props,this.monitor):t===e.getSourceId())}},{key:"endDrag",value:function(){this.props&&this.spec.endDrag&&this.spec.endDrag(this.props,this.monitor,l(this.ref))}}])&&M(t.prototype,n),e}();function j(e){return Object.keys(e).forEach((function(t){(0,i.k)(O.indexOf(t)>-1,'Expected the drag source specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',O.join(", "),t),(0,i.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),P.forEach((function(t){(0,i.k)("function"==typeof e[t],"Expected %s in the drag source specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source",t,t,e[t])})),function(t,n){return new N(e,t,n)}}function q(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,i.k)(I(e),'Expected "type" provided as the first argument to DragSource to be a string, or a function that returns a string given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',e),o=function(){return e}),(0,i.k)(s(t),'Expected "spec" provided as the second argument to DragSource to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',t);var a=j(t);return(0,i.k)("function"==typeof n,'Expected "collect" provided as the third argument to DragSource to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),(0,i.k)(s(r),'Expected "options" provided as the fourth argument to DragSource to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-source',n),function(e){return T({containerDisplayName:"DragSource",createHandler:a,registerHandler:F.w,createConnector:function(e){return new _.x(e)},createMonitor:function(e){return new D.p(e)},DecoratedComponent:e,getType:o,collect:n,options:r})}}var z=n(89026),A=n(56941);function $(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var U=["canDrop","hover","drop"],L=function(){function e(t,n,i){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.props=null,this.spec=t,this.monitor=n,this.ref=i}var t,n;return t=e,(n=[{key:"receiveProps",value:function(e){this.props=e}},{key:"receiveMonitor",value:function(e){this.monitor=e}},{key:"canDrop",value:function(){return!this.spec.canDrop||this.spec.canDrop(this.props,this.monitor)}},{key:"hover",value:function(){this.spec.hover&&this.props&&this.spec.hover(this.props,this.monitor,l(this.ref))}},{key:"drop",value:function(){if(this.spec.drop)return this.spec.drop(this.props,this.monitor,this.ref.current)}}])&&$(t.prototype,n),e}();function V(e){return Object.keys(e).forEach((function(t){(0,i.k)(U.indexOf(t)>-1,'Expected the drop target specification to only have some of the following keys: %s. Instead received a specification with an unexpected "%s" key. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',U.join(", "),t),(0,i.k)("function"==typeof e[t],"Expected %s in the drop target specification to be a function. Instead received a specification with %s: %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target",t,t,e[t])})),function(t,n){return new L(e,t,n)}}function K(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=e;"function"!=typeof e&&((0,i.k)(I(e,!0),'Expected "type" provided as the first argument to DropTarget to be a string, an array of strings, or a function that returns either given the current props. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',e),o=function(){return e}),(0,i.k)(s(t),'Expected "spec" provided as the second argument to DropTarget to be a plain object. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',t);var a=V(t);return(0,i.k)("function"==typeof n,'Expected "collect" provided as the third argument to DropTarget to be a function that returns a plain object of props to inject. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),(0,i.k)(s(r),'Expected "options" provided as the fourth argument to DropTarget to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drop-target',n),function(e){return T({containerDisplayName:"DropTarget",createHandler:a,registerHandler:F.n,createMonitor:function(e){return new A.H(e)},createConnector:function(e){return new z.Y(e)},DecoratedComponent:e,getType:o,collect:n,options:r})}}function B(e){return B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},B(e)}function W(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function H(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function G(e,t,n){return t&&H(e.prototype,t),n&&H(e,n),e}function Y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&J(e,t)}function J(e,t){return J=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},J(e,t)}function Q(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=ee(e);if(t){var r=ee(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return X(this,n)}}function X(e,t){return!t||"object"!==B(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function ee(e){return ee=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},ee(e)}function te(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return(0,i.k)("function"==typeof e,'Expected "collect" provided as the first argument to DragLayer to be a function that collects props to inject into the component. ',"Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer",e),(0,i.k)(s(t),'Expected "options" provided as the second argument to DragLayer to be a plain object when specified. Instead, received %s. Read more: http://react-dnd.github.io/react-dnd/docs/api/drag-layer',t),function(n){var r=n,o=t.arePropsEqual,a=void 0===o?u.w:o,s=r.displayName||r.name||"Component",l=function(){var t=function(t){Y(o,t);var n=Q(o);function o(){var e;return W(this,o),(e=n.apply(this,arguments)).isCurrentlyMounted=!1,e.ref=c.createRef(),e.handleChange=function(){if(e.isCurrentlyMounted){var t=e.getCurrentState();(0,u.w)(t,e.state)||e.setState(t)}},e}return G(o,[{key:"getDecoratedComponentInstance",value:function(){return(0,i.k)(this.ref.current,"In order to access an instance of the decorated component, it must either be a class component or use React.forwardRef()"),this.ref.current}},{key:"shouldComponentUpdate",value:function(e,t){return!a(e,this.props)||!(0,u.w)(t,this.state)}},{key:"componentDidMount",value:function(){this.isCurrentlyMounted=!0,this.handleChange()}},{key:"componentWillUnmount",value:function(){this.isCurrentlyMounted=!1,this.unsubscribeFromOffsetChange&&(this.unsubscribeFromOffsetChange(),this.unsubscribeFromOffsetChange=void 0),this.unsubscribeFromStateChange&&(this.unsubscribeFromStateChange(),this.unsubscribeFromStateChange=void 0)}},{key:"render",value:function(){var e=this;return c.createElement(f.L.Consumer,null,(function(t){var n=t.dragDropManager;return void 0===n?null:(e.receiveDragDropManager(n),e.isCurrentlyMounted?c.createElement(r,Object.assign({},e.props,e.state,{ref:d(r)?e.ref:null})):null)}))}},{key:"receiveDragDropManager",value:function(e){if(void 0===this.manager){this.manager=e,(0,i.k)("object"===B(e),"Could not find the drag and drop manager in the context of %s. Make sure to render a DndProvider component in your top-level component. Read more: http://react-dnd.github.io/react-dnd/docs/troubleshooting#could-not-find-the-drag-and-drop-manager-in-the-context",s,s);var t=this.manager.getMonitor();this.unsubscribeFromOffsetChange=t.subscribeToOffsetChange(this.handleChange),this.unsubscribeFromStateChange=t.subscribeToStateChange(this.handleChange)}}},{key:"getCurrentState",value:function(){if(!this.manager)return{};var t=this.manager.getMonitor();return e(t,this.props)}}]),o}(c.Component);return t.displayName="DragLayer(".concat(s,")"),t.DecoratedComponent=n,t}();return p()(l,n)}}},84785:(e,t,n)=>{"use strict";n.d(t,{DragLayer:()=>r.DragLayer,DragSource:()=>r.DragSource,DropTarget:()=>r.DropTarget});var i=n(31388);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var r=n(9238)},73897:()=>{},48058:()=>{},31388:(e,t,n)=>{"use strict";var i=n(75253);n.o(i,"DragLayer")&&n.d(t,{DragLayer:function(){return i.DragLayer}}),n.o(i,"DragSource")&&n.d(t,{DragSource:function(){return i.DragSource}}),n.o(i,"DropTarget")&&n.d(t,{DropTarget:function(){return i.DropTarget}});var r=n(48058);n.o(r,"DragLayer")&&n.d(t,{DragLayer:function(){return r.DragLayer}}),n.o(r,"DragSource")&&n.d(t,{DragSource:function(){return r.DragSource}}),n.o(r,"DropTarget")&&n.d(t,{DropTarget:function(){return r.DropTarget}});var o=n(72105);n.o(o,"DragLayer")&&n.d(t,{DragLayer:function(){return o.DragLayer}}),n.o(o,"DragSource")&&n.d(t,{DragSource:function(){return o.DragSource}}),n.o(o,"DropTarget")&&n.d(t,{DropTarget:function(){return o.DropTarget}});var a=n(73897);n.o(a,"DragLayer")&&n.d(t,{DragLayer:function(){return a.DragLayer}}),n.o(a,"DragSource")&&n.d(t,{DragSource:function(){return a.DragSource}}),n.o(a,"DropTarget")&&n.d(t,{DropTarget:function(){return a.DropTarget}})},75253:()=>{},72105:()=>{},46871:(e,t,n)=>{"use strict";function i(){var e=this.constructor.getDerivedStateFromProps(this.props,this.state);null!=e&&this.setState(e)}function r(e){this.setState(function(t){var n=this.constructor.getDerivedStateFromProps(e,t);return null!=n?n:null}.bind(this))}function o(e,t){try{var n=this.props,i=this.state;this.props=e,this.state=t,this.__reactInternalSnapshotFlag=!0,this.__reactInternalSnapshot=this.getSnapshotBeforeUpdate(n,i)}finally{this.props=n,this.state=i}}function a(e){var t=e.prototype;if(!t||!t.isReactComponent)throw new Error("Can only polyfill class components");if("function"!=typeof e.getDerivedStateFromProps&&"function"!=typeof t.getSnapshotBeforeUpdate)return e;var n=null,a=null,s=null;if("function"==typeof t.componentWillMount?n="componentWillMount":"function"==typeof t.UNSAFE_componentWillMount&&(n="UNSAFE_componentWillMount"),"function"==typeof t.componentWillReceiveProps?a="componentWillReceiveProps":"function"==typeof t.UNSAFE_componentWillReceiveProps&&(a="UNSAFE_componentWillReceiveProps"),"function"==typeof t.componentWillUpdate?s="componentWillUpdate":"function"==typeof t.UNSAFE_componentWillUpdate&&(s="UNSAFE_componentWillUpdate"),null!==n||null!==a||null!==s){var l=e.displayName||e.name,d="function"==typeof e.getDerivedStateFromProps?"getDerivedStateFromProps()":"getSnapshotBeforeUpdate()";throw Error("Unsafe legacy lifecycles will not be called for components using new component APIs.\n\n"+l+" uses "+d+" but also contains the following legacy lifecycles:"+(null!==n?"\n  "+n:"")+(null!==a?"\n  "+a:"")+(null!==s?"\n  "+s:"")+"\n\nThe above lifecycles should be removed. Learn more about this warning here:\nhttps://fb.me/react-async-component-lifecycle-hooks")}if("function"==typeof e.getDerivedStateFromProps&&(t.componentWillMount=i,t.componentWillReceiveProps=r),"function"==typeof t.getSnapshotBeforeUpdate){if("function"!=typeof t.componentDidUpdate)throw new Error("Cannot polyfill getSnapshotBeforeUpdate() for components that do not define componentDidUpdate() on the prototype");t.componentWillUpdate=o;var c=t.componentDidUpdate;t.componentDidUpdate=function(e,t,n){var i=this.__reactInternalSnapshotFlag?this.__reactInternalSnapshot:n;c.call(this,e,t,i)}}return e}n.r(t),n.d(t,{polyfill:()=>a}),i.__suppressDeprecationWarning=!0,r.__suppressDeprecationWarning=!0,o.__suppressDeprecationWarning=!0},24903:(e,t,n)=>{"use strict";t.cj=void 0;var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(67294),o=l(r),a=l(n(45697)),s=n(76597);function l(e){return e&&e.__esModule?e:{default:e}}var d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var n=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.state={searchTerm:n.props.value||""},n.updateSearch=n.updateSearch.bind(n),n.filter=n.filter.bind(n),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentWillReceiveProps",value:function(e){if(void 0!==e.value&&e.value!==this.props.value){var t={target:{value:e.value}};this.updateSearch(t)}}},{key:"render",value:function(){var e=this.props,t=e.className,n=(e.onChange,e.caseSensitive,e.sortResults,e.throttle,e.filterKeys,e.value,e.fuzzy,e.inputClassName),i=function(e,t){var n={};for(var i in e)t.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(e,i)&&(n[i]=e[i]);return n}(e,["className","onChange","caseSensitive","sortResults","throttle","filterKeys","value","fuzzy","inputClassName"]);return i.type=i.type||"search",i.value=this.state.searchTerm,i.onChange=this.updateSearch,i.className=n,i.placeholder=i.placeholder||"Search",o.default.createElement("div",{className:t},o.default.createElement("input",i))}},{key:"updateSearch",value:function(e){var t=this,n=e.target.value;this.setState({searchTerm:n},(function(){t._throttleTimeout&&clearTimeout(t._throttleTimeout),t._throttleTimeout=setTimeout((function(){return t.props.onChange(n)}),t.props.throttle)}))}},{key:"filter",value:function(e){var t=this.props,n=t.filterKeys,i=t.caseSensitive,r=t.fuzzy,o=t.sortResults;return(0,s.createFilter)(this.state.searchTerm,e||n,{caseSensitive:i,fuzzy:r,sortResults:o})}}]),t}(r.Component);d.defaultProps={className:"",onChange:function(){},caseSensitive:!1,fuzzy:!1,throttle:200},d.propTypes={className:a.default.string,inputClassName:a.default.string,onChange:a.default.func,caseSensitive:a.default.bool,sortResults:a.default.bool,fuzzy:a.default.bool,throttle:a.default.number,filterKeys:a.default.oneOf([a.default.string,a.default.arrayOf(a.default.string)]),value:a.default.string},t.cj=s.createFilter},76597:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getValuesForKey=a,t.searchStrings=s,t.createFilter=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return function(i){if(""===e)return!0;n.caseSensitive||(e=e.toLowerCase());var r=e.split(" ");return t?("string"==typeof t&&(t=[t]),r.every((function(e){var r=void 0;if(-1!==e.indexOf(":")){var o=e.split(":")[0];e=e.split(":")[1],r=t.filter((function(e){return e.toLowerCase().indexOf(o)>-1}))}else r=t;return r.some((function(t){return s(a(t,i),e,n)}))}))):r.every((function(e){return s([i],e,n)}))}};var i,r=(i=n(69021))&&i.__esModule?i:{default:i};function o(e){return e.reduce((function(e,t){return e.concat(Array.isArray(t)?o(t):t)}),[])}function a(e,t){var n=e.split("."),i=[t];return n.forEach((function(e){var t=[];i.forEach((function(n){if(n)if(n instanceof Array){var i=parseInt(e,10);if(!isNaN(i))return t.push(n[i]);n.forEach((function(n){t.push(n[e])}))}else n&&"function"==typeof n.get?t.push(n.get(e)):t.push(n[e])})),i=t})),(i=o(i=i.map((function(e){return e&&e.push&&e.toArray?e.toArray():e})))).filter((function(e){return"string"==typeof e||"number"==typeof e}))}function s(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n.caseSensitive,o=n.fuzzy,a=n.sortResults,s=n.exactMatch;e=e.map((function(e){return e.toString()}));try{if(o){"function"==typeof e.toJS&&(e=e.toJS());var l=new r.default(e.map((function(e){return{id:e}})),{keys:["id"],id:"id",caseSensitive:i,shouldSort:a});return l.search(t).length}return e.some((function(e){try{return i||(e=e.toLowerCase()),s&&(t=new RegExp("^"+t+"$","i")),!(!e||-1===e.search(t))}catch(e){return!1}}))}catch(e){return!1}}},69021:function(e){e.exports=function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function r(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var o=n(1),a=n(7),s=a.get,l=(a.deepValue,a.isArray),d=function(){function e(t,n){var i=n.location,r=void 0===i?0:i,o=n.distance,a=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.caseSensitive,p=void 0!==h&&h,f=n.tokenSeparator,m=void 0===f?/ +/g:f,g=n.findAllMatches,v=void 0!==g&&g,b=n.minMatchCharLength,y=void 0===b?1:b,C=n.id,S=void 0===C?null:C,x=n.keys,w=void 0===x?[]:x,k=n.shouldSort,Z=void 0===k||k,R=n.getFn,T=void 0===R?s:R,F=n.sortFn,D=void 0===F?function(e,t){return e.score-t.score}:F,_=n.tokenize,E=void 0!==_&&_,I=n.matchAllTokens,M=void 0!==I&&I,O=n.includeMatches,P=void 0!==O&&O,N=n.includeScore,j=void 0!==N&&N,q=n.verbose,z=void 0!==q&&q;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:a,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,minMatchCharLength:y,id:S,keys:w,includeMatches:P,includeScore:j,shouldSort:Z,getFn:T,sortFn:D,verbose:z,tokenize:E,matchAllTokens:M},this.setCollection(t),this._processKeys(w)}var t,n;return t=e,(n=[{key:"setCollection",value:function(e){return this.list=e,e}},{key:"_processKeys",value:function(e){if(this._keyWeights={},this._keyNames=[],e.length&&"string"==typeof e[0])for(var t=0,n=e.length;t<n;t+=1){var i=e[t];this._keyWeights[i]=1,this._keyNames.push(i)}else{for(var r=null,o=null,a=0,s=0,l=e.length;s<l;s+=1){var d=e[s];if(!d.hasOwnProperty("name"))throw new Error('Missing "name" property in key object');var c=d.name;if(this._keyNames.push(c),!d.hasOwnProperty("weight"))throw new Error('Missing "weight" property in key object');var u=d.weight;if(u<0||u>1)throw new Error('"weight" property in key must bein the range of [0, 1)');o=null==o?u:Math.max(o,u),r=null==r?u:Math.min(r,u),this._keyWeights[c]=u,a+=u}if(a>1)throw new Error("Total of weights cannot exceed 1")}}},{key:"search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{limit:!1};this._log('---------\nSearch pattern: "'.concat(e,'"'));var n=this._prepareSearchers(e),i=n.tokenSearchers,r=n.fullSearcher,o=this._search(i,r);return this._computeScore(o),this.options.shouldSort&&this._sort(o),t.limit&&"number"==typeof t.limit&&(o=o.slice(0,t.limit)),this._format(o)}},{key:"_prepareSearchers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=[];if(this.options.tokenize)for(var n=e.split(this.options.tokenSeparator),i=0,r=n.length;i<r;i+=1)t.push(new o(n[i],this.options));return{tokenSearchers:t,fullSearcher:new o(e,this.options)}}},{key:"_search",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=this.list,i={},r=[];if("string"==typeof n[0]){for(var o=0,a=n.length;o<a;o+=1)this._analyze({key:"",value:n[o],record:o,index:o},{resultMap:i,results:r,tokenSearchers:e,fullSearcher:t});return r}for(var s=0,l=n.length;s<l;s+=1)for(var d=n[s],c=0,u=this._keyNames.length;c<u;c+=1){var h=this._keyNames[c];this._analyze({key:h,value:this.options.getFn(d,h),record:d,index:s},{resultMap:i,results:r,tokenSearchers:e,fullSearcher:t})}return r}},{key:"_analyze",value:function(e,t){var n=this,i=e.key,r=e.arrayIndex,o=void 0===r?-1:r,a=e.value,s=e.record,d=e.index,c=t.tokenSearchers,u=void 0===c?[]:c,h=t.fullSearcher,p=t.resultMap,f=void 0===p?{}:p,m=t.results,g=void 0===m?[]:m;!function e(t,r,o,a){if(null!=r)if("string"==typeof r){var s=!1,d=-1,c=0;n._log("\nKey: ".concat(""===i?"--":i));var p=h.search(r);if(n._log('Full text: "'.concat(r,'", score: ').concat(p.score)),n.options.tokenize){for(var m=r.split(n.options.tokenSeparator),v=m.length,b=[],y=0,C=u.length;y<C;y+=1){var S=u[y];n._log('\nPattern: "'.concat(S.pattern,'"'));for(var x=!1,w=0;w<v;w+=1){var k=m[w],Z=S.search(k),R={};Z.isMatch?(R[k]=Z.score,s=!0,x=!0,b.push(Z.score)):(R[k]=1,n.options.matchAllTokens||b.push(1)),n._log('Token: "'.concat(k,'", score: ').concat(R[k]))}x&&(c+=1)}d=b[0];for(var T=b.length,F=1;F<T;F+=1)d+=b[F];d/=T,n._log("Token score average:",d)}var D=p.score;d>-1&&(D=(D+d)/2),n._log("Score average:",D);var _=!n.options.tokenize||!n.options.matchAllTokens||c>=u.length;if(n._log("\nCheck Matches: ".concat(_)),(s||p.isMatch)&&_){var E={key:i,arrayIndex:t,value:r,score:D};n.options.includeMatches&&(E.matchedIndices=p.matchedIndices);var I=f[a];I?I.output.push(E):(f[a]={item:o,output:[E]},g.push(f[a]))}}else if(l(r))for(var M=0,O=r.length;M<O;M+=1)e(M,r[M],o,a)}(o,a,s,d)}},{key:"_computeScore",value:function(e){this._log("\n\nComputing score:\n");for(var t=this._keyWeights,n=!!Object.keys(t).length,i=0,r=e.length;i<r;i+=1){for(var o=e[i],a=o.output,s=a.length,l=1,d=0;d<s;d+=1){var c=a[d],u=c.key,h=n?t[u]:1,p=0===c.score&&t&&t[u]>0?Number.EPSILON:c.score;l*=Math.pow(p,h)}o.score=l,this._log(o)}}},{key:"_sort",value:function(e){this._log("\n\nSorting...."),e.sort(this.options.sortFn)}},{key:"_format",value:function(e){var t=[];if(this.options.verbose){var n=[];this._log("\n\nOutput:\n\n",JSON.stringify(e,(function(e,t){if("object"===i(t)&&null!==t){if(-1!==n.indexOf(t))return;n.push(t)}return t}),2)),n=null}var r=[];this.options.includeMatches&&r.push((function(e,t){var n=e.output;t.matches=[];for(var i=0,r=n.length;i<r;i+=1){var o=n[i];if(0!==o.matchedIndices.length){var a={indices:o.matchedIndices,value:o.value};o.key&&(a.key=o.key),o.hasOwnProperty("arrayIndex")&&o.arrayIndex>-1&&(a.arrayIndex=o.arrayIndex),t.matches.push(a)}}})),this.options.includeScore&&r.push((function(e,t){t.score=e.score}));for(var o=0,a=e.length;o<a;o+=1){var s=e[o];if(this.options.id&&(s.item=this.options.getFn(s.item,this.options.id)[0]),r.length){for(var l={item:s.item},d=0,c=r.length;d<c;d+=1)r[d](s,l);t.push(l)}else t.push(s.item)}return t}},{key:"_log",value:function(){var e;this.options.verbose&&(e=console).log.apply(e,arguments)}}])&&r(t.prototype,n),e}();e.exports=d},function(e,t,n){function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}var r=n(2),o=n(3),a=n(6),s=function(){function e(t,n){var i=n.location,r=void 0===i?0:i,o=n.distance,s=void 0===o?100:o,l=n.threshold,d=void 0===l?.6:l,c=n.maxPatternLength,u=void 0===c?32:c,h=n.isCaseSensitive,p=void 0!==h&&h,f=n.tokenSeparator,m=void 0===f?/ +/g:f,g=n.findAllMatches,v=void 0!==g&&g,b=n.minMatchCharLength,y=void 0===b?1:b,C=n.includeMatches,S=void 0!==C&&C;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.options={location:r,distance:s,threshold:d,maxPatternLength:u,isCaseSensitive:p,tokenSeparator:m,findAllMatches:v,includeMatches:S,minMatchCharLength:y},this.pattern=p?t:t.toLowerCase(),this.pattern.length<=u&&(this.patternAlphabet=a(this.pattern))}var t,n;return t=e,(n=[{key:"search",value:function(e){var t=this.options,n=t.isCaseSensitive,i=t.includeMatches;if(n||(e=e.toLowerCase()),this.pattern===e){var a={isMatch:!0,score:0};return i&&(a.matchedIndices=[[0,e.length-1]]),a}var s=this.options,l=s.maxPatternLength,d=s.tokenSeparator;if(this.pattern.length>l)return r(e,this.pattern,d);var c=this.options,u=c.location,h=c.distance,p=c.threshold,f=c.findAllMatches,m=c.minMatchCharLength;return o(e,this.pattern,this.patternAlphabet,{location:u,distance:h,threshold:p,findAllMatches:f,minMatchCharLength:m,includeMatches:i})}}])&&i(t.prototype,n),e}();e.exports=s},function(e,t){var n=/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g;e.exports=function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:/ +/g,r=new RegExp(t.replace(n,"\\$&").replace(i,"|")),o=e.match(r),a=!!o,s=[];if(a)for(var l=0,d=o.length;l<d;l+=1){var c=o[l];s.push([e.indexOf(c),c.length-1])}return{score:a?.5:1,isMatch:a,matchedIndices:s}}},function(e,t,n){var i=n(4),r=n(5);e.exports=function(e,t,n,o){for(var a=o.location,s=void 0===a?0:a,l=o.distance,d=void 0===l?100:l,c=o.threshold,u=void 0===c?.6:c,h=o.findAllMatches,p=void 0!==h&&h,f=o.minMatchCharLength,m=void 0===f?1:f,g=o.includeMatches,v=void 0!==g&&g,b=s,y=e.length,C=u,S=e.indexOf(t,b),x=t.length,w=[],k=0;k<y;k+=1)w[k]=0;if(-1!==S){var Z=i(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});if(C=Math.min(Z,C),-1!==(S=e.lastIndexOf(t,b+x))){var R=i(t,{errors:0,currentLocation:S,expectedLocation:b,distance:d});C=Math.min(R,C)}}S=-1;for(var T=[],F=1,D=x+y,_=1<<(x<=31?x-1:30),E=0;E<x;E+=1){for(var I=0,M=D;I<M;)i(t,{errors:E,currentLocation:b+M,expectedLocation:b,distance:d})<=C?I=M:D=M,M=Math.floor((D-I)/2+I);D=M;var O=Math.max(1,b-M+1),P=p?y:Math.min(b+M,y)+x,N=Array(P+2);N[P+1]=(1<<E)-1;for(var j=P;j>=O;j-=1){var q=j-1,z=n[e.charAt(q)];if(z&&(w[q]=1),N[j]=(N[j+1]<<1|1)&z,0!==E&&(N[j]|=(T[j+1]|T[j])<<1|1|T[j+1]),N[j]&_&&(F=i(t,{errors:E,currentLocation:q,expectedLocation:b,distance:d}))<=C){if(C=F,(S=q)<=b)break;O=Math.max(1,2*b-S)}}if(i(t,{errors:E+1,currentLocation:b,expectedLocation:b,distance:d})>C)break;T=N}var A={isMatch:S>=0,score:0===F?.001:F};return v&&(A.matchedIndices=r(w,m)),A}},function(e,t){e.exports=function(e,t){var n=t.errors,i=void 0===n?0:n,r=t.currentLocation,o=void 0===r?0:r,a=t.expectedLocation,s=void 0===a?0:a,l=t.distance,d=void 0===l?100:l,c=i/e.length,u=Math.abs(s-o);return d?c+u/d:u?1:c}},function(e,t){e.exports=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=[],i=-1,r=-1,o=0,a=e.length;o<a;o+=1){var s=e[o];s&&-1===i?i=o:s||-1===i||((r=o-1)-i+1>=t&&n.push([i,r]),i=-1)}return e[o-1]&&o-i>=t&&n.push([i,o-1]),n}},function(e,t){e.exports=function(e){for(var t={},n=e.length,i=0;i<n;i+=1)t[e.charAt(i)]=0;for(var r=0;r<n;r+=1)t[e.charAt(r)]|=1<<n-r-1;return t}},function(e,t){var n=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===Object.prototype.toString.call(e)},i=function(e){return null==e?"":function(e){if("string"==typeof e)return e;var t=e+"";return"0"==t&&1/e==-1/0?"-0":t}(e)},r=function(e){return"string"==typeof e},o=function(e){return"number"==typeof e};e.exports={get:function(e,t){var a=[];return function e(t,s){if(s){var l=s.indexOf("."),d=s,c=null;-1!==l&&(d=s.slice(0,l),c=s.slice(l+1));var u=t[d];if(null!=u)if(c||!r(u)&&!o(u))if(n(u))for(var h=0,p=u.length;h<p;h+=1)e(u[h],c);else c&&e(u,c);else a.push(i(u))}else a.push(t)}(e,t),a},isArray:n,isString:r,isNum:o,toString:i}}])},18474:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(67294),a=d(o),s=d(n(45697)),l=d(n(54087));function d(e){return e&&e.__esModule?e:{default:e}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var h=function(e){function t(){var e,n,i;c(this,t);for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];return n=i=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.events=["resize","scroll","touchstart","touchmove","touchend","pageshow","load"],i.subscribers=[],i.rafHandle=null,i.subscribe=function(e){i.subscribers=i.subscribers.concat(e)},i.unsubscribe=function(e){i.subscribers=i.subscribers.filter((function(t){return t!==e}))},i.notifySubscribers=function(e){if(!i.framePending){var t=e.currentTarget;i.rafHandle=(0,l.default)((function(){i.framePending=!1;var e=i.node.getBoundingClientRect(),n=e.top,r=e.bottom;i.subscribers.forEach((function(e){return e({distanceFromTop:n,distanceFromBottom:r,eventSource:t===window?document.body:i.node})}))})),i.framePending=!0}},i.getParent=function(){return i.node},u(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"getChildContext",value:function(){return{subscribe:this.subscribe,unsubscribe:this.unsubscribe,getParent:this.getParent}}},{key:"componentDidMount",value:function(){var e=this;this.events.forEach((function(t){return window.addEventListener(t,e.notifySubscribers)}))}},{key:"componentWillUnmount",value:function(){var e=this;this.rafHandle&&(l.default.cancel(this.rafHandle),this.rafHandle=null),this.events.forEach((function(t){return window.removeEventListener(t,e.notifySubscribers)}))}},{key:"render",value:function(){var e=this;return a.default.createElement("div",i({},this.props,{ref:function(t){return e.node=t},onScroll:this.notifySubscribers,onTouchStart:this.notifySubscribers,onTouchMove:this.notifySubscribers,onTouchEnd:this.notifySubscribers}))}}]),t}(o.PureComponent);h.childContextTypes={subscribe:s.default.func,unsubscribe:s.default.func,getParent:s.default.func},t.default=h},78579:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=n(67294),o=l(r),a=l(n(90731)),s=l(n(45697));function l(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}var u=function(e){function t(){var e,n,i;d(this,t);for(var r=arguments.length,o=Array(r),a=0;a<r;a++)o[a]=arguments[a];return n=i=c(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(o))),i.state={isSticky:!1,wasSticky:!1,style:{}},i.handleContainerEvent=function(e){var t=e.distanceFromTop,n=e.distanceFromBottom,r=e.eventSource,o=i.context.getParent(),a=!1;i.props.relative&&(a=r!==o,t=-(r.scrollTop+r.offsetTop)+i.placeholder.offsetTop);var s=i.placeholder.getBoundingClientRect(),l=i.content.getBoundingClientRect().height,d=n-i.props.bottomOffset-l,c=!!i.state.isSticky,u=a?c:t<=-i.props.topOffset&&n>-i.props.bottomOffset;n=(i.props.relative?o.scrollHeight-o.scrollTop:n)-l;var h=u?{position:"fixed",top:d>0?i.props.relative?o.offsetTop-o.offsetParent.scrollTop:0:d,left:s.left,width:s.width}:{};i.props.disableHardwareAcceleration||(h.transform="translateZ(0)"),i.setState({isSticky:u,wasSticky:c,distanceFromTop:t,distanceFromBottom:n,calculatedHeight:l,style:h})},c(i,n)}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),i(t,[{key:"componentWillMount",value:function(){if(!this.context.subscribe)throw new TypeError("Expected Sticky to be mounted within StickyContainer");this.context.subscribe(this.handleContainerEvent)}},{key:"componentWillUnmount",value:function(){this.context.unsubscribe(this.handleContainerEvent)}},{key:"componentDidUpdate",value:function(){this.placeholder.style.paddingBottom=this.props.disableCompensation?0:(this.state.isSticky?this.state.calculatedHeight:0)+"px"}},{key:"render",value:function(){var e=this,t=o.default.cloneElement(this.props.children({isSticky:this.state.isSticky,wasSticky:this.state.wasSticky,distanceFromTop:this.state.distanceFromTop,distanceFromBottom:this.state.distanceFromBottom,calculatedHeight:this.state.calculatedHeight,style:this.state.style}),{ref:function(t){e.content=a.default.findDOMNode(t)}});return o.default.createElement("div",null,o.default.createElement("div",{ref:function(t){return e.placeholder=t}}),t)}}]),t}(r.Component);u.propTypes={topOffset:s.default.number,bottomOffset:s.default.number,relative:s.default.bool,children:s.default.func.isRequired},u.defaultProps={relative:!1,topOffset:0,bottomOffset:0,disableCompensation:!1,disableHardwareAcceleration:!1},u.contextTypes={subscribe:s.default.func,unsubscribe:s.default.func,getParent:s.default.func},t.default=u},58439:(e,t,n)=>{"use strict";t.L9=t.Le=void 0;var i=o(n(78579)),r=o(n(18474));function o(e){return e&&e.__esModule?e:{default:e}}t.Le=i.default,t.L9=r.default,i.default},49997:(e,t,n)=>{"use strict";n.d(t,{Z:()=>b});var i=n(67294),r=n(51995),o=n(61988),a=n(91877),s=n(93185),l=n(74069),d=n(33626),c=n(97381),u=n(60193),h=n(11965);function p({extensions:e,placeholder:t,id:n}){return(0,h.tZ)(u.ZP,{id:n,placeholder:t,extensions:e,autoComplete:"off",autoFocus:!0})}var f=n(3741),m=n(31069);const g=async e=>{var t;let n;try{n=await m.Z.get({endpoint:`/dashboardasync/api/read?_oc_DashboardModelViewAsync=changed_on&_od_DashboardModelViewAsync=desc&_flt_2_dashboard_title=${e}`})}catch(e){return[{title:(0,o.t)("An error occurred while fetching dashboards")}]}return null==(t=n)?void 0:t.json.result.map((e=>({title:e.dashboard_title,...e})))},v=(0,r.iK)(l.Z)`
  margin-top: 20%;

  .ant-modal-body {
    padding: 0;
    overflow: visible;
  }
`;function b(){const e=(0,i.useRef)(),t=(0,i.useRef)(null),[n,r]=(0,i.useState)(!1),l=e=>(0,c.logEvent)(f.tB,{show_omni:e}),u=()=>{e.current=!1,r(!1),l(!1)};return(0,d.J)((()=>{function n(t){if(!(0,a.cr)(s.T.OMNIBAR))return;const n=t.ctrlKey||t.metaKey,i=["KeyK"].includes(t.code);"Escape"===t.key&&e.current?u():n&&i&&(e.current=!e.current,r(e.current),l(!!e.current))}function i(e){t.current&&!t.current.contains(e.target)&&u()}return e.current=!1,document.addEventListener("mousedown",i),document.addEventListener("keydown",n),()=>{document.removeEventListener("keydown",n),document.removeEventListener("mousedown",i)}})),(0,h.tZ)(v,{title:"",show:n,hideFooter:!0,closable:!1,onHide:()=>{},destroyOnClose:!0},(0,h.tZ)("div",{ref:t},(0,h.tZ)(p,{id:"InputOmnibar",placeholder:(0,o.t)("Search all dashboards"),extensions:[g]})))}},23561:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>Ku});var i=n(14890),r=n(37703),o=n(67294),a=n(45697),s=n.n(a),l=n(61988),d=n(93185),c=n(14278),u=n(38703),h=n(81255);function p(e){return Object.values(e).reduce(((e,t)=>(t&&t.type===h.dW&&t.meta&&t.meta.chartId&&e.push(t.meta.chartId),e)),[])}var f=n(94184),m=n.n(f),g=n(51995),v=n(11965),b=n(57902),y=n(40637),C=n(58439),S=n(23279),x=n.n(S),w=n(91033);function k(){return k=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},k.apply(this,arguments)}function Z(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function R(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var T=function(e){var t,n;function i(t){var n;return R(Z(n=e.call(this,t)||this),"animationFrameID",void 0),R(Z(n),"resizeObserver",void 0),R(Z(n),"target",null),R(Z(n),"resize",(function(e){var t=e.width,i=e.height,r=e.top,o=e.left;n.setState((function(){return{width:t,height:i,top:r,left:o}}))})),R(Z(n),"setTarget",(function(e){n.target=e})),n.state={width:0,height:0,top:0,left:0},n.resize=x()(n.resize,t.debounceTime),n.animationFrameID=null,n}n=e,(t=i).prototype=Object.create(n.prototype),t.prototype.constructor=t,t.__proto__=n;var r=i.prototype;return r.componentDidMount=function(){var e=this;this.resizeObserver=new w.Z((function(t){void 0===t&&(t=[]),t.forEach((function(t){var n=t.contentRect,i=n.left,r=n.top,o=n.width,a=n.height;e.animationFrameID=window.requestAnimationFrame((function(){e.resize({width:o,height:a,top:r,left:i})}))}))})),this.target&&this.resizeObserver.observe(this.target)},r.componentWillUnmount=function(){this.animationFrameID&&window.cancelAnimationFrame(this.animationFrameID),this.resizeObserver&&this.resizeObserver.disconnect()},r.render=function(){var e=this.props,t=e.className,n=e.children,i=(e.debounceTime,e.parentSizeStyles),r=function(e,t){if(null==e)return{};var n,i,r={},o=Object.keys(e);for(i=0;i<o.length;i++)n=o[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,["className","children","debounceTime","parentSizeStyles"]);return o.createElement("div",k({style:i,ref:this.setTarget,className:t},r),n(k({},this.state,{ref:this.target,resize:this.resize})))},i}(o.Component);R(T,"propTypes",{className:s().string,debounceTime:s().number,children:s().func.isRequired}),R(T,"defaultProps",{debounceTime:300,parentSizeStyles:{width:"100%",height:"100%"}});var F,D=n(80621),_=n(84785),E=n(2275),I=n(23493),M=n.n(I);const O=D.Mu+1,P=D.Mu+3,N=D.Mu+4,j=D.Mu+5,q={[h.U0]:{[h.yR]:D.Mu,[h.BG]:D.Mu},[h.BG]:{[h.dW]:O,[h.t]:O,[h.xh]:O,[h.BA]:O,[h.hE]:O,[h.Nc]:O,[h.Os]:O,[h.yR]:O},[h.Os]:{[h.dW]:N,[h.t]:N,[h.xh]:N,[h.BA]:N},[h.yR]:{[h.gn]:P},[h.gn]:{[h.dW]:j,[h.t]:j,[h.xh]:j,[h.BA]:P,[h.hE]:j,[h.Nc]:j,[h.Os]:P,[h.yR]:P},[h.BA]:{[h.dW]:j,[h.Nc]:j,[h.xh]:j,[h.Os]:P,[h.hE]:P,[h.yR]:P},[h.dW]:{},[h.t]:{},[h.hE]:{},[h.Nc]:{},[h.xh]:{}};function z(e){const{parentType:t,childType:n,parentDepth:i}=e;if(!t||!n||"number"!=typeof i)return!1;const r=(q[t]||{})[n];return"number"==typeof r&&i<=r}const A="DROP_TOP",$="DROP_RIGHT",U="DROP_BOTTOM",L="DROP_LEFT";let V,K={};function B(e,t){const{depth:n,parentComponent:i,component:r,orientation:o,isDraggingOverShallow:a}=t.props,s=e.getItem();if(!s||s.id===r.id)return null;const l=z({parentType:r.type,parentDepth:n,childType:s.type}),d=i&&i.type,c=z({parentType:d,parentDepth:n+(d===h.gn||d===h.yR?0:-1),childType:s.type});if(!l&&!c)return null;const u=(r.children||[]).length>0,p="row"===o?"vertical":"horizontal",f="row"===o?"horizontal":"vertical";if(a&&l&&!c)return"vertical"===p?u?$:L:u?U:A;const m=t.ref.getBoundingClientRect(),g=e.getClientOffset()||K[r.id];if(!g||!m)return null;K[r.id]=g;const v=Math.abs(g.y-m.top),b=Math.abs(g.y-m.bottom),y=Math.abs(g.x-m.left),C=Math.abs(g.x-m.right);if(!a&&[v,b,y,C].every((e=>e>20)))return null;if(c&&!l){if("vertical"===f){const e=m.left+(m.right-m.left)/2;return g.x<e?L:$}const e=m.top+(m.bottom-m.top)/2;return g.y<e?A:U}if(c&&l){if("vertical"===f){if(y<20)return L;if(C<20)return $}else{if(v<20)return A;if(b<20)return U}return"vertical"===p?u?$:L:u?U:A}return null}const W=M()((function(e,t,n){var i,r;if(!n.mounted)return;const o=B(t,n);!function(e){const t="SCROLL_TOP"===e&&!V&&0!==document.documentElement.scrollTop,n=V&&("SCROLL_TOP"!==e||0===document.documentElement.scrollTop);t?V=setInterval((()=>{if(0===document.documentElement.scrollTop)return clearInterval(V),void(V=null);let e=document.documentElement.scrollTop-120;e<0&&(e=0),window.scroll({top:e,behavior:"smooth"})}),50):n&&(clearInterval(V),V=null)}((null==n||null==(i=n.props)||null==(r=i.component)?void 0:r.type)===h.U0?"SCROLL_TOP":null),o?n.setState((()=>({dropIndicator:o}))):n.setState((()=>({dropIndicator:null})))}),100);const H="DRAG_DROPPABLE",G=[H,{canDrag:e=>!e.disableDragDrop,beginDrag(e){const{component:t,index:n,parentComponent:i={}}=e;return{type:t.type,id:t.id,meta:t.meta,index:n,parentId:i.id,parentType:i.type}}},function(e,t){return{dragSourceRef:e.dragSource(),dragPreviewRef:e.dragPreview(),isDragging:t.isDragging()}}],Y=[H,{canDrop:e=>!e.disableDragDrop,hover(e,t,n){n&&n.mounted&&W(e,t,n)},drop(e,t,n){const i=t.getDropResult();if((!i||!i.destination)&&n.mounted)return function(e,t,n){if(!n.mounted)return;n.setState((()=>({dropIndicator:null})));const i=B(t,n);if(!i)return;const{parentComponent:r,component:o,index:a,onDrop:s,orientation:l}=n.props,d=t.getItem(),c="row"===l&&(i===A||i===U)||"column"===l&&(i===L||i===$)?"sibling":"child",u={source:{id:d.parentId,type:d.parentType,index:d.index},dragging:{id:d.id,type:d.type,meta:d.meta}};if("child"===c)u.destination={id:o.id,type:o.type,index:o.children.length};else{let e=r&&d.parentId===r.id&&d.index<a?a-1:a;i!==U&&i!==$||(e+=1),u.destination={id:r.id,type:r.type,index:e}}return s(u),K={},u}(0,t,n)}},function(e,t){return{droppableRef:e.dropTarget(),isDraggingOver:t.isOver(),isDraggingOverShallow:t.isOver({shallow:!0})}}],J={children:s().func,className:s().string,component:E.cP.isRequired,parentComponent:E.cP,depth:s().number.isRequired,disableDragDrop:s().bool,orientation:s().oneOf(["row","column"]),index:s().number.isRequired,style:s().object,onDrop:s().func,editMode:s().bool.isRequired,useEmptyDragPreview:s().bool,isDragging:s().bool.isRequired,isDraggingOver:s().bool.isRequired,isDraggingOverShallow:s().bool.isRequired,droppableRef:s().func.isRequired,dragSourceRef:s().func.isRequired,dragPreviewRef:s().func.isRequired},Q={className:null,style:null,parentComponent:null,disableDragDrop:!1,children(){},onDrop(){},orientation:"row",useEmptyDragPreview:!1};class X extends o.PureComponent{constructor(e){super(e),this.state={dropIndicator:null},this.setRef=this.setRef.bind(this)}componentDidMount(){this.mounted=!0}componentWillUnmount(){this.mounted=!1}setRef(e){this.ref=e,this.props.useEmptyDragPreview?this.props.dragPreviewRef((F||((F=new Image).src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),F),{captureDraggingState:!0}):this.props.dragPreviewRef(e),this.props.droppableRef(e)}render(){const{children:e,className:t,orientation:n,dragSourceRef:i,disableDragDrop:r,isDragging:o,isDraggingOver:a,style:s,editMode:l}=this.props,{dropIndicator:d}=this.state,c=a&&d&&!r?{className:m()("drop-indicator",d===A&&"drop-indicator--top",d===U&&"drop-indicator--bottom",d===L&&"drop-indicator--left",d===$&&"drop-indicator--right")}:null,u=l?{dragSourceRef:i,dropIndicatorProps:c}:{};return(0,v.tZ)("div",{style:s,ref:this.setRef,className:m()("dragdroppable","row"===n&&"dragdroppable-row","column"===n&&"dragdroppable-column",o&&"dragdroppable--dragging",t)},e(u))}}X.propTypes=J,X.defaultProps=Q;const ee=(0,_.DragSource)(...G)((0,_.DropTarget)(...Y)(X)),te={id:s().string.isRequired,type:s().string.isRequired,label:s().string.isRequired,className:s().string};class ne extends o.PureComponent{render(){const{label:e,id:t,type:n,className:i,meta:r}=this.props;return(0,v.tZ)(ee,{component:{type:n,id:t,meta:r},parentComponent:{id:D.D0,type:h.F0},index:0,depth:0,editMode:!0},(({dragSourceRef:t})=>(0,v.tZ)("div",{ref:t,className:"new-component"},(0,v.tZ)("div",{className:m()("new-component-placeholder",i)}),e)))}}function ie(){return(0,v.tZ)(ne,{id:D.Nb,type:h.BA,label:(0,l.t)("Column"),className:"fa fa-long-arrow-down"})}function re(){return(0,v.tZ)(ne,{id:D.ES,type:h.hE,label:(0,l.t)("Divider"),className:"divider-placeholder"})}function oe(){return(0,v.tZ)(ne,{id:D.Z1,type:h.Nc,label:(0,l.t)("Header"),className:"fa fa-header"})}function ae(){return(0,v.tZ)(ne,{id:D.vD,type:h.Os,label:(0,l.t)("Row"),className:"fa fa-long-arrow-right"})}function se(){return(0,v.tZ)(ne,{id:D.NN,type:h.yR,label:(0,l.t)("Tabs"),className:"fa fa-window-restore"})}function le(){return(0,v.tZ)(ne,{id:D.C3,type:h.xh,label:"Markdown",className:"fa fa-code"})}ne.propTypes=te,ne.defaultProps={className:null};var de=n(68969),ce=n(88239),ue=n(8177),he=n.n(ue),pe=n(85105),fe=n.n(pe),me=n(99663),ge=n(46058),ve=n(49135),be=n(93196),ye=n(75621),Ce=n(94396),Se=function(e){function t(){var e,n,i,r;(0,me.default)(this,t);for(var o=arguments.length,a=Array(o),s=0;s<o;s++)a[s]=arguments[s];return n=i=(0,ve.default)(this,(e=t.__proto__||fe()(t)).call.apply(e,[this].concat(a))),i._cellRenderer=function(e){var t=e.parent,n=e.rowIndex,r=e.style,o=e.isScrolling,a=e.isVisible,s=e.key,l=i.props.rowRenderer;return he()(r,"width").writable&&(r.width="100%"),l({index:n,style:r,isScrolling:o,isVisible:a,key:s,parent:t})},i._setRef=function(e){i.Grid=e},i._onScroll=function(e){var t=e.clientHeight,n=e.scrollHeight,r=e.scrollTop;(0,i.props.onScroll)({clientHeight:t,scrollHeight:n,scrollTop:r})},i._onSectionRendered=function(e){var t=e.rowOverscanStartIndex,n=e.rowOverscanStopIndex,r=e.rowStartIndex,o=e.rowStopIndex;(0,i.props.onRowsRendered)({overscanStartIndex:t,overscanStopIndex:n,startIndex:r,stopIndex:o})},r=n,(0,ve.default)(i,r)}return(0,be.default)(t,e),(0,ge.default)(t,[{key:"forceUpdateGrid",value:function(){this.Grid&&this.Grid.forceUpdate()}},{key:"getOffsetForRow",value:function(e){var t=e.alignment,n=e.index;return this.Grid?this.Grid.getOffsetForCell({alignment:t,rowIndex:n,columnIndex:0}).scrollTop:0}},{key:"invalidateCellSizeAfterRender",value:function(e){var t=e.columnIndex,n=e.rowIndex;this.Grid&&this.Grid.invalidateCellSizeAfterRender({rowIndex:n,columnIndex:t})}},{key:"measureAllRows",value:function(){this.Grid&&this.Grid.measureAllCells()}},{key:"recomputeGridSize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.columnIndex,n=void 0===t?0:t,i=e.rowIndex,r=void 0===i?0:i;this.Grid&&this.Grid.recomputeGridSize({rowIndex:r,columnIndex:n})}},{key:"recomputeRowHeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.recomputeGridSize({rowIndex:e,columnIndex:0})}},{key:"scrollToPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToPosition({scrollTop:e})}},{key:"scrollToRow",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.Grid&&this.Grid.scrollToCell({columnIndex:0,rowIndex:e})}},{key:"render",value:function(){var e=this.props,t=e.className,n=e.noRowsRenderer,i=e.scrollToIndex,r=e.width,a=m()("ReactVirtualized__List",t);return o.createElement(ye.Z,(0,ce.default)({},this.props,{autoContainerWidth:!0,cellRenderer:this._cellRenderer,className:a,columnWidth:r,columnCount:1,noContentRenderer:n,onScroll:this._onScroll,onSectionRendered:this._onSectionRendered,ref:this._setRef,scrollToRow:i}))}}]),t}(o.PureComponent);Se.defaultProps={autoHeight:!1,estimatedRowSize:30,onScroll:function(){},noRowsRenderer:function(){return null},onRowsRendered:function(){},overscanIndicesGetter:Ce.ZP,overscanRowCount:10,scrollToAlignment:"auto",scrollToIndex:-1,style:{}},Se.propTypes=null;const xe=Se;var we=n(24903),ke=n(9875),Ze=n(4715),Re=n(69856);const Te={datasourceUrl:s().string,datasourceName:s().string,innerRef:s().func,isSelected:s().bool,lastModified:s().string,sliceName:s().string.isRequired,style:s().object,visType:s().string.isRequired},Fe=g.iK.div`
  ${({theme:e})=>`\n    .chart-card {\n      border: 1px solid ${e.colors.grayscale.light2};\n      border-radius: ${e.gridUnit}px;\n      background: ${e.colors.grayscale.light5};\n      padding: ${2*e.gridUnit}px;\n      margin: 0 ${3*e.gridUnit}px\n        ${3*e.gridUnit}px\n        ${3*e.gridUnit}px;\n      position: relative;\n      cursor: move;\n      white-space: nowrap;\n      overflow: hidden;\n\n      &:hover {\n        background: ${e.colors.grayscale.light4};\n      }\n    }\n\n    .chart-card.is-selected {\n      cursor: not-allowed;\n      opacity: 0.4;\n    }\n\n    .card-title {\n      margin-right: 60px;\n      margin-bottom: ${2*e.gridUnit}px;\n      font-weight: ${e.typography.weights.bold};\n    }\n\n    .card-body {\n      display: flex;\n      flex-direction: column;\n\n      .item {\n        span {\n          word-break: break-all;\n\n          &:first-child {\n            font-weight: ${e.typography.weights.normal};\n          }\n        }\n      }\n    }\n\n    .is-added-label {\n      background: ${e.colors.grayscale.base};\n      border-radius: ${e.gridUnit}px;\n      color: ${e.colors.grayscale.light5};\n      font-size: ${e.typography.sizes.s}px;\n      text-transform: uppercase;\n      position: absolute;\n      padding: ${e.gridUnit}px\n        ${2*e.gridUnit}px;\n      top: ${8*e.gridUnit}px;\n      right: ${8*e.gridUnit}px;\n      pointer-events: none;\n    }\n  `}
`;function De({datasourceUrl:e,datasourceName:t,innerRef:n,isSelected:i,lastModified:r,sliceName:o,style:a,visType:s}){return(0,v.tZ)(Fe,{ref:n,style:a},(0,v.tZ)("div",{className:m()("chart-card",i&&"is-selected")},(0,v.tZ)("div",{className:"card-title"},o),(0,v.tZ)("div",{className:"card-body"},(0,v.tZ)("div",{className:"item"},(0,v.tZ)("span",null,(0,l.t)("Modified")," "),(0,v.tZ)("span",null,r)),(0,v.tZ)("div",{className:"item"},(0,v.tZ)("span",null,(0,l.t)("Visualization")," "),(0,v.tZ)("span",null,s)),(0,v.tZ)("div",{className:"item"},(0,v.tZ)("span",null,(0,l.t)("Data source")," "),(0,v.tZ)("a",{href:e},t)))),i&&(0,v.tZ)("div",{className:"is-added-label"},(0,l.t)("Added")))}De.propTypes=Te,De.defaultProps={datasourceUrl:null,datasourceName:"-",innerRef:null,isSelected:!1,style:null,lastModified:null};const _e=De,Ee={position:"fixed",pointerEvents:"none",top:0,left:0,zIndex:101,width:344},Ie={dragItem:s().shape({index:s().number.isRequired}),slices:s().arrayOf(E.Rw),isDragging:s().bool.isRequired,currentOffset:s().shape({x:s().number.isRequired,y:s().number.isRequired})};function Me({dragItem:e,slices:t,isDragging:n,currentOffset:i}){if(!(n&&i&&e&&t))return null;const r=t[e.index];return r&&e.parentType===h.F0&&e.type===h.dW?(0,v.tZ)(_e,{style:{...Ee,transform:`translate(${i.x}px, ${i.y}px)`},sliceName:r.slice_name,lastModified:r.changed_on_humanized,visType:r.viz_type,datasourceUrl:r.datasource_url,datasourceName:r.datasource_name}):null}Me.propTypes=Ie,Me.defaultProps={currentOffset:null,dragItem:null,slices:null};const Oe=(0,_.DragLayer)((e=>({dragItem:e.getItem(),currentOffset:e.getSourceClientOffset(),isDragging:e.isDragging()})))(Me),Pe={fetchAllSlices:s().func.isRequired,isLoading:s().bool.isRequired,slices:s().objectOf(E.Rw).isRequired,lastUpdated:s().number.isRequired,errorMessage:s().string,userId:s().string.isRequired,selectedSliceIds:s().arrayOf(s().number),editMode:s().bool,height:s().number,filterboxMigrationState:Re.Qi},Ne={selectedSliceIds:[],editMode:!1,errorMessage:"",height:window.innerHeight,filterboxMigrationState:Re.Qi.NOOP},je=["slice_name","viz_type","datasource_name"],qe={slice_name:"name",viz_type:"viz type",datasource_name:"dataset",changed_on:"recent"},ze=g.iK.div`
  display: flex;
  flex-direction: row;
  padding: ${({theme:e})=>3*e.gridUnit}px;
`,Ae=(0,g.iK)(Ze.Ph)`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
  min-width: 150px;
`;class $e extends o.Component{static sortByComparator(e){const t="changed_on"===e?-1:1;return(n,i)=>n[e]<i[e]?-1*t:n[e]>i[e]?1*t:0}constructor(e){super(e),this.state={filteredSlices:[],searchTerm:"",sortBy:"changed_on",selectedSliceIdsSet:new Set(e.selectedSliceIds)},this.rowRenderer=this.rowRenderer.bind(this),this.searchUpdated=this.searchUpdated.bind(this),this.handleKeyPress=this.handleKeyPress.bind(this),this.handleChange=this.handleChange.bind(this),this.handleSelect=this.handleSelect.bind(this)}componentDidMount(){const{userId:e,filterboxMigrationState:t}=this.props;this.slicesRequest=this.props.fetchAllSlices(e,(0,d.c)(d.T.ENABLE_FILTER_BOX_MIGRATION)&&t!==Re.Qi.SNOOZED)}UNSAFE_componentWillReceiveProps(e){const t={};e.lastUpdated!==this.props.lastUpdated&&(t.filteredSlices=Object.values(e.slices).filter((0,we.cj)(this.state.searchTerm,je)).sort($e.sortByComparator(this.state.sortBy))),e.selectedSliceIds!==this.props.selectedSliceIds&&(t.selectedSliceIdsSet=new Set(e.selectedSliceIds)),Object.keys(t).length&&this.setState(t)}componentWillUnmount(){this.slicesRequest&&this.slicesRequest.abort&&this.slicesRequest.abort()}getFilteredSortedSlices(e,t){return Object.values(this.props.slices).filter((0,we.cj)(e,je)).sort($e.sortByComparator(t))}handleKeyPress(e){"Enter"===e.key&&(e.preventDefault(),this.searchUpdated(e.target.value))}handleChange(e){this.searchUpdated(e.target.value)}searchUpdated(e){this.setState((t=>({searchTerm:e,filteredSlices:this.getFilteredSortedSlices(e,t.sortBy)})))}handleSelect(e){this.setState((t=>({sortBy:e,filteredSlices:this.getFilteredSortedSlices(t.searchTerm,e)})))}rowRenderer({key:e,index:t,style:n}){const{filteredSlices:i,selectedSliceIdsSet:r}=this.state,o=i[t],a=r.has(o.slice_id),s=h.dW,l=D.Jd,d={chartId:o.slice_id,sliceName:o.slice_name};return(0,v.tZ)(ee,{key:e,component:{type:s,id:l,meta:d},parentComponent:{id:D.D0,type:h.F0},index:t,depth:0,disableDragDrop:a,editMode:this.props.editMode,useEmptyDragPreview:!0,style:{}},(({dragSourceRef:e})=>(0,v.tZ)(_e,{innerRef:e,style:n,sliceName:o.slice_name,lastModified:o.changed_on_humanized,visType:o.viz_type,datasourceUrl:o.datasource_url,datasourceName:o.datasource_name,isSelected:a})))}render(){const e=this.props.height-30-64-16;return(0,v.tZ)("div",{className:"slice-adder-container"},(0,v.tZ)(ze,null,(0,v.tZ)(ke.II,{placeholder:(0,l.t)("Filter your charts"),className:"search-input",onChange:this.handleChange,onKeyPress:this.handleKeyPress}),(0,v.tZ)(Ae,{id:"slice-adder-sortby",value:this.state.sortBy,onChange:this.handleSelect,options:Object.entries(qe).map((([e,t])=>({label:(0,l.t)("Sort by %s",t),value:e}))),placeholder:(0,l.t)("Sort by")})),this.props.isLoading&&(0,v.tZ)(u.Z,null),!this.props.isLoading&&this.state.filteredSlices.length>0&&(0,v.tZ)(xe,{width:376,height:e,rowCount:this.state.filteredSlices.length,rowHeight:112,rowRenderer:this.rowRenderer,searchTerm:this.state.searchTerm,sortBy:this.state.sortBy,selectedSliceIds:this.props.selectedSliceIds}),this.props.errorMessage&&(0,v.tZ)("div",{className:"error-message"},this.props.errorMessage),(0,v.tZ)(Oe,{slices:this.state.filteredSlices}))}}$e.propTypes=Pe,$e.defaultProps=Ne;const Ue=$e,Le=(0,r.$j)((function({sliceEntities:e,dashboardInfo:t,dashboardState:n},i){return{height:i.height,userId:t.userId,selectedSliceIds:n.sliceIds,slices:e.slices,isLoading:e.isLoading,errorMessage:e.errorMessage,lastUpdated:e.lastUpdated,editMode:n.editMode,filterboxMigrationState:n.filterboxMigrationState}}),(function(e){return(0,i.DE)({fetchAllSlices:de.To},e)}))(Ue),Ve=({registryKeys:e,registry:t})=>()=>e.map((e=>t[e])),Ke=({registryKeys:e,registry:t})=>n=>{e=e.filter((e=>e!==n)),delete t[n]},Be=({registry:e})=>t=>e[t],We=((e=[])=>{const t={registry:{},registryKeys:[]},n=(({registryKeys:e,registry:t})=>(n,i)=>{e.push(n),t[n]={key:n,metadata:i.metadata,Component:o.lazy(i.loadComponent)}})(t);return e.forEach((({key:e,item:t})=>{n(e,t)})),{set:n,get:Be(t),delete:Ke(t),getAll:Ve(t)}})([]),He=({componentKey:e,metadata:t})=>(0,v.tZ)(ne,{id:D.gR,type:h.t,label:t.name,meta:{metadata:t,componentKey:e},className:`fa fa-${t.iconName}`}),Ge=(0,g.iK)(y.ZP)`
  line-height: inherit;
  margin-top: ${({theme:e})=>2*e.gridUnit}px;
`,Ye=g.iK.div`
  height: 100%;
  position: fixed;
  right: 0;
  top: 0;

  .ReactVirtualized__List {
    padding-bottom: ${({topOffset:e})=>`${124+e}px`};
  }
`,Je=({isStandalone:e,topOffset:t=0})=>(0,v.tZ)(Ye,{topOffset:t,className:"dashboard-builder-sidepane"},(0,v.tZ)(T,null,(({height:n})=>(0,v.tZ)(C.L9,null,(0,v.tZ)(C.Le,{topOffset:-t,bottomOffset:1/0},(({style:i,isSticky:r})=>{const{pageYOffset:o}=window,a=o<59&&!e,s=t+(59-o-4);return(0,v.tZ)("div",{className:"viewport",style:{...i,top:a?s:t}},(0,v.tZ)(Ge,{id:"tabs",className:"tabs-components"},(0,v.tZ)(y.ZP.TabPane,{key:1,tab:(0,l.t)("Components")},(0,v.tZ)(se,null),(0,v.tZ)(ae,null),(0,v.tZ)(ie,null),(0,v.tZ)(oe,null),(0,v.tZ)(le,null),(0,v.tZ)(re,null),We.getAll().map((({key:e,metadata:t})=>(0,v.tZ)(He,{metadata:t,componentKey:e})))),(0,v.tZ)(y.ZP.TabPane,{key:2,tab:(0,l.t)("Charts"),className:"tab-charts"},(0,v.tZ)(Le,{height:n+(r?59:0)}))))}))))));var Qe=n(74599),Xe=n(30381),et=n.n(Xe),tt=n(78161),nt=n(37488),it=n(3741),rt=n(91877),ot=n(70163),at=n(35932),st=n(38270),lt=n(36674),dt=n(9679),ct=n(31069),ut=n(83862),ht=n(88694),pt=n(27600),ft=n(5872),mt=n.n(ft),gt=n(10222),vt=n(68492),bt=n(23525),yt=n(81788);const Ct=e=>{const{copyMenuItemTitle:t,emailMenuItemTitle:n,emailSubject:i,emailBody:r,addDangerToast:a,addSuccessToast:s,dashboardId:d,dashboardComponentId:c,...u}=e;async function h(){const e=(0,bt.eY)(pt.KD.nativeFiltersKey);let t={};return e&&d&&(t=await(0,yt.B8)(d,e)),(0,bt.Nm)({dashboardId:d,filterState:t,hash:c})}return(0,v.tZ)(o.Fragment,null,(0,v.tZ)(ut.v.Item,mt()({key:"copy-url"},u),(0,v.tZ)("div",{onClick:async function(){try{const e=await h();await(0,gt.Z)(e),s((0,l.t)("Copied to clipboard!"))}catch(e){vt.Z.error(e),a((0,l.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},t)),(0,v.tZ)(ut.v.Item,mt()({key:"share-by-email"},u),(0,v.tZ)("div",{onClick:async function(){try{const e=encodeURIComponent(`${r}${await h()}`),t=encodeURIComponent(i);window.location.href=`mailto:?Subject=${t}%20&Body=${e}`}catch(e){vt.Z.error(e),a((0,l.t)("Sorry, something went wrong. Try again later."))}},role:"button",tabIndex:0},n)))};var St=n(68073),xt=n(94670);const wt=g.iK.div`
  ${({theme:e})=>`\n    .css-editor-header {\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      margin-bottom: ${2*e.gridUnit}px;\n\n      h5 {\n        margin-top: ${e.gridUnit}px;\n      }\n    }\n    .css-editor {\n      border: 1px solid ${e.colors.grayscale.light1};\n    }\n  `}
`,kt={initialCss:s().string,triggerNode:s().node.isRequired,onChange:s().func,templates:s().array};class Zt extends o.PureComponent{constructor(e){super(e),this.state={css:e.initialCss},this.changeCss=this.changeCss.bind(this),this.changeCssTemplate=this.changeCssTemplate.bind(this)}componentDidMount(){xt.ry.preload()}changeCss(e){this.setState({css:e},(()=>{this.props.onChange(e)}))}changeCssTemplate({key:e}){this.changeCss(e)}renderTemplateSelector(){if(this.props.templates){const e=(0,v.tZ)(ut.v,{onClick:this.changeCssTemplate},this.props.templates.map((e=>(0,v.tZ)(ut.v.Item,{key:e.css},e.label))));return(0,v.tZ)(Ze.Gj,{overlay:e,placement:"bottomRight"},(0,v.tZ)(at.Z,null,(0,l.t)("Load a CSS template")))}return null}render(){return(0,v.tZ)(St.Z,{triggerNode:this.props.triggerNode,modalTitle:(0,l.t)("CSS"),modalBody:(0,v.tZ)(wt,null,(0,v.tZ)("div",{className:"css-editor-header"},(0,v.tZ)("h5",null,(0,l.t)("Live CSS editor")),this.renderTemplateSelector()),(0,v.tZ)(xt.ry,{className:"css-editor",minLines:12,maxLines:30,onChange:this.changeCss,height:"200px",width:"100%",editorProps:{$blockScrolling:!0},enableLiveAutocompletion:!0,value:this.state.css||""}))})}}Zt.propTypes=kt,Zt.defaultProps={initialCss:"",onChange:()=>{}};const Rt=Zt;var Tt=n(24554),Ft=n(29487),Dt=n(49238);const _t=[[0,(0,l.t)("Don't refresh")],[10,(0,l.t)("10 seconds")],[30,(0,l.t)("30 seconds")],[60,(0,l.t)("1 minute")],[300,(0,l.t)("5 minutes")],[1800,(0,l.t)("30 minutes")],[3600,(0,l.t)("1 hour")],[21600,(0,l.t)("6 hours")],[43200,(0,l.t)("12 hours")],[86400,(0,l.t)("24 hours")]].map((e=>({value:e[0],label:e[1]}))),Et=(0,g.iK)(St.Z)`
  .ant-modal-body {
    overflow: visible;
  }
`,It=g.iK.div`
  margin-top: ${({theme:e})=>6*e.gridUnit}px;
`;class Mt extends o.PureComponent{constructor(e){super(e),this.modalRef=void 0,this.modalRef=o.createRef(),this.state={refreshFrequency:e.refreshFrequency},this.handleFrequencyChange=this.handleFrequencyChange.bind(this),this.onSave=this.onSave.bind(this),this.onCancel=this.onCancel.bind(this)}onSave(){var e;this.props.onChange(this.state.refreshFrequency,this.props.editMode),null==(e=this.modalRef.current)||e.close(),this.props.addSuccessToast((0,l.t)("Refresh interval saved"))}onCancel(){var e;this.setState({refreshFrequency:this.props.refreshFrequency}),null==(e=this.modalRef.current)||e.close()}handleFrequencyChange(e){this.setState({refreshFrequency:e||_t[0].value})}render(){const{refreshLimit:e=0,refreshWarning:t,editMode:n}=this.props,{refreshFrequency:i=0}=this.state,r=!!i&&!!t&&i<e;return(0,v.tZ)(Et,{ref:this.modalRef,triggerNode:this.props.triggerNode,modalTitle:(0,l.t)("Refresh interval"),modalBody:(0,v.tZ)("div",null,(0,v.tZ)(Dt.lX,null,(0,l.t)("Refresh frequency")),(0,v.tZ)(Tt.ZP,{ariaLabel:(0,l.t)("Refresh interval"),options:_t,value:i,onChange:this.handleFrequencyChange,sortComparator:(0,Tt.mj)("value")}),r&&(0,v.tZ)(It,null,(0,v.tZ)(Ft.Z,{type:"warning",message:(0,v.tZ)(o.Fragment,null,(0,v.tZ)("div",null,t),(0,v.tZ)("br",null),(0,v.tZ)("strong",null,(0,l.t)("Are you sure you want to proceed?")))}))),modalFooter:(0,v.tZ)(o.Fragment,null,(0,v.tZ)(at.Z,{buttonStyle:"primary",buttonSize:"small",onClick:this.onSave},n?(0,l.t)("Save"):(0,l.t)("Save for this session")),(0,v.tZ)(at.Z,{onClick:this.onCancel,buttonSize:"small"},(0,l.t)("Cancel")))})}}Mt.defaultProps={refreshLimit:0,refreshWarning:null};const Ot=Mt;var Pt=n(87183),Nt=n(87253);const jt={saveType:D.TN,colorNamespace:void 0,colorScheme:void 0,shouldPersistRefreshFrequency:!1};class qt extends o.PureComponent{constructor(e){super(e),this.modal=void 0,this.onSave=void 0,this.state={saveType:e.saveType,newDashName:`${e.dashboardTitle} [copy]`,duplicateSlices:!1},this.modal=null,this.handleSaveTypeChange=this.handleSaveTypeChange.bind(this),this.handleNameChange=this.handleNameChange.bind(this),this.saveDashboard=this.saveDashboard.bind(this),this.setModalRef=this.setModalRef.bind(this),this.toggleDuplicateSlices=this.toggleDuplicateSlices.bind(this),this.onSave=this.props.onSave.bind(this)}setModalRef(e){this.modal=e}toggleDuplicateSlices(){this.setState((e=>({duplicateSlices:!e.duplicateSlices})))}handleSaveTypeChange(e){this.setState({saveType:e.target.value})}handleNameChange(e){this.setState({newDashName:e,saveType:D.kS})}saveDashboard(){var e;const{saveType:t,newDashName:n}=this.state,{dashboardTitle:i,dashboardInfo:r,layout:o,customCss:a,dashboardId:s,refreshFrequency:d,shouldPersistRefreshFrequency:c,lastModifiedTime:u}=this.props,h=c?d:null==(e=r.metadata)?void 0:e.refresh_frequency,p={certified_by:r.certified_by,certification_details:r.certification_details,css:a,dashboard_title:t===D.kS?n:i,duplicate_slices:this.state.duplicateSlices,last_modified_time:u,owners:r.owners,roles:r.roles,metadata:{...null==r?void 0:r.metadata,positions:o,refresh_frequency:h}};var f;t!==D.kS||n?(this.onSave(p,s,t).then((e=>{t===D.kS&&e&&e.json&&e.json.id&&(window.location.href=`/superset/dashboard/${e.json.id}/`)})),null==(f=this.modal)||f.close()):this.props.addDangerToast((0,l.t)("You must pick a name for the new dashboard"))}render(){return(0,v.tZ)(St.Z,{ref:this.setModalRef,triggerNode:this.props.triggerNode,modalTitle:(0,l.t)("Save dashboard"),modalBody:(0,v.tZ)("div",null,(0,v.tZ)(Pt.Y,{value:D.TN,onChange:this.handleSaveTypeChange,checked:this.state.saveType===D.TN,disabled:!this.props.canOverwrite},(0,l.t)("Overwrite Dashboard [%s]",this.props.dashboardTitle)),(0,v.tZ)("hr",null),(0,v.tZ)(Pt.Y,{value:D.kS,onChange:this.handleSaveTypeChange,checked:this.state.saveType===D.kS},(0,l.t)("Save as:")),(0,v.tZ)(ke.II,{type:"text",placeholder:(0,l.t)("[dashboard name]"),value:this.state.newDashName,onFocus:e=>this.handleNameChange(e.target.value),onChange:e=>this.handleNameChange(e.target.value)}),(0,v.tZ)("div",{className:"m-l-25 m-t-5"},(0,v.tZ)(Nt.ZP,{checked:this.state.duplicateSlices,onChange:()=>this.toggleDuplicateSlices()}),(0,v.tZ)("span",{className:"m-l-5"},(0,l.t)("also copy (duplicate) charts")))),modalFooter:(0,v.tZ)("div",null,(0,v.tZ)(at.Z,{buttonStyle:"primary",onClick:this.saveDashboard},(0,l.t)("Save")))})}}qt.defaultProps=jt;const zt=qt;var At=n(14505),$t=n(81395),Ut=n(31758),Lt=n(41609),Vt=n.n(Lt);const Kt=[h.gn,h.U0];function Bt({currentNode:e={},components:t={},filterFields:n=[],selectedChartId:i}){if(!e)return null;const{type:r}=e;if(h.dW===r&&e&&e.meta&&e.meta.chartId){const t={value:e.meta.chartId,label:e.meta.sliceName||`${r} ${e.meta.chartId}`,type:r,showCheckbox:i!==e.meta.chartId};return{...t,children:n.map((n=>({value:`${e.meta.chartId}:${n}`,label:`${t.label}`,type:"filter_box",showCheckbox:!1})))}}let o=[];if(e.children&&e.children.length&&e.children.forEach((e=>{const r=Bt({currentNode:t[e],components:t,filterFields:n,selectedChartId:i}),a=t[e].type;Kt.includes(a)?o.push(r):o=o.concat(r)})),Kt.includes(r)){let t=null;return t=r===h.U0?(0,l.t)("All charts"):e.meta&&e.meta.text?e.meta.text:`${r} ${e.id}`,{value:e.id,label:t,type:r,children:o}}return o}function Wt({components:e={},filterFields:t=[],selectedChartId:n}){return Vt()(e)?[]:[{...Bt({currentNode:e[D._4],components:e,filterFields:t,selectedChartId:n})}]}function Ht(e=[],t=-1){const n=[],i=(e,r)=>{e&&e.children&&(-1===t||r<t)&&(n.push(e.value),e.children.forEach((e=>i(e,r+1))))};return e.length>0&&e.forEach((e=>{i(e,0)})),n}function Gt({activeFilterField:e,checkedFilterFields:t}){return(0,dt.o)(e?[e]:t)}var Yt=n(20194);function Jt({activeFilterField:e,checkedFilterFields:t}){if(e)return(0,Yt._)(e).chartId;if(t.length){const{chartId:e}=(0,Yt._)(t[0]);return t.some((t=>(0,Yt._)(t).chartId!==e))?null:e}return null}function Qt({checkedFilterFields:e=[],activeFilterField:t,filterScopeMap:n={},layout:i={}}){const r=Gt({checkedFilterFields:e,activeFilterField:t}),o=t?[t]:e,a=Wt({components:i,filterFields:o,selectedChartId:Jt({checkedFilterFields:e,activeFilterField:t})}),s=new Set;o.forEach((e=>{(n[e].checked||[]).forEach((t=>{s.add(`${t}:${e}`)}))}));const l=[...s],d=n[r]?n[r].expanded:Ht(a,1);return{[r]:{nodes:a,nodesFiltered:[...a],checked:l,expanded:d}}}var Xt=n(94654),en=n.n(Xt),tn=n(83927),nn=n.n(tn),rn=n(58809),on=n.n(rn),an=n(8816),sn=n.n(an);function ln({tabScopes:e,parentNodeValue:t,forceAggregate:n=!1,hasChartSiblings:i=!1,tabChildren:r=[],immuneChartSiblings:o=[]}){if(n||!i&&Object.entries(e).every((([e,{scope:t}])=>t&&t.length&&e===t[0]))){const n=function({tabs:e=[],tabsInScope:t=[]}){const n=[];return e.forEach((({value:e,children:i})=>{i&&!t.includes(e)&&i.forEach((({value:e,children:i})=>{i&&!t.includes(e)&&n.push(...i.filter((({type:e})=>e===h.dW)))}))})),n.map((({value:e})=>e))}({tabs:r,tabsInScope:en()(e,(({scope:e})=>e))}),i=en()(Object.values(e),(({immune:e})=>e));return{scope:[t],immune:[...new Set([...n,...i])]}}const a=Object.values(e).filter((({scope:e})=>e&&e.length));return{scope:en()(a,(({scope:e})=>e)),immune:a.length?en()(a,(({immune:e})=>e)):en()(Object.values(e),(({immune:e})=>e)).concat(o)}}function dn({currentNode:e={},filterId:t,checkedChartIds:n=[]}){if(!e)return{};const{value:i,children:r}=e,o=r.filter((({type:e})=>e===h.dW)),a=r.filter((({type:e})=>e===h.gn)),s=o.filter((({value:e})=>t!==e&&!n.includes(e))).map((({value:e})=>e)),l=sn()(on()((e=>e.value)),nn()((e=>dn({currentNode:e,filterId:t,checkedChartIds:n}))))(a);if(!Vt()(o)&&o.some((({value:e})=>n.includes(e)))){if(Vt()(a))return{scope:[i],immune:s};const{scope:e,immune:t}=ln({tabScopes:l,parentNodeValue:i,forceAggregate:!0,tabChildren:a});return{scope:e,immune:s.concat(t)}}return a.length?ln({tabScopes:l,parentNodeValue:i,hasChartSiblings:!Vt()(o),tabChildren:a,immuneChartSiblings:s}):{scope:[],immune:s}}function cn({filterKey:e,nodes:t=[],checkedChartIds:n=[]}){if(t.length){const{chartId:i}=(0,Yt._)(e);return dn({currentNode:t[0],filterId:i,checkedChartIds:n})}return{}}var un=n(43399),hn=n(28388),pn=n.n(hn);const fn=(0,g.iK)(ot.Z.BarChartOutlined)`
  ${({theme:e})=>`\n    position: relative;\n    top: ${e.gridUnit-1}px;\n    color: ${e.colors.primary.base};\n    margin-right: ${2*e.gridUnit}px;\n  `}
`;function mn({currentNode:e={},selectedChartId:t}){if(!e)return null;const{label:n,value:i,type:r,children:o}=e;if(o&&o.length){const a=o.map((e=>mn({currentNode:e,selectedChartId:t})));return{...e,label:(0,v.tZ)("span",{className:m()(`filter-scope-type ${r.toLowerCase()}`,{"selected-filter":t===i})},r===h.dW&&(0,v.tZ)(fn,null),n),children:a}}return{...e,label:(0,v.tZ)("span",{className:m()(`filter-scope-type ${r.toLowerCase()}`,{"selected-filter":t===i})},n)}}function gn({nodes:e,selectedChartId:t}){return e?e.map((e=>mn({currentNode:e,selectedChartId:t}))):[]}var vn=n(13842);const bn={check:(0,v.tZ)(vn.lU,null),uncheck:(0,v.tZ)(vn.zq,null),halfCheck:(0,v.tZ)(vn.dc,null),expandClose:(0,v.tZ)("span",{className:"rct-icon rct-icon-expand-close"}),expandOpen:(0,v.tZ)("span",{className:"rct-icon rct-icon-expand-open"}),expandAll:(0,v.tZ)("span",{className:"rct-icon rct-icon-expand-all"},(0,l.t)("Expand all")),collapseAll:(0,v.tZ)("span",{className:"rct-icon rct-icon-collapse-all"},(0,l.t)("Collapse all")),parentClose:(0,v.tZ)("span",{className:"rct-icon rct-icon-parent-close"}),parentOpen:(0,v.tZ)("span",{className:"rct-icon rct-icon-parent-open"}),leaf:(0,v.tZ)("span",{className:"rct-icon rct-icon-leaf"})},yn={nodes:s().arrayOf(E.ck).isRequired,checked:s().arrayOf(s().oneOfType([s().number,s().string])).isRequired,expanded:s().arrayOf(s().oneOfType([s().number,s().string])).isRequired,onCheck:s().func.isRequired,onExpand:s().func.isRequired,selectedChartId:s().number},Cn=()=>{};function Sn({nodes:e=[],checked:t=[],expanded:n=[],onCheck:i,onExpand:r,selectedChartId:o}){return(0,v.tZ)(pn(),{showExpandAll:!0,expandOnClick:!0,showNodeIcon:!1,nodes:gn({nodes:e,selectedChartId:o}),checked:t,expanded:n,onCheck:i,onExpand:r,onClick:Cn,icons:bn})}Sn.propTypes=yn,Sn.defaultProps={selectedChartId:null};const xn={label:s().string.isRequired,isSelected:s().bool.isRequired};function wn({label:e,isSelected:t}){return(0,v.tZ)("span",{className:m()("filter-field-item filter-container",{"is-selected":t})},(0,v.tZ)(Dt.lX,{htmlFor:e},e))}function kn({nodes:e,activeKey:t}){if(!e)return[];const n=e[0],i=n.children.map((e=>({...e,children:e.children.map((e=>{const{label:n,value:i}=e;return{...e,label:(0,v.tZ)(wn,{isSelected:i===t,label:n})}}))})));return[{...n,label:(0,v.tZ)("span",{className:"root"},n.label),children:i}]}wn.propTypes=xn;const Zn={activeKey:s().string,nodes:s().arrayOf(E.ck).isRequired,checked:s().arrayOf(s().oneOfType([s().number,s().string])).isRequired,expanded:s().arrayOf(s().oneOfType([s().number,s().string])).isRequired,onCheck:s().func.isRequired,onExpand:s().func.isRequired,onClick:s().func.isRequired};function Rn({activeKey:e,nodes:t=[],checked:n=[],expanded:i=[],onClick:r,onCheck:o,onExpand:a}){return(0,v.tZ)(pn(),{showExpandAll:!0,showNodeIcon:!1,expandOnClick:!0,nodes:kn({nodes:t,activeKey:e}),checked:n,expanded:i,onClick:r,onCheck:o,onExpand:a,icons:bn})}Rn.propTypes=Zn,Rn.defaultProps={activeKey:null};const Tn={dashboardFilters:s().objectOf(E.Er).isRequired,layout:s().object.isRequired,updateDashboardFiltersScope:s().func.isRequired,setUnsavedChanges:s().func.isRequired,onCloseModal:s().func.isRequired},Fn=g.iK.div`
  height: ${({theme:e})=>16*e.gridUnit}px;

  // TODO: replace hardcoded color with theme variable after refactoring filter-scope-selector.less to Emotion
  border-top: ${({theme:e})=>e.gridUnit/4}px solid #cfd8dc;
  padding: ${({theme:e})=>6*e.gridUnit}px;
  margin: 0 0 0 ${({theme:e})=>6*-e.gridUnit}px;
  text-align: right;

  .btn {
    margin-right: ${({theme:e})=>4*e.gridUnit}px;

    &:last-child {
      margin-right: 0;
    }
  }
`;class Dn extends o.PureComponent{constructor(e){super(e);const{dashboardFilters:t,layout:n}=e;if(Object.keys(t).length>0){const e=function({dashboardFilters:e={}}){const t=Object.values(e).map((e=>{const{chartId:t,filterName:n,columns:i,labels:r}=e,o=Object.keys(i).map((e=>({value:(0,Yt.w)({chartId:t,column:e}),label:r[e]||e})));return{value:t,label:n,children:o,showCheckbox:!0}}));return[{value:D.dU,type:h.U0,label:(0,l.t)("All filters"),children:t}]}({dashboardFilters:t}),i=e[0].children;this.allfilterFields=[],i.forEach((({children:e})=>{e.forEach((e=>{this.allfilterFields.push(e.value)}))})),this.defaultFilterKey=i[0].children[0].value;const r=Object.values(t).reduce(((e,{chartId:i,columns:r})=>({...e,...Object.keys(r).reduce(((e,r)=>{const o=(0,Yt.w)({chartId:i,column:r}),a=Wt({components:n,filterFields:[o],selectedChartId:i}),s=Ht(a,1),l=((0,un.up)({filterScope:t[i].scopes[r]})||[]).filter((e=>e!==i));return{...e,[o]:{nodes:a,nodesFiltered:[...a],checked:l,expanded:s}}}),{})})),{}),{chartId:o}=(0,Yt._)(this.defaultFilterKey),a=[],s=this.defaultFilterKey,d=[D.dU].concat(o),c=Qt({checkedFilterFields:a,activeFilterField:s,filterScopeMap:r,layout:n});this.state={showSelector:!0,activeFilterField:s,searchText:"",filterScopeMap:{...r,...c},filterFieldNodes:e,checkedFilterFields:a,expandedFilterIds:d}}else this.state={showSelector:!1};this.filterNodes=this.filterNodes.bind(this),this.onChangeFilterField=this.onChangeFilterField.bind(this),this.onCheckFilterScope=this.onCheckFilterScope.bind(this),this.onExpandFilterScope=this.onExpandFilterScope.bind(this),this.onSearchInputChange=this.onSearchInputChange.bind(this),this.onCheckFilterField=this.onCheckFilterField.bind(this),this.onExpandFilterField=this.onExpandFilterField.bind(this),this.onClose=this.onClose.bind(this),this.onSave=this.onSave.bind(this)}onCheckFilterScope(e=[]){const{activeFilterField:t,filterScopeMap:n,checkedFilterFields:i}=this.state,r=Gt({activeFilterField:t,checkedFilterFields:i}),o=t?[t]:i,a={...n[r],checked:e},s=function({checked:e=[],filterFields:t=[],filterScopeMap:n={}}){const i=e.reduce(((e,t)=>{const[n,i]=t.split(":");return{...e,[i]:(e[i]||[]).concat(parseInt(n,10))}}),{});return t.reduce(((e,t)=>{const{chartId:r}=(0,Yt._)(t),o=(i[t]||[]).filter((e=>e!==r));return{...e,[t]:{...n[t],checked:o}}}),{})}({checked:e,filterFields:o,filterScopeMap:n});this.setState((()=>({filterScopeMap:{...n,...s,[r]:a}})))}onExpandFilterScope(e=[]){const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:i}=this.state,r=Gt({activeFilterField:t,checkedFilterFields:n}),o={...i[r],expanded:e};this.setState((()=>({filterScopeMap:{...i,[r]:o}})))}onCheckFilterField(e=[]){const{layout:t}=this.props,{filterScopeMap:n}=this.state,i=Qt({checkedFilterFields:e,activeFilterField:null,filterScopeMap:n,layout:t});this.setState((()=>({activeFilterField:null,checkedFilterFields:e,filterScopeMap:{...n,...i}})))}onExpandFilterField(e=[]){this.setState((()=>({expandedFilterIds:e})))}onChangeFilterField(e={}){const{layout:t}=this.props,n=e.value,{activeFilterField:i,checkedFilterFields:r,filterScopeMap:o}=this.state;if(n===i){const e=Qt({checkedFilterFields:r,activeFilterField:null,filterScopeMap:o,layout:t});this.setState({activeFilterField:null,filterScopeMap:{...o,...e}})}else if(this.allfilterFields.includes(n)){const e=Qt({checkedFilterFields:r,activeFilterField:n,filterScopeMap:o,layout:t});this.setState({activeFilterField:n,filterScopeMap:{...o,...e}})}}onSearchInputChange(e){this.setState({searchText:e.target.value},this.filterTree)}onClose(){this.props.onCloseModal()}onSave(){const{filterScopeMap:e}=this.state,t=this.allfilterFields.reduce(((t,n)=>{const{nodes:i}=e[n];return{...t,[n]:cn({filterKey:n,nodes:i,checkedChartIds:e[n].checked})}}),{});this.props.updateDashboardFiltersScope(t),this.props.setUnsavedChanges(!0),this.props.onCloseModal()}filterTree(){if(this.state.searchText){const e=e=>{const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:i}=e,r=Gt({activeFilterField:t,checkedFilterFields:n}),o=i[r].nodes.reduce(this.filterNodes,[]),a=Ht([...o]),s={...i[r],nodesFiltered:o,expanded:a};return{filterScopeMap:{...i,[r]:s}}};this.setState(e)}else this.setState((e=>{const{activeFilterField:t,checkedFilterFields:n,filterScopeMap:i}=e,r=Gt({activeFilterField:t,checkedFilterFields:n}),o={...i[r],nodesFiltered:i[r].nodes};return{filterScopeMap:{...i,[r]:o}}}))}filterNodes(e=[],t={}){const{searchText:n}=this.state,i=(t.children||[]).reduce(this.filterNodes,[]);return(t.label.toLocaleLowerCase().indexOf(n.toLocaleLowerCase())>-1||i.length)&&e.push({...t,children:i}),e}renderFilterFieldList(){const{activeFilterField:e,filterFieldNodes:t,checkedFilterFields:n,expandedFilterIds:i}=this.state;return(0,v.tZ)(Rn,{activeKey:e,nodes:t,checked:n,expanded:i,onClick:this.onChangeFilterField,onCheck:this.onCheckFilterField,onExpand:this.onExpandFilterField})}renderFilterScopeTree(){const{filterScopeMap:e,activeFilterField:t,checkedFilterFields:n,searchText:i}=this.state,r=Gt({activeFilterField:t,checkedFilterFields:n}),a=Jt({activeFilterField:t,checkedFilterFields:n});return(0,v.tZ)(o.Fragment,null,(0,v.tZ)("input",{className:"filter-text scope-search multi-edit-mode",placeholder:(0,l.t)("Search..."),type:"text",value:i,onChange:this.onSearchInputChange}),(0,v.tZ)(Sn,{nodes:e[r].nodesFiltered,checked:e[r].checked,expanded:e[r].expanded,onCheck:this.onCheckFilterScope,onExpand:this.onExpandFilterScope,selectedChartId:a}))}renderEditingFiltersName(){const{dashboardFilters:e}=this.props,{activeFilterField:t,checkedFilterFields:n}=this.state,i=[].concat(t||n).map((t=>{const{chartId:n,column:i}=(0,Yt._)(t);return e[n].labels[i]||i}));return(0,v.tZ)("div",{className:"selected-fields multi-edit-mode"},0===i.length&&(0,l.t)("No filter is selected."),1===i.length&&(0,l.t)("Editing 1 filter:"),i.length>1&&(0,l.t)("Batch editing %d filters:",i.length),(0,v.tZ)("span",{className:"selected-scopes"},i.join(", ")))}render(){const{showSelector:e}=this.state;return(0,v.tZ)("div",{className:"filter-scope-container"},(0,v.tZ)("div",{className:"filter-scope-header"},(0,v.tZ)("h4",null,(0,l.t)("Configure filter scopes")),e&&this.renderEditingFiltersName()),(0,v.tZ)("div",{className:"filter-scope-body"},e?(0,v.tZ)("div",{className:"filters-scope-selector"},(0,v.tZ)("div",{className:m()("filter-field-pane multi-edit-mode")},this.renderFilterFieldList()),(0,v.tZ)("div",{className:"filter-scope-pane multi-edit-mode"},this.renderFilterScopeTree())):(0,v.tZ)("div",{className:"warning-message"},(0,l.t)("There are no filters in this dashboard."))),(0,v.tZ)(Fn,null,(0,v.tZ)(at.Z,{buttonSize:"small",onClick:this.onClose},(0,l.t)("Close")),e&&(0,v.tZ)(at.Z,{buttonSize:"small",buttonStyle:"primary",onClick:this.onSave},(0,l.t)("Save"))))}}Dn.propTypes=Tn;const _n=(0,r.$j)((function({dashboardLayout:e,dashboardFilters:t}){return{dashboardFilters:t,layout:e.present}}),(function(e){return(0,i.DE)({updateDashboardFiltersScope:$t.l6,setUnsavedChanges:Ut.if},e)}))(Dn),En=g.iK.div((({theme:{gridUnit:e}})=>({padding:2*e,paddingBottom:3*e})));class In extends o.PureComponent{constructor(e){super(e),this.modal=void 0,this.modal=o.createRef(),this.handleCloseModal=this.handleCloseModal.bind(this)}handleCloseModal(){this.modal.current&&this.modal.current.close()}render(){const e={onCloseModal:this.handleCloseModal};return(0,v.tZ)(St.Z,{ref:this.modal,triggerNode:this.props.triggerNode,modalBody:(0,v.tZ)(En,null,(0,v.tZ)(_n,e)),width:"80%"})}}var Mn=n(56727),On=n(11370);function Pn({pathname:e,filters:t={},hash:n="",standalone:i}){const r=new URLSearchParams;r.set(pt.KD.preselectFilters.name,JSON.stringify((0,On.Z)(t))),i&&r.set(pt.KD.standalone.name,i.toString());const o=(0,bt.eY)(pt.KD.nativeFiltersKey);o&&r.set(pt.KD.nativeFiltersKey.name,o);const a=n?`#${n}`:"";return`${e}?${r.toString()}${a}`}const Nn={addSuccessToast:s().func.isRequired,addDangerToast:s().func.isRequired,dashboardInfo:s().object.isRequired,dashboardId:s().number.isRequired,dashboardTitle:s().string.isRequired,dataMask:s().object.isRequired,customCss:s().string.isRequired,colorNamespace:s().string,colorScheme:s().string,onChange:s().func.isRequired,updateCss:s().func.isRequired,forceRefreshAllCharts:s().func.isRequired,refreshFrequency:s().number.isRequired,shouldPersistRefreshFrequency:s().bool.isRequired,setRefreshFrequency:s().func.isRequired,startPeriodicRender:s().func.isRequired,editMode:s().bool.isRequired,userCanEdit:s().bool.isRequired,userCanShare:s().bool.isRequired,userCanSave:s().bool.isRequired,userCanCurate:s().bool.isRequired,isLoading:s().bool.isRequired,layout:s().object.isRequired,expandedSlices:s().object.isRequired,onSave:s().func.isRequired,showPropertiesModal:s().func.isRequired,manageEmbedded:s().func.isRequired,refreshLimit:s().number,refreshWarning:s().string,lastModifiedTime:s().number.isRequired,filterboxMigrationState:Re.Qi},jn={colorNamespace:void 0,colorScheme:void 0,refreshLimit:0,refreshWarning:null,filterboxMigrationState:Re.Qi.NOOP},qn="refresh-dashboard",zn="edit-properties",An="download-as-image",$n="toggle-fullscreen",Un="manage-embedded",Ln=g.iK.div`
  margin-left: ${({theme:e})=>2.5*e.gridUnit}px;
  span {
    color: ${({theme:e})=>e.colors.grayscale.base};
  }
`;class Vn extends o.PureComponent{static discardChanges(){window.location.reload()}constructor(e){super(e),this.state={css:e.customCss,cssTemplates:[]},this.changeCss=this.changeCss.bind(this),this.changeRefreshInterval=this.changeRefreshInterval.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this)}UNSAFE_componentWillMount(){ct.Z.get({endpoint:"/csstemplateasyncmodelview/api/read"}).then((({json:e})=>{const t=e.result.map((e=>({value:e.template_name,css:e.css,label:e.template_name})));this.setState({cssTemplates:t})})).catch((()=>{this.props.addDangerToast((0,l.t)("An error occurred while fetching available CSS templates"))}))}changeCss(e){this.setState({css:e},(()=>{(0,At.Z)(e)})),this.props.onChange(),this.props.updateCss(e)}changeRefreshInterval(e,t){this.props.setRefreshFrequency(e,t),this.props.startPeriodicRender(1e3*e)}handleMenuClick({key:e,domEvent:t}){switch(e){case qn:this.props.forceRefreshAllCharts(),this.props.addSuccessToast((0,l.t)("Data refreshed"));break;case zn:this.props.showPropertiesModal();break;case An:{const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Mn.Z)(".dashboard",this.props.dashboardTitle,{},!0)(t).then((()=>{e.style.visibility="visible"}));break}case $n:{const e=Pn({pathname:window.location.pathname,filters:(0,un.De)(),hash:window.location.hash,standalone:!(0,bt.eY)(pt.KD.standalone)});window.location.replace(e);break}case Un:this.props.manageEmbedded()}}render(){const{dashboardTitle:e,dashboardId:t,dashboardInfo:n,refreshFrequency:i,shouldPersistRefreshFrequency:r,editMode:o,customCss:a,colorNamespace:s,colorScheme:d,layout:c,expandedSlices:u,onSave:h,userCanEdit:p,userCanShare:f,userCanSave:m,userCanCurate:g,isLoading:b,refreshLimit:y,refreshWarning:C,lastModifiedTime:S,addSuccessToast:x,addDangerToast:w,filterboxMigrationState:k}=this.props,Z=`${(0,l.t)("Superset dashboard")} ${e}`,R=(0,l.t)("Check out this dashboard: "),T=Pn({pathname:window.location.pathname,filters:(0,un.De)(),hash:window.location.hash}),F=(0,v.tZ)(ut.v,{onClick:this.handleMenuClick,selectable:!1},m&&(0,v.tZ)(ut.v.Item,{key:"save-modal"},(0,v.tZ)(zt,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:t,dashboardTitle:e,dashboardInfo:n,saveType:D.kS,layout:c,expandedSlices:u,refreshFrequency:i,shouldPersistRefreshFrequency:r,lastModifiedTime:S,customCss:a,colorNamespace:s,colorScheme:d,onSave:h,triggerNode:(0,v.tZ)("span",null,(0,l.t)("Save as")),canOverwrite:p})),f&&(0,v.tZ)(Ct,{url:T,copyMenuItemTitle:(0,l.t)("Copy permalink to clipboard"),emailMenuItemTitle:(0,l.t)("Share permalink by email"),emailSubject:Z,emailBody:R,addSuccessToast:x,addDangerToast:w,dashboardId:t}),(0,v.tZ)(ut.v.Item,{key:qn,disabled:b},(0,l.t)("Refresh dashboard")),(0,v.tZ)(ut.v.Divider,null),(0,v.tZ)(ut.v.Item,{key:"autorefresh-modal"},(0,v.tZ)(Ot,{addSuccessToast:this.props.addSuccessToast,refreshFrequency:i,refreshLimit:y,refreshWarning:C,onChange:this.changeRefreshInterval,editMode:o,triggerNode:(0,v.tZ)("span",null,(0,l.t)("Set auto-refresh interval"))})),o&&k!==Re.Qi.CONVERTED&&(0,v.tZ)(ut.v.Item,{key:"set-filter-mapping"},(0,v.tZ)(In,{className:"m-r-5",triggerNode:(0,l.t)("Set filter mapping")})),o&&(0,v.tZ)(ut.v.Item,{key:zn},(0,l.t)("Edit dashboard properties")),o&&(0,v.tZ)(ut.v.Item,{key:"edit-css"},(0,v.tZ)(Rt,{triggerNode:(0,v.tZ)("span",null,(0,l.t)("Edit CSS")),initialCss:this.state.css,templates:this.state.cssTemplates,onChange:this.changeCss})),!o&&g&&(0,v.tZ)(ut.v.Item,{key:Un},(0,l.t)("Embed dashboard")),!o&&(0,v.tZ)(ut.v.Item,{key:An},(0,l.t)("Download as image")),!o&&(0,v.tZ)(ut.v.Item,{key:$n},(0,bt.eY)(pt.KD.standalone)?(0,l.t)("Exit fullscreen"):(0,l.t)("Enter fullscreen")));return(0,v.tZ)(ht.$,{overlay:F,trigger:["click"],getPopupContainer:e=>e.closest(".dashboard-header")},(0,v.tZ)(Ln,{id:"save-dash-split-button",role:"button"},(0,v.tZ)(ot.Z.MoreHoriz,null)))}}Vn.propTypes=Nn,Vn.defaultProps=jn;const Kn=Vn;var Bn=n(48600),Wn=n(58593),Hn=n(37921);const Gn={dashboardId:s().number.isRequired,isPublished:s().bool.isRequired,savePublished:s().func.isRequired,canEdit:s().bool.isRequired,canSave:s().bool.isRequired},Yn=(0,l.t)("This dashboard is not published, it will not show up in the list of dashboards. Click here to publish this dashboard."),Jn=(0,l.t)("This dashboard is not published which means it will not show up in the list of dashboards. Favorite it to see it there or access it by using the URL directly."),Qn=(0,l.t)("This dashboard is published. Click to make it a draft.");class Xn extends o.Component{componentDidMount(){this.togglePublished=this.togglePublished.bind(this)}togglePublished(){this.props.savePublished(this.props.dashboardId,!this.props.isPublished)}render(){return this.props.isPublished?this.props.canEdit&&this.props.canSave?(0,v.tZ)(Wn.u,{id:"published-dashboard-tooltip",placement:"bottom",title:Qn},(0,v.tZ)(Hn.Z,{onClick:()=>{this.togglePublished()}},(0,l.t)("Published"))):null:this.props.canEdit&&this.props.canSave?(0,v.tZ)(Wn.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:Yn},(0,v.tZ)(Hn.Z,{onClick:()=>{this.togglePublished()}},(0,l.t)("Draft"))):(0,v.tZ)(Wn.u,{id:"unpublished-dashboard-tooltip",placement:"bottom",title:Jn},(0,v.tZ)(Hn.Z,null,(0,l.t)("Draft")))}}Xn.propTypes=Gn;const ei={onUndo:s().func.isRequired,onRedo:s().func.isRequired};class ti extends o.PureComponent{constructor(e){super(e),this.handleKeydown=this.handleKeydown.bind(this)}componentDidMount(){document.addEventListener("keydown",this.handleKeydown)}componentWillUnmount(){document.removeEventListener("keydown",this.handleKeydown)}handleKeydown(e){if(e.ctrlKey||e.metaKey){const t="z"===e.key||90===e.keyCode,n="y"===e.key||89===e.keyCode,i=document&&document.querySelector(".dashboard-markdown--editing"),r=document&&document.querySelector(".editable-title--editing");i||r||!t&&!n||(e.preventDefault(),(t?this.props.onUndo:this.props.onRedo)())}}render(){return null}}ti.propTypes=ei;const ni=ti;var ii=n(20818),ri=n(97860),oi=n(5558);const ai=e=>{e&&clearInterval(e)};var si=n(70695),li=n(22102),di=n(9882),ci=n(74069),ui=n(14114);const hi=e=>e.split(/(?:\s|,)+/).filter((e=>e)),pi=g.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: flex-end;
`,fi=({dashboardId:e,onHide:t})=>{const{addInfoToast:n,addDangerToast:i}=(0,ui.e1)(),[r,a]=(0,o.useState)(!0),[s,d]=(0,o.useState)(!1),[c,h]=(0,o.useState)(null),[p,f]=(0,o.useState)(""),m=`/api/v1/dashboard/${e}/embedded`,g=!c||hi(p).join()!==c.allowed_domains.join(),b=(0,o.useCallback)((()=>{d(!0),(0,li.Z)({method:"POST",endpoint:m})({allowed_domains:hi(p)}).then((({result:e})=>{h(e),f(e.allowed_domains.join(", ")),n((0,l.t)("Changes saved."))}),(e=>{console.error(e),i((0,l.t)((0,l.t)("Sorry, something went wrong. The changes could not be saved.")))})).finally((()=>{d(!1)}))}),[m,p]),y=(0,o.useCallback)((()=>{ci.Z.confirm({title:(0,l.t)("Disable embedding?"),content:(0,l.t)("This will remove your current embed configuration."),okType:"danger",onOk:()=>{d(!0),(0,li.Z)({method:"DELETE",endpoint:m})({}).then((()=>{h(null),f(""),n((0,l.t)("Embedding deactivated.")),t()}),(e=>{console.error(e),i((0,l.t)("Sorry, something went wrong. Embedding could not be deactivated."))})).finally((()=>{d(!1)}))}})}),[m]);return(0,o.useEffect)((()=>{a(!1),(0,li.Z)({method:"GET",endpoint:m})({}).catch((e=>{if(404===e.status)return{result:null};throw e})).then((({result:e})=>{a(!0),h(e),f(e?e.allowed_domains.join(", "):"")}))}),[e]),r?(0,v.tZ)(o.Fragment,null,(0,v.tZ)("p",null,c?(0,v.tZ)(o.Fragment,null,(0,l.t)("This dashboard is ready to embed. In your application, pass the following id to the SDK:"),(0,v.tZ)("br",null),(0,v.tZ)("code",null,c.uuid)):(0,l.t)("Configure this dashboard to embed it into an external web application.")),(0,v.tZ)("p",null,(0,l.t)("For further instructions, consult the")," ",(0,v.tZ)("a",{href:"https://www.npmjs.com/package/@superset-ui/embedded-sdk",target:"_blank",rel:"noreferrer"},(0,l.t)("Superset Embedded SDK documentation."))),(0,v.tZ)("h3",null,"Settings"),(0,v.tZ)(Dt.xJ,null,(0,v.tZ)("label",{htmlFor:"allowed-domains"},(0,l.t)("Allowed Domains (comma separated)")," ",(0,v.tZ)(di.V,{tooltip:(0,l.t)("A list of domain names that can embed this dashboard. Leaving this field empty will allow embedding from any domain.")})),(0,v.tZ)(ke.II,{name:"allowed-domains",value:p,placeholder:"superset.example.com",onChange:e=>f(e.target.value)})),(0,v.tZ)(pi,null,c?(0,v.tZ)(o.Fragment,null,(0,v.tZ)(at.Z,{onClick:y,buttonStyle:"secondary",loading:s},(0,l.t)("Deactivate")),(0,v.tZ)(at.Z,{onClick:b,buttonStyle:"primary",disabled:!g,loading:s},(0,l.t)("Save changes"))):(0,v.tZ)(at.Z,{onClick:b,buttonStyle:"primary",loading:s},(0,l.t)("Enable embedding")))):(0,v.tZ)(u.Z,null)},mi=e=>{const{show:t,onHide:n}=e;return(0,v.tZ)(ci.Z,{show:t,onHide:n,title:(0,l.t)("Embed"),hideFooter:!0},(0,v.tZ)(fi,e))},gi={addSuccessToast:s().func.isRequired,addDangerToast:s().func.isRequired,addWarningToast:s().func.isRequired,user:oi.UserWithPermissionsAndRoles,dashboardInfo:s().object.isRequired,dashboardTitle:s().string.isRequired,dataMask:s().object.isRequired,charts:s().objectOf(E.$6).isRequired,layout:s().object.isRequired,expandedSlices:s().object.isRequired,customCss:s().string.isRequired,colorNamespace:s().string,colorScheme:s().string,setColorSchemeAndUnsavedChanges:s().func.isRequired,isStarred:s().bool.isRequired,isPublished:s().bool.isRequired,isLoading:s().bool.isRequired,onSave:s().func.isRequired,onChange:s().func.isRequired,fetchFaveStar:s().func.isRequired,fetchCharts:s().func.isRequired,fetchUISpecificReport:s().func.isRequired,saveFaveStar:s().func.isRequired,savePublished:s().func.isRequired,updateDashboardTitle:s().func.isRequired,editMode:s().bool.isRequired,setEditMode:s().func.isRequired,showBuilderPane:s().func.isRequired,updateCss:s().func.isRequired,logEvent:s().func.isRequired,hasUnsavedChanges:s().bool.isRequired,maxUndoHistoryExceeded:s().bool.isRequired,lastModifiedTime:s().number.isRequired,onRefresh:s().func.isRequired,onUndo:s().func.isRequired,onRedo:s().func.isRequired,undoLength:s().number.isRequired,redoLength:s().number.isRequired,setMaxUndoHistoryExceeded:s().func.isRequired,maxUndoHistoryToast:s().func.isRequired,refreshFrequency:s().number.isRequired,shouldPersistRefreshFrequency:s().bool.isRequired,setRefreshFrequency:s().func.isRequired,dashboardInfoChanged:s().func.isRequired,dashboardTitleChanged:s().func.isRequired},vi=g.iK.div`
  background: ${({theme:e})=>e.colors.grayscale.light5};
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  padding: 0 ${({theme:e})=>6*e.gridUnit}px;
  border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};

  .action-button > span {
    color: ${({theme:e})=>e.colors.grayscale.base};
  }
  button,
  .fave-unfave-icon {
    margin-left: ${({theme:e})=>2*e.gridUnit}px;
  }
  .button-container {
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
    .action-button {
      font-size: ${({theme:e})=>e.typography.sizes.xl}px;
      margin-left: ${({theme:e})=>2.5*e.gridUnit}px;
    }
  }
`;class bi extends o.PureComponent{static discardChanges(){const e=new URL(window.location.href);e.searchParams.delete("edit"),window.location.assign(e)}constructor(e){super(e),this.showEmbedModal=()=>{this.setState({showingEmbedModal:!0})},this.hideEmbedModal=()=>{this.setState({showingEmbedModal:!1})},this.state={didNotifyMaxUndoHistoryToast:!1,emphasizeUndo:!1,showingPropertiesModal:!1,showingReportModal:!1},this.handleChangeText=this.handleChangeText.bind(this),this.handleCtrlZ=this.handleCtrlZ.bind(this),this.handleCtrlY=this.handleCtrlY.bind(this),this.toggleEditMode=this.toggleEditMode.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.startPeriodicRender=this.startPeriodicRender.bind(this),this.overwriteDashboard=this.overwriteDashboard.bind(this),this.showPropertiesModal=this.showPropertiesModal.bind(this),this.hidePropertiesModal=this.hidePropertiesModal.bind(this),this.showReportModal=this.showReportModal.bind(this),this.hideReportModal=this.hideReportModal.bind(this),this.renderReportModal=this.renderReportModal.bind(this)}componentDidMount(){const{refreshFrequency:e,user:t,dashboardInfo:n}=this.props;this.startPeriodicRender(1e3*e),this.canAddReports()&&Object.entries(n).length&&this.props.fetchUISpecificReport(t.userId,"dashboard_id","dashboards",n.id,t.email)}componentDidUpdate(e){if(this.props.refreshFrequency!==e.refreshFrequency){const{refreshFrequency:e}=this.props;this.startPeriodicRender(1e3*e)}}UNSAFE_componentWillReceiveProps(e){const{user:t}=this.props;var n;D.Q9-e.undoLength<=0&&!this.state.didNotifyMaxUndoHistoryToast&&(this.setState((()=>({didNotifyMaxUndoHistoryToast:!0}))),this.props.maxUndoHistoryToast()),e.undoLength>D.Q9&&!this.props.maxUndoHistoryExceeded&&this.props.setMaxUndoHistoryExceeded(),this.canAddReports()&&e.dashboardInfo.id!==this.props.dashboardInfo.id&&this.props.fetchUISpecificReport(null==t?void 0:t.userId,"dashboard_id","dashboards",null==e||null==(n=e.dashboardInfo)?void 0:n.id,null==t?void 0:t.email)}componentWillUnmount(){ai(this.refreshTimer),this.props.setRefreshFrequency(0),clearTimeout(this.ctrlYTimeout),clearTimeout(this.ctrlZTimeout)}handleChangeText(e){const{updateDashboardTitle:t,onChange:n}=this.props;e&&this.props.dashboardTitle!==e&&(t(e),n())}handleCtrlY(){this.props.onRedo(),this.setState({emphasizeRedo:!0},(()=>{this.ctrlYTimeout&&clearTimeout(this.ctrlYTimeout),this.ctrlYTimeout=setTimeout((()=>{this.setState({emphasizeRedo:!1})}),100)}))}handleCtrlZ(){this.props.onUndo(),this.setState({emphasizeUndo:!0},(()=>{this.ctrlZTimeout&&clearTimeout(this.ctrlZTimeout),this.ctrlZTimeout=setTimeout((()=>{this.setState({emphasizeUndo:!1})}),100)}))}forceRefresh(){if(!this.props.isLoading){const e=Object.keys(this.props.charts);return this.props.logEvent(it.H3,{force:!0,interval:0,chartCount:e.length}),this.props.onRefresh(e,!0,0,this.props.dashboardInfo.id)}return!1}startPeriodicRender(e){let t;if(e){const n=_t.find((t=>t.value===e/1e3));t=n?n.label:et().duration(e,"millisecond").humanize()}this.refreshTimer=function({interval:e=0,periodicRender:t,refreshTimer:n}){return ai(n),e>0?setInterval(t,e):0}({interval:e,periodicRender:()=>{const{fetchCharts:n,logEvent:i,charts:r,dashboardInfo:o}=this.props,{metadata:a}=o,s=a.timed_refresh_immune_slices||[],d=Object.values(r).filter((e=>-1===s.indexOf(e.id))).map((e=>e.id));return i(it.S,{interval:e,chartCount:d.length}),this.props.addWarningToast((0,l.t)("This dashboard is currently auto refreshing; the next auto refresh will be in %s.",t)),"fetch"===o.common.conf.DASHBOARD_AUTO_REFRESH_MODE?n(d,!1,.2*e,o.id):n(d,!0,.2*e,o.id)},refreshTimer:this.refreshTimer})}toggleEditMode(){this.props.logEvent(it.vH,{edit_mode:!this.props.editMode}),this.props.setEditMode(!this.props.editMode)}overwriteDashboard(){var e,t,n;const{dashboardTitle:i,layout:r,colorScheme:o,colorNamespace:a,customCss:s,dashboardInfo:d,refreshFrequency:c,shouldPersistRefreshFrequency:u,lastModifiedTime:h,slug:p}=this.props,f=u?c:null==(e=d.metadata)?void 0:e.refresh_frequency,m=(null==d||null==(t=d.metadata)?void 0:t.color_scheme)||o,g=(null==d||null==(n=d.metadata)?void 0:n.color_namespace)||a,v=(0,tt.Z)().getColorMap(g,m),b={certified_by:d.certified_by,certification_details:d.certification_details,css:s,dashboard_title:i,last_modified_time:h,owners:d.owners,roles:d.roles,slug:p,metadata:{...null==d?void 0:d.metadata,color_namespace:g,color_scheme:m,positions:r,refresh_frequency:f,shared_label_colors:v}},y=(0,dt.o)(r).length,C=d.common.conf.SUPERSET_DASHBOARD_POSITION_DATA_LIMIT||D.Bu;y>=C?this.props.addDangerToast((0,l.t)("Your dashboard is too large. Please reduce its size before saving it.")):(y>=.9*C&&this.props.addWarningToast("Your dashboard is near the size limit."),this.props.onSave(b,d.id,D.TN))}showPropertiesModal(){this.setState({showingPropertiesModal:!0})}hidePropertiesModal(){this.setState({showingPropertiesModal:!1})}showReportModal(){this.setState({showingReportModal:!0})}hideReportModal(){this.setState({showingReportModal:!1})}renderReportModal(){return Object.keys(this.props.reports).length?(0,v.tZ)(Bn.Z,{showReportModal:this.showReportModal,toggleActive:this.props.toggleActive,deleteActiveReport:this.props.deleteActiveReport}):(0,v.tZ)(o.Fragment,null,(0,v.tZ)("span",{role:"button",title:(0,l.t)("Schedule email report"),tabIndex:0,className:"action-button",onClick:this.showReportModal},(0,v.tZ)(ot.Z.Calendar,null)))}canAddReports(){if(!(0,rt.cr)(d.T.ALERT_REPORTS))return!1;const{user:e}=this.props;return!(null==e||!e.userId)&&Object.keys(e.roles||[]).map((t=>e.roles[t].filter((e=>"menu_access"===e[0]&&"Manage"===e[1]))))[0].length>0}render(){var e,t,n,i;const{dashboardTitle:r,layout:a,expandedSlices:s,customCss:c,colorNamespace:u,dataMask:h,setColorSchemeAndUnsavedChanges:p,colorScheme:f,onUndo:m,onRedo:g,undoLength:b,redoLength:y,onChange:C,onSave:S,updateCss:x,editMode:w,isPublished:k,user:Z,dashboardInfo:R,hasUnsavedChanges:T,isLoading:F,refreshFrequency:D,shouldPersistRefreshFrequency:_,setRefreshFrequency:E,lastModifiedTime:I,filterboxMigrationState:M}=this.props,O=R.dash_edit_perm&&M!==Re.Qi.REVIEWING&&!R.is_managed_externally,P=R.dash_share_perm,N=R.dash_save_perm&&M!==Re.Qi.REVIEWING,j=(0,rt.cr)(d.T.EMBEDDED_SUPERSET)&&(0,si.ZP)("can_set_embedded","Dashboard",Z.roles),q=!w&&this.canAddReports(),z=null==(e=R.common)||null==(t=e.conf)?void 0:t.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_LIMIT,A=null==(n=R.common)||null==(i=n.conf)?void 0:i.SUPERSET_DASHBOARD_PERIODICAL_REFRESH_WARNING_MESSAGE;return(0,v.tZ)(vi,{className:"dashboard-header","data-test-id":`${R.id}`},(0,v.tZ)("div",{className:"dashboard-component-header header-large"},(0,v.tZ)(st.Z,{title:r,canEdit:O&&w,onSaveTitle:this.handleChangeText,showTooltip:!1,certifiedBy:R.certified_by,certificationDetails:R.certification_details}),(0,v.tZ)(Xn,{dashboardId:R.id,isPublished:k,savePublished:this.props.savePublished,canEdit:O,canSave:N}),(null==Z?void 0:Z.userId)&&(null==R?void 0:R.id)&&(0,v.tZ)(lt.Z,{itemId:R.id,fetchFaveStar:this.props.fetchFaveStar,saveFaveStar:this.props.saveFaveStar,isStarred:this.props.isStarred,showTooltip:!0})),(0,v.tZ)("div",{className:"button-container"},N&&(0,v.tZ)("div",{className:"button-container"},w&&(0,v.tZ)(o.Fragment,null,(0,v.tZ)(nt.Z,{className:"m-r-5"},(0,v.tZ)(at.Z,{buttonSize:"small",onClick:m,disabled:b<1,buttonStyle:this.state.emphasizeUndo?"primary":void 0,showMarginRight:!1},(0,v.tZ)("i",{title:"Undo",className:"undo-action fa fa-reply"}),""),(0,v.tZ)(at.Z,{buttonSize:"small",onClick:g,disabled:y<1,buttonStyle:this.state.emphasizeRedo?"primary":void 0,showMarginRight:!1},"",(0,v.tZ)("i",{title:"Redo",className:"redo-action fa fa-share"}))),(0,v.tZ)(at.Z,{buttonSize:"small",className:"m-r-5",onClick:this.constructor.discardChanges,buttonStyle:"default"},(0,l.t)("Discard changes")),(0,v.tZ)(at.Z,{buttonSize:"small",disabled:!T,buttonStyle:"primary",onClick:this.overwriteDashboard},(0,l.t)("Save")))),w&&(0,v.tZ)(ni,{onUndo:this.handleCtrlZ,onRedo:this.handleCtrlY}),!w&&O&&(0,v.tZ)(o.Fragment,null,(0,v.tZ)("span",{role:"button",title:(0,l.t)("Edit dashboard"),tabIndex:0,className:"action-button",onClick:this.toggleEditMode},(0,v.tZ)(ot.Z.EditAlt,null))),q&&this.renderReportModal(),(0,v.tZ)(ii.Z,{dashboardId:R.id,dashboardInfo:R,dashboardTitle:r,show:this.state.showingPropertiesModal,onHide:this.hidePropertiesModal,colorScheme:this.props.colorScheme,onSubmit:e=>{const{dashboardInfoChanged:t,dashboardTitleChanged:n}=this.props;t({slug:e.slug,metadata:JSON.parse(e.jsonMetadata||"{}"),certified_by:e.certifiedBy,certification_details:e.certificationDetails,owners:e.owners,roles:e.roles}),p(e.colorScheme),n(e.title)},onlyApply:!0}),this.state.showingReportModal&&(0,v.tZ)(ri.Z,{show:this.state.showingReportModal,onHide:this.hideReportModal,props:{userId:Z.userId,userEmail:Z.email,dashboardId:R.id,creationMethod:"dashboards"}}),j&&(0,v.tZ)(mi,{show:this.state.showingEmbedModal,onHide:this.hideEmbedModal,dashboardId:R.id}),(0,v.tZ)(Kn,{addSuccessToast:this.props.addSuccessToast,addDangerToast:this.props.addDangerToast,dashboardId:R.id,dashboardTitle:r,dashboardInfo:R,dataMask:h,layout:a,expandedSlices:s,customCss:c,colorNamespace:u,colorScheme:f,onSave:S,onChange:C,forceRefreshAllCharts:this.forceRefresh,startPeriodicRender:this.startPeriodicRender,refreshFrequency:D,shouldPersistRefreshFrequency:_,setRefreshFrequency:E,updateCss:x,editMode:w,hasUnsavedChanges:T,userCanEdit:O,userCanShare:P,userCanSave:N,userCanCurate:j,isLoading:F,showPropertiesModal:this.showPropertiesModal,manageEmbedded:this.showEmbedModal,refreshLimit:z,refreshWarning:A,lastModifiedTime:I,filterboxMigrationState:M})))}}bi.propTypes=gi,bi.defaultProps={colorNamespace:void 0,colorScheme:void 0};const yi=bi;function Ci(e){return Object.values(e).some((e=>e.chartUpdateStartTime>(e.chartUpdateEndTime||0)))}var Si=n(41295),xi=n(40701),wi=n(72570),ki=n(97381),Zi=n(61358);const Ri=(0,r.$j)((function({dashboardLayout:e,dashboardState:t,reports:n,dashboardInfo:i,charts:r,dataMask:o,user:a}){return{dashboardInfo:i,undoLength:e.past.length,redoLength:e.future.length,layout:e.present,dashboardTitle:((e.present[D.M2]||{}).meta||{}).text,expandedSlices:t.expandedSlices,refreshFrequency:t.refreshFrequency,shouldPersistRefreshFrequency:!!t.shouldPersistRefreshFrequency,customCss:t.css,colorNamespace:t.colorNamespace,colorScheme:t.colorScheme,charts:r,dataMask:o,user:a,isStarred:!!t.isStarred,isPublished:!!t.isPublished,isLoading:Ci(r),hasUnsavedChanges:!!t.hasUnsavedChanges,maxUndoHistoryExceeded:!!t.maxUndoHistoryExceeded,lastModifiedTime:Math.max(t.lastModifiedTime,i.last_modified_time),editMode:!!t.editMode,slug:i.slug,metadata:i.metadata,reports:n,filterboxMigrationState:t.filterboxMigrationState}}),(function(e){return(0,i.DE)({addSuccessToast:wi.ws,addDangerToast:wi.Gb,addWarningToast:wi.Dz,onUndo:xi.Ou,onRedo:xi.az,setEditMode:Ut.Mb,showBuilderPane:Ut.O8,setColorSchemeAndUnsavedChanges:Ut.ps,fetchFaveStar:Ut.Lb,saveFaveStar:Ut.TN,savePublished:Ut.dr,fetchCharts:Ut.Mn,updateDashboardTitle:xi.A7,updateCss:Ut.Sn,onChange:Ut.z2,onSave:Ut.M8,setMaxUndoHistoryExceeded:Ut.uN,maxUndoHistoryToast:Ut.Qt,logEvent:ki.logEvent,setRefreshFrequency:Ut.fE,onRefresh:Ut.Yy,dashboardInfoChanged:Si.a8,dashboardTitleChanged:xi.Ww,updateDataMask:Qe.eG,fetchUISpecificReport:Zi.Aw,toggleActive:Zi.M,deleteActiveReport:Zi.MZ},e)}))(yi),Ti=g.iK.div`
  display: flex;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
  &:hover {
    color: ${({theme:e})=>e.colors.primary.base};
  }
`,Fi=g.iK.span`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,Di=({icon:e,label:t,onClick:n})=>(0,v.tZ)(Ti,{tabIndex:0,role:"button",onClick:e=>{e.preventDefault(),n(e)}},e,t&&(0,v.tZ)(Fi,null,t));var _i=n(52256),Ei=n(1510),Ii=n(99543);function Mi(e){return Object.entries(e).map((([e,t])=>({col:e,op:Array.isArray(t)?"IN":"==",val:t}))).filter((e=>null!==e.val))}const Oi=({child:e,layout:t,scope:n,activeFilters:i,filterId:r,extraFormData:o})=>{var a,s;const l=null==(a=t[e])||null==(s=a.meta)?void 0:s.chartId;if(t[e].type===h.dW){if(n.excluded.includes(l))return;return i[r]||(i[r]={scope:[],values:o}),void i[r].scope.push(l)}t[e].children.forEach((e=>Oi({child:e,layout:t,scope:n,activeFilters:i,filterId:r,extraFormData:o})))},Pi=(e,t)=>Object.values(e).filter((e=>e[t])).reduce(((e,n)=>({...e,[n.id]:t?n[t]:n})),{}),Ni=({chartConfiguration:e,nativeFilters:t,dataMask:n,layout:i})=>{const r={};return Object.values(n).forEach((({id:n,extraFormData:o})=>{var a,s,l,d,c;const u=null!=(a=null!=(s=null==t||null==(l=t[n])?void 0:l.scope)?s:null==e||null==(d=e[n])||null==(c=d.crossFilters)?void 0:c.scope)?a:{rootPath:[D._4],excluded:[n]};u.rootPath.forEach((e=>{var t,a;null==(t=i[e])||null==(a=t.children)||a.forEach((e=>{Oi({child:e,layout:i,scope:u,activeFilters:r,filterId:n,extraFormData:o})}))}))})),r},ji={},qi={};var zi,Ai=n(18446),$i=n.n(Ai),Ui=n(12515),Li=n(18239),Vi=n(40219),Ki=n(29147),Bi=n(11064),Wi=n(16355),Hi=n(65013);!function(e){e[e.all=0]="all",e[e.specific=1]="specific"}(zi||(zi={}));const Gi=({type:e,meta:t},n)=>{var i,r;return!(e!==h.gn&&e!==h.dW&&e!==h.U0||n&&"filter_box"===(null==(i=n[null==t?void 0:t.chartId])||null==(r=i.formData)?void 0:r.viz_type))},Yi=(e,t,n,i,r,o,a)=>{let s=t;if(Gi(e,i)&&e.type!==h.U0&&r.includes(e.id)){var d;const n=a(e.meta.sliceNameOverride||e.meta.sliceName||e.meta.text||e.meta.defaultText||e.id.toString(),o.includes(null==(d=e.meta)?void 0:d.chartId),(0,l.t)("This chart might be incompatible with the filter (datasets don't match)")),i={key:e.id,title:n,children:[]};t.children.push(i),s=i}e.children.forEach((e=>Yi(n[e],s,n,i,r,o,a)))},Ji=(e,t,n,i)=>{n.forEach((n=>{var r,o;Ji(e,t,((e,t)=>{var n;return[...(null==(n=e[t])?void 0:n.children)||[],...Object.values(e).filter((n=>n.parents&&n.parents[n.parents.length-1]===t&&!Gi(e[n.parents[n.parents.length-1]]))).map((({id:e})=>e))]})(t,n),i),(null==(r=t[n])?void 0:r.type)!==h.dW||i.includes(null==(o=t[n])?void 0:o.meta.chartId)||e.push(n)}))},Qi=(e,t=[])=>({rootPath:[D._4],excluded:e?[e,...t]:t}),Xi=(e,t)=>!e||e.rootPath[0]===D._4&&!e.excluded.filter((e=>e!==t)).length,er=(e,t,n)=>{let i=(0,v.tZ)("span",null,e);return t&&(i=(0,v.tZ)(o.Fragment,null,i,"",(0,v.tZ)(Wn.u,{title:n},(0,v.tZ)(ot.Z.Info,{iconSize:"m"})))),i},tr=({formScope:e,initialScope:t,forceUpdate:n,updateFormValues:i,chartId:a,initiallyExcludedCharts:s=[]})=>{const[d,c]=(0,o.useState)([D._4]),{treeData:u,layout:p}=function(e,t=[],n=(e=>e)){const i=(0,r.v9)((({dashboardLayout:{present:e}})=>e)),a=(0,r.v9)((({charts:e})=>e)),s={children:[],key:D._4,type:h.U0,title:(0,l.t)("All panels")},d=(0,o.useMemo)((()=>Object.values(i).reduce(((t,n)=>{const{id:i,parents:r=[],type:o,meta:a}=n;return o===h.dW&&e!==(null==a?void 0:a.chartId)?[...new Set([...t,...r,i])]:t}),[])),[i,e]);return(0,o.useMemo)((()=>{Yi(i[D._4],s,i,a,d,t,n)}),[i,s,a,t,n]),{treeData:[s],layout:i}}(a,s,er),[f,m]=(0,o.useState)(!0),g=(0,o.useMemo)((()=>((e,t)=>{const n=[];return Ji(n,t,[...e.rootPath],[...e.excluded]),[...new Set(n)]})({...e||t},p)),[e,t,p]);return(0,v.tZ)(Ze.mp,{checkable:!0,selectable:!1,onExpand:e=>{c(e),m(!1)},expandedKeys:d,autoExpandParent:f,onCheck:e=>{n();const t=((e,t)=>{if(!e.length)return{rootPath:[],excluded:[]};const n=e.filter((e=>{var n;return(null==(n=t[e])?void 0:n.type)===h.dW})).map((e=>{var n;return[D._4,...(null==(n=t[e])?void 0:n.parents)||[]].filter((e=>Gi(t[e])))}));n.sort(((e,t)=>e.length-t.length));const i=n.map((e=>e[n[0].length-1])),r=[];return Object.entries(t).forEach((([t,n])=>{var o;const a=n.parents||[];n.type===h.dW&&null!=(o=[D._4,...a])&&o.find((n=>((t,n)=>i.includes(t)&&!e.includes(n))(n,t)))&&r.push(n.meta.chartId)})),{rootPath:[...new Set(i)],excluded:r}})(e,p);void 0!==a&&(t.excluded=[...new Set([...t.excluded,a])]),i({scope:t})},checkedKeys:g,treeData:u})},nr=g.iK.div`
  display: flex;
  flex-direction: column;
  & > * {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
  padding: 0px ${({theme:e})=>4*e.gridUnit}px;
`,ir=(0,g.iK)(Ze.qz.Item)`
  margin-bottom: 0;
`,rr=({pathToFormValue:e=[],formScopingType:t,formFilterScope:n,forceUpdate:i,filterScope:r,updateFormValues:a,chartId:s,initiallyExcludedCharts:d})=>{const[c]=(0,o.useState)(r||Qi(s,d)),[u]=(0,o.useState)(Xi(c,s)?zi.all:zi.specific),[h,p]=(0,o.useState)(!!r),f=(0,o.useCallback)((e=>{a(e),p(!0)}),[a]),m=(0,o.useCallback)((()=>{if(r||h)return;const e=Qi(s,d);a({scope:e,scoping:Xi(e,s)?zi.all:zi.specific})}),[s,r,h,d,a]);return(0,Hi.d)(m),(0,v.tZ)(nr,null,(0,v.tZ)(ir,{name:[...e,"scoping"],initialValue:u},(0,v.tZ)(Pt.Y.Group,{onChange:({target:{value:e}})=>{if(e===zi.all){const e=Qi(s);a({scope:e})}p(!0),i()}},(0,v.tZ)(Pt.Y,{value:zi.all},(0,l.t)("Apply to all panels")),(0,v.tZ)(Pt.Y,{value:zi.specific},(0,l.t)("Apply to specific panels")))),(0,v.tZ)(Ze.ZT.Text,{type:"secondary"},(null!=t?t:u)===zi.specific?(0,l.t)("Only selected panels will be affected by this filter"):(0,l.t)("All panels with this column will be affected by this filter")),(null!=t?t:u)===zi.specific&&(0,v.tZ)(tr,{updateFormValues:f,initialScope:c,formScope:n,forceUpdate:i,chartId:s,initiallyExcludedCharts:d}),(0,v.tZ)(ir,{name:[...e,"scope"],hidden:!0,initialValue:c}))};var or=n(10752),ar=n.n(or),sr=n(88889),lr=n(55786);const dr="filters",cr={filter_time:[sr.Z.TEMPORAL],filter_timegrain:[sr.Z.TEMPORAL],filter_timecolumn:[sr.Z.TEMPORAL],filter_select:[sr.Z.BOOLEAN,sr.Z.STRING,sr.Z.NUMERIC,sr.Z.TEMPORAL],filter_range:[sr.Z.NUMERIC]},ur=()=>{const[,e]=o.useState({});return o.useCallback((()=>e({})),[])},hr=(e,t,n)=>{const i=e.getFieldValue(dr)||{};e.setFields([{name:dr,value:{...i,[t]:{...i[t],...n}}}])},pr=e=>({value:e.id,label:e.table_name}),fr=e=>{const t=(0,lr.Z)(null==e?void 0:e.column_types);return 0===t.length||t.includes(sr.Z.TEMPORAL)},mr=(e,t)=>{var n;return!t.type_generic||!(e in cr)||(null==(n=cr[e])?void 0:n.includes(t.type_generic))},gr=({form:e,scope:t,chartId:n})=>{const i=ur(),r=e.getFieldValue("scope"),o=e.getFieldValue("scoping");return(0,v.tZ)(rr,{updateFormValues:t=>{((e,t)=>{e.setFieldsValue({...t})})(e,{...t})},filterScope:t,chartId:n,formFilterScope:r,forceUpdate:i,formScopingType:o})};var vr=n(89734),br=n.n(vr),yr=n(44908),Cr=n.n(yr),Sr=n(68122),xr=n(53350),wr=n(811);const kr=[];function Zr(){return(0,r.v9)((e=>{var t,n;return(null==(t=e.dashboardInfo)||null==(n=t.metadata)?void 0:n.native_filter_configuration)||kr}))}function Rr(){return(0,r.v9)((e=>{var t;return null==(t=e.dashboardLayout)?void 0:t.present}))}function Tr(){const e=Rr();return(0,o.useMemo)((()=>Object.values(e).some((e=>e.type===h.gn))),[e])}var Fr=n(27034),Dr=n(22068);const _r="FILTER",Er=g.iK.div`
  ${({isDragging:e,theme:t})=>`\n    opacity: ${e?.3:1};\n    cursor: ${e?"grabbing":"pointer"};\n    width: 100%;\n    display: flex;\n    padding:  ${t.gridUnit}px;\n  `}
`,Ir=(0,g.iK)(ot.Z.Drag,{shouldForwardProp:e=>"isDragging"!==e})`
  ${({isDragging:e,theme:t})=>`\n    font-size: ${t.typography.sizes.m}px;\n    margin-top: 15px;\n    cursor: ${e?"grabbing":"grab"};\n    padding-left: ${t.gridUnit}px;\n  `}
`;var Mr={name:"82a6rk",styles:"flex:1"};const Or=({index:e,onRearrange:t,filterIds:n,children:i})=>{const r=(0,o.useRef)(null),[{isDragging:a},s]=(0,Fr.c)({item:{filterIds:n,type:_r,index:e},collect:e=>({isDragging:e.isDragging()})}),[,l]=(0,Dr.L)({accept:_r,hover:(n,i)=>{var o;if(!r.current)return;const a=n.index,s=e;if(a===s)return;const l=null==(o=r.current)?void 0:o.getBoundingClientRect(),d=(l.bottom-l.top)/2,c=i.getClientOffset().y-l.top;a<s&&c<d||a>s&&c>d||(t(a,s),n.index=s)}});return s(l(r)),(0,v.tZ)(Er,{ref:r,isDragging:a},(0,v.tZ)(Ir,{isDragging:a,alt:"Move icon",className:"dragIcon"}),(0,v.tZ)("div",{css:Mr},i))},Pr=g.iK.div`
  ${({theme:e})=>`\n      display: flex;\n      align-items: center;\n      padding: ${2*e.gridUnit}px;\n      width: 100%;\n      border-radius: ${e.borderRadius}px;\n      &.active {\n        color: ${e.colors.grayscale.dark1};\n        border-radius: ${e.borderRadius}px;\n        background-color: ${e.colors.secondary.light4};\n        span, .anticon {\n          color: ${e.colors.grayscale.dark1};\n        }\n      }\n      &:hover {\n        color: ${e.colors.primary.light1};\n        span, .anticon {\n          color: ${e.colors.primary.light1};\n        }\n      }\n      &.errored div, &.errored .warning {\n        color: ${e.colors.error.base};\n      }\n  `}
`,Nr=(0,g.iK)(ot.Z.Trash)`
  color: ${({theme:e})=>e.colors.grayscale.light3};
`,jr=(0,g.iK)(ot.Z.Warning)`
  color: ${({theme:e})=>e.colors.error.base};
  &.anticon {
    margin-left: auto;
  }
`,qr=g.iK.div`
  height: 100%;
  overflow-y: auto;
`;var zr={name:"7whenc",styles:"display:flex;width:100%"},Ar={name:"1vr7vmn",styles:"align-items:center;display:flex"},$r={name:"1je5tt7",styles:"align-self:flex-end;margin-left:auto"},Ur={name:"an0ls6",styles:"align-self:flex-start;margin-left:auto"};const Lr=(0,o.forwardRef)((({getFilterTitle:e,onChange:t,onRemove:n,restoreFilter:i,onRearrange:r,currentFilterId:o,removedFilters:a,filters:s,erroredFilters:d=[]},c)=>(0,v.tZ)(qr,{ref:c},(()=>{const c=[];return s.forEach(((s,u)=>{c.push((0,v.tZ)(Or,{key:u,onRearrange:r,index:u,filterIds:[s]},(r=>{const s=!!a[r],c=d.includes(r),u=o===r,h=[];return c&&h.push("errored"),u&&h.push("active"),(0,v.tZ)(Pr,{role:"tab",key:`filter-title-tab-${r}`,onClick:()=>t(r),className:h.join(" ")},(0,v.tZ)("div",{css:zr},(0,v.tZ)("div",{css:Ar},s?(0,l.t)("(Removed)"):e(r)),!a[r]&&c&&(0,v.tZ)(jr,{className:"warning"}),s&&(0,v.tZ)("span",{css:$r,role:"button",tabIndex:0,onClick:e=>{e.preventDefault(),i(r)}},(0,l.t)("Undo?"))),(0,v.tZ)("div",{css:Ur},s?null:(0,v.tZ)(Nr,{onClick:e=>{e.stopPropagation(),n(r)},alt:"RemoveFilter"})))})(s)))})),c})()))),Vr=g.iK.div`
  ${({theme:e})=>`\n  cursor: pointer;\n  margin: ${4*e.gridUnit}px;\n  color: ${e.colors.primary.base};\n  &:hover {\n    color: ${e.colors.primary.dark1};\n  }\n`}
`,Kr=g.iK.div`
  height: 100%;
  display: flex;
  flex-direction: column;
`,Br=[{label:"Filter",type:wr.BE.NATIVE_FILTER},{label:"Divider",type:wr.BE.DIVIDER}],Wr=({getFilterTitle:e,onChange:t,onAdd:n,onRemove:i,onRearrange:r,restoreFilter:a,currentFilterId:s,filters:d,removedFilters:c,erroredFilters:u})=>{const h=(0,o.useRef)(null),p=(0,g.Fg)(),f=(0,v.tZ)(ut.$,{mode:"horizontal"},Br.map((e=>(0,v.tZ)(ut.$.Item,{onClick:()=>{return t=e.type,n(t),void setTimeout((()=>{var e;const t=document.getElementById("native-filters-tabs");if(t){const e=t.getElementsByClassName("ant-tabs-nav-list")[0];e.scrollTop=e.scrollHeight}null==h||null==(e=h.current)||null==e.scroll||e.scroll({top:h.current.scrollHeight,behavior:"smooth"})}),0);var t}},e.label))));return(0,v.tZ)(Kr,null,(0,v.tZ)(Ze.Gj,{overlay:f,arrow:!0,placement:"topLeft",trigger:["hover"]},(0,v.tZ)(Vr,null,(0,v.tZ)("div",{className:"fa fa-plus"})," ",(0,v.tZ)("span",null,(0,l.t)("Add filters and dividers")))),(0,v.tZ)("div",{css:(0,v.iv)({height:"100%",overflowY:"auto",marginLeft:3*p.gridUnit},"","")},(0,v.tZ)(Lr,{ref:h,filters:d,currentFilterId:s,removedFilters:c,getFilterTitle:e,erroredFilters:u,onChange:t,onRemove:i,onRearrange:r,restoreFilter:a})))},Hr=g.iK.div`
  display: flex;
  height: 100%;
`,Gr=g.iK.div`
  flex-grow: 3;
  margin-left: ${({theme:e})=>-1*e.gridUnit-1};
`,Yr=g.iK.div`
  width: 270px;
  border-right: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
`,Jr=({getFilterTitle:e,onChange:t,onRemove:n,onRearrange:i,restoreFilter:r,onAdd:o,erroredFilters:a,children:s,currentFilterId:l,filters:d,removedFilters:c})=>{const u=d.filter((e=>e===l))[0];return(0,v.tZ)(Hr,null,(0,v.tZ)(Yr,null,(0,v.tZ)(Wr,{currentFilterId:l,filters:d,removedFilters:c,erroredFilters:a,getFilterTitle:e,onChange:t,onAdd:e=>o(e),onRearrange:i,onRemove:e=>n(e),restoreFilter:r})),(0,v.tZ)(Gr,null,d.map((e=>(0,v.tZ)("div",{key:e,style:{height:"100%",overflowY:"auto",display:e===u?"":"none"}},s(e))))))};var Qr=n(43700);const Xr=g.iK.div`
  display: flex;
  flex-direction: row;
  background-color: ${({level:e,theme:t})=>t.colors[e].light2};
  border-radius: ${({theme:e})=>e.borderRadius}px;
  border: 1px solid ${({level:e,theme:t})=>t.colors[e].base};
  color: ${({level:e,theme:t})=>t.colors[e].dark2};
  padding: ${({theme:e})=>2*e.gridUnit}px;
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
  width: 100%;
`,eo=g.iK.div`
  display: flex;
  flex-direction: column;
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
`,to=g.iK.span`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
`;function no({body:e,level:t="error",title:n}){const i=(0,g.Fg)().colors[t].base;return(0,v.tZ)(Xr,{level:t,role:"alert"},"error"===t?(0,v.tZ)(ot.Z.ErrorSolid,{iconColor:i}):(0,v.tZ)(ot.Z.WarningSolid,{iconColor:i}),(0,v.tZ)(eo,null,(0,v.tZ)(to,null,n),(0,v.tZ)("p",null,e)))}var io=n(73375),ro=n(46566),oo=n(77997);const ao=(e,t,n=((...e)=>JSON.stringify([...e])))=>(...i)=>{const r=n(...i);if(t.has(r))return t.get(r);const o=e(...i);return t.set(r,o),o};var so=n(78676);const lo=g.iK.div`
  width: 100%;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  min-height: ${({theme:e})=>10*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit+2}px;

  .checkbox {
    margin-bottom: ${({theme:e,checked:t})=>t?e.gridUnit:0}px;
  }

  & > div {
    margin-bottom: ${({theme:e})=>2*e.gridUnit}px;
  }
`,co=g.iK.div`
  margin-left: ${({theme:e})=>6*e.gridUnit}px;
`,uo=e=>{const{checked:t,disabled:n,title:i,tooltip:r,children:a,onChange:s=(()=>{}),initialValue:l=!1}=e,[d,c]=(0,o.useState)(l);return(0,o.useEffect)((()=>{void 0!==t&&c(t)}),[t]),(0,v.tZ)(lo,{checked:d},(0,v.tZ)(Ze.r4,{className:"checkbox",checked:d,disabled:n,onChange:e=>{const n=e.target.checked;void 0===t&&c(n),s(n)}},(0,v.tZ)(o.Fragment,null,i,"",r&&(0,v.tZ)(di.V,{placement:"top",tooltip:r}))),d&&(0,v.tZ)(co,null,a))};var ho=n(28615),po=n(98286);const fo=new Map,mo=ao(ct.Z.get,fo,(({endpoint:e})=>e||""));function go({allowClear:e=!1,filterValues:t=(()=>!0),form:n,formField:i="column",filterId:r,datasetId:a,value:s,onChange:d,mode:c}){var u;const[h,p]=(0,o.useState)(),{addDangerToast:f}=(0,ui.e1)(),m=(0,o.useCallback)((()=>{n.setFields([{name:["filters",r,i],touched:!1,value:null}])}),[n,r,i]),g=(0,o.useMemo)((()=>(0,lr.Z)(h).filter(t).map((e=>e.column_name)).map((e=>({label:e,value:e})))),[h,t]),b=null==(u=n.getFieldValue("filters"))?void 0:u[r].filterType,y=(0,o.useMemo)((()=>null==h?void 0:h.find((e=>e.column_name===s))),[h,s]);return(0,o.useEffect)((()=>{y&&!mr(b,y)&&m()}),[y,b,m]),(0,ho.S)(a,(e=>{null!=e&&m(),null!=a&&mo({endpoint:`/api/v1/dataset/${a}`}).then((({json:{result:e}})=>{const t=Array.isArray(s)?s:[s];e.columns.some((e=>null==t?void 0:t.includes(e.column_name)))||m(),p(e.columns)}),(async e=>{const{error:t,message:n}=await(0,po.O)(e);let i=n||t||(0,l.t)("An error has occurred");"Forbidden"===n&&(i=(0,l.t)("You do not have permission to edit this dashboard")),f(i)}))})),(0,v.tZ)(Ze.Ph,{mode:c,value:"multiple"===c?s||[]:s,ariaLabel:(0,l.t)("Column select"),onChange:d,options:g,placeholder:(0,l.t)("Select a column"),notFoundContent:(0,l.t)("No compatible columns found"),showSearch:!0,allowClear:e})}var vo=n(15926),bo=n.n(vo);const yo=new Map,Co=ao(ct.Z.get,yo,(({endpoint:e})=>e||"")),So=({onChange:e,value:t})=>{const n=(0,o.useCallback)((({error:e,message:t})=>{let n=t||e||(0,l.t)("An error has occurred");return"Forbidden"===t&&(n=(0,l.t)("You do not have permission to edit this dashboard")),n}),[]);return(0,v.tZ)(Ze.Ph,{ariaLabel:(0,l.t)("Dataset"),value:t,options:async(e,t,i)=>{const r="table_name",o=bo().encode({filters:[{col:r,opr:"ct",value:e}],page:t,page_size:i,order_column:r,order_direction:"asc"});return Co({endpoint:`/api/v1/dataset/?q=${o}`}).then((e=>({data:e.json.result.map(pr),totalCount:e.json.count}))).catch((async e=>{const t=n(await(0,po.O)(e));throw new Error(t)}))},onChange:e})},xo=e=>(0,o.useMemo)((()=>(0,v.tZ)(So,e)),[]);var wo=n(88274);const ko=({hasDefaultValue:e,filterId:t,hasDataset:n,form:i,setDataMask:r,formData:o,enableNoResults:a})=>{var s,d,c;const h=(i.getFieldValue("filters")||{})[t],p=null==h?void 0:h.defaultValueQueriesData,f=n&&null===p,m=null==(s=h.defaultDataMask)||null==(d=s.filterState)?void 0:d.value,g=e&&null==m;return f?(0,v.tZ)(u.Z,{position:"inline-centered"}):(0,v.tZ)(wo.Z,{height:32,width:"filter_time"===(null==h?void 0:h.filterType)?350:250,appSection:Wi.Tr.FILTER_CONFIG_MODAL,behaviors:[Wi.cg.NATIVE_FILTER],formData:o,queriesData:n?null==h?void 0:h.defaultValueQueriesData:[{data:[{}]}],chartType:null==h?void 0:h.filterType,hooks:{setDataMask:r},enableNoResults:a,filterState:{...null==(c=h.defaultDataMask)?void 0:c.filterState,validateMessage:g&&(0,l.t)("Value is required"),validateStatus:g&&"error"}})};var Zo=n(37687);const Ro=(0,g.iK)(Dt.xJ)`
  margin-bottom: 0;
`;const To=g.iK.div`
  display: flex;
  flex-direction: column;
  height: 400px; // arbitrary
  text-align: center;
  justify-content: center;
  align-items: center;
  color: ${({theme:e})=>e.colors.grayscale.base};
`,Fo=({onClick:e})=>(0,v.tZ)(To,null,(0,v.tZ)("p",null,(0,l.t)("You have removed this filter.")),(0,v.tZ)("div",null,(0,v.tZ)(at.Z,{buttonStyle:"primary",onClick:e},(0,l.t)("Restore Filter")))),Do=g.iK.div`
  display: flex;
  flex-direction: column;
`,_o=g.iK.div`
  ${({theme:e})=>`\n    display: inline-flex;\n    flex-direction: row;\n    align-items: center;\n    cursor: pointer;\n    color: ${e.colors.primary.base};\n    &:hover {\n      color: ${e.colors.primary.dark1};\n    }\n  `}
`,Eo=(0,g.iK)(ot.Z.Trash)`
  ${({theme:e})=>`\n    cursor: pointer;\n    margin-left: ${2*e.gridUnit}px;\n    color: ${e.colors.grayscale.base};\n    &:hover {\n      color: ${e.colors.grayscale.dark1};\n    }\n  `}
`,Io=g.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    width: 220px;\n    flex-direction: row;\n    align-items: center;\n    margin-bottom: ${e.gridUnit}px;\n  `}
`,Mo=g.iK.div`
  text-transform: uppercase;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.base};
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
`,Oo=({availableFilters:e,selection:t,onChange:n,onDelete:i})=>{let r=e.find((e=>e.value===t)),o=e;return r||(r={label:(0,l.t)("(deleted or invalid type)"),value:t},o=[r,...o]),(0,v.tZ)(Io,null,(0,v.tZ)(Ze.Ph,{ariaLabel:(0,l.t)("Limit type"),labelInValue:!0,options:o,onChange:e=>n(t,e.value),value:r}),(0,v.tZ)(Eo,{iconSize:"xl",onClick:()=>i(t)}))},Po=({availableFilters:e=[],dependencies:t=[],onDependenciesChange:n})=>{const[i,r]=(0,o.useState)(t),a=e=>{r(e),n(e)},s=(e,t)=>{const n=i.findIndex((t=>t===e)),r=[...i];r[n]=t,a(r)},d=e=>{const t=[...i];t.splice(i.indexOf(e),1),a(t)};return 0===e.length?(0,v.tZ)("span",null,(0,l.t)("No available filters.")):(0,v.tZ)(o.Fragment,null,i.map((t=>(0,v.tZ)(Oo,{key:t,selection:t,availableFilters:e.filter((e=>e.value===t||!i.includes(e.value))),onChange:s,onDelete:d}))),e.length>i.length&&(0,v.tZ)(_o,{onClick:()=>{const t=e.find((e=>!i.includes(e.value)));if(t){const e=[...i];e.push(t.value),a(e)}}},(0,v.tZ)(ot.Z.PlusSmall,null),(0,l.t)("Add filter")))},No=({availableFilters:e=[],dependencies:t=[],onDependenciesChange:n,getDependencySuggestion:i})=>{const r=e.length>0,o=t.length>0;return(0,v.tZ)(Do,null,(0,v.tZ)(uo,{title:(0,l.t)("Values are dependent on other filters"),initialValue:o,onChange:e=>{const t=[];e&&!o&&r&&t.push(i()),n(t)},tooltip:(0,l.t)("Values selected in other filters will affect the filter options to only show relevant values")},o&&(0,v.tZ)(Mo,null,(0,l.t)("Values dependent on")),(0,v.tZ)(Po,{availableFilters:e,dependencies:t,onDependenciesChange:n,getDependencySuggestion:i})))},jo=(0,g.iK)(y.ZP.TabPane)`
  padding: ${({theme:e})=>4*e.gridUnit}px 0px;
`,qo=g.iK.div`
  ${({theme:e})=>`\n    display: flex;\n    flex-direction: row-reverse;\n    justify-content: space-between;\n    padding: 0px ${4*e.gridUnit}px;\n  `}
`,zo=g.iK.div`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  width: 100%;
  padding: 0px ${({theme:e})=>4*e.gridUnit}px;
`,Ao=["enableEmptyFilter","defaultToFirstItem","multiSelect","searchAllOptions","inverseSelection"],$o=(0,g.iK)(Dt.xJ)`
  width: 49%;
  margin-bottom: ${({theme:e})=>4*e.gridUnit}px;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,Uo=(0,g.iK)(Dt.xJ)`
  margin-bottom: 0;
  padding-bottom: 0;
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  & .ant-form-item-control-input {
    min-height: ${({theme:e})=>10*e.gridUnit}px;
  }
`,Lo=(0,g.iK)(Dt.xJ)`
  min-width: 50%;

  & .ant-form-item-label {
    padding-bottom: 0;
  }

  .ant-form-item {
    margin-bottom: 0;
  }

  .ant-form-item-control-input-content > div > div {
    height: auto;
  }

  .ant-form-item-extra {
    display: none;
  }

  & .ant-form-item-control-input {
    height: auto;
  }
`,Vo=g.iK.span`
  color: ${({theme:e})=>e.colors.grayscale.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  text-transform: uppercase;
`,Ko=(0,g.iK)(Dt.xJ)`
  margin-bottom: 0;
`,Bo=g.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
`,Wo=(0,g.iK)(ot.Z.Refresh)`
  margin-left: ${({theme:e})=>2*e.gridUnit}px;
  color: ${({theme:e})=>e.colors.primary.base};
`,Ho=(0,g.iK)(Qr.Z)`
  border-left: 0;
  border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  border-radius: 0;

  .ant-collapse-header {
    border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    border-top: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
    margin-top: -1px;
    border-radius: 0;
  }

  .ant-collapse-content {
    border: 0;
  }

  .ant-collapse-content-box {
    padding-top: ${({theme:e})=>2*e.gridUnit}px;
  }

  &.ant-collapse > .ant-collapse-item {
    border: 0;
    border-radius: 0;
  }
`,Go=(0,g.iK)(y.ZP)`
  .ant-tabs-nav {
    position: sticky;
    top: 0;
    background: white;
    z-index: 1;
  }

  .ant-tabs-nav-list {
    padding: 0;
  }

  .ant-form-item-label {
    padding-bottom: 0;
  }
`,Yo=g.iK.span`
  color: ${({theme:e})=>e.colors.error.base};
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  margin-left: ${({theme:e})=>e.gridUnit-1}px;
  &:before {
    content: '*';
  }
`,Jo={configuration:{key:"configuration",name:(0,l.t)("Settings")},scoping:{key:"scoping",name:(0,l.t)("Scoping")}},Qo={configuration:{key:"configuration",name:(0,l.t)("Filter Configuration")},settings:{key:"settings",name:(0,l.t)("Filter Settings")}},Xo=["filter_select","filter_range"],ea={[(0,l.t)("Select filter")]:(0,l.t)("Value"),[(0,l.t)("Range filter")]:(0,l.t)("Numerical range"),[(0,l.t)("Time filter")]:(0,l.t)("Time range"),[(0,l.t)("Time column")]:(0,l.t)("Time column"),[(0,l.t)("Time grain")]:(0,l.t)("Time grain"),[(0,l.t)("Group By")]:(0,l.t)("Group by")},ta=new Map,na=ao(ct.Z.get,ta,(({endpoint:e})=>e||"")),ia=({filterId:e,filterToEdit:t,removedFilters:n,form:i,getAvailableFilters:a,activeFilterPanelKeys:s,restoreFilter:c,handleActiveFilterPanelChange:h,setErroredFilters:p,validateDependencies:f,getDependencySuggestion:m},g)=>{var b,y,C,S,x,w,k,Z,R,T,F,D,_,E,I,M,O,P,N,j,q,z,A,$;const U=!!n[e],[L,V]=(0,o.useState)(""),[K,B]=(0,o.useState)([]),[W,H]=(0,o.useState)(Jo.configuration.key),[G,Y]=(0,o.useState)(null),J=ur(),[Q,X]=(0,o.useState)(),ee=(0,o.useMemo)((()=>({})),[]),te=i.getFieldValue("filters"),ne=null==te?void 0:te[e],ie=ne||G||ee,re=(null==ie?void 0:ie.dependencies)||(null==t?void 0:t.cascadeParentIds),oe=(0,Bi.Z)().items,ae=Object.entries(oe).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(Wi.cg.NATIVE_FILTER)})).map((([e])=>e)),se=(0,r.v9)((({datasources:e})=>e)),le=(0,r.v9)((({charts:e})=>e)),de=(0,o.useMemo)((()=>Object.values(se).some((e=>fr(e)))),[se]),ce=(0,o.useMemo)((()=>{const e=Object.values(se).find((e=>{var t;return e.id===(null==ie||null==(t=ie.dataset)?void 0:t.value)}));return!e||fr(e)}),[null==ie||null==(b=ie.dataset)?void 0:b.value,se]),ue=!(null==(y=oe[null==ie?void 0:ie.filterType])||null==(C=y.value)||!C.datasourceCount),he=null!=(S=null!=(x=null==ie||null==(w=ie.dataset)?void 0:w.value)?x:null==t||null==(k=t.targets[0])?void 0:k.datasetId)?S:((e,t)=>{var n;const i=new Map;let r="",o=0;return Object.values(t).forEach((e=>{const{formData:t}=e;if(t){const{datasource:e}=t,n=(i.get(e)||0)+1;i.set(e,n),n>o&&(o=n,r=e)}})),null==(n=e[r])?void 0:n.id})(se,le),{controlItems:pe={},mainControlItems:fe={}}=ie?function({datasetId:e,disabled:t,forceUpdate:n,form:i,filterId:r,filterType:a,filterToEdit:s,formFilter:d,removed:c}){var u;const h=null!=(u=((e={})=>{var t,n;return null!=(t=null==(n=ar()(e.controlPanelSections))?void 0:n.reduce(((e,{controlSetRows:t=[]})=>[...e,...ar()(t)]),[]))?t:[]})((0,Zo.Z)().get(a)))?u:[],p={},f={};return h.filter((e=>"groupby"===(null==e?void 0:e.name))).forEach((t=>{var a,u,h,p,m,g,b,y,C;const S=null!=(a=null==s||null==(u=s.controlValues)?void 0:u[t.name])?a:null==t||null==(h=t.config)?void 0:h.default,x=null==s||null==(p=s.targets[0])||null==(m=p.column)?void 0:m.name,w=(0,v.tZ)(o.Fragment,null,(0,v.tZ)(Ro,{name:["filters",r,"requiredFirst",t.name],hidden:!0,initialValue:(null==t||null==(g=t.config)?void 0:g.requiredFirst)&&(null==s?void 0:s.requiredFirst)}),(0,v.tZ)($o,{name:["filters",r,"column"],initialValue:x,label:(0,v.tZ)(Vo,null,(null==(b=t.config)?void 0:b.label)||(0,l.t)("Column")),rules:[{required:(null==(y=t.config)?void 0:y.required)&&!c,message:(0,l.t)("Column is required")}]},(0,v.tZ)(go,{mode:(null==(C=t.config)?void 0:C.multiple)&&"multiple",form:i,filterId:r,datasetId:e,filterValues:e=>mr((null==d?void 0:d.filterType)||"",e),onChange:()=>{hr(i,r,{defaultDataMask:null}),n()}})));f[t.name]={element:w,checked:S}})),h.filter((e=>{var t;return(null==e||null==(t=e.config)?void 0:t.renderTrigger)&&"sortAscending"!==e.name&&"enableSingleValue"!==e.name})).forEach((e=>{var a,c,u,h;const f=null!=(a=null==s||null==(c=s.controlValues)?void 0:c[e.name])?a:null==e||null==(u=e.config)?void 0:u.default,m=(0,v.tZ)(o.Fragment,null,(0,v.tZ)(Ro,{name:["filters",r,"requiredFirst",e.name],hidden:!0,initialValue:(null==e||null==(h=e.config)?void 0:h.requiredFirst)&&(null==s?void 0:s.requiredFirst)}),(0,v.tZ)(Wn.u,{key:e.name,placement:"left",title:e.config.affectsDataMask&&t&&(0,l.t)('Populate "Default value" to enable this control')},(0,v.tZ)(Uo,{key:e.name,name:["filters",r,"controlValues",e.name],initialValue:f,valuePropName:"checked",colon:!1},(0,v.tZ)(Ze.r4,{disabled:e.config.affectsDataMask&&t,onChange:({target:{checked:t}})=>{e.config.requiredFirst&&hr(i,r,{requiredFirst:{...null==d?void 0:d.requiredFirst,[e.name]:t}}),e.config.resetConfig&&hr(i,r,{defaultDataMask:null}),n()}},e.config.label,"",e.config.description&&(0,v.tZ)(di.V,{placement:"top",label:e.config.name,tooltip:e.config.description})))));p[e.name]={element:m,checked:f}})),{controlItems:p,mainControlItems:f}}({datasetId:he,disabled:!1,forceUpdate:J,form:i,filterId:e,filterType:null==ie?void 0:ie.filterType,filterToEdit:t,formFilter:ie,removed:U}):{},me=!!fe.groupby,ge=!(null==(R=(null!=(Z=oe[null==ie?void 0:ie.filterType])?Z:{}).value)||!R.enableNoResults),ve=me&&!!K.length,be=!ue||he&&((null==ie?void 0:ie.column)||!me),ye=Xo.includes(null==ie?void 0:ie.filterType),Ce=va.includes(null==ie?void 0:ie.filterType),Se=null==(T=null==ie?void 0:ie.isDataDirty)||T,xe=t=>{hr(i,e,t),V(""),J()};let we={};re&&re.length>0&&te&&re.forEach((e=>{var t,n;const i=null==(t=te[e])||null==(n=t.defaultDataMask)?void 0:n.extraFormData;we=(0,Ei.on)(we,i)}));const Re=JSON.stringify(we),Te=(0,o.useCallback)(((t=!1)=>{var n,r;if(!ue||null==ie||null==(n=ie.dataset)||!n.value)return void J();const o=(0,Ei.zi)({datasetId:null==ie||null==(r=ie.dataset)?void 0:r.value,groupby:null==ie?void 0:ie.column,...ie});o.extra_form_data=we,xe({defaultValueQueriesData:null,isDataDirty:!1}),(0,_i.getChartDataRequest)({formData:o,force:t,requestParams:{dashboardId:0}}).then((({response:e,json:t})=>{if((0,rt.cr)(d.T.GLOBAL_ASYNC_QUERIES)){const n="result"in t?t.result[0]:t;if(200===e.status)xe({defaultValueQueriesData:[n]});else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,oo.YJ)(n).then((e=>{xe({defaultValueQueriesData:e})})).catch((e=>{V(e.message||e.error||(0,l.t)("Check configuration"))}))}}else xe({defaultValueQueriesData:t.result})})).catch((t=>{t.json().then((n=>{(t=>{hr(i,e,{defaultValueQueriesData:null}),V(t),J()})(n.message||t.statusText||(0,l.t)("Check configuration"))}))}))}),[e,J,i,ie,ue,Re]);(0,o.useEffect)((()=>Te()),[Re]);const Fe=(0,Ei.zi)({datasetId:he,groupby:me?null==ie?void 0:ie.column:void 0,...ie});Fe.extra_form_data=we;const[De,_e,Ee,Ie]=((e,t)=>{var n,i;const r=!(null==e||null==(n=e.controlValues)||!n.enableEmptyFilter),a=!(null==e||null==(i=e.controlValues)||!i.defaultToFirstItem),[s,d]=(0,o.useState)(!1),[c,u]=(0,o.useState)(r),[h,p]=(0,o.useState)(""),f=(e=!1)=>{const t=r&&!a;u(t),d(!!t||e)};return(0,o.useEffect)((()=>{var t,n;f(!a&&!(null==e||null==(t=e.defaultDataMask)||null==(n=t.filterState)||!n.value))}),[a,r]),(0,o.useEffect)((()=>{var e,n;f(!a&&!(null==t||null==(e=t.defaultDataMask)||null==(n=e.filterState)||!n.value))}),[]),(0,o.useEffect)((()=>{let e="";a?e=(0,l.t)('Default value set automatically when "Select first filter value by default" is checked'):c?e=(0,l.t)('Default value must be set when "Filter value is required" is checked'):s&&(e=(0,l.t)('Default value must be set when "Filter has default value" is checked')),p(e)}),[s,c,a]),[s,c,h,f]})(ie,t),Me=!he||Q||(null==ie||null==(F=ie.dataset)?void 0:F.label),Oe=(0,o.useCallback)((()=>{i.setFields([{name:"changed",value:!0}])}),[i]),Pe=(0,o.useCallback)((t=>{hr(i,e,t),Oe()}),[e,i,Oe]),Ne=!!(null!=ie&&ie.adhoc_filters||null!=ie&&ie.time_range||null!=t&&null!=(D=t.adhoc_filters)&&D.length||null!=t&&t.time_range),je=void 0!==(null==ie||null==(_=ie.controlValues)?void 0:_.enableSingleValue)||void 0!==(null==t||null==(E=t.controlValues)?void 0:E.enableSingleValue);let qe=null==t||null==(I=t.controlValues)?void 0:I.enableSingleValue;void 0!==(null==ie||null==(M=ie.controlValues)?void 0:M.enableSingleMaxValue)&&({enableSingleValue:qe}=ie.controlValues);const ze="boolean"==typeof(null==ie||null==(O=ie.controlValues)?void 0:O.sortAscending)||"boolean"==typeof(null==t||null==(P=t.controlValues)?void 0:P.sortAscending);let Ae=null==t||null==(N=t.controlValues)?void 0:N.sortAscending;"boolean"==typeof(null==ie||null==(j=ie.controlValues)?void 0:j.sortAscending)&&(Ae=ie.controlValues.sortAscending);const $e=!ue||!Se&&be||!fe.groupby,Ue=t=>{var n;const r=null==(n=i.getFieldValue("filters"))?void 0:n[e].controlValues;hr(i,e,{controlValues:{...r,sortAscending:t}}),J()},Le=t=>{var n;const r=null==(n=i.getFieldValue("filters"))?void 0:n[e].controlValues;hr(i,e,{controlValues:{...r,enableSingleValue:t}}),J()},Ve=()=>setTimeout((()=>i.validateFields([["filters",e,"adhoc_filters"],["filters",e,"time_range"]])),0),Ke=(null==ie?void 0:ie.time_range)&&"No filter"!==ie.time_range,Be=(null==ie||null==(q=ie.adhoc_filters)?void 0:q.length)>0,We=null==ie||null==(z=ie.controlValues)?void 0:z.defaultToFirstItem,He=(null==ie?void 0:ie.filterType)===(null==t?void 0:t.filterType)?null==t?void 0:t.defaultDataMask:null,Ge=()=>Ke||Be?Promise.resolve():Promise.reject(new Error((0,l.t)("Pre-filter is required"))),Ye=a(e),Je=Ye.length>0;(0,o.useEffect)((()=>{he&&na({endpoint:`/api/v1/dataset/${he}`}).then((e=>{var t,n,i;B(null==(t=e.json)||null==(n=t.result)?void 0:n.metrics);const r=null==(i=e.json)?void 0:i.result;r.type=r.datasource_type,r.filter_select=!0,X(r)})).catch((e=>{(0,wi.Gb)(e.message)}))}),[he]),(0,o.useImperativeHandle)(g,(()=>({changeTab(e){H(e)}}))),((e,t)=>{var n;const i=ur(),r=(e.getFieldValue("filters")||{})[t];(0,o.useEffect)((()=>{hr(e,t,{isDataDirty:!0,defaultValueQueriesData:null}),i()}),[e,null==r?void 0:r.filterType,null==r?void 0:r.column,null==r||null==(n=r.dataset)?void 0:n.value,JSON.stringify(null==r?void 0:r.adhoc_filters),null==r?void 0:r.time_range,i,t])})(i,e),(0,o.useEffect)((()=>{ue&&be&&De&&Se&&Te()}),[ue,be,De,Se,Te,Me]);const Qe=(0,o.useMemo)((()=>{var e;const t=[];return void 0===(null==ie||null==(e=ie.dataset)?void 0:e.value)?[]:(Object.values(le).forEach((e=>{var n,i,r;const o=null==(n=e.formData)?void 0:n.datasource;void 0!==o&&(null==(i=se[o])?void 0:i.id)!==(null==ie||null==(r=ie.dataset)?void 0:r.value)&&t.push(e.id)})),t)}),[JSON.stringify(le),null==ie||null==(A=ie.dataset)?void 0:A.value,JSON.stringify(se)]);return(0,o.useEffect)((()=>{U&&Y(ne)}),[U]),(0,o.useEffect)((()=>{G&&!U&&(hr(i,e,G),Y(null))}),[ne,e,i,U,G]),U?(0,v.tZ)(Fo,{onClick:()=>c(e)}):(0,v.tZ)(Go,{activeKey:W,onChange:e=>H(e),centered:!0},(0,v.tZ)(jo,{tab:Jo.configuration.name,key:Jo.configuration.key,forceRender:!0},(0,v.tZ)(qo,null,(0,v.tZ)($o,{name:["filters",e,"type"],hidden:!0,initialValue:wr.BE.NATIVE_FILTER},(0,v.tZ)(ke.II,null)),(0,v.tZ)($o,{name:["filters",e,"name"],label:(0,v.tZ)(Vo,null,(0,l.t)("Filter name")),initialValue:null==t?void 0:t.name,rules:[{required:!U,message:(0,l.t)("Name is required")}]},(0,v.tZ)(ke.II,ga("name-input"))),(0,v.tZ)($o,mt()({name:["filters",e,"filterType"],rules:[{required:!U,message:(0,l.t)("Name is required")}],initialValue:(null==t?void 0:t.filterType)||"filter_select",label:(0,v.tZ)(Vo,null,(0,l.t)("Filter Type"))},ga("filter-type")),(0,v.tZ)(Ze.Ph,{ariaLabel:(0,l.t)("Filter type"),options:ae.map((e=>{var t,n,i;const r=null==(t=oe[e])?void 0:t.value.name,o=r?ea[r]:void 0,a=1===(null==(n=cr[e])?void 0:n.length)&&(null==(i=cr[e])?void 0:i.includes(sr.Z.TEMPORAL))&&!de;return{value:e,label:o||r,customLabel:a?(0,v.tZ)(Wn.u,{title:(0,l.t)("Datasets do not contain a temporal column")},o||r):void 0,disabled:a}})),onChange:t=>{hr(i,e,{filterType:t,defaultDataMask:null,column:null}),J()}}))),ue&&(0,v.tZ)(zo,null,Me?(0,v.tZ)($o,mt()({name:["filters",e,"dataset"],label:(0,v.tZ)(Vo,null,(0,l.t)("Dataset")),initialValue:Q?{label:Q.table_name,value:Q.id}:void 0,rules:[{required:!U,message:(0,l.t)("Dataset is required")}]},ga("datasource-input")),(0,v.tZ)(xo,{onChange:t=>{t.value!==he&&hr(i,e,{dataset:t,defaultDataMask:null,column:null}),J()}})):(0,v.tZ)($o,{label:(0,v.tZ)(Vo,null,(0,l.t)("Dataset"))},(0,v.tZ)(u.Z,{position:"inline-centered"})),ue&&Object.keys(fe).map((e=>fe[e].element))),(0,v.tZ)(Ho,{activeKey:s,onChange:e=>{h(e)},expandIconPosition:"right",key:`native-filter-config-${e}`},(0,v.tZ)(Qr.Z.Panel,{forceRender:!0,header:Qo.configuration.name,key:`${e}-${Qo.configuration.key}`},Ce&&Je&&(0,v.tZ)(Uo,{name:["filters",e,"dependencies"],initialValue:re},(0,v.tZ)(No,{availableFilters:Ye,dependencies:re,onDependenciesChange:t=>{hr(i,e,{dependencies:t}),J(),f(),Oe()},getDependencySuggestion:()=>m(e)})),ue&&ye&&(0,v.tZ)(Ko,{name:["filters",e,"preFilter"]},(0,v.tZ)(uo,{initialValue:Ne,title:(0,l.t)("Pre-filter available values"),onChange:e=>{Oe(),e&&Ve()}},(0,v.tZ)(Lo,{name:["filters",e,"adhoc_filters"],initialValue:null==t?void 0:t.adhoc_filters,required:!0,rules:[{validator:Ge}]},(0,v.tZ)(ro.Z,{columns:(null==Q||null==($=Q.columns)?void 0:$.filter((e=>e.filterable)))||[],savedMetrics:(null==Q?void 0:Q.metrics)||[],datasource:Q,onChange:t=>{hr(i,e,{adhoc_filters:t}),J(),Ve()},label:(0,v.tZ)("span",null,(0,v.tZ)(Vo,null,(0,l.t)("Pre-filter")),!Ke&&(0,v.tZ)(Yo,null))})),ce&&(0,v.tZ)(Uo,{name:["filters",e,"time_range"],label:(0,v.tZ)(Vo,null,(0,l.t)("Time range")),initialValue:(null==t?void 0:t.time_range)||"No filter",required:!Be,rules:[{validator:Ge}]},(0,v.tZ)(io.Z,{name:"time_range",endpoints:["inclusive","exclusive"],onChange:t=>{hr(i,e,{time_range:t}),J(),Ve()}})),Ke&&(0,v.tZ)(Uo,{name:["filters",e,"granularity_sqla"],label:(0,v.tZ)(o.Fragment,null,(0,v.tZ)(Vo,null,(0,l.t)("Time column")),"",(0,v.tZ)(di.V,{placement:"top",tooltip:(0,l.t)("Optional time column if time range should apply to another column than the default time column")})),initialValue:null==t?void 0:t.granularity_sqla},(0,v.tZ)(go,{allowClear:!0,form:i,formField:"granularity_sqla",filterId:e,filterValues:e=>!!e.is_dttm,datasetId:he,onChange:t=>{hr(i,e,{granularity_sqla:t}),J()}})))),"filter_range"!==(null==ie?void 0:ie.filterType)?(0,v.tZ)(Ko,{name:["filters",e,"sortFilter"]},(0,v.tZ)(uo,{initialValue:ze,title:(0,l.t)("Sort filter values"),onChange:e=>{Ue(e||void 0),Oe()}},(0,v.tZ)(Uo,{name:["filters",e,"controlValues","sortAscending"],initialValue:Ae,label:(0,v.tZ)(Vo,null,(0,l.t)("Sort type"))},(0,v.tZ)(Pt.Y.Group,{onChange:e=>{Ue(e.target.value)}},(0,v.tZ)(Pt.Y,{value:!0},(0,l.t)("Sort ascending")),(0,v.tZ)(Pt.Y,{value:!1},(0,l.t)("Sort descending")))),ve&&(0,v.tZ)(Lo,{name:["filters",e,"sortMetric"],initialValue:null==t?void 0:t.sortMetric,label:(0,v.tZ)(o.Fragment,null,(0,v.tZ)(Vo,null,(0,l.t)("Sort Metric")),"",(0,v.tZ)(di.V,{placement:"top",tooltip:(0,l.t)("If a metric is specified, sorting will be done based on the metric value")}))},(0,v.tZ)(Ze.Ph,{allowClear:!0,ariaLabel:(0,l.t)("Sort metric"),name:"sortMetric",options:K.map((e=>{var t;return{value:e.metric_name,label:null!=(t=e.verbose_name)?t:e.metric_name}})),onChange:t=>{void 0!==t&&(hr(i,e,{sortMetric:t}),J())}})))):(0,v.tZ)(Ko,{name:["filters",e,"rangeFilter"]},(0,v.tZ)(uo,{initialValue:je,title:(0,l.t)("Single Value"),onChange:e=>{Le(e?so.c.Exact:void 0),Oe()}},(0,v.tZ)(Uo,{name:["filters",e,"controlValues","enableSingleValue"],initialValue:qe,label:(0,v.tZ)(Vo,null,(0,l.t)("Single value type"))},(0,v.tZ)(Pt.Y.Group,{onChange:e=>Le(e.target.value)},(0,v.tZ)(Pt.Y,{value:so.c.Minimum},(0,l.t)("Minimum")),(0,v.tZ)(Pt.Y,{value:so.c.Exact},(0,l.t)("Exact")),(0,v.tZ)(Pt.Y,{value:so.c.Maximum},(0,l.t)("Maximum"))))))),(0,v.tZ)(Qr.Z.Panel,{forceRender:!0,header:Qo.settings.name,key:`${e}-${Qo.settings.key}`},(0,v.tZ)($o,{name:["filters",e,"description"],initialValue:null==t?void 0:t.description,label:(0,v.tZ)(Vo,null,(0,l.t)("Description"))},(0,v.tZ)(ke.Kx,null)),(0,v.tZ)(Ko,{name:["filters",e,"defaultValueQueriesData"],hidden:!0,initialValue:null}),(0,v.tZ)(Ko,{name:["filters",e,"defaultValue"]},(0,v.tZ)(uo,{checked:De,disabled:_e||We,initialValue:De,title:(0,l.t)("Filter has default value"),tooltip:Ee,onChange:t=>{Ie(t),t||hr(i,e,{defaultDataMask:null}),Oe()}},!U&&(0,v.tZ)(Lo,{name:["filters",e,"defaultDataMask"],initialValue:He,label:(0,v.tZ)(Vo,null,(0,l.t)("Default Value")),required:De,rules:[{validator:()=>{var t,n;if(null!=ie&&null!=(t=ie.defaultDataMask)&&null!=(n=t.filterState)&&n.value){const e=i.getFieldsError();return p((t=>t.length&&!e.find((e=>e.errors.length>0))?[]:t)),Promise.resolve()}return p((t=>t.includes(e)?t:[...t,e])),Promise.reject(new Error((0,l.t)("Default value is required")))}}]},L?(0,v.tZ)(no,{title:(0,l.t)("Cannot load filter"),body:L,level:"error"}):$e?(0,v.tZ)(Bo,null,(0,v.tZ)(ko,{setDataMask:t=>{var n,r;$i()(null==He||null==(n=He.filterState)?void 0:n.value,null==t||null==(r=t.filterState)?void 0:r.value)||Oe(),hr(i,e,{defaultDataMask:t}),i.validateFields([["filters",e,"defaultDataMask"]]),J()},hasDefaultValue:De,filterId:e,hasDataset:ue,form:i,formData:Fe,enableNoResults:ge}),ue&&he&&(0,v.tZ)(Wn.u,{title:(0,l.t)("Refresh the default values")},(0,v.tZ)(Wo,{onClick:()=>Te(!0)}))):(0,l.t)('Fill all required fields to enable "Default Value"')))),Object.keys(pe).sort(((e,t)=>Ao.indexOf(e)-Ao.indexOf(t))).map((e=>pe[e].element))))),(0,v.tZ)(jo,{tab:Jo.scoping.name,key:Jo.scoping.key,forceRender:!0},(0,v.tZ)(rr,{updateFormValues:Pe,pathToFormValue:["filters",e],forceUpdate:J,filterScope:null==t?void 0:t.scope,formFilterScope:null==ie?void 0:ie.scope,formScopingType:null==ie?void 0:ie.scoping,initiallyExcludedCharts:Qe})))},ra=(0,o.forwardRef)(ia);var oa={name:"ihui0v",styles:"text-align:left;& .ant-alert-action{align-self:center;}"},aa={name:"zjik7",styles:"display:flex"};function sa({title:e,onConfirm:t,onDismiss:n,children:i}){return(0,v.tZ)(Ft.Z,{closable:!1,type:"warning",key:"alert",message:e,css:oa,description:i,action:(0,v.tZ)("div",{css:aa},(0,v.tZ)(at.Z,{key:"cancel",buttonSize:"small",buttonStyle:"secondary",onClick:n},(0,l.t)("Keep editing")),(0,v.tZ)(at.Z,{key:"submit",buttonSize:"small",buttonStyle:"primary",onClick:t},(0,l.t)("Yes, cancel")))})}const la=({canSave:e=!0,onCancel:t,handleSave:n,onDismiss:i,onConfirmCancel:r,saveAlertVisible:a})=>a?(0,v.tZ)(sa,{key:"cancel-confirm",title:(0,l.t)("There are unsaved changes."),onConfirm:r,onDismiss:i},(0,l.t)("Are you sure you want to cancel?")):(0,v.tZ)(o.Fragment,null,(0,v.tZ)(at.Z,{key:"cancel",buttonStyle:"secondary",onClick:t},(0,l.t)("Cancel")),(0,v.tZ)(at.Z,{disabled:!e,key:"submit",buttonStyle:"primary",onClick:n},(0,l.t)("Save")));var da=n(60812),ca=n(92242);const ua=g.iK.div`
  ${({theme:e})=>`\n    padding: ${4*e.gridUnit}px;\n  `}
`,ha=({componentId:e,divider:t})=>(0,v.tZ)(ua,null,(0,v.tZ)(Dt.xJ,{initialValue:t?t.title:"",label:(0,l.t)("Title"),name:["filters",e,"title"],rules:[{required:!0,message:(0,l.t)("Title is required"),whitespace:!0}]},(0,v.tZ)(ke.II,null)),(0,v.tZ)(Dt.xJ,{initialValue:t?t.description:"",label:(0,l.t)("Description"),name:["filters",e,"description"]},(0,v.tZ)(ke.Kx,{rows:4})),(0,v.tZ)(Dt.xJ,{hidden:!0,name:["filters",e,"type"],initialValue:wr.BE.DIVIDER})),pa=(0,g.iK)(ci.o)`
  min-width: 700px;
  .ant-modal-body {
    padding: 0px;
  }
`,fa=g.iK.div`
  display: flex;
  height: 700px;
  flex-direction: row;
  .filters-list {
    width: ${({theme:e})=>50*e.gridUnit}px;
    overflow: auto;
  }
`,ma=(0,g.iK)(Ze.qz)`
  width: 100%;
`,ga=(0,xr.Q)("filters-config-modal"),va=["filter_select"];function ba({isOpen:e,initialFilterId:t,createNewOnOpen:n,onSave:i,onCancel:r}){const[a]=Ze.qz.useForm(),s=(0,o.useRef)(),d=Zr(),c=function(){const e=Zr();return(0,o.useMemo)((()=>e.reduce(((e,t)=>(e[t.id]=t,e)),{})),[e])}(),[u,h]=(0,o.useState)([]),[p,f]=(0,o.useState)({}),[m,g]=(0,o.useState)(!1),y=(0,o.useMemo)((()=>Cr()([...(0,ca.QN)(d),...u]).filter((e=>{var t;return!p[e]||(null==(t=p[e])?void 0:t.isPending)}))),[d,u,p]),C=null!=t?t:y[0],[S,w]=(0,o.useState)(C),[k,Z]=(0,o.useState)([]),[R,T]=(0,o.useState)({filters:{}}),F=u.filter((e=>!p[e])),D=e=>{const t=p[e];null!=t&&t.isPending&&clearTimeout(t.timerId),f((t=>({...t,[e]:null})))},_=()=>Object.keys(c),[E,I]=(0,o.useState)(_()),M=e=>[`${e}-${Qo.configuration.key}`,`${e}-${Qo.settings.key}`],[O,P]=(0,o.useState)(M(C)),N=(0,o.useCallback)((e=>{const t=(0,ca.W6)(e);h([...u,t]),w(t),g(!1),I([...E,t]),P(M(t))}),[u,E,w,I,h]);((e,t,n)=>{const i=(0,da.D)(e);(0,o.useEffect)((()=>{n&&e&&!i&&t(wr.BE.NATIVE_FILTER)}),[n,e,i,t])})(e,N,n),((e,t,n,i)=>{(0,o.useEffect)((()=>{const r=e[t];if(r&&!r.isPending){const r=n.flat().find((n=>!e[n]&&n!==t));r&&i(r)}}),[t,e,n,i])})(p,S,E,w);const j=(0,ca.EJ)(f,I,g),q=(e=!1)=>{h([]),w(C),f({}),g(!1),T({filters:{}}),Z([]),y.length>0&&P(M(y[0])),e||I(_()),a.resetFields(["filters"]),a.setFieldsValue({changed:!1})},z=(0,o.useCallback)((e=>{const t=R.filters[e],n=c[e];return t&&"name"in t&&t.name||t&&"title"in t&&t.title||n&&"name"in n&&n.name||n&&"title"in n&&n.title||(0,l.t)("[untitled]")}),[c,R.filters]),A=(0,o.useCallback)((e=>{var t;if(p[e])return!1;const n=(null==(t=a.getFieldValue("filters"))?void 0:t[e])||c[e];return n&&"filterType"in n&&va.includes(n.filterType)}),[c,a,p]),$=(0,o.useCallback)((e=>y.filter((t=>t!==e)).filter((e=>A(e))).map((e=>({label:z(e),value:e})))),[A,y,z]),U=(0,o.useCallback)((()=>{const e=a.getFieldsError(),t=[];e.forEach((e=>{const n=e.name[1];e.errors.length>0&&!t.includes(n)&&t.push(n)})),!t.length&&k.length>0?Z([]):t.length>0&&!$i()(br()(k),br()(t))&&Z(t)}),[a,k]),L=async()=>{const e=await(0,ca.G$)(a,S,w);U(),e?((e=>{Object.keys(c).forEach((e=>{const t=c[e];if(!("cascadeParentIds"in t))return;const{cascadeParentIds:n}=t;n&&(t.cascadeParentIds=n.filter((e=>A(e))))}));const t=null==e?void 0:e.filters;t&&Object.keys(t).forEach((e=>{const n=t[e];if(!("dependencies"in n))return;const{dependencies:i}=n;i&&(n.dependencies=i.filter((e=>A(e))))}))})(e),(0,ca.GA)(c,E,p,i,e)(),q(!0)):s.current.changeTab("configuration")},V=()=>{q(),r()},K=()=>{const e=a.getFieldValue("changed"),t=_(),n=E.length!==t.length||E.some(((e,n)=>e!==t[n]));F.length>0||a.isFieldsTouched()||e||n?g(!0):V()},B=(0,o.useCallback)((()=>{const e=new Map,t=a.getFieldValue("filters");return t&&Object.keys(t).forEach((n=>{const i=t[n],r=c[n];let o=[];i&&"dependencies"in i?o=[...i.dependencies]:r&&r.cascadeParentIds&&(o=[...r.cascadeParentIds]),e.set(n,o)})),e}),[c,a]),W=()=>{const e=B();y.filter((e=>!p[e])).forEach((t=>{const n={name:["filters",t,"dependencies"],errors:(0,ca.uh)(e,t)?[(0,l.t)("Cyclic dependency detected")]:[]};a.setFields([n])})),U()},H=e=>{const t=B(),n=E.filter((t=>t!==e&&A(t))),i=n.find((n=>{const i=t.get(e)||[];return i.push(n),!(0,ca.uh)(t,e)||(i.pop(),!1)}));return i||n[0]},G=(0,o.useMemo)((()=>x()(((e,t)=>{const n=e.filters&&Object.values(e.filters).some((e=>e.name&&null!==e.name)),i=e.filters&&Object.values(e.filters).some((e=>e.title&&null!==e.title));(n||i)&&T(t),g(!1),U()}),Sr.M)),[U]);return(0,o.useEffect)((()=>{Z((e=>e.filter((e=>!p[e]))))}),[p]),(0,v.tZ)(pa,{visible:e,maskClosable:!1,title:(0,l.t)("Add and edit filters"),width:"50%",destroyOnClose:!0,onCancel:K,onOk:L,centered:!0,footer:(0,v.tZ)(la,{onDismiss:()=>g(!1),onCancel:K,handleSave:L,canSave:!k.length,saveAlertVisible:m,onConfirmCancel:V})},(0,v.tZ)(b.Z,null,(0,v.tZ)(fa,null,(0,v.tZ)(ma,{form:a,onValuesChange:G,layout:"vertical"},(0,v.tZ)(Jr,{erroredFilters:k,onRemove:j,onAdd:N,onChange:e=>{w(e),P(M(e))},getFilterTitle:z,currentFilterId:S,removedFilters:p,restoreFilter:D,onRearrange:(e,t)=>{const n=[...E],i=n.splice(e,1)[0];n.splice(t,0,i),I(n)},filters:E},(e=>(e=>e.startsWith(ca.Ky)?(0,v.tZ)(ha,{componentId:e,divider:c[e]}):(0,v.tZ)(ra,{ref:s,form:a,filterId:e,filterToEdit:c[e],removedFilters:p,restoreFilter:D,getAvailableFilters:$,key:e,activeFilterPanelKeys:O,handleActiveFilterPanelChange:e=>P(e),isActive:S===e,setErroredFilters:Z,validateDependencies:W,getDependencySuggestion:H}))(e)))))))}const ya=({isOpen:e,chartId:t,onClose:n})=>{var i,a;const s=(0,r.I0)(),[d]=Ze.qz.useForm(),c=(0,r.v9)((({dashboardInfo:e})=>{var t;return null==e||null==(t=e.metadata)?void 0:t.chart_configuration})),u=null==c||null==(i=c[t])||null==(a=i.crossFilters)?void 0:a.scope,h=()=>{s((0,Si.Aw)({...c,[t]:{id:t,crossFilters:{scope:d.getFieldValue("scope")}}})),n()};return(0,v.tZ)(ci.o,{visible:e,maskClosable:!1,title:(0,l.t)("Cross Filter Scoping"),width:"55%",destroyOnClose:!0,onCancel:n,onOk:h,centered:!0,footer:(0,v.tZ)(o.Fragment,null,(0,v.tZ)(at.Z,{key:"cancel",buttonStyle:"secondary",onClick:n},(0,l.t)("Cancel")),(0,v.tZ)(at.Z,{key:"submit",buttonStyle:"primary",onClick:h},(0,l.t)("Save")))},(0,v.tZ)(ma,{preserve:!1,form:d,layout:"vertical"},(0,v.tZ)(gr,{form:d,scope:u,chartId:t})))};var Ca=n(15423);const Sa="cross_filter_scoping",xa="download_as_image",wa="explore_chart",ka="export_csv",Za="export_full_csv",Ra="force_refresh",Ta="resize_label",Fa="toggle_chart_description",Da=g.iK.div`
  padding: ${({theme:e})=>e.gridUnit/4}px
    ${({theme:e})=>1.5*e.gridUnit}px;

  .dot {
    display: block;
  }

  &:hover {
    cursor: pointer;
  }
`,_a=g.iK.div`
  height: auto;
  margin: ${({theme:e})=>e.gridUnit}px 0;
  color: ${({theme:e})=>e.colors.grayscale.base};
  line-height: ${({theme:e})=>1.5*e.typography.sizes.m}px;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  justify-content: flex-start;
`,Ea=".dashboard-component-chart-holder",Ia=()=>(0,v.tZ)(Da,null,(0,v.tZ)("span",{className:"dot"}),(0,v.tZ)("span",{className:"dot"}),(0,v.tZ)("span",{className:"dot"}));class Ma extends o.PureComponent{constructor(e){super(e),this.toggleControls=this.toggleControls.bind(this),this.refreshChart=this.refreshChart.bind(this),this.handleMenuClick=this.handleMenuClick.bind(this),this.state={showControls:!1,showCrossFilterScopingModal:!1}}refreshChart(){this.props.updatedDttm&&this.props.forceRefresh(this.props.slice.slice_id,this.props.dashboardId)}toggleControls(){this.setState((e=>({showControls:!e.showControls})))}handleMenuClick({key:e,domEvent:t}){switch(e){case Ra:this.refreshChart(),this.props.addSuccessToast((0,l.t)("Data refreshed"));break;case Sa:this.setState({showCrossFilterScopingModal:!0});break;case Fa:this.props.toggleExpandSlice&&this.props.toggleExpandSlice(this.props.slice.slice_id);break;case wa:this.props.logExploreChart&&this.props.logExploreChart(this.props.slice.slice_id);break;case ka:this.props.exportCSV&&this.props.exportCSV(this.props.slice.slice_id);break;case Ta:this.props.handleToggleFullSize();break;case Za:this.props.exportFullCSV&&this.props.exportFullCSV(this.props.slice.slice_id);break;case xa:{const e=document.querySelector(".ant-dropdown:not(.ant-dropdown-hidden)");e.style.visibility="hidden",(0,Mn.Z)(Ea,this.props.slice.slice_name)(t).then((()=>{e.style.visibility="visible"}));break}}}render(){var e;const{componentId:t,dashboardId:n,slice:i,isFullSize:r,cachedDttm:a=[],updatedDttm:s=null,addSuccessToast:c=(()=>{}),addDangerToast:u=(()=>{}),supersetCanShare:h=!1,isCached:p=[]}=this.props,f=(0,Bi.Z)().items,m="table"===i.viz_type,g=Object.entries(f).filter((([,{value:e}])=>{var t;return null==(t=e.behaviors)?void 0:t.includes(Wi.cg.INTERACTIVE_CHART)})).find((([e])=>e===i.viz_type)),b=null==(e=i.form_data)?void 0:e.emit_filter,y=(a||[]).map((e=>et().utc(e).fromNow())),C=s?et().utc(s).fromNow():"",S=[...new Set(p.map((e=>e?(0,l.t)("Cached %s",y):C?(0,l.t)("Fetched %s",C):""))||"")],x=S.map(((e,t)=>(0,v.tZ)("div",{key:`tooltip-${t}`},S.length>1?(0,l.t)("Query %s: %s",t+1,e):e))),w=r?(0,l.t)("Minimize chart"):(0,l.t)("Maximize chart"),k=(0,v.tZ)(ut.v,{onClick:this.handleMenuClick,selectable:!1},(0,v.tZ)(ut.v.Item,{key:Ra,disabled:"loading"===this.props.chartStatus,style:{height:"auto",lineHeight:"initial"}},(0,l.t)("Force refresh"),(0,v.tZ)(_a,null,x)),(0,v.tZ)(ut.v.Divider,null),i.description&&(0,v.tZ)(ut.v.Item,{key:Fa},(0,l.t)("Toggle chart description")),this.props.supersetCanExplore&&(0,v.tZ)(ut.v.Item,{key:wa,onClick:this.props.onExploreChart},(0,l.t)("View chart in Explore")),this.props.supersetCanExplore&&(0,v.tZ)(ut.v.Item,{key:"view_query"},(0,v.tZ)(St.Z,{triggerNode:(0,v.tZ)("span",null,(0,l.t)("View query")),modalTitle:(0,l.t)("View query"),modalBody:(0,v.tZ)(Ca.Z,{latestQueryFormData:this.props.formData}),draggable:!0,resizable:!0,responsive:!0})),h&&(0,v.tZ)(Ct,{dashboardId:n,dashboardComponentId:t,copyMenuItemTitle:(0,l.t)("Copy permalink to clipboard"),emailMenuItemTitle:(0,l.t)("Share permalink by email"),emailSubject:(0,l.t)("Superset chart"),emailBody:(0,l.t)("Check out this chart: "),addSuccessToast:c,addDangerToast:u}),(0,v.tZ)(ut.v.Item,{key:Ta},w),(0,v.tZ)(ut.v.Item,{key:xa},(0,l.t)("Download as image")),"filter_box"!==this.props.slice.viz_type&&this.props.supersetCanCSV&&(0,v.tZ)(ut.v.Item,{key:ka},(0,l.t)("Export CSV")),"filter_box"!==this.props.slice.viz_type&&(0,rt.cr)(d.T.ALLOW_FULL_CSV_EXPORT)&&this.props.supersetCanCSV&&m&&(0,v.tZ)(ut.v.Item,{key:Za},(0,l.t)("Export full CSV")),(0,rt.cr)(d.T.DASHBOARD_CROSS_FILTERS)&&g&&b&&(0,v.tZ)(ut.v.Item,{key:Sa},(0,l.t)("Cross-filter scoping")));return(0,v.tZ)(o.Fragment,null,(0,v.tZ)(ya,{chartId:i.slice_id,isOpen:this.state.showCrossFilterScopingModal,onClose:()=>this.setState({showCrossFilterScopingModal:!1})}),r&&(0,v.tZ)(ot.Z.FullscreenExitOutlined,{style:{fontSize:22},onClick:()=>{this.props.handleToggleFullSize()}}),(0,v.tZ)(ht.$,{overlay:k,trigger:["click"],placement:"bottomRight",getPopupContainer:e=>e.closest(Ea)},(0,v.tZ)("span",{id:`slice_${i.slice_id}-controls`,role:"button","aria-label":"More Options"},(0,v.tZ)(Ia,null))))}}const Oa=Ma;var Pa=n(87185),Na=n.n(Pa);const ja={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm193.5 301.7l-210.6 292a31.8 31.8 0 01-51.7 0L318.5 484.9c-3.8-5.3 0-12.7 6.5-12.7h46.9c10.2 0 19.9 4.9 25.9 13.3l71.2 98.8 157.2-218c6-8.3 15.6-13.3 25.9-13.3H699c6.5 0 10.3 7.4 6.5 12.7z"}}]},name:"check-circle",theme:"filled"};var qa=n(27029),za=function(e,t){return o.createElement(qa.Z,Object.assign({},e,{ref:t,icon:ja}))};za.displayName="CheckCircleFilled";const Aa=o.forwardRef(za),$a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm-32 232c0-4.4 3.6-8 8-8h48c4.4 0 8 3.6 8 8v272c0 4.4-3.6 8-8 8h-48c-4.4 0-8-3.6-8-8V296zm32 440a48.01 48.01 0 010-96 48.01 48.01 0 010 96z"}}]},name:"exclamation-circle",theme:"filled"};var Ua=function(e,t){return o.createElement(qa.Z,Object.assign({},e,{ref:t,icon:$a}))};Ua.displayName="ExclamationCircleFilled";const La=o.forwardRef(Ua),Va={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm192 472c0 4.4-3.6 8-8 8H328c-4.4 0-8-3.6-8-8v-48c0-4.4 3.6-8 8-8h368c4.4 0 8 3.6 8 8v48z"}}]},name:"minus-circle",theme:"filled"};var Ka=function(e,t){return o.createElement(qa.Z,Object.assign({},e,{ref:t,icon:Va}))};Ka.displayName="MinusCircleFilled";const Ba=o.forwardRef(Ka);var Wa=n(76697);const Ha=g.iK.div`
  ${({theme:e})=>v.iv`
    display: inline-block;
    color: ${e.colors.grayscale.light5};
    background: ${e.colors.grayscale.base};
    border-radius: 1em;
    vertical-align: text-top;
    padding: ${e.gridUnit}px ${2*e.gridUnit}px;
    font-size: ${e.typography.sizes.m}px;
    font-weight: ${e.typography.weights.bold};
    min-width: 1em;
    min-height: 1em;
    line-height: 1em;
    vertical-align: middle;
    white-space: nowrap;

    svg {
      position: relative;
      top: -2px;
      color: ${e.colors.grayscale.light5};
      width: 1em;
      height: 1em;
      display: inline-block;
      vertical-align: middle;
    }

    &:hover {
      cursor: pointer;
      background: ${e.colors.grayscale.dark1};
    }

    &.has-cross-filters {
      background: ${e.colors.primary.base};
      &:hover {
        background: ${e.colors.primary.dark1};
      }
    }

    &.has-incompatible-filters {
      color: ${e.colors.grayscale.dark2};
      background: ${e.colors.alert.base};
      &:hover {
        background: ${e.colors.alert.dark1};
      }
      svg {
        color: ${e.colors.grayscale.dark2};
      }
    }

    &.filters-inactive {
      color: ${e.colors.grayscale.light5};
      background: ${e.colors.grayscale.light1};
      padding: ${e.gridUnit}px;
      text-align: center;
      height: 22px;
      width: 22px;

      &:hover {
        background: ${e.colors.grayscale.base};
      }
    }
  `}
`,Ga=g.iK.span`
  position: relative;
  margin-right: ${({theme:e})=>e.gridUnit}px;
  font-weight: ${({bold:e,theme:t})=>e?t.typography.weights.bold:"auto"};
  color: ${({color:e,theme:t})=>e||t.colors.grayscale.light5};
  display: flex;
  align-items: center;
  & > * {
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }
`,Ya=g.iK.i`
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  left: -${({theme:e})=>5*e.gridUnit}px;
`,Ja=g.iK.button`
  cursor: pointer;
  display: flex;
  flex-wrap: wrap;
  text-align: left;
  padding: 0;
  border: none;
  background: none;
  outline: none;
  width: 100%;

  &::-moz-focus-inner {
    border: 0;
  }

  & i svg {
    color: transparent;
    margin-right: ${({theme:e})=>e.gridUnit}px;
  }

  &:hover i svg {
    color: inherit;
  }
`,Qa=g.iK.div`
  margin: 0 -${({theme:e})=>4*e.gridUnit}px;
`,Xa=g.iK.div`
  padding-left: ${({theme:e})=>6*e.gridUnit}px;
  margin: -${({theme:e})=>3*e.gridUnit}px 0;
`,es=g.iK.div`
  min-width: 200px;
  max-width: 300px;
  overflow-x: hidden;
`,ts=g.iK.div`
  max-width: 100%;
  flex-grow: 1;
  overflow: auto;
  color: ${({theme:e})=>e.colors.grayscale.light5};
`,ns=g.iK.div`
  ${({theme:e})=>`\n  padding-top: ${3*e.gridUnit}px;\n  max-width: 100%;\n  flex-grow: 1;\n  overflow: auto;\n  color: ${e.colors.grayscale.light5};\n  `}
`;var is=n(76570);n(14670);const rs=(0,l.t)("Please apply filter changes"),os=e=>null==e?"":"string"==typeof e||"number"==typeof e?`${e}`:Array.isArray(e)?e.join(", "):"object"==typeof e?JSON.stringify(e):(0,l.t)("Unknown value"),as=({filterSetFilterValues:e,dataMaskSelected:t})=>e.find((({dataMask:e={}})=>{const n=Object.entries(t);return n.every((([t,i])=>{var r;const o=(0,Ii.JB)(i.filterState,null==e||null==(r=e[t])?void 0:r.filterState,{ignoreUndefined:!0,ignoreNull:!0}),a=n.length===Object.keys(null!=e?e:{}).length;return o&&a}))})),ss=({indicator:{column:e,name:t,value:n,path:i=[]},onClick:r=(()=>{}),text:a})=>{const s=os(n);return(0,v.tZ)(o.Fragment,null,(0,v.tZ)(Ja,{onClick:()=>r([...i,`LABEL-${e}`])},(0,v.tZ)(Ga,{bold:!0},(0,v.tZ)(Ya,null,(0,v.tZ)(is.Z,null)),t,s?": ":""),(0,v.tZ)(ts,null,s)),a&&(0,v.tZ)(ns,null,a))},ls=({appliedCrossFilterIndicators:e=[],appliedIndicators:t=[],incompatibleIndicators:n=[],unsetIndicators:i=[],onHighlightFilterSource:a,children:s})=>{const[d,c]=(0,o.useState)(!1),u=(0,g.Fg)(),h=(0,r.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs}));(0,o.useEffect)((()=>{d&&window.addEventListener("resize",(()=>c(!1)),{once:!0})}),[d]),(0,o.useEffect)((()=>{c(!1)}),[h]);const p=()=>{const i=[];return e.length&&i.push("appliedCrossFilters"),t.length&&i.push("applied"),n.length&&i.push("incompatible"),i.length?i:["unset"]},[f,m]=(0,o.useState)((()=>[...p()])),b=e=>`${e.column} - ${e.name}`,y=(0,v.tZ)(es,null,(0,v.tZ)(v.xB,{styles:(0,v.iv)(".filterStatusPopover{.ant-popover-inner{background-color:",u.colors.grayscale.dark2,"cc;.ant-popover-inner-content{padding-top:0;padding-bottom:0;}}&.ant-popover-placement-bottom,&.ant-popover-placement-bottomLeft,&.ant-popover-placement-bottomRight{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",u.colors.grayscale.dark2,"cc;border-left-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-top,&.ant-popover-placement-topLeft,&.ant-popover-placement-topRight{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",u.colors.grayscale.dark2,"cc;border-right-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-left,&.ant-popover-placement-leftTop,&.ant-popover-placement-leftBottom{&>.ant-popover-content>.ant-popover-arrow{border-top-color:",u.colors.grayscale.dark2,"cc;border-right-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover-placement-right,&.ant-popover-placement-rightTop,&.ant-popover-placement-rightBottom{&>.ant-popover-content>.ant-popover-arrow{border-bottom-color:",u.colors.grayscale.dark2,"cc;border-left-color:",u.colors.grayscale.dark2,"cc;}}&.ant-popover{color:",u.colors.grayscale.light4,";z-index:99;}}","")}),(0,v.tZ)(Qa,null,(0,v.tZ)(Qr.Z,{ghost:!0,light:!0,activeKey:f,onChange:function(e){m("string"==typeof e?[e]:e)}},e.length?(0,v.tZ)(Qr.Z.Panel,{key:"appliedCrossFilters",header:(0,v.tZ)(Ga,{bold:!0,color:u.colors.primary.light1},(0,v.tZ)(ot.Z.CursorTarget,{css:(0,v.iv)({fill:u.colors.primary.light1},"",""),iconSize:"xl"}),(0,l.t)("Applied Cross Filters (%d)",e.length))},(0,v.tZ)(Xa,{css:(0,v.iv)({paddingBottom:3*u.gridUnit},"","")},e.map((e=>(0,v.tZ)(ss,{key:b(e),indicator:e,onClick:a}))))):null,t.length?(0,v.tZ)(Qr.Z.Panel,{key:"applied",header:(0,v.tZ)(Ga,{bold:!0,color:u.colors.success.base},(0,v.tZ)(Aa,null)," ",(0,l.t)("Applied Filters (%d)",t.length))},(0,v.tZ)(Xa,{css:(0,v.iv)({paddingBottom:3*u.gridUnit},"","")},t.map((e=>(0,v.tZ)(ss,{key:b(e),indicator:e,onClick:a}))))):null,n.length?(0,v.tZ)(Qr.Z.Panel,{key:"incompatible",header:(0,v.tZ)(Ga,{bold:!0,color:u.colors.alert.base},(0,v.tZ)(La,null)," ",(0,l.t)("Incompatible Filters (%d)",n.length))},(0,v.tZ)(Xa,{css:(0,v.iv)({paddingBottom:3*u.gridUnit},"","")},n.map((e=>(0,v.tZ)(ss,{key:b(e),indicator:e,onClick:a}))))):null,i.length?(0,v.tZ)(Qr.Z.Panel,{key:"unset",header:(0,v.tZ)(Ga,{bold:!0,color:u.colors.grayscale.light1},(0,v.tZ)(Ba,null)," ",(0,l.t)("Unset Filters (%d)",i.length)),disabled:!i.length},(0,v.tZ)(Xa,{css:(0,v.iv)({paddingBottom:3*u.gridUnit},"","")},i.map((e=>(0,v.tZ)(ss,{key:b(e),indicator:e,onClick:a}))))):null)));return(0,v.tZ)(Wa.ZP,{overlayClassName:"filterStatusPopover",content:y,visible:d,onVisibleChange:function(e){c(e),e&&m(p())},placement:"bottomRight",trigger:"click"},s)};var ds;!function(e){e.Unset="UNSET",e.Applied="APPLIED",e.Incompatible="INCOMPATIBLE",e.CrossFilterApplied="CROSS_FILTER_APPLIED"}(ds||(ds={}));const cs=new Set(Object.values(Re.i2)),us=e=>null!=e&&e.label?e.label:null!=e&&e.value?(0,lr.Z)(null==e?void 0:e.value).join(", "):null,hs=(e,t,n)=>{const i=t.columns[e],r=Array.isArray(i)?i:[i];if(null==i||t.isDateFilter&&i===Re.vM||0===r.length)return[];if(t.isDateFilter&&cs.has(e)){const t=((e===Re.i2.time_grain_sqla?n.time_grain_sqla:n.granularity)||[]).reduce(((e,[t,n])=>({...e,[t]:n})),{});return r.map((e=>t[e]||e))}return r},ps=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.applied_filters)||[]).map((e=>e.column)))},fs=e=>{var t,n;return new Set(((null==e||null==(t=e.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)||[]).map((e=>e.column)))},ms={},gs={},vs={},bs={},ys={},Cs=[],Ss=({chartId:e})=>{var t,n;const i=(0,r.I0)(),a=(0,r.v9)((e=>e.datasources)),s=(0,r.v9)((e=>e.dashboardFilters)),l=(0,r.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters})),c=(0,r.v9)((e=>e.dashboardInfo)),u=(0,r.v9)((e=>e.charts)),p=(0,r.v9)((e=>e.dashboardLayout.present)),f=(0,r.v9)((e=>e.dataMask)),[g,b]=(0,o.useState)(Cs),[y,C]=(0,o.useState)(Cs),S=(0,o.useCallback)((e=>{i((0,Ut.E2)(e))}),[i]),x=u[e],w=(0,da.D)(x),k=null==w?void 0:w.chartStatus,Z=(0,da.D)(s),R=(0,da.D)(a),T=(null==x?void 0:x.chartStatus)&&["rendered","success"].includes(x.chartStatus);(0,o.useEffect)((()=>{if(!T&&y.length>0)C(Cs);else if("success"!==k){var t,n,i,r,o,l,d,c;(null==x||null==(t=x.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)===(null==w||null==(i=w.queriesResponse)||null==(r=i[0])?void 0:r.rejected_filters)&&(null==x||null==(o=x.queriesResponse)||null==(l=o[0])?void 0:l.applied_filters)===(null==w||null==(d=w.queriesResponse)||null==(c=d[0])?void 0:c.applied_filters)&&s===Z&&a===R||C(((e,t,n,i)=>{const r=ps(i),o=fs(i),a=Object.values(t).filter((t=>t.chartId!==e)),s=Object.entries(n).filter((([e])=>a.find((t=>t.datasourceId===e)))).map((([,e])=>e)),l=gs[e];if(ms[e]&&(0,Ii.JB)(null==l?void 0:l.appliedColumns,r)&&(0,Ii.JB)(null==l?void 0:l.rejectedColumns,o)&&(0,Ii.JB)(null==l?void 0:l.matchingFilters,a)&&(0,Ii.JB)(null==l?void 0:l.matchingDatasources,s))return ms[e];const d=a.reduce(((t,i)=>t.concat(((e,t,n,i,r)=>{const o=(e,t)=>i.has(e)&&t.columns[e]?ds.Applied:r.has(e)?ds.Incompatible:ds.Unset;return Object.keys(t.columns).filter((n=>(0,un.up)({filterScope:t.scopes[n]}).includes(e))).map((e=>({column:e,name:t.labels[e]||e,value:hs(e,t,n),status:o(e,t),path:t.directPathToFilter})))})(e,i,n[i.datasourceId]||{},r,o))),[]);return d.sort(((e,t)=>e.name.localeCompare(t.name))),ms[e]=d,gs[e]={appliedColumns:r,rejectedColumns:o,matchingFilters:a,matchingDatasources:s},d})(e,s,a,x))}}),[x,e,s,y.length,a,null==w?void 0:w.queriesResponse,k,Z,R,T]);const F=(0,da.D)(l),D=(0,da.D)(p),_=(0,da.D)(f),E=(0,da.D)(null==(t=c.metadata)?void 0:t.chart_configuration);(0,o.useEffect)((()=>{if(!T&&g.length>0)b(Cs);else if("success"!==k){var t,n,i,r,o,a,s,u,m,v;(null==x||null==(t=x.queriesResponse)||null==(n=t[0])?void 0:n.rejected_filters)===(null==w||null==(i=w.queriesResponse)||null==(r=i[0])?void 0:r.rejected_filters)&&(null==x||null==(o=x.queriesResponse)||null==(a=o[0])?void 0:a.applied_filters)===(null==w||null==(s=w.queriesResponse)||null==(u=s[0])?void 0:u.applied_filters)&&l===F&&p===D&&f===_&&E===(null==(m=c.metadata)?void 0:m.chart_configuration)||b(((e,t,n,i,r,o=ys)=>{const a=ps(i),s=fs(i),l=bs[n];if(vs[n]&&(0,Ii.JB)(null==l?void 0:l.appliedColumns,a)&&(0,Ii.JB)(null==l?void 0:l.rejectedColumns,s)&&(null==l?void 0:l.nativeFilters)===e&&(null==l?void 0:l.dashboardLayout)===r&&(null==l?void 0:l.chartConfiguration)===o&&(null==l?void 0:l.dataMask)===t)return vs[n];const c=({label:e,column:t,type:n=wr.gT.NativeFilters})=>{const i=null!==e;return n===wr.gT.CrossFilters&&i?ds.CrossFilterApplied:!t&&i?ds.Applied:t&&s.has(t)?ds.Incompatible:t&&a.has(t)&&i?ds.Applied:ds.Unset};let u=[];(0,d.c)(d.T.DASHBOARD_NATIVE_FILTERS)&&(u=e&&Object.values(e).filter((e=>{var t;return e.type===wr.BE.NATIVE_FILTER&&(null==(t=e.chartsInScope)?void 0:t.includes(n))})).map((e=>{var n,i,r,o;const a=null==(n=e.targets)||null==(i=n[0])||null==(r=i.column)?void 0:r.name,s=null==(o=t[e.id])?void 0:o.filterState,l=us(s);return{column:a,name:e.name,path:[e.id],status:c({label:l,column:a}),value:l}})));let p=[];if((0,d.c)(d.T.DASHBOARD_CROSS_FILTERS)){const e=Object.values(r),i=e.find((e=>{var t;return(null==e||null==(t=e.meta)?void 0:t.chartId)===n}));p=Object.values(o).filter((e=>!e.crossFilters.scope.excluded.includes(n)&&e.crossFilters.scope.rootPath.some((e=>{var t;return(null==i?void 0:i.type)===h.dW&&(null==i||null==(t=i.parents)?void 0:t.includes(e))})))).map((n=>{var i,r,o;const a=null==(i=t[n.id])?void 0:i.filterState,s=us(a),l=null==a?void 0:a.filters,d=l&&Object.keys(l)[0],u=e.find((e=>{var t;return(null==e||null==(t=e.meta)?void 0:t.chartId)===n.id}));return{column:d,name:null==u||null==(r=u.meta)?void 0:r.sliceName,path:[...null!=(o=null==u?void 0:u.parents)?o:[],null==u?void 0:u.id],status:c({label:s,type:wr.gT.CrossFilters}),value:s}})).filter((e=>e.status===ds.CrossFilterApplied))}const f=p.concat(u);return vs[n]=f,bs[n]={nativeFilters:e,dashboardLayout:r,chartConfiguration:o,dataMask:t,appliedColumns:a,rejectedColumns:s},f})(l,f,e,x,p,null==(v=c.metadata)?void 0:v.chart_configuration))}}),[x,e,null==(n=c.metadata)?void 0:n.chart_configuration,f,l,g.length,p,null==w?void 0:w.queriesResponse,E,k,D,_,F,T]);const I=(0,o.useMemo)((()=>Na()((e=>{const t=[ds.Applied,ds.Unset,ds.Incompatible];return e.sort(((e,n)=>t.indexOf(e.status)-t.indexOf(n.status)))})([...y,...g]),((e,t)=>e.column===t.column&&e.name===t.name&&(e.status!==ds.Applied||t.status!==ds.Applied)))),[y,g]),M=(0,o.useMemo)((()=>I.filter((e=>e.status===ds.CrossFilterApplied))),[I]),O=(0,o.useMemo)((()=>I.filter((e=>e.status===ds.Applied))),[I]),P=(0,o.useMemo)((()=>I.filter((e=>e.status===ds.Unset))),[I]),N=(0,o.useMemo)((()=>I.filter((e=>e.status===ds.Incompatible))),[I]);if(!(M.length||O.length||N.length||P.length))return null;const j=!M.length&&!O.length&&!N.length;return(0,v.tZ)(ls,{appliedCrossFilterIndicators:M,appliedIndicators:O,unsetIndicators:P,incompatibleIndicators:N,onHighlightFilterSource:S},(0,v.tZ)(Ha,{className:m()("filter-counts",!!N.length&&"has-incompatible-filters",!!M.length&&"has-cross-filters",j&&"filters-inactive")},(0,v.tZ)(ot.Z.Filter,{iconSize:"m"}),!j&&(0,v.tZ)("span",null,O.length+M.length),N.length?(0,v.tZ)(o.Fragment,null," ",(0,v.tZ)(ot.Z.AlertSolid,null),(0,v.tZ)("span",null,N.length)):null))},xs=o.memo(Ss),ws=(0,l.t)("Annotation layers are still loading."),ks=(0,l.t)("One ore more annotation layers failed loading."),Zs=(0,g.iK)(ot.Z.CursorTarget)`
  cursor: pointer;
  color: ${({theme:e})=>e.colors.primary.base};
  height: 22px;
  width: 22px;
`,Rs=({innerRef:e=null,forceRefresh:t=(()=>({})),updateSliceName:n=(()=>({})),toggleExpandSlice:i=(()=>({})),logExploreChart:a=(()=>({})),onExploreChart:s,exportCSV:d=(()=>({})),editMode:c=!1,annotationQuery:u={},annotationError:h={},cachedDttm:p=null,updatedDttm:f=null,isCached:m=[],isExpanded:g=!1,sliceName:b="",supersetCanExplore:y=!1,supersetCanShare:C=!1,supersetCanCSV:S=!1,sliceCanEdit:x=!1,exportFullCSV:w,slice:k,componentId:Z,dashboardId:R,addSuccessToast:T,addDangerToast:F,handleToggleFullSize:D,isFullSize:_,chartStatus:E,formData:I,width:M,height:O})=>{const P=(0,r.I0)(),N=(0,Ki.fG)(),[j,q]=(0,o.useState)(null),z=(0,o.useRef)(null),A=(0,r.v9)((e=>{var t,n;return null==(t=e.dataMask[null==k?void 0:k.slice_id])||null==(n=t.filterState)?void 0:n.value})),$=(0,o.useMemo)((()=>({value:A,name:(0,l.t)("Emitted values")})),[A]);return(0,o.useEffect)((()=>{const e=z.current;e&&(e.scrollWidth>e.offsetWidth||e.scrollHeight>e.offsetHeight)?q(null!=b?b:null):q(null)}),[b,M,O]),(0,v.tZ)("div",{className:"chart-header",ref:e},(0,v.tZ)("div",{className:"header-title",ref:z},(0,v.tZ)(Wn.u,{title:j},(0,v.tZ)(st.Z,{title:b||(c?"---":""),canEdit:c,emptyText:"",onSaveTitle:n,showTooltip:!1})),!!Object.values(u).length&&(0,v.tZ)(Wn.u,{id:"annotations-loading-tooltip",placement:"top",title:ws},(0,v.tZ)("i",{role:"img","aria-label":ws,className:"fa fa-refresh warning"})),!!Object.values(h).length&&(0,v.tZ)(Wn.u,{id:"annoation-errors-tooltip",placement:"top",title:ks},(0,v.tZ)("i",{role:"img","aria-label":ks,className:"fa fa-exclamation-circle danger"}))),(0,v.tZ)("div",{className:"header-controls"},!c&&(0,v.tZ)(o.Fragment,null,A&&(0,v.tZ)(Wn.u,{placement:"top",title:(0,v.tZ)(ss,{indicator:$,text:(0,l.t)("Click to clear emitted filters")})},(0,v.tZ)(Zs,{onClick:()=>P((0,Qe.ze)(null==k?void 0:k.slice_id))})),!N.hideChartControls&&(0,v.tZ)(xs,{chartId:k.slice_id}),!N.hideChartControls&&(0,v.tZ)(Oa,{slice:k,isCached:m,isExpanded:g,cachedDttm:p,updatedDttm:f,toggleExpandSlice:i,forceRefresh:t,logExploreChart:a,onExploreChart:s,exportCSV:d,exportFullCSV:w,supersetCanExplore:y,supersetCanShare:C,supersetCanCSV:S,sliceCanEdit:x,componentId:Z,dashboardId:R,addSuccessToast:T,addDangerToast:F,handleToggleFullSize:D,isFullSize:_,chartStatus:E,formData:I}))))},Ts={height:s().number.isRequired};function Fs({height:e}){return(0,v.tZ)("div",{className:"missing-chart-container",style:{height:e+20}},(0,v.tZ)("div",{className:"missing-chart-body"},(0,l.t)("There is no chart definition associated with this component, could it have been deleted?"),(0,v.tZ)("br",null),(0,v.tZ)("br",null),(0,l.t)("Delete this container and save to remove this message.")))}Fs.propTypes=Ts;const Ds={id:s().number.isRequired,componentId:s().string.isRequired,dashboardId:s().number.isRequired,width:s().number.isRequired,height:s().number.isRequired,updateSliceName:s().func.isRequired,isComponentVisible:s().bool,handleToggleFullSize:s().func.isRequired,chart:E.$6.isRequired,formData:s().object.isRequired,labelColors:s().object,sharedLabelColors:s().object,datasource:s().object,slice:E.Rw.isRequired,sliceName:s().string.isRequired,timeout:s().number.isRequired,maxRows:s().number.isRequired,filterboxMigrationState:Re.Qi,filters:s().object.isRequired,refreshChart:s().func.isRequired,logEvent:s().func.isRequired,toggleExpandSlice:s().func.isRequired,changeFilter:s().func.isRequired,setFocusedFilterField:s().func.isRequired,unsetFocusedFilterField:s().func.isRequired,editMode:s().bool.isRequired,isExpanded:s().bool.isRequired,isCached:s().bool,supersetCanExplore:s().bool.isRequired,supersetCanShare:s().bool.isRequired,supersetCanCSV:s().bool.isRequired,sliceCanEdit:s().bool.isRequired,addSuccessToast:s().func.isRequired,addDangerToast:s().func.isRequired,ownState:s().object,filterState:s().object,postTransformProps:s().func,datasetsStatus:s().oneOf(["loading","error","complete"])},_s=Object.keys(Ds).filter((e=>"width"!==e&&"height"!==e&&"isComponentVisible"!==e)),Es=new Set(["filter_box"]),Is=g.iK.div`
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;

  &.is-deactivated {
    opacity: 0.5;
    background-color: ${({theme:e})=>e.colors.grayscale.light1};
  }
`,Ms=g.iK.div`
  display: flex;
  flex-direction: column;
  max-height: 100%;
`;class Os extends o.Component{constructor(e){super(e),this.logExploreChart=()=>{this.props.logEvent(it.oK,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached})},this.onExploreChart=async()=>{try{const e=window.localStorage.getItem("last_tab_id"),t=e?String(Number.parseInt(e,10)+1):void 0,n=await(0,Vi.nv)(this.props.datasource.id,this.props.formData,this.props.slice.slice_id,t),i=(0,Ui.y8)(null,{[pt.KD.formDataKey.name]:n,[pt.KD.sliceId.name]:this.props.slice.slice_id});window.open(i,"_blank","noreferrer")}catch(e){vt.Z.error(e),this.props.addDangerToast((0,l.t)("An error occurred while opening Explore"))}},this.state={width:e.width,height:e.height,descriptionHeight:0},this.changeFilter=this.changeFilter.bind(this),this.handleFilterMenuOpen=this.handleFilterMenuOpen.bind(this),this.handleFilterMenuClose=this.handleFilterMenuClose.bind(this),this.exportCSV=this.exportCSV.bind(this),this.exportFullCSV=this.exportFullCSV.bind(this),this.forceRefresh=this.forceRefresh.bind(this),this.resize=this.resize.bind(this),this.setDescriptionRef=this.setDescriptionRef.bind(this),this.setHeaderRef=this.setHeaderRef.bind(this),this.getChartHeight=this.getChartHeight.bind(this),this.getDescriptionHeight=this.getDescriptionHeight.bind(this)}shouldComponentUpdate(e,t){if(t.width!==this.state.width||t.height!==this.state.height||t.descriptionHeight!==this.state.descriptionHeight||!$i()(e.datasource,this.props.datasource))return!0;if(e.isComponentVisible){if(e.chart.triggerQuery)return!0;if(e.isFullSize!==this.props.isFullSize)return clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350),!1;e.width===this.props.width&&e.height===this.props.height||(clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(this.resize,350));for(let t=0;t<_s.length;t+=1){const n=_s[t];if(!(0,Ii.JB)(e[n],this.props[n]))return!0}}return this.props.cacheBusterProp!==e.cacheBusterProp}componentDidMount(){if(this.props.isExpanded){const e=this.getDescriptionHeight();this.setState({descriptionHeight:e})}}componentWillUnmount(){clearTimeout(this.resizeTimeout)}componentDidUpdate(e){if(this.props.isExpanded!==e.isExpanded){const e=this.getDescriptionHeight();this.setState({descriptionHeight:e})}}getDescriptionHeight(){return this.props.isExpanded&&this.descriptionRef?this.descriptionRef.offsetHeight:0}getChartHeight(){const e=this.getHeaderHeight();return Math.max(this.state.height-e-this.state.descriptionHeight,20)}getHeaderHeight(){return this.headerRef&&this.headerRef.offsetHeight||22}setDescriptionRef(e){this.descriptionRef=e}setHeaderRef(e){this.headerRef=e}resize(){const{width:e,height:t}=this.props;this.setState((()=>({width:e,height:t})))}changeFilter(e={}){this.props.logEvent(it.Qg,{id:this.props.chart.id,columns:Object.keys(e)}),this.props.changeFilter(this.props.chart.id,e)}handleFilterMenuOpen(e,t){this.props.setFocusedFilterField(e,t)}handleFilterMenuClose(e,t){this.props.unsetFocusedFilterField(e,t)}exportCSV(e=!1){this.props.logEvent(it.PC,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),(0,Ui.pe)({formData:e?{...this.props.formData,row_limit:this.props.maxRows}:this.props.formData,resultType:"full",resultFormat:"csv",force:!0})}exportFullCSV(){this.exportCSV(!0)}forceRefresh(){return this.props.logEvent(it.TD,{slice_id:this.props.slice.slice_id,is_cached:this.props.isCached}),this.props.refreshChart(this.props.chart.id,!0,this.props.dashboardId)}render(){const{id:e,componentId:t,dashboardId:n,chart:i,slice:r,datasource:o,isExpanded:a,editMode:s,filters:l,formData:d,labelColors:c,sharedLabelColors:u,updateSliceName:h,sliceName:p,toggleExpandSlice:f,timeout:g,supersetCanExplore:b,supersetCanShare:y,supersetCanCSV:C,sliceCanEdit:S,addSuccessToast:x,addDangerToast:w,ownState:k,filterState:Z,handleToggleFullSize:R,isFullSize:T,filterboxMigrationState:F,postTransformProps:D,datasetsStatus:_}=this.props,{width:E}=this.state;if(!i||!r)return(0,v.tZ)(Fs,{height:this.getChartHeight()});const{queriesResponse:I,chartUpdateEndTime:M,chartStatus:O}=i,P="loading"===O,N="filter_box"===r.viz_type&&[Re.Qi.REVIEWING,Re.Qi.CONVERTED].includes(F),j=(null==I?void 0:I.map((({is_cached:e})=>e)))||[],q=(null==I?void 0:I.map((({cached_dttm:e})=>e)))||[],z=Es.has(r.viz_type),A=(0,un.Z3)(e)?function({activeFilters:e={},filterId:t}){return Object.entries(e).reduce(((e,n)=>{const[i,{values:r}]=n,{chartId:o,column:a}=(0,Yt._)(i);return o===t?{...e,[a]:r}:e}),{})}({activeFilters:l,filterId:e}):{};return(0,v.tZ)(Ms,{className:"chart-slice","data-test-chart-id":e,"data-test-viz-type":r.viz_type,"data-test-chart-name":r.slice_name},(0,v.tZ)(Rs,{innerRef:this.setHeaderRef,slice:r,isExpanded:!!a,isCached:j,cachedDttm:q,updatedDttm:M,toggleExpandSlice:f,forceRefresh:this.forceRefresh,editMode:s,annotationQuery:i.annotationQuery,logExploreChart:this.logExploreChart,onExploreChart:this.onExploreChart,exportCSV:this.exportCSV,exportFullCSV:this.exportFullCSV,updateSliceName:h,sliceName:p,supersetCanExplore:b,supersetCanShare:y,supersetCanCSV:C,sliceCanEdit:S,componentId:t,dashboardId:n,filters:l,addSuccessToast:x,addDangerToast:w,handleToggleFullSize:R,isFullSize:T,chartStatus:i.chartStatus,formData:d,width:E,height:this.getHeaderHeight()}),a&&r.description_markeddown&&(0,v.tZ)("div",{className:"slice_description bs-callout bs-callout-default",ref:this.setDescriptionRef,dangerouslySetInnerHTML:{__html:r.description_markeddown}}),(0,v.tZ)("div",{className:m()("dashboard-chart",z&&"dashboard-chart--overflowable")},(P||N)&&(0,v.tZ)(Is,{className:m()(N&&"is-deactivated"),style:{width:E,height:this.getChartHeight()}}),(0,v.tZ)(Li.Z,{width:E,height:this.getChartHeight(),addFilter:this.changeFilter,onFilterMenuOpen:this.handleFilterMenuOpen,onFilterMenuClose:this.handleFilterMenuClose,annotationData:i.annotationData,chartAlert:i.chartAlert,chartId:e,chartStatus:O,datasource:o,dashboardId:n,initialValues:A,formData:d,labelColors:c,sharedLabelColors:u,ownState:k,filterState:Z,queriesResponse:i.queriesResponse,timeout:g,triggerQuery:i.triggerQuery,vizType:r.viz_type,isDeactivatedViz:N,filterboxMigrationState:F,postTransformProps:D,datasetsStatus:_})))}}Os.propTypes=Ds,Os.defaultProps={isCached:!1,isComponentVisible:!0};var Ps=n(9531);const Ns={},js=(0,r.$j)((function({charts:e,dashboardInfo:t,dashboardState:n,dashboardLayout:i,dataMask:r,datasources:o,sliceEntities:a,nativeFilters:s,common:l},d){var c,u,h,p,f;const{id:m}=d,g=e[m]||Ns,v=g&&g.form_data&&o[g.form_data.datasource]||Ps.tw,{colorScheme:b,colorNamespace:y,datasetsStatus:C}=n,S=(null==t||null==(c=t.metadata)?void 0:c.label_colors)||{},x=(null==t||null==(u=t.metadata)?void 0:u.shared_label_colors)||{},w=function({chart:e,charts:t,filters:n,nativeFilters:i,chartConfiguration:r,colorScheme:o,colorNamespace:a,sliceId:s,layout:l,dataMask:d,labelColors:c,sharedLabelColors:u}){const h=qi[s];if(ji[s]===n&&(0,Ii.JB)(null==h?void 0:h.color_scheme,o,{ignoreUndefined:!0})&&(0,Ii.JB)(null==h?void 0:h.color_namespace,a,{ignoreUndefined:!0})&&(0,Ii.JB)(null==h?void 0:h.label_colors,c,{ignoreUndefined:!0})&&(0,Ii.JB)(null==h?void 0:h.shared_label_colors,u,{ignoreUndefined:!0})&&h&&(0,Ii.JB)(null==h?void 0:h.dataMask,d,{ignoreUndefined:!0}))return h;let p={};const f=Ni({chartConfiguration:r,dataMask:d,layout:l,nativeFilters:i.filters}),m=Object.entries(f).filter((([,{scope:t}])=>t.includes(e.id))).map((([e])=>e));m.length&&(p={extra_form_data:(0,Ei.vk)(d,t,m)});const g={...e.formData,label_colors:c,shared_label_colors:u,...o&&{color_scheme:o},extra_filters:Mi(n),...p};return ji[s]=n,qi[s]={...g,dataMask:d},g}({layout:i.present,chart:g,chartConfiguration:null==(h=t.metadata)?void 0:h.chart_configuration,charts:e,filters:(0,un._f)(m),colorScheme:b,colorNamespace:y,sliceId:m,nativeFilters:s,dataMask:r,labelColors:S,sharedLabelColors:x});return w.dashboardId=t.id,{chart:g,datasource:v,labelColors:S,sharedLabelColors:x,slice:a.slices[m],timeout:t.common.conf.SUPERSET_WEBSERVER_TIMEOUT,filters:(0,un.De)()||Ns,formData:w,editMode:n.editMode,isExpanded:!!n.expandedSlices[m],supersetCanExplore:!!t.superset_can_explore,supersetCanShare:!!t.superset_can_share,supersetCanCSV:!!t.superset_can_csv,sliceCanEdit:!!t.slice_can_edit,ownState:null==(p=r[m])?void 0:p.ownState,filterState:null==(f=r[m])?void 0:f.filterState,maxRows:l.conf.SQL_MAX_ROW,filterboxMigrationState:n.filterboxMigrationState,datasetsStatus:C}}),(function(e){return(0,i.DE)({updateComponents:xi.WZ,addSuccessToast:wi.ws,addDangerToast:wi.Gb,toggleExpandSlice:Ut.WL,changeFilter:$t.M6,setFocusedFilterField:Ut.GH,unsetFocusedFilterField:Ut.oY,refreshChart:_i.refreshChart,logEvent:ki.logEvent},e)}))(Os);var qs=n(13433);const zs={addDangerToast:s().func.isRequired,anchorLinkId:s().string,dashboardId:s().number,emailSubject:s().string,emailContent:s().string,placement:s().oneOf(["right","left","top","bottom"])};class As extends o.Component{constructor(e){super(e),this.state={shortUrl:""},this.onShortUrlSuccess=this.onShortUrlSuccess.bind(this),this.getCopyUrl=this.getCopyUrl.bind(this)}onShortUrlSuccess(e){this.setState((()=>({shortUrl:e})))}getCopyUrl(e){e.stopPropagation();const t=(0,bt.eY)(pt.KD.nativeFiltersKey);this.props.dashboardId&&(0,yt.B8)(this.props.dashboardId,t).then((e=>(0,bt.Nm)({dashboardId:this.props.dashboardId,filterState:e,hash:this.props.anchorLinkId}).then(this.onShortUrlSuccess).catch(this.props.addDangerToast))).catch(this.props.addDangerToast)}renderPopover(){const e=(0,l.t)("%s%s",this.props.emailContent,this.state.shortUrl);return(0,v.tZ)("div",{id:"shorturl-popover"},(0,v.tZ)(qs.Z,{text:this.state.shortUrl,copyNode:(0,v.tZ)("i",{className:"fa fa-clipboard",title:(0,l.t)("Copy to clipboard")})}),"",(0,v.tZ)("a",{href:`mailto:?Subject=${this.props.emailSubject}%20&Body=${e}`},(0,v.tZ)("i",{className:"fa fa-envelope"})))}render(){return(0,v.tZ)(Wa.ZP,{trigger:"click",placement:this.props.placement,onClick:this.getCopyUrl,content:this.renderPopover()},(0,v.tZ)("span",{className:"short-link-trigger btn btn-default btn-sm",role:"button"},(0,v.tZ)("i",{className:"short-link-trigger fa fa-link"}),""))}}As.defaultProps={placement:"left",emailSubject:"",emailContent:""},As.propTypes=zs;const $s=(0,ui.ZP)(As);var Us=n(56967);const Ls={anchorLinkId:s().string.isRequired,dashboardId:s().number,filters:s().object,showShortLinkButton:s().bool,inFocus:s().bool,placement:s().oneOf(["right","left","top","bottom"])};class Vs extends o.PureComponent{componentDidMount(){const e=(0,Us.Z)(),{anchorLinkId:t}=this.props;e&&t===e&&this.scrollToView()}UNSAFE_componentWillReceiveProps(e){const{inFocus:t=!1}=e;t&&this.scrollToView()}scrollToView(e=0){const{anchorLinkId:t}=this.props,n=document.getElementById(t);n&&setTimeout((()=>{n.scrollIntoView({block:"center",behavior:"smooth"})}),e)}render(){const{anchorLinkId:e,dashboardId:t,showShortLinkButton:n,placement:i}=this.props;return(0,v.tZ)("span",{className:"anchor-link-container",id:e},n&&(0,v.tZ)($s,{anchorLinkId:e,dashboardId:t,emailSubject:(0,l.t)("Superset chart"),emailContent:(0,l.t)("Check out this chart in dashboard:"),placement:i}))}}Vs.propTypes=Ls,Vs.defaultProps={inFocus:!1,showShortLinkButton:!1,placement:"right",filters:{}};const Ks=Vs,Bs=({onDelete:e})=>(0,v.tZ)(Di,{onClick:e,icon:(0,v.tZ)(ot.Z.Trash,{iconSize:"xl"})}),Ws=g.iK.div`
  .hover-menu {
    opacity: 0;
    position: absolute;
    z-index: 10;
    font-size: ${({theme:e})=>e.typography.sizes.m};
  }

  .hover-menu--left {
    width: ${({theme:e})=>6*e.gridUnit}px;
    top: 50%;
    transform: translate(0, -50%);
    left: ${({theme:e})=>-7*e.gridUnit}px;
    padding: ${({theme:e})=>2*e.gridUnit}px 0;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }

  .hover-menu--left > :nth-child(n):not(:only-child):not(:last-child) {
    margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
  }

  .hover-menu--top {
    height: ${({theme:e})=>6*e.gridUnit}px;
    top: ${({theme:e})=>-6*e.gridUnit}px;
    left: 50%;
    transform: translate(-50%);
    padding: 0 ${({theme:e})=>2*e.gridUnit}px;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: center;
  }
`;class Hs extends o.PureComponent{render(){const{innerRef:e,position:t,children:n}=this.props;return(0,v.tZ)(Ws,{className:"hover-menu-container"},(0,v.tZ)("div",{ref:e,className:m()("hover-menu","left"===t&&"hover-menu--left","top"===t&&"hover-menu--top")},n))}}Hs.defaultProps={position:"left",innerRef:null,children:null};var Gs=n(29119);const Ys={right:function(){return(0,v.tZ)("div",{className:"resize-handle resize-handle--right"})},bottom:function(){return(0,v.tZ)("div",{className:"resize-handle resize-handle--bottom"})},bottomRight:function(){return(0,v.tZ)("div",{className:"resize-handle resize-handle--bottom-right"})}},Js={top:!1,right:!0,bottom:!0,left:!1,topRight:!1,bottomRight:!0,bottomLeft:!1,topLeft:!1},Qs={widthAndHeight:Js,widthOnly:{...Js,bottomRight:!1,bottom:!1},heightOnly:{...Js,bottomRight:!1,right:!1},notAdjustable:{...Js,bottomRight:!1,bottom:!1,right:!1}},Xs=Number.MAX_VALUE,el={id:s().string.isRequired,children:s().node,adjustableWidth:s().bool,adjustableHeight:s().bool,gutterWidth:s().number,widthStep:s().number,heightStep:s().number,widthMultiple:s().number,heightMultiple:s().number,minWidthMultiple:s().number,maxWidthMultiple:s().number,minHeightMultiple:s().number,maxHeightMultiple:s().number,staticHeight:s().number,staticHeightMultiple:s().number,staticWidth:s().number,staticWidthMultiple:s().number,onResizeStop:s().func,onResize:s().func,onResizeStart:s().func,editMode:s().bool.isRequired},tl={children:null,adjustableWidth:!0,adjustableHeight:!0,gutterWidth:D.es,widthStep:D.cd,heightStep:D.cd,widthMultiple:null,heightMultiple:null,minWidthMultiple:1,maxWidthMultiple:Xs,minHeightMultiple:1,maxHeightMultiple:Xs,staticHeight:null,staticHeightMultiple:null,staticWidth:null,staticWidthMultiple:null,onResizeStop:null,onResize:null,onResizeStart:null},nl=[D.cd,D.cd],il={right:"resizable-container-handle--right",bottom:"resizable-container-handle--bottom"};class rl extends o.PureComponent{constructor(e){super(e),this.state={isResizing:!1},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this)}handleResizeStart(e,t,n){const{id:i,onResizeStart:r}=this.props;r&&r({id:i,direction:t,ref:n}),this.setState((()=>({isResizing:!0})))}handleResize(e,t,n){const{onResize:i,id:r}=this.props;i&&i({id:r,direction:t,ref:n})}handleResizeStop(e,t,n,i){const{id:r,onResizeStop:o,widthStep:a,heightStep:s,widthMultiple:l,heightMultiple:d,adjustableHeight:c,adjustableWidth:u,gutterWidth:h}=this.props;if(o){const e=l+Math.round(i.width/(a+h)),t=d+Math.round(i.height/s);o({id:r,widthMultiple:u?e:null,heightMultiple:c?t:null}),this.setState((()=>({isResizing:!1})))}}render(){const{children:e,adjustableWidth:t,adjustableHeight:n,widthStep:i,heightStep:r,widthMultiple:o,heightMultiple:a,staticHeight:s,staticHeightMultiple:l,staticWidth:d,staticWidthMultiple:c,minWidthMultiple:u,maxWidthMultiple:h,minHeightMultiple:p,maxHeightMultiple:f,gutterWidth:g,editMode:b}=this.props,y={width:t?(i+g)*o-g:c&&c*i||d||void 0,height:n?r*a:l&&l*r||s||void 0};let C=Qs.notAdjustable;b&&t&&n?C=Qs.widthAndHeight:b&&t?C=Qs.widthOnly:b&&n&&(C=Qs.heightOnly);const{isResizing:S}=this.state;return(0,v.tZ)(Gs.e,{enable:C,grid:nl,minWidth:t?u*(i+g)-g:void 0,minHeight:n?p*r:void 0,maxWidth:t?Math.max(y.width,Math.min(Xs,h*(i+g)-g)):void 0,maxHeight:n?Math.max(y.height,Math.min(Xs,f*r)):void 0,size:y,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,handleComponent:Ys,className:m()("resizable-container",S&&"resizable-container--resizing"),handleClasses:il},e)}}rl.propTypes=el,rl.defaultProps=tl;const ol=rl,al={id:s().string.isRequired,parentId:s().string.isRequired,dashboardId:s().number.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,getComponentById:s().func.isRequired,index:s().number.isRequired,depth:s().number.isRequired,editMode:s().bool.isRequired,directPathToChild:s().arrayOf(s().string),directPathLastUpdated:s().number,focusedFilterScope:s().object,fullSizeChartId:s().oneOf([s().number,null]),availableColumnCount:s().number.isRequired,columnWidth:s().number.isRequired,onResizeStart:s().func.isRequired,onResize:s().func.isRequired,onResizeStop:s().func.isRequired,deleteComponent:s().func.isRequired,updateComponents:s().func.isRequired,handleComponentDrop:s().func.isRequired,setFullSizeChartId:s().func.isRequired,postAddSliceFromDashboard:s().func},sl=o.forwardRef((({chartId:e,...t},n)=>{const i=(0,g.Fg)(),o=(0,r.v9)((e=>e.nativeFilters)),a=function(e,t){if(!e.focusedFilterField)return null;const{chartId:n,column:i}=e.focusedFilterField;return{chartId:n,scope:t[n].scopes[i]}}((0,r.v9)((e=>e.dashboardState)),(0,r.v9)((e=>e.dashboardFilters))),s=o.focusedFilterId;if(!a&&!s)return(0,v.tZ)("div",mt()({ref:n},t));const l={borderColor:i.colors.primary.light2,opacity:1,boxShadow:`0px 0px ${2*i.gridUnit}px ${i.colors.primary.base}`,pointerEvents:"auto"};var d,c;if(s){if(null!=(d=o.filters[s])&&null!=(c=d.chartsInScope)&&c.includes(e))return(0,v.tZ)("div",mt()({ref:n,style:l},t))}else if(e===a.chartId||(0,un.up)({filterScope:a.scope}).includes(e))return(0,v.tZ)("div",mt()({ref:n,style:l},t));return(0,v.tZ)("div",mt()({ref:n,style:{opacity:.3,pointerEvents:"none"}},t))}));class ll extends o.Component{static renderInFocusCSS(e){return(0,v.tZ)("style",null,`label[for=${e}] + .Select .Select__control {\n                    border-color: #00736a;\n                    transition: border-color 1s ease-in-out;\n           }`)}static getDerivedStateFromProps(e,t){const{component:n,directPathToChild:i,directPathLastUpdated:r}=e,{label:o,chart:a}=function(e){const t={};if(e.length>0){const n=e.slice();for(;n.length;){const e=n.pop(),i=e.split("-")[0];if(t[i.toLowerCase()]=e,!D.Ep.includes(i))break}}return t}(i);return r!==t.directPathLastUpdated&&n.id===a?{outlinedComponentId:n.id,outlinedColumnName:o,directPathLastUpdated:r}:null}constructor(e){super(e),this.state={isFocused:!1,outlinedComponentId:null,outlinedColumnName:null,directPathLastUpdated:0},this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateSliceName=this.handleUpdateSliceName.bind(this),this.handleToggleFullSize=this.handleToggleFullSize.bind(this),this.handlePostTransformProps=this.handlePostTransformProps.bind(this)}componentDidMount(){this.hideOutline({},this.state)}componentDidUpdate(e,t){this.hideOutline(t,this.state)}hideOutline(e,t){const{outlinedComponentId:n}=t,{outlinedComponentId:i}=e;n&&!i&&setTimeout((()=>{this.setState((()=>({outlinedComponentId:null,outlinedColumnName:null})))}),2e3)}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleUpdateSliceName(e){const{component:t,updateComponents:n}=this.props;n({[t.id]:{...t,meta:{...t.meta,sliceNameOverride:e}}})}handleToggleFullSize(){const{component:e,fullSizeChartId:t,setFullSizeChartId:n}=this.props,{chartId:i}=e.meta;n(t===i?null:i)}handlePostTransformProps(e){return this.props.postAddSliceFromDashboard(),e}render(){var e,t,n;const{isFocused:i}=this.state,{component:r,parentComponent:o,index:a,depth:s,availableColumnCount:l,columnWidth:d,onResizeStart:c,onResize:u,onResizeStop:p,handleComponentDrop:f,editMode:g,isComponentVisible:b,dashboardId:y,fullSizeChartId:C,getComponentById:S=(()=>{})}=this.props,{chartId:x}=r.meta,w=C===x,k=null==(e=S(null==(n=o.parents)?void 0:n.find((e=>e.startsWith(h.BA)))))||null==(t=e.meta)?void 0:t.width;let Z=r.meta.width||D.cx;o.type===h.BA?Z=o.meta.width||D.cx:k&&Z>k&&(Z=k);let R=0,T=0;return w?(R=window.innerWidth-32,T=window.innerHeight-32):(R=Math.floor(Z*d+(Z-1)*D.es-32),T=Math.floor(r.meta.height*D.cd-32)),(0,v.tZ)(ee,{component:r,parentComponent:o,orientation:o.type===h.Os?"column":"row",index:a,depth:s,onDrop:f,disableDragDrop:i,editMode:g},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,v.tZ)(ol,{id:r.id,adjustableWidth:o.type===h.Os,adjustableHeight:!0,widthStep:d,widthMultiple:Z,heightStep:D.cd,heightMultiple:r.meta.height,minWidthMultiple:D.cx,minHeightMultiple:D.AA,maxWidthMultiple:l+Z,onResizeStart:c,onResize:u,onResizeStop:p,editMode:g},(0,v.tZ)(sl,{chartId:x,ref:t,className:m()("dashboard-component","dashboard-component-chart-holder",this.state.outlinedComponentId?"fade-in":"fade-out",w&&"full-size")},!g&&(0,v.tZ)(Ks,{anchorLinkId:r.id,inFocus:!!this.state.outlinedComponentId}),!!this.state.outlinedComponentId&&ll.renderInFocusCSS(this.state.outlinedColumnName),(0,v.tZ)(js,{componentId:r.id,id:r.meta.chartId,dashboardId:y,width:R,height:T,sliceName:r.meta.sliceNameOverride||r.meta.sliceName||"",updateSliceName:this.handleUpdateSliceName,isComponentVisible:b,handleToggleFullSize:this.handleToggleFullSize,isFullSize:w,postTransformProps:this.handlePostTransformProps}),g&&(0,v.tZ)(Hs,{position:"top"},(0,v.tZ)("div",null,(0,v.tZ)(Bs,{onDelete:this.handleDeleteComponent})))),e&&(0,v.tZ)("div",e))))}}ll.propTypes=al,ll.defaultProps={directPathToChild:[],directPathLastUpdated:0};const dl=(0,r.$j)((function(e){return{directPathToChild:e.dashboardState.directPathToChild,directPathLastUpdated:e.dashboardState.directPathLastUpdated}}))(ll);var cl=n(78186);const ul=(0,g.iK)(ut.v.Item)`
  &.ant-menu-item {
    height: auto;
    line-height: 1.4;

    padding-top: ${({theme:e})=>e.gridUnit}px;
    padding-bottom: ${({theme:e})=>e.gridUnit}px;

    margin-top: 0;
    margin-bottom: 0;

    &:not(:last-child) {
      margin-bottom: 0;
    }

    &:hover {
      background: ${({theme:e})=>e.colors.grayscale.light3};
    }

    &.active {
      font-weight: ${({theme:e})=>e.typography.weights.bold};
      background: ${({theme:e})=>e.colors.grayscale.light2};
    }
  }

  &.ant-menu-item-selected {
    color: unset;
  }
`;var hl={name:"s5xdrg",styles:"display:flex;align-items:center"};const pl=e=>{const{value:t,options:n,onChange:i,renderButton:r=(e=>e.label),renderOption:o=(e=>(0,v.tZ)("div",{className:e.className},e.label))}=e,a=(0,g.Fg)(),s=n.find((e=>e.value===t));return(0,v.tZ)(Ze.Gj,{trigger:["click"],overlayStyle:{zIndex:a.zIndex.max},overlay:(0,v.tZ)(ut.v,{onClick:({key:e})=>i(e)},n.map((e=>(0,v.tZ)(ul,{id:"menu-item",key:e.value,className:m()("dropdown-item",{active:e.value===t})},o(e)))))},(0,v.tZ)("div",{role:"button",css:hl},s&&r(s),(0,v.tZ)(ot.Z.CaretDown,{iconColor:a.colors.grayscale.base,css:(0,v.iv)({marginTop:.5*a.gridUnit},"","")})))},fl=[{value:"edit",label:(0,l.t)("Edit")},{value:"preview",label:(0,l.t)("Preview")}];class ml extends o.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,v.tZ)(pl,{id:e,options:fl,value:t,onChange:n})}}class gl extends o.PureComponent{constructor(e){super(e),this.container=void 0,this.state={isFocused:e.isFocused},this.setRef=this.setRef.bind(this),this.handleClick=this.handleClick.bind(this)}UNSAFE_componentWillReceiveProps(e){e.editMode&&e.isFocused&&!this.state.isFocused?(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState({isFocused:!0})):this.state.isFocused&&!e.editMode&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState({isFocused:!1}))}componentWillUnmount(){document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick)}setRef(e){this.container=e}handleClick(e){if(!this.props.editMode)return;const{onChangeFocus:t,shouldFocus:n,disableClick:i}=this.props,r=n(e,this.container);i||!r||this.state.isFocused?!r&&this.state.isFocused&&(document.removeEventListener("click",this.handleClick),document.removeEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!1}))),t&&t(!1)):(document.addEventListener("click",this.handleClick),document.addEventListener("drag",this.handleClick),this.setState((()=>({isFocused:!0}))),t&&t(!0))}render(){var e;const{children:t,menuItems:n,editMode:i,style:r}=this.props,{isFocused:o}=this.state;return(0,v.tZ)("div",{ref:this.setRef,onClick:this.handleClick,role:"none",className:m()("with-popover-menu",i&&o&&"with-popover-menu--focused"),style:r},t,i&&o&&(null!=(e=null==n?void 0:n.length)?e:0)>0&&(0,v.tZ)("div",{className:"popover-menu"},n.map(((e,t)=>(0,v.tZ)("div",{className:"menu-item",key:`menu-item-${t}`},e)))))}}gl.defaultProps={children:null,disableClick:!1,onChangeFocus:null,menuItems:[],isFocused:!1,shouldFocus:(e,t)=>{var n;return(null==t?void 0:t.contains(e.target))||"menu-item"===e.target.id||"menu-item"===(null==(n=e.target.parentNode)?void 0:n.id)},style:null};const vl={id:s().string.isRequired,parentId:s().string.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,index:s().number.isRequired,depth:s().number.isRequired,editMode:s().bool.isRequired,logEvent:s().func.isRequired,addDangerToast:s().func.isRequired,undoLength:s().number.isRequired,redoLength:s().number.isRequired,availableColumnCount:s().number.isRequired,columnWidth:s().number.isRequired,onResizeStart:s().func.isRequired,onResize:s().func.isRequired,onResizeStop:s().func.isRequired,deleteComponent:s().func.isRequired,handleComponentDrop:s().func.isRequired,updateComponents:s().func.isRequired},bl="# Markdown\n## Markdown\n### Markdown\n\n<br />\n\nClick here to edit [markdown](https://bit.ly/1dQOfRK)",yl=(0,l.t)("This markdown component has an error.");class Cl extends o.PureComponent{constructor(e){super(e),this.state={isFocused:!1,markdownSource:e.component.meta.code,editor:null,editorMode:"preview",undoLength:e.undoLength,redoLength:e.redoLength},this.renderStartTime=it.Yd.getTimestamp(),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleChangeEditorMode=this.handleChangeEditorMode.bind(this),this.handleMarkdownChange=this.handleMarkdownChange.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleResizeStart=this.handleResizeStart.bind(this),this.setEditor=this.setEditor.bind(this)}componentDidMount(){this.props.logEvent(it.aD,{viz_type:"markdown",start_offset:this.renderStartTime,ts:(new Date).getTime(),duration:it.Yd.getTimestamp()-this.renderStartTime})}static getDerivedStateFromProps(e,t){const{hasError:n,editorMode:i,markdownSource:r,undoLength:o,redoLength:a}=t,{component:s,undoLength:l,redoLength:d}=e;return l!==o||d!==a?{...t,undoLength:l,redoLength:d,markdownSource:s.meta.code,hasError:!1}:n||"preview"!==i||s.meta.code===r?t:{...t,markdownSource:s.meta.code}}static getDerivedStateFromError(){return{hasError:!0}}componentDidUpdate(e){!this.state.editor||e.component.meta.width===this.props.component.meta.width&&e.columnWidth===this.props.columnWidth||this.state.editor.resize(!0),this.props.editMode&&xt.cE.preload()}componentDidCatch(){this.state.editor&&"preview"===this.state.editorMode&&this.props.addDangerToast((0,l.t)("This markdown component has an error. Please revert your recent changes."))}setEditor(e){e.getSession().setUseWrapMode(!0),this.setState({editor:e})}handleChangeFocus(e){const t=!!e,n=t?"edit":"preview";this.setState((()=>({isFocused:t}))),this.handleChangeEditorMode(n)}handleChangeEditorMode(e){const t={...this.state,editorMode:e};"preview"===e&&(this.updateMarkdownContent(),t.hasError=!1),this.setState(t)}updateMarkdownContent(){const{updateComponents:e,component:t}=this.props;t.meta.code!==this.state.markdownSource&&e({[t.id]:{...t,meta:{...t.meta,code:this.state.markdownSource}}})}handleMarkdownChange(e){this.setState({markdownSource:e})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleResizeStart(e){const{editorMode:t}=this.state,{editMode:n,onResizeStart:i}=this.props,r="edit"===t;i(e),n&&r&&this.updateMarkdownContent()}renderEditMode(){return(0,v.tZ)(xt.cE,{onChange:this.handleMarkdownChange,width:"100%",height:"100%",showGutter:!1,editorProps:{$blockScrolling:!0},value:"string"==typeof this.state.markdownSource?this.state.markdownSource:bl,readOnly:!1,onLoad:this.setEditor})}renderPreviewMode(){const{hasError:e}=this.state;return(0,v.tZ)(cl.Z,{source:e?yl:this.state.markdownSource||bl})}render(){const{isFocused:e,editorMode:t}=this.state,{component:n,parentComponent:i,index:r,depth:o,availableColumnCount:a,columnWidth:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u}=this.props,p=i.type===h.BA?i.meta.width||D.cx:n.meta.width||D.cx,f="edit"===t;return(0,v.tZ)(ee,{component:n,parentComponent:i,orientation:i.type===h.Os?"column":"row",index:r,depth:o,onDrop:c,disableDragDrop:e,editMode:u},(({dropIndicatorProps:t,dragSourceRef:r})=>(0,v.tZ)(gl,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,v.tZ)(ml,{id:`${n.id}-mode`,value:this.state.editorMode,onChange:this.handleChangeEditorMode})],editMode:u},(0,v.tZ)("div",{className:m()("dashboard-markdown",f&&"dashboard-markdown--editing"),id:n.id},(0,v.tZ)(ol,{id:n.id,adjustableWidth:i.type===h.Os,adjustableHeight:!0,widthStep:s,widthMultiple:p,heightStep:D.cd,heightMultiple:n.meta.height,minWidthMultiple:D.cx,minHeightMultiple:D.AA,maxWidthMultiple:a+p,onResizeStart:this.handleResizeStart,onResize:l,onResizeStop:d,editMode:!e&&u},(0,v.tZ)("div",{ref:r,className:"dashboard-component dashboard-component-chart-holder"},u&&(0,v.tZ)(Hs,{position:"top"},(0,v.tZ)(Bs,{onDelete:this.handleDeleteComponent})),u&&f?this.renderEditMode():this.renderPreviewMode()))),t&&(0,v.tZ)("div",t))))}}Cl.propTypes=vl,Cl.defaultProps={};const Sl=(0,r.$j)((function(e){return{undoLength:e.dashboardLayout.past.length,redoLength:e.dashboardLayout.future.length}}))(Cl);function xl({position:e="left",innerRef:t=null,dotCount:n=8}){return(0,v.tZ)("div",{ref:t,className:m()("drag-handle","left"===e&&"drag-handle--left","top"===e&&"drag-handle--top")},Array(n).fill(null).map(((e,t)=>(0,v.tZ)("div",{key:`handle-dot-${t}`,className:"drag-handle-dot"}))))}var wl=n(713);function kl(e){return(0,v.tZ)("div",{className:m()("background-style-option",e.className)},`${e.label} background`)}function Zl(e){return(0,v.tZ)("div",{className:m()("background-style-option",e.className)},e.label)}class Rl extends o.PureComponent{render(){const{id:e,value:t,onChange:n}=this.props;return(0,v.tZ)(pl,{id:e,options:wl.Z,value:t,onChange:n,renderButton:kl,renderOption:Zl})}}const Tl={id:s().string.isRequired,parentId:s().string.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,index:s().number.isRequired,depth:s().number.isRequired,editMode:s().bool.isRequired,availableColumnCount:s().number.isRequired,columnWidth:s().number.isRequired,minColumnWidth:s().number.isRequired,onResizeStart:s().func.isRequired,onResize:s().func.isRequired,onResizeStop:s().func.isRequired,deleteComponent:s().func.isRequired,handleComponentDrop:s().func.isRequired,updateComponents:s().func.isRequired};class Fl extends o.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:i,columnWidth:r,minColumnWidth:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u,onChangeTab:h,isComponentVisible:p}=this.props,f=e.children||[],g=wl.Z.find((t=>t.value===(e.meta.background||D.HE)));return(0,v.tZ)(ee,{component:e,parentComponent:t,orientation:"column",index:n,depth:a,onDrop:c,editMode:u},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,v.tZ)(ol,{id:e.id,adjustableWidth:!0,adjustableHeight:!1,widthStep:r,widthMultiple:e.meta.width,minWidthMultiple:o,maxWidthMultiple:i+(e.meta.width||0),onResizeStart:s,onResize:l,onResizeStop:d,editMode:u},(0,v.tZ)(gl,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,v.tZ)(Rl,{id:`${e.id}-background`,value:e.meta.background,onChange:this.handleChangeBackground})],editMode:u},u&&(0,v.tZ)(Hs,{innerRef:n,position:"top"},(0,v.tZ)(xl,{position:"top"}),(0,v.tZ)(Bs,{onDelete:this.handleDeleteComponent}),(0,v.tZ)(Di,{onClick:this.handleChangeFocus,icon:(0,v.tZ)(ot.Z.Cog,{iconSize:"xl"})})),(0,v.tZ)("div",{className:m()("grid-column",0===f.length&&"grid-column--empty",g.className)},f.map(((t,n)=>(0,v.tZ)(ad,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:e.meta.width,columnWidth:r,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:p,onChangeTab:h}))),t&&(0,v.tZ)("div",t))))))}}Fl.propTypes=Tl,Fl.defaultProps={};const Dl=Fl,_l={id:s().string.isRequired,parentId:s().string.isRequired,component:E.cP.isRequired,depth:s().number.isRequired,parentComponent:E.cP.isRequired,index:s().number.isRequired,editMode:s().bool.isRequired,handleComponentDrop:s().func.isRequired,deleteComponent:s().func.isRequired};class El extends o.PureComponent{constructor(e){super(e),this.handleDeleteComponent=this.handleDeleteComponent.bind(this)}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{component:e,depth:t,parentComponent:n,index:i,handleComponentDrop:r,editMode:o}=this.props;return(0,v.tZ)(ee,{component:e,parentComponent:n,orientation:"row",index:i,depth:t,onDrop:r,editMode:o},(({dropIndicatorProps:e,dragSourceRef:t})=>(0,v.tZ)("div",{ref:t},o&&(0,v.tZ)(Hs,{position:"left"},(0,v.tZ)(Bs,{onDelete:this.handleDeleteComponent})),(0,v.tZ)("div",{className:"dashboard-component dashboard-component-divider"}),e&&(0,v.tZ)("div",e))))}}El.propTypes=_l;const Il=El;var Ml=n(79271);const Ol={id:s().string.isRequired,parentId:s().string.isRequired,component:E.cP.isRequired,depth:s().number.isRequired,parentComponent:E.cP.isRequired,index:s().number.isRequired,editMode:s().bool.isRequired,filters:s().object.isRequired,handleComponentDrop:s().func.isRequired,deleteComponent:s().func.isRequired,updateComponents:s().func.isRequired};class Pl extends o.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleChangeFocus=this.handleChangeFocus.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeSize=this.handleUpdateMeta.bind(this,"headerSize"),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeText=this.handleUpdateMeta.bind(this,"text")}handleChangeFocus(e){this.setState((()=>({isFocused:e})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}render(){const{isFocused:e}=this.state,{component:t,depth:n,parentComponent:i,index:r,handleComponentDrop:o,editMode:a,filters:s}=this.props,l=Ml.Z.find((e=>e.value===(t.meta.headerSize||D.u_))),d=wl.Z.find((e=>e.value===(t.meta.background||D.HE)));return(0,v.tZ)(ee,{component:t,parentComponent:i,orientation:"row",index:r,depth:n,onDrop:o,disableDragDrop:e,editMode:a},(({dropIndicatorProps:e,dragSourceRef:i})=>(0,v.tZ)("div",{ref:i},a&&n<=2&&(0,v.tZ)(Hs,{position:"left"},(0,v.tZ)(xl,{position:"left"})),(0,v.tZ)(gl,{onChangeFocus:this.handleChangeFocus,menuItems:[(0,v.tZ)(pl,{id:`${t.id}-header-style`,options:Ml.Z,value:t.meta.headerSize,onChange:this.handleChangeSize}),(0,v.tZ)(Rl,{id:`${t.id}-background`,value:t.meta.background,onChange:this.handleChangeBackground})],editMode:a},(0,v.tZ)("div",{className:m()("dashboard-component","dashboard-component-header",l.className,d.className)},a&&(0,v.tZ)(Hs,{position:"top"},(0,v.tZ)(Bs,{onDelete:this.handleDeleteComponent})),(0,v.tZ)(st.Z,{title:t.meta.text,canEdit:a,onSaveTitle:this.handleChangeText,showTooltip:!1}),!a&&(0,v.tZ)(Ks,{anchorLinkId:t.id,filters:s,showShortLinkButton:!0}))),e&&(0,v.tZ)("div",e))))}}Pl.propTypes=Ol,Pl.defaultProps={};const Nl=Pl,jl={id:s().string.isRequired,parentId:s().string.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,index:s().number.isRequired,depth:s().number.isRequired,editMode:s().bool.isRequired,availableColumnCount:s().number.isRequired,columnWidth:s().number.isRequired,occupiedColumnCount:s().number.isRequired,onResizeStart:s().func.isRequired,onResize:s().func.isRequired,onResizeStop:s().func.isRequired,handleComponentDrop:s().func.isRequired,deleteComponent:s().func.isRequired,updateComponents:s().func.isRequired};class ql extends o.PureComponent{constructor(e){super(e),this.state={isFocused:!1},this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleUpdateMeta=this.handleUpdateMeta.bind(this),this.handleChangeBackground=this.handleUpdateMeta.bind(this,"background"),this.handleChangeFocus=this.handleChangeFocus.bind(this)}handleChangeFocus(e){this.setState((()=>({isFocused:Boolean(e)})))}handleUpdateMeta(e,t){const{updateComponents:n,component:i}=this.props;t&&i.meta[e]!==t&&n({[i.id]:{...i,meta:{...i.meta,[e]:t}}})}handleDeleteComponent(){const{deleteComponent:e,component:t,parentId:n}=this.props;e(t.id,n)}render(){const{component:e,parentComponent:t,index:n,availableColumnCount:i,columnWidth:r,occupiedColumnCount:o,depth:a,onResizeStart:s,onResize:l,onResizeStop:d,handleComponentDrop:c,editMode:u,onChangeTab:h,isComponentVisible:p}=this.props,f=e.children||[],g=wl.Z.find((t=>t.value===(e.meta.background||D.HE)));return(0,v.tZ)(ee,{component:e,parentComponent:t,orientation:"row",index:n,depth:a,onDrop:c,editMode:u},(({dropIndicatorProps:t,dragSourceRef:n})=>(0,v.tZ)(gl,{isFocused:this.state.isFocused,onChangeFocus:this.handleChangeFocus,disableClick:!0,menuItems:[(0,v.tZ)(Rl,{id:`${e.id}-background`,value:g.value,onChange:this.handleChangeBackground})],editMode:u},u&&(0,v.tZ)(Hs,{innerRef:n,position:"left"},(0,v.tZ)(xl,{position:"left"}),(0,v.tZ)(Bs,{onDelete:this.handleDeleteComponent}),(0,v.tZ)(Di,{onClick:this.handleChangeFocus,icon:(0,v.tZ)(ot.Z.Cog,{iconSize:"xl"})})),(0,v.tZ)("div",{className:m()("grid-row",0===f.length&&"grid-row--empty",g.className)},f.map(((t,n)=>(0,v.tZ)(ad,{key:t,id:t,parentId:e.id,depth:a+1,index:n,availableColumnCount:i-o,columnWidth:r,onResizeStart:s,onResize:l,onResizeStop:d,isComponentVisible:p,onChangeTab:h}))),t&&(0,v.tZ)("div",t)))))}}ql.propTypes=jl;const zl=ql,Al="RENDER_TAB",$l="RENDER_TAB_CONTENT",Ul={dashboardId:s().number.isRequired,id:s().string.isRequired,parentId:s().string.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,index:s().number.isRequired,depth:s().number.isRequired,renderType:s().oneOf([Al,$l]).isRequired,onDropOnTab:s().func,editMode:s().bool.isRequired,filters:s().object.isRequired,availableColumnCount:s().number,columnWidth:s().number,onResizeStart:s().func,onResize:s().func,onResizeStop:s().func,handleComponentDrop:s().func.isRequired,updateComponents:s().func.isRequired,setDirectPathToChild:s().func.isRequired},Ll={availableColumnCount:0,columnWidth:0,onDropOnTab(){},onResizeStart(){},onResize(){},onResizeStop(){}},Vl=g.iK.div`
  ${({isHighlighted:e,theme:{gridUnit:t,colors:n}})=>`\n    padding: ${t}px ${2*t}px;\n    margin: ${-t}px ${-2*t}px;\n    transition: box-shadow 0.2s ease-in-out;\n    ${e&&`box-shadow: 0 0 ${t}px ${n.primary.light1};`}\n  `}
`,Kl=e=>e.dropIndicatorProps&&(0,v.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),Bl=e=>e.dropIndicatorProps&&(0,v.tZ)("div",{className:"drop-indicator drop-indicator--top"});class Wl extends o.PureComponent{constructor(e){super(e),this.handleChangeText=this.handleChangeText.bind(this),this.handleDrop=this.handleDrop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}handleChangeTab({pathToTabIndex:e}){this.props.setDirectPathToChild(e)}handleChangeText(e){const{updateComponents:t,component:n}=this.props;e&&e!==n.meta.text&&t({[n.id]:{...n,meta:{...n.meta,text:e}}})}handleDrop(e){this.props.handleComponentDrop(e),this.props.onDropOnTab(e)}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}renderTabContent(){const{component:e,parentComponent:t,depth:n,availableColumnCount:i,columnWidth:r,onResizeStart:o,onResize:a,onResizeStop:s,editMode:l,isComponentVisible:d}=this.props;return(0,v.tZ)("div",{className:"dashboard-component-tabs-content"},l&&(0,v.tZ)(ee,{component:e,parentComponent:t,orientation:"column",index:0,depth:n,onDrop:this.handleTopDropTargetDrop,editMode:!0,className:"empty-droptarget"},Bl),e.children.map(((t,l)=>(0,v.tZ)(ad,{key:t,id:t,parentId:e.id,depth:n,index:l,onDrop:this.handleDrop,availableColumnCount:i,columnWidth:r,onResizeStart:o,onResize:a,onResizeStop:s,isComponentVisible:d,onChangeTab:this.handleChangeTab}))),l&&(0,v.tZ)(ee,{component:e,parentComponent:t,orientation:"column",index:e.children.length,depth:n,onDrop:this.handleDrop,editMode:!0,className:"empty-droptarget"},Kl))}renderTab(){const{component:e,parentComponent:t,index:n,depth:i,editMode:r,filters:o,isFocused:a,isHighlighted:s}=this.props;return(0,v.tZ)(ee,{component:e,parentComponent:t,orientation:"column",index:n,depth:i,onDrop:this.handleDrop,editMode:r},(({dropIndicatorProps:t,dragSourceRef:i})=>(0,v.tZ)(Vl,{isHighlighted:s,className:"dragdroppable-tab",ref:i},(0,v.tZ)(st.Z,{title:e.meta.text,defaultTitle:e.meta.defaultText,placeholder:e.meta.placeholder,canEdit:r&&a,onSaveTitle:this.handleChangeText,showTooltip:!1,editing:r&&a}),!r&&(0,v.tZ)(Ks,{anchorLinkId:e.id,dashboardId:this.props.dashboardId,filters:o,showShortLinkButton:!0,placement:n>=5?"left":"right"}),t&&(0,v.tZ)("div",t))))}render(){const{renderType:e}=this.props;return e===Al?this.renderTab():this.renderTabContent()}}function Hl({currentComponent:e,directPathToChild:t=[]}){if(!e||0===t.length||-1===t.indexOf(e.id))return-1;const n=t.findIndex((t=>t===e.id)),i=t[n+1];return e.children.indexOf(i)>=0?e.children.findIndex((e=>e===i)):-1}function Gl(e,t){const n=(e.parents||[]).slice();return n.push(e.id),n.push(e.children[t]),n}function Yl(e=[]){if(e.length>0){const t=e.slice();for(;t.length;){const e=t.pop(),n=e&&e.split("-")[0];if(!D.Ep.includes(n))return e}}return null}Wl.propTypes=Ul,Wl.defaultProps=Ll;const Jl={id:s().string.isRequired,parentId:s().string.isRequired,component:E.cP.isRequired,parentComponent:E.cP.isRequired,index:s().number.isRequired,depth:s().number.isRequired,renderTabContent:s().bool,editMode:s().bool.isRequired,renderHoverMenu:s().bool,directPathToChild:s().arrayOf(s().string),filterboxMigrationState:Re.Qi,logEvent:s().func.isRequired,setActiveTabs:s().func,availableColumnCount:s().number,columnWidth:s().number,onResizeStart:s().func,onResize:s().func,onResizeStop:s().func,createComponent:s().func.isRequired,handleComponentDrop:s().func.isRequired,onChangeTab:s().func.isRequired,deleteComponent:s().func.isRequired,updateComponents:s().func.isRequired},Ql={renderTabContent:!0,renderHoverMenu:!0,availableColumnCount:0,columnWidth:0,directPathToChild:[],filterboxMigrationState:Re.Qi.NOOP,setActiveTabs(){},onResizeStart(){},onResize(){},onResizeStop(){}},Xl=g.iK.div`
  width: 100%;
  background-color: ${({theme:e})=>e.colors.grayscale.light5};

  .dashboard-component-tabs-content {
    min-height: ${({theme:e})=>12*e.gridUnit}px;
    margin-top: ${({theme:e})=>e.gridUnit/4}px;
    position: relative;
  }

  .ant-tabs {
    overflow: visible;

    .ant-tabs-nav-wrap {
      min-height: ${({theme:e})=>12.5*e.gridUnit}px;
    }

    .ant-tabs-content-holder {
      overflow: visible;
    }
  }

  div .ant-tabs-tab-btn {
    text-transform: none;
  }
`;class ed extends o.PureComponent{constructor(e){super(e),this.showDeleteConfirmModal=e=>{const{component:t,deleteComponent:n}=this.props;Ze.xT.confirm({title:(0,l.t)("Delete dashboard tab?"),content:(0,v.tZ)("span",null,"Deleting a tab will remove all content within it. You may still reverse this action with the ",(0,v.tZ)("b",null,"undo")," button (cmd + z) until you save your changes."),onOk:()=>{n(e,t.id);const i=t.children.indexOf(e);this.handleDeleteTab(i)},okType:"danger",okText:"DELETE",cancelText:"CANCEL",icon:null})},this.handleEdit=(e,t)=>{const{component:n,createComponent:i}=this.props;"add"===t?i({destination:{id:n.id,type:n.type,index:n.children.length},dragging:{id:D.Xk,type:h.gn}}):"remove"===t&&this.showDeleteConfirmModal(e)};const t=Math.max(0,Hl({currentComponent:e.component,directPathToChild:e.directPathToChild})),{children:n}=e.component,i=n[t];this.state={tabIndex:t,activeKey:i},this.handleClickTab=this.handleClickTab.bind(this),this.handleDeleteComponent=this.handleDeleteComponent.bind(this),this.handleDeleteTab=this.handleDeleteTab.bind(this),this.handleDropOnTab=this.handleDropOnTab.bind(this),this.handleDrop=this.handleDrop.bind(this)}componentDidMount(){this.props.setActiveTabs(this.state.activeKey)}componentDidUpdate(e,t){t.activeKey===this.state.activeKey&&e.filterboxMigrationState===this.props.filterboxMigrationState||this.props.setActiveTabs(this.state.activeKey,t.activeKey)}UNSAFE_componentWillReceiveProps(e){const t=Math.max(0,e.component.children.length-1),n=this.props.component.children,i=e.component.children;if(this.state.tabIndex>t&&this.setState((()=>({tabIndex:t}))),i.length){const e=i[i.length-1];i.length>n.length&&this.setState((()=>({activeKey:e,tabIndex:t}))),i.length<n.length&&this.setState((()=>({activeKey:i[0]})))}if(e.isComponentVisible&&Yl(e.directPathToChild)!==Yl(this.props.directPathToChild)){const t=Hl({currentComponent:e.component,directPathToChild:e.directPathToChild});t>-1&&t!==this.state.tabIndex&&this.setState((()=>({tabIndex:t,activeKey:i[t]})))}}handleClickTab(e){const{component:t}=this.props,{children:n}=t;if(e!==this.state.tabIndex){const n=Gl(t,e),i=n[n.length-1];this.props.logEvent(it.Iq,{target_id:i,index:e}),this.props.onChangeTab({pathToTabIndex:n})}this.setState((()=>({activeKey:n[e]})))}handleDeleteComponent(){const{deleteComponent:e,id:t,parentId:n}=this.props;e(t,n)}handleDeleteTab(e){this.handleClickTab(Math.max(0,e-1))}handleDropOnTab(e){const{component:t}=this.props,{destination:n}=e;if(n){const e=n.id===t.id?n.index:t.children.indexOf(n.id);e>-1&&setTimeout((()=>{this.handleClickTab(e)}),30)}}handleDrop(e){e.dragging.type!==h.yR&&this.props.handleComponentDrop(e)}render(){const{depth:e,component:t,parentComponent:n,index:i,availableColumnCount:r,columnWidth:o,onResizeStart:a,onResize:s,onResizeStop:l,renderTabContent:d,renderHoverMenu:c,isComponentVisible:u,editMode:h,nativeFilters:p}=this.props,{children:f}=t,{tabIndex:m,activeKey:g}=this.state;let b;return null!=p&&p.focusedFilterId&&(b=p.filters[p.focusedFilterId].tabsInScope),(0,v.tZ)(ee,{component:t,parentComponent:n,orientation:"row",index:i,depth:e,onDrop:this.handleDrop,editMode:h},(({dropIndicatorProps:i,dragSourceRef:p})=>(0,v.tZ)(Xl,{className:"dashboard-component dashboard-component-tabs"},h&&c&&(0,v.tZ)(Hs,{innerRef:p,position:"left"},(0,v.tZ)(xl,{position:"left"}),(0,v.tZ)(Bs,{onDelete:this.handleDeleteComponent})),(0,v.tZ)(y.cl,{id:t.id,activeKey:g,onChange:e=>{this.handleClickTab(f.indexOf(e))},onEdit:this.handleEdit,type:h?"editable-card":"card"},f.map(((n,i)=>{var c;return(0,v.tZ)(y.cl.TabPane,{key:n,tab:(0,v.tZ)(ad,{id:n,parentId:t.id,depth:e,index:i,renderType:Al,availableColumnCount:r,columnWidth:o,onDropOnTab:this.handleDropOnTab,isFocused:g===n,isHighlighted:g!==n&&(null==(c=b)?void 0:c.includes(n))})},d&&(0,v.tZ)(ad,{id:n,parentId:t.id,depth:e,index:i,renderType:$l,availableColumnCount:r,columnWidth:o,onResizeStart:a,onResize:s,onResizeStop:l,onDropOnTab:this.handleDropOnTab,isComponentVisible:m===i&&u}))}))),i&&n.id!==D._4&&(0,v.tZ)("div",i))))}}ed.propTypes=Jl,ed.defaultProps=Ql;const td=(0,r.$j)((function(e){return{nativeFilters:e.nativeFilters,directPathToChild:e.dashboardState.directPathToChild,filterboxMigrationState:e.dashboardState.filterboxMigrationState}}))(ed),nd={[h.dW]:dl,[h.xh]:Sl,[h.BA]:Dl,[h.hE]:Il,[h.Nc]:Nl,[h.Os]:zl,[h.gn]:Wl,[h.yR]:td,[h.t]:({component:e,parentComponent:t,index:n,depth:i,handleComponentDrop:a,editMode:s,columnWidth:d,availableColumnCount:c,onResizeStart:u,onResizeStop:p,onResize:f,deleteComponent:g,parentId:b,updateComponents:y,id:C})=>{const S=t.type===h.BA?t.meta.width||D.cx:e.meta.width||D.cx,x=()=>{g(C,b)},w=wl.Z.find((t=>t.value===(e.meta.background||D.HE))),{Component:k}=We.get(e.meta.componentKey),Z=(0,r.v9)((({nativeFilters:e,dataMask:t})=>({nativeFilters:e,dataMask:t})));return(0,v.tZ)(ee,{component:e,parentComponent:t,orientation:t.type===h.Os?"column":"row",index:n,depth:i,onDrop:a,editMode:s},(({dropIndicatorProps:n,dragSourceRef:i})=>(0,v.tZ)(gl,{menuItems:[(0,v.tZ)(Rl,{id:`${e.id}-background`,value:e.meta.background,onChange:t=>{return"background",n=t,void y({[e.id]:{...e,meta:{...e.meta,background:n}}});var n}})],editMode:s},(0,v.tZ)("div",{className:m()("dashboard-component",`dashboard-${e.componentKey}`,null==w?void 0:w.className),id:e.id},(0,v.tZ)(ol,{id:e.id,adjustableWidth:t.type===h.Os,widthStep:d,widthMultiple:S,heightStep:D.cd,adjustableHeight:!1,heightMultiple:e.meta.height,minWidthMultiple:D.cx,minHeightMultiple:D.cx,maxWidthMultiple:c+S,onResizeStart:u,onResize:f,onResizeStop:p},(0,v.tZ)("div",{ref:i,className:"dashboard-component"},s&&(0,v.tZ)(Hs,{position:"top"},(0,v.tZ)(Bs,{onDelete:x})),(0,v.tZ)(o.Suspense,{fallback:(0,v.tZ)("div",null,(0,l.t)("Loading..."))},(0,v.tZ)(k,{dashboardData:Z}))))),n&&(0,v.tZ)("div",n))))}};var id=n(72673);const rd={id:s().string,parentId:s().string,depth:s().number,index:s().number,renderHoverMenu:s().bool,renderTabContent:s().bool,onChangeTab:s().func,component:E.cP.isRequired,parentComponent:E.cP.isRequired,createComponent:s().func.isRequired,deleteComponent:s().func.isRequired,updateComponents:s().func.isRequired,handleComponentDrop:s().func.isRequired,logEvent:s().func.isRequired,directPathToChild:s().arrayOf(s().string),directPathLastUpdated:s().number,dashboardId:s().number.isRequired,isComponentVisible:s().bool};class od extends o.PureComponent{render(){const{component:e}=this.props,t=e?nd[e.type]:null;return t?(0,v.tZ)(t,this.props):null}}od.propTypes=rd,od.defaultProps={isComponentVisible:!0};const ad=(0,r.$j)((function({dashboardLayout:e,dashboardState:t,dashboardInfo:n},i){const r=e.present,{id:o,parentId:a}=i,s=r[o],l={component:s,getComponentById:e=>r[e],parentComponent:r[a],editMode:t.editMode,filters:(0,un.De)(),dashboardId:n.id,fullSizeChartId:t.fullSizeChartId};if(s){const e=s.type;if(e===h.Os||e===h.BA){const{occupiedWidth:t,minimumWidth:n}=(0,id.Z)({id:o,components:r});e===h.Os&&(l.occupiedColumnCount=t),e===h.BA&&(l.minColumnWidth=n)}}return l}),(function(e){return(0,i.DE)({addDangerToast:wi.Gb,createComponent:xi.LM,deleteComponent:xi.v7,updateComponents:xi.WZ,handleComponentDrop:xi._p,setDirectPathToChild:Ut.E2,setFullSizeChartId:Ut.zL,setActiveTabs:Ut.$_,logEvent:ki.logEvent,postAddSliceFromDashboard:Ut.Cd},e)}))(od);var sd,ld=n(5977),dd=n(90057),cd=n(8868),ud=n(94301),hd=n(6954);!function(e){e.AllFilters="allFilters",e.FilterSets="filterSets"}(sd||(sd={}));const pd=e=>Object.values(e).reduce(((e,t)=>({...e,[t.id]:t.extraFormData})),{}),fd=(e,t)=>{var n;const i=null==t?void 0:t.value;return(null==(n=e.controlValues)?void 0:n.enableEmptyFilter)&&null==i};var md=n(52794),gd=n(24350),vd=n.n(gd),bd=n(63105),yd=n.n(bd),Cd=n(37936);const Sd=()=>(0,r.v9)((e=>e.nativeFilters.filterSets||{})),xd=()=>{const e=(0,r.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.preselectNativeFilters})),t=(0,r.v9)((e=>e.nativeFilters.filters));return(0,o.useMemo)((()=>Object.entries(t).reduce(((t,[n,i])=>({...t,[n]:{...i,preselect:null==e?void 0:e[n]}})),{})),[t,e])},wd=()=>{const e=(0,r.v9)((e=>e.dataMask));return(0,o.useMemo)((()=>Object.values(e).filter((e=>String(e.id).startsWith(ca.rW))).reduce(((e,t)=>({...e,[t.id]:t})),{})),[e])},kd=(e,t)=>{const n=Sd(),i=Object.values(n),r=(0,o.useMemo)((()=>!!i.find((({name:t})=>t===e))),[i,e]);return t!==e&&r},Zd=g.iK.div`
  display: flex;
  & button {
    ${({disabled:e})=>"pointer-events: "+(e?"none":"all")};
    flex: 1;
  }
`,Rd=g.iK.div`
  display: grid;
  flex-direction: row;
  justify-content: center;
  align-items: center;
  grid-gap: 10px;
  grid-template-columns: 1fr 1fr;
`,Td=({onCancel:e,editMode:t,onEdit:n,onCreate:i,disabled:r,filterSetName:a})=>{const s=kd(a),d=!a||s||r;return(0,v.tZ)(o.Fragment,null,t?(0,v.tZ)(Rd,null,(0,v.tZ)(at.Z,{buttonStyle:"tertiary",buttonSize:"small",onClick:e},(0,l.t)("Cancel")),(0,v.tZ)(Wn.u,{placement:"right",title:!a&&(0,l.t)("Please filter set name")||s&&(0,l.t)("Filter set with this name already exists")||r&&rs},(0,v.tZ)(Zd,{disabled:d},(0,v.tZ)(at.Z,mt()({disabled:d,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:i},au("create-filter-set-button")),(0,l.t)("Create"))))):(0,v.tZ)(Wn.u,{placement:"bottom",title:r&&rs},(0,v.tZ)(Zd,{disabled:r},(0,v.tZ)(at.Z,mt()({disabled:r,buttonStyle:"tertiary",buttonSize:"small",onClick:n},au("new-filter-set-button")),(0,l.t)("Create new filter set")))))},Fd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"};var Dd=function(e,t){return o.createElement(qa.Z,Object.assign({},e,{ref:t,icon:Fd}))};Dd.displayName="CheckOutlined";const _d=o.forwardRef(Dd),Ed={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M176 511a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0zm280 0a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"ellipsis",theme:"outlined"};var Id=function(e,t){return o.createElement(qa.Z,Object.assign({},e,{ref:t,icon:Ed}))};Id.displayName="EllipsisOutlined";const Md=o.forwardRef(Id),Od=g.iK.div`
  display: flex;
  align-items: center;
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
`,Pd=(0,g.iK)(Ze.Ol)`
  &.ant-collapse-ghost > .ant-collapse-item {
    & > .ant-collapse-content > .ant-collapse-content-box {
      padding: 0;
      padding-top: 0;
      padding-bottom: 0;
      font-size: ${({theme:e})=>e.typography.sizes.s}px;
    }
    & > .ant-collapse-header {
      padding: 0;
      display: flex;
      align-items: center;
      flex-direction: row-reverse;
      justify-content: flex-end;
      max-width: max-content;
      & .ant-collapse-arrow {
        position: static;
        padding-left: ${({theme:e})=>e.gridUnit}px;
      }
  }
`,Nd=g.iK.div`
  padding-top: ${({theme:e})=>e.gridUnit}px;
  padding-bottom: ${({theme:e})=>e.gridUnit}px;
`,jd=({dataMask:e,filterSet:t})=>{const n=(0,g.Fg)(),i=xd(),r=Object.values(i).filter(wr.kI);let o=null!=r?r:[];return null!=t&&t.nativeFilters&&(o=Object.values(null==t?void 0:t.nativeFilters).filter(wr.kI)),(0,v.tZ)(Pd,{ghost:!0,expandIconPosition:"right",defaultActiveKey:t?void 0:["filters"],expandIcon:({isActive:e})=>{const t=n.colors.grayscale.base,i=e?ot.Z.CaretUpOutlined:ot.Z.CaretDownOutlined;return(0,v.tZ)(i,{iconColor:t})}},(0,v.tZ)(Ze.Ol.Panel,mt()({},au("collapse-filter-set-description"),{header:(0,v.tZ)(Od,null,(0,v.tZ)(Ze.ZT.Text,{type:"secondary"},(0,l.t)("Filters (%d)",o.length))),key:"filters"}),o.map((({id:n,name:r})=>{var o,a,s,d,c;const u=t&&!(0,Ii.JB)(null==(o=i[n])?void 0:o.controlValues,null==t||null==(a=t.nativeFilters)||null==(s=a[n])?void 0:s.controlValues,{ignoreUndefined:!0}),h=!Object.keys(i).includes(n);return(0,v.tZ)(Ze._e,{title:h&&(0,l.t)("This filter doesn't exist in dashboard. It will not be applied.")||u&&(0,l.t)("Filter metadata changed in dashboard. It will not be applied."),placement:"bottomLeft",key:n},(0,v.tZ)(Nd,null,(0,v.tZ)(Ze.ZT.Text,{strong:!0,delete:h,mark:u},r,":"),(0,v.tZ)(Ze.ZT.Text,{delete:h,mark:u},os(null==e||null==(d=e[n])||null==(c=d.filterState)?void 0:c.value)||(0,v.tZ)(Ze.ZT.Text,{type:"secondary"},(0,l.t)("None")))))}))))},qd=(0,g.iK)(at.Z)`
  padding: 0;
`,zd=g.iK.div`
  display: flex;
  justify-content: space-between;
  align-items: center;
`,Ad=g.iK.div`
  display: flex;
  justify-content: flex-end;
  align-items: center;
  & > *,
  & > button.superset-button {
    ${({theme:e})=>`margin-left: ${2*e.gridUnit}px`};
  }
`,$d=({editMode:e,setFilterSetName:t,onDelete:n,onEdit:i,filterSetName:r,dataMaskSelected:a,filterSet:s,isApplied:d,onRebuild:c})=>{var u,h;const p=(0,g.Fg)(),f=(0,v.tZ)(ut.v,null,(0,v.tZ)(ut.v.Item,{onClick:i},(0,l.t)("Edit")),(0,v.tZ)(ut.v.Item,{onClick:c},(0,v.tZ)(Wn.u,{placement:"right",title:(0,l.t)("Remove invalid filters")},(0,l.t)("Rebuild"))),(0,v.tZ)(ut.v.Item,{onClick:n,danger:!0},(0,l.t)("Delete")));return(0,v.tZ)(o.Fragment,null,(0,v.tZ)(zd,null,(0,v.tZ)(Ze.ZT.Text,{strong:!0,editable:{editing:e,icon:(0,v.tZ)("span",null),onChange:t}},null!=(u=null==s?void 0:s.name)?u:r),(0,v.tZ)(Ad,null,d&&(0,v.tZ)(_d,{style:{color:p.colors.success.base}}),n&&(0,v.tZ)(Ze.Gj,{overlay:f,placement:"bottomRight",trigger:["click"]},(0,v.tZ)(qd,mt()({onClick:e=>{e.stopPropagation(),e.preventDefault()}},au("filter-set-menu-button"),{buttonStyle:"link",buttonSize:"xsmall"}),(0,v.tZ)(Md,null))))),(0,v.tZ)(jd,{filterSet:s,dataMask:null!=(h=null==s?void 0:s.dataMask)?h:a}))},Ud=g.iK.div`
  display: grid;
  align-items: center;
  justify-content: center;
  grid-template-columns: 1fr;
  // 108px padding to make room for buttons with position: absolute
  padding-bottom: ${({theme:e})=>27*e.gridUnit}px;

  & button.superset-button {
    margin-left: 0;
  }
  & input {
    width: 100%;
  }
`,Ld=g.iK.div`
  ${({theme:e,"data-selected":t,onClick:n})=>`\n    display: grid;\n    align-items: center;\n    justify-content: center;\n    grid-template-columns: 1fr;\n    grid-gap: ${e.gridUnit}px;\n    border-bottom: 1px solid ${e.colors.grayscale.light2};\n    padding: ${2*e.gridUnit}px ${4*e.gridUnit}px;\n    cursor: ${n?"pointer":"auto"};\n    background: ${t?e.colors.primary.light5:"transparent"};\n  `}
`,Vd=(0,l.t)("New filter set"),Kd=({dataMaskSelected:e,onEditFilterSet:t,disabled:n,onFilterSelectionChange:i,tab:a})=>{const s=(0,r.I0)(),[l,d]=(0,o.useState)(Vd),[c,u]=(0,o.useState)(!1),h=wd(),p=Sd(),f=Object.values(p),m=xd(),g=Object.values(m),[b,y]=(0,o.useState)(null);(0,o.useEffect)((()=>{var t;if(a===sd.AllFilters)return;if(!f.length)return void y(null);const n=as({dataMaskSelected:e,filterSetFilterValues:f});y(null!=(t=null==n?void 0:n.id)?t:null)}),[a,e,f]);const C=(e,t)=>{var n,i,r;return!g.find((t=>(null==t?void 0:t.id)===e))||!(0,Ii.JB)(null==(n=m[e])?void 0:n.controlValues,null==t||null==(i=t.nativeFilters)||null==(r=i[e])?void 0:r.controlValues,{ignoreUndefined:!0})},S=(e,t)=>{var n;const r=null==t?void 0:t.target;if(r){var o;const e=r.closest(`[data-anchor=${au("filter-set-wrapper",!0)}]`);if(null!=e&&null!=(o=e.querySelector(".ant-collapse-header"))&&o.contains(r)||null!=r&&r.closest(".ant-dropdown"))return}if(y(e),!e)return;const a=p[e];(null!=(n=Object.values(null==a?void 0:a.dataMask))?n:[]).forEach((e=>{const{extraFormData:t,filterState:n,id:r}=e;C(r,a)||i({id:r},{extraFormData:t,filterState:n})}))};return(0,v.tZ)(Ud,null,!b&&(0,v.tZ)(Ld,null,(0,v.tZ)($d,{dataMaskSelected:e,editMode:c,setFilterSetName:d,filterSetName:l}),(0,v.tZ)(Td,{filterSetName:l.trim(),disabled:n,onCancel:()=>{u(!1),d(Vd)},editMode:c,onEdit:()=>u(!0),onCreate:()=>{const e={name:l.trim(),nativeFilters:m,dataMask:Object.keys(m).reduce(((e,t)=>({...e,[t]:h[t]})),{})};s((0,md.xQ)(e)),u(!1),d(Vd)}})),f.map((i=>(0,v.tZ)(Ld,mt()({},au("filter-set-wrapper"),{"data-anchor":au("filter-set-wrapper",!0),"data-selected":i.id===b,onClick:e=>S(i.id,e),key:i.id}),(0,v.tZ)($d,{isApplied:i.id===b&&!n,onDelete:()=>{return e=i.id,s((0,md.$l)(e)),void(e===b&&y(null));var e},onEdit:()=>{return e=i.id,S(e),void t(e);var e},onRebuild:()=>(e=>{var t;const n=p[e],i=Object.values(null!=(t=null==n?void 0:n.dataMask)?t:{}).filter((e=>{const{id:t}=e;return!C(t,n)})).reduce(((e,t)=>({...e,[t.id]:m[t.id]})),{}),r={...n,nativeFilters:i,dataMask:Object.keys(i).reduce(((e,t)=>{var i;return{...e,[t]:null==(i=n.dataMask)?void 0:i[t]}}),{})};s((0,md.ql)(r))})(i.id),dataMaskSelected:e,filterSet:i})))))},Bd={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M464 720a48 48 0 1096 0 48 48 0 10-96 0zm16-304v184c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V416c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8zm475.7 440l-416-720c-6.2-10.7-16.9-16-27.7-16s-21.6 5.3-27.7 16l-416 720C56 877.4 71.4 904 96 904h832c24.6 0 40-26.6 27.7-48zm-783.5-27.9L512 239.9l339.8 588.2H172.2z"}}]},name:"warning",theme:"outlined"};var Wd=function(e,t){return o.createElement(qa.Z,Object.assign({},e,{ref:t,icon:Bd}))};Wd.displayName="WarningOutlined";const Hd=o.forwardRef(Wd),Gd=g.iK.div`
  display: grid;
  grid-template-columns: 1fr;
  align-items: flex-start;
  justify-content: flex-start;
  grid-gap: ${({theme:e})=>e.gridUnit}px;
  background: ${({theme:e})=>e.colors.primary.light4};
  padding: ${({theme:e})=>2*e.gridUnit}px;
`,Yd=(0,g.iK)(Ze.ZT.Text)`
  color: ${({theme:e})=>e.colors.primary.dark2};
`,Jd=(0,g.iK)(Ze.ZT.Text)`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  & .anticon {
    padding: ${({theme:e})=>e.gridUnit}px;
  }
`,Qd=g.iK.div`
  display: flex;
  & button {
    ${({disabled:e})=>"pointer-events: "+(e?"none":"all")};
    flex: 1;
  }
`,Xd=({filterSetId:e,onCancel:t,dataMaskSelected:n,disabled:i})=>{const a=wd(),s=(0,r.I0)(),d=Sd(),c=xd(),u=Object.values(d),[h,p]=(0,o.useState)(d[e].name),f=kd(h,d[e].name),m=(0,o.useMemo)((()=>as({dataMaskSelected:n,filterSetFilterValues:u})),[n,u]),g=m&&m.id!==e,b=i||g||f;return(0,v.tZ)(Gd,null,(0,v.tZ)(Yd,{strong:!0},(0,l.t)("Editing filter set:")),(0,v.tZ)(Yd,{editable:{editing:!0,icon:(0,v.tZ)("span",null),onChange:p}},h),(0,v.tZ)(Rd,null,(0,v.tZ)(at.Z,{ghost:!0,buttonStyle:"tertiary",buttonSize:"small",onClick:t},(0,l.t)("Cancel")),(0,v.tZ)(Ze._e,{placement:"right",title:f&&(0,l.t)("Filter set with this name already exists")||g&&(0,l.t)("Filter set already exists")||i&&rs},(0,v.tZ)(Qd,{disabled:b},(0,v.tZ)(at.Z,mt()({disabled:b,buttonStyle:"primary",htmlType:"submit",buttonSize:"small",onClick:()=>{s((0,md.ql)({id:e,name:h,nativeFilters:c,dataMask:{...a}})),t()}},au("filter-set-edit-save")),(0,l.t)("Save"))))),g&&(0,v.tZ)(Jd,{mark:!0},(0,v.tZ)(Hd,null),(0,l.t)('This filter set is identical to: "%s"',null==m?void 0:m.name)))},ec=(0,g.iK)(at.Z)`
  padding: 0;
`,tc=({createNewOnOpen:e,dashboardId:t,children:n})=>{const i=(0,r.I0)(),[a,s]=(0,o.useState)(!1);function l(){s(!1)}return(0,v.tZ)(o.Fragment,null,(0,v.tZ)(ec,mt()({},au("create-filter"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>s(!0)}),n),(0,v.tZ)(ba,{isOpen:a,onSave:async function(e){i(await(0,md.RY)(e)),l()},onCancel:l,createNewOnOpen:e,key:`filters-for-${t}`}))},nc=g.iK.h4`
  display: flex;
  flex-direction: row;
  justify-content: space-between;
  margin: 0;
  padding: ${({theme:e})=>2*e.gridUnit}px;

  & > span {
    flex-grow: 1;
  }
`,ic=(0,g.iK)(at.Z)`
  padding: 0;
`,rc=g.iK.div`
  padding: ${({theme:e})=>e.gridUnit}px
    ${({theme:e})=>2*e.gridUnit}px;
`,oc=g.iK.div`
  ${({theme:e})=>v.iv`
    margin-top: ${2*e.gridUnit}px;

    & button > [role='img']:first-of-type {
      margin-right: ${e.gridUnit}px;
      line-height: 0;
    }

    span[role='img'] {
      padding-bottom: 1px;
    }

    .ant-btn > .anticon + span {
      margin-left: 0;
    }
  `}
`,ac=({toggleFiltersBar:e})=>{const t=(0,g.Fg)(),n=xd(),i=Object.values(n),o=(0,r.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),a=(0,r.v9)((({dashboardInfo:e})=>e.id));return(0,v.tZ)(rc,null,(0,v.tZ)(nc,null,(0,v.tZ)("span",null,(0,l.t)("Filters")),(0,v.tZ)(ic,mt()({},au("collapse-button"),{buttonStyle:"link",buttonSize:"xsmall",onClick:()=>e(!1)}),(0,v.tZ)(ot.Z.Expand,{iconColor:t.colors.grayscale.base}))),o&&(0,v.tZ)(oc,null,(0,v.tZ)(tc,{dashboardId:a,createNewOnOpen:0===i.length},(0,v.tZ)(ot.Z.PlusSmall,null)," ",(0,l.t)("Add/Edit Filters"))))};var sc,lc=n(90731),dc=(sc=function(e,t){return sc=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},sc(e,t)},function(e,t){function n(){this.constructor=e}sc(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}),cc="html",uc="svg",hc=function(e){var t,n,i,r={};if(e===cc)i=document.createElement("div");else{if(e!==uc)throw new Error('Invalid element type "'+e+'" for createPortalNode: must be "html" or "svg".');i=document.createElementNS("http://www.w3.org/2000/svg","g")}var o={element:i,elementType:e,setPortalProps:function(e){r=e},getInitialPortalProps:function(){return r},mount:function(i,r){if(r!==n){if(o.unmount(),i!==t&&!function(e,t){if(t===cc)return e instanceof HTMLElement;if(t===uc)return e instanceof SVGElement;throw new Error('Unrecognized element type "'+t+'" for validateElementType.')}(i,e))throw new Error('Invalid element type for portal: "'+e+'" portalNodes must be used with '+e+" elements, but OutPortal is within <"+i.tagName+">.");i.replaceChild(o.element,r),t=i,n=r}},unmount:function(e){e&&e!==n||t&&n&&(t.replaceChild(n,o.element),t=void 0,n=void 0)}};return o},pc=function(e){function t(t){var n=e.call(this,t)||this;return n.addPropsChannel=function(){Object.assign(n.props.node,{setPortalProps:function(e){n.setState({nodeProps:e})}})},n.state={nodeProps:n.props.node.getInitialPortalProps()},n}return dc(t,e),t.prototype.componentDidMount=function(){this.addPropsChannel()},t.prototype.componentDidUpdate=function(){this.addPropsChannel()},t.prototype.render=function(){var e=this,t=this.props,n=t.children,i=t.node;return lc.createPortal(o.Children.map(n,(function(t){return o.isValidElement(t)?o.cloneElement(t,e.state.nodeProps):t})),i.element)},t}(o.PureComponent),fc=function(e){function t(t){var n=e.call(this,t)||this;return n.placeholderNode=o.createRef(),n.passPropsThroughPortal(),n}return dc(t,e),t.prototype.passPropsThroughPortal=function(){var e=Object.assign({},this.props,{node:void 0});this.props.node.setPortalProps(e)},t.prototype.componentDidMount=function(){var e=this.props.node;this.currentPortalNode=e;var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentDidUpdate=function(){var e=this.props.node;this.currentPortalNode&&e!==this.currentPortalNode&&(this.currentPortalNode.unmount(this.placeholderNode.current),this.currentPortalNode=e);var t=this.placeholderNode.current,n=t.parentNode;e.mount(n,t),this.passPropsThroughPortal()},t.prototype.componentWillUnmount=function(){this.props.node.unmount(this.placeholderNode.current)},t.prototype.render=function(){return o.createElement("div",{ref:this.placeholderNode})},t}(o.PureComponent),mc=hc.bind(null,cc),gc=(hc.bind(null,uc),n(28368)),vc=n.n(gc);const bc=x()(((e,t)=>{e(t?(0,md.$7)(t):(0,md.Up)())}),300),yc=g.iK.div`
  & > div {
    height: auto !important;
    min-height: ${32}px;
  }
`,Cc=[{data:[{}]}],Sc=[Wi.cg.NATIVE_FILTER],xc=({dataMaskSelected:e,filter:t,directPathToChild:n,onFilterSelectionChange:i,inView:a=!0,showOverflow:s,parentRef:c,setFilterActive:h})=>{var p,f,m;const{id:g,targets:b,filterType:y,adhoc_filters:C,time_range:S}=t,x=(0,Bi.Z)().get(y),w=function(e,t){const n=(0,r.v9)((t=>{var n;return null==(n=t.nativeFilters.filters[e])?void 0:n.cascadeParentIds}));return(0,o.useMemo)((()=>{let e={};return(0,lr.Z)(n).forEach((n=>{const i=null==t?void 0:t[n];e=(0,Ei.on)(e,null==i?void 0:i.extraFormData)})),e}),[t,n])}(g,e),k=(()=>{const e=(0,r.v9)((e=>e.dashboardState.isRefreshing)),t=(0,r.v9)((e=>e.dashboardState.isFiltersRefreshing));return!e&&t})(),[Z,R]=(0,o.useState)([]),[T,F]=(0,o.useState)(""),[D,_]=(0,o.useState)({inView:!1}),[E,I]=(0,o.useState)({}),[M,O]=(0,o.useState)(a),P=(0,o.useRef)(null),[N]=b,{datasetId:j,column:q={}}=N,{name:z}=q,A=!!j,[$,U]=(0,o.useState)(A),[L,V]=(0,o.useState)(!1),K=(0,r.I0)(),B=(0,o.useCallback)((()=>{V(!1),U(!1),k&&K((0,Ut.YC)())}),[K,k]);(0,o.useEffect)((()=>{!M&&a&&O(!0)}),[a,M,O]),(0,o.useEffect)((()=>{var e;if(!M)return;const n=(0,Ei.zi)({...t,datasetId:j,dependencies:w,groupby:z,adhoc_filters:C,time_range:S}),i=(null==(e=t.dataMask)?void 0:e.ownState)||{};if(!L&&(!vc()(D,n,((e,t,n)=>"url_params"===n||void 0))||!$i()(E,i)||k)){if(_(n),I(i),!A)return;V(!0),(0,_i.getChartDataRequest)({formData:n,force:!1,requestParams:{dashboardId:0},ownState:i}).then((({response:e,json:t})=>{if((0,rt.cr)(d.T.GLOBAL_ASYNC_QUERIES)){const n="result"in t?t.result[0]:t;if(200===e.status)R([n]),B();else{if(202!==e.status)throw new Error(`Received unexpected response status (${e.status}) while fetching chart data`);(0,oo.YJ)(n).then((e=>{R(e),B()})).catch((e=>{F(e.message||e.error||(0,l.t)("Check configuration")),B()}))}}else R(t.result),F(""),B()})).catch((e=>{F(e.statusText),B()}))}}),[M,w,j,z,B,JSON.stringify(t),A,L,k]),(0,o.useEffect)((()=>{var e;(null==n?void 0:n[0])===t.id&&(null==P||null==(e=P.current)||e.focus())}),[P,n,t.id]);const W=(0,o.useCallback)((e=>i(t,e)),[t,i]),H=(0,o.useCallback)((()=>bc(K,g)),[K,g]),G=(0,o.useCallback)((()=>bc(K)),[K]),Y=(0,o.useMemo)((()=>({setDataMask:W,setFocusedFilter:H,unsetFocusedFilter:G,setFilterActive:h})),[W,h,H,G]),J=fd(t,null==(p=t.dataMask)?void 0:p.filterState),Q=(0,o.useMemo)((()=>{var e;return{...null==(e=t.dataMask)?void 0:e.filterState,validateStatus:J&&"error"}}),[null==(f=t.dataMask)?void 0:f.filterState,J]);return T?(0,v.tZ)(no,{title:(0,l.t)("Cannot load filter"),body:T,level:"error"}):(0,v.tZ)(yc,null,$?(0,v.tZ)(u.Z,{position:"inline-centered"}):(0,v.tZ)(wo.Z,{height:32,width:"100%",showOverflow:s,formData:D,parentRef:c,inputRef:P,queriesData:A?Z:Cc,chartType:y,behaviors:Sc,filterState:Q,ownState:null==(m=t.dataMask)?void 0:m.ownState,enableNoResults:null==x?void 0:x.enableNoResults,isRefreshing:L,hooks:Y}))},wc=e=>{var t,n;return(null==e||null==(t=e.meta)?void 0:t.text)||(null==e||null==(n=e.meta)?void 0:n.defaultText)||""},kc=e=>{var t,n;return(null==e||null==(t=e.meta)?void 0:t.sliceNameOverride)||(null==e||null==(n=e.meta)?void 0:n.sliceName)||(null==e?void 0:e.id)||""},Zc=g.iK.div`
  ${({theme:e})=>v.iv`
    display: flex;
    align-items: center;
    margin: ${e.gridUnit}px 0;
    font-size: ${e.typography.sizes.s}px;

    &:first-of-type {
      margin-top: 0;
    }

    &:last-of-type {
      margin-bottom: 0;
    }

    & .ant-tooltip-open {
      display: inline-flex;
    }
  `};
`,Rc=g.iK.span`
  ${({theme:e})=>v.iv`
    color: ${e.colors.grayscale.base};
    padding-right: ${4*e.gridUnit}px;
    margin-right: auto;
    text-transform: uppercase;
    white-space: nowrap;
  `};
`,Tc=g.iK.div`
  ${({theme:e})=>v.iv`
    color: ${e.colors.grayscale.dark1};
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline;
  `};
`,Fc=g.iK.span`
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
`,Dc=g.iK.span`
  text-decoration: underline;
  cursor: pointer;
`,_c=g.iK.span`
  ${({theme:e})=>v.iv`
    color: ${e.colors.primary.base};
  `}
`,Ec=g.iK.ul`
  ${({theme:e})=>v.iv`
    padding-left: ${3*e.gridUnit}px;
    margin-bottom: 0;
  `};
`,Ic=g.iK.span`
  font-weight: ${({theme:e})=>e.typography.weights.bold};
`,Mc=g.iK.div`
  min-width: 0;
  display: inline-flex;
  white-space: nowrap;
`,Oc=e=>{var t,n;const[i,r]=(0,o.useState)(0),[a,s]=(0,o.useState)(!1);return(0,o.useLayoutEffect)((()=>{const t=e.current;if(!t)return;const{scrollWidth:n,clientWidth:i,childNodes:o}=t;if(n>i){const e=i-6,t=o.length;let n=0,a=0;for(;n<e;)n+=o[a].offsetWidth,a+=1;a===t?(r(1),s(!1)):(r(t-a),s(!0))}else r(0)}),[null==(t=e.current)?void 0:t.offsetWidth,null==(n=e.current)?void 0:n.clientWidth,e]),[i,a]},Pc=({title:e,children:t,...n})=>(0,v.tZ)(Wn.u,mt()({title:e,placement:"bottom",overlayClassName:"filter-card-tooltip"},n),(0,v.tZ)(Mc,null,t)),Nc=(e,t)=>Array.isArray(e)&&e.length>0?(0,v.tZ)(o.Fragment,null,(0,v.tZ)(Ic,null,t,":"),(0,v.tZ)(Ec,null,e.map((e=>(0,v.tZ)("li",null,e))))):null,jc=o.memo((({filter:e})=>{const t=(e=>{const t=(0,r.v9)((e=>e.dashboardLayout.present)),n=(()=>{const e=(0,r.v9)((e=>e.charts));return(0,o.useMemo)((()=>Object.values(e)),[e])})();return(0,o.useMemo)((()=>{let i;const r=t[D._4].children[0];if(r.startsWith("TABS-")&&(i=t[r].children),0===e.scope.rootPath.length)return;if(0===e.scope.excluded.length&&(e.scope.rootPath[0]===D._4||i&&i.every((t=>e.scope.rootPath.includes(t)))))return{all:[(0,l.t)("All charts")]};if(0===e.scope.excluded.length&&i)return{tabs:e.scope.rootPath.map((e=>wc(t[e]))).filter(Boolean)};const o=Object.values(t).filter((e=>e.type===h.dW));if(e.scope.rootPath[0]===D._4)return{charts:n.filter((t=>!e.scope.excluded.includes(t.id))).map((e=>{const t=o.find((t=>t.meta.chartId===e.id));return kc(t)})).filter(Boolean)};if(i){const i=[...e.scope.rootPath],r=o.filter((e=>e.parents.some((e=>i.includes(e)))));e.scope.excluded.forEach((e=>{const t=i.findIndex((t=>{var n;return null==(n=r.find((t=>t.meta.chartId===e)))?void 0:n.parents.includes(t)}));t>-1&&i.splice(t,1)}));const a=n.filter((t=>!e.scope.excluded.includes(t.id))).reduce(((e,t)=>{const n=r.find((e=>e.meta.chartId===t.id&&e.parents.every((e=>!i.includes(e)))));return n&&e.push(n),e}),[]);return{tabs:i.map((e=>wc(t[e]))).filter(Boolean),charts:a.map(kc).filter(Boolean)}}}),[n,e.scope.excluded,e.scope.rootPath,t])})(e),n=(0,o.useRef)(null),[i,a]=Oc(n),s=(0,o.useMemo)((()=>0!==i&&t?t.all?(0,v.tZ)("span",null,(0,l.t)("All charts")):(0,v.tZ)("div",null,Nc(t.tabs,(0,l.t)("Tabs")),Nc(t.charts,(0,l.t)("Charts"))):null),[i,t]);return(0,v.tZ)(Zc,null,(0,v.tZ)(Rc,null,(0,l.t)("Scope")),(0,v.tZ)(Pc,{title:s},(0,v.tZ)(Tc,{ref:n},t?Object.values(t).flat().map(((e,t)=>(0,v.tZ)("span",null,0===t?e:`, ${e}`))):(0,l.t)("None")),a>0&&(0,v.tZ)(_c,null,"+",i)))})),qc=({dependency:e,hasSeparator:t})=>{const n=(0,r.I0)(),i=(0,o.useCallback)((()=>{n((0,Ut.E2)([e.id]))}),[e.id,n]);return(0,v.tZ)("span",null,t&&(0,v.tZ)("span",null,", "),(0,v.tZ)(Dc,{role:"button",onClick:i,tabIndex:0},e.name))},zc=o.memo((({filter:e})=>{const t=(e=>{const t=(0,lr.Z)(e.cascadeParentIds);return(0,r.v9)((e=>0===t.length?[]:t.reduce(((t,n)=>(t.push(e.nativeFilters.filters[n]),t)),[])))})(e),n=(0,o.useRef)(null),[i,a]=Oc(n),s=(0,g.Fg)(),d=(0,o.useMemo)((()=>i>0&&t?(0,v.tZ)(Ec,null,t.map((e=>(0,v.tZ)("li",null,(0,v.tZ)(qc,{dependency:e}))))):null),[i,t]);return Array.isArray(t)&&0!==t.length?(0,v.tZ)(Zc,null,(0,v.tZ)(Rc,{css:v.iv`
          display: inline-flex;
          align-items: center;
        `},(0,l.t)("Dependent on")," ",(0,v.tZ)(Pc,{title:(0,l.t)("Filter only displays values relevant to selections made in other filters.")},(0,v.tZ)(ot.Z.Info,{iconSize:"m",iconColor:s.colors.grayscale.light1,css:v.iv`
              margin-left: ${s.gridUnit}px;
            `}))),(0,v.tZ)(Pc,{title:d},(0,v.tZ)(Tc,{ref:n},t.map(((e,t)=>(0,v.tZ)(qc,{dependency:e,hasSeparator:0!==t})))),a&&(0,v.tZ)(_c,null,"+",i))):null})),Ac=({filter:e})=>{const t=(0,o.useRef)(null),[n]=Oc(t);return(0,v.tZ)(Zc,{css:e=>v.iv`
          margin-bottom: ${3*e.gridUnit}px;
        `},(0,v.tZ)(ot.Z.FilterSmall,{css:e=>v.iv`
            margin-right: ${e.gridUnit}px;
          `}),(0,v.tZ)(Pc,{title:n?e.name:null},(0,v.tZ)(Fc,{ref:t},e.name)))},$c=({filter:e})=>{const t=(0,o.useMemo)((()=>(0,Bi.Z)().get(e.filterType)),[e.filterType]);return(0,v.tZ)(Zc,null,(0,v.tZ)(Rc,null,(0,l.t)("Filter type")),(0,v.tZ)(Tc,null,null==t?void 0:t.name))},Uc=({filter:e})=>(0,v.tZ)("div",null,(0,v.tZ)(Ac,{filter:e}),(0,v.tZ)($c,{filter:e}),(0,v.tZ)(jc,{filter:e}),(0,v.tZ)(zc,{filter:e})),Lc=({children:e,filter:t,getPopupContainer:n,isVisible:i=!0})=>{const[r,a]=(0,o.useState)(!1);return(0,o.useEffect)((()=>{i||a(!1)}),[i]),(0,v.tZ)(Wa.ZP,{placement:"right",overlayClassName:"filter-card-popover",mouseEnterDelay:.2,mouseLeaveDelay:.2,onVisibleChange:e=>{a(i&&e)},visible:i&&r,content:(0,v.tZ)(Uc,{filter:t}),getPopupContainer:null!=n?n:()=>document.body,destroyTooltipOnHide:!0},e)},Vc=g.iK.div`
  position: absolute;
  right: 0;
`,Kc=g.iK.h4`
  font-size: ${({theme:e})=>e.typography.sizes.s}px;
  color: ${({theme:e})=>e.colors.grayscale.dark1};
  margin: 0;
  overflow-wrap: break-word;
`,Bc=g.iK.div`
  display: flex;
  flex-direction: row;
  align-items: center;
  justify-content: space-between;
  margin-bottom: ${({theme:e})=>e.gridUnit}px;
`,Wc=(0,g.iK)(Dt.l0)`
  width: 100%;
  && .ant-form-item-label > label {
    text-transform: none;
    width: 100%;
    padding-right: ${({theme:e})=>11*e.gridUnit}px;
  }
  .ant-form-item-tooltip {
    margin-bottom: ${({theme:e})=>e.gridUnit}px;
  }
`,Hc=(0,g.iK)(Dt.xJ)`
  .ant-form-item-label {
    label.ant-form-item-required:not(.ant-form-item-required-mark-optional) {
      &::after {
        display: none;
      }
    }
  }
`,Gc=g.iK.div`
  font-size: ${({theme:e})=>e.typography.sizes.m}px;
  display: flex;
`,Yc=()=>(0,v.tZ)("span",{css:e=>({color:e.colors.error.base,fontSize:`${e.typography.sizes.s}px`,paddingLeft:"1px"})},"*"),Jc=({description:e})=>(0,v.tZ)(Gc,null,(0,v.tZ)(Wn.u,{title:e,placement:"right",overlayInnerStyle:{display:"-webkit-box",overflow:"hidden",WebkitLineClamp:20,WebkitBoxOrient:"vertical",textOverflow:"ellipsis"}},(0,v.tZ)("i",{className:"fa fa-info-circle text-muted",css:e=>({paddingLeft:`${e.gridUnit}px`,cursor:"pointer"})}))),Qc=({dataMaskSelected:e,filter:t,icon:n,onFilterSelectionChange:i,directPathToChild:r,inView:a,showOverflow:s,parentRef:l})=>{var d,c,u;const[h,p]=(0,o.useState)(!1),{name:f="<undefined>"}=t,m=fd(t,null==(d=t.dataMask)?void 0:d.filterState),g=!(null==(c=t.controlValues)||!c.enableEmptyFilter),b=(0,o.useMemo)((()=>(0,v.tZ)(Bc,null,(0,v.tZ)(Kc,null,f),g&&(0,v.tZ)(Yc,null),t.description&&t.description.trim()&&(0,v.tZ)(Jc,{description:t.description}),(0,v.tZ)(Vc,null,n))),[f,g,t.description,n]),y=(0,o.useContext)(gu);return(0,v.tZ)(Wc,{layout:"vertical"},(0,v.tZ)(Lc,{filter:t,isVisible:!h&&!y},(0,v.tZ)("div",null,(0,v.tZ)(Hc,{label:b,required:null==t||null==(u=t.controlValues)?void 0:u.enableEmptyFilter,validateStatus:m?"error":void 0},(0,v.tZ)(xc,{dataMaskSelected:e,filter:t,showOverflow:s,directPathToChild:r,onFilterSelectionChange:i,inView:a,parentRef:l,setFilterActive:p})))))},Xc=o.memo(Qc),eu=g.iK.div`
  padding: ${({theme:e})=>4*e.gridUnit}px;
  // 108px padding to make room for buttons with position: absolute
  padding-bottom: ${({theme:e})=>27*e.gridUnit}px;
`,tu=({directPathToChild:e,dataMaskSelected:t,onFilterSelectionChange:n})=>{const i=xd(),a=(0,o.useMemo)((()=>Object.values(i)),[i]),s=(0,o.useMemo)((()=>{const e=new Array(a.length);for(let t=0;t<a.length;t+=1)e[t]=mc();return e}),[a.length]),d=(0,o.useMemo)((()=>a.map((e=>({...e,dataMask:t[e.id]})))),[a,t]),c=new Set(d.map((e=>e.id))),[u,p]=function(e){const t=Tr(),n=function(){const e=(0,r.v9)((e=>{var t;return null==(t=e.dashboardState)?void 0:t.activeTabs})),t=function(){const e=Rr();return t=>{const n=Object.values(e).find((e=>{var n;return(null==(n=e.meta)?void 0:n.chartId)===t}));return null==n?void 0:n.parents.filter((t=>e[t].type===h.gn))}}();return n=>{var i;return(0,wr.nY)(n)||"chartsInScope"in n&&(null==(i=n.chartsInScope)?void 0:i.some((n=>{const i=t(n);return 0===(null==i?void 0:i.length)||(null==i?void 0:i.every((t=>e.includes(t))))})))}}();return(0,o.useMemo)((()=>{let i=[];const r=[];return t?e.forEach((e=>{n(e)?i.push(e):r.push(e)})):i=e,[i,r]}),[e,t,n])}(d),f=Tr()&&d.length>0,m=(0,o.useCallback)((i=>{const r=d[i];return(0,wr.nY)(r)?(0,v.tZ)("div",null,(0,v.tZ)("h3",null,r.title),(0,v.tZ)("p",null,r.description)):(0,v.tZ)(Xc,{dataMaskSelected:t,filter:r,directPathToChild:e,onFilterSelectionChange:n,inView:!1})}),[d,JSON.stringify(t),e,n]);return(0,v.tZ)(eu,null,s.filter(((e,t)=>c.has(a[t].id))).map(((e,t)=>(0,v.tZ)(pc,{node:e},m(t)))),u.map((e=>{const t=a.findIndex((t=>t.id===e.id));return(0,v.tZ)(fc,{node:s[t],inView:!0})})),f&&(0,v.tZ)(Ze.Ol,{ghost:!0,bordered:!0,expandIconPosition:"right",collapsible:0===p.length?"disabled":void 0,css:e=>(0,v.iv)("&.ant-collapse{margin-top:",u.length>0?6*e.gridUnit:0,"px;&>.ant-collapse-item{&>.ant-collapse-header{padding-left:0;padding-bottom:",2*e.gridUnit,"px;&>.ant-collapse-arrow{right:",e.gridUnit,"px;}}& .ant-collapse-content-box{padding:",4*e.gridUnit,"px 0 0;}}}","")},(0,v.tZ)(Ze.Ol.Panel,{header:(0,l.t)("Filters out of scope (%d)",p.length),key:"1"},p.map((e=>{const t=d.findIndex((t=>t.id===e.id));return(0,v.tZ)(fc,{node:s[t],inView:!0})})))))},nu=o.memo(tu);var iu=n(54076);const ru=g.iK.div`
  ${({theme:e})=>v.iv`
    display: flex;
    flex-direction: column;
    align-items: center;

    position: fixed;
    z-index: 100;

    // filter bar width minus 1px for border
    width: ${Ps.I6-1}px;
    bottom: 0;

    padding: ${4*e.gridUnit}px;
    padding-top: ${6*e.gridUnit}px;

    background: linear-gradient(transparent, white 25%);

    pointer-events: none;

    & > button {
      pointer-events: auto;
    }

    & > .filter-apply-button {
      margin-bottom: ${3*e.gridUnit}px;
    }

    && > .filter-clear-all-button {
      color: ${e.colors.grayscale.base};
      margin-left: 0;
      &:hover {
        color: ${e.colors.primary.dark1};
      }

      &[disabled],
      &[disabled]:hover {
        color: ${e.colors.grayscale.light1};
      }
    }
  `};
`,ou=({onApply:e,onClearAll:t,dataMaskApplied:n,dataMaskSelected:i,isApplyDisabled:r})=>{const a=(0,o.useMemo)((()=>Object.values(n).some((e=>{var t,n,r;return!(0,iu.Rw)(null==(t=i[e.id])||null==(n=t.filterState)?void 0:n.value)||!i[e.id]&&!(0,iu.Rw)(null==(r=e.filterState)?void 0:r.value)}))),[n,i]);return(0,v.tZ)(ru,null,(0,v.tZ)(at.Z,mt()({disabled:r,buttonStyle:"primary",htmlType:"submit",className:"filter-apply-button",onClick:e},au("apply-button")),(0,l.t)("Apply filters")),(0,v.tZ)(at.Z,mt()({disabled:!a,buttonStyle:"link",buttonSize:"small",className:"filter-clear-all-button",onClick:t},au("clear-button")),(0,l.t)("Clear all")))},au=(0,xr.Q)("filter-bar"),su=g.iK.div`
  width: ${({theme:e})=>8*e.gridUnit}px;

  & .ant-tabs-top > .ant-tabs-nav {
    margin: 0;
  }
  &.open {
    width: ${({width:e})=>e}px; // arbitrary...
  }
`,lu=g.iK.div`
  & .ant-typography-edit-content {
    left: 0;
    margin-top: 0;
    width: 100%;
  }
  position: absolute;
  top: 0;
  left: 0;
  flex-direction: column;
  flex-grow: 1;
  width: ${({width:e})=>e}px;
  background: ${({theme:e})=>e.colors.grayscale.light5};
  border-right: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  border-bottom: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  min-height: 100%;
  display: none;
  &.open {
    display: flex;
  }
`,du=g.iK.div`
  position: absolute;
  top: ${({offset:e})=>e}px;
  left: 0;
  height: 100%;
  width: ${({theme:e})=>8*e.gridUnit}px;
  padding-top: ${({theme:e})=>2*e.gridUnit}px;
  display: none;
  text-align: center;
  &.open {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: ${({theme:e})=>2*e.gridUnit}px;
  }
  svg {
    cursor: pointer;
  }
`,cu=(0,g.iK)(ot.Z.Collapse)`
  color: ${({theme:e})=>e.colors.primary.base};
  margin-bottom: ${({theme:e})=>3*e.gridUnit}px;
`,uu=(0,g.iK)(ot.Z.Filter)`
  color: ${({theme:e})=>e.colors.grayscale.base};
`,hu=(0,g.iK)(Ze.D6)`
  & .ant-tabs-nav-list {
    width: 100%;
  }
  & .ant-tabs-tab {
    display: flex;
    justify-content: center;
    margin: 0;
    flex: 1;
  }

  & > .ant-tabs-nav .ant-tabs-nav-operations {
    display: none;
  }
`,pu=g.iK.div`
  margin-top: ${({theme:e})=>8*e.gridUnit}px;
`,fu=[pt.KD.nativeFilters.name,pt.KD.permalinkKey.name],mu=x()((async(e,t,n,i,r)=>{const{location:o}=e,{search:a}=o,s=new URLSearchParams(a),l=new URLSearchParams;let d;s.forEach(((e,t)=>{fu.includes(t)||l.append(t,e)}));const c=(0,bt.eY)(pt.KD.nativeFiltersKey),u=JSON.stringify(i);d=n&&c&&await(0,yt.TZ)(t,u,c,r)?c:await(0,yt.u7)(t,u,r),d&&l.set(pt.KD.nativeFiltersKey.name,d),e.location.pathname=window.location.pathname,e.replace({search:l.toString()})}),Sr.M),gu=(0,o.createContext)(!1),vu=({filtersOpen:e,toggleFiltersBar:t,directPathToChild:n,width:i,height:a,offset:s})=>{const c=(0,ld.k6)(),h=wd(),[p,f]=(0,o.useState)(null),[g,b]=(0,dd.x)(h),y=(0,r.I0)(),[C,S]=(0,o.useState)(0),x=(0,hd.z)(),w=Sd(),k=Object.values(w),[Z,R]=(0,o.useState)(sd.AllFilters),T=xd(),F=(0,da.D)(T),D=Object.values(T),_=D.filter(wr.kI),E=(0,r.v9)((({dashboardInfo:e})=>null==e?void 0:e.id)),I=(0,r.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),[O,P]=(0,o.useState)(!1),N=(0,o.useRef)(),j=(0,o.useCallback)(((e,t)=>{b((n=>{var i,r,o;void 0!==(null==(i=t.filterState)?void 0:i.value)&&void 0===(null==(r=g[e.id])||null==(o=r.filterState)?void 0:o.value)&&e.requiredFirst&&y((0,Qe.eG)(e.id,t)),n[e.id]={...(0,cd.H)(e.id),...t}}))}),[g,y,b]);(0,o.useEffect)((()=>{if(F){const e={};Object.values(T).forEach((t=>{const n=null==F?void 0:F[t.id];if(!n)return;const i=t.filterType,r=t.targets,o=t.defaultDataMask,a=null==n?void 0:n.filterType,s=null==n?void 0:n.targets,l=null==n?void 0:n.defaultDataMask,d=i!==a,c=!$i()(r,s),u=!$i()(o,l);(d||c||u)&&(e[t.id]=(0,cd.H)(t.id))})),Vt()(e)||(b((t=>({...t,...e}))),Object.keys(e).forEach((e=>y((0,Qe.ze)(e)))))}}),[JSON.stringify(T),JSON.stringify(F)]);const q=JSON.stringify(h);(0,o.useEffect)((()=>{b((()=>h))}),[q,b]),(0,o.useEffect)((()=>{mu(c,E,C,h,x)}),[E,q,c,C,x]);const z=(0,o.useCallback)((()=>{const e=Object.keys(g);S(1),e.forEach((e=>{g[e]&&y((0,Qe.eG)(e,g[e]))}))}),[g,y]),A=(0,o.useCallback)((()=>{Object.keys(g).forEach((e=>{g[e]&&(y((0,Qe.ze)(e)),b((t=>{var n;void 0!==(null==(n=t[e].filterState)?void 0:n.value)&&(t[e].filterState.value=void 0)})))}))}),[g,y,b]),$=(0,o.useCallback)((()=>t(!0)),[t]),U=(0,o.useCallback)(M()((()=>{clearTimeout(N.current),P(!0),N.current=setTimeout((()=>{P(!1)}),300)}),200),[]);(0,o.useEffect)((()=>(document.onscroll=U,()=>{document.onscroll=null})),[U]),((e,t)=>{const n=xd(),i=wd();(0,o.useEffect)((()=>{Object.keys(e).forEach((e=>{n[e]||t((t=>{delete t[e]}))}))}),[i,e,n,t])})(g,b);const L=((e,t,n)=>{const i=Object.values(e),r=Object.values(t);return(0,Ii.JB)(pd(e),pd(t),{ignoreUndefined:!0})||i.length!==r.length||n.some((t=>{var n;return fd(t,null==e||null==(n=e[null==t?void 0:t.id])?void 0:n.filterState)}))})(g,h,_),V=(()=>{const[e,t]=(0,o.useState)(!1),n=xd(),i=(0,o.useContext)(Cd.MigrationContext);let a=(0,r.v9)((e=>e.charts)),s=0;if(!e)if(i===Re.Qi.REVIEWING){a=vd()(yd()(a,(e=>{var t;return"filter_box"!==(null==(t=e.formData)?void 0:t.viz_type)})),"id");const e=document.querySelectorAll('[data-test-viz-type="filter_box"]').length;s=document.querySelectorAll('[data-ui-anchor="chart"]').length-e}else s=document.querySelectorAll('[data-ui-anchor="chart"]').length;return(0,o.useEffect)((()=>{if(e)return;if(Object.values(n).find((({requiredFirst:e})=>e)))return void t(!0);let i;0===s&&(i=setTimeout((()=>{t(!0)}),1e3)),s>0&&void 0!==i&&clearTimeout(i);const r=Object.values(a).filter((({chartStatus:e})=>"loading"!==e)).length;s>0&&r>=s&&t(!0)}),[a,e,s]),e})(),K=(0,o.useMemo)((()=>({overflow:"auto",height:a,overscrollBehavior:"contain"})),[a]),B=_.length;return(0,v.tZ)(gu.Provider,{value:O},(0,v.tZ)(su,mt()({},au(),{className:m()({open:e}),width:i}),(0,v.tZ)(du,mt()({},au("collapsable"),{className:m()({open:!e}),onClick:$,offset:s}),(0,v.tZ)(cu,mt()({},au("expand-button"),{iconSize:"l"})),(0,v.tZ)(uu,mt()({},au("filter-icon"),{iconSize:"l"}))),(0,v.tZ)(lu,{className:m()({open:e}),width:i},(0,v.tZ)(ac,{toggleFiltersBar:t}),V?(0,rt.cr)(d.T.DASHBOARD_NATIVE_FILTERS_SET)?(0,v.tZ)(hu,{centered:!0,onChange:R,defaultActiveKey:sd.AllFilters,activeKey:p?sd.AllFilters:void 0},(0,v.tZ)(Ze.D6.TabPane,{tab:(0,l.t)("All filters (%(filterCount)d)",{filterCount:B}),key:sd.AllFilters,css:K},p&&(0,v.tZ)(Xd,{dataMaskSelected:g,disabled:!L,onCancel:()=>f(null),filterSetId:p}),0===D.length?(0,v.tZ)(pu,null,(0,v.tZ)(ud.Tc,{title:(0,l.t)("No filters are currently added"),image:"filter.svg",description:I&&(0,l.t)("Click the button above to add a filter to the dashboard")})):(0,v.tZ)(nu,{dataMaskSelected:g,directPathToChild:n,onFilterSelectionChange:j})),(0,v.tZ)(Ze.D6.TabPane,{disabled:!!p,tab:(0,l.t)("Filter sets (%(filterSetCount)d)",{filterSetCount:k.length}),key:sd.FilterSets,css:K},(0,v.tZ)(Kd,{onEditFilterSet:f,disabled:!L,dataMaskSelected:g,tab:Z,onFilterSelectionChange:j}))):(0,v.tZ)("div",{css:K,onScroll:U},0===D.length?(0,v.tZ)(pu,null,(0,v.tZ)(ud.Tc,{title:(0,l.t)("No filters are currently added"),image:"filter.svg",description:I&&(0,l.t)("Click the button above to add a filter to the dashboard")})):(0,v.tZ)(nu,{dataMaskSelected:g,directPathToChild:n,onFilterSelectionChange:j})):(0,v.tZ)("div",{css:(0,v.iv)({height:a},"","")},(0,v.tZ)(u.Z,null)),(0,v.tZ)(ou,{onApply:z,onClearAll:A,dataMaskSelected:g,dataMaskApplied:h,isApplyDisabled:L}))))},bu=o.memo(vu),yu=e=>{const t=e[D._4],n=null==t?void 0:t.children[0];return n===D.PV?e[D._4]:e[n]},Cu=(e,t)=>"ant-tabs-nav-wrap"===e.target.className||t.contains(e.target);var Su=n(78718),xu=n.n(Su);const wu={depth:s().number.isRequired,editMode:s().bool.isRequired,gridComponent:E.cP.isRequired,handleComponentDrop:s().func.isRequired,isComponentVisible:s().bool.isRequired,resizeComponent:s().func.isRequired,setDirectPathToChild:s().func.isRequired,width:s().number.isRequired},ku=e=>e.dropIndicatorProps&&(0,v.tZ)("div",{className:"drop-indicator drop-indicator--bottom"}),Zu=e=>e.dropIndicatorProps&&(0,v.tZ)("div",{className:"drop-indicator drop-indicator--top"}),Ru=g.iK.div`
  position: absolute;
  top: 0;
  bottom: 0;
  left: 0;
  right: 0;
`;class Tu extends o.PureComponent{constructor(e){super(e),this.state={isResizing:!1,rowGuideTop:null},this.handleResizeStart=this.handleResizeStart.bind(this),this.handleResize=this.handleResize.bind(this),this.handleResizeStop=this.handleResizeStop.bind(this),this.handleTopDropTargetDrop=this.handleTopDropTargetDrop.bind(this),this.getRowGuidePosition=this.getRowGuidePosition.bind(this),this.setGridRef=this.setGridRef.bind(this),this.handleChangeTab=this.handleChangeTab.bind(this)}getRowGuidePosition(e){return e&&this.grid?e.getBoundingClientRect().bottom-this.grid.getBoundingClientRect().top-2:null}setGridRef(e){this.grid=e}handleResizeStart({ref:e,direction:t}){let n=null;"bottom"!==t&&"bottomRight"!==t||(n=this.getRowGuidePosition(e)),this.setState((()=>({isResizing:!0,rowGuideTop:n})))}handleResize({ref:e,direction:t}){"bottom"!==t&&"bottomRight"!==t||this.setState((()=>({rowGuideTop:this.getRowGuidePosition(e)})))}handleResizeStop({id:e,widthMultiple:t,heightMultiple:n}){this.props.resizeComponent({id:e,width:t,height:n}),this.setState((()=>({isResizing:!1,rowGuideTop:null})))}handleTopDropTargetDrop(e){e&&this.props.handleComponentDrop({...e,destination:{...e.destination,index:0}})}handleChangeTab({pathToTabIndex:e}){this.props.setDirectPathToChild(e)}render(){var e,t,n;const{gridComponent:i,handleComponentDrop:r,depth:a,editMode:s,width:d,isComponentVisible:c}=this.props,u=(d+D.es)/D.cz-D.es,{isResizing:h,rowGuideTop:p}=this.state;return d<100?null:(0,v.tZ)(o.Fragment,null,s&&0===(null==i||null==(e=i.children)?void 0:e.length)&&(0,v.tZ)(Ru,null,(0,v.tZ)(ud.XJ,{title:(0,l.t)("Drag and drop components and charts to the dashboard"),description:(0,l.t)("You can create new charts or use existing ones from the panel on the right"),buttonText:(0,v.tZ)(o.Fragment,null,(0,v.tZ)("i",{className:"fa fa-plus"}),(0,l.t)("Create a new chart")),buttonAction:()=>{window.location.assign("/chart/add")},image:"chart.svg"})),(0,v.tZ)("div",{className:"dashboard-grid",ref:this.setGridRef},(0,v.tZ)("div",{className:"grid-content"},s&&(0,v.tZ)(ee,{component:i,depth:a,parentComponent:null,index:0,orientation:"column",onDrop:this.handleTopDropTargetDrop,className:"empty-droptarget",editMode:!0},ku),null==i||null==(t=i.children)?void 0:t.map(((e,t)=>(0,v.tZ)(ad,{key:e,id:e,parentId:i.id,depth:a+1,index:t,availableColumnCount:D.cz,columnWidth:u,isComponentVisible:c,onResizeStart:this.handleResizeStart,onResize:this.handleResize,onResizeStop:this.handleResizeStop,onChangeTab:this.handleChangeTab}))),s&&(null==i||null==(n=i.children)?void 0:n.length)>0&&(0,v.tZ)(ee,{component:i,depth:a,parentComponent:null,index:i.children.length,orientation:"column",onDrop:r,className:"empty-droptarget",editMode:!0},Zu),h&&Array(D.cz).fill(null).map(((e,t)=>(0,v.tZ)("div",{key:`grid-column-${t}`,className:"grid-column-guide",style:{left:t*D.es+t*u,width:u}}))),h&&p&&(0,v.tZ)("div",{className:"grid-row-guide",style:{top:p,width:d}}))))}}Tu.propTypes=wu,Tu.defaultProps={};const Fu=Tu,Du=(0,r.$j)((function({dashboardState:e}){return{editMode:e.editMode}}),(function(e){return(0,i.DE)({handleComponentDrop:xi._p,resizeComponent:xi.iO,setDirectPathToChild:Ut.E2},e)}))(Fu),_u=({topLevelTabs:e})=>{const t=(0,r.v9)((e=>e.dashboardLayout.present)),n=(()=>{const e=(0,r.v9)((e=>{var t;return null==(t=e.nativeFilters)?void 0:t.filters}));return(0,o.useMemo)((()=>e?Object.values(e).map((e=>xu()(e,["id","scope","type"]))):[]),[JSON.stringify(e)])})(),i=(0,r.v9)((e=>e.dashboardState.directPathToChild)),a=(0,r.v9)((e=>e.charts)),[s,l]=(0,o.useState)(((e,t)=>Math.max(0,Hl({currentComponent:yu(e),directPathToChild:t})))(t,i)),c=(0,r.I0)();(0,o.useEffect)((()=>{const e=Hl({currentComponent:yu(t),directPathToChild:i});e>-1&&l(e)}),[Yl(i)]),(0,o.useEffect)((()=>{if(!(0,d.c)(d.T.DASHBOARD_NATIVE_FILTERS)||0===n.length)return;const e=n.map((e=>{if(e.id.startsWith(ca.Ky))return{filterId:e.id,tabsInScope:[],chartsInScope:[]};const n=function(e,t,n){const i=Object.values(n);return Object.values(t).filter((t=>{var n,r;return!e.excluded.includes(t.id)&&(null==(n=i.find((e=>{var n;return(null==e?void 0:e.type)===h.dW&&(null==(n=e.meta)?void 0:n.chartId)===t.id})))||null==(r=n.parents)?void 0:r.some((t=>e.rootPath.includes(t))))})).map((e=>e.id))}(e.scope,a,t),i=(0,Ei.Rz)(t,n);return{filterId:e.id,tabsInScope:Array.from(i),chartsInScope:n}}));c((0,md.xk)(e))}),[n,t,c]);const u=e?e.children:[D.PV],p=Math.min(s,u.length-1),f=0===p?D.PV:p.toString();return(0,v.tZ)("div",{className:"grid-container"},(0,v.tZ)(T,null,(({width:e})=>(0,v.tZ)(y.ZP,{id:D.PV,activeKey:f,renderTabBar:()=>(0,v.tZ)(o.Fragment,null),fullWidth:!1,animated:!1,allowOverflow:!0},u.map(((n,i)=>(0,v.tZ)(y.ZP.TabPane,{key:0===i?D.PV:i.toString()},(0,v.tZ)(Du,{gridComponent:t[n],depth:D.Mu+1,width:e,isComponentVisible:i===s}))))))))},Eu=g.iK.div`
  display: grid;
  grid-template-columns: auto 1fr;
  grid-template-rows: auto 1fr;
  flex: 1;
  /* Special cases */

  /* A row within a column has inset hover menu */
  .dragdroppable-column .dragdroppable-row .hover-menu--left {
    left: -12px;
    background: ${({theme:e})=>e.colors.grayscale.light5};
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  }

  .dashboard-component-tabs {
    position: relative;
  }

  /* A column within a column or tabs has inset hover menu */
  .dragdroppable-column .dragdroppable-column .hover-menu--top,
  .dashboard-component-tabs .dragdroppable-column .hover-menu--top {
    top: -12px;
    background: ${({theme:e})=>e.colors.grayscale.light5};
    border: 1px solid ${({theme:e})=>e.colors.grayscale.light2};
  }

  /* move Tabs hover menu to top near actual Tabs */
  .dashboard-component-tabs > .hover-menu-container > .hover-menu--left {
    top: 0;
    transform: unset;
    background: transparent;
  }

  /* push Chart actions to upper right */
  .dragdroppable-column .dashboard-component-chart-holder .hover-menu--top,
  .dragdroppable .dashboard-component-header .hover-menu--top {
    right: 8px;
    top: 8px;
    background: transparent;
    border: none;
    transform: unset;
    left: unset;
  }
  div:hover > .hover-menu-container .hover-menu,
  .hover-menu-container .hover-menu:hover {
    opacity: 1;
  }
`,Iu=g.iK.div`
  grid-column: 1;
  grid-row: 1 / span 2;
  z-index: 11;
`,Mu=g.iK.div`
  position: sticky;
  top: -1px;
  width: ${({width:e})=>e}px;
  flex: 0 0 ${({width:e})=>e}px;
`,Ou=g.iK.div`
  grid-column: 2;
  grid-row: 1;
  position: sticky;
  top: 0;
  z-index: 100;
`,Pu=g.iK.div`
  grid-column: 2;
  grid-row: 2;
  // @z-index-above-dashboard-header (100) + 1 = 101
  ${({fullSizeChartId:e})=>e&&"z-index: 101;"}
`,Nu=g.iK.div`
  display: flex;
  flex-direction: row;
  flex-wrap: nowrap;
  height: auto;
  flex: 1;

  .grid-container .dashboard-component-tabs {
    box-shadow: none;
    padding-left: 0;
  }

  .grid-container {
    /* without this, the grid will not get smaller upon toggling the builder panel on */
    width: 0;
    flex: 1;
    position: relative;
    margin-top: ${({theme:e})=>6*e.gridUnit}px;
    margin-right: ${({theme:e})=>8*e.gridUnit}px;
    margin-bottom: ${({theme:e})=>6*e.gridUnit}px;
    margin-left: ${({theme:e,dashboardFiltersOpen:t,editMode:n,nativeFiltersEnabled:i})=>t||n||!i?8*e.gridUnit:0}px;

    ${({editMode:e,theme:t})=>e&&`\n      max-width: calc(100% - ${Ps.XX+16*t.gridUnit}px);\n    `}
  }

  .dashboard-builder-sidepane {
    width: ${Ps.XX}px;
    z-index: 1;
  }

  .dashboard-component-chart-holder {
    // transitionable traits to show filter relevance
    transition: opacity ${({theme:e})=>e.transitionTiming}s,
      border-color ${({theme:e})=>e.transitionTiming}s,
      box-shadow ${({theme:e})=>e.transitionTiming}s;
    border: 0 solid transparent;
  }
`,ju=()=>{var e,t;const n=(0,r.I0)(),i=(0,Ki.fG)(),a=(0,r.v9)((e=>e.dashboardLayout.present)),s=(0,r.v9)((e=>e.dashboardState.editMode)),c=(0,r.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),h=(0,r.v9)((e=>e.dashboardState.directPathToChild)),p=(0,r.v9)((e=>e.dashboardState.fullSizeChartId)),f=(0,o.useCallback)((({pathToTabIndex:e})=>{n((0,Ut.E2)(e))}),[n]),g=(0,o.useCallback)((()=>{n((0,xi.g3)());const e=Gl(yu(a),0);n((0,Ut.E2)(e))}),[a,n]),y=(0,o.useCallback)((e=>n((0,xi._p)(e))),[n]),C=a[D._4],S=null==C?void 0:C.children[0],x=S!==D.PV?a[S]:void 0,w=(0,bt.eY)(pt.KD.standalone),k=w===D._B.REPORT,Z=i.hideTitle||w===D._B.HIDE_NAV_AND_TITLE||k,R=(Z?0:Ps.Mz)+(x?Ps.RX:0),{showDashboard:T,dashboardFiltersOpen:F,toggleDashboardFiltersOpen:_,nativeFiltersEnabled:E}=(()=>{const e=(0,o.useContext)(Cd.MigrationContext),[t,n]=(0,o.useState)(!1),i=(0,r.v9)((e=>{var t,n;return(null==(t=(0,bt.eY)(pt.KD.showFilters))||t)&&(null==(n=e.dashboardInfo.metadata)?void 0:n.show_native_filters)})),a=(0,r.v9)((({dashboardInfo:e})=>e.dash_edit_perm)),s=xd(),l=Object.values(s),c=(0,bt.eY)(pt.KD.expandFilters),[u,h]=(0,o.useState)(null!=c?c:!!l.length),p=i&&(0,rt.cr)(d.T.DASHBOARD_NATIVE_FILTERS)&&(a||!a&&0!==l.length),f=l.filter((e=>e.requiredFirst)),m=wd(),g=t||!p||!(p&&f.length&&f.find((({id:e})=>{var t,n;return void 0===(null==(t=m[e])||null==(n=t.filterState)?void 0:n.value)}))),v=(0,o.useCallback)((e=>{h(null!=e?e:!u)}),[u]);return(0,o.useEffect)((()=>{!1===c||0===l.length&&p&&["CONVERTED","REVIEWING","NOOP"].includes(e)?v(!1):v(!0)}),[l.length,e]),(0,o.useEffect)((()=>{g&&n(!0)}),[g]),{showDashboard:g,dashboardFiltersOpen:u,toggleDashboardFiltersOpen:v,nativeFiltersEnabled:p}})(),I=F?Ps.I6:Ps.gz,[M,O]=function(e){const t=(0,o.useRef)(null),[n,i]=(0,o.useState)(!1),r=e=>{const[t]=e;i(t.intersectionRatio<1)};return(0,o.useEffect)((()=>{const n=new IntersectionObserver(r,e),i=t.current;return i&&n.observe(i),()=>{i&&n.unobserve(i)}}),[t,e]),[t,n]}({threshold:[1]}),P=(0,rt.cr)(d.T.DASHBOARD_NATIVE_FILTERS_SET),N=`calc(100vh - ${Ps.UN+(O||w?0:Ps.Ky)+(P?Ps.a7:0)}px)`,j=F?0:R+20,q=(0,o.useMemo)((()=>({marginLeft:F||s||!E?0:-32})),[F,s,E]),z=(0,o.useCallback)((({dropIndicatorProps:e})=>(0,v.tZ)("div",null,!Z&&(0,v.tZ)(Ri,null),e&&(0,v.tZ)("div",e),!k&&x&&!i.hideNav&&(0,v.tZ)(gl,{shouldFocus:Cu,menuItems:[(0,v.tZ)(Di,{icon:(0,v.tZ)(ot.Z.FallOutlined,{iconSize:"xl"}),label:"Collapse tab content",onClick:g})],editMode:s},(0,v.tZ)(ad,{id:null==x?void 0:x.id,parentId:D._4,depth:D.Mu+1,index:0,renderTabContent:!1,renderHoverMenu:!1,onChangeTab:f})))),[s,f,g,Z,k,x,i.hideNav]);return(0,v.tZ)(Eu,null,E&&!s&&(0,v.tZ)(Iu,null,(0,v.tZ)(Mu,{ref:M,width:I},(0,v.tZ)(b.Z,null,(0,v.tZ)(bu,{filtersOpen:F,toggleFiltersBar:_,directPathToChild:h,width:I,height:N,offset:j})))),(0,v.tZ)(Ou,null,(0,v.tZ)(ee,{component:C,parentComponent:null,depth:D.Mu,index:0,orientation:"column",onDrop:y,editMode:s,disableDragDrop:!!x,style:q},z)),(0,v.tZ)(Pu,{fullSizeChartId:p},(0,v.tZ)(v.xB,{styles:v.iv`
            // @z-index-above-dashboard-header (100) + 1 = 101
            ${p&&"div > .filterStatusPopover.ant-popover{z-index: 101}"}
          `}),!s&&!x&&0===(null==(e=a[D.PV])||null==(t=e.children)?void 0:t.length)&&(0,v.tZ)(ud.XJ,{title:(0,l.t)("There are no charts added to this dashboard"),description:c&&(0,l.t)("Go to the edit mode to configure the dashboard and add charts"),image:"dashboard.svg"}),(0,v.tZ)("div",{className:m()("dashboard",s&&"dashboard--editing")},(0,v.tZ)(Nu,{className:"dashboard-content",dashboardFiltersOpen:F,editMode:s,nativeFiltersEnabled:E},T?(0,v.tZ)(_u,{topLevelTabs:x}):(0,v.tZ)(u.Z,null),s&&(0,v.tZ)(Je,{isStandalone:!!w,topOffset:R})))))};var qu=n(49997);const zu=[h.dW,h.xh,h.t];function Au(e){return!Object.values(e).some((({type:e})=>e&&zu.includes(e)))}const $u={actions:s().shape({addSliceToDashboard:s().func.isRequired,removeSliceFromDashboard:s().func.isRequired,triggerQuery:s().func.isRequired,logEvent:s().func.isRequired,clearDataMaskState:s().func.isRequired}).isRequired,dashboardInfo:E.$X.isRequired,dashboardState:E.DZ.isRequired,charts:s().objectOf(E.$6).isRequired,slices:s().objectOf(E.Rw).isRequired,activeFilters:s().object.isRequired,chartConfiguration:s().object.isRequired,datasources:s().object.isRequired,ownDataCharts:s().object.isRequired,layout:s().object.isRequired,impressionId:s().string.isRequired,initMessages:s().array,timeout:s().number,userId:s().string};class Uu extends o.PureComponent{static onBeforeUnload(e){e?window.addEventListener("beforeunload",Uu.unload):window.removeEventListener("beforeunload",Uu.unload)}static unload(){const e=(0,l.t)("You have unsaved changes.");return window.event.returnValue=e,e}constructor(e){var t,n;super(e),this.appliedFilters=null!=(t=e.activeFilters)?t:{},this.appliedOwnDataCharts=null!=(n=e.ownDataCharts)?n:{},this.onVisibilityChange=this.onVisibilityChange.bind(this)}componentDidMount(){const e=document.getElementById("app"),t=(null==e?void 0:e.getAttribute("data-bootstrap"))||"{}",{dashboardState:n,layout:i}=this.props,r={is_soft_navigation:it.Yd.timeOriginOffset>0,is_edit_mode:n.editMode,mount_duration:it.Yd.getTimestamp(),is_empty:Au(i),is_published:n.isPublished,bootstrap_data_length:t.length},o=(0,Us.Z)();o&&(r.target_id=o),this.props.actions.logEvent(it.Wl,r),"hidden"===document.visibilityState&&(this.visibilityEventData={start_offset:it.Yd.getTimestamp(),ts:(new Date).getTime()}),window.addEventListener("visibilitychange",this.onVisibilityChange),this.applyCharts()}componentDidUpdate(){this.applyCharts()}UNSAFE_componentWillReceiveProps(e){const t=p(this.props.layout),n=p(e.layout);this.props.dashboardInfo.id===e.dashboardInfo.id&&(t.length<n.length?n.filter((e=>-1===t.indexOf(e))).forEach((t=>{return this.props.actions.addSliceToDashboard(t,(n=e.layout,i=t,Object.values(n).find((e=>e&&e.type===h.dW&&e.meta&&e.meta.chartId===i))));var n,i})):t.length>n.length&&t.filter((e=>-1===n.indexOf(e))).forEach((e=>this.props.actions.removeSliceFromDashboard(e))))}applyCharts(){const{hasUnsavedChanges:e,editMode:t}=this.props.dashboardState,{appliedFilters:n,appliedOwnDataCharts:i}=this,{activeFilters:r,ownDataCharts:o,chartConfiguration:a}=this.props;(0,d.c)(d.T.DASHBOARD_CROSS_FILTERS)&&!a||(t||(0,Ii.JB)(i,o,{ignoreUndefined:!0})&&(0,Ii.JB)(n,r,{ignoreUndefined:!0})||this.applyFilters(),e?Uu.onBeforeUnload(!0):Uu.onBeforeUnload(!1))}componentWillUnmount(){window.removeEventListener("visibilitychange",this.onVisibilityChange),this.props.actions.clearDataMaskState()}onVisibilityChange(){if("hidden"===document.visibilityState)this.visibilityEventData={start_offset:it.Yd.getTimestamp(),ts:(new Date).getTime()};else if("visible"===document.visibilityState){const e=this.visibilityEventData.start_offset;this.props.actions.logEvent(it.Ev,{...this.visibilityEventData,duration:it.Yd.getTimestamp()-e})}}getAllCharts(){return Object.values(this.props.charts)}applyFilters(){const{appliedFilters:e}=this,{activeFilters:t,ownDataCharts:n}=this.props,i=Object.keys(t),r=Object.keys(e),o=new Set(i.concat(r)),a=((e,t)=>{const n=Object.keys(e),i=Object.keys(t),r=(o=n,a=i,[...o.filter((e=>!a.includes(e))),...a.filter((e=>!o.includes(e)))]).filter((n=>e[n]||t[n]));var o,a;return new Set([...n,...i]).forEach((n=>{(0,Ii.JB)(e[n],t[n])||r.push(n)})),[...new Set(r)]})(n,this.appliedOwnDataCharts);[...o].forEach((n=>{if(!i.includes(n)&&r.includes(n))a.push(...e[n].scope);else if(r.includes(n)){if((0,Ii.JB)(e[n].values,t[n].values,{ignoreUndefined:!0})||a.push(...t[n].scope),!(0,Ii.JB)(e[n].scope,t[n].scope)){const i=(t[n].scope||[]).concat(e[n].scope||[]);a.push(...i)}}else a.push(...t[n].scope)})),this.refreshCharts([...new Set(a)]),this.appliedFilters=t,this.appliedOwnDataCharts=n}refreshCharts(e){e.forEach((e=>{this.props.actions.triggerQuery(!0,e)}))}render(){return this.context.loading?(0,v.tZ)(u.Z,null):(0,v.tZ)(o.Fragment,null,(0,v.tZ)(qu.Z,null),(0,v.tZ)(ju,null))}}Uu.contextType=c.Zn,Uu.propTypes=$u,Uu.defaultProps={initMessages:[],timeout:60,userId:""};const Lu=Uu;var Vu=n(50810);const Ku=(0,r.$j)((function(e){var t,n,i,r,o;const{datasources:a,sliceEntities:s,charts:l,dataMask:d,dashboardInfo:c,dashboardState:u,dashboardLayout:h,impressionId:p,nativeFilters:f}=e;return{initMessages:null==(t=c.common)?void 0:t.flash_messages,timeout:null==(n=c.common)||null==(i=n.conf)?void 0:i.SUPERSET_WEBSERVER_TIMEOUT,userId:c.userId,dashboardInfo:c,dashboardState:u,charts:l,datasources:a,activeFilters:{...(0,un.De)(),...Ni({chartConfiguration:null==(r=c.metadata)?void 0:r.chart_configuration,nativeFilters:f.filters,dataMask:d,layout:h.present})},chartConfiguration:null==(o=c.metadata)?void 0:o.chart_configuration,ownDataCharts:Pi(d,"ownState"),slices:s.slices,layout:h.present,impressionId:p}}),(function(e){return{actions:(0,i.DE)({setDatasources:Vu.Fy,clearDataMaskState:Qe.sh,addSliceToDashboard:Ut.Pi,removeSliceFromDashboard:Ut.rL,triggerQuery:_i.triggerQuery,logEvent:ki.logEvent},e)}}))(Lu)},90057:(e,t,n)=>{"use strict";n.d(t,{x:()=>o,C:()=>a});var i=n(18172),r=n(67294);function o(e){var t=(0,r.useState)((function(){return(0,i.vV)("function"==typeof e?e():e,!0)})),n=t[1];return[t[0],(0,r.useCallback)((function(e){n("function"==typeof e?(0,i.ZP)(e):(0,i.vV)(e))}),[])]}function a(e,t,n){var o=(0,r.useMemo)((function(){return(0,i.ZP)(e)}),[e]);return(0,r.useReducer)(o,t,n)}}}]);